{"id": 1177, "wybug_id": "wooyun-2014-065731", "wybug_title": "Ecmall Sql 注入 第一枚。", "wybug_corp": "ShopEx", "wybug_author": "′雨。", "wybug_date": "2014-06-26 15:25", "wybug_open_date": "2014-09-24 15:26", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-24：\t细节向公众公开  简要描述： 打了补丁试试。 详细说明：  在app/message.app.php中\nfunction drop()    {        $msg_ids = isset($_GET['msg_id']) ? trim($_GET['msg_id']) : '';        if (!$msg_ids)        {            $this->show_warning('no_such_message');            return;        }        $msg_ids = explode(',',$msg_ids);        $mod_message = &m('message');        foreach ($msg_ids as $key=>$msg_id){            $message = $mod_message->find(intval($msg_id));            $message = current($message);            if(!$message || $message['parent_id']!=0)            {                unset($msg_ids[$key]);  //过滤掉回复的和数据库没有的短信的msg_id            }        }        if (!$msg_ids)        {            $this->show_warning('no_such_message');            return;        }        if (!$mod_message->msg_drop($msg_ids, $this->visitor->get('user_id')))    //删除        {            $this->show_warning($mod_message->get_error());            return;        }\n\n$msg_ids = isset($_GET['msg_id']) ? trim($_GET['msg_id']) : '';\n这里没有过滤 跟进一下函数\nfunction msg_drop($msg_id, $user_id)    {        $msg_ids = is_array($msg_id) ? $msg_id : explode(',', $msg_id);        if (!$msg_ids)        {            $this->_error('no_such_message');            return false;        }        if (!$user_id)        {            $this->_error('no_such_user');            return false;        }        foreach ($msg_ids as $msg_id)        {            $message = $this->get_info($msg_id);            if ($user_id==$message['to_id']) //收件箱            {                if ($message['status']==2 || $message['status']==3)                {                    $this->edit($msg_id, array('status' => 2));                }else                {                    $drop_ids[] = $msg_id; //记录需要删除记录的msg_id                }            }\n没过滤 再跟\nfunction edit($conditions, $edit_data)    {         if (empty($edit_data))        {            return false;        }        $edit_data = $this->_valid($edit_data);        if (!$edit_data)        {            return false;        }        $edit_fields = $this->_getSetFields($edit_data);        $conditions  = $this->_getConditions($conditions, false);        $this->db->query(\"UPDATE {$this->table} SET {$edit_fields}{$conditions}\");        return $this->db->affected_rows();\n带入到update中。来注入把。   漏洞证明：  首先注册两个号 用一个号给另外一个号发短消息然后另外一个号查看的时候抓个包。\n\n\n\n可以报错注入。   修复方案：      $msg_ids = isset($_GET['msg_id']) ? intval($_GET['msg_id']) : '';   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2014-06-26 15:32 厂商回复： 非常感谢您为shopex信息安全做的贡献已经做过过滤 非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-26 16:34 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n     。。难道你说的做的过滤是说的你们618补丁全局那过滤？那我就无语了。    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}