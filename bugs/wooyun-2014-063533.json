{"id": 2782, "wybug_id": "wooyun-2014-063533", "wybug_title": "蝉游记从web到IOS到Android漏洞组合", "wybug_corp": "chanyouji.com", "wybug_author": "摄影会长", "wybug_date": "2014-06-05 07:57", "wybug_open_date": "2014-07-23 20:28", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向公众公开  简要描述： 你家CEO头像把我吓着了，赶紧发点东西压压惊。。。 标题党   详细说明：  进入正题：Web婵游记我看了下CEO的介绍：就几个人用4个月把应用做出来上线。那先从网站看起，看了下联合创始人Quake Wang的githubhttps://github.com/quake/quake.github.com/blob/master/slides/huohua/index.html \n\n用Ruby on Rails 写的，嗯 ,好框架～看了一下端口，开了443用 CVE-2014-0160的脚本测试了下漏洞存在， \n\n本来到这里 测试over，但想想太对不起纯银的头像了。这里看了下dump出内存的东西，解码后 浏览下没有常规的帐号，密码 cookie。研究了一下数据 判断这应该是手机app交互的接口。IOS挂起burp用iphone打开应用， \n\n测试没错请求是用authorization进行的认证\nGET /api/tokens.json HTTP/1.1Host: chanyouji.comProxy-Connection: closeAccept-Encoding: gzipAuthorization: Basic  *************M6eA==User-Agent: iPhone5,2;iPhone OS;7.1;2.3Connection: close\n查看dump的data很多Authorization的信息 整理下 \n\n测试了下接口 \n\n可以成功登录别人的帐号  （auth认证是持久的，可直接同步他人的数据）当然也可以刷粉丝之类。POST /api/friends.json friend_id=xxxx看到一个奇怪的请求http://cyjs.qiniudn.com/pois/58-78.zip（qiniudn是chanyouji的图片存储主机） \n\n进行了加密再研究下静态分析ipa手机未越狱，所以采用静态分析，下载了chanyouji3.41版本这里先要破除DRM，dump出内存，重打包了ipa.拖入ida6.4中，有很多sub_ 未识别的函数，Quake Wang OC写的不标准啊 \n\n查找pois的函数，顺着找，找到zip 解密部分，看到密码  （怎么是hacker编码。。。） \n\n解压压缩文件\n\n 旅游地点景点酒店坐标 ，我看了纯银的微博，地图偏移有关？（用我0.01精度的火星地图查了几个，貌似有的也没有纠偏）看下数据存储用itools直接导出数据库sqlite  未加密用sqlite browser 打开\n\n是同步错了么？Android下载了APK  反编译了一下，也看了下那个密码的部分  判断下APK 和ipa是否用的相同？Android下用的zip解密 肯定用到ZipFile类,搜索下 \nfileoutputstream.write(binaryData); fileoutputstream.flush(); fileoutputstream.close();ZipFile zipfile = new ZipFile(file); if(zipfile.isEncrypted())                                                zipfile.setPassword(\"chany0uj1\"); zipinputstream = zipfile.getInputStream(zipfile.getFileHeader(\"poi.csv\"));\n密码相同。数据库存储同样未加密的sqlite存储检测下Manifest.xmlexported=\"true\"有几项  可被DOS例：\n<receiver android:exported=\"true\" android:name=\"com.umeng.message.NotificationProxyBroadcastReceiver\"/>\n友盟分析数据也不是很重要广播receiver 可被外部应用调用 可以限制下访问权限（可做可不做）其他没什么了   漏洞证明：  \n\n莱小妞的。。。。。   修复方案：  1.给个婵小队的签名吧(^^)2.纯银赶紧换头像   版权声明：转载请注明来源 摄影会长@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2014-06-05 08:41 厂商回复： api调用https heartbleed漏洞已经修复，用户token持久时间过长的问题，我们会在后续app版本里面改成较短时间周期，截图中给出的莱小妞同学账号token已经失效。数据库加密密码泄露问题已忽略，因为客户端有保留解密以后的数据库，可以直接dump出来，该数据不是敏感信息，是用来保存景点坐标的离线包，加密码是为了托管在CDN上的zip文件防爬虫考虑。CEO头像已换，蝉小队签名请提供一个邮寄方式，或者直接发送邮件到，我们会尽快快递过去，十分感谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-05 16:34 |    \t\tzhq445078388 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:19        | 请牢记\"杀进程点康姆\")\t\t \n  CEO头像已换..2333    \n     2014-06-05 16:41 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  CEO头像已换....    \n     2014-06-25 10:26 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:103        | going)\t\t \n  CEO头像已换....    \n     2014-06-25 11:51 |    \t\tF4K3R \t\t\t( 普通白帽子  |\t\t\t        Rank:297 漏洞数:31        | 学习)\t\t \n  CEO头像已换....     \n     2014-08-01 10:39 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n   CEO好乖， 我不禁好奇是什么头像    \n     2015-01-14 15:02 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  思路流程不错，学习了～    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}