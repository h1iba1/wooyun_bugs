{"id": 11983, "wybug_id": "wooyun-2013-026232", "wybug_title": "我是如何沦陷ChinaZ下载站服务器的，可登录3389、篡改源码等", "wybug_corp": "站长之家", "wybug_author": "牛奶坦克", "wybug_date": "2013-06-18 15:24", "wybug_open_date": "2013-06-23 15:24", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "渗透测试思路", "管理后台对外", "安全意识不足", "后台被猜解"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-06-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-06-23：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述：   测试的源头来自我很好奇为啥Chinaz上的源码总是可能被人放后门，源码下载站的安全情况到底如何？测试结果：  从最开始某个漏洞Down掉了chinaz下载站的整站源码（down.chinaz.com），然后打开的第一个文件就发现了一处由于理解问题导致的安全漏洞。。。最终获取了服务器管理员权限，找到修改后的3389端口，成功登录远程服务器！PS：具体看细节吧，源码包篡改什么你们懂。。厂商速度处理，很严重。PS2：几个测试文件和帐号都已经清理，现在网站和服务器依然纯洁。 详细说明：  从chinaz主站的网段中找到了一台服务器，这台服务器开了rsync，而且匿名即可访问与下载（后来证明这台服务器就是down的服务器）。\n\n排除了一些静态文件目录，导出一些ASP的脚本文件，看web.config，有数据库密码信息\n\n发现有个“zczamzk”目录，是个奇怪的后台，看样子功能强大\n\n但没密码，准备挖挖源码看看有漏洞木，结果打开的第一个文件就发现有问题：\naction = Replace(Trim(Request.QueryString(\"action\")),\"'\",\"\")articleid = Replace(Trim(Request.QueryString(\"articleid\")),\"'\",\"\")typee = Replace(Trim(Request.QueryString(\"typee\")),\"'\",\"\")if action=\"show\" then\t  set rs=server.createobject(\"adodb.recordset\")\t  sql=\"Select * From DP_Mood Where articleid=\"&articleid&\"\"      rs.open sql,conn,1,3\t  If Not(rs.Eof And rs.Bof) Then\narticleid看似做了处理，是针对字符型变量的过滤，但是下面真正的语句是整形的，呵，可以注射http://down.chinaz.com/xq.asp?action=show&articleid=123%20and%201=1http://down.chinaz.com/xq.asp?action=show&articleid=123%20and%201=2懒人用sqlmap跑。。（dbo.DP_Administrator：adminname，adminpassword）\n\nmd5给秒破了，成功登录到后台\n\n\n\n源码下载服务器等\n\n   漏洞证明：  拿shell吧，有个很常见的文章管理功能，上传文件，这里尝试了几次，只拿可行的检测结果证明，只需上传个名为”1.asp;.zip“的文件，利用IIS解析漏洞即可。\n\n写个.net大马进去，哦了\n\n用了个最新的Windows提权程序，秒了服务器管理员权限\n\n\n\n（怕其他人发现这个账户，测试完就给删除了）最后做个简单的小证明吧：http://down.chinaz.com/wooyun.txt\n\n   修复方案：  都在细节里了   版权声明：转载请注明来源 牛奶坦克@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-06-23 15:24 厂商回复：  漏洞Rank：20  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-06-18 15:25 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  我似乎知道那些源码包里的后门是咋上去的了。。。    \n     2013-06-18 15:27 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  你好,牛奶    \n     2013-06-18 15:29 |    \t\t牛奶坦克 \t\t\t( 普通白帽子  |\t\t\t        Rank:355 漏洞数:20        | 晚安,牛奶)\t\t \n  @梧桐雨 你好， 梧桐雨    \n     2013-06-18 15:42 |    \t\t78基佬 \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:20        | 不会日站的设计师不是好产品经理)\t\t \n  大神    \n     2013-06-18 16:36 |    \t\t坏人咖啡 \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:4        | 做一个简简单单的坏人)\t\t \n  洞主牛B    \n     2013-06-18 16:38 |    \t\tX,D \t\t\t( 普通白帽子  |\t\t\t        Rank:143 漏洞数:7        | X,D)\t\t \n  他们还玩3389呢？    \n     2013-06-18 17:05 |    \t\tLeon \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 永无宁日啊)\t\t \n  @X,D 被他改成3389了吧！    \n     2013-06-18 18:59 |    \t\t基佬库克 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:15        | 简介什么的是直接爆菊吧..)\t\t \n  站长网这么悲惨..同情一下    \n     2013-06-18 22:02 |    \t\ttxcbg \t\t\t( 普通白帽子  |\t\t\t        Rank:391 漏洞数:53        | 说点什么呢？)\t\t \n  围观    \n     2013-06-19 22:44 |    \t\t夜 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:4        | 小夜，一个苦逼程序员)\t\t \n  貌似老衲也经常在上面下载啊！    \n     2013-06-23 16:27 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:146        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  @疯狗 猜测依据是？    \n     2013-06-23 16:46 |    \t\tSct7p \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 懂与不懂之间只隔了一层纸，懂的人会觉得很...)\t\t \n  霸气的忽略    \n     2013-06-23 17:03 |    \t\t纠结师 \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:12        | 传说中的废材)\t\t \n  幸好忽略了。。。 不然又不知道得罪多少人的了。、。    \n     2013-06-23 20:08 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @纠结师 此话怎讲啊？    \n     2013-06-24 11:18 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:170        | 力不从心)\t\t \n  忽略？！    \n     2013-06-24 12:01 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @wefgod 目测厂商已经得知漏洞细节并忽略，哎，乌云给补分。。。    \n     2013-06-24 16:08 |    \t\tLeon \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 永无宁日啊)\t\t \n  叫人情何以堪啊！忽略！    \n     2013-06-24 16:25 |    \t\tX,D \t\t\t( 普通白帽子  |\t\t\t        Rank:143 漏洞数:7        | X,D)\t\t \n  忽略了?这是什么节奏？    \n     2013-06-24 18:10 |    \t\t牛奶坦克 \t\t\t( 普通白帽子  |\t\t\t        Rank:355 漏洞数:20        | 晚安,牛奶)\t\t \n  @X,D 害羞的节奏，大乌云已经给我补分了，感谢    \n     2013-06-24 18:58 |    \t\tX,D \t\t\t( 普通白帽子  |\t\t\t        Rank:143 漏洞数:7        | X,D)\t\t \n  其实我最喜欢点忽略的厂商。    \n     2013-06-25 22:50 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:88        | 梦想还是要有的，万一实现了呢？)\t\t \n  @牛奶坦克 洞主分享下那个提权exp    \n     2013-07-02 10:36 |    \t\tsaber \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:1        | 我只是一个人走了太久，久到习惯了一个人。)\t\t \n  @疯狗 真相了。。    \n     2013-07-02 10:47 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @if、so 作者分享了，可见 http://zone.wooyun.org/content/4730     \n     2013-07-26 09:28 |    \t\t小震 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | ~)\t\t \n  危害等级：无影响厂商忽略    \n     2013-11-26 08:45 |    \t\t灬相随灬 \t\t\t( 普通白帽子  |\t\t\t        Rank:369 漏洞数:64        | 大胆天下去得，小心寸步难行。)\t\t \n  好厉害！    \n     2014-01-08 23:15 |    \t\t蓝盾科技 \t\t\t( 实习白帽子  |\t\t\t        Rank:90 漏洞数:16        | 蓝盾科技致力于网络安全，信息安全，通信安...)\t\t \n  @灬相随灬 熊熊可知道我在找你    \n     2015-02-03 10:30 |    \t\t__Happy \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | xxxx)\t\t \n  rsync x.x.x.x::www我成功进入后，要怎么下载里面的东西？求教啊！！    \n     2015-02-03 11:35 |    \t\t灬相随灬 \t\t\t( 普通白帽子  |\t\t\t        Rank:369 漏洞数:64        | 大胆天下去得，小心寸步难行。)\t\t \n  @蓝盾科技 我去！你谁啊，干嘛找我    \n     2015-05-08 16:03 |    \t\tRas Al Ghul \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:4        | 不可知论主义者)\t\t \n  好强    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}