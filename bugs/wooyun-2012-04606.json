{"id": 20910, "wybug_id": "wooyun-2012-04606", "wybug_title": "凤凰分站注射漏洞读取配置文件获得网站路径THEN读取网站文件", "wybug_corp": "凤凰网", "wybug_author": "疯狂", "wybug_date": "2012-02-17 20:18", "wybug_open_date": "2012-04-02 20:19", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射", "服务权限设置不当", "源码泄漏", "任意文件读取利用", "服务配置不当", "数据库账户权限过高"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-02-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-02-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-02-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-03-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-03-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-04-02：\t细节向公众公开  简要描述： 以点破面...... 详细说明：  \n\n\n\n这是网站注入点...   漏洞证明：  \n\n\n\n\n\n\n\n读取敏感文件，一个一个的读，慢死我了   修复方案：  终于有发现了:loveyou.cfgContent is :  server {   listen       80;   server_name  bbs.travel.ifeng.com bbsfile.travel.ifeng.com;   ssi on;   client_max_body_size    4m;   index index.shtml index.html index.php;   root  /data/ifengsite/htdocs/bbs;        if ( $fastcgi_script_name ~ \\..*\\/.*php ) {       return 403;        }        location ~ ^/(admin|include|attachments|templates|forumdata)/.*\\.(php|php5)$        {        deny all;        }        location ~ .*admincp\\.(php|php5)?$ {         allow 220.181.67.0/24;         allow 220.181.48.0/24;         allow 210.51.19.0/24;         allow 210.51.18.0/24;         allow 211.151.61.0/24;         allow 210.51.19.11;         allow 127.0.0.1;         deny all;        fastcgi_pass  127.0.0.1:9000;        fastcgi_index index.php;        include fcgi.conf;        }   location ~ .*\\.(php|php5)?$ {        fastcgi_pass  127.0.0.1:9000;        fastcgi_index index.php;        include fcgi.conf;        }   error_page   404              /404.html;   error_page   500 502 503 504  50x.html;   location = /50x.html {        root   /data/ifengsite/htdocs;        }   location ~ .*\\.(gif|jpg|png|bmp|jpeg|ico|tif|css)$ {        expires 60m;        valid_referers none blocked *.ifeng.com *.phoenixtv.com ;        if ($invalid_referer) {                return 403;                }        }   location ~ .*\\.(mpeg|mpg|mov|asf|wmv|wma|mp3|rm|rmvb|swf)$ {        expires 120m;        }   location ~ .*\\.(shtml|htm|html|js)$ {        expires 10m;        }   log_format  accessbbs  '$remote_addr - $remote_user [$time_local] \"$request\" '             '$status $body_bytes_sent \"$http_referer\" '             '\"$http_user_agent\" ';   access_log  /data/logs/nginx/bbs_access.log  accessbbs;   rewrite ^(.*)/archiver/((fid|tid)-[\\w\\-]+\\.html)$ $1/archiver/index.php?$2 last;   rewrite ^(.*)/forum-([0-9]+)-([0-9]+)\\.html$ $1/forumdisplay.php?fid=$2&page=$3 last;   rewrite ^(.*)/thread-([0-9]+)-([0-9]+)-([0-9]+)\\.html$ $1/viewthread.php?tid=$2&extra=page%3D$4&page=$3 last;   rewrite ^(.*)/tag-(.+)\\.html$ $1/tag.php?name=$2 last; } server {   listen       80;   server_name  app.travel.ifeng.com app.travel.fashion.ifeng.com;   ssi on;   index index.html index.php;   root  /data/ifengsite/htdocs/app;   location ~ ^/(cache|upload|templates_c)/.*\\.(php|php5)$        {        deny all;        }   location ~ .*\\.(php|php5)?$ {        fastcgi_pass  127.0.0.1:9000;        fastcgi_index index.php;        include fcgi.conf;        }   error_page   404              /404.html;   error_page   500 502 503 504  50x.html;   location = /50x.html {        root   /data/ifengsite/htdocs;        }   location ~ .*\\.(gif|jpg|png|bmp|jpeg|ico|tif|css)$ {        expires 60m;        valid_referers none blocked *.ifeng.com *.phoenixtv.com ;        if ($invalid_referer) {                return 403;                }        }   location ~ .*\\.(mpeg|mpg|mov|asf|wmv|wma|mp3|rm|rmvb|swf)$ {        expires 120m;        }   location ~ .*\\.(shtml|htm|html|js)$ {        expires 10m;        }   log_format  accessapp  '$remote_addr - $remote_user [$time_local] \"$request\" '             '$status $body_bytes_sent \"$http_referer\" '             '\"$http_user_agent\" ';   access_log  /data/logs/nginx/app_access.log  accessapp;   rewrite ^/scenery_comment_(\\d+)$ /scenery_comment.php?scenery=$1 last;   rewrite ^/scenery_(.*)$ /scenery.php?scenery_$1 last;   rewrite ^/tools/((?!index.php|images|js|style).*)$ /tools/index.php?$1 last;   rewrite ^/city_detail_(\\d+)$ /city_detail.php?id=$1 last;   rewrite ^/city_intro_(\\d+)$ /city_intro.php?id=$1 last;   rewrite ^/city_image_(\\d+)$ /city_image.php?id=$1 last;   rewrite ^/city_comment_(\\d+)$ /city_comment.php?city=$1 last;   rewrite ^/city_blog_(\\d+)$ /city_blog.php?city=$1 last;   rewrite ^/city_news_(\\d+)$ /city_news.php?city=$1 last;   rewrite ^/line_list_(\\d+)$ /line_list.php?to_city_id2=$1 last;   rewrite ^/line_detail_(\\d+)$ /line_detail.php?id=$1 last;   rewrite ^/map_(\\w+)_(\\d+)$ /map.php?$1=$2 last;   rewrite ^/continent_(\\d+)$ /continent.php?id=$1 last;   rewrite ^/country_(\\d+)$ /country.php?id=$1 last;   rewrite ^/province_(\\d+)$ /province.php?id=$1 last;   rewrite ^/map_(\\w+)_(\\d+)$ /map.php?$1=$2 last; } server {   listen       80;   server_name  admin.travel.ifeng.com;   ssi on;   index index.html index.php;   root  /data/ifengsite/htdocs/admin;     location ~ .*\\.(php|php5)?$ {         allow 220.181.67.0/24;         allow 210.51.19.0/24;         allow 210.51.18.0/24;         allow 211.151.61.0/24;         allow 210.51.19.11;         deny all;        fastcgi_pass  127.0.0.1:9000;        fastcgi_index index.php;        include fcgi.conf;        }   location ~ .*\\.(php|php5)?$ {   #location ~ .*\\.(php|php5)?$ {         allow 220.181.67.0/24;         allow 210.51.19.0/24;         allow 210.51.18.0/24;         allow 211.151.61.0/24;         allow 210.51.19.11;         deny all;        fastcgi_pass  127.0.0.1:9000;        fastcgi_index index.php;        include fcgi.conf;        }   error_page   404              /404.html;   error_page   500 502 503 504  50x.html;   location = /50x.html {        root   /data/ifengsite/htdocs;        }   location ~ .*\\.(gif|jpg|png|bmp|jpeg|ico|tif|css)$ {        expires 60m;        valid_referers none blocked *.ifeng.com *.phoenixtv.com ;        if ($invalid_referer) {                return 403;                }        }   location ~ .*\\.(mpeg|mpg|mov|asf|wmv|wma|mp3|rm|rmvb|swf)$ {        expires 120m;        }   location ~ .*\\.(shtml|htm|html|js)$ {        expires 10m;        }   log_format  accessadmin  '$remote_addr - $remote_user [$time_local] \"$request\" '             '$status $body_bytes_sent \"$http_referer\" '             '\"$http_user_agent\" ';   access_log  /data/logs/nginx/admin_app_access.log  accessadmin; } server {   listen       80;   server_name  mysql.travel.ifeng.com;   ssi on;   index index.html index.php;   root  /data/ifengsite/htdocs/mysql;   location ~ .*\\.(php|php5)?$ {        fastcgi_pass  127.0.0.1:9000;        fastcgi_index index.php;        include fcgi.conf;        }   error_page   404              /404.html;   error_page   500 502 503 504  50x.html;   location = /50x.html {        root   /data/ifengsite/htdocs;        }   location ~ .*\\.(gif|jpg|png|bmp|jpeg|ico|tif|css)$ {        expires 60m;        valid_referers none blocked *.ifeng.com *.phoenixtv.com ;        if ($invalid_referer) {                return 403;                }        }   location ~ .*\\.(mpeg|mpg|mov|asf|wmv|wma|mp3|rm|rmvb|swf)$ {        expires 120m;        }   location ~ .*\\.(shtml|htm|html|js)$ {        expires 10m;        }   log_format  accessmysql  '$remote_addr - $remote_user [$time_local] \"$request\" '             '$status $body_bytes_sent \"$http_referer\" '             '\"$http_user_agent\" ';   access_log  /data/logs/nginx/mysql_access.log  accessmysql; }还有一个：tech.conf server {   listen       80;   server_name  bbs.tech.ifeng.com;   ssi on;   index index.shtml index.html index.php;   root  /data/ifengsite/htdocs/tech_bbs;    location ~ ^/(admin|attachments|templates|forumdata)/.*\\.(php|php5)$        {        deny all;        }   location ~ .*\\.(php|php5)?$ {        fastcgi_pass  127.0.0.1:9000;        fastcgi_index index.php;        include fcgi.conf;        }   error_page   404              /404.html;   error_page   500 502 503 504  50x.html;   location = /50x.html {        root   /data/ifengsite/htdocs;        }   location ~ .*\\.(gif|jpg|png|bmp|jpeg|ico|tif|css)$ {        expires 60m;        valid_referers none blocked *.ifeng.com *.phoenixtv.com ;        if ($invalid_referer) {                return 403;                }        }   location ~ .*\\.(mpeg|mpg|mov|asf|wmv|wma|mp3|rm|rmvb|swf)$ {        expires 120m;        }   location ~ .*\\.(shtml|htm|html|js)$ {        expires 10m;        }   log_format  accesstechbbs  '$remote_addr - $remote_user [$time_local] \"$request\" '             '$status $body_bytes_sent \"$http_referer\" '             '\"$http_user_agent\" ';   access_log  /data/logs/nginx/tech_bbs_access.log  accessbbs; }呵呵路径和网站配置出来了,读取网站文件\n\n打完收工.....   版权声明：转载请注明来源 疯狂@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2012-02-17 21:54 厂商回复： 非常感谢你的提供。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-02-18 13:12 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  经典！！    \n     2012-02-18 13:18 |    \t\tshine  \t\t\t( 普通白帽子  |\t\t\t        Rank:831 漏洞数:77        | coder)\t\t \n  @xsser 怎么个经典法？简单描述一下啊！目前从标题来看，手法确实很委婉！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}