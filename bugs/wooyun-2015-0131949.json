{"id": 67691, "wybug_id": "wooyun-2015-0131949", "wybug_title": "thinksaas最新版存储xss", "wybug_corp": "thinksaas.cn", "wybug_author": "路人甲", "wybug_date": "2015-08-06 17:39", "wybug_open_date": "2015-11-09 17:41", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-11：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-09：\t细节向公众公开  简要描述： 过滤不当 详细说明：  最新版下载地址http://www.thinksaas.cn/service/down/跟前面thinksaas最新版xss2 WooYun: thinksaas最新版xss2 thinksaas最新版xss WooYun: thinksaas最新版xss 原理都一样 吐槽下 官网不让注册帐号 就在本地测试了 前人的我测试一个现在还可以 当然 漏洞文件肯定是不一样的漏洞文件 在app/article/action/add.php 25行中没有过滤 48行插入数据库\n<?phpdefined('IN_TS') or die('Access Denied.');$userid = aac('user') -> isLogin();switch ($ts) {\tcase \"\" :\t\tif ($TS_APP['allowpost'] == 0 && $TS_USER['isadmin'] == 0) {\t\t\ttsNotice('系统设置不允许会员发文章！');\t\t}\t\t$cateid = intval($_GET['cateid']);\t\t$title = '发布文章';\t\tinclude  template('add');\t\tbreak;\tcase \"do\" :\t\tif ($_POST['token'] != $_SESSION['token']) {\t\t\ttsNotice('非法操作！');\t\t}\t\t$cateid = intval($_POST['cateid']);\t\t$title = trim($_POST['title']);//这里没有过滤\t\t$content = tsClean($_POST['content']);\t\t$tag = tsClean($_POST['tag']);\t\t$addtime = date('Y-m-d H:i:s');\t\tif (intval($TS_USER['isadmin']) == 0) {\t\t\t// 过滤内容开始\t\t\taac('system') -> antiWord($title);\t\t\taac('system') -> antiWord($content);\t\t\taac('system') -> antiWord($tag);\t\t\t// 过滤内容结束\t\t}\t\tif ($title == '' || $content == '')\t\t\ttsNotice(\"标题和内容都不能为空！\");\t\t//1审核后显示0不审核\t\tif ($TS_APP['isaudit'] == 1) {\t\t\t$isaudit = 1;\t\t} else {\t\t\t$isaudit = 0;\t\t}\t\t$articleid = $new['article'] -> create('article', array('userid' => $userid, 'locationid' => aac('user') -> getLocationId($userid), 'cateid' => $cateid, 'title' => $title, 'content' => $content, 'isaudit' => $isaudit, 'addtime' => date('Y-m-d H:i:s')));//这里插入\t\t// 上传帖子图片开始\t\t$arrUpload = tsUpload($_FILES['photo'], $articleid, 'article', array('jpg', 'gif', 'png', 'jpeg'));\t\tif ($arrUpload) {\t\t\t$new['article'] -> update('article', array('articleid' => $articleid), array('path' => $arrUpload['path'], 'photo' => $arrUpload['url']));\t\t}\t\t// 上传帖子图片结束\t\t// 处理标签\t\taac('tag') -> addTag('article', 'articleid', $articleid, $tag);\t\t// 对积分进行处理\t\taac('user') -> doScore($TS_URL['app'], $TS_URL['ac'], $TS_URL['ts']);\t\theader(\"Location: \" . tsUrl('article', 'show', array('id' => $articleid)));\t\tbreak;}\n利用过程http://www.test.com/shenji/thinksaas2.4/index.php?app=article&ac=add发表文章输入以下内容\n\n点击发布 点击我的社区即可触发xss\n\n   漏洞证明：  \n\n   修复方案：  漏洞文件 在app/article/action/add.php 25行中tsClean过滤下即可   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-11-09 17:41 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}