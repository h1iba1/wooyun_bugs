{"id": 48382, "wybug_id": "wooyun-2015-0117890", "wybug_title": "微信某功能存在漏洞可导致严重的客户端拒绝服务攻击", "wybug_corp": "腾讯", "wybug_author": "procen424", "wybug_date": "2015-06-03 10:36", "wybug_open_date": "2015-09-02 14:28", "wybug_type": "拒绝服务", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["拒绝服务", "微信", "崩溃", "闪退"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-07：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-02：\t细节向公众公开  简要描述： 微信某功能的设计缺陷（不是 iOS 特殊字符攻击）可使好友的客户端崩溃退出、朋友圈彻底瘫痪锁死无法正常使用，并存在进一步利用的可能。Android、iOS 平台均受此漏洞影响，尤以 Android 为重。 详细说明：  利用小视频暂存功能上传畸形文件，好友的客户端在解析视频时发生错误崩溃退出。由于小视频自动播放选项默认打开，因此本攻击会产生非常大的危害。I. 上传任意视频文件1. 拍摄一段小视频并暂存。2. 准备要发送的文件，格式转换为 x264 + AAC，封装容器为 MP4，分辨率、长度及其它编码参数没有限制，但文件大小不得超过 1 MB。3. 导出视频的第 1 帧，作为封面图片。（此步可选）4. 在 存储卡/tencent/MicroMsg/<id>/draft/ 目录下找到刚刚暂存的小视频，用第 2 步制作的文件替换暂存视频本体，用第 3 步制作的文件替换 thumb。5. 在朋友圈发送暂存的小视频，可以看到其内容已被替换为第 2 步中的文件。II. 发送畸形小视频，使好友的朋友圈无法正常阅读1. 制作一张高度远远大于宽度的图片。（演示中为 2 x 30000 像素）2. 将图片作为静帧，按 I-2 中的要求生成视频。3. 使用 I 中的方法发送到朋友圈。4. 在好友打开他们自己的朋友圈之后，将无法阅读这条消息之下的内容。III. 发送畸形小视频，使好友的朋友圈崩溃锁死1. 制作一张宽度远远大于高度的图片。（演示中为 30000 x 2 像素）2. 将图片作为静帧，按 I-2 中的要求生成视频。3. 使用 I 中的方法发送到朋友圈。此时在 Android 客户端下会遇到发送界面闪退的问题，可以快速点击两次暂存小视频的预览图，待右上方出现发送按钮时再迅速连续点击，即可成功。4. 在好友打开他们自己的朋友圈之后，一旦本视频完成加载，立即崩溃退出，整个过程只有 1 到 5 秒，无法做任何操作。除非屏蔽好友并清除缓存，否则永远无法使用朋友圈。（iOS 平台部分版本不受影响）IV. 转发小视频，使好友的会话界面崩溃锁死1. 将 II 中上传的视频转发给好友。2. 当对方点击消息通知或从微信主界面进入会话后立即崩溃退出，双方无法发送任何信息，除非删除当前会话后重建。（iOS 平台部分版本不受影响）3. 若将小视频转发至群中，则所有人都会崩溃退出。如果向对方发送精心构造的畸形视频文件，存在进一步利用漏洞达到更高级别危害的可能。如需索取测试文件请联系 wechat_bug # 163 . com   漏洞证明：  已在不同设备/版本上进行测试，均可复现。演示中的设备为 Nexus 5，微信版本：6.2，系统版本：Android 5.1。演示I http://v.youku.com/v_show/id_XMTI1MzY0NjI4OA==.html演示II http://v.youku.com/v_show/id_XMTI1MzY0Njg1Ng==.html演示III http://v.youku.com/v_show/id_XMTI1MzY0NzEyNA==.html演示III-好友看到的效果 http://v.youku.com/v_show/id_XMTI1MzY0NzUyMA==.html演示IV http://v.youku.com/v_show/id_XMTI1MzY0Nzc3Mg==.html备用链接 http://pan.baidu.com/s/1kTj9FQB   修复方案：  1. 服务器端对上传的小视频进行检查，拒绝畸形文件。2. 优化小视频缩放逻辑。   版权声明：转载请注明来源 procen424@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-06-04 14:28 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-04 14:30 |    \t\tmilan \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:32        | 妈妈说：搬不完砖就别回家。)\t\t \n  谁的小号    \n     2015-06-04 14:41 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  居然15分    \n     2015-06-04 14:52 |    \t\tca1n \t\t\t( 普通白帽子  |\t\t\t        Rank:100 漏洞数:22        | not yet)\t\t \n  ...又来    \n     2015-06-04 15:03 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  额，看分数感觉直接发字符打挂的么。。。    \n     2015-06-04 16:41 |    \t\t我能拒绝么 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 疯爆志林)\t\t \n  屌屌的啊    \n     2015-06-04 16:53 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @xsser 很好奇一般拒绝服务是怎么测试的，这种目测有通用奖励额    \n     2015-06-04 17:47 |    \t\t鸟云厂商  \t\t\t( 核心白帽子 |\t\t\t        Rank:1313 漏洞数:146        | 中国菜鸟)\t\t \n  @px1624 ￥2000    \n     2015-06-04 17:57 |    \t\t这只猪 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 南无阿弥陀佛！)\t\t \n  碉堡了    \n     2015-06-04 19:13 |    \t\tJ0kER \t\t\t( 实习白帽子  |\t\t\t        Rank:56 漏洞数:13        | 上海--求职)\t\t \n  关注    \n     2015-06-04 21:34 |    \t\tQ1NG \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:16        | 临 兵 斗 者 皆 阵 列 前 行 !)\t\t \n  碉堡了!    \n     2015-06-04 22:55 |    \t\t斋家奇神 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | ？)\t\t \n  路过    \n     2015-06-04 22:58 |    \t\trange \t\t\t( 普通白帽子  |\t\t\t        Rank:153 漏洞数:32        | 这个人有点懒，没有写个人简介)\t\t \n  我说我微信咋挂了！原来是酱紫，CCAV往这拍！    \n     2015-06-04 23:53 |    \t\tJGHOOluwa \t\t\t( 普通白帽子  |\t\t\t        Rank:206 漏洞数:32        | 就是来看看大牛们如何超神的^-^)\t\t \n  我说我前天怎么微信挂了呢！    \n     2015-06-04 23:56 |    \t\tDrizzle.Risk \t\t\t( 普通白帽子  |\t\t\t        Rank:255 漏洞数:19        | You have an error in your SQL syntax; ch...)\t\t \n  第一感觉像畸形数据，但又是跨平台漏洞，难道是畸形数据导致服务端返回某种诡谲的错误？    \n     2015-06-05 09:01 |    \t\t波总z \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 本人学计算机网络这方面的，很高兴加入到你...)\t\t \n  膜拜    \n     2015-06-09 23:38 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  膜拜 为啥没闪电 @疯狗佩服楼主的手段    \n     2015-09-02 15:03 |    \t\t老实先生 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:4        | 早日告别路人状态)\t\t \n  跟随CCAV    \n     2015-09-02 16:21 |    \t\tHckmaple \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:14        | ~~~)\t\t \n  思路好牛逼    \n     2015-09-02 16:51 |    \t\t哎呦我去 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | 新手白帽子！！继续努力)\t\t \n  洞主思路真牛逼    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}