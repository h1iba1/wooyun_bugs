{"id": 20859, "wybug_id": "wooyun-2012-04683", "wybug_title": "中国联通客服平台任意文件上传", "wybug_corp": "中国联通", "wybug_author": "only_guest", "wybug_date": "2012-02-21 11:34", "wybug_open_date": "2012-04-06 11:35", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-02-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-02-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-03-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-03-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-03-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-04-06：\t细节向公众公开  简要描述： 中国联通客服平台任意文件上传导致可以获取webshell. 详细说明：  采用了用友的ICC客服系统.该系统存在严重安全隐患http://help.10010.com/5107/upload/uploadFlash.php代码如下\n<?php/** * uploadFlash.php * Flash文件上传. */require_once('../global.inc.php');//operateId=1 上传,operateId=2 获取地址.$operateId\t= intval($_REQUEST['operateId']);if(empty($operateId)) exit;if($operateId == 1){\t$date = date(\"Ymd\");\t$dest = $CONFIG->basePath.\"data/files/\".$date.\"/\";\t$COMMON->createDir($dest);\t//if (!is_dir($dest))\tmkdir($dest, 0777);\t\t$nameExt = strtolower($COMMON->getFileExtName($_FILES['Filedata']['name']));\t\t$allowedType = array('jpg', 'gif', 'bmp', 'png', 'jpeg');\t\tif(!in_array($nameExt, $allowedType)){\t\t$msg = 0;\t}\tif(empty($msg)){\t\t$filename = getmicrotime().'.'.$nameExt;\t\t$file_url = urlencode($CONFIG->baseUrl.'data/files/'.$date.\"/\".$filename);\t\t\t\t$filename = $dest.$filename;\t\tif(empty($_FILES['Filedata']['error'])){\t\t\tmove_uploaded_file($_FILES['Filedata']['tmp_name'],$filename);\t\t}\t\t\t\tif (file_exists($filename)){\t\t\t//$msg = 1;\t\t\t$msg = $file_url;\t\t\t@chmod($filename, 0444);\t\t}else{\t\t\t$msg = 0;\t\t}\t}\t$outMsg = \"fileUrl=\".$msg;\t$_SESSION[\"eoutmsg\"] = $outMsg;\texit;}else if($operateId == 2){\t$outMsg = $_SESSION[\"eoutmsg\"];\tif(!empty($outMsg)){\t\tsession_unregister(\"eoutmsg\");\t\techo '&'.$outMsg;\t\texit;\t}else{\t\techo \"&fileUrl=0\";\t\texit;\t}}function getmicrotime(){     list($usec, $sec) = explode(\" \",microtime());     return ((float)$usec + (float)$sec); }?>\n存在逻辑错误.可以导致任意文件上传.   漏洞证明：  http://help.10010.com/data/files/20111109/1320824790.09.php上面为一句话后门地址密码为only   修复方案：  找用友升级一下吧.   版权声明：转载请注明来源 only_guest@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：17  确认时间：2012-02-21 20:41 厂商回复： CNVD确认漏洞存在且确认测试后门存在。CNVD对本漏洞评分如下：基本得分CVSS：(AV:R/AC:L/Au:NR/C:C/A:C/I:C/B:C) score:10.00（高危）技术难度系数：1.1（有一定难度）影响危害系数：1.5（较严重）CNVD综合评分：10.00*1.1*1.5=16.5 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-03-23 10:11 |    \t\tx-star \t\t\t( 普通白帽子  |\t\t\t        Rank:124 漏洞数:13        | Windows/Linux Kernel.  Information Secur...)\t\t \n  不会PHP   有人能解释一下 uploadFlash.php 什么地方出问题了吗？    \n     2012-03-23 10:18 |    \t\tx-star \t\t\t( 普通白帽子  |\t\t\t        Rank:124 漏洞数:13        | Windows/Linux Kernel.  Information Secur...)\t\t \n  看懂了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 17, "Ranks": null}