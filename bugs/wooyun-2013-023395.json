{"id": 12911, "wybug_id": "wooyun-2013-023395", "wybug_title": "E创网络添加评论页面检查不严格，导致可以任意添加评论", "wybug_corp": "E创网络", "wybug_author": "路人甲", "wybug_date": "2013-05-10 16:15", "wybug_open_date": "2013-05-10 16:15", "wybug_type": "非授权访问/权限绕过", "wybug_level": "低", "wybug_rank_0": "3", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["未授权访问", "认证设计不合理"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-05-10：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-05-10：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： addview.asp没有对用户身份进行验证，导致可以随意对新闻进行评论 详细说明：  \n<%reviewID=checkstr(Request.Form(\"reviewID\"))NewsID=checkstr(Request.Form(\"NewsID\"))title=checkstr(Request.Form(\"title\"))Author=trim(checkstr((Request.Form(\"Author\"))))dim ViewUrlViewUrl=request.cookies(eChsys)(\"ViewUrl\")if ViewUrl=\"\" then\tViewUrl=\"index.asp\"end ifif author=\"\" then\tresponse.write \"<script>alert('请输入您的姓名！');history.back()</script>\"\tResponse.Endend ifauthor=htmlencode(author)email=trim(Request.Form(\"email\"))if email=\"\" then\tresponse.write \"<script>alert('请输入您的EMAIL。');history.back()</script>\"\tResponse.Endend ifif  IsValidEmail(email)=false  then\tresponse.write \"<script>alert('请输入正确的EMAIL。');history.back()</script>\"\tResponse.Endend ifif Instr(request(\"content\"),\"'\")>0 or Instr(request(\"content\"),\"script\")>0 or Instr(request(\"content\"),\"onClick\")>0  or Instr(request(\"content\"),\"onload\")>0 then\tShow_Err(\"对不起，您输入的留言内容包含有非法字符。<br><br><a href='javascript:history.back()'>返回</a>\")\tResponse.End end ifcontent=trim(htmlencode1((request.form(\"content\"))))content=replace(content,\"<p> \",\"\")content=replace(content,\"<P> \",\"\")Response.cookies(eChsys)(\"content\")=contentdim byte1byte1=split(byteType,\"|\")for i=0 to ubound(byte1)\tcontent=replace(content,trim(byte1(i)),\"***\")nextdim byte2byte2=split(byteipType,\"|\")for i=0 to ubound(byte2)if Request.serverVariables(\"REMOTE_ADDR\")=byte2(i) then\tShow_Err(\"对不起，你的IP地址已被锁定，请联系管理员！！！。<br><br><a href='javascript:history.back()'>返回</a>\")\tResponse.cookies(eChsys)(\"content\")=\"\"\tResponse.End end ifnextdim byte3byte3=split(bytezfType,\"|\")for i=0 to ubound(byte3)if Instr(request(\"content\"),byte3(i))>0  then\tShow_Err(\"对不起，请不要发布非法小广告！！！。<br><br><a href='javascript:history.back()'>返回</a>\")\tResponse.cookies(eChsys)(\"content\")=\"\"\tResponse.End end ifnextif content=\"\" then\tresponse.write \"<script>alert('请输入评论内容！');history.back()</script>\"\tResponse.Endend ifset rs=server.createobject(\"adodb.recordset\")sql=\"select * from \"& db_EC_News_Table &\" where NewsId=\" & NewsIdrs.open sql,conn,1,3if rs.eof and rs.bof then\trs.close\tset rs=nothing\tresponse.write \"<script>alert('无法对不存在的文章进行评论！\\n 确认是否为非法的提交。');history.back()</script>\"\tresponse.endelse\tchecked=rs(\"checkked\")\tif checked<>1 then\t\trs.close\t\tset rs=nothing\t\tresponse.write \"<script>alert('文章未通过审核，不能进行评论！');history.back()</script>\"\t\tresponse.end\telse\t\trs(\"titlesize\")=1\t\trs.update\t\trs.close\t\treviewip=Request.ServerVariables(\"REMOTE_ADDR\")\t\tpassed=checkstr(Request.Form(\"passed\")) //评论是否通过flag竟然交给用户来提交！\t\t\tset rs=server.createobject(\"adodb.recordset\")\t\tsql=\"select * from \"& db_EC_Review_Table &\"\" \t\trs.open sql,conn,1,3\t\trs.addnew\t\trs(\"author\")=author\t\trs(\"content\")=content\t\trs(\"title\")=title\t\trs(\"NewsID\")=NewsID\t\trs(\"passed\")=passed\t\trs(\"reviewip\")=reviewip\t\trs(\"email\")=email\t\trs(\"updatetime\")=now()\t\trs.update\t\trs.close\t\treviewid=reviewID+1\t\tset rs=nothing\t\tResponse.cookies(eChsys)(\"content\")=\"\"\tend ifend ifResponse.Redirect ViewUrl%>\n提交内容包含newsid、passed、title、content、author、email就可以绕过评论审核机制直接对newsid对应的新闻进行评论了   漏洞证明：  \n\n   修复方案：  addview.asp页面加入用户认证、验证码passed flag只能由管理员控制   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}