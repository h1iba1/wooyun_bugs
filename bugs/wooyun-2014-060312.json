{"id": 55653, "wybug_id": "wooyun-2014-060312", "wybug_title": "StartBBS v1.1.5存储型xss", "wybug_corp": "startbbs.com", "wybug_author": "phith0n", "wybug_date": "2014-05-12 22:53", "wybug_open_date": "2014-08-07 22:54", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-17：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-07：\t细节向公众公开  简要描述： 存储型xss。 详细说明：  用户资料修改处，可以填写用户网站。一般填写url的地方容易出现xss，很多人忽略。观察代码，app/controllers/settings.php 36行\n$data = array(    'uid' => $uid,    'email' => strip_tags($this->input->post('email')),    'homepage' => prep_url(strip_tags($this->input->post('homepage'))),    'location' => strip_tags($this->input->post('location')),    'qq' => strip_tags($this->input->post('qq')),    'signature' => strip_tags($this->input->post('signature')),    'introduction' => strip_tags($this->input->post('introduction')));\n先调用strip_tags去除html标签，再调用prep_url处理。prep_url函数如下：\nfunction prep_url($str = ''){    if ($str == 'http://' OR $str == '')    {        return '';    }    $url = parse_url($str);    if ( ! $url OR ! isset($url['scheme']))    {        $str = 'http://'.$str;    }    return $str;}\n我们如果使用伪协议的xss，如<a href=\"javascript:alert(1)\">aaa</a>，我们填入的url就是javascript:alert(1)，不会被strip_tags过滤。但这个函数看起来似乎在前面加了http://，实际上$url['scheme']是javascript，!isset()并不成立，所以没有进入下面那个if语句。有了这些理论基础，所以我们就可以开始插了。   漏洞证明：  url在数据库中长度只有50，比较短。但因为StartBBS用了Jquery，所以可以调用Jquery的getScript方法来加载远程js：\n\n其他用户（甚至管理员）访问你的资料，并点击你的网址以后触发：\n\nps. 真的有这么傻的人会点这么奇怪的链接吗？那我就不知道了。。。xss平台已经收到cookie：\n\n   修复方案：  正则判断：^(http|https):.*   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-08-07 22:54 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}