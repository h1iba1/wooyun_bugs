{"id": 381, "wybug_id": "wooyun-2015-0126058", "wybug_title": "新浪核心站点高危XSS+涉及缺陷隐患可造成大规模蠕虫攻击+劫持微博账号", "wybug_corp": "新浪", "wybug_author": "黑暗游侠", "wybug_date": "2015-07-12 10:05", "wybug_open_date": "2015-08-28 17:32", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-28：\t细节向公众公开  简要描述： 新浪核心站点高危XSS+涉及缺陷隐患可造成大规模蠕虫攻击+劫持微博账号 详细说明：  从发现到利用大概研究了快50分钟了，写完睡觉去，快1点了新浪show\nhttp://show.sina.com.cn/\n核心站点，业务范围不多介绍了漏洞简单描述一下：个人空间处\nhttp://space.show.sina.com.cn/\n发表日志处添加音乐，插入xss即可\n\n方便测试，给出简洁的demo地址，直接访问即可触发demo alert（wooyun）：\nhttp://space.show.sina.com.cn/bloglist.php?space_uid=218835112\n\n\n======================================漏洞讲完了，重点讲利用过程新浪所有核心重要站点cookie都做了httponly，cookie其实并么有什么卵用看一下cookie就一目了然了\n\nshow有两种登录方式，\n\n经过反复测试：若用户A登陆的是show账号，没有登录微博，那么只能造成第一种蠕虫：\n第一处：新浪show空间发表恶意代码日志进行蠕虫传播\n抓包构造内容发送即可。若用户A登陆show用的是微博登陆方式，而不是shwo账号，只能造成第二种蠕虫（因为show空间日志系统不对非show账号的用户开放，无法开通）：\n第二处：新浪微博，对weibo本身不存在，但是可以使用户在微博发show链接地址，不断地诱导访问蠕虫传播\n参考：\nhttp://wooyun.org/bugs/wooyun-2010-098586\nA Simple Result：\n\n若用户A登陆show用的是show账号，另外别的标签页登陆了微博，那么两种蠕虫传播方式均可#劫持用户微博账号新浪sso认证体系中存在这样一个隐患微博用户访问以下URL可以获得ticket：\nhttp://login.sina.com.cn/sso/crossdomain.php?action=login\n\n\n关键的是：\n这个ticket是一次性会话，而且没有时间限制，就是说，在别的地方能使用ticket登录帐号\n所以get了ticket访问以下URL：\nhttp://passport.weibo.com/wbsso/login?ticket=**********\n即可在另一地方登陆该用户微博账户。本地测试用的是微博账号登陆show，访问构造好的脚本xss，服务端下的结果：\n\n打开Firefox来访问：\n\n访问weibo.com最终结果，成功劫持:\n\n（End）睡觉去   漏洞证明：     修复方案：     版权声明：转载请注明来源 黑暗游侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-07-14 17:32 厂商回复： 感谢支持，漏洞修复中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-12 10:35 |    \t\tmyhalo \t\t\t( 普通白帽子  |\t\t\t        Rank:281 漏洞数:55        | 所属团队:TSafe)\t\t \n  我擦，路人甲又发功了，这个不是闪电么。。。    \n     2015-07-12 10:46 |    \t\t笔墨 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:20        | 瘦子)\t\t \n  666    \n     2015-07-12 15:15 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @myhalo @疯狗 狗哥,围观的绿帽子都觉的应该可以有闪电    \n     2015-07-12 15:23 |    \t\tmyhalo \t\t\t( 普通白帽子  |\t\t\t        Rank:281 漏洞数:55        | 所属团队:TSafe)\t\t \n  @黑暗游侠 我擦，你妹啊，我是白妹子，你才绿帽子，擦擦擦擦    \n     2015-07-12 15:32 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @myhalo 原来是绿妹子哈，我还以为绿帽子呢    \n     2015-07-12 16:01 |    \t\tmyhalo \t\t\t( 普通白帽子  |\t\t\t        Rank:281 漏洞数:55        | 所属团队:TSafe)\t\t \n  @黑暗游侠 这个闪电没了    \n     2015-07-12 20:10 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  是啊没事    \n     2015-07-13 10:37 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  show......第三方合作站的xss,核心个毛线啊，上了首页就不错了，不过思路还是不错    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}