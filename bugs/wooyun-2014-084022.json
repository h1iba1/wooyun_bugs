{"id": 43042, "wybug_id": "wooyun-2014-084022", "wybug_title": "金和OA SQL注入之1", "wybug_corp": "金和软件", "wybug_author": "疯狂的dabing", "wybug_date": "2014-12-01 18:53", "wybug_open_date": "2015-03-01 18:54", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-01：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-03-01：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 我司最近在内网部署了一套OA，正式上线前领导让先测下安全性，被人爆菊了就囧了。。黑盒一番，来个无需登录的XSS。所测版本为C6V3,官网demo也存在该问题，貌似V2不存在。 详细说明：  应要求补充5个实例OA这种东西大概升级的比较少，因此对于新漏洞批量验证可能比较麻烦，所以请审核和CERT的验证工作人员耐心测试。关键字：百度：inurl:Jhsoft.Web.loginbing：PassWordSlide.aspx搜出来的都是金和OA，但是该漏洞只影响V3新版，V2及以下版本不存在该问题，因此需要手动判断是否存在。如果遇到302跳转，请选择不跟随。给出V3新版特征：登录页面为hPassWordSlide.aspx的为V3新版，存在该漏洞，登录页面为PassWordNew.aspx或者PassWord.aspx的为低版本，不存在该问题。http://www.ccteboa.com/c6/Jhsoft.Web.login/AjaxForLogin.aspxhttp://218.17.227.196/C6/Jhsoft.Web.login/AjaxForLogin.aspxhttp://oa.originseed.com.cn/C6/Jhsoft.Web.login/AjaxForLogin.aspx//不跟随302跳转http://www.xiyuefa.com:802/C6/Jhsoft.Web.login/AjaxForLogin.aspxhttp://oa.inofa.com/C6/Jhsoft.Web.login/AjaxForLogin.aspxhttp://oa.kanq.com.cn:808/C6/Jhsoft.Web.login/AjaxForLogin.aspxhttp://oa.guoxiang.com.cn/C6/Jhsoft.Web.login/AjaxForLogin.aspx注入点就是登录框。这个地方在前端过滤了单引号等特殊符号，并对数据进行base64编码后传输。但服务器并未校验数据合法性，导致可以编码后直接发送数据到服务器造成SQL注入。有注入的参数为loginCode。这里比较尴尬，不能报错，因为所有的错误都会提示用户名和密码错误。因此如果没有正确的帐号和密码，这里只能延时盲注，如果有账户密码，就可以布尔型盲注。注意这里使用了base64编码，所以要用sqlmap自带的一个插件来辅助注入。./sqlmap.py -u http://demos.jh0101.com/c6v32/Jhsoft.Web.login/AjaxForLogin.aspx --data=\"type=login&loginCode=admin=&pwd=123\" -p loginCode --tamper base64encode.py\n\n可以看到current user为sa，当前数据库为C6v3.2demo。由于sqlmap的延时注入太蛋疼，我就想写个脚本自己跑跑，这时候奇迹发生了！=================================================写了一个中转脚本，如下：\n\n当提交一个存在的用户名时如admin，就会爆出错误页面。\n\n当提交一个不存在的用户名时，就会提示用户名和密码错误！\n\n于是通过中转脚本，就sqlmap就可以识别为布尔型注入了！\n\n不过由于os和脚本都是我本地环境，所以识别为本机的linux和php，但不影响数据的获取。   漏洞证明：  ./sqlmap.py -u http://demos.jh0101.com/c6v32/Jhsoft.Web.login/AjaxForLogin.aspx --data=\"type=login&loginCode=admin=&pwd=123\" -p loginCode --tamper base64encode.py\n\n   修复方案：  不要依赖base64编码，也不要依赖waf，不要拼接sql语句！使用pdo预编译或者sql template。   版权声明：转载请注明来源 疯狂的dabing@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：暂时无回应 漏洞Rank：0  确认时间：2014-12-01 18:53 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-23 11:02 |    \t\t疯狂的dabing \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:9        | Hehe is golden.)\t\t \n  @xsser 这是要等待认领一辈子的节奏啊？    \n     2015-04-28 09:58 |    \t\t北京金和软件股份有限公司(乌云厂商)\t\t \n  你好，问题已经修复。    \n     2015-05-01 18:42 |    \t\t疯狂的dabing \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:9        | Hehe is golden.)\t\t \n  @北京金和软件股份有限公司 姗姗来迟，0 rank。。。哎    \n  \n\n\n", "wybug_level_fromcorp": "暂时无回应", "wybug_rank_fromcorp": 0, "Ranks": null}