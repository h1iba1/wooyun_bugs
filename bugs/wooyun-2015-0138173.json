{"id": 71498, "wybug_id": "wooyun-2015-0138173", "wybug_title": "携程客户端升级存在安全隐患可被替换为木马", "wybug_corp": "携程旅行网", "wybug_author": "Moonight", "wybug_date": "2015-08-31 17:47", "wybug_open_date": "2015-11-29 18:32", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当", "客户端程序设计错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-29：\t细节向公众公开  简要描述： 携程客户端升级过程中存在重大安全问题，升级包有可能被攻击者所替换为木马等恶意应用 详细说明：  1.携程客户端升级新版本的时候会进行MD5的校验，计算下载到本地的客户端的MD5数值以及服务端的返回的预期MD5数值是否匹配\n\n2.但是携程客户端所有的请求均是HTTP明文的，下面是请求md5值和新版本客户端下载链接的请求(1). 请求md5值和下载链接的url，经过验证该MD5确实是对应下载链接的APK的MD5\n\n(2). 下载APK应用的请求\n\n3.HTTP请求无任何签名和加密机制，非常容易进行篡改，利用中间人攻击可以同时对MD5和下载链接进行篡改，这样便可以绕过校验逻辑，这样便可以控制携程客户端可以安装任意的应用，包括木马病毒等恶意应用   漏洞证明：  具体的漏洞风险的原因都在截图中，如果需要的话我会做一个MITM的视频演示下，大家都是做安全的应该都明白这样风险有多大，否则客户端也没有必要进行md5的验证   修复方案：  1.使用HTTPS传输MD5和下载链接2.使用加密的方式传输MD5和下载链接   版权声明：转载请注明来源 Moonight@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2015-08-31 18:31 厂商回复： 感谢提交 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-31 18:44 |    \t\tMe_Fortune \t\t\t( 普通白帽子  |\t\t\t        Rank:246 漏洞数:85        | The quiter you are,the more you're able ...)\t\t \n  中间人攻击截取返回包里面的那个url?    \n     2015-08-31 21:24 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @Me_Fortune 嗯嗯，截取后把下载链接改成你自己的apk，同时把md5改成这个apk对应的md5    \n     2015-09-01 09:02 |    \t\t大师兄 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:6        | 每日必关注乌云)\t\t \n  mark    \n     2015-09-01 09:34 |    \t\tgeegirl \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:28        )\t\t \n  以前qq有过类似的问题，不过那个给了20rank，没记错的话好像还闪了（也可能记错了）    \n     2015-09-01 09:37 |    \t\t大师兄 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:6        | 每日必关注乌云)\t\t \n  @geegirl 我倒是记得几年前，有查看任意QQ的好友，修改备注，删除好友 的漏洞。出在数据交互上。    \n     2015-09-01 10:39 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @geegirl 携程rank给的非常低，不知道是不是对于安全理解程度不够，之前报的空intent导致客户端crash都被驳回了    \n     2015-09-01 11:40 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  携程的问题可以直接找我    \n     2015-09-01 17:58 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @小胖胖要减肥 你准备跳槽了？    \n     2015-09-02 10:07 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @小胖胖要减肥 http://www.wooyun.org/bugs/wooyun-2015-0135823/trace/0c59a881df2e7c877267d933e2be7e13  你好，这个你可以看下，导致客户端crash的应该算是拒绝服务攻击吧？也是客户端不安全实现造成的吧？为什么驳回呢？    \n     2015-09-02 15:58 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @Moonight 漏洞状态： 漏洞没有通过审核  具体原因： 问题真实存在但是影响不大  这个你得问finger ，疯狗，xsser啊 ，我们都看不到漏洞    \n     2015-09-02 16:08 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @小胖胖要减肥 好吧＝ ＝    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}