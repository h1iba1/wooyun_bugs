{"id": 17448, "wybug_id": "wooyun-2012-010687", "wybug_title": "乐视网某应用管理弱口令以及sql注入造成的结构扫射！", "wybug_corp": "乐视网", "wybug_author": "shine", "wybug_date": "2012-08-08 11:13", "wybug_open_date": "2012-09-22 11:14", "wybug_type": "后台弱口令", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-08-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-08-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-08-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-08-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-09-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-09-22：\t细节向公众公开  简要描述：   常说的一句话：“历史是惊人的相似！”  详细说明：   \n为什么这么说了？  看看这个case:  WooYun: 去哪儿test帐号弱口令了！ \n\n和上面这公司在技术选择上基本是一致的（当然，对于一般奋进型的公司都会这么选择！）。\n   漏洞证明：  \nhttp://pv.letv.com/index.htmlLETV数据分析平台帐号弱口令：test test\n\n从一个公司的test帐号弱口令说明什么了？至少是安全架构流程不完善，而不是意外！\n\n\n注射点比较多，当然是同一个地方，“过滤条件：”处\n\n\n'注射点\n\n\n\nsql注射内容就不去看了，我们从Java异常机制的角度看看分层结构的弱点（因为java抛异常，也是分层的！）：\n注射的异常信息：\nHttp status: 500 Internal Server ErrorajaxOptions: errorthrownError: undefined500 Servlet Exception[show] org.postgresql.util.PSQLException: ERROR: syntax error at or near \"注射点\"  位置：519org.springframework.web.util.NestedServletException: Request processingfailed; nested exception is org.springframework.dao.InvalidDataAccessResourceUsageException:could not execute query; SQL [select count(*) from ( select url, sum(pv)pv , sum(uv) uv, sum(uip) uip,'<a href=''#'' onclick=show(''common.html?name=urlIn&key='||replace(replace(url,'%','%25'),'&','%26') ||'&needProd=true&from=20120808&other=-'')>查看流入</a>'url_in , '<a href=''#'' onclick=show(''common.html?name=urlOut&needProd=true&key='||replace(replace(url,'%','%25'),'&','%26') ||'&from=20120808&other=-'')>查看流出</a>'url_out  from t_stat_url_top where prod_code = 'ifeng'   and tuiguang ='-'  and day_time = '20120808' and url like '%'注射点%' group by url orderby pv desc) asdf]; nested exception is org.hibernate.exception.SQLGrammarException:could not execute query\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:656)\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:549)\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:119)\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:96)\tat com.caucho.server.dispatch.ServletFilterChain.doFilter(ServletFilterChain.java:109)\tat com.caucho.server.webapp.WebAppFilterChain.doFilter(WebAppFilterChain.java:156)\tat com.caucho.server.webapp.AccessLogFilterChain.doFilter(AccessLogFilterChain.java:95)\tat com.caucho.server.dispatch.ServletInvocation.service(ServletInvocation.java:287)\tat com.caucho.server.http.HttpRequest.handleRequest(HttpRequest.java:811)\tat com.caucho.network.listen.TcpSocketLink.dispatchRequest(TcpSocketLink.java:1186)\tat com.caucho.network.listen.TcpSocketLink.handleRequest(TcpSocketLink.java:1148)\tat com.caucho.network.listen.TcpSocketLink.handleRequestsImpl(TcpSocketLink.java:1132)\tat com.caucho.network.listen.TcpSocketLink.handleRequests(TcpSocketLink.java:1055)\tat com.caucho.network.listen.TcpSocketLink.handleAcceptTask(TcpSocketLink.java:903)\tat com.caucho.network.listen.AcceptTask.doTask(AcceptTask.java:74)\tat com.caucho.network.listen.ConnectionTask.runThread(ConnectionTask.java:97)\tat com.caucho.network.listen.ConnectionTask.run(ConnectionTask.java:80)\tat com.caucho.network.listen.AcceptTask.run(AcceptTask.java:59)\tat com.caucho.env.thread.ResinThread.runTasks(ResinThread.java:164)\tat com.caucho.env.thread.ResinThread.run(ResinThread.java:130)Caused by: org.springframework.dao.InvalidDataAccessResourceUsageException:could not execute query; SQL [select count(*) from ( select url, sum(pv)pv , sum(uv) uv, sum(uip) uip,'<a href=''#'' onclick=show(''common.html?name=urlIn&key='||replace(replace(url,'%','%25'),'&','%26') ||'&needProd=true&from=20120808&other=-'')>查看流入</a>'url_in , '<a href=''#'' onclick=show(''common.html?name=urlOut&needProd=true&key='||replace(replace(url,'%','%25'),'&','%26') ||'&from=20120808&other=-'')>查看流出</a>'url_out  from t_stat_url_top where prod_code = 'ifeng'   and tuiguang ='-'  and day_time = '20120808' and url like '%'注射点%' group by url orderby pv desc) asdf]; nested exception is org.hibernate.exception.SQLGrammarException:could not execute query\tat org.springframework.orm.hibernate3.SessionFactoryUtils.convertHibernateAccessException(SessionFactoryUtils.java:629)\tat org.springframework.orm.hibernate3.HibernateAccessor.convertHibernateAccessException(HibernateAccessor.java:412)\tat org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:411)\tat org.springframework.orm.hibernate3.HibernateTemplate.execute(HibernateTemplate.java:339)\tat com.tj.dao.BaseDaoHib.getCountByNativeSQL(BaseDaoHib.java:244)\tat com.tj.dao.BaseDaoHib.getPageInfo(BaseDaoHib.java:547)\tat com.tj.service.PVService.getProObject(PVService.java:904)\tat com.tj.service.PVService.access$0(PVService.java:712)\tat com.tj.service.PVService$1.getObject(PVService.java:1088)\tat com.tj.util.CacheUtilMem.autoCach(CacheUtilMem.java:154)\tat com.tj.util.CacheUtilMem.autoCach(CacheUtilMem.java:143)\tat com.tj.service.PVService.getCommonActionData(PVService.java:1082)\tat com.tj.action.Common.getMetaAction(Common.java:346)\tat sun.reflect.GeneratedMethodAccessor273.invoke(Unknown Source)\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\tat java.lang.reflect.Method.invoke(Method.java:597)\tat org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:176)\tat org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:426)\tat org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:414)\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:790)\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:719)\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:644)\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:549)\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:119)\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:96)\tat com.caucho.server.dispatch.ServletFilterChain.doFilter(ServletFilterChain.java:109)\tat com.caucho.server.webapp.WebAppFilterChain.doFilter(WebAppFilterChain.java:156)\tat com.caucho.server.webapp.AccessLogFilterChain.doFilter(AccessLogFilterChain.java:95)\tat com.caucho.server.dispatch.ServletInvocation.service(ServletInvocation.java:287)\tat com.caucho.server.http.HttpRequest.handleRequest(HttpRequest.java:811)\tat com.caucho.network.listen.TcpSocketLink.dispatchRequest(TcpSocketLink.java:1186)\tat com.caucho.network.listen.TcpSocketLink.handleRequest(TcpSocketLink.java:1148)\tat com.caucho.network.listen.TcpSocketLink.handleRequestsImpl(TcpSocketLink.java:1132)\tat com.caucho.network.listen.TcpSocketLink.handleRequests(TcpSocketLink.java:1055)\tat com.caucho.network.listen.TcpSocketLink.handleAcceptTask(TcpSocketLink.java:903)\tat com.caucho.network.listen.AcceptTask.doTask(AcceptTask.java:74)\tat com.caucho.network.listen.ConnectionTask.runThread(ConnectionTask.java:97)\tat com.caucho.network.listen.ConnectionTask.run(ConnectionTask.java:80)\tat com.caucho.network.listen.AcceptTask.run(AcceptTask.java:59)\tat com.caucho.env.thread.ResinThread.runTasks(ResinThread.java:164)\tat com.caucho.env.thread.ResinThread.run(ResinThread.java:130)Caused by: org.hibernate.exception.SQLGrammarException: could not executequery\tat org.hibernate.exception.SQLStateConverter.convert(SQLStateConverter.java:90)\tat org.hibernate.exception.JDBCExceptionHelper.convert(JDBCExceptionHelper.java:66)\tat org.hibernate.loader.Loader.doList(Loader.java:2235)\tat org.hibernate.loader.Loader.listIgnoreQueryCache(Loader.java:2129)\tat org.hibernate.loader.Loader.list(Loader.java:2124)\tat org.hibernate.loader.custom.CustomLoader.list(CustomLoader.java:312)\tat org.hibernate.impl.SessionImpl.listCustomQuery(SessionImpl.java:1723)\tat org.hibernate.impl.AbstractSessionImpl.list(AbstractSessionImpl.java:165)\tat org.hibernate.impl.SQLQueryImpl.list(SQLQueryImpl.java:175)\tat org.hibernate.impl.AbstractQueryImpl.uniqueResult(AbstractQueryImpl.java:835)\tat com.tj.dao.BaseDaoHib$7.doInHibernate(BaseDaoHib.java:250)\tat org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:406)\tat org.springframework.orm.hibernate3.HibernateTemplate.execute(HibernateTemplate.java:339)\tat com.tj.dao.BaseDaoHib.getCountByNativeSQL(BaseDaoHib.java:244)\tat com.tj.dao.BaseDaoHib.getPageInfo(BaseDaoHib.java:547)\tat com.tj.service.PVService.getProObject(PVService.java:904)\tat com.tj.service.PVService.access$0(PVService.java:712)\tat com.tj.service.PVService$1.getObject(PVService.java:1088)\tat com.tj.util.CacheUtilMem.autoCach(CacheUtilMem.java:154)\tat com.tj.util.CacheUtilMem.autoCach(CacheUtilMem.java:143)\tat com.tj.service.PVService.getCommonActionData(PVService.java:1082)\tat com.tj.action.Common.getMetaAction(Common.java:346)\tat sun.reflect.GeneratedMethodAccessor273.invoke(Unknown Source)\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\tat java.lang.reflect.Method.invoke(Method.java:597)\tat org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:176)\tat org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:426)\tat org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:414)\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:790)\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:719)\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:644)\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:549)\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:119)\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:96)\tat com.caucho.server.dispatch.ServletFilterChain.doFilter(ServletFilterChain.java:109)\tat com.caucho.server.webapp.WebAppFilterChain.doFilter(WebAppFilterChain.java:156)\tat com.caucho.server.webapp.AccessLogFilterChain.doFilter(AccessLogFilterChain.java:95)\tat com.caucho.server.dispatch.ServletInvocation.service(ServletInvocation.java:287)\tat com.caucho.server.http.HttpRequest.handleRequest(HttpRequest.java:811)\tat com.caucho.network.listen.TcpSocketLink.dispatchRequest(TcpSocketLink.java:1186)\tat com.caucho.network.listen.TcpSocketLink.handleRequest(TcpSocketLink.java:1148)\tat com.caucho.network.listen.TcpSocketLink.handleRequestsImpl(TcpSocketLink.java:1132)\tat com.caucho.network.listen.TcpSocketLink.handleRequests(TcpSocketLink.java:1055)\tat com.caucho.network.listen.TcpSocketLink.handleAcceptTask(TcpSocketLink.java:903)\tat com.caucho.network.listen.AcceptTask.doTask(AcceptTask.java:74)\tat com.caucho.network.listen.ConnectionTask.runThread(ConnectionTask.java:97)\tat com.caucho.network.listen.ConnectionTask.run(ConnectionTask.java:80)\tat com.caucho.network.listen.AcceptTask.run(AcceptTask.java:59)\tat com.caucho.env.thread.ResinThread.runTasks(ResinThread.java:164)\tat com.caucho.env.thread.ResinThread.run(ResinThread.java:130)Caused by: org.postgresql.util.PSQLException: ERROR: syntax error at ornear \"注射点\"  位置：519\tat org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2062)\tat org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1795)\tat org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:257)\tat org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:479)\tat org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:367)\tat org.postgresql.jdbc2.AbstractJdbc2Statement.executeQuery(AbstractJdbc2Statement.java:271)\tat org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:92)\tat org.hibernate.jdbc.AbstractBatcher.getResultSet(AbstractBatcher.java:208)\tat org.hibernate.loader.Loader.getResultSet(Loader.java:1812)\tat org.hibernate.loader.Loader.doQuery(Loader.java:697)\tat org.hibernate.loader.Loader.doQueryAndInitializeNonLazyCollections(Loader.java:259)\tat org.hibernate.loader.Loader.doList(Loader.java:2232)\tat org.hibernate.loader.Loader.listIgnoreQueryCache(Loader.java:2129)\tat org.hibernate.loader.Loader.list(Loader.java:2124)\tat org.hibernate.loader.custom.CustomLoader.list(CustomLoader.java:312)\tat org.hibernate.impl.SessionImpl.listCustomQuery(SessionImpl.java:1723)\tat org.hibernate.impl.AbstractSessionImpl.list(AbstractSessionImpl.java:165)\tat org.hibernate.impl.SQLQueryImpl.list(SQLQueryImpl.java:175)\tat org.hibernate.impl.AbstractQueryImpl.uniqueResult(AbstractQueryImpl.java:835)\tat com.tj.dao.BaseDaoHib$7.doInHibernate(BaseDaoHib.java:250)\tat org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:406)\tat org.springframework.orm.hibernate3.HibernateTemplate.execute(HibernateTemplate.java:339)\tat com.tj.dao.BaseDaoHib.getCountByNativeSQL(BaseDaoHib.java:244)\tat com.tj.dao.BaseDaoHib.getPageInfo(BaseDaoHib.java:547)\tat com.tj.service.PVService.getProObject(PVService.java:904)\tat com.tj.service.PVService.access$0(PVService.java:712)\tat com.tj.service.PVService$1.getObject(PVService.java:1088)\tat com.tj.util.CacheUtilMem.autoCach(CacheUtilMem.java:154)\tat com.tj.util.CacheUtilMem.autoCach(CacheUtilMem.java:143)\tat com.tj.service.PVService.getCommonActionData(PVService.java:1082)\tat com.tj.action.Common.getMetaAction(Common.java:346)\tat sun.reflect.GeneratedMethodAccessor273.invoke(Unknown Source)\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\tat java.lang.reflect.Method.invoke(Method.java:597)\tat org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:176)\tat org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:426)\tat org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:414)\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:790)\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:719)\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:644)\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:549)\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:119)\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:96)\tat com.caucho.server.dispatch.ServletFilterChain.doFilter(ServletFilterChain.java:109)\tat com.caucho.server.webapp.WebAppFilterChain.doFilter(WebAppFilterChain.java:156)\tat com.caucho.server.webapp.AccessLogFilterChain.doFilter(AccessLogFilterChain.java:95)\tat com.caucho.server.dispatch.ServletInvocation.service(ServletInvocation.java:287)\tat com.caucho.server.http.HttpRequest.handleRequest(HttpRequest.java:811)\tat com.caucho.network.listen.TcpSocketLink.dispatchRequest(TcpSocketLink.java:1186)\tat com.caucho.network.listen.TcpSocketLink.handleRequest(TcpSocketLink.java:1148)\tat com.caucho.network.listen.TcpSocketLink.handleRequestsImpl(TcpSocketLink.java:1132)\tat com.caucho.network.listen.TcpSocketLink.handleRequests(TcpSocketLink.java:1055)\tat com.caucho.network.listen.TcpSocketLink.handleAcceptTask(TcpSocketLink.java:903)\tat com.caucho.network.listen.AcceptTask.doTask(AcceptTask.java:74)\tat com.caucho.network.listen.ConnectionTask.runThread(ConnectionTask.java:97)\tat com.caucho.network.listen.ConnectionTask.run(ConnectionTask.java:80)\tat com.caucho.network.listen.AcceptTask.run(AcceptTask.java:59)\tat com.caucho.env.thread.ResinThread.runTasks(ResinThread.java:164)\tat com.caucho.env.thread.ResinThread.run(ResinThread.java:130)--------------------------------------------------------------------------------Resin/4.0.20 Server: 'default'\n\n先看这一行：[show] org.postgresql.util.PSQLException: ERROR: syntax error at or near \"注射点\"  位置：519\n\norg.postgresql.util.PSQLException 抛的这一异常，那么使用的是postgresql的jdbc驱动包\n\n然后仔细看看中间的Servlet异常，好象没有使用常用的Struts或WebWork框架，而直接使用的Spring的MVC,难道被Struts2的远程代码执行漏洞弄怕了？哈哈！以及hibernate3\n\nResin/4.0.20 Server: 'default' 和Resin容器！\n\n没别的意思，无聊吐槽两句！哈哈！\n   修复方案：   对外的内部系统也要注意安全！（奥运会都快完了，电视机还没到！）   版权声明：转载请注明来源 shine@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2012-08-08 11:31 厂商回复： 唉，最近问题多多，实在不好意思，已经通知业务部门进行处理。同时我们将对所有系统进行排查，来避免此类问题。再次感谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-08-08 15:04 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @乐视网 @shine 两位，有礼物不？我会给你惊喜的！    \n     2012-08-08 15:56 |    \t\tshine  \t\t\t( 普通白帽子  |\t\t\t        Rank:831 漏洞数:77        | coder)\t\t \n  @风萧萧 不知道有没有？不过他们内部好象现在比较忙；公司还是比较有朝气的，应用多而没有有条不紊，所以问题就多了！哈哈！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}