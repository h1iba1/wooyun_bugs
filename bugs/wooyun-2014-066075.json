{"id": 1215, "wybug_id": "wooyun-2014-066075", "wybug_title": "金龙一卡通查询子系统漏洞，可制作手持设备联网快速复制他人卡片（非爆破）", "wybug_corp": "哈尔滨新中新华科电子设备有限公司", "wybug_author": "路人甲", "wybug_date": "2014-06-24 17:12", "wybug_open_date": "2014-09-22 17:14", "wybug_type": "非授权访问", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["未授权访问", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-22：\t细节向公众公开  简要描述：  详细说明：  金龙一卡通查询子系统需要配置终端机IP，只有被配置为终端IP的机器才能够使用该查询子系统，如果不是可信终端列表则显示为未授权状态，如下图所示：\n\n但是该查询子系统的服务端存在未授权访问，不在可信IP列表内的IP也可以通过接口查询M1卡的扇区密码，如下图所示：\n\n（由于涉及到的用户量较大，为不被恶意利用，故地址暂做隐藏）有了扇区密码，就可以dump M1卡的内容了，不用暴力破解，所以可制作手持设备并连接网络批量复制他人卡片，只需要1秒钟。CPU卡也是可以的，CPU卡会当做M卡处理；另外还有cardtype参数可以控制选择是M1还是M4，因此涉及到的不仅是M卡，还有CPU卡作为M卡处理的问题。复制他人卡片之后进行消费，使得卡片金额与系统金额不平，也会计算为该用户的实际消费，进行平账。根据调研卡片在高校的业务情况，使用该套系统若发生对账不平，会进行平账处理，也就是会纠正卡片的金额错误，造成用户卡片金额被盗刷（对于卡复制问题，还可结合另一个漏洞在不物理接触他人卡片的情况下制作卡片，但该漏洞目前的攻击难度较大，需要进一步研究，公开日期不定）。【代码】\n\n实际上对于M卡写一个手机APP就可以了~~  类似于Mifare Classic Tool_1.7.3.apk   漏洞证明：  走访高校，已经找到一个对应于该系统的物理卡片，并可成功使用获取到的扇区密码进行认证。\n\n   修复方案：  查询扇区密码的接口也要根据IP来做限制~~   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2014-06-28 22:42 厂商回复： CNVD未直接复现，不过对于此类M卡的风险已经早已获知，已经由CNVD直接向哈尔滨新中新集团股份有限公司通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-24 17:23 |    \t\t紫衣大侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:21        | 愿结天下有识之士)\t\t \n  强势插入....    \n     2014-06-24 17:55 |    \t\t李明搞 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 某小白)\t\t \n  这让我想起了当年因破解北京市政一卡通恶意消费贰入狱的两位360工程师    \n     2014-06-24 20:18 |    \t\tm_vptr \t\t\t( 普通白帽子  |\t\t\t        Rank:133 漏洞数:30        | 新手)\t\t \n  我们的饭卡。。。    \n     2014-06-28 22:46 |    \t\tCplusHua \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:33        | 乌云奖金:-1)\t\t \n  查询到和爆破好像不是一个问题~属于应用系统问题而非卡问题~是吧    \n     2014-06-28 22:46 |    \t\tCplusHua \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:33        | 乌云奖金:-1)\t\t \n  @cncert国家互联网应急中心     \n     2014-07-29 11:46 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  哈哈很给力啊    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}