{"id": 48626, "wybug_id": "wooyun-2014-077062", "wybug_title": "江南科友堡垒机信息泄露+任意文件下载漏洞(疑为后门）", "wybug_corp": "江南科友科技股份有限公司", "wybug_author": "路人甲", "wybug_date": "2014-09-23 15:14", "wybug_open_date": "2014-12-22 15:14", "wybug_type": "默认配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-22：\t细节向公众公开  简要描述： 作为安全厂商，请穿好裤子再出来保护客户安全.... 详细说明：  1、信息泄露（物理路径爆出来）  https://1.1.1.1/audit/123baobiao.php\n\n \n可以通过PHP来产生EXCEL档. teaman翻译 ---------------------------- Excel Functions ---------------------------- 将下面的代码存为excel.php ,然后在页面中包括进来 然后调用 1. Call xlsBOF() 2. 将一些内容写入到xlswritenunber() 或者 xlswritelabel()中. 3.然后调用 Call xlsEOF() 也可以用 fwrite 函数直接写到服务器上，而不是用echo 仅仅在浏览器上显示。 // // To display the contents directly in a MIME compatible browser // add the following lines on TOP of your PHP file: Warning: Cannot modify header information - headers already sent by (output started at /usr/local/apache2/htdocs/project/www/audit/123baobiao.php:16) in /usr/local/apache2/htdocs/project/www/audit/123baobiao.php on line 49Warning: Cannot modify header information - headers already sent by (output started at /usr/local/apache2/htdocs/project/www/audit/123baobiao.php:16) in /usr/local/apache2/htdocs/project/www/audit/123baobiao.php on line 50Warning: Cannot modify header information - headers already sent by (output started at /usr/local/apache2/htdocs/project/www/audit/123baobiao.php:16) in /usr/local/apache2/htdocs/project/www/audit/123baobiao.php on line 51Warning: Cannot modify header information - headers already sent by (output started at /usr/local/apache2/htdocs/project/www/audit/123baobiao.php:16) in /usr/local/apache2/htdocs/project/www/audit/123baobiao.php on line 52Warning: Cannot modify header information - headers already sent by (output started at /usr/local/apache2/htdocs/project/www/audit/123baobiao.php:16) in /usr/local/apache2/htdocs/project/www/audit/123baobiao.php on line 53Warning: Cannot modify header information - headers already sent by (output started at /usr/local/apache2/htdocs/project/www/audit/123baobiao.php:16) in /usr/local/apache2/htdocs/project/www/audit/123baobiao.php on line 54Warning: Cannot modify header information - headers already sent by (output started at /usr/local/apache2/htdocs/project/www/audit/123baobiao.php:16) in /usr/local/apache2/htdocs/project/www/audit/123baobiao.php on line 55 This is a label€嚸@\n2、任意文件下载漏洞导致源码不保（无需登录）   该文件没有任何功能，初步怀疑厂商遗留的后门。按照黑哥说的，一切跟程序功能没任何联系的，就是后门。。。   看代码如下：  在audit/download.php中  贴出全部代码 \n<?php\t\t//for safety //design to that just copy the url cannot download the file//by zhanglerequire_once \"include/language.php\";$file_name = $_GET['name'];$file_dir = $_GET['path'];if (!file_exists($file_dir . $file_name)) {\techo $GLOBALS['zh_output']->get(107);\techo $file_dir . $file_name;\texit;} else {\t$fp = fopen($file_dir . $file_name, \"r\"); \theader( \"Pragma: public\" );\theader( \"Expires: 0\" ); // set expiration time  \theader( \"Cache-Component: must-revalidate, post-check=0, pre-check=0\" );  \theader(\t\"Content-type: application/octet-stream\");\theader(\t\"Accept-Ranges: bytes\");\theader(\t\"Accept-Length: \".filesize($file_dir . $file_name));\theader(\t\"Content-Disposition: attachment; filename=\" . $file_name);\theader( 'Content-Transfer-Encoding: binary' );\t$file_size = filesize($file_dir . $file_name);\t$buffer_size = 1024;\t// use buffer in order not to take up too much memory at one time\t$cur_pos = 0;\twhile(!feof($fp) && ($file_size - $cur_pos > $buffer_size))\t{\t   $buffer = fread($fp, $buffer_size);\t   echo $buffer;\t   $cur_pos += $buffer_size;\t}\t$buffer = fread($fp, $file_size - $cur_pos);\techo $buffer;\tfclose($fp);}?>\n 这里$file_name = $_GET['name'];$file_dir = $_GET['path'];一个路径   一个文件名一旦他们存在即下载文件\n$file_size = filesize($file_dir . $file_name);\t$buffer_size = 1024;\t// use buffer in order not to take up too much memory at one time\t$cur_pos = 0;\twhile(!feof($fp) && ($file_size - $cur_pos > $buffer_size))\t{\t   $buffer = fread($fp, $buffer_size);\t   echo $buffer;\t   $cur_pos += $buffer_size;\t}\n轻轻松松获取源码。。。你说这是啥功能？ 不是后门？？没有任何限制，这就是后门了，请厂商自己确认吧！结合链接提供exp如下：https://1.1.1.1/audit/download.php?path=/usr/local/apache2/htdocs/project/www&name=/index.php\n\n\n\n    漏洞证明：  https://1.1.1.1/audit/download.php?path=/usr/local/apache2/htdocs/project/www&name=/index.php\n\n\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2014-09-28 09:31 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}