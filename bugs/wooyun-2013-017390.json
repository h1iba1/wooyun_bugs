{"id": 14304, "wybug_id": "wooyun-2013-017390", "wybug_title": "腾讯某站下一处跨大域dom xss", "wybug_corp": "腾讯", "wybug_author": "只抽红梅", "wybug_date": "2013-01-16 18:09", "wybug_open_date": "2013-03-02 18:09", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-01-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-01-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-02-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-02-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-03-02：\t细节向公众公开  简要描述： 昨天在zone里面看到“猪猪侠”发的一个帖子以及讨论http://zone.wooyun.org/content/2361正好又有sogili大牛的科普《猥琐流之webkit神跨域》http://zone.wooyun.org/content/2365其实我所知道更早的应该是前端牛JerryQu的博文《Webkit下最无敌的跨大域方案》http://www.imququ.com/post/document_domain_bug_in_webkit.html所以就去google下看能不能找到一处这样的问题。通过 \"site:qq.com inurl:domain\"参数可以找到一些，见详细说明。 详细说明：  由于上面的文章说的很清楚，我这里就简单描述下：由于同源策略的限制，document.domain常用来进行跨域做一些事情，所以在腾讯的大部分业务中都有：\ndocument.domain = \"qq.com\"\n这样的代码。但是有的时候业务需要可能并没有通过js写死在页面中，而是通过js在url中取值来进行设置，比如：http://a.qq.com/?domain=qq.comhttp://b.qq.com/#qq.com这样在以前本没有任何问题，因为在qq.com域下是没有办法设置document.domain为baidu.com域或者com域的。但是webkit内核却支持设置到最后一级也就是\ndocument.domain = \"com\"\n好了，开始看我们找到的实例：http://imgcache.qq.com/qqshow_v3/htdocs/live/popup/361/popup.html?domain=qq.com这个页面中有如下代码：\nvar g_sDomain = QSFL.excore.getURLParam(\"domain\");…………document.domain = g_sDomain;\n我们猜测上面的QSFL.excore.getURLParam函数就是取URL中的domain参数。在http://imgcache.qq.com/ac/qqshow/qsfl/2_71/core.js这个js中我们找到了QSFL.excore.getURLParam函数，就是和我们猜测的一样。\nQSFL.excore.getURLParam = function (sName, sUrl, rCharSet) {    (!sUrl) && (sUrl = window.location.href);    sUrl = sUrl.toString();    sUrl = sUrl.split(\"#\")[0];    var nIndex = sUrl.indexOf(\"?\");    var _value = (nIndex >= 0) ? QSFL.excore.getParam(sUrl.substr(nIndex + 1), sName, \"&\", \"=\") : \"\";    return _value;};\n这样我们就可以通过下面的url来设置document.domain为comhttp://imgcache.qq.com/qqshow_v3/htdocs/live/popup/361/popup.html?domain=com只在webkit内核的浏览器下有效哦，chrome和safari都是webkit的浏览器。   漏洞证明：  http://imgcache.qq.com/qqshow_v3/htdocs/live/popup/361/popup.html?domain=com直接通过chrome访问这个页面，然后看下document.domain的值就可以看到效果。\n\n是不是有疑问在实战中如何利用？我们在我们的任意站点下通过iframe包含这个有漏洞的页面，通过在我们的站点页面下也设置document.domain为com域，这样就突破了同源策略的限制，我们就可以在我们的站点页面向iframe页面注入js代码。说了这么多实例代码我想就不再需要我给出了吧？   修复方案：  1、document.domain写死为qq.com2、可以通过location.host来取值   版权声明：转载请注明来源 只抽红梅@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2013-01-17 09:53 厂商回复： 非常感谢您的报告。这个问题我们已经确认，正在与业务部门进行沟通制定解决方案。如有任何新的进展我们将会及时同步。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-01-16 18:33 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  现在还有红梅么？    \n     2013-01-16 18:54 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  跨大域最近很火啊，学习之。    \n     2013-01-16 20:00 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  啊    \n     2013-01-16 20:54 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  大域、、、    \n     2013-01-17 07:17 |    \t\tZhexi \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 新欢，旧爱。各自安好、互不打扰。)\t\t \n  @只抽红梅   跨域.....求洞主指教    \n     2013-01-19 09:29 |    \t\t一刀终情 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:28        | ‮‮PKAV技术宅社区-安全爱好者)\t\t \n  红梅,常州?    \n     2013-01-19 10:10 |    \t\tXhm1n9 \t\t\t( 实习白帽子  |\t\t\t        Rank:57 漏洞数:13        | bug)\t\t \n  韶关红梅烟    \n     2013-02-06 10:59 |    \t\tfox \t\t\t( 普通白帽子  |\t\t\t        Rank:159 漏洞数:16        | fox)\t\t \n  @只抽红梅 请问那个地址没权限访问是神马情况， 需要什么权限呢http://zone.wooyun.org/content/2361    \n     2013-02-06 11:01 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @fox 加入那个领域 找长短短    \n     2013-02-06 12:31 |    \t\tfox \t\t\t( 普通白帽子  |\t\t\t        Rank:159 漏洞数:16        | fox)\t\t \n  @小胖胖要减肥 好， 多谢， 我记得前几天还看过那个帖子的， 今天倒没权限了    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}