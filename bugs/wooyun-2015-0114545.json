{"id": 31237, "wybug_id": "wooyun-2015-0114545", "wybug_title": "Mao10cms最新版本可遍历所有用户id致可CSRF提升自己为管理员", "wybug_corp": "mao10.com", "wybug_author": "路人甲", "wybug_date": "2015-05-18 10:23", "wybug_open_date": "2015-08-16 15:52", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-21：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-16：\t细节向公众公开  简要描述： Mao10cms最新版本可遍历所有用户id致可CSRF提升自己为管理员测试版本为官方最新版Mao10CMS V3.3.4 详细说明：  看到这个 WooYun: Mao10cms最新版本存在CSRF越权导致管理员发表文章 ，我也来个CSRF，这容易实现，给管理员发条站内信或者留言说自己的商品或网站有问题了，求帮助。热心的管理员就点链接啦。要提升自己为管理员，首先要知道自己的id，mao10cms可以这样获得自己的id，并且可以遍历所有用户（包括管理员）的用户名及id（无需登陆）。在查看商品时，访问链接http://localhost/index.php?m=pro&c=index&a=single&id=1，只要把id从1开始加1遍历就可以得到所有用户（包括管理员）的用户名及id，如图，以管理员为例\n\n知道了自己的id，那就可以通过CSRF来提升自己为管理员了。Mao10cms在后台修改用户权限时没有对token或referer进行处理，可以CSRF看看代码吧\npublic function manage($page=1){    \tif(is_numeric($page)) {\t    \tif(mc_user_id()) {\t    \t\tif(mc_is_admin()) {\t    \t\t\tif(is_numeric($_POST['user_level']) && is_numeric($_POST['user_id'])) {\t\t    \t\t\tif($_POST['user_id']==mc_user_id()) {\t\t\t    \t\t\t$this->error('您不能修改自己的身份！',U('Control/index/manage'));\t\t    \t\t\t} else {\t\t\t    \t\t\tmc_update_meta($_POST['user_id'],'user_level',$_POST['user_level'],'user');\t\t\t\t\t\t\t$this->success('修改用户身份成功！');\t\t    \t\t\t};\t    \t\t\t} else {\t\t    \t\t\t$this->page = M('page')->where(\"type='user'\")->order('id desc')->page($page,mc_option('page_size'))->select();\t\t\t\t\t\t$count = M('page')->where(\"type='user'\")->count();\t\t\t\t\t\t$this->assign('count',$count);\t\t\t\t\t\t$this->assign('page_now',$page);\t\t\t\t\t\t$this->theme('admin')->display('Control/manage');\t    \t\t\t}\t\t    \t} else {\t\t\t    \t$this->error('您没有权限访问此页面！');\t\t    \t};\t    \t} else {\t\t    \t$this->success('请先登陆',U('User/login/index'));\t\t    };\t\t} else {\t\t\t$this->error('参数错误！');\t\t}    }\nPOC如下：\n\n修改过程：\n\n修改成功：\n\n   漏洞证明：  见 详细说明   修复方案：  token referer   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-05-18 15:50 厂商回复： 感谢指正 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}