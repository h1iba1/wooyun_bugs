{"id": 55255, "wybug_id": "wooyun-2014-061574", "wybug_title": "中国消防产品信息网任意文件下载", "wybug_corp": "中国消防产品信息网", "wybug_author": "new", "wybug_date": "2014-05-23 17:40", "wybug_open_date": "2014-07-07 17:41", "wybug_type": "任意文件遍历/下载", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码泄漏"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-23：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-07-07：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 中国消防产品信息网任意文件下载 详细说明：  网站首页：http://www.cccf.com.cn/getIndex.do下载链接：http://www.cccf.com.cn/net/pages/download.jsp?path=uploads%5C2013%5C04%5C11%5C1310185844586.doc&name=%C3%F0%BB%F0%C6%F7%B2%FA%C6%B7..doc直接将path值改为你要下载的文件名，就可以download之，例如：http://www.cccf.com.cn/net/pages/download.jsp?path=/net/pages/download.jsp结果如下：\n\n我们在来看一下download。jsp文件：源码如下：\n<%@page contentType=\"application/x-msdownload\"%><%@ page language=\"java\"  pageEncoding=\"gb2312\"%><%@page import=\"java.io.BufferedInputStream\"%><%@page import=\"java.io.BufferedOutputStream\"%><%@page import=\"java.io.IOException\"%><%  String root = application.getRealPath(\"/\");  String realName = request.getParameter(\"name\");  String fullPath = request.getParameter(\"path\");  response.setHeader(\"Content-Type\", \"application/x-msdownload;\");  response.setHeader(\"Content-disposition\", \"attachment; filename=\" + realName + \"\");    java.io.BufferedInputStream bis = null;  java.io.BufferedOutputStream bos = null;  try {    bis = new BufferedInputStream(new java.io.FileInputStream(root + fullPath ));    bos = new BufferedOutputStream(response.getOutputStream());    byte[] buff = new byte[10 * 1024];    int bytesRead;    while ( -1 != (bytesRead = bis.read(buff, 0, buff.length))) {      bos.write(buff, 0, bytesRead);    }    bos.flush();  } catch (IOException ioe) {    System.out.println(\"ÏÂÔØŽíÎó£º\" + ioe);  } finally {    if (bis != null){      bis.close();    }    if (bos != null) {      bos.close();    }    out.clear();    out = pageContext.pushBody();  }%>\n似乎没有任何限制，只要文件名和路径对就可以了，而且后面的文件名我们不用填写，只用填写路径就好了，这个是java字符串处理的特性，拼接起来就是完整的路径了。   漏洞证明：  同上   修复方案：  做一下下载过滤，只能下载pdf、xls、doc、ppt文件，应该能保你一时平安。   版权声明：转载请注明来源 new@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}