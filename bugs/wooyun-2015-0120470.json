{"id": 9933, "wybug_id": "wooyun-2015-0120470", "wybug_title": "中国电信微店后台管理系统/弱口令/已shell可内网渗透/可控制2.5W微店/泄露近14W订单", "wybug_corp": "中国电信", "wybug_author": "小饼仔", "wybug_date": "2015-06-14 18:10", "wybug_open_date": "2015-08-03 12:10", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["弱口令", "任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-03：\t细节向公众公开  简要描述： 蝴蝶效应 详细说明：  1.系统介绍地址\nhttp://w.189.cn/\n\n\n这个系统是中国电信提供给各地营业厅开设微店的，可以进行业务办理、手机选购等功能。比如常州文化宫中心营业厅\nhttp://w.189.cn/wd/main.do?author=WT16109\n\n\n更改参数author的值就可以到其他营业厅的页面。比如\n中国电信蔡锷路厅 http://w.189.cn/wd/main.do?author=WT3813中国电信上海公园东路营业厅 http://w.189.cn/wd/main.do?author=WT10692等等\n2.漏洞起因之前发的漏洞 WooYun: 中国电信某站配置不当/已shell/可vpn连接/内网渗透 漏洞证明里有提到这样一段话\n因为之前有人已经来过，这里建议你们重置一下老版数据库VPN_USER表登陆密码，还有用户表T_USER_INFO密码明文存储，很多人在不同的站点都用同一个密码，用用户表里面的邮箱账号字段和密码可以成功登陆189邮箱，邮箱里有敏感信息，通知他们都去改密码吧，不然会造成蝴蝶效应的。\n从成功登陆的邮箱中获取到，http://w.189.cn/的两个账号，弱口令000000，当时成功登陆了（现在密码已经失效），找到一个地方可以上传文件，没有限制，导致getshell。2. 证明拿 常州文化宫中心营业厅 http://w.189.cn/wd/main.do?author=WT16109 来做例子说明账号密码\nWT16109 / 111111\n本身就是弱口令成功登陆\n\n可修改微店的各种信息，如产品管理\n\n套餐管理\n\n等等点击门店信息，有个上传店铺头像的地方\n\n没后缀限制，上传shell，返回结果里就有地址\n\nshell地址\nhttp://w.189.cn/upload/images/20150614_154235124.jsp  密码 dsgfdsfrewewcgfdasfasdfasdf因为这个系统有nginx负载均衡，所以连接的时候可能会失败。这里再给一个机器上都有的shell地址http://w.189.cn/admin/upload/images/20150411_11352641.jsp密码 sdfasdfkjermnjcjadksfas如果再失败就重新上传吧\n上个菜刀连接\n\n数据库配置\n\n用户量 3W+\n\n测试下弱口令000000 md5为 670b14728ad9902aecba32e22fa4f6bd\nSELECT count(*) FROM WT_USER where MD5PWD='670b14728ad9902aecba32e22fa4f6bd' ORDER BY 1 DESC4977\n00000就有近5000个微店数量 2.5W+\n\n订单 近14W\n\n订单数据,有姓名电话地址\n\n   漏洞证明：  在内网\n[/home/wd_web/app/webapps/wtfx_02/admin/upload/images/]$ ifconfigeth0      Link encap:Ethernet  HWaddr 02:00:30:CC:01:0E            inet addr:172.16.246.47  Bcast:172.16.246.255  Mask:255.255.255.0          inet6 addr: fe80::30ff:fecc:10e/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:262574821 errors:0 dropped:0 overruns:0 frame:0          TX packets:274629745 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:120478956360 (112.2 GiB)  TX bytes:198503921192 (184.8 GiB)lo        Link encap:Local Loopback            inet addr:127.0.0.1  Mask:255.0.0.0          inet6 addr: ::1/128 Scope:Host          UP LOOPBACK RUNNING  MTU:16436  Metric:1          RX packets:44326 errors:0 dropped:0 overruns:0 frame:0          TX packets:44326 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0           RX bytes:12113369 (11.5 MiB)  TX bytes:12113369 (11.5 MiB)\nlinux内核可提权\n[/home/wd_web/app/tomcat_wd/bin/]$ uname -aLinux jtwd47 2.6.32-279.el6.x86_64 #1 SMP Wed Jun 13 18:24:36 EDT 2012 x86_64 x86_64 x86_64 GNU/Linux\n利用reGeorg反向，可进一步渗透地址http://w.189.cn/upload/images/20150614_160701772.jsp已拿下两台服务器root权限\n172.16.246.15\n\n\n\n172.16.246.47\n\n\n已证明，不再进一步深入   修复方案：  未做破坏...   版权声明：转载请注明来源 小饼仔@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-06-19 12:09 厂商回复： CNVD确认并复现所述情况,已经转由CNCERT下发通报,由其后续协网站调管理单位处置.  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}