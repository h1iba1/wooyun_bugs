{"id": 55714, "wybug_id": "wooyun-2014-060141", "wybug_title": "CSDJCMS 程式舞曲 最新 注入三处 (无需登录,官网成功)", "wybug_corp": "chshcms.com", "wybug_author": "′雨。", "wybug_date": "2014-05-10 16:30", "wybug_open_date": "2014-08-08 16:32", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-08：\t细节向公众公开  简要描述： 同一文件中。  两处无需登录,一处需要注册一个会员。 详细说明：  在app/controllers/home.php中第一处 \npublic function friendadd()\t{            header(\"Expires: Mon, 26 Jul 1997 05:00:00 GMT\");             header(\"Cache-Control: no-cache, must-revalidate\");             header(\"Pragma: no-cache\");            if(@!eregi($_SERVER['SERVER_NAME'],$_SERVER['HTTP_REFERER'])){exit('QQ:848769359');}            @header(\"Content-type: text/html;charset=gbk\");            $user= $this->input->get_post('user', TRUE);   //user            $type= $this->input->get_post('type', TRUE);   //type                if(empty($user)){\t\t\texit(\"10000\");//参数错误                }                $users=$this->session->userdata('cs_name');                if(!$this->CsdjUser->User_Login(1)){\t\t\texit(\"10001\");//没有登入                }                if($users==$user){\t\t\texit(\"10004\");//不能关注自己                }                if($type=='qx'){  //删除                      $this->db->query(\"delete from \".CS_SqlPrefix.\"friend where CS_Userb='\".$user.\"' and cs_usera='\".$users.\"'\");                      //删除粉丝                      $this->db->query(\"delete from \".CS_SqlPrefix.\"fans where CS_Usera='\".$user.\"' and cs_userb='\".$users.\"'\");                      exit(\"ok\");                }                $sql=\"SELECT * FROM \".CS_SqlPrefix.\"user where cs_name='\".$user.\"'\";\n$user 无过滤的就带入到了查询当中。第二处\npublic function login()\t{            $username = $this->input->get_post('username', TRUE);   //username            $userpass = $this->input->get_post('userpass', TRUE);   //userpass            if(empty($username)) exit('10001');  //用户名为空            if(empty($userpass)) exit('10002');  //密码为空                    //可以用ID、会员名、邮箱来进行登入                    $sqlu=\"SELECT CS_Pass,CS_SID,CS_YID,CS_ID,CS_Name,CS_LogNum,CS_Cion,CS_Vip,CS_LogTime,CS_EndTime FROM \".CS_SqlPrefix.\"user where cs_id='\".$username.\"' or cs_name='\".$username.\"' or cs_email='\".$username.\"'\";\t\t    $row=$this->CsdjDB->get_all($sqlu);\n$username无过滤带入查询中。第三处\npublic function webplayer()\t{            header(\"Expires: Mon, 26 Jul 1997 05:00:00 GMT\");             header(\"Cache-Control: no-cache, must-revalidate\");             header(\"Pragma: no-cache\");            if(@!eregi($_SERVER['SERVER_NAME'],$_SERVER['HTTP_REFERER'])){exit('QQ:848769359');}            @header(\"Content-type: text/html;charset=gbk\");            $user= $this->input->post('uid', TRUE);   //user                $showstr='';                $sqlstr=\"select CS_FID,CS_Name,CS_PlayUrl from \".CS_SqlPrefix.\"dance where CS_YID=0 and CS_HID=0 and CS_User='\".$user.\"' order by CS_ID desc limit 0, 10\";\t\t$result=$this->CsdjDB->db->query($sqlstr);\n$user 可控无过滤。测试一下demo   漏洞证明：  \n\ndemo成功。其他两处都一样。   修复方案：     版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-05-10 16:35 厂商回复： 不是上午已经发过一次了吗？我刚刚已经修复了~！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-10 16:31 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @′ 雨。 为何你总是那么屌？高富帅，漏洞都是钱啊    \n     2014-05-10 16:54 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @chshcms.com 这漏洞审核慢了。。。。。。。    \n     2014-05-10 16:57 |    \t\t程氏舞曲CMS(乌云厂商)\t\t \n  @′  雨。 您上去不是已经发过了么？    \n     2014-05-10 17:19 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @程氏舞曲CMS 本来是两个都是一起发的。 结果审核的时候 先审了一个 另外一个又没审 现在下午才审核过了。    \n     2014-05-10 17:19 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @程氏舞曲CMS 随便求补丁。。 让我看看。    \n     2014-05-10 17:29 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @程氏舞曲CMS  额 不用补丁了。  已经Fuzz 绕过了。    \n     2014-05-10 17:38 |    \t\t程氏舞曲CMS(乌云厂商)\t\t \n  @′  雨。 漏洞还是存在？    \n     2014-05-10 17:42 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @程氏舞曲CMS 嗯 绕过了。  已经乌云了, 等审核通过了 你们就能看到了    \n     2014-05-10 18:54 |    \t\t程氏舞曲CMS(乌云厂商)\t\t \n  @′  雨。 麻烦您在测试下看看~！    \n     2014-05-10 18:57 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @程氏舞曲CMS  嗯测试了的。 可以成功绕过。http://www.wooyun.org/bugs/wooyun-2014-060210/trace/05040a9a8a472dd0eb0641c5e90d10a3还在审核。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}