{"id": 50093, "wybug_id": "wooyun-2014-078923", "wybug_title": "bookingeCMS ktvCMS无任何限制重装", "wybug_corp": "珠海中新信息科技有限公司", "wybug_author": "路人甲", "wybug_date": "2014-10-15 11:34", "wybug_open_date": "2015-01-13 11:36", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-15：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-01-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 有人争论重装算不算通用，如果cms连最基本的安装锁都没有用呢？或者没有生成一个按钮提示用户删除install呢？再或者安装完成后没有把安装目录rename一下？ 详细说明：  安装前能判断一下lock吗？安装步骤能判断一下吗？生成lock放那里是摆设吗？看下面安装代码，install/index.php\n$install = new install();$step = isset($_GET['step']{0}) ? $_GET['step'] : 1;if($step == 1) {\t$license = file_get_contents(MY_ROOT.'license.html');\tinclude MY_ROOT.'templates'.DIRECTORY_SEPARATOR.'step-1.html';} elseif($step == 2) {\t$isError = FALSE;\t$sp_gd = $install->checkGD();\t$isError = ($sp_gd > 0 ? $isError : TRUE);\t$sp_allow_url_fopen = (ini_get('allow_url_fopen') ? array('<img src=\"images/ok.gif\" alt=\"成功\" />', 'allow_url_fopen 已开启！') : array('<img src=\"images/error.gif\" alt=\"失败\" />', 'allow_url_fopen 未开启！'));\t$sp_safe_mode = (ini_get('safe_mode') ? array('<img src=\"images/error.gif\" alt=\"失败\" />', 'safe_mode 已开启！') : array('<img src=\"images/ok.gif\" alt=\"成功\" />', 'safe_mode 已关闭！'));\t$sp_gd = ($sp_gd > 0 ? array('<img src=\"images/ok.gif\" alt=\"成功\" />', 'GD 扩展已开启！') : array('<img src=\"images/error.gif\" alt=\"失败\" />', 'GD 扩展未开启！'));\t$sp_mysql = (function_exists('mysql_connect') ? array('<img src=\"images/ok.gif\" alt=\"成功\" />', 'MySQL 扩展已开启！') : array('<img src=\"images/error.gif\" alt=\"失败\" />', 'MySQL 扩展未开启！'));\t$isError = (function_exists('mysql_connect') ? $isError : TRUE);\t$sys_file = array(\t\t'data' => array('Cache', 'Config', 'Xml'),\t\t'lib' => array('Controller' => 'admin', 'Model' => 'admin', 'My', 'Plugin', 'View' ),\t\t'theme',\t\t'upload'\t);\t$auth = $install->checkAuthority(APP_ROOT, $sys_file);\tinclude MY_ROOT.'templates'.DIRECTORY_SEPARATOR.'step-2.html';} elseif($step == 3) {\t$return = '';\tif(isset($_POST['sql_name']{0})) {\t\t$return = $install->initDb();\t\tif($return === TRUE) {\t\t\theader('Location:index.php?step=4');\t\t\texit();\t\t}\t}\tinclude MY_ROOT.'templates'.DIRECTORY_SEPARATOR.'step-3.html';} elseif($step == 4) {\t$return = '';\tif(isset($_POST['adminName']{0})) {\t\t$return = $install->initAdmin();\t\tif($return === TRUE) {\t\t\theader('Location:index.php?step=5');\t\t\texit();\t\t}\t}\tinclude MY_ROOT.'templates'.DIRECTORY_SEPARATOR.'step-4.html';} elseif($step == 5) {\t$admin = $install->getAdmin();\t$file = fopen(MY_DATADIR.'install.lock', 'ab');\tif(!$file) {\t\tfwrite($file, '');\t\tfflush($file);\t\tfclose($file);\t}\tinclude MY_ROOT.'templates'.DIRECTORY_SEPARATOR.'step-5.html';}\n安装前敢不敢判断一下lock？步骤控制变量step用户可控，可直接查看安装完成后的界面，demo演示：http://ktv.cms.bookinge.com/install/index.php?step=5\n\n   漏洞证明：  第一次测试时把demo给重装了，见谅~~下载用本机环境截图作证明吧\n\n   修复方案：  安装前判断lock或者 强制删除install目录再或者 把安装目录rename一下安装过程对step进行判断   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}