{"id": 49130, "wybug_id": "wooyun-2014-075186", "wybug_title": "帝国CMS（全版） 验证码可无视！可导致验证码无效（验证码识别都是渣渣）", "wybug_corp": "帝国CMS", "wybug_author": "风情万种", "wybug_date": "2014-09-05 18:48", "wybug_open_date": "2014-12-04 18:50", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-04：\t细节向公众公开  简要描述： 帝国CMS 验证码可无视！可导致验证码无效（验证码识别都是渣渣） 详细说明：  看帝国 获取验证码的代码 \n//显示验证码function ShowKey($v){\t$vname=ecmsReturnKeyVarname($v);\t$key=strtolower(domake_password(4));\tecmsSetShowKey($vname,$key); ..................}\necmsReturnKeyVarname 是返回保存验证码的cookie的名称比如本列打开的页面上注册页面的验证码url 是 http://localhost/empirecms/e/ShowKey/?v=reg第一步：根据ecmsReturnKeyVarname 返回的是checkregkey\n//返回变量名function ecmsReturnKeyVarname($v){\tif($v=='login')//登陆\t{\t\t$name='checkloginkey';\t}\telseif($v=='reg')//注册\t{\t\t$name='checkregkey';\t}\telseif($v=='info')//信息\t{\t\t$name='checkinfokey';\t}\telseif($v=='spacefb')//空间反馈\t{\t\t$name='checkspacefbkey';\t}\telseif($v=='spacegb')//空间留言\t{\t\t$name='checkspacegbkey';\t}\telseif($v=='gbook')//留言\t{\t\t$name='checkgbookkey';\t}\telseif($v=='feedback')//反馈\t{\t\t$name='checkfeedbackkey';\t}\telseif($v=='getpassword')//取回密码\t{\t\t$name='checkgetpasskey';\t}\telseif($v=='regsend')//重发激活邮件\t{\t\t$name='checkregsendkey';\t}\telse//评论pl\t{\t\t$name='checkplkey';\t}\treturn $name;}\n第二步：ecmsSetShowKey函数将cookie保存到cookie中，看这函数好像是做了不少 其实是把验证码md5了一下就保存到cookie里面了 关键点:$key=$time.','.$checkpass.','.$val;$val就是验证码的md5\n/设置验证码function ecmsSetShowKey($varname,$val,$ecms=0){\tglobal $public_r;\t$val=md5($val);\t$time=time();\t$checkpass=md5(md5($val.'EmpireCMS'.$time).$public_r['keyrnd']);\t$key=$time.','.$checkpass.','.$val;\tesetcookie($varname,$key,0,$ecms);}//设置COOKIEfunction esetcookie($var,$val,$life=0,$ecms=0){\tglobal $ecms_config;\t$varpre=empty($ecms)?$ecms_config['cks']['ckvarpre']:$ecms_config['cks']['ckadminvarpre'];\treturn setcookie($varpre.$var,$val,$life,$ecms_config['cks']['ckpath'],$ecms_config['cks']['ckdomain']);}\n第三步：查看cookie,mlukmcheckregkey=1409913237%2C26b915271f0eccf2eef645af070e7e63%2C8f136277f7544773106f4c06dcdb4bf4;最后面%2C后面8f136277f7544773106f4c06dcdb4bf4就是验证码的md5 这四位数的验证码在cmd5那是一查一个准啊\n\n\n\n   漏洞证明：  \n\n\n\n   修复方案：  验证码识别都市渣渣   版权声明：转载请注明来源 风情万种@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-09-10 09:13 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-05 19:57 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  估计被忽略，我之前提交csrf shell的一直还在，这个厂商不再    \n     2014-09-10 12:36 |    \t\tmagerx \t\t\t( 普通白帽子  |\t\t\t        Rank:257 漏洞数:45        | 别说话。)\t\t \n  开刷了么。。    \n     2014-12-05 01:17 |    \t\tAnonymous.L \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:8        | 最后一位关注xxxx的人 , 孤独之人)\t\t \n  几乎没有影响，验证码的功能是防止注册机类似的灌水软件，你即使md5解密也没什么用的，验证码的功能已经完成了，等你解密了都什么时候了。    \n     2014-12-05 09:10 |    \t\t尕肚肚 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 安全技术屌丝)\t\t \n  不懂，获得已经验证过的验证码有什么用？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}