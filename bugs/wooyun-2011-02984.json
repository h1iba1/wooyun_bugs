{"id": 21972, "wybug_id": "wooyun-2011-02984", "wybug_title": "phpcms 2008代码注射漏洞", "wybug_corp": "phpcms", "wybug_author": "teamtopkarl", "wybug_date": "2011-10-12 16:51", "wybug_open_date": "2011-11-11 16:51", "wybug_type": "设计不当", "wybug_level": "高", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "远程代码执行", "代码执行漏洞"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-10-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2011-10-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2011-10-16：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2011-12-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2011-12-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2011-12-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2011-11-11：\t细节向公众公开  简要描述： phpcms2008的某参数可以进行代码注入。 详细说明：  phpcms 2008的代码中由于对模板参数处理不当，导致可以任意执行任意代码文件。具体的代码触发路径是这样的：phpcms/yp/product.php中获取pagesize参数，拼接为$urlrule变量。随后将之带入yp目录下的product.html模板之中。在模板执行后，进入到get函数处理中，最后经过get->pages->pageurl函数，最终触发pageurl的如下代码：\neval(\"\\$url = \\\"$urlrule\\\";\");\n在这里，将未过滤的$urlrule通过eval赋值。这里可以使用${@phpcode}的语法执行php函数，最终造成漏洞。（进入最后pageurl逻辑前，有个要求是product数目必须超过0，所以没有测试数据的本地新搭建环境没法复现，必须加一些测试数据才行）   漏洞证明：  http://demo.phpcms.cn/yp/product.php?pagesize=${@print(md5(admin))}http://demo.phpcms.cn/yp/product.php?pagesize=${@phpinfo()}\n\n   修复方案：     版权声明：转载请注明来源 teamtopkarl@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2011-10-13 10:03 厂商回复： 5 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2011-10-13 00:36 |    \t\td4rkwind \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 关注web 安全，产品安全)\t\t \n  顶    \n     2011-10-13 10:08 |    \t\trayh4c \t\t\t( 普通白帽子  |\t\t\t        Rank:240 漏洞数:23        )\t\t \n  自评RANK好低啊 - -    \n     2011-10-13 10:16 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  关键是厂商的亮了 命令执行还低 无解的盛大啊 哈哈    \n     2011-10-13 10:47 |    \t\tc4rp3nt3r \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:10        | 人生的意义就在于从一个圈子跳到另一个更大...)\t\t \n  盛大也给过我一次5R,好像这玩意要花钱是的    \n     2011-10-13 12:55 |    \t\t我了个去 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:14        | 4892057@qq.com                          ...)\t\t \n  求exp，哈哈    \n     2011-10-13 15:12 |    \t\tteamtopkarl \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:7        | 对网络安全事业一直保持着激情)\t\t \n  我这个洞被盛大无视了，我也没怎么深入，只给了个POC    \n     2011-10-13 22:10 |    \t\t笨子 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 80759112)\t\t \n  坐等公开啊  盛大人为 就算你射了 你后台也拿不到shell    \n     2011-10-13 22:22 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  这直接执行代码的 就是个shell不需要你射    \n     2011-10-13 22:47 |    \t\t坏虾 \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:8        | From Internet,For Internet……BY：坏虾)\t\t \n  这两天，phpcms 2008都被人搞烂了快。唉，直接getshell    \n     2011-10-14 00:31 |    \t\tteamtopkarl \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:7        | 对网络安全事业一直保持着激情)\t\t \n  是远程代码执行，EXP我写出来了    \n     2011-10-14 02:48 |    \t\t笨子 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 80759112)\t\t \n  额 求 exp getshell    \n     2011-10-14 07:19 |    \t\tteamtopkarl \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:7        | 对网络安全事业一直保持着激情)\t\t \n  铁证如山，看我的截图，哈哈http://hi.baidu.com/teamtopkarl/blog/item/cbe18fef7bf09af3cf1b3e26.html    \n     2011-10-14 07:28 |    \t\tteamtopkarl \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:7        | 对网络安全事业一直保持着激情)\t\t \n  这洞我其实去年11月份就发现了，直接看文章http://hi.baidu.com/teamtopkarl/blog/item/9ca1e719fa13796adbb4bd68.html    \n     2011-10-14 13:00 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  怎么发现的啊 这个    \n     2011-10-15 12:38 |    \t\tBloodwolf \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:8        | whoami)\t\t \n  这种洞洞 尤其是针对开源程序。只要仔细审查一遍代码。就能发现不少地方    \n     2011-10-17 22:20 |    \t\txiaoxin \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:16        | 无)\t\t \n  有点鸡肋了，许多网站禁用此模块    \n     2011-11-12 12:03 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  - - RANK真低     \n     2011-11-12 12:27 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  说明厂商的判断能力有问题    \n     2012-05-25 10:52 |    \t\tPhp0day \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | php安全开发、代码审计、渗透测试。)\t\t \n  哇。。我都不敢提交了。    \n     2012-08-18 20:29 |    \t\t冷bing \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 你懂的、。)\t\t \n  最近，phpcms 很火啊，这是为什么呢？为什么？    \n     2013-08-31 21:45 |    \t\t少校 \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:5        | 别开枪，自己人！)\t\t \n  本站验证码太简单，很容易识别，我是测试验证码识别程序！    \n     2013-09-02 14:32 |    \t\tBloodwolf \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:8        | whoami)\t\t \n  楼上的木有小JJ！我是测试验证码识别程序！    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}