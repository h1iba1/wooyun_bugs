{"id": 76577, "wybug_id": "wooyun-2015-0164562", "wybug_title": "ThinkSAAS最新版2.4 Xss漏洞", "wybug_corp": "thinksaas.cn", "wybug_author": "麦兜", "wybug_date": "2015-12-28 10:44", "wybug_open_date": "2016-02-09 23:29", "wybug_type": "XSS 跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-09：\t细节向公众公开  简要描述： 未过滤 详细说明：  先看写入代码：/var/www/html/thinksaas/app/my/action/setting.php\ncase \"citydo\":\t\t\t$province = trim($_POST['province']); \t\t$city = trim($_POST['city']);//只过滤两处空白\t\t//这里就直接写入数据库了\t\t$new['my']->update('user_info',array(\t\t\t'userid'=>$userid,\t\t),array(\t\t\t\t\t'province'=>$province,\t\t\t'city'=>$city,\t\t\t\t));\t\ttsNotice(\"常居地更新成功！\");\t\t\tbreak;\nUpdate:\npublic function update($table, $conditions, $row) {\t\t$where = \"\";\t\tif (empty ( $row ))\t\t\treturn FALSE;\t\tif (is_array ( $conditions )) {\t\t\t$join = array ();\t\t\tforeach ( $conditions as $key => $condition ) {\t\t\t\t$condition = $this->escape ( $condition );\t\t\t\t$join [] = \"`{$key}` = {$condition}\";\t\t\t}\t\t\t$where = \"WHERE \" . join ( \" AND \", $join );\t\t} else {\t\t\tif (null != $conditions)\t\t\t\t$where = \"WHERE \" . $conditions;\t\t}\t\tforeach ( $row as $key => $value ) {\t\t\t$value = $this->escape ( $value ); //只做了转义\t\t\t//$vals [] = \"`$key` = $value\";\t\t\t$vals [] = \"{$key} = {$value}\";\t\t}\t\t$values = join ( \", \", $vals );\t\t$sql = \"UPDATE \" . dbprefix . \"{$table} SET {$values} {$where}\";\t\t\t\treturn $this->db->query ( $sql );\t}\n再来看取出：/var/www/html/thinksaas/app/user/class.user.php\n//获取一个用户的信息\tfunction getOneUser($userid){\t\t\t\t\t\t$strUser = $this->find('user_info',array(\t\t\t\t'userid'=>$userid,\t\t\t));\t\t\t\t\t\tif($strUser){\t\t\t\t\t\t\t$strUser['username'] = tsTitle($strUser['username']);\t\t\t\t\t\t\tif($strUser['face'] && $strUser['path']){\t\t\t\t\t$strUser['face'] = tsXimg($strUser['face'],'user',120,120,$strUser['path'],1);\t\t\t\t}elseif($strUser['face'] && $strUser['path']==''){\t\t\t\t\t$strUser['face']\t= SITE_URL.'public/images/'.$strUser['face'];\t\t\t\t}else{\t\t\t\t\t//没有头像\t\t\t\t\t$strUser['face']\t= SITE_URL.'public/images/user_large.jpg';\t\t\t\t}\t\t\t}else{\t\t\t\t$strUser = '';\t\t\t}\t\t\t\t\t\treturn $strUser; //没任何过滤\t}\n   漏洞证明：  \n\n\n\n   修复方案：  过滤并编码   版权声明：转载请注明来源 麦兜@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-12-28 23:02 厂商回复： 感谢反馈，已经修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}