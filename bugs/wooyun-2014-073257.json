{"id": 51821, "wybug_id": "wooyun-2014-073257", "wybug_title": "frcms 多处注入 (demo成功)", "wybug_corp": "finereason.com", "wybug_author": "′king", "wybug_date": "2014-08-25 11:17", "wybug_open_date": "2014-11-23 11:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-28：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-23：\t细节向公众公开  简要描述： rt 详细说明：  在plus/onlinepay/alipay_notify.php中\n$sign_type       = \"MD5\";\t\t\t\t\t\t       //加密方式 不需修改$alipay = new alipay_notify($partner,$security_code,$sign_type,$_input_charset,$transport);    //构造通知函数信息$verify_result = $alipay->notify_verify();  //计算得出通知验证结果$dingdan       = $out_trade_no;       \t//获取支付宝传递过来的订单号$total         = isset($price)?$price:$total_fee;\t\t\t//获取支付宝传递过来的总价格if($verify_result) {    if($_POST['trade_status'] == 'WAIT_BUYER_PAY'||$_POST['trade_status'] == 'TRADE_FINISHED' ||$_POST['trade_status'] == 'TRADE_SUCCESS') {        echo \"success\";    }\n当通不过验证的时候\nelse {    $db ->query(\"update {$cfg['tb_pre']}payback set p_isucceed=2 where p_oid=$dingdan\");    echo \"fail\";\n带入了这个查询 且没有单引号。也没有intval 可以注入了。在tenpay_notify.php 中\n}}else{    $db ->query(\"update {$cfg['tb_pre']}payback set p_isucceed=2 where p_oid=$sp_billno\");\tshowmsg('支付失败！如果您的账户已扣款请联系管理员确认是否支付成功。',\"javascript:;\");exit;}\n也是没通过验证 无单引号 无intval在chinabank_notify.php中\n}else{    $db ->query(\"update {$cfg['tb_pre']}payback set p_isucceed=2,p_pmode='$v_pmode' where p_oid=$v_oid\");\tshowmsg('支付失败！如果您的账户已扣款请联系管理员确认是否支付成功。',\"javascript:;\");exit;}?>\n当没通过验证的时候 无单引号 无intval   漏洞证明：  \n\n这里我把语句输出了一下 盲注、。试试demo访问 http://v2014.rccms.com/plus/onlinepay/alipay_notify.php?out_trade_no=1返回的是 fail访问这个 http://v2014.rccms.com/plus/onlinepay/alipay_notify.php?out_trade_no=a返回的是提示信息！MysqlError:MySQL Query Error如果你的浏览器没反应，请点击这里...因为这时候我们提交的是一个字符这里没有单引号 所以就报错了把语句换一下就能盲注了 就不继续测试了。   修复方案：  都intval把。   版权声明：转载请注明来源 ′king@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-08-25 11:55 厂商回复： 漏洞已确认存在，修复中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}