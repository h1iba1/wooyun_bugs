{"id": 45777, "wybug_id": "wooyun-2014-087073", "wybug_title": "腾讯QQ升级漏洞（2009-2014通杀），可被中间人攻击利用植入木马", "wybug_corp": "腾讯", "wybug_author": "内谁", "wybug_date": "2014-12-14 02:01", "wybug_open_date": "2015-03-14 02:02", "wybug_type": "非授权访问/认证绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["腾讯", "木马", "中间人攻击", "自动升级"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-18：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-14：\t细节向公众公开  简要描述： QQ2009-2014通杀（包括最新的6.7），升级过程可被中间人攻击利用，可使得获得更新程序的机器被植入任意EXE文件。 详细说明：  QQ在登录成功后10分钟左右，会主动向服务器POST投递某个模块要求更新，URL如下：http://updatecenter.qq.com/queryselfupdate回应包为一个包含特殊文件头的xml文档，该文档描述了要更新的url地址（zip压缩包），hash值，以及size。这个回应包的前两个字节表示了文件头的大小，去除文件头后，就是标准的xml文档攻击者如果劫持了这个TCP会话，并伪造xml文档，插入TCP会话，可以造成任意exe文件被下载并执行的后果。QQ没有对此文件进行任何校验，仅仅通过xml的描述来校验是否合法，未对exe文件本身进行数字签名校验等措施。   漏洞证明：  抓包及插入TCP会话后截图\n\n\n\n伪造的xml文档：\n\n在这个xml文档中，url字段表示zip包的下载地址（必须为zip包，包中需要有名为txupd.exe的文件），MD5字段为hash值，size字段为大小（字节）符合上述条件，下载后自动解包，自动运行，想怎么玩就怎么玩……   修复方案：  校验zip包内的文件，校验数字签名   版权声明：转载请注明来源 内谁@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-12-15 14:38 厂商回复： 非常感谢您的报告。这个问题我们已经确认，正在与业务部门进行沟通制定解决方案，如有任何新的进展我们将会及时同步。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-15 14:41 |    \t\t0x334 \t\t\t( 普通白帽子  |\t\t\t        Rank:171 漏洞数:35        | 漏洞无影响，已忽略～～～～～～～)\t\t \n  中间人20分！    \n     2014-12-15 14:47 |    \t\tWalle \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:5        | ...   位卑、未敢忘忧国！   ...)\t\t \n  企鹅终于被X了、、    - -    \n     2014-12-15 14:49 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  好屌    \n     2014-12-15 14:54 |    \t\t紫衣大侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:21        | 愿结天下有识之士)\t\t \n  关注下~~    \n     2014-12-15 15:05 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:29        | 倚楼听风雨，淡看江湖路...)\t\t \n  应该很好看    \n     2014-12-15 15:20 |    \t\t阿狸 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 我喜欢阿狸！！！！！！！！)\t\t \n  已经关注   坐等公开    \n     2014-12-15 15:33 |    \t\t码农 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 爱肉肉~)\t\t \n  看不到 无爱    \n     2014-12-15 16:13 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  厉害    \n     2014-12-16 01:38 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:16        | 猜猜我是谁？)\t\t \n  没有校验数字签名？感觉和上次沙龙的议题好像~    \n     2014-12-16 10:24 |    \t\tWoodee \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 乌云路人甲，打脸pa pa pa)\t\t \n  据说这个洞很强大    \n     2014-12-16 16:20 |    \t\tRichy \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:5        )\t\t \n  坐等公开    \n     2014-12-16 18:45 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  mitmf?    \n     2014-12-16 19:38 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  牛B啊!~~    \n     2014-12-16 19:52 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  求详细。。。~    \n     2014-12-18 11:33 |    \t\tค้้้้้้้้้ \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:5        | 撸[ค้้้้้้้้้้้้้้้้้...)\t\t \n  占位    \n     2014-12-18 16:45 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2360 漏洞数:406        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  原来是这样子    \n     2014-12-18 19:19 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  20，see see    \n     2014-12-19 05:10 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-12-19 11:38 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  公开时间？醉了。。。。。    \n     2014-12-19 16:33 |    \t\t忽然之间 \t\t\t( 普通白帽子  |\t\t\t        Rank:802 漏洞数:131        | 空白格)\t\t \n  已经强制更新了，赶紧查我的钱多了没    \n     2014-12-19 17:33 |    \t\t龍 、 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:135        | 你若安好  我就是晴天)\t\t \n  醉啦    \n     2014-12-19 17:42 |    \t\t无心、 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:20        | 你不是风儿，我也不是沙，再怎么缠绵也到不...)\t\t \n  @龍 、醉尼玛蛋，蛋疼    \n     2014-12-19 17:43 |    \t\t无心、 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:20        | 你不是风儿，我也不是沙，再怎么缠绵也到不...)\t\t \n  公开时间：\t 2015-01-28 02:01醉了。    \n     2014-12-19 20:55 |    \t\t我是一只小鸭子 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 想好再写)\t\t \n  和搜狗输入法哪个一样？    \n     2014-12-20 10:07 |    \t\t命运 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我是来乌云秀智商下限的~~)\t\t \n  似曾相识    \n     2015-01-05 17:47 |    \t\t冷冷的夜 \t\t\t( 普通白帽子  |\t\t\t        Rank:135 漏洞数:12        )\t\t \n  配合某些手段用处很大，吊！    \n     2015-03-14 14:46 |    \t\t静默 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:6        | 安全小白)\t\t \n  牛逼爆了    \n     2015-03-16 15:16 |    \t\t木马游民 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:8        | I love LSD!)\t\t \n  大锅，请问用到那个劫持工具叫啥呀    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}