{"id": 2100, "wybug_id": "wooyun-2014-061149", "wybug_title": "Anymacro 邮件系统登陆状态任意文件下载漏洞（读取源码以及邮件内容）", "wybug_corp": "北京安宁创新网络科技有限公司", "wybug_author": "路人甲", "wybug_date": "2014-05-17 20:38", "wybug_open_date": "2014-08-15 20:40", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-21：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-15：\t细节向公众公开  简要描述：  详细说明：  乌云已经把它列入到通用型奖励厂商当中了。0x01 北京anymacro是国内较流行的一家企业级邮箱系统，客户主要为教育/政府机构。其中涉及客户较多。从官网确认以下受影响：运营级系统中华人民共和国商务部河北省网通黑龙江省网通内蒙古自治区铁通抚顺市网通企业级系统苏宁电器集团中远房地产邯郸钢铁集团铜牛针织集团校园级系统北京邮电大学中国人民大学东北大学南昌大学电 子 政 务中国政协济南市政府天津市公安局河北省高级人民法院市民信箱系统青岛市东营市石家庄市宝鸡市0x02 漏洞分析：给2个案例http://webmail.vanceinfo.com   http://sut.edu.cn在根目录当中domain_sign.php\nrequire_once \"config/config.php\";require_once \"include/template.php\";require_once \"include/func.php\";require_once 'include/right.php';require_once 'include/func_login.php';require_once \"include/auth.php\";$domain_sign_dir=$DOMAIN_SIGN_DIR; //这里$DOMAIN_SIGN_DIR已经原始定义域签名目录：/mail/domain_signif (!empty($imgid)){  //不为空的情况下：\t$file=$domain_sign_dir.\"/img/\".base64_decode($imgid);  这里$imgid base64解码。。        if (file_exists($file)){    //如果存在就以图片输出。。。从而造成任意文件读取（源码），，包括邮件信息                header(\"Content-type:image;\");                readfile($file);                exit;        }\texit;}if (!empty($get_sign)){\t$file=$domain_sign_dir.\"/\".$SESSION[\"domain\"].\".sign\";\tif (file_exists($file)){                readfile($file);                exit;\n例如读取/etc/passwd\n\n\n\n然后通过读/etc/shadow 报错，即可知道邮件系统的路径，从而造成任意源码读取\n\n同样构造好即可读取任意邮件内容。   漏洞证明：  \n\n\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-05-18 13:23 厂商回复： 此漏洞为我公司的G6版本，现在使用量已经比较小。正在推出升级包联系用户升级 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}