{"id": 45372, "wybug_id": "wooyun-2015-0118944", "wybug_title": "凤凰网客户端远程命令执行附加详细利用分析", "wybug_corp": "凤凰网", "wybug_author": "小手冰凉", "wybug_date": "2015-06-08 11:08", "wybug_open_date": "2015-09-09 20:30", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行", "客户端安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-14：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-09：\t细节向公众公开  简要描述： 凤凰网的新闻，看起来简直停不下来! 详细说明：  凤凰网客户端远程命令执行，这次就以你为跳板了多个问题串起来达到远程命令执行的目的。0x00 版本目标凤凰新闻最新版（fenghuangxinwen_95.apk 4.4.3）0x01 命令执行这个版本的凤凰新闻编译的安卓目标版本过低导致命令执行漏洞\nminSdkVersion: '9'  targetSdkVersion: '15'\n测试凤凰新闻阅读普通新闻的时候打开的正好是webview，我们将地址指向poc结果如下\n\n0x02 接口过滤不严&新闻伪造通常找app提供的接口都是去AndroidManifest.xml文件中找注册的接受类，然后去反编译分析源码，那样有时候反编译不出来，这里我们换个不同的思路。随便打开一个新闻，然后使用分享功能，把分享信息中的URL复制出来，在手机浏览器中打开，你会发现这个时候就会自动跳转到新闻客户端，这个过程其实就是手机浏览器根据网页上的提供的app的本地接口打开app，并且通常情况下都会传递一个数据过去，例如URL。这样也就以为这js中会暴露出这个app的提供的接口的使用方式。使用这种方式我们发现了如下接口\ncomifengnewsclient://call?type=doc&id=<URL>\n在js中用上面这个地址就会直接跳转到app。其中的URL是一个凤凰新闻的地址（例子：http://api.iclient.ifeng.com/ipadtestdoc?aid=99008381），返回的是一个json，其中包含这个新闻的所有信息。然后这个app就会按照这个json文件把新闻展示在页面上。整个过程完全没有验证URL或者是信息来源。可用于新闻伪造，中奖信息欺骗等。测试：建立两个网页URLA和URLB在URLA中使用js跳转到comifengnewsclient://call?type=doc&id=URLB。URLB中则返回一个虚假新闻的json，效果如图：\n\n地址：http://31.220.48.93:28214/if/fakenewsjm.html远程命令执行你可能已经注意到 返回这个（http://api.iclient.ifeng.com/ipadtestdoc?aid=99008381）包含新闻信息的json中，出现了html标签！这也就以为着这写信息非常有可能是展示在webview中的。首先的想法就是在json的title字段添加js语句，发现不能执行，百思不得其姐！后来突然想到既然能加载图片，那图片的事件呢？果断在之前的字段加上\n<img src='1' onerror=\\\"alert('Well done!');\\\">\n发现弹窗果然如期出现了！这样就好办了，配合之前的命令执行漏洞，直接用onerror执行window.location来跳转到执行页面就行了。测试：用安卓浏览器打开http://31.220.48.93:28214/if/ls_0.html就会跳转到凤凰新闻并执行命令远程执行列sd卡目录并显示：地址：http://31.220.48.93:28214/if/ls_0.html然后跳转到app加载http://31.220.48.93:28214/if/new.html的json这个json中包含下一步跳转的js，最后成功打开http://31.220.48.93:28214/if/ls_1.html并执行命令显示\n\n   漏洞证明：  如上   修复方案：  上调编译版本接口过滤   版权声明：转载请注明来源 小手冰凉@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-06-11 20:29 厂商回复： 非常感谢您对凤凰网信息安全的帮助，我们正在跟进解决。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-08 11:30 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:170        | 力不从心)\t\t \n  为何都那么给力    \n     2015-06-08 12:06 |    \t\tDrizzle.Risk \t\t\t( 普通白帽子  |\t\t\t        Rank:255 漏洞数:19        | You have an error in your SQL syntax; ch...)\t\t \n  这个不错啊..    \n     2015-06-08 12:12 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:17        | 当我又回首一切,这个世界会好吗?)\t\t \n  @Drizzle.Risk ：）    \n     2015-06-08 12:47 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:75        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  @xsser 大神 我怎么还有4rank没发 你帮我看看    \n     2015-06-09 16:03 |    \t\t上官元恒 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:3        | 屌丝程序员一枚，上能修电脑，下能装系统。)\t\t \n  @xsser 求审核 http://www.wooyun.org/bugs/wooyun-2010-0119063/trace/93a8b53c93b061ede582385a7ec7af0a    \n     2015-09-09 21:01 |    \t\t金枪银矛小霸王 \t\t\t( 普通白帽子  |\t\t\t        Rank:103 漏洞数:25        | 不会挖洞洞的猿猿不是好学生)\t\t \n  安卓的分给得好低啊    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}