{"id": 8208, "wybug_id": "wooyun-2013-034774", "wybug_title": "360安全卫士某处缺陷导致本地命令执行漏洞", "wybug_corp": "奇虎360", "wybug_author": "只抽红梅", "wybug_date": "2013-08-20 07:47", "wybug_open_date": "2013-11-18 07:48", "wybug_type": "远程代码执行", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计错误", "安全卫士", "本地命令执行"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-10-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-10-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-11-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-11-18：\t细节向公众公开  简要描述： 360安全卫士某处缺陷导致本地命令执行漏洞，最新版本上测试通过。 详细说明：  360安全卫士有个“360电脑专家”功能，可以聊天哦，来咱和智能机器人聊聊（我也不知道和真人聊天会是什么样的效果）。输入：<xxoo>在聊天窗口中直接显示 <xxoo>，看来不存在问题。查看下聊天记录，却发现我们刚输入的那句是空白，这又不是浏览器，又没办法查看源代码，不过直觉告诉我们没有过滤的。聊天记录么，肯定是保存在本地的，拿出 Filemon 试试能不能找到。设置过滤，包含 \"*360DiagnoseScan*;\"，再打开聊天记录，别说，还真找到了。在这里：C:\\Documents and Settings\\Administrator\\Application Data\\SosClient\\chat （我 xp 系统）按时间保存的 html 文件：chat_20130819xxxxxxxxx.html，打开找到了我们的代码：\n<font color=\"#0fb42d\">我   xx:oo</font><p><font color=\"#333333\"><xxoo></font></p></div><div><p></p><font color=\"#0032c8\">360电脑专家   xx:oo</font>\n看到没有过滤，既然是保存在本地的 html 中，权限么还是蛮大的，能不能执行命令呢，继续。聊天有限制，只允许 30 个字符，一个英文和一个中文竟然同等对待，太不科学了。不过难不倒我们，我们构造如下的代码，分 5 次输入进去：\n<script>/**/w=new ActiveXObject/**/(\"WScript.Shell\");/**/w.run(\"cmd.exe\");/**/</script>\n通过 /**/ 注释掉乱七八糟的东西，保持我们代码的完整性，由于每次聊天都要从服务端返回信息，有一个时间差，所以我们以一个极快的速度连续输入我们的代码，就像下图一样：\n\n来来来，赶紧点开聊天记录看看呢，多乖的窗口啊，就这么跳出来了。\n\n   漏洞证明：  \n\n   修复方案：  写入聊天内容到本地文件之前进行一次编码处理。   版权声明：转载请注明来源 只抽红梅@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2013-08-20 12:14 厂商回复： 感谢乌云白帽子的反馈。该问题是360电脑专家聊天窗口的一个本地存储型XSS，只影响本地用户自己，因此危害等级评估为低。我们会尽快修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-08-20 08:29 |    \t\t78基佬 \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:20        | 不会日站的设计师不是好产品经理)\t\t \n  吓尿了    \n     2013-08-20 08:29 |    \t\t78基佬 \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:20        | 不会日站的设计师不是好产品经理)\t\t \n  这个可以换1万块吧 在他们的cert那提交    \n     2013-08-20 09:46 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  @78基佬 估计有限制的。    \n     2013-08-20 11:01 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @78基佬 给cert提交好像不给钱的啊，为什么我的他们只给一个证？    \n     2013-08-20 11:52 |    \t\t心伤的胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:308 漏洞数:29        | 因为心伤，所以胖子。)\t\t \n  好屌的样子，目测 1 分？    \n     2013-08-20 17:41 |    \t\t78基佬 \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:20        | 不会日站的设计师不是好产品经理)\t\t \n  @wefgod 360的cert啊    \n     2013-08-21 14:50 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @78基佬 360的啊……    \n     2013-09-09 16:45 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  我去，那么给力的？存储型跨站可以这样执行cmd的？？？？？？明显是360的安全问题吧……    \n     2013-09-18 17:09 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  那这么到底算是命令执行还是XSS，一般XSS没有执行本地CMD的权限吧。。    \n     2013-09-18 17:09 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  那这么到底算是命令执行还是XSS，一般XSS没有执行本地CMD的权限吧。。    \n     2013-11-19 09:09 |    \t\t大和尚 \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:5        | www.ieroot.com 积极向上的心态！百折不挠...)\t\t \n  搜狗你可以把这挂到你的搜索页面上了.以及输入法上,以及你的好大个搜狐的主页上,以及你的卸载页面上.呵呵    \n     2013-11-20 04:42 |    \t\t兔子。 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 沉默是金。)\t\t \n  表示  不用垃圾 360    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}