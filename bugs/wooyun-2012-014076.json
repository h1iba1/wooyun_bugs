{"id": 16641, "wybug_id": "wooyun-2012-014076", "wybug_title": "dedeCMS 最新注入漏洞一枚", "wybug_corp": "DeDeCMS", "wybug_author": "cyg07", "wybug_date": "2012-10-30 19:56", "wybug_open_date": "2012-10-31 13:49", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "7", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "数字类型注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-10-30：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2012-10-31：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： hf由于对参数的变量未作初始化检测及使用了类反射的技巧导致 plus\\feedback.php 中变量 $typeid 存在注入风险。 详细说明：  \n由于官方已经发布补丁，而且漏洞未提供POC攻击代码，故此漏洞提前公开。补丁地址：http://bbs.dedecms.com/551651.html\n构造的方式我不提供了，但是你有心阅读下代码就会明白了。\n...if($comtype == 'comments')    {        $arctitle = addslashes($title);        if($msg!='')        {            $inquery = \"INSERT INTO `#@__feedback`(`aid`,`typeid`,`username`,`arctitle`,`ip`,`ischeck`,`dtime`, `mid`,`bad`,`good`,`ftype`,`face`,`msg`)                   VALUES ('$aid','$typeid','$username','$arctitle','$ip','$ischeck','$dtime', '{$cfg_ml->M_ID}','0','0','$feedbacktype','$face','$msg'); \";            $rs = $dsql->ExecuteNoneQuery($inquery);            if(!$rs)            {                ShowMsg(' 发表评论错误! ', '-1');                //echo $dsql->GetError();                exit();            }        }    }    //引用回复    elseif ($comtype == 'reply')    {        $row = $dsql->GetOne(\"SELECT * FROM `#@__feedback` WHERE id ='$fid'\");        $arctitle = $row['arctitle'];        $aid =$row['aid'];        $msg = $quotemsg.$msg;        $msg = HtmlReplace($msg, 2);        $inquery = \"INSERT INTO `#@__feedback`(`aid`,`typeid`,`username`,`arctitle`,`ip`,`ischeck`,`dtime`,`mid`,`bad`,`good`,`ftype`,`face`,`msg`)                VALUES ('$aid','$typeid','$username','$arctitle','$ip','$ischeck','$dtime','{$cfg_ml->M_ID}','0','0','$feedbacktype','$face','$msg')\";        $dsql->ExecuteNoneQuery($inquery);    }\n   漏洞证明：  下面我给出一张带了echo信息的问题结果演示。\n\n   修复方案：  今天突发想作作代码审计，dedecms中HTTP的输入上用类反射这个技巧第一次见（好吧，我承认我是第一次玩PHP代码审计）。建议考虑在反射上作得全面点，支持输入参数的类型和开发对应的过滤器作到更灵活更安全，这会给你们解决其中很多没反馈的问题。 gl   版权声明：转载请注明来源 cyg07@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：8 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2012-10-30 23:03 |    \t\tHenry:bobo \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:22        | 本胖吊！~又高又肥2个奶奶像地雷)\t\t \n  神奇的路人甲    \n     2012-10-31 09:50 |    \t\t撒旦 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 专注WEB安全，专注网络安全)\t\t \n  求忽略    \n     2012-10-31 11:08 |    \t\t苦逼老爷爷 \t\t\t( 普通白帽子  |\t\t\t        Rank:211 漏洞数:17        | 用户太懒什么都没留下)\t\t \n  @撒旦 哪需要忽略啊，那简要描述也太“简要”了，已经很明白了嘛。。    \n     2012-10-31 13:35 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  奇怪 不是全过滤了么 默认    \n     2012-10-31 14:59 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  ......我懂了    \n     2012-10-31 16:21 |    \t\t联众世界(乌云厂商)\t\t \n  CheckSql  表示很难绕过这个函数。    \n     2012-10-31 18:16 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  @联众世界  wooyun一哥帮助你！    \n     2012-10-31 18:22 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  http://zone.wooyun.org/content/108    \n     2012-10-31 18:28 |    \t\t半世倾尘 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 努力)\t\t \n  @联众世界 亮了    \n     2012-11-01 01:09 |    \t\t西毒 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:33        | 心存谦卑才能不断超越自我)\t\t \n  不是全过滤了么？怎么回事？    \n     2012-11-01 09:58 |    \t\t西毒 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:33        | 心存谦卑才能不断超越自我)\t\t \n  哥哥....我看上面没注入啊，到底是咋回事，求解答    \n     2012-11-01 12:32 |    \t\tjsbug \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:16        )\t\t \n  测试了好久.配合filter.inc.php的二次变量覆盖没有处理_RunMagicQuotes.magic_quotes_gpc=off下才能成功吧?    \n     2012-11-01 15:18 |    \t\t园长 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:14        | 你在身边就是缘，缘分写在数据库里面。)\t\t \n  @西毒 INSERT的时候typeid貌似没有验证，看补丁文件你就知道了。    \n     2012-11-01 22:16 |    \t\tWdot \t\t\t( 实习白帽子  |\t\t\t        Rank:77 漏洞数:12        | it came too later)\t\t \n  绕过了，其实挺简单，想复杂了。。。    \n     2012-11-04 02:49 |    \t\t鬼哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:136 漏洞数:13        | 鬼哥 ！！！！)\t\t \n  @联众世界 其实很好饶过的。    \n     2012-11-04 11:10 |    \t\t西毒 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:33        | 心存谦卑才能不断超越自我)\t\t \n  @园长 绕过倒是很简单，问题，他这个条件实在是太苛刻了    \n     2012-11-05 20:38 |    \t\tMatt  \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:107        | 承接代码审计 http://codescan.cn/)\t\t \n  构造的鸟么，内置的防注入Ids能过么。。。    \n     2012-11-06 16:55 |    \t\tWdot \t\t\t( 实习白帽子  |\t\t\t        Rank:77 漏洞数:12        | it came too later)\t\t \n  @Matt 很容易的，去看看 ` 这个符号    \n     2012-11-06 17:27 |    \t\tMatt  \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:107        | 承接代码审计 http://codescan.cn/)\t\t \n  @Wdot 那dede还有好几处注入呢,,    \n     2012-11-06 17:30 |    \t\tWdot \t\t\t( 实习白帽子  |\t\t\t        Rank:77 漏洞数:12        | it came too later)\t\t \n  @Matt 悲催的是，拿到密码也解出明文了，找不到后台～    \n     2012-11-06 17:47 |    \t\tMatt  \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:107        | 承接代码审计 http://codescan.cn/)\t\t \n  @Wdot 看错误日志    \n     2012-12-30 09:52 |    \t\t陈再胜 \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:13        | 微博收收听~~~●﹏●)\t\t \n  @Wdot dedecms有个报错爆出后台的方法    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 8, "Ranks": null}