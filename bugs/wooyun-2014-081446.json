{"id": 47323, "wybug_id": "wooyun-2014-081446", "wybug_title": "搜狗高速浏览器处理TLS证书不当可导致中间人攻击", "wybug_corp": "搜狗", "wybug_author": "MITM", "wybug_date": "2014-10-31 08:37", "wybug_open_date": "2015-01-29 08:38", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当", "客户端程序设计错误", "浏览器"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-29：\t细节向公众公开  简要描述： 搜狗高速浏览器处理SSL/TLS无效证书不当，可导致中间人攻击 详细说明：  当搜狗浏览器打开的https网页提供的SSL/TLS证书无效时（如自签名、域名不匹配），它会自动打开页面，且没有明显的文字提示。光在\"https\"上画个杠和锁上画个叉，我不知道有几个用户能注意到。\n\n我曾经尝试使用HTTPS缓存污染，但是没成功，每次打开搜狗浏览器页面都会重新加载，至今没想明白为什么。也尝试过用跨站引用来窃取cookie，也没成功。证书不正确的资源会自动屏蔽。但是以下两个利用是成功的（无需安装根证书、无需用户交互，部分思路来源于 http://fex.baidu.com/blog/2014/04/traffic-hijack-2/）：一是，如果用户使用网站的自动登录功能的话，cookie会在第一次访问时一并发送，所以自动加载页面可能导致cookie泄露。二是，如果没有自动登录，但是有自动填表功能。https被劫持的情况下，中间人可插入JavaScript读取并发送表单内容。以上这两点可以通过自动跳转来利用，可窃取任意HTTPS网站的cookie或密码（如果浏览器有记录的话）。非HTTPS网站的cookie和密码被窃取是很正常的，但是如果HTTPS网站也能被窃取cookie，那这就是浏览器的漏洞了。   漏洞证明：  Fiddler下的演示（再次强调，无需安装Fidder的根证书）：加入以下AutoResponder规则：\n\n打开搜狗浏览器，访问http://www.example.com/，然后看Fiddler的抓包结果，cookie尽收眼底：\n\n重定向的过程非常快，因为HTTP请求的回复是中间人发的，而不是服务器发的。所以这个过程用户很难察觉。而且全过程中浏览器连显示“红杠https”的机会都没有。用户看到的就是最后加载的百度首页。当然这仅仅是演示，实际攻击中可以使用更加灵活的规则，比如刚开始跳转任意网站到“认证”页，点击确认进入最初跳转点。也可以用meta refresh跳转，因为3xx重定向有最大跳转次数限制。自动填表的懒的弄了，我想应该可以拿到密码。   修复方案：  当SSL证书无效时，不要打开页面，除非用户点击继续。顺便说句与这个漏洞无关的，你们怎么对EV SSL一点表示也没有啊？\n\n   版权声明：转载请注明来源 MITM@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-10-31 11:34 厂商回复： 收到，感谢支持，欢迎到SGSRC提交漏洞！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-31 12:25 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  看不懂呀    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}