{"id": 23279, "wybug_id": "wooyun-2011-01376", "wybug_title": "盛大网站漏洞修复方案不完整导致可能代码执行", "wybug_corp": "盛大网络", "wybug_author": "BNE", "wybug_date": "2011-02-21 01:18", "wybug_open_date": "2011-03-23 06:00", "wybug_type": "命令执行", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["解析漏洞", "安全意识不足", "文件上传", "逻辑缺陷", "代码执行"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-02-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2011-02-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2011-03-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2011-03-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2011-03-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2011-03-23：\t细节向公众公开  简要描述： 盛大网站由于对漏洞理解有所偏差，没有按照实际情况进行漏洞修复，导致修复方案可以被绕过而失效。 详细说明：  之前盛大出过因为nginx+fastcgi-php造成的代码执行漏洞。后续盛大依照80sec的漏洞公告上的解决方案，对漏洞进行了简单修补:\nif ( $fastcgi_script_name ~ \\..*\\/.*php ) {\treturn 403;    }\n然而实际上，盛大的网站php fastcgi设置则不光是扩展名为php才能访问。我们随便一个sdo的网站做一下实验：\nhttp://forum.dev.sdo.com/robots.txt/s.http://forum.dev.sdo.com/robots.txt/s.phphttp://forum.dev.sdo.com/robots.txt/s.php5\n以上连接均返回：\nNo input file specified.\n而其余的链接则返回标准的http 404错误页面。这说明只要扩展名为空、php、php5，都会被nginx传入后端的fastcgi进行处理，因此返回的是php-fastcgi的输出结果。由此我们推测，盛大的php-fastcgi配置如下：\nlocation ~ .*\\.(php|php5)?$\t{            #fastcgi_pass  unix:/tmp/php-cgi.sock;      fastcgi_pass  127.0.0.1:9001;      fastcgi_index index.php;      include fcgi.conf;    }\n如果厂家没有选择关闭cgi.fix_pathinfo的方式进行修补，而只是机械照搬80sec提供的临时性解决方案针对了url中包含php的链接进行了屏蔽，就可以通过以上几种链接方式绕过修复方案重现漏洞。BTW:实际上这个问题不光是盛大出现，我估计网络上是有个教程之类的东东误导了大家，有很多人的php-fastcgi是配置成\"location ~ .*\\.(php|php5)?$\"形式的。   漏洞证明：  经过测试，果然发现盛大创新园的blog存在问题配置，可以利用：\nhttp://in.sdo.com/wp-content/plugins/tdo-mini-forms/tdomf-style-form.css/s.\n\n\n   修复方案：  使用cgi.fix_pathinfo=0的方式，一劳永逸。或者根据自己网站的php-fastcgi设置，定制一个url屏蔽列表。   版权声明：转载请注明来源 BNE@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2011-02-21 10:02 厂商回复： 多谢BNE提交漏洞信息！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2011-02-21 18:32 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  牛逼大了    \n     2011-12-09 09:29 |    \t\tsoftbug \t\t\t( 实习白帽子  |\t\t\t        Rank:66 漏洞数:10        | 为人类设计最好的软件，解放人的双手,一起...)\t\t \n  分析的不错，这才是牛人 BNE 顶！ 后面留言的 请依次保持队形！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}