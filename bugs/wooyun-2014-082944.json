{"id": 43369, "wybug_id": "wooyun-2014-082944", "wybug_title": "强智教务系统通用型文件上传（getshell）", "wybug_corp": "qzdatasoft.com", "wybug_author": "six-door", "wybug_date": "2014-11-16 20:48", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-21：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： 任意上传getshell 详细说明：  看见前人提交了一个 WooYun: 强智教务系统通杀Getshell(提权服务器内网渗透) ，我也来提交一下。。。1，任意文件上传漏洞文件 /jwgl/jxjh/JxjhXGBc.asp部分源码如下：\n<%OPTION EXPLICIT%><!--#include FILE=\"upfile_class.asp\"--><%server.ScriptTimeout =10000000dim upfile,formPath,ServerPath,FSPath,formName,FileName,oFileset upfile=new upfile_class ''建立上传对象upfile.GetData (10240000)   '取得上传数据,限制最大上传10M%><html><head><title>文件上传 - 长沙市强科技发展有限责任公司·版权所有</title><style type=\"text/css\"><!--.p9{ font-size: 9pt; font-family: 宋体 }--></style><meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"></head><body leftmargin=\"20\" topmargin=\"20\" class=\"p9\"><p class=\"tx1\"><font color=\"#0000FF\" size=\"1\"></font></p><hr size=1 noshadow width=300 align=left><%if upfile.err > 0 then  '如果出错    select case upfile.err\tcase 1\tResponse.Write \"你没有上传数据呀???是不是搞错了??\"\tcase 2\tResponse.Write \"你上传的文件超出我们的限制,最大10M\"\tend select\telse%><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" bordercolor=\"#000000\" class=\"p9\" style=\"border-collapse: collapse\">  <tr bgcolor=\"#CCCCCC\">     <td height=\"25\" valign='middle'>　本地文件　</td>    <td  valign='middle'>　大小(字节)　</td>    <td  valign='middle'>　上传到　</td>  </tr>  <%\tFSPath=GetFilePath(Server.mappath(\"upfile.asp\"),\"\\\")'取得当前文件在服务器路径\tServerPath=GetFilePath(Request.ServerVariables(\"HTTP_REFERER\"),\"/\")'取得在网站上的位置\tfor each formName in upfile.file '列出所有上传了的文件\t   set oFile=upfile.file(formname)\t   FileName=upfile.form(formName)'取得文本域的值\t   if not FileName>\"\" then  FileName=oFile.filename'如果没有输入新的文件名,就用原来的文件名\t   oFile.SaveToFile FSPath&FileName   ''保存文件\t %><tr>     <td  valign=\"middle\" align = \"left\" height=\"20\"><%=oFile.FilePath&oFile.FileName%></td>    <td  valign=\"middle\" align = \"center\"><%=oFile.filesize%></td>    <td  valign=\"middle\" align = \"center\"><A HREF=\"<%=serverpath&FileName%>\" title = \"<%=serverpath&FileName%>\"><%=FileName%></A></td>  </tr><%\t set oFile=nothing\tnext%>  <tr>     <td colspan=\"3\" height=\"25\" valign='middle'>　一共上传了<%=upfile.file.Count%>个文件</td>  </tr><%end ifset upfile=nothing  '删除此对象%></table><p></p></p>[<a href=\"javascript:history.back();\">返回</a>]</body></html><%function GetFilePath(FullPath,str)  If FullPath <> \"\" Then    GetFilePath = left(FullPath,InStrRev(FullPath, str))    Else    GetFilePath = \"\"  End IfEnd function%>\n可以看出该文件无任何访问验证，getshell可参考上述大牛构造的exp   漏洞证明：  1，任意文件上传，给出3例供CNCERT测试\n\n\n\n\n\n   修复方案：  增加上传页面验证，对上传文件做白名单过滤   版权声明：转载请注明来源 six-door@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-29 07:17 |    \t\twellsun \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | www.wellsun.com)\t\t \n  针对什么版本？    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}