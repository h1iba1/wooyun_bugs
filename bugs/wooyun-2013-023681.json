{"id": 10828, "wybug_id": "wooyun-2013-023681", "wybug_title": "Espcms V5.6.13.04.22 UTF8 正式版后台逻辑验证错误漏洞之2/N", "wybug_corp": "易思ESPCMS企业网站管理系统", "wybug_author": "Code_Sec", "wybug_date": "2013-05-14 08:35", "wybug_open_date": "2013-08-09 08:36", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-05-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-05-19：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-07-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-07-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-08-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-09：\t细节向公众公开  简要描述： 系统后台权限逻辑校验存在问题，导致后台某模块功能被绕过和非授权访问 详细说明：  后台管理员权限校验在文件\\public\\class_connector.php:\nfunction admin_purview() {\t\tif ($this->fun->accept('archive', 'R') == 'filemanage' && $this->fun->accept('action', 'R') == 'batupfilesave') {\t\t\t$ecisp_admininfo = $this->fun->accept('ecisp_admininfo', 'G');\t\t\t$esp_powerlist = $this->fun->accept('esp_powerlist', 'G');\t\t\t$gettype = false;\t\t} else {\t\t\t$ecisp_admininfo = $this->fun->accept('ecisp_admininfo', 'C');\t\t\t$esp_powerlist = $this->fun->accept('esp_powerlist', 'C');\t\t\t$gettype = true;\t\t}\t\t$arr_purview = explode('|', $this->fun->eccode($ecisp_admininfo, 'DECODE', db_pscode));\t\t$this->esp_powerlist = explode('|', $this->fun->eccode($esp_powerlist, 'DECODE', db_pscode));\t\tlist($this->esp_adminuserid, $this->esp_username, $this->esp_password, $this->esp_useragent, $this->esp_powerid, $this->esp_inputclassid, $this->esp_softurl) = $arr_purview;\t\tif ($gettype) {\t\t\tif (empty($this->esp_username) || empty($this->esp_adminuserid) || md5(admin_AGENT) != $this->esp_useragent || md5(admin_ClassURL) != $this->esp_softurl) {\t\t\t\t$condition = 0;\t\t\t} else {\t\t\t\t$condition = 1;\t\t\t}\t\t} else {\t\t\tif (empty($this->esp_username) || empty($this->esp_adminuserid) || md5(admin_ClassURL) != $this->esp_softurl) {\t\t\t\t$condition = 0;\t\t\t} else {\t\t\t\t$condition = 1;\t\t\t}\t\t}\t\tif ($condition == 0) {\t\t\tif ($this->fun->accept('archive', 'R') != 'adminuser' && $this->fun->accept('action', 'R') != 'login') {\t\t\t\theader('location: index.php?archive=adminuser&action=login');\t\t\t\texit();\t\t\t}\t\t} else {\t\t\tif ($condition == 1 && $this->fun->accept('point', 'R') == '' && $this->fun->accept('archive', 'R') == '' && $this->fun->accept('action', 'R') == '') {\t\t\t\theader('location: index.php?archive=management&action=tab&loadfun=mangercenter&out=tabcenter');\t\t\t\texit();\t\t\t}\t\t}\n逻辑校验存在问题:if ($condition == 0) {\t\t\tif ($this->fun->accept('archive', 'R') != 'adminuser' && $this->fun->accept('action', 'R') != 'login') {\t\t\t\theader('location: index.php?archive=adminuser&action=login');\t\t\t\texit();\t\t\t}当archive=adminuser,但是action变量不等于login时就不会被跳转到登录页。但是在文件adminsoft\\control\\adminuser.php中\nfunction onlogin() {\t\tparent::start_template();\t\tif ($this->fun->accept('logoutid', 'C') == 1) {\t\t\t$this->ectemplates->assign('systemTitle', $this->lng['adminuser_login_lout_error']);\t\t\t$this->fun->setcookie('logoutid', 0);\t\t} else {\t\t\t$this->ectemplates->assign('systemTitle', $this->lng['adminuser_login_login_error']);\t\t}\t\t$this->ectemplates->display('login');\t}\tfunction onlogin_into() {\t\tinclude_once admin_ROOT . '/public/class_seccode.php';\t\tlist($new_seccode, $expiration) = explode(\"\\t\", $this->fun->eccode($_COOKIE['ecisp_seccode'], 'DECODE'));\t\t$code = new seccode();\t\t$code->seccodeconvert($new_seccode);\t\tparent::start_template();\t\t$db_table = db_prefix . \"admin_member\";\t\t$linkURL = $_SERVER['HTTP_REFERER'];\n还可以调用该类的其他方法，如方法onlogin_into()   漏洞证明：  http://127.0.0.1/adminsoft/index.php?archive=adminuser&action=login_into也就是可以调用adminuser.php这个后台文件的其他功能。   修复方案：  改逻辑校验   版权声明：转载请注明来源 Code_Sec@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-08-09 08:36 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-05-14 08:53 |    \t\t专业种田  \t\t\t( 核心白帽子 |\t\t\t        Rank:1425 漏洞数:182        | 没有最专业的农民,只有更努力地耕耘..........)\t\t \n  又来高手    \n     2013-05-14 10:20 |    \t\t煦阳。 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:27        | 这个人很懒，什么都没留下。)\t\t \n  果然连载    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}