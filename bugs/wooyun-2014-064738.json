{"id": 54350, "wybug_id": "wooyun-2014-064738", "wybug_title": "tipask 盲打后台xss", "wybug_corp": "tipask问答系统", "wybug_author": "phith0n", "wybug_date": "2014-06-13 13:37", "wybug_open_date": "2014-09-11 13:38", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-13：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-09-11：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 直打后台的xss，不过这厂商似乎没注册呀，360有这边没有。。 详细说明：  注册会员时对用户名没有过滤。这是检查部分代码：\n$username = trim($this->post['username']);$password = trim($this->post['password']);$email = $this->post['email'];if ('' == $username || '' == $password) {    $this->message(\"用户名或密码不能为空!\", 'user/register');} else if (!preg_match(\"/^[a-z'0-9]+([._-][a-z'0-9]+)*@([a-z0-9]+([._-][a-z0-9]+))+$/\", $email)) {    $this->message(\"邮件地址不合法!\", 'user/register');} else if ($this->db->fetch_total('user', \" email='$email' \")) {    $this->message(\"此邮件地址已经注册!\", 'user/register');} else if (!$_ENV['user']->check_usernamecensor($username)) {    $this->message(\"邮件地址被禁止注册!\", 'user/register');}\npost和get都只经过了addslashes处理，没有htmlspecialchars。没有其他地方检查用户名。但数据库中用户名长度是14位，如果要一次构造一个xss还是比较难的。可以用拼接的方式来构造exp，原理我就不多说了。注册三个用户，第一个*/</script>，第二个*/alert(1)/*，第三个<script>/*，后台查看用户列表的时候触发。详见漏洞证明。   漏洞证明：  注册一个<img src=1>发现没有过滤：\n\n然后来拼接一个POC：注册三个用户，第一个*/</script>，第二个*/alert(1)/*，第三个<script>/*。注册完成后数据库可以看到，三个用户：\n\n后台查看用户的时候触发：\n\n如果要加载远程js的话得多注册几个了，不过因为tipask用了Jquery，所以加载起来也不难，我就不演示了。   修复方案：  htmlspecialchars   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}