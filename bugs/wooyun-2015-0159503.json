{"id": 78857, "wybug_id": "wooyun-2015-0159503", "wybug_title": "麦德龙奇葩设计导致全站用户相关信息泄露", "wybug_corp": "metromall.cn", "wybug_author": "userlxx", "wybug_date": "2015-12-09 12:22", "wybug_open_date": "2016-01-25 18:01", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "用户敏感信息泄露", "认证设计不合理", "平行权限"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-25：\t细节向公众公开  简要描述： 麦德龙，业界良心厂商。作为一个菜鸟挖的洞竟然送来了礼物，第一个礼物啊，感动的哭！于是又挖了挖以表感谢~~ 详细说明：  漏洞有两处，配合起来可以控制全站用户账号：（1） 正常情况下，后台根据请求的sessionID来查询用户信息；但是，如果sessionID不正确的时候，后台根据请求cookie中的CustomerID来查询信息。——这样可以遍历全站用户信息。（2） 用户账户修改自身密码时不验证旧密码，且根据第一个漏洞，sessionID不正确时使用CustomerID来重置账户密码。——重置全站账户密码，并登陆任意操作。1、正常情况下，后台根据请求的sessionID来查询用户信息：我的土豪账号。（查询个人信息为例 /account/accinfo.aspx）；\n\n2、修改CustomerID为27685（注册的另外一个账号），依然根据sessionID查询；\n\n3、但是。。但是。。把sessionID改错后，程序就根据CustomerID来查询个人信息。好机智的一个“容错”能力！！！真是佩服这设计。\n\n4、这样，就可以轻易的遍历用户信息、订单信息。。等等/account/accinfo.aspx ——查询“个人信息”\n\n/account/orderlist.aspx ——查询“订单信息”\n\n5、竟然有这么一个奇葩的漏洞，应该深入利用一下。立马想到重置账号密码，由此联想到登录后“修改密码”功能。\n\n6、输入“原密码”，此时发送一个ajax请求验证旧密码是否正确，可篡改返回值绕过。\n\n\n\n7、两次输入新密码，提交请求。首先，发送验证旧密码请求/account/modifypwd.aspx，使用上一步方法绕过检查。然后，发送重置密码的请求/account/modifypwd.aspx，携带旧密码和新密码。该死的是修改密码这个request不检查旧密码，直接重置密码。\n\n8、由此，结合“奇葩cookie利用”漏洞，即可重置任意账户的口令。以CustomerID=27026为例（订单遍历的时候看到她买过东西，所以就她了）首先，重置CustomerID=27026的密码。\n\n然后，查下27026的手机号（即登录用户名）是什么。\n\n好，现在我们有27026的账户/口令了，登录瞅瞅吧~\n\n9、用户账号都控制了，最基本是大量用户信息泄露。。另外，我可以为用户“到付”下单啦（我是雷锋）。。当然，我什么都没有做！    漏洞证明：  如上。   修复方案：  1、cookie这个使用也太奇葩了。。2、重置密码需要验证旧密码的，不能单独验证。这回可以给20RANK了，谢啦~或许可以再来一个礼物，我太贪得无厌了。。。   版权声明：转载请注明来源 userlxx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2015-12-14 09:24 厂商回复： 已确认 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}