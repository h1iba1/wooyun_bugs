{"id": 37215, "wybug_id": "wooyun-2015-0100199", "wybug_title": "ourphp没设计缺陷可浏览他人的站内信", "wybug_corp": "ourphp.net", "wybug_author": "浅蓝", "wybug_date": "2015-03-24 14:01", "wybug_open_date": "2015-06-22 14:06", "wybug_type": "非授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-22：\t细节向公众公开  简要描述： rt 详细说明：  ourphp.net官网共有三个帐号测试\nadmin@qq.comadmin@qq.cnadmin@qq.org\n用admin@qq.com给 admin@qq.cn发一个站内信 站内信的ID为1再用admin@qq.cn给admin@qq.org发一个站内信 站内信的ID为2接着登录admin@qq.com访问http://localhost/client/user/ourphp_mail.php?id=1\n\n再访问http://localhost/client/user/ourphp_mail.php?id=2\n\nadmin@qq.cn给admin@qq.org发的站内信我们也可以看。  看一下代码\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\" /><title></title></head><body><?php/* * Ourphp - CMS建站系统 * Copyright (C) 2014 ourphp.net * 开发者：哈尔滨伟成科技有限公司*/include '../../config/ourphp_code.php';include '../../config/ourphp_config.php';include '../../config/ourphp_version.php';include '../../config/ourphp_Language.php';include '../../function/ourphp_function.class.php';$id = intval($_GET['id']);session_start();if(!isset($_SESSION['username'])){\texit(\"no!\");}\t$sql=\"select OP_Usersend,OP_Usercollect,OP_Usercontent,time from `ourphp_usermessage` where id = \".$id;\t$query=mysql_query($sql);\t$ourphp_rs=mysql_fetch_array($query)?><table width=\"90%\" border=\"0\" cellpadding=\"10\" style=\"font-size:12px;\">  <tr>    <td width=\"150\"><div align=\"right\">发件人：</div></td>    <td>&nbsp;<?php if($ourphp_rs[0] == $_SESSION['username']){ echo '我';}else{ echo $ourphp_rs[0];} ?></td>  </tr>  <tr>    <td><div align=\"right\">收件人：</div></td>    <td>&nbsp;<?php echo $ourphp_rs[1]; ?></td>  </tr>  <tr>    <td valign=\"top\"><div align=\"right\">收件内容：</div></td>    <td>&nbsp;<?php echo $ourphp_rs[2]; ?></td>  </tr>  <tr>    <td><div align=\"right\">时间：</div></td>    <td>&nbsp;<?php echo $ourphp_rs[3]; ?></td>  </tr></table><?php\tmysql_free_result($query);?></body></html>\n没有进行任何限制 直接读数据   漏洞证明：  共有三个帐号测试\nadmin@qq.comadmin@qq.cnadmin@qq.org\n用admin@qq.com给 admin@qq.cn发一个站内信 站内信的ID为1再用admin@qq.cn给admin@qq.org发一个站内信 站内信的ID为2接着登录admin@qq.com访问http://localhost/client/user/ourphp_mail.php?id=1\n\n再访问http://localhost/client/user/ourphp_mail.php?id=2\n\nadmin@qq.cn给admin@qq.org发的站内信我们也可以看。  看一下代码client/user/ourphp_mail.php\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\" /><title></title></head><body><?php/* * Ourphp - CMS建站系统 * Copyright (C) 2014 ourphp.net * 开发者：哈尔滨伟成科技有限公司*/include '../../config/ourphp_code.php';include '../../config/ourphp_config.php';include '../../config/ourphp_version.php';include '../../config/ourphp_Language.php';include '../../function/ourphp_function.class.php';$id = intval($_GET['id']);session_start();if(!isset($_SESSION['username'])){\texit(\"no!\");}\t$sql=\"select OP_Usersend,OP_Usercollect,OP_Usercontent,time from `ourphp_usermessage` where id = \".$id;\t$query=mysql_query($sql);\t$ourphp_rs=mysql_fetch_array($query)?><table width=\"90%\" border=\"0\" cellpadding=\"10\" style=\"font-size:12px;\">  <tr>    <td width=\"150\"><div align=\"right\">发件人：</div></td>    <td>&nbsp;<?php if($ourphp_rs[0] == $_SESSION['username']){ echo '我';}else{ echo $ourphp_rs[0];} ?></td>  </tr>  <tr>    <td><div align=\"right\">收件人：</div></td>    <td>&nbsp;<?php echo $ourphp_rs[1]; ?></td>  </tr>  <tr>    <td valign=\"top\"><div align=\"right\">收件内容：</div></td>    <td>&nbsp;<?php echo $ourphp_rs[2]; ?></td>  </tr>  <tr>    <td><div align=\"right\">时间：</div></td>    <td>&nbsp;<?php echo $ourphp_rs[3]; ?></td>  </tr></table><?php\tmysql_free_result($query);?></body></html>\n没有进行任何限制 直接读数据   修复方案：  给client/user/ourphp_mail.php中输出数据的地方加上以下代码\nif($_SESSION['username']==$ourphp_rs[0]||$_SESSION['username']==$ourphp_rs[1]){输出数据库内容那部分代码}else{echo '非法访问';}\n意思是 如果用户名与发件人相同 或者 用户名与收件人相同即可浏览站内信否则输出\"非法访问\"   版权声明：转载请注明来源 浅蓝@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-03-24 14:05 厂商回复： 我们会在V1.2.0版本中修复这个问题。谢谢您的帮助。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}