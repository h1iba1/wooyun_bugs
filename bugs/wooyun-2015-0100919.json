{"id": 29702, "wybug_id": "wooyun-2015-0100919", "wybug_title": "多市公共安全系统Getshell漏洞续（通用）", "wybug_corp": "公安部一所", "wybug_author": "pandas", "wybug_date": "2015-03-12 14:46", "wybug_open_date": "2015-06-14 11:42", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(公安部一所)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-14：\t细节向公众公开  简要描述： 该漏洞利用方式简单粗暴，轻松getshell。 详细说明：  案例详见该漏洞： WooYun: 多市公共安全系统Getshell漏洞（通用） 漏洞文件：edittheme.php\ninclude( \"../common.php\" );//这个文件的功能：伪全局变量定义以及特殊字符过滤empty($siteid) && die('error');$v=$block_s;if ($op=='update'){\t$blockfid=trim($blockfid);\t$string=$atc_content;    $source=$string;\t$insert_id=0;\t...\t$source=stripslashes($string);\tif (!file_exists(SITE_CACHE.'/themes')){\t\t@Mkdirs(SITE_CACHE.'/themes');\t}\t$r_url=ROOT_URL.'/';\t//便于模板的移植性\t$source=str_replace($r_url,'',$source);\t$content=str_replace($r_url,'',$content);\tif ($blockfid=='oho_loginh'){\t\twritefile(SITE_CACHE.'/themes/'.$blockid.'h_s.php',$source);\t\twritefile(SITE_CACHE.'/themes/'.$blockid.'h.php',$content);\t}else{\t\twritefile(SITE_CACHE.'/themes/'.$blockid.$s2.'_s.php',$source);//漏洞产生1\t\twritefile(SITE_CACHE.'/themes/'.$blockid.$s2.'.php',$content); //漏洞产生2\t}\nwritefile函数就是重写了file_put_contents可以直接写一个php文件，内容可控未过滤。   漏洞证明：  写入phpinfo以作证明，具体利用代码请查看代码测试区。\n\n\n\nshell测试图，未深入内网及数据，已删除。\n\n   修复方案：  .   版权声明：转载请注明来源 pandas@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：10  确认时间：2015-03-16 11:40 厂商回复： 已验证确认所描述的问题。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-12 15:43 |    \t\t番茄炒蛋 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:31        | test)\t\t \n  流弊    \n     2015-03-12 15:47 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  @番茄炒蛋 番茄师傅    \n     2015-03-12 16:02 |    \t\t番茄炒蛋 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:31        | test)\t\t \n  @袋鼠妈妈 不是一个人    \n     2015-03-16 12:09 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  文件名像了点，利用方式都是不一样的，被说成是重复我也是醉了，早知道不发这个续集了@Finger     \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 10, "Ranks": null}