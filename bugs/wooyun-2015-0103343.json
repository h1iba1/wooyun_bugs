{"id": 26558, "wybug_id": "wooyun-2015-0103343", "wybug_title": "EduSoho SQL注入漏洞通杀众多版本", "wybug_corp": "edusoho.com", "wybug_author": "Comer", "wybug_date": "2015-03-24 16:32", "wybug_open_date": "2015-06-22 17:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-22：\t细节向公众公开  简要描述： 版本4以上通杀吧~ 详细说明：  down了源码，定位之src/Topxia/WebBundle/Controller/SearchController.php  36行的categoryIds参数存在注入\n<?phpnamespace Topxia\\WebBundle\\Controller;use Symfony\\Component\\HttpFoundation\\Request;use Topxia\\Common\\Paginator;use Topxia\\Common\\ArrayToolkit;class SearchController extends BaseController{    public function indexAction(Request $request)    {        $courses = $paginator = null;        $code = 'Vip';        $currentUser = $this->getCurrentUser();        $keywords = $request->query->get('q');        $keywords=trim($keywords);                $vip = $this->getAppService()->findInstallApp($code);        $isShowVipSearch = $vip && version_compare($vip['version'], \"1.0.7\", \">=\");                $currentUserVipLevel = \"\";        $vipLevelIds = \"\";        if($isShowVipSearch){            $currentUserVip = $this->getVipService()->getMemberByUserId($currentUser['id']);            $currentUserVipLevel = $this->getLevelService()->getLevel($currentUserVip['levelId']);            $vipLevels = $this->getLevelService()->findAllLevelsLessThanSeq($currentUserVipLevel['seq']);            $vipLevelIds = ArrayToolkit::column($vipLevels, \"id\");        }        $parentId = 0;        $categories = $this->getCategoryService()->findAllCategoriesByParentId($parentId);                $categoryIds=array();        for($i=0;$i<count($categories);$i++){            $id = $categories[$i]['id'];            $name = $categories[$i]['name'];            $categoryIds[$id] = $name;        }        $categoryId = $request->query->get('categoryIds');        $coursesTypeChoices = $request->query->get('coursesTypeChoices');               if (!$keywords) {            goto response;        }        if($coursesTypeChoices == 'vipCourses'){            $conditions = array(                'status' => 'published',                'title' => $keywords,                'categoryId' => $categoryId,                'vipLevelIds' =>  $vipLevelIds            );        }elseif($coursesTypeChoices == 'liveCourses'){            $conditions = array(                'status' => 'published',                'title' => $keywords,                'categoryId' => $categoryId,                'type' => 'live'            );        }else{            $conditions = array(                'status' => 'published',                'title' => $keywords,                'categoryId' => $categoryId            );        }        $paginator = new Paginator(            $this->get('request'),            $this->getCourseService()->searchCourseCount($conditions)            , 10        );        $courses = $this->getCourseService()->searchCourses(            $conditions,            'latest',            $paginator->getOffsetCount(),            $paginator->getPerPageCount()        );        response:        return $this->render('TopxiaWebBundle:Search:index.html.twig', array(            'courses' => $courses,            'paginator' => $paginator,            'keywords' => $keywords,            'isShowVipSearch' => $isShowVipSearch,            'currentUserVipLevel' => $currentUserVipLevel,            'categoryIds' => $categoryIds,            'coursesTypeChoices' => $coursesTypeChoices        ));    }...\n本来打算回溯到具体的SQL查询，但发现是用了Symfony框架加上code审计能力有限....AdminBundle貌似后台也在调\n\n   漏洞证明：  localhost\n\n官网demo.edusoho.com\nweb server operating system: Linux Ubuntuweb application technology: Nginx, PHP 5.5.9back-end DBMS: MySQL >= 5.0.0database management system users [1]:[*] 'demoedusohouser'@'localhost'available databases [2]:[*] `demo.edusoho.com`[*] information_schema\n官网说是不少厂商在用，度娘谷大哥收录情况\n\n\n\n测了4~5均存在该注入包括最新的5.1.4，低版本的试了1-2好像没这个函数的相关功能，3的就不知了夜深了就酱~   修复方案：  注入这个必须懂...   版权声明：转载请注明来源 Comer@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-03-24 17:17 厂商回复： 感谢@Comer 最新状态： 2015-03-25：已修复  ", "replys": "漏洞评价：\n评论\n     2015-03-27 21:38 |    \t\tlupin \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:48        | 尊重自己的爱好 远离利益的罪恶)\t\t \n  这个漏洞该有奖金    \n     2015-03-29 17:53 |    \t\t90Snake \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:42        | 最大的漏洞就是人)\t\t \n  @lupin 2刀或者3刀    \n     2015-03-30 09:46 |    \t\tComer \t\t\t( 普通白帽子  |\t\t\t        Rank:336 漏洞数:40        | 关注安全 | 关注智能漏洞挖掘)\t\t \n  @lupin @90Snake  我提的洞少，尼们别吓我~    \n     2015-03-30 10:02 |    \t\tXser \t\t\t( 普通白帽子  |\t\t\t        Rank:194 漏洞数:61        | JDSec)\t\t \n  @comer 听说挖到注入送肾六    \n     2015-03-30 17:19 |    \t\t90Snake \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:42        | 最大的漏洞就是人)\t\t \n  @Comer ...看错洞了 这个我也不知道了 我以为是商派的    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}