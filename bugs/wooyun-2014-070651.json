{"id": 52622, "wybug_id": "wooyun-2014-070651", "wybug_title": "Maccms asp版本后台XSS盲打", "wybug_corp": "maccms.com", "wybug_author": "story", "wybug_date": "2014-08-04 12:29", "wybug_open_date": "2014-11-02 12:30", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["盲打"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-08：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-02：\t细节向公众公开  简要描述： Maccms ASP版本后台盲打。 详细说明：  /inc/ajax.asp 255行reporterr函数\nsub reporterr()\tdim g_vid,g_name,g_content,g_audit,g_ip,g_time\tg_vid = be(\"post\",\"g_vid\") : g_vid = chkSql(g_vid, True)\tg_name = be(\"post\",\"g_name\") : g_name = chkSql(g_name, True)\tg_content = be(\"post\",\"g_content\") : g_content = chkSql(g_content, True)\tif not isNum(g_vid) then alert \"请填写正确参数\" : exit sub\tif len(g_name) > 64 then g_name = left(g_name,64)\tif len(g_content) > 255 then g_content = left(g_content,255)\tif app_gbookaudit=1 then g_audit=0 else g_audit=1\tg_ip = getIP()    g_time = Now()    If getTimeSpan(\"lastreportErrTime\") < app_gbooktime Then alert \"请稍后再试\": Exit Sub    \tobjdb.add \"{pre}gbook\", Array(\"g_vid\",\"g_audit\",\"g_name\", \"g_ip\", \"g_time\", \"g_content\"), Array(g_vid, g_audit, g_name, g_ip, g_time, g_content)\tSession(\"lastreportErrTime\") = Now\twriteA \"报错成功,多谢支持!<script>setTimeout(\"\"window.close()\"\",1000)</script>\"end sub\n获取了用户提交的留言信息。其中调用getIP()获得IP地址，看看\nfunction getIP()\tdim x, y\tx = Request.ServerVariables(\"HTTP_X_FORWARDED_FOR\")\ty = Request.ServerVariables(\"REMOTE_ADDR\")\tif(isN(x) or lCase(x)=\"unknown\") then getIP=y else getIP=x\tif instr(getIP,\".\")=0 then getIP = \"0.0.0.0\"end function\n从HTTP_X_FORWARDED_FOR获得IP，并且没有过滤。不过注入是不行了，可以XSS盲打。数据库路IP字长是32字符，基本满足最短盲打要求，而且可以拼接。我就不多提了，只演示一下弹窗。   漏洞证明：  提交的时候改包：\n\n后台查看留言的时候弹窗：\n\n   修复方案：  过滤   版权声明：转载请注明来源 story@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-08-05 14:11 厂商回复： 漏洞已经确认，稍后修复加强xss过滤。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}