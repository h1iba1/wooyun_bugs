{"id": 47245, "wybug_id": "wooyun-2015-090522", "wybug_title": "连环撞库可导致同程内网继续沦陷", "wybug_corp": "苏州同程旅游网络科技有限公司", "wybug_author": "if、so", "wybug_date": "2015-01-07 17:46", "wybug_open_date": "2015-01-31 16:01", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-31：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 漫游同程一周年纪念日，再次检测下同程安全。鄙视有杀器的人民币玩家，撞库-脱裤-撞库是何等痛苦。 详细说明：  新年了，没事再看我以前提交的漏洞 WooYun: 利用某些漏洞可以重置同程网任意用户密码 ，看到了自己第一个闪电的漏洞厂商同程网，于是继续来检测下她的安全。把外部网站大概看了一下，没有什么漏洞，咱是穷人，不像人民币玩家找洞那么轻松。搞了半天，没有头绪，忽然在我的QQ邮箱里面翻到了以前发给同程技术的一个数据库，这个库是他们内网的hr库。有了这个库，脑洞大开，想到了一个思路：撞库-getshell or注入-继续撞库来说明下：因为手上的老库都是内部信息，所以唯一能撞库的只有他们的内部论坛inbbs.17u.com假如成功就可以尝试上次的方法getshell，如果不能getshell，尝试注入，因为dvbbs8.0 asp存在一个注入，2007年出的，回想当年，是asp的天下。如果能注入，继续撞库，看能否进入公司邮箱，进入邮箱也就代表了可以拨入vpn进入内网。来到他们的内部论坛\n\n先尝试正常注册，提示只有内网用户 才能注册\n\nasp代码检测来源ip可以用伪造ip来bypass\n\n\n\n如图，轻松bypass。可是他么的发现还要审核！！没办法，只能撞库了。由于时间好久，忘记了论坛用户名的规则，那怎么样才能知道用户名的规则了?这个时候只能靠rss这个神奇的东西了\n\n发现用户名是姓名加工号，于是开始撞库，折腾了三小时搞出了一个账号江伟伟0328 jww0924!@#进入论坛发现以前getshell的漏洞已经被补了，只能靠注入了dvbbs 8.0 注入 exp 参数topicid\nPOST /inbbs/Appraise.asp?action=save HTTP/1.1Origin: http://inbbs.17u.com:8080Content-Length: 740Accept-Language: zh-CN,zh;q=0.8Accept-Encoding: gzip,deflateHost: inbbs.17u.com:8080Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36Connection: closeReferer: http://inbbs.17u.com:8080/inbbs/dispbbs.asp?BoardID=1179&ID=33455&replyID=&skin=1Cache-Control: max-age=0Cookie: DvForum=UserID=28&usercookies=0&userclass=%B9%DC%C0%ED%D4%B1&username=%F6%C4%EF%C7&password=3O263U7hgb314ixb&userhidden=2&StatUserID=22126511262; boardid=1179&topicid=sqlinj here&announceid=3585149&atype=0&a1=0&a2=0&atitle=sa&acodestr=8342&acontent=asd\n成功注入后获取了管理员账号，进入后台\n\n发现fso组件已经被kill了，无法shell，没办法，只能狠一点，把所有的用户账号拖了出来。然后便开始数据整理，1800多条数据，要整理成固定格式，还要把cmd5批量破解出来的密码附加上，此处省略一万字。。。整完之后便开始对邮件系统mail.17u.com开始撞库费了那么大力气，老天还是眷恋了我一把，长度为477的结果就是正确的账号密码\n\n\n\n\n\n最后成功获取了十几个邮箱账号随便登陆一个试试\n\n模糊的记得同程使用的是pptvpn 。可是ip地址忘了，怎么办?找了半天没找到，后来发现不是有内部论坛嘛，去翻了一下，果然看到了\n\n\n\n就不深入了，晚上整理数据搞了几小时，浑身冻僵，实在没力气了   漏洞证明：  \n\n\n\n\n\n\n\n   修复方案：  。。   版权声明：转载请注明来源 if、so@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-01-07 18:58 厂商回复： 感谢关注同程旅游，下午去机房上设备，回来一看又出事了...不过你拿到密码也进不了内网的，VPN是绑定硬件的，且只能绑定一次。这个论坛跑了好久了，内部新开发的论坛还没上线，先临时关闭外网访问吧。弱密码每天都有跑，好吧，又要加字典了。OWA因为没有验证码，这个问题也提过，在阿里云上反代试了一下但是没用，唉，不多说了... 最新状态： 2015-01-31：公开下  ", "replys": "漏洞评价：\n评论\n     2015-01-07 17:47 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  1000块的购物卡    \n     2015-01-07 17:49 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:91        | 梦想还是要有的，万一实现了呢？)\t\t \n  @猪猪侠 哈哈    \n     2015-01-07 17:54 |    \t\t蜉蝣 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:24        )\t\t \n  要是发个ipad，得有多疯狂 @苏州同程旅游网络科技有限公司    \n     2015-01-07 17:54 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  撞撞撞    \n     2015-01-07 18:20 |    \t\t%230CC \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 溜溜)\t\t \n  你忘了撞12306的人了吗？    \n     2015-01-07 20:28 |    \t\tlijiejie  \t\t\t( 核心白帽子 |\t\t\t        Rank:2210 漏洞数:294        | Just for fun.)\t\t \n  @苏州同程旅游网络科技有限公司  唉，说多了都是泪啊。。。    \n     2015-01-07 20:50 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @lijiejie 李姐姐你貌似升核心啦 恭喜啊    \n     2015-01-07 20:53 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @猪猪侠 上次杀器王子的那个我实际上申请了800，然后自己垫了200，因为感觉自己也有责任。这个实际没能进内网，我看看吧，能争取多少就多少，然后自己再加点儿。    \n     2015-01-07 20:55 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:91        | 梦想还是要有的，万一实现了呢？)\t\t \n  @苏州同程旅游网络科技有限公司 。。。兄弟，别。。    \n     2015-01-07 22:28 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  @if、so @苏州同程旅游网络科技有限公司 厂商真是厚道呀  赞    \n     2015-01-08 03:30 |    \t\t写个七 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 一点一点积累。)\t\t \n  @苏州同程旅游网络科技有限公司  wooyun好厂商（维运） 赞    \n     2015-01-08 04:58 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @写个七 不是运维，在同程安全组从属架构部，向CTO汇报的。高层重视安全，无奈安全本来就难招，又在苏州这地界。所以现在实际只有我一个人。    \n     2015-01-08 06:46 |    \t\t蜉蝣 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:24        )\t\t \n  这大半夜还在加班，@苏州同程旅游网络科技有限公司 给你点120个赞    \n     2015-01-08 09:42 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  @苏州同程旅游网络科技有限公司 伙计熬夜要注意保养身体呀    \n     2015-01-08 09:48 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @f4ckbaidu 哈，哥 这是你小号吧    \n     2015-01-09 09:04 |    \t\t哈兹本德 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:2        | 哎呀，菜鸟一枚。)\t\t \n  @苏州同程旅游网络科技有限公司 我在武汉，我们公司据说招了一年才招到小菜我，，我们也是搞旅游的，不过跟你们的业务有点点区别。    \n     2015-01-14 13:42 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:91        | 梦想还是要有的，万一实现了呢？)\t\t \n  @苏州同程旅游网络科技有限公司  收到了，谢谢    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}