{"id": 58485, "wybug_id": "wooyun-2014-051068", "wybug_title": "Thinksaas v2.1 2枚注入。", "wybug_corp": "thinksaas.cn", "wybug_author": "′雨。", "wybug_date": "2014-02-19 14:00", "wybug_open_date": "2014-05-20 14:01", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-20：\t细节向公众公开  简要描述： 依旧过滤不严。 详细说明：  这次写两个把。。  - - 这两个同一文件的 哈哈。依旧是越权。\\app\\group\\action\\admin\\group.php无需管理  只需要一个前台注册账户就能访问。真正的管理后台在\\app\\system\\action\\但是为毛这admin目录下的文件都能做很多事?\n\n注入第一枚。\ncase \"add_do\":\t\t$userid = intval($_POST['userid']);\t\t$strUser = $db->once_fetch_assoc(\"select * from \".dbprefix.\"user_info where userid='$userid'\");\t\t$arrData = array(\t\t\t'userid' => $userid,\t\t\t'groupname'\t=> t($_POST['groupname']),\t\t\t'groupdesc'\t=> tsClean($_POST['groupdesc']),\t\t\t'isrecommend'\t=> intval($_POST['isrecommend']),\t\t\t'addtime'\t=> time(),\t\t\t'ispost'\t=> intval($_POST['ispost']),\t\t);\t\t$groupid = $db->insertArr($arrData,dbprefix.'group');\t\t//更新group_user索引关系\t\t$groupUserNum = $db->once_num_rows(\"select * from \".dbprefix.\"group_user where userid='$userid' and groupid='$groupid'\");\n'groupdesc'\t=> tsClean($_POST['groupdesc']),tsclean 就是又调用了 cleanJs函数\nfunction cleanJs($text) {\t$text = trim ( $text );\t$text = stripslashes ( $text );\t// 完全过滤注释\t$text = preg_replace ( '/<!--?.*-->/', '', $text );\t// 完全过滤动态代码\t$text = preg_replace ( '/<\\?|\\?>/', '', $text );\t// 完全过滤js\t$text = preg_replace ( '/<script?.*\\/script>/', '', $text );\t// 过滤多余html\t$text = preg_replace ( '/<\\/?(html|head|meta|link|base|body|title|style|script|form|iframe|frame|frameset)[^><]*>/i', '', $text );\t// 过滤on事件lang js\twhile ( preg_match ( '/(<[^><]+)(lang|data|onfinish|onmouse|onexit|onerror|onclick|onkey|onload|onchange|onfocus|onblur)[^><]+/i', $text, $mat ) ) {\t\t$text = str_replace ( $mat [0], $mat [1], $text );\t}\twhile ( preg_match ( '/(<[^><]+)(window\\.|javascript:|js:|about:|file:|document\\.|vbs:|cookie)([^><]*)/i', $text, $mat ) ) {\t\t$text = str_replace ( $mat [0], $mat [1] . $mat [3], $text );\t}\treturn $text;}\ncleanJs cleanJs 只过滤js。\n\n看看所执行的语句 \n\n都懂的。____________________________________________________________________注入第二发\ncase \"edit_do\":\t\t$groupid = intval($_POST['groupid']);\t\t\t\t$new['group']->update('group',array(\t\t\t'groupid'=>$groupid,\t\t),array(\t\t\t'groupname'\t\t=> t($_POST['groupname']),\t\t\t'groupdesc'\t\t=> tsClean($_POST['groupdesc']),\t\t\t'userid'\t\t\t=> intval($_POST['userid']),\t\t\t'ispost'\t=> intval($_POST['ispost']),\t\t));\t\t\t\tqiMsg(\"小组信息修改成功！\");\t\tbreak;\ntsclean 我就不再贴了嘛； 上面都有。 Update row未过滤。   漏洞证明：  \n\n然后再访问http://127.0.0.1/thinksaas/index.php?app=group&ac=admin/group&ts=list\n\n话说我的@咋不见了。   修复方案：  过滤   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-02-20 09:54 厂商回复： 感谢反馈。bug已经修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}