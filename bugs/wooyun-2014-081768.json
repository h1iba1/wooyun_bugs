{"id": 43754, "wybug_id": "wooyun-2014-081768", "wybug_title": "易酷CMS可以任意修改他人密码密保漏洞", "wybug_corp": "ekucms.com", "wybug_author": "nextdoor", "wybug_date": "2014-11-05 12:19", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-10：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： 易酷CMS可以任意修改他人密码密保漏洞 详细说明：  版本2.5简单的说就是个人会员修改自己的密码和密保等问题时越权而造成可以修改其他的密码密保问题我们先分析一下代码viem/user/edit.html\n</div>//从这里提交参数，提交到user/update<div class=\"user\">    <h3>修改资料</h3>     <ul style=\"line-height:30px\"><form action=\"index.php?s=User/Update\" method=\"post\" id=\"gxform\"><input name=\"id\" type=\"hidden\" value=\"{$id}\" />    <li>用户帐号：{$username}</li>    <li>用户积分：{$money}</li>    <li>联系 QQ：<input name=\"qq\" type=\"text\" value=\"{$qq}\" maxlength=\"12\"></li>    <li>原始密码：<input name=\"olduserpwd\" type=\"password\" /></li> \t<li>修改密码：<input name=\"userpwd\" type=\"password\" /> 不修改请留空</li>       <li>确认密码：<input name=\"reuserpwd\" type=\"password\" /> 不修改请留空</li>    <li>密保问题：<input name=\"question\" type=\"text\" value=\"{$question|htmlspecialchars}\" maxlength=\"20\"/></li>    <li>密保答案：<input name=\"answer\" type=\"text\" value=\"{$answer|htmlspecialchars}\" maxlength=\"20\"/></li>    <li style=\"padding-top:10px\"><input class=\"bginput\" name=\"submit\" type=\"submit\" value=\"更 新\" /> <input class=\"bginput\" name=\"reset\" type=\"reset\" value=\"重 填\" /></li>\n跟踪user/updatecore\\lib\\action\\home\\UserAction.class.php\npublic function update(){\t\t$rs = D(\"Home.User\");\t\tif ($rs->create()) {\t\t\tif (false !== $rs->save()) {\t\t\t\t$this->assign(\"jumpUrl\",'index.php?s=User/Login');\t\t\t\t$this->success('用户信息更新成功,请重新登录！');\t\t\t}else{\t\t\t\t$this->error(\"用户信息更新失败!\");\t\t\t}\t\t}else{\t\t\t$this->error($rs->getError());\t\t}\t}跟踪create()函数 //这个函数在框架中也没有做很好的防御  public function create($data='',$type='') {        // 如果没有传值默认取POST数据        if(empty($data)) {            $data    =   $_POST;        }elseif(is_object($data)){            $data   =   get_object_vars($data);        }elseif(!is_array($data)){            $this->error = L('_DATA_TYPE_INVALID_');            return false;        }        // 状态        $type = $type?$type:(!empty($data[$this->getPk()])?self::MODEL_UPDATE:self::MODEL_INSERT);        // 表单令牌验证        if(C('TOKEN_ON') && !$this->autoCheckToken($data)) {            $this->error = L('_TOKEN_ERROR_');            return false;        }        // 数据自动验证        if(!$this->autoValidation($data,$type)) return false;        // 检查字段映射        if(!empty($this->_map)) {            foreach ($this->_map as $key=>$val){                if(isset($data[$key])) {                    $data[$val] =   $data[$key];                    unset($data[$key]);                }            }        }        // 验证完成生成数据对象        $vo   =  array();        foreach ($this->fields as $key=>$name){            if(substr($key,0,1)=='_') continue;            $val = isset($data[$name])?$data[$name]:null;            //保证赋值有效            if(!is_null($val)){                $vo[$name] = (MAGIC_QUOTES_GPC && is_string($val))?   stripslashes($val)  :  $val;            }        }        // 创建完成对数据进行自动处理        $this->autoOperation($vo,$type);        // 赋值当前数据对象        $this->data =   $vo;        // 返回创建的数据以供其他调用        return $vo;     }\n   漏洞证明：  登陆链接http://127.0.0.1:8088/ekucms/index.php?s=User/Login在用户登陆编辑处http://127.0.0.1:8088/ekucms/index.php?s=User/Edit我们注册一个test账号，旧密码不用填写也可以\n\n更改id参数，可以写一个脚本，只需修改id参数密码和密保都一样，那么拿下任意用户都可以了\n\nid为3的密码和密保都修改了\n\n   修复方案：  至少修改用户的重要信息时，原密码应该验证一下吧，验证一下是否是本人吧   版权声明：转载请注明来源 nextdoor@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}