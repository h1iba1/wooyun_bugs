{"id": 41448, "wybug_id": "wooyun-2014-088782", "wybug_title": "西安某网站建设公司官网任意文件上传致getshell", "wybug_corp": "西安某网站建设公司", "wybug_author": "zhxs", "wybug_date": "2014-12-29 10:34", "wybug_open_date": "2015-02-12 10:36", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传内容未检查", "文件上传漏洞", "文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-29：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-02-12：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 这网站做的网站还不少  网站经过安全联盟认证带绿标的，自己网站的安全都不要了 真想把首页给他改了  可俺不是那种人啊！~ 详细说明：  俺悄悄的告诉你们哈 好吧 其实俺是想找这公司建的网站的通用0day  不过一不小心手抖了 就把官网shell了！开始：在那夜黑风高的夜晚俺无聊啊经过一番查找、找到目标：http://www.liyouit.com/ 看了看我擦 网站好多，结果尼玛后台都不不到一个  无奈开始对官网下手就在这时看到有个留言板、http://www.liyouit.com/feedbook.php 嘿嘿 这可是好消息 准备插入点xss、在下面看到 居然有个上传附件的地方\n\n我擦 手抖随便一点居然上传成功了！嘿嘿 果断打开连接看看 \n\n找到菜刀 果断连接\n\nshell 到手！   漏洞证明：  \n\n\n\n看看代码feedbook.php\n<tr>                              <td width=\"45%\"><input name=\"fujian\" type=\"text\" id=\"fujian\" size=\"35\" maxlength=\"100\"></td>                              <td width=\"55%\"><iframe name='mainFrame1' frameborder=0 height=23 scrolling=no src='../scwj_client.php?fn=fujian' width=300></iframe></td>                            </tr>\n这里：../scwj_client.php?fn=fujian然后再看：scwj_client.phphttp://www.liyouit.com//scwj_client.php直接访问上传文件\n\n再看看代码\n<?php$fn=trim(htmlspecialchars($_GET['fn']));$fn=!empty($fn) ? $fn : '' ;if (!empty($_FILES['postfile']['tmp_name'])){    $picName = time() . rand(1000, 9999) . strrchr($_FILES['postfile']['name'], '.');\t$file_size = $_FILES['postfile']['size'];    $uploadDir = \"ClientUploadFiles/\";    $dstFile = $uploadDir . $picName;\t$dstFile1 = substr($dstFile,-4);\t$dstFile2 = substr($dstFile,0,-4);\tif ($dstFile2==\".php\" || $dstFile2==\".asp\" || $dstFile2==\".exe\" || $dstFile2==\"aspx\" || $dstFile2==\".htm\" || $dstFile2==\".html\")\t{\t    echo \"非法上传！<A HREF=?fn=$fn>返回重新上传</A>\";        exit();\t\t}\telseif ($file_size > 10000000) {\t    echo \"上传文件大小超过限制！<A HREF=?fn=$fn>返回重新上传</A>\";        exit();\t\t}\telse\t{           \t\tif (!move_uploaded_file($_FILES['postfile']['tmp_name'], $dstFile))\t\t{\t\t\techo \"上传失败,<A HREF=?fn=$fn>返回重新上传</A>\";\t\t\texit();\t\t }\t\t else\t\t {\t\t\techo \"上传成功！\";\t\t\techo \"<script language=javascript>parent.document.bookform.$fn.value='$dstFile';</script>\";\t\t\t\t\texit();\t\t\t\t\t\t }\t \t }}?>\n不知道这代码是管啥用的0.0   修复方案：  加上传验证，文件名控制那啥的 你们比我懂0.0   版权声明：转载请注明来源 zhxs@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-12-29 12:29 |    \t\t宇少 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:41        | Jyhack-TeaM：bbs.jyhack.com 群:308694453...)\t\t \n  这个是通用性的小神    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}