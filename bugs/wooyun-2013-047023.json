{"id": 59530, "wybug_id": "wooyun-2013-047023", "wybug_title": "emlog官方插件导致xss可打管理员cookie", "wybug_corp": "emlog.net", "wybug_author": "phith0n", "wybug_date": "2013-12-26 10:55", "wybug_open_date": "2014-03-26 10:56", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-12-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-02-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-26：\t细节向公众公开  简要描述： 不侧露。 详细说明：  emlog官方的“反垃圾评论”插件（感觉70%以上的人在用,因为内核代码里没有垃圾评论的处理，要处理垃圾评论只有用插件），未对某处xss进行过滤导致直接打管理员cookie。代码如下：\n<?php\t\twhile($res = $DB->fetch_array($query)):\t\t$ishide = $res['hide']=='y'?'<font color=\"red\">[待审]</font>':'';\t\t$mail = !empty($res['mail']) ? \"({$res['mail']})\" : '';\t\t$ip = !empty($res['ip']) ? \"<br />IP：<a href=\\\"./plugin.php?plugin=anti_spam_comment&advance=true&ip={$res['ip']}\\\">{$res['ip']}</a>\" : '';\t\t$url = !empty($res['url']) ? \"({$res['url']})\" : '';\t\t$res['content'] = str_replace('<br>',' ',$res['comment']);\t\t$sub_content = subString($res['content'], 0, 50);\t\t$res['title'] = subString($res['title'], 0, 42);\t\t?>\t\t\t<tr>\t\t\t\t<td><input type=\"checkbox\" value=\"<?php echo $res['cid']; ?>\" name=\"com[]\" class=\"ids\" /></td>\t\t\t\t<td><a href=\"./plugin.php?plugin=anti_spam_comment&advance=true&act=edit&cid=<?php echo $res['cid']; ?>\" title=\"<?php echo $res['content']; ?>\"><?php echo $sub_content; ?></a> <?php echo $ishide; ?>\t\t\t\t<br /><?php echo smartDate($res['date']); ?>\t\t\t\t<span style=\"display:none; margin-left:8px;\">\t\t\t\t<a href=\"javascript: asc_confirm(<?php echo $res['cid']; ?>, 'name');\">屏蔽内容</a>\t\t\t\t<a href=\"javascript: asc_confirm(<?php echo $res['cid']; ?>, 'url');\">删除地址</a>\t\t\t\t</span>\t\t\t\t</td>\t\t\t\t<td><a href=\"./plugin.php?plugin=anti_spam_comment&advance=true&poster=<?php echo urlencode($res['poster']);?>\"><?php echo htmlspecialchars($res['poster']);?></a> <?php echo $url; ?> <?php echo $ip;?> <?php echo $mail;?></td>\t\t\t\t<td><a href=\"./plugin.php?plugin=anti_spam_comment&advance=true&gid=<?php echo $res['gid']; ?>\"><?php echo $res['title']; ?></a></td>\t\t\t</tr>\t\t<?php endwhile; ?>\n数据库中取出评论内容$res['comment']，$sub_content取前50个字符就直接输出了。而且插入数据库时也未进行数据处理:\n\n直接导致执行javascript:\n\n   漏洞证明：  可打cookie：\n\n\n\n使用该cookie可以直接登录后台。   修复方案：  \necho htmlspecialchars($sub_content);\n   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-12-26 13:20 厂商回复： 确认，的确可以获取到管理员cookie并登录后台 最新状态： 2013-12-27：已经修复  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}