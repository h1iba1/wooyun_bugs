{"id": 18813, "wybug_id": "wooyun-2012-010172", "wybug_title": "QQ邮箱再现跨站储存型漏洞", "wybug_corp": "腾讯", "wybug_author": "啤酒", "wybug_date": "2012-07-26 15:20", "wybug_open_date": "2012-07-26 16:57", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-07-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-07-26：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： QQ邮箱跨站储存型漏洞，卫生棉叫邮箱跨站喃？因为问题出在在邮箱里面. 详细说明：  继上次QQ邮箱附件跨站漏洞之后，tx的tx求个QQ公仔给偶儿子玩玩..呵呵首先给自己发送一份构造邮件，构造过程如下：====准备原料和测试环境========================= 原料:  一张jpg 格式的图片（当然是包含js脚本的jpg）  图片内容如图 \n\n在txt里面编辑好代码之后修改后缀txt为jpg测试环境： ie8====重现漏洞===========================打开QQ邮箱把图片作为附件上传,同时将图片添加到正文\n\n 就绪之后发送到自己的邮箱可能有人问为什么要发到自己的邮箱我的目的是得到上传图片的地址。我在做这一步的时候尝试过抓包得到图片的地址，实际上也真能得到地址，但是抓包得到的地址，用ie访问之后是直接提示下载文件的，不能在ie的框架内执行，于是想到以前发的正常的图片，发到对方邮箱之后都是在正文显示，没提示过下载。遂尝试把构造的图片发到自己的邮箱得到地址。（在我真正测试的时候考虑的还要多一点，不过现在都忘了）打开已发送\n\n\n\n\n\n         地址复制出来在QQ登录状态单独访问这个图片地址。奇迹出现了.图片内的代码成功执行，且重现了在ie6上才能看到的漏洞--ie执行图片内的代码 。\n\n目测是这个地址没有设置解析文件头。所以ie按照默认的html解析了，总之图片内的代码执行了。同时观察图片地址，很显然可以看到地址中的参数包含了身份判断，但是幸运的是似乎只判断了发送方身份，换句话说就是：这个地址是静态的，只要发给QQ邮箱用户 对方点击了这个连接就能执行。ok把得到的地址发给好友点击执行.通杀所有ie\n\n当然真正的场景不能这么简陋。对方点击连接代码执行\n\n这里还有个比较有趣的地方 如果这个连接是非腾讯的话那么点击后窗口是在新的标签内打开，如果是腾讯自己的连接的话点击连接后是直接在框架内打开的。   漏洞证明：  \n\n   修复方案：     版权声明：转载请注明来源 啤酒@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2012-07-26 16:57 厂商回复： 感谢你的报告，但是此问题没有重现。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-07-26 15:22 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  这个QQ应该是修复不了的～ 而且的确利用场景苛刻    \n     2012-07-26 15:24 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  先 顶一下 呵呵    \n     2012-07-26 15:39 |    \t\t啤酒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 道不同.喝酒结盟)\t\t \n  @xsser 很容易再现的..利用也很顺畅，只要是ie 对方点击了连接就执行.关键点在于拿到那个图片地址.而那个图片地址自己发给自己就能拿到了。拿到了发给别人，别人点击之后就可运行。腾讯自己可以通过权限验证修复.让攻击方拿不到目标方的图片地址，而不是共用地址。    \n     2012-07-26 15:47 |    \t\t啤酒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 道不同.喝酒结盟)\t\t \n  修正一下 QQ登录状态 是 QQ邮箱登录状态的意思    \n     2012-07-26 17:46 |    \t\tcnrstar \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:23        | Be my personal best!)\t\t \n  不行的，我测试了下，给自己弹框框还是可以的，发给别人的时候让别人弹框框是不行的。。    \n     2012-07-26 18:30 |    \t\t啤酒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 道不同.喝酒结盟)\t\t \n  尼玛找到原因了，同个浏览器可以同时登录路多个QQ邮箱。当发送方和接收方在同个浏览器的时候能复现。想必是sid是来自cookie算出来的。不过我4月份确实异地测试的。忘了当时怎么搞的了。    \n     2012-07-26 19:31 |    \t\t啤酒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 道不同.喝酒结盟)\t\t \n  @xsser 这个漏洞我已近重新测试复现了能不能再提交一次喃？    \n     2012-07-26 19:32 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  @啤酒 可以 呵呵    \n     2012-07-26 22:23 |    \t\t性感的蛐蛐 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 少年,母猪喊你回家拱地!)\t\t \n  呵呵，我是通过TX微博弄的仔，就不去找老马了，太扣了    \n     2012-07-27 22:21 |    \t\t啤酒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 道不同.喝酒结盟)\t\t \n  @性感的蛐蛐 确是扣得没法说了。大半年都过去了才发过一次礼物。果然是企鹅——1年只产一次蛋。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}