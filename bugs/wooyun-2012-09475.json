{"id": 18087, "wybug_id": "wooyun-2012-09475", "wybug_title": "Stcms sql injection Vulnerabilities", "wybug_corp": "Stcms", "wybug_author": "路人甲", "wybug_date": "2012-07-11 12:07", "wybug_open_date": "2012-08-25 12:08", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-07-11：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2012-08-25：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 任意sql语句执行 详细说明：  \ncase 'list':\t\t\t$totalNum = $mysql->numTable(\"member\", $where);\t\t$pageNum = 20;\t\t$totalPage = intval($totalNum/$pageNum) == $totalNum/$pageNum ? $totalNum/$pageNum : intval($totalNum/$pageNum)+1;\t\t$page = $page ? $page : 1;\t\t$page = $page>$totalPage ? $totalPage : $page;\t\t$page = $page<1 ? 1 : $page;\t\t$members = $mysql->select(\"member\",\"id,name,time,money,provience,city,picture\",$where,array(\"id DESC\"),array(($page-1)*$pageNum,$pageNum));\t\trequire(INCLUDE_PATH.\"page.class.php\");\t\t$pageClass = new page($page,$totalNum,$pageNum, WEB_URL.\"member/u.php?action=list\", true);\t\t$pageCode = $pageClass->getCode();\t\t$smarty->assign(\"webTitle\",\"会员列表\");\t\t$smarty->assign(\"uList\", $members);\t\t$smarty->assign(\"pageCode\", $pageCode);\t\t$smarty->display(\"member/m_u_list.html\");function numTable($table='',$wheres=false)\t{\t\t$table = $this->dbPrefix.$table;\t\t$sql = \"SELECT COUNT(*) AS num FROM `$table`\";\t\tif($wheres)\t\t{\t\t\t$sql .= \" WHERE \";\t\t\tif(is_array($wheres))\t\t\t{\t\t\t\tforeach($wheres as $key => $val)\t\t\t\t{\t\t\t\t\t$whr[] = \"`$key`='\".$val.\"'\";\t\t\t\t}\t\t\t\t$sql .= implode(\" AND \",$whr);\t\t\t}\t\t\telseif(is_string($wheres))\t\t\t{\t\t\t\t$sql .= $wheres;\t\t\t}\t\t}\t\t$result = $this->fetch($this->query($sql));\t\treturn $result['num'];\t}\nWhere 没初始化 导致可执行任意sql语句   漏洞证明：  http://localhost/stcms_html/member/u.php?action=list&where={sql}    修复方案：  你懂的吧   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2012-08-25 12:55 |    \t\tXhm1n9 \t\t\t( 实习白帽子  |\t\t\t        Rank:57 漏洞数:13        | bug)\t\t \n  这里不是指定了表名么，还怎么任意sql语句?mysql的多语句？    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}