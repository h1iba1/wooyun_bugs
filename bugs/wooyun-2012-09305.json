{"id": 19247, "wybug_id": "wooyun-2012-09305", "wybug_title": "Oblog 4.5-4.6 access&amp;mssql getshell 0day", "wybug_corp": "悠悠易（北京）网络科技有限公司", "wybug_author": "Henry", "wybug_date": "2012-07-06 22:53", "wybug_open_date": "2012-07-06 22:53", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "逻辑错误", "源码审核", "任意文件写入利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-07-06：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2012-07-06：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 由于程序猿的逻辑判断出错，导致可通过IIS解析漏洞直接生成WEBSHELL权限。 详细说明：  影响范围：4.5 - 4.6漏洞需求: IIS6.0\\开启会员挖掘作者:henry绝对原创，技术含量不高,但影响范围比较广..邮箱是QQ号码求匿..漏洞文件：\nAjaxServer.asp (372行)log_filename = Trim(Request(\"filename\"))//未过滤自定义文件名AjaxServer.asp (259行)(关键)If (oblog.chkdomain(log_filename) = False And log_filename <> \"\") and isdraft<>1 Then oblog.adderrstr (\"文件名称不合规范，只能使用小写字母以及数字！\")\n逻辑错误,只要有一个条件不满足,则跳过.请看:206行 \nisdraft = Int(Request(\"isdraft\")) //可控\n\nisdraft=1\n 则成功跳过   漏洞证明：  漏洞利用：⒈ 注册会员，发表一日志。⒉ 修改日志，高级选项，文件名称这里写abcdefg，内容为一句话木马源码。然后抓包保存。⒊ 修改表单数据，将filename改为a.asp;x，isdraft参数为1，提交表单。⒋ 回到博文管理，选择重新发布日志，日志地址则为SHELL地址。tips: 若博文目录不可, 则可控制filename=../../data/a.asp;x   修复方案：  AjaxServer.asp (259行)(关键)If (oblog.chkdomain(log_filename) = False And log_filename <> \"\") \nand\n isdraft<>1 Then oblog.adderrstr (\"文件名称不合规范，只能使用小写字母以及数字！\")</code>将and改为or即可防止   版权声明：转载请注明来源 Henry@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2012-07-06 23:30 |    \t\t随风.潜入夜 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:5        )\t\t \n  你没有看过生成后的代码吧？<>符号都被过滤成了 HTML的gt lt 无法解析，即便是变形一句话也不会解析。    \n     2012-07-07 19:47 |    \t\tHenry \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | Null)\t\t \n  方法一：可通过修改日志模版（有的可能需要等级权限）方法二：将编辑器改为代码模式，或者通过NC提交。都通过测试确认，网络上已有人写出利用工具 ：）    \n     2012-07-30 22:46 |    \t\tnetwork \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:2        | 我是帅哥)\t\t \n  4.5的是可以 请问你有下载过最新源码吗 。    \n     2012-07-31 00:06 |    \t\t随风.潜入夜 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:5        )\t\t \n  @network 测试的4.6关键字转意了    \n     2012-07-31 12:14 |    \t\tnetwork \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:2        | 我是帅哥)\t\t \n  @随风.潜入夜 yes 主要是我下载的代码和他贴出来的都不一样。4.5可以的    \n     2013-12-30 18:16 |    \t\tdoor \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 没什么说明)\t\t \n  @Henry 修改日志模板？    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}