{"id": 33873, "wybug_id": "wooyun-2015-0107822", "wybug_title": "Metinfo最新版注入(gpc影响）", "wybug_corp": "MetInfo", "wybug_author": "i3esn0w", "wybug_date": "2015-04-15 14:21", "wybug_open_date": "2015-07-16 10:52", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-16：\t细节向公众公开  简要描述： 之前提交说已经过滤了，然后又下载了一下，发现还是没有过滤，不知道审核说的过滤是在哪过滤的 详细说明：  \n\n可以看到是最新下载的，更新日期\n\n后台配置文件位于/admin/include/common.inc.php\n\n代码无任何改变\n<?php# MetInfo Enterprise Content Management System # Copyright (C) MetInfo Co.,Ltd (http://www.metinfo.cn). All rights reserved. header(\"Content-type: text/html;charset=utf-8\");error_reporting(E_ERROR | E_PARSE);@set_time_limit(0);define('ROOTPATH_ADMIN', substr(dirname(__FILE__), 0, -7));DIRECTORY_SEPARATOR == '\\\\'?@ini_set('include_path', '.;' . ROOTPATH_ADMIN):@ini_set('include_path', '.:' . ROOTPATH_ADMIN);$DS=DIRECTORY_SEPARATOR;$url_array=explode($DS,ROOTPATH_ADMIN);$count = count($url_array);$last_count=$count-2;$last_count=strlen($url_array[$last_count])+1;define('ROOTPATH', substr(ROOTPATH_ADMIN, 0, -$last_count));PHP_VERSION >= '5.1' && date_default_timezone_set('Asia/Shanghai');session_cache_limiter('private, must-revalidate'); @ini_set('session.auto_start',0); if(PHP_VERSION < '4.1.0') {\t$_GET         = &$HTTP_GET_VARS;\t$_POST        = &$HTTP_POST_VARS;\t$_COOKIE      = &$HTTP_COOKIE_VARS;\t$_SERVER      = &$HTTP_SERVER_VARS;\t$_ENV         = &$HTTP_ENV_VARS;\t$_FILES       = &$HTTP_POST_FILES;}$settings=array();$db_settings=array();$db_settings = parse_ini_file(ROOTPATH.'config/config_db.php');@extract($db_settings);require_once ROOTPATH_ADMIN.'include/mysql_class.php';$db = new dbmysql();$db->dbconn($con_db_host,$con_db_id,$con_db_pass,$con_db_name);$query=\"select * from {$tablepre}config where name='met_tablename' and lang='metinfo'\";$mettable=$db->get_one($query);$mettables=explode('|',$mettable[value]);foreach($mettables as $key=>$val){\t$tablename='met_'.$val;\t\t$$tablename=$tablepre.$val;\t$_M[table][$tablename]=$tablepre.$val;}require_once dirname(__file__).'/global.func.php';require_once dirname(__file__).'/global/snap.func.php';define('MAGIC_QUOTES_GPC', get_magic_quotes_gpc());$lang=$_GET['lang']<>\"\"?$_GET['lang']:$_POST['lang'];$lang=daddslashes($lang,0,1);$metinfoadminok=1;$settings_arr=array();require_once ROOTPATH.'config/config.inc.php';met_cooike_start();$query=\"select * from {$tablepre}lang where mark='{$_GET[langset]}' and lang='metinfo'\";$isadminlang=$db->get_one($query);if(!$isadminlang&&$_GET[langset]!='')die('not have this language');if($_GET[langset]!=''){\t$_GET[langset]=daddslashes($_GET[langset],0,1);\tchange_met_cookie('languser',$_GET[langset]);\tsave_met_cookie();}\nlangset还是无任何过滤，直接带入查询   漏洞证明：  and 1=1\n\nand 1=2\n\nSQLmap测试\n\n由于后台文件调用了login_check.php文件来检查是否已经登录，因此，后台所有文件均可注入附上最新下载的程序http://pan.baidu.com/s/1mgHvzMo   修复方案：  不知道   版权声明：转载请注明来源 i3esn0w@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-04-17 10:51 厂商回复： 谢谢您的反馈，这个问题我们已经修复了。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-28 08:51 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  这个漏洞可惜了，本身可以直接getshell    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}