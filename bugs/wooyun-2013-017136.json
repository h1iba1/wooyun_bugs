{"id": 14438, "wybug_id": "wooyun-2013-017136", "wybug_title": "都江堰市政府被入侵（包括财政局、公安局、政务服务中心等），突破防注程序获取Shell", "wybug_corp": "都江堰市政府", "wybug_author": "小胖子", "wybug_date": "2013-01-10 10:49", "wybug_open_date": "2013-02-24 10:50", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["渗透测试思路", "管理后台对外", "安全意识不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-01-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-01-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-02-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-02-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-02-24：\t细节向公众公开  简要描述： 千里之堤毁于注入。 详细说明：  0x1：本次虽然是未被授权，但是没有修改任何数据，并立即提交乌云并通知管理员。请勿跨，谢谢。0x2:一个注入引发的问题。详细过程：  主站都是防注入的，而且后台真复杂，密码算法未知（貌似），首先看防注入代码。\n//$refuse_str=\"and|or|select|update|from|where|order|by|delete|'|insert|into|values|create|table|database\";<br />//$refuse_str=\"select|update|where|delete|insert|into|values|create|table|database\";<br />$refuse_str=\"substring|and|ascii|database|select|update|where|delete|insert|or|union|'|into|values|create|table|from\";<br />$arr_refuse_str=explode(\"|\",$refuse_str);<br />foreach ($_REQUEST as $key=>$value)<br />{<br />for($i=0;$i<sizeof($arr_refuse_str);$i++)<br />{<br />   if(substr_count(strtolower($_REQUEST[$key]),$arr_refuse_str[$i])>0){<br />    echo \"请不要来攻击!\";<br />\n绕还是不好绕的，大写转小写，但是有一个文件，嘿嘿，例外了哇。http://www.djy.gov.cn/djykz/content.php?content=5983\n\n然后，gpc_off，读文件，读apache配置。\n\n得到路径，读首页文件：\n\n欣喜的看到数据库配置文件，路径/inc/db.php 读取之：\n\nRoot！！！！root！！亲。明显看到防注入代码，但是不能疏忽，SQL链接之：\n\n测试之前就旁站看了下，统计局是用的dedecms，读取管理密码：\n\n后台设置也相对简单 /tjj然后，然后就没有然后了，权限很大，同服务器有N多政府网站，想想都害怕。   漏洞证明：  \n\n后台真复杂，怪不得。   修复方案：  0x1：缺陷文件加入防注入。0x2：MySQL还是不要允许外连了。今天测试是旁站，要是没有旁站，root的mysql也非常危险，数据库用户单独设置权限吧。0x3：后台设置得牢靠点，最好限制为内网IP登陆，对同服站点做好管理。0x4:不要跨省啊，作为一个热爱都江堰的都江堰人，仅仅是想都江堰政府把网站做得更好啊！0x5：不继续深入了，等修复完后再看？   版权声明：转载请注明来源 小胖子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-01-14 09:44 厂商回复： CNVD确认并复现所述情况，已在11日下午转由CNCERT四川分中心协调网站管理方处置。按完全影响机密性，部分影响可用性和完整性进行评分，基本危害评分8.97（高危），发现技术难度系数1.1，涉及行业或单位影响系数1.5（同主机多部门网站），综合rank=8.97*1.1*1.5=14.800 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-01-10 10:56 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  壮哉大蓉城@Rstar#    \n     2013-01-14 01:01 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  统计局的DEDE.密码caidao小伙.    \n     2013-01-14 09:55 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @only_guest 哈哈，你又紧张了哇？    \n     2013-01-14 10:18 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @se55i0n 嗯.必须紧张.    \n     2013-01-14 12:30 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @only_guest 大爷，核心白帽子权限就是高啊，都能看到内容鸟，已通知管理员删除shell并修复咯，各位大牛别对号入座啊，跪了。    \n     2013-01-14 18:27 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @小胖子 现在还看不到内容.我只是去日了遍.分析了下你的马    \n     2013-01-14 21:13 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @only_guest 次奥！    \n     2013-02-03 12:18 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  @小胖子 @se55i0n @only_guest if(substr_count(strtolower($_REQUEST[$key]),$arr_refuse_str[$i])>0){<br />    echo \"请不要来攻击!\";<br />看清楚了没有exit~~~~~~~~~~!!!!!! 可以爆错注入或者延迟    \n     2013-02-03 13:10 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @_Evil 报错怎么做？延迟可以？不过能找到没过滤的点岂不更好～哈哈～    \n     2013-02-03 17:24 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  如果是error based注入的就爆错了。 他只是echo 没有exit php代码还会执行 的~~~~~ 延迟嘛 百度下php延迟注入    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}