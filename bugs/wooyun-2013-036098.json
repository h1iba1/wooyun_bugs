{"id": 9942, "wybug_id": "wooyun-2013-036098", "wybug_title": "腾讯申诉机制存在缺陷引发的一系列血案", "wybug_corp": "腾讯", "wybug_author": "鬼魅羊羔", "wybug_date": "2013-09-04 17:05", "wybug_open_date": "2013-09-04 17:36", "wybug_type": "账户体系控制不严", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["认证设计不合理"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-09-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-09-04：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 腾讯申诉机制存在缺陷 详细说明：  9月3日下午16:25分左右，QQ意外被黑，发现问题后，我的第一反应就是用密保来修改密码，因为当时着急，没仔细想，结果就发现，密保居然不正确了（返回头想，更改QQ密码，除非手机宝令绑定，或者超级QQ绑定后，才可以直接更改密码，其他更改措施，都需要密码保护来验证，既然密码不正确了，密保肯定也就被重置了，当然无法更改了。） 下图为QQ被盗的原因，就是申诉：进一步检查发现，出了QQ密码，密保手机、手机宝令、QQ密码保护等措施，全部被人重置了，于是我直接联想到了QQ申诉，当然了，QQ申诉必须具备几个条件，姓名、常用IP、三个人以上的QQ好友辅助验证以及曾用密码，才可以重置QQ密保，我一直以为是QQ申诉出来新的漏洞了，可以直接秒杀（后来一琢磨，发现不是QQ漏洞的问题，因为申诉我的号码，他已经具备了几个条件，我的名字是公开的，这个条件成熟、常用IP可以直接代理，也成熟，常用密码的话，有QQ裤子就好说，直接查询历史密码，这还不够，问题就出在最关键的QQ好友辅助上了，我是栽到这里了。）先不多说，我先贴几张图，咱看图说话。。。大家注意下2013-09-03 16:29分的纪录，是申诉审核通过后的，大家也知道，申诉审核时间，是4小时之内，但是通常2小时就会有结果了，估计申诉时间大概是下午2点前后，申诉成功后，直接开始更改我的密码和密保资料，幸运的是我在他重新设置密保资料之前，就提交了一次申诉材料，当然了，我知道的账号信息肯定比他要全，毕竟是我自己的号。\n\n QQ被重置以后，当时只顾着着急QQ本身了，却忘了攻击者的真正意图，当时就想到了乌云账号会不会受牵连，因为我乌云的的密码找回邮箱，就是QQ邮箱，我登陆乌云，发现密码果然被修改了，果不其然，在修改我的密保以后，第一件事，就是进我的QQ邮箱，因为我QQ邮箱设置了独立密码，他又用设置好的密保，重置了我的独立密码，进入了邮箱，大家看下IP地址，是代理的呼和浩特市，跟我的常用IP很接近，但是，还是有区别的。。这就说明，这个家伙在登陆我邮箱的时候，用的依然是代理，也就是被盗QQ的常用IP地址，这是满足申诉的第一个重要条件。\n\n后来找回密码以后，我进入邮箱，发现了这个，原来，攻击者在重置了我QQ邮箱独立密码以后，就直接奔我的乌云账号去了，通过乌云账号密码找回功能，直接修改了我的乌云密码，并且转账走了33乌币，攻击者的真正目的，是乌云的乌币，我的QQ号，只是连带误伤而已，在已删除邮件中找到了这个，看下图：\n\n下面是攻击者进入我乌云账户后进行的转账截图：\n\n出去办了点事情，回来，我的小伙伴们已经有个结果了：陈再胜小朋友在看到乌云账号被盗的消息后，第一时间成功的射到了这个家伙的乌云密码，但是果不其然，是个小号，也不知道是转几次的小号了，WB直接转给了xcloud这个账号，估计这个账号也是个小号，肯定又转到了另外一个账户上：\n\n（后来根据这个账户的拥有者说，他的账户是被人恶意找回了，用他的号来栽赃陷害的，并不是他所为，这个具体是不是，就没地方考证了，但是如果真是栽赃的话，那这个事情就变的更复杂了）仔细回想了下，最近加我的人实在太多了，大部分都是加进来，不说话，要么就是无限次的重复一句话，之前没在意，出了这事儿后，我才明白过来，这就是申诉找回的最重要的一个环节，加你，不是为了聊天，而是为了后续的好友辅助申诉，我也不知道具体是哪个人，我还是先贴出来吧。。误伤了莫怪。。\n\n后来有人反映，这些QQ号当中，有一个人加了不少白帽子，而且，多数是有事没事的说话，比较可疑，具体是哪个，我也没证据，大家自己斟酌吧。。最近加的这些人，行为真心古怪，反复的问我：“在吗？”，我回答后，就没动静了，第二天，还是回重复同样的话，问你在不在。当然了，这些人，我都是单向好友，也就是我同意他们加我好友，但是我并没有加他们。后来琢磨了下，这样的话，如果也能被申诉，那么只有一种可能性，腾讯不会验证对方是否在你的好友列表当中，而是把经常聊天的人当做了常用联系人，也就是默认成了好友，就算你好友没加他，对方一样可以进行辅助申诉。我忽略了一个问题，还可以根据QQ空间信息，加上对方的好友后，说号被盗了如何如何，然后让帮忙配合申诉，这样也可以申诉成功的。对方加你其他朋友的QQ后，先不说话，当你直接收到一封“QQ密保好友辅助”的邮件后，忽然告诉你，说是号被盗了，需要填下申诉回执单，很紧急，你的第一反应是什么？我想，很多人看到邮件提示的是自己朋友的QQ号，基本不会怀疑，肯定是先着急的填写验证信息后，才会想起来问对方，你是不是某某某人？你号怎么会丢呢？当你填写完成后，你问什么，都已经没有意义了。。。。如果我加对方10个好友，广撒网，那配合申诉的命中率是多少呢？我相信，超过三个，是轻轻松松的。。。这样的话，QQ密保被重置的概率就很大了。为了验证这个可行性，我跟陈再胜继续做了次测试，在单向好友的情况下，是可以邀请对方进行好友辅助的（比如说：攻击者QQ为：4444，我的QQ为：5555,4444用户加我为好友，我只点了同意，也就是说，我并没有加他，而我，却在对方的好友名单里，这样的话，在对我5555这个号进行申诉时，攻击者4444同样可以收到好友辅助验证的邮件，也就是说，攻击者就算不在你的好友列表当中，一样可以有资格进行好友辅助验证，一旦成功验证人数超过3个，那么，QQ被申诉的几率是多大呢？由于曲子龙没有及时响应我的测试，导致申诉失败，我先贴个图，大家先看下：\n\n申诉过的朋友应该都知道，如果申诉材料不够，肯定会邮件提示你，姓名、或者其他资料不全，如果没提示，则说明，你提交的材料已经达到了审核标准，我再贴一张图，大家看看跟上图的区别就知道了。。\n\n在这次申诉中，我只用了3样东西，1.姓名；2.常用IP；3.三个刚加的好友。其实满足这三条，申诉的几率应该是90%的。。由上图内容可以推论，达到上述三个条件后，被重置密保的可行性是非常大的。。我也并没有100%的肯定，但是自己确实是这么中招的。。。事情到此也就有个结果了，经过这次事情，给大家总结了几个经验。1.陌生人不要加，哪怕只是单向好友，也不要加。。。如果是自己的朋友要社，那只能认栽，没别的。2.如果密保被重置，请让朋友投诉你的QQ，暂时冻结你的QQ使用权，可以拖延下时间，以免出更大的问题。3.尽量不要用QQ邮箱做你的密保邮箱，我乌云账号被沦陷，就是个好例子。如果对方不加你，只是利用你QQ好友里已存在的用户去对你发起验证，以欺骗的方式，让对方配合验证的话，那你只能自求多福了。。。。我相信，如果腾讯的验证机制不改，这个帖子估计就会变成一个盗号申诉教程了。。哎。。。最后补充下：有乌币的朋友们，赶紧换密保邮箱吧。。剑总正在改善安全机制，相信很快就会有个结果了，让这些不法分子，无机可乘。。关于我损失的乌币的事情，希望剑总别补偿了，首先这个也是个人原因，安全意识不足，导致的问题，其次，如果贸然补偿我了，其他受损失的用户也得跟着补偿，这不合适，这个先例不能开。。。给个1WB就OK了，这个帖子，其实不算是什么漏洞，只是发出来，警醒下大家。本来想继续深入测试申诉这个功能的，但是测试的时间越长，怕其他用户遭受损失，所以就先发出来了。。在深入的话，就挖到腾讯那了。。。   漏洞证明：  看详细说明吧。。。   修复方案：  密码找回最好加入手机短信验证机制，乌币消费，也加上短信验证吧，方便。。。   版权声明：转载请注明来源 鬼魅羊羔@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-09-04 17:36 厂商回复： 感谢楼主的报告，我们的业务人员对相关逻辑进行了确认，并没有缺陷。推测可能是楼主历史资料被盗所致。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-09-04 17:07 |    \t\tlucky \t\t\t( 普通白帽子  |\t\t\t        Rank:409 漏洞数:84        | 三人行必有我师焉########################...)\t\t \n  还真发出来了呀！    \n     2013-09-04 17:11 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  擦，有一张贴错图了。。其实配合社工裤，一条历史密码，就可以解决申诉问题了。    \n     2013-09-04 17:13 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @鬼魅羊羔 什么申诉问题？    \n     2013-09-04 17:15 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  申诉目前确实是腾讯在账户体系上的安全短板，绕过了密码，直接就能把你账户权限拿下。虽然有些条件限制，但是对于那些有心的人来说,这些还是很有可能得到这些资料。    \n     2013-09-04 17:20 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @xsser 根据做黑产的朋友说，他们申诉别人的密保，一般只是需要一条历史密码就可以了，再配合辅助好友验证的缺陷，就基本妥妥的了。我的号就是这样被拿下的。。。    \n     2013-09-04 17:25 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @鬼魅羊羔 是的 这wb算是弥补给你吧 我的也一直在被申诉啊    \n     2013-09-04 17:27 |    \t\t　 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 　)\t\t \n  @鬼魅羊羔 刚在ZONE看到了,好狗血~    \n     2013-09-04 17:27 |    \t\t小震 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | ~)\t\t \n  都是200以上rank的牛人。。。    \n     2013-09-04 17:28 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  围观下    \n     2013-09-04 17:30 |    \t\t　 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 　)\t\t \n  @lucky @梧桐雨 @xsser @鬼魅羊羔 估计要被我大腾讯忽略,貌似之前就看过类似的文章了~    \n     2013-09-04 17:31 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @　 昨天申诉的才狗血呢。。好不容易申诉回来了，我手贱，第一次申诉结束后，我不放心，又申诉了一遍，，结果第一遍的成功了，我重置完密保，刚填写完资料和信息，过了不到一小时，第二次提交的申诉也通过了，然后我的密保又被自己重置了，我又重新填写了一次，，，蛋疼。。。    \n     2013-09-04 17:32 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  持久型关注！    \n     2013-09-04 17:32 |    \t\t专业种田  \t\t\t( 核心白帽子 |\t\t\t        Rank:1425 漏洞数:182        | 没有最专业的农民,只有更努力地耕耘..........)\t\t \n  今天有一个人加我，说了一句话，就没回应了，看了你的贴，我果断拉入黑名单,太危险了.........    \n     2013-09-04 17:32 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @　 忽略是肯定的，其实这个文章忽略了，还是好点，不忽略，其他人就看不到，其他人看到了，也会提高些警惕，对大家都好。。。本来这个文章写出来的目的，不是为了rank，只是为了放在漏洞列表当中，给大家报个警。。    \n     2013-09-04 17:33 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  @鬼魅羊羔 陌生人一律拉黑    \n     2013-09-04 17:34 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  @niliu 你可以试试陌生人的弱口令。    \n     2013-09-04 17:36 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  @梧桐雨 。。。。。。我去~ 我这点小人品还是积攒着挣rank吧    \n     2013-09-04 17:37 |    \t\t　 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 　)\t\t \n  @鬼魅羊羔 查了下我单向好友,更狗血,1596!!!我删呢还是不删呢?    \n     2013-09-04 17:38 |    \t\t　 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 　)\t\t \n  @鬼魅羊羔 果断被忽略了~    \n     2013-09-04 17:49 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @　 忽略了就对了，正合我意，意料中的事情。    \n     2013-09-04 17:55 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  嗯 公开也好 大家都注意下帐号安全 而且腾讯方面的机制大家也注意下 尽量做到保护好个人敏感信息 出了问题的应对方案    \n     2013-09-04 17:58 |    \t\tsecer \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 来乌云学习学习)\t\t \n  人民币都有编号的，所以WB也可以加个key方便追查流向(当然账户体系变复杂了...)    \n     2013-09-04 17:59 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @secer 你想逼死剑心啊。。。    \n     2013-09-04 18:09 |    \t\t李白 \t\t\t( 普通白帽子  |\t\t\t        Rank:142 漏洞数:29        )\t\t \n  @xsser http://wooyun.org/bugs/wooyun-2013-035960/trace/19aa6d038281d9210530f8ffe57e5bac  求审大腾讯..    \n     2013-09-04 18:53 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  关注！保护好自己的乌币    \n     2013-09-04 20:32 |    \t\t小震 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | ~)\t\t \n  @secer 毛线。那不得复杂死。。。    \n     2013-09-05 11:55 |    \t\t酷帥王子 \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:34        | 天朗日清，和风送闲，可叹那俊逸如我顾影自...)\t\t \n  哈哈哥用的635833就是用这种办法，搞来的，不足为奇去年我就发了一个腾讯相关的漏洞报告，结果直接忽略了，我坚信这种办法可以搞到5位，大家相信我吧    \n     2013-09-05 15:14 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @酷帥王子 我相信你。。。受过一次害了，肯定得信啊。。    \n     2013-09-05 18:38 |    \t\t小痞子 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:21        | <xss>alert(\"a\")</xss>￥&@&……dssKhwjcw...)\t\t \n  @xsser 吐了一口黑狗血。。。我得WB 也被盗光了。 哎·~ 能不能补回来啊  (*^__^*) 嘻嘻……    \n     2013-09-10 01:02 |    \t\tscan_z \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:4        | /home/work/newsphp/newsroot/temp/smarty/...)\t\t \n  我同学申诉的时候，只是误把申诉的QQ写成我的QQ了，居然也成功。狗血的是 我同学申诉的时候一个密码包括历史密码都没写就申诉成功了。 我QQ历史密码那么多，随便写一个申诉走我也认了，一个密码都不知道也能成功，真无语。    \n     2013-09-10 10:13 |    \t\tscan_z \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:4        | /home/work/newsphp/newsroot/temp/smarty/...)\t\t \n  ---------------------------------------------------------XXXng  10:09:43我的QQ号码没有申诉过，第一次申诉比较容易，我想问要怎么提高申诉难度？腾讯官方在线客服  10:10:01您要防止他人恶意申诉的话 这边建议您填写申诉单 并且 腾讯官方在线客服  10:10:11 您要更加完善才行 您要填写6个密码 7位好友 4个历史登录地 您填写得早期完善 他人就无法申诉成功了 您一次性完善了 就行---------------------------------------------------------    \n     2013-09-10 10:17 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @scan_z 看着有点懵圈。。。    \n     2013-09-10 15:41 |    \t\tp.z  \t\t\t( 普通白帽子  |\t\t\t        Rank:411 漏洞数:40        )\t\t \n  \"为了验证这个可行性，我跟陈再胜继续做了次测试，在单向好友的情况下，是可以邀请对方进行好友辅助的\" @腾讯 你们确定这个逻辑没有问题?    \n     2013-09-10 16:05 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @p.z 伦家说了，不是程序逻辑问题，换句话说，只要人家开发的程序没有代码方面的缺陷问题，其他神马都是浮云。。你号丢了，你得重新申请，业务掉了，你也重新花钱开。。总而言之，不影响人家收入的，，，哈。哈。哈。哈。而且连好友的时间都不带验证的。。    \n     2013-09-10 21:06 |    \t\t倒霉熊 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:6        | *好简要)\t\t \n  @鬼魅羊羔 好友时间有验证- 0 -。。。开始的时候是2天。后来7天- 0 -在后来。。不晓得。开始的时候只要有一个好友是长期的好友。。后面的好友单向也无所谓- 0 -。。。。    \n     2013-09-10 22:11 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @倒霉熊 嗯，是呢。。我号上之前有些人，上线了，就问你一句在不在，你回答完了，他就没动静了，然后第二天又是如此，反复好几天，我还跟我们同事抱怨过呢，刚抱怨完，下午就被重置了。。。感觉很狗血。。最起码要验证半年以上的好友吧，几天的算毛啊。。。真想不明白。    \n     2013-09-10 23:55 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @鬼魅羊羔 @xsser 你的一直被申诉？看来像你这种不加陌生人的qq，需要先申诉搞定3个以上你的好友，应该才可以额。。。诶，这种事情就得申诉几个腾讯高管的qq。这样他们就不会说是历史密码被盗所致了。。。    \n     2013-09-11 00:06 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @px1624 现在到是没有了，反正，上次是有人加我QQ上的好友，然后冒充我，去发邮件请求辅助申诉。。。就算不加你好友，也一样可以啊。。重点是，邀请的好友数量以及辅助申诉成功的数量。。。人家可以直接进你空间，找到跟你谈话密切，关系暧昧的人，加为好友，然后上自己的号看你在不在线，然后哦莫名其妙的问你一句，“在吗？”，反复问几遍，你要是不回答，就猜测你不在线，然后，就冒充你，给你的好友发送邮件，说QQ被盗了，请求辅助，一旦有人手贱，那你就完蛋了。。    \n     2013-09-11 07:57 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @鬼魅羊羔 还是比较bug啊！    \n     2013-09-21 00:33 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  并没有缺陷?不解释啊……这种事情频繁发生。话说真可以试试去搞搞5位6位啊！    \n     2013-10-24 14:56 |    \t\tJam \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:1        | I'm CJ!)\t\t \n  从来都是用Gmail的路过。。。。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}