{"id": 11418, "wybug_id": "wooyun-2013-024938", "wybug_title": "百度某社区权限缺陷导致用户信息泄露等", "wybug_corp": "百度", "wybug_author": "你撸我也撸", "wybug_date": "2013-06-03 10:55", "wybug_open_date": "2013-07-18 10:57", "wybug_type": "未授权访问/权限绕过", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-06-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-06-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-06-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-06-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-07-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-07-18：\t细节向公众公开  简要描述： RT! 详细说明：  改一下id，可以读取其他存在“发件箱”的私信：http://openresearch.baidu.com/member/message_read.jspx?id=500&&box=1   漏洞证明：  大量获奖大学生的详细联系方式等信息：\n\n\n\n\n\n\n\n\n\n   修复方案：  好象是用的开源代码啊，jeecms（这个开源系统百度也敢用？权限稀烂啊！）：\n\n或者可能是下面的关联因素造成的（参考代码是jeecms-2012-sp1）：com.jeecms.cms.action.member.MessageAct.java类：\npublic String message_read(Integer id, Integer box,HttpServletRequest request, HttpServletResponse response,ModelMap model) 方法：        @RequestMapping(value = \"/member/message_read.jspx\")\tpublic String message_read(Integer id, Integer box,\t\t\tHttpServletRequest request, HttpServletResponse response,\t\t\tModelMap model) {\t\tCmsSite site = CmsUtils.getSite(request);\t\tCmsUser user = CmsUtils.getUser(request);\t\tFrontUtils.frontData(request, model, site);\t\tMemberConfig mcfg = site.getConfig().getMemberConfig();\t\t// 没有开启会员功能\t\tif (!mcfg.isMemberOn()) {\t\t\treturn FrontUtils.showMessage(request, model, \"member.memberClose\");\t\t}\t\tif (user == null) {\t\t\treturn FrontUtils.showLogin(request, model, site);\t\t}\t\tCmsReceiverMessage message = receiverMessageMng.findById(id);\t\tif (message != null) {\t\t\t// 阅读收信\t\t\t// 非收件人和发件人无权查看信件\t\t\tif (!message.getMsgReceiverUser().equals(user)\t\t\t\t\t&& !message.getMsgSendUser().equals(user)) {\t\t\t\tWebErrors errors = WebErrors.create(request);\t\t\t\terrors.addErrorCode(\"error.noPermissionsView\");\t\t\t\treturn FrontUtils.showError(request, response, model, errors);\t\t\t}\t\t\t// 收件人查看更新已读状态\t\t\tif (message.getMsgReceiverUser().equals(user)) {\t\t\t\tmessage.setMsgStatus(true);\t\t\t\treceiverMessageMng.update(message);\t\t\t\tlog\t\t\t\t\t\t.info(\t\t\t\t\t\t\t\t\"member CmsMessage read CmsMessage success. id={}\",\t\t\t\t\t\t\t\tid);\t\t\t}\t\t\tmodel.addAttribute(\"message\", message);\t\t} else {\t\t\t// 阅读已发信\t\t\tCmsMessage msg = messageMng.findById(id);\t\t\tmodel.addAttribute(\"message\", msg);\t\t}\t\tmodel.addAttribute(\"box\", box);\t\treturn FrontUtils.getTplPath(request, site.getSolutionPath(),\t\t\t\tTPLDIR_MESSAGE, MESSAGE_READ);\t}\n例如，看看这段权限控制：先根据id在“收件箱”\nCmsReceiverMessage message =receiverMessageMng.findById(id);\n里找这条信息。如果存在\nif (message != null) {\n，就走“阅读收信”的流程，再去判断当前用户是否有阅读权限\nif(!message.getMsgReceiverUser().equals(user)&&!message.getMsgSendUser().equals(user)) {\n，下面就是正常逻辑了，没什么大问题。如果上面这个id在“收件箱”中不存在，就在下面“发件箱”中找\nCmsReceiverMessage message =receiverMessageMng.findById(id);\n看到，没有和上面“阅读收信”一样做进一步的权限验证，直接addAttribute发件箱的这条信息给用户了：\nelse {\t\t\t// 阅读已发信\t\t\tCmsMessage msg = messageMng.findById(id);\t\t\tmodel.addAttribute(\"message\", msg);\t\t}\n刚本地测试，自己发的一条给其他用户的信息，自己都没有这条信息在“发件箱”中的阅读权限了(id错位了)，@jeecms  :\n\n看看是不是这种情况？当然，如果是，上面至少还有一层逻辑造成“收件箱”与“发件箱”的id错位了（“收件箱”、“发件箱”、“草稿箱”、“垃圾箱”这四个操作存储时id问题，我这边测试id逻辑全错了，所以jeecms把上面的权限控制及存储代码的逻辑好好再捋一遍！），自己去看吧，看别人的代码很辛苦！或者是二次开发等其他情况造成的！   版权声明：转载请注明来源 你撸我也撸@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2013-06-03 20:16 厂商回复： 感谢提交，此为第三方开发。正在联系处理！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-06-05 19:14 |    \t\t熊猫 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:33        | panda)\t\t \n  =-= 有邮箱手机？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}