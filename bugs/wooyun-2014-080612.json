{"id": 47511, "wybug_id": "wooyun-2014-080612", "wybug_title": "360浏览器中间人漏洞可被更多人利用", "wybug_corp": "奇虎360", "wybug_author": "MITM", "wybug_date": "2014-10-24 18:29", "wybug_open_date": "2015-01-22 18:30", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当", "客户端程序设计错误", "浏览器"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-30：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-22：\t细节向公众公开  简要描述： 看了最近iCloud中间人攻击事件之后，发现对360安全和极速浏览器的SSL中间人攻击，可以有更多利用。 详细说明：  看了最近iCloud等中间人攻击事件的评论，许多人提到360安全和极速浏览器会默认打开网页，并加提醒。有人提出过虽然有提醒，但提醒不醒目，用户很容易忽略。也有人提到如果有自动登录的话，可泄露cookie。以下是更有危害的利用：(目前我没看到有人提，不知道WooYun-2014-80287里有没有以下利用方法)一句话概括就是，自签名证书配合HTTP缓存污染，可长期钓取敏感信息。具体说就是，首先使用公共Wi-Fi，或者自建Wi-Fi接入点，使自己能够任意监听及修改流量。当用户访问某些有价值的HTTPS网站时（可以通过TLS握手中的SNI扩展确定，比如监听mybank.icbc.com.cn），用自签名证书，发起中间人攻击。这时中间人可以篡改任意JavaScript文件来达到自己的目的，比如上传密码之类的。然后设置这个文件的头字段Cache-Control的max-age为一个很大的值，比如10年。当然，如果用户使用360安全浏览器的话会看到网页内容以及“证书风险”提示。这时即使用户不输入账户信息，立即退出，攻击也会继续。用户回家之后，再次打开网银时，会看到证书正常的小锁和EV SSL信息，以为安全了。但是因为我们之前设置了长时间缓存，所以JS会从缓存调取，所以攻击代码会一直起作用，直到用户主动清缓存，或按Ctrl+F5刷新（我试了只按F5不行）。   漏洞证明：  用Fiddler在自己电脑上试了下，在Fiddler Script里加入以下代码：\n\n开启解密HTTPS。用360安全浏览器打开https://mybank.icbc.com.cn/icbc/perbank/index.jsp。然后关闭360浏览器，停止解密HTTPS。重新打开360浏览器，再次访问上述网址，出现：\n\n   修复方案：  当SSL证书无效时，不要默认打开页面。另外你们不是用的Chromium内核，为什么不支持HSTS (HTTP Strict Transport Security)?   版权声明：转载请注明来源 MITM@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-10-27 12:08 厂商回复： 此问题已得到修复，感谢白帽子的反馈。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-24 18:30 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  金山百度qq一起笑了    \n     2014-10-24 18:48 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  mark    \n     2014-10-25 00:10 |    \t\t        Jn·  \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:14        | 本小菜很可爱，如果不服你TM来打我啊--哎呀...)\t\t \n  mark    \n     2014-10-25 00:54 |    \t\tdarkrerror \t\t\t( 普通白帽子  |\t\t\t        Rank:263 漏洞数:44        )\t\t \n  mark    \n     2014-10-25 07:15 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @ddy 不是应该叫腾讯吗...    \n     2014-10-25 08:33 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  @老和尚 腾讯有很多个产品，不要殃及无辜    \n     2014-10-25 09:51 |    \t\t奇虎360(乌云厂商)\t\t \n  楼主的验证方法是通过fiddler篡改了HTTPS下的JS文件内容，需要在客户端安装自签名的证书，否则无法直接修改HTTPS的通信内容，在这个前提下中间人劫持成功HTTPS并不是360的漏洞，请楼主再验证和我们沟通下，以及乌云的审核人员再review一下这个到底是不是漏洞？    \n     2014-10-25 11:24 |    \t\tB1acken \t\t\t( 普通白帽子  |\t\t\t        Rank:174 漏洞数:56        | 渣渣)\t\t \n  @奇虎360 围观    \n     2014-10-25 11:44 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @ddy 哦、你说的是qq浏览器哈、我以为你说公司的...    \n     2015-01-23 09:51 |    \t\tBMa \t\t\t( 普通白帽子  |\t\t\t        Rank:1776 漏洞数:200        )\t\t \n  @老和尚 @瘦蛟舞  怎么客观看待厂商回复？    \n     2015-03-22 12:52 |    \t\ttodaro \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:12        | 完结。)\t\t \n  @奇虎360 看不懂，厂商能给解释一下吗？http下本来就可以嗅探cookie，他这边的漏洞是想说被劫持跳转后，没有提醒用户呢？还是说可以劫持cookie？如果是在劫持下的情况，他看过那个团队的文章，他就该知道甚至是https都可以降成http继续嗅探，所以我不明白他这漏洞真是算浏览器的吗？厂商能给解释一下吗？    \n     2015-03-22 13:13 |    \t\ttodaro \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:12        | 完结。)\t\t \n  @todaro 懂了。。。。    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}