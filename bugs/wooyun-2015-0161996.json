{"id": 77676, "wybug_id": "wooyun-2015-0161996", "wybug_title": "某城市管理系统Java反序列化命令执行导致内网漫游", "wybug_corp": "建湖数字化管理系统", "wybug_author": ": )", "wybug_date": "2015-12-17 14:40", "wybug_open_date": "2016-02-01 10:51", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-01：\t细节向公众公开  简要描述： 1.内网漫游2.数据泄漏 详细说明：  一、通过Java反序列化命令执行漏洞拿到服务器权限    首先，这个洞导致很多站沦陷了。    有的站放在有公网ip的服务器上了。    有的站放在内网中，但是通过端口映射等可以在公网上访问，该类服务器通常具有内网ip。如果在公网上开启了3389端口，那么就可以直接访问，如果3389仅仅是在内网开启的，那么就不能访问。（现在只是知道有这么回事，表述的可能不是很完善。）   这个站可以在外网上开启了3389端口，所以理论上可以远程登录拿到服务器权限。测试一下是否在外网开启了3389：\ntelnet **.**.**.** 3389返回黑框框 说明开启了（如果没有开启我也不知道怎么办了 还请路过的大牛指教）\n 二、通过Java反序列化命令执行这个洞来建立一个用户+获取管理员密码。\nnet user test1 wooyun /addnet localgroup administrators test1 /add\n\n建立完用户：mstsc**.**.**.** /admin\n获取管理员密码：http://**.**.**.**/thread-264895-1-1.html\n\n三、其他  登录服务器之后直接发现内网ip的机器ip和地址都已经保存在桌面上了。- -。  查看一下敏感信息的数量，估计一下能拿多少rank，早日成为实习白帽子。>_<。  over。\n\n   漏洞证明：  内网漫游两台服务器：\n\n敏感信息泄漏：1.一张有意思的网络拓扑图，别告诉我是这台服务器所在的拓扑。- -。\n\n2.源代码+数据库备份\n\n\n\n3.移动硬盘没拔吧..\n\n数据：\n\n\n\n   修复方案：  1.Java反序列化命令执行修复2.内网口令不要直接放在桌面上3.移动硬盘拔了吧>_<   版权声明：转载请注明来源 : )@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-12-21 18:02 厂商回复： CNVD确认并复现所述情况,已经转由CNCERT下发给江苏分中心,由其后续协调网站管理单位处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-12-23 20:29 |    \t\t: ) \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:9        | 知足常乐，心态要好)\t\t \n  这里补充一下@进击的zjx 在这里 WooYun: 长城汽车协同平台反序列化命令执行（Linux相对路径写shell） 提到的Java反序列化漏洞修复方法。java反序列化命令执行临时办法：下载SerialKiller.jar后放置于classpath，将应用代码中的java.io.ObjectInputStream替换为SerialKiller，之后配置让其能够允许或禁用一些存在问题的类，SerialKiller有Hot-Reload,Whitelisting,Blacklisting几个特性，控制了外部输入反序列化后的可信类型，lib地址:https://github.com/ikkisoft/SerialKiller(仅供参考)。    \n     2015-12-23 20:36 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:1469 漏洞数:180        | 1000rank目标达成！撒花……)\t\t \n  @: ) 我也是粘贴的- -！    \n     2015-12-23 20:46 |    \t\t: ) \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:9        | 知足常乐，心态要好)\t\t \n  @进击的zjx  找不到你说的大牛...我就只好写上原文路径+方法啦~感谢~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}