{"id": 4562, "wybug_id": "wooyun-2014-049927", "wybug_title": "某通用型学校网站系统SQL注入影响大量学校网站", "wybug_corp": "某通用型学校网站系统", "wybug_author": "xfkxfk", "wybug_date": "2014-01-27 12:51", "wybug_open_date": "2014-04-27 12:52", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "逻辑错误", "安全意识不足", "白盒测试", "后台验证绕过"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-03-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-27：\t细节向公众公开  简要描述： 某通用型学校网站系统SQL注入影响大量学校网站。这个还是交给cncert国家互联网应急中心处理吧。 详细说明：  首先是从沈阳航空职业技术学院搜到的信息：\nhttp://www.syhzy.cn/\n\n\n于是按照关键字搜了一下：\n技术支持:校无忧科技\n看了用户量不小啊\n\n下载了源码看了下：Xiao5u_School_v2.1.zip看到这个文件/admin/check.asp：\nif request(\"action\")=\"login\" then   Username=trim(request(\"admin_name\"))   Password=trim(request(\"admin_pass\"))end ifIf Instr(Username,\"or\")<>0 or Instr(Password,\"or\")<>0 or Instr(Username,\"and\")<>0 or Instr(Password,\"and\")<>0Then   response.write \"<br><br><br><br><font size=2><center>没事别搞人家后台，谢谢！<br>否则一切后果自负！<br>校无忧-Www.Xiao5u.Com</font>\"elseset rs=server.createobject(\"adodb.recordset\")sql=\"select * from admin where Username='\"&Username&\"' and Password='\"&md5(Password)&\"'\"rs.open sql,conn,1,3\n从代码中看出，虽然他做了一点点的处理，但是基本上跟没处理一样，只是判断用户名和密码中是否有or和and关键字，那我们不是用大写或者大小写混合不就绕过了。本地环境测试了下，成功绕过后台登陆，后台登陆地址/admin/login.asp\n\n登陆后台后，在网站信息处，可以拿shell，文件/admin/siteconfig.asp：\nsub SaveConfig()\tIf ObjInstalled=false Then\t\tFoundErr=true\t\tErrMsg=ErrMsg & \"<br><li>你的服务器不支持 FSO(Scripting.FileSystemObject)! </li>\"\t\texit sub\tend if\tdim fso,hf\tset fso=Server.CreateObject(\"Scripting.FileSystemObject\")\tset hf=fso.CreateTextFile(Server.mappath(\"../inc/config.asp\"),true)\thf.write \"<\" & \"%\" & vbcrlf\thf.write \"Const SiteName=\" & chr(34) & trim(request(\"SiteName\")) & chr(34) & \"              '网站名称\" & vbcrlf\thf.write \"Const keywords=\" & chr(34) & trim(request(\"keywords\")) & chr(34) & \"              '关键字\" & vbcrlf\thf.write \"Const description=\" & chr(34) & trim(request(\"description\")) & chr(34) & \"           '描述\" & vbcrlf\thf.write \"Const Copyright=\" & chr(34) & InPutStr(trim(request(\"Copyright\"))) & chr(34) & \"  '版权信息\" & vbcrlf\thf.write \"%\" & \">\"\thf.close\tset hf=nothing\tset fso=nothing\tend sub\n这里没有任何过滤，直接将接收到的配置信息写入了配置文件/inc/config.asp中。\n\n来看看配置文件/inc/config.asp内容;\n\n成功写入一句话密码，拿到shell;\n\n   漏洞证明：  来两个案例证明吧：\n\n\n\n没有拿上述网站shell，没有破坏数据。影响挺大，拿shell，拿站都可以批量的，请cncert国家互联网应急中心及时处理吧。   修复方案：  加强过滤。   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2014-02-01 22:46 厂商回复： CNVD确认并复现所述多个实例情况，由CNVD尝试通过公开联系渠道协调软件生产厂商处置。涉及案例CNCERT暂未建立联系渠道，故由软件生产厂商处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-01-28 09:30 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  难道又是正方？    \n     2014-01-28 13:29 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @光刃 感觉不是。正方用得最多的是教务，这里看描述似乎不是教务，是门户之类的吧    \n     2014-01-28 13:37 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  @wefgod 奥    \n     2014-04-27 13:54 |    \t\tthatqier \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:7        | 小白一个)\t\t \n  @cncert国家互联网应急中心 ,这个问题还有好多网站存在把？    \n     2014-04-27 14:12 |    \t\tlkboboy \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 无所事事)\t\t \n  这系统貌似已经被爆过了。。不过人家是JS代码。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}