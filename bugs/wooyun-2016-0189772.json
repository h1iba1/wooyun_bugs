{"id": 86688, "wybug_id": "wooyun-2016-0189772", "wybug_title": "三方支付之钱宝命令执行漏洞/威胁十几万用户数千万资金安全/十几万银行卡、千万信用卡记录泄露", "wybug_corp": "深圳市钱宝科技服务有限公司", "wybug_author": "z_zz_zzz", "wybug_date": "2016-03-27 23:19", "wybug_open_date": "2016-05-14 18:50", "wybug_type": "系统/服务补丁不及时", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(广东省信息安全测评中心,深圳市钱宝科技服务有限公司)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程命令执行"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-04-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-14：\t细节向公众公开  简要描述： 深圳市钱宝科技服务有限公司（简称钱宝）是中国首批从事第三方支付的企业，专业提供电子支付服务和收款解决方案，主要业务为跨境外汇兑换、互联网支付（信用卡收款和海外本地收款）、银行卡收单三大产品，注册资本为1亿元人民币。总部设在深圳，在北京、上海、广州、武汉、天津、杭州、南京、济南、重庆、青岛、大连、宁波、厦门等地设有分部。公司现有超过1000名员工。服务范围覆盖中国各大中城市以及香港、澳门地区，马来西亚、菲律宾、新加坡等亚太地区国家以及美洲、欧洲和非洲。2011年以来，钱宝陆续获得由中国人民银行颁发的互联网支付牌照和银行卡收单牌照，并成为中国大陆首家Visa QSP和国家外汇管理局认可的首批跨境电子商务外汇兑换支付业务试点单位。日处理订单超过十万笔，交易量突破百亿。服务器存在命令执行漏洞，可查看用户信息、修改用户密码，严重威胁用户资金安全与隐私。 详细说明：  首先声明，我没有改数据，查数据也只查了十条左右证明漏洞存在，没有脱库，拒绝查水表。威胁如下：1.多台服务器沦陷，可内网渗透2.可操作数据库，查看或修改用户信息3.威胁十几万用户数千万资金安全4.用户重要信息泄露5.163企业邮箱信息泄露6.与银行发送交易的信息泄露7.FTP服务器存储了用户的身份证照片，进入内网后可获取钱宝的以下服务器均存在JAVA反序列化漏洞，均可控制。\n\n先来看超级账户系统，个人客户和企业客户都使用这个系统。\n\n\n\n这个是可以绑定银行卡，也可以充钱的，和支付宝一个性质\n\n连上服务器\n\nroot用户\n\n随便看看\n\n\n\n应用部署在这里，我没有传JSP上去，访问下已有的文件验证下\n\n\n\n这个文件里有163企业邮箱的信息\n\n登进邮箱瞅一眼，别的啥都没看\n\n\n\n这些文件里有和各银行的交易信息配置\n\n这个文件里有数据库信息，不过是加密的\n\n加密了怕啥，分析下代码，明文就算出来了连上数据库\n\n这个数据库的用户应该挺多的，我只看了当前用户的118个表\n\n客户银行卡信息，虽然有几位打了码，应该也能分析出来\n\n16W银行卡信息\n\n虚拟账户信息，这个虚拟账户就和支付宝账户的概念差不多的密码是保存的hash，但是没有加盐，把自己注册的用户的密码改成一个常用密码，再找hash值相同的用户，找出来一堆-.-，想登录谁的用户，改一下数据库的值就可以了。当然我没有这样做。\n\n14W用户\n\n看下账户余额\n\n444个余额大于0\n\n总数是，7146万。。。\n\n看下发送的邮件\n\n\n\n可以改别人的密码，当然也可以直接用数据库用户改了-.-发送的短信，有验证码，转账估计也不是问题了。当然我也没这样做-.-\n\n\n\n还有其他的表里有金额，不知道准不准，更吓人\n\n这个表的金额总数是，7个亿。。。我觉得是我算错了\n\n管理员信息，我没有拿这些去登录\n\n再来看看信用卡支付系统商户后台\n\n连上服务器\n\n这是另一台服务器，还是root\n\n跑了好多应用\n\n应用部署在这里，没上传JSP，一样访问现有文件验证下\n\n\n\n数据库信息也是加密的，用相同的方法解决连上数据库\n\n171个表\n\n这是另一个数据库，看看有多少用户\n\n看看信用卡记录，1000W\n\n都是国际友人\n\n这个BB的表是啥\n\n银行卡信息\n\n\n\n看看发送的邮件\n\n\n\n商户管理员\n\n再来看看其他的服务器，都可以控制\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n用户在实名认证时需要上传身份证照片，照片保存在FTP服务器中，FTP信息在某个应用的properties文件中，内网后可获取用户身份证照片，没这样做。   漏洞证明：  见详细说明   修复方案：  打补丁或者参考：修复weblogic的JAVA反序列化漏洞的多种方法http://**.**.**.**/web/13470如何控制开放HTTPS服务的weblogic服务器http://**.**.**.**/web/13681   版权声明：转载请注明来源 z_zz_zzz@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-03-30 18:43 厂商回复： 非常感谢您的报告。报告中的问题已确认并复现。影响的数据：高攻击成本：中造成影响：高综合评级为：高，rank：10正在联系相关网站管理单位处置。 最新状态： 2016-03-31：漏洞已确认，修复中  ", "replys": "漏洞评价：\n评价\n     2016-03-28 00:29 |    \t\tautO_pw \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:21        | ด้้้ด้้้้้็็็็็้้้้้...)\t\t \n  抢个1楼    \n     2016-03-28 01:27 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2016-03-30 19:47 |    \t\tz_zz_zzz \t\t\t( 普通白帽子  |\t\t\t        Rank:249 漏洞数:28        | 诸恶莫作)\t\t \n  这个，10RANK，还是少了点吧，要是被黑产先控制了呢-.-|||    \n     2016-03-30 19:53 |    \t\tjye33 \t\t\t( 普通白帽子  |\t\t\t        Rank:1141 漏洞数:257        | 没有什么能够阻挡，我对静静的向往)\t\t \n  @z_zz_zzz 这个广东省信息安全测评中心不会给白帽子很多rank的。已经不想提交那边的了    \n     2016-03-30 20:04 |    \t\tz_zz_zzz \t\t\t( 普通白帽子  |\t\t\t        Rank:249 漏洞数:28        | 诸恶莫作)\t\t \n  @jye33 原来如此，可是这个厂商就是广东的-。-    \n     2016-03-30 20:33 |    \t\tjye33 \t\t\t( 普通白帽子  |\t\t\t        Rank:1141 漏洞数:257        | 没有什么能够阻挡，我对静静的向往)\t\t \n  @z_zz_zzz广东那边的基本上不是wooyun厂商的都交给他们了    \n     2016-03-31 09:30 |    \t\t深圳市钱宝科技服务有限公司(乌云厂商)\t\t \n  @z_zz_zzz 非常感谢！这个问题非常严重，公司领导层也很重视，希望以后有长期合作的机会，是否方便提供一下个人联系方式，谢谢！    \n     2016-03-31 09:35 |    \t\tz_zz_zzz \t\t\t( 普通白帽子  |\t\t\t        Rank:249 漏洞数:28        | 诸恶莫作)\t\t \n  @深圳市钱宝科技服务有限公司 我的个人资料里有联系方式，找乌云应该可以要到吧^_^    \n     2016-03-31 09:43 |    \t\t深圳市钱宝科技服务有限公司(乌云厂商)\t\t \n  @z_zz_zzz 向wooyun索取了，不知道是否能发过来。有时间来深圳玩，我请客 ^_^。    \n     2016-03-31 09:46 |    \t\tz_zz_zzz \t\t\t( 普通白帽子  |\t\t\t        Rank:249 漏洞数:28        | 诸恶莫作)\t\t \n  @深圳市钱宝科技服务有限公司 ^_^    \n     2016-03-31 10:24 |    \t\tjye33 \t\t\t( 普通白帽子  |\t\t\t        Rank:1141 漏洞数:257        | 没有什么能够阻挡，我对静静的向往)\t\t \n  @深圳市钱宝科技服务有限公司 你们是才入住过来嘛？    \n     2016-03-31 10:29 |    \t\t深圳市钱宝科技服务有限公司(乌云厂商)\t\t \n  @jye33 见笑了，才入住的，以后多关注一下。以后来深圳可以到我们公司来坐坐，我做东。    \n     2016-03-31 10:37 |    \t\tjye33 \t\t\t( 普通白帽子  |\t\t\t        Rank:1141 漏洞数:257        | 没有什么能够阻挡，我对静静的向往)\t\t \n  @深圳市钱宝科技服务有限公司有空一定来    \n     2016-03-31 10:59 |    \t\t深圳市钱宝科技服务有限公司(乌云厂商)\t\t \n  @jye33  @z_zz_zzz 说定了，来深圳联系我，18129959990，微信也是这个。    \n     2016-03-31 11:10 |    \t\tz_zz_zzz \t\t\t( 普通白帽子  |\t\t\t        Rank:249 漏洞数:28        | 诸恶莫作)\t\t \n  @深圳市钱宝科技服务有限公司 好的^_^    \n     2016-03-31 11:22 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:2312 漏洞数:489        | 我就问，还有谁！！！！！！！！！！！！！...)\t\t \n  @z_zz_zzz 仁兄，私聊我下你qq可以吗，希望与你交流    \n     2016-03-31 11:32 |    \t\tz_zz_zzz \t\t\t( 普通白帽子  |\t\t\t        Rank:249 漏洞数:28        | 诸恶莫作)\t\t \n  @小龙 好的    \n     2016-03-31 11:41 |    \t\tjye33 \t\t\t( 普通白帽子  |\t\t\t        Rank:1141 漏洞数:257        | 没有什么能够阻挡，我对静静的向往)\t\t \n  @深圳市钱宝科技服务有限公司ok    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}