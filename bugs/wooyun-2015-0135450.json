{"id": 4247, "wybug_id": "wooyun-2015-0135450", "wybug_title": "windows版网站安全狗上传拦截bypass", "wybug_corp": "安全狗", "wybug_author": "JoyChou", "wybug_date": "2015-08-20 08:24", "wybug_open_date": "2015-08-20 09:23", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "7", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["上传", "安全狗"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-20：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 网站安全狗在win上的上传拦截绕过 详细说明：  上传代码：\n<?phpif(isset($_POST['submit'])){\t$upfile = $_FILES['file']['name'];\t$tempfile = $_FILES['file']['tmp_name'];\t$ext = trim(get_extension($upfile)); \t//var_dump($ext);\tif(in_array($ext,array('php','php3','php5','asp','asa','cer','cdx','aspx','htaccess'))){\t\tdie('Warning ! File type error..');\t}\t$savefile = $upfile;\tif(move_uploaded_file($tempfile,$savefile)){\t\tdie('Success upload. FileName: '.$savefile);\t}else{\t\tdie('Upload failed..');\t}}function get_extension($file){\treturn strtolower(substr($file, strrpos($file, '.')+1));}?><html> <body>  <form method=\"post\" action=\"#\" enctype=\"multipart/form-data\">   <input type=\"file\" name=\"file\" value=\"\"/>   <input type=\"submit\" name=\"submit\" value=\"upload\"/>  </form> </body></html>\n当上传的文件扩展名中包含一些特殊字符的时候（比如bypass.phpX，这里的X代表空格%20或其他特殊字符{%80-%99}），安全狗截取文件扩展名为phpX，并判断为合法文件，故上传成功。但是利用windows的文件名特性，存在的文件名为bypass.php，并且可以解析。   漏洞证明：  提交一个bypass.phpX，X的hex为\\x90\n\n\n\n   修复方案：  过滤含有特殊字符的扩展名   版权声明：转载请注明来源 JoyChou@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-08-20 09:23 厂商回复： 不知道提交者测试的是什么版本，这边测试完根本不存在这个问题。在较早之前的一次，也是因为取不到完整的文件名而导致绕过，之后改了方法，开发说能防住了！欢迎各位打脸，就文件名这块。另外，如果有什么疑问，欢迎私信，乐意交流。 漏洞Rank：10  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-20 15:37 |    \t\tJoyChou \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:4        | 无)\t\t \n  由于没写是win上iis版本还是apache版本，审核漏洞的也没去测windows上最新的所有版本，导致被忽略。又学习到了新姿势。不过漏洞确实存在。    \n     2015-08-21 21:16 |    \t\t猫和老鼠 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | ...)\t\t \n  安全狗渣渣一个，乌云都补RANK，看你叼。乌云RANK 都比你多，看你叼    \n     2015-08-24 09:04 |    \t\t安全狗(乌云厂商)\t\t \n  @猫和老鼠 此言差矣，欢迎来提交。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}