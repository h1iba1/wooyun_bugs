{"id": 66535, "wybug_id": "wooyun-2015-0126541", "wybug_title": "Javaweb架构分析安全之万户ezoffice全版本通杀上传GETSHELL", "wybug_corp": "ezoffice", "wybug_author": "黑暗游侠", "wybug_date": "2015-07-29 15:40", "wybug_open_date": "2015-10-30 09:26", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-09-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-30：\t细节向公众公开  简要描述： Javaweb架构分析安全之万户ezoffice全版本通杀上传GETSHELL 详细说明：  客户案例（90%），ezOffice管理系统是万户核心系统，基本上客户都会搭建该oa搭配了ezprotal或者evo，都会配套ezoffice，这系统已经属于标配了，类似买手机总得配耳机：\n公共管理与社会组织中共安徽省委办公厅安徽省人民政府固镇县人民政府内蒙古自治区政府办公厅六安市人民政府怀远县人民政府偃师市委市人民政府蚌埠市人民政府绩溪县人民政府乌海市海勃湾区人民政府新余市人民政府泾县人民政府黔南苗族布依族自治州人民政府宣城市人民政府颍上县人民政府西安市莲湖区人民政府阜阳市人民政府颍泉县人民政府武汉市蔡甸区人民政府宁国市人民政府临泉县人民政府天津静海县人民政府铜陵市人民政府阜南县人民政府广州市海珠区人民政府界首市人民政府颍州区人民政府中原区人民政府景德镇市人民政府颍东区人民政府突泉县人民政府合肥市庐阳区人民政府铜陵市铜官山区人民政府贵州省六盘水市钟山区人民政府长丰县人民政府办公室安徽省司法系统合肥市公安局亳州市公安局安徽省人民检察院蚌埠市公安局河南省森林公安局安徽省监狱管理局淮南市公安局马鞍山市公安局交警支队河南省公安厅安庆市公安局安徽省劳教局江西省公安厅池州市公安局合肥市未管所陕西省公安厅马鞍山市公安局武警安徽省总队安徽省水利厅安徽省财政厅安徽省交通运输厅新疆水利厅铜陵市财政局黑龙江省公路局河南省水利厅蒙城县财政局济南市公路局江西省水利厅无为县财政局合肥市公路局山西汾河灌溉管理局涡阳县财政局安庆市公路工程处甘肃省景泰川电力提灌管理局宣城市宣州区财政局宿松县建设局安徽省物价局安徽省科技厅三亚市国土局湖北省物价局安徽省农业委员会蚌埠市国土局铜陵市物价局安徽省农垦事业管理局滁州市国土局内蒙统战部山西粮食局阜阳市国土局邢台统计局鄂尔多斯林业局宣城市国土局怀宁县劳动局太湖县林业局安庆市国土局阜阳市招标局桐城市农委定远县国土局黑龙江海事局国家级合肥经济技术开发区管委会安徽省工商联（总商会）安徽省政府金融工作办公室烟台海事局芜湖市鸠江经济开发区管委会安徽省食品药品监督管理局蚌埠市高新区管理委员会湖北省质量技术监督局交通运输部广州打捞局阜阳开发区管委会湖南省保险行业协会交通运输部救助打捞局全椒县经济开发区管委会中国保险监督管理委员会广东监管局交通运输部北海救助局六安市叶集区改革发展试验区管委会中国保险监督管理委员会深圳监管局交通运输部烟台打捞局九华山风景区管理委员会广东保监局汕头监管分局交通运输部上海打捞局襄阳高新区管委会江苏保监局安徽省蚌埠市蚌埠交通局长沙经济开发区江苏标准化研究院广州白云区交通管理局广州市荔湾区人民政府逢源街道办事处安徽省舒城县工商行政管理局株洲市交通委贵州省电子政务中心江苏省产品质量监督检验中心所广州市人民政府参事室文史馆中共邳州市信访局西藏县级政务中国航天员科研训练中心宁国市经信委湖北省民族委中共六盘水纪律检查委员会 六盘水市监察局宣城市经信委柳州市计生委中国农业机械化科学研究院长白山旅游局广州市妇女联合会北京注册会计师协会山东临沂供销社广西壮族自治区人口和计划生育委员会山西省劳教（戒毒）局上海市环境监察总队新余市孔目江生态经济区 新余仙女湖风景名胜区管委会 新余分宜县政府 新余高新技术产业开发区管委会新余市渝水区政府驻旌德县政府叶集试验区管委会安徽省食品药品监督管理局铜陵市政府新余市直党委群团长沙市芙蓉区政府安庆市政府沙河市政府安徽省粮食局 晋城市煤炭管理局湖北省沙洋陈家山监狱丹东边境经济合作区赣州市公安局灌南县政府安徽省淮河河道管理局铜陵市交通运输局河池市农业机械化管理局湘西土家族苗族自治州经济和信息化委员会六安金安区政府金寨县政府阜阳市公安局 南昌市水务局 国家建筑城建机械质量监督检验中心湖北省供销合作总社江西省住房和城乡建设厅通辽市政府阜阳市政府蒙城县人大常委会办公室临汾市住房公积金管理中心郎溪县政府舒城县政府蚌埠市龙子湖区政府焦作市公安局南京江宁（国家）经济开发区管委会沈阳红海滩管委会长沙市天心区金盆岭街道办事处河南省公安厅贵州钟山区人民政府阜阳市司法局云南省教育厅内蒙古司法厅安徽保监局安庆市财政局濮阳市公安局铜陵市公共资源交易监督管理局江西省公安厅交通警察总队新疆维吾尔自治区高级人民法院江西省国有资产监督管理委员会呼和浩特市住房保障和房屋管理局首都机场街道办事处广东省兴宁市财政局北京市人民政府国有资产监督管理委员会安徽省六安市公安局内蒙古司法厅内蒙古民政厅黑龙江省环保厅安徽池州市政府湖北大冶市财政局江西省检察院天津市中小企业管理局唐山市住房公积金管理中心滁州市重点项目建设办公室安徽省食品药品审评认证中心新余高新技术产业开发区新余市仙女湖风景名胜区信息化工作领导小组办公室中国民用航空华东地区空中交通管理局安徽分局卫生、社会福利与社会保障上海市肺科医院湖南湘雅医院安徽省卫生厅上海市口腔病防治院安徽省立医院山西省卫生厅普陀区中心医院安徽医科大学第一附属医院内蒙古自治区卫生厅复旦大学附属眼耳鼻喉科医院蚌埠市第三人民医院鄂尔多斯市卫生局复旦大学附属肿瘤医院蚌埠医学院第一附属医院宣城市卫生局上海质子重离子医院宁国市人民医院淮北市卫生局北京市昌平区医院淮北市人民医院首都医科大学附属北京口腔医院宣城市中心医院阜阳市卫生局天津市第一中心医院铜陵市人民医院阜阳市颍上县卫生局天津北辰医院常州市第一人民医院阜阳市临泉县卫生局山西红十字口腔医院常州市儿童医院阜阳市颍州区卫生局山西医科大学第二医院常州市中心血站阜阳市民政局山西省潞安集团总医院泰安市中心医院巴东县政府扶贫办浙江省新华医院昆山市第一人民医院广西壮族自治区房改办重庆国宾医院大同市第三人民医院蚌埠市人力资源与社会保障局湖北省十堰市太和医院兖州第一人民医院涡阳县人力资源与社会保障局宁夏回族自治区人民医院朝阳中心医院重庆市石柱县人力资源和社会保障局黑龙江省农垦宝泉岭管理局中心医院温州职业技能鉴定中心广州市健康教育所内蒙古赤峰学院附属医院湘西州住房公积金管理中心广东省职业病防治院赤峰学院第二附属医院北京住房公积金管理中心广东省工伤康复中心中国中医科学院基础理论研究所乌鲁木齐高新区高新技术创业服务中心广州市海珠区疾病预防控制中心济南银丰医学检验中心山西红十字口腔医院中国福利会国际和平妇幼保健院长沙市第四医院 常州武进区卫生局莱芜市人民医院复旦大学附属华东医院上海市精神卫生中心中国发展研究基金会上海中医药大学附属岳阳中西医结合医院常州市妇幼保健院十堰郧县人民医院惠州市中大惠亚医院珠海市第二人民医院上海市中西医结合医院浙江大学医学院附属义乌医院界首市卫生局上海市浦东新区人民医院上海市公共卫生临床中心复旦大学附属儿科医院连云港市第二人民医院复旦大学附属眼耳鼻喉科医院上海市嘉定区妇幼保健院黄石市中心医院南阳医专第一附属医院上海市同仁医院十堰房县人民医院右江民族医学院附属医院上海市第六人民医院东院安徽医科大学附属巢湖医院湖南雅美医疗美容医院有限公司北京市海淀医院山西省疾病预防控制中心湖北黄石中心医院文化体育与娱乐国家图书馆安徽省新闻出版局蚌埠电视台安徽省广播电影电视局解放军出版社安庆人民广播电台延庆县文化委员会安徽日报报业集团增城市广播电视台安徽省体育局解放日报报业集团枞阳县广播电视中心广州市地方志编纂委员办公室山西省出版集团北京大学会议中心荔湾区文化广电新闻出版局江苏赢天下传播有限公司北京光影梦幻城市发展有限公司湖南经视文化传播有限公司南京新与力文化传播有限公司北京亿阳万泰文化传播有限公司中广有线芜湖分公司安徽华伦国际文化发展有限公司北京国一金典文化传播有限公司安徽高速传媒有限公司安徽妙道山旅游开发有限公司北京数字光魔影院管理有限公司建荣皇家海洋科普世界（沈阳）有限公司保利文化集团股份有限公司北京鸿华绿苑运动休闲中心有限公司湖南新活动传媒有限公司兴隆文化园海南海视旅游卫视传媒有限责任公司北京华奥信客国际文化传播有限公司吉视传媒股份有限公司内蒙古医科大学天津市委党校富龙控股北京长城沃美电影院线有限公司河北旅投集团山东星火国际传媒集团有限公司江苏新华报业传媒集团中国石油报社建筑业中国铁建港航局集团有限公司北京新奥混凝土集团有限公司山西西山金城建筑有限公司合肥建设投资控股（集团）有限公司北京新航建材集团有限公司山西西山金信建筑有限公司合肥市公路桥梁工程有限公司北京沈飞铝业幕墙工程有限公司湖南金沙路桥建设有限公司宁国华普建材股份有限公司北京一统木业集团有限公司广州珠江装修工程有限公司上海新塔星石材发展有限公司北京灵驰海岳装饰工程有限公司重庆市基础工程有限公司杭州荣帮基础工程有限公司哈尔滨龙庆钢构彩板有限公司成都市第三建筑工程有限公司江苏宝利沥青股份有限公司沈阳益佳家保温工程有限公司新疆南天城建（集团）股份有限公司环发建设工程有限公司奥来国信（北京）工程材料检测有限责任公司内蒙古金宇集团股份有限公司北京五洲环球装饰工程设计有限公司广东泰恒高速公路发展有限公司江西省建筑材料工业科学研究设计院长沙市公路桥梁建设有限责任公司四川茂晖建工集团有限公司湖北中交咸通高速公路有限公司北京清尚建筑装饰工程有限公司三亚市海棠湾开发建设有限公司上海明联建设工程有限公司中国对外建设华东分公司山东纳美安装饰工程有限公司合肥宝光建材有限公司安徽铜陵盛友实业有限公司湖北中能浩天建筑工程有限公司房地产业浙江圣大建设集团安徽分公司福建兴万祥集团上海城市商业集团有限公司安徽蓝鼎置地有限公司佛山市宝盈房地产开发有限公司上海嘉鹏置业有限公司安徽瑞沅置地有限公司佛山市南海海逸锦绣蓝湾房地产开发有限公司上海君庭置业有限公司安徽盛通置业股份有限公司北京广安置业投资公司上海大发房地产集团有限公司安徽省中奥博联房地产投资咨询有限公司北京华远房地产经纪有限公司上海天昱通房地产开发有限责任公司合肥鹏远住宅工业有限公司山西铭基房地产开发有限公司浙江汇经控股有限公司合肥蓝盛置业有限公司山西智诚房地产开发有限公司黑龙江学伟集团利港置业发展（合肥）有限公司山东中润投资控股集团股份有限公司黑龙江禹泰房地产开发有限责任公司信地置业（合肥）有限公司十堰万隆基房地产开发有限公司哈尔滨亚麻房地产开发公司淮南民生置业有限公司东方华峰控股有限公司利嘉置业有限公司湖南运达实业集团有限公司重庆中鹏实业有限公司嘉兴亿联置业有限公司陕西安康兴科集团济宁唐宁置业有限公司湖北大都地产集团有限公司安徽亚夏投资有限公司湖北恒大置业有限公司曹县恒吉置业有限公司大连福佳集团湖南湘体置业有限公司三亚嘉鹏科技发展有限公司江苏元龙房地产开发有限公司重庆兆德投资有限公司安徽金大地投资控股有限公司安徽三联实业发展有限公司扬州博润实业发展有限公司中建地产辽宁置业有限公司全椒多金房地产开发有限公司湖南裕田奥特莱斯置业有限公司大庆市承宁房地产开发有限公司山西铭基房地产开发有限公司湖北恒大置业有限公司采矿业紫金矿业集团股份有限公司山东招金集团有限公司淮南矿业集团焦作煤业（集团）有限责任公司靖远煤业集团有限责任公司山西西山煤电（集团）有限责任公司西山煤电(集团)有限责任公司化工厂山西西山煤电股份有限公司镇城底矿山西西山煤电股份有限公司太原选煤厂山西西山煤电股份有限公司山西西山煤电股份有限公司西铭矿山西西山煤电股份有限公司屯兰矿选煤厂山西吕梁西山德威矿业管理有限公司山西西山煤电股份有限公司马兰矿山西西山煤电股份有限公司马兰矿选煤厂鸡西市华丰洗煤集团有限公司西山煤电（集团）公司屯兰矿山西西山煤电股份有限公司西曲矿选煤厂山西大土河焦化有限责任公司山西焦煤集团有限责任公司杜儿坪矿山西西山煤电股份有限公司西铭矿选煤厂昌兴矿业（中国）有限公司山西焦煤集团有限责任公司东曲煤矿山西汾西新峪煤业有限责任公司洗煤厂潞安华亿实业有限公司山西西山煤电股份有限公司西曲矿同煤浙能麻家梁煤业有限责任公司七台河宝泰隆煤化工股份有限公司山西潞安矿业（集团）公司李村煤矿河北峰峰集团南京云海特种金属股份有限公司北京黔中盛华投资发展有限公司慈林煤业有限公司山西汾西新峪煤业有限公司洗煤厂山西鑫飞能源投资集团有限公司同煤浙能麻家梁煤业有限公司郭庄煤业有限责任公司山西煤炭运销集团大同有限公司党委工作部福建省新华都工程有限责任公司北票市富贵鸟矿业有限公司山西潞安集团古城煤矿武汉承力程技股份有限公司中石化江汉石油工程有限公司制造(电器机械及器材制造)松下系统网络科技(珠海)有限公司河南新飞电器有限公司广东富华工程机械制造有限公司许继电源有限公司深圳拓邦股份有限公司中科风电（北京）有限公司上海人民企业集团深圳感臻科技有限公司北京亿力新能源股份有限公司朗松珂利（上海）仪器仪表有限公司深圳圣美歌科技有限公司格力电器（武汉）有限公司上海汇益控制系统股份有限公司深圳哈里通实业有限公司东莞栢能电子科技有限公司安徽莱恩电泵有限公司浙江新龙实业有限公司广州大百信电子科技有限公司格力电器（合肥）有限公司杭州银湖电气设备有限公司杭州银湖电气设备有限公司广东海博威视电子科技股份有限公司合肥华耀电子工业有限公司江苏通盛换热器有限公司威海克莱特菲尔风机股份有限公司合肥晶弘电器有限公司洛阳润奥电气有限公司圣航科技股份有限公司合肥天鹅制冷科技有限公司镇江环太硅科技有限公司重庆虎溪电机工业有限责任公司淮南万泰电子股份有限公司东营滨龙机电有限公司山东山大华天科技股份有限公司合肥荣事达太阳能科技有限公司贵州航天电器有限公司广东申菱空调设备有限公司山西泰宝密封有限公司杭州鸿世电器有限公司沈阳东北机电五金城广元市世畅科技有限公司深圳拓邦股份有限公司制造(医药)江苏恒瑞医药股份有限公司山东绿叶制药集团陕西盘龙制药集团有限公司江苏康缘药业股份有限公司杭州民生药业集团有限公司慈铭健康体检管理集团股份有限公司上海海嘉诺医药发展股份有限公司浙江众益药业有限公司北京万特尔生物制药有限公司长春迪瑞医疗科技股份有限公司宿州华康医药集团百济神州（北京）生物科技有限公司广东信东医药有限责任公司同路生物制药股份有限公司兰州生物制药厂中国医学科学院药物研究所广东腾骏动物药业股份有限公司中国药科大学制药有限公司哈药集团股份有限公司合肥亿帆生物医药有限公司制造(汽车)上海汽车工业销售公司东风汽车股份有限公司安徽安凯福田曙光车桥有限公司上海瑞尔实业有限公司中国重汽集团济南动力有限公司安徽江淮专用汽车有限公司浙江永源汽车有限公司中联重科股份有限公司合肥美桥汽车传动及底盘系统有限公司南京金龙客车制造有限公司重庆市嘉陵川江汽车制造有限公司合肥云鹤江森汽车座椅有限公司吉林希尔工贸有限责任公司襄阳光瑞汽车零部件有限公司合肥客车制造有限责任公司芜湖中集瑞江汽车有限公司潍柴动力股份有限公司潍柴动力上海分公司山东重工集团有限公司重庆潍柴发动机厂山东山推机械有限公司山东山重建机有限公司扬州亚星客车股份有限公司广州市龙星行汽车销售服务有限公司陕西重型汽车有限公司制造(机械)中国福马机械集团有限公司镇江中福马机械有限公司山重建机有限公司唐山齿轮集团有限公司苏福马机械有限公司河南三联科技工程有限公司江苏林海动力机械集团公司华电曹妃甸重工装备有限公司内蒙古神舟硅业有限责任公司合肥神马科技股份有限公司天津华电重工机械有限公司中国浦发机械工业股份有限公司百事德机械（江苏）有限公司山河智能装备股份有限公司北京云海矿山工程技术有限公司南京埃斯顿自动控制技术有限公司安徽江淮银联重型工程机械有限公司北京爱捷洲际科技有限公司南京华狮化工有限公司安徽巨一自动化装备有限公司北京东方瑞澳医疗设备有限公司苏州胜利精密制造科技股份有限公司芜湖爱瑞特环保科技有限公司北京朗波尔集团常熟市龙腾特种钢有限公司芜湖海螺型材科技股份有限公司广州金升阳科技有限公司晋西机器工业集团有限责任公司泰富国际工程有限公司广州贝晓德传动配套有限公司湖南昱升工程机械有限公司栖霞中泰环保设备有限公司东莞百乐仕汽车精密配件有限公司大连华锐重工集团股份有限公司长沙中联重工科技有限公司陕西重型汽车潍柴动力扬州柴油机有限责任公司沈阳机床集团山河智能装备股份有限公司制造(其它)广西柳州钢铁（集团）公司铜化集团全力集团安徽淮化集团公司山西昆明烟草有限责任公司上海广电富士光电材料有限公司安利合成革股份有限公司北京首钢股份有限公司焦化厂上海市华信能源控股有限公司安徽宁国中鼎密封件有限公司北京三仁宝业科技发展有限公司上海昌辉投资管理（集团）有限公司合肥力威汽车油泵有限公司北京佰依们服饰有限公司上海唯成电子科技有限公司安徽晋煤中能化工股份有限公司北京东华银海印刷有限公司上海森林特种钢门有限公司安徽国通高新管业股份有限公司广东省工业设备安装公司上海众俊智能科技有限公司（亚芯电子）安徽华普节能材料股份有限公司广州中大环境治工程有限公司上海斯买特实业有限公司安庆横江实业（集团）公司广州秀珀化工股份有限公司上海源天野营旅游用品制造有限公司安庆南风日化有限责任公司中山市西威厨房设备制造有限公司江苏申特钢铁有限公司铜陵市铜官山化工有限公司广州陶一郎陶瓷有限公司湖南御泥坊化妆品有限公司铜陵江威精密制造有限公司浙江大自然鞋业有限公司陕西欣雅纸业有限公司黄山杜邦华佳化工有限公司浙江永康哈尔斯真空器皿股份有限公司陕西斯达煤矿安全装备有限公司黄山永佳集团有限公司兰州海红技术股份有限公司连云港中钢石英公司黄山永新股份有限公司山东国瓷功能材料有限公司七台河隆鹏集团栖霞中泰环保设备有限公司蓝格包装材料有限公司天津市天变阳光变压器有限公司长沙新振升集团有限公司闼闼同创工贸有限责任公司安徽中烟再造烟叶科技有限责任公司广州泰李汽车座椅有限公司山西中通管业有限公司香港雅都实业有限公司江苏德帮化学工业集团有限公司新东岳集团有限公司安徽天地人塑胶有限公司天津中环半导体股份有限公司世仓物流设备（上海）有限公司武汉世纪宇峰厨房设备工程有限公司威特电梯部件（苏州）有限公司山东金能科技有限责任公司新疆五鑫铜业有限责任公司 重庆华联卫生用品有限责任公司达亚帆布（上海）有限公司鑫广绿环再生资源股份有限公司广州百视通眼镜超市有限公司北京汇众实业总公司宁波南海化学有限公司常德芙蓉烟叶复烤有限责任公司南京中钞长城金融设备有限公司河北凯跃化工集团有限公司深圳紫金环球金属交易中心中谷琪珑集团有限公司电力、燃气、供水业河北水务集团大唐集团安徽分公司中油首汽石油销售有限公司宁波市自来水总公司大唐陈村水力发电厂上海浦航石油有限公司太原市自来水公司大唐淮北发电厂万向加油站瑞安市市区自来水公司大唐淮南田家庵发电厂山西煤炭运销集团有限公司楚源水电投资集团有限公司大唐安庆生物质能发电有限公司湖北省煤炭投资开发有限公司甘肃省天祝藏族自治县电力局马鞍山当涂发电有限公司安徽省天然气开发有限责任公司中机国能电力工程有限公司皖能（合肥）发电有限公司成都深燃天然气有限公司华润电力控股有限公司河南分公司皖能集团马鞍山电力公司马鞍山港华燃气公司富裕县富鹤供热公司广东宝丽华电力有限公司湖北能源集团股份有限公司黑龙江星辰热力发展股份有限公司中国庆华能源集团有限公司山东渤海油脂工业有限公司湖南泰通电力科技有限公司安徽省能源集团有限公司齐鲁石化济南办事处博思特能源装备（天津）股份有限公司北京三兴汇生石油科技有限公司安徽驰纬电气有限公司山西南方川建电力有限公司常州港华燃气有限公司皖能铜陵发电有限公司皖能合肥发电有限公司淮北国安电力有限公司科学研究、技术服务、地质勘查业中国船舶重工集团第七二五研究所北京市测绘设计研究院内蒙古自治区科学技术协会中国计量科技研究院北京奥瑞安能源技术开发有限公司新疆华瀚智能系统工程有限公司中国科学院地理科学与资源研究所北京蓝天大地生物技术开发有限公司山西三佳新能源科技集团有限公司中包包装研究院有限公司北京长城华冠汽车技术开发有限公司成都森龙信息科技有限责任公司中国烟草总公司合肥设计院北京卓泰天下科技有限公司太原市慧友科贸有限公司广东海事局海测大队捷思锐科技（北京）有限公司青岛太平洋海洋工程有限公司广州机械科学研究院东方蓝天钛金科技有限公司河南信安通信技术有限公司广州市白云区科学技术局惠州市易道科技有限公司上海前山管道技术有限公司浙江伟明集团青岛太平洋海洋工程有限公司上海力信电气技术有限公司河南航天液压气动技术有限公司国电四维北京易科路通铁道设备有限公司苏州嘉图信息技术有限公司金电联行（北京）信息技术有限公司北京突破电气有限公司湖南省核工业地质局放射性核素检测中心上海上阳流体科技有限公司辽宁邮电规划设计院重庆中科盛弘科技集团有限公司安徽格图通讯系统工程有限公司安徽国祯环保节能科技股份有限公司武汉大功率机车检修段深圳市捷顺科技实业股份有限公司交通运输、仓储邮政业中国海洋航空集团公司中联理货有限公司上海春秋航空有限公司北京首汽（集团）股份有限公司广西壮族自治区港航管理局上海外高桥国际物流有限公司中铁联合物流股份有限公司郴州市道路运输管理处上海铁路局合肥供电段中海集装箱运输股份有限公司江苏高速公路联网营运管理有限公司西安铁路局安康车辆段中海船务代理有限公司江苏大丰海港控股集团有限公司武汉铁路局武昌客车段沪杭甬高速公路股份有限公司江苏新天国际货运代理有限公司深圳市盐田港集团有限公司芜湖港储运股份有限公司江苏启东道达重工（集团）有限公司深圳华强供应链管理有限公司合肥城市轨道交通有限公司南京远洋运输股份有限公司广州南沙港务有限公司蚌埠市交通投资集团有限公司苏州中集国际供应链有限公司广州市卓志物流服务有限公司蚌埠市蚌固一级公路开发有限公司苏州天天物流有限公司广州港南沙港务有限公司安徽迅捷物流有限责任公司苏州港太仓区美锦码头广东华路交通科技有限公司宿州汽车运输有限公司太仓港正和集装箱码头有限公司广东合捷国际供应链公司北京大白熊商务航空有限责任公司泰州兴舟船舶科技有限公司东莞华利运输集团有限公司嘉友国际物流(北京)有限公司镇江港大港港区四期工程码头宁波光明码头有限公司西北民航机场建设责任有限公司镇江港务集团有限公司宁波港兴国际货运代理有限公司烟台中联物流园有限公司内蒙古华蒙通物流控股有限公司重庆万州机场有限责任公司西山煤电(集团)有限责任公司铁路公司江西国中安智物流有限公司北京汉宇航空有限公司天津市鹏峰汽车贸易有限公司天津中运海运集团有限公司聊城交运集团有限公司日照港股份有限公司长春客运中心华蒙通物流控股有限公司安徽皖江物流集团股份有限公司金融业银联商务有限公司渤海证券股份有限公司中信银行中煤财产保险股份有限公司爱建证券有限责任公司齐鲁银行股份有限公司安徽国元信托投资有限责任公司无锡华英证券有限公司招商信诺人寿保险有限公司合肥华安证券有限公司开源证券有限公司中国民生银行武汉分行安徽和县农村信用合作联社上海银商资讯有限公司人民银行内蒙古阿拉善中心支行蚌埠投资集团上海润邦投资集团有限公司中国工商银行德州分行安徽嘉润投资控股集团有限公司筑玖投资发展（上海）有限公司泌阳县农信社北京全唐投资管理有限公司上海三林投资发展有限公司东莞市农村信用合作联社北京金力控股集团有限公司上海付费通信息服务有限公司肥东县农村信用合作联社北京汽车财务集团有限公司广州市鹏融投资管理有限公司天津滨海银行北京中硕投资担保有限公司大业信托有限责任公司东莞农村商业银行股份有限公司北京金汇兴业投资管理有限公司佛山市南海区联诚投资发展有限公司安徽省农村信用社联合社中城福润（北京）投资控股有限公司广东东创投资控股有限公司安徽岳西农村合作银行沈阳市沈北新区华泰小额贷款有限责任公司广州壹马交通投资有限公司绩溪县农村商业银行江苏永隆资产管理有限公司滨海投资（天津）有限公司江苏民丰农商银行南京圣和投资集团天津渤海海胜股权投资基金管理有限公司湖南省保障性安居工程投资有限公司 湖南长海投资置业控股集团有限公司四川天坤投资管理有限公司湖南富兴集团有限公司武汉名道资源投资控股有限公司江苏润扬投资管理股份有限公司深圳市红岭创投电子商务股份有限公司和乔集团慧金商业保理（上海）有限公司中国保险信息技术管理有限责任公司通联支付网络服务股份有限公司黑龙江农村信用社哈尔滨汇丽投资有限公司新余市城市建设投资集团有限公司湖南豪瑞投资开发有限公司湖南波隆投资集团股份有限公司北京文化科技融资担保有限公司硅谷天堂资产管理集团股份有限公司安徽东辰投资有限公司安徽省投资集团控股有限公司爱建证券有限责任公司蒙城农村商业银行含山农村商业银行深圳市瑞达投资有限公司东莞农村商业银行股份有限公司北京保利剧院管理有限公司中央国债登记结算有限责任公司北京昭德投资有限公司上海红歆财富投资管理有限公司中原银行天津市北辰区农村信用合作社制造(农副食品、食品、饮料)内蒙古伊利实业集团股份有限公司光明乳业股份有限公司李锦记健康食品集团（无限极（中国）有限公司）安徽中烟再造烟叶科技有限责任公司富氏食品（中国）有限公司华嘉食品有限公司安徽达诺乳业有限公司华润雪花啤酒（山东、滨州、聊城）有限公司浙江省粮油食品进出口股份有限公司宣酒集团重庆有友实业有限公司安徽真心食品有限公司江苏汤沟两相和酒业有限公司四川易泰多科技有限责任公司安徽阿幸食品有限公司朗源股份有限公司上海市农产品质量安全中心安徽詹氏食品有限公司武汉亚太调味食品有限公司安徽溜溜果园科技有限公司安徽汤臣倍健保健品推广服务有限公司武汉仟吉食品有限公司安徽金禾实业股份有限公司亳州良夫面粉厂北京二商集团有限责任公司内蒙古圣牧高科牧业有限公司内蒙古民丰薯业有限公司哈尔滨天手食品有限公司味好美（武汉）食品有限公司买买酒信息传输、计算机服务与软件业东方电子集团有限公司话机世界数码连锁集团股份有限公司西藏电信北京乐语世纪科技集团有限公司上海家有购物商务有限公司西藏电信二级单位北京网聘咨询有限公司上海感信信息科技有限公司安徽四创电子股份有限公司鹏博士电信传媒集团南京吉隆光纤通信有限公司重庆市农产品集团电子商务有限公司兴唐通信有限公司南京丰盛新能源科技股份有限公司世纪龙信息网络有限责任公司北京迪特卡得通信设备有限公司联通时科（北京）信息技术科技有限公司深圳锐明视讯技术有限公司北京福星晓程电子科技股份有限公司北京宏泰博科信息技术有限公司深圳市捷电科技有限公司北京天威诚信电子商务服务有限公司北京目标在线科技有限公司广东中南元建网络工程有限公司北京千橡网景科技发展有限公司博涛同创（北京）科技有限公司广州中望龙腾软件股份有限公司广州市景览数码科技有限公司武汉三力通信有限责任公司研祥智能科技股份有限公司长沙凯能数码科技有限公司 中国铁通集团安徽分公司山东路科公路信息咨询有限公司云南南天电子信息产业股份有限公司北京日升天信科技股份有限公司云南龙达网络信息科技有限公司水利、环境与公共设施管理浙江盾安控股集团有限公司湖南水总水利水电建设有限公司北京北科环境工程有限公司安徽国祯集团股份有限公司湖南凯天环保科技股份有限公司北京中电联环保工程有限公司长沙市富安再生资源有限公司湖南华宇水利水电建设工程有限公司肇庆高新区粤海水务有限公司平湖市水利局武汉云峰再生资源有限公司安徽盛运环保工程有限公司皖能环保有限公司安徽金大地商业管理公司温州生态园管委会安徽蒙城经济开发区安徽省墙体材料革新和建筑节能领导小组办公室湖南省水利水电第一工程有限公司四川林盛装饰设计工程有限公司农林牧渔北京顺鑫农业股份公司合肥丰乐种业股份有限公司佛山满堂和顺茶文化有限公司北大荒垦丰种业股份有限公司安徽天达饲料集团上海市川东农场山东金正大生态工程股份有限公司安徽一笑堂茶业有限公司上海农业信息有限公司重庆千帆园林景观工程有限公司安徽恩龙园林股份有限公司中国吉林森工集团制造(服装)上海美特斯邦威服饰股份有限公司红豆集团福建才子集团有限公司北京佰依们服饰有限公司江苏海澜集团公司卡宾服饰（中国）有限公司重庆市名瑞服饰连锁有限公司上海拉夏贝尔服饰股份有限公司福建省优拓贸易有限公司（华美）达利丝绸（浙江）有限公司杭州光凯服饰有限公司广州市双鱼体育用品集团有限公司大宇（集团）布业有限公司卓尚服饰（杭州）有限公司广州今誉服饰有限公司安徽鸿润（集团）股份有限公司浙江婉甸服饰有限公司广州市索典服饰有限公司安徽华茂集团上海慕丰实业有限公司东莞市新思路内衣有限公司泉州海博贸易有限公司广州市格风服饰有限公司快鱼服饰有限公司广东博斯服饰实业有限公司江苏红豆实业股份有限公司广州市皑如服装设计有限公司凯纳尔国际贸易有限公司湖南梦洁家纺股份有限公司重庆蓝蝶服饰有限公司教育云南省教育厅铁道部党校哈尔滨理工大学丽水市教育局中共安徽省委党校西安交大武汉市洪山区教育局淮北师范大学湖北省工业大学温州市瓯海区教育局安徽天象集团温州科技职业学院温州市龙湾区教育局安徽师范大学附属小学南通纺织职业技术学院温州市鹿城教育局芜湖一中广州松田职业学院台州市教育局安庆二中广东岭南职业技术学院安庆市迎江区教育局安庆四中广东省电子信息技工学校亳州谯城区教育局安庆职业技术学院云浮市技工学校潜山县文化局枞阳县会宫中学广州市海珠区树华美术培训中心广州市青年文化宫哈尔滨华德学院广州市第一一三中学广州市教育研究所哈尔滨市汽车驾驶学校华中科技大学远程与继续教育学院保利影业投资有限公司沈阳楷博教育培训学校中国戏曲学院附属中等戏曲学校北京神墨教育机构北京世纪明德教育科技有限公司北京尚德智业教育咨询中心成功之道教育机构北京二十一世纪金星教育科技有限公司北京市崇文区职工大学东方国际教育交流中心苏州大学浙江省温州市教育网络工程有限公司青海卫生职业技术学院宁波工程学院吉林大学天津青年职业学院乌鲁木齐头屯河区教育局哈尔滨体育学院太原大学温州市教育局常州旅游商贸高等职业技术学校居民服务与其他服务都江堰农产品交易中心山西同至人劳务派遣服务有限公司上海米岚城市奥莱企业管理有限公司济南宏泰物业有限公司昆山商厦股份有限公司纳玛特康而健健身(上海)有限公司广州市天河供用站运城市盐湖区宇翔广告有限公司北京京龙大厦物业管理有限责任公司北京华联集团租赁和商务服务业天一金行贵金属经营有限公司九华山旅游股份有限公司上海申通地铁资产经营管理有限公司狮桥融资租赁（中国）有限公司中山市旅游集团有限公司武汉国有资产经营公司山西荣昌盛投资有限公司河南中原铁道旅游集团有限责任公司鑫城国有资产有限公司山东大唐物业管理有限公司安徽好之旅国际旅行社有限公司江苏东恒国际集团有限公司山东文康商贸有限公司安徽三户装饰江苏中住物业服务开发有限公司北京奥之杰汽车服务中心合肥创和资产管理有限责任公司上海同济工程咨询有限公司北京泰格斯特国际展览展示有限公司桐城市太阳城购物中心上海豫园旅游商城股份有限公司北京中润达会计事务所有限公司深圳市森美丽服装连锁店有限公司上海旗威投资管理有限公司浙江东方神州珠宝有限公司广州注意力公关顾问有限公司唐山盛世国际汽车园发展有限公司嘉丽购物有限责任公司广州法德美化妆品有限公司哈尔滨家得乐商贸有限公司上海春秋国际旅行社有限公司湖北华垚拍卖有限公司天津市诚信招标有限公司成都博朗房地产营销策划有限公司太原新西城购物广场有限公司保利香港拍卖有限公司四川众望安全环保技术咨询有限公司山东省银河伟业物业管理公司廊坊市新朝阳购物中心惠州市丽日购物广场安徽大胜集团 泰安中泰金桥商业管理有限公司黄山中海国际旅行社管理公司北京汉思科营销策划有限责任公司上海分公司上海渥德酒店管理有限公司艾迪能新科（北京）油气技术有限公司嘉实（厦门）融资租赁有限公司浙江高乐旅游文化产业有限公司工银安盛人寿保险有限公司住宿与餐饮业宁夏华祺饭店有限公司深圳万味源餐饮管理有限公司浙江湖州老娘舅餐饮管理有限公司北京天开瑞祥不老山庄山东神龟餐饮管理有限公司新疆乌鲁木齐阳光酒店批发与零售业浙江宝利德控股集团有限公司中国进口汽车贸易有限公司上海嗳呵母婴用品国际贸易有限公司合肥周谷堆农产品批发市场股份有限公司上海行家商贸有限公司上海嗳蓓錇化妆品有限公司无锡市吉丰贸易有限公司北京天凯力邦贸易有限责任公司佛山市顺德区爱护商贸有限公司哈尔滨鑫天翔电气设备经销有限公司武汉凯成国际贸易有限公司上海汽车工业销售有限公司湖北银丰实业集团上海卓恒生物科技有限公司安徽腾辉投资集团有限公司广东俊诚汽车集团股份有限公司浙江省五金矿产进出口有限公司山西西山煤电贸易有限责任公司内蒙古华元医药有限公司怡景丽家市场开发有限公司广东罗浮宫家居集团济南华联商厦集团股份有限公司\n   漏洞证明：  ezOffice分政务版和企业版你用了ezportal+ezoffice或者ezflow+ezoffice要搞清楚的是各个系统并不是在同一台服务器上，可能分布在2台不同的服务器上你拿下了ezportal不一定shell也有ezoffice，反向同理不过核心平台的shell拿下，各种oa、敏感信息、配置文件都会泄露可以内网漫游了具体可以参考我下一个漏洞（对某核心宽带的内网漫游，也算是对该通用的一个实际攻击案例的重放）本次漏洞过程还是从ezOfiice的架构设计出发官网的介绍：\n运行在windows、linux、unix、AIX、solaris等多种操作系统上、支持IBM websphere、ORACLE weblogic、tomcat等、支持oracle、sqlserver、DB2、mysql、sybase等多种关系型数据库。\n通过google和zoomeye的分析发现ezOffice的搭建平台：\nWindows（几乎所有）Linux（极少数）其他（没出现。。。）\n然后就是分平台来看对不同的web服务器、中间件apache、tomcat、websphere、nginx、resin、libhttpd、jboss、weblogic等进行不同的方法拿uploder.jsp这个最新版本的文件代码示例：\n<%@ page contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%><%@ page import=\"java.io.File\" %><%@ page import=\"java.io.IOException\" %><%@ page import=\"java.text.SimpleDateFormat\" %><%@ page import=\"java.util.*\" %><%@ page import=\"org.apache.commons.fileupload.FileItem\" %><%@ page import=\"org.apache.commons.fileupload.FileUploadException\" %><%@ page import=\"org.apache.commons.fileupload.disk.DiskFileItemFactory\" %><%@ page import=\"org.apache.commons.fileupload.servlet.ServletFileUpload\" %><%@ page import=\"org.apache.commons.net.ftp.FTPClient\" %><%@ page import=\"com.whir.ezoffice.customForm.WorkFlowUploadFile\" %><%@ page import=\"com.whir.ezoffice.netdisk.bd.NetdiskBD\" %><%@ page import=\"com.whir.ezoffice.microblog.util.CutPhotoSize\" %><%@page  import=\"com.whir.component.security.crypto.EncryptUtil\"%><%\t\t\trequest.setCharacterEncoding(\"UTF-8\");response.setContentType(\"text/json;charset=UTF-8\");response.setHeader(\"Cache_Control\", \"no-cache\");if(session.getAttribute(\"userName\")!=null){    String domainId = session.getAttribute(\"domainId\")!=null?session.getAttribute(\"domainId\").toString():\"0\" ;    // 磁盘绝对路径      String path = request.getRealPath(\"\");    // 模块文件夹    String dir = request.getParameter(\"dir\")!=null?request.getParameter(\"dir\"):\"dir\";    String makeYMdir = request.getParameter(\"makeYMdir\")!=null?request.getParameter(\"makeYMdir\"):\"yes\";    // 年月文件夹    Date now = new Date();    SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");    String str_date = sdf.format(now);    String year = str_date.substring(0,4);    String month = str_date.substring(5,7);    // 绝对路径    //如果dir以/开头，则不放在upload下，属于自定义上传目录    if(dir.length() > 0 && dir.indexOf(\"/\") == 0){        path = (path + dir);    }else{        String path1 = path + \"/upload/\"+dir+\"/\";        path = makeYMdir.equals(\"yes\")?(path + \"/upload/\"+dir+\"/\" + year+month+\"/\"):(path + \"/upload/\"+dir+\"/\");        //创建文件夹               if(makeYMdir.equals(\"yes\")){            File file = new File(path1);            if (file.exists()) {                File file2 = new File(path);                if (!file2.exists()) {                    file2.mkdirs();                }            }        }    }    String rootPath = com.whir.component.config.PropertiesUtil.getInstance().getRootPath();    String preUrl = rootPath;    //是否为FTP上传    boolean isFtpUpload_ = false;    Map ftpMap = new HashMap();    Map sysMap = com.whir.org.common.util.SysSetupReader.getInstance().getSysSetupMap(domainId);    if (sysMap != null && sysMap.get(\"附件上传\") != null && sysMap.get(\"附件上传\").toString().equals(\"0\")) {        String fileServer = com.whir.component.config.ConfigReader.getFileServer(request.getRemoteAddr());        ftpMap = com.whir.component.config.ConfigReader.getUploadMap(request.getRemoteAddr(), domainId);        preUrl = fileServer;        isFtpUpload_ = true;    }    // request中参数部分    String isEncrypt = (String)sysMap.get(\"加密存储\");    //customize biz import datas    boolean isDeleteFile = true;    if (\"datas\".equals(dir) || \"fileimport\".equals(dir) || dir.indexOf(\"custom/ezform/ext\")!=-1 || dir.indexOf(\"modulesext/devform\")!=-1) {        isEncrypt = \"0\";        isDeleteFile = false;    }    //相对路径    String relative_path = makeYMdir.equals(\"yes\")?(preUrl+\"/upload/\"+dir+\"/\"+ year+month+\"/\"):(preUrl+\"/upload/\"+dir+\"/\");// /defaultroot/upload/dir/201303/    if(dir.indexOf(\"/\") == 0){        relative_path = preUrl+dir;    }    ServletFileUpload sfu = new ServletFileUpload(new DiskFileItemFactory());    String fileName = \"\",sourcePath=\"\",fileNameStr = \"\",json=\"\";    try {        List fileList = sfu.parseRequest(request);        String name = \"\";        String extName = \"\";        for (int i = 0; i < fileList.size(); i++) {            FileItem fi = (FileItem) fileList.get(i);            if (!fi.isFormField()) {                name = fi.getName();                //System.out.println(\"name1:\"+name);                if(name.lastIndexOf(\"\\\\\")>=0){                    name = name.substring(name.lastIndexOf(\"\\\\\")+1);                }                //System.out.println(\"name2:\"+name);                if (name == null || \"\".equals(name.trim())) {                    continue;                }                if (name.lastIndexOf(\".\") >= 0) {                    extName = name.substring(name.lastIndexOf(\".\"));                }                String checkExtName = (\"\" + extName).toLowerCase();                //System.out.println(\"extName:\"+checkExtName);                //if(\",innerMailbox,information,peopleinfo,weibo,taskCenter,taskcentermodel,boardroom,govdocumentmanager,contract,forum,dossier,project,projectmodel,ptrain,workreport,goodspic,\".indexOf(\",\"+dir+\",\") != -1){                if(dir.indexOf(\"/custom/ezform/ext/\") == -1 && dir.indexOf(\"/modulesext/devform/customize/\") == -1 && dir.indexOf(\"/modulesext/devform/workflow/\") == -1 && dir.indexOf(\"/ezoffice/form/\") == -1 && dir.indexOf(\"/ezoffice/formhandler/\") == -1){                    if(\",.jsp,.jspx,.asp,.aspx,.bat,.cmd,.exe,.ocx,.cab,.dll,.js,.html,.htm,.php,.action,.msi,.scr,.com,.class\".indexOf(extName)!=-1){                        continue;                    }                }                //如果dir以/开头，则保持原文件名，属于自定义上传目录                String myRandom=new com.whir.common.util.Random().getRandom();                if(dir.indexOf(\"/\") == 0){                    fileName = name;                    myRandom = name.substring(0,name.lastIndexOf(\".\"));                }else{                    fileName = myRandom + extName;                }                //sourcePath = (path + fileName).replaceAll(\"/\",\"\\\\\\\\\");                sourcePath = (path + fileName).replaceAll(\"\\\\\\\\\",\"/\");                //保存                File saveFile = new File(sourcePath);                fi.write(saveFile);                fileNameStr += fileName + \",\";                //文件大小                int fileSize = (int)fi.getSize();//837494                com.whir.common.util.UploadFile upFile=new com.whir.common.util.UploadFile();                upFile.setFileSize(fileName, fileSize, dir, request, \"1\".equals(isEncrypt)?true:false);//upFile.getFileSize(fileName);//817.86K                //生成缩略图                String imgType = \"*.jpg;*.jpeg;*.gif;*.png\";                if(imgType.indexOf(extName.toLowerCase())>0){                    CutPhotoSize _cutPhotoSize=new CutPhotoSize();                    //缩略图信息，格式：150x150_small;300x300                    String thumbnail  = request.getParameter(\"thumbnail\")!=null?request.getParameter(\"thumbnail\"):\"\";                    if(!thumbnail.equals(\"\")){                        String[] thumbnail_arr = thumbnail.split(\";\");                        //循环数组元素                        for(int m =0; m<thumbnail_arr.length; m++){                            String width  = thumbnail_arr[m].substring(0,thumbnail_arr[m].indexOf(\"x\"));                            String height = thumbnail_arr[m].substring(thumbnail_arr[m].indexOf(\"x\")+1,thumbnail_arr[m].indexOf(\"_\")>0?thumbnail_arr[m].indexOf(\"_\"):thumbnail_arr[m].length());                            String shortName = thumbnail_arr[m].indexOf(\"_\")>0?thumbnail_arr[m].substring(thumbnail_arr[m].indexOf(\"_\")+1,thumbnail_arr[m].length()):thumbnail_arr[m];                            String newFileName = myRandom+\"_\"+shortName+extName ;                            String newSourcePath = (path+newFileName).replaceAll(\"\\\\\\\\\",\"/\");                            //System.out.println(\"extName.toLowerCase():\"+extName.toLowerCase());                            if (!\".gif\".equals(extName.toLowerCase())) {                                   //System.out.println(\"进入scaleImage\");                                _cutPhotoSize.scaleImage(sourcePath,newSourcePath,Integer.parseInt(width),Integer.parseInt(height));                            }else{                                 //System.out.println(\"进入getGifImage\");                                _cutPhotoSize.getGifImage(sourcePath,newSourcePath,Integer.parseInt(width),Integer.parseInt(height),true);                             }                            //是否为FTP上传                            if (isFtpUpload_) {                                WorkFlowUploadFile.buildList(dir,(dir.indexOf(\"/\") == 0) ?\"\":(year + month),ftpMap.get(\"server\").toString(),ftpMap.get(\"user\").toString(),ftpMap.get(\"oriPass\") + \"whir?!\");                                com.whir.govezoffice.documentmanager.common.util.NewFtpClient ftpClient1 = new com.whir.govezoffice.documentmanager.common.util.NewFtpClient(                                ftpMap.get(\"server\").toString(),ftpMap.get(\"port\").toString(),ftpMap.get(\"user\").toString(),ftpMap.get(\"oriPass\") + \"whir?!\",newSourcePath,newFileName, (dir.indexOf(\"/\") == 0) ? dir:(makeYMdir.equals(\"yes\")?(dir+\"/\" + year + month):(dir)));                                ftpClient1.upload2();                                //如果是ftp上传，删除应用下的临时附件                                File newSaveFile = new File(newSourcePath);                                newSaveFile.delete();                            }                        }                    }                }                //是否为FTP上传                if (isFtpUpload_) {                    WorkFlowUploadFile.buildList(dir, (dir.indexOf(\"/\") == 0) ?\"\":(year + month),ftpMap.get(\"server\").toString(),ftpMap.get(\"user\").toString(),ftpMap.get(\"oriPass\") + \"whir?!\");                    com.whir.govezoffice.documentmanager.common.util.NewFtpClient ftpClient1 = new com.whir.govezoffice.documentmanager.common.util.NewFtpClient(                    ftpMap.get(\"server\").toString(),ftpMap.get(\"port\").toString(),ftpMap.get(\"user\").toString(),ftpMap.get(\"oriPass\") + \"whir?!\",sourcePath,fileName, (dir.indexOf(\"/\") == 0) ? dir:(makeYMdir.equals(\"yes\")?(dir+\"/\" + year + month):(dir)));                    ftpClient1.upload2();                                        //如果是ftp上传，删除应用下的临时附件                    if(isDeleteFile){                        saveFile.delete();                    }                }                EncryptUtil util = new EncryptUtil();                String dlcode = util.getSysEncoderKeyVlaue(\"FileName\",myRandom+extName,\"dir\");                json += \"{id:\\\"\\\",master:\\\"\\\",dlcode:\\\"\"+dlcode+\"\\\",file_type:\\\"\"+extName+\"\\\",save_name:\\\"\"+myRandom+\"\\\",file_name:\\\"\"+name.substring(0,name.lastIndexOf(\".\"))+\"\\\",relative_path:\\\"\"+relative_path+\"\\\"}\";            }        }        //返回json字符串        out.print(json);    } catch (FileUploadException e) {        e.printStackTrace();    } catch (Exception e) {        e.printStackTrace();    }}%>|<-->|\n基本上所有的上传点和该上传点都类似，就拿这一处来分析其他的地方同理参考所有上传点均取消了之前存在缺陷的typefile参数余下的参数：dir= //自定义上传路径，默认upload目录下，（这里存在缺陷后面讲，针对linux平台的）makeYMdir=no //不进行日期重命名然后过滤了非法的后缀首先对于 # Windows 对于windows是几乎所有ezoffice的标配，都搭建在微软的windows上，也是最快捷方便的getshell，管你什么乱七八糟的中间件、服务器，一律不管，直接上传通杀包括你旧版本的什么singleuplosd、hotupload等一堆乱七八糟的上传还是修复以后、删的删、改的改的上传不管你是需要登录的还是不需要登录的上传windows下可以直接利用ADS文件流来突破所有防御\nPOC：shell.jsp::$DATA\n最新版ezOffice，Getshell也就是那么一瞬间：\n\n这个呢，主要还是利用了该javaweb的特性，几乎所有的均搭建在windows平台那么对于其他很小部分的# Linux同样也给出方案，毕竟万一碰到了怎么办ezOffice基于Servlet 2.5和java 2.1如果是apache，基本架构就是Apache+Tomcat+JDK（tomcat作为解释器,servlet容器）jsp、jspx不能上传但是shell.jsp.eee，shell.jsp.wooyun都不在黑名单内利用解析漏洞来突破或者上传一个.htaccess来解析getshell，方法很多如果是nginx静态资源，肯定是搭配jetty或者tomcat来处理servlet出于性能考虑，该架构基本难碰到碰到了还是利用解析漏洞来绕过如果再碰到更少的weblogic、websphere或者resin等可以利用jspf或者其他特性conf、xml配置等文件来拿shell所以前面的自定义目录就有用了默认的一个\"/\"上传的是defaultroot目录如果是\"../../\"，非\"/\"开头，则makeYMdir设置为no也会以日期来重命名该文件所以对该处突破要利用\n/../../..\n格式来进行任意非黑名单文件名（conf\\config\\properties\\htaccess\\xml）的任意目录上传来看对比图\n\n\n\n\n\n但是windows下并不能跨盘，比如在D盘，不能跨到C盘去，但是windows已经通杀了，还管这个有什么用呢，所以放在linux下讲linux下所有目录均可以，通过该缺陷覆盖配置文件或者自定义规则来Getwebshell(End)   修复方案：     版权声明：转载请注明来源 黑暗游侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-08-01 09:24 厂商回复： cnvd确认并复现所述情况，已经由cnvd向软件生产厂商万户网络公司以往联系渠道邮箱通报。万户网络公司已经收悉，同时已经反馈称正在及时处置，建议用户关注其官方网站发布的最新补丁情况。根据实测案例，已经同步向各分中心下发。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-27 16:07 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:567 漏洞数:108        | 低调求发展)\t\t \n  小厂商。。    \n     2015-07-28 16:21 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  您好！    感谢您对CNVD的支持，请您协助CNVD提供下测试实例（至少2个）确认通用性，如需登录前提，也请提供登录口令，并邮件反馈vreport@cert.org.cn，以便CNVD及时验证、处置。    祝好！    \n     2015-07-29 20:27 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1784 漏洞数:269        | 123)\t\t \n  @cncert国家互联网应急中心 ok了，早就mail你们了，怎么还不确认啊！急啊需要rank    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}