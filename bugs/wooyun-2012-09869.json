{"id": 17894, "wybug_id": "wooyun-2012-09869", "wybug_title": "对金山游戏的一次渗透测试", "wybug_corp": "金山软件集团", "wybug_author": "an1k3r", "wybug_date": "2012-07-19 04:33", "wybug_open_date": "2012-09-02 04:33", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["内部敏感信息泄漏", "内部管理不完善", "任意命令执行", "内部应用安全边界缺失", "内部敏感系统对外开放", "内部系统对外"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-07-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-07-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-07-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-08-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-08-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-09-02：\t细节向公众公开  简要描述： 本来只想看下金山的某个后台有没有注入啥的可以绕过，谁知道... 接下来就是各种游戏服务器提权等。服务器连接内网，但是没有继续渗透。涉及的游戏有月影传说，剑侠二等。话说金山的一些游戏还是挺不错的 >.< 详细说明：  渗透从这里开始。金山游戏运营系统Kingeyes：https://keyes.xoyo.com/admin\n\n好吧，本来只想看下后台有没有注入啥的可以绕过，谁知道竟然可以远程执行命令。0.0先用WVS扫描神器过了一下，看能不能扫到一些注入点或者敏感目录。扫描出来的目录很多，但大部分打开都是空白。如：直接访问https://keyes.xoyo.com/admin/view/machines/query.php会显示空白。\n\n但是呢，不知道怎么回事，无意间将https://keyes.xoyo.com/admin/view/machines/query.php改成https://keyes.xoyo.com/admin/machines/query后奇迹出现了（去掉了view、以及php后缀名），各种游戏的服务器啊。\n\n那么可以推测，别的链接也可以这样修改。于是将https://keyes.xoyo.com/admin/view/shell/index.php改为https://keyes.xoyo.com/admin/shell\n\n这个接口可以直接执行系统命令，还是root权限。目标和端口填上图所示服务器的IP和端口即可，大概是100多台服务器吧。\n\nLin服务器大概有100台左右，看了下，开了22端口，但是大部分从外网无法访问，应该是被墙了。Win服务器大概有7、8台的样子。一些服务器对外开放了3389，于是决定先拿下Win服务器，然后从Win跳到Lin上。找到一台开3389的服务器59.37.172.45，添加了一个administrator账户，远程桌面登录后绕开防火墙，其它几台Win服务器可以通过此服务器做跳转拿到。\n\n登进去之后发现服务器虽然有内网地址（172.20.21.2），但是没有网关。\n\n是不是Lin服务器也没有网关呢，于是看了下，果然没有。由此可推测，这些服务器分组后放在各自的Vlan里，互相之间没有通信。\n\n这样的话，Lin服务器的root权限还是只能通过那个接口地址拿到。找到一个对外开放SSH的服务器(好少啊）118.26.237.113。直接执行useradd报错。原来是环境变量的问题，使用绝对路径执行就可以了。如：/usr/sbin/useradd root0 -p root0\n\n发现ssh不能登录，查看用户属性是允许登录的，也没启用pam限制登录账户。难道还有其它方面限制？不过，暂时到这里吧，不继续了。没有经过授权做的渗透，不好意思哈。 >.<\n\n   漏洞证明：  在详细说明里了。   修复方案：  应该懂的。   版权声明：转载请注明来源 an1k3r@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-07-19 09:32 厂商回复： 多谢，我们将尽快安排修复。同时该漏洞影响我们评估相当的严重，所以rank给到20； 最新状态： 2012-07-19：非常感谢，已经修复完毕；  ", "replys": "漏洞评价：\n评论\n     2012-07-19 06:32 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  holy shit！    \n     2012-07-19 10:33 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  相信这对  cc 会很有帮助的 ，谢谢厂商的评估！    \n     2012-08-18 17:19 |    \t\tlossite \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:2        | OK!)\t\t \n  这个管理接口不赖 0.0    \n     2012-08-18 18:11 |    \t\tfreefinder \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 安全爱好者+漏洞新手)\t\t \n  嗯，给力    \n     2012-08-18 19:35 |    \t\tP w \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:14        | -这家伙很懒,什么都没有留下。其实我真的很...)\t\t \n  这是什么原因引起的呢？    \n     2012-08-18 20:00 |    \t\t小A \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 您好，我是小A。)\t\t \n  我是实习的。。。什么原理呢？    \n     2012-08-19 18:25 |    \t\t鱼化石 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:18        | 介绍不能为空)\t\t \n  很奇怪的说    \n     2012-08-19 22:07 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:177 漏洞数:31        | Hacked by @ringzero 我錯了)\t\t \n  给力啊    \n     2012-09-04 17:37 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  金山要收了LZ了    \n     2012-09-23 00:14 |    \t\tprint_0x0000 \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:22        | 一枚苦逼的农民工.)\t\t \n  好给力哇...膜拜洞主。    \n     2012-11-15 16:37 |    \t\tuni3orns \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:2        | 过来膜拜各位洞主的)\t\t \n  我那个x,这个是什么原理啊?@xsser    \n     2012-11-15 16:40 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @uni3orns 你这么一说似乎我也不能理解，要求洞主来解答吧    \n     2012-11-19 08:54 |    \t\tuni3orns \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:2        | 过来膜拜各位洞主的)\t\t \n  @an1k3r 跪求指教！～    \n     2012-11-20 16:44 |    \t\tan1k3r \t\t\t( 普通白帽子  |\t\t\t        Rank:474 漏洞数:40        | 0.0)\t\t \n  @uni3orns 不好意思，具体俺也不知道为啥 >.<    \n     2012-11-20 16:56 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @an1k3r 大神，乌云需要你！    \n     2012-11-20 17:02 |    \t\tan1k3r \t\t\t( 普通白帽子  |\t\t\t        Rank:474 漏洞数:40        | 0.0)\t\t \n  @风萧萧 呵呵，萧大，乌云有你这样的大神就可以了～    \n     2012-12-28 00:44 |    \t\t猴子 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:5        | 我是一只骚猴子)\t\t \n  送娃娃呀~要金山充气的。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}