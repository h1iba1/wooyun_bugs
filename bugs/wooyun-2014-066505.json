{"id": 53787, "wybug_id": "wooyun-2014-066505", "wybug_title": "某网上挂号系统找回密码漏洞及SQL注入(用户敏感信息泄漏)", "wybug_corp": "nj12320.org", "wybug_author": "nzk1912", "wybug_date": "2014-06-28 11:42", "wybug_open_date": "2014-08-12 11:44", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-12：\t细节向公众公开  简要描述： 前段时间经常去医院，网上挂号比较方便，就找到了这个，算是习惯吧，测下吧，就发现了几个问题，望改进。 详细说明：  1、重置密码漏洞    http://www.nj12320.org/njmine/findPassword.do?type=start   这是重置密码的进入地址，正常操作要一步一步进行，输入身份证号、用户名等信息正确后可以重置密码。    经测试发现，中间的检测环节都可以跳过。2步即可修改密码。第一步，正常输入用户名和验证码后，点击下一步；第二步，直接请求最后一步修改密码的操作，也是可以成功的。即POST： POST /njmine/findPassword.do?type=step4 data为：username=&verifyCode=&idtype=0&idnum=&name=&birthday=&password=testtest2其中password为新密码。2、SQL注入漏洞，主页的搜索功能，可以SQL注入，理论上应该可以，没试成功，也懒得试了，肯定要改改了。http://www.nj12320.org/njres/输入框输入一个单引号，SQL就看到了，下面就是累脑细胞拼SQL了。SQL: select t.* from (select tt.*,rownum as rowno from      (select            HOSCODE, HOSNAME, HOSINTRO, HOSPHO, HOSTRAFFIC, HOSMAP, HOSIP, HOSLOGO, HOSONLINE,      FORCEPAY, CARDID, HOSLEVEL, HOSTYPE, HOSURL, CREATE_ID, CREATE_TIME, MODIFY_ID, MODIFY_TIME,      HOSSHORTNAM, ISLINK, IS_BIG_DEP          from reservation.hospital where hosonline='1'            and hosname like '%注入点%'                       order by Hostype desc,HosName asc) tt      WHERE rownum <= ?      ) t      WHERE t.rowno > ?   漏洞证明：  输入用户名和验证码，到达下一个页面，就不用管它了:\n\n用工具抓了包，便于测试，直接发这个POST请求就可以了，新密码如红框框内\n\n泄漏的用户信息，随便找了一个用户测试的，对不起你了~有身份证号，手机号等个人信息。\n\n搜索输入一个单号号，SQL直接就打印出来了，下面就是拼SQL了。\n\n\n\n   修复方案：  1、密码问题 有很多通用方案，任选。2、绑定变量可行不？要么就过滤特殊字符。3、服务器信息也存在泄漏，如tomcat版本号是6.0.36，万一有漏洞发现，容易被利用，按电信安全标准，信息要隐藏。   版权声明：转载请注明来源 nzk1912@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-07-03 08:13 厂商回复： cnvd确认并复现所述情况，已经转 由cncert下发给江苏分中心处置。按多个漏洞综合评分，rank 15 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}