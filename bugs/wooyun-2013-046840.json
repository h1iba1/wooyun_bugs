{"id": 5351, "wybug_id": "wooyun-2013-046840", "wybug_title": "大汉通版jcms任意文件上传漏洞", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "xcoder", "wybug_date": "2013-12-24 10:14", "wybug_open_date": "2014-03-24 10:14", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-12-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-02-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-24：\t细节向公众公开  简要描述：  大汉通版jcms 任意文件上传漏洞 详细说明：  问题出在导入xml文件时，只是采用了本地js验证，没有进行服务端验证，而且对文件的访问权限没有进行任何控制，服务端也没有对上传文件的有效性进行检查导致任意文件上传，威力巨大:\n\n部分代码:\nListTable listtable = new ListTable(request);\t\tout.println(listtable.getListTableCssJs());\t\t\t\tsys.initSysPara(request);\t\t\t\t\t//*得到用户信息*/\t\tjcms.entity.Merp_Pub_UserEntity userentity = UserRightBLF.getUserInfo(request);\t\t\t\t\t\tString strFilePath = application.getRealPath(\"\")+\"/m_5_5/m_5_5_3/temp/upload/\" ;\t\tConvert.createDirectory(strFilePath);\t\t\t\tCommonUploadFile upload = new CommonUploadFile(strFilePath,\"\");\n上传地址:\nhttp://netcenter.cau.edu.cn/jcms/m_5_5/m_5_5_3/import_style.jsp\n将本能js验证去掉\n\n\nshell地址:http://www.target.com/jcms/m_5_5/m_5_5_3/temp/upload/后门文件名\n\n\n\nshell:http://netcenter.cau.edu.cn/jcms/m_5_5/m_5_5_3/temp/upload/yjh.jsp 密码:sx\n   漏洞证明：  问题出在导入xml文件时，只是采用了本地js验证，没有进行服务端验证，而且对文件的访问权限没有进行任何控制，服务端也没有对上传文件的有效性进行检查导致任意文件上传，威力巨大:\n\n部分代码:\nListTable listtable = new ListTable(request);\t\tout.println(listtable.getListTableCssJs());\t\t\t\tsys.initSysPara(request);\t\t\t\t\t//*得到用户信息*/\t\tjcms.entity.Merp_Pub_UserEntity userentity = UserRightBLF.getUserInfo(request);\t\t\t\t\t\tString strFilePath = application.getRealPath(\"\")+\"/m_5_5/m_5_5_3/temp/upload/\" ;\t\tConvert.createDirectory(strFilePath);\t\t\t\tCommonUploadFile upload = new CommonUploadFile(strFilePath,\"\");\n上传地址:\nhttp://netcenter.cau.edu.cn/jcms/m_5_5/m_5_5_3/import_style.jsp\n将本能js验证去掉\n\n\nshell地址:http://www.target.com/jcms/m_5_5/m_5_5_3/temp/upload/后门文件名\n\n\n\nshell:http://netcenter.cau.edu.cn/jcms/m_5_5/m_5_5_3/temp/upload/yjh.jsp 密码:sx\n   修复方案：  权限控制，对上传文件后缀进行检查   版权声明：转载请注明来源 xcoder@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2013-12-24 15:58 厂商回复： 已收到，谢谢 最新状态： 2013-12-30：补充CNVD处置情况，根据测试实例，已经转由CNCERT下发给山东、贵州、湖北、江苏、浙江等分中心，由上述分中心协调处置涉及的地方政府部门网站案例。  ", "replys": "漏洞评价：\n评论\n     2013-12-24 10:21 |    \t\t刺刺 \t\t\t( 普通白帽子  |\t\t\t        Rank:603 漏洞数:52        | 真正的安全并不是技术，而是人类善良的心灵...)\t\t \n  大牛，都发出来吧，还有jget jsearch egov lm vc jiep jportal jmportal jphoto jvideo xxgk vipchat jact，期待啊……    \n     2013-12-24 14:01 |    \t\t南京大汉网络有限公司(乌云厂商)\t\t \n  help #wooyun.org    \n     2013-12-30 00:20 |    \t\t暗夜清风 \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:10        | 大哥,你的娃娃掉了.举手之劳,不必以身相许)\t\t \n  求机油联系方式    \n     2014-01-12 23:54 |    \t\txcoder \t\t\t( 实习白帽子  |\t\t\t        Rank:59 漏洞数:9        | 一个世界有你，一个世界没有你，让两者的不...)\t\t \n  @暗夜清风 最近比较忙没怎么上线啊    \n     2014-01-12 23:57 |    \t\txcoder \t\t\t( 实习白帽子  |\t\t\t        Rank:59 漏洞数:9        | 一个世界有你，一个世界没有你，让两者的不...)\t\t \n  @南京大汉网络有限公司 感谢大汉科技的杯具和移动电源，东西已经收到！    \n     2014-01-13 16:02 |    \t\t刺刺 \t\t\t( 普通白帽子  |\t\t\t        Rank:603 漏洞数:52        | 真正的安全并不是技术，而是人类善良的心灵...)\t\t \n  @xcoder 还以为rank给的少，礼物会很好呢！    \n     2014-01-13 20:59 |    \t\txcoder \t\t\t( 实习白帽子  |\t\t\t        Rank:59 漏洞数:9        | 一个世界有你，一个世界没有你，让两者的不...)\t\t \n  @刺刺 送了个杯具，有含义！    \n     2014-01-14 09:00 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  杯具！！！    \n     2014-01-21 11:06 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @xcoder 意思是你要悲剧吗……    \n     2014-01-21 17:01 |    \t\t刺刺 \t\t\t( 普通白帽子  |\t\t\t        Rank:603 漏洞数:52        | 真正的安全并不是技术，而是人类善良的心灵...)\t\t \n  @xcoder 难道洞主就是那个农大的学生？我猜测在jis提权发现之后，被安排做全套的安检……    \n     2014-01-23 18:17 |    \t\t腾讯QQ \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我不是坏人)\t\t \n  好悲剧。。    \n     2014-01-23 19:44 |    \t\txcoder \t\t\t( 实习白帽子  |\t\t\t        Rank:59 漏洞数:9        | 一个世界有你，一个世界没有你，让两者的不...)\t\t \n  @刺刺 我等屌丝怎么是农大的啊，随便找了个站！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}