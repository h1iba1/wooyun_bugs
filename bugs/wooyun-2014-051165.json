{"id": 58462, "wybug_id": "wooyun-2014-051165", "wybug_title": "EasyTalk SQL注入导致后台登录绕过", "wybug_corp": "nextsns.com", "wybug_author": "xfkxfk", "wybug_date": "2014-02-17 13:43", "wybug_open_date": "2014-05-18 13:44", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "安全意识不足", "源码审核", "注射漏洞利用技巧", "源码分析", "白盒测试", "后台验证绕过"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-18：\t细节向公众公开  简要描述： EasyTalk SQL注入导致后台登录绕过 详细说明：  漏洞存在文件：/Admin/Lib/Action/LoginAction.class.php：\npublic function dologin() {\t\tparent::toadmin();        $user_name=$_POST['username'];        $password=$_POST['password'];\t\t$authcode=trim($_POST['authcode']);\t\tif (!$user_name || !$password || !$authcode || $authcode!=$_SESSION['authcode']) {\t\t\t$this->redirect('/Login/index');\t\t\texit;\t\t}        if (ET_UC==TRUE) {            list($uid, $username, $password, $email) = uc_user_login($user_name,$password);            if($username && $uid>0) {                $user = M(\"Users\")->where(\"user_name='$username' AND isadmin=1\")->field('user_id,user_name')->find();                if($user) {                    Cookie::set('adminauth', authcode(\"$user_name\\t$user[user_id]\",'ENCODE'));                    echo '<script>parent.location.href=\"'.SITE_URL.'/admin.php?s=/Index\"</script>';                } else {                    $this->redirect('/Login/index');                }            } else {                $this->redirect('/Login/index');            }        } else {            $password=md5(md5($password));\t\t\t$user = M(\"Users\")->where(\"user_name='$user_name' AND password='$password' AND isadmin=1\")->find();\t\t\tif($user) {\t\t\t\tCookie::set('adminauth', authcode(\"$user_name\\t$user[user_id]\",'ENCODE'));\t\t\t\techo '<script>parent.location.href=\"'.SITE_URL.'/admin.php?s=/Index\"</script>';\t\t\t} else {\t\t\t\t$this->redirect('/Login/index');\t\t\t}        }    }\nuser那么和password都没有过滤，导致SQL注入。   漏洞证明：  登陆是构造如下请求，验证码一定为当前验证码：\n\n成功登陆：\n\n   修复方案：  过滤   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-02-17 14:16 厂商回复： 已修复，感谢作者 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}