{"id": 59169, "wybug_id": "wooyun-2014-048363", "wybug_title": "TCCMS SQL注入漏洞2(同一文件多处)", "wybug_corp": "teamcen.com", "wybug_author": "xfkxfk", "wybug_date": "2014-01-09 12:25", "wybug_open_date": "2014-04-09 12:26", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "数字类型注射", "逻辑错误", "安全意识不足", "源码审核", "注射漏洞利用技巧", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-01-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-03-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-09：\t细节向公众公开  简要描述： TCCMS SQL注入漏洞，同一文件多处SQL注入，可获取管理员账户信息 详细说明：  app/controller/news.class.php：\npublic function all() {\t\t$_Obj = M($this->objName);\t\t$categoryObj = M(\"category\");\t\t$_Obj->pageSize = 20;\t\t$where = \"1=1\";\t\t$key = $_POST['key'];//注入，再次参数上举例\t\t$cid = $_GET['cid'];\t\tif ($key != \"\") {\t\t\t$where .= \" and title like '$key%'\";\t\t}\t\tif (!empty($cid) && $cid != \"\") {\t\t\t$where .= \" and classid = \" . $cid;\t\t}\t\tif ($_GET[\"type\"] == \"user\") {\t\t\t$where .= \" and uid = \" . $_COOKIE['userId'];\t\t}\t\tif (isset($_GET['yz'])) {\t\t\t$where .= \" AND yz =\".$_GET['yz'];\t\t}\t\tif (isset($_GET['levels'])) {\t\t\t$where .= \" AND levels =\".$_GET['levels'];\t\t}\t\tif (isset($_GET['special'])) {\t\t\t$where .= \" AND special =\".$_GET['special'];\t\t}\t\tif (isset($_GET['top'])) {\t\t\t$where .= \" AND top =\".$_GET['top'];\t\t}\t\tif (isset($_GET['flashpic'])) {\t\t\t$where .= \" AND flashpic =\".$_GET['flashpic'];\t\t}\t\tif (isset($_GET['isphoto'])) {\t\t\t$where .= \" AND isphoto =\".$_GET['isphoto'];\t\t}\t\t$_Obj->setSortId();\t\t$orderBy = $_GET['sortId'];\t\t$_objAry = $_Obj->where($where)->orderby(\"id \".$orderBy)->getList();\t\t//$pidSelectStr = $categoryObj->getTree($categoryObj, 1,false);\t\t//$this->setValue(\"pidSelectStr\", $pidSelectStr);\t\t$this->setValue(\"categoryObj\", $categoryObj);\t\t$this->setValue(\"objAry\", $_objAry);\t\t$this->setValue(\"Obj\", $_Obj);\t\t$this->setValue(\"action\", \"list\");\t\t$this->forward(\"user/newsList.html\");\t}\n进入where和orderby，getList函数，system/core/model.class.php：\npublic function where($where) {        $this->where = empty($this->where) ? \" where \" . $where : $this->where . $where;        return $this;    }        public function orderby($orderby) {        $this->orderby = $orderby;        $this->orderby = empty($this->orderby) ? \"\" : \" order by \" . $this->orderby;        return $this;    }public function getList() {        $offset = 0;        $page = intval($_GET['page']);        $pageSize = $this->pageSize;        if (!$page) {            $page = 1;        }        $offset = ($page - 1) * $pageSize;        $sql = \"select \" . $this->field . \" from \" . $this->table . \" \" . $this->where . $this->orderby . \" limit $offset,$pageSize\";        $rt = $this->db->query($sql);//带入SQL语句        $coun = mysql_query(\"select count(*) as cou from \" . $this->table . \"\" . $this->where);//带入SQL语句        $arr = mysql_fetch_array($coun);        $total = $arr['cou'];        $this->count = $total;        if ($_GET['a'] == 'all') {        \t$this->isAdmin = 1;        }        $this->pagenav = $this->db->pageft($total, $pageSize, 1, 1, 1, 5, \"\", $this->model, $this->isAdmin);        while ($row = $this->db->fetch_assoc($rt)) {            $objList[] = $row;        }        $this->where = '';        return $objList;    }\n   漏洞证明：  \n\n   修复方案：  过滤   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-01-09 13:04 厂商回复： 这是后台的文章列表，没有管理员身份不能进行访问的吧？ 最新状态： 2014-01-09：不过安全漏洞，无处不在，要严谨对待，感谢。  ", "replys": "漏洞评价：\n评论\n     2014-01-09 13:17 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  这怎么是后台文章列表了。我都没登陆，大哥。。。你自己测试一下啊    \n     2014-01-09 13:18 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  @TCCMS-PHP内容管理系统     \n     2014-01-09 13:26 |    \t\tTCCMS-PHP内容管理系统(乌云厂商)\t\t \n  @xfkxfk 是前台，立刻fix掉。赞一个    \n     2014-02-09 12:22 |    \t\t马丁 \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:23        | 大爷~给口饭吧。)\t\t \n  @xfkxfk 乖  不哭 听话 后台就后台 没事 RANK已经给了    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}