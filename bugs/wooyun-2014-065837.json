{"id": 54009, "wybug_id": "wooyun-2014-065837", "wybug_title": "qibocms 黄页系统SQL注入一枚", "wybug_corp": "齐博CMS", "wybug_author": "′雨。", "wybug_date": "2014-06-23 11:14", "wybug_open_date": "2014-09-21 11:16", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-21：\t细节向公众公开  简要描述： 过滤不严。 详细说明：  http://bbs.qibosoft.com/down2.php?v=hy1.0#down这里下载地址 刚下载的。在hy/choose_pic.php中\nif($action=='upload'){\t\t\tif(is_uploaded_file($_FILES[postfile][tmp_name])){\t\t\t\t$array[name]=is_array($postfile)?$_FILES[postfile][name]:$postfile_name;\t\t$title=$title?$title:$array[name];\t\t$myname_str=explode(\".\",strtolower($array[name]));\t\t$myname=$myname_str[(count($myname_str)-1)];\t\tif(!in_array($myname,array('gif','jpg'))) $msg=\"{$array[name]}图片只能是gif或者jpg的格式\";\t\t\t\t$array[path]=\"$webdb[updir]/homepage/pic/\".ceil($lfjuid/1000).\"/$lfjuid\";\t//商家图片另存\t\t$array[size]=is_array($postfile)?$_FILES[postfile][size]:$postfile_size;\t\t$webdb[company_uploadsize_max]=$webdb[company_uploadsize_max]?$webdb[company_uploadsize_max]:100;\t\t//if($array[size]>$webdb[company_uploadsize_max]*1024)\t$msg=\"{$array[name]}图片超过最大{$webdb[company_uploadsize_max]}K限制\";\t\t\t\tif($msg==''){\t\t\t$picurl=upfile(is_array($postfile)?$_FILES[postfile][tmp_name]:$postfile,$array);\t\t\tif($picurl){\t\t\t\t\t\t\t\t\t\t$Newpicpath=ROOT_PATH.\"$array[path]/{$picurl}.gif\";\t\t\t\t\tgdpic(ROOT_PATH.\"$array[path]/$picurl\",$Newpicpath,120,120);\t\t\t\t\tif(!file_exists($Newpicpath)){\t\t\t\t\t\tcopy(ROOT_PATH.\"$array[path]/{$picurl}\",$Newpicpath);\t\t\t\t\t}\t\t\t\t\t//$msg=\"{$array[name]}上传成功\";\t\t\t\t\t$picurl=\"homepage/pic/\".ceil($lfjuid/1000).\"/$lfjuid/$picurl\";\t\t\t\t\t$title=get_word($title,32);\t\t\t\t\t$db->query(\"INSERT INTO `{$_pre}pic` ( `pid` , `psid` , `uid` , `username` ,  `title` , `url` , `level` , `yz` , `posttime` , `isfm` , `orderlist`  ) VALUES ('', '$psid', '$lfjuid', '$lfjid', '$title', '$picurl', '0', '{$webdb[auto_userpostpic]}', '$timestamp', '0', '0');\");\n可以看到$title=get_word($title,32); 看看title哪里来的$title=$title?$title:$array[name]; 如果没定义$title的话就是直接用上传时候文件的名字做的 $_FILES的 然后就无视转义了。然后就带入到了insert当中。   漏洞证明：  \n\n报错了 构造一下语句。\n\n这里限制了后缀必须为jpg之类的 所以在文件名的后面还是需要加一个这个。\n\n直接查看源码得到数据。   修复方案：     版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-06-24 11:09 厂商回复： 感谢提出来！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}