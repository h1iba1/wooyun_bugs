{"id": 48351, "wybug_id": "wooyun-2014-080142", "wybug_title": "骑士人才系统 sql注入导致任意用户密码修改", "wybug_corp": "74c,s.com", "wybug_author": "menmen519", "wybug_date": "2014-10-20 16:40", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射漏洞利用技巧", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-25：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： 骑士人才系统 sql注入导致任意用户密码修改 详细说明：  wap_password.php:\nelseif ($act == 'save_password'){\t\trequire_once(QISHI_ROOT_PATH.'include/fun_user.php');\t$arr['username']=$_SESSION['username'];\t$arr['oldpassword']=trim($_POST['oldpassword'])?trim($_POST['oldpassword']):exit('请输入旧密码！');\t$arr['password']=trim($_POST['password'])?trim($_POST['password']):exit('请输入新密码！');\tif ($arr['password']!=trim($_POST['password1'])) exit('两次输入密码不相同，请重新输入！');\t//edit_password()修改密码的方法\t$info=edit_password($arr);\n我们跟进到这个函数edit_password：fun_user.php:\nfunction edit_password($arr,$check=true){\tglobal $db,$QS_pwdhash;\tif (!is_array($arr))return false;\t$user_info=get_user_inusername($arr['username']);\t$pwd_hash=$user_info['pwd_hash'];\t$password=md5(md5($arr['oldpassword']).$pwd_hash.$QS_pwdhash);\tif ($check)\t{\t\t$row = $db->getone(\"SELECT * FROM \".table('members').\" WHERE username='{$arr['username']}' and password = '{$password}' LIMIT 1\");\t\t\t\tif(empty($row))\t\t{\t\t\treturn -1;\t\t}\t}\t$md5password=md5(md5($arr['password']).$pwd_hash.$QS_pwdhash);\t\tif ($db->query( \"UPDATE \".table('members').\" SET password = '$md5password'  WHERE username='\".$arr['username'].\"'\")) return $arr['username'];\twrite_memberslog($_SESSION['uid'],$_SESSION['utype'],1004,$_SESSION['username'],\"修改了密码\");\treturn false;}\n看见没有这里的意思是如果我们找到了username，那么我们底下就update该用户的密码我们到注册页面：\n\n注册完毕后 我们的意图就是更改test的密码然后我们发送url：http://localhost/74cms_v3.5.1_20141015/upload/wap/personal/wap_password.php?act=save_passwordpost:oldpassword=xxxxx&password=yyyy&password1=yyyytest用户的密码就被修改给yyyy了 登陆 看看：\n\n   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-20 16:47 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  ....    \n     2014-10-21 09:50 |    \t\tX-Power \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:3        | 没事来打酱油)\t\t \n  正需要此洞。     \n     2014-10-21 20:17 |    \t\t好好吃饭天天向上 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 漏洞是什么！？)\t\t \n  重复了吧？！http://loudong.360.cn/vul/info/id/26885    \n     2014-10-21 20:24 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  @好好吃饭天天向上 可能吧，不知道啊    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}