{"id": 73147, "wybug_id": "wooyun-2015-0156043", "wybug_title": "某电竞平台(dota2)一些列问题导致Getshell影响内网安全", "wybug_corp": "imbatv.cn", "wybug_author": "we8_", "wybug_date": "2015-12-08 21:49", "wybug_open_date": "2016-01-11 16:56", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["渗透测试思路", "安全意识不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： ImbaTV是一个以 DOTA2 游戏为中心的原创性内容供应平台，已经转播了 TI4 联赛，并且制作了水友赛、比赛点播，游戏 MV。2015年10月完成约1亿人民币的B轮融资。该轮融资由毅达资本旗下紫金文化基金领投，普思资本跟投，A轮投资方红杉资本与创新工场继续跟投。ImbaTV是一家以DOTA2相关视频为核心的游戏内容分发平台。其创业过程异乎寻常的顺利——在设备没有配备完整情况下，转播TI4预选赛，创造最高38万人次直播。其后又获得了创新工场和红杉资本联合投资的数百万美元。据悉这是创新工场在游戏领域迄今为止首轮投资额最多的公司之一，仅次于此前被收购的智明星通。－－没有脱任何重要文件和数据:) 详细说明：  1、信息搜集：bbs.imbatv.cn(Discuz! X3.1)http://bbs.imbatv.cn/test.phphttp://bbs.imbatv.cn/.git/confighttp://bbs.imbatv.cn/robots.txthttp://bbs.imbatv.cn/admin.phphttp://i.imbatv.cn/phpinfo.phphttp://i.imbatv.cn/admin.phphttp://i.imbatv.cn/.svn/entrieshttp://imbatv.cn/admin/http://imbatv.cn/i.phphttp://imbatv.cn/search?keywords=1    注入http://webdev.imbatv.cn/admin/一个一个进行测试，我们逐一进行分析:)1、BBS的dzx3.1 本身貌似大概没什么卵洞，但是上天给了我一丝希望，让我找到了个phpinfo,我们查看下phpinfo的后半部分。\n\n\n\n发现账号密码木有，uc的，bbs的，db的，但是试试证明.....全都不好使。。。。我们可以留作一个信息搜集库继续向下看。。。。突然见，发现了个.git的玩意，没尽兴测试前给我高兴蒙B了，之后发现只有一张logo.....BBS暂时跳过，继续看下面的字域名:)2、i.imbatv.cnphpinfo，发现的东西基本和上面的形式差不多，甚至也出现了ucenter的东西，并且让我看到了\n\n之后我感觉这个网站应该有很多目录是挂载过来的。网站后台admin.php先放着，上天又让我激动了一下子，发现了svn泄漏:)http://i.imbatv.cn/.svn/entries之后我进行文件查看（公司网打开svn的文件有的看不鸟。。我以为没戏了，结果回家一看。。诶？粗来了卧槽。。。）首先admin.php文件：最上面写的：\n<?php  include 'auth.php';  $login = false;  session_start();  if (isset($_SESSION['user_name']) && $_SESSION['user_name'] == $AUTH['user_name'])    $login = true;?>\nok，我们看到了如果等于$AUTH[‘user_name’]的时候就$login=true,那我们看看auth在哪，翻翻svn...结果发现了auth.php的代码:\n<?php  define(\"AUTH_SUFFIX\", \".imbatv\");  $AUTH = array();  $AUTH['user_name'] = 'ileague';  //imbatv9090!@#$  $AUTH['passwd'] = '276051cbeda009552cb68436b60d9c44';?>\n用户名密码。。都有了，登录吧：）看看后台有啥好玩的(例如说上传之类的可以利用的)。\n\n\n\n看到第一个名字我笑了.....老带劲了。。。第三个我也留着吧。。。。翻了一圈，没什么有用的，我就继续看了下svn..hs_match目录下有个login.php:\n<?php$verify = md5('Just4HsBp2015');$admin_pwd = md5('Just4AdminHsBp2015');if(!empty($_POST)){   if(empty($_POST['user']) || $_POST['user'] == \"\"){        echo '<script type=\"text/javascript\">                alert(\"用户名不能为空\");                </script>’;\n发现了admin_pwd的明文密码，然后不知道用户名是啥。。瞎猜的admin进去的。关于重置数据的，就一个按钮你整了一个页面。。。。哎。。。心碎了。。。\n\n继续看其他的svn没什么卵收获。3、应该先测试主站的，其实最开始发现也有个phpinfo(http://imbatv.cn/i.php)，挺激动，没啥用。。。。然后发现了注入点(http://imbatv.cn/search?keywords=1)有waf，开始测试xss来着无意间发现了可能有waf了，双引号闭合mysql爆错。\n\n用tamper放sqlmap里面跑，跑出了数据；\n\n跑出了后台的用户名密码:admin：imba*********#$成功登陆了后台:)\n\n权限还是不小的。在浏览后台过程中，发现了，存在上传点，但是服务器对content-type有严格的限制，目测白名单，该上传啥上传啥，弄了好几个小时没搞定，期间也搞了一下http://webdev.imbatv.cn/admin/同样存在注入，后台口令和那个主站的一样。。。晚上突然发现是否能够换个方式在后台上传php格式的文件呢？浏览页面:抓包:(路径信息phpinfo里面有，跨目录吧)\n\n\n\n之后成功上传了卧槽。。。(/mnt/web/*********/dota***/upfiles.php)\n\n可以执行cmd命令，可以msf或者ssock等进行内网代理。可进一步进行内网渗透。还有个svn的用户名密码成功登陆，各种key，各种config，各种源代码:)\n\n   漏洞证明：  \n\n可以执行cmd命令，可以msf或者ssock等进行内网代理。可进一步进行内网渗透。还有个svn的用户名密码成功登陆，各种key，各种config，各种源代码:)\n\nhttp://webdev.imbatv.cn/admin/这个域名和主站用的是同一个模板，估计数据库也一样，可以登录并且getshell。   修复方案：  1、phpinfo删除2、svn合理配置3、sql注入修复4、各种修复吧:)   版权声明：转载请注明来源 we8_@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-12-10 20:04 厂商回复： 感谢发现我们的漏洞，给我们很好的上了一课，我们将尽快修补，然后请你们再次扫描我们是否还存在高危险级别的漏洞，作为技术人员，本人学艺不精，将对漏洞发现者给予一定礼物。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-11-26 14:47 |    \t\tsauren \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:27        | 天天打DOTA，快乐你我他~)\t\t \n  涛哥哭了 @esports海涛    \n     2015-12-09 08:27 |    \t\t暴走 \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:75        | Wooyun的Rank获取如同Dota冲天梯有过之而无...)\t\t \n  中路十屠夫，中路十神牛...    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}