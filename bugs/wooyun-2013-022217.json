{"id": 12455, "wybug_id": "wooyun-2013-022217", "wybug_title": "CCTV分站SQL注入+本地文件包含（phpcms某版本新漏洞）", "wybug_corp": "中国网络电视台", "wybug_author": "b4dboy", "wybug_date": "2013-04-20 23:33", "wybug_open_date": "2013-06-04 23:34", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["变量覆盖"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-04-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-05-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-05-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-05-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-06-04：\t细节向公众公开  简要描述： 某分站残留着一套老程序。 详细说明：  　　下午去参加了乌云和广测举办的沙龙观望了各种大牛，回来的时候赶上了暴雨那叫一个湿身呀，于是晚上就搜索了下最近的天气接着就点进了cctv的天气频道。　　　　在天气频道的cms目录下发现还残留着一套phpcms 2007。这可是一个相当老的版本呀,说不定可以刷点乌云币呢(PS：沙龙上听说乌云币过200的就能找到月薪8k的工作)。　　　　搜索了一些phpcms 2007的漏洞测试均没有成功而且他这个也删掉了很多模块，xday行不通就只能用0day啦，嘎嘎。下载了一套phpcms 2007进行分析，在module\\movie\\onunload.inc.php里发现了一个update型的注入。\n<?php defined('IN_PHPCMS') or exit('Access Denied');$serverid ? 1 : showmessage($LANG['illegal_operation']);$db->query(\"UPDATE \".TABLE_MOVIE_SERVER.\" SET `num` = (num-1) WHERE serverid = $serverid AND num > 0 \");?>\n$serverid没有进行任何过滤也没有用单引号括起来，所以无视gpc。核心文件include\\common.inc.php里大概80左右变量覆盖漏洞。\nif($PHP_QUERYSTRING && preg_match(\"/^(.*)\\.(htm|html|shtm|shtml)$/\", $PHP_QUERYSTRING, $urlvar)){\tparse_str(str_replace(array('/', '-', ' '), array('&', '=', ''), $urlvar[1]));}\n这个判断太弱了，判断querystring是不是等于静态文件后缀，结尾随便加个参数赋个静态文件的值就过了，经过parse_str就产生了。漏洞太多了不继续分析了。   漏洞证明：  http://weather.cctv.com/cms/movie/onunload.php?serverid=1+and+exists%28select*from+%28select*from%28select+name_const%28@@version,0%29%29a+join+%28select+name_const%28@@version,0%29%29b%29c%29\n\nhttp://weather.cctv.com/cms/movie/onunload.php?serverid=1&db_file=b4dboy&x.htm   修复方案：  建议下架掉这套残留程序   版权声明：转载请注明来源 b4dboy@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2013-04-22 09:52 厂商回复： 感谢，我们将尽快整改。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-04-21 07:21 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  mark    \n     2013-04-21 13:55 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  phpcms2008？    \n     2013-04-21 14:43 |    \t\tb4dboy \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:3        | good bye)\t\t \n  @围剿 标题是编辑改的吧。。。    \n     2013-04-21 16:07 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  新漏洞 就是0day吧 哈哈    \n     2013-04-21 16:30 |    \t\tb4dboy \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:3        | good bye)\t\t \n  @possible 这个版本都没人用了。。。    \n     2013-04-22 09:01 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  @b4dboy 哈哈 求个有人用的     \n     2013-04-22 09:27 |    \t\tb4dboy \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:3        | good bye)\t\t \n  @possible 嘿嘿，拿妹纸来换吧，看你有多少妹纸。哈哈    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}