{"id": 56031, "wybug_id": "wooyun-2014-059180", "wybug_title": "Beescms v3.4 设计缺陷致任意登录后台。", "wybug_corp": "beescms.com", "wybug_author": "′雨。", "wybug_date": "2014-05-02 16:31", "wybug_open_date": "2014-07-28 16:32", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-07：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-28：\t细节向公众公开  简要描述： 看了几个小时 好像也没有看出神马名堂来。 详细说明：  在admin/init.php中\nif (!get_magic_quotes_gpc()){    if (isset($_REQUEST))    {        $_REQUEST  = addsl($_REQUEST);    }    $_COOKIE   = addsl($_COOKIE);\t$_POST = addsl($_POST);\t$_GET = addsl($_GET);}include(DATA_PATH.'confing.php');define('CMS_URL','http://'.$_SERVER['HTTP_HOST'].CMS_SELF);include(INC_PATH.'mysql.class.php');$mysql=new mysql(DB_HOST,DB_USER,DB_PASSWORD,DB_NAME,DB_CHARSET,DB_PCONNECT);if(file_exists(DATA_PATH.\"cache/cache_admin_group.php\")){include(DATA_PATH.\"cache/cache_admin_group.php\");}//检查登陆if(!is_login()){header('location:login.php');exit;}\n这里对get post cookie转义后没有extract。但是在include/init.php中 extract了。\nif (!get_magic_quotes_gpc()){    if (isset($_REQUEST))    {        $_REQUEST  = addsl($_REQUEST);    }    $_COOKIE   = addsl($_COOKIE);\t$_POST = addsl($_POST);\t$_GET = addsl($_GET);}if (isset($_REQUEST)){$_REQUEST  = fl_value($_REQUEST);}    $_COOKIE   = fl_value($_COOKIE);\t$_GET = fl_value($_GET);@extract($_POST);@extract($_GET);@extract($_COOKIE);\n先addslashes一次 然后调用fl_value 来过滤一些特殊字符。在admin/init.php中 \nif(!is_login()){header('location:login.php');exit;}\n判断是否登录。\nfunction is_login(){\tif($_SESSION['login_in']==1&&$_SESSION['admin']){\t\tif(time()-$_SESSION['login_time']>3600){\t\t\tlogin_out();\t\t}else{\t\t\t$_SESSION['login_time']=time();\t\t\t@session_regenerate_id();\t\t}\t\treturn 1;\t}else{\t\t$_SESSION['admin']='';\t\t$_SESSION['admin_purview']='';\t\t$_SESSION['admin_id']='';\t\t$_SESSION['admin_time']='';\t\t$_SESSION['login_in']='';\t\t$_SESSION['login_time']='';\t\t$_SESSION['admin_ip']='';\t\treturn 0;\t}\n\nif($_SESSION['login_in']==1&&$_SESSION['admin']){\t\tif(time()-$_SESSION['login_time']>3600){\t\t\tlogin_out();\t\t}else{\t\t\t$_SESSION['login_time']=time();\t\t\t@session_regenerate_id();\t\t}\t\treturn 1;\n只要满足 session 的login_in true   admin true 和 时间戳减去login_time小于3600就能返回true。这里我们全部覆盖掉。时间戳减去login_time小于3600的话 让login_time 很大很大就行了。首先对index.php请求 然后访问admin这里我把session输出来一下。  满足条件了的。\n\n   漏洞证明：  \n\n直接访问/admin/ 就会跳转到/admin/admin.php了。   修复方案：  加强验证。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-07-28 16:32 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}