{"id": 55174, "wybug_id": "wooyun-2014-061996", "wybug_title": "百度云ROM Discuz x3.1 任务漏洞造成的刷积分", "wybug_corp": "百度", "wybug_author": "路人甲", "wybug_date": "2014-05-23 16:23", "wybug_open_date": "2014-07-07 16:24", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-07：\t细节向公众公开  简要描述： Discuz!X最新版本（及部分旧版本所存在的刷分漏洞）利用DZ X 任务漏洞刷论坛积分兑换奖品 详细说明：  详情请见http://wooyun.org/bugs/wooyun-2010-049502在完成任务时（home.php?mod=draw&do=view&id=xx），任务先前的状态缺少判断完成任务的链接形如：home.php?mod=draw&do=view&id=xx这个地址最终在 source\\class\\class_task.php 中被处理约第370行：function draw($id) {\tglobal $_G;\tif(!($this->task = C::t('common_task')->fetch_by_uid($_G['uid'], $id))) {\t\tshowmessage('task_nonexistence');\t} elseif($this->task['status'] != 0) {\t\tshowmessage('task_not_underway');\t} elseif($this->task['tasklimits'] && $this->task['achievers'] >= $this->task['tasklimits']) {\t\treturn -1;\t}......之后就是获得任务奖励了总觉得上面这一段少了些什么判断？我们对比下其他代码约第473行：function giveup($id) {\tglobal $_G;\tif($_GET['formhash'] != FORMHASH) {\t\tshowmessage('undefined_action');\t} elseif(!($this->task = C::t('common_task')->fetch_by_uid($_G['uid'], $id))) {\t\tshowmessage('task_nonexistence');\t} elseif($this->task['status'] != '0') {\t\tshowmessage('task_not_underway');\t}这一段是放弃任务的判断，我们看到如果 $this->task['status'] != '0',就是说任务没有开始的时候，是不能放弃任务的。但是，在上面那段获取任务奖励的代码中，并没有判断任务是否开始，造成了无需领取任务，就可以无限次数获取奖励。此漏洞还可以用于强行获取由于用户组不符，没有权限领取的任务的奖励。漏洞详细利用，请见漏洞证明。   漏洞证明：  登陆后 完善资料，不断提交下面的地址http://bbs.rom.baidu.com/home.php?mod=task&do=draw&id=3   修复方案：  在 source\\class\\class_task.php 中的 draw 函数部分，加入任务是否领取的判断   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-05-23 19:17 厂商回复： 感谢对百度安全的支持。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-24 14:06 |    \t\t小怿 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:6        | )\t\t \n  该论坛同时存在道具刷分，道具的详细细节可以看 http://wooyun.org/bugs/wooyun-2014-049703    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}