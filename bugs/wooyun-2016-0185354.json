{"id": 87931, "wybug_id": "wooyun-2016-0185354", "wybug_title": "第三方消息推送SDK个推（igexin）因密码学设计缺陷导致通信流量可解密篡改                                      ", "wybug_corp": "getui.com", "wybug_author": "GoSSIP_SJTU", "wybug_date": "2016-03-18 13:39", "wybug_open_date": "2016-06-20 15:40", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["中间人攻击", "第三方", "密码学误用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-03-25：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-05-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-20：\t细节向公众公开  简要描述： 个推是一套第三方推送技术解决方案，大量应用程序（参见http://www.getui.com/case/）通过集成个推SDK来达到给客户端推送消息的功能。但其用于保护通信流量的密码学实现存在重大缺陷，导致推送流量可被解密甚至篡改，从而造成使用该SDK的应用程序都存在用户隐私泄露、恶意消息推送等严重问题。 详细说明：  由于保护通信流量的实现存在严重密码学问题，导致获取到推送流量的中间人可以实时恢复出通信密钥，进而可以解密消息获取推送协议的交互数据、修改交互数据内容、重新加密回合法消息。   漏洞证明：  下面是虾米音乐应用从屏幕点亮到收到一条推送消息的过程中所有通信解密后的情况，从中可以看到一个完整的推送过程。\nSend '\\x0f460012182913413\\x0f359786050198713\\x1fA-359786050198713-1457335818899\\x16UgM0PuGY4Z9hhSeWysmxz5'    Recv '\\x0f]\\x91J\\x13\\x9fg\\xaf\\x1fA-359786050198713-1457335818899 921f7606f5a217900ea4e1e46d8e3e2c 8ffcc07d7c924c7aacd5ef76db0f014d'    注：客户端向个推服务器注册，其中包括sim，imei和AppID信息；服务器确认并返回该用户的cid（921f7606f5a217900ea4e1e46d8e3e2c）。        Send '\\x0f]\\x91J\\x13\\x9fg\\xaf\\x00\\x00\\xff\\x00\\x00\\x16UgM0PuGY4Z9hhSeWysmxz5'    Recv '@\\x0f]\\x91J\\x13\\x9fg\\xaf'    注：客户端向服务器表明在线，服务器确认。        Send '\\xe6\\xf2\\x81\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x0817258000\\x824{\"id\":\"1457335822066\",\"action\":\"addphoneinfo\",\"info\":{\"app\":\"MDP\",\"model\":\"SM-N9006\",\"cell\":\"\",\"imei\":\"359786050198713\",\"sim\":\"460012182913413\",\"mac\":\"\",\"type\":\"ANDROID\",\"system_version\":\"android4.3\",\"deviceid\":\"ANDROID-93ee89e0f06d47b8bd9b34741b71990f\",\"channelid\":\"open:fm.xiami.main\",\"version\":\"**.**.**.**\"}}\\x00 921f7606f5a217900ea4e1e46d8e3e2c'    Recv '\\xe6\\xf2\\x81\\x00\\x00\\x01SO\\xfb\\xf4\\\\\\x0817258000*{\"action\":\"received\",\"id\":\"1457335822066\"}\\x00 921f7606f5a217900ea4e1e46d8e3e2c'        Recv '\\xefy\\x81\\x00\\x00\\x01SP\\x00\\x85\\'\\x03OMP\\x85^{\"id\":\"ce5699d8-5457-4374-8e3d-71aa0c08c44e_OMP\",\"condition\":{\"duration\":\"\"},\"taskid\":\"OSA-0307_d1yBLcjHwb5HT3mR6idYl7\",\"action_chains\":[{\"actionid\":\"1\",\"do\":\"10030\",\"type\":\"goto\",\"is_withnettype\":\"false\"},{\"actionid\":\"10030\",\"noinstall_action\":\"100\",\"appid\":\"\",\"do\":\"100\",\"appstartupid\":{\"android\":\"\",\"ios\":\"\",\"symbia\":\"\"},\"type\":\"startapp\",\"is_withnettype\":\"false\",\"is_autostart\":\"false\"},{\"actionid\":\"100\",\"type\":\"null\",\"is_withnettype\":\"false\"}],\"appkey\":\"jfY3OTRHNC9tSAvPTxK3F2\",\"action\":\"pushmessage\",\"appid\":\"UgM0PuGY4Z9hhSeWysmxz5\",\"messageid\":\"ce5699d8-5457-4374-8e3d-71aa0c08c44e\",\"push_info\":{\"message\":\"\",\"action_key\":\"\",\"launch-image\":\"\",\"sound\":\"\",\"loc-args\":\"\",\"payload\":\"\",\"action-loc-key\":\"\",\"loc-key\":\"\",\"badge\":\"\"}};{\"title\":\"华晨宇新歌《横冲直撞》独家首发!\",\"text\":\"邀你一起回忆我们滚烫炙热的青春!\",\"exts\":{\"category\":\"system\",\"category_id\":86,\"name\":\"虾小米\",\"url\":\"xiami:\\/\\/open?url=http%3a%2f%**.**.**.**%2fmarket%2fmusic%2fact%2fhuachenyu.php\",\"scheme_url\":\"xiami:\\/\\/open?url=http%3a%2f%**.**.**.**%2fmarket%2fmusic%2fact%2fhuachenyu.php\",\"image\":\"http:\\/\\/**.**.**.**\\/images\\/common\\/uploadpic\\/68\\/14573234681214.jpg\",\"type\":\"artist\"}} 921f7606f5a217900ea4e1e46d8e3e2c'    Send 'x\"\\x81\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x0817258000\\x82\\x14{\"action\":\"pushmessage_feedback\",\"appid\":\"UgM0PuGY4Z9hhSeWysmxz5\", \"id\":\"1457336121378\", \"appkey\":\"jfY3OTRHNC9tSAvPTxK3F2\", \"messageid\":\"ce5699d8-5457-4374-8e3d-71aa0c08c44e\",\"taskid\":\"OSA-0307_d1yBLcjHwb5HT3mR6idYl7\",\"actionid\": \"0\",\"result\":\"ok\",\"timestamp\":\"1457336121378\"}\\x00 921f7606f5a217900ea4e1e46d8e3e2c'    注：收到服务器推送的消息，相应动作为打开应用；客户端确认收到，发送反馈消息。\n通信过程中由于作为中间人可以解密、篡改和加密数据包，因此可以任意更改推送的内容，例如更改推送的文字、链接，甚至通过更改action_chains的动作属性，达到startapp，startweb等动作。以下视频（密码gossip）给出两个演示，第一个使用个推给出的demo程序来验证集成了个推SDK的应用程序所进行的推送通信确实可以被在线实时解密和修改。演示中原本推送来的消息是打开**.**.**.**网页，经我们的中间人后，变为**.**.**.**。第二个演示以虾米音乐为例，想要说明的是该应用的确使用了个推协议进行消息推送，并且我们可以解密。若在恰当的时机收到服务器推送的消息，即可像演示一中那样做内容篡改。   修复方案：  更改密码学相关设计与实现，使用密码学安全的算法与协议。   版权声明：转载请注明来源 GoSSIP_SJTU@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2016-03-22 15:37 厂商回复： 1.本次漏洞产生原因是因为个推系统设计初期，综合评估手机的处理性能问题和功耗问题，同时考虑到很多第三方应用会对他们的下发消息进行私有的数据加密处理，因此个推采用了一种安全性相对较弱的通讯加密处理机制。目前对于安全强度要求较高的客户，均在对消息中的payload进行了额外的私有数据加密处理。 2.此次所报的漏洞只可能发生在某个网络中间节点进行统一劫持篡改才会造成一定程度的影响，即用户手机连接上被植入恶意程序的Wifi路由或者手机Wifi热点时，才有可能造成影响。对于绝大多数手机，仍然可以确保数据隐私以及数据不被监听或篡改。目前业内暂未有因为中间人攻击而造成大规模影响的先例。 3.针对于此漏洞，个推平台将在近期加强安全措施，提供新版本SDK，实现采用更高强度的通讯加密方式以及防篡改和防抵赖手段，同时增加相应的服务器设备和带宽资源用于支持相应的安全机制，从而修补此漏洞。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-03-17 15:06 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  这个漏洞严重关注啊！    \n     2016-03-17 15:32 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:71        )\t\t \n  2楼    \n     2016-03-17 15:35 |    \t\t啊L川  \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:39        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  mark    \n     2016-03-17 16:02 |    \t\t暴走 \t\t\t( 普通白帽子  |\t\t\t        Rank:615 漏洞数:107        | 专心补刀。)\t\t \n  凑够热闹    \n     2016-03-17 16:52 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:765 漏洞数:83        | 铁甲依然在)\t\t \n  mark    \n     2016-03-17 17:01 |    \t\tking7 \t\t\t( 普通白帽子  |\t\t\t        Rank:1887 漏洞数:252        | 早知如此绊人心，何如当初莫相识。)\t\t \n  我一看这个洞就知道是上海弄算法的那个洞主    \n     2016-03-18 13:53 |    \t\tzhchbin \t\t\t( 普通白帽子  |\t\t\t        Rank:153 漏洞数:33        )\t\t \n  fmark    \n     2016-03-21 09:47 |    \t\t平安金融科技咨询有限公司(乌云厂商)\t\t \n  关注中    \n     2016-03-22 15:38 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:765 漏洞数:83        | 铁甲依然在)\t\t \n  厂商态度点赞    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}