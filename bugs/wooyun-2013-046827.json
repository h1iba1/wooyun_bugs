{"id": 5353, "wybug_id": "wooyun-2013-046827", "wybug_title": "DEV-C++ 堆缓冲区溢出漏洞", "wybug_corp": "DEV C++ 4.9.9.2", "wybug_author": "光刃", "wybug_date": "2013-12-23 18:19", "wybug_open_date": "2014-03-23 18:19", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["缓冲区溢出"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-12-30：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-02-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-23：\t细节向公众公开  简要描述： 打开源代码时候未对数据格式大小进行检测，导致堆溢出，。载入特定构造的文件可以执行任意恶意代码（shellcode）存在多种数据格式中，这里以.H格式来演示 详细说明：  触发漏洞文件注意：一定要先关联.H文件，让程序以.H格式被打开。C:\\1.h一大堆数据文件文件内数据define XXXX\t\"111111111。。。。111\"很长很长，我构造的是56.0 KB  一定要足够的长   漏洞证明：  分析过程覆盖前的某次操作：00401C6C    53              push    ebx                          ; EAX=02DD2070 ;要处理数据块的地址和大小  02DD2070  4C 00401C6D    3B05 10565900   cmp     eax, dword ptr [595610]      ; 02DBD1C8 和淹没后的大数据地址比较00401C73    75 09           jnz     short 00401C7E。。。。。。\t\t\t\t\t\t\t\t\t;计算要处理数据的开始地址和大小\t\t00401C7E    8B50 04         mov     edx, dword ptr [eax+4]        ; [00DD2070+4]=02DD2070 地址00401C81    8B48 08         mov     ecx, dword ptr [eax+8]        ; [00DD2070+8]=4c       大小00401C84    81F9 00100000   cmp     ecx, 100000401C8A    7F 38           jg      short 00401CC400401C8C    3BC2            cmp     eax, edx00401C8E    75 17           jnz     short 00401CA700401C90    85C9            test    ecx, ecx00401C92    79 03           jns     short 00401C9700401C94    83C1 03         add     ecx, 3要处理的数据（正常）02DD2070  70 20 DD 02[70 20 DD 02][4C 00 00 00]41 63 63 65  p ?p ?L...Acce02DD2080  73 73 20 76 69 6F 6C 61 74 69 6F 6E 20 61 74 20  ss violation at02DD2090  61 64 64 72 65 73 73 20 25 70 20 69 6E 20 6D 6F  address %p in mo02DD20A0  64 75 6C 65 20 27 25 73 27 2E 20 25 73 20 6F 66  dule '%s'. %s of02DD20B0  20 61 64 64 72 65 73 73 4C 00 00 00 17 00 00 00   addressL......02DD20C0  24 8A 40 00 DC 20 DD 02 00 00 00 00 00 00 00 00  $夽.??........我们的大数据02DBD1C8  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD1D8  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD1E8  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD1F8  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD208  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  1111111111111111-----------------------------------------------------------------------------------覆盖瞬间：00401C6C    53              push    ebx\t\t\t\t;EAX=02DBD1C8 要处理数据的地址 (被覆盖了  成了地址31313131 地址31313131）00401C6D    3B05 10565900   cmp     eax, dword ptr [595610]      ; 和淹没后的大数据地址比较\t\t\t;;[595610]=2DB4000 \t\t\t\t\t\t\t\t ;00401C73    75 09           jnz     short 00401C7E\t00401C75    8B50 04         mov     edx, dword ptr [eax+4]00401C78    8915 10565900   mov     dword ptr [595610], edx00401C7E    8B50 04         mov     edx, dword ptr [eax+4]\t;EDX=溢出后的31313131地址\t\t\t;00401C81    8B48 08         mov     ecx, dword ptr [eax+8]\t;ECX=溢出后的31313131大小\t00401C84    81F9 00100000   cmp     ecx, 100000401CC4    8B00            mov     eax, dword ptr [eax]...00401CC4    8B00            mov     eax, dword ptr [eax]\t;02DD000000401CC6    8902            mov     dword ptr [edx], eax\t;内存地址给edx， 溢出了 就是31313131了00401CC8    8950 04         mov     dword ptr [eax+4], edx00401CCB    5B              pop     ebx要处理的数据（被覆盖）02DBD1C8  00 00 DD 02 31 31 31 31 31 31 31 31 31 31 31 31  ..?111111111111   ; 3131313102DBD1D8  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD1E8  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD1F8  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD208  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD218  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD228  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD238  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD248  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DBD258  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DD0000  00 40 DB 02[C8 D1 DB 02]BC 20 00 00 31 31 31 31  .@?妊??..1111    ; 02dbd1c802DD0010  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DD0020  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DD0030  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DD0040  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DD0050  31 31 31 31 31 31 31 31 31 31 31 31 31 31 31 31  111111111111111102DB4000  31 31 31 31[00 00 DD 02]C0 11 00 00 32 32 32 32  1111..??..2222    ;02dd000002DB4010  32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32  222222222222222202DB4020  32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32  222222222222222202DB4030  32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32  222222222222222202DB4040  32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32  222222222222222202DB4050  32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32  2222222222222222；也就是说 数据地址 和数据大小（覆盖后的31313131）我们可控制我们也就可以往数据A处写大小为B的数据。A就是shellcode地址这就是该漏洞的利用原理\n\n   修复方案：  检测大小   版权声明：转载请注明来源 光刃@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-12-27 20:54 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-12-23 18:24 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  不明真相~看看2楼怎么说。    \n     2013-12-23 18:30 |    \t\tm1x7e1 \t\t\t( 普通白帽子  |\t\t\t        Rank:543 漏洞数:132        | 求工作)\t\t \n  不明真相~看看3楼怎么说。    \n     2013-12-23 18:50 |    \t\t摸了你 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:17        | 1shitMVqBjCKrnRvSoixMx6RKpG9J8pBM)\t\t \n  3楼不想说...4楼说吧    \n     2013-12-23 18:55 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  4楼啥都不懂，5楼来吧    \n     2013-12-23 19:05 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  楼下请关注软件漏洞分析技术这本书    \n     2013-12-23 19:07 |    \t\t小驴牙牙 \t\t\t( 普通白帽子  |\t\t\t        Rank:168 漏洞数:43        | 不断学习，进步！)\t\t \n  学习中，感谢！    \n     2013-12-23 19:07 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  不关注请楼下关注    \n     2013-12-23 21:09 |    \t\t233 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:4        | 小孩子看了根本把持不住)\t\t \n  楼下你关注了吗？    \n     2013-12-23 21:50 |    \t\tonlycjeg \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:5        | 我就看看,我不说话.)\t\t \n  我没关注啊.    \n     2013-12-24 09:23 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  这个问题还是得交给一楼来处理^_^    \n     2013-12-28 12:47 |    \t\toooooooooooooooorg \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | nothing)\t\t \n  走开，让我来    \n     2013-12-28 18:06 |    \t\t微笑Style \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 代码爱好者)\t\t \n  本来不明白，看了楼上我明白了    \n     2013-12-28 18:20 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  @微笑Style 明白什么了？    \n     2013-12-28 20:10 |    \t\t妈妈说名字不能起太长 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:1        | 这都可以？)\t\t \n  其实什么都不明白    \n     2013-12-29 12:25 |    \t\t4399gdww \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:4        | )\t\t \n  楼下的明白？    \n     2014-01-01 20:22 |    \t\tDefa \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:13        | <img src=1 onerror=alert(1)>)\t\t \n  依然不明白，    \n     2014-03-23 18:43 |    \t\t萧然 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 喜欢一切美丽的东西！)\t\t \n  楼上都是小白，楼下才是大黑    \n     2014-03-23 20:53 |    \t\tCyrils \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:10        | the more the better)\t\t \n  卧槽走错楼了不是小白    \n     2014-03-23 21:57 |    \t\t笨小猪 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:2        | 杯壁下流)\t\t \n  我看不明白，楼下告诉我。    \n     2014-03-23 23:17 |    \t\tdiguoji \t\t\t( 普通白帽子  |\t\t\t        Rank:323 漏洞数:79        | 中国吉林长春)\t\t \n  楼下，不明白，一楼距今一个月了应该明白了，请教一楼    \n     2015-02-01 21:39 |    \t\t鬼五 \t\t\t( 普通白帽子  |\t\t\t        Rank:214 漏洞数:83        )\t\t \n  依然不明白，楼上各位大大距今快1年了肯定明白了，请教楼上各位大大    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}