{"id": 9637, "wybug_id": "wooyun-2013-033233", "wybug_title": "人人网某分站储存型xss漏洞及上传问题", "wybug_corp": "人人网", "wybug_author": "px1624", "wybug_date": "2013-08-02 07:47", "wybug_open_date": "2013-09-16 07:47", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型", "人人网"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-08-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-09-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-16：\t细节向公众公开  简要描述： 晚上在人人网随便转了转，随手测试了下，发现人人网某分站存在储存型xss，可以盲打后台管理，也可以盗取他人登录cookie（已经证明）。上传位置也有些问题，我做了初步检测，你们自己仔细查查吧，请别给个位数的rank额。 详细说明：  1 存在漏洞的分站是这个：\nhttp://mentos.renren.com/\n\n\n2 上传作品，发现标题位置的字符会输出在js中。果断构造一下xss代码测试，xss代码：\n',(function(){alert(1)}()),'\nF12看了下源码，发现'号被过滤成了′源码：\n<a href=\"javascript:void(0)\" onclick=\"all_video_play(324,'′,(function(){alert(1)}()),′',0,'94678153','http://v139.56img.com/images/28/5/coop_3000002383i56olo56i56.com_cw_137535892041hd.jpg','u')\"><img src=\"http://v139.56img.com/images/28/5/coop_3000002383i56olo56i56.com_cw_137535892041hd.jpg\" width=\"135\" height=\"100\" alt=\"\"></a>\n\n\n3 将'改为html的编码&#39; 然后写入，xss代码为：\n&#39;,(function(){alert(1)}()),&#39;\nF12看一下，吼吼，成功解析了。源码\n：<a href=\"javascript:void(0)\" onclick=\"all_video_play(325,'',(function(){alert(1)}()),'',0,'http://yx.xnimg.cn/M04/22/1308/71/YJjIVnQrU36jai2aimQb63yi.ori.mp3','http://yx.xnimg.cn/M04/62/41/41/ZrIJ3yZrmE3ejaINBjAFvmYz.ori.jpg','m')\"><img src=\"http://yx.xnimg.cn/M04/62/41/41/ZrIJ3yZrmE3ejaINBjAFvmYz.ori.jpg\" width=\"135\" height=\"100\" alt=\"\"></a>\n\n\n4 点击一下试试，成功弹窗了。\n\n5 尝试将\"><也写成html的&#模式，发现这里对于这三个字符会进行二次过滤，过滤为&quot;&gt;&lt;源码：\n<a href=\"javascript:void(0)\" onclick=\"all_video_play(326,'')&quot;&gt;&lt;img src=1 onerror=alert(22)&gt;',0,'http://yx.xnimg.cn/M02/22/1308/79/Zzq6vyB7Rz2uUNN3Yf6RvuAr.ori.mp3','http://yx.xnimg.cn/M04/62/78/78/ym2emmbEB7niZNBnMbuyYfa2.ori.jpg','m')\"><img src=\"http://yx.xnimg.cn/M04/62/78/78/ym2emmbEB7niZNBnMbuyYfa2.ori.jpg\" width=\"135\" height=\"100\" alt=\"\"></a>\n6 测试一下有么有其他限制，能不能插入调用外部js文件的代码。结果表示无压力额~\n\n7 可以写入盗取用户登录cookie的代码。虽然这里是点击型xss，但是中招率貌似还比较高，可能由于是点击播放视频或者音频的原因吧。吼吼，不一会就收到了几个，地址各异，不是很清楚中招的渠道都有哪些。\n\n\n\n8 测试cookie可以成功登录他人账户，并随意进行操作（请放心，我没有发布或者操作用户的任何东西）。\n\n\n\n管理员不知道是下班了还是比较聪明，我等了半个小时，管理的cookie也没弄到。可能因为我前面插了个alert(1)他发现后留意到了吧。不过根据我以前xss过那么多次人人网的经验，这里管理后台肯定是没有进行xss的二次过滤的。这里我也就不再等管理员cookie去登录后台截图了，反正这种后台应该也没啥东西。。9  这里的上传也有问题，图片位置和视频位置都可以传非法文件上去。我随便写了个txt，后缀改为xx.jpg  xx.mp3就直接给传上去了。。。   漏洞证明：  请看上面详情。   修复方案：  1  对'号进行二次过滤。2  上传位置判断做一下判断。   版权声明：转载请注明来源 px1624@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2013-08-02 16:21 厂商回复： 已修复，谢谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-08-02 07:48 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  mark    \n     2013-08-02 07:58 |    \t\tnauscript \t\t\t( 普通白帽子  |\t\t\t        Rank:291 漏洞数:57        | 我淫荡啊我淫荡)\t\t \n  mark too    \n     2013-08-02 08:25 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  mark three    \n     2013-08-02 09:36 |    \t\tc2c2 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:4        )\t\t \n  mark four    \n     2013-08-02 09:41 |    \t\tAdra1n \t\t\t( 普通白帽子  |\t\t\t        Rank:437 漏洞数:68        )\t\t \n  mark five.    \n     2013-08-02 10:29 |    \t\t蘑菇 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:1        | 没有做不到的，只有想不到的！)\t\t \n  mark six    \n     2013-08-02 11:41 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  mark 柒    \n     2013-08-02 11:50 |    \t\t1ee \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:14        | 看书中....)\t\t \n  mark 奶    \n     2013-08-02 17:19 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  原来是被这12rank 给超越了。。    \n     2013-08-02 17:42 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @齐迹 。。。我都两个月没怎么发力了。。。    \n     2013-08-02 18:20 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  @px1624 坐等发力！    \n     2013-08-02 18:26 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @齐迹 略虚。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}