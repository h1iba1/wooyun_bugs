{"id": 55280, "wybug_id": "wooyun-2014-061486", "wybug_title": "代码审计系列7: youyax开源论坛程序 DOM Based XSS", "wybug_corp": "youyax.com", "wybug_author": "LaiX", "wybug_date": "2014-05-19 19:59", "wybug_open_date": "2014-08-17 20:00", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "10", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-17：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： DOM Based XSS 详细说明：  程序官网：http://www.youyax.com/漏洞程序下载地址:http://down.chinaz.com/soft/33435.htm漏洞文件位置在：\\YouYaX\\Tpl\\mobile\\home\\mypub.html 第23行处的 eval() 函数\n..................\tdocument.onreadystatechange = function(){               if (document.readyState == \"complete\"){    \tvar aes=document.getElementById(\"pagination\").getElementsByTagName(\"a\");\t\t\t\tvar url=window.location.href;18行\t\t\t\tvar url_array=url.split(\"=\");\t\t\t\tvar page=url_array[1];\t\t\t\tvar uclass=document.getElementById(\"pagination\").getElementsByTagName(\"a\");\t\t\t\tfor(var n in uclass)\t\t\t\t{23行\t\t\t\t\tvar str=eval(\"/fy\"+page+\"/\");\t\t\t\t\tif(str.test(uclass[n].className)&&uclass[n].className!=undefined)\t\t\t\t\t{\t\t\t\t\t\tuclass[n].style.background=\"#deccb1\";\t\t\t\t\t}\t\t\t\t}\t}}..................\n观察上面的代码不难发现，18行处的\nvar url_array=url.split(\"=\");\n是罪魁祸首。整个过程将URL以等号(=)之后的字符送入page变量，然后等到页面触发AJAX - onreadystatechange 事件 再通过eval函数执行了page里面的变量。知道了程序的逻辑后，我们可以在URL处构造如下：\nhttp://127.0.0.1/YouYaX/Tpl/mobile/home/mypub.html?=/.source+alert()/\n   漏洞证明：  当我们访问http://127.0.0.1/YouYaX/Tpl/mobile/home/mypub.html?=/.source+alert()/\n\n   修复方案：  根据业务选择是否保留或者过滤   版权声明：转载请注明来源 LaiX@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2014-05-19 21:02 厂商回复： 对系统无不良影响，但有助于开发者编码规范 最新状态： 2014-05-20：作者低估了漏洞的破坏力，被诱导点击后，危害等级应该是很高的，感谢LaiX指出的问题 2014-05-25：欢迎白帽子们帮我来做论坛测试  ", "replys": "漏洞评价：\n评论\n     2014-05-19 21:34 |    \t\tLaiX \t\t\t( 普通白帽子  |\t\t\t        Rank:128 漏洞数:39        | 承接 建站、仿站、维护、反黑客、代码审计...)\t\t \n  不应该无影响吧。    \n     2014-05-19 21:53 |    \t\tLaiX \t\t\t( 普通白帽子  |\t\t\t        Rank:128 漏洞数:39        | 承接 建站、仿站、维护、反黑客、代码审计...)\t\t \n  找厂商理论了一下，以下是厂商的回复：因为跨站脚本不是存储在服务器上也不是访问服务器返回跨站代码而是客户端脚本的逻辑处理问题引起的，危害性不大，除非有些知识超出我范围了，那我就不知了。    \n     2014-05-19 23:27 |    \t\tLaiX \t\t\t( 普通白帽子  |\t\t\t        Rank:128 漏洞数:39        | 承接 建站、仿站、维护、反黑客、代码审计...)\t\t \n  结贴：http://bbs.youyax.com/Content-index-id-5389.aspx    \n     2014-05-22 23:24 |    \t\tYouYaX(乌云厂商)\t\t \n  1分很低，应该20分    \n     2014-05-23 11:30 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  @YouYaX 反射XSS一般5分    \n     2014-05-23 13:48 |    \t\tYouYaX(乌云厂商)\t\t \n  @只发通用型 貌似是我给多少分，白帽子就得多少分，别人帮忙找出了问题，20分应该的。    \n     2014-05-23 18:24 |    \t\tLaiX \t\t\t( 普通白帽子  |\t\t\t        Rank:128 漏洞数:39        | 承接 建站、仿站、维护、反黑客、代码审计...)\t\t \n  @只发通用型 给多少rank无所谓，只要能认真思考积极修复，那就是对白帽子最大的回报了    \n     2014-05-23 18:56 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  @YouYaX 良心厂商 我来了...    \n     2014-05-23 23:06 |    \t\tYouYaX(乌云厂商)\t\t \n  @只发通用型 欢迎前去测试~`(*∩_∩*)′    \n     2014-05-23 23:09 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  @YouYaX 已经提交 在后台审核了    \n     2014-05-24 20:31 |    \t\tYouYaX(乌云厂商)\t\t \n  @只发通用型 没收到通知    \n     2014-05-26 16:13 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  能看到代码？    \n     2014-05-26 16:56 |    \t\tYouYaX(乌云厂商)\t\t \n  @计算姬 我公开了，所以能看到吧    \n     2014-05-26 17:06 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  @YouYaX 嗯，我是说他能看到bbs的代码？我后来看了下，这论坛是开源的，所以能吓到代码啊，我懂了。我刚也提交了一个。    \n     2014-06-06 08:28 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @YouYaX 正愁今天撸哪一套，就你了！    \n     2014-06-06 09:23 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  @mramydnei 撸的差不多了，还有属于非代码安全的问题。不过是小厂商，我就不提交了。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}