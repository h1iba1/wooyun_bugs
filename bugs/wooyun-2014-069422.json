{"id": 528, "wybug_id": "wooyun-2014-069422", "wybug_title": "LNMP一些不安全的默认配置", "wybug_corp": "LNMP", "wybug_author": "phith0n", "wybug_date": "2014-07-23 18:25", "wybug_open_date": "2014-10-21 18:26", "wybug_type": "默认配置不当", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["默认配置不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-31：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-21：\t细节向公众公开  简要描述： LNMP是国内用的比较多的Linux下一键搭建nginx+php+mysql环境的程序，但该程序的默认配置不好，容易造成安全问题。不过问题并不大，所以标题不敢写太猛~今天搭建环境，顺便把问题提交了，希望能得到修复。 详细说明：  \n\n问题1：disable_function禁用的函数不彻底。默认禁用的函数是：\n\n明显不全，没有禁用popen，所以我们可以使用popen来执行命令：\n$f = popen(\"ifconfig\",\"r\");while(!@feof($f)){$re .= @fread($f,1024);}@pclose($f);echo $re;\n问题2：自带的proftpd在创建新账户以后会将账号密码保存在/tmp目录下的.passwd中，这个文件权限是644，是允许所有用户读取的。所以，只要我有一个webshell或普通用户权限，就能读取别人的ftp账号密码。（造成跨站等危险）究其原因，就是在安装好proftpd后，lnmp会在/root目录下新建一个proftpd_vhost.sh脚本，目的是方便用户直接使用此脚本来创建ftp账号。我们看看这个sh的代码：/root/proftpd_vhost.sh 88行开始：\nuseradd -s /sbin/nologin -d $userdir -c \"lnmp proftpd user\" $usernamecat >/tmp/$user.passwd<<eof$username:$userpasseofchpasswd < /tmp/$user.passwdcat >/usr/local/proftpd/etc/vhost/$username.conf<<eof<Directory $userdir>     <Limit ALL>          AllowUser $username     </Limit></Directory>eofecho \"Restart ProFTPd......\"/etc/init.d/proftpd stop/etc/init.d/proftpd startecho \"=========================================================================\"echo \"Add ProFTPd Virtual Host for LNMP v1.0 ,  Written by Licess \"echo \"=========================================================================\"echo \"For more information please visit http://www.lnmp.org/\"echo \"\"echo \"Your UserName:$username\"echo \"Your Password:$userpass\"echo \"Directory of $username:$userdir\"echo \"\"echo \"=========================================================================\"\n先调用useradd添加了一个账号，然后cat > 将字符串\"$username:$userpass\"写入/tmp/$user.passwd文件中。然后将/tmp/$user.passwd文件的内容传入chpasswd命令，来修改新增加的用户的密码。最后就将配置写入vhost配置文件，再echo一些信息，这个sh脚本就结束了。直到最后lnmp也没有去删除这个/tmp/$user.passwd文件，所以就遗留了一个包含新创建的ftp账号密码的文件，而且所有用户都有读权限：\n\n   漏洞证明：  \n\n\n\n   修复方案：  无。   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-07-28 09:44 厂商回复： CNVD未直接确认（暂未发现通用多个实例情况），由于默认配置存在的风险暂不列入处置流程。先行确认rank 10 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-23 20:16 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  @军哥 @猫七     \n     2014-07-24 12:05 |    \t\t帅气凌云 \t\t\t( 普通白帽子  |\t\t\t        Rank:314 漏洞数:60        | 弱点扫描{Www.VulScan.CN} 为网站健康检查...)\t\t \n  php彩蛋已知的    \n     2014-07-24 12:10 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  @帅气凌云 不是彩蛋    \n     2014-07-28 11:53 |    \t\twinsyk \t\t\t( 普通白帽子  |\t\t\t        Rank:108 漏洞数:16        | 越长大越孤单)\t\t \n  nginx 解析？    \n     2014-07-28 14:06 |    \t\t帅气凌云 \t\t\t( 普通白帽子  |\t\t\t        Rank:314 漏洞数:60        | 弱点扫描{Www.VulScan.CN} 为网站健康检查...)\t\t \n  @phith0n 发来，我修补我的服务器    \n     2014-11-28 18:06 |    \t\t廷廷 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 有很强的好奇心，爱好广泛，求女女带走。。...)\t\t \n   还可以这样玩。 学习了·    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}