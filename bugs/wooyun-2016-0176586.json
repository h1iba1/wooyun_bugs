{"id": 86828, "wybug_id": "wooyun-2016-0176586", "wybug_title": "天融信TopADS任意文件读取及删除四处打包(无需登录)", "wybug_corp": "天融信", "wybug_author": "xfkxfk", "wybug_date": "2016-02-17 23:27", "wybug_open_date": "2016-05-18 11:00", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取", "源码审核", "文件操作参数未过滤", "任意删除文件"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-02-21：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-04-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-18：\t细节向公众公开  简要描述： 天融信TopADS任意文件读取及删除四处打包(无需登录) 详细说明：  天融信TopADS任意文件读取及删除四处打包(无需登录)产品介绍：http://**.**.**.**/aqcp/bjaq/kjjfw/ddos_20130315165858709314/index.htm第一处文件读取文件/usr/local/apache2/htdocs/modules/ads/ads_bwlist_download.php\n<?php    $file_dir = \"/SE/web/\";    $file_name = $_POST['filename'];    if (!file_exists($file_dir . $file_name)) {     \techo \"NO SUCH FILE\";    \texit;    }    // 打开文件     $file = fopen($file_dir . $file_name, \"r\");     // 输入文件标签     Header(\"Content-type: application/octet-stream\");     Header(\"Accept-Ranges: bytes\");     Header(\"Accept-Length: \".filesize($file_dir . $file_name));     Header(\"Content-Disposition: attachment; filename=\" . $file_name);     // 输出文件内容     echo fread($file,filesize($file_dir . $file_name));    fclose($file);?>\n不用解释了，一眼就看出来了。。。第二处文件读取及文件删除文件/usr/local/apache2/htdocs/modules/ads/ads_log_download.php\n<?php    date_default_timezone_set(\"Asia/Shanghai\");    error_reporting(0);    $file_name = $_GET[\"name\"];    $way = $_GET[\"way\"];    $file_dir = \"/SE/dumplog/\".$way.\"/\";    Header(\"Content-type: application/octet-stream\");     Header(\"Accept-Ranges: bytes\");     Header(\"Accept-Length: \".filesize($file_dir . $file_name));     Header(\"Content-Disposition: attachment; filename=\" . $file_name);     $file = fopen($file_dir . $file_name,\"rb\");        fseek($file, 0);    while (!feof($file))     {       set_time_limit(0);       print(fread($file, 1024*8));       flush();       ob_flush();    }        fclose($file);       if ($way == \"manul\")     {           unlink($file_dir . $file_name);    }    exit;       ?>\n这里存在任意文件读取，并且还存在任意文件删除漏洞第三处文件读取文件/usr/local/apache2/htdocs/modules/ads/ads_pcap_download.php\n<?php    $file_name = $_GET[\"filename\"];     $file_dir = \"/SE/ads_tcpdump/\";    if (!file_exists($file_dir . $file_name))    {         //检查文件是否存在         $file_dir = \"/SE/attack_cap/\";        if (!file_exists($file_dir . $file_name))        {            $file_dir = \"/SE/abnormal_cap/\";            if (!file_exists($file_dir . $file_name))            {                echo \"NO SUCH FILE\";                exit;            }        }    }    // 打开文件     $file = fopen($file_dir . $file_name,\"r\");     // 输入文件标签     Header(\"Content-type: application/octet-stream\");     Header(\"Accept-Ranges: bytes\");     Header(\"Accept-Length: \".filesize($file_dir . $file_name));     Header(\"Content-Disposition: attachment; filename=\" . $file_name);     // 输出文件内容     fseek($file, 0);    while (!feof($file))     {       set_time_limit(0);       print(fread($file, 1024*8));       flush();       ob_flush();    }    fclose($file);    exit;?>\n也不用多余的解释了第四处文件读取文件/usr/local/apache2/htdocs/modules/ads/ads_report_download.php\n<?php    $file_name = $_POST[\"filename\"];    $file_dir = $_SERVER['DOCUMENT_ROOT'].\"/cachedata/reports/\";    if (!file_exists($file_dir . $file_name))    {     \techo \"NO SUCH FILE\";    \texit;    }    // 打开文件     $file = fopen($file_dir . $file_name, \"r\");     // 输入文件标签     Header(\"Content-type: application/octet-stream\");     Header(\"Accept-Ranges: bytes\");     Header(\"Accept-Length: \".filesize($file_dir . $file_name));     Header(\"Content-Disposition: attachment; filename=\" . $file_name);     // 输出文件内容     echo fread($file,filesize($file_dir . $file_name));    fclose($file);    exit;?>\n这里更黄更暴力，无需赘述   漏洞证明：  上面的四处文件读取和删除都很容易证明我们拿第一处证明案例：**.**.**.**/\n\n然后拿最后一处证明案例：**.**.**.**/\n\n第二处和第三处就不再证明了   修复方案：  添加登录验证，过来非法数据   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2016-02-18 10:56 厂商回复： 已通过其它渠道获知，谢谢提交。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-02-18 00:38 |    \t\tzeracker  \t\t\t( 普通白帽子  |\t\t\t        Rank:1077 漏洞数:139        | 爱吃小龙虾。)\t\t \n  你哪来这么多设备测试啊？    \n     2016-02-18 00:57 |    \t\tXser \t\t\t( 普通白帽子  |\t\t\t        Rank:390 漏洞数:88        | JDSec)\t\t \n  @zeracker 空间搜索下就有了    \n     2016-02-18 08:15 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2313 漏洞数:351        | 呵呵！)\t\t \n  @Xser @zeracker 天融信产品中心，挨个产品来一遍    \n     2016-02-18 08:41 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:322 漏洞数:58        | little red pig!)\t\t \n  什么空间搜索下？    \n     2016-02-18 09:11 |    \t\t坏男孩-A_A \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:23        | 膜拜学习中)\t\t \n  关键字是什么呢?    \n     2016-02-18 09:33 |    \t\tcf_hb \t\t\t( 普通白帽子  |\t\t\t        Rank:119 漏洞数:17        | 爱生活，爱安全！)\t\t \n  xfk牛屌屌的，求带飞    \n     2016-02-19 14:48 |    \t\t盛大网络(乌云厂商)\t\t \n  http://loudong.360.cn/vul/profile/u/xfkxfk/page/2    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}