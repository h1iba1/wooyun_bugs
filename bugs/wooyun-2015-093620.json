{"id": 44474, "wybug_id": "wooyun-2015-093620", "wybug_title": "从百度某论坛存储型XSS到百度浏览器远程命令执行", "wybug_corp": "百度", "wybug_author": "路人甲", "wybug_date": "2015-01-24 01:10", "wybug_open_date": "2015-04-24 01:12", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行", "浏览器漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-03-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-24：\t细节向公众公开  简要描述： 。。。 详细说明：  新版本的百度浏览器，未修复下载目录可通过特权API直接设置的漏洞，具体见： WooYun: 百度浏览器远程命令执行五 那么，只要找到一个特权域下的XSS，即可导致下载程序到指定目录：其中http://bbs.liulanqi.baidu.com/属于特权域，如下图所示，可以成功在该域下执行特权API\n\n-------------------------------http://bbs.liulanqi.baidu.com/ 是一个 DZ 3.2 的论坛，默认功能不知道有没有XSS，但是百度自己所添加的百度云附件功能却出现了存储型XSS。XSS的成因是获取http://pan.baidu.com的链接后，通过正则，匹配出链接后的JSON数据，parse后，未经过滤，即被拼接进入DOM中。只需要回帖，发表以下内容：\n[url=http://pan.baidu.com/s/1dDgZov3?frm=fujian#%7B%22surl%22%3A%22s%2F1dDgZov3%3Ffrm%3Dfujian%22%2C%22sdate%22%3A1422007684%2C%22sname%22%3A%22<img src onerror=console.log(111111)>logo.png%22%2C%22isdir%22%3A0%2C%22uk%22%3A%222600757472%22%2C%22uname%22%3A%22abc%22%7D]百度云附件：logo.png[/url]\n可以看到console.log(111111) 被成功执行。\n\n可以直接看帖子：http://bbs.liulanqi.baidu.com/forum.php?mod=viewthread&tid=1150&pid=94627&page=11&extra=#pid94627打开F12即可看到输出的111111--------------------------------------------------结合以上两点, 即向启动目录写入文件。（具体漏洞利用代码参见 WooYun: 百度浏览器远程命令执行五 ），利用效果图如下：\n\n   漏洞证明：  见详细说明   修复方案：  1. 修复存储型xss2. 修复可以通过特权域API来设置下载任意下载目录的问题。当前的设置下载目录的方式是：点击设置下载目录按钮-》用户选择路径-》选择完成后，返回用户所选择的路径-》特权域API对所选择的路径设置进行保存（百度浏览器是这种）正确的设置下载目录的方式是： 点击设置下载目录按钮-》用户选择路径-》选择完成后，在浏览器端的代码里保存下载目录的设置 （一般浏览器都是这种）   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-01-26 10:25 厂商回复： 感谢提交，已通知业务部门处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-24 01:17 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  趁着没人 占个座    \n     2015-01-24 01:29 |    \t\t咸鱼翻身 \t\t\t( 普通白帽子  |\t\t\t        Rank:576 漏洞数:108        )\t\t \n  二楼。。。。。。。。。。    \n     2015-01-24 03:10 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  百度浏览器也不容易啊 lol    \n     2015-01-28 14:14 |    \t\tsec_jtn \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:56        | 本想无耻的刷rank，最后发现是我想太多了。...)\t\t \n  卧槽，CCAV能看见我吗？我是4L给个特写啊    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}