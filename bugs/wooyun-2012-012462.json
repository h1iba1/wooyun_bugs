{"id": 16552, "wybug_id": "wooyun-2012-012462", "wybug_title": "无需client_sec可用QQ登录平台发表空间日志等高权限操作（WooYun-2012-11314衍生）", "wybug_corp": "腾讯", "wybug_author": "horseluke", "wybug_date": "2012-09-20 14:16", "wybug_open_date": "2012-11-04 14:17", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-09-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-09-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-09-30：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-10-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-10-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-11-04：\t细节向公众公开  简要描述： WooYun-2012-11314（http://www.wooyun.org/bugs/wooyun-2010-011314 ）的报告者@Tater 在阐述漏洞成因时没有说透，其实这是OAuth 2.0中Client-side Implicit Grant潜在的安全隐患，各个支持OAuth 2.0的开放平台都有这问题，其中就包括QQ登录。 详细说明：  该隐患就是，OAuth 2.0中Client-side Implicit Grant获取的access token可以用在Server-side通讯中，而且由于在访问受保护资源时无需传递app secret，而app key又是公开的，结果就由于这种“无绑定token”，导致api无法分辨合法的请求来源，而出现了问题。（详细将在zone.wooyun.org有详文）以腾讯的QQ登录开放平台为例，发表空间日志接口（add_one_blog）是需要高权限的。普通人申请的当然不可能有的，不过成功案例就一定有的了。看了看，点点应该是最佳选择。到它的登录页面查看，记下其client_id：216028\n\n接下来，就是走OAuth 2.0中Client-side Implicit Grant流程了。首先就是根据文档：http://wiki.opensns.qq.com/wiki/%E3%80%90QQ%E7%99%BB%E5%BD%95%E3%80%91%E4%BD%BF%E7%94%A8Implicit_Grant%E6%96%B9%E5%BC%8F%E8%8E%B7%E5%8F%96Access_Token 构造出如下url（scope参数猜死人啊…...）：https://graph.qq.com/oauth2.0/authorize?response_type=token&client_id=216028&redirect_uri=http://open.z.qq.com/moc2/success.jsp&scope=get_user_info,add_one_blog,do_like,add_t,list_album访问之：\n\n一切顺利的话，抓包会发现回调的授权中转页会有access token：\n\n好了，请出server-side脚本（请放置在php服务器上运行）：http://horseluke-code.googlecode.com/svn/trunk/draftCode/oauth2_client_side_side_effect/qq_oauth2.php 填入参数，submit：\n\n   漏洞证明：  调用成功~\n\n   修复方案：  我也想知道怎么解决啊，怎么兼顾client-side和server-side这两个场景真的好考人智慧啊，这个协议如果再改真的害死开发者啊，难怪Eran Hammer要画圈圈诅咒…...   版权声明：转载请注明来源 horseluke@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2012-09-20 16:11 厂商回复： 感谢反馈，我们已同步给业务进行处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-09-20 14:31 |    \t\tupload \t\t\t( 普通白帽子  |\t\t\t        Rank:251 漏洞数:43        | 此处略--！)\t\t \n  好长....................................的标题    \n     2012-09-20 14:45 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  @upload 呃...我也不想...    \n     2012-09-20 14:48 |    \t\tNiceWorm \t\t\t( 普通白帽子  |\t\t\t        Rank:179 漏洞数:38        )\t\t \n  恩。有意思。呵呵    \n     2012-09-20 14:56 |    \t\tupload \t\t\t( 普通白帽子  |\t\t\t        Rank:251 漏洞数:43        | 此处略--！)\t\t \n  @NiceWorm 103！    \n     2012-09-21 07:08 |    \t\tner \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:4        )\t\t \n  好长的标题.还有那看不懂的参数...    \n     2012-10-10 16:47 |    \t\ticefish \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:8        | 欢迎大家和我用邮件进行交流~)\t\t \n  OAuth 2.0 应用向授权服务器取资源的时候不都要带app sec吗？为什么qq这个可以不带呢，不带的话，按理qq资源服务器应该是验证不通过的啊。@horseluke    \n     2012-10-10 16:51 |    \t\ticefish \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:8        | 欢迎大家和我用邮件进行交流~)\t\t \n  哦，原来OAuth2大致有两种实现方式，Implicit grant这种不要app sec    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}