{"id": 37223, "wybug_id": "wooyun-2015-0100175", "wybug_title": "ROCBOSS V2.0重装漏洞", "wybug_corp": "rocboss.com", "wybug_author": "浅蓝", "wybug_date": "2015-03-10 10:53", "wybug_open_date": "2015-06-08 11:46", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-10：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-08：\t细节向公众公开  简要描述： 如题 详细说明：  在根目录中有个install.php，该文件未验证/生成lock文件。 也不会自动删除该文件导致重装\n<?phpif (isset($_POST['host'])){\t$host = $_POST['host'];\t$user = $_POST['user'];\t$password = $_POST['password'];\t$name = $_POST['name'];\t$admin_name = $_POST['admin_name'];\t$admin_email = $_POST['admin_email'];\t$admin_password = $_POST['admin_password'];\t$safe_key = $_POST['safe_key'];\t$path = $_POST['path'];\t$conn = mysql_connect($host, $user, $password);\tif (!$conn)\t{\t\tdie('Could not connect: ' . mysql_error());\t}\tmysql_select_db($name, $conn);\tmysql_query(\"SET NAMES utf8\");\tmysql_query(\"SET FOREIGN_KEY_CHECKS = 0\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_attachment`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_favorite`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_floor`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_follow`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_notification`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_praise`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_reply`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_score`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_topic`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_user`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_whisper`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_tag`\");\tmysql_query(\"DROP TABLE IF EXISTS `roc_topic_tag_connection`\");\tmysql_query(\"\t\tCREATE TABLE `roc_attachment` (\t\t  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,\t\t  `uid` mediumint(8) unsigned NOT NULL,\t\t  `path` varchar(128) NOT NULL,\t\t  `time` int(11) unsigned NOT NULL,\t\t  `tid` int(11) unsigned NOT NULL DEFAULT '0',\t\t  `pid` int(11) unsigned NOT NULL DEFAULT '0',\t\t  PRIMARY KEY (`id`,`uid`,`tid`,`pid`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_favorite` (\t\t  `fid` mediumint(8) NOT NULL AUTO_INCREMENT,\t\t  `uid` mediumint(8) NOT NULL,\t\t  `tid` int(11) NOT NULL,\t\t  PRIMARY KEY (`fid`),\t\t  KEY `fuid` (`fid`),\t\t  KEY `id` (`tid`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_floor` (\t\t  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,\t\t  `pid` int(11) unsigned NOT NULL,\t\t  `uid` mediumint(8) unsigned NOT NULL,\t\t  `content` varchar(120) NOT NULL,\t\t  `posttime` int(11) NOT NULL,\t\t  PRIMARY KEY (`id`,`pid`,`uid`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_follow` (\t\t  `uid` mediumint(8) unsigned NOT NULL DEFAULT '0',\t\t  `fuid` mediumint(8) unsigned NOT NULL DEFAULT '0',\t\t  PRIMARY KEY (`uid`,`fuid`),\t\t  KEY `uid` (`uid`),\t\t  KEY `fuid` (`fuid`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_notification` (\t\t  `nid` mediumint(8) NOT NULL AUTO_INCREMENT,\t\t  `atuid` mediumint(8) NOT NULL,\t\t  `uid` mediumint(8) NOT NULL,\t\t  `tid` int(11) NOT NULL,\t\t  `pid` int(11) NOT NULL,\t\t  `fid` int(11) unsigned NOT NULL,\t\t  `isread` tinyint(1) unsigned zerofill NOT NULL DEFAULT '0',\t\t  PRIMARY KEY (`nid`),\t\t  KEY `atuid` (`atuid`,`isread`,`nid`),\t\t  KEY `tid` (`tid`),\t\t  KEY `pid` (`pid`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_praise` (\t\t  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,\t\t  `uid` mediumint(8) unsigned NOT NULL DEFAULT '0',\t\t  `tid` int(11) unsigned NOT NULL DEFAULT '0',\t\t  PRIMARY KEY (`id`,`uid`,`tid`),\t\t  KEY `uid` (`uid`),\t\t  KEY `fuid` (`tid`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_reply` (\t\t  `pid` int(11) unsigned NOT NULL AUTO_INCREMENT,\t\t  `tid` int(11) unsigned NOT NULL DEFAULT '0',\t\t  `uid` mediumint(8) NOT NULL,\t\t  `content` varchar(250) NOT NULL,\t\t  `client` varchar(16) NOT NULL,\t\t  `posttime` int(11) NOT NULL,\t\t  PRIMARY KEY (`pid`,`tid`,`uid`),\t\t  KEY `tid` (`tid`,`pid`),\t\t  KEY `uid` (`uid`,`pid`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_score` (\t\t  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,\t\t  `uid` mediumint(8) unsigned NOT NULL,\t\t  `changed` smallint(6) NOT NULL,\t\t  `remain` mediumint(8) NOT NULL,\t\t  `type` tinyint(2) NOT NULL,\t\t  `time` int(11) unsigned NOT NULL,\t\t  PRIMARY KEY (`id`,`uid`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_tag` (\t\t  `tagid` int(11) unsigned NOT NULL AUTO_INCREMENT,\t\t  `tagname` varchar(16) NOT NULL,\t\t  `used` int(11) unsigned NOT NULL,\t\t  PRIMARY KEY (`tagid`,`tagname`,`used`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_topic` (\t\t  `tid` int(11) NOT NULL AUTO_INCREMENT,\t\t  `uid` mediumint(8) NOT NULL,\t\t  `title` varchar(64) NOT NULL,\t\t  `content` text NOT NULL,\t\t  `comments` mediumint(8) NOT NULL DEFAULT '0',\t\t  `client` varchar(16) DEFAULT NULL,\t\t  `istop` tinyint(1) unsigned NOT NULL DEFAULT '0',\t\t  `islock` tinyint(1) unsigned NOT NULL DEFAULT '0',\t\t  `posttime` int(11) NOT NULL,\t\t  `lasttime` int(11) NOT NULL,\t\t  PRIMARY KEY (`tid`,`uid`,`title`),\t\t  KEY `uid` (`uid`,`tid`),\t\t  KEY `cid` (`lasttime`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_topic_tag_connection` (\t\t  `tid` int(11) unsigned NOT NULL,\t\t  `tagid` int(11) unsigned NOT NULL,\t\t  PRIMARY KEY (`tid`,`tagid`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_user` (\t\t  `uid` mediumint(8) unsigned NOT NULL AUTO_INCREMENT,\t\t  `username` char(26) NOT NULL,\t\t  `email` char(36) NOT NULL,\t\t  `signature` varchar(32) NOT NULL,\t\t  `password` char(32) NOT NULL,\t\t  `regtime` int(11) NOT NULL,\t\t  `lasttime` int(11) NOT NULL,\t\t  `qqid` char(32) NOT NULL,\t\t  `scores` mediumint(8) unsigned NOT NULL,\t\t  `money` mediumint(8) unsigned NOT NULL,\t\t  `groupid` tinyint(2) unsigned NOT NULL DEFAULT '1',\t\t  PRIMARY KEY (`uid`),\t\t  UNIQUE KEY `nickname` (`username`),\t\t  KEY `email` (`email`),\t\t  KEY `qqid` (`qqid`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"\t\tCREATE TABLE `roc_whisper` (\t\t  `id` mediumint(8) unsigned NOT NULL AUTO_INCREMENT,\t\t  `atuid` mediumint(8) unsigned NOT NULL,\t\t  `uid` mediumint(8) unsigned NOT NULL,\t\t  `content` varchar(255) NOT NULL,\t\t  `posttime` int(11) NOT NULL,\t\t  `isread` tinyint(1) unsigned NOT NULL DEFAULT '0',\t\t  `del_flag` mediumint(8) unsigned NOT NULL,\t\t  PRIMARY KEY (`id`),\t\t  KEY `atuid` (`atuid`,`isread`,`id`)\t\t) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT\");\tmysql_query(\"SET FOREIGN_KEY_CHECKS = 1;\");\tmysql_query(\"INSERT INTO `roc_user` (username, email, signature, password, regtime, lasttime, qqid, scores, money, groupid) VALUES ('\".$admin_name.\"', '\".$admin_email.\"', '我是管理员，哈哈', '\".md5($admin_password).\"', '\".time().\"', '\".time().\"', '', '1000', '0', '9')\");\tmysql_close($conn);\t$content = file_get_contents('application/config/config.php');\t$content = preg_replace('/\\'database_name\\' => .+?\\,/s', '\\'database_name\\' => \\'' . $name . '\\',', $content);\t$content = preg_replace('/\\'server\\' => .+?\\,/s', '\\'server\\' => \\'' . $host . '\\',', $content);\t$content = preg_replace('/\\'username\\' => .+?\\,/s', '\\'username\\' => \\'' . $user . '\\',', $content);\t$content = preg_replace('/\\'password\\' => .+?\\,/s', '\\'password\\' => \\'' . $password . '\\',', $content);\tfile_put_contents('application/config/config.php', $content);\t$content = file_get_contents('index.php');\t$content = str_replace('define(\\'ROOT\\', \\'/\\');', 'define(\\'ROOT\\', \\''.$path.'\\');', $content);\tfile_put_contents('index.php', $content);\theader('location: ./');}?><!doctype html><html><head><meta charset=\"utf-8\" /><title>ROCBOSS 2.0安装文件</title><style type=\"text/css\">*{padding:0;margin:0;}html,body{font:normal 12px 'Microsoft Yahei';color:#666;}.install{width: 300px;margin:20px auto;}#info{background:#353535;overflow:hidden;height:30px;color: #fff;text-align: center;line-height: 30px;}#notice{background:#46A880;overflow:hidden;height:30px;color: #fff;text-align: center;line-height: 30px;}p{height: 30px;line-height: 30px;font-weight: bold;}.input{width:278px;border:1px solid #ccc;background:#fff;padding:10px;font:normal 12px 'Microsoft Yahei';outline:0;color:#222}.input:focus{border:1px solid #555;}.submit{border-radius:2px;text-align:center;border:none;padding:9px 15px;background:#333;cursor:pointer;font:bold 12px 'Microsoft Yahei';color:#fff;margin-top: 10px;}</style> </head> <body> <div id=\"info\"> \t当前系统环境：<?php if(PHP_OS=='WINNT'){echo('Windows');}else{echo(PHP_OS);}?>PHP <?=@PHP_VERSION?>/<?=@$_SERVER['SERVER_SOFTWARE']?></div><div id=\"notice\">\t请确保系统满足运行环境要求：PHP >= 5.1 ; 需要开启 pdo_mysql 扩展 ; 需要开启 PATHINFO ; MySQL需要支持 InnoDB 引擎 ; 安装完后请删除本安装文件</div> <div class=\"install\">\t <form method=\"post\">\t <p>数据库主机(默认无需修改)</p>\t <input type=\"text\" name=\"host\" size=\"30\" class=\"input\" value=\"localhost\" />\t <p>数据库用户</p>\t <input type=\"text\" name=\"user\" size=\"30\"  class=\"input\" value=\"root\" />\t <p>数据库密码</p>\t <input type=\"text\" name=\"password\" size=\"30\"  class=\"input\"  value=\"root\"/>\t <p>数据库名</p>\t <input type=\"text\" name=\"name\" size=\"30\"  class=\"input\" value=\"rocboss\" />\t <p>管理员昵称</p>\t <input type=\"text\" name=\"admin_name\" size=\"30\" class=\"input\" value=\"admin\" />\t <p>管理员邮箱</p>\t <input type=\"text\" name=\"admin_email\" size=\"30\" class=\"input\" value=\"admin@admin.com\" />\t <p>管理员密码</p>\t <input type=\"text\" name=\"admin_password\" size=\"30\" class=\"input\" value=\"123456\" />\t <p>安全密匙KEY（请务必修改，不少于14位）</p>\t <input type=\"text\" name=\"safe_key\" size=\"30\" class=\"input\" value=\"dg#i<?php echo rand(10000000, 99999999);?>k7\" />\t <div onclick=\"if(confirm('确定要安装吗?')){document.forms[0].submit()}\" class=\"submit\">开始安装</div>\t <input type=\"hidden\" name=\"path\" size=\"30\"  class=\"input\" value=\"<?php echo str_replace('install.php','',$_SERVER['SCRIPT_NAME'])?>\"/>\t </form> </div> </body> </html>\n   漏洞证明：  \n\n   修复方案：  验证lock文件   版权声明：转载请注明来源 浅蓝@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-06-08 11:46 厂商回复： 本来就是一个简易的安装脚本，已经明确说明了安装成功后删除文件 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-10 12:05 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  @ROCBOSS 是吗？提示删除真的有很大的作用？那他们为什么不删呢？http://www.010351.com/install.phphttp://www.xjprogram.com/install.phphttp://www.gskoo.com//install.phphttp://www.ymdm.net//install.php    \n     2015-03-10 12:20 |    \t\tROCBOSS(乌云厂商)\t\t \n  @浅蓝 安装说明上多次强调了安装完要删除，还不删那就是他们的事了，这部分人没必要管，被黑了也是活该，本来这个安装文件就没有必要，直接导入sql文件配置下文件就好，考虑到一些人连导入数据库都不知道才写的东西。从程序角度看，这根本算不上漏洞    \n     2015-03-10 12:51 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  @ROCBOSS 我觉得你有必要看看人家的CMS安装程序是怎么写的    \n     2015-03-10 13:24 |    \t\tROCBOSS(乌云厂商)\t\t \n  @浅蓝 无非就是加了锁文件判断，又不是什么难事，没必要在这上面浪费时间。你要是能提供其它安全漏洞我会很感激的    \n     2015-03-10 13:30 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  @ROCBOSS 有很多人没有看到提示，或者看到提示也没有去删，总之还是有安全隐患。还有一个你们的漏洞没审核通过呢    \n     2015-03-10 13:39 |    \t\tROCBOSS(乌云厂商)\t\t \n  后续更新的时候考虑完善下安装文件，当前只能先提醒那些人删除，另外一个等通知到了我看下，如果确认了给你高rank    \n     2015-03-10 13:55 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  @ROCBOSS 好的 谢谢    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}