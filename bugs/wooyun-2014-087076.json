{"id": 41996, "wybug_id": "wooyun-2014-087076", "wybug_title": "74cms最新版 二次注入", "wybug_corp": "74c,s.com", "wybug_author": "路人曱", "wybug_date": "2014-12-16 11:45", "wybug_open_date": "2015-01-22 11:46", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-21：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-22：\t细节向公众公开  简要描述：  详细说明：  74cms 20141128最新版漏洞文件:/wap/plus/wap_ajax.php 610-654行：\nelseif ($act == 'invited_add'){\t$smarty->cache = false;\t$resume=resume_one($_POST[\"resume_id\"]);\t$jobs=jobs_one($_POST[\"jobs_id\"]);\tif($_SESSION['utype']!=1){\t\texit(\"企业会员请登录后邀请面试\");\t}\tif (check_interview($_POST[\"resume_id\"],$_POST[\"jobs_id\"],$_SESSION['uid']))\t{\texit(\"repeat\");\t}\t$addarr['resume_id']=$resume['id'];\t$addarr['resume_addtime']=$resume['addtime'];\tif ($resume['display_name']==\"2\")\t{\t$addarr['resume_name']=\"N\".str_pad($resume['id'],7,\"0\",STR_PAD_LEFT);\t\t}\telseif ($resume['display_name']==\"3\")\t{\t$addarr['resume_name']=cut_str($resume['fullname'],1,0,\"**\");\t}\telse\t{\t$addarr['resume_name']=$resume['fullname'];\t}\t$addarr['resume_uid']=$resume['uid'];\t$addarr['company_id']=$jobs['company_id'];\t$addarr['company_addtime']=$jobs['company_addtime'];\t$addarr['company_name']=$jobs['companyname'];\t$addarr['company_uid']=$_SESSION['uid'];\t$addarr['jobs_id']=$jobs['id'];\t$addarr['jobs_name']=$jobs['jobs_name'];\t$addarr['jobs_addtime']=$jobs['addtime'];\t\t$addarr['personal_look']= 1;\t$addarr['interview_addtime']=time();\t$user=get_user_info($resume['uid']);\t$resume_user=get_user_info($resume['uid']);\tif ($_CFG['operation_mode']==\"2\")\t{\t\tinserttable(table('company_interview'),$addarr);\n$resume=resume_one($_POST[\"resume_id\"]);//resume_id相当于个人用户id及简历resume_one函数选取部分代码\nunction resume_one($id){\tglobal $db;\t$id=intval($id);\t$db->query(\"update \".table('resume').\" set click=click+1 WHERE id='{$id}'  LIMIT 1\");\t$wheresql=\" WHERE id='{$id}'\";\t$sql = \"select * from \".table('resume').$wheresql.\" LIMIT 1\";\t$val=$db->getone($sql);\nresume_one()为查询出简历信息  查询出来放入$resume数组$jobs=jobs_one($_POST[\"jobs_id\"]);//jobs_id 为企业用户发布职位idJobs_one函数部分代码\nfunction jobs_one($id){\tglobal $db;\t$id=intval($id);\t$db->query(\"update \".table('jobs').\" set click=click+1 WHERE id='{$id}'  LIMIT 1\");\t$db->query(\"update \".table('jobs_search_hot').\" set click=click+1 WHERE id='{$id}'  LIMIT 1\");\t$wheresql=\" WHERE id='\".$id.\"'\";\t$sql = \"select * from \".table('jobs').$wheresql.\" LIMIT 1\";\t$val=$db->getone($sql);\njobs_one()为查询职位的信息查询出来放入数组$jobs把2个数组的部分放入$addarr数组 带入inserttable(table('company_interview'),$addarr);进行insert操作而仅仅能实现控制的变量 只有$resume['fullname']  和 $jobs['jobs_name']$jobs['companyname']则不行 注册做了限制 引进不了 \\ 或 ’insert进去的信息得找个地方出来文件:wap/personal/wap_interview.php\nelseif ($act == 'interview'){\t$uid=intval($_SESSION[\"uid\"]);\t$wheresql=\" WHERE  i.resume_uid=$uid \";\t$perpage = 5;\t$count  = 0;\t$page = empty($_GET['page'])?1:intval($_GET['page']);\tif($page<1) $page = 1;\t$start = ($page-1)*$perpage;\t$total_sql=\"SELECT COUNT(*) AS num FROM  \".table('company_interview').\" as i {$wheresql}\";\t$count=$db->get_total($total_sql);\t$limit=\" LIMIT {$start},{$perpage}\";\t$smarty->assign('title','收到的面试邀请 - 个人会员中心 - '.$_CFG['site_name']);\t$sql=\"select * from \".table(\"company_interview\").\" as i $wheresql order by i.interview_addtime \".$limit;\t$interview=$db->getall($sql);\t$smarty->assign('interview',$interview);\t$smarty->display(\"wap/personal/wap-interview.html\");\t}\n就是查出个人用户收到的企业的邀请而上面insert操作就是企业对个人用户的职位邀请smarty->assign('title','收到的面试邀请 - 个人会员中心 - '.$_CFG['site_name']);显示出来 显示出来的数据只有 企业名称$jobs['companyname'] 和 职位名称$jobs['jobs_name']要实现二次注入，需注册一个个人用户(发布简历，简历姓名可控但有位数限制10位左右)，注册一个企业用户 发布一个职位 职位名称可控，同样有位数限制不是前端做的限制，无奈！！！经过不断尝试终于找到了方法2个可控变量$resume['fullname'] 改为 ',1,\"\\     //其中 此处 1 为 个人id   $jobs['jobs_name']改为 \",1,1,1,1,1,user(),1,1,1)#则可完美insert进去 ，user()则 刚好为$jobs['jobs_name']   漏洞证明：  注册个人用户创建简历 更改姓名为 ',1,\"\\ \n\n注册企业用户 发布职位更改职位名称为 \",1,1,1,1,user(),1,1,1)#\n\n\n\n访问上面链接 其中resume_id为个人简历id jobs_id为职位id访问完成 insert操作最后登录个人用户\n\n访问 http://127.0.0.1/wap/personal/wap_interview.php?act=interview  看到user()已经出来了   修复方案：     版权声明：转载请注明来源 路人曱@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-01-22 11:46 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}