{"id": 72417, "wybug_id": "wooyun-2015-0154318", "wybug_title": "从未授权访问到茅台主站沦陷可shell(测试环境权限影响线上业务思路)", "wybug_corp": "emaotai.cn", "wybug_author": "Hxai11", "wybug_date": "2015-11-20 17:18", "wybug_open_date": "2016-01-11 15:34", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "任意文件上传", "渗透测试思路", "后台被猜解"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： 一个中国人，一个日本人，一个美国人，在一块讨论哪个国家的酒好， 日本人说：我们的老米酒最好。，美国人说：威士忌，中国人：当然是茅台啦！  三个人争论不休，决定找一只老鼠做试验。 日本人先开始：灌了一杯酒给那只老鼠，那是老鼠走了十步，倒了！该美国人啦，他灌了酒的那只老鼠，走了五步，倒在地上，美国人说：看见没，威士忌当然不老米酒好啦！， 该中国人啦，只见另外一只老鼠喝了茅台之后，竟然走了一百多步，一直走到老鼠洞里，美国人和日本人大笑：什么茅台啊，。话音刚落，只见老鼠从洞里走了出来，手里拿着一块砖，大吼；猫呢？ 详细说明：  过程是这样的：发现一个这个站点，根据漏洞得知git相关项目都不设访问权限，我没登录都能看到各种信息\n\n\n\n最后找到这个文件\n\n之后从这一步开始就注定了网站的沦陷之后我们利用已经得知的密码登录http://shop.cdev.emaotai.cn/admin/login.aspx?returnUrl=/admin发现可以登录，但是看来看去就像是一个测试站点，不好办，测试站点能利用啥呢，没办法\n\n突然想到可不可以用cookie转移的办法登录茅台主站？也就是茅台官方的商城，因为茅台主站的程序跟测试站程序一模一样，所以利用成功几率很高，本身这个测试站点已经有管理员的cookie了于是抱着试试的心态登录这是测试站点的cookie\n\n我们加载cookie到主站，之后为了避免麻烦，我们直接用这个cookie 在主站的添加管理员用户页面添加一个管理员用户\n\n成功访问到，之后我们添加了一个管理员用户，之后我们等了主站试试\n\n成功等了了！！！之后我们去看看用户数量有多少？\n\n40多万用户数量之后我们开始拿shell在寻找了一遍之后在在触摸板板块里的首页背景图那里可以上传aspx文件并且没有限制于是乎成功拿到shell\n\n之后我们连接上数据库看看用户信息\n\n可以远程连接1433服务器来看看用户信息\n\n\n\n结束   漏洞证明：  \n\n   修复方案：  修复未授权访问，修复任意上传shell，送一瓶茅台呗~~   版权声明：转载请注明来源 Hxai11@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-11-22 10:17 厂商回复： 感谢你的反馈，我们将尽快修复这个问题。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-11-20 17:19 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  有点意思，多思考    \n     2015-11-20 17:25 |    \t\tyonghao \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:9        | 非攻)\t\t \n  米酒也是中国传过去的。    \n     2015-11-20 17:35 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @yonghao ...    \n     2015-11-22 11:22 |    \t\tHxai11 \t\t\t( 普通白帽子  |\t\t\t        Rank:1173 漏洞数:226        | 你的爱恨与纠葛，你的回忆与苦痛，都是一体...)\t\t \n  我去，都shell了，才8rank    \n     2015-11-22 14:07 |    \t\tCan \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:13        | 个人博客www.webst.cc)\t\t \n  mark    \n     2015-11-22 17:08 |    \t\tnick被注册 \t\t\t( 普通白帽子  |\t\t\t        Rank:152 漏洞数:25        | 天一)\t\t \n  小厂家..    \n     2015-11-22 18:19 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:188 漏洞数:63        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  猫呢？    \n     2015-11-22 21:32 |    \t\tvicker \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:6        | = =，)\t\t \n  我猜是redis？    \n     2016-01-01 01:06 |    \t\tphith0n  \t\t\t( 普通白帽子  |\t\t\t        Rank:681 漏洞数:112        | 一个想当文人的黑客~)\t\t \n  是好思路，赞一个！    \n     2016-01-04 12:38 |    \t\tTon7BrEak \t\t\t( 普通白帽子  |\t\t\t        Rank:237 漏洞数:48        | 吃苦耐劳，我只会第一个！)\t\t \n  COOKIE转移，好思路    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}