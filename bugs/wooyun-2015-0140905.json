{"id": 66644, "wybug_id": "wooyun-2015-0140905", "wybug_title": "上海农商银行可以用一个用户名可以发送银行任意虚假消息钓鱼（附赠一疑似SQL注射）", "wybug_corp": "上海农商银行网上商城", "wybug_author": "Maxson", "wybug_date": "2015-09-15 16:27", "wybug_open_date": "2015-11-01 16:02", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏校验", "逻辑错误", "设计不当", "搞笑有爱"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-01：\t细节向公众公开  简要描述： #_#  我自己先提现了100万。 详细说明：  \nhttp://mall.srcb.com/customer/member/memberedit.jhtml\n随便注册一个账号，然后修改账户信息。利用短信验证钓鱼。\n\n全部是用JS做过滤。\n$(document).ready(function(){      $(\"#zip\").province_city_county(\"province\", \"city\", \"county\", \"102\",\"10201\",\"1020101\",\"\");      $(\"#savebtn\").click(function() {    \t      \t  \t//验证手机号码    \t  if($(\"#memberMobile\").val()!=\"\"){\t    \t  if(!$(\"#memberMobile\").val().match(/^1[3|4|5|8][0-9]\\d{8}$/)){\t    \t    alert(\"手机号码格式不正确，请重新输入。\");\t    \t    $(\"#memberMobile\").focus();\t    \t    return false;\t    \t  }    \t  }    \t  if($(\"#memberNick\").val().length > 20){    \t \t\talert(\"昵称不能大于20个字符\");    \t \t\t$(\"#memberNick\").focus();    \t \t\treturn false;    \t \t}\t \t if($(\"#memberName\").val().length > 16){\t \t\talert(\"真实姓名不能大于16个字符\");\t \t\t$(\"#memberName\").focus();\t \t\treturn false;\t \t}\t \tif ($(\"[name=idTypeCode] :selected\").val() == 1 && $(\"#certNum\").val()!=\"\") {  //身份证验证\t \t\tif (($(\"#certNum\").val().length==15 && $(\"#certNum\").val().match(/^[1-9]\\d{7}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}$/)) ||\t \t\t\t($(\"#certNum\").val().length==18 && $(\"#certNum\").val().match(/^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])(\\d{4}|(\\d{3}[xX]{1}))$/)) \t \t\t\t) {\t \t\t\t\t \t\t} else {\t \t\t\talert(\"身份证格式不正确，请重新输入。\");\t    \t    $(\"#certNum\").focus();\t    \t    return false;\t \t\t}\t \t}\t \t if($(\"#certNum\").val().length > 26){\t \t\talert(\"证件号码不能大于26个字符\");\t \t\t$(\"#certNum\").focus();\t \t\treturn false;\t \t}\t \tif($(\"#certNum\").val() != \"\"){\t \t\tif(!$(\"#certNum\").val().match(/[A-Za-z0-9]$/)){\t    \t    alert(\"证件号码格式不正确，请重新输入。\");\t    \t    $(\"#certNum\").focus();\t    \t    return false;\t    \t  }\t \t}\t \tif($(\"#memberAddr\").val().length > 170){\t \t\talert(\"街道地址不能大于170个字符\");\t \t\t$(\"#memberAddr\").focus();\t \t\treturn false;\t \t}    \t     \t  //邮箱验证    \t  if(!$(\"#memberEmail\").val() != \"\"){\t    \t  if(!$(\"#memberEmail\").val().match(/^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$/)){\t\t\t    alert(\"邮箱格式不正确,请重新输。\");\t\t\t    $(\"#email\").focus();\t\t\t    return false;\t\t\t   }     \t  }\n点击账户安全。提交一下，得到短信：\n\n既然是JS过滤，完全可以修改内容，- -可想而知。逻辑漏洞还是有的。还有一个难题我不会利用。貌似存在POST SQL注入：\nPOST /customer/member/membersave.jhtml HTTP/1.1Host: mall.srcb.comUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:40.0) Gecko/20100101 Firefox/40.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/json; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://mall.srcb.com/customer/member/memberedit.jhtmlContent-Length: 294Cookie: JSESSIONID=00005GL786GN0NjzTAtsQf0QHlL:173qolaje; i2shopping-main=%7B%22userid%22%3A%2200211241%22%2C%22username%22%3A%22%E6%9D%8E%E5%85%88%E7%94%9F%EF%BC%8C%E5%B7%B2%E7%BB%8F%E8%BD%AC%E8%B4%A610000000%E4%B8%87%22%2C%22mobile%22%3A%2213783533827%22%2C%22encode%22%3A%2256d90c0d50a84a3047e52d04e1a5828d%22%2C%22userkind%22%3A%2201%22%2C%22name%22%3A%22%22%2C%22provinceno%22%3A%22102%22%2C%22cityno%22%3A%2210201%22%2C%22email%22%3A%221643216797%40qq.com%22%7DConnection: keep-alivePragma: no-cacheCache-Control: no-cache{\"email\":\"**16797@qq.com\",\"memberNickname\":\"æå¸ssssô\tSÛ \tÛå¸åçï¼å·²ç»è½¬è´¦100ä¸\",\"name\":\"æå¸å¸åçï¼å·²ç»è½¬è´¦100ä¸\",\"mobile\":\"**3533827\",\"idNumber\":\"\",\"idTypeCode\":\"1\",\"address\":\"\",\"province\":\"1\",\"city\":\"1\",\"county\":\"1\",\"memberBirth\":\"\",\"marital\":\"\",\"income\":\"1\",\"interest\":\"\"}\n部分*代替了。效果如下：\n\n\nSqlMapClient operation; SQL []; --- The error occurred while applying a parameter map. --- Check the B2C_MALL_MEMBERINFO.updateByPrimaryKeySelective-InlineParameterMap. --- Check the statement (update failed). --- Cause: com.ibm.db2.jcc.am.SqlDataException: The value of a host variable in the EXECUTE or OPEN statement is out of range for its corresponding use.. SQLCODE=-302, SQLSTATE=22001, DRIVER=3.59.81; nested exception is com.ibatis.common.jdbc.exception.NestedSQLException: --- The error occurred while applying a parameter map. --- Check the B2C_MALL_MEMBERINFO.updateByPrimaryKeySelective-InlineParameterMap. --- Check the statement (update failed). --- Cause: com.ibm.db2.jcc.am.SqlDataException: The value of a host variable in the EXECUTE or OPEN statement is out of range for its corresponding use.. SQLCODE=-302, SQLSTATE=22001, DRIVER=3.59.81\n我也看不懂，大神继续。     漏洞证明：  \nhttp://mall.srcb.com/customer/member/memberedit.jhtml\n随便注册一个账号，然后修改账户信息。利用短信验证钓鱼。\n\n全部是用JS做过滤。\n$(document).ready(function(){      $(\"#zip\").province_city_county(\"province\", \"city\", \"county\", \"102\",\"10201\",\"1020101\",\"\");      $(\"#savebtn\").click(function() {    \t      \t  \t//验证手机号码    \t  if($(\"#memberMobile\").val()!=\"\"){\t    \t  if(!$(\"#memberMobile\").val().match(/^1[3|4|5|8][0-9]\\d{8}$/)){\t    \t    alert(\"手机号码格式不正确，请重新输入。\");\t    \t    $(\"#memberMobile\").focus();\t    \t    return false;\t    \t  }    \t  }    \t  if($(\"#memberNick\").val().length > 20){    \t \t\talert(\"昵称不能大于20个字符\");    \t \t\t$(\"#memberNick\").focus();    \t \t\treturn false;    \t \t}\t \t if($(\"#memberName\").val().length > 16){\t \t\talert(\"真实姓名不能大于16个字符\");\t \t\t$(\"#memberName\").focus();\t \t\treturn false;\t \t}\t \tif ($(\"[name=idTypeCode] :selected\").val() == 1 && $(\"#certNum\").val()!=\"\") {  //身份证验证\t \t\tif (($(\"#certNum\").val().length==15 && $(\"#certNum\").val().match(/^[1-9]\\d{7}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}$/)) ||\t \t\t\t($(\"#certNum\").val().length==18 && $(\"#certNum\").val().match(/^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])(\\d{4}|(\\d{3}[xX]{1}))$/)) \t \t\t\t) {\t \t\t\t\t \t\t} else {\t \t\t\talert(\"身份证格式不正确，请重新输入。\");\t    \t    $(\"#certNum\").focus();\t    \t    return false;\t \t\t}\t \t}\t \t if($(\"#certNum\").val().length > 26){\t \t\talert(\"证件号码不能大于26个字符\");\t \t\t$(\"#certNum\").focus();\t \t\treturn false;\t \t}\t \tif($(\"#certNum\").val() != \"\"){\t \t\tif(!$(\"#certNum\").val().match(/[A-Za-z0-9]$/)){\t    \t    alert(\"证件号码格式不正确，请重新输入。\");\t    \t    $(\"#certNum\").focus();\t    \t    return false;\t    \t  }\t \t}\t \tif($(\"#memberAddr\").val().length > 170){\t \t\talert(\"街道地址不能大于170个字符\");\t \t\t$(\"#memberAddr\").focus();\t \t\treturn false;\t \t}    \t     \t  //邮箱验证    \t  if(!$(\"#memberEmail\").val() != \"\"){\t    \t  if(!$(\"#memberEmail\").val().match(/^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$/)){\t\t\t    alert(\"邮箱格式不正确,请重新输。\");\t\t\t    $(\"#email\").focus();\t\t\t    return false;\t\t\t   }     \t  }\n点击账户安全。提交一下，得到短信：\n\n既然是JS过滤，完全可以修改内容，- -可想而知。逻辑漏洞还是有的。还有一个难题我不会利用。貌似存在POST SQL注入：\nPOST /customer/member/membersave.jhtml HTTP/1.1Host: mall.srcb.comUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:40.0) Gecko/20100101 Firefox/40.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/json; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://mall.srcb.com/customer/member/memberedit.jhtmlContent-Length: 294Cookie: JSESSIONID=00005GL786GN0NjzTAtsQf0QHlL:173qolaje; i2shopping-main=%7B%22userid%22%3A%2200211241%22%2C%22username%22%3A%22%E6%9D%8E%E5%85%88%E7%94%9F%EF%BC%8C%E5%B7%B2%E7%BB%8F%E8%BD%AC%E8%B4%A610000000%E4%B8%87%22%2C%22mobile%22%3A%2213783533827%22%2C%22encode%22%3A%2256d90c0d50a84a3047e52d04e1a5828d%22%2C%22userkind%22%3A%2201%22%2C%22name%22%3A%22%22%2C%22provinceno%22%3A%22102%22%2C%22cityno%22%3A%2210201%22%2C%22email%22%3A%221643216797%40qq.com%22%7DConnection: keep-alivePragma: no-cacheCache-Control: no-cache{\"email\":\"**16797@qq.com\",\"memberNickname\":\"æå¸ssssô\tSÛ \tÛå¸åçï¼å·²ç»è½¬è´¦100ä¸\",\"name\":\"æå¸å¸åçï¼å·²ç»è½¬è´¦100ä¸\",\"mobile\":\"**3533827\",\"idNumber\":\"\",\"idTypeCode\":\"1\",\"address\":\"\",\"province\":\"1\",\"city\":\"1\",\"county\":\"1\",\"memberBirth\":\"\",\"marital\":\"\",\"income\":\"1\",\"interest\":\"\"}\n部分*代替了。效果如下：\n\n\nSqlMapClient operation; SQL []; --- The error occurred while applying a parameter map. --- Check the B2C_MALL_MEMBERINFO.updateByPrimaryKeySelective-InlineParameterMap. --- Check the statement (update failed). --- Cause: com.ibm.db2.jcc.am.SqlDataException: The value of a host variable in the EXECUTE or OPEN statement is out of range for its corresponding use.. SQLCODE=-302, SQLSTATE=22001, DRIVER=3.59.81; nested exception is com.ibatis.common.jdbc.exception.NestedSQLException: --- The error occurred while applying a parameter map. --- Check the B2C_MALL_MEMBERINFO.updateByPrimaryKeySelective-InlineParameterMap. --- Check the statement (update failed). --- Cause: com.ibm.db2.jcc.am.SqlDataException: The value of a host variable in the EXECUTE or OPEN statement is out of range for its corresponding use.. SQLCODE=-302, SQLSTATE=22001, DRIVER=3.59.81\n我也看不懂，大神继续。     修复方案：  搞得我好乱啊。   版权声明：转载请注明来源 Maxson@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-09-17 16:00 厂商回复：     CNVD确认并复现所述情况,已经转由CNCERT向银行业信息化主管部门通报,由其后续协调网站管理单位处置. 同时已经转报给上海分中心,由其后续联系处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}