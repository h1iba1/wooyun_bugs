{"id": 56185, "wybug_id": "wooyun-2014-058575", "wybug_title": "phpdisk V7 补丁过滤不严继续注入", "wybug_corp": "phpdisk.com", "wybug_author": "′雨。", "wybug_date": "2014-04-28 11:48", "wybug_open_date": "2014-07-27 11:50", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-27：\t细节向公众公开  简要描述： 看到phpdisk 又更新了  再次上去看看。上面说的是/*PHPDisk网盘系统 v7.0 20140422更新说明：二次修正Cookie登录验证问题修正获取文件链接权限问题云上传造成sql注入问题*/修复了注入问题。   我勒个擦, 下载下来一看。 你这补丁完全打偏了啊。没修复到实处。。 详细说明：  在ajax.php中上个漏洞地址： WooYun: phpdisk V7 sql注入2 看修改了哪些地方。\n$ins = array(\t\t\t\t\t'yun_fid' => (int)$file[file_id],//补丁后这里转整\t\t\t\t\t'file_name' => $db->escape($file[file_name]),//补丁后 这里转义。\t\t\t\t\t'file_key' => $file_key,\t\t\t\t\t'file_extension' => $db->escape($file[file_extension]),//补丁后 这里转义。\t\t\t\t\t'file_mime' => 'application/octet-stream',\t\t\t\t\t'file_description' => $db->escape($file[file_description]),//补丁后这里转义\t\t\t\t\t'file_size' => (int)$file['file_size'],\t\t\t\t\t'file_time' => $timestamp,\t\t\t\t\t'is_checked' => $is_checked,\t\t\t\t\t'in_share' => $in_share,\t\t\t\t\t'report_status' => $report_status,\t\t\t\t\t'userid' => $pd_uid,\t\t\t\t\t'folder_id' => $folder_id ? $folder_id : -1,\t\t\t\t\t'ip' => $onlineip,\t\t\t\t\t);\t\t\t\t\t$sql = \"insert into {$tpf}files set \".$db->sql_array($ins).\";\";\t\t\t\t\t$db->query_unbuffered(is_utf8() ? $sql : iconv('utf-8','gbk',$sql));\n怎么修复的是 insert 这里?\nelse{\t\t\t\t$file = unserialize(base64_decode($data));\t\t\t\t$num = @$db->result_first(\"select count(*) from {$tpf}files where yun_fid='{$file[file_id]}' and userid='$pd_uid'\");\n这里怎么不修复?   利用这里继续注入。直接把语句输出来\n\n   漏洞证明：  见上面。   修复方案：   过滤啊。 别又打偏了?   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-04-28 13:20 厂商回复： 已收到，谢谢反馈 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-08 22:06 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  @phpdisk.com @′ 雨。 大神 我想知道你是怎么绕过这个过滤的$file[file_id] = (int)$file[file_id];$file[file_size] = (int)$file[file_size];$num = @$db->result_first(\"select count(*) from {$tpf}files where yun_fid='{$file[file_id]}' and userid='$pd_uid'\");难道我的版本有问题 我看到的代码和你的不一样？    \n     2014-05-08 22:39 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:188        | Only Code Never Lie To Me.)\t\t \n  @只发通用型  那应该是不一样的。    \n     2014-05-08 23:18 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @′  雨。 源码包还有了么？    \n     2014-05-08 23:38 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:188        | Only Code Never Lie To Me.)\t\t \n  @疯狗  嗯 我有422的源码，    \n     2014-05-09 11:00 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @′  雨。 就是你提交这个版本的源码包    \n     2014-05-09 11:59 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:188        | Only Code Never Lie To Me.)\t\t \n  @疯狗   恩 应该有的。    \n     2014-08-04 00:01 |    \t\tsf0l \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 2'xx00)\t\t \n  @′ 雨 这个注入没回显，怎么搞啊    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}