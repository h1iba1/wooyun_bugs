{"id": 206, "wybug_id": "wooyun-2014-076823", "wybug_title": "华为荣耀立方智能路由器ws860s 任意文件上传", "wybug_corp": "华为技术有限公司", "wybug_author": "livers", "wybug_date": "2014-09-21 16:15", "wybug_open_date": "2014-11-05 16:16", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["文件上传漏洞"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-05：\t细节向公众公开  简要描述： 版本 B218SP01【2014年8月27日更新】 之前峰会上提到的问题，与华为的人员已交互过，就是可任意上传 ，执行命令，安装apk等。。 详细说明：  system\\etc目录下，存在缺陷代码\n<?php  //$target_path  = \"/\";//接收文件目录  $target_path = $_POST['path'];$count = count($_FILES['file']['name']);if(!file_exists($target_path)){\techo \"目录不存在或者不正确 \" . $target_path . \"<br />\";\treturn;}for($i=0;$i<$count;$i++){$target_path_temp = $target_path . basename( $_FILES['file']['name'][$i]);  if(move_uploaded_file($_FILES['file']['tmp_name'][$i], $target_path_temp)) {     echo \"The file \".  basename( $_FILES['file']['name'][$i]). \" has been uploaded\" . \"<br />\";  }  else{     echo \"There was an error uploading the file, please try again!\" . $_FILES['file']['error'][$i] . \"<br />\";  }  }?>\n\n\n可上传任意文件到任意目录开启了lighthttpd服务 Conf 配置server.document-root = \"/\"Bin目录下start.webserver脚本copy文件到/mnt/.lighttpd/目录下Webserver.sh 766属性\n#!/system/bin/shcp /system/etc/accept.html /mnt/.lighttpd/cp /system/etc/accept.php /mnt/.lighttpd/cp /system/etc/php.ini /mnt/.lighttpd_etc/cp -r /system/etc/lighttpd/* /mnt/.lighttpd_etc/chmod 766 /mnt/.lighttpd/*\n攻击者可以上传webshell执行adb 或pm 命令安装apk，am命令执行apk   漏洞证明：  system\\etc目录下，存在缺陷代码\n<?php  //$target_path  = \"/\";//接收文件目录  $target_path = $_POST['path'];$count = count($_FILES['file']['name']);if(!file_exists($target_path)){\techo \"目录不存在或者不正确 \" . $target_path . \"<br />\";\treturn;}for($i=0;$i<$count;$i++){$target_path_temp = $target_path . basename( $_FILES['file']['name'][$i]);  if(move_uploaded_file($_FILES['file']['tmp_name'][$i], $target_path_temp)) {     echo \"The file \".  basename( $_FILES['file']['name'][$i]). \" has been uploaded\" . \"<br />\";  }  else{     echo \"There was an error uploading the file, please try again!\" . $_FILES['file']['error'][$i] . \"<br />\";  }  }?>\n\n\n可上传任意文件到任意目录开启了lighthttpd服务 Conf 配置server.document-root = \"/\"Bin目录下start.webserver脚本copy文件到/mnt/.lighttpd/目录下Webserver.sh 766属性\n#!/system/bin/shcp /system/etc/accept.html /mnt/.lighttpd/cp /system/etc/accept.php /mnt/.lighttpd/cp /system/etc/php.ini /mnt/.lighttpd_etc/cp -r /system/etc/lighttpd/* /mnt/.lighttpd_etc/chmod 766 /mnt/.lighttpd/*\n攻击者可以上传php 的webshell执行adb 或pm 命令安装apk，am命令执行apk   修复方案：  过滤上传文件的类型  和上传文件的路径   版权声明：转载请注明来源 livers@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-09-25 15:01 厂商回复： 感谢livers的测试。业务部门已经在排查。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-21 19:45 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  livers 大牛 又来发硬件洞了~    \n     2014-09-22 00:55 |    \t\tGale Albatross \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:13        | Gale Albatross)\t\t \n  物联网，智能设备大牛来了。    \n     2014-09-22 09:44 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  已关注    \n     2014-09-25 15:54 |    \t\tONE \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | balabala)\t\t \n  应该不是web传上去的吧。是adb接口么？    \n     2014-10-17 11:53 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  没有测试成功的例子？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}