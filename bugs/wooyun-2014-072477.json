{"id": 1061, "wybug_id": "wooyun-2014-072477", "wybug_title": "dota的站点与论坛可导致getshell以及脱裤", "wybug_corp": "完美时空", "wybug_author": "CoffeeSafe", "wybug_date": "2014-08-15 12:42", "wybug_open_date": "2014-09-29 19:28", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "默认配置不当", "服务配置不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-29：\t细节向公众公开  简要描述： http://www.wooyun.org/bugs/wooyun-2014-071920亲，上次没礼物，这次有没有？详细看漏洞修复里的总结。 详细说明：  上次发了完美世界无冬ol主站以及Arc页游平台getwebshell脱裤本次在服务器又出了dota的站点与论坛可导致getshell以及脱裤原因是《无冬OL》Xbox 官方网站 存在命令执行（具体看上一个漏洞）本次发现，跨目录不仅仅是上次描述的那样简单！\n\n本次漏洞涉及：http://tishow.dota2.com.cn              http://www.dota2bbs.org              http://bbs.dota2.com.cn   漏洞证明：  本次我不上传木马什么演示的！我只贴出相关信息。你们可以看看。路径：/web/webapps/Dota2BBS/config/config_ucenter.php\n<?phpdefine('UC_CONNECT', 'mysql');define('UC_DBHOST', '127.0.0.1');define('UC_DBUSER', 'ultrax');define('UC_DBPW', 'ultrax123!@#');define('UC_DBNAME', 'ultrax');define('UC_DBCHARSET', 'utf8');define('UC_DBTABLEPRE', '`ultrax`.pre_ucenter_');define('UC_DBCONNECT', 0);define('UC_CHARSET', 'utf-8');define('UC_KEY', 'c017C0kdX9J9E1q8963cyfU4z0G1gbI0Xc8749K4x2taT1id0c25y3Var9q7RdB6');define('UC_API', 'http://bbs.scgl.dota2.com.cn/uc_server');define('UC_APPID', '1');define('UC_IP', '');define('UC_PPP', 20);\n路径：/web/webapps/Dota2BBS/config/config_ucenter_default.php\n<?php/** *      [Discuz!] (C)2001-2099 Comsenz Inc. *      This is NOT a freeware, use is subject to license terms * *      $Id: config_ucenter_default.php 11023 2010-05-20 02:23:09Z monkey $ */// ============================================================================define('UC_CONNECT', 'mysql');\t\t\t\t// 连接 UCenter 的方式: mysql/NULL, 默认为空时为 fscoketopen(), mysql 是直接连接的数据库, 为了效率, 建议采用 mysql// 数据库相关 (mysql 连接时)define('UC_DBHOST', '127.0.0.1');\t\t\t// UCenter 数据库主机define('UC_DBUSER', 'ultrax');\t\t\t\t// UCenter 数据库用户名define('UC_DBPW', 'ultrax123!@#');\t\t\t\t// UCenter 数据库密码define('UC_DBNAME', 'ucenter');\t\t\t\t// UCenter 数据库名称define('UC_DBCHARSET', 'utf8');\t\t\t\t// UCenter 数据库字符集define('UC_DBTABLEPRE', '`ucenter`.uc_');\t\t// UCenter 数据库表前缀define('UC_DBCONNECT', '0');\t\t\t\t// UCenter 数据库持久连接 0=关闭, 1=打开// 通信相关define('UC_KEY', 'yeN3g9EbNfiaYfodV63dI1j8Fbk5HaL7W4yaW4y7u2j4Mf45mfg2v899g451k576');\t// 与 UCenter 的通信密钥, 要与 UCenter 保持一致define('UC_API', 'http://localhost/ucenter/branches/1.5.0/server'); // UCenter 的 URL 地址, 在调用头像时依赖此常量define('UC_CHARSET', 'utf-8');\t\t\t\t// UCenter 的字符集define('UC_IP', '127.0.0.1');\t\t\t\t// UCenter 的 IP, 当 UC_CONNECT 为非 mysql 方式时, 并且当前应用服务器解析域名有问题时, 请设置此值define('UC_APPID', '1');\t\t\t\t// 当前应用的 ID// ============================================================================define('UC_PPP', '20');?>\n路径：/web/webapps/Dota2BBS/config/config_global_default.php\n<?php/** *      [Discuz!] (C)2001-2099 Comsenz Inc. *      This is NOT a freeware, use is subject to license terms * *      $Id: config_global_default.php 32891 2013-03-20 10:51:37Z zhengqingpeng $ */$_config = array();// ----------------------------  CONFIG DB  ----------------------------- //// ----------------------------  数据库相关设置---------------------------- ///** * 数据库主服务器设置, 支持多组服务器设置, 当设置多组服务器时, 则会根据分布式策略使用某个服务器 * @example * $_config['db']['1']['dbhost'] = 'localhost'; // 服务器地址 * $_config['db']['1']['dbuser'] = 'root'; // 用户 * $_config['db']['1']['dbpw'] = 'root';// 密码 * $_config['db']['1']['dbcharset'] = 'gbk';// 字符集 * $_config['db']['1']['pconnect'] = '0';// 是否持续连接 * $_config['db']['1']['dbname'] = 'x1';// 数据库 * $_config['db']['1']['tablepre'] = 'pre_';// 表名前缀 * * $_config['db']['2']['dbhost'] = 'localhost'; * ... * */$_config['db'][1]['dbhost']  \t\t= '127.0.0.1';$_config['db'][1]['dbuser']  \t\t= 'ultrax';$_config['db'][1]['dbpw'] \t \t= 'ultrax123!@#';$_config['db'][1]['dbcharset'] \t\t= 'utf8';$_config['db'][1]['pconnect'] \t\t= 0;$_config['db'][1]['dbname']  \t\t= 'ultrax';$_config['db'][1]['tablepre'] \t\t= 'pre_';/** * 数据库从服务器设置( slave, 只读 ), 支持多组服务器设置, 当设置多组服务器时, 系统每次随机使用 * @example * $_config['db']['slave']['1']['dbhost'] = 'localhost'; * $_config['db']['slave']['1']['dbuser'] = 'root'; * $_config['db']['slave']['1']['dbpw'] = 'root'; * $_config['db']['slave']['1']['dbcharset'] = 'gbk'; * $_config['db']['slave']['1']['pconnect'] = '0'; * $_config['db']['slave']['1']['dbname'] = 'x1'; * $_config['db']['slave']['1']['tablepre'] = 'pre_'; * * $_config['db']['slave']['2']['dbhost'] = 'localhost'; * ... * */$_config['db']['slave'] = array();/** * 数据库 分布部署策略设置 * * @example 将 common_member 部署到第二服务器, common_session 部署在第三服务器, 则设置为 * $_config['db']['map']['common_member'] = 2; * $_config['db']['map']['common_session'] = 3; * * 对于没有明确声明服务器的表, 则一律默认部署在第一服务器上 * */$_config['db']['map'] = array();/** * 数据库 公共设置, 此类设置通常对针对每个部署的服务器 */$_config['db']['common'] = array();/** *  禁用从数据库的数据表, 表名字之间使用逗号分割 * * @example common_session, common_member 这两个表仅从主服务器读写, 不使用从服务器 * $_config['db']['common']['slave_except_table'] = 'common_session, common_member'; * */$_config['db']['common']['slave_except_table'] = '';/** * 内存服务器优化设置 * 以下设置需要PHP扩展组件支持，其中 memcache 优先于其他设置， * 当 memcache 无法启用时，会自动开启另外的两种优化模式 *///内存变量前缀, 可更改,避免同服务器中的程序引用错乱$_config['memory']['prefix'] = 'discuz_';/* reids设置, 需要PHP扩展组件支持, timeout参数的作用没有查证 */$_config['memory']['redis']['server'] = '';$_config['memory']['redis']['port'] = 6379;$_config['memory']['redis']['pconnect'] = 1;$_config['memory']['redis']['timeout'] = 0;/** * 是否使用 Redis::SERIALIZER_IGBINARY选项,需要igbinary支持,windows下测试时请关闭，否则会出>现错误Reading from client: Connection reset by peer * 支持以下选项，默认使用PHP的serializer * [重要] 该选项已经取代原来的 $_config['memory']['redis']['igbinary'] 选项 * Redis::SERIALIZER_IGBINARY =2 * Redis::SERIALIZER_PHP =1 * Redis::SERIALIZER_NONE =0 //则不使用serialize,即无法保存array */$_config['memory']['redis']['serializer'] = 1;$_config['memory']['memcache']['server'] = '';\t\t\t// memcache 服务器地址$_config['memory']['memcache']['port'] = 11211;\t\t\t// memcache 服务器端口$_config['memory']['memcache']['pconnect'] = 1;\t\t\t// memcache 是否长久连接$_config['memory']['memcache']['timeout'] = 1;\t\t\t// memcache 服务器连接超时$_config['memory']['apc'] = 1;\t\t\t\t\t\t\t// 启动对 apc 的支持$_config['memory']['xcache'] = 1;\t\t\t\t\t\t// 启动对 xcache 的支持$_config['memory']['eaccelerator'] = 1;\t\t\t\t\t// 启动对 eaccelerator 的支持$_config['memory']['wincache'] = 1;\t\t\t\t\t\t// 启动对 wincache 的支持// 服务器相关设置$_config['server']['id']\t\t= 1;\t\t\t// 服务器编号，多webserver的时候，用于标识当前服务器的ID// 附件下载相关//// 本地文件读取模式; 模式2为最节省内存方式，但不支持多线程下载// 1=fread 2=readfile 3=fpassthru 4=fpassthru+multiple$_config['download']['readmod'] = 2;// 是否启用 X-Sendfile 功能（需要服务器支持）0=close 1=nginx 2=lighttpd 3=apache$_config['download']['xsendfile']['type'] = 0;// 启用 nginx X-sendfile 时，论坛附件目录的虚拟映射路径，请使用 / 结尾$_config['download']['xsendfile']['dir'] = '/down/';//  CONFIG CACHE$_config['cache']['type'] \t\t\t= 'sql';\t// 缓存类型 file=文件缓存, sql=数据库缓存// 页面输出设置$_config['output']['charset'] \t\t\t= 'utf-8';\t// 页面字符集$_config['output']['forceheader']\t\t= 1;\t\t// 强制输出页面字符集，用于避免某些环境乱码$_config['output']['gzip'] \t\t\t= 0;\t\t// 是否采用 Gzip 压缩输出$_config['output']['tplrefresh'] \t\t= 1;\t\t// 模板自动刷新开关 0=关闭, 1=打开$_config['output']['language'] \t\t\t= 'zh_cn';\t// 页面语言 zh_cn/zh_tw$_config['output']['staticurl'] \t\t= 'static/';\t// 站点静态文件路径，“/”结尾$_config['output']['ajaxvalidate']\t\t= 0;\t\t// 是否严格验证 Ajax 页面的真实性 0=关闭，1=打开$_config['output']['iecompatible']\t\t= 0;\t\t// 页面 IE 兼容模式// COOKIE 设置$_config['cookie']['cookiepre'] \t\t= 'discuz_'; \t// COOKIE前缀$_config['cookie']['cookiedomain'] \t\t= ''; \t\t// COOKIE作用域$_config['cookie']['cookiepath'] \t\t= '/'; \t\t// COOKIE作用路径// 站点安全设置$_config['security']['authkey']\t\t\t= 'asdfasfas';\t// 站点加密密钥$_config['security']['urlxssdefend']\t\t= true;\t\t// 自身 URL XSS 防御$_config['security']['attackevasive']\t\t= 0;\t\t// CC 攻击防御 1|2|4|8$_config['security']['querysafe']['status']\t= 1;\t\t// 是否开启SQL安全检测，可自动预防SQL注入攻击$_config['security']['querysafe']['dfunction']\t= array('load_file','hex','substring','if','ord','char');$_config['security']['querysafe']['daction']\t= array('@','intooutfile','intodumpfile','unionselect','(select', 'unionall', 'uniondistinct');$_config['security']['querysafe']['dnote']\t= array('/*','*/','#','--','\"');$_config['security']['querysafe']['dlikehex']\t= 1;$_config['security']['querysafe']['afullnote']\t= 0;$_config['admincp']['founder']\t\t\t= '1';\t\t// 站点创始人：拥有站点管理后台的最高权限，每个站点可以设置 1名或多名创始人\t\t\t\t\t\t\t\t// 可以使用uid，也可以使用用户名；多个创始人之间请使用逗号“,”分开;$_config['admincp']['forcesecques']\t\t= 0;\t\t// 管理人员必须设置安全提问才能进入系统设置 0=否, 1=是[安全]$_config['admincp']['checkip']\t\t\t= 1;\t\t// 后台管理操作是否验证管理员的 IP, 1=是[安全], 0=否。仅在管理员无法登陆后台时设置 0。$_config['admincp']['runquery']\t\t\t= 0;\t\t// 是否允许后台运行 SQL 语句 1=是 0=否[安全]$_config['admincp']['dbimport']\t\t\t= 1;\t\t// 是否允许后台恢复论坛数据  1=是 0=否[安全]/** * 系统远程调用功能模块 */// 远程调用: 总开关 0=关  1=开$_config['remote']['on'] = 0;// 远程调用: 程序目录名. 出于安全考虑,您可以更改这个目录名, 修改完毕, 请手工修改程序的实际目录$_config['remote']['dir'] = 'remote';// 远程调用: 通信密钥. 用于客户端和本服务端的通信加密. 长度不少于 32 位//          默认值是 $_config['security']['authkey']\t的 md5, 您也可以手工指定$_config['remote']['appkey'] = md5($_config['security']['authkey']);// 远程调用: 开启外部 cron 任务. 系统内部不再执行cron, cron任务由外部程序激活$_config['remote']['cron'] = 0;// $_GET|$_POST的兼容处理，0为关闭，1为开启；开启后即可使用$_G['gp_xx'](xx为变量名，$_GET和$_POST集合的所有变量名)，值为已经addslashes()处理过$_config['input']['compatible'] = 1;?>\n其余的目录一样，建议翻翻看dota2app/也就是：http://tishow.dota2.com.cn多处配置不当。跨权限执行等。另外贴出几个dota bbs 的管理员pwd md5如下：b4ee1889ce9337042647a485897ed89d8493c14f3486251cc807a1f1a97f20b7图的话再顺便带几张。。\n\n\n\n\n\n   修复方案：   简单的唠叨两句，上次脱裤，这次完全也可以的。这种站点以及服务器部署，缺陷的存在，你可以看到，还是那句话，并不是一点危害。危害的多大可以自己站在黑盒测试方面香香，这次我没有像上次上传shell什么的，我感觉没必要留下后门，贴出代码，你会懂的。希望尽快修复~~~~ 本次赏点什么吧？管理员比我更专业~   版权声明：转载请注明来源 CoffeeSafe@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-08-18 19:41 厂商回复： 非常感谢，我们会尽快处理，还没有你的联系方式，得到后会尽快发送你礼物，谢谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-15 13:36 |    \t\tCoffee \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:15        | Corie, a student of RDFZ.)\t\t \n  看起来我好像抢了你的id……    \n     2014-08-15 14:00 |    \t\tCoffeeSafe \t\t\t( 普通白帽子  |\t\t\t        Rank:142 漏洞数:37        )\t\t \n  @Coffee 呵呵，没有。我就叫coffeesafe的。    \n     2014-08-15 17:20 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  你俩是失散多年的亲兄弟吗？    \n     2014-08-15 17:49 |    \t\tCoffeeSafe \t\t\t( 普通白帽子  |\t\t\t        Rank:142 漏洞数:37        )\t\t \n  @鬼魅羊羔 靠。。草泥马这个物种和你是不是祖辈有牵连~~    \n     2014-08-15 20:55 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @CoffeeSafe 看不懂开玩笑是吧？    \n     2014-08-15 21:42 |    \t\tCoffeeSafe \t\t\t( 普通白帽子  |\t\t\t        Rank:142 漏洞数:37        )\t\t \n  @鬼魅羊羔 哈哈~我也和你看玩笑的，羊羔哥哥。莫生气。哈哈    \n     2014-08-19 10:34 |    \t\t李白 \t\t\t( 普通白帽子  |\t\t\t        Rank:142 漏洞数:29        )\t\t \n  求DOTA2全英雄传说装    \n     2015-01-04 19:34 |    \t\tzhangfei \t\t\t( 实习白帽子  |\t\t\t        Rank:59 漏洞数:5        | (╯°Д°)╯︵ ┻━┻)\t\t \n  后排膜拜下前辈。现在此机器又被拿下～哈哈    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}