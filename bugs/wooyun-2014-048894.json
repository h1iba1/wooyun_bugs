{"id": 4842, "wybug_id": "wooyun-2014-048894", "wybug_title": "Dedecms 会员中心注入漏洞7", "wybug_corp": "Dedecms", "wybug_author": "Matt", "wybug_date": "2014-01-14 17:16", "wybug_open_date": "2014-04-14 17:17", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-01-17：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-03-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-14：\t细节向公众公开  简要描述： 我是来继续做贡献的~ 详细说明：  \nmember/upload_edit.phpelse if($dopost=='save'){    $title = HtmlReplace($title,2);    if($mediatype==1) $utype = 'image';    else if($mediatype==2)    {        $utype = 'flash';    }    else if($mediatype==3)    {        $utype = 'media';    }    else    {        $utype = 'addon';    }    $title = HtmlReplace($title, 2);    $exname = preg_replace(\"#(.*)/#\", \"\", $oldurl);// 文件名是获取.前面的    $exname = preg_replace(\"#\\.(.*)$#\", \"\", $exname);\techo $exname ;    $filename = MemberUploads('addonfile', $oldurl, $cfg_ml->M_ID, $utype,$exname, -1, -1, TRUE);//返回上传的文件名    SaveUploadInfo($title, $filename, $mediatype);//利用返回的带入查询    ShowMsg(\"成功修改文件！\", \"uploads_edit.php?aid=$aid\");}function SaveUploadInfo($title,$filename,$medaitype=1,$addinfos=''){    global $dsql,$cfg_ml,$cfg_basedir;    if($filename=='')    {        return FALSE;    }    if(!is_array($addinfos))    {        $addinfos[0] = $addinfos[1] = $addinfos[2] = 0;    }    if($medaitype==1)    {        $info = '';        $addinfos = GetImageSize($cfg_basedir.$filename,$info);    }    $addinfos[2] = @filesize($cfg_basedir.$filename);    $row = $dsql->GetOne(\"SELECT aid,title,url FROM `#@__uploads` WHERE url LIKE '$filename' AND mid='\".$cfg_ml->M_ID.\"'; \");    $uptime = time();    if(is_array($row))    {        $query = \"UPDATE `#@__uploads` SET title='$title',mediatype='$medaitype',                     width='{$addinfos[0]}',height='{$addinfos[1]}',filesize='{$addinfos[2]}',uptime='$uptime'                     WHERE aid='{$row['aid']}'; \";        $dsql->ExecuteNoneQuery($query);    }    else    {        $inquery = \"INSERT INTO `#@__uploads`(title,url,mediatype,width,height,playtime,filesize,uptime,mid)           VALUES ('$title','$filename','$medaitype','\".$addinfos[0].\"','\".$addinfos[1].\"','0','\".$addinfos[2].\"','$uptime','\".$cfg_ml->M_ID.\"'); \";echo $inquery ;//注入就在这里发生了！        $dsql->ExecuteNoneQuery($inquery);    }    $fid = $dsql->GetLastID();    AddMyAddon($fid, $filename);    return TRUE;}\n   漏洞证明：  \n利用方法<form id=\"frmUpload\" enctype=\"multipart/form-data\" action=\"http://127.0.0.1/dede/member/uploads_edit.php?dopost=save&title=ss&oldurl=1'.php\" method=\"post\">看Oldurl就知道了~<input type=\"file\" name=\"addonfile\" id=\"addonfile\" size=\"50\"><br><input name=\"mode\" type=\"hidden\" value=\"2\"><input id=\"btnUpload\" type=\"submit\" value=\"Upload\"></form>\n\n\n   修复方案：  过滤啊！   版权声明：转载请注明来源 Matt@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2014-01-14 22:24 厂商回复： 已修复，感谢反馈 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-01-14 17:17 |    \t\t坠落 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 恩。。。。。。。)\t\t \n  洞主 尔甚叼 令尊知否    \n     2014-01-14 17:18 |    \t\t4399gdww \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:4        | )\t\t \n  坐等8    \n     2014-01-14 17:19 |    \t\tMatt  \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:107        | 承接代码审计 http://codescan.cn/)\t\t \n  @坠落 此小事 无须知    \n     2014-01-14 17:20 |    \t\t摸了你 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:17        | 1shitMVqBjCKrnRvSoixMx6RKpG9J8pBM)\t\t \n  ...赤果果的刷。    \n     2014-01-14 17:20 |    \t\t坠落 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 恩。。。。。。。)\t\t \n  @Matt 洞主 此话让我 不明觉厉    \n     2014-01-14 17:21 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  我去？还在继续啊    \n     2014-01-14 17:27 |    \t\tonlycjeg \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:5        | 我就看看,我不说话.)\t\t \n  疯了吧，都7个了！~~    \n     2014-01-14 17:31 |    \t\tGosuto \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:5        | )\t\t \n  洞主略屌啊    \n     2014-01-14 17:37 |    \t\t3King \t\t\t( 普通白帽子  |\t\t\t        Rank:1129 漏洞数:92        | 【study at HNUST】非常感谢大家的关注~ 大...)\t\t \n  完全停不下来的说......    \n     2014-01-14 17:51 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  会员中心有7个文件吗？不是同一文件多次不算得啊！    \n     2014-01-14 17:55 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  吊炸天了。。    \n     2014-01-14 17:58 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  一个2k，7个1W4    \n     2014-01-14 18:12 |    \t\t封印师 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 我是小彩笔来的。...(｡•ˇ‸ˇ•｡) ...)\t\t \n  刷屏了，屌！    \n     2014-01-14 18:12 |    \t\tFireweed \t\t\t( 普通白帽子  |\t\t\t        Rank:107 漏洞数:14        | Show me the #)\t\t \n  会员中心有7个文件吗？不是同一文件多次不算得啊！     \n     2014-01-14 18:17 |    \t\t摸了你 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:17        | 1shitMVqBjCKrnRvSoixMx6RKpG9J8pBM)\t\t \n  @px1624 wooyun快被dz刷穷了    \n     2014-04-14 17:19 |    \t\tdave \t\t\t( 实习白帽子  |\t\t\t        Rank:73 漏洞数:12        | ส้้้้้้้้้้้้้้้้้้้...)\t\t \n  dedecms 注定是一个备注    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}