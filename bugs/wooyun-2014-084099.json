{"id": 43012, "wybug_id": "wooyun-2014-084099", "wybug_title": "phpok最新版一处注入", "wybug_corp": "phpok.com", "wybug_author": "玉林嘎", "wybug_date": "2014-11-25 21:55", "wybug_open_date": "2015-02-23 21:56", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-28：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-23：\t细节向公众公开  简要描述： 最近没什么代码审计漏洞 给个前台呗 详细说明：  phpok最新版 20141119\n\n问题文件：/framework/model/data.php    //还是老问题//取得文章列表public function arclist($rs)第102-105行:\nif($rs['user_id']){\t$sql.= \"AND l.user_id IN(\".$rs['user_id'].\") \";}\n$rs['user_id'] 是直接进入查询的造成注入  现在就是找哪个地方应用了function arclist()是从 function _arclist()过来的 找下_arclist()找了下一共2个地方 一个不行 另一个就可以/framework/www/project_control.phpfunction load_module($rs,$parent_rs='')  该函数用到了_arclist()选取几行重要代码129-131行：$ext = $this->get(\"ext\");$tag = $this->get(\"tag\");$uid = $this->get('uid');uid get进来201-204行:if($uid){\t$pageurl .= \"uid=\".$uid.\"&\";\t$dt['user_id'] = $uid;}$uid 赋给dt数组的user_Id219行:$rslist = $this->call->phpok('_arclist',$dt);$dt函数 进入查询再找找load_module函数的应用，还是在这个文件下/framework/www/project_control.phpfunction index_f()63-67行:if($rs[\"module\"]){\t$this->load_module($rs,$parent_rs);\texit;}找到准确位置 uid未过滤   漏洞证明：  \n\n\n\n而且可sqlmap噢\n\n   修复方案：  过滤   版权声明：转载请注明来源 玉林嘎@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-11-25 22:19 厂商回复： 汗啊，又是过滤不完整~~吐啊，你们都是牛人~ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-25 22:25 |    \t\tphpok企业站(乌云厂商)\t\t \n  郁闷，我这边测试后，发现只是SQL会报错，不会爆库吧~    \n     2014-11-25 22:26 |    \t\tphpok企业站(乌云厂商)\t\t \n  不管了，也是一个漏洞~~这些都尽量堵上：）    \n     2014-11-26 09:56 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  @phpok企业站  噢。搞忘了。这个信息是我审计时候，喜欢把 sql语句  var_dump出来，而且这个sqlmap是误报。但是这个是可以盲注的    \n     2014-11-26 09:58 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  @phpok企业站 你确认太快了。我还想在编辑下的    \n     2014-11-26 11:38 |    \t\tphpok企业站(乌云厂商)\t\t \n  没事~我们这边PHPOK正在大力发展，对于这一块我们很重视的~~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}