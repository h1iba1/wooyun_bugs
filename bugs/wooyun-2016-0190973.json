{"id": 86861, "wybug_id": "wooyun-2016-0190973", "wybug_title": "全友家私某系统漏洞（涉及上千万订单信息/涉及大量的个人详细身份证件地址订单信息/涉及十几库Sa权限）", "wybug_corp": "全友家私", "wybug_author": "路人甲", "wybug_date": "2016-03-31 12:00", "wybug_open_date": "2016-05-19 22:40", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-19：\t细节向公众公开  简要描述：  详细说明：  http://**.**.**.**  存在jboss反序列命令执行，只能用jspx或者写shell 到jmx-console里，策略禁止在default下执行jsp脚本。通过查找配置数据库发现大量数据，近千万的订单详情，以及几百万的个人详细的身份证信息以及收货地址信息，危害极大数据库涉及内网多台主机。截取部分数据已证明危害，   漏洞证明：  \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<local-tx-datasource>\t\t<jndi-name>TBMPKDataSource</jndi-name>\t\t<connection-url>jdbc:sqlserver**.**.**.**:1433;DatabaseName=cop_tbm;SelectMethod=Cursor</connection-url>\t\t<driver-class>com.microsoft.sqlserver.jdbc.SQLServerDriver</driver-class>\t\t<connection-property name=\"user\">tbmsql</connection-property>\t\t<connection-property name=\"password\">tbm123</connection-property>\t\t<min-pool-size>1</min-pool-size>\t\t<max-pool-size>10</max-pool-size>\t</local-tx-datasource></datasources>\t<local-tx-datasource>\t\t<jndi-name>TOSADDataSource</jndi-name>\t\t<connection-url>jdbc:sqlserver**.**.**.**:1433;DatabaseName=QuanYou-DB;SelectMethod=Cursor</connection-url>\t\t<driver-class>com.microsoft.sqlserver.jdbc.SQLServerDriver</driver-class>\t\t<connection-property name=\"user\">sa</connection-property>\t\t<connection-property name=\"password\">P@ssw0rd!123</connection-property>\t\t<min-pool-size>5</min-pool-size>\t\t<max-pool-size>100</max-pool-size>\t</local-tx-datasource>\n数据库配置\nQuery#0 : select rows,OBJECT_NAME(id) as TABLENAME from sysindexes where indid=0rowsint\tTABLENAMEnvarchar2\tsysfiles190\tT_TBM_SALE_TASK553033\tT_TBM_CHECK_DETAIL_A2015060\tF_STOCK_APPLY12\ttemp_1559465\tT_MDM_CHAN_DIS_SERIES_INFO17894\tT_TBM_SIGN_IN_A2015060\tT_TBM_PRICE_PROGRAM356\tT_TBM_STOCK_ADJUST_DETAIL_PRICE_2016012238208\tT_TBM_STAFF173\tT_TBM_SALE_TASK_DETAIL877126\tT_TBM_SIGN_IN_DETAIL_A2015064\tCAP_USER_201506115889333\tT_TBM_SHOP_PRICE_SAD7592\tT_MDM_CHAN_DIS_STORE1504117\tT_TBM_STOCK_TERM_STATISTICS_A2015060\tT_TBM_PRICE_PROGRAM_DETAIL1\tT_TEMP_ACCOUNT_IMP3244130\tT_MDM_PRO_REL_PRO_SALE_ORG5530807\tT_TBM_MY_PRODUCT_SAD10592442\tT_TBM_STOCK_OUTIN_DETAIL29\tT_MDM_CHAN_OFFICE_INFO1070627\tT_TBM_STOCK_TERM_STATISTICS_A2015050\tT_TBM_STOCK_BATCH_A201505418\ttmp_dis_info3868975\tT_TBM_PURBILL_DETAIL7301\tT_TBM_PATCH_PIC_20150808_BAK0\tT_MDM_CHAN_SHOP_DECORATION97\ttmp_shop_info1891850\tT_TBM_STOCK_BATCH_A2015069827\tT_TBM_SP_REDACT_20150724_BAK421\tT_TBM_STOCK_ADJUST_DETAIL_CAL_IN_201601221327\ttmp_store_info825824\tT_TBM_STOCK_OUTIN3617\tT_MDM_CHAN_SHOP_INFO1509690\tT_TBM_STOCK_TERM_STATISTICS_B201506167115\tT_TBM_CHECK_DETAIL_PRICE_OUT_2016012266390\tT_TBM_SAMPLE_UP_DETAIL102682\tT_TBM_PATCH_PLATE_20150807_bak0\tFV_INFO_STRUCT919749\tT_TBM_STOCK_TERM_STATISTICS_B201505532\tT_TBM_CHECK_DETAIL_PRICE_CAL_OUT_201601221160\tT_TBM_CHECK_DETAIL_CAL_OUT_20160122356\tT_TBM_STOCK_ADJUST_DETAIL_PRICE_CAL_OUT_201601221600497\tT_TBM_PICK_DETAIL11279\tCAP_USER_20150815_BAK47557\tT_MDM_ORG_ADMIN_REGION2127\tT_TBM_SIGN_IN_DETAIL_CAL_IN_2016012245438\tT_TBM_PATCH_SIGN_DETAIL_20150810_BAK5\tT_MDM_ORG_CHANNEL_DISTR1160\tTEMP_201637395\tcust_bak1160\tT_TBM_CHECK_DETAIL_CAL_IN_2016012217\tT_MDM_ORG_SALE_DEPT42021\tT_TBM_SP_REDACT_CUSTOM0\tT_TBM_SALE_BILL_DETAIL_PACK_PRICE_20160122559710\tT_TBM_PICK10996018\tT_TBM_STOCK_HIS308\tT_MDM_ORG_SALE_GROUP131\tT_TBM_STOCK_BATCH_TOTAL_FEE_OFFICE_10015831456\tT_TBM_STOCK_BATCH_HIS560\tT_TBM_SP_REDACT_NUM44046\tT_TBM_SALE_BILL_DETAIL_QUANTITY_OUT_2016012396409\tT_TBM_STOCK_OUTIN_RECORD_HIS33\tT_MDM_ORG_SALE_ORG44046\tT_TBM_SALE_BILL_DETAIL_RETURN_2016012345\tT_TBM_FEEDBACK557332\tT_TBM_STOCK_OUTIN_HIS41289\tT_TBM_SP_REDACT_OLD_PRODUCT74\tT_TBM_STOCK_ALLOT1648476\tT_TBM_STOCK_OUTIN_DETAIL_HIS68410\tT_TBM_SIGN_IN_201509041748\tT_TBM_STOCK_TERM_STATISTICS_HIS1353\tT_TBM_STOCK_ALLOT_DETAIL11284\tcap_user_20150811_bak80341\tcustomer_bak_6_19809\tT_TBM_OPTION_INFO771735\tT_TBM_SALE_BILL_DETAIL_SEND_PACK_2016012318\tTMP0053518245\tT_TBM_STOCK28531\tT_TBM_ECBILL_DETAIL_BAK1\tT_ACCOUNT_IMP336\tT_TBM_QUESTION_INFO0\tT_ACCOUNT_IMP_BAK4780\tT_TBM_SALE_BILL_DETAIL_SEND_2016012311\tT_TBM_QUESTION_BANK291288\tT_TBM_STOCK_ADJUST_DETAIL81\tT_MDM_PRO_CATEGORY27317\tT_TBM_SALE_BILL_DETAIL_ERROR_PACK_20160123219590\tT_TBM_SIGN_IN                                     20W+车辆信息10816\tCAP_USER_20150714_BAK34360\tT_TBM_SALE_BILL_M1_201601231\tANHUIBAN734\tT_MDM_PRO_COLOR_NUM34360\tT_TBM_SALE_BILL_OUT_M1_201601230\tF_HANDSET_GET_PACK86559\tcustomer_bak_6_2262097\tT_MDM_PRO_PRODUCT_MODEL0\tT_TBM_HANDLE_LOG464\ttmp31698\tT_MDM_PRO_REL_MATERIAL_MATCH197513\tT_TBM_STOCK_OCCUPY208\tT_MDM_PRO_PRODUCT_SERIES247\ttmp310\tT_TBM_SYS_LOGIN_LOG18\ttmp32157274\tT_TBM_SALE_BILL_BAK_2015072711752326\tT_TBM_SIGN_IN_DETAIL95\tT_TBM_SALE_BILL_DETAIL_20160104357666\tT_MDM_PRO_PRODUCT_INFO_20150814_BAK9\tT_MDM_PRO_PRODUCT_STYLE4\tT_TBM_EC_LOGISTIC201601060\tT_MDM_PRI_NO_SALES_PRICE_TOTAL_BAK295\tT_TBM_PURBILL_1000695853527\tT_TBM_POLICY_PUR2206\tT_MDM_PRI_SALES_PRICE_TOTAL_BAK13082943\tT_TBM_STOCK_OUTIN_RECORD9547\tT_TBM_SAMPLE_DOWN0\tT_MDM_PRO_REL_PRO_GROUP_SALE_ORG4534\tT_TBM_PURBILL_DETAIL_1000695446\tT_TBM_SIGN_IN_20150707441429\tT_TBM_SYNC_NO_SALES_PRICE_TOTAL23\tT_TBM_SP_REDACT_10006950\tT_TBM_SURVEY7123\tT_TBM_PATCH_PIC_20150814_BAK102\tT_MDM_PRO_SALE_SERIES2457\tT_TBM_STOCK_1000695775\tT_TBM_STOCK_OUTIN_100069546651\ttmp220\tT_MDM_ZONE_SALE_COMM8378\tT_TBM_STOCK_OUTIN_DETAIL_10006951508071\tT_MDM_PRI_NO_SALES_PRICE_TOTAL_15101263\tT_TBM_SIGN_IN_20150613174\tT_TBM_PATCH_RESTRICT_BAK731\tT_TBM_DELIVERY_1000695487\tT_TBM_STORE_PACKAGE36\tT_MDM_ZONE_SALE_AREA19729\tT_TBM_SEQUENCE_bak2015072815182\tT_TBM_SIGN_IN_20150613_ALL695\tT_TBM_PICK_10006951\tT_TBM_PURBILL20160112710\tT_TBM_PICK_DETAIL_1000695149\tTMP_SIGN38399\tT_TBM_IMP_EXCEL1652537\ttmp1                                 160W+ 家私订单1329\tT_TBM_STORE_PACKAGE_DETAIL1055\tT_TBM_STOCK_WARN36\tT_MDM_ZONE_SALE_MARKET41224\tT_TBM_SP_REDACT2\tT_TBM_CHECK_100069540269\tT_TBM_STOCK_ADJUST4313\tT_TBM_PATCH_BILL_20150729_BAK106\tT_MDM_PRO_FACTORY_INFO2\tT_MDM_ZONE_SALE_RANGE0\tT_TBM_IMP_RESULT0\tT_TBM_ECBILL201601135\tT_MDM_ZONE_SALE_REGION11\tT_TBM_SIGN_IN_TMP0\tT_TBM_SIGN_IN_DETAIL_201507070\tT_TBM_ECBILL_DETAIL201601132063\typr_test_010\tT_TBM_CHECK_DETAIL_TEMP20\tT_MDM_ZONE_SALE_ZONE260310\tT_TBM_PATCH_PLATE_STRUCT_20150816_BAK2748363\ttmp_sale_price2950\tT_TBM_PATCH_BILL_20160114_BAK2569187\ttmp_sale_price_bak277327\tT_TBM_PATCH_PLATE_STRUCT_20160115_BAK36\tT_SAP_OFFICE_TO_CUSCODE260\tT_TBM_CARPOOL150\tT_TBM_SIGN_IN_201510147607\tT_TBM_PATCH_PIC_20160115_BAK53638\ttmp_sale_price_no108006\tT_TBM_PATCH_PLATE_20160115_BAK530\tT_TBM_CARPOOL_DETAIL5889333\tT_TBM_SHOP_PRICE_SAD_BAK10742\tCAP_USER_201507070\tT_IMP_PLATE10832\tcap_user_bak_201507172633\tT_IMP_PLATE_STR2\tt_notice0\tT_IMP_PIC21122\tT_TBM_PATCH_BILL_20150819_BAK2896752\tT_TBM_CHECK_DETAIL28\tCAP_ROLE_20150707_BAK0\tF_STOCK_SALE_HEAD7123732\tT_MDM_PRI_NO_SALES_PRICE_TOTAL_tmp49\tT_TBM_COMPLAINT294335\ttmp_zlfl7659508\tT_MDM_PRI_SALES_PRICE_TOTAL_tmp                 700W家私订单0\tT_TBM_STOCK_OUTIN_RECORD_20150547\tT_TBM_CUSCHEST_DEMAND_BAK967366\tT_TBM_STOCK_OUTIN_RECORD_B2015056856\tT_MDM_PRI_SALES_PRICE_TOTAL_tmp011005\tT_TBM_CUSCHEST_DEMAND0\tF_STOCK_INSEND24742\tT_TBM_STOCK_OUTIN_B2015050\tT_TBM_PUR_CHECK910619\tT_TBM_STOCK_OUTIN_DETAIL_B2015050\tT_TBM_CHECK_PACK_DETAIL_REPEAT0\tF_STOCK_INWAY12150\tT_TBM_PICK_B2015050\tT_TBM_CHECK_PACK_DETAIL1241310\ttmp_STOCK_BATCH33709\tT_TBM_PICK_DETAIL_B2015057\tT_TBM_PURBILL_201509086859\tT_MDM_PRI_SALES_PRICE_TOTAL_tmp02853790\tT_TBM_DELIVERY311\tT_TBM_SAMPLE_UP_B2015057\tT_TBM_PURBILL_DETAIL_201509081267\tT_TBM_SAMPLE_UP_DETAIL_B201505120\tapp_menu201601170\tT_TBM_DISTRIBUTOR_ACCOUNT259\tT_TBM_SAMPLE_DOWN_B201505622\tCAP_RESAUTH_20160117_BAK1939\tT_TBM_SAMPLE_DOWN_DETAIL_B2015053\tT_TBM_STOCK_ALLOT_B2015051228\tCAP_USER2016022333\tT_TBM_INFO19912\tT_TBM_STAFF_BAK2187\tT_TBM_CUSCHEST_DEMAND_DETAIL45570\tT_TEMP_DIS_SERIES_IMP6724\tT_MDM_CHAN_DIS_STORE_151126591\ttmp00111\tT_TBM_STOCK_ALLOT_DETAIL_B2015052\tapp_menu_bak167\ttmp_mgr_error9965\tT_TBM_CHECK_B20150539262\tT_TBM_PUR_DRAFT_TMP770777\tT_TBM_CUSTOMER937780\tT_TBM_CHECK_DETAIL_B201505150\ttmp_mgr_error_239262\tT_TBM_PUR_DRAFT_TMP2704\tT_TBM_SIGN_IN_B201505150\ttmp_mgr_error_339262\tT_TBM_PUR_DRAFT_TMP357268\tT_TBM_SIGN_IN_DETAIL_B20150510577\tCAP_USER_BAK_20150601243\tTEMP1967366\tT_TBM_STOCK_OUTIN_RECORD_A201505586034\tT_TBM_REFUND1574982\ttmp_STOCK_BATCH_TYPE125933\tT_TBM_STOCK_OUTIN_A201505129513\ttmp_STOCK_BATCH_TYPE2919955\tT_TBM_STOCK_OUTIN_DETAIL_A20150517114\tT_TBM_CACHE_PUR_PRO277326\tT_TBM_PATCH_PLATE_STRUCT_151130622\ttmp00213255249\tT_TBM_STOCK_TERM_STATISTICS1249\tT_TBM_INFO_HISTORY13156\tT_TBM_PICK_A201505255\tSTOCK_SAMPLE_DOWN_TEMP46577\tT_TBM_PATCH_PLATE_STRUCT_BAK_15113037523\tT_TBM_PICK_DETAIL_A20150510\tT_MDM_CHAN_DISTRIBUTOR_INFO_20150602622\t签收单物料编码异常信息表323518\ttmp_STOCK_BATCH_TYPE3421\tT_TBM_SAMPLE_UP_A201505786553\tT_TBM_SALE_BILL51049\tT_TBM_RETURN648\ttmp00385\ttmp_STOCK_PROBLEM1604\tT_TBM_SAMPLE_UP_DETAIL_A2015051\tT_TBM_ECBILL_DETAIL2016011811\ttmp0041574982\tT_TBM_STOCK_BATCH_bak74991\tT_TBM_MESSAGE_DETAIL_20150731_BAK338\tT_TBM_SAMPLE_DOWN_A2015051\tT_TBM_ECBILL20160118169763\tT_TBM_SALE_BILL_BAK_201507302128\tT_TBM_SAMPLE_DOWN_DETAIL_A2015058752264\tT_TBM_MY_PRODUCT75449\tT_TBM_MESSAGE_DETAIL_150731_1530_bak4\tT_TBM_STOCK_ALLOT_A20150544\tT_TBM_ASSIGN_BAK14\tT_TBM_STOCK_ALLOT_DETAIL_A2015054\tT_TBM_PATCH_PLATE_STRUCT_20150825_BAK10852\tT_TBM_CHECK_A2015051033569\tTMP_TBM_SIGN_IN_COPY1199105\tT_TBM_CHECK_DETAIL_A2015050\tF_STOCK_SALE_UNSEND181727\tT_TBM_SYNC_SHOP_PRICE165380\tTMP_TBM_SIGN_IN_COPY_17380\tT_TBM_SIGN_IN_A20150511550\tT_TBM_CHECK_DETAIL20160302332198\tT_TBM_PURBILL1354\tT_TBM_COMMUNITY_SAD0\tF_PUR_PACK_CHOICE75320\tt_tbm_customer_bak350387\tT_TBM_SIGN_IN_DETAIL_A20150580\tT_TBM_PUR_DRAFT_BAK_00155\tT_TBM_PUR_DRAFT_BAK_0021428794\tT_TBM_STOCK_OUTIN_RECORD_B2015061\tT_TBM_SIGN_IN_2015120873061\tT_TBM_STOCK_OUTIN_B2015062\tT_TBM_SIGN_IN_DETAIL20151208801882\tTMP_TBM_SIGN_IN_COPY_21216594\tT_TBM_STOCK_OUTIN_DETAIL_B201506618\tTEMP_STOCK2387973\tT_TBM_MESSAGE825411\tT_TBM_PATCH_RECORD_15102743668\tT_TBM_PICK_B2015060\tF_STOCK_NEED1657\tT_TBM_SAMPLE_UP_B20150615181\tT_TBM_SAMPLE_UP419864\tT_TBM_MESSAGE_DETAIL6479\tT_TBM_SAMPLE_UP_DETAIL_B201506162553\tT_TBM_EC_LOGISTIC13\tT_MDM_PRO_PRODUCT_GROUP532\tT_TBM_STOCK_PROBLEM25215\tT_MDM_CHAN_SHOP_DEC_DETAIL966\tT_TBM_SAMPLE_DOWN_B201506313806\tT_TBM_ECBILL2\tCAP_RESAUTH201601192840\tT_TBM_SAMPLE_DOWN_DETAIL_B201506745046\tT_TBM_ECBILL_DETAIL1084\tT_MDM_PRO_MATERIAL_GROUP7975\tT_TBM_SALE_BILL_20151214165380\tTMP_TBM_SIGN_IN_COPY_35\tT_TBM_STOCK_ALLOT_B201506720\tT_TBM_SALE_BILL_201512152868\tT_MDM_CHAN_SHOP_DEC_MAIN49\tT_TBM_STOCK_ALLOT_DETAIL_B20150640804\tT_TBM_WARCARD_bak5\tT_MDM_PRO_SPACE_INFO0\tF_SBILL_SALEORG1996\tT_TBM_PUR_DRAFT81134\tT_TBM_MESSAGE_DETAIL_20150803_bak9613\tT_TBM_CHECK_B2015069480145\tT_TBM_STOCK_BATCH555014\tT_TBM_CHECK_DETAIL_B201506139900\tBASE_PRODUCTINFO_BAK42200\tT_TBM_PUR_DRAFT_DETAIL11451\tT_TBM_SIGN_IN_B20150635817\tT_MDM_PRO_PRODUCT_INFO_chayi579873\tT_TBM_SIGN_IN_DETAIL_B2015060\tT_TBM_CUSTOMER_FILE1428794\tT_TBM_STOCK_OUTIN_RECORD_A2015062983\tT_TBM_DIS_STORE_TEMP75485\tT_TBM_STOCK_OUTIN_A201506422\tT_TBM_DIS_STORE_TEMP11222711\tT_TBM_STOCK_OUTIN_DETAIL_A20150645682\tT_TBM_PICK_A201506284\tT_TEMP_154849\tT_TBM_CHECK96840\tT_TBM_RETURN_DETAIL130733\tT_TBM_PICK_DETAIL_A2015061046\tT_TBM_COMMUNITY52\tT_TEMP_IMP_2117931\tT_TBM_PURBILL_201509111727\tT_TBM_SAMPLE_UP_A2015061390504\tT_TBM_PURBILL_DETAIL_201509110\tT_TBM_SALES_RICE6468\tT_TBM_SAMPLE_UP_DETAIL_A201506201\tT_TEMP_2691322\tT_TBM_WARCARD579\tT_MDM_CHAN_CUSTOMER_MGR_INFO1052\tT_TBM_SAMPLE_DOWN_A201506417\tT_TBM_STAFF_SAD1099798\tT_TBM_SALE_BILL_DETAIL201601222906\tT_TBM_SAMPLE_DOWN_DETAIL_A2015062747\tT_MDM_CHAN_DISTRIBUTOR_INFO_20150723_BAK1526570\tT_TBM_SALE_BILL_DETAIL_SUIT201601223029\tT_MDM_CHAN_DISTRIBUTOR_INFO6\tT_TBM_STOCK_ALLOT_A2015064045718\tT_TBM_SALE_BILL_DETAIL_PACK201601220\tF_STOCK_HIS_SALES2559330\tT_TBM_SALE_BILL_DETAIL25659\tCAP_PARTYAUTH_BAK23136\tT_TBM_SAMPLE_DOWN_DETAIL50\tT_TBM_STOCK_ALLOT_DETAIL_A2015064045718\tT_TBM_SALE_BILL_DETAIL_PACK_MATYPE_201601224812\tT_MDM_CHAN_DIS_SALEORG_INFO9622\tT_TBM_CHECK_A201506\n数据库结构\nhttp://**.**.**.**/default/1.jspx 9635789\nshell   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2016-04-04 22:39 厂商回复： CNVD确认所述情况，已经由CNVD通过网站公开联系方式向网站管理单位通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-03-31 12:08 |    \t\t带头大哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:786 漏洞数:230        | |任意邮件伪造| |目录遍历| |任意文件读取|...)\t\t \n  http://butian.360.cn/vul/info/qid/QTVA-2016-397889    \n     2016-03-31 12:43 |    \t\t田老板 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:11        | 学校杀手)\t\t \n  http://butian.360.cn/vul/info/qid/QTVA-2016-397889    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}