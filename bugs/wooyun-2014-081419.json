{"id": 43858, "wybug_id": "wooyun-2014-081419", "wybug_title": "某通用建站系统漏洞打包（任意文件上传）", "wybug_corp": "长威信息科技发展股份有限公司", "wybug_author": "路人甲", "wybug_date": "2014-10-31 12:47", "wybug_open_date": "2015-01-29 12:48", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-08：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-29：\t细节向公众公开  简要描述： 不是第一个提这个洞的人，相信也不会是最后一个     前几个被提出的洞都没有找到问题厂商......这有点让人难以置信呀 详细说明：  存在该漏洞的厂商为：\n长威信息科技发展股份有限公司http://www.evecom.net/\n长威信息科技发展股份有限公司，是一家全国领先的IT综合服务提供商。长威科技致力于以智慧城市为核心领域的软件研发、解决方案集成及运行维护服务，并已构建起完整的IT服务价值链，为客户提供端到端的IT信息化服务。曾经的那些bug（感谢possible的分析，找了一下午才发现你已经提过了部分..）：\n WooYun: 福建省国土资源厅任意jsp上传 \n其中修复方案中有指出其拦截代码为\nevecom.jspcode='|and|set|exec|varchar|insert|select|*|update|delete|chr|master|truncate|char|declare|<|>\n注意evecom即长威（该站已换厂商了）\n WooYun: 福建某些局站点任意文件下载 \n案例中的\n../WEB-INF/web.xml\n也指向了长威（evecom）\n\n该系统有3处漏洞：1、上传页面未授权访问，导致文件任意上传、文件任意删除；2、任意文件下载3、FCK（路径都懒得改了）实例（以福建省为主）中华人民共和国上海海事局福州航标处\nhttp://www.fzhb.gov.cn/admin/content/upload.jsp\n福建省人口和计划生育委员会\nhttp://www.fjjsw.gov.cn/admin/content/upload.jsp\n\nhttp://www.fjjsw.gov.cn:8080/admin/content/upload.jsp\n福建省司法厅\nhttp://www.fjsf.gov.cn:11080/fjsf/admin/content/upload.jsp\n\nhttp://www.fjsf.gov.cn/fjsf/admin/content/upload.jsp\n\nhttp://www.fjsf.gov.cn/admin/content/upload.jsp\n福建农产品信息网\nhttp://www.fjcoop.com:8088/admin/content/upload.jsp\n福建少年儿童出版社\nhttp://www.fjcp.com/admin/content/upload.jsp\n长威信息科技发展股份有限公司\nhttp://www.evecom.net/admin/content/upload.jsp\n等等，也可以访问http://*./admin/template/uploadFile.jsp搜索特征：templates/left.jsp?colidtemplates/zt_qzlx.jsp?colidtemplates/down.jsp?colid   漏洞证明：  以厂商主站为例1、上传页面未授权访问，导致文件任意上传、文件任意删除；可以用possible提供的exp，也可以自己抓个包，将realPath=null改为realPath=/，或其它（这里没有设置limit和hold参数，所有文件被重命名为  原文件名+时间戳.jsp）\n\n\n\n\n\n\nhttp://www.evecom.net/test20141030085829.jsp\n通过以下链接可完成文件删除动作，注意realPath的修改\nhttp://www.evecom.net/delMoreFile.do?realPath=/&filename=test20141030085829.jsp&notSelect=1\n访问后http://www.evecom.net/test20141030085829.jsp会报500错误，但文件确实已经被删除了，特地传了个马上去验证了（这个洞貌似已经有年头了，站里也有其他人的shell）\nhttp://www.evecom.net/20140924102951.jsp\n\n\n2、任意文件下载\nhttp://www.evecom.net/templates/download.jsp?path=/UserFiles/../WEB-INF/web.xml\n\n\n3、FCK（以福建省人口和计划生育委员会网站为例）可参考\n WooYun: 中国联通某省站点任意文件上传 \n\nhttp://www.fjjsw.gov.cn/FCKeditor/editor/fckeditor.html\n\nhttp://www.fjjsw.gov.cn/FCKeditor/editor/filemanager/browser/default/frmupload.html\n\nhttp://www.fjjsw.gov.cn/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector\n\n\n4、任意添加用户\n\n就不深入了....   修复方案：  修复对任意文件下载应该是过滤../ 并且文件后缀白名单检查吧上传路径不可控+重命名+白名单未授权访问加上登录session验证   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2014-11-05 09:52 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}