{"id": 31825, "wybug_id": "wooyun-2015-0109655", "wybug_title": "五矿集团某站点jboss漏洞可内网渗透", "wybug_corp": "五矿集团", "wybug_author": "cleanmgr", "wybug_date": "2015-04-22 13:43", "wybug_open_date": "2015-06-08 17:58", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "未授权访问", "用户敏感信息泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-08：\t细节向公众公开  简要描述： 五矿集团某站点jboss漏洞可内网渗透，据说五矿的洞都忽略了，但还是提交吧... 详细说明：  站点：http://202.96.11.45上面部署有五矿有色铜业务运营系统、金网后台管理系统、五矿有色铜内贸业务系统。\n\n发现有jbosshttp://202.96.11.45/jmx-console/发现已被人光顾过了..\n\nhttp://202.96.11.45/DonGz/index.jsp\n\n找到数据库连接密码等，对外未开放1433端口，转发后连接，多个数据库：\n\n\n\n\n\n通过获取的数据登陆部分站点等等...http://202.96.11.48/SmartLearning/\n\n http://202.96.11.46/KinmetFutures/login.jsp \n\n然后就是进内网 发现是nt authority\\system权限，本打算通过reg save hklm\\system c:\\system.hive等读取注册表破解获得密码进去，未成功。\n\n只能自建admin$账户了，转发3389端口\n\n\n\n通过内网渗透发现10.1.32.1/2410.2.11.1/2410.255.1.45/24等网段域控服务器为10.1.32.1和10.1.32.2主机同时共用口令一堆：zhangj   zh*ng*2w8jsunp su*p5*9mzhaojk   zha*j*2*8ppatrol  p*t*olAdministrator   P**sw*rdliujy  9*****9Administrator  89****nv*a8etAdministrator  m*n*e*a*s等等部分截图如下：10.255.1.42\n\n\n\n\n\n\n\n\n\n10.255.1.14\n\n10.1.32段的\n\n其中几台主机截图：\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n通过抓包又能获取到一批密码：\n\n最后在10.1.32.45的缓存中抓到域账户的密码：\n\n破解未成功，其实可以通过wce工具直接提交密文登陆，但未尝试。   漏洞证明：  另送202.96.11.65心脏出血一个\n\n利用jmx-console获取敏感信息：1、jboss家目录路径：jboss.system  type=ServerConfig\n\n2、查询部署的应用：flavor=URL,type=DeploymentScanner找到java.lang.String listDeployedURLs()，点击Invoke\n\n3、列出部署的应用信息：service=MainDeployer找到java.util.Collection listDeployed()，点击Invoke\n\n4、关闭jboss找到jboss.system type=Server 找到void shutdown()，点击Invoke(未尝试)5、读取任意文件name=SystemProperties,type=Service找到List of MBean attributes，在URLList中填入文件的相对路径，点击Apply 如果文件路径不正确或不存在，将出现500错误。找到java.util.Map showAll()，点击Invoke在返回页面中可以查看到目标文件内容:\n\n6、通过DeploymentScanner、BSH（Bean Shell）Deployment、直接写入shell等方式写入木马。7、有密码jmx-console等通过RMI远程方法调用、JMXInvoker、Jmx Console控制台HTTP认证绕过、invoker/JMXInvokerServlet或invoker/EJBInvokerServlet、Jboss远程代码执行漏洞CVE 2013-4810等方式部署木马。   修复方案：  建议一：删除$JBOSS_HOME/[server]/all/deploy和$JBOSS_HOME/[server]/default/deploy下的Jmx-console.war、Web-console.war文件卸载控制台。或者去掉“jmx-console-web.xml”里的<http-method>GET</http-method> 和<http-method>POST</http-method>， 这样就能使所有HTTP类型的请求都要登录才能成功。建议二：给jmx-console和web-console都加上密码。在 ${jboss.server.home.dir}/deploy下面找到jmx-console.war目录编辑WEB-INF/web.xml文件，去掉 security-constraint 块的注释，使其起作用。建议三：编辑WEB-INF/jboss-web.xml去掉 security-domain 块的注释，security-domain值的映射文件为 login-config.xml （该文件定义了登录授权方式）；或者直接删除 $JBOSS_HOME/[server]/all/deploy 和$JBOSS_HOME/[server]/default/deploy下的Jmx-console.war 、Web-console.war这两个.War文件来禁止对jmx-console和web-console的访问，再访问jmx-console或者 web-console时就返回404了。建议四: 删除 server/default/deploy/http-invoker.sar 这个包建议五：梳理并加强内网防火墙ACL，最好限制到端口级。建议六：口令共用及弱口令问题等....   版权声明：转载请注明来源 cleanmgr@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2015-04-24 17:56 厂商回复： CNVD未复现所述情况,已经转由CNCERT向能源行业信息化主管部门通报,由其后续协调网站管理单位处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-09 09:56 |    \t\tqdq \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 有关部门)\t\t \n  好强    \n     2015-06-10 14:07 |    \t\t冰麒麟 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 就算是男孩子,只要可爱就没问题了.)\t\t \n  卧槽，日穿了    \n     2015-09-08 15:48 |    \t\t临时城管 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 随手这么一打)\t\t \n  牛掰    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}