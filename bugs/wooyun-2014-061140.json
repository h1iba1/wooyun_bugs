{"id": 2103, "wybug_id": "wooyun-2014-061140", "wybug_title": "大汉版通系统再次getshell之2", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "路人甲", "wybug_date": "2014-05-17 20:31", "wybug_open_date": "2014-08-15 20:32", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "任意文件上传", "文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-15：\t细节向公众公开  简要描述： 大汉版通系统再次getshell#2(前台且非setup) ，且同样存存在两处.. 详细说明：  注：该系统为信息公开系统(xxgk)#1 漏洞文件\n/xxgk/m_6_1/opr_modal.jsp/xxgk/m_6_1/attachupload.jsp\n选择其一贴下漏洞代码,这里为/xxgk/m_6_1/opr_modal.jsp..\n\n\n//..if (strStatus.equals(\"S\")) {    blf.doUpload(request);    out.println(Convert.getAlterScript(\"parent.location='./opr_modal.jsp'\"));    return;}//从下面可获取到文件上传的路径if (strStatus.equals(\"V\")) {        int inModaltype = Integer.parseInt(strModaltype);        entity = blf.getModal(strI_id, inModaltype);        if (entity != null) {            strModalName = entity.getVc_modalfilename();        }        String strModalPath = application.getRealPath(\"\")                + \"/jcms_files/jcms\" + strAppID + \"/web\" + nWebID                + \"/site/zfxxgk/ysqgk/modal/\" + strModaltype + \"/\"                + strModalName;        Convert convert = new Convert();        String strModal = convert                .readInputStream(strModalPath, \"UTF-8\");        if (Convert.getValue(strModal).length() == 0) {            out                    .println(\"<a style='font:12px;color:#FF0000'>模板文件为空</a>\");            return;        }        strModal = Convert.replaceString(strModal, \"\\\"images/\", \"\\\"\"                + \"../jcms_files/jcms\" + strAppID + \"/web\" + nWebID                + \"/site/zfxxgk/ysqgk/modal/\" + strModaltype                + \"/images/\");        out.println(strModal);        return;    }%>\n从上面可以看出，文件上传仅在客户端采用javascript进行验证,服务端并没有任何的验证，可以说 可以直接上传任意文件，于是造成了任意文件上传漏洞。#2 漏洞验证由于网上有大量的实例，任意选取一个案例进行测试验证..这里选择\nhttp://xxgk.weifang.gov.cn/xxgk/m_6_1/opr_modal.jsp\n\n\nstep1 将我们要上传的users.jsp重命名为user.htmstep2 上传时抓包，将user.htm再次命名为user.jsp即可，如下\n\n点击GO 即可在下面目录生成user.jsp\n/xxgk/jcms_files/jcms1/web0/site/zfxxgk/ysqgk/modal/1/你的文件名注意：由于代码中上传文件的路径为：\"/jcms_files/jcms\" + strAppID + \"/web\" + nWebID+ \"/site/zfxxgk/ysqgk/modal/\" + strModaltype + \"/\"+ 文件名;所以路径可能要做适当的更改.@@@\n#3 连接shellshell路径为：\nhttp://xxgk.site.cn/xxgk/jcms_files/jcms1/web0/site/zfxxgk/ysqgk/modal/1/users.jsp\n如图所示\n\n   漏洞证明：  #证明这个系统均运行在很高的权限.. 控制下吧\n\n   修复方案：  客户端的东西是不可信的   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-05-19 10:00 厂商回复： 感谢关注 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}