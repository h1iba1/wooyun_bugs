{"id": 42443, "wybug_id": "wooyun-2014-085793", "wybug_title": "phpcms后台变量覆盖导致SQL注入", "wybug_corp": "phpcms", "wybug_author": "JsStack", "wybug_date": "2014-12-08 18:31", "wybug_open_date": "2014-12-13 18:32", "wybug_type": "SQL注射漏洞", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 用到了大量extract，稍不注意就会造成问题。这次是个sql注入,需要管理员权限 详细说明：  v9代码在ipbanned.php line74\npublic function search_ip() {\t\t$where = '';\t\tif($_GET['search']) extract($_GET['search']);\t\tif($ip){\t\t\t$where .= $where ?  \" AND ip LIKE '%$ip%'\" : \" ip LIKE '%$ip%'\";\t\t}\t\t$page = isset($_GET['page']) && intval($_GET['page']) ? intval($_GET['page']) : 1;\t\t$infos = $this->db->listinfo($where,$order = 'ipbannedid DESC',$page, $pages = '2');\t\t$pages = $this->db->pages;  \t\t$big_menu = array('javascript:window.top.art.dialog({id:\\'add\\',iframe:\\'?m=admin&c=ipbanned&a=add\\', title:\\''.L('add_ipbanned').'\\', width:\\'450\\', height:\\'300\\'}, function(){var d = window.top.art.dialog({id:\\'add\\'}).data.iframe;var form = d.document.getElementById(\\'dosubmit\\');form.click();return false;}, function(){window.top.art.dialog({id:\\'add\\'}).close()});void(0);', L('add_ipbanned'));\t\tinclude $this->admin_tpl('ip_search_list');\t}\n这句extract($_GET['search']);，提交任意key=value对都会解析成变量。下面\nif($ip){\t\t\t$where .= $where ?  \" AND ip LIKE '%$ip%'\" : \" ip LIKE '%$ip%'\";\t\t}\n没有ip的话就会绕过这句，只需提交search内容为where=xxx，就可以覆盖变量$where,顺利到达sql。例如提交1=1，最终sql为：\nSELECT COUNT(*) AS num FROM `phpcms`.`v9_ipbanned` WHERE 1=1 LIMIT 1\n虽然会加反斜杠转义引号等符号，但是可以用char(99,58,92,119,105,110),concat()等绕过这些限制。可用来猜解数据库名，帐户密码等。   漏洞证明：     修复方案：     版权声明：转载请注明来源 JsStack@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-13 18:32 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-04 05:41 |    \t\t探狗 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 报！！探狗飞报！！！)\t\t \n  后台，后台还有个代码执行    \n     2015-07-27 00:34 |    \t\t0c0c0f \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:15        | My H34rt c4n 3xploit 4ny h0les!)\t\t \n  @JsStack 还没修复呢.    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}