{"id": 10251, "wybug_id": "wooyun-2013-028795", "wybug_title": "中国铁建股份有限公司某业务系统漏洞（多漏洞打包）", "wybug_corp": "中国铁建股份有限公司", "wybug_author": "鶆鶈", "wybug_date": "2013-07-14 11:24", "wybug_open_date": "2013-08-28 11:25", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-07-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-07-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-07-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-08-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-08-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-28：\t细节向公众公开  简要描述： 任意文件文件下载和SQL注射及由此引发的渗透测试。(漏洞类型不能多选额，建议做成多选；另外建议加个备注框，可以说些题外话，之前提交过一次，不知道为什么没通过，我觉得这个问题还是有一定影响的，那个123456条我也不知道是哪个，大侠们稍微麻烦下，在下面给个具体原因描述吧。) 详细说明：  1.任意文件下载:http://ec.crcc.cn/b2b/web/fileuploadAction.do?method=downLoad&fileName=web.xml&fileType=text&fjbh=web&fjml=/WEB-INF/翻了源程序后发现程序中还有几处文件下载，都存在问题，比如这个就更方便了：http://ec.crcc.cn/b2b/web/uploadAction.do?method=downLoad&fileType=text&fileName=/etc/shadow2.SQL注射：http://ec.crcc.cn/b2b/web/two/indexinfoAction.do?actionType=showOneProduct&xh=2&dwbm=-1' union select NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL from dual--&sbwzly=03.渗透测试：1) 先下载些网站源程序来看看，特别是weblogic的config.xml和WEB-INF下的一些常见配置文件，再根据struts-config.xml批量下载类文件；2) 结合源码，SQL注射起来就简单多了，密码只是简单地通过base64加密，读取admin帐号密码登入系统，得到该系统管理员权限；3) 在翻源码时发现程序中存在一个用户信息导出的操作(在com.sunwayworld.srm30.web.sysuser.action.SysUserAction这个类中)，可导出全部上万用户信息，其中email带crcc的当然是内部人员了，可用作后续渗透;4) admin帐号可以修改系统文件上传类型，添加jsp，在系统系统里翻半天没找到上传，根据struts-config.xml直接去源程序里翻，猜也猜得到是那个fileuploadAction，就看怎么调用了，上传了一个jspshell文件，不过上传后没返回文件名有点奇怪，保存的是\"年月+4位数字.后缀\"的形式，扫一下吧。5) 拿到了webshell，不出意外，当然是系统权限。ec.crcc.cn的ip地址是114.247.103.7，而114.247.103.6这个IP的8000端口也跑着这个系统，依法施为，这台主机当然也跑不了。通过这两服务器可以尝试渗透内网中其它主机，笔者就没测试了。6) 导出的用户信息中没密码，weblogic里有关密码的东西都是加密的，笔者也不知道怎么去调用它的datasource，对这些东西不熟，不过不是还有SQL注射么，根据SQL注射漏洞获取用户对应的密码（多数是弱口令），使用这些帐号密码再去测试企业应用中心(work.crcc.cn)和邮件系统(mail.crcc.com)，从中都找到了能登陆的用户。7) 现在能掌控两台服务器，部分多处通用的帐号密码，足够向中国铁建股份有限公司发起进一步渗透了，笔者就木有继续了。   漏洞证明：  使用admin登陆:\n\ngetshell:\n\n大量用户信息泄露：\n\n登陆email及企业应用系统：\n\n\n\n   修复方案：  系统应该是sunwayworld开发的，最好联系他们修复吧。   版权声明：转载请注明来源 鶆鶈@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2013-07-18 15:28 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-08-28 14:19 |    \t\tIXY \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:3        | 小菜来学习的)\t\t \n  LZ大黑阔    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}