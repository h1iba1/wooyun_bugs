{"id": 47367, "wybug_id": "wooyun-2014-080867", "wybug_title": "qibocms地方门户系统注入一个问题(demo测试)", "wybug_corp": "齐博CMS", "wybug_author": "′雨。", "wybug_date": "2014-10-29 13:02", "wybug_open_date": "2015-01-27 13:04", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-27：\t细节向公众公开  简要描述： 一周4个小时的假期也够苦的。life5.qibosoft.com听说一般应用。注入 && 另外一个问题。 详细说明：  \nif(ereg(\"^([-_0-9a-zA-Z]+)$\",$_GET[jobs])){\t//不读数据库\tif(is_file(dirname(__FILE__).\"/../inc/job/$_GET[jobs].php\")){\t\tinclude(dirname(__FILE__).\"/../inc/job/$_GET[jobs].php\");\t}}elseif(ereg(\"^([-_0-9a-zA-Z]+)$\",$_GET['job'])||ereg(\"^([-_0-9a-zA-Z]+)$\",$_POST['job'])){\t//读数据库\trequire(dirname(__FILE__).\"/\".\"global.php\");\tif(ereg(\"^([-_0-9a-zA-Z]+)$\",$job)&&is_file(ROOT_PATH.\"inc/job/$job.php\")){\t\tinclude(ROOT_PATH.\"inc/job/$job.php\");\t}}\n包含文件进来。inc/job/ckreg.php 中\n}elseif($type=='yzimg'){\tif($db->get_one(\"SELECT * FROM {$pre}yzimg WHERE $SQL imgnum='$name' AND sid='$usr_sid'\")){\t\tdie(\"<img src=$webdb[www_url]/images/default/check_right.gif> <font color=red>验证码输入正确!</font>\");\t}else{\t\tdie(\"<img src=$webdb[www_url]/images/default/check_error.gif>请输入正确的验证码\"); \t}\n这里的$SQL并没有初始化, 结合qibocms的全局机制 可以直接控制这个变量 导致注入。\n\ndemo测试:http://life5.qibosoft.com/do/job.php?job=ckreg&type=yzimg&SQL=1=1 union select 1%23数据库连接出错:SELECT * FROM life5_yzimg WHERE 1=1 union select 1# imgnum='' AND sid='1wmqh6ce'The used SELECT statements have a different number of columns1222请输入正确的验证码_________________________________________________________________________第二个问题在wei/member/post.php中\nelseif($action==\"del\"){\t$rsdb=$db->get_one(\"SELECT B.*,A.* FROM `{$_pre}content` A LEFT JOIN `{$_pre}content_1` B ON A.id=B.id WHERE A.id='$id'\");\tif($rsdb[fid]!=$fidDB[fid]){\t\t\tshowerr(\"栏目有问题\");\t}\tif($rsdb[uid]!=$lfjuid&&!$web_admin)\t{\t\tshowerr(\"你无权操作\");\t}\t$db->query(\"DELETE FROM `{$_pre}content` WHERE id='$id' \");\t$db->query(\"DELETE FROM `{$_pre}content_1` WHERE id='$id' \");\t$db->query(\"DELETE FROM `{$_pre}comments` WHERE id='$id' \");\t\tkeyword_del($id,$rsdb['keywords']);\nkeyword_del($id,$rsdb['keywords']);这里是出库来的 所以能引入转义符啥的。\nfunction keyword_del($id,$keyword){\tglobal $db,$_pre;\tif(!$keyword){\t\treturn ;\t}\t$detail2=explode(\" \",$keyword);\tforeach( $detail2 AS $key=>$value){\t\tif($value){\t\t\t$db->query(\"UPDATE `{$_pre}keyword` SET num=num-1 WHERE BINARY `keywords`='$value'\");\t\t\t$_rs=$db->get_one(\"SELECT kid,num FROM `{$_pre}keyword` WHERE BINARY `keywords`='$value'\");\t\t\tif($_rs[num]<1){\t\t\t\t$db->query(\"DELETE FROM `{$_pre}keyword` WHERE BINARY `keywords`='$value'\");\t\t\t\t}\t\t\t$kid=$_rs[kid];\t\t\t$db->query(\"DELETE FROM `{$_pre}keywordid` WHERE `kid`='$kid' AND id='$id'\");\n可以看到 出库的没过滤 再一次带入到查询当中\n\n首先 关键字中写一些特殊字符 然后入库\n\n然后修改。在点击确认。\n\n出库 造成注入。   漏洞证明：  \n\n   修复方案：  第一个初始化一下第二个 出库转义。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-10-31 16:03 厂商回复： 感谢提出来。 不过第二个问题，之前已处理过的了 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-29 13:03 |    \t\tki11y0u \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:23        | 好好学习，求带飞~~~~~~~~~~~~~~~~~~~~~~...)\t\t \n  雨牛~~~~~~    \n     2014-10-29 13:06 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  门户是付费的，源码...    \n     2014-10-29 13:24 |    \t\tC4ndy \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        )\t\t \n  注入#1  这是有续集的节奏？    \n     2014-10-29 13:28 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  雨大爷又来抢我生意了    \n     2014-10-29 13:50 |    \t\tPythonPig \t\t\t( 普通白帽子  |\t\t\t        Rank:491 漏洞数:71        | 只会简单工具的小小菜)\t\t \n  雨大爷不是潜心一年的嘛？最近又开始飙洞了？    \n     2014-10-29 13:56 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @PythonPig  不破1000rank 不甘心。。    \n     2014-10-29 13:58 |    \t\tPythonPig \t\t\t( 普通白帽子  |\t\t\t        Rank:491 漏洞数:71        | 只会简单工具的小小菜)\t\t \n  @′  雨。 挖洞强迫症，得治    \n     2014-10-29 15:57 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  雨牛又出来调皮了。    \n     2015-01-25 22:00 |    \t\t金枪银矛小霸王 \t\t\t( 普通白帽子  |\t\t\t        Rank:103 漏洞数:25        | 不会挖洞洞的猿猿不是好学生)\t\t \n  唉，雨牛天天出来装逼    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}