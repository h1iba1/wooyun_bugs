{"id": 41935, "wybug_id": "wooyun-2014-087255", "wybug_title": "UWA 2.X 通用建站系统XXOO大礼包", "wybug_corp": "asthis.net", "wybug_author": "路人甲", "wybug_date": "2014-12-16 18:19", "wybug_open_date": "2015-03-16 18:20", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "13", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-16：\t细节向公众公开  简要描述： 欢迎使用 UWA 2.X ，是如斯(AsThis)基于 PHP 和 MySQL 开发的通用建站系统，程序简洁、灵活而具备强大的扩展性，他将是您轻松建站的首选利器。 详细说明：  #01 敏感路径泄露X1/core/lib/core/App.class.php 第14行\nclass App extends Pfa {\t/* initialization */\tpublic function __construct() {\t\terror_reporting(E_ALL ^ E_NOTICE ^ E_WARNING);\t\tset_error_handler(array('App', 'app_error'));\t\t//[RUNTIME]\t\tApp::build(); // pre-compile\t\t//[/RUNTIME]\t\tUrl::dispatch(); // URL dispatch and define CTRLR_NAME, ACTN_NAME\n其中 Pfa 父类没有验证是否存在 导致直接访问http://localhost/core/lib/core/App.class.php会导致爆出绝对路径\n\n此问题在cms中多处存在请务必详查对于父类的继承相关代码#02 敏感路径泄露X2/core/tpl/page_trace.php 第17行\n<div id=\"pfa_page_trace\" style=\"padding:10px;margin:10px;color:#666;line-height:18px;background:#fff;border:1px solid #e5e5e5;\">\t<p style=\"padding:0;margin:0;border-bottom:1px solid #ccc;font-size:14px;color:#f60;\"><?php echo L('_PAGE_TRACE_INFO_') ?></p>\t<p style=\"padding:0 margin:5px 0 0;overflow:auto;height:300px;text-align:left;font-size:12px;\"><?php foreach($_trace as $key=>$info){echo $key . ' : ' . $info . \"<br />\\r\\n\";}?>\t</p></div>\n文件并未define function文件 并直接调用函数导致报错\n\n#03 SQL injection/core/lib/ext/AServer.class.php 第14-111行的定义类AServer时 第16-37行代码如下\npublic static function get_ip() {\t\t$ip = '';\t\tif(!empty($_SERVER['HTTP_CLIENT_IP'])) {\t\t\t$ip = $_SERVER['HTTP_CLIENT_IP'];\t\t}\t\tif(!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {\t\t\t$ips = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);\t\t\tif($ip) {\t\t\t\tarray_unshift($ips, $ip);\t\t\t\t$ip = '';\t\t\t}\t\t\tfor($i = 0; $i < count($ips); $i++) {\t\t\t\tif(!preg_match(\"/^(10|172\\.16|192\\.168)\\./i\", $ips[$i])) {\t\t\t\t\t$ip = $ips[$i];\t\t\t\t\tbreak;\t\t\t\t}\t\t\t}\t\t}\t\t$ip = $ip ? $ip : $_SERVER['REMOTE_ADDR'];\t\t$long = sprintf(\"%u\", ip2long($ip));\t\treturn $long ? $ip : '0.0.0.0';\t}\n对于HTTP_CLIENT_IP和HTTP_X_FORWARDED_FOR都木有过滤 所以导致可以进行注入。由于木有火狐就先不进行测试了 具体应用在/admin.php进行登录时会记录IP 对于IP却没有过滤，Ps：sqlmap使用要加--level=3\n\n   漏洞证明：     修复方案：  过滤第一次提交通用洞洞不足指出~   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-12-16 22:31 厂商回复： 已确认，多谢反馈 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-10 00:44 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  对于HTTP_CLIENT_IP和HTTP_X_FORWARDED_FOR都木有过滤 ？我书读的少，你可不要骗我    \n     2015-02-23 10:37 |    \t\t′雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @roker 早就让你多读点书 你不信、    \n     2015-04-08 13:14 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  @roker 这漏洞完全在乱写 =。=    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}