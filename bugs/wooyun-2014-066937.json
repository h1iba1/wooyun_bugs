{"id": 2082, "wybug_id": "wooyun-2014-066937", "wybug_title": "海康威视分站存在漏洞可渗透内网", "wybug_corp": "海康威视", "wybug_author": "点点", "wybug_date": "2014-07-02 10:38", "wybug_open_date": "2014-08-16 10:40", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-16：\t细节向公众公开  简要描述： 美女就是会骗钱，上次一美女同事吃完饭，跟我说她忘带钱包，要我打的送她回家，她拿钱还我，当我傻，那么远，我打的回来不要钱啊，又想占我便宜，下次再这样要求，我最少要她补我回来车费！我还是比较机智知道她家在哪个站下车近，我拿出2块，送到公交站，看她上车我才走的。还有一次跟一女同事喝酒聚会，喝完女同事也醉了说想让我晚上陪她睡，我听完后一巴掌扇过去了，把她一人留在那，我想她肯定是想趁我睡着的时候偷我兜里的两百块钱，真没想到她是这种人，我呸！ 详细说明：  美女就是会骗钱，上次一美女同事吃完饭，跟我说她忘带钱包，要我打的送她回家，她拿钱还我，当我傻，那么远，我打的回来不要钱啊，又想占我便宜，下次再这样要求，我最少要她补我回来车费！我还是比较机智知道她家在哪个站下车近，我拿出2块，送到公交站，看她上车我才走的。还有一次跟一女同事喝酒聚会，喝完女同事也醉了说想让我晚上陪她睡，我听完后一巴掌扇过去了，把她一人留在那，我想她肯定是想趁我睡着的时候偷我兜里的两百块钱，真没想到她是这种人，我呸！   漏洞证明：  海康威视分站http://eps.hikvision.com/ftb.imagegallery.aspx 存在上传漏洞 直接可以上传asp\n\nhttp://eps.hikvision.com/images/dm.asp shell地址   修复方案：  修复方案：添加代码加登陆验证程序代码private void Page_Load(object sender, System.EventArgs e) {  　　string isframe = \"\" + Request[\"frame\"];  　Freetextbox上传图片是直接保留原文件名的，这个地方做个修改，上传文件使用时间串做文件名。修改方式如下：　　找到 程序代码UploadFileNameUploadFileName = UploadFileName.Substring(UploadFileName.LastIndexOf(\"\\\\\")+1);  　　在其下面添加以下代码　　 程序代码//*********************　　UploadFileName = DateTime.Now.ToString() + UploadFileName.Remove(0, UploadFileName.LastIndexOf(\".\"));　　UploadFileName = UploadFileName.Replace(\":\", \"\").Replace(\"-\", \"\").Replace(\" \", \"\");　　//by Yation.Team 2009/7/17 上传文件用时间重命名以前已经有人公布过fb暴路径的方法http*****.cn/helps/ftb.imagegallery.aspx?frame=1”在地址后面加上&rif=..&cif=..在访问 整个网站的目录就呈现在眼前了,下面还有上传删除等按钮... 修正方式如下：　　找到 程序代码if (cif != \"\" && rif != \"\") {　　把RootImagesFolder.Value = rif;替换成　　 程序代码//*****************************　　RootImagesFolder.Value = DefaultImageFolder;　　Array srtArray = cif.Split('\\\\');　　string str = srtArray.GetValue(0).ToString();　　if (str != DefaultImageFolder)　　{　　cif = DefaultImageFolder;　　}　　cif = cif.Replace(\"..\\\\\", \"\").Replace(\"../\",\"\");　　//防止越级查看文件 by kook. - 2011.2.22    版权声明：转载请注明来源 点点@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2014-07-02 14:00 厂商回复： 感谢反馈，已提交网站开发人员修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-02 13:51 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  下次有这样的女人 告诉她们 请联系我！ 人傻 钱多 速来！    \n     2014-07-02 14:10 |    \t\t点点 \t\t\t( 普通白帽子  |\t\t\t        Rank:214 漏洞数:38        | 准备申请سمَـَّوُوُحخ ̷̴̐...)\t\t \n  @海康威视 我还以为你会给20呢 亲 有礼物么    \n     2014-07-23 21:34 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  我觉得能给出详细修复方案的， 就应该给人家20点。 支持楼主    \n     2014-10-26 20:34 |    \t\t花心 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:6        | 我是来找机油的。)\t\t \n  下次有这样的女人 告诉她们 请联系我！ 人傻 钱多 速来！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}