{"id": 72822, "wybug_id": "wooyun-2015-0148340", "wybug_title": "智能设备安全之控制全国消费终端电子信息互动屏(控制开机/关机/广告/视频/字幕/推广图等)", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "xfkxfk", "wybug_date": "2015-10-21 14:34", "wybug_open_date": "2016-01-21 11:00", "wybug_type": "权限控制绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["终端机安全", "认证设计不合理", "认证缺陷", "认证绕过"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-26：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-21：\t细节向公众公开  简要描述： 中国消费终端联播网——电子信息互动屏可控制全国所有终端电子信息互动屏，可以开关机，重启，修改增加图片广告，播放视频，滚动文字等，正好公司附近饭店就有一台，蹲点测试。顺便祝大家重阳节快乐！ 详细说明：  具体设备详情如下介绍：http://**.**.**.**/html/netproject.html?id=1正好某天吃饭在饭店大厅看到这个，上面跑了一个Android系统，随便点了几下然后有密码，登陆不进去，但是看到了它与服务器通信的地址，但是修改不了，需要密码然后回来就研究了一番，发现如下影响很大的问题首先从官方开始，了解了下这个产品然后从终端与服务器通信地址开始下手，发现如下问题：http://**.**.**.**/ADVPLAYLIST12/\n\nhttp://**.**.**.**/ADVSEVER12/\n\nhttp://**.**.**.**/NewForIF/\n\n很多列目录的问题，各种信息泄露，如web service请求的验证token\n\n然后仔细翻了一遍，下载了几个压缩包里面有东方天呈巡查系统和东方天呈广告投放系统先从东方天呈巡查系统入手\n\n然后需要登录账号，试了一些弱口令都无果然后找工具看了下源码中对登录验证的过程，如下：\n\n看源码中是从接受的参数中得到用户名和密码然后到云端服务器进行账户验证，如果验证成功后，返回的第一个参数为1，第二个参数为用户userid，如果记住密码的话就会把用户名密码写到config.ini文件中然后如果第一个参数为1即代表登录验证成功，然后查询userid对应的权限，最后登录进入巡查系统如这里我们输入错误的用户名密码\n\n然后修改返回后的信息：\n\n最后即可登录成功，进入系统了这个系统里面有很多功能，包括用户管理，用户权限管理，设备管理，设备定位，设备故障管理，云端网站后台管理等这是设备列表，可以列出全国各地的终端还可以对终端进行操作，关机，重启，截屏等操作全国各地全部加起来的终端数量应该有5000+台，下面为直辖市的全部终端列表\n\n还可以对所以终端设备进行定位，如四川成都的部分设备\n\n下面为对用户及权限的操作：\n\n在菜单栏中的网站系统里面，有三个系统：餐饮企业内部管理系统——使用设备的企业自己的管理后台地址：http://**.**.**.**:84/Login.aspx餐饮企业后台管理系统——云端管理全国所有使用设备及注册过的企业地址：http://**.**.**.**:86/Login.aspx政府信息发布平台——政府部分发布推广及公告信息的系统地址：http://**.**.**.**:85/Login.aspx从巡查系统中添加一个用户，然后即可登录餐饮企业后台管理系统http://**.**.**.**:86/Login.aspx\n\n后台可以看到，到目前为止全国一共有5081台设备然后随便选择一台设备，即可进行操作，先来重置密码，重置后的密码为弱口令123456下来再来登录餐饮企业内部管理系统http://**.**.**.**:84/Login.aspx利用我们重置的某家餐饮企业密码，成功登录内部管理系统\n\n可以在这里对自家设备进行管理，投放公告，推广图片，宣传图片，广告到设备上等操作至于政府信息发布平台，因为没有找到账号没有登录下面来看看前面提到的东方天呈广告投放系统\n\n也是需要账户才能登录的，而且登录验证过程跟巡查系统一样\n\n但是这里返回的登录验证数据太对，没办法全部构造全，及时登录成功但是会导致权限丢失可喜的是在压缩包里面有config.ini文件，里面已经记录了正确的用户名和加密后的密码\n\n我们在登录时修改掉密码接口成功登录\n\n下面为用户及权限管理\n\n下面才是此系统的重点，可以查看到全国所有终端设备上已经投放的广告而且这里还可以自定义广告投放\n\n可以随便查看全国任意一台设备上现在播放的广告内容，如苏福记酒店的广告内容：\n\n下屏有两个广告然后我们来给苏福记酒店的终端设备增加一个广告今天正好重阳节，就加一个应景的广告吧\n\n这里可以选择广告在设备上的位置，播放时间，广告类型可为图片和视频，还可以选择我们增加的广告在那一台终端机上跑，我们这里选择苏福记酒店（因为他离我进，我可以去看广告是否生效）（解释一下，这个终端设备有三个屏幕，上面是一个广告屏，中间是一个系统操作屏，也可以展示企业自己的推广内容，还有一个下屏，这个最大，是大部分的广告播放屏幕）现在再来看我们投放的广告是否加入到了苏福记酒店的终端广告列表中：\n\n可见，广告已经成功加入到了播放列表中剩下的就是去终端机上看看是否成功播放了（当然我们是真的去看了）上面我们只在下屏投放了广告，而且只有管理员才能投放其实上面我们有讲到餐饮企业内部管理系统中，企业可以自行修改自己的终端机上的内容这里存在越权操作，企业可以改任何其他企业在中屏的推广广告如这里我在苏福记酒店的终端机上加了一个中屏广告\n\n这里可以进行删除和编辑，在编辑时，我们可以编辑其他企业的终端机上的中屏广告如苏福记酒店的中屏广告为1185，我可以直接修改1183的其他终端机上的广告\n\n到现在为止，我们已经给苏福记酒店投放了下屏的图片广告和中屏的图片广告然后我们去苏福记酒店看看效果。。。。。。（一个小时过去了）效果杠杠的，上图：\n\n喜庆的重阳节广告图片已经在中屏和下屏播放了。。。其实我们看到的巡查和广告投放系统，根本不需要登录即可直接发送操作请求因为第一步里面已经泄露token，而且登录后是没有跟新这个token的所以在所有的请求中没有验证登录状态，直接发送请求即可   漏洞证明：  \n\n   修复方案：  加固服务器配置巡查和广告投放系统代码加密处理验证所以请求的登录状态加强不同用户间的权限控制   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-10-23 10:58 厂商回复： CNVD确认所述漏洞情况，暂未建立与网站管理单位的直接处置渠道，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-10-21 14:39 |    \t\tDloveJ \t\t\t( 普通白帽子  |\t\t\t        Rank:1184 漏洞数:212        | Web安全测试培训  QQ269787775)\t\t \n  沙发 伸伸腿    \n     2015-10-21 14:40 |    \t\tmissy \t\t\t( 普通白帽子  |\t\t\t        Rank:816 漏洞数:219        | .....-3-3-3-3-3-3-3-3-3-3-3-3-3)\t\t \n  师傅好666    \n     2015-10-21 14:46 |    \t\tHckmaple \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:23        | ~~~)\t\t \n  前排占座    \n     2015-10-21 14:46 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1837 漏洞数:291        | HackBraid昵称的由来是一款名为Braid的游戏...)\t\t \n  师傅带我～    \n     2015-10-21 14:53 |    \t\t蓝天 \t\t\t( 普通白帽子  |\t\t\t        Rank:369 漏洞数:87        | 互联网上拾破烂的胖子)\t\t \n  6666666666    \n     2015-10-21 15:23 |    \t\tFormat_smile \t\t\t( 普通白帽子  |\t\t\t        Rank:296 漏洞数:112        | ···孰能无过，谁是谁非！)\t\t \n  前排    \n     2015-10-21 15:27 |    \t\t大漠長河 \t\t\t( 实习白帽子  |\t\t\t        Rank:66 漏洞数:10        | ̷̸̨̀͒̏̃ͦ̈́̾( 天龙源景区枫叶正...)\t\t \n  还有这设备     \n     2015-10-21 23:41 |    \t\t草丛基佬 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 哟哟哟哟哟哟)\t\t \n  大神    \n     2015-10-21 23:45 |    \t\t梧桐树下 \t\t\t( 普通白帽子  |\t\t\t        Rank:502 漏洞数:83        | 一大波洞正在过来……)\t\t \n  马克，牛的不要不要的    \n     2015-10-21 23:58 |    \t\t带头大哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:458 漏洞数:146        | |任意邮件伪造| |目录遍历| |任意文件读取|...)\t\t \n  怪只怪我自己，死心塌地爱着你。到最后才明白，爱情有钱就可以！    \n     2015-10-22 16:31 |    \t\tyinian \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:24        | 一花一世界，一叶一菩提。)\t\t \n  请收下我的膝盖    \n     2015-10-22 19:25 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        )\t\t \n  又打雷了    \n     2015-10-26 13:12 |    \t\t路人毛 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:23        | ../)\t\t \n  @Format_smile 活捉    \n     2015-10-29 17:21 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1334 漏洞数:193        | 。)\t\t \n  还有这种高科技     \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}