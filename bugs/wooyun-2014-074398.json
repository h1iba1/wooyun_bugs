{"id": 51456, "wybug_id": "wooyun-2014-074398", "wybug_title": "用友软件协作办公平台通用型任意文件上传getshell", "wybug_corp": "用友软件", "wybug_author": "路人甲", "wybug_date": "2014-09-01 15:24", "wybug_open_date": "2014-11-30 15:26", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-09：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-30：\t细节向公众公开  简要描述： 通杀getshell 详细说明：  上传点：/oaerp/ui/sync/excelUpload.jsp思路：1.绕过javascript限制，上传小马；2.根据小马命名规则getshelljavascript代码：\n<script type=\"text/javascript\">\tfunction upload() {\t\tvar filePath = j$(\"#file\").val(); \t\t\tif (filePath == \"\"){\t\t\tj$(\"#file\").click();\t\t\treturn;\t\t}\t\tvar fileExt = filePath.substring(filePath.lastIndexOf(\".\"));\t\tif (fileExt == \".xls\" || fileExt == \".xlsx\"){//burp即可绕过该限制\t\t\tidForm.action = \"/oaerp/ui/sync/excelImport.jsp?selERPType=\" \t\t\t\t\t\t\t+ j$(\"#selERPType\").val() + \"&selTemplate=\" + j$(\"#selTemplate\").val();\t\t\tj$(\"#btnUpload\").attr(\"disabled\", true);\t\t\tidForm.submit();\t\t} else {\t\t\t\t\talert(\"只能导入excel文件！\"); \t\t}\t}\t\tj$(document).ready(function(){\t\tvar importType = \"<%=importType%>\";\t\tj$(\"#selTemplate\").val(importType);\t\tj$(\"#fs\" + importType).show();\t\t\t});</script>\n   漏洞证明：  #1.http://fsd2014.f3322.org:9090/oaerp/ui/sync/excelUpload.jsp小马：jsp.jsp上传后发现命名规则：上传时间（精确到秒）+jsp.jsp如下：\n\n那我爆破下秒数：\n\n\n\ngetshell：\n\nshell:http://fsd2014.f3322.org:9090/oaerp/upload/20140829221136jsp.jsp 密码：1#2.http://220.168.210.109:9090/oaerp/ui/sync/excelUpload.jspshell:http://220.168.210.109:9090/oaerp/upload/20140829222946jsp.jsp 密码：1#3.http://oa.danzi.com.cn:9090/oaerp/ui/sync/excelUpload.jspshell:http://oa.danzi.com.cn:9090/oaerp/upload/20140829223826jsp.jsp 密码：1   修复方案：  高危漏洞任意文件上传修补方法：服务器端再做一次后缀匹配即可，如果是jsp就kill掉   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-09-06 09:45 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}