{"id": 48139, "wybug_id": "wooyun-2014-084085", "wybug_title": "人人网某重要功能储存型XSS漏洞可劫持其他用户身份（二）", "wybug_corp": "人人网", "wybug_author": "px1624", "wybug_date": "2014-11-21 12:06", "wybug_open_date": "2015-01-05 12:08", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["人人网", "储存"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-05：\t细节向公众公开  简要描述： the more rank，the better high bugs！ 详细说明：  #1 对于http://wooyun.org/bugs/wooyun-2014-083670漏洞的修补不完善导致的。之前这个漏洞是用单引号构造绕过的。然后给出的修补措施就是过滤掉单引号。然后今天去看了下，发现修补了，的确是把单引号过滤干净了。但是开发人员明显属于指哪修哪啊，为了避免漏洞公开后被恶意利用，然后我又不得不过来再提交一次。#2 人人网这个留言板的位置，修补后的过滤机制是这样的。过滤了><\"这次修补后还过滤了'还过滤了&##3 这里先科普个小知识，在浏览器解析代码的时候，html代码是优先于js代码解析的。也就是说在htm标签的属性中，下面的代码可以这么写。<img src=\"xxx\" onclick=\"alert(1);alert(2)\"><img src=\"xxx\" onclick=\"alert(1&#41;&#59;&#97;&#108;&#101;&#114;&#116;&#40;&#50;)\">2个代码是等效的。\n\n#4 这时候你可能还会说那也没事啊，我们已经把&#给过滤了。但是经过测试后，发现这里虽然过滤了&# 但是竟然没有过了&目测是因为url中为了怕把正常功能给干掉了吧那么问题就来了，htm编码除了&#的形式还有&的形式的啊！\n\n#5 好了，现在开始正题，说说这里怎么利用，直接请求的时候改包，把单引号写为&apos; 然后构造语法正确的js代码即可。\n\n看弹窗了吧。\n\n#6 下面证明下可以调用任意外部js文件，这里的利用代码和上次基本一致，利用String.fromCharCode和eval就可以了。这里保留一个完整的图片地址，这样用户点击图片就是直接查看大图，完全没任何异样，但是其实已经中了我们XSS了。\n\n\n\n#7 可以盗取用户cookie，人人网是一站式cookie，没httponly，有了cookie啥都可以干了！\n\n   漏洞证明：  看上面。   修复方案：  1 不能指哪修哪啊，要从本质上思考这个点的漏洞的产生原因。2 建议修补措施：把&过滤为&amp; 这种修补措施，就是专门防御htm编码绕过的这种XSS的。3 再来个年费vip把，为了更好的挖掘人人网的漏洞，有几个个功能是需要vip7才能测试，我现在vip6了，不过vip快到期了。   版权声明：转载请注明来源 px1624@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2014-11-21 13:10 厂商回复： 谢了，当时确实只过滤实体编码&#39;，谢谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-21 13:30 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  。。额，rank变少了，本来还想继续挖挖日志呢，算了不挖了！    \n     2014-11-21 13:41 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  庞总，xss怎么才能上首页？    \n     2014-11-21 13:46 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  求带.......    \n     2014-11-21 13:50 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @大亮 不知道，估计是大公司能直接盗取cookie登录重要功能这种吧。比如你找个空间日志的，肯定就首页了    \n     2014-12-11 14:32 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  庞总也写教程了，学习    \n     2014-12-11 14:40 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @小川 。。。我漏洞内容一般都比较详细吧    \n     2015-01-05 16:49 |    \t\ttodaro \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:12        | 完结。)\t\t \n  我在想，先js编码，再html编码，是不是就能防止这个xss的产生了?求姿势打脸    \n     2015-01-05 17:25 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @todaro 直接把把&过滤为&amp;就可以了    \n     2015-01-05 19:46 |    \t\ttodaro \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:12        | 完结。)\t\t \n  @px1624 恩。学习了。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}