{"id": 41957, "wybug_id": "wooyun-2014-087202", "wybug_title": "iWebShop开源电子商务系统SQL注入漏洞", "wybug_corp": "济南爱程网络科技有限公司", "wybug_author": "路人甲", "wybug_date": "2014-12-16 17:20", "wybug_open_date": "2015-03-16 17:22", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-16：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-03-16：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： iWebShop开源电子商务系统最新版2014-11-18存在SQL注入漏洞. 详细说明：  首先，这个洞与我在360补天提交的不一样。需要登陆后台，漏洞在iwebshop\\controllers\\market.php页面，$id参数未过滤\nfunction ticket_status()\t{\t\t$status    = IReq::get('status');\t\t$id        = IReq::get('id');\t\t$ticket_id = IReq::get('ticket_id');\t\tif(!empty($id) && $status != null && $ticket_id != null)\t\t{\t\t\t$ticketObj = new IModel('prop');\t\t\tif(is_array($id))\t\t\t{\t\t\t\tforeach($id as $val)\t\t\t\t{\t\t\t\t\t$where = 'id = '.$val;\t\t\t\t\t$ticketRow = $ticketObj->getObj($where,$status);\t\t\t\t\tif($ticketRow[$status]==1)\t\t\t\t\t{\t\t\t\t\t\t$ticketObj->setData(array($status => 0));\t\t\t\t\t}\t\t\t\t\telse\t\t\t\t\t{\t\t\t\t\t\t$ticketObj->setData(array($status => 1));\t\t\t\t\t}\t\t\t\t\t$ticketObj->update($where);\t\t\t\t}\t\t\t}\t\t\telse\t\t\t{\t\t\t\t$where = 'id = '.$id;\t\t\t\t$ticketRow = $ticketObj->getObj($where,$status);\t\t\t\tif($ticketRow[$status]==1)\t\t\t\t{\t\t\t\t\t$ticketObj->setData(array($status => 0));\t\t\t\t}\t\t\t\telse\t\t\t\t{\t\t\t\t\t$ticketObj->setData(array($status => 1));\t\t\t\t}\t\t\t\t$ticketObj->update($where);\t\t\t}\t\t\t$this->redirect('ticket_more_list/ticket_id/'.$ticket_id);\t\t}\t\telse\t\t{\t\t\t$this->ticket_id = $ticket_id;\t\t\t$this->redirect('ticket_more_list',false);\t\t\tUtil::showMessage('请选择要修改的id值');\t\t}\t}\n看下调用的IReq::get('id')req_class.php\npublic static function get($key, $type=false)\t{\t\t//默认方式\t\tif($type==false)\t\t{\t\t\tif(isset($_GET[$key])) return $_GET[$key];\t\t\telse if(isset($_POST[$key])) return $_POST[$key];\t\t\telse return null;\t\t}\t\t//get方式\t\telse if($type=='get' && isset($_GET[$key]))\t\t\treturn $_GET[$key];\t\t//post方式\t\telse if($type=='post' && isset($_POST[$key]))\t\t\treturn $_POST[$key];\t\t//无匹配\t\telse\t\t\treturn null;\t}\n然后带入model_class.php的function update()\npublic function update($where,$except=array())\t{\t\t$except = is_array($except) ? $except : array($except);\t\t//获取更新数据\t\t$tableObj  = $this->tableData;\t\t$updateStr = '';\t\t$where     = (strtolower($where) == 'all') ? '' : ' WHERE '.$where;\t\tforeach($tableObj as $key => $val)\t\t{\t\t\tif($updateStr != '') $updateStr.=' , ';\t\t\tif(!in_array($key,$except))\t\t\t\t$updateStr.= '`'.$key.'` = \\''.$val.'\\'';\t\t\telse\t\t\t\t$updateStr.= '`'.$key.'` = '.$val;\t\t}\t\t$sql = 'UPDATE '.$this->tableName.' SET '.$updateStr.$where;\t\treturn $this->db->query($sql);\t}\n   漏洞证明：  最后看下提交的数据与结果，需要cookie\n\n\n\n   修复方案：  你们懂。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2015-04-07 17:47 |    \t\tm-33 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:4        | 想要联系我？)\t\t \n  这个奖金怎么不发给我@乌云    \n     2015-04-07 17:48 |    \t\tm-33 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:4        | 想要联系我？)\t\t \n  @乌云     \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}