{"id": 9071, "wybug_id": "wooyun-2013-035186", "wybug_title": "Discuz! 后台第三方插件上传任意后缀文件拿shell（某插件导致）", "wybug_corp": "Discuz!", "wybug_author": "江南的鱼", "wybug_date": "2013-08-25 17:19", "wybug_open_date": "2013-10-09 17:20", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "中", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-09-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-09-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-09-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-10-09：\t细节向公众公开  简要描述： Discuz!利用插件拿Discuz!论坛shell的文章：http://zone.wooyun.org/content/5275拿shell，我在这篇文章里面用到的插件是zend加密的，可能有系统不支持。今天谈的这个利用插件拿shell，是未加密的插件，基本都支持吧，不挑版本系统。 另外有小伙伴说，安装插件需要 安全密码，确实有的论坛需要安全密码。绕过安全密码第一版：http://www.wooyun.org/bugs/wooyun-2013-032644  我已经提交给官方了，所以失效了。但是我后续还会上 绕过安全密码第二版。 详细说明：  问题插件出在：[MZG]点广告赚积分 1.0  http://addon.discuz.com/?@mzg_advertise.plugin过程如下：1.先搜索 “MZG” 找到 点广告赚积分。  \n\n2. 安装插件，安装GBK还是UFT8随你系统编码选择。安装好插件后，选择  “添加广告”。\n\n3. 添加广告里面的 LOGO 文件上传，选本地上传，这里面未限制文件后缀，可以上传任意后缀名文件。\n\n4. 查看添加的广告，看到了吧？ \n\n5. 看下shell \n\n分析下代码：\n\n未对文件后缀名做任何判断，导致上传任意文件，导致出现代码执行.加上 过安全密码装插件第二版，完美后台拿shell！   漏洞证明：  \nif (is_uploaded_file($_FILES['up_pic']['tmp_name']) and !$_FILES['up_pic']['error']) {\t\t\t     $picarr = explode(\".\",$_FILES['up_pic']['name']);                 $newpic = $pic?$pic:'source/plugin/mzg_advertise/logo/'.$_G['timestamp'].'.'.$picarr[count($picarr)-1];\t\t\t\t\tif (move_uploaded_file($_FILES['up_pic']['tmp_name'],$newpic)) {\t\t\t\t\t\t\t$pic = $newpic;\t\t\t\t\t} else {\t\t\t\t\t\t\tcpmsg(\"图片上传错误\", $_POST['resturl']);\t\t\t\t\t}\t\t\t}\n   修复方案：  下架插件   版权声明：转载请注明来源 江南的鱼@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-08-26 09:57 厂商回复： 感谢您的支持。我们会尽快给于修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-10-29 14:34 |    \t\tStream \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 低头要有勇气，抬头要有底气!)\t\t \n  下架了，MZG    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}