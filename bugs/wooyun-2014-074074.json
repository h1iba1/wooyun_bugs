{"id": 51567, "wybug_id": "wooyun-2014-074074", "wybug_title": "YiDacms 最新版重置任意用户账户二及其他越权操作", "wybug_corp": "yidacms.com", "wybug_author": "xfkxfk", "wybug_date": "2014-08-27 17:07", "wybug_open_date": "2014-11-25 17:08", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "越权操作", "源码审计"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-30：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-25：\t细节向公众公开  简要描述： YiDacms 最新版重置任意用户账户，及其他越权操作 详细说明：  易达CMS 企业建站系统当前最新版本是：YidaCms X3.2（20140718）版之前发过一次重置任意用户密码的漏洞，但是只能修改成固定的密码，要是修改成任意密码的话，比较麻烦，需要md5明文密码后取10位作为信息密码，较麻烦。这里我们直接输入任意明文密码，即可修改来看看源代码：文件/Yidacms/user/user.asp\nif request(\"yidacms\")=\"password\" Then\tset rs=server.createobject(\"adodb.recordset\")\tuser_id1 = cint(request(\"id\"))\tsql=\"select * from shuaiweb_user WHERE id= \"&user_id1&\"\"\trs.open sql,dbok,1,1\tif Request.Form(\"shuaiweb_userpass\")=\"\" then \t\tresponse.write \"<script language=javascript> alert('密码不能为空！');history.go(-1);</script>\"\t\tresponse.end\tend if\tif Request.Form(\"shuaiweb_userpass\")<>Request.Form(\"shuaiweb_userpass2\") then \t\tresponse.write \"<script language=javascript> alert('两次输入的密码不一样！');history.go(-1);</script>\"\t\tresponse.end\tend if\tset rs=server.createobject(\"adodb.recordset\")\tuser_id2 = cint(request(\"id\"))\tsql=\"select * from shuaiweb_user WHERE id= \"&user_id2&\"\"\trs.open sql,dbok,1,3\t\trs(\"shuaiweb_useremail\")=filter_Str(trim(request.form(\"shuaiweb_useremail\")))\t\trs(\"shuaiweb_userpass\")=filter_Str(left(MD5(trim(request.form(\"shuaiweb_userpass\"))),10))\t\trs(\"shuaiweb_username\")=filter_Str(trim(request.form(\"shuaiweb_username\")))\t\trs(\"shuaiweb_usertel\")=filter_Str(trim(request.form(\"shuaiweb_usertel\")))\t\trs(\"shuaiweb_userqq\")=filter_Str(trim(request.form(\"shuaiweb_userqq\")))\t\trs(\"shuaiweb_usermsn\")=filter_Str(trim(request.form(\"shuaiweb_usermsn\")))\t\trs(\"shuaiweb_useraddress\")=filter_Str(trim(request.form(\"shuaiweb_useraddress\")))\t\trs(\"shuaiweb_userportrait\")=filter_Str(trim(request.form(\"shuaiweb_userportrait\")))\t\trs(\"shuaiweb_usernote\")=filter_Str(trim(request.form(\"shuaiweb_usernote\")))\t\trs(\"shuaiweb_usernumber\")=filter_Str(trim(request.form(\"shuaiweb_usernumber\")))\trs.update\trs.close\tset rs=nothing\tsession(\"shuaiweb_useremail\")=request.Form(\"shuaiweb_useremail\")\tresponse.write \"<script language=javascript> alert('修改成功！');location.replace('user_pass.asp');</script>\"\tEnd If\n这里按照获取的id，直接update，更新用户信息了信息的密码直接获取，也没有判断旧密码，直接修改对应id的密码以及其他信息。这里同样，遍历一遍id，即可修改全部用户密码。其他越权操作：\nif request(\"yidacms\")=\"buydel\" Then\tset rs=server.createobject(\"adodb.recordset\")\tuser_id3 = cint(request(\"id\"))\tsql=\"select * from shuaiweb_buy WHERE id= \"&user_id3&\"\"\trs.open sql,dbok,1,1\tif rs(\"shuaiweb_reading\") = 1 then\t\t\tresponse.write \"<script language=javascript> alert('已发货的订单不可以删除!');history.go(-1);</script>\"\t\t\tresponse.end\t\t\t   else\tif(cint(request(\"id\")) <> \"\") then id = cint(request(\"id\"))\tset rs = server.createobject(\"adodb.recordset\")\tuser_id4 = cint(request(\"id\"))\tsql=\"DELETE * FROM shuaiweb_buy WHERE id= \"&user_id4&\"\"\trs.open sql,dbok,3,2\trs.update\trs.close\tset rs=nothing\tresponse.write \"<script language=javascript> alert('成功删除！');location.replace('user_buy.asp');</script>\"\tEnd If\tend if\n这列也是直接获取id，然后删除id对应的订单导致越权删除任意用户订单信息了。   漏洞证明：  先来看看用户id=5的初始信息，登陆密码为222222\n\n然后登陆攻击者账户，修改id=5的用户的信息及密码：\n\n最后登陆id=5的用户时，用户名和密码已经被修改了\n\n另一处修改订单同样，只要发送删除订单请求，修改id即可删除此id的订单了。   修复方案：  修改删除用户信息是，判断用户属性   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-08-27 17:47 厂商回复： 以经在新版本中修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}