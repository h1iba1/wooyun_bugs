{"id": 62651, "wybug_id": "wooyun-2013-034858", "wybug_title": "emlog验证码重用漏洞（密码爆破等影响）", "wybug_corp": "emlog.net", "wybug_author": "phith0n", "wybug_date": "2013-08-21 08:50", "wybug_open_date": "2013-11-19 08:50", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "白盒测试", "验证码重用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-24：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-10-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-10-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-11-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-11-19：\t细节向公众公开  简要描述： emlog验证码重用。可无视验证码刷评论，无视验证码暴力破解后台。 详细说明：  看了两天emlog源码也没白看。。。在发表评论的时候，服务端验证数据代码如下：\nif($Comment_Model->isLogCanComment($blogId) === false) {\t\t\temMsg('评论失败：该文章已关闭评论');\t\t} elseif ($Comment_Model->isCommentExist($blogId, $name, $content) === true) {\t\t\temMsg('评论失败：已存在相同内容评论');\t\t} elseif ($Comment_Model->isCommentTooFast() === true) {\t\t\temMsg('评论失败：您提交评论的速度太快了，请稍后再发表评论');\t\t} elseif (empty($name)) {\t\t\temMsg('评论失败：请填写姓名');\t\t} elseif (strlen($name) > 20) {\t\t\temMsg('评论失败：姓名不符合规范');\t\t} elseif ($mail != '' && !checkMail($mail)) {\t\t\temMsg('评论失败：邮件地址不符合规范');\t\t} elseif (ISLOGIN == false && $Comment_Model->isNameAndMailValid($name, $mail) === false) {\t\t\temMsg('评论失败：禁止使用管理员昵称或邮箱评论');\t\t} elseif (!empty($url) && preg_match(\"/^(http|https)\\:\\/\\/[^<>'\\\"]*$/\", $url) == false) {\t\t\temMsg('评论失败：主页地址不符合规范','javascript:history.back(-1);');\t\t} elseif (empty($content)) {\t\t\temMsg('评论失败：请填写评论内容');\t\t} elseif (strlen($content) > 8000) {\t\t\temMsg('评论失败：内容不符合规范');\t\t} elseif (ROLE == 'visitor' && Option::get('comment_needchinese') == 'y' && !preg_match('/[\\x{4e00}-\\x{9fa5}]/iu', $content)) {\t\t\temMsg('评论失败：评论内容需包含中文');\t\t} elseif (ISLOGIN == false && Option::get('comment_code') == 'y' && session_start() && $imgcode != $_SESSION['code']) {\t\t\temMsg('评论失败：验证码错误');\t\t} else {\t\t\t$Comment_Model->addComment($name, $content, $mail, $url, $imgcode, $blogId, $pid);\t\t}\n在检查验证码时，发现验证码不对则提示验证码错误，但检查成功后并没有清除SESSION中的验证码信息，下次只要不再访问生成验证码的脚本，该SESSION则一直有效。导致此后验证码可以重用。在后台登录页面原理相同，均未清除SESSION中的验证码，导致可以暴力破解后台密码。-------------利用方法：  第一次手工输入验证码后提交，burpsuite抓包，然后把服务器返回的包丢弃（以免重新打开需要输入验证码的界面，把验证码刷新掉）。  再就暴力提交数据包就OK了。因为验证码没有刷新,SESSION没有更新，所以验证码不用再次输入。   漏洞证明：  刷评论：  提交评论时候，由于emlog默认限制15秒发一条，所以在burpsuite中设置一下，每间隔大概16秒提交一次。\n\n  等待一段时间后看看效果：\n\n暴力破解后台密码：\n\n   修复方案：  检查验证码成功后清除SESSION   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2013-08-21 11:46 厂商回复： 确认，给暴力破解降低了难度 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}