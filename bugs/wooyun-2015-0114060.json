{"id": 31407, "wybug_id": "wooyun-2015-0114060", "wybug_title": "kppw最新版本 注入两个", "wybug_corp": "keke.com", "wybug_author": "Cheery", "wybug_date": "2015-05-18 10:09", "wybug_open_date": "2015-08-21 10:10", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-23：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-21：\t细节向公众公开  简要描述： 我是来拿wooyun号的，求第一个洞来个高rank! 详细说明：  在 control\\user\\account_report.php 和 control\\user\\account_rights.php中，也就是举报管理处，我们拿第一个来说明一下<插一句话 上面玉林嘎找的6个注入里面(baner和balance)(goodslist和tasklist)结构相同，所以两个都存在一样的漏洞，就会多几个地方的注入了，这个算吗？>\n<?php$page and $intPage = intval($page);$type=strval($type) ? $type : 1;$op = strval($op);$strUrl =\"index.php?do=user&view=account&op=report\";$type and $strUrl .=\"&type=\".intval($type);$intPagesize and $strUrl .=\"&intPagesize=\".intval($intPagesize);$strReportObj and $strUrl .=\"&reportObj=\".strval($strReportObj);$strReportStatus and $strReportStatus .=\"&reportStatus=\".strval($strReportStatus);$arrReportObj = array(    'task' => '任务',\t'work' => '稿件',\t'product' =>'商品');$arrReportStatus = array(          '1' =>'待处理',          '2' =>'处理中',          '3' =>'未成立',          '4' =>'已处理'         );$objReportT = keke_table_class::get_instance('witkey_report');if (isset ( $action )) {\tswitch ($action) {\t\tcase 'mulitDel' :\t\t\tif ($ckb) {\t\t\t\t$objTaskT->del ( 'task_id', $ckb );\t\t\t\tkekezu::show_msg ( '删除成功', $strUrl, NULL, NULL, 'ok' );\t\t\t} else {\t\t\t\tkekezu::show_msg ( '删除失败', NULL, NULL, NULL, 'error' );\t\t\t}\t\t\tbreak;\t\tcase 'delSingle' :\t\t\tif ($objId) {\t\t\t\t$objTaskT->del ( 'task_id', intval($objId) );\t\t\t\tkekezu::show_msg ( '删除成功', $strUrl, NULL, NULL, 'ok' );\t\t\t} else {\t\t\t\tkekezu::show_msg ( '删除失败', NULL, NULL, NULL, 'error' );\t\t\t}\t\t\tbreak;\t}} else {\t$strWhere  = \" 1=1 \";\t$strWhere .= \" and report_type = 2 \";\tif($type == 2){\t   $strWhere .= \" and to_uid = \".$gUid;\t}else{\t   $strWhere .= \" and uid = \".$gUid;\t}\t$intPage = intval ( $intPage ) ? $intPage : 1;\t$intPagesize = intval ( $intPagesize ) ? $intPagesize : 10;\tif(isset($strReportStatus)&&$strReportStatus!=''&&$strReportStatus > -1){\t\t$strWhere .= \" and report_status=\".intval($strReportStatus);\t}else{\t\t$strReportStatus = -1;\t}    if(isset($strReportObj)&&$strReportObj!=''){\t\t$strWhere .= \" and obj= '$strReportObj'\";\t}else{\t\t$strReportObj = ' ';\t}\t$strOrder&&in_array($strOrder, array_keys($arrListOrder)) and $strWhere .= \" order by \".$strOrder.', report_id desc ' or  $strWhere .= \" order by report_id desc\";\t$arrDatas = $objReportT->get_grid($strWhere, $strUrl, $intPage, $intPagesize, null,null,null);\t$arrReportLists = $arrDatas ['data'];\t$intCount = $arrDatas ['count'];\t$strPages = $arrDatas ['pages'];}unset($objReportT);\n可以看见这个地方 $strOrder&&in_array($strOrder, array_keys($arrListOrder)) and $strWhere .= \" order by \".$strOrder.', report_id desc ' or  $strWhere .= \" order by report_id desc\";这个cms采用伪全局，所以我们可以构造$strOrder=1,sleep(20)%23 和 arrListOrder[1,sleep(20)%23] (即$strOder的值与$arrListOrder的键值相等就可以)接下来证明吧   漏洞证明：  我们需要先随便创建一个新号，这个没有什么限制，然后举报一个商品，让查询语句不为空，就可以利用盲注了\n\n\n\n我们看结果 \n\n\n\n成功sleep 0.0   修复方案：  变量初始值定义！   版权声明：转载请注明来源 Cheery@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-08-21 10:10 厂商回复：  漏洞Rank：4  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}