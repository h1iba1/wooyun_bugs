{"id": 12912, "wybug_id": "wooyun-2015-0110039", "wybug_title": "D-Link 网络视频存储设备存在多处远程任意命令执行漏洞", "wybug_corp": "D-Link", "wybug_author": "路人甲", "wybug_date": "2015-04-24 01:38", "wybug_open_date": "2015-07-26 15:00", "wybug_type": "设计不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-30：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-26：\t细节向公众公开  简要描述： 借用一下官方对DNR产品的描述DNR-322L Mydlink双盘位网络影像存储器是一款独立的存储设备，能从多达九台网络摄像机记录视频，并将其存放在专门的硬盘存储设备上，而无需用户打开电脑。DNR-322L经由mydlink授权，可支持通过Web浏览器使用mydlink网站或NVR的Web GUI来进行实时远程监控和回放。用户拥有多种选项来查看和组织屏幕上的摄像机影像，对于具有多个信道的系统，用户可轻松地将所选的摄像机拖放到查看区域。摄像机名称和记录状态会通过屏幕显示。单个摄像机可进行全屏查看，并带有双向音频支持。用户可从界面中控制摇头/倾斜/缩放 (PTZ) 功能，也可以通过直接单击视频来控制这些功能。D-Link该类产品存在多处远程任意命令执行漏洞。 详细说明：  D-Link DNR系列产品在多处cgi中未对访问者的身份进行必要的检验，且对Cookie值过滤不严，导致攻击者不需要身份认证即可直接访问这些cgi，并可构造恶意Cookie来实现远程任意命令执行，做为影像监控及存储设备，危害不可低估。在多处cgi中有以下check_login函数的代码实现：\ncgiCookieString(\"username\", &s, 1024);    sprintf(cmd, \"echo '%s' >/tmp/test\", &s);    system(&cmd);\n可以看出，攻击者只需简单构造一个诸如\nadmin'&&cat /etc/shadow&&echo '\n这样的cookie值，即可执行需要的命令，含有这个cookie处理过程的cgi有folder_tree.cgiaccount_mgr.cgifile_center.cgiwizard_mgr.cgi等，此处不一一例举了。有些cgi的利用需要合适的参数配合，有些则完全不需要。如file_center.cgi需要配合参数?cmd=Webdav_Upload_File或?cmd=Webdav_Del而folder_tree.cgi则完全不需要。D-LINK的DNR系列经测试322L及326受影响，其余型号未测，估计也少不了。可以通过shodan搜索关键字dlink dnr或其它搜索方法来取得样例。   漏洞证明：  \n代码见下面测试代码admin:$1$$lyMuUKj2m.b6Ymp3******:0:0:99999:7:::nobody:pACwI1f******:0:0:99999:7:::squeezecenter:$1$$o7vIitnZu4MHlaR5******:15460:0:99999:7:::root:$1$$qRPK7m23GJusamGp******:14746:0:99999:7:::remote:pa3HFO8******:0:0:99999:7:::remote:pa3HFO8******:0:0:99999:7:::*为打码部分\n   修复方案：  严格身份认证及用户输入过滤。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-04-27 14:59 厂商回复： CNVD确认并复现所述情况，已经由CNVD通过网站公开联系方式（或以往建立的处置渠道）向网站管理单位（软件生产厂商）通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}