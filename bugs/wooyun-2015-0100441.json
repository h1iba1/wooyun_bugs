{"id": 37093, "wybug_id": "wooyun-2015-0100441", "wybug_title": "精讯cms sql注入(直接提升为管理员)", "wybug_corp": "jxcms.com", "wybug_author": "牛肉包子", "wybug_date": "2015-03-10 16:11", "wybug_open_date": "2015-06-08 16:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-08：\t细节向公众公开  简要描述： 用户量挺大的一个cms 详细说明：  看到Lib\\Action\\MemberAction.class.php\npublic function profile() {\t\t$this -> obj -> isLogin() or $this -> showMsg(L('LOGIN_FIRST'), Url :: getUrl('member', 'login'));\t\tif ($this -> isSubmit) {\t\t\tif ($this -> obj -> edit()) {\t\t\t\t$this -> showMsg(L('OPERATE_SUCCESS'), $this -> referer);\t\t\t} else $this -> showMsg($this -> obj -> error);\t\t}\t\t$member = $this -> obj -> find(get_cookie('userid'));\t\t$tmp = explode('-', $member['birthday']);\t\t$birthday = array('year' => intval($tmp[0]), 'month' => intval($tmp[1]), 'day' => intval($tmp[2]));\t\t$birthday['timestamp'] = $member['birthday'] != '0000-00-00' ? Func :: timeStamp($member['birthday']) : '';\t\t$this -> assign('birthday', $birthday);\t\t$this -> assign('member', $member);\t\t$this -> assign('title', L('USER_PROFILE'));\t\t$this -> display('member_profile');\t}\n然后跟进edit\npublic function edit() {\t\t$info = R('info', 'post');\t\t$info['userid'] = intval($info['userid']);\t\tif (!$info['userid']) {\t\t\t$this -> error = $this -> L['NOPARAM'];\t\t\treturn false;\t\t}\t\t$data = $this -> find($info['userid']);\t\tif (empty($data)) {\t\t\t$this -> error = $this -> L['USER_IS_NOT_EXIST'];\t\t\treturn false;\t\t}\t\t$info['userid'] == get_cookie('userid') or show_error($this -> L['NO_PERMISSION']);\t\t$info['birthday'] = R('birthyear') . '-' . R('birthmonth') . '-' . R('birthday');\t\treturn $this -> create($info) -> update();\t}\n意思就是将POST进来的info数组插入数据库，但是没判断字段名，导致我们可以自己添加，然后提升到管理员权限。首先注册一个普通用户\n\n在数据库里面可以看到管理员和普通会员在一个表里面，就只有一个groupid字段来判断权限然后进入修改个人资料页面\n\n然后登陆后台\n\n成功登陆\n\n搜索案例\n\n然后再提供5个互联网实际案例,以下网址账号为wooyun，密码为wooyun123http://test.tzks.cn/admin.php?a=defaults\n\nhttp://qiushibang.com/admin.php?a=defaults\n\nhttp://www.gsdedu.com/admin.php?a=defaults\n\nhttp://www.cnekw.com/saes/admin.php?a=defaults\n\nhttp://www.jiuyehangbiao.com/admin.php?a=defaults\n\n   漏洞证明：  http://test.tzks.cn/admin.php?a=defaults\n\nhttp://qiushibang.com/admin.php?a=defaults\n\nhttp://www.gsdedu.com/admin.php?a=defaults\n\nhttp://www.cnekw.com/saes/admin.php?a=defaults\n\nhttp://www.jiuyehangbiao.com/admin.php?a=defaults\n\n   修复方案：  判断一下吧   版权声明：转载请注明来源 牛肉包子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2015-03-10 16:39 厂商回复： 数组方式简单，容易扩展，缺陷是可以另外添加字段，我们会增加安全字段的过滤，感觉发现BUG的作者！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}