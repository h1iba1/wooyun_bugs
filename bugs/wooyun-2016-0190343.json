{"id": 88157, "wybug_id": "wooyun-2016-0190343", "wybug_title": "中兴某企业业务网关系统设备任意文件删除&amp;任意命令执行(无需登录)                                      ", "wybug_corp": "中兴通讯股份有限公司", "wybug_author": "YY-2012", "wybug_date": "2016-03-29 12:22", "wybug_open_date": "2016-06-27 15:10", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意命令执行"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-01：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-05-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-27：\t细节向公众公开  简要描述： rt 详细说明：  任意文件删除/modules/system/sys_restore_local.be.php：\n<?php//require_once('../../validate.php');//add by quentin at 2009-03-19 - modify quentin 2009-05-13require_once(\"../../mainfile.php\");$res=new res_ajax();$action=isset($_POST['action'])?$_POST['action']:(isset($_GET['action'])?$_GET['action']:null);if(is_null($action)) {\t$res->set_resultcode('-1');\t$res->set_resultstr($lang['hackat']);\t$res->output();\texit;}switch($action) {\tcase 'backup':\t\tsys_backup($_POST);\t\tbreak;\tcase 'restore':\t\tsys_restore($_POST);\t    break;\tcase 'delete':\t\tcfg_delete($_POST);\t    break;\tcase 'initconfig':\t    sys_initconfig($_POST);\t    break;\tcase 'getUSB':\t    sys_getusb($_POST);\t    break;}$res->output();exit;function sys_backup($post) {\tglobal $db;\tglobal $res;\tglobal $lang;    $filename=$post['filename'];    if($post['rad_dir']=='fs') {\t\t$backup_dir=$post['dir_fs'];\t} else {\t\t$backup_dir=$post['dir_u'];\t}    $filename_len = strlen($filename);    if($filename_len == 0 || $filename_len > 20 || !preg_match(\"/^[0-9a-zA-Z_]*$/\" , $filename)) {\t\t$res->set_resultcode('-2');\t\t$res->set_resultstr($lang['err_filepath']);\t\treturn;\t}\t/*$count=$db->countof('fms_task_info', \"execute_status<>'3' and task_name_id='4'\");\tif($count>0) {\t\t$res->set_resultcode('-1');\t    $res->set_resultstr($lang['tasking']);\t\treturn;\t}*/\t$cc=$db->countof('fms_local_backup_process', \"backup_dir='\".$backup_dir.\"' and filename='\".$filename.\".cfg'\");    if($cc>0) {\t\t$res->set_resultcode('-1');\t    $res->set_resultstr($lang['dupfiles']);\t\treturn;\t}\t/*$sqlb=\"insert into fms_task_info set task_name_id='4', task_type_id='1', priority_id='1', start_time='\".mktime().\"', execute_status='1', operator='\".$_SESSION['user'].\"'\";    if(!$db->execute($sqlb)) {\t\t$db->execute('rollback');\t\t$res->set_resultcode('-4');\t\t$res->set_resultstr($lang['dberr']);\t\treturn;\t}*/    //$id=mysql_insert_id();    $id = 0;\t$sql=\"insert into fms_local_backup_process set task_serial='\".$id.\"', backup_dir='\".$backup_dir.\"', filename='\".$filename.\".cfg', system_data='1', log_data='1', process='0', task_status='0'\";\t$db->execute('start transaction');\tif(!$db->execute($sql)) {\t\t$db->execute('rollback');\t\t$res->set_resultcode('-4');\t\t$res->set_resultstr($lang['dberr']);\t\treturn;\t}\t$id=mysql_insert_id();\t$db->execute(\"commit\");\t$res->set_resultcode('0');\t$res->set_resultstr($id);\t$resa = service_action('Backup_Config');}function sys_restore($post) {\tglobal $db;\tglobal $res;\tglobal $lang;\t$count=$db->countof('fms_task_info', \"execute_status<>'3' and task_name_id='5'\");\tif($count>0) {\t\t$res->set_resultcode('-1');\t    $res->set_resultstr($lang['tasking']);\t\treturn;\t}    /*$sqlb=\"insert into fms_task_info set task_name_id='5', task_type_id='1', priority_id='1', start_time='\".mktime().\"', execute_status='1', operator='\".$_SESSION['user'].\"'\";\tif(!$db->execute($sqlb)) {\t\t$db->execute('rollback');\t\t$res->set_resultcode('-4');\t\t$res->set_resultstr($lang['dberr']);\t\treturn;\t}\t$id=mysql_insert_id();*/\t$id = 0;    $sqla=array();\t$sqla[]=\"insert into fms_backup_special_file_process set task_serial='\".$id.\"', filename='\".$post['hidd_file'].\"', process='0', task_status='0', operate_mode='0'\";\t//$sqla[]=\"update wms_restore_filelist set resume_id='\".$id.\"' where id='\".$post['hidd_id'].\"'\";\t$db->execute('start transaction');\tforeach($sqla as $sqlstr) {\t\tif(!$db->execute($sqlstr)) {\t\t\t$db->execute('rollback');\t\t\t$res->set_resultcode('-4');\t\t\t$res->set_resultstr($lang['dberr']);\t\t\treturn;\t\t}\t\t}\t$id=mysql_insert_id();\t$db->execute(\"commit\");\t$res->set_resultcode('0');\t$res->set_resultstr($id);\t$resa = service_action('Restore_Config');}function cfg_delete($post) {\tglobal $res;\tglobal $lang;\tglobal $db;\t$filepath=str_replace('//', '/', $post['hid_name']);\tif(!@unlink($filepath)) {\t\t$res->set_resultcode('-4');\t\t$res->set_resultstr($lang['err_delfile']);\t\treturn;\t}\t$sql=\"delete from wms_restore_filelist where id='\".$post['hid_id'].\"'\";\t$db->execute('start transaction');\tif(!$db->execute($sql)) {\t\t$db->execute('rollback');\t\t$res->set_resultcode('-4');\t\t$res->set_resultstr($lang['dberr']);\t\treturn;\t}\t$db->execute(\"commit\");\t$res->set_resultcode('0');\t$res->set_resultstr($lang['success']);}function sys_initconfig($post) {\tglobal $res;\t$resa=service_action('Restore_FactoryConfig');\t$res->set_result($resa[0], $resa[1]);}function sys_getusb($post) {\tglobal $res;\t$resa=service_action('reload_usb_mount');\t$res->set_result($resa[0], $resa[1]);}?>\n\n\n任意命令/modules/system/local_rollback.php\n<?phprequire_once('../../validate.php');require_once(\"../../mainfile.php\");$sel_dir = $_GET['sel_dir'];$sql = \"select * from lcm_globals where  variable='MODULE_VER' and category='system'\";$rs = $db->query($sql);while ($data = $db->fetchNextObject($rs)){    $up[$data->variable] = $data->value;}$smarty->assign('ver_system', $up['MODULE_VER']);$command = '/usr/upgrade/'.$sel_dir.'/rollback.sh '. $sel_dir .' &';$actions=array();$actions[]=\"Action: action_rollback\";$actions[]=\"Command: \".$command;//Add/Mod/Del$result = action_array_cms($actions);echo $command;exit;?>\n\n\n   漏洞证明：  \n\n\n\n\n\n案例参考http://**.**.**.**/bugs/wooyun-2016-0189550：\n**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/\n   修复方案：  你们懂的。   版权声明：转载请注明来源 YY-2012@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2016-03-29 15:09 厂商回复： 感谢关注～ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}