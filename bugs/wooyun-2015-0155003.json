{"id": 80859, "wybug_id": "wooyun-2015-0155003", "wybug_title": "360手机浏览器wormhole漏洞可导致任意命令执行", "wybug_corp": "奇虎360", "wybug_author": "ilovewuyun", "wybug_date": "2015-11-23 11:16", "wybug_open_date": "2015-12-17 14:48", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-26：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： 360手机浏览器（包括最新版）存在远程控制漏洞。任何来源的攻击者均可远程大规模控制受害者手机并执行任意命令。命令执行可以享有360手机浏览器的所有权限（拍照、录像、录音等），如果360手机浏览器有root，问题会更严重。 详细说明：  此分析基于360手机浏览器的最新版：\n\nMD5= 675d2679790bf16476840f61314bd3cbPackage Name: com.qihoo.browser点开运行后发现静默监听端口6587，且远程可连，也没有对连接来源做任何限制：\n\n从/proc/net/tcp可以看出app uid是10092，且从netstat的返回结果看，是进程8235在监听该端口，通过ps可以找到该进程及其命令：\n\n 找到该文件（um.3）发现，这是个ELF文件。通过逆向证实它的确打开了6587端口并监听。进一步的检查发现，它通过http request接收两个参数，t和u。t的取值可以是0或1。当t为0时，功能为查询app版本信息，如下图所示（**.**.**.**为受害者IP，下文同）：\n\n当t为1时，功能为打开u参数所指定的任意URL，如下图所示：\n\n进一步逆向发现打开URL对应如下代码：\n\n 可以看出实际上是调用com.google.android.apps.chrome.Main这个activity来打开URL ，并且会尝试用root权限打开。虽然最新版里并不存在这个activity，所以不能完成打开URL操作，其他渠道发布的版本以及历史版本中是否有该acitivity仍待确认。这里要强调的是，不管360手机浏览器的各个版本是否实现了com.google.android.apps.chrome.Main来打开URL，这部分逻辑是可以被任意来源的攻击者远程exploit执行任意命令的。原因是该逻辑并没有对http request来的内容做任何检查就送进了system()执行，攻击者可以将那条am start命令截断（例如用分号）然后插入自己想执行的命令。以360强大的安全能力，我们不多加猜测他们这个用法是漏洞还是后门。例如，攻击者可以调用:\ncurl -X GET 'http://**.**.**.**:6587/t=1&u=**.**.**.**;echo haha > /sdcard/xixi;'\n执行该命令后可以看到sdcard里出现了xixi文件，内容是haha。所以，攻击者能 用360手机浏览器的权限大规模控制受害者手机。360手机助手的部分权限列举如下：android.permission.ACCESS_FINE_LOCATIONandroid.permission.CAMERAandroid.permission.RECORD_AUDIOandroid.permission.GET_ACCOUNTSandroid.permission.MANAGE_ACCOUNTSandroid.permission.USE_CREDENTIALSandroid.permission.SEND_SMSandroid.permission.RECEIVE_SMSandroid.permission.WRITE_SETTINGScom.android.browser.permission.READ_HISTORY_BOOKMARKScom.android.launcher.permission.WRITE_SETTINGS基本上控制受害者手机录像、拍照、录音、窃取隐私、发起高级钓鱼攻击等都不成问题。而如果360手机浏览器拥有root权限，情况将会更严重。   漏洞证明：  假设要执行的攻击命令为CMD，受害者IP为**.**.**.**，则在运行360手机浏览器后执行如下命令即可。其中**.**.**.**并不重要，可以换成任何url。\ncurl -X GET 'http://**.**.**.**:6587/t=1&u=**.**.**.**;CMD;'\n   修复方案：     版权声明：转载请注明来源 ilovewuyun@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-11-23 14:13 厂商回复： 非常感谢白帽子对360产品安全的帮助。我们已紧急修复此漏洞，并会全网推送升级，提示用户尽快更新版本。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-11-23 11:20 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:765 漏洞数:83        | 铁甲依然在)\t\t \n  这个屌....上周已经监控到这个 cmd...去忙别的就被洞主先发..囧    \n     2015-11-23 11:30 |    \t\tNicky \t\t\t( 普通白帽子  |\t\t\t        Rank:493 漏洞数:71        | http://www.droidsec.cn 安卓安全中文站)\t\t \n  厉害啊 我洞主在这：http://blog.trustlook.com/2015/11/21/请别揣着明白装糊涂-关于360手机助手回应虫洞/    \n     2015-11-23 11:36 |    \t\trayh4c \t\t\t( 普通白帽子  |\t\t\t        Rank:240 漏洞数:23        )\t\t \n  @瘦蛟舞 我已经让组里的伙子跟进中    \n     2015-11-23 11:36 |    \t\trayh4c \t\t\t( 普通白帽子  |\t\t\t        Rank:240 漏洞数:23        )\t\t \n  @Nicky 腾讯的吧。呵呵    \n     2015-11-23 12:33 |    \t\t青空 \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:1        | 向各位学习、致敬。)\t\t \n  抢个位置。。。。    \n     2015-11-23 12:44 |    \t\tphith0n  \t\t\t( 普通白帽子  |\t\t\t        Rank:751 漏洞数:118        | 一个想当文人的黑客~)\t\t \n  前排围观撕逼    \n     2015-11-23 12:46 |    \t\thqdvista \t\t\t( 普通白帽子  |\t\t\t        Rank:154 漏洞数:31        | N/A)\t\t \n  前排围观撕逼    \n     2015-11-23 12:51 |    \t\tqingxp9 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:4        | ~~~)\t\t \n  占位    \n     2015-11-23 12:54 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:252 漏洞数:43        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  前排围观撕逼    \n     2015-11-23 13:03 |    \t\t青空 \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:1        | 向各位学习、致敬。)\t\t \n  真强悍 请别揣着明白装糊涂 — 关于360手机助手回应虫洞漏洞“Dimension Door（异次元之门）”的回应 http://blog.trustlook.com/2015/11/21/    \n     2015-11-23 13:33 |    \t\t大师兄 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:8        | 每日必关注乌云)\t\t \n  围观撕开    \n     2015-11-23 13:55 |    \t\t小荷才露尖尖角 \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:14        | less is more)\t\t \n  凑个热闹    \n     2015-11-23 14:02 |    \t\tPiaCa \t\t\t( 普通白帽子  |\t\t\t        Rank:137 漏洞数:11        | 简单点!啪......嚓~~)\t\t \n  这个漏洞略……    \n     2015-11-23 15:14 |    \t\thecate \t\t\t( 普通白帽子  |\t\t\t        Rank:754 漏洞数:116        | ®高级安全工程师 | WooYun认证√)\t\t \n  非常感谢白帽子对360产品后门的帮助。我们已紧急隐藏该后门，并会全网推送种马，提示用户尽快更新版本。    \n     2015-11-23 15:46 |    \t\tWatermelon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:9        | Watermelon)\t\t \n  哈哈 欢迎推送    \n     2015-11-24 11:07 |    \t\tlgarc0ne \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:1        | 新入行安全狗)\t\t \n  围观    \n     2015-11-25 14:34 |    \t\tamethyst \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | surprise！)\t\t \n  http://v.qq.com/page/v/o/y/v0174xaijoy.html PoC视频亮点自寻（静默卸载、静默安装，大家发挥下想象力，嗯）    \n     2015-11-25 15:26 |    \t\tamethyst \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | surprise！)\t\t \n  @amethyst 旧的url失效了，新的点点点这儿:http://v.qq.com/page/i/3/8/i0174pddb38.html    \n     2015-11-26 10:53 |    \t\t青空 \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:1        | 向各位学习、致敬。)\t\t \n  看这里http://blog.trustlook.com/    \n     2015-11-30 11:23 |    \t\tWinck \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:3        | 华人安全网 www.systemsec.cn 719811394)\t\t \n  前排围观 跟我一起吃饺子    \n     2015-12-11 12:28 |    \t\tamethyst \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | surprise！)\t\t \n  yo!yo!看这里：http://blog.trustlook.com/2015/12/10/360_browser_wormhole/     \n     2016-01-27 22:01 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:285 漏洞数:54        | little red pig!)\t\t \n  赞一个    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}