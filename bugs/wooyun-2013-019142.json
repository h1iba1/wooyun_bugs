{"id": 65093, "wybug_id": "wooyun-2013-019142", "wybug_title": "推女郎某处设计不当可造成用户注册信息泄露、修改，网站挂马等严重危害", "wybug_corp": "tuigirl.com", "wybug_author": "txcbg", "wybug_date": "2013-02-25 17:21", "wybug_open_date": "2013-04-11 17:22", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露", "存储型", "挂马", "越权访问"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-02-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-03-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-03-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-03-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-03-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-04-11：\t细节向公众公开  简要描述： 推女郎某处设计不当可造成用户注册信息泄露、修改，网站挂马等严重危害。 详细说明：      两个危害不是怎么严重的漏洞一组合，危害性立马严重了起来。    推女郎对用户信息验证不严，导致可以越权修改任意用户的“所在地区”信息。本来这不算什么严重的漏洞，但“所在地区”输入的地方存在存储型XSS漏洞，用户登录后的页面中会显示“所在地区”信息，因此只要用户登录就会受到XSS漏洞的攻击。在所有注册用户的“所在地区”处插入XSS利用代码，就可以获得所有注册用户的Cookie信息，而注册用户的用户名（邮箱）在Cookie信息中有出现，所以可以获得所有注册用户的用户名了。    另外，如果把XSS利用代码换成挂马代码，一旦用户的电脑没有打相应的补丁，电脑就会被挂马者完全控制，造成用户信息泄露等严重后果。    看到网站有付费订阅功能，利用越权访问漏洞，非付费用户可能看到付费用户订阅的内容从而不付费订阅了，可能给贵公司造成经济损失。   漏洞证明：      我在推女郎网站http://www.tuigirl.com/注册了两个用户yixiu@gmail.com，jiqimao@gmail.com。注册登录后通过查看Cookie信息发现了一个变量mid，其值是一个数字，经过测试知道通过mid可以区别用户。yixiu@gmail.com这个用户Cookie信息中的mid的值为8317，把“所在地区”信息修改为123；jiqimao@gmail.com这个用户Cookie信息中的mid的值为8318，把“所在地区”信息修改为456。如图1。\n\n在Chrome中登录的是jiqimao@gmail.com这个用户，mid为8318，用Edit This Cookie插件修改mid为8317，也就是用户yixiu@gmail.com对应的mid，如图2。\n\n修改好后刷新一下，“所在地区”显示为123，也就是yixiu@gmail.com这个用户的“所在地区”信息，说明可以越权查看其它用户的信息。是否可以修改呢，来测试下，把“所在地区”由123修改为wooyun，如图3。\n\n刷新下在Mozilla Firefox中登录的yixiu@gmail.com这个用户的页面，“所在地区”信息也由原来的123变成了我们在Chrome中修改为的wooyun，如图4。说明还可以越权修改其它用户的“所在地区”信息。（用户密码不可修改，因为修改用户密码需要用户的原有密码）\n\n    发现“所在地区”信息处存在存储型XSS漏洞，并且可以利用XSS漏洞获得用户登录后的Cookie信息，如图5，6。\n\n\n\n    为了不容易被发现被修改了信息，插入精心构造后的XSS利用代码后显示如图7。只多了“\"/>”，一般用户可能不会在意。\n\n    可以看到在通过XSS漏洞获得的Cookie信息中有用户名（邮箱），如果修改所有用户的“所在地区”为XSS利用代码，就可能获得所有用户的用户名。新注册一个用户，大约找到当前mid的最大值max，然后对一次插入XSS利用代码的过程抓包，修改Cookie中的mid依次为1-max，就可以修改所有用户的“所在地区”信息为XSS利用代码了。这个活用burpsuite很容易实现。   修复方案：  管理员懂的。   版权声明：转载请注明来源 txcbg@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-03-01 05:17 厂商回复： 非常感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-02-25 18:23 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  马克。。。    \n     2013-03-25 13:17 |    \t\t少校 \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:5        | 别开枪，自己人！)\t\t \n  穷追不舍的毅力啊！    \n     2013-04-11 18:07 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  。。。精心构造。。洞主可以在你所构造的xss代码的最后面加一个 <img这样就会将你那里侧漏出来的\">给闭合进去了。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}