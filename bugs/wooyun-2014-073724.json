{"id": 51679, "wybug_id": "wooyun-2014-073724", "wybug_title": "TinyShop SQL注入", "wybug_corp": "tinyrise.com", "wybug_author": "zxx", "wybug_date": "2014-08-27 14:33", "wybug_open_date": "2014-11-25 14:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-31：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-25：\t细节向公众公开  简要描述： 未过滤，导致注入 详细说明：  问题出现在/protected/controllers/simple.php中：\n//捆绑商品数量    public function bundbuy_num(){        $id = Filter::int(Req::args('id'));        $num = Filter::int(Req::args('num'));        if($num<=0)$num = 1;        $product_id = Req::args('pid');//pid参数未过滤直接传给$product_id        $product_ids = preg_replace('/-/i', ',', $product_id);//$product_id将字符串中-替换为,后传给$product_ids        $model = new Model(\"bundling\");        $bund = $model->where(\"id=$id\")->find();        if($bund){//为了条件语句执行，$id要存在。            $goods_id = $bund['goods_id'];            $products = $model->table(\"goods as go\")->join(\"left join products as pr on pr.goods_id=go.id\")->where(\"pr.id in ($product_ids)\")->fields(\"*,pr.id as product_id\")->group(\"go.id\")->findAll();//$product_ids直接放入查询语句中            $products = $this->packBundbuyProducts($products);        }        $weight = 0;        $max_num = $num;        foreach ($products as $prod) {            $weight += $prod['weight'];            if($max_num>$prod['store_nums'])$max_num = $prod['store_nums'];        }        $num = $max_num;        $amount = sprintf(\"%01.2f\",$bund['price'] * $num);        $product[$product_id] = array('id'=>$product_ids,'goods_id'=>'','name'=>'','img'=>'','num'=>$num,'store_nums'=>$num,'price'=>$bund['price'],'spec'=>array(),'amount'=>$amount,'sell_total'=>$amount,'weight'=>$weight,'point'=>'',\"prom_goods\"=>array(),\"sell_price\"=>$bund['price'],\"real_price\"=>$bund['price']);        echo JSON::encode($product);    }\n   漏洞证明：  http://localhost/index.php?con=simple&act=bundbuy_num&id=1&num=1&pid=1,2,3,4) and 1=1 %23\n\n\n\n用sqlmap跑一下，pid是注入参数，又是基于时间盲注\n\n   修复方案：  过滤一下   版权声明：转载请注明来源 zxx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-08-28 16:18 厂商回复： 非常感谢您为TinyShop信息安全做的贡献，此问题已经360库带反馈，不过仍然感谢你的支持。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}