{"id": 50281, "wybug_id": "wooyun-2014-078286", "wybug_title": "UCenter存在多处CSRF（可备份数据、删除应用、删除管理员等）", "wybug_corp": "Discuz!", "wybug_author": "zph", "wybug_date": "2014-10-13 10:15", "wybug_open_date": "2015-01-11 10:16", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-16：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-11：\t细节向公众公开  简要描述： UCenter存在多处CSRF（可备份数据、删除应用、删除管理员等） 详细说明：  UCenter有很多处没有判断formhash啊……都可以CSRF……   漏洞证明：  #1 删除应用\n\nformhash为空，成功提交\n\n#2 删除管理员\n\nformhash为空，成功删除\n\n#3 备份数据\n\n无formhash，目录名可控\n\n如果是windows用户，基本上就能拖下来了……\n\n   修复方案：  首先判断formhashwindows短文件名解决策略：1.首先要想的是改变存储文件名的策略（而不是把所有责任都推给用win主机的用户），毕竟用windows服务器的用户还不占少数。windows文件名大于8个字符就可以用过短文件名访问到。因为短文件名取前6个字符加上\"~数字\"，那么为什么不让文件名前六位毫无规律，变复杂呢？\n如果前六位是纯数字，那么有1000000（10^6）种可能性，一夜就可以轻松获取你的备份数据库。如果前六位是字母+纯数字，那么有1544804416（36^6）种可能性，至少要跑1544.804416夜才能获取你的数据库。如果还有特殊字符呢？如果加上文件夹名的可能性组合呢？\n这样一来，可以跑出来的几率就几乎为0了。2.既然你知道windows主机只要大于8位就可以通过短文件名访问，那为什么要让文件和文件夹名大于8位呢？所以可以（只是个人建议）判断下用户是windows主机还是linux，如果是windows主机就不用考虑文件名多长多长了，只要把8位的复杂度搞好，其他都是浮云。\n8位数字+字母可能性：2821109907456（34^8）\n3.教育用户安全性，设置服务器防盗链，禁止zip等文件下载。   版权声明：转载请注明来源 zph@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-10-13 10:49 厂商回复： 感谢您提出此产品的问题，尤其是同时给出了解决方案的建议。希望今后继续合作。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-13 12:15 |    \t\tCoffee \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:15        | Corie, a student of RDFZ.)\t\t \n  同学你不上课吗……    \n     2014-10-13 13:46 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  @Coffee 这个洞十一期间就提交了……刚刚审核    \n     2014-10-13 15:40 |    \t\tHaswell \t\t\t( 普通白帽子  |\t\t\t        Rank:167 漏洞数:18        | HorizonSec @ RDFZ)\t\t \n  赞    \n     2014-10-19 20:00 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  @疯狗 @Finger 这个前台隐藏的“高危漏洞”有奖金么？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}