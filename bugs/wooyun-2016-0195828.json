{"id": 88740, "wybug_id": "wooyun-2016-0195828", "wybug_title": "看我如何利用burp大法绕过深信服SSL VPN访问权限控制                                      ", "wybug_corp": "深信服", "wybug_author": "f4ckbaidu", "wybug_date": "2016-04-13 15:49", "wybug_open_date": "2016-07-17 00:10", "wybug_type": "权限控制绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-21：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-06-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-07-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-07-17：\t细节向公众公开  简要描述： 通篇都是猥琐流，乌云欠我一个闪电 详细说明：  声明：本次报告中提到的**.**.**.**是一个虚拟的域名，并非真实域名在测试自己公司SSL VPN安全性的时候发现一个有趣的东西ssl vpn连接后会服务端会下发一个资源列表给客户端，如下图：\n\n图中的host字段就是VPN远端的服务器IP，port就是允许你访问的服务区端口号，这里为22这里的意思就是只允许你去访问10.x.x.x的22端口，那么问题来了：\n挖掘机哪家强，哦不对，是我可以修改服务器返回的IP和端口号来访问其它VPN远端资源吗？\n说做就做，通过burp代理修改port范围为1-65535来试试：\n\n然并卵，使用http代理后就不能访问L3VPN资源了（L3VPN=TCP+UDP+ICMP）\n\n然而就不能继续了吗？no，祭出神器burp的invisible proxying所谓的invisible proxying就是透明代理，通过出口设备将访问VPN的数据重定向给burp即可\n\n找谁重定向？出口设备或者linux的iptables都可以，这里以出口设备DNAT为例简要来说访问VPN的数据流变成如下流程：hacker --> 出口 --> DNAT给burp（同时源IP转换为**.**.**.**） --> burp处理 --> 出口 --> VPN设备注意：burp和hacker主机不能为同一台，为同一台的话会出现数据环路，为什么自己去想吧，基础网络知识这里做实验的hacker机IP为**.**.**.**，burp主机**.**.**.**，网关为**.**.**.**，VPN设备IP假设为**.**.**.**那么在出口需要做：1、源IP为**.**.**.**的访问**.**.**.** TCP443端口重定向到**.**.**.**的443端口2、代理**.**.**.**访问**.**.**.**的请求因为我这里**.**.**.**是假的所以要绑定下hosts，burp和windows主机都要绑定\n\n现在我们登陆试下，发现burp正常工作，VPN登陆流程比较慢但可以登陆可以看到端口范围已经被burp自动修改了：\n\n注：这里VPN登陆成功后需取消网关的DNAT策略，否则会因burp代理速度太慢导致VPN不可用我们再来访问10.x.x.x的80端口试试，duang！一下就打开了80端口的页面\n\n当然3306端口也是可以访问的：\n\n最终测试结论：已绕过VPN访问控制系统   漏洞证明：     修复方案：  你懂的   版权声明：转载请注明来源 f4ckbaidu@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2016-04-18 00:06 厂商回复： 感谢白帽子提交的问题。经过与提交该漏洞的白帽子联系发现，该设备定制了特殊功能，问题是由于该功能的定制包存在问题，导致数据请求存在被篡改的风险。该定制包只有部分特定用户使用，目前已将此漏洞修复，其他不使用该定制包的用户则不存在此问题。感谢白帽子为我们指出问题，请白帽子私信留下联系方式，我们将为您寄送礼物以示答谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-13 15:53 |    \t\tAasron \t\t\t( 普通白帽子  |\t\t\t        Rank:990 漏洞数:171        | raw_input(\"你知道我要输入什么？\"))\t\t \n  fuzz    \n     2016-04-13 16:02 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:5460 漏洞数:423        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  乌云欠我一个闪电    \n     2016-04-13 16:21 |    \t\t坏男孩-A_A \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:23        | 膜拜学习中)\t\t \n  牛逼    \n     2016-04-13 16:22 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1418 漏洞数:128        | 东方红＊＊联盟欢迎你－0-)\t\t \n  乌云欠我一打闪电-0-    \n     2016-04-13 16:27 |    \t\tAzui \t\t\t( 实习白帽子  |\t\t\t        Rank:61 漏洞数:15        | 人有两件宝，双手和大脑。)\t\t \n  乌云欠我一个闪电    \n     2016-04-13 16:39 |    \t\tF4K3R \t\t\t( 普通白帽子  |\t\t\t        Rank:318 漏洞数:34        | 求团队收留。)\t\t \n  乌云欠我一个闪电    \n     2016-04-13 16:46 |    \t\tT-Safe \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:11        | 厦门冰眼信息科技安全研究院)\t\t \n  乌云欠我一个闪电    \n     2016-04-13 16:57 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:1015 漏洞数:220        )\t\t \n  乌云欠我一个闪电    \n     2016-04-13 17:27 |    \t\tzmx \t\t\t( 普通白帽子  |\t\t\t        Rank:166 漏洞数:44        | wooyun)\t\t \n  能绕过手机验证吗？    \n     2016-04-13 17:47 |    \t\t深信服(乌云厂商)\t\t \n  提交该漏洞的白帽子您好，感谢您向我们反馈问题，目前我们想咨询下这台设备的部分配置，希望与您取得联系，我们的邮箱：anquan@sangfor.com.cn，非常感谢！    \n     2016-04-13 17:57 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:265 漏洞数:33        | 开发真是日了狗了)\t\t \n  @深信服 你想咨询啥，没开防中间人攻击，这个本来你们默认也就没开启    \n     2016-04-13 18:08 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:259 漏洞数:96        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  @f4ckbaidu  乌云欠你一个闪电   你取消匿名，就给你闪电啦    \n     2016-04-13 20:26 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1905 漏洞数:295        | 以大多数人的努力程度之低，根本轮不到去拼...)\t\t \n  乌云欠我一个闪电。    \n     2016-04-13 20:40 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:341 漏洞数:62        | little red pig!)\t\t \n  强势围观    \n     2016-04-22 19:44 |    \t\t土豆俠 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我爱吃土豆)\t\t \n  乌云欠我一个闪电    \n     2016-05-04 10:16 |    \t\t习总夸我好青年 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 刚来的,请多关照)\t\t \n  闪电是啥?    \n     2016-05-08 21:18 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1768 漏洞数:246        | 。)\t\t \n  膜拜大师傅    \n     2016-06-12 01:28 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:2185 漏洞数:312        | 解决问题的第一步，是要承认问题的存在。)\t\t \n   - -这个码打的。。看的好乱好揪心  还好有图不然还真不好理解    \n     2016-06-12 08:39 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1418 漏洞数:128        | 东方红＊＊联盟欢迎你－0-)\t\t \n  又学习了一招！！！！！    \n     2016-06-22 08:44 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1905 漏洞数:295        | 以大多数人的努力程度之低，根本轮不到去拼...)\t\t \n  又涨姿势了...    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}