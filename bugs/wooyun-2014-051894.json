{"id": 58218, "wybug_id": "wooyun-2014-051894", "wybug_title": "Easytalk V2.5 任意用户登录", "wybug_corp": "nextsns.com", "wybug_author": "酱油甲", "wybug_date": "2014-02-24 15:41", "wybug_open_date": "2014-05-25 15:42", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-25：\t细节向公众公开  简要描述： Easytalk <= V2.5 任意用户登录,包括管理员后台登陆 详细说明：  Easytalk <= V2.5 任意用户登录,包括管理员后台登陆--------首先是前台：问题出在：Home/Common/function.php中的function authcode（）\nfunction authcode($string, $operation = 'DECODE', $key = '', $expiry = 0) {        $ckey_length = 4;        $key = md5($key ? $key : SITE_URL);        $keya = md5(substr($key, 0, 16));        $keyb = md5(substr($key, 16, 16));\n以及Home/lib/Action/IndexAction.class.php中的dologin\nif ($remember==\"checked\") {                        Cookie::set('authcookie', authcode(\"$user[user_name]\\t$user[user_id]\\t1\",'ENCODE'), 31536000);                    } else {                        Cookie::set('authcookie', authcode(\"$user[user_name]\\t$user[user_id]\\t0\",'ENCODE'));                    }\n由于只验证了$user[user_name]\\t$user[user_id] 而user_id可以在收听时候得到： \n\n而在function authcode（）中，唯一用来判别不同网站的key，默认是没有的，那就会使用SITE_URL，也就是网站地址：例如http://wb.sol.net.cn这个站点，那SITE_URL=http://wb.sol.net.cn我们可以通过指定SITE_URL来得到authcookie：\n\n然后登录~~\n\n---------------------------------------------------------------同样，在后台登陆时候，也使用了这个函数：\nif($user) {\t\t\t\tCookie::set('adminauth', authcode(\"$user_name\\t$user[user_id]\",'ENCODE'));\t\t\t\techo '<script>parent.location.href=\"'.SITE_URL.'/admin.php?s=/Index\"</script>';\t\t\t} else {\t\t\t\t$this->redirect('/Login/index');\t\t\t}\n用户可以自己使用authcode函数计算出adminauth的值，登录后台。   漏洞证明：  已测V2.5，V2.4   修复方案：  不要这么简单的验证cookie……   版权声明：转载请注明来源 酱油甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-02-24 17:03 厂商回复： 该问题已经再最新版本的2.5中解决了。2.5重新上传了 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}