{"id": 87162, "wybug_id": "wooyun-2016-0178011", "wybug_title": "jcms系统session重置导致getshell", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "老虎皮", "wybug_date": "2016-02-23 16:26", "wybug_open_date": "2016-05-27 12:20", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-03-01：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-04-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-27：\t细节向公众公开  简要描述：  详细说明：  jcms系统session重置导致getshell  在/jcms/jcms_files/jcms1/web1/site/module/oss/que_code.jsp \n<%@page import=\"jcms.util.ValidateCode\"%><%\tString sessionId = request.getParameter(\"sessionid\");\tout.clear();\tValidateCode code1 = new ValidateCode();\tif(sessionId==null)\t\tsessionId = \"\";\tcode1.setSessionName(sessionId);\tcode1.getValidateCode(request,response);%>\n String sessionId = request.getParameter(\"sessionid\"); 直接通过sessionid获取值 code1.setSessionName(sessionId);然后又直接设置session   而在我们的jcms中的setup(后台管理制作端)中又只判断其中cookie_username是否为空不为空即就登录  可参考如下：http://**.**.**.**/bugs/wooyun-2015-0107138 \nString strUser = (String)sessions.getAttribute(\"cookie_username\"); // 判断strUser值 是否为空？ if( strUser == null || strUser.trim().length() == 0 ) {    out.println('请先登录!')  return; }  //如果为空，则未登录，直接返回\n 利用过程如下：   1、**.**.**.**/jcms/setup/opr_licenceinfo.jsp（如果后台未更改或者未设置权限提交下） 你会发现需要登录   2、**.**.**.**/jcms/jcms_files/jcms1/web1/site/module/oss/que_code.jsp?sessionid=cookie_username    3、再次访问**.**.**.**/jcms/setup/opr_licenceinfo.jsp即可 提供5个测试案例http://**.**.**.**http://**.**.**.**http://**.**.**.****.**.**.****.**.**.**:8080**.**.**.**选取其中做演示**.**.**.**\n\n\n\n\n\n 后台getshell参考http://**.**.**.**/bugs/wooyun-2014-061360 \n\n \n\n \n\n \n\n\n\n 就不一一shell了http://**.**.**.**/jcms/setup/opr_licenceinfo.jsp   漏洞证明：  \n\n\n\n 后台getshell参考http://**.**.**.**/bugs/wooyun-2014-061360 \n\n \n\n \n\n \n\n\n\n 就不一一shell了   修复方案：     版权声明：转载请注明来源 老虎皮@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2016-02-27 12:12 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-02-23 18:30 |    \t\twebhe4d \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:40        | 最近忙于篮球比赛，刷洞得缓缓 ：）   雷霆...)\t\t \n  沙发。    \n     2016-04-08 00:08 |    \t\twaht000 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:14        | 我还是太菜。。。)\t\t \n  膜拜审计牛    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}