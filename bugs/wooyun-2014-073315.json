{"id": 910, "wybug_id": "wooyun-2014-073315", "wybug_title": "小能在线客服系统可聊天可getshell(多家电商使用)", "wybug_corp": "小能", "wybug_author": "loli", "wybug_date": "2014-08-21 14:33", "wybug_open_date": "2014-10-05 14:34", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["文件上传内容未检查"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-21：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-10-05：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 客服MM一定要警惕那些不说话给你发图片或文件的银。 详细说明：  \n小能创立于2007年底，由来自微软、盛大等知名IT公司的高管创办，并先后为超过15000多家中国的互联网和电商公司提供产品和服务。2013年底，公司获得国际知名风险投资公司的投资。\n---------------------------------------------------------------------------\n1.任意文件上传漏洞，可GETSHELL在某网站上瞎逛看到有个客服在线，客服系统一般都提供发图片或者截图的功能，试了下韩都衣舍，看图：\n\n\n随便传了个图片过去，返回请求包如下：\nHTTP/1.1 200 OKServer: nginx/1.4.1Date: Thu, 21 Aug 2014 05:24:36 GMTContent-Type: text/html; charset=utf-8Connection: closeVary: Accept-EncodingX-Powered-By: PHP/5.2.10Content-Length: 437{\"type\":2,\"msg\":\"ä¼ è¾å®æ\",\"url\":\"http://t2d.ntalker.com/func/imagetrans/image.php?f=YWFhLnBuZw==&q=L2ltYWdlc2F2ZS90ZW1wL2tmXzk4MTcvZWI5ZmNhZmNlMmYxOTNlNzM2YzBmNjBmMjk1YjgzODAxNDA4NTk4Njc2LnBuZw==\",\"oldfile\":\"aaa.png\",\"size\":\"4.36 KB\",\"extension\":\"png\",\"sourceurl\":\"http://t2d.ntalker.com/func/imagetrans/download.php?f=YWFhLnBuZw==&q=L2ltYWdlc2F2ZS90ZW1wL2tmXzk4MTcvZWI5ZmNhZmNlMmYxOTNlNzM2YzBmNjBmMjk1YjgzODAxNDA4NTk4Njc2LnBuZw==\"}\n\nURL被base64编码了：f=YWFhLnBuZw==  //这是上传的文件名q=L2ltYWdlc2F2ZS90ZW1wL2tmXzk4MTcvZWI5ZmNhZmNlMmYxOTNlNzM2YzBmNjBmMjk1YjgzODAxNDA4NTk4Njc2LnBuZw==  //上传的路径通过burpsuite将png图片后缀直接改成php，插入php一句话马后上传，获取到shell:\n\n\n   漏洞证明：  内网。。。\n[/home/www/t2d.ntalker.com/func/imagetrans/imagesave/temp/kf_1x/]$ /sbin/ifconfigem1       Link encap:Ethernet  HWaddr 00:26:B9:5C:A5:1A            inet addr:113.31.17.239  Bcast:113.31.17.255  Mask:255.255.255.224          inet6 addr: fe80::226:b9ff:fe5c:a51a/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:3766950309 errors:0 dropped:1 overruns:0 frame:0          TX packets:3438306797 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:564554700096 (525.7 GiB)  TX bytes:1622506233974 (1.4 TiB)em2       Link encap:Ethernet  HWaddr 00:26:B9:5C:A5:1B            inet addr:192.168.1.190  Bcast:192.168.1.255  Mask:255.255.255.0          inet6 addr: fe80::226:b9ff:fe5c:a51b/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:373313383 errors:0 dropped:0 overruns:0 frame:0          TX packets:314958152 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:273620519884 (254.8 GiB)  TX bytes:159373614381 (148.4 GiB)lo        Link encap:Local Loopback            inet addr:127.0.0.1  Mask:255.0.0.0          inet6 addr: ::1/128 Scope:Host          UP LOOPBACK RUNNING  MTU:16436  Metric:1          RX packets:2799149950 errors:0 dropped:0 overruns:0 frame:0          TX packets:2799149950 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0           RX bytes:1016538441687 (946.7 GiB)  TX bytes:1016538441687 (946.7 GiB)\n更多小伙伴看这：http://www.xiaoneng.cn/partner.html   修复方案：  判断文件后缀名，设置图片目录不执行脚本权限。   版权声明：转载请注明来源 loli@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-10-08 08:40 |    \t\t铁汉 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:6        | 向各种大神学习之)\t\t \n  我终于知道，为神马很多客服系统都不给截图了    \n     2014-10-08 10:02 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  试了下，拿到的shell貌似还是xiaoneng的一个空间，和所在企业没啥联系?    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}