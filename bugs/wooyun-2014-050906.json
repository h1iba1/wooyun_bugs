{"id": 5178, "wybug_id": "wooyun-2014-050906", "wybug_title": "一次失败的漫游百度内部网络过程", "wybug_corp": "百度", "wybug_author": "3King", "wybug_date": "2014-02-14 04:16", "wybug_open_date": "2014-03-31 04:16", "wybug_type": "应用配置错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方框架", "任意文件上传", "渗透测试思路", "安全意识不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-31：\t细节向公众公开  简要描述： 安全是一个整体，保证安全不在于强大的地方有多强大，而在于真正薄弱的地方在哪里。本实例从一个不起眼的细节展开，发现致命漏洞后，为了检测百度内部是否有完善的监控报警机制，便尝试进行渗透挖掘，最终被系统规则检测到，暴漏了整个测试行为。本次渗透的心得在于，无论对于厂商还是渗透人员来说，细节是多么重要。欢迎百度选择忽略此漏洞，让基友们提前围观到细节。（猪猪侠：你妹....） 详细说明：  #1 猜测及发现隐患今晚在给手机上的应用升级时，闲着无聊打开了Wireshark进行抓包。就当升级完准备拔线时，窗口里突然蹦出了几个发向百度二三级域名的连接：loc.map.baidu.com、mobads.baidu.com、mobads-logs.baidu.com（原图已无法复现）\n\n想起昨天和剑心聊（gao）天（ji）时谈到的一些企业高层对安全的态度，便下意识地ping了这三个域名一下。前两个都解析到了cdn上，但是当ping到mobads-logs.baidu.com时，却发现并未到cdn，而是解析到了一个真实地址。\n\n#2 IP段扫描及发现漏洞于是利用扫描工具，对123.125.114段进行全面的扫描。最终在123.125.114.213，发现开放了web服务，而且疑似是内部测试系统的对外。\n\n首先是在模板下载链接处发现任意文件下载漏洞。\n\n\n\n\n\n随后又发现有一处上传点。\n\n上传后虽然未返回上传地址，但通过查看源码之后发现了这个\n\n从这里可以看出，文件传上去后是存储在了heat-map/upload里，而不是临时存储。接着便猜测，是否上传效验了文件类型，并且上传后有没有改名。做一个简单的验证：上传一个文件名为2.jsp的输出“Helloworld”jsp程序，然后尝试访问http://123.125.114.213/heat-map/upload/2.jsp，发现返回“Helloworld”，由此证明上传漏洞存在。\n\n#3 内网基础信息的获取及触发报警在进一步测试前，曾经考虑过百度很可能有较健全监控报警机制。为了测试是否存在，便上传了菜刀JSPShell进行渗透挖掘。通过目录和文件信息可以看到，此服务器有多名百度员工在使用，存在大量脚本和相关信息。\n\n通过netstat可以看到，此服务器有往百度多个内网B段的连接，如果能够获得这台服务器的高权限，将极有可能进一步深入百度内网。\n\n同时，从员工留下的脚本内发现了多处映射在根目录的FTP匿名和数据库信息。\n\n对服务器进行遍历后，mongo发现，百度服务器上安装了waf软件。\n\n\n\n\nsms_cmd=\"gsmsend -s 10.23.199.131:15008 -s 10.23.248.104:15008\"\n跟踪链接后，到达百度短信报警平台。\n\n\n\n目的已经达到，百度服务器有健全的监控机制，便没有进一步检测。由于JSPShell返回的部分信息触发报警，没过多久，Shell被清除，服务器下线，渗透结束。另外，同段中的123.125.114.240疑似出现注入漏洞，请注意。\n\n申明：后部分的挖掘是和先与剑心沟通后，征得同意才进行的。如有欠妥之处，还望原谅。另外，感谢mongo基友的协♂助♂测♂试~   漏洞证明：  略   修复方案：  ·测试站点不要暴露在外网。·任何情况下，都要注意外部信息不要被暴露。·进一步加强网络安全，继续为上亿网络用户提供安全，优质的服务！   版权声明：转载请注明来源 3King@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-02-14 13:14 厂商回复： 感谢3King的友情检测，我们会继续提升能力，也请各位白帽子在安全测试中注意遵守国家相关法律。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-02-14 07:25 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  失败是成功她妈    \n     2014-02-14 07:48 |    \t\t专业种田  \t\t\t( 核心白帽子 |\t\t\t        Rank:1425 漏洞数:182        | 没有最专业的农民,只有更努力地耕耘..........)\t\t \n  看标题以为猪猪侠    \n     2014-02-14 08:13 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  最后的那个括号亮了！^ ^    \n     2014-02-14 08:38 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  我堵100WB百度不会忽略    \n     2014-02-14 08:40 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @zzR ( 普通白帽子 |\t Rank:1074 漏洞数:95 | WooYun.0rg)你的后边这个wooyun.org手机能点开吗？我手机的UC可以点开进主页    \n     2014-02-14 08:48 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  @HackBraid you win    \n     2014-02-14 08:49 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @zzR ^ ^    \n     2014-02-14 09:35 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-02-14 09:50 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  牛逼！    \n     2014-02-14 11:12 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  括弧亮了。。    \n     2014-02-14 11:41 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  我就喜欢括号里的话  不错    \n     2014-02-14 12:11 |    \t\tchar \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:3        | 中国平安，不只保险这么简单。)\t\t \n  “为了检测百度内部是否有完善的监控报警机制”，是“根本停不下来”吧？哈哈    \n     2014-02-14 12:34 |    \t\t3King \t\t\t( 普通白帽子  |\t\t\t        Rank:1129 漏洞数:92        | 【study at HNUST】非常感谢大家的关注~ 大...)\t\t \n  @char 基友，别损...    \n     2014-02-14 13:02 |    \t\td4rkwind \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 关注web 安全，产品安全)\t\t \n  我跟剑心沟通后，剑心说百度是可以查水表的。    \n     2014-02-14 13:24 |    \t\tHuc-Unis \t\t\t( 普通白帽子  |\t\t\t        Rank:1055 漏洞数:292        | 诶，现在通用奖励越来越低了；离买保时捷卡...)\t\t \n  为什么美国那么多黑客，中国的黑客都是垃圾，你懂得为什么...    \n     2014-02-14 13:41 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  看标题以为猪猪侠，看厂商回复以为是腾讯。。。特别是那句“也请各位白帽子在安全测试中注意遵守国家相关法律”来，对比下！ WooYun: 一次失败的漫游腾讯内部网络过程 #1    \n     2014-02-14 13:54 |    \t\tshawshank \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:3        | free you mind)\t\t \n  我跟剑心沟通后，剑心说百度是可以查水表的。    \n     2014-02-14 15:44 |    \t\t中国民间-孑海 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | 关注国家网络安全  维护中国网络)\t\t \n    @ Huc-Unis 难道你这是长他是志气  灭自己国家威风    我也不知道这是为什么    \n     2014-03-06 14:29 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  哈哈给力    \n     2014-03-30 12:21 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  你妹。。。。。小哥叫Mango    \n     2014-03-31 12:30 |    \t\tstevenliu \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:2        | 从事信息网络完全)\t\t \n  不错嘛 报百度菊花！！！    \n     2014-03-31 12:31 |    \t\t我了个去 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:14        | 4892057@qq.com                          ...)\t\t \n  我们会继续提升能力，也请各位白帽子在安全测试中注意遵守国家相关法律。意思就是请你们老老实实的，不要越界    \n     2014-04-02 14:45 |    \t\tEdward_Phoenix \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 修电脑的)\t\t \n  整个过程真是惊喜不断！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}