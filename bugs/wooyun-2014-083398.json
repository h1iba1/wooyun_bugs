{"id": 46609, "wybug_id": "wooyun-2014-083398", "wybug_title": "某酒店Mifare卡门锁系统破解（可以任意构造房卡开门）", "wybug_corp": "ADEL/爱迪尔", "wybug_author": "libmaru", "wybug_date": "2014-11-21 17:49", "wybug_open_date": "2015-02-19 17:50", "wybug_type": "设计不当", "wybug_level": "中", "wybug_rank_0": "9", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-19：\t细节向公众公开  简要描述： 通过入住或者其他途径得到该酒店对应的 2 字节系统号后，可以任意构造房卡开门 详细说明：  以下针对 ADEL A90 Mifare 门禁系统ADEL 出售的门卡是向复旦微电子定制的 FM11RF08，等同于 Mifare Classic S50特别之处在于 SAK == 0x19，导致 libnfc 将卡片大小识别为 320 字节，mfoc 不受影响门锁会识别 SAK，所以自己制卡的话需要使用 UID 卡，先写入一次 SAK=4 可以使 libnfc 正常工作默认配置下酒店使用第 1、15 扇区第 1 扇区使用 A0A1A2A3A4A5 / B0B1B2B3B4B5 默认密钥第 15 扇区使用 UID 构造出的密钥，KeyA、KeyB 相同第 15 扇区密钥的构造方法默认为 { uid[0]^uid[1], uid[0], uid[1], uid[2], uid[3], uid[2]^uid[3] }对互联网上流传的 A90 系统进行逆向得知卡 0x3DD 处为 0x3C0 至 0x3DC 内容的 checksum，算法见测试代码0x3C0 至 0x3DC 的内容经过编码，解码算法见测试代码解码后的内容依次为3 字节 卡号，第一个nibble为9代表客人卡/备用卡/电梯卡2 字节 系统号，各酒店不同2 字节 门锁号1 字节 床号8 字节 时间区间6+2 字节 不解释了5 字节 0xFF padding门锁号一般在软件中批量生成，与酒店房间号的对应关系可以直接看出来时间区间由起止时间各 4 字节构成，算法见测试代码至此，已经可以从一份房卡样本中获得 2 字节的系统号，并生成新的客房卡打开其他房间的门锁PS：系统号保存在数据库的 XTCS 表中，所以不排除其他方式得到系统号如果能够访问 MY 表，可以构造出总控卡任意开门，不需要针对每个客房构造客房卡动态调试的思路是虚拟出两个串口对接，A90 使用其中一端，自己的脚本跑在另一端模拟读卡器来一张调试过程截图\n\n   漏洞证明：  没啥好说的   修复方案：  最低成本的修复是打乱门锁号门锁似乎有保护机制，不怕暴力   版权声明：转载请注明来源 libmaru@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2014-11-26 10:45 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-26 14:33 |    \t\t记得 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | 人 生 若 只 如 初 見)\t\t \n  碉堡了！    \n     2015-02-20 09:51 |    \t\tH1d3r \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:2        | 　‮)\t\t \n  赶脚好牛掰    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}