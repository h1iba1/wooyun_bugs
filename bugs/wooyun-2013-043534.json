{"id": 60393, "wybug_id": "wooyun-2013-043534", "wybug_title": "礼意久久主站任意文件上传", "wybug_corp": "礼意久久", "wybug_author": "Ghora", "wybug_date": "2013-11-21 16:34", "wybug_open_date": "2014-01-05 16:35", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "中", "wybug_rank_0": "6", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["上传漏洞", "上传格式限制"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-21：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-01-05：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 网站直接上传JSP文件，可以直接上传shell，这样没有对网站上传进行过滤，如果黑客找到过后进入shell里面造成网站不必要的损失。 详细说明：  \n漏洞页面是：http://www.liyi99.com/partener.do?_methodName=regist\n ，这里面的话有两个上传地址，可以直接上传shell.完全没有格式过滤。http://www.liyi99.com/picture/-1928514119_dama.jsp   漏洞证明：  \n\n\n 直接上传.JPG文件\n \n\n\n\n\n\n\n\n   修复方案：  Connection conn = DataBase.getConnection();  \t\t\tProductDAO productDao = new ProductDAO();\t\t\tCategoryDAO categoryDao = new CategoryDAO();\t\t\tcategoryDao.setConn(conn);\t\t\tProduct product = new Product();\t\t\tproductDao.setConn(conn);\t\t\t//上传文件\t\t\tSmartUpload upload = new SmartUpload();\t\t\t// 上传初始化\t\t\tupload.initialize(this.getServletConfig(), request, response);\t\t\t// 设定上传限制\t\t\t// 1.限制每个上传文件的最大长度。\t\t\tupload.setMaxFileSize(1000000);\t\t\t// 2.限制总上传数据的长度。\t\t\tupload.setTotalMaxFileSize(10000000);\t\t\t// 3.设定允许上传的文件（通过扩展名限制）,仅允许gif.jpg文件。\t\t\tupload.setAllowedFilesList(\"gif,jpg\");\t\t\t// 4.设定禁止上传的文件（通过扩展名限制）,禁止上传带有exe,bat,\t\t\t// jsp,htm,html扩展名的文件和没有扩展名的文件。\t\t\tupload.setDeniedFilesList(\"exe,bat,jsp,htm,html\");\t\t\t//上传文件\t\t\tupload.upload();\t\t\t//利用request对象获取参数，接参   版权声明：转载请注明来源 Ghora@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}