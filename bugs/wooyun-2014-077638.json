{"id": 50509, "wybug_id": "wooyun-2014-077638", "wybug_title": "芒果云KODExlporer一处本地文件包含(可GETSHELL)", "wybug_corp": "千帆网络工作室", "wybug_author": "loopx9", "wybug_date": "2014-09-28 18:40", "wybug_open_date": "2014-12-27 18:42", "wybug_type": "文件包含", "wybug_level": "中", "wybug_rank_0": "6", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "文件包含", "本地文件包含利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-27：\t细节向公众公开  简要描述： LFI一枚. 详细说明：  controller/util.php: 74-98\n//语言包加载function init_lang(){    if (isset($_COOKIE['kod_user_language'])) {        $lang = $_COOKIE['kod_user_language'];  //从cookie中取值    }else{  //没有cookie        preg_match('/^([a-z\\-]+)/i', $_SERVER['HTTP_ACCEPT_LANGUAGE'], $matches);        $lang = $matches[1];        switch (substr($lang,0,2)) {            case 'zh':                if ($lang != 'zn-TW'){                    $lang = 'zh-CN';                }                break;            case 'en':$lang = 'en';break;            default:$lang = 'en';break;        }        $lang = str_replace('-', '_',$lang);        setcookie('kod_user_language',$lang, time()+3600*24*365);    }        $GLOBALS['language'] = $lang;        define('LANGUAGE_TYPE', $lang);    include(LANGUAGE_PATH.$lang.'/main.php');  //直接包含了，没做过滤    $GLOBALS['L'] = $L;    $GLOBALS['lang'] = $L;}\ninit_lang() 在 /config/config.php 中调用.   漏洞证明：  \n\n函数parse_incoming 对GPC传进来的参数都进行了stripslashes，可惜init_lang()是在之前调用，不然就不受GPC限制了。cookie添加 kod_user_language=../User/demo/home/new.txt%00 ,然后访问成功利用需要\\0截断，因而所需条件: php version <5.3.4, GPC off。GPC启用时，一些版本的php也能长文件名截断.   修复方案：  过滤。   版权声明：转载请注明来源 loopx9@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-09-28 20:11 厂商回复： 感谢关注与贡献！马上整改，尽快发布新版 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}