{"id": 13583, "wybug_id": "wooyun-2013-019108", "wybug_title": "我是如何登录住哪网后台的(突破IP限制!)", "wybug_corp": "住哪网", "wybug_author": "leaf", "wybug_date": "2013-02-24 00:04", "wybug_open_date": "2013-04-10 00:05", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-02-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-02-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-03-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-03-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-03-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-04-10：\t细节向公众公开  简要描述： 我是如何登录住哪网后台的(突破IP限制!) 详细说明：  猜解到后台：\nhttp://www.zhuna.cn/sys_admin/\n\n\n点击确定后，跳转到登录界面：\nhttp://www.zhuna.cn/sys_admin/login.php\n\n\n很自然的觉得后台部分页面没有访问控制，可以直接进行请求查看。(同时也怀疑可能存在JS访问绕过问题，禁用JS后再进行访问，发现依然如此，故而排除JS绕过的想法。）通过查看HTML源代码，很容易的找到菜单页面名称：\nhttp://www.zhuna.cn/sys_admin/menu.php\n\n\n查看menu.php页面的HTML源代码，逐个请求各超链接页面，不难发现其中部分页面是不需要身份验证的(不会跳转到登录页面)：\n\n\n\n以其中一个链接为例，我们发现这些不需要身份验证的页面有IP限制：\n\nsys_admin路径下部分页面有ip限制，会不会是使用客户端发送header中的X-Forwarded-For 来检测客户端IP，从而进行判断的呢？一试便知！用http editor来发送该页面请求，同时特意增加了X-Forwarded-For，问题是它的值写什么合适呢？咱不知道它到底允许那些地址，算鸟，直接127.0.0.1本地回环地址，这个总应该是放行的，果不其然,如图：\n\n问题又来了，http editor里不能直接点击超链接，对于其它链接还得每次单独请求，太不方便了，突然想到了因插件而强大的火狐浏览器...X-Forwarded-For Header...\n\n如上图设置好以后，就可以用火狐进行自由浏览了，它会自动在目标站点的每个请求头中加入 X-Forwarded-For：127.0.0.1\n\n\n\n.........and so on!!! 未进一步深入，不再一一贴图！   漏洞证明：  如上所述！    修复方案：     版权声明：转载请注明来源 leaf@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-02-24 06:42 厂商回复： 非常感谢，我们会尽快对予以修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-02-24 01:54 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  我也打到直接登不上就没搞了，mark，话说洞主是冲着礼物还是ipad啊，多个洞有多个礼物么    \n     2013-02-24 02:39 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  不错不错..别搞我的ID就好。。    \n     2013-02-24 07:52 |    \t\t小瘦子 \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 有点意思...)\t\t \n  @小胖胖要减肥 兄台好！    \n     2013-02-24 07:54 |    \t\t中粮我买网(乌云厂商)\t\t \n  关注一下。。    \n     2013-02-24 07:55 |    \t\tleaf \t\t\t( 普通白帽子  |\t\t\t        Rank:948 漏洞数:121        | 真的没影响么？)\t\t \n  @小胖胖要减肥 呵呵！这个不是盲打的！    \n     2013-02-24 08:00 |    \t\tleaf \t\t\t( 普通白帽子  |\t\t\t        Rank:948 漏洞数:121        | 真的没影响么？)\t\t \n  汗！回头来看才发现，\"住哪\"写成了\"去哪\"...@xsser 求修改！    \n     2013-02-24 08:39 |    \t\tValo洛洛 \t\t\t( 普通白帽子  |\t\t\t        Rank:458 漏洞数:52        | 。)\t\t \n  禁用js 修改forward？    \n     2013-02-24 11:25 |    \t\tsafe121 \t\t\t( 实习白帽子  |\t\t\t        Rank:98 漏洞数:11        | http://www.gov.cn)\t\t \n  x-forwarded-for?    \n     2013-02-24 11:26 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  顶    \n     2013-02-24 11:58 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @小瘦子 又是小号 伤不起    \n     2013-02-24 11:59 |    \t\tleaf \t\t\t( 普通白帽子  |\t\t\t        Rank:948 漏洞数:121        | 真的没影响么？)\t\t \n  @小胖胖要减肥 我怎么感觉这里胖的、瘦的一大堆...    \n     2013-02-24 12:04 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @leaf 被你发现了 自从心伤的胖子开始 反正要么胖要么瘦    \n     2013-02-24 12:15 |    \t\tValo洛洛 \t\t\t( 普通白帽子  |\t\t\t        Rank:458 漏洞数:52        | 。)\t\t \n  @safe121 打错了- -是referer 大概可能是。。    \n     2013-02-24 12:23 |    \t\tleaf \t\t\t( 普通白帽子  |\t\t\t        Rank:948 漏洞数:121        | 真的没影响么？)\t\t \n  @Valo洛洛 @safe121 看厂商已修复的情况下，我说你们开始猜的思路是对的...    \n     2013-02-24 12:30 |    \t\tValo洛洛 \t\t\t( 普通白帽子  |\t\t\t        Rank:458 漏洞数:52        | 。)\t\t \n  @leaf 不是猜的。。。我搞过。。。。。还没报。。。。    \n     2013-02-24 12:35 |    \t\tleaf \t\t\t( 普通白帽子  |\t\t\t        Rank:948 漏洞数:121        | 真的没影响么？)\t\t \n  @Valo洛洛 呵呵！相对来说，这种案例不多！    \n     2013-02-25 08:53 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  根据referer来限制IP？太不靠谱了吧。XFF还有点可能吧    \n     2013-05-09 13:39 |    \t\tAqua \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:2        | hello world !)\t\t \n  在使用 CDN 后只有用 x-forwarded-for 判别客户端 IP，这倒是能用来给PHP程序登录后台不留下真实 IP用！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}