{"id": 57775, "wybug_id": "wooyun-2014-053369", "wybug_title": "PPTV多应用commons-fileupload组件拒绝服务漏洞", "wybug_corp": "PPTV(PPlive)", "wybug_author": "Nebula", "wybug_date": "2014-03-11 15:56", "wybug_open_date": "2014-04-25 15:57", "wybug_type": "系统/服务补丁不及时", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-25：\t细节向公众公开  简要描述： RT! 详细说明：  代码逻辑错误，特殊包进入死循环，cpu 100%,造成拒绝服务（DoS）：Apache Commons FileUpload Denial-of-Service(cve-2014-0050) :http://zone.wooyun.org/content/10508   漏洞证明：    这个漏洞比较严重啊!但一个月快过去了,我看了一下,除了阿里修复得比较好以外,一些电商好像基本没处理,不知道是不是觉得没危害还是漏洞理解有问题,发现有些电商等在java安全漏洞这一块基本是一片空白(而自己的应用绝大部分是J2EE.比如:某东)!  commons-fileupload是Apache commons系列的重要组件,J2EE中我们基本都使用该包做上传功能.比如:tomcat7已经开始完全复用该组件代码嵌入其中,所以它是受影响的（比如：http://zone.wooyun.org/content/10508 这个标题中，因为tomcat比较流行，所以只写了它，事实影响范围并非如此！）。  但这次真正有直接危害的是J2EE框架(因为其他使用该包的中间件可能都需要一些攻击条件)，但一些框架是不需要的！！！比如：Struts2或Spring等,以Struts2（为什么选它就不多说了）为例,我们不需要找一个上传功能，只要找了一个进入框架请求流程即可，就是找个框架拦截扩展名地址即可，比如：.action Struts2并未提供自己的请求解析器，也就是就Struts2不会自己去处理multipart/form-data的请求，它需要调用其他请求解析器，将HTTP请求中的表单域解析出来。但Struts2在原有的上传解析器基础上做了进一步封装，更进一步简化了文件上传。进入框架流程后，会经过一系列的拦截器（拦截器），也包括上传所在的拦截器！  比如：这里找了几个sturts2框架的应用：http://passport.pptv.com/registerandlogin.dohttp://tips.passport.pptv.com/getUsertipNum.dohttp://home.pplive.com/login.do  那么我们怎么确认漏洞存在，因为特征不够明显，其实很简单，PoC打过去，进入死循环后，web服务器是不会有响应包的，如果漏洞不存在是会正常响应的！比如：一直在等待响应包（这里可以用抓包工具测试），我这里用java模拟的http请求\n\n之前：\n\n之后：\n\n  当然，从外部看是不明显的(比如：4核八线程的cpu，我可能要发8次包才到100%)，还是要上服务器查看,比如：该包是否小于1.3.1\n\n   修复方案：  如果是替换包：http://commons.apache.org/proper/commons-fileupload/download_fileupload.cgi （如果是框架，一般换最新 Commons FileUpload包就可以了）如果是被嵌入到其他中间件，比如：tomcat，最好是换最新版本中间件   版权声明：转载请注明来源 Nebula@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-03-11 17:46 厂商回复： thx~ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}