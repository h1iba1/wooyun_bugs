{"id": 85891, "wybug_id": "wooyun-2016-0169077", "wybug_title": "网神旧版VPN系统GETSHELL（同时影响网御神州、天融信、西安网赢、卫士通、吉大正元、美国凹凸、德国 ANIX等多家VPN厂商设备）", "wybug_corp": "网神信息技术(北京)股份有限公司", "wybug_author": "Angle_G", "wybug_date": "2016-01-11 14:17", "wybug_open_date": "2016-04-11 16:08", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-16：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-03-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-03-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-03-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-04-11：\t细节向公众公开  简要描述： RT 详细说明：  在文件 /admin/system/backup_action.php\n<?phpif (isset($_REQUEST['cmd']))\t$cmd = $_REQUEST['cmd'];else\t$cmd = \"NULL\";$with_cert = 1;$pass = \"\";include_once \"management/system.php\";if ($cmd == $LANG_IMPORT) {\tif ($_FILES['userfile']) {\t\t$file_size = $_FILES['userfile']['size'];\t\t$file_type = $_FILES['userfile']['type'];\t\t\t$temp_name = $_FILES['userfile']['tmp_name'];\t\t$file_name = $_FILES['userfile']['name'];\t\t$file_name = str_replace(\"\\\\\",\"\",$file_name);\t\t$file_name = str_replace(\"'\",\"\",$file_name);\t\t$file_name = str_replace(\" \",\"\",$file_name);\t\t$file_path = $CFG_UPLOAD_PATH.\"__im_data__.bin\";\t\t//File Name Check\t\tif ( $file_name == \"\" ) { \t\t\techo \"Invalid File Name Specified\";\t\t\treturn;\t\t}\t\t$result  =  move_uploaded_file($temp_name, $file_path);\t\tchmod($file_path, 0777);\t} else {\t\t$msg = \"no upload file\\n\";\t\tinclude \"include/error.php\";\t\treturn;\t}\tif (isset($_POST['pass_import']))\t\t$pass = $_POST['pass_import'];\t$SM = new SystemManager;\t$msg = $SM->Import_Export($ticket, $pass, 1, 0);\tif ($msg == \"OK\")\t\t$msg = $RESTART_MSG;\tinclude \"include/error.php\";\treturn;}if ($cmd == $LANG_EXPORT) {\tif (isset($_POST['pass_export']))\t\t$pass = $_POST['pass_export'];\t$SM = new SystemManager;\t$V = $SM->Import_Export($ticket, $pass, 2, $with_cert);\t$file_name = \"/data/upload/__ex_data__.bin\";\t/*\theader(\"Pragma: \"); \theader(\"Cache-Control: \"); \theader(\"Content-type: application/octet-stream\");  \theader(\"Content-Length: \".filesize($file_name));\theader(\"Content-Disposition: attachment; filename=\\\"sysbackup.bin\\\"\");\treadfile($file_name);\tunlink($file_name);\t */}?>\n\n$result = move_uploaded_file($temp_name, $file_path);\n $file_path 可控 \n$file_path = $CFG_UPLOAD_PATH.\"__im_data__.bin\";\n%00 截断 存在任意文件上传！！EXP:丢到测试代码里了！   漏洞证明：  案例：证明漏洞存在 直接传了info，exp在测试代码里面**.**.**.**/**.**.**.**/admin/system/11.php\n\nhttps://**.**.**.**/welcome_pop.phphttps://**.**.**.**/admin/system/11.php\n\n**.**.**.**/welcome_pop.php**.**.**.**/admin/system/11.php\n\nhttps://**.**.**.**/welcome_pop.php 北京交通大学https://**.**.**.**/admin/system/11.php\n\nhttps://**.**.**.**/welcome_pop.php  安徽财政电子政务系统https://**.**.**.**/admin/system/11.php\n\n都是是网神的哦，只是他有个功能能改页面中的logo，看箭头的小logo就是网神的标志：\n\n经过测试 影响网御神州、天融信、西安网赢、卫士通、吉大正元、美国凹凸、德国 ANIX等多家VPN厂商设备   修复方案：  !!!!   版权声明：转载请注明来源 Angle_G@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2016-01-13 10:15 厂商回复： 感谢白帽子提出的此漏洞，我们在收到信息后核实发现的确存在此问题，目前我们已针对此漏洞指定了相应的修复方案，并已开始对本次涉及的设备进行修复。请白帽子留下你的联系方式，我们将邮寄一份精美礼品以表示感谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-11 15:47 |    \t\tcuger \t\t\t( 普通白帽子  |\t\t\t        Rank:205 漏洞数:46        | 都说爱笑的人运气不会太差，废话，运气太差...)\t\t \n  V587    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}