{"id": 7369, "wybug_id": "wooyun-2013-037631", "wybug_title": "ecmall2.x修改任意管理员和用户密码", "wybug_corp": "ShopEx", "wybug_author": "Chora", "wybug_date": "2013-09-20 17:52", "wybug_open_date": "2013-12-19 17:52", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-09-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-09-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-09-25：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-11-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-11-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-12-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-12-19：\t细节向公众公开  简要描述： 修改密码时未进行权限验证,顺便求个礼物...求动力- -. 详细说明：  app/find_password.php\nfunction set_password()    {        if (!IS_POST)         {            ......                }        else //POST提交        {            if (empty($_POST['new_password']) || empty($_POST['confirm_password']))            {                $this->show_warning(\"unsettled_required\");                return ;            }            if (trim($_POST['new_password']) != trim($_POST['confirm_password']))             {                $this->show_warning(\"password_not_equal\");                return ;            }            $password = trim($_POST['new_password']);            $passlen = strlen($password);            if ($passlen < 6 || $passlen > 20)            {                $this->show_warning('password_length_error');                return;            }            $id = intval($_GET['id']);//虽然是过滤了,但是不影响利用.            $word = $this->_rand();            $md5word = md5($word);            $ms =& ms();        //连接用户系统            $ms->user->edit($id, '', array('password' => $password), true); //强制修改 !!问题就出在这儿,false是需要验证的,不知道程序员为什么要设置成非验证修改,偷懒也不是这么偷的吧...            if ($ms->user->has_error())            {                $this->show_warning($ms->user->get_error());                return;            }            $ret = $this->_password_mod->edit($id, array('activation' => $md5word));            $this->show_message(\"edit_success\",                'login_in', 'index.php?app=member&act=login',                'back_index', 'index.php');            return ;        }    }\nincludes/passports/default.passport.php\nfunction edit($user_id, $old_password, $items, $force = false)    {        if (!$force) //为false时需要验证,为ture时直接跳过执行下面的操作        {            $info = $this->get($user_id);            if (md5($old_password) != $info['password'])            {                $this->_error('auth_failed');                return false;            }        }        $edit_data = array();        if (isset($items['password']))        {            $edit_data['password']  = md5($items['password']);        }        if (isset($items['email']))        {            $edit_data['email'] = $items['email'];        }        if (empty($edit_data))        {            return false;        }        //编辑本地数据        $this->_local_edit($user_id, $edit_data);//跟进        return true;    }\nincludes/passport.base.php\nfunction _local_edit($user_id, $data)    {        $model_member =& m('member');        $model_member->edit($user_id, $data);\\\\执行update        return true;    }\n只需要POST提交new_password=123456&confirm_password=123456,当然不要忘了要修改的id,id是通过GET参数获得的.后台拿SHELL的话,见这篇 WooYun: ecmall 2.x通杀SQL注入至后台getshell   漏洞证明：  \n\n\n\n   修复方案：  改为false即可,当然第2个参数也要填写旧密码。   版权声明：转载请注明来源 Chora@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-09-22 11:15 厂商回复： 非常感谢您为shopex信息安全做的贡献我们将尽快修复非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-09-20 23:44 |    \t\tChora \t\t\t( 普通白帽子  |\t\t\t        Rank:337 漏洞数:22        | 生存、生活、生命。)\t\t \n  求组织(千万不要是党国)带走...    \n     2013-09-24 09:55 |    \t\texploits \t\t\t( 实习白帽子  |\t\t\t        Rank:69 漏洞数:17        | As We Do，As You Know !)\t\t \n  @Chora 来加入基友协会吧，受老习直接领导    \n     2013-11-01 22:49 |    \t\t再见江南 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 维护世界和平)\t\t \n  id是通过GET参数获得的这是啥意思呢，通过用户名能获取id吗？    \n     2013-11-02 10:40 |    \t\tChora \t\t\t( 普通白帽子  |\t\t\t        Rank:337 漏洞数:22        | 生存、生活、生命。)\t\t \n  @再见江南 你要修改哪个ID的密码，就要用GET方式提交那个ID。    \n     2013-11-06 18:39 |    \t\t再见江南 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 维护世界和平)\t\t \n  @Chora 有点不明白的地方就是如果ID是4，那他对应的用户名是什么呢，好像没办法查出来，如果对方网站有注入还能查出来，有些修改了id=1 不是admin也没办法进后台吧？    \n     2013-12-18 11:25 |    \t\t网络流氓 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 欢迎热爱网络安全的朋友技术交流QQ:1020471...)\t\t \n  测试中，修改ID=1 的ADMIN 账户，提示用户受保护。有基友遇到了这种情况了吗    \n     2013-12-18 11:32 |    \t\t再见江南 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 维护世界和平)\t\t \n  对啊，我也遇到了    \n     2014-01-22 21:57 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @网络流氓 废话，难道厂商确认了却没有修复？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}