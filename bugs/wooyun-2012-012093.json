{"id": 16738, "wybug_id": "wooyun-2012-012093", "wybug_title": "完美svn信息泄露&amp;某管理地址泄漏", "wybug_corp": "完美时空", "wybug_author": "QK.PenTesting", "wybug_date": "2012-09-12 19:10", "wybug_open_date": "2012-10-27 19:10", "wybug_type": "敏感信息泄露", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-09-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-09-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-09-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-10-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-10-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-10-27：\t细节向公众公开  简要描述： 我是QK，我不要当路人甲。.svn/entries小翻了下代码，找不到BUG，就不继续翻代码了 = =  详细说明：  http://esales.wanmei.com/e/.svn/entrieshttp://shendun.wanmei.com/.svn/entrieshttp://cookie.bi.wanmei.com/jsp/pvbi/.svn/entrieshttp://211.100.255.17/.svn/entrieshttp://211.100.255.18/.svn/entrieshttp://211.100.255.17:8080/.svn/entrieshttp://211.100.255.18:8080/.svn/entrieshttp://211.100.255.17/http://211.100.255.18/   漏洞证明：  test1231231231.jsp 源码试读。\n<%@page import=\"com.world2.esales.service.AutoCheckTaskNew\"%><%@ page language=\"java\" contentType=\"text/html; charset=GBK\"    pageEncoding=\"GBK\"%><%@ page import=\"com.world2.limit.*,com.world2.esales.dao.ConnectionPool,java.sql.*,java.io.*,com.world2.config.EsalesConfig,java.text.*,com.world2.esales.commons.util.*,java.util.*,com.world2.esales.dao.jdbc.BusinessOrderFormDAOImpl,com.world2.esales.dao.jdbc.UserStoreNewDAOImpl,com.world2.esales.module.UserStoreNew\"%><%AutoCheckTaskNew.getInstance().run();//ErrorInputCtrl.getInstance().getSafePassWDErrorLimit().remove(27013);System.out.println(\"end\");%><%!private void writeFile(String path, String name, String content)throws Exception {String fullName = path + \"/\" + name;try {File dirFile = new File(path);dirFile.mkdirs();File contFile = new File(fullName);FileOutputStream outStream = new FileOutputStream(contFile);PrintStream printStream = new PrintStream(outStream, false, \"GBK\");printStream.print(content);printStream.flush();printStream.close();} catch (Exception e) {e.printStackTrace(System.out);throw e;}}private void checkUserStoreNewSaleOut() {\tStringBuffer sb = new StringBuffer();\tStringBuffer alertMsg=new StringBuffer();\tList<UserStoreNew> difflist=new ArrayList<UserStoreNew>();\tint i=0;\ttry {\t\tList<UserStoreNew> userStoreNewList = UserStoreNewDAOImpl.getAllUserStoreNew();\t\tint diff;\t\tString problemMsg;\t\tfor (UserStoreNew userStoreNew : userStoreNewList) {\t\t\ti++;\t\t\tif(i%100==0){\t\t\t\tSystem.out.println(i);\t\t\t}\t\t\tdiff = UserStoreNewDAOImpl.getSumSaleOutAfter(userStoreNew\t\t\t\t\t.getUserid(), userStoreNew.getCardType())+ \t\t\t\t\tUserStoreNewDAOImpl.getSumSaleOutBefore(userStoreNew\t\t\t\t\t\t.getUserid(), userStoreNew.getCardType())\t\t\t\t\t- userStoreNew.getSaleoutNumber();\t\t\tif (diff != 0) {\t\t\t\tif ( (Math.abs(diff) > 100) && (userStoreNew.getCardType() < 3)) {\t\t\t\t\tdifflist.add(userStoreNew);\t\t\t\t}\t\t\t\tif ((Math.abs(diff) > 20 ) && (userStoreNew.getCardType() > 3)) {\t\t\t\t\tdifflist.add(userStoreNew);\t\t\t\t}\t\t\t}\t\t}\t\t\t\t//对于误差大的再算一遍\t\tint diffcount=0;\t\tfor(UserStoreNew u:difflist){\t\t    \tUserStoreNew userStoreNew=UserStoreNewDAOImpl.getUserStoreNewByUserIdAndCardType(u.getUserid(), u.getCardType());\t\t    \tdiff = UserStoreNewDAOImpl.getSumSaleOutAfter(userStoreNew\t\t\t\t.getUserid(), userStoreNew.getCardType())+ \t\t\t\tUserStoreNewDAOImpl.getSumSaleOutBefore(userStoreNew\t\t\t\t\t.getUserid(), userStoreNew.getCardType())- userStoreNew.getSaleoutNumber();    \t\t\tif (diff != 0) {    \t\t\t\tproblemMsg = \"userid=\" + userStoreNew.getUserid()    \t\t\t\t\t\t+ \", cardtype=\" + userStoreNew.getCardType()    \t\t\t\t\t\t+ \" has saleout difference. storeSaleout=\"    \t\t\t\t\t\t+ userStoreNew.getSaleoutNumber()    \t\t\t\t\t\t+ \", realsaleout=\"    \t\t\t\t\t\t+ (userStoreNew.getSaleoutNumber() + diff)    \t\t\t\t\t\t+ \",diff =\" + diff + \"\\r\\n<br/>\";    \t\t\t\tsb.append(problemMsg);    \t\t\t\t// generate alert email message    \t\t\t\tif ( (Math.abs(diff) > 100) && (userStoreNew.getCardType() < 3)) {    \t\t\t\t\talertMsg.append(problemMsg);    \t\t\t\t\tdiffcount++;    \t\t\t\t}    \t\t\t\t// generate alert email message    \t\t\t\tif ((Math.abs(diff) > 20 ) && (userStoreNew.getCardType() > 3)) {    \t\t\t\t\talertMsg.append(problemMsg);    \t\t\t\t\tdiffcount++;    \t\t\t\t}    \t\t\t}\t\t}\t\tif(diffcount==0){\t\t    alertMsg.append(\"sale out check no problem\");\t\t}\t\tSimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\t\tString savepath = EsalesConfig.getInstance().getLogPath(\"savepath\");\t\t// record userstore saleout diff\t\tthis.writeFile(savepath, sdf.format(new java.util.Date()) + \".log.2\", sb.toString());\t} catch (Exception e) {\t\te.printStackTrace();\t}}%>\n   修复方案：  你懂的。   版权声明：转载请注明来源 QK.PenTesting@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2012-09-17 09:18 厂商回复： 感谢QK.PenTesting对完美的关注，已通知相关人员进行处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-10-27 19:19 |    \t\tVty \t\t\t( 普通白帽子  |\t\t\t        Rank:199 漏洞数:37        )\t\t \n  怎么读源码    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}