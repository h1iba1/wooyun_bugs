{"id": 47443, "wybug_id": "wooyun-2014-086747", "wybug_title": "新浪某服务器getshell", "wybug_corp": "新浪", "wybug_author": "鸟云厂商", "wybug_date": "2014-12-11 08:55", "wybug_open_date": "2015-01-25 08:56", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向公众公开  简要描述： 新浪某服务器getshell 详细说明：  新浪某台服务器，论坛信息显示是新浪SHOW的一个外挂的论坛，可是为毛在新浪的C段上呵呵你们懂得。\n\nhttp://123.103.108.50/uc_server对应域名是http://bbs.uctools.net/uc_server密码是123456789重置管理员密码进了后台DZ3.1，但是貌似修复了。生成不了HTM本来想退出了，但是突发奇想，用了dz自带的文件校验工具，果然在未知文件里发现了不知道哪位留下的shell。0.php1.php2.php三个都在根目录下且密码都为a\n\n菜刀链接之，更呵呵了\n\n这尼玛不是外挂的网站吗为什么你新浪的业务也在上面/data0/web_root/vroom.show.sina.com.cn/www/inc/SSOCookie.class.php\n<?php/** * set & get cookie for sina.com.cn * cookie format:  [ uniqueid:userid:appgroup:displayname:gender:paysign ] */class SSOCookie {    const COOKIE_SUE = 'SUE';   //sina user encrypt info    const COOKIE_SUP = 'SUP';   //sina user plain info\tconst COOKIE_KEY_FILE = '/data0/web_root/client.show.sina.com.cn/www/inc/cookie.conf';\tprivate $_arrConf; // the infomation in cookie.conf\tpublic function __construct($config = self::COOKIE_KEY_FILE) {\t\tif(!$this->_parseConfigFile($config)){\t\t\tthrow new Exception(\"parse config file failed\");\t\t}else{\t\t\techo 14314;\t\t}\t}    public function getCookie(&$arrUserInfo) {        // 不存在密文cookie或明文cookie视为无效        if( !isset($_COOKIE[self::COOKIE_SUE]) ||            !isset($_COOKIE[self::COOKIE_SUP])) {                return false;\t\t\t}\n\n/**\t * SSO登录接口调用函数\t * \t * @param  $ip        客户端IP地址\t * @param  $pin       SSO接口调用PIN码\t * @param  $entry     项目代码\t * @param  $ag        用户类型\t * @param  $userId    用户ID\t * @param  $pwd       用户密码\t * @param  $url       SSO接口调用地址\t * @param  $succ      SSO接口调用结果集\t * @return $resultArr 返回结果(数组类型)\t */\tpublic static function ssoLogin($userId, $pwd){\t    $ip = $_SERVER['REMOTE_ADDR'];              // 客户端IP地址\t    $pin = '70269226506e773f52a5ed9471f1691c';  // PIN码\t    $entry = 'desktop';                         // 项目代码\t    $ag = '';                                   // 用户类型\t\t    $mchk = md5($userId.$ag.$pwd.$ip.$pin);       // 加密串\t\t$userId = rawurlencode($userId);\t    $pwd = rawurlencode($pwd);                  // 转换为统一字符编码\t    $url = (\"http://ilogin.sina.com.cn/api/chksso.php?entry={$entry}&user={$userId}&ag={$ag}&pw={$pwd}&ip={$ip}&m={$mchk}\"); // 接口调用地址\t    //Zend_Debug::dump($url);\t    $succ = file_get_contents($url);  // 接口调用结果\t\t// var_dump($succ);\t    //echo \"succ={$succ}<br>\";\t    $result = '';\t    parse_str($succ,$result);\t\t    foreach ($result as $key =>$value){\t    \t$result[$key] = urldecode($value);\t    }\t    \t    //Zend_Debug::dump($succ);\t    //print_r($result);    \t    return $result;\t}\t\t/**\t * 注入COOKIE\t * \t * @param  $str      SSO接口返回值\t * @param  $strOne   拆分字符串1\t * @param  $strTwo   拆分字符串2\t * @param  $strThree 拆分字符串3\t * @param  $delArray 删除数组内第1个元素\t */\tpublic static function setCookieStr($str) {\t\t$strOne = explode('Set-Cookie:',$str['cookies']);\t\t$delArray = array_shift($strOne);\t\t$cookie = array();\t\tforeach ($strOne as $key => $value) {\t\t\t$strTwo = explode('=',$value,2);\t\t\t$strThree = explode(';',$strTwo['1']);            //echo $strTwo['1'],\"<br>\";\t\t\t$cookieName = trim($strTwo['0']);\t\t\t$cookieValue = trim($strThree['0']);\t\t\t$cookie[$cookieName] = $cookieValue;            if (stripos($strTwo['1'],'httponly')){            \t$httponly = 1;                //echo $strTwo['0'];                //print_r($strThree);                //echo \"<br>\";            }else{            \t                $httponly = 0;            }            //echo \"cookieName=$cookieName,cookieValue=$cookieValue,$httponly<br>\";\t\t\tsetcookie($cookieName, $cookieValue, 0, \"/\", \"sina.com.cn\",0,$httponly);\t\t}\t\t//print_r($cookie);\t\treturn $cookie;\t}}\n\n<?phpdefine(\"AG\",1);define(\"AG_PIN\",'e22760687e1ad7132a84ebf21fc18490');define(\"AG_ENTRY\",'sinashow');define(\"AG_DOMAIN\",'.show.sina.com.cn');$cookie_key = array('v0'=>'v030f6b787dd6f37157e6a2493e83714a63f1438fc30217955ca3f8f952cdef4','v1'=>'v130f6b787dd6f37157e6a2493e83714a63f1438fc30217955ca3f8f952cdef4');class ShowSSO{\tpublic $_url = \"\";\tpublic $_host = \"http://login.show.sina.com.cn/\";\tpublic $_format = 'json';\tpublic $_Encrypt;\tpublic $_uid;\tpublic $_pwd;\tpublic $_ip;\tpublic $_ag;\tpublic $_ag_pin;\tpublic $_ag_entry;\tpublic $_request='cURL';\tpublic $_method='POST';\tpublic $_result='';\tfunction __construct($ag,$ag_pin,$entry,$uid,$pwd){//echo $pwd;\t\t\tif(!empty($ag))$this->_ag=$ag;\t\tif(!empty($ag_pin))$this->_ag_pin=$ag_pin;\t\tif(!empty($entry))$this->_ag_entry=$entry;\t\tif(!empty($uid))$this->_uid=$uid;\t\tif(!empty($pwd))$this->_pwd=$pwd;\n   漏洞证明：     修复方案：     版权声明：转载请注明来源 鸟云厂商@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-12-11 14:37 厂商回复： 感谢关注新浪安全，此为第三方业务，已通知修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}