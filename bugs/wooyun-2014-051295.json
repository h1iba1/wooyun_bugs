{"id": 58420, "wybug_id": "wooyun-2014-051295", "wybug_title": "XDcms Sql Injection 26-28", "wybug_corp": "www.xdcms.cn", "wybug_author": "HackBraid", "wybug_date": "2014-02-18 14:56", "wybug_open_date": "2014-05-19 14:57", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "6", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射", "源码审核", "注射漏洞利用技巧", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-19：\t细节向公众公开  简要描述： Sql Injection 详细说明：  注入在XDCMS企业管理系统后台的模型发布处，\\system\\modules\\xdcms\\model.php文件：管理员在发布模型和编辑模型的时候会分别调用model_add_save()和model_edit_save()函数，三个注入点就出现在这两个函数里：model_add_save()函数：\npublic function model_add_save(){\t\t$modelname=safe_html($_POST['modelname']);//safe_html可被大写绕过\t\t$modeltable=$_POST['modeltable'];//未过滤，直接注入\t\t$modeltable_content=get_content_table($modeltable);\t\t$is_lock=$_POST['is_lock'];\t\t$is_fixed=$_POST['is_fixed'];\t\tif(empty($modelname)||empty($modeltable)){\t\t\tshowmsg(C('material_not_complete'),'-1');\t\t}\t\tif(!check_str($modeltable,'/^[a-z0-9][a-z0-9]*$/')){\t\t\tshowmsg(C('table').C('numbers_and_letters'),'-1');\t\t}\t\t$tables=$this->mysql->show_table();\t\tif(in_array(DB_PRE.$modeltable,$tables)){\t\t\tshowmsg(C('table_exist'),'-1');\t\t}\t\tif(in_array(DB_PRE.$modeltable_content,$tables)){\t\t\tshowmsg(C('table_exist'),'-1');\t\t}\t\t$this->mysql->db_insert('model',\"`model_name`='\".$modelname.\"',`model_table`='\".$modeltable.\"',`is_lock`=\".$is_lock.\",`is_fixed`=\".$is_fixed);\t\t$field=\"`id` int(8) unsigned NOT NULL AUTO_INCREMENT,`catid` tinyint(5) unsigned NOT NULL DEFAULT '0',`title` char(80) NOT NULL,`thumb` char(100) NOT NULL,`keywords` char(40) NOT NULL,`description` char(255) NOT NULL,`commend` tinyint(1) unsigned NOT NULL DEFAULT '0',`url` char(100) NOT NULL,`userid` mediumint(8) unsigned NOT NULL DEFAULT '0',`username` char(20) NOT NULL,`inputtime` int(10) unsigned NOT NULL DEFAULT '0',`updatetime` int(10) unsigned NOT NULL DEFAULT '0',`hits` int(8) unsigned NOT NULL DEFAULT '0',`sort` int(8) unsigned NOT NULL DEFAULT '0',`style` char(20) default NULL,PRIMARY KEY (`id`)\";\t\t$field_content=\"id int(8) not null,PRIMARY KEY (`id`)\";\t\t$this->mysql->create_table($modeltable,$field);\t\t$this->mysql->create_table($modeltable_content,$field_content);\t\t$this->cache->model_cache();\t\tshowmsg(C('add_success'),'-1');\t}\nmodel_edit_save()函数：\npublic function model_edit_save(){\t\t$id=isset($_POST['id'])?intval($_POST['id']):0;\t\t$modelname=safe_html($_POST['modelname']);//可大写绕过\t\t$is_lock=$_POST['is_lock'];\t\t$is_fixed=isset($_POST['is_fixed'])?intval($_POST['is_fixed']):1;\t\tif(empty($modelname)){\t\t\tshowmsg(C('material_not_complete'),'-1');\t\t}\t\t$this->mysql->db_update(\"model\",\"`model_name`='\".$modelname.\"',`is_lock`=\".$is_lock.\",`is_fixed`=\".$is_fixed.\"\",\"`id`=\".$id);\t\t$this->cache->model_cache();\t\tshowmsg(C('update_success'),'-1');\t}\n   漏洞证明：  添加模型处以modelname为例，点击模型添加：\n\n抓包添加exp：\n\n成功：\n\n管理模型处modelname，点击编辑：\n\n抓包加exp：\n\n成功：\n\n   修复方案：  过滤！   版权声明：转载请注明来源 HackBraid@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-02-24 22:23 厂商回复： 存在没过滤 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}