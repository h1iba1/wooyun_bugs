{"id": 43828, "wybug_id": "wooyun-2014-081526", "wybug_title": "大米CMS多处XSS盲打后台", "wybug_corp": "damicms.com", "wybug_author": "xfkxfk", "wybug_date": "2014-11-01 15:40", "wybug_open_date": "2015-01-30 15:42", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-30：\t细节向公众公开  简要描述： 大米CMS多处XSS盲打后台 详细说明：  大米CMS多处XSS可以盲打后台，大米CMS后台的SQL注入一大堆，只要进了后台获取数据不成问题第一处文件/Web/Lib/Action/GuestbookAction.class.php\npublic function update()\t{\t//输出gb2312码,ajax默认转的是utf-8\t\theader(\"Content-type: text/html; charset=utf-8\");\t\tif(!isset($_POST['author']) or !isset($_POST['content']))\t\t{\t\t\talert('非法操作!',3);\t\t}\t//读取数据库和缓存\t\t$pl = M('guestbook');\t\t$config = F('basic','','./Web/Conf/');\t//相关判断\t\tif(Session::is_set('posttime'))\t\t{\t\t\t$temp = Session::get('posttime') + $config['postovertime'];\t\t\tif(time() < $temp)\t\t\t{\t\t\t\techo \"请不要连续发布!\";\t\t\t\texit;\t\t\t}\t\t}\t//准备工作\t\tif($config['bookoff'] == 0) $data['status'] = 0;\t//先解密js的escape\t\t$data['author'] = htmlspecialchars(unescape($_POST['author']));\t\t$data['content'] = htmlspecialchars(trim(unescape($_POST['content'])));\t\t$data['title'] = htmlspecialchars(trim(unescape($_POST['title'])));\t\t$data['tel'] = htmlspecialchars(trim(unescape($_POST['tel'])));\t\t$data['ip'] = get_client_ip();\t\t$data['addtime'] = date('Y-m-d H:i:s');\t//处理数据\t\tif($pl->add($data))\t\t{\t\t\tSession::set('posttime', time());\t\t\tif($config['bookoff'] == 0)\t\t\t{\t\t\t\techo '发布成功,留言需要管理员审核!';\t\t\t\texit;\t\t\t}\t\t\telse\t\t\t{\t\t\t\techo '发布成功!';\t\t\t\texit;\t\t\t}\t\t}\t\telse\t\t{\t\t\techo '发布失败!';\t\t\texit;\t\t}\t}\n这里$data['ip'] = get_client_ip();但是get_client_ip是没有处理任何XSS内容的发表文章时X-Forwarded_For可设置XSS payload，发表留言后，直接进入数据库，然后等管理员审核第二处文件/Web/Lib/Action/IndexAction.class.php\npublic function doreglink()\t{\t\theader(\"Content-type: text/html; charset=utf-8\");\t\t$data['title'] = $_POST['Title'];\t\t$data['url'] = $_POST['LinkUrl'];\t\t$data['logo'] = $_POST['LogoUrl'];\t\t$data['status'] = 0;\t\t$data['rank'] = 10;\t\t$link = M('link');\t\tif($link->add($data))\t\t{\t\t\techo \"<br/><br/><br/><font color=red>添加成功，等待审核！请在贵站加上本站链接。</font>\";\t\t}\t\telse\t\t{\t\t\techo \"<br/><br/><br/><font color=red>添加失败,请联系管理员!</font>\";\t\t}\t}\n这里的三个参数都没有过滤XSS申请链接后，等管理员审核   漏洞证明：  第一处发送留言时：\nX-Forwarded_For=\"><img/src=1 onerror=alert(1)>\n\n\n第二处：\n\n\n\n   修复方案：  remove_xss()   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2014-11-01 17:33 厂商回复： xss确认 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}