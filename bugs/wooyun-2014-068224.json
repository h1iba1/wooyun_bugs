{"id": 2856, "wybug_id": "wooyun-2014-068224", "wybug_title": "bilibili某分站有SQL注射漏洞", "wybug_corp": "bilibili.com", "wybug_author": "StarBrilliant", "wybug_date": "2014-07-17 12:42", "wybug_open_date": "2014-07-18 09:57", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "7", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-18：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： bilibili某分站有SQL注射漏洞，有一定可能性获取到用户密码 详细说明：  上次报告这个漏洞没有通过，估计是我填写得不够详细？如果这次再不通过我只有公开了。如果是乌云这边联系不上厂商，我要提醒一下，bilibili换域名了，从 .tv 改成 .com 了。==== 以下正文 ====bilibili某分站（画友 drawyoo h.bilibili.com）有SQL注射漏洞触发方法：打开 h.bilibili.com 在右上角搜索框内输入一个分号（'），点击搜索即报错。网页地址 http://h.bilibili.com/search?keyword=%27继续测试 '+OR+''=' 仍然报错，但是测试 '+OR+'a'=' 会返回空白结果，结果页出现了“搜索 \\'+OR+\\'a\\'=\\'”的双重转义的字样，所以可以判断确实是做了转义，但是由于没有使用成熟的转义库导致了有漏网之鱼。下面可以继续构造SQL注入字符串。根据我的推断，画友分站和bilibili主站运行在同一台服务器上，如果数据库被入侵可能导致上万密码被泄漏，后果不堪设想。==== 正文结束 ====我的测试到此为止，以不破坏为重，希望乌云和bilibili重视。有次我交的XSS漏洞bilibili竟然私自修复却没有给我回复。   漏洞证明：  出错信息，爆出 SQL 语句：\nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '''') limit 0,1' at line 1SELECT GROUP_CONCAT(il_id) as il_id FROM dr_illust_tag WHERE tag_id=(SELECT tag_id FROM dr_tag WHERE tag=''') limit 0,1;\n截图如下：\n\n==== 管理员请帮助我取回另一重要截图 ====另外，前几天我在提交 hash fd3b8129168a154fa9db959db290ba97 漏洞的时候，截图中有一个不同的出错信息，爆出了服务器文件名 /var/www/drawyoo/.../dbClass.php 和 .../500.htm 以及更多重要信息。可惜wooyun不让我取回那张图了。如果乌云这边的管理员可以帮助我取回那张图我不胜感激。   修复方案：  第一，转义！转义！转义！一定要用成熟的转义库！或者参数化查询。第二，避免双重转义。不要在输出的网页上出页反斜线！这是“转义不完备、网站有漏洞”的暗示！   版权声明：转载请注明来源 StarBrilliant@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-07-17 12:45 厂商回复： 此漏洞是在当天处理另一个独立事件时发现并修正的 最新状态： 2014-07-18：此漏洞是在当天处理另一个独立事件时发现并修正的  ", "replys": "漏洞评价：\n评论\n     2014-07-12 09:40 |    \t\treality0ne \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:7        )\t\t \n  老司机带我    \n     2014-07-12 12:22 |    \t\t小小泥娃 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:4        | 高二)\t\t \n  老司机我要飞    \n     2014-07-14 06:53 |    \t\tEv1l \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:20        | 问题真实存在但影响不大。联系邮箱security...)\t\t \n  求带，求共享！qq私信你了    \n     2014-07-14 15:45 |    \t\t洛克 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 哈哈)\t\t \n  b站要被沦陷了哈哈哈哈    \n     2014-07-14 15:52 |    \t\tStarBrilliant \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | (null))\t\t \n  B站站长第三次默默修好了漏洞却没有回应乌云……操    \n     2014-07-14 15:54 |    \t\tStarBrilliant \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | (null))\t\t \n  B站站长第三次默默修好了漏洞却没有回应乌云…… 操！ 看来以后还是直接利用最好。    \n     2014-07-14 15:54 |    \t\tStarBrilliant \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | (null))\t\t \n  哈哈！没有修干净！现在提示：<b>Warning</b>:  implode(): Invalid arguments passed in <b>/var/www/drawyoo/include/modules/class.Member.php</b> on line <b>41</b>    \n     2014-07-14 16:09 |    \t\tEv1l \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:20        | 问题真实存在但影响不大。联系邮箱security...)\t\t \n  @StarBrilliant 求洞洞地址私信我    \n     2014-07-14 16:14 |    \t\tStarBrilliant \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | (null))\t\t \n  @StarBrilliant 哎呀我忘了评论区是公开的了，不过好像这个提示信息里没有什么秘密信息就是了。    \n     2014-07-14 16:19 |    \t\tEv1l \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:20        | 问题真实存在但影响不大。联系邮箱security...)\t\t \n  @StarBrilliant 我去，敢不敢把连接给我看看~不和你抢    \n     2014-07-14 17:21 |    \t\tStarBrilliant \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | (null))\t\t \n  @Ev1l 45天后自然就公开了嘛。这么明显的SQL注射自己找一找也能找到的吧？虽然B站已经修复了但是引入了另一个bug所以我不能公开。    \n     2014-07-14 17:26 |    \t\tEv1l \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:20        | 问题真实存在但影响不大。联系邮箱security...)\t\t \n  @StarBrilliant 刚看，是同一个搜索框的漏洞么？    \n     2014-07-14 17:36 |    \t\tStarBrilliant \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | (null))\t\t \n  @Ev1l 不要在公开评论区讨论漏洞细节，即使B站已经修复这个漏洞了，你找我私信谈。    \n     2014-07-14 18:11 |    \t\tEv1l \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:20        | 问题真实存在但影响不大。联系邮箱security...)\t\t \n  @StarBrilliant 好的、、    \n     2014-07-15 10:14 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  http://h.bilibili.com/    \n     2014-07-15 16:03 |    \t\tCoxxs \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:8        | 节操数:233 | ww)\t\t \n  @StarBrilliant 你没提交到厂商..B站厂商在这里..www.wooyun.org/corps/%E4%B8%8A%E6%B5%B7%E5%B9%BB%E7%94%B5%E4%BF%A1%E6%81%AF%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8    \n     2014-07-15 16:07 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  @StarBrilliant 是的，哈哈 :)    \n     2014-07-15 20:17 |    \t\t橘子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | 呢个...羞射高中生一枚。带上大神@Haswell...)\t\t \n  sqlmap好像跑不出来？    \n     2014-07-18 13:22 |    \t\tThe soul \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:12        | ฏ๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎...)\t\t \n  @Ev1l  高手 我一眼就看到你了    \n     2014-07-20 18:13 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  发了两个礼物啊 :)2014-07-18\t上海哔哩哔哩动画有限公司 给 StarBrilliant 发送礼物2014-07-18\t上海哔哩哔哩动画有限公司 给 StarBrilliant 发送礼物    \n     2014-07-20 23:52 |    \t\t橘子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | 呢个...羞射高中生一枚。带上大神@Haswell...)\t\t \n  bilibili好大方...    \n     2014-07-21 21:48 |    \t\tStarBrilliant \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | (null))\t\t \n  @StarBrilliant @StarBrilliant 对6楼的致歉，看来是B站在修复另一个bug的时候意外补好的，而不是故意的。看在打算三次给我发送礼物的份上我也很感激啦（不过前几天没法提交我的联系方式，今天wooyun方面已经修复了）。    \n     2014-08-07 14:05 |    \t\tphantomer \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:4        | 菜比一个。求勿喷。)\t\t \n  老司机。    \n     2014-08-25 19:29 |    \t\t银冥币 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:21        | \"/upload/avatar/avatar_251_b.jpg\" />)\t\t \n  @StarBrilliant 此漏洞确实是另一个独立事件发现修复的....    \n     2014-08-25 19:29 |    \t\t银冥币 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:21        | \"/upload/avatar/avatar_251_b.jpg\" />)\t\t \n  @Ricter    \n     2014-08-26 18:55 |    \t\tRicter \t\t\t( 实习白帽子  |\t\t\t        Rank:59 漏洞数:15        | 渣渣一个)\t\t \n  @银冥币 嗷嗷冥币让我挖了下我就找到了另外两个洞然后给章鱼了    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}