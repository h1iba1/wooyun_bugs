{"id": 59550, "wybug_id": "wooyun-2013-046951", "wybug_title": "PHPSHE电商程序GETSHELL", "wybug_corp": "phpshe.com", "wybug_author": "xfkxfk", "wybug_date": "2013-12-25 10:01", "wybug_open_date": "2014-03-22 10:02", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意代码写入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-30：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-02-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-22：\t细节向公众公开  简要描述： PHPSHE电商程序GETSHELL 详细说明：  安装文件getshell来看看安装文件/install/index.php文件：\nif (isset($_p_pesubmit)) {\t\t\t$dbconn = mysql_connect(\"{$_p_db_host}:{$_p_db_port}\", $_p_db_user, $_p_db_pw);\t\t\tif (!$dbconn) pe_error('数据库连接失败...数据库ip，用户名，密码对吗？');\t\t\tif (!mysql_select_db($_p_db_name, $dbconn)) {\t\t\t\tmysql_query(\"CREATE DATABASE `{$_p_db_name}` DEFAULT CHARACTER SET utf8\", $dbconn);\t\t\t\t!mysql_select_db($_p_db_name, $dbconn) && pe_error('数据库选择失败...数据库名对吗？');\t\t\t}\t\t\tmysql_query(\"SET NAMES utf8\", $dbconn);\t\t\tmysql_query(\"SET sql_mode = ''\", $dbconn);\t\t\t$sql_arr = explode('/*#####################@ pe_cutsql @#####################*/', file_get_contents(\"{$pe['path_root']}install/phpshe.sql\"));\t\t\tforeach ($sql_arr as $v) {\t\t\t\t$result = mysql_query(trim(str_ireplace('{dbpre}', $_p_dbpre, $v)));\t\t\t}\t\t\tif ($result) {\t\t\t\tmysql_query(\"update `{$_p_dbpre}admin` set `admin_name` = '{$_p_admin_name}', `admin_pw` = '\".md5($_p_admin_pw).\"' where `admin_id`=1\", $dbconn);\t\t\t\t$config = \"<?php\\n\\$pe['db_host'] = '{$_p_db_host}'; //数据库主机地址\\n\\z$pe['db_name'] = '{$_p_db_name}'; //数据库名称\\n\\$pe['db_user'] = '{$_p_db_user}'; //数据库用户名\\n\\$pe['db_pw'] = '{$_p_db_pw}'; //数据库密码\\n\\$pe['db_coding'] = 'utf8';\\n\\$pe['url_model'] = 'pathinfo'; //url模式,可选项(pathinfo/pathinfo_safe/php)\\ndefine('dbpre','{$_p_dbpre}'); //数据库表前缀\\n?>\";\t\t\t\tfile_put_contents(\"{$pe['path_root']}config.php\", $config);\t\t\t\tpe_goto(\"{$pe['host_root']}install/index.php?step=success\");\t\t\t}\t\t\telse {\t\t\t\tpe_error('数据库安装失败！');\t\t\t}\t\t}\n这里的$_p_admin_name没有过滤直接进入数据库查询，存在sql注入。我们来利用这里的$_p_dbpre参数，也没有过滤，其他的参数也没有过滤但是不能更改否则会出现错误，因为会导致安装失败。$_p_dbpre就是数据库的前缀。\n\n正常的安装，提交的数据如下：\n\n我们来修改这里的$_p_dbpre参数：\n\n   漏洞证明：  看看config.php文件内容：\n\n访问一下config.php文件：\n\n利用方法：在安装时，修改参数$_p_dbpre如下：\n\n   修复方案：  过滤   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-03-22 10:02 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-04 16:04 |    \t\tMARCH0 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | B-TENS)\t\t \n  这个怎么就不补了    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}