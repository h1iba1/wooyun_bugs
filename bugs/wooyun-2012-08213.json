{"id": 18796, "wybug_id": "wooyun-2012-08213", "wybug_title": "爱丽27.cn源码下载", "wybug_corp": "爱丽", "wybug_author": "loopx9", "wybug_date": "2012-06-12 14:30", "wybug_open_date": "2012-07-27 14:30", "wybug_type": "系统/服务运维配置不当", "wybug_level": "低", "wybug_rank_0": "3", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码泄漏", "脚本文件未解析", "数据库密码泄漏", "源码泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-06-12：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2012-07-27：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： nginx应该是取消了php解析导致下载漏洞产生 详细说明：  php没有解析直接出源码.   漏洞证明：  \nhttp://www.27.cn/global.php\n\nhttp://www.27.cn/include/data.class.php\n\n<?php/** * [aili.com] (C)2001-2009 aili.com Inc. * This is NOT a freeware, use is subject to license terms * $RCFfile: data.class.php $ * $Revision: 1.1 $ * $Date: 2009/08/25 17:45:00 $ *//** * This is a class to database and create the thumbs for them. * require global.php data.class.php */if(!defined('IN_CMS')) {\texit('Access Denied');}class DBbase_Sql {\tvar $Host     = 'localhost';\tvar $Database = 'newcms';\tvar $User     = 'new27cn';\tvar $Password = 'FD%^%df5636FPEe6546PRVCME';\tvar $Link_ID  = 0;\tvar $Query_ID = 0;\tvar $Record   = array();\tvar $Row;\tvar $Errno    = 0;\tvar $Error    = \"\";\tvar $Auto_free   = 0;\tvar $Auto_commit = 0;\tfunction connect(){/*\t\tif ( 0 == $this->Link_ID ){\t\t\t$this->Link_ID=mysql_connect($this->Host, $this->User, $this->Password);\t\t\tif (!$this->Link_ID) {\t\t\t\t$this->halt(\"Link-ID == false, connect failed\");\t\t\t}\t\t\tif (!mysql_query(sprintf(\"use %s\",$this->Database),$this->Link_ID)) {\t\t\t\t$this->halt(\"cannot use database \".$this->Database);\t\t\t}\t\t}*/\t\tif ( 0 == $this->Link_ID ){\t\t\t$this->Link_ID=mysql_connect($this->Host, $this->User, $this->Password);\t\t\tif (!$this->Link_ID) {\t\t\t\t$this->halt(\"Link-ID == false, connect failed\");\t\t\t}\t\t\tif (!mysql_select_db($this->Database,$this->Link_ID)) {\t\t\t\t$this->halt(\"cannot use database \".$this->Database);\t\t\t}\t\t}\t\tif(!mysql_ping($this->Link_ID)) {\t\t mysql_close($this->Link_ID);\t\t$this->Link_ID = 0;\t\t$this->Link_ID = $this->connect();\t\t}\t}\tfunction query($Query_String){\t\t$this->connect();\t\tmysql_query(\"SET NAMES gbk\",$this->Link_ID);\t\t$this->Query_ID = mysql_query($Query_String,$this->Link_ID);\t\t$this->outputsql($Query_String);\t\t$this->Row = 0;\t\t$this->Error = $this->Database;\t\tif (!$this->Query_ID) {\t\t  $this->halt(\"Invalid SQL: \".$Query_String);\t\t}\t\treturn $this->Query_ID;\t}\tfunction outputsql($Query_String){\t\tif($_GET['sql_debug_open']=='debug'){\t\t\t@file_put_contents('sql.log',$Query_String.\"\\r\\n\",FILE_APPEND);\t\t}\t\t$this->Query_String=$Query_String;\t}\tfunction fetch_array(){\t\treturn mysql_fetch_array($this->Query_ID);\t}\tfunction next_record(){\t\t$this->Record = mysql_fetch_array($this->Query_ID);\t\t$this->Row += 1;\t\t$stat = is_array($this->Record);\t\tif (!$stat && $this->Auto_free) {\t\t\tmysql_free_result($this->Query_ID);\t\t\t$this->Query_ID = 0;\t\t}\t\treturn $stat;\t}\tfunction seek($pos){\t\t$status = mysql_data_seek($this->Query_ID, $pos);\t\tif ($status) {\t\t\t$this->Row = $pos;\t\t}\t\treturn;\t}\tfunction metadata($table){\t\t$count = 0;\t\t$id    = 0;\t\t$res   = array();\t\t$this->connect();\t\t$id = @mysql_list_fields($this->Database, $table);\t\tif ($id < 0) {\t\t\t$this->halt(\"Metadata query failed.\");\t\t}\t\t$count = mysql_num_fields($id);\t\tfor ($i=0; $i<$count; $i++) {\t\t\t$res[$i][\"table\"] = mysql_field_table ($id, $i);\t\t\t$res[$i][\"name\"]  = mysql_field_name  ($id, $i);\t\t\t$res[$i][\"type\"]  = mysql_field_type  ($id, $i);\t\t\t$res[$i][\"len\"]   = mysql_field_len   ($id, $i);\t\t\t$res[$i][\"flags\"] = mysql_field_flags ($id, $i);\t\t\t$res[\"meta\"][$res[$i][\"name\"]] = $i;\t\t\t$res[\"num_fields\"]= $count;\t\t}\t\tmysql_free_result($id);\t\treturn $res;\t}\tfunction affected_rows(){\t\treturn mysql_affected_rows($this->Link_ID);\t}\tfunction num_rows(){\t\treturn mysql_num_rows($this->Query_ID);\t}\tfunction num_fields(){\t\treturn mysql_num_fields($this->Query_ID);\t}\tfunction nf(){\t\treturn $this->num_rows();\t}\tfunction f($Name){\t\treturn $this->Record[$Name];\t}\tfunction pos(){\t\treturn $this->Row;\t}\tfunction instid(){\t\treturn mysql_insert_id($this->Link_ID);\t}\tfunction substr_cut($str_cut,$length = 30){  \t\tif (strlen($str_cut) > $length){ \t\t\tfor($i=0; $i < $length; $i++){ \t\t\t\tif (ord($str_cut[$i]) > 128){\t\t\t\t\t$i++;\t\t\t\t}\t\t\t\t\t$str_cut = substr($str_cut,0,$i); \t\t\t}\t\t\treturn $str_cut;\t\t}\t}\tfunction halt($message){\t\tprintf(\"System Maintenance......<br>Please wait Try.\".$message);\t} \tfunction escape_string($message){\t\treturn mysql_escape_string($message);\t} \tfunction strformat($message){\t\treturn stripslashes($message);\t}  \tfunction in_($message){\t\t$message = str_replace('&amp;','&',$message);\t\t$message = str_replace('&nbsp;',' ',$message);\t\t$message = str_replace('\"','&quot;',$message);\t\t$message = str_replace(\"'\",'&#39;',$message);\t\t$message = str_replace(\"<\",\"&lt;\",$message);\t\t$message = str_replace(\">\",\"&gt;\",$message);\t\t$message = str_replace(\"\\t\",\"&nbsp;&nbsp;\",$message);\t\t$message = str_replace(\"\\r\",\"\",$message);\t\t$message = str_replace(\" \",\"&nbsp;\",$message);\t\t$message=str_replace(\"(\",\"?\",$message);\t\t$message=str_replace(\")\",\"?\",$message);\t\t$message=addslashes($message);\t\treturn $message;\t} \tfunction out_($message){\t\t$message=str_replace(\"'\",\"?\",$message);\t\t$message=str_replace(\";\",\"?\",$message);\t\t$message=str_replace(\"(\",\" (\",$message);\t\t$message=str_replace(\")\",\"?\",$message);\t\t$message=ereg_replace(\" {2}\",\"&nbsp;&nbsp;\",nl2br(htmlspecialchars(stripslashes($message)))); \t\treturn $message;\t} \tfunction trimall(&$items){\t\t array_walk($items,\"trim_value\");\t}  \tfunction trim_value(&$value){ \t\t$value = trim($value); \t}\tfunction free_result(){\t\tmysql_free_result($this->Query_ID);\t}\tfunction close_mysql(){\t\tmysql_close($this->Link_ID);\t}}?>\n   修复方案：     版权声明：转载请注明来源 loopx9@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：7 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 7, "Ranks": null}