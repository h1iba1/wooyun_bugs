{"id": 10942, "wybug_id": "wooyun-2013-023167", "wybug_title": "简单绕过安全狗防护实现SQL注入检测", "wybug_corp": "安全狗", "wybug_author": "爱玩C", "wybug_date": "2013-05-06 15:41", "wybug_open_date": "2013-08-04 15:41", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-05-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-05-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-05-09：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-06-30：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-07-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-07-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-04：\t细节向公众公开  简要描述： 很多网站都安装了安全狗防护软件，我们在对这些网站进行SQL注入检测时会被拦截到。但是这个软件存在一个逻辑漏洞，可以无视安全狗的存在，实现SQL注入检测。 详细说明：  很多人做网站，装了WAF，肯定是会把搜索引擎的爬虫放到白名单里面，不然SEO就蛋疼了。 白名单意味着啥？？？ 就是说在白名单里面的用户，WAF都会不管它，直接放行，那我们就可以利用这个东西来绕过安全狗。 搜索引擎爬虫是在安全狗的白名单，我们只需要伪装成爬虫就OK了。 那安全狗是怎么判断爬虫的呢？？我测试了一下，发现他用的很普通的方法，就是user-agent。大家都知道这个东西很好伪造。   漏洞证明：  没有修改user-agent前，我们对一个安装了安全狗防护软件的网站进行SQL注入检测，会被安全狗拦截到。\n\n我们修改一下FireFox的User-Agent：在地址栏输入“about:config”，按下回车进入设置菜单。找到“general.useragent.override”，如果没有这一项，则点右键“新建”->“字符串”，输入这个字符串。将其值设为自己想要的UserAgent，比如百度爬虫蜘蛛的User-Agent：Baiduspider我们再次进行SQL注入检测，效果图如下，绕过了。\n\n很简单的方法，其实做WAF都是要照顾搜索引擎爬虫的，大家可以淫荡一下其他的WAF了。   修复方案：  你们懂得的。求邀请码   版权声明：转载请注明来源 爱玩C@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2013-05-06 18:22 厂商回复： 您好，感谢对安全狗的关注，该漏洞官方已从别处得知，在已经发布的新版网站安全狗3.0 beta版本中已做修复。安全狗用户可以通过以下方式解决：1）使用网站安全狗2.4版及以下版本的用户，关闭爬虫全局白名单功能；2）或者下载最新的3.0 beta版本进行覆盖安装。网站安全狗3.0版增加众多新功能，欢迎大家使用最新版本。同时，若发现有关安全狗的问题，欢迎与我们联系，邮箱web#safedog.cn，我们将根据漏洞价值予以奖励，感谢，我们会更加努力完善自己 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-05-06 15:41 |    \t\tsysALong \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:5        | 电脑里的AV片 永远 和 电脑旁的卫生纸 成 ...)\t\t \n  我唯一能说的，就是  你妹。    \n     2013-05-06 15:43 |    \t\t小猪 \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:10        )\t\t \n  http://www.freebuf.com/articles/web/9178.html耳光拿好，不谢    \n     2013-05-06 16:14 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  啪啪啪啪，十天不谢！@彩色哥    \n     2013-05-06 16:18 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  为啥能审核过呢？求解、、、    \n     2013-05-06 16:34 |    \t\t落叶纷飞 \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:1        | im luoye,Once the 00day.cn)\t\t \n  看到楼主，我发现我的RP很赞    \n     2013-05-06 16:56 |    \t\t无我 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:5        | 我是无我)\t\t \n  这个问题，已经提交了很多次了！安全狗本来就很垃圾    \n     2013-05-06 16:57 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  你特么的盗取我亲爱的@Seay 版权。 我很生气！    \n     2013-05-06 17:14 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  洞主，你那个不是之前公开的那个？确定？？？？？    \n     2013-05-06 17:27 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  撸主我找了好几个网吧，终于找到你了！你又在这里吹牛逼了。工头到处找你，叫你赶紧回工地去，还有两车水泥要卸，工头说再不回去你那10天300块多工钱一份都别想拿到。还有村长来电话了，叫我告诉你，隔壁村的王寡妇来你家提亲了，叫你明天赶紧结工钱回去和她把婚事给办了    \n     2013-05-06 17:43 |    \t\tiiiiiiiii \t\t\t( 普通白帽子  |\t\t\t        Rank:680 漏洞数:89        | )\t\t \n  撸主我找了好几个网吧，终于找到你了！你又在这里吹牛逼了。工头到处找你，叫你赶紧回工地去，还有两车水泥要卸，工头说再不回去你那10天300块多工钱一份都别想拿到。还有村长来电话了，叫我告诉你，隔壁村的王寡妇来你家提亲了，叫你明天赶紧结工钱回去和她把婚事给办了    \n     2013-05-06 18:46 |    \t\tsysALong \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:5        | 电脑里的AV片 永远 和 电脑旁的卫生纸 成 ...)\t\t \n  撸主我找了好几个网吧，终于找到你了！你又在这里吹牛逼了。工头到处找你，叫你赶紧回工地去，还有两车水泥要卸，工头说再不回去你那10天300块多工钱一份都别想拿到。还有村长来电话了，叫我告诉你，隔壁村的王寡妇来你家提亲了，叫你明天赶紧结工钱回去和她把婚事给办了    \n     2013-05-06 20:30 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  撸主我找了好几个网吧，终于找到你了！你又在这里吹牛逼了。工头到处找你，叫你赶紧回工地去，还有两车水泥要卸，工头说再不回去你那10天300块多工钱一份都别想拿到。还有村长来电话了，叫我告诉你，隔壁村的王寡妇来你家提亲了，叫你明天赶紧结工钱回去和她把婚事给办了艹 这都能有Rank：5    \n     2013-05-07 00:38 |    \t\tSeay \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:8        )\t\t \n  撸主我找了好几个网吧，终于找到你了！你又在这里吹牛逼了。工头到处找你，叫你赶紧回工地去，还有两车水泥要卸，工头说再不回去你那10天300块多工钱一份都别想拿到。还有村长来电话了，叫我告诉你，隔壁村的王寡妇来你家提亲了，叫你明天赶紧结工钱回去和她把婚事给办了     \n     2013-05-08 02:12 |    \t\t范特西 \t\t\t( 实习白帽子  |\t\t\t        Rank:46 漏洞数:5        | 我是菜鸟)\t\t \n  广大论坛就应该封杀你这种人，一拿到人家研究的漏洞就来发。没RP。    \n     2013-05-15 15:28 |    \t\tAofa \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | check it out yo)\t\t \n  @爱玩C 撸主我找了好几个网吧，终于找到你了！你又在这里吹牛逼了。工头到处找你，叫你赶紧回工地去，还有两车水泥要卸，工头说再不回去你那10天300块多工钱一份都别想拿到。还有村长来电话了，叫我告诉你，隔壁村的王寡妇来你家提亲了，叫你明天赶紧结工钱回去和她把婚事给办了     \n     2013-05-22 11:29 |    \t\t彩色哥 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:1        | D8是我的天下！)\t\t \n  @围剿 已封，10天循环！    \n     2013-07-06 21:00 |    \t\tJOKER96 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:2        | 95后菜鸟)\t\t \n  撸主我找了好几个网吧，终于找到你了！你又在这里吹牛逼了。工头到处找你，叫你赶紧回工地去，还有两车水泥要卸，工头说再不回去你那10天300块多工钱一份都别想拿到。还有村长来电话了，叫我告诉你，隔壁村的王寡妇来你家提亲了，叫你明天赶紧结工钱回去和她把婚事给办了    \n     2013-08-04 16:07 |    \t\t偉哥 \t\t\t( 实习白帽子  |\t\t\t        Rank:67 漏洞数:11        | 哥是没帽子)\t\t \n  撸主我找了好几个网吧，终于找到你了！你又在这里吹牛逼了。工头到处找你，叫你赶紧回工地去，还有两车水泥要卸，工头说再不回去你那10天300块多工钱一份都别想拿到。还有村长来电话了，叫我告诉你，隔壁村的王寡妇来你家提亲了，叫你明天赶紧结工钱回去和她把婚事给办了    \n     2013-08-05 23:39 |    \t\t李旭敏 \t\t\t( 普通白帽子  |\t\t\t        Rank:469 漏洞数:71        | ฏ๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎...)\t\t \n  这种事情我也干过，不过我还是鄙视一下洞主，至少给个版权把···    \n     2013-08-09 15:01 |    \t\tcolgator \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:2        | xxoo，搞基比较好)\t\t \n  @无我 求大牛笼罩，给点技术~~安全狗作实蛋疼    \n     2013-08-29 15:01 |    \t\tD_r0ck \t\t\t( 实习白帽子  |\t\t\t        Rank:36 漏洞数:3        | 可能是最帅的歌~)\t\t \n  宇宙第一黑客啊    \n     2013-11-11 23:23 |    \t\tcmdshell \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:9        )\t\t \n  撸主我找了好几个网吧，终于找到你了！你又在这里吹牛逼了。工头到处找你，叫你赶紧回工地去，还有两车水泥要卸，工头说再不回去你那10天300块多工钱一份都别想拿到。还有村长来电话了，叫我告诉你，隔壁村的王寡妇来你家提亲了，叫你明天赶紧结工钱回去和她把婚事给办了    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}