{"id": 20326, "wybug_id": "wooyun-2012-06799", "wybug_title": "Discuz NT多个版本文件上传漏洞", "wybug_corp": "Discuz!", "wybug_author": "I_S_T_O", "wybug_date": "2012-05-08 00:20", "wybug_open_date": "2012-05-13 00:20", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-05-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-05-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Discuz NT多个版本文件上传漏洞文章作者：rebeyond注：文章首发I.S.T.O信息安全团队，后由原创作者友情提交到乌云-漏洞报告平台。I.S.T.O版权所有，转载需注明作者。 详细说明：  漏洞文件:tools/ajax.aspx 漏洞分析:这个页面里的ajax请求，都没有进行权限的验证，游客权限就可以调用其中的所有方法，很危险的写法，于是有了下面的漏洞。\n\n当filename和upload两个参数同时不为空时，取得input的值，并解密生成uid，然后调用UploadTempAvatar(uid)上传头像，继续跟进方法UploadTempAvatar:\n\n在方法内部对上传文件的文件名进行字符串组装，其中uid是我们可以控制的，所以可以通过让uid取值为”test.asp;”，组装后的文件名是avatar_test.asp;.jpg，这样上传后的文件IIS6便会直接执行，得到webshell。   漏洞证明：  实例演示：1.      目标站：http://www.xxxxer.net2.      伪造reference,因为ajax这个页面只对reference进行了验证。3.      构造input参数的值，因为我们的目标是为uid赋值”test.asp;”，uid为input解密而来，通过默认Passwordkey(位于/config/general.config中)，对”test;.asp”加密得到input的值”Jw6IIaYanY7W0695pYVdOA==”。4.      构造请求参数：\n\n上传成功后会直接把shell地址回显出来，\n\n成功获得webshell:\n\n不过在实际测试中，有部分不能成功，懒得找原因了，有兴趣的同学继续研究一下吧^.^，截个官网的截图留个念：\n\n   修复方案：  您懂的，by I_S_T_O rebeyond   版权声明：转载请注明来源 I_S_T_O@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2012-05-13 00:20 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-05-08 00:29 |    \t\t北北 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:5        | 广告位招租。有阿里、万网的漏洞私信给我有...)\t\t \n  mark    \n     2012-05-08 00:50 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  关注    \n     2012-05-08 02:04 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  mark 之     \n     2012-05-08 08:37 |    \t\tJannock  \t\t\t( 核心白帽子 |\t\t\t        Rank:2278 漏洞数:204        | 关注技术与网络安全（招人中，有兴趣请私信...)\t\t \n  打广告？^_^  wooyun可以考虑增加团队帐号了。嘻嘻。。。    \n     2012-05-08 09:01 |    \t\tP w \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:14        | -这家伙很懒,什么都没有留下。其实我真的很...)\t\t \n  mark...    \n     2012-05-08 09:03 |    \t\tCnCxzSec(衰仔) \t\t\t( 普通白帽子  |\t\t\t        Rank:322 漏洞数:32        | Wow~~~)\t\t \n  好久没见ISTO。。    \n     2012-05-08 09:03 |    \t\tCnCxzSec(衰仔) \t\t\t( 普通白帽子  |\t\t\t        Rank:322 漏洞数:32        | Wow~~~)\t\t \n  请kj上图    \n     2012-05-08 09:13 |    \t\t少帅 \t\t\t( 实习白帽子  |\t\t\t        Rank:59 漏洞数:14        )\t\t \n  等 .    \n     2012-05-08 09:49 |    \t\t松子 \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:5        | 无事)\t\t \n  坐等。    \n     2012-05-08 11:03 |    \t\tkj021320 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 法克鱿，草泥马)\t\t \n  不是我，是 rebeyond提交的  -_-    \n     2012-05-08 11:17 |    \t\tI_S_T_O \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | I_S_T_O)\t\t \n  @Jannock 非专业漏洞挖掘，只能以team形式发布，这才显得不孤单 啊哈哈    \n     2012-05-08 11:18 |    \t\tI_S_T_O \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | I_S_T_O)\t\t \n  @CnCxzSec(衰仔) 请KJ上xxoo大图    \n     2012-05-08 11:24 |    \t\tsaga \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 世界上只有10种人，懂二进制的，和不懂二进...)\t\t \n  这个需要关注下，团队的力量    \n     2012-05-08 11:27 |    \t\t葉孒 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:5        | 呵呵)\t\t \n  坐等细节     \n     2012-05-08 11:37 |    \t\tRa1nker \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | TeST)\t\t \n  http://whhacker.blog.51cto.com/298713/856639    \n     2012-05-08 11:45 |    \t\tJannock  \t\t\t( 核心白帽子 |\t\t\t        Rank:2278 漏洞数:204        | 关注技术与网络安全（招人中，有兴趣请私信...)\t\t \n  其实这个并不通用，Passwordkey在正常安装时会重新生成的。估计你拿的都是用源码安装的吧。不过还有其他办法利用系统的生成。    \n     2012-05-08 12:15 |    \t\tCnCxzSec(衰仔) \t\t\t( 普通白帽子  |\t\t\t        Rank:322 漏洞数:32        | Wow~~~)\t\t \n  @kj021320 请kj上图   ps:wooyun上懂这几个字含义的不多啊。。    \n     2012-05-08 12:29 |    \t\tkj021320 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 法克鱿，草泥马)\t\t \n  @CnCxzSec(衰仔) 评论不能发图    \n     2012-05-08 12:39 |    \t\titleaf \t\t\t( 普通白帽子  |\t\t\t        Rank:140 漏洞数:17        )\t\t \n  膜拜    \n     2012-05-08 13:46 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  NB大了。    \n     2012-05-08 15:25 |    \t\tking \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:2        | 喜爱安全，网络游戏安全应用漏洞挖掘)\t\t \n  这好多年前的漏洞了，100%是成功的，，不过官方貌似是不支持asp解析的！！！！    \n     2012-05-08 15:27 |    \t\tking \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:2        | 喜爱安全，网络游戏安全应用漏洞挖掘)\t\t \n   WooYun: 凡客诚品配合dxoday和列目录漏洞可导致直接入侵  跟这个一样的，，上传任意文件的！！！    \n     2012-05-08 17:21 |    \t\tlivers \t\t\t( 实习白帽子  |\t\t\t        Rank:94 漏洞数:6        | mov esp,0jmp espcrash.....)\t\t \n  @Jannock 确实是这样。    \n     2012-05-08 18:43 |    \t\t自由与精神 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:5        | 缺乏精神力量，但我向往自由)\t\t \n  @Jannock 求解“不过还有其他办法利用系统的生成。”    \n     2012-05-08 18:44 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @自由与精神 利用同样的算法呗    \n     2012-05-08 22:56 |    \t\tccSec \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:4        | ^^)\t\t \n  @Jannock 发现了利用系统的生成的办法，不过有点鸡肋，不知道找的是不是同一个点。。。    \n     2012-05-09 22:03 |    \t\t自由与精神 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:5        | 缺乏精神力量，但我向往自由)\t\t \n  @xsser ... 能不能说点实际的    \n     2012-05-09 22:03 |    \t\t自由与精神 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:5        | 缺乏精神力量，但我向往自由)\t\t \n  @ccSec 公布出来看看    \n     2012-05-10 09:18 |    \t\tccSec \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:4        | ^^)\t\t \n  @自由与精神 等补丁出来后再说吧:)    \n     2012-05-13 04:08 |    \t\t0xsec \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 0xSec Team)\t\t \n  Good.    \n     2012-05-13 06:51 |    \t\tz@cx \t\t\t( 普通白帽子  |\t\t\t        Rank:434 漏洞数:56        | 。-。-。)\t\t \n  沦陷多骚站。。。    \n     2012-10-31 18:31 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  这个牛逼~翻到这里了~~    \n     2013-01-05 23:34 |    \t\t黑匣子 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:17        | 我是一个有思想的菜鸟！)\t\t \n  make    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}