{"id": 1083, "wybug_id": "wooyun-2014-066866", "wybug_title": "代码审计系列8: 蝉知企业门户2.4正式版 猥琐获取管理员账户密码", "wybug_corp": "chanzhi.org", "wybug_author": "LaiX", "wybug_date": "2014-07-01 17:40", "wybug_open_date": "2014-09-29 18:34", "wybug_type": "敏感信息泄露", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-29：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 青岛息壤网络信息有限公司成立于2013年，由禅道软件公司青岛易软天创全资投资创办，位于美丽的青岛开发区，团队成员拥有丰富的网站设计、系统研发、服务器维护和SEO经验。我们正在打造一款开源免费的企业门户系统，以帮助企业建立品牌网站，进行宣传推广、市场营销、产品销售和客户跟踪。息壤，为天下企业提供专业的营销工具！ 详细说明：  蝉知企业门户系统在安装完成后会在 \\system\\tmp\\log\\ 下生成类似 \n\n的两个文件.我们打开 sql.20140701.log 内容如下：\n20140701 13:28:01: /install.php20140701 13:28:04: /install.php?m=install&f=step120140701 13:28:06: /install.php?m=install&f=step220140701 13:28:13: /install.php?m=install&f=step320140701 13:28:14: /install.php?m=install&f=step320140701 13:28:22: /install.php?m=install&f=step320140701 13:28:22: /install.php?m=install&f=step420140701 13:28:27: /install.php?m=install&f=step4  INSERT INTO eps_user SET `account` = 'admin',`realname` = 'admin',`password` = '86f3059b228c8acf99e69734b6bb32cc',`admin` = 'super',`join` = '2014-07-01 13:28:27'  REPLACE eps_config SET `owner` = 'system',`module` = 'common',`section` = 'global',`key` = 'version',`value` = '2.4'20140701 13:28:27: /install.php?m=install&f=step5  REPLACE eps_config SET `owner` = 'system',`module` = 'common',`section` = 'site',`key` = 'lang',`value` = 'zh-cn'\n可以发现在程序安装的时候将之前设置的管理员账户密码的SQL命令写入了这个Log文件。具体代码在 system\\framework\\router.class.php 的第 1602 行\npublic function saveSQL()    {        if(!class_exists('dao')) return;        $sqlLog = $this->getLogRoot() . 'sql.' . date('Ymd') . '.log';        $fh = @fopen($sqlLog, 'a');        if(!$fh) return false;        fwrite($fh, date('Ymd H:i:s') . \": \" . $this->getURI() . \"\\n\");        foreach(dao::$querys as $query) fwrite($fh, \"  $query\\n\");        fwrite($fh, \"\\n\");        fclose($fh);    }\n可以发现文件名是根据当时安装的日期命名的。那我们可否通过获取某些远程文件的最后创建日期来找确定安装日期，从而找到这个LOG文件呢。   漏洞证明：  通过上面的分析，试着找一个案例。\n\n\n\n通过官网上的论坛找到了一个案例。然后我们尝试得到安装的日期，这里可以通过观察响应头文件中的If-Modified-Since参数 找到。\n\n得知日期后，我们构造如下URL:\nhttp://www.sdled.net/system/tmp/log/sql.20140628.log\n\n\n可以看见管理员的账号和MD5后的密码瞬间暴露出来。   修复方案：  这个日志文件有点多余   版权声明：转载请注明来源 LaiX@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：2  确认时间：2014-07-01 18:12 厂商回复： 感谢Laix的细心审计，已经确认。近期会发布一个版本修复该问题。 最新状态： 2014-07-01：我们近期会发布一个版本，日志改为php格式结尾的来记录。同时升级的时候删除之前的日志。也会给用户相应的安全提示。 2014-08-09：蝉知系统有两个目录system, www，www是所有对外公开请求文件的目录。考虑到有很多虚拟机的用户，这样的目录结构部署起来不方便。所以可以将system下面的文件拷贝到www目录下面。这样部署方便，但理论上来讲其他用户就可以通过http访问到system下面的文件。蝉知系统的密码是做过加盐处理的。最新的2.5版本已经增强了日志的管理。  ", "replys": "漏洞评价：\n评论\n     2014-07-01 17:46 |    \t\txy小雨 \t\t\t( 普通白帽子  |\t\t\t        Rank:171 漏洞数:50        | 成为海贼王的男人)\t\t \n  mark    \n     2014-07-01 18:05 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  这个cms我也看了。。没看出什么来。，mark下    \n     2014-07-01 19:20 |    \t\tXser \t\t\t( 普通白帽子  |\t\t\t        Rank:194 漏洞数:61        | JDSec)\t\t \n  表示这个系统很难挖，mark    \n     2014-07-05 23:18 |    \t\t魂淡、 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 么么哒)\t\t \n  根据厂商的回复应该是跟日志记录有关了    \n     2014-07-06 20:59 |    \t\tKnight \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:10        | 刚刚上洗手间，看到一个玉树临风的少年，气...)\t\t \n  从厂商的回复我已经知道是怎么回事了。    \n     2014-07-21 21:36 |    \t\tsec_jtn \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:56        | 本想无耻的刷rank，最后发现是我想太多了。...)\t\t \n  牛逼    \n     2014-08-09 20:54 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  @青岛易软天创网络科技有限公司  WooYun: 蝉知企业门户系统 v2.5 sql 注入至管理员。 新厂商什么的最喜欢了    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}