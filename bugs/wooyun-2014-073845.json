{"id": 305, "wybug_id": "wooyun-2014-073845", "wybug_title": "某社会化分享按钮及分享代码提供商官网SQL注入导致公司内部信息及大量客户信息泄漏", "wybug_corp": "JiaThis", "wybug_author": "Walnut King", "wybug_date": "2014-09-17 12:20", "wybug_open_date": "2014-11-01 12:22", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["字符类型注射", "管理后台对外", "后台被猜解", "注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-01：\t细节向公众公开  简要描述： 成因：过期（3年前）抽奖活动页面中出现SQL注入危害：1.用户数据泄漏2.公司内部信息泄漏3.网站后台管理员信息泄漏（可控制客户信息及获取运营数据） 详细说明：  加网主页www.jiathis.com某过期活动页面可导致sql注入（POST方式），仅jiathis业务有近50w条客户数据泄漏。后台管理权限泄漏，可更改任意用户信息及运营数据。注入页面是偶然发现的某过期活动页面，这种页面属于长期被遗忘在角落的东西，定期安全检查及代码更新应该覆盖不到，感觉可能存在漏洞http://www.jiathis.com/event/iphone5/恰巧在下图位置发现数据提交框，尝试输入注入数据验证一下，发现提交按钮已锁定，此路不通。\n\n但我仍然不死心，在页面代码中找到了遗留的js脚本：\nfunction getwinner(type) {\t\tif(type != 1) {\t\t\tsetTimeout(function() {\t\t\t\t$('#div-show'+type).hide();\t\t\t},10000);\t\t}\t\tvar domain = $('input[name=domain'+type+']').val();\t\tvar uid = $('input[name=uid'+type+']').val();\t\t$('span[id^=winner'+type+'_]').attr('class','');\t\tif(domain != '' || uid != '') {\t\t\tvar data = '';\t\t\tif(domain != '' && uid != '') {\t\t\t\tdata = \"domain=\"+domain+\"&uid=\"+uid;\t\t\t} else {\t\t\t\tdata = domain ? \"domain=\"+domain : \"uid=\"+uid;\t\t\t}\t\t\t$.ajax({\t\t\t\t'type':'post',\t\t\t\t'url': \"http://www.jiathis.com/event/searchwinner/\"+type,\t\t\t\t'data':data,\t\t\t\t'success':function(msg) {\t\t\t\t\tvar str = '';\t\t\t\t\tif(msg == 'no') {\t\t\t\t\t\tstr = '咦，亲，本次没有找到你的UID哦。看来你需要抽取后面的大奖喽，加油！';\t\t\t\t\t} else {\t\t\t\t\t\t$('#winner'+type+'_'+msg).addClass('winner');\t\t\t\t\t}\t\t\t\t}\t\t\t});\t\t} else {\t\t\tif(type == 3) {\t\t\t\t$('#div-show'+type).html('请输入邮箱或者UID').show();\t\t\t}\t\t}\t}\n随即直验证该post请求，果然发现一sql注入漏洞。虽然页面屏蔽按钮但请求接口依然存在。以后就是用sqlmap验证并挖掘信息，详见以下：1.sqlmap对注入点验证：\n\n2.按业务划分数据库表：\n\n3.每个表中均有管理员及用户信息：\n\n4.jiathis客户信息数量\n\n5.部分客户信息\n\n6.管理员权限设置json串中可见网站结构信息，据此可推测网站后台路径\n\n7.管理员表中密码存在弱口令，可据此登录网站后台，后台页面：\n\n\n\n可登录多个系统后台。由于后台不稳定，担心影响公司正常业务，未尝试上传webshell，若webshell上传成功有快速拖库风险。   漏洞证明：  \n\n   修复方案：  1.过期页面处理请及时且彻底。2.管理员修改弱口令（杜绝纯数字、8位以下密码）。3.多业务不公用数据库，数据库权限分配合理。另：网站服务器https端口打开，如果不是正常业务请关闭。   版权声明：转载请注明来源 Walnut King@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-09-17 13:45 厂商回复： 漏洞的页面存在于早前已下线的活动页面，比较隐蔽，现已修复，感谢白帽子。 最新状态： 2014-09-17：需要说明一下，用户密码等隐私数据，我们全部进行了加盐(salt)处理，这方面是安全的。对个别的弱口令网站管理员帐号，我们进行了相应的处理。  ", "replys": "漏洞评价：\n评论\n     2014-08-26 17:18 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  自身流量就非常高，好厉害    \n     2014-08-26 18:35 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  这个值得关注下，社会化分享，又是个第三方坑    \n     2014-09-17 14:23 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  加盐(salt)也是有规则的，有些也是可以解密的，应该与小米、电玩巴士的加密方式如出一辙    \n     2014-09-17 15:38 |    \t\t北京加网时代科技有限公司(乌云厂商)\t\t \n  @浩天 每个用户有自己独立的salt，然后再单向哈希加密。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}