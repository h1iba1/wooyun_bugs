{"id": 16426, "wybug_id": "wooyun-2012-012647", "wybug_title": "软酷网任意文件上传漏洞", "wybug_corp": "软酷网", "wybug_author": "路人甲", "wybug_date": "2012-09-24 17:59", "wybug_open_date": "2012-11-08 18:00", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-09-24：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2012-11-08：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 软酷网任意文件上传漏洞，可以导致上传shell，并导致服务区沦陷服务器安全配置也存在很大问题，直接是root权限 详细说明：  上传时只是通过js控制了上传的类型，服务端并没有对文件扩展名进行控制和判断\n$(document).ready(function() {\t\tdocument.getElementById(\"logo\").focus();\t\t$(\"#uploadify\").uploadify({\t\t\t\t  \t\t\t'uploader'       : 'http://coolteam.ruanko.com:80/resources/uploadify.swf',\t\t\t'script'         : 'http://coolteam.ruanko.com:80//doUpLoadToTemp.jsp',\t\t\t'method'         : 'GET',\t\t\t'cancelImg'      : 'http://coolteam.ruanko.com:80/resources/images/cancel.png',\t\t\t'folder'         : 'uploads',\t\t\t'buttonImg'      : 'http://coolteam.ruanko.com:80/resources/images/liulan.png',\t\t\t'width'          : 63,\t\t\t'height'         : 18,\t\t\t'queueID'        : 'fileQueue',\t\t\t'auto'           : true,\t\t\t'multi'          : false,   \t\t\t\t\t\t\t'sizeLimit'      : 409600,  \t\t\t'fileExt'        : '*.jpg;*.jpeg;*.gif;*.bmp;*.png', \t\t\t'fileDesc'       : '请选择jpg jpeg gif bmp png文件',\t\t\t'scriptData'     : {'uploadPath':'uploadTemp','upperFileName':''},        \t\t\tonComplete: function (event, queueID, fileObj, response, data) {\t\t\t\t    var value = response ;\t\t\t    \t\t    \t$(\"#logo\").val(value);\t\t\t    \tdocument.getElementById(\"logo\").focus();\t\t    \t\t\t    \t$(\"#uploadify\").uploadifySettings('scriptData',{'uploadPath':'uploadTemp','upperFileName':value});   \t   \t\t   \t\t    \t//$(\"#uploadLogoInfo\").html(\"<img  height='80' width='80' src='http://coolteam.ruanko.com:80/uploadTemp/2012-09-21/\"+value+\"' style='border: 2px solid #b8b8b8;'/>\");\t【亮点在这里，这里可以推测出上传后shell地址】\t\t   \t},\t\t   \tonError: function(event,queueID,fileObj,errorObj) { \t   \t \t\t\t\t   \t\tif(errorObj.info == 409600){\t\t   \t\t\t$('#uploadify'+queueID).append('文件不能超过400K');\t\t   \t\t}          \t   　\t}\t\t\t\t\t});\n   漏洞证明：  \n\n\n\n\n\n   修复方案：  文件上传漏洞 在服务端 action这边重命名文件并控制文件上传的类型，去掉页面上调试信息。服务器安全配置这块，设置tomcat启动权限不要为root，启动Tomcat的管理员加入www组，这样Tomcat启动后，可以向logs目录写入日志，works目录生成缓存。所有WebApp全部目录设置不可写，某些需要上传图片的目录，把写操作打开，并关闭执行操作   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}