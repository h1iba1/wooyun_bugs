{"id": 57647, "wybug_id": "wooyun-2014-053756", "wybug_title": "Maccms V8 注入两枚", "wybug_corp": "maccms.com", "wybug_author": "′雨。", "wybug_date": "2014-03-16 11:12", "wybug_open_date": "2014-06-14 11:12", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-05-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-14：\t细节向公众公开  简要描述： 过滤不严。无需单引号。同一文件。 详细说明：  在inc/user/alipay/alipayapi.php中  \n$out_trade_no = $_POST['WIDout_trade_no'];//可控        //商户网站订单系统中唯一订单号，必填        //订单名称        $subject = $_POST['WIDsubject'];        //必填        //付款金额        $price = $_POST['WIDprice'];        //必填        //商品数量        $quantity = \"1\";        //必填，建议默认为1，不改变值，把一次交易看成是一次下订单而非购买一件商品        //物流费用        $logistics_fee = \"0.00\";        //必填，即运费        //物流类型        $logistics_type = \"EXPRESS\";        //必填，三个值可选：EXPRESS（快递）、POST（平邮）、EMS（EMS）        //物流支付方式        $logistics_payment = \"SELLER_PAY\";        //必填，两个值可选：SELLER_PAY（卖家承担运费）、BUYER_PAY（买家承担运费）        //订单描述        $body = $_POST['WIDbody'];        //商品展示地址        $show_url = $_POST['WIDshow_url'];        //需以http://开头的完整路径，如：http://www.xxx.com/myorder.html        //收货人姓名        $receive_name = $_POST['WIDreceive_name'];        //如：张三        //收货人地址        $receive_address = $_POST['WIDreceive_address'];        //如：XX省XXX市XXX区XXX路XXX小区XXX栋XXX单元XXX号        //收货人邮编        $receive_zip = $_POST['WIDreceive_zip'];        //如：123456        //收货人电话号码        $receive_phone = $_POST['WIDreceive_phone'];        //如：0571-88158090        //收货人手机号码        $receive_mobile = $_POST['WIDreceive_mobile'];        //如：13312341234/************************************************************///构造要请求的参数数组，无需改动$parameter = array(\t\t\"service\" => \"trade_create_by_buyer\",\t\t\"partner\" => trim($alipay_config['partner']),\t\t\"payment_type\"\t=> $payment_type,\t\t\"notify_url\"\t=> $notify_url,\t\t\"return_url\"\t=> $return_url,\t\t\"seller_email\"\t=> $alipay_config['no'],\t\t\"out_trade_no\"\t=> $out_trade_no,\t\t\"subject\"\t=> $subject,\t\t\"price\"\t=> $price,\t\t\"quantity\"\t=> $quantity,\t\t\"logistics_fee\"\t=> $logistics_fee,\t\t\"logistics_type\"\t=> $logistics_type,\t\t\"logistics_payment\"\t=> $logistics_payment,\t\t\"body\"\t=> $body,\t\t\"show_url\"\t=> $show_url,\t\t\"receive_name\"\t=> $receive_name,\t\t\"receive_address\"\t=> $receive_address,\t\t\"receive_zip\"\t=> $receive_zip,\t\t\"receive_phone\"\t=> $receive_phone,\t\t\"receive_mobile\"\t=> $receive_mobile,\t\t\"_input_charset\"\t=> trim(strtolower($alipay_config['input_charset'])));$db = new AppDb($MAC['db']['server'],$MAC['db']['user'],$MAC['db']['pass'],$MAC['db']['name']);$sql = 'select count(*) from {pre}user_pay where p_order='.$out_trade_no;$num = $db->getOne($sql);if($num>0){\tshowErr('System',\"订单号错误无法提交数据\");}else{\t$db->Add('{pre}user_pay',array('p_uid','p_order','p_price','p_point','p_time'),array($_SESSION[\"userid\"],$out_trade_no,$price,$price*$MAC['pay']['app']['exc'],time()));}\n可以看到 直接带入了下面的这两个查询当中 其中一个语句还不需要单引号所以就不需要考虑gpc了。   漏洞证明：  \n\n\n\n剩下的就能直接注入了。   修复方案：  过滤呗   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-03-16 11:57 厂商回复： 已经确认该漏洞，正在着手修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}