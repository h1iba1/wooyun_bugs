{"id": 68519, "wybug_id": "wooyun-2015-0141447", "wybug_title": "敏感信息+组合技巧拿下数据库和后台", "wybug_corp": "北京三好互动教育科技有限公司", "wybug_author": "路人甲", "wybug_date": "2015-09-16 09:03", "wybug_open_date": "2015-10-31 09:50", "wybug_type": "重要敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-31：\t细节向公众公开  简要描述： 这种小技巧在高手看来简直是不值一哂，该漏洞并没有什么技术可言。 详细说明：  00X01 首选是对之前泄露的信息整理。某技术人员的VPN密码已经修改，已不能进入内网了。那么之前的收集的信息是否还可以利用，是否有密码没有修改呢？整合之前搜集的信息1.1 外网后台第一道防线\nhttp://service.sanhao.com/login.php用户名:beijing密码:*******\n\n\n1.2 密码未改，登录后是这样的\n\n1.3 通过登录后台，尝试一些常见用户名和密码，结果发现这里的验证还是比较严格的。长度为10~20位，不能为纯数字或英文。不能有连续数字。\n\n\n\n00X02 上面的后台先放着，继续找找泄露的信息能否找到账号密码。2.1 一个外网链接数据库的phpmyadmin后台，下面可以选择数据库的IP地址\nhttp://123.57.18.112/mysqladmin/index.php\n\n\n2.2 虽然他们的数据库或者后台有IP限制，但是他们自己提供了一个很好的phpmyadmin的入口，那么之前搜集的数据库是不是可以都链接了呢？试试，截图如下。\n\n2.3 重要的数据库我单独列出来。一个是BBS的数据库，一个是三好官网+后台的数据库数据库里面的表。\n\n\n\n2.4 三好主数据库数据如下，部分敏感信息做了简单的注释，大家可以通过命名就可以知道表的信息是什么。\ntable_name\ttable_rows\tysyy_admin_op\t660159\tysyy_order_read\t469674\tysyy_teacher_time\t442466\tysyy_comment_operate\t63836\tysyy_bill\t59801\tysyy_sms\t39186\t//短信验证码ysyy_course\t26278\tysyy_order_ct\t16730\tysyy_pay\t16656\tysyy_teacher_impression\t15973\tysyy_course_apply\t15783\tysyy_user\t15681\t//用户ysyy_user_parent\t15482\t//家长ysyy_user_recommend\t15446\tysyy_user_student\t13888\tysyy_teacher_cat\t13518\tysyy_teacher_stulabel\t11967\tysyy_user_teacher\t11729\t//讲师ysyy_comment\t10486\tysyy_order\t9409\tysyy_room\t8919\tysyy_admin_feelog\t8556\tysyy_teacher_tag\t6356\tysyy_teacher_experience\t5967\tysyy_teacher_result\t5196\tysyy_order_se\t3064\tysyy_coupon_act\t2959\tysyy_teacher_album\t2397\tysyy_apply_cash\t2332\tysyy_coupon\t1805\tysyy_clip\t1457\tysyy_teacher_video\t1153\tysyy_news\t1150\tysyy_studentcount_operate\t987\tysyy_coupon_buy\t785\tysyy_seo\t757\tysyy_device_change\t737\tysyy_user_bank\t713\t//用户银行信息ysyy_ev_test\t681\tysyy_device\t561\tysyy_recommend_teacher\t298\tysyy_price\t252\tysyy_community_news\t190\tysyy_admin\t165\t//后台管理员信息ysyy_tag_cat\t103\tysyy_feedback\t97\ttest_relation\t65\tysyy_test_teacher\t62\tysyy_org\t52\tysyy_tag\t42\tysyy_sort\t40\tysyy_link\t35\tadmin_responsible\t35\tysyy_area\t34\tysyy_banner\t29\tysyy_community_tag\t25\tysyy_cat\t24\tysyy_recommend_notice\t20\tysyy_code\t20\tysyy_impression\t15\tysyy_individuation\t12\tysyy_student_label\t12\tysyy_textbook\t11\tysyy_room_tmp\t10\tysyy_service_qq\t10\tysyy_code_apply\t6\tysyy_client\t1\tysyy_coupon_template\t1\tysyy_mail\t0\tysyy_community_like\t0\tysyy_community_favorite\t0\tysyy_hobby\t0\tysyy_recommend_course\t0\tysyy_community\t0\tysyy_recommend\t0\tysyy_video_url\t0\tysyy_pay_admin\t0\tysyy_courseware\t0\tysyy_course_frame\t0\tysyy_character\t0\tysyy_notice\t0\n00X03 后台进不去是一个难题，有了数据库后台还进不去也太伤心了。解密了所有的管理员密码发现一个也解密不出来，那么就不是常规的加密方式了。继续翻搜集的信息，在API中找到了密码的生成\n//管理员密码生成    public function passwordEncode($password, $salt) {        return md5(md5($password) . $salt . 'admin');\n鉴于后台登录的规则，就构造了一个密码和salt（4位数字），然后替换三好的admin的密码和salt，成功登录后台。（画外音：数据库都有了还进后台干嘛？  答：shell啊~shell啊~可是并没有成功shell，也许自己功力不足啊！）登录证明如下图：\n\n00X04 本来在这里应该结束的，尝试上传php菜刀马的时候，发现IP就被封了。换IP继续撸。然后试了下正常上传，发现文件是在img下的站点，随意看了下，发现无法继续利用。但是在编辑新闻咨询的时候，可以源代码编辑，那么可以利用的点就很多了。找一个有噱头的标题+加上恶意代码+置顶~这里只是证明能够插入JS脚本，进行XSS攻击等。4.1 源代码与非源代码的区别\n\n4.2 前台咨询页面的表现\n\n4.3 接收的cookie等\n\n4.4 其他说明。其实xss真是一个不容忽视的漏洞，这里不管他是不是XSS漏洞。但是它本身提供了源代码的编辑功能，危害很大的。可以恶意跳转，挂马、构造请求和构造点击劫持等等。这里不容忽视，因为在非源代码模式下，你根本发现不了异常。结合对网站业务流程的熟悉，可以有想不到的结果。00X05 后台有个功能比较imba，登入web\n\n5.1 分析了一下这个链接，感觉太恐怖了\nhttp://www.sanhao.com/index.php?admin_session=【3c**此处打码***d3da】&user_id=66&user_type=1\n管理员都是可以把自己的admin_session复制到这个链接，然后通过修改user_id即可直接登录教师的账号5.2 来次提现可好？一般的提现都需要人工审核的，三好也不例外。但是，这样给不法分子利用，还是相当危险的啊！\n\n00x06 这次真的结束了   漏洞证明：  总结：漏洞证明就看上面了，危害有多严重就看利用漏洞的人有多猥琐，脑洞有多大了。本来内网的数据库，结果你给我留了个“后门”登录。信息泄露了一次，虽然只是一个企业邮箱的密码，但是涉及的其他敏感信息也被泄露了，你永远不知道哪些密码已经被他人记住了。密码需要修改，整体都修改吧，虽然工程略大，但是信息的安全性为重，不是吗？   修复方案：  1、所有的密码都修改了吧2、不要再用邮箱保存、发送密码和敏感信息了3、自己去社工库查询下自己的信息是否泄露，适当增强密码的安全性4、注销离职员工的账号5、做好排查工作，检查管理员信息是否准确（默默的增加了一个管理员，看能找到吧。）6、检测各个服务器有无异常登录、异常文件等OK~夜深了~（该漏洞并没有什么技术可言）   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-09-16 09:48 厂商回复： 已经确认漏洞，谢谢提交！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}