{"id": 72515, "wybug_id": "wooyun-2015-0146580", "wybug_title": "猎豹免费wifi驱动可利用漏洞", "wybug_corp": "金山网络", "wybug_author": "iometer", "wybug_date": "2015-10-14 00:37", "wybug_open_date": "2016-01-12 06:06", "wybug_type": "非授权访问/认证绕过", "wybug_level": "高", "wybug_rank_0": "11", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "客户端程序设计错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-17：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-12：\t细节向公众公开  简要描述： 猎豹免费WiFi电脑版liebaonat_xp.sys，存在任意地址写入漏洞，写入的地址可控，可以实现内核任意指令执行目的.  详细说明：  驱动liebaonat_xp.sys在处理发给设备LiebaoNAT的IoControlCode为0x830020F0的通信时，由于没有严格校验输入输出参数，导致出现一个任意地址写入漏洞，写入的地址可控/写入的数据长度为4B，可以实现内核任意指令执行目的. IoControlCode为0x830020F0时，InputBuffer是一个内核地址指针，可在UserMode预测甚至遍历出来; InputBufferSize为sizeof(PVOID); 驱动臆测OutputBuffer和OutputBufferSize对应一个4B的UserMode地址——漏洞因此产生。\nNTSTATUS __stdcall DeviceDispatch(PDEVICE_OBJECT DeviceObject, PIRP Irp){    PIO_STACK_LOCATION irpSp = IoGetCurrentStackLocation();    NTSTATUS Status = STATUS_SUCCESS;       PVOID* inputBuffer = Irp->AssociatedIrp.SystemBuffer;    PVOID* outputBuffer = Irp->AssociatedIrp.SystemBuffer;          ULONG  InputBufLength = irpSp->Parameters.DeviceIoControl.InputBufferLength;    ULONG  IoControlCode = irpSp->Parameters.DeviceIoControl.IoControlCode;    if(IoControlCode == 0x830020F0)    {        if ( InputBufLength >= 4 ) // wowo....        {            PVOID* lpBuf = CheckExploit(*inputBuffer, &IoControlCode);            if ( lpBuf )            {                *outputBuffer = lpBuf[143];                Status = STATUS_SUCCESS;            }            else            {                Status = NDIS_STATUS_ADAPTER_NOT_FOUND;            }            Irp->IoStatus.Status = Status;            Irp->IoStatus.Information = 4;            return Status;        }    }    ...}\n   漏洞证明：  \n//示例程序:执行0xEB 0xFE实现内核线程死循环;//下载链接http://pan.baidu.com/s/1pJFy783\n   修复方案：  严格校验输入和输出缓冲区地址及大小.   版权声明：转载请注明来源 iometer@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-10-14 06:05 厂商回复： 感谢提交 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}