{"id": 29955, "wybug_id": "wooyun-2015-0117859", "wybug_title": "某省人力资源和社会保障厅官网任意文件下载", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "路人甲", "wybug_date": "2015-06-05 15:53", "wybug_open_date": "2015-07-24 18:30", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-24：\t细节向公众公开  简要描述： 低调。。 详细说明：  \nhttp://www.zjhrss.gov.cn/download/downfile.jsp?pathfile=download/downfile.jsp&sitename=zjstmhwz\n\n\n\n<%@page import=\"org.apache.derby.tools.sysinfo\"%><%@page import=\"java.io.File\"%><%@page import=\"java.io.OutputStream\"%><%@page import=\"java.io.FileInputStream\"%><%@page import=\"java.net.URLEncoder\"%><%@page language=\"java\" contentType=\"application/x-msdownload\"\tpageEncoding=\"utf-8\"%><%\tString downloadname = null;\tString strFilePath = null;\tint nClassID = 0;//Integer.parseInt(request.getParameter(\"classid\"));\t//String strFileName = String.valueOf((request.getParameter(\"filename\")==null?\"\":request.getParameter(\"filename\")));\t\tString strFileName = new String((request.getParameter(\"filename\")==null?\"\":request.getParameter(\"filename\")).getBytes(\"ISO-8859-1\"),\"utf-8\");\t\tif(strFileName!=null) strFileName = strFileName.replace(\"../\", \"\");\tString pathfile = request.getParameter(\"pathfile\");\tif(pathfile!=null ) pathfile = pathfile.replace(\"../\", \"\");\t\tpathfile = (pathfile == null ? \"\" : pathfile);\tString strTemp = \"\";\tout.clear();\tout = pageContext.pushBody();\t\tSystem.out.println(\"strFileName:old----------------\"+strFileName);\tpathfile=java.net.URLDecoder.decode(pathfile,\"UTF-8\");\tstrFileName=java.net.URLDecoder.decode(strFileName,\"UTF-8\");\tSystem.out.println(\"strFileName:new----------------\"+strFileName);\t\tif(\"\".equals(strFileName)){\t\tstrFileName=pathfile.substring(pathfile.lastIndexOf(\"/\")+1) ;\t}\t\tif (pathfile.equals(\"\")) {\t\tpathfile = \"/jcms/jcms_files/jcms1/web1/site/attach/\"\t\t\t\t+ nClassID + \"/\" + strFileName;\t}\t//System.out.println(\"pathfile2----------------\"+pathfile);\tString fileDir=request.getSession().getServletContext().getRealPath(\"/\")+ pathfile;\t//System.out.println(\"fileDir----------------\"+fileDir);\tFile file = new File(fileDir);\tif (!file.exists()) {\t\tout.println(\"<script type=\\\"text/javascript\\\">alert(\\\"下载失败，文件不存在！\\\");</script>\");\t\treturn;\t}\tresponse.setContentType(\"application/octet-stream; charset=UTF-8\");\tString filedisplay = strFileName;\tfiledisplay = URLEncoder.encode(filedisplay, \"UTF-8\");\tresponse.addHeader(\"Content-Disposition\", \"attachment;filename=\"\t\t\t+ filedisplay);\tOutputStream outp = null;\tFileInputStream in = null;\ttry {\t\toutp = response.getOutputStream();\t\tin = new FileInputStream(fileDir);\t\tbyte[] b = new byte[1024];\t\tint i = 0;\t\twhile ((i = in.read(b)) > 0) {\t\t\toutp.write(b, 0, i);\t\t}\t\toutp.flush();\t} catch (Exception e) {\t\tSystem.out.println(\"Error!\");\t\te.printStackTrace();\t} finally {\t\tif (in != null) {\t\t\tin.close();\t\t\tin = null;\t\t}\t\tif (outp != null) {\t\t\toutp.close();\t\t\toutp = null;\t\t}\t}%>\n   漏洞证明：  \n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2015-06-09 18:29 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT下发给浙江分中心，由其后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}