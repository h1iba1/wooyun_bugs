{"id": 66630, "wybug_id": "wooyun-2015-0141449", "wybug_title": "链家地产某站getshell到简单内网漫游", "wybug_corp": "homelink.com.cn", "wybug_author": "PythonPig", "wybug_date": "2015-09-16 12:29", "wybug_open_date": "2015-11-01 14:58", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传内容未检查"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-01：\t细节向公众公开  简要描述： 链家地产某站getshell到简单内网漫游 详细说明：  问题站点是链家公益，在wooyun看到以前@默之 牛提过该系统的一个漏洞： WooYun: 由一个弱口令进而对链家的一次简单内网漫游 ，该漏洞是通过弱口令进入后台拿shell的，看漏洞状态：已下线。前几天无意找到了这个站，测试了一下，所谓的下线是把后台地址改了，即使是管理员在前台登陆以后也无法进入后台。然后尝试扫下后台，没有得到任何结果，无奈只能从前台进行测试了。该站开放注入外部用户：http://gongyi.homelink.com.cn/lianjia/portal/user/loginHtml未授权访问点没有找到，那就看看有没有上传。注入一个外部用户，进入，看到头像可编辑。开始尝试上传。先传个.jsp，结果js判断了\n\n来个图片马，Burp 修改，绕过js检测\n\n又没成功，抓包看下，看到了一个路径变量。感觉奇怪，上传存储路径就有点奇葩了，这里竟然把上传后的文件名都在前端确定了？修改路径，发现存储路径与这个路径无关，储存名字也与此参数无关。该参数没有任何可利用价值了。\n\n又失败，上传正常图片再看，注意到了这里\n\n难道这里有必然的联系？测试之，把type参数清空，果然上传图片的存储路径也变量。猜想：根据这里的type对用户上传文件进行类型判断。验证：把type清空，上传图片马，burp改后缀名为jsp，上传，成功，猜想正确。这里的type可以任意改，你懂得。\n\n\n\n\n\n上刀看看系统参数。\n\n\n\n\n\n直接是root权限啊，又有内网ip，那就简单测试下内网其他存活的主机吧。根据以前对链家内网的测试，172.165.0.0/21网段都可以访问，这里简单的贴几张内网系统的图吧IT运维管理站点\n\n\n\n\n\n\n\n另外，该系统的外网用户之间存在多处平行越权。看个图就懂了吧\n\n上图是在修改用户密码时，不需要输入原密码，而且有个用户id，系统只根据这个id来修改用户数据的，如果遍历的话，~~还有其他很多地方都存在类似平行越权~~另外，从该站数据备份的情况来看，应该是第天备份一次，保存7天~~除了泄露链家内部员工信息之外，受链家资助的孩子们的信息也泄露了~\n\n\n\n   漏洞证明：  见 详细说明   修复方案：  你们比我懂   版权声明：转载请注明来源 PythonPig@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-09-17 14:57 厂商回复： 确认，谢谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-09-16 12:31 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  好分析    \n     2015-09-16 12:40 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1709 漏洞数:273        | ...........................................)\t\t \n  +1    \n     2015-09-16 12:41 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:778 漏洞数:98        )\t\t \n  难道是那个没修复的那个洞么    \n     2015-09-16 15:34 |    \t\tPythonPig \t\t\t( 普通白帽子  |\t\t\t        Rank:506 漏洞数:72        | 只会简单工具的小小菜)\t\t \n  @疯狗 狗哥，审核大大骗我，早上说这个洞没通过！！刚我看到这个漏洞还以为我的漏洞细节被人偷了呢~~打审核大大的PP    \n     2015-09-16 16:20 |    \t\tPythonPig \t\t\t( 普通白帽子  |\t\t\t        Rank:506 漏洞数:72        | 只会简单工具的小小菜)\t\t \n  @玉林嘎 NO    \n     2015-09-16 22:33 |    \t\t北京链家房地产经纪有限公司(乌云厂商)\t\t \n  你好，过程中把type清空那段没太看明白，能讲细点吗？或者留下联系方式？    \n     2015-09-17 10:07 |    \t\tPythonPig \t\t\t( 普通白帽子  |\t\t\t        Rank:506 漏洞数:72        | 只会简单工具的小小菜)\t\t \n  @北京链家房地产经纪有限公司 @乌云小秘书 将与您取得联系，帮我转发个文档给你    \n     2015-10-19 15:11 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  链家网    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}