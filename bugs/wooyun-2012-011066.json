{"id": 17237, "wybug_id": "wooyun-2012-011066", "wybug_title": "Ecshop存在诸多SQL注射漏洞", "wybug_corp": "ShopEx", "wybug_author": "blue", "wybug_date": "2012-08-19 16:48", "wybug_open_date": "2012-10-03 16:48", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-08-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-08-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-08-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2012-10-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-10-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-11-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-10-03：\t细节向公众公开  简要描述： 开源网店系统Ecshop存在多处的SQL注射漏洞，成功利用可以获取网店权限 详细说明：  flow.php\nelseif ($_REQUEST['step'] == 'update_cart'){    if (isset($_POST['goods_number']) && is_array($_POST['goods_number']))    {        flow_update_cart($_POST['goods_number']);    }    show_message($_LANG['update_cart_notice'], $_LANG['back_to_cart'], 'flow.php');    exit;}\n\nfunction flow_update_cart($arr){    /* 处理 */    foreach ($arr AS $key => $val)    {        $val = intval(make_semiangle($val));        if ($val <= 0 && !is_numeric($key))        {            continue;        }        //查询：        $sql = \"SELECT `goods_id`, `goods_attr_id`, `product_id`, `extension_code` FROM\" .$GLOBALS['ecs']->table('cart').               \" WHERE rec_id='$key' AND session_id='\" . SESS_ID . \"'\";        $goods = $GLOBALS['db']->getRow($sql);        $sql = \"SELECT g.goods_name, g.goods_number \".                \"FROM \" .$GLOBALS['ecs']->table('goods'). \" AS g, \".                    $GLOBALS['ecs']->table('cart'). \" AS c \".                \"WHERE g.goods_id = c.goods_id AND c.rec_id = '$key'\";        $row = $GLOBALS['db']->getRow($sql);        //查询：系统启用了库存，检查输入的商品数量是否有效        if (intval($GLOBALS['_CFG']['use_storage']) > 0 && $goods['extension_code'] != 'package_buy')        {            if ($row['goods_number'] < $val)            {                show_message(sprintf($GLOBALS['_LANG']['stock_insufficiency'], $row['goods_name'],                $row['goods_number'], $row['goods_number']));                exit;            }            /* 是货品 */            $goods['product_id'] = trim($goods['product_id']);            if (!empty($goods['product_id']))            {\n仅仅全局对数组的值有处理但是没有对key处理造成漏洞   漏洞证明：  \n\n   修复方案：  全局对key也处理！   版权声明：转载请注明来源 blue@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2012-08-19 22:26 厂商回复： 感谢您为Shopex信息安全做的贡献，我们会尽快处理非常感谢！！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-08-19 17:03 |    \t\t左右 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:3        | 左右 ? 左. : 右.)\t\t \n  诸多~~~坐等公开    \n     2012-08-19 17:47 |    \t\tneal \t\t\t( 普通白帽子  |\t\t\t        Rank:219 漏洞数:23        )\t\t \n  我很想知道 源码在那里获取的。    \n     2012-08-19 17:50 |    \t\t葉孒 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:5        | 呵呵)\t\t \n  纳尼    \n     2012-08-19 17:56 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @neal ecshop不是开源的么    \n     2012-08-19 18:50 |    \t\tneal \t\t\t( 普通白帽子  |\t\t\t        Rank:219 漏洞数:23        )\t\t \n  @xsser  完全的开源吗？ 我不知道哈.    \n     2012-08-19 18:52 |    \t\tneal \t\t\t( 普通白帽子  |\t\t\t        Rank:219 漏洞数:23        )\t\t \n  @xsser 我的意思是能看到源码的吗?  我是搞java的 对php甚是不了解,见谅 见谅    \n     2012-08-19 18:53 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @neal 嗯,一般的php都是开源的    \n     2012-08-19 19:00 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  大牛出没    \n     2012-08-19 19:54 |    \t\t飘雪柔情 \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:7        | 我不是黑客，你们都是黑客)\t\t \n  坐等公开！！    \n     2012-08-19 22:42 |    \t\tmario \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 可以省略吗)\t\t \n  坐等公开    \n     2012-08-19 22:57 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  又会死多少商户哦。    \n     2012-08-19 23:02 |    \t\tAnony \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:5        | 乌云白帽子一枚)\t\t \n  7.1版本的？    \n     2012-08-19 23:19 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  膜拜～    \n     2012-08-19 23:42 |    \t\tcddevils \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:2        | 菜鸟一个)\t\t \n  坐等。。    \n     2012-08-26 12:20 |    \t\t小痞子 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:21        | <xss>alert(\"a\")</xss>￥&@&……dssKhwjcw...)\t\t \n  。。。悲催了~~我也是用的ecshop  坐等公布啊    \n     2012-08-30 12:58 |    \t\twanxx \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 无)\t\t \n  怀着鸡冻的心情 花光了哥的WB 我发觉我被标题坑了    \n     2012-08-30 13:29 |    \t\tyy520 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:12        )\t\t \n  @wanxx 求内容～求详情～ 到底是ecshop还是shopex    \n     2012-08-30 13:57 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @wanxx 怎么讲，假的？    \n     2012-08-30 17:16 |    \t\twanxx \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 无)\t\t \n  诸多 等公开了看吧    \n     2012-09-03 19:17 |    \t\t猪头子 \t\t\t( 普通白帽子  |\t\t\t        Rank:189 漏洞数:35        | 自信的看着队友rm -rf/tar挂服务器)\t\t \n  我擦，不是我找到了那个吧？    \n     2012-09-03 19:27 |    \t\t葉孒 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:5        | 呵呵)\t\t \n          if ($val <= 0 && !is_numeric($key))        {            continue;        }表示好奇    \n     2012-09-03 22:18 |    \t\tx7iao \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:41        | 文能床上控萝莉，武能床上定人妻)\t\t \n  额  亲能负责任点不  官方也是脑子进水了????这你那能注入我头割下来给你们当板凳  by h3len    \n     2012-09-03 22:21 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  坑爹货，官方还给rank    \n     2012-09-03 22:21 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @x7iao 你仔细看，这可不可以注射？哈哈 围观楼上    \n     2012-09-03 22:25 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @葉孒 @x7iao @saline 请这几位好好思考思考，甚至自己动手测试下再说别人     \n     2012-09-03 22:29 |    \t\tx7iao \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:41        | 文能床上控萝莉，武能床上定人妻)\t\t \n  @xsser 亲 我要是没测试过会说这话?  我刚才才花时间测试了  不管是key还是value  在gpc下都会转移  测试千万遍  要是亲能成功   给出个利用方法    \n     2012-09-03 22:31 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @x7iao 首先，gpc=off 其次 if ($val <= 0 && !is_numeric($key)) { continue; } 是有漏洞的 我也测试过，但是请注意需要$val变量的第一个字符为数字并且大于0     \n     2012-09-03 22:48 |    \t\tx7iao \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:41        | 文能床上控萝莉，武能床上定人妻)\t\t \n  @xsser 测试了  gpc关闭情况下确实key没被过滤  但是addslashes_deep函数是会连key和value一起过滤的  为啥这里却把key转义回来了呢  希望亲提点呀  明天割头自杀不解释  不过希望自杀前能看到回答    \n     2012-09-03 22:50 |    \t\t葉孒 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:5        | 呵呵)\t\t \n  @xsser 别来回复，让他自杀先。。    \n     2012-09-03 23:24 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  呵呵，我只是觉得忽略gpc的洞子不是好洞子。    \n     2012-09-03 23:34 |    \t\tx7iao \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:41        | 文能床上控萝莉，武能床上定人妻)\t\t \n  @saline 不过说实话 ecshop就我个人来说是没挖出 文件全部读完了  希望各位大牛上吧    \n     2012-09-04 00:12 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @saline 新版php取消了gpc 全部为off了    \n     2012-09-04 00:31 |    \t\tx7iao \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:41        | 文能床上控萝莉，武能床上定人妻)\t\t \n  @xsser http://www.myhack58.com/Article/html/3/62/2010/26956.htm,呵呵，解释吗。    \n     2012-09-04 12:32 |    \t\tx7iao \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:41        | 文能床上控萝莉，武能床上定人妻)\t\t \n  我懂鸟  ecshop的addslashes_deep值过滤了value 我去自杀去了  各位88  以后看到这个号都不是本人 相信我!o(∩_∩)o     \n     2012-09-04 13:34 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @x7iao 把乌云币先捐了可以么    \n     2012-09-08 22:42 |    \t\tVty \t\t\t( 普通白帽子  |\t\t\t        Rank:199 漏洞数:37        )\t\t \n  后台怎么拿shell呢    \n     2012-09-11 11:44 |    \t\t冰锋刺客 \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:14        | 请在监护人陪同下与本人交流)\t\t \n  我靠，又看不了漏洞 ？    \n     2012-09-21 07:11 |    \t\tner \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:4        )\t\t \n  我擦..欺骗了我的WB...    \n     2012-10-22 11:53 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  sql 错误提示早就该关了！不知道官方怎么想的！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}