{"id": 51623, "wybug_id": "wooyun-2014-073904", "wybug_title": "YiDacms 最新版SQL注入漏洞二处", "wybug_corp": "yidacms.com", "wybug_author": "xfkxfk", "wybug_date": "2014-08-26 19:06", "wybug_open_date": "2014-11-21 19:08", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "安全意识不足", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-31：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-21：\t细节向公众公开  简要描述： YiDacms 最新版SQL注入漏洞二处 详细说明：  易达CMS 企业建站系统当前最新版本是：YidaCms X3.2（20140718）版文件/Yidacms/user/user_message.asp第一处SQL注入：\nyidacms_email = request(\"yidacms_email\")if  yidacms_email = \"x\" thenemail = trim(request.form(\"email\"))if shuaiweb_useremail = email then\t\t\tresponse.write \"<script language=javascript> alert('不能自已给自已发消息!');history.go(-1);</script>\"\t\t\tresponse.endend ifset rs=server.createobject(\"adodb.recordset\")sql=\"select * from shuaiweb_user where shuaiweb_useremail='\"&trim(request.form(\"email\"))&\"' ORDER BY ID ASC\"response.write(sql)  rs.open sql,dbok,1,1if rs.eof then\t\t\tresponse.write \"<script language=javascript> alert('没有这位会员，请重新输入会员账户!');history.go(-1);</script>\"\t\t\tresponse.endend if%>\n直接将email带入SQL注入，导致sql注入第二处SQL注入：\n<form id=\"form2\" name=\"form2\" method=\"post\" action=\"?yidacms_email=r\"><table width=\"98%\" border=\"1\" cellpadding=\"10\" cellspacing=\"0\" bordercolor=\"#cccccc\" style=\"border-collapse:collapse; margin-top:40px;\"align=\"center\">  <tr>    <td>接收账户 : <%=email%><input type=\"hidden\" name=\"shuaiweb_email\" value=\"<%=email%>\"/><input type=\"hidden\" name=\"shuaiweb_emailt\" value=\"<%=shuaiweb_useremail%>\"/></td>  </tr>    <tr>    <td><textarea name=\"shuaiweb_emailcontent\" id=\"content\" style=\"width:100%;height:200px;visibility:hidden;\"></textarea></td>  </tr>  <tr>    <td>\t<input type=\"submit\" name=\"Submit2\" value=\"发 送\" style=\" background:URL(../template/user/images/30.gif); width:66px; height:26px; border:0px; color:#FFFFFF;\" /></td>  </tr></table></form><%end ifif  request(\"yidacms_email\") = \"r\" then\tset rs=server.createobject(\"adodb.recordset\")\tsql=\"select * from shuaiweb_usermessage\"  \trs.open sql,dbok,3,2\trs.addnew \t\trs(\"shuaiweb_email\")=filter_Str(trim(request.form(\"shuaiweb_email\")))\t\trs(\"shuaiweb_emailt\")=filter_Str(trim(request.form(\"shuaiweb_emailt\")))\t\trs(\"shuaiweb_emailcontent\")=filter_Str(trim(request.form(\"shuaiweb_emailcontent\")))\t\t'rs(\"shuaiweb_userzhuangtai\")=trim(request.form(\"shuaiweb_userzhuangtai\"))\t\t'rs(\"shuaiweb_useradmin\")=trim(request.form(\"shuaiweb_useradmin\"))\t\trs(\"time\")=Now ()\t\trs(\"shuaiweb_yuedu\")=0\trs.update\tresponse.write \"<script language=javascript> alert('发送成功!');location.replace('user_message.asp?email=email');</script>\"\trs.Close\tset rs=nothingend if%></body>\n在update时，shuaiweb_userzhuangtai和shuaiweb_useradmin没有使用全局过滤filter_Str函数，导致SQL注入。   漏洞证明：  第一处SQL注入证明：这里我们打印一下SQL语句。\n\n存在此用户，email显示在了接收账户处\n\n用户不存在，无法发送信息第二处就不在证明了，发送信息时，shuaiweb_userzhuangtai和shuaiweb_useradmin存在注入。   修复方案：  不管全局有没有用，既然用了就全部用上，在进入数据库的参数上都加上全局过滤先。   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-11-21 19:08 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}