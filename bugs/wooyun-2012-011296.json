{"id": 17058, "wybug_id": "wooyun-2012-011296", "wybug_title": "livcms 内容管理系统存在注射漏洞", "wybug_corp": "南京厚建软件", "wybug_author": "xyhk5558", "wybug_date": "2012-08-27 18:27", "wybug_open_date": "2012-10-11 18:27", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-08-27：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2012-10-11：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 此程序多用于网络媒体各大地方卫视，程序目录dealfunc下comment_stat.php和comment_js.php，对cmid未做过滤。直接导致注射。后台默认地址为 http://cp.xxxx.com/ws 详细说明：  comment_stat.php文件源码\n<?php /*** comment_stat.php :: 评论回复统计文件 :: dealfunc* * $Id: comment_stat.php 67 2007-06-01 03:48:20Z $*/define ('INCLUDE_PATH', './../');require_once \"./../liv_global.php\";$staticfile = $_REQUEST['staticfile'];$commresult = $DB->query_first(\"SELECT count(*) as cmtnum  FROM liv_comment where contentid=\".$_REQUEST['cmid'] . \" and auditing=1 \");?>document.write('<?php echo intval($commresult['cmtnum']);?>');<?php?>comment_js.php文件源码<?php /*** comment_js.php :: 评论JS调用 :: dealfunc* * $Id: comment_js.php 67 2007-06-01 03:48:20Z $*/define('INCLUDE_PATH','./../');require \"./../liv_global.php\";$cmid = $_REQUEST['cmid'];if ($cmid){$cond = ' AND contentid=' . $cmid;}$limit = intval($_REQUEST['limit']) ? intval($_REQUEST['limit']) : 6;$brieflength = intval($_REQUEST['brieflength']) ? intval($_REQUEST['brieflength']) : 100;?>\tdocument.write('<ul style=\"border-bottom:1px solid #ccc;margin-bottom:10px;\"><li style=\"font-size:14px;font-weight:bold;\">文章评论：</li>');<?php$result = $DB->query(\"SELECT * FROM \" . DB_PREFIX . \"comment WHERE auditing = 1 and siteid = \" . intval($siteinfo['siteid']) . $cond . \" ORDER BY pubdate DESC LIMIT $limit\");//echo \"SELECT * FROM \" . DB_PREFIX . \"comment WHERE auditing = 1 and siteid = \" . intval($siteinfo['siteid']) . $cond . \" and contentid=\".$cmid.\" ORDER BY pubdate DESC LIMIT $limit\";$rst = $DB->num_rows($result);//$commentlink = $siteinfo['sitepath'].'comment/comment.php?cmid='.$cmid.'&modeid='.$modeid;$commentlink = $siteinfo['sitepath'].'comment/comment.php?cmid='.$cmid;while($row = $DB->fetch_array($result)){\t$content = cutchars($row['content'],$brieflength);           //     $content = nl2br($content);                $content = str_replace(array(chr(10),chr(13)),\"\",$content);\t$pubdate = date('Y-m-d',$row['pubdate']);\t$author = $row['author'];\t$ips = explode(\".\",$row['ip']);\t$newip = $ips[0].'.'.$ips[1].'.*.*';\t$link = $siteinfo['weburl'] . 'comment/comment.php?cmid=' . $row['contentid'];\t?>\t\tdocument.write('<li style=\"background:#f1f1f1;border-bottom:1px solid #d8d8d8;padding:5px;\">网友：<b><?php echo $author ?></b> 时间：<?php echo $pubdate ?> IP：<?php echo $newip ?></li><li style=\"line-height:22px;padding:5px;\"><a href=\"<?php echo $link ?>\" target=\"_blank\"><?php echo $content;?></a></li>');\t<?php}if($rst != 0){\t?>\tdocument.write('<li style=\"text-align:right;line-height:22px;font-weight:bold;padding-right:10px;\"><a href=\"<?php echo $commentlink ?>\" target=\"_blank\">更多留言</a></li>');\t<?php}?>\tdocument.write('</ul>');<?php?>\n没任何过滤，直接带入查询   漏洞证明：  \n\n   修复方案：  加强过滤或直接删除此目录下的文件，   版权声明：转载请注明来源 xyhk5558@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2012-10-11 18:49 |    \t\tLeadUrLife \t\t\t( 普通白帽子  |\t\t\t        Rank:103 漏洞数:14        | 好好学习 天天向上)\t\t \n  商业系统，没记错的话至少还有两处有注射点    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}