{"id": 665, "wybug_id": "wooyun-2014-074591", "wybug_title": "一次对金山企业测试的过程(漫游未遂)", "wybug_corp": "金山软件集团", "wybug_author": "if、so", "wybug_date": "2014-09-01 10:39", "wybug_open_date": "2014-10-16 10:40", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-16：\t细节向公众公开  简要描述： 漫游未遂啊，运气差了点，但是觉得审核给个闪电是可以的吧 详细说明：  安全是一个整体，当公司业务繁多时，往往会在一些细节方面出现问题。当实施安全策略时，一些问题就会被疏漏。金山分公司较多，这是前话，后话是github源码泄露公司内部账号，金山肯定是修补检查了的，可是子母公司盘根交错，往往补了这，忘了那。可牛（conew.com）便是金山旗下的一个业务公司，github上搜索，搜索到一个\ndef SendEmail(allsenders, msg):    smtp = smtplib.SMTP()       smtp.connect(\"smtp.gmail.com\", \"25\")    smtp.starttls()    smtp.login('dengrui@conew.com', 'dr6544566')       smtp.sendmail('dengrui@ijinshan.com', allsenders, msg.as_string())       smtp.quit()    print u'%s 发送成功！' % titles\n发现用的是gmail的企业邮箱，只能用客户端来连了\n\n如图，成功登陆。下面就是一段漫长的收邮件了，本着已漫游内网的目的，果断在邮件里面搜索vpn，得到vpn地址：\nhttps://ksvpn.kingsoft.com/dana-na/auth/url_default/welcome.cgi\n上面有几种登陆方式，看来只有域账号可以登入了。\n\n尝试用账号密码，发现登入错误，说明手上掌握的不是金山的域账号，根据直觉，域账号应该是kingsoft.com的账号密码\n\n邮件密码和域账号要是一样的话，已知的只有exchange了，经过一段漫长搜索终于找到了exchange的服务器了，邮件就懒得翻了，几万封邮件！！\n\n可是找到地址了，密码是什么了，我觉得他肯定记在某个地方了，正好想起来邮箱有个note功能，去看了下，发现几个密码，觉得Dr6544566最像\n\n成功登陆\n\n自此我已经拥有了金山的域账号，即可登陆juniper的vpn！！可是juniper一个恶心的hostcheck功能，会判断连接vpn的机器的系统配置是不是和管理员配置的一样，所以导致连接失败。\n\n虽然这里提示无法连接，但是还是有方法bypass的1.逆向hostcheck，修改判断是否合法机器代码.2.juniper对windows限制较多，但是多MAC os限制较少，可以尝试mac os下面的juniper客户端来尝试连接。可是屌丝毕竟是屌丝，没那个条件。邮件里面泄露的东西那就太多太多了，很黄很暴力，各种密码，cdn啊，测试机器啊，数据库啊，就不放出来了，影响人家正常工作。。虽然vpn这条路有点问题，但是靠这2个邮箱，长期潜伏，进入内网只是时间问题： ）   漏洞证明：  \ndef SendEmail(allsenders, msg):    smtp = smtplib.SMTP()       smtp.connect(\"smtp.gmail.com\", \"25\")    smtp.starttls()    smtp.login('dengrui@conew.com', 'dr6544566')       smtp.sendmail('dengrui@ijinshan.com', allsenders, msg.as_string())       smtp.quit()    print u'%s 发送成功！' % titles\n\n\n\n\n   修复方案：  安全是一个整体   版权声明：转载请注明来源 if、so@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-09-01 11:13 厂商回复： 非常感谢。VPN执行的是动态口令认证，所以未能突破。不过员工邮箱泄露的信息已经足够严重。我们将尽快跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-01 11:34 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:91        | 梦想还是要有的，万一实现了呢？)\t\t \n  no.你们不是支持域账号吗，我已经拿到了，只不过vpn本身限制了我    \n     2014-09-30 14:24 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:91        | 梦想还是要有的，万一实现了呢？)\t\t \n  @金山软件集团  对了，正好有个问题要请教下，juniper是不是检查连接机器的MAC地址？是不是mac没在服务端注册过就会被hostcheck检测到？    \n     2014-10-16 16:57 |    \t\t小卖部部长 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:3        | 别拿部长不当干部！)\t\t \n  洞主，我是dengrui，我被开了，快赔我工作。。    \n     2015-03-13 15:13 |    \t\t萌萌哒-花粉 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:5        | 多乌云 多美女 花粉 顾名思义 就是校花班花...)\t\t \n  @小卖部部长 不会吧  我哥们一个漏洞被三个国内平台和互联网中心通报三次 啥事没有    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}