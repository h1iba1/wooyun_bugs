{"id": 47431, "wybug_id": "wooyun-2015-092777", "wybug_title": "从一个漏洞到再次沦陷中国联通企业信息服务平台(含32个省)", "wybug_corp": "中国联通", "wybug_author": "cuger", "wybug_date": "2015-01-20 11:59", "wybug_open_date": "2015-01-25 12:00", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-25：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 从一个被忽略的漏洞到再次沦陷中国联通企业信息服务平台，之前找到个文件，数了下有32个省的简称 详细说明：  之所以说再次，是因为之前已经被@s0mun5 沦陷过一次了:\nhttp://wooyun.org/bugs/wooyun-2010-079668\n被忽略的漏洞是良品铺子的这个漏洞（已经通过微信联系技术人员修改了密码）:\nhttp://wooyun.org/bugs/wooyun-2010-081423\n虽然猜出了良品铺子的后台管理口令，不过技术太菜，后台没有拿到shell，该系统是广州信景技术有限公司开发的，还有其他很多成功案例，像中粮我买网、国美等系统也是采用这家公司的，扯远了，回到正题。   漏洞证明：  虽然在后台没有拿到shell，但是后台有短信和邮件的发送接口，如下图所示：\n\n但是这个地方不管是F12，还是查看源文件什么的，是无法直接看到密码的。最后通过burp代理抓到了短信接口的密码，这算是这个系统的一个设计缺陷吧，点击该短信接口，burp拦截后直接返回明文密码，如下图所示：\n\n有了短信接口的用户密码，赶紧到那个接口网址去试试，成功登陆：\n\n可以查看所有已发送短信给自己发条短信测试一下：\n\n\n\n测试发送短信成功，难道仅仅发发短信就完了？那实在是太没意思了。。。。素材库—文件库-上传文件，未做任何过滤（以为有了上次会吸取教训，╮(╯▽╰)╭），直接上传webshell，burp代理返回shell路径：\n\n上菜刀：\n\n开始以为hb.ums86.com只是湖北省的，后来发现，远远不止这些：tj、gx、zj、yn、ss、sh、sd、sc、nx、ln、jx、js、hi、gs、gd、fj、cq、bh、bj。。。。差不多全国各个省都在这个ip上面贴一些配置信息吧，\n<?xml version=\"1.0\" encoding=\"utf-8\"?><!-- the proxool configuration can be embedded within your own application's.\tAnything outside the \"proxool\" tag is ignored. --><something-else-entirely>\t<proxool>\t\t<alias>db_1</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"im_db1\" />\t\t\t<property name=\"password\" value=\"im_db1\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_epma</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.213:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"epma\" />\t\t\t<property name=\"password\" value=\"epma01\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_2</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"im_db2\" />\t\t\t<property name=\"password\" value=\"im_db2\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<!-- 在分配连接前后是否进行有效性测试，这个是解决本问题的关?? -->\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_zx</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"im_zx\" />\t\t\t<property name=\"password\" value=\"im_zx\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<!-- 在分配连接前后是否进行有效性测试，这个是解决本问题的关?? -->\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_js</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"im_js\" />\t\t\t<property name=\"password\" value=\"im_js\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<!-- 在分配连接前后是否进行有效性测试，这个是解决本问题的关?? -->\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_jx</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"im_jx\" />\t\t\t<property name=\"password\" value=\"im_jx\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<!-- 在分配连接前后是否进行有效性测试，这个是解决本问题的关?? -->\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_gd</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"im_gd\" />\t\t\t<property name=\"password\" value=\"im_gd\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<!-- 在分配连接前后是否进行有效性测试，这个是解决本问题的关?? -->\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_common</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"im_common\" />\t\t\t<property name=\"password\" value=\"im_common\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_stat</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"im_gd\" />\t\t\t<property name=\"password\" value=\"im_gd\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_nx</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"im_nx\" />\t\t\t<property name=\"password\" value=\"im_nx\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_imessage</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"imessage\" />\t\t\t<property name=\"password\" value=\"imessage\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t\t<alias>db_3</alias>\t\t<driver-url>jdbc:oracle:thin:@192.168.1.216:1521/dbtest</driver-url>\t\t<driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\t\t<driver-properties>\t\t\t<property name=\"user\" value=\"imessage\" />\t\t\t<property name=\"password\" value=\"imessage\" />\t\t</driver-properties>\t\t<house-keeping-sleep-time>300000</house-keeping-sleep-time>\t\t<simultaneous-build-throttle>2</simultaneous-build-throttle>\t\t<prototype-count>2</prototype-count>\t\t<maximum-connection-count>5</maximum-connection-count>\t\t<maximum-active-time>3600000</maximum-active-time>\t\t<minimum-connection-count>2</minimum-connection-count>\t\t<trace>true</trace>\t\t<test-before-use>true</test-before-use>\t\t<test-after-use>true</test-after-use>\t\t<house-keeping-test-sql>SELECT SYSDATE FROM DUAL\t\t</house-keeping-test-sql>\t</proxool>\t<proxool>\t<alias>db_union_prov</alias>                <driver-url>jdbc:oracle:thin:@192.168.2.223:1521/orcl</driver-url>                <driver-class>oracle.jdbc.driver.OracleDriver</driver-class>                <driver-properties>                        <property name=\"user\" value=\"im_union_prov\" />                        <property name=\"password\" value=\"ton9y1pl\" />                </driver-properties>                <house-keeping-sleep-time>300000</house-keeping-sleep-time>                <simultaneous-build-throttle>100</simultaneous-build-throttle>                <prototype-count>2</prototype-count>                <maximum-connection-count>200</maximum-connection-count>                <maximum-active-time>240000</maximum-active-time>                <minimum-connection-count>2</minimum-connection-count>                <trace>true</trace>                <test-before-use>false</test-before-use>                <test-after-use>false</test-after-use>                <house-keeping-test-sql>SELECT SYSDATE FROM DUAL</house-keeping-test-sql>        </proxool></something-else-entirely>\n连接数据库后，全国的企业发送接口都到手了，然后就可以组成短信轰炸机群了，然后就没有然后了。。。。   修复方案：  检查文件的合法性，不能指哪儿补哪儿。   版权声明：转载请注明来源 cuger@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-01-25 12:00 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-21 11:16 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  哦    \n     2015-01-21 12:55 |    \t\tcuger \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:44        | 这个家伙很懒，什么也没留下)\t\t \n  @wefgod 干哥好久不见    \n     2015-01-22 17:04 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @cuger 你认错人了    \n     2015-01-22 18:21 |    \t\tcuger \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:44        | 这个家伙很懒，什么也没留下)\t\t \n  @wefgod 哈哈哈哈，怎么可能~    \n     2015-01-23 09:00 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @cuger 是啊，我是好几个人哈哈    \n     2015-01-25 18:37 |    \t\tcuger \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:44        | 这个家伙很懒，什么也没留下)\t\t \n  我擦。。。。为什么忽略了？    \n     2015-01-27 15:30 |    \t\t菜鸟甲 \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:14        | 啥也不会的菜鸟)\t\t \n  我擦。这都能忽略。    \n     2015-09-16 09:29 |    \t\tMark0smith \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:6        | 我更像是一个小松鼠)\t\t \n  这个好，我要慢慢体会    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}