{"id": 11165, "wybug_id": "wooyun-2013-031605", "wybug_title": "拉手网可修改任意用户密码(验证码有效次数绕过)", "wybug_corp": "拉手网", "wybug_author": "niliu", "wybug_date": "2013-07-22 10:26", "wybug_open_date": "2013-07-27 10:27", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "敏感接口缺乏校验", "逻辑错误", "设计不当", "认证设计不合理", "设计错误", "搞笑有爱"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-07-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-07-27：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： RT...影响还是比较大的，涉及到用户的财产安全... 详细说明：  今天，登陆拉手时候发现我把自己的用户名忘了...然后就随手检测了一下...我就拿自己的号码做测试吧...登陆时候，点忘记密码，来到密码找回页面...\n\n选择通过短信找回，这里输入手机号后，目标手机会收到一个6位数的随机验证码...随便输一个验证码提交时抓包...得到如下数据...\n\n接下来，对验证码进行暴力破解...对回包进行比对...错误包：\nHTTP/1.1 200 OKDate: Sun, 21 Jul 2013 03:13:39 GMTContent-Type: text/html; charset=utf-8Connection: closeVary: Accept-EncodingExpires: Thu, 19 Nov 1981 08:52:00 GMTCache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0Pragma: no-cacheServer: LWSVia: web-1-50Vary: Accept-Encoding{\"status\":5,\"msg\":\"\\u9a8c\\u8bc1\\u7801\\u9519\\u8bef\"}\n正确包：\nHTTP/1.1 200 OKDate: Sun, 21 Jul 2013 03:13:39 GMTContent-Type: text/html; charset=utf-8Connection: closeVary: Accept-EncodingExpires: Thu, 19 Nov 1981 08:52:00 GMTCache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0Pragma: no-cacheServer: LWSVia: web-1-48Vary: Accept-Encoding{\"status\":1,\"msg\":\"MTg2MDA5M*******我是马赛克*******NTc5MkB*********jQxOXwzNDQwMDI3NTZkOTY4**********hMA%3D%3D\"}\n\n\n\n\n得到正确验证码，但是经过反复测试，发现拉手的验证码有效性只有一次，就是你输入完验证码到修改密码的页面后，如果返回，再输入验证码这是已经无效了，这样一来，我们破解得到的验证码就无效了....因为我破解是已经用过一次了...到这里真的没有办法突破了吗？就在决定放弃的时候，突然想起一个问题，就是之前用邮箱找回密码时候的密码重置连接...如下图：\n\n只要打开连接，即可重置密码，这个没有有效次数限制...并且，http://www.lashou.com/account/reset?code= [这里这个code很眼熟啊]经过比对，发现就是暴力猜解验证码时，正确验证码返回的数据中的数据...直接组合一下得到重置密码连接...\nhttp://www.lashou.com/account/reset?code=MTg2MDA5M*******我是马赛克*******NTc5MkB*********jQxOXwzNDQwMDI3NTZkOTY4**********hMA%3D%3D\n访问即可重置目标用户密码！\n\n   漏洞证明：  同上   修复方案：  本来是打算暴力破解验证码然后重置用户密码的，但是最后发现验证码有效性只有一次...在想放弃时候却有了新的发现...盒盒...这个你们应该懂吧...ps:听说你们有礼物:-）   版权声明：转载请注明来源 niliu@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-07-27 10:27 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-07-25 06:58 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  @拉手网 漏洞修复没，貌似这个快忽略公开了吧…    \n     2013-07-27 08:08 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  @拉手网  快公开了 …@疯狗 俩一样的漏洞，这个快要忽略公开了，那边还没修复…    \n     2013-07-27 12:12 |    \t\tIXY \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:3        | 小菜来学习的)\t\t \n  @niliu 这个链接有没有时效性 比如半小时一天或者72个小时失效 这个漏洞就是说只要有验证码的code编码后的字符串就可以重置密码 但是这个code是如何加密的 因为如果不知道加密方法是没办法利用的    \n     2013-07-27 13:19 |    \t\twinger \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | Dark Net Top Hacker)\t\t \n  @IXY 输入6位码 获取重置参数， 重置参数的和mail里头的链接刚好是一个. 洞主如果有抓包分析整个过程， 有可能看到邮件里头的那个url. 或者做了一层封装， 然后调用。 这里还算是比较清晰的。 直接用调用http://www.lashou.com/account/reset?code=xxxx 就能修改， 如果是被封装了。 就需要先抓包， 热后分析后面修改的流程。写个批量猜解的工具， 在猜解成功后直接模拟提交修改密码。 这个难度不大。 其实只要一个简单的方法就可以避免针对返回值判断是否成功的爆破攻击。 直接产生错误输出， 同时在结果页面中包含一个错误图片的警告(或者指示下一步操作)， 但是错误和正确返回的html内容都是一样的。攻击者只能分析返回的图片了。 当然6位码时间越短越好。    \n     2013-07-27 14:35 |    \t\tIXY \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:3        | 小菜来学习的)\t\t \n  @winger 重新再看一遍明白了 先是爆破验证码 在正确包里面有包含了这个code的编码 然后直接在用 http://www.lashou.com/account/reset?code=xxxx 就可以了    \n     2013-07-29 09:22 |    \t\t拉手网(乌云厂商)\t\t \n  @niliu 修复了，链接加了有效期    \n     2013-07-31 12:21 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  拉手网送你媳妇~    \n     2013-07-31 12:30 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  @M4sk 毛都木有    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}