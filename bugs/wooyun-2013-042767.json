{"id": 8253, "wybug_id": "wooyun-2013-042767", "wybug_title": "又一次失败的漫游腾讯内部网络过程 #2", "wybug_corp": "腾讯", "wybug_author": "猪猪侠", "wybug_date": "2013-11-13 13:24", "wybug_open_date": "2013-11-13 15:06", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "敏感信息泄露", "错误信息未屏蔽"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 又一次大意导致安全测试失败，不得不赞一下腾讯在PHP安全领域的防护实力，当属国内第一！将本次测试过程写出来，主要是想让乌云的小伙伴们能从中总结出错误经验，从而避免因为相似的粗心大意而使安全测试终止。最后扯一句：小伙伴们，一起期待下一篇“又又一次失败的漫游腾讯内部网络过程”吧！由于没有建立一个通用的标准和防御规则来保护好中间件配置信息、DNS信息、业务数据信息、用户信息、源码备份文件、版本管理工具信息、系统错误信息和敏感地址信息(后台或测试地址)的泄露，攻击者可能会通过收集这些保护不足的数据，利用这些信息对系统实施进一步的攻击。 详细说明：  #1 信息泄露原因由于腾讯论坛管理员在更新服务器文件时，未注意到编辑器会默认创建各种.bak备份文件用来规避错误编辑时引发的数据丢失风险，从而造成了更严重的信息安全威胁。#2 泄露内容网站：tita.qq.com网站：http://tita.qq.com/bbs泄露文件1：http://tita.qq.com/bbs/config/config_global.php.bak泄露文件2：http://tita.qq.com/bbs/config/config_ucenter.php.bak \n:<?php$_config = array();// ---------------------------- CONFIG DB ----------------------------- //$_config['db']['1']['dbhost'] = '10.***.**.54:3303';$_config['db']['1']['dbuser'] = 'mtt';$_config['db']['1']['dbpw'] = 'mtt***';$_config['db']['1']['dbcharset'] = 'gbk';$_config['db']['1']['pconnect'] = '0';$_config['db']['1']['dbname'] = 'discuz_sky';$_config['db']['1']['tablepre'] = 'pre_';$_config['db']['common']['slave_except_table'] = '';// -------------------------- CONFIG MEMORY --------------------------- //$_config['memory']['prefix'] = 'BG1mwW_';$_config['memory']['eaccelerator'] = 1;$_config['memory']['apc'] = 1;$_config['memory']['xcache'] = 1;$_config['memory']['memcache']['server'] = '';$_config['memory']['memcache']['port'] = 11211;$_config['memory']['memcache']['pconnect'] = 1;$_config['memory']['memcache']['timeout'] = 1;// -------------------------- CONFIG SERVER --------------------------- //$_config['server']['id'] = 1;// ------------------------- CONFIG DOWNLOAD -------------------------- //$_config['download']['readmod'] = 2;$_config['download']['xsendfile']['type'] = '0';$_config['download']['xsendfile']['dir'] = '/down/';// --------------------------- CONFIG CACHE --------------------------- //$_config['cache']['type'] = 'sql';// -------------------------- CONFIG OUTPUT --------------------------- //$_config['output']['charset'] = 'gbk';$_config['output']['forceheader'] = 1;$_config['output']['gzip'] = '0';$_config['output']['tplrefresh'] = 1;$_config['output']['language'] = 'zh_cn';$_config['output']['staticurl'] = 'static/';$_config['output']['ajaxvalidate'] = '0';$_config['output']['iecompatible'] = '0';// -------------------------- CONFIG COOKIE --------------------------- //$_config['cookie']['cookiepre'] = 'HeCR_';$_config['cookie']['cookiedomain'] = '';$_config['cookie']['cookiepath'] = '/';// ------------------------- CONFIG SECURITY -------------------------- //$_config['security']['authkey'] = '05b9d******BBJRt';$_config['security']['urlxssdefend'] = 0;$_config['security']['attackevasive'] = '0';$_config['security']['querysafe']['status'] = 1;$_config['security']['querysafe']['dfunction']['0'] = 'load_file';$_config['security']['querysafe']['dfunction']['1'] = 'hex';$_config['security']['querysafe']['dfunction']['2'] = 'substring';$_config['security']['querysafe']['dfunction']['3'] = 'if';$_config['security']['querysafe']['dfunction']['4'] = 'ord';$_config['security']['querysafe']['dfunction']['5'] = 'char';$_config['security']['querysafe']['daction']['0'] = 'intooutfile';$_config['security']['querysafe']['daction']['1'] = 'intodumpfile';$_config['security']['querysafe']['daction']['2'] = 'unionselect';$_config['security']['querysafe']['daction']['3'] = '(select';$_config['security']['querysafe']['daction']['4'] = 'unionall';$_config['security']['querysafe']['daction']['5'] = 'uniondistinct';$_config['security']['querysafe']['dnote']['0'] = '/*';$_config['security']['querysafe']['dnote']['1'] = '*/';$_config['security']['querysafe']['dnote']['2'] = '#';$_config['security']['querysafe']['dnote']['3'] = '--';$_config['security']['querysafe']['dnote']['4'] = '\"';$_config['security']['querysafe']['dlikehex'] = 1;$_config['security']['querysafe']['afullnote'] = '0';// -------------------------- CONFIG ADMINCP -------------------------- //// -------- Founders: $_config['admincp']['founder'] = '1,2,3'; --------- //$_config['admincp']['founder'] = '1';$_config['admincp']['forcesecques'] = '0';$_config['admincp']['checkip'] = 0;$_config['admincp']['runquery'] = 0;$_config['admincp']['dbimport'] = 0;// -------------------------- CONFIG REMOTE --------------------------- //$_config['remote']['on'] = '0';$_config['remote']['dir'] = 'remote';$_config['remote']['appkey'] = '62cf0b3c3e**********16839721d8e';$_config['remote']['cron'] = '0';// ------------------- QROM DIY -------------------- //$_config['plugindeveloper'] = yes;// ------------------- THE END -------------------- //?>\n\n<?phpdefine('UC_CONNECT', 'mysql');define('UC_DBHOST', '10.***.**.54:3303');define('UC_DBUSER', 'mtt');define('UC_DBPW', 'mtt***');define('UC_DBNAME', 'discuz_sky');define('UC_DBCHARSET', 'gbk');define('UC_DBTABLEPRE', '`discuz_sky`.pre_ucenter_');define('UC_DBCONNECT', 0);define('UC_CHARSET', 'gbk');define('UC_KEY', 'bc21Y0P7U4x91fN4Jexdz7********************4M5C8U3NdL8Q3X19eod');define('UC_API', 'http://tita.qq.com/bbs/uc_server');define('UC_APPID', '1');define('UC_IP', '');define('UC_PPP', 20);\n   漏洞证明：  #4 漏洞证明 (有UC_KEY，Discuz等于可以做任何事)详细利用方法参见： WooYun: 途牛网某服务配置失误 导致论坛敏感文件泄露(致使百万用户信息告急) #5 证明细节(对于有些人你不发个SHELL出来，他们永远会觉得这不是安全问题！)例如盛大： WooYun: 盛大某分站敏感配置文件泄露#1 可导致内网渗透 #6 利用细节由于Discuz UC_SERVER 的updateapps接口未严格校验客户端提交的数据，导致可写入任意代码至/config/config_ucenter.php。\n$code=urlencode(_authcode(\"time=$timestamp&action=updateapps\", 'ENCODE', $uc_key));\n鉴于!Discuz在乌云已经属于无良厂商，这里不纰漏详细代码，另外扯一句：Discuz最好做好“以后都别指望从好心的白帽子手上免费获取任何漏洞信息”的准备了！，用Discuz厂商的们，都夹紧尾巴低调吧，别哪天一不小心就被黑了！围观： WooYun: 安全测试#1 如何搞定discuz.net官方！ #7 没图没SHELL说个毛线？\n\n我想被腾讯的全量日志监控系统发现的原因是：“执行了phpinfo()这个坑爹的函数，phpinfo()返回的数据包全是未加密的HTTP原文，从而被监控系统直接识别出里面的各种恶心入侵关键字，触发IDS报警，从而发现了这次的测试行为！”   修复方案：  #1 网络边界需要认真对待。#2 杜绝为了方便而造成的不必要的信息泄露。#3 安全是一个整体，保证安全不在于强大的地方有多强大，而在于真正薄弱的地方在哪里。   版权声明：转载请注明来源 猪猪侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-11-13 15:06 厂商回复： 该漏洞在渗透过程中我们已经发现并处理，暂未发现对业务和用户造成安全影响，如您有进一步发现，请及时与我们联系。 漏洞Rank：8  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-11-13 13:25 |    \t\tjeary \t\t\t( 普通白帽子  |\t\t\t        Rank:296 漏洞数:106        | (:‮.kcaH eb nac gnihtynA))\t\t \n  碰巧坐上沙发，我是一楼。坐等忽略。    \n     2013-11-13 13:26 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  mark!!    \n     2013-11-13 13:26 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  又一次....    \n     2013-11-13 13:27 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  小伙伴们，一起期待下一篇“又又一次失败的漫游腾讯内部网络过程”吧！    \n     2013-11-13 13:27 |    \t\t园长 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:14        | 你在身边就是缘，缘分写在数据库里面。)\t\t \n  路过，请敲门。    \n     2013-11-13 13:27 |    \t\t光头强 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:3        | 惹我光头强，揍你没商量！)\t\t \n  @猪猪侠 又又，切克闹，腾讯裤子来一套，来一套！！！    \n     2013-11-13 13:29 |    \t\tEvi1m0 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 邪红色信息安全组织)\t\t \n  1024    \n     2013-11-13 13:37 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  1024    \n     2013-11-13 13:38 |    \t\tsolihat \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | white hat,webapp security)\t\t \n  感谢猪猪侠同学的友情检测，我们会继续提升能力，也请各位白帽子在安全测试中注意遵守国家相关法律!    \n     2013-11-13 13:41 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  期待下一篇“一次成功的漫游腾讯内部网络过程”！     \n     2013-11-13 13:42 |    \t\tpangshenjie \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:14        )\t\t \n  我的偶像啊。。。。@猪猪侠 可以爆个照么。求签名吧    \n     2013-11-13 13:47 |    \t\tjeary \t\t\t( 普通白帽子  |\t\t\t        Rank:296 漏洞数:106        | (:‮.kcaH eb nac gnihtynA))\t\t \n  期待下一篇“我是如何在腾讯内部找到某某接口”！    \n     2013-11-13 13:50 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:177 漏洞数:31        | Hacked by @ringzero 我錯了)\t\t \n  猪猪侠应该先去腾讯应聘，然后就有“我是如何成功打入腾讯内部”    \n     2013-11-13 13:50 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  期待下一篇“我是如何入侵乌云并给每个人1000 WB”！    \n     2013-11-13 13:51 |    \t\tMr.醉心 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 爱生活，爱音乐，爱美女，更爱波多野结衣)\t\t \n  又又，切克闹，腾讯裤子来一套，来一套！！！     \n     2013-11-13 13:57 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  老失败啊 怎么    \n     2013-11-13 14:00 |    \t\ty0umer \t\t\t( 普通白帽子  |\t\t\t        Rank:103 漏洞数:11        | 装逼就像大姨妈,一月来一次足矣)\t\t \n  这个必须..    \n     2013-11-13 14:02 |    \t\tPgHook \t\t\t( 普通白帽子  |\t\t\t        Rank:964 漏洞数:115        | ...........................................)\t\t \n  怎么又失败了啊！期待你下次成功啊！    \n     2013-11-13 14:07 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  - -无数个膜拜不说话    \n     2013-11-13 14:16 |    \t\tSleshep \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 隼)\t\t \n  失败是成功他妈    \n     2013-11-13 14:22 |    \t\t低调的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:466 漏洞数:68        | loading……………………)\t\t \n  后排占位~~~~~~~~猪猪太霸气了~~~~必须学习    \n     2013-11-13 14:53 |    \t\t剑无名 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:32        | 此剑无名。)\t\t \n  小伙伴们，一起期待下一篇“又又一次失败的漫游腾讯内部网络过程”吧！     \n     2013-11-13 14:57 |    \t\t机械迷城 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 菜鸟一枚。。大牛飘过)\t\t \n  期待    \n     2013-11-13 15:06 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  期待下一篇“一次成功的漫游腾讯内部网络过程”！    \n     2013-11-13 15:24 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  太好了...公布了...学习学习。。。    \n     2013-11-13 15:34 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  执行了phpinfo()这个坑爹的函数....就被发现了？好强大的防御系统。感谢TX忽略此漏洞，让小伙伴们提前查看细节！    \n     2013-11-13 15:41 |    \t\tM0nster \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:17        | 允许我国的艺术家先富起来)\t\t \n  偶像    \n     2013-11-13 16:19 |    \t\tsql  \t\t\t( 核心白帽子 |\t\t\t        Rank:1127 漏洞数:145        | 带着两个MM（mysql,mssql），玩3p（asp,php...)\t\t \n  貌似猪哥的扫描器 扫 config_global.php.bak 之类很牛逼的样子哦    \n     2013-11-13 16:33 |    \t\t剑无名 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:32        | 此剑无名。)\t\t \n  @sql 我总觉得你的sql扫描器也很牛逼，可以分享给我吗？    \n     2013-11-13 16:44 |    \t\txx123 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 雷锋)\t\t \n  MARK,猪哥V5    \n     2013-11-13 18:25 |    \t\t盛大网络(乌云厂商)\t\t \n  UC_API GBK吧    \n     2013-11-13 18:33 |    \t\tfeng \t\t\t( 普通白帽子  |\t\t\t        Rank:664 漏洞数:79        | 想刷个6D)\t\t \n  敢成功一次不    \n     2013-11-13 19:43 |    \t\tjaojan \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:10        | xss my life)\t\t \n  猪哥V587    \n     2013-11-13 20:25 |    \t\t233 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:4        | 小孩子看了根本把持不住)\t\t \n  V587    \n     2013-11-13 22:12 |    \t\tMas \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:15        )\t\t \n  @猪猪侠 一哥你好 一哥再见    \n     2013-11-14 00:36 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  memcached利用了没    \n     2013-11-14 08:56 |    \t\t坏虾 \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:8        | From Internet,For Internet……BY：坏虾)\t\t \n  霸气测漏，大家一起渗透测试腾讯内网吧   期待与猪哥在腾讯内网见面    \n     2013-11-14 09:52 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  - -！这是什么节奏，无影响，厂商忽略...    \n     2013-11-15 10:03 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n  @盛大网络 你又来调皮了    \n     2013-11-15 11:49 |    \t\t伟哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:29        | 不怕流氓有文化,就怕色狼有耐心,那么一只起...)\t\t \n  砖石已到帐请注意查收。    \n     2013-11-16 10:59 |    \t\t沦沦 \t\t\t( 普通白帽子  |\t\t\t        Rank:504 漏洞数:127        | 爱老婆，爱生活)\t\t \n  黑哥成为一哥啦    \n     2013-11-17 11:38 |    \t\tinsight-labs  \t\t\t( 普通白帽子  |\t\t\t        Rank:623 漏洞数:75        | Security guys)\t\t \n  应该不是通过返回的数据被发现，估计是那个直接出现在url里的phpinfo    \n     2013-11-22 23:16 |    \t\t西毒 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:33        | 心存谦卑才能不断超越自我)\t\t \n  heige 真是个牛逼人物    \n     2013-11-24 13:15 |    \t\t腾讯厂商 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | script>document.cookie(\"http//a.cc/21.js...)\t\t \n    哈哈  猪猪侠你好！    \n     2013-12-09 22:58 |    \t\tCpt.Tony \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 兴趣)\t\t \n  腾讯表示再也受不了了……    \n     2013-12-09 23:02 |    \t\tCpt.Tony \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 兴趣)\t\t \n  @腾讯厂商 tita这玩意实在坑爹，麻烦你们处理好了再上线成不？    \n     2013-12-11 08:57 |    \t\t低调 \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:18        | .......)\t\t \n  咱能成功次吗？    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}