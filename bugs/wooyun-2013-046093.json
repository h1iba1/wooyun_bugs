{"id": 5440, "wybug_id": "wooyun-2013-046093", "wybug_title": "phpcms v9  SQL注入漏洞（第二弹）", "wybug_corp": "phpcms", "wybug_author": "狗狗侠", "wybug_date": "2013-12-16 11:01", "wybug_open_date": "2014-03-16 11:02", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-12-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-02-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-16：\t细节向公众公开  简要描述： null 详细说明：  第二次玩乌云，等待乌云发BB漏洞文件发生在phpcms\\modules\\member\\index.php中392行 \npublic function account_manage_info() { // account_manage_info方法，就是更新个人资料\t\tif(isset($_POST['dosubmit'])) {\t\t\t//更新用户昵称\t\t\t$nickname = isset($_POST['nickname']) && trim($_POST['nickname']) ? trim($_POST['nickname']) : ''; //存在真名名字就去掉2边空格\t\t\tif($nickname) {\t\t\t\t$this->db->update(array('nickname'=>$nickname), array('userid'=>$this->memberinfo['userid'])); //存在$nickname这个变量就更新真实名字，漏洞发生在此处\t\t\t\tif(!isset($cookietime)) {\t\t\t\t\t$get_cookietime = param::get_cookie('cookietime');\t\t\t\t}  // 取出cookietime\t\t\t\t$_cookietime = $cookietime ? intval($cookietime) : ($get_cookietime ? $get_cookietime : 0);\t\t\t\t$cookietime = $_cookietime ? TIME + $_cookietime : 0;\t\t\t\tparam::set_cookie('_nickname', $nickname, $cookietime);//这里设置cookie\t\t\t}………………….//省略若干无关代码\n我们注册用户，然后修改个人信息http://127.0.0.1/index.php?m=member&c=index&a=account_manage_info&t=1我们更新测试下，将带有’ （单引号的名字）带入数据库试试\n\n然后我们看看数据库中对应表的更新\n\n然后发现已经成功进入了数据库接下来我们要做的就是重新登录（必须重新注销登录，因为要用到这里重新登录的cookie）当我们重新登录的时候在phpcms\\modules\\member\\index.php中543行\tpublic function login() {\t\t$this->_session_start();\t\t//…..省略若干代码\t\t\tparam::set_cookie('auth', $phpcms_auth, $cookietime);\t\t\tparam::set_cookie('_userid', $userid, $cookietime);\t\t\tparam::set_cookie('_username', $username, $cookietime);\t\t\tparam::set_cookie('_groupid', $groupid, $cookietime);\t\t\tparam::set_cookie('_nickname', $nickname, $cookietime);       //…..省略若干代码这里我们发现已经重新设置nickname的cookie了，而这里的$nickname也是从数据库里面取出来的。我们看phpcms\\modules\\comment\\index.php中的post方法\n\n这里的$username变量是通过cookie过来的然后这个$username变量又做了些什么呢？在phpcms\\modules\\comment\\index.php 100行处\n\n发现这个它赋给了一个$data数组，然后进入了数据库，一个insert语句$comment->add()这样一个过程上面是一个提交评论的操作，我们的攻击思路是这样的当我们提交评论的时候，截取我们的数据包，将其中的username这个cookie值用我们nickname这个cookie值来代替，这样就起到了注入的效果了，我们测试下具体攻击过程就不演示了。。。贴一下官网测试的结果\n\n   漏洞证明：  \n\n   修复方案：  这个....在入数据库前做过滤吧，记得若干年前80vul的那句。。。一切变量都是有害的   版权声明：转载请注明来源 狗狗侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-12-17 13:34 厂商回复： 感谢提交 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-12-16 11:03 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  我了个去啊。。去啊。。去啊。。。    \n     2013-12-16 11:05 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  围观狗狗侠    \n     2013-12-16 11:05 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  名字亮了    \n     2013-12-16 11:06 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  我了个去啊。。去啊。。去啊。。。    \n     2013-12-16 11:06 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  我了个去啊。。去啊。。去啊。。。    \n     2013-12-16 11:08 |    \t\t狗狗侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:497 漏洞数:55        | 我是狗狗侠)\t\t \n  @猪猪侠  围观猪猪侠，我们是同一个马甲    \n     2013-12-16 11:12 |    \t\tm1x7e1 \t\t\t( 普通白帽子  |\t\t\t        Rank:543 漏洞数:132        | 求工作)\t\t \n  @狗狗侠 @猪猪侠 敢不敢 整一个十二生肖!! 鼠鼠侠，牛牛侠，虎虎侠，兔兔侠，龙龙侠，蛇蛇侠，马马侠，羊羊侠，猴猴侠，鸡鸡侠，狗狗侠，猪猪侠。。    \n     2013-12-16 11:52 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  连载啊，尼玛！！！    \n     2013-12-16 13:11 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  狗狗侠回来了，围观    \n     2013-12-16 14:44 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  这一季叫 狗狗侠归来    \n     2013-12-16 15:30 |    \t\t小土豆 \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:23        )\t\t \n  好屌！！！！    \n     2013-12-16 22:15 |    \t\t忆苦思甜 \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:25        )\t\t \n  太流逼了 最近V9真惨    \n     2013-12-16 23:21 |    \t\t鸡总 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        )\t\t \n  老员工下岗了造成的？    \n     2013-12-17 09:21 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  马克    \n     2013-12-17 10:12 |    \t\tBr4iden \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:5        | 塞翁失马，焉知非福)\t\t \n  @鸡总 一个很熟悉的名字。。。    \n     2013-12-17 14:07 |    \t\tEbon_Wolf \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:24        | 您好，我似咣咚朲，需要服务吗？专业酱油工...)\t\t \n  360已经提交N多    \n     2013-12-21 14:15 |    \t\tayys \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 欢迎交流，熟悉正方教务系统漏洞。专业挖洞...)\t\t \n  快用GreenCMS    \n     2014-01-06 14:47 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  给力    \n     2014-01-07 07:39 |    \t\tetcat \t\t\t( 普通白帽子  |\t\t\t        Rank:149 漏洞数:22        | 0101010101001010101010101010100101010101...)\t\t \n  第二次玩乌云   你这么屌  你家里人知道么    \n     2014-01-07 09:11 |    \t\tfeng \t\t\t( 普通白帽子  |\t\t\t        Rank:664 漏洞数:79        | 想刷个6D)\t\t \n  狗哥第二次玩乌云 还是个小菜啊 ，你女朋友知道么    \n     2014-01-07 15:41 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  看文笔应该是 @西毒 无疑    \n     2014-01-23 13:31 |    \t\tlitao13 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 从事互联网行业15年余载，专注于web端与网...)\t\t \n  2014-01-06：\t细节向普通白帽子公开我为啥看不到    \n     2014-01-23 14:22 |    \t\tw5r2 \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:52        )\t\t \n  测试 这个'进不去，不知道lZ是什么版本.    \n     2014-02-16 17:33 |    \t\tL.X \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 分享和谐)\t\t \n  nickname字段长度只有20怎么把注入语句带入咧，似乎没什么利用价值啊~~~    \n     2014-02-17 22:10 |    \t\t笨小猪 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:2        | 杯壁下流)\t\t \n  @litao13 你只是一头路人。    \n     2014-03-31 16:56 |    \t\t小痞子 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:21        | <xss>alert(\"a\")</xss>￥&@&……dssKhwjcw...)\t\t \n  厉害~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}