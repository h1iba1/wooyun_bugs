{"id": 12271, "wybug_id": "wooyun-2013-025356", "wybug_title": "PHPCMS V9 任意文件包含漏洞", "wybug_corp": "phpcms", "wybug_author": "tenzy", "wybug_date": "2013-06-07 15:09", "wybug_open_date": "2013-06-12 15:10", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-06-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-06-12：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 某处考虑不严谨，有可能导致文件包含漏洞。利用条件：register_global=ON 详细说明：  漏洞文件：/plugin.php漏洞代码：22行触发条件：register_global=ON代码片段：15到22行\nif(isset($_GET['id'])) {\tif(!preg_match(\"/^[a-z0-9_\\-]+$/i\",$_GET['id'])) showmessage((L('illegal_parameters')));\tlist($identification, $filename,$action) = explode('-', $_GET['id']);\t$filename = !empty($filename) ? $filename : $identification;\t$action = !empty($action) ? $action : 'init';}$cache = getcache($identification,'plugins');\n因为只有if(isset($_GET['id']))的情况下，$identification变量才会被初始化，因此请求时，不提交$_GET['id']，直接identification=./xxxx/xxxx/xxx.php%00同时利用长文件名截断或%00截断，可以完美利用此漏洞、神马？还不完美？不能包含木马文件？好吧，我们再看回以前的一个漏洞： WooYun: PHPCMS V9 getwebshell漏洞 无需任意权限，此修复后依旧可以直接上传图片，此文件包含漏洞加上老的文件上传漏洞，还有什么做不到的。   漏洞证明：  漏洞文件：/plugin.php漏洞代码：22行触发条件：register_global=ON代码片段：15到22行\nif(isset($_GET['id'])) {\tif(!preg_match(\"/^[a-z0-9_\\-]+$/i\",$_GET['id'])) showmessage((L('illegal_parameters')));\tlist($identification, $filename,$action) = explode('-', $_GET['id']);\t$filename = !empty($filename) ? $filename : $identification;\t$action = !empty($action) ? $action : 'init';}$cache = getcache($identification,'plugins');\n   修复方案：  无   版权声明：转载请注明来源 tenzy@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-06-12 15:10 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-06-07 15:15 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  前排    \n     2013-06-07 15:48 |    \t\tlucky \t\t\t( 普通白帽子  |\t\t\t        Rank:409 漏洞数:81        | 三人行必有我师焉########################...)\t\t \n  前排    \n     2013-06-07 15:50 |    \t\tAepl│恋爱 \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:15        | Forzen恋爱-不要做你的Guest 只想做的你adm...)\t\t \n  前排    \n     2013-06-07 15:56 |    \t\tGetshell \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        )\t\t \n  我爱你，大牛    \n     2013-06-07 15:57 |    \t\tAepl│恋爱 \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:15        | Forzen恋爱-不要做你的Guest 只想做的你adm...)\t\t \n  @Getshell 脱离队伍 拉出去弹JJ10分钟    \n     2013-06-07 16:00 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  mark    \n     2013-06-07 16:11 |    \t\t温柔杀手 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 这是个马甲，用来装比)\t\t \n  mark    \n     2013-06-07 16:24 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  马克    \n     2013-06-07 17:48 |    \t\tmsx2009 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:7        | 信息安全 web开发)\t\t \n  马克    \n     2013-06-07 19:38 |    \t\t0xTback \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 初入江湖，请多多关照~！！！)\t\t \n  好像一般register_global都默认off    \n     2013-06-07 21:51 |    \t\ttenzy \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:21        | Need not to know)\t\t \n  @0xTback 否则我会发出来么。。。    \n     2013-06-07 21:51 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  @tenzy 我信洞主！    \n     2013-06-07 22:13 |    \t\tGetshell \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        )\t\t \n  @Aepl│恋爱 呀么蝶，我下次不敢了，呜呜呜....    \n     2013-06-08 09:53 |    \t\tkimdle \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | @kimdle)\t\t \n  前排！    \n     2013-06-13 10:17 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:170        | 力不从心)\t\t \n  什么情况？    \n     2013-07-12 10:46 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n  if(!$cache['disable'] || !preg_match(\"/^[a-z0-9_\\-]+$/i\", $identification) || $filename=='plugin_admin'  || $filename=='hook') {\tshowmessage(L('plugin_not_exist','','plugin'));}23~26行的验证，可以绕过？求教。。    \n     2013-11-18 20:17 |    \t\t廷廷 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 有很强的好奇心，爱好广泛，求女女带走。。...)\t\t \n  register_global=ON 鸡肋啊！！    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}