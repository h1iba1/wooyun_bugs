{"id": 71547, "wybug_id": "wooyun-2015-0138397", "wybug_title": "滴滴打车客户端存在重大可被安全隐患可进行远程控制或钓鱼", "wybug_corp": "小桔科技", "wybug_author": "Moonight", "wybug_date": "2015-09-01 17:29", "wybug_open_date": "2015-12-01 02:46", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-05：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-01：\t细节向公众公开  简要描述： 滴滴打车客户端可被攻击者进行远程控制，甚至获取滴滴打车客户端内所有机密信息。高版本系统可以进行钓鱼。 详细说明：  需要注意的是该漏洞利用方法是在非root机器上，只需发送一个intent消息便可以控制滴滴打车客户端，也可以发送指定的url链接对滴滴打车客户端进行钓鱼1. 滴滴打车客户端存在导出组件com.didi.game.activity.GameActivity2. 该组件会接收extra参数url，注意该参数是攻击者完全可控的，可以发送任意的url\n\n3. 当接收到该url后，WebActivity的initData会接收该Intent发过来并获取WebviewModel类封装后的参数，最终会调用CommonWebviewEx.loadurl对url进行加载\n\n4.关键的地方来了，由于url是完全可控的，所以我们将url设置为我们自己的url，同时注意另一个关键点，滴滴打车使用了addjavascriptinterface接口，并导出了对象DidiJSBridge\n\n5.我们在自己的url对应的html页面中嵌入js代码，该js代码利用该java对象DidiJSBridge进行反射调用shell，这里我简单调用了一个ls -l，当然也可以通过nc等方式进行反向shell连接我的服务器，由于是在滴滴客户端的webview内部加载的，我也具有权限读取/data/data/com.sdu.didi.psnger目录下所有文件发送给我自己的服务器，远控示例代码如下图：\n\n6.intent的启动我是使用drozer发送的命令\n\n   漏洞证明：  下面是通过上述代码发送intent消息后客户端的显示，已经列出了shell当前的所有文件信息\n\n   修复方案：  1.对组件导出进行限制2.对客户端打开的url进行控制3.添加@JavascriptInterface注解或去除addjavascriptinterface接口   版权声明：转载请注明来源 Moonight@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-09-02 02:45 厂商回复： 感谢白帽子，这个分析过程非常详细，也从中感受到白帽子的细心和对技术认真态度。从技术层面上来说，白帽子通过代码分析，理顺了一条可执行的漏洞利用思路，这是亮点，但我们给出的评分不高，且可能分值有些对不住漏洞标题，简单说明下：首先，漏洞触发有先决条件，其次，漏洞影响面依赖于钓鱼命中情况，最后，这个漏洞利用收益比较有限。 最新状态： 2015-09-02：对白帽子的质疑我们上午进行了激烈的内部讨论，结论是Rank确实应该调高。但wooyun Rank没法调整，我们再联系白帽子沟通协调这个漏洞的后续处理。  ", "replys": "漏洞评价：\n评论\n     2015-09-01 17:32 |    \t\tZhe \t\t\t( 普通白帽子  |\t\t\t        Rank:843 漏洞数:218        | 踏马的。，千万只草泥马)\t\t \n  来学习一下    \n     2015-09-01 17:32 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1234 漏洞数:122        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  三哥说好屌,前来膜拜    \n     2015-09-01 17:48 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @子非海绵宝宝 不好意思，最近才混乌云，请问三哥是？    \n     2015-09-01 17:52 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1077 漏洞数:139        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  前排支持下。。 欢迎洞主    \n     2015-09-01 17:53 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:868 漏洞数:102        )\t\t \n  楼上3哥    \n     2015-09-01 17:54 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1234 漏洞数:122        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  @Moonight @zeracker 这位就是大乌云三哥了     \n     2015-09-01 17:57 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @子非海绵宝宝 大牛好，三哥好，请多多指教    \n     2015-09-02 07:48 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  漏洞影响面是非root设备安装的任意的滴滴打车客户端。注意我说的影响是远程控制而不是钓鱼？即使是钓鱼你们认为这个rank合适吗？官方确认给这个rank，认为危害是低危是吗？求官方解释什么样的客户端漏洞是高危？你们对待这个漏洞这个态度那我没什么可说的了。。。    \n     2015-09-02 09:07 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  还有官方是不是根本没有理解这个漏洞，上面那么多当我白说，你看到的最直白的结果就是我发送一个intent消息就可以远程控制你的客户端    \n     2015-09-02 14:13 |    \t\t猫和老鼠 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | ...)\t\t \n  @小桔科技  给点RMB洞主    \n     2015-09-02 15:07 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @小桔科技 方便再联系吗？这个漏洞这么处理我不认同的？shell都执行了，你告诉我利用范围有限？    \n     2015-09-02 15:16 |    \t\t猫和老鼠 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | ...)\t\t \n  管这么多干哈呢，又不是他们员工，干嘛要一直帮着他们，分都给了。    \n     2015-09-03 06:51 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @猫和老鼠  后来联系到厂商了，之前处理漏洞的人根本没理解漏洞，厂商后续态度还蛮好的    \n     2015-09-05 10:37 |    \t\twebshell \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:18        | 没有伞的孩子必须努力奔跑。)\t\t \n  @Moonight 这就对了。处理漏洞的人没理解这可是误事的。    \n     2015-09-05 11:59 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @webshell 嗯嗯，是啊    \n     2015-09-06 11:56 |    \t\t大师兄 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:6        | 每日必关注乌云)\t\t \n  厂商的态度还算可以,为洞主和厂商都点个赞    \n     2015-09-06 16:53 |    \t\t开心一下1313 \t\t\t( 实习白帽子  |\t\t\t        Rank:63 漏洞数:20        | 喝口水,压压惊......)\t\t \n  @Moonight 还好你遇到这厂商能及时发现自己问题及时改错，不然你肠子都要悔青哦    \n     2015-09-06 17:04 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @开心一下1313 是呢，是呢，谢谢: )    \n     2015-09-06 19:52 |    \t\tSpid3r \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:10        | 常年撒网打鱼.)\t\t \n  果然是师兄驾到啊，三哥要好好招待咯    \n     2015-09-06 20:10 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @Spid3r 小星星怎么猜到我的啊    \n     2015-09-07 09:18 |    \t\tSpid3r \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:10        | 常年撒网打鱼.)\t\t \n  @Moonight  博客图标咯 哈哈    \n     2015-09-07 09:33 |    \t\tMoonight \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:7        | 无线安全攻城狮)\t\t \n  @Spid3r 哈哈，机智的小星星    \n     2015-09-08 21:23 |    \t\t老虎 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 低调)\t\t \n  知道怎么打的了    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}