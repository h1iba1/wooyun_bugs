{"id": 50151, "wybug_id": "wooyun-2014-078728", "wybug_title": "YXCMS最新版绕过补丁继续任意文件删除", "wybug_corp": "yxcms.net", "wybug_author": "xfkxfk", "wybug_date": "2014-10-10 13:03", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "源码审核", "任意删除文件"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-15：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： YXCMS最新版绕过补丁继续任意文件删除 详细说明：  最早Matt牛在2013-12-30发的一个漏洞： WooYun: yxcms任意文件删除 导致的重新安装漏洞 厂商在2014-01-13发布了升级包，修改这个漏洞但是处理的不严格，可以绕过，继续进行任意文件删除看代码protected/apps/members/contoller/newscontroller.php\nif (empty($_FILES['picture']['name']) === false){                $tfile=date(\"Ymd\");\t\t\t\t$imgupload= $this->upload($this->uploadpath.$tfile.'/',config('imgupSize'),'jpg,bmp,gif,png');                $imgupload->saveRule='thumb_'.time();\t\t\t\tif(!empty($_POST['oldpicture']) && $_POST['oldpicture']!=$this->nopic){\t\t\t\t\t$picpath=$this->uploadpath.$_POST['oldpicture'];\t\t\t\t\t$lasts=strtolower(substr($_POST['oldpicture'],-3));\t\t\t\t\tif(file_exists($picpath) && in_array($lasts,array('gif','jpg','png','bmp'))) @unlink($picpath);\t\t\t\t}\t\t\t\t$imgupload->upload();\t\t\t\t$fileinfo=$imgupload->getUploadFileInfo();\t\t\t\t$errorinfo=$imgupload->getErrorMsg();\t\t\t\tif(!empty($errorinfo)) $this->alert($errorinfo);\t\t\t\telseif($fileinfo[0]['savename']) $data['picture']=$tfile.'/'.$fileinfo[0]['savename'];\t\t\t}\t\t\tmodel('news')->update(\"id='$id'\",$data);\t\t\t$this->success('资讯编辑成功~',url('news/index'));\n厂商在删除文件之前，加了后缀的判断$lasts=strtolower(substr($_POST['oldpicture'],-3));in_array($lasts,array('gif','jpg','png','bmp')判断后缀必须是('gif','jpg','png','bmp')这里面的但是在windows下可以使用%00进行截断这样即可绕过后缀的限制，继续删除任意文件了   漏洞证明：  1、登陆前台，然后添加一个news，要上传一张封面图片2、然后再编辑这个news，在上传另外一张封面图片3、提交时抓包，修改此时的oldpicture为：./../../protected/apps/install/install.lock%00a.jpg\n\n4、此时install.lock文件已经被删除了\n\n   修复方案：  判断后缀没用，这个要删除的文件不直接从POST提交，用户不可控就好了或者进行严格过滤处理   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-10 14:08 |    \t\tMartial \t\t\t( 普通白帽子  |\t\t\t        Rank:544 漏洞数:105        )\t\t \n  强，火钳刘明    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}