{"id": 84915, "wybug_id": "wooyun-2016-0170504", "wybug_title": "51TALK（zabbix命令执行）SVN泄漏主站源码某处撞库", "wybug_corp": "无忧英语", "wybug_author": "陆由乙", "wybug_date": "2016-01-17 21:09", "wybug_open_date": "2016-02-27 11:49", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-27：\t细节向公众公开  简要描述： ，，，，，，，，，，，，，，好贵的英语学费。 详细说明：  \n\nhttp://116.213.69.250/index.phpzabbix弱口令:admin/zabbix两处SVNhttp://pms.51talk.com/.svn/entrieshttp://ts.51talk.com/.svn/entries然而第二处碉堡了，估计是主站的老代码，跟主站相似度极高。   漏洞证明：  \n\n我就不shell了毕竟权限是zabbix还要提权\n\n看一个有意思的文件wj_user.php\n<?php/** * 91外教用户注册信息 * @author malh<malinghui@51talk.com> * */include 'init.php';//判断ip来源$arr_return    = array();$ip = getClientIP();if (!in_array($ip, array('121.40.145.142', '112.124.41.101'))) {\t$arr_return['code'] = -2;\t$arr_return['url'] = '';\t$arr_return['msg'] = '非法请求';\techo json_encode($arr_return);exit;}//实例化模型$obj_user      = Load::loadModel(\"User\");$obj_stu_point = Load::loadModel(\"StuPoint\");$obj_storage   = new Storage('/logs/');//接收参数$data  = Http::post('data');$token = Http::post('token');//添加log日志$file = '91/' . date('Y_m', time()) . '_reg_log.txt';$obj_storage->write($file, $data . \"\\r\\n\", false);//解析用户参数        $data_arr = unserialize($data);//安全token验证$key       = '51talk';$token_md5 = md5(md5($data) . $key);if ($token_md5 != $token) {\t$arr_return['code'] = -2;\t$arr_return['url'] = '';\t$arr_return['msg'] = '签名错误';\techo json_encode($arr_return);exit;}//验证用户信息$fromurl       \t\t   = explode(',', Http::cookie('from_url'));$from                  = $data_arr['from'];//1.网站、2.wap$userinfo['user_name'] = $data_arr['mail'];$userinfo['password']  = $data_arr['password'];$userinfo['mobile']    = $data_arr['phone'];$userinfo['nickname']  = $data_arr['nickname'];$userinfo['from_url']  = $fromurl[0];$userinfo['key_word']  = Http::cookie('query_wd');$userinfo['from_ip']   = $data_arr['ip'];$userinfo['ext_id']    = Http::cookie('baihe_user_id', '');$userinfo['register_from'] = 1001;$obj_reg = new Model_Register($userinfo, $recommen_code);//检查注册合法性if (!$obj_reg->waiJiaoCheckReg()) {\t$arr_return['code'] = -1;\t$arr_return['url'] = $from >1 ? 'http://wap.51talk.com/login.php' : 'http://www.51talk.com/user/user_login.php';\t$arr_return['msg'] = $obj_reg->getMessage();\techo json_encode($arr_return);exit;}$user_id = $obj_reg->doReg();//执行注册if (!$user_id) {\t$arr_return['code'] = -1;\t$arr_return['url'] = $from >1 ? 'http://wap.51talk.com/register.php' : 'http://www.51talk.com/user/user_register.php';\t$arr_return['msg'] = '注册时出现异常,请重新注册';\techo json_encode($arr_return);exit;}$user_toke = encode($data_arr['mail'].'_'.$data_arr['password'].'_'.$from.'_'.time());$arr_return['code'] = 1;$arr_return['url'] = $from >1 ? 'http://www.51talk.com/wj_user_login.php?token='.$user_toke : 'http://www.51talk.com/wj_user_login.php?token='.$user_toke;$arr_return['msg'] = '';echo json_encode($arr_return);exit;\n无限注册?http://pms.51talk.com/login撞库，\n\n   修复方案：  改口令，删.svn目录，加验证码。   版权声明：转载请注明来源 陆由乙@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2016-01-19 12:00 厂商回复： 已联系相关人员进行处理，谢谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}