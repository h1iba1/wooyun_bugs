{"id": 24248, "wybug_id": "wooyun-2010-0146", "wybug_title": "Discuz！7.2/X1 第三方插件SQL注入及持久型XSS漏洞", "wybug_corp": "Discuz!", "wybug_author": "CnCxzSec(衰仔)", "wybug_date": "2010-07-31 21:05", "wybug_open_date": "2010-08-31 00:00", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射", "持久型", "第三方合作不可控"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2010-07-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2010-08-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2010-08-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2010-08-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2010-08-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2010-08-31：\t细节向公众公开  简要描述： Discuz！7.2/X1 第三方插件SQL注入及持久型XSS漏洞。SQL注入比较鸡肋，要求GPC为off（目前这样的网站几乎绝版了）XSS因为是持久型的，只要管理员打开此应用即会触发。利用XSS怎么操作就见仁见智了。 详细说明：  由Discuz！认证的（http://addons.discuz.com/workroom.php）第三方开发团队“潮流少年工作室 Teen Studio”出品的心情墙插件（http://www.discuz.net/forum.php?mod=viewthread&tid=1632898），因变量未初始化及过滤不严导致SQL注入及跨站脚本漏洞。moodwall.inc.phpSQL注入,除下面代码这一处外，本文件还有很多处这样的或是$_POST得到后直接用的情况。惨不忍睹。\nelseif($action == 'edit_mood' && moodid) {          //moodid未初始化，直接代入sql查询\t  $check = $db->result_first(\"SELECT * FROM {$tablepre}moodwall WHERE id='$moodid' AND uid='$discuz_uid'\");\t  if(!$check || !$moodid) {\t\t  showmessage('moodwall:moodwall_inc_php_2', 'plugin.php?id=moodwall&action=user_mood');\t  }\t  $sql = \"SELECT * FROM {$tablepre}moodwall WHERE id='$moodid'\";\t  $query = $db->query($sql);\t  $moodlist_edit = array();\t  while($mood_edit = $db->fetch_array($query)) {\t\t  $moodlist_edit[] = $mood_edit;\t  }\nXSS\n$uid=$_POST[uid];\t $username=$_POST[username];\t $bgpic=$_POST[bgpic];\t $mood=$_POST[mood];\t $message=$_POST[message];\t $dateline=time();          //$_POST得到数据直接入库，前端出库代码也没有做过滤，这里就不贴了。\t $db->query(\"INSERT INTO {$tablepre}moodwall (uid,username, bgpic, mood, message, dateline) VALUES ('$uid', '$username', '$bgpic', '$mood', '$message', '$dateline')\");\n   漏洞证明：  随意找一个安装此应用的网站：\n/plugin.php?id=moodwall&action=edit_mood&moodid=2'\n发表心情处直接插入html代码\n\"><script>alert(/xss/)</script>\n   修复方案：  过滤啊过滤，初始化啊初始化。强烈建议Discuz！团队对第三方的应用做严格的审查后再在自己的官方论坛上发布。Discuz！败在插件上也不是一次两次了。   版权声明：转载请注明来源 CnCxzSec(衰仔)@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2010-08-01 20:55 厂商回复： 感谢您的支持，我们将会尽快联系插件作者，并尽快做出修正 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}