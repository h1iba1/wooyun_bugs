{"id": 4627, "wybug_id": "wooyun-2014-049703", "wybug_title": "Discuz! X3.1 刷分系列漏洞之2", "wybug_corp": "Discuz!", "wybug_author": "Coxxs", "wybug_date": "2014-01-24 10:26", "wybug_open_date": "2014-04-24 10:27", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "低", "wybug_rank_0": "3", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-01-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-03-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-24：\t细节向公众公开  简要描述： Discuz!X最新版本（及部分旧版本所存在的刷分漏洞）这几天整理DZ的刷分漏洞，原本打算出个系列发上来，结果发现不少漏洞都已经fix了，这可能已经是系列的最后一个了吧。 详细说明：  在使用“千斤顶”道具时，使用的数量缺少负值判断上面的一句话已经很清晰地说明问题了，所以这里就不分析的很详细了使用“千斤顶”道具时，会调用以下文件：source\\class\\magic\\magic_jack.php在该文件的57行开始，是使用道具的部分：\nfunction usesubmit() {...$magicnum = intval($_GET['magicnum']);...}\n其中的$magicnum就是在使用道具时，填写的使用数量。填入正数时，会正常消耗相应数量的“千斤顶”道具。但由于这个变量未进行负值判断，造成填入负数时，可以直接获得大量“千斤顶”道具。具体重现步骤，在漏洞说明中详述。   漏洞证明：  1、购买一个千斤顶道具2、打开任意帖子，在右下角选择“千斤顶”道具，提示：\n本次使用数量:\n3、填入一个负数，如-100，点击使用，提示：\n千斤顶成功将主题顶起\n4、查看道具数量，现在有101个千斤顶之后将这些道具卖掉即可刷取积分   修复方案：  打开 source\\class\\magic\\magic_jack.php 查找（约在第67行)：\nif(empty($magicnum) || $magicnum > $this->magic['num']) {\n替换为 \nif(empty($magicnum) || $magicnum <= 0 || $magicnum > $this->magic['num']) {\n这样，使用道具填入负数时，就会提示\n道具数量不足或没有填写使用数量。\n   版权声明：转载请注明来源 Coxxs@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-01-24 11:01 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-01-24 10:30 |    \t\tWens0n \t\t\t( 普通白帽子  |\t\t\t        Rank:102 漏洞数:22        | 精华漏洞数:32 | WooYun认证√  舞蹈系教授)\t\t \n  牛b    \n     2014-01-24 12:52 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  大牛b     \n     2014-01-27 16:15 |    \t\tJ′aron \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | 问题真实存在但是影响不大.)\t\t \n  屌爆了    \n     2014-02-28 17:43 |    \t\tCoxxs \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:8        | 节操数:233 | ww)\t\t \n  @Discuz! Discuz! X3.1 Release 20140301中，此bug依然未被修复    \n     2014-04-25 17:16 |    \t\t橘子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | 呢个...羞射高中生一枚。带上大神@Haswell...)\t\t \n  @Coxxs 么么哒！捕捉到小可爱~    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}