{"id": 53557, "wybug_id": "wooyun-2014-067229", "wybug_title": "某商业链系统通用SQL注入(无需登录)", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "sex is not show", "wybug_date": "2014-07-09 18:16", "wybug_open_date": "2014-10-07 18:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-17：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-07：\t细节向公众公开  简要描述： 涉及全国多家超市、商场 详细说明：  技术支持:北京富基融通科技有限公司(http://www.e-future.com.cn/) 程序名称：商业供应链系统 漏洞类型：SQL注入 是否需要登录：否 漏洞文件：web/base/product/productQuery.jsp?pcode=1漏洞参数：pcode关键字：google & baidu intitle:商业供应链系统 影响用户： 可以参看开发公司的案例介绍： http://www.e-future.com.cn/case_market.php 个人搜集了些案例： \n北京奥特莱斯SCM商业供应链系统 http://123.127.107.117/web/base/product/productQuery.jsp?pcode=1哈尔滨联强乐买SCM商业供应链系统 http://1.58.67.114/web/base/product/productQuery.jsp?pcode=1北人集团_商业供应链SCM系统-超市 http://scm.brjt.cn:8081/web/base/product/productQuery.jsp?pcode=1国光SCM商业供应链系统 http://gyl.jxggls.com:8080/web/base/product/productQuery.jsp?pcode=1家乐园供应链系统 http://222.223.124.193:8081/web/base/product/productQuery.jsp?pcode=1商业供应链系统 http://js.bjcsf.com/web/base/product/productQuery.jsp?pcode=1商业供应链系统 http://218.66.37.70:8081/web/base/product/productQuery.jsp?pcode=1商业供应链系统 http://218.207.88.11/web/base/product/productQuery.jsp?pcode=1商业供应链系统 http://60.2.37.237:8080/web/base/product/productQuery.jsp?pcode=1沈阳新一城商场经营管理有限公司 http://61.161.160.102:8080/web/base/product/productQuery.jsp?pcode=1新朝阳购物中心网 http://60.10.134.176:8080/web/base/product/productQuery.jsp?pcode=1东方购物广场有限公司SCM系统 http://60.213.49.66:8000/web/base/product/productQuery.jsp?pcode=1http://221.194.122.150/web/base/product/productQuery.jsp?pcode=1\n代码分析：\n<%\tString action =\"\";//如果是根据产品编码查询，则productQuery.jsp?pcode=''\tif (request.getParameter(\"ID\")!=null)//如果要输入条件查询，则productQuery.jsp?ID=search\taction = \"search\";\tString outStr =\"\";\tif (beanx.getEditFlag().equals(\"search\") || action.equals(\"search\")) {            outStr = beanx.ShowQueryPage(3);//显示查询窗口            if (outStr ==\"\")            response.sendRedirect(\"../../error/error_customer.jsp\");            else out.println(outStr+\"<br>\");\t\t\toutStr = \"\";            if (beanx.getEditFlag().equals(\"search\")){\t\t\t\toutStr=beanx.DisplayPage(beanx.GetQueryRs(),1,2);            }\t}\telse if (request.getParameter(\"pcode\") != null){//如果产品编码不为空，则根据产品编码显示产品信息，否则查询所有产品信息                outStr=beanx.DisplayPage(beanx.GetProduct(request.getParameter(\"pcode\")),1,2); ////这里参数pcode带入了方法GetProduct        }\t//else out.println(\"显示错误，请与管理员联系!\");%>\n继续看GetProduct方法：\npublic ResultSet GetProduct(String code)  {    PubDAOBuild tmpDao = new PubDAOBuild();    return tmpDao.openSQl(\"select * from \" + this.tbname + \" where Pcode='\" + code + \"'\");  }\n完全没过滤直接带入sql语句查询，导致注入产生   漏洞证明：  实例演示：####1：北京奥特莱斯SCM商业供应链系统 http://123.127.107.117/web/base/product/productQuery.jsp?pcode=1\n\n\n\n###2：北人集团_商业供应链SCM系统-超市 http://scm.brjt.cn:8081/web/base/product/productQuery.jsp?pcode=1\n\n\n\n###3：东方购物广场有限公司SCM系统 http://60.213.49.66:8000/web/base/product/productQuery.jsp?pcode=1\n\n\n\n####4：http://221.194.122.150/web/base/product/productQuery.jsp?pcode=1\n\n\n\n####5：沈阳新一城商场经营管理有限公司 http://61.161.160.102:8080/web/base/product/productQuery.jsp?pcode=1\n\n\n\n表信息：\nDatabase: DBUSRSCM[78 tables]+-------------------+| A                 || AA                || ADPRICE           || ADPRICEBAK        || ADPRICED          || ADPRICEDBAK       || BALANCE           || BALANCE_D         || BALANCE_DET       || BAS_CLASS_NAME    || BAS_COUNTER       || BAS_DEPT          || BAS_FEE           || BAS_FEESUM        || BAS_GROUP         || BAS_MANAFRAME     || BAS_ORG           || BAS_PCHILD        || BAS_PRODUCT       || BAS_PROD_CLASS    || BAS_PUR           || BAS_PUR1          || BAS_PUR_ALL       || BAS_PUR_CHILD     || BAS_PUR_GRP       || BAS_PUR_ORD       || BAS_ROLE          || BAS_ROLE_PUR      || BAS_SHOP          || BAS_SHOPSUPP      || BAS_STUB          || BAS_SUPPLIER      || BAS_SUPP_LAND     || BAS_TIMER         || BAS_USER          || BAS_USER_ROLE     || BILLNO            || BILLTYPE          || BILL_IN           || BILL_IND          || BRAND             || CHECKDATA         || CODECHARGE        || GOODSCODELIST     || GOODSSHOP         || JLCXGYSFY         || JLCXGYSFY1        || JLCXXSFX1         || JLCXXSKB          || LICENSE           || LICENSEDETAIL     || LICENSE_CLASS     || LICENSE_CLASS_BAK || LOG_TABLE         || OPERERRORS        || OPERLOG           || ORD               || ORD_COUNT         || ORD_D             || PUBINFO           || SALES_GZHZ        || SALES_PRO         || SALES_PRO_BG      || SALES_PRO_XTX     || SALES_RHZ         || SALES_TMP         || SALES_TMP08       || SALES_TMP1        || SALES_TMP101211   || SALES_TMPP        || SCM_CUST          || STOCK             || STOCK1            || STOCK_TMP         || STOCK_TMP1        || SUPCHARGE         || TSUPP             || TTSUPP            |+-------------------+\n   修复方案：  过滤OR参数化查询   版权声明：转载请注明来源 sex is not show@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-07-14 11:09 厂商回复： CNVD确认所述情况，并通过实例确认通用性，根据近日建立的处置渠道，已经按所述情况向软件生产厂商再次通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}