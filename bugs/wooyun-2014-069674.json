{"id": 1494, "wybug_id": "wooyun-2014-069674", "wybug_title": "利用系统缺陷过百度杀毒主动防御", "wybug_corp": "百度", "wybug_author": "104705824", "wybug_date": "2014-07-26 22:37", "wybug_open_date": "2014-09-09 22:38", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-09：\t细节向公众公开  简要描述： 其实这个漏洞各大杀毒厂商都曾经存在过，名字就不点了。有的是自己从某些渠道得知修复了有的是上报修复的。前些天测试百度杀毒才知道也存在这个漏洞，利用微软的某个缺陷绕过百度杀毒主动防御，可进行各种敏感操作可加载驱动。 详细说明：  原理：利用微软畸形文件夹漏洞新建一个带相同文件名带\"..\"号的，系统将这个文件夹误认为同一个文件夹那么将这个特殊文件夹里的程序命名为同一文件名的话系统也将此程序误认为同一程序利用这个我们可以伪造任意可信任程序（如系统文件/可信任软件）很多安全软件都会放过可信任软件或系统文件进行敏感操作的。同样道理，我们可以将自己的任意驱动文件（包括恶意驱动）伪造成系统驱动或安全软件自己的驱动就可以加载自己的驱动了。可信任程序加可信任驱动一般都是不提示的。1.测试在百度杀毒文件夹里创建一个与百度杀毒文件目录同名带\"..\"的文件夹命令:md \"C:\\Program Files\\Baidu\\BaiduSd\\2.1.0.2625..\\\"  (删除可以目录用  rd /q /s \"C:\\Program Files\\Baidu\\BaiduSd\\2.1.0.2625..\\\" )打开这个文件夹在运行中输入:\"C:\\Program Files\\Baidu\\BaiduSd\\2.1.0.2625..\\\"   说明：必须带\"号否则无法打开将利用程序复制到这个文件夹中，并重命名百度杀毒文件的任意一个程序比如BaiduSdTray.exe 发现图标起了变化 查看版本号等程序信息都变成了百度杀毒自己的文件。微软提供的路径解析函数存在缺陷，会将利用的程序误认为是同名程序，这里利用程序变成了百度杀毒自己的程序，这样就可以绕过白名单机制（一般安全软件都会将系统自带文件或者认证的程序是白名单），可以进行敏感操作。比如加载驱动，一般没有认证的程序或驱动加载是被拦截的。我们都知道系统的驱动文件都是放在C:\\WINDOWS\\system32\\drivers文件夹同样我们创建一个带..的文件夹 C:\\WINDOWS\\system32\\drivers..\\将要利用的驱动文件放在这个文件夹中找一个百度杀毒自己的驱动bd0001.sys将利用的驱动文件重新命名为bd0001.sys 本来拦截的现在已经不拦截了出现两个bd0001.sys   已经成功加载驱动2.通用的利用方法方法:伪造系统文件和伪造系统驱动伪造系统文件:创建一个 C:\\WINDOWS\\system32..\\ 文件夹  将利用程序重新命名为svchost.exe伪造系统驱动：创建一个系统驱动文件夹 C:\\WINDOWS\\system32\\drivers..\\ 将利用的驱动文件重新命名为beep.sys这两个都是系统文件百度杀毒白名单机制肯定是允许进行各种敏感操作的   漏洞证明：  附上漏洞测试视频和程序链接：http://pan.baidu.com/s/1nt5beqt 密码：isex   修复方案：  修正下检测文件的真实路径或者直接拦截运行在畸形文件夹里的程序   版权声明：转载请注明来源 104705824@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2014-07-28 12:27 厂商回复： 感谢对百度安全的支持。我们已联系业务部门处理！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-26 23:16 |    \t\t萧然 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 喜欢一切美丽的东西！)\t\t \n  dll劫持？    \n     2014-07-27 00:01 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  难道是利用微软在win7以后缺失的某个dll进行劫持？    \n     2014-08-17 12:35 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  好思路！收藏    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}