{"id": 12679, "wybug_id": "wooyun-2015-0119753", "wybug_title": "金立手机官网可重置任意用户密码(admin账号测试)", "wybug_corp": "gionee.com", "wybug_author": "路人甲", "wybug_date": "2015-06-11 13:57", "wybug_open_date": "2015-07-27 10:14", "wybug_type": "网络设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "安全意识不足", "设计不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-27：\t细节向公众公开  简要描述： 找不到工作，你们要我么，即将失业的游民！！！可怜我给高点rank吧，呜呜~~~~~~~~~ 详细说明：  0x1:自己的用户走一遍正确的流程，记录下有用的响应包。\n\n下一步到获取验证码的页面（绑定手机的用户），接着获取验证码输入正确的验证码下一步截取响应包。\n\n\nHTTP/1.1 200 OKServer: nginxDate: Thu, 11 Jun 2015 03:06:53 GMTContent-Type: text/html;charset=UTF-8Connection: keep-aliveVary: Accept-EncodingContent-Language: zh-CNContent-Length: 4100<!DOCTYPE html><html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>æ¾åå¯ç -éªè¯èº«ä»½</title><link href=\"../static/css/reset.css\"\trel=\"stylesheet\" type=\"text/css\" /><link href=\"../static/css/common_index.css\"\trel=\"stylesheet\" type=\"text/css\" /><link rel=\"shortcut icon\" href=\"../favicon.ico\" /><link rel=\"Bookmark\" href=\"../favicon.ico\" /></head><body>\t<div id=\"ma_reg_container\">\t\t<div id=\"ma_reg_header\">\t\t\t<div class=\"ma_in_header cl\">\t\t\t\t<a href=\"http://www.gionee.com/\" class=\"ma_logo z\"><img src=\"../static/images/common/login_logo.png\" /></a>\t\t\t</div>\t\t</div>\t\t<div id=\"ma_content\" class=\"cl\">\t\t\t<div class=\"stephd cl\">\t\t\t\t<h1 class=\"t1 z\">æ¾åå¯ç </h1>\t\t\t\t<ul class=\"step_nav y\" id=\"stepTwo\">\t\t\t\t\t<li>å¡«åè´¦æ·</li>\t\t\t\t\t<li class=\"on\">éªè¯èº«ä»½</li>\t\t\t\t\t<li>è®¾ç½®æ°å¯ç </li>\t\t\t\t\t<li class=\"tow\">å®æ</li>\t\t\t\t</ul>\t\t\t</div>\t\t \t<div class=\"w960bx\">\t\t\t<div class=\"ma_in_reg_content_right\">\t\t\t\t<ul>\t\t\t\t\t<li class=\"w3_log_tit mbt10\">è¯·éæ©éªè¯æ¹å¼:</li>\t\t\t\t\t<li class=\"ma_login_input_1\">\t\t\t\t\t\t<select class=\"find_psw_selct\" name=\"methods\" id=\"Jmethod\">\t\t\t\t\t    \t\t\t\t\t\t\t    <option value=\"130*****882\" type=\"2\">ææº</option>\t\t\t\t\t\t</select>\t\t\t\t\t\t\t<input type=\"hidden\" id=\"Jcss\" value=\"orange\" />\t\t\t\t\t\t\t<input type=\"hidden\" id=\"Jservice\" value=\"http://shop.gionee.com/login_success.shtml\" />\t\t\t\t\t\t\t\t<li class=\"w3_log_tit mbt10\" id=\"Jhint\">æ¨çææºå·ç æ¯:130*****882</li>\t\t\t\t\t\t\t\t\t</ul>\t\t\t\t<div class=\"ma_reg_btn_box\">\t\t\t\t\t\t<button class=\"ma_reg_btn z\" type=\"button\" style=\"display: none\"  id=\"JsetMail\">\t\t\t\t\t\t\tåééªè¯é®ä»¶\t\t\t\t\t\t</button>\t\t\t\t\t  \t<button class=\"ma_reg_btn z\" type=\"button\" id=\"JsetMobile\">\t\t\t\t\t\t\tåééªè¯ç­ä¿¡\t\t\t\t\t\t</button>\t\t\t\t\t\t\t\t</div>\t\t\t</div>\t\t</div>\t\t</div>\t</div>\t<style>.ft_white { width: 100%; padding: 10px 0; text-align: center; border-top: #dddddd 1px solid; color: #676767;font-family:\"Microsoft Yahei\",arial,simsun; line-height: 35px}.ft_white a{color: #676767} span.pipe{} </style><div class=\"ft_white\">      <div class=\"ft_cont\">        æå¡ç­çº¿ï¼400-779-6666 <span class=\"pipe\">|</span> <a href=\"/help_detail/63\" target=\"_blank\">éç§ä¿æ¤</a> <span class=\"pipe\">|</span> <a href=\"http://www.gionee.com/op-webmap.shtml\" target=\"_blank\">ç½ç«å°å¾</a><br/>        Copyright &copy; 2013 æ·±å³å¸éç«éä¿¡è®¾å¤æéå¬å¸ çæææ ç²¤ICPå¤05087105å·    </div>    </div><script type=\"text/javascript\" src=\"../static/js/jquery-1.7.1.min.js\"></script><script type=\"text/javascript\" src=\"../static/js/core.js\"></script><script>(function(){\tvar domMethod=$id(\"Jmethod\"),domSetMail=$id(\"JsetMail\"),domSetMobile=$id(\"JsetMobile\"),domHint=$id(\"Jhint\");\tvar css=$id(\"Jcss\").value,service=$id(\"Jservice\").value;\t\t$addEvent\t(domMethod,\"change\",function(e){\t\tvar value=this.value,type;\t\tfor(var i=0,childs=this.childNodes,len=childs.length;i<len;i++){\t\t\tif(childs[i].value==value){\t\t\t\ttype=childs[i].getAttribute(\"type\");\t\t\t}\t\t}\t\tif(type==1){\t\t\tdomSetMail.style.display=\"block\";\t\t\tdomSetMobile.style.display=\"none\";\t\t\tdomHint.innerHTML=\"æ¨çé®ç®±æ¯:\"+value;\t\t}else{\t\t\tdomSetMail.style.display=\"none\";\t\t\tdomSetMobile.style.display=\"block\";\t\t\t\tdomHint.innerHTML=\"æ¨çææºå·ç æ¯:\"+value;\t\t\t\t}\t});\t\tif(domSetMail){\t\t$addEvent\t(domSetMail,\"click\",function(){\t\t\t$ajaxSendPwdMail({css:css,service:service},function(data){\t\t\t\tif(data && data.code==0){\t\t\t\t\t$setCookie(\"pwdMailTime\",(new Date()).getTime());\t\t\t\t\twindow.location.href=data.nextlink;\t\t\t\t}else{\t\t\t\t\talert(\"ç½ç»åºé\");\t\t\t\t}\t\t\t});\t\t});\t}\tif(domSetMobile){\t\t$addEvent\t(domSetMobile,\"click\",function(){\t\t\t$ajaxSendPwdSms({css:css,service:service},function(data){\t\t\t\tif(data && data.code==0){\t\t\t\t\t$setCookie(\"pwdMobileTime\",(new Date()).getTime());\t\t\t\t\twindow.location.href=data.nextlink;\t\t\t\t}else{\t\t\t\t\talert(\"ç½ç»åºé\");\t\t\t\t}\t\t\t});\t\t});\t}\t\t})();</script></body></html>\n\n\n0x2：放行之后到重置密码的页面。\nHTTP/1.1 200 OKServer: nginxDate: Thu, 11 Jun 2015 03:11:10 GMTContent-Type: text/html;charset=UTF-8Connection: keep-aliveVary: Accept-EncodingContent-Language: zh-CNContent-Length: 4765<!DOCTYPE html><html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>æ¾åå¯ç -è®¾ç½®æ°å¯ç </title><link href=\"../static/css/reset.css\"\trel=\"stylesheet\" type=\"text/css\" /><link href=\"../static/css/common_index.css\"\trel=\"stylesheet\" type=\"text/css\" /><link rel=\"shortcut icon\" href=\"../favicon.ico\" /><link rel=\"Bookmark\" href=\"../favicon.ico\" /></head><body>\t<div id=\"ma_reg_container\">\t\t<div id=\"ma_reg_header\">\t\t\t<div class=\"ma_in_header cl\">\t\t\t\t<a href=\"http://www.gionee.com/\" class=\"ma_logo z\"><img\t\t\t\t\tsrc=\"../static/images/common/login_logo.png\" />\t\t\t\t</a>\t\t\t</div>\t\t</div>\t\t<div id=\"ma_content\" class=\"cl\">\t\t\t<div class=\"stephd cl\">\t\t\t\t<h1 class=\"t1 z\">æ¾åå¯ç </h1>\t\t\t\t<ul class=\"step_nav y\" id=\"stepThree\">\t\t\t\t\t<li>å¡«åè´¦æ·</li>\t\t\t\t\t<li>éªè¯èº«ä»½</li>\t\t\t\t\t<li class=\"on\">è®¾ç½®æ°å¯ç </li>\t\t\t\t\t<li class=\"tow\">å®æ</li>\t\t\t\t</ul>\t\t\t</div>\t\t\t\t    <div class=\"w960bx\">\t\t\t<div class=\"ma_in_reg_content_right\">\t\t\t\t <form action=\"/cas/n/phoneRestPwd\" method=\"post\" onsubmit=\"return checkForm();\">\t\t\t\t<ul>\t\t\t\t\t<li class=\"w3_log_tit mabo20\">ç»å½å¸å·:13080180882</li>\t\t\t\t\t<li class=\"w3_log_tit mbt10\">æ°ç»å½å¯ç :</li>\t\t\t\t\t<li class=\"ma_login_input_1\"><input name=\"pwd\" id=\"Jpwd\" type=\"password\" maxlength=\"30\"   autocomplete=\"false\" htmlEscape=\"true\" /><div class=\"worm_tips_gray\" id=\"JpwdHint\"></div></li>\t\t\t\t\t<li class=\"w3_log_tit mbt10\">ç¡®è®¤å¯ç :</li>\t\t\t\t\t<li class=\"ma_login_input_1\"><input  name=\"pwd1\" id=\"Jpwd1\" type=\"password\" maxlength=\"30\"   autocomplete=\"false\" htmlEscape=\"true\" /><div class=\"worm_tips_gray\" id=\"Jpwd1Hint\"></div></li>\t\t\t\t</ul>\t\t\t\t<div class=\"ma_reg_btn_box\">\t\t\t\t\t\t<button class=\"ma_reg_btn z\" id=\"Jbtn\" type=\"submit\">ç¡®å®</button>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t</form>\t\t\t</div>\t\t</div>\t\t</div>\t</div>\t<style>.ft_white { width: 100%; padding: 10px 0; text-align: center; border-top: #dddddd 1px solid; color: #676767;font-family:\"Microsoft Yahei\",arial,simsun; line-height: 35px}.ft_white a{color: #676767} span.pipe{} </style><div class=\"ft_white\">      <div class=\"ft_cont\">        æå¡ç­çº¿ï¼400-779-6666 <span class=\"pipe\">|</span> <a href=\"/help_detail/63\" target=\"_blank\">éç§ä¿æ¤</a> <span class=\"pipe\">|</span> <a href=\"http://www.gionee.com/op-webmap.shtml\" target=\"_blank\">ç½ç«å°å¾</a><br/>        Copyright &copy; 2013 æ·±å³å¸éç«éä¿¡è®¾å¤æéå¬å¸ çæææ ç²¤ICPå¤05087105å·    </div>    </div>\t<script type=\"text/javascript\" src=\"../static/js/jquery-1.7.1.min.js\"></script>\t<script type=\"text/javascript\" src=\"../static/js/md5.js\"></script><script type=\"text/javascript\" src=\"../static/js/core.js\"></script><script>//(function(){\t//æ ¡éªå¯ç \tvar domTxt=$id(\"Jpwd\"),domTxt1=$id(\"Jpwd1\");\tvar reg=/^.{6,30}$/;\tvar hintMap={\t\t\"Jpwd\":{\t\t\tdef:\"\",\t\t\tfocus:\"\",\t\t\tempty:\"è¯·è¾å¥å¯ç \",\t\t\terr:\"å¯ç ä¸º6-30ä½\",\t\t\tsuc:\"\"\t\t},\t\t\t\t\"Jpwd1\":{\t\t\tdef:\"\",\t\t\tfocus:\"\",\t\t\tempty:\"è¯·ç¡®è®¤æ°å¯ç \",\t\t\terr:\"å¯ç ä¸ä¸è´\",\t\t\tsuc:\"\"\t\t}\t};\t\tvar hintCssMap={\t\tdef:\"worm_tips_gray\",\t\terr:\"ma_reg_error\"\t};\t$focusInput(domTxt,\"\",function(isfocus,isNull){\t\t\tvar domid=domTxt.id;\t\t\tif(isfocus){\t\t\t\tsetHint($id(domid+\"Hint\"),hintCssMap.def,hintMap[domid].def);\t\t\t}else{\t\t\t\tcheckpwd(domid,0,isNull);\t\t\t}\t\t\t});\t$focusInput(domTxt1,\"\",function(isfocus,isNull){\t\t\tvar domid=domTxt1.id;\t\t\tif(isfocus){\t\t\t\tsetHint($id(domid+\"Hint\"),hintCssMap.def,hintMap[domid].def);\t\t\t}else{\t\t\t\tcheckpwd(domid,0,isNull);\t\t\t}\t\t\t});\tfunction checkpwd(domid,isMust,isNull){\t\t\tvar result=true,value=$.trim($id(domid).value);\t\t\tisNull=isNull?true:value.length==0;\t\t\tif(isNull){\t\t\t\tif(isMust){\t\t\t\t\tsetHint($id(domid+\"Hint\"),hintCssMap.err,hintMap[domid].empty);\t\t\t\t}else{\t\t\t\t\tsetHint($id(domid+\"Hint\"),hintCssMap.def,hintMap[domid].def);\t\t\t\t}\t\t\t\tresult=false;\t\t\t}else{\t\t\t\tif(domid==\"Jpwd\"){\t\t\t\t\tif(value.match(reg)==null){\t\t\t\t\t\tresult=false;\t\t\t\t\t\tsetHint($id(domid+\"Hint\"),hintCssMap.err,hintMap[domid].err);\t\t\t\t\t}\t\t\t\t}else{\t\t\t\t\tif(value!==$id(\"Jpwd\").value){\t\t\t\t\t\t\t\t\t\t\t\tresult=false;\t\t\t\t\t\tsetHint($id(domid+\"Hint\"),hintCssMap.err,hintMap[domid].err);\t\t\t\t\t}\t\t\t\t}\t\t\t}\t\t\treturn result;\t}\t\tfunction checkForm(){\t\t\t\tvar result=true;\t\tif(!checkpwd(\"Jpwd\",1)){\t\t\tresult=false;\t\t}\t\t\tif(!checkpwd(\"Jpwd1\",1)){\t\t\tresult=false;\t\t}\t\t\tif(result){\t\t\tdomTxt.value=hex_md5(domTxt.value);\t\t\tdomTxt1.value=hex_md5(domTxt1.value);\t\t}\t\treturn result;\t}\tfunction setHint(elem,css,msg){\t\telem.innerHTML=msg;\t\telem.className=css;\t\t\telem.style.display=\"block\";\t\t}\t//})();</script></body></html>\n\n\n\n\n看到修改密码的URL，就能很轻松的绕过验证码，只要用户绑定了手机号，在输入用户名之后能够在响应包里提取的绑定的手机号，之后构造修改用户密码的URL，即可成功重置密码，只是一种方法，下面说一种没有绑定手机号绑定邮箱或者木有绑定任何东西的用户，admin测试！   漏洞证明：  0x3:admin测试，验证码下一步阶段响应包修改为0x1里的code，放行看效果。\n\n可以在响应包里提取到用户的uid和修改密码的类型，通过修改uid重置密码，用一个自己的用户绑定邮箱，之后修改uid也该修改，或者在这一步直接修改修改密码的方式，通过手机修改密码。\n\n0x4：获取验证码会失败\n\n\n{\"code\":\"0\",\"msg\":\"éªè¯æå\",\"nextlink\":\"/cas/n/phoneRestPwd?phoneNum=130xxxxxxx82&css=default&service=\"}\n把code替换到验证错误的响应包，看下图。\n\n就能到修改密码的页面，修改密码为wooyun123。0x5：登录验证。\n\n   修复方案：  完善服务端的验证机制，不单单是前端。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-06-12 10:13 厂商回复： 感谢对金立安全作出的贡献 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-11 16:10 |    \t\trange \t\t\t( 普通白帽子  |\t\t\t        Rank:153 漏洞数:32        | 这个人有点懒，没有写个人简介)\t\t \n  来来来，来我这。                  -----北京市第一人民监狱    \n     2015-07-27 10:31 |    \t\tkevinchowsec \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:5        | 周凯文，信息安全爱好者。)\t\t \n  前端验证！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}