{"id": 53817, "wybug_id": "wooyun-2014-066420", "wybug_title": "FengCMS权限验证错误，人人都是管理员", "wybug_corp": "fengcms.com", "wybug_author": "magerx", "wybug_date": "2014-07-01 15:27", "wybug_open_date": "2014-09-29 18:24", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["越权操作", "认证缺陷", "设计不当导致攻击界面扩大"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-29：\t细节向公众公开  简要描述： 我是标题党来的。 详细说明：  后台的文件都会包含admin/app/admin.php来做一个身份校验，来看看admin.php:\n<?phpdefined('TPL_INCLUDE') or die( 'Restricted access'); \tif($_SESSION['manage']==\"\"){\t\techo '<meta http-equiv=\"refresh\" content=\"0;url=login.php\">';\t}?>\n如果session为空仅做一次refresh，这样以来其实所有包含admin.php的文件代码还是可以执行的，也就是说我们只要abort返回login.php的请求，我们就可以对后台功能进行任意操作了。举几个例子试试：数据库备份与删除：先请求一次，这里用Tamper Data来abort掉之后的返回首页的请求:\nhttp://localhost/fengcms/admin/index.php?controller=dbmanage&operate=dbbackup\n\n\n\nhttp://localhost/fengcms/admin/index.php?controller=dbmanage&operate=save&type=0\n\n\n再比如添加文章：\nhttp://localhost/fengcms/admin/index.php?controller=module&project=article&operate=add\n\n\n再比如密码修改：这个也是唯一需要再次验证密码的地方，所以就这个没办法咯\nhttp://localhost/fengcms/admin/index.php?controller=manage&operate=password\n\n\n文件浏览的地方：\nhttp://localhost/fengcms/admin/public/htmledit/php/file_manager_json.php?path=&order=NAME&dir=&1403851632052\n其实也就是除了修改密码，其他后台功能都可以越权实现了，找个上传拿shell也是可以的。   漏洞证明：  \n\n\n\n\n\n\n\n   修复方案：  //为啥不直接die或者exit   版权声明：转载请注明来源 magerx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-07-01 15:37 厂商回复： 非常感谢，立即修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-01 15:21 |    \t\tmagerx \t\t\t( 普通白帽子  |\t\t\t        Rank:257 漏洞数:45        | 别说话。)\t\t \n  @疯狗 @xsser 厂商注册了，他说认领不了，我不太清楚，只好呼叫二位了。3Q    \n     2014-07-08 12:38 |    \t\tFengCMS(乌云厂商)\t\t \n  FengCms安全测试站地址：http://guf521656.h163.92hezu.org/ 有效期2014-7-8至2014-7-15 欢迎各位安全界的朋友帮我们寻找安全漏洞！作为一个小小的创业团队，对各位朋友对FengCms的关注表示衷心的感谢！    \n     2014-07-10 16:25 |    \t\tFengCMS(乌云厂商)\t\t \n  非常感谢各位白帽子的辛勤工作！FengCms安全测试站地址：http://guf521656.h163.92hezu.org/ 已经升级到最新版本 有效期2014-7-8至2014-7-15 欢迎各位安全界的朋友帮我们寻找安全漏洞！作为一个小小的创业团队，对各位朋友对FengCms的关注表示衷心的感谢！@路人甲    \n     2014-07-28 19:16 |    \t\t好基友一辈子 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:37        )\t\t \n  @FengCMS 还有没有测试地址    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}