{"id": 60288, "wybug_id": "wooyun-2013-043973", "wybug_title": "TCCMS设计缺陷（伪造他人发帖）", "wybug_corp": "teamcen.com", "wybug_author": "齐迹", "wybug_date": "2013-11-25 10:43", "wybug_open_date": "2014-02-23 10:44", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-11-28：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-01-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-01-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-02-23：\t细节向公众公开  简要描述： 本来不算提交的，不过我觉得厂商还没有意识到问题的严重性。所以再次发一个详细说明一下。 详细说明：  问题发生在 bbs模块和上次的类型是一样的  用了model的create方法。\\bbs\\controller\\index.class.php行147\n/*    * 前台    * 帖子发布保存    * */    public function savePost() {    \t$_Obj = M(\"bbs_thread\");    \t$msgObj = new Msg ();    \t$_Obj->create();    \t$_Obj->subject = $_POST['info']['subject'];    \t$_Obj->content = $_POST['info']['content'];    \t$_Obj->addtime = time();    \tif (empty($_Obj->subject) || empty($_Obj->content)) {    \t\t$msgObj->addMsg ( 'error', Config::lang(\"TITLEANDCONTENTNOTEMPTY\") );    \t}    \tif (empty($_COOKIE['userId'])) {    \t\t$msgObj->addMsg ( 'error', Config::lang(\"BBSPOSTMUSTLOGIN\") );    \t}    \tif (empty($_POST['info']['boardid'])) {    \t\t\t$msgObj->addMsg ( 'error', '请选择版块');    \t\t}    \tif (! $msgObj->hasMsg) {    \t\t$user = get('user',$_COOKIE['userId']);\t    \t$_Obj->uid = $_COOKIE['userId'];\t    \t$_Obj->username = empty($user->username) ? \"Unknow\" :$user->username;\t    \t$_Obj->guestip = NetUtil::getIp();\t    \t$_Obj->yz = 1;\t    \t$_Obj->saveOrUpdate();\t    \t//\t    \t$user->money += 10 ;\t    \t$user->update();\t    \theader(\"Location:index.php?ac=index_list&m=bbs&bid=\" . $_Obj->boardid);    \t} else {    \t\t$_GET['bid']=$_GET['bid'];    \t\t$_GET['boardid']=$_POST['info']['boardid'];    \t\t$this->setValue ( \"Obj\", $_Obj );    \t\t$this->post();    \t}    }\n这里只需要POST['info']['id'] 即可修改任意帖子重点是 $_COOKIE['userId'] 没有进行验证主要伪造COOKIE 即可具有发布的权限。这个文件最后 还有锁定板块功能 没有权限验证。这个文件我都不忍心看了！多多啊！   漏洞证明：  http://bbs.teamcen.com/thread-3-10.html成功修改了帖子和伪造管理员回帖！\n\n   修复方案：  推荐一篇问题http://my.oschina.net/qiji2012/blog/165232最后说一下rank分数不是对你们专业级别的评级！从审计中成长才是最重要的！   版权声明：转载请注明来源 齐迹@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-11-25 11:21 厂商回复： 感谢齐迹，web安全因你而更完美,TC的安全有你的参与而更完善。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}