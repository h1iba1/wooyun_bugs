{"id": 17110, "wybug_id": "wooyun-2012-011311", "wybug_title": "苏宁易购某站异常信息未屏蔽导致众多敏感信息暴露！", "wybug_corp": "江苏苏宁易购电子商务有限公司", "wybug_author": "有礼物送上", "wybug_date": "2012-08-25 09:35", "wybug_open_date": "2012-10-09 09:36", "wybug_type": "应用配置错误", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-08-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-08-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-09-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-09-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-09-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-10-09：\t细节向公众公开  简要描述： RT! 详细说明：   先附带一个目录小浏览：\n\n    漏洞证明：  \njava的异常机制其实没什么错，方便程序调试及修正。但它抛的异常暴露的信息还是比较多的！  有时一些类型转换，造型时容易出现这种异常：http://union.suning.com/aas/ad/adsearch/ad-search!search.action?keyWord=a'\n\n\n\n这个到是好，sql语句都抛出来了！http://union.suning.com/aas/ad/channel/channel-ad!orderPage.action?orderInfoId=60191s\n\n\n\n看看异常信息：org.springframework.dao.DataIntegrityViolationException: could not execute query; SQL [          select AdContentId,ContentDesc,ContentType,ContentSize,ContentUrl          from AAS_BIZ_AdContent        where 1=1                          and AdInfoId = ?                                    and contentType = ?                    order by AdInfoId ,ContentSize     ]; nested exception is org.hibernate.exception.DataException: could not execute query\tat org.springframework.orm.hibernate3.SessionFactoryUtils.convertHibernateAccessException(SessionFactoryUtils.java:642)\tat org.springframework.orm.hibernate3.HibernateAccessor.convertHibernateAccessException(HibernateAccessor.java:412)\tat org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:411)\tat org.springframework.orm.hibernate3.HibernateTemplate.executeFind(HibernateTemplate.java:343)\tat com.suning.framework.dao.UniversalDaoHibernate.queryListBySql(UniversalDaoHibernate.java:567)\tat com.suning.framework.dao.UniversalDaoHibernate.queryListBySql(UniversalDaoHibernate.java:554)\tat com.suning.aas.ad.dao.hibernate.AdContentDaoHibernate.searchContent(AdContentDaoHibernate.java:40)\tat com.suning.aas.ad.logic.impl.AdInfoBizImpl.searchContent(AdInfoBizImpl.java:100)\tat sun.reflect.GeneratedMethodAccessor267.invoke(Unknown Source)\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\tat java.lang.reflect.Method.invoke(Method.java:600)\tat org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:309)\tat org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:149)\tat com.suning.framework.template.ServiceInterceptor.invoke(ServiceInterceptor.java:86)\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)\tat org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:202)\tat $Proxy53.searchContent(Unknown Source)\tat com.suning.aas.portal.adsearch.action.ChannelAdAction.orderPage(ChannelAdAction.java:152)\tat sun.reflect.GeneratedMethodAccessor358.invoke(Unknown Source)\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\tat java.lang.reflect.Method.invoke(Method.java:600)\tat com.opensymphony.xwork2.DefaultActionInvocation.invokeAction(DefaultActionInvocation.java:441)\tat com.opensymphony.xwork2.DefaultActionInvocation.invokeActionOnly(DefaultActionInvocation.java:280)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:243)\tat com.opensymphony.xwork2.validator.ValidationInterceptor.doIntercept(ValidationInterceptor.java:252)\tat org.apache.struts2.interceptor.validation.AnnotationValidationInterceptor.doIntercept(AnnotationValidationInterceptor.java:68)\tat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:87)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.ConversionErrorInterceptor.intercept(ConversionErrorInterceptor.java:122)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.ParametersInterceptor.doIntercept(ParametersInterceptor.java:195)\tat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:87)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.ParametersInterceptor.doIntercept(ParametersInterceptor.java:195)\tat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:87)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.StaticParametersInterceptor.intercept(StaticParametersInterceptor.java:179)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat org.apache.struts2.interceptor.FileUploadInterceptor.intercept(FileUploadInterceptor.java:235)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.ModelDrivenInterceptor.intercept(ModelDrivenInterceptor.java:89)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.ChainingInterceptor.intercept(ChainingInterceptor.java:126)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.PrepareInterceptor.doIntercept(PrepareInterceptor.java:138)\tat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:87)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat org.apache.struts2.interceptor.ServletConfigInterceptor.intercept(ServletConfigInterceptor.java:164)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.ParametersInterceptor.doIntercept(ParametersInterceptor.java:195)\tat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:87)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat org.apache.struts2.interceptor.MultiselectInterceptor.intercept(MultiselectInterceptor.java:75)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat org.apache.struts2.interceptor.CheckboxInterceptor.intercept(CheckboxInterceptor.java:94)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.I18nInterceptor.intercept(I18nInterceptor.java:165)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.AliasInterceptor.intercept(AliasInterceptor.java:179)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.opensymphony.xwork2.interceptor.ExceptionMappingInterceptor.intercept(ExceptionMappingInterceptor.java:176)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat com.suning.aas.common.web.interceptor.ActionAccessTimeInterceptor.intercept(ActionAccessTimeInterceptor.java:96)\tat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:237)\tat org.apache.struts2.impl.StrutsActionProxy.execute(StrutsActionProxy.java:52)\tat org.apache.struts2.dispatcher.Dispatcher.serviceAction(Dispatcher.java:488)\tat org.apache.struts2.dispatcher.ng.ExecuteOperations.executeAction(ExecuteOperations.java:77)\tat org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter.doFilter(StrutsPrepareAndExecuteFilter.java:91)\tat com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:188)\tat com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:116)\tat com.suning.aas.portal.web.filer.AuthFilter.doFilter(AuthFilter.java:163)\tat com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:188)\tat com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:116)\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:88)\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)\tat com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:188)\tat com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:116)\tat com.ibm.ws.webcontainer.filter.WebAppFilterChain._doFilter(WebAppFilterChain.java:77)\tat com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:908)\tat com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:997)\tat com.ibm.ws.webcontainer.extension.DefaultExtensionProcessor.invokeFilters(DefaultExtensionProcessor.java:985)\tat com.ibm.ws.webcontainer.extension.DefaultExtensionProcessor.handleRequest(DefaultExtensionProcessor.java:905)\tat com.ibm.ws.webcontainer.webapp.WebApp.handleRequest(WebApp.java:3826)\tat com.ibm.ws.webcontainer.webapp.WebGroup.handleRequest(WebGroup.java:276)\tat com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:931)\tat com.ibm.ws.webcontainer.WSWebContainer.handleRequest(WSWebContainer.java:1583)\tat com.ibm.ws.webcontainer.channel.WCChannelLink.ready(WCChannelLink.java:186)\tat com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleDiscrimination(HttpInboundLink.java:445)\tat com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleNewRequest(HttpInboundLink.java:504)\tat com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.processRequest(HttpInboundLink.java:301)\tat com.ibm.ws.http.channel.inbound.impl.HttpICLReadCallback.complete(HttpICLReadCallback.java:83)\tat com.ibm.ws.tcp.channel.impl.AioReadCompletionListener.futureCompleted(AioReadCompletionListener.java:165)\tat com.ibm.io.async.AbstractAsyncFuture.invokeCallback(AbstractAsyncFuture.java:217)\tat com.ibm.io.async.AsyncChannelFuture.fireCompletionActions(AsyncChannelFuture.java:161)\tat com.ibm.io.async.AsyncFuture.completed(AsyncFuture.java:138)\tat com.ibm.io.async.ResultHandler.complete(ResultHandler.java:204)\tat com.ibm.io.async.ResultHandler.runEventProcessingLoop(ResultHandler.java:775)\tat com.ibm.io.async.ResultHandler$2.run(ResultHandler.java:905)\tat com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1563)Caused by: org.hibernate.exception.DataException: could not execute query\tat org.hibernate.exception.SQLStateConverter.convert(SQLStateConverter.java:102)\tat org.hibernate.exception.JDBCExceptionHelper.convert(JDBCExceptionHelper.java:66)\tat org.hibernate.loader.Loader.doList(Loader.java:2297)\tat org.hibernate.loader.Loader.listIgnoreQueryCache(Loader.java:2172)\tat org.hibernate.loader.Loader.list(Loader.java:2167)\tat org.hibernate.loader.custom.CustomLoader.list(CustomLoader.java:316)\tat org.hibernate.impl.SessionImpl.listCustomQuery(SessionImpl.java:1821)\tat org.hibernate.impl.AbstractSessionImpl.list(AbstractSessionImpl.java:165)\tat org.hibernate.impl.SQLQueryImpl.list(SQLQueryImpl.java:179)\tat com.suning.framework.dao.UniversalDaoHibernate$14.doInHibernate(UniversalDaoHibernate.java)\tat org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:406)\t... 97 moreCaused by: com.ibm.db2.jcc.b.jm: DB2 SQL Error: SQLCODE=-420, SQLSTATE=22018, SQLERRMC=DECFLOAT, DRIVER=3.50.152\tat com.ibm.db2.jcc.b.wc.a(wc.java:571)\tat com.ibm.db2.jcc.b.wc.a(wc.java:57)\tat com.ibm.db2.jcc.b.wc.a(wc.java:126)\tat com.ibm.db2.jcc.b.tk.c(tk.java:1901)\tat com.ibm.db2.jcc.b.tk.a(tk.java:1443)\tat com.ibm.db2.jcc.t4.db.n(db.java:739)\tat com.ibm.db2.jcc.t4.db.i(db.java:257)\tat com.ibm.db2.jcc.t4.db.c(db.java:52)\tat com.ibm.db2.jcc.t4.t.c(t.java:44)\tat com.ibm.db2.jcc.t4.sb.i(sb.java:153)\tat com.ibm.db2.jcc.b.tk.P(tk.java:1438)\tat com.ibm.db2.jcc.b.uk.e(uk.java:3153)\tat com.ibm.db2.jcc.b.uk.yb(uk.java:535)\tat com.ibm.db2.jcc.b.uk.executeQuery(uk.java:509)\tat org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:93)\tat org.hibernate.jdbc.AbstractBatcher.getResultSet(AbstractBatcher.java:208)\tat org.hibernate.loader.Loader.getResultSet(Loader.java:1849)\tat org.hibernate.loader.Loader.doQuery(Loader.java:718)\tat org.hibernate.loader.Loader.doQueryAndInitializeNonLazyCollections(Loader.java:270)\tat org.hibernate.loader.Loader.doList(Loader.java:2294)\t... 105 more\n\n一层层的：数据表结构： select AdContentId,ContentDesc,ContentType,ContentSize,ContentUrl from AAS_BIZ_AdContent where 1=1 and AdInfoId = ? and contentType = ?   order by AdInfoId ,ContentSize框架：Struts2、Hbernate、Spring数据库：DB2容器：IBM Websphere\n   修复方案：    抛的异常就没必要给用户看了？影响体验不说；一般的用户也看不懂啊！   版权声明：转载请注明来源 有礼物送上@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2012-08-25 11:12 厂商回复： 经验证，低危漏洞确实存在，正在处理中，谢谢您对苏宁易购的关注。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-01-22 15:02 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  “低危漏洞确实存在”- -！居然这么强调- -    \n     2013-01-23 00:24 |    \t\tluom \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:9        | 90sec老油条 专注渗透，Linux，code)\t\t \n  终于知道我那个是什么了。。。。。 WooYun: 苏宁 主站和分站各一个 疑似SQL注入    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}