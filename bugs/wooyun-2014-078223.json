{"id": 48276, "wybug_id": "wooyun-2014-078223", "wybug_title": "phpwind win服务器可被下载备份文件（主要提一下修复方案）", "wybug_corp": "phpwind", "wybug_author": "zph", "wybug_date": "2014-10-03 18:21", "wybug_open_date": "2015-01-01 18:22", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-01：\t细节向公众公开  简要描述： 哎……不说其他的了，都懂得，只需要爆破几个数字。主要提一下修复方案吧。 详细说明：  \n\n\n\n不说其他的了。PW_9-0~1/PW_9-0~1.ZIP只需要爆破3个数字，即可下载备份sql数据\n\n   漏洞证明：  \n\n   修复方案：  1.首先要想的是改变存储文件名的策略（而不是把所有责任都推给用win主机的用户），毕竟用windows服务器的用户还不占少数。windows文件名大于8个字符就可以用过短文件名访问到。因为短文件名取前6个字符加上\"~数字\"，那么为什么不让文件名前六位毫无规律，变复杂呢？\n如果前六位是纯数字，那么有1000000（10^6）种可能性，一夜就可以轻松获取你的备份数据库。如果前六位是字母+纯数字，那么有1544804416（36^6）种可能性，至少要跑1544.804416夜才能获取你的数据库。如果还有特殊字符呢？如果加上文件夹名的可能性组合呢？\n这样一来，可以跑出来的几率就几乎为0了。2.文件夹名不要和文件名一样我这里备份的是：pw_9-0_20141003171113_AZOKE/pw_9-0_20141003171113_AZOKE.zip文件名和文件夹名完全一样啊，本来还需要跑一晚上才能得到数据的。这样只需跑几分钟就能获得数据了。文件夹名命名也要遵循上面的策略，前六位一定要毫无规律，能复杂尽量复杂，以加大爆破难度。比如A^B94!_pw_9-0_20141003171113_AZOKE/B#!5@P_pw_123456_123456_abc.zip因为在windows主机上如果你前六位很有规律，后面再复杂也没用。人家照样能通过短文件名把你爆破出来。所以文件名和文件夹前六位要为windows主机考虑，一定要毫无规律+尽量复杂。3.既然你知道windows主机只要大于8位就可以通过短文件名访问，那为什么要让文件和文件夹名大于8位呢？所以可以（只是个人建议）判断下用户是windows主机还是linux，如果是windows主机就不用考虑文件名多长多长了，只要把8位的复杂度搞好，其他都是浮云。\n8位数字+字母可能性：2821109907456（34^8）\n4.教育用户安全性，设置服务器防盗链，禁止zip等文件下载。   版权声明：转载请注明来源 zph@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2014-10-09 11:57 厂商回复： 感谢你对我们的支持与关注，该问题我们正在修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-09 12:19 |    \t\treality0ne \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:7        )\t\t \n  win ~1。。    \n     2014-10-10 11:45 |    \t\t黑侠 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 帮助别人，等于帮助自己)\t\t \n  phpwind 怎么了？    \n     2014-10-12 14:28 |    \t\t默秒全 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | a....)\t\t \n  目测短文件名 绝对的    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}