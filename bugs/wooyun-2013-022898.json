{"id": 64871, "wybug_id": "wooyun-2013-022898", "wybug_title": "奇葩方法盲打爱丽网（真的很奇葩）", "wybug_corp": "aili.com", "wybug_author": "黑匣子", "wybug_date": "2013-05-02 11:07", "wybug_open_date": "2013-05-07 11:08", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-05-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-05-07：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 看乌云那么多人都收到了爱丽网的礼物，我闲着无聊也对爱丽网进行一次检测！ 详细说明：  我先在这个网站上注册个账号8787887(删了吧)，然后逛了一下网站，看了下大致结构，分析得出，这个站都被乌云的哥们检测了那么多次了，明面很难找到XSS和上传漏洞，难不成扫一天网站目录？深入分析？这样不值吧?然后我就在上传相册哪里分析了下看看能不能上传构造（就算不能上传PHP文件只要有构造还是可以利用的！），果然在上传照片这里发现BUG，上传照片可以构造URL，但是发现一个问题，就算你改变了图片后缀，访问照片地址为.PHP，实际上服务器上存储的照片格式还是GIF。于是乎想了下既然可以改变URL，能不能插入其他代码呢？先弹窗一下试试！闭合图片地址加入JS代码。\n\n可以看出成功弹窗！\n\n\n\n最后在插入盗取Cookie的代码，发现竟然把“.”过滤了，仔细想想过滤点是很正常的，不然很容易存在解析漏洞的，正打算提交乌云的时候，忽然想起来以前利用URL编码%2e来代替这个点拿shell的经历。试了试果然可以盗取Cookie，然后就是找用户反顾页面把这个页面提交给管理员，等待后台Cookie…等了2天只等到管理Cookie，\n\n可惜没有等到管理后台的地址！本来想加管理的QQ欺骗一下，感觉没有必要非进后台。   漏洞证明：  以上就是   修复方案：  既然服务器上都限制了上传格式，为什么客户端还能控制呢？把这处改为先上传到服务器上，再去获取图片URL会不会比先获取URL再上传好点？   版权声明：转载请注明来源 黑匣子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-05-07 11:08 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-05-02 11:53 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  爱丽网给的礼物，给我一份什么保湿霜…………    \n     2013-05-02 12:23 |    \t\t黑匣子 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:17        | 我是一个有思想的菜鸟！)\t\t \n  @wefgod 哈哈，不错啊- -    \n     2013-05-02 12:23 |    \t\t专业种田  \t\t\t( 核心白帽子 |\t\t\t        Rank:1425 漏洞数:182        | 没有最专业的农民,只有更努力地耕耘..........)\t\t \n  @wefgod 有面膜的:)    \n     2013-05-02 12:26 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @专业种田 @黑匣子 本来以为给的东西是女的用的，想给女朋友的，结果……男士专用啊！然后就送老爸了    \n     2013-05-02 12:36 |    \t\t黑匣子 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:17        | 我是一个有思想的菜鸟！)\t\t \n  @爱丽网 知道为什么没有打进后台了，因为管理员是通过后台把这个地址复制出来的！ 并且后台和前台没有打通登录(可能是吧，没有进过爱丽网后台，不知道管理员账号能不能登录前台)，所以有管理员Cookie也不能登录前台    \n     2013-05-02 13:10 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  @黑匣子 管理员通过后台把这个地址复制出来 后台和前提没打通登录..啥意思啊...真心看不明白...爱丽网后台好像是限制外网登录的吧...    \n     2013-05-02 14:32 |    \t\t黑匣子 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:17        | 我是一个有思想的菜鸟！)\t\t \n  @Rookie 管理员通过后台把这个地址复制出来(公布了，就看明白了！)。后台和前台没有打通登录:有些网站程序是管理员可以登录前台进行操作的(比如DZ)，有些是不行的（比如多多返利网源码，管理员账号就不能登录前台）。不知道爱丽网后台有没有限制外网登录    \n     2013-05-02 16:07 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @wefgod 台历要不要？哈哈~~    \n     2013-05-02 16:08 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  话说爱丽网后台我也有打到，很早之前都有打到了，现在一直持久劫持。坑爹的是 进不去啊。。    \n     2013-05-02 18:40 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  @黑匣子 爱丽网后台有登陆限制的.外网禁止登陆 @px1624 你弄了几本台历 哈哈~~    \n     2013-05-02 18:55 |    \t\t黑匣子 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:17        | 我是一个有思想的菜鸟！)\t\t \n  @Rookie 哈哈 台历不错啊！电子版的吗？    \n     2013-05-02 19:02 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @黑匣子 @Rookie 两本。纸质的诶。。    \n     2013-05-07 11:22 |    \t\t龙臣 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:5        | 人生就是一个缓慢被骗的过程。)\t\t \n  忽略了、、我汗    \n     2013-05-07 11:37 |    \t\t爱丽网(乌云厂商)\t\t \n  @黑匣子  最近公司搬家，确实是给忘掉了，Rank 可能给不了了，不过礼物是一定要有的 ..    \n     2013-05-07 14:26 |    \t\t龙臣 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:5        | 人生就是一个缓慢被骗的过程。)\t\t \n  @爱丽网 乔迁都不忘安全  服务器没搬丢吧、、    \n     2013-05-08 21:00 |    \t\trampage \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:16        | 网站建设、安全与开发)\t\t \n  @wefgod 我也是那样子的，默认还是男的    \n     2013-05-08 21:01 |    \t\trampage \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:16        | 网站建设、安全与开发)\t\t \n  @爱丽网 挺给力的厂商啊    \n     2013-05-09 09:37 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @rampage 虽然说我确实是男的……但是本来以为可以给女朋友那边的    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}