{"id": 20106, "wybug_id": "wooyun-2012-07508", "wybug_title": "CN二级域名设计逻辑错误", "wybug_corp": "CNNIC", "wybug_author": "PCanyi", "wybug_date": "2012-05-25 09:24", "wybug_open_date": "2012-05-25 09:24", "wybug_type": "网络设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当导致攻击界面扩大", "搞笑有爱"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-05-25：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2012-05-25：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： CN为国际顶级域名，在CN域名下，设了二级域名，分别是：类别域名6个，行政域名36个。这些二级域名由于逻辑设计错误，导致用户注册的顶级CN域名可能与二级域名冲突，出现一个域名对应两个IP的解析错误。 详细说明：  一般域名的结构为：(1)主机名+N级域名标识+(N-1)级域名标识+...+三级域名标识(作为企业标识)+二级域名如：www.sina.com.cn(2)主机名+N级域名标识+(N-1)级域名标识+...+三级域名+二级域名标识(作为企业标识)+顶级域名如：www.sina.com(3)以上两种情况不带主机名如：sina.com.cn，sina.comCN下的二级域名分别为：类别域名：.com.cn.net.cn.org.cn.gov.cn.mil.cn.edu.cn行政域名：.ac.cn.bj.cn.sh.cn.hk.cn.tj.cn.cq.cn.he.cn.sx.cn.nm.cn.ln.cn.jl.cn.hl.cn.js.cn.zj.cn.ah.cn.fj.cn.jx.cn.sd.cn.ha.cn.hb.cn.hn.cn.gd.cn.gx.cn.hi.cn.sc.cn.gz.cn.yn.cn.xz.cn.sn.cn.gs.cn.qh.cn.nx.cn.xj.cn.tw.cn.mo.cn这些二级域名可能会与一级CN域名发生冲突。下面以.gov.cn与.cn域名为例，来进行分析：众所周知：国务院网站为www.gov.cn，作为政府机构，它的二级域应该为.gov.cn，国务院在申请域名的时候，以www为它的三级域名标识(也可以理解为企业标识)，国务院没有设置主机名，所以国务院的全域名地址为www.gov.cn。下面是国务院的whois信息：\n\n现在有一个非政府机构的网址：linux.gov.cn，因为非政府机构，它应该是顶级域.cn，gov为该域名的二级域名标识（即企业标识），而linux为主机名。所以该机构的全域名地址为：linux.gov.cn。下面是该域名的whois信息：\n\n这个时候有意思的事情发生了，根据域名的相关规定，只要申请了一个域名，就可以在域名的基础上，添加若干的主机数以及企业标识上一级数的域名。也就是说：国务院它有权添加www.gov.cn三级域标识以上的域名，或者是添加主机，假如我们添加一个上域test，那么全域名为test.www.gov.cn；假如我添加一个名为a的主机，不添加test域，那么这时它的全域名为a.www.gov.cn；假如我在test域以上添加一个名为a的主机，那么全域名地址为：a.test.www.gov.cn。请不要分心，重要的问题不在这里，而在域名linux.gov.cn，该域名所有者同样也是被允许添加主机或企业标识上一级数的域名的。假如他在企业标识域添加了一个名为www的主机进行域名解析，会发生什么呢？很重要，它的全域名就为www.gov.cn了，这个时候，这个用户的全域名就和国务院的域名一模一样。同样，其它cn下的其它二级域名也会和cn顶级域名发生类假的冲突。   漏洞证明：  下图是关于国家gov.cn域名的申请规定，非政府单位是不能申请gov.cn的二级域名的，也就是说，linux.gov.cn，决不可能是gov.cn的，只能是申请的.cn的顶级域名。\n\n下图是www.gov.cn和linux.gov.cn的dns信息\n\n   修复方案：     版权声明：转载请注明来源 PCanyi@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：2 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2012-05-25 10:07 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  尼玛。居然没人认领。这可是好东西啊。这个逻辑错误 牛逼坏了...    \n     2012-05-25 10:56 |    \t\trandom_ \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:50        | 推动开源推动网络安全)\t\t \n  恩 我有一次看到某人黑了 **.gov.cn的一个站 开始以为政府官网的一个子站 突然惊讶    \n     2012-05-25 12:56 |    \t\tredzl \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | Let's exploit it!)\t\t \n  我这里可以管理一个GOV域名,但是我没有发现洞主所说的\"被允许添加主机或企业标识上一级数的域名的\"这个功能..    \n     2012-05-25 14:08 |    \t\t汉时明月 \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:6        | ‮......核审在正名签 :)\t\t \n  楼主逻辑混乱啊    \n     2012-05-25 15:26 |    \t\t小一 \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:13        )\t\t \n  重要的问题不在这里，而在域名linux.gov.cn，该域名所有者同样也是被允许添加主机或企业标识上一级数的域名的。假如他在企业标识域添加了一个名为www的主机进行域名解析，会发生什么呢？很重要，它的全域名就为www.gov.cn了，这个时候，这个用户的全域名就和国务院的域名一模一样。说实话，这句没看懂。。。    \n     2012-05-25 23:33 |    \t\tPCanyi \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 【为自己吹下的牛逼奋斗终身！】  幻想着改...)\t\t \n  linux.gov.cn用户它申请的域名实际应该是gov.cn，linux是主机名，是用户自己设置的。    \n     2012-05-29 15:46 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  万网那个域名 net.cn，也有类似别扭的情况，多级后缀标记导致的混淆问题。    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 2, "Ranks": null}