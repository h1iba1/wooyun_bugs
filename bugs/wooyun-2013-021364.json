{"id": 12677, "wybug_id": "wooyun-2013-021364", "wybug_title": "cutecms_v3.5 SQL Injection Vulnerability", "wybug_corp": "cutecms", "wybug_author": "knife", "wybug_date": "2013-04-08 10:43", "wybug_open_date": "2013-05-23 10:43", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "字符类型注射", "源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-08：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-05-23：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 算高危了 详细说明：  /*******************************************************//* cutecms_v3.5  SQL Injection Vulnerability/* ========================         /* By:     : Kn1f3     /* E-Mail   : 681796@qq.com/*******************************************************//* Welcome to http://www.90sec.com *//*******************************************************/首先看首页文件index.php\n>>>>/**/无关代码省略/**/ define('IN_CUTECMS', true); if(!file_exists(\"include/install.lock\")) {\t header(\"location:install/\");exit; } require_once('include/helper.php'); require_once('include/generate_static.inc.php');   //包含文件>>>>/**/无关代码省略/**/\t if($staticUrl && $staticUrl!='index') {    \t\t if(preg_match(\"/^(.*)_page([0-9]{1,})$/i\",   $staticUrl)) {\t\t   $url = substr($staticUrl, 0, strpos($staticUrl, \"_page\")).\".html\";\t\t   $staticUrlRow = getStaticUrlRow($db, $url);\t\t   $action = $staticUrlRow['action'];\t\t   $urlChannelId = $urlContentId = $staticUrlRow['rid'];\t\t   $urlPageNum = substr($staticUrl, strpos($staticUrl, \"_page\")+5);\t\t }\t\t \t\t else {\t\t\t $url = $staticUrl.\".html\";\t\t\t $staticUrlRow = getStaticUrlRow($db, $url);  //发现带入了数据库查询，看看getStaticUrlRow函数\t         if(!$staticUrlRow) {\t\t\t   $pathPartsArr = pathinfo($url);              \t\t\t   $staticPathArr = explode(\"/\", $pathPartsArr['dirname']);\t           $staticChannelHtmlName = array_pop($staticPathArr);>>>>/**/无关代码省略/**///跟入helper.phprequire_once( BASE.\"lang.inc.php\" );require_once( BASE.\"base.inc.php\" );require_once( BASE.\"validate.inc.php\" );require_once( BASE.\"elements.inc.php\" );require_once( BASE.\"template.inc.php\" );//继续跟入base.inc.phpfunction getStaticUrlRow( $db, $url = \"\", $rid = \"\" ){\t\t\t\t$sql = \"SELECT * FROM \".PREFIX.\"static_url WHERE 1\";\t\t\t\tif ( $url ) //带入查询没有任何过滤\t\t\t\t{\t\t\t\t\t\t\t\t$sql .= \" AND url = '\".$url.\"'\";\t\t\t\t}\t\t\t\tif ( $rid )\t\t\t\t{\t\t\t\t\t\t\t\t$sql .= \" AND rid = \".$rid;\t\t\t\t}\t\t\t\t$sql .= \" LIMIT 1\";\t\t\t\t$re = $db->getRow( $sql );\t\t\t\treturn $re;}//以为把文件加密了，就能把漏洞给修补？作者太2了吧 >>>>/**/无关代码省略/**/http://127.0.0.1/cutecms_free_v3.5/index.php?staticUrl=[sql]\n   漏洞证明：  \n\n   修复方案：  :) 可以用80sec那段防注入代码   版权声明：转载请注明来源 knife@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：10 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2013-04-10 15:14 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:170        | 力不从心)\t\t \n  刀哥辛苦了    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 10, "Ranks": null}