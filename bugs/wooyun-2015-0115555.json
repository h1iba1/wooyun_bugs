{"id": 30859, "wybug_id": "wooyun-2015-0115555", "wybug_title": "乐彩网主站几处问题大礼包（绕过SQL安全过滤）", "wybug_corp": "乐彩网", "wybug_author": "ca1n", "wybug_date": "2015-05-22 16:41", "wybug_open_date": "2015-07-06 20:38", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-06：\t细节向公众公开  简要描述： 过滤太多，绕过不易，且绕且珍惜，周一见o(=·ェ·=)m ~ 详细说明：  看见乌云上提交的乐彩网的注入厂商回应都修了，嘛，今天就又检测了一下\n0x01:GET型注入http://17500.cn/tc225/survey_showR.php?issue=07087\n\n\n返回正常\n\n返回错误，可以大概确定有注入了，掏出sqlmap\n\n有注入点\n\n跑数据的时候出问题了，猜测应该是有过滤，手注看看\nissue=07087' order by 19 -- 2\n返回正常，order by 20的时候返回出错，说明有19个字段union select的时候直接返回空白界面。。。这里过滤应该是过滤了 后来fuzz了一下只要出现union select 不管中间是否有字符有多少字符统统返回空白页面开始以为是输入字符串太长了，后来发现是有敏感字符串，union select 不行了试试盲注\nif(ascii(mid(user(),%s,1))=%s,sleep(1),0) -- # 1\n标准语句往上一放\n\n好吧 还是空白   漏洞证明：  在这个空白页面想了很久 各种fuzz。。。最后发现这里对各种敏感字符串的判定有点奇怪，ascii()和mid()在if()里出现的时候会被过滤，但是ascii()和mid()不在if()里面的时候不会被过滤，不知道怎么后台是怎么实现的但是既然没有if()的时候ascii()和mid()没有被过滤那么还是可以进行下去的通过抓包比较返回长度，可以确定用户名第一个字符的ascii为114。。。手边没有现成的脚本就不继续跑下去了，\n\n只做证明点到为止\nhttp://17500.cn/tc225/survey_showR.php?issue=07087' and ascii(mid((user()),1,1))=114 -- # 1这里想说一个tip。。。可能很多人都知道了，对于mysql比较的时候'123'=123会认为是true，在某些情况下可能会有用\n下面这一处也是同样的情况，sqlmap跑不出来是因为被过滤了，构造一下包可以出数据\n0x02:POST型注入http://17500.cn/3d/3Dallresult.phpq2=1' and ascii(mid((user()),1,1))=114 -- # 1\n===========================================================\n反射型xss一处,chrome下会被拦截，ff测试成功http://17500.cn/p3/p3_showpub.php?issue=-->'\"><script>alert(1)</script><H1>XSS@HERE</H1>\n\n\n   修复方案：  网上有很多很好的修复方案，感觉你们对安全的重视还有待提高   版权声明：转载请注明来源 ca1n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-05-22 20:36 厂商回复： 谢谢提供的漏洞信息，我们尽快修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-29 07:56 |    \t\tDloveJ \t\t\t( 普通白帽子  |\t\t\t        Rank:1107 漏洞数:200        | <a href=javascrip:alert('xss')>s</a> 点...)\t\t \n  @浩天 帮我审核下 我也有他们得一个洞 拜托了    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}