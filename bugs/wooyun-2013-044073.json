{"id": 60260, "wybug_id": "wooyun-2013-044073", "wybug_title": "CmsEasy后台多处文件包含", "wybug_corp": "cmseasy", "wybug_author": "xfkxfk", "wybug_date": "2013-11-26 18:58", "wybug_open_date": "2014-02-24 18:58", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "文件包含漏洞", "文件包含漏洞利用技巧", "文件包含", "文件包含漏洞利用", "本地文件包含利用", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-11-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-01-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-01-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-02-24：\t细节向公众公开  简要描述： CmsEasy 存在多处文件包含，可以结合其他漏洞利用，直接GetShell。 详细说明：  \n第一处，后台自定义——添加表单\n先来看看/cmseasy/template/admin/form/addform.php文件：\n\n直接获取到template参数的值再来看看/cmseasy/lib/admin/form_admin.php\n\n没有判断template参数的值是否合法，是否是在允许的范围内等，直接进行保存。\n\n我们在添加表单时抓包，修改这里template默认的值为我们自己的payload文件boot.php\n\nBoot.php文件的内容为<?php phpinfo();?>看看数据库存储的内容，直接进行了存储\n\n然后，添加成功后，会在管理表单里面添加我们的表单\n\n然后，我们可以预览我们已经添加的表单，这里的预览功能是任何人都可以访问的\n\n这样成功包含了我们的payload文件boot.php。\n第二处，后台模板——添加栏目标签\n\n\n不进行代码分析了，方法同上，来张证明吧：\n\n\n第三处，后台模板——添加内容标签\n方法同第二处。\n第四处，后台内容——添加内容——属性设置\n\n\n这里的包含可以直接利用，拿到shell，见下回分晓。   漏洞证明：  见详细说明   修复方案：  判断添加的表单中，tagtemplate参数的值是否合法，添加判断规则即可。这里可以规定，添加的栏目，使用的模板只能是现存的模板，或者添加的栏目只能在指定的目录下，不可跳跃目录。   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-11-26 20:02 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}