{"id": 15927, "wybug_id": "wooyun-2012-013692", "wybug_title": "PKAV腾讯专场 - 5. 两个未修补好的历史遗留XSS，（腾讯微博，WEBQQ各一处）", "wybug_corp": "腾讯", "wybug_author": "gainover", "wybug_date": "2012-10-22 00:15", "wybug_open_date": "2012-12-06 00:15", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-10-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-10-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-11-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-11-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-11-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-12-06：\t细节向公众公开  简要描述： 没修补完善的，打包一起发了吧，微博这个应该是修复第3次了。。  详细说明：  1. 首先是腾讯微博的这个问题，历史轨迹 WooYun: 腾讯微博持久XSS漏洞 | WooYun: 腾讯微博存储型XSS漏洞--看我这标题多普通 | WooYun: 腾讯微博存储型XSS漏洞--看我这标题多普通2 ------------------------------再次测试时，这个点，还是存在问题，虽然没有先前的严重，但是在IE下还是可行的。漏洞成因，没过滤\"， 导致可以用style=\"x:expression ... 的方式触发XSS。如下图，插入后的代码。\n\nmusicSong参数\nhttp://api.t.qq.com/old/publish.phpcontent\t#送礼物#@gainover xxxxx！ #A-a-aa-aaa-Irwin Goodman# xxxxstartTime\t0endTime\t1350546646508countTypeviewModelattipssourcepic\thttp://qzonestyle.gtimg.cn/qzone/space_item/pre/13/82717_1.pngmusicID\t49976musicSong\tIrwin Goodman'\"style=\"w:expression(if(!window.x){alert(document.cookie);window.x=1})\"aaa=musicSinger\tmmmmmmusicLocation\thttp://stream10.qqmusic.qq.com/12049976.wmamusicShortUrl\t1DmeVOapiType\t8giftId\t82717eventId\t5\n播放音乐时，会弹个窗。。。 \n\n-----------------------------------2. 至于WEBQQ这个。 敢把用自定义网页做背景的功能去掉么？在腾讯现有的架构下，只要拿到了cookies，这个拿网页做背景的功能，就是一个后门功能。 跨站脚本-可以让战场离得更远（浅谈腾讯架构缺陷）（ WooYun: 跨站脚本-可以让战场离得更远（浅谈腾讯架构缺陷） ） 中已经说明了相关问题。这里我也不用脚本来做自动化的后门设置了。如有需要，相关利用代码和（ WooYun: 腾讯WEBQQ的持久劫持 - 反射型XSS到XSS后门的实现 ） 基本一样。手工一样可以完成后门设置，流程： 通过一个反射型的XSS，拿到cookies之后。可以进入web.qq.com页面，将WEB背景的自定义地址设置为一个腾讯的反射型XSS。 \n\n这样受害者下次使用WEBQQ时，就会触发这个后门。\n\n   漏洞证明：  见详细说明。   修复方案：  1. 对于微博的问题，将相关的几个参数中，双引号也加以过滤。中国的XP+IE的份额还是那么大，危害还是挺大的。2. WEBQQ这个，建议废弃掉这个用网页做自定义背景的功能吧。如果一定要保留这个功能。建议让官方提供可靠的背景网页，并在保存自定义背景地址时进行正则判断。   版权声明：转载请注明来源 gainover@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2012-10-22 10:17 厂商回复： 非常感谢您的报告。这个问题我们已经确认，正在与业务部门进行沟通制定解决方案。如有任何新的进展我们将会及时同步。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-10-22 00:23 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  你们这是故意的么？让腾讯怎么活！    \n     2012-10-22 00:38 |    \t\tupload \t\t\t( 普通白帽子  |\t\t\t        Rank:251 漏洞数:43        | 此处略--！)\t\t \n   .'\"'.        ___,,,___        .'``.: (\\  `.\"'\"```         ```\"'\"-'  /) ; :  \\                         `./  .'  `.                            :.'    /        _         _        \\   |         0}       {0         |   |         /         \\         |   |        /           \\        |   |       /             \\       |    \\     |      .-.      |     /     `.   | . . /   \\ . . |   .'       `-._\\.'.(     ).'./_.-'           `\\'  `._.'  '/'             `. --'-- .'               `-...-'    \n     2012-10-22 00:40 |    \t\tBlackeagle \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:10        | 向WooYun致敬)\t\t \n  快没了吧。。    \n     2012-10-22 01:01 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  @Blackeagle 还有很多。。。要打赌不    \n     2012-10-22 01:31 |    \t\tBlackeagle \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:10        | 向WooYun致敬)\t\t \n  @蟋蟀哥哥 不了。。。    \n     2012-10-22 04:39 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  漏洞关注数超过100明天加更一章!    \n     2012-10-22 06:53 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  漏洞关注数超过100明天加更一章!    \n     2012-10-22 10:26 |    \t\t心伤的胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:308 漏洞数:29        | 因为心伤，所以胖子。)\t\t \n  @only_guest @gainover 我顶~~    \n     2012-10-22 13:25 |    \t\tqiaoy \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:16        )\t\t \n  怎么只有5，1234呢？    \n     2012-12-15 17:05 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  “微博这个应该是修复第3次了。。”这句话说的好像有种恨铁不成钢的感觉额    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}