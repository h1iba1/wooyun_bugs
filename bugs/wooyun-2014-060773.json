{"id": 55492, "wybug_id": "wooyun-2014-060773", "wybug_title": "PHPMyWind 注入漏洞&amp;任意用户登录", "wybug_corp": "phpmywind.com", "wybug_author": "Matt", "wybug_date": "2014-05-15 12:24", "wybug_open_date": "2014-08-10 12:26", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-20：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-10：\t细节向公众公开  简要描述： PHPMyWind 注入漏洞&任意用户登录 详细说明：  \nmember.phpif(!empty($_COOKIE['username']) &&//从COOKIE里面解密username然后赋值   !empty($_COOKIE['lastlogintime']) &&   !empty($_COOKIE['lastloginip'])){\t$c_uname     = AuthCode($_COOKIE['username']);\t$c_logintime = AuthCode($_COOKIE['lastlogintime']);\t$c_loginip   = AuthCode($_COOKIE['lastloginip']);}else{\t$c_uname     = '';\t$c_logintime = '';\t$c_loginip   = '';}//验证是否登录和用户合法if($a=='saveedit'    or $a=='getarea'    or $a=='savefavorite' or   $a=='delfavorite' or $a=='delcomment' or $a=='delmsg' or   $a=='delorder'    or $a=='avatar'     or $a=='getgoods' or   $a=='applyreturn' or $a=='perfect'    or $a=='binding' or   $a=='removeoqq'   or $a=='removeoweibo'){\tif(!empty($c_uname))\t{\t\t//guest为一键登陆未绑定账号时的临时用户\t\tif($c_uname != 'guest')\t\t{\t\t\t$r = $dosql->GetOne(\"SELECT `id`,`expval` FROM `#@__member` WHERE `username`='$c_uname'\");//通过上面的可以看出来源            shoppingcart.phpif($a == 'addshopingcart'){\t //构成选中属性\tif(isset($typeid))\t{\t\t//参数过滤\t\t$typeid = intval($typeid);\t\t//获取商品属性\t\t$dosql->Execute(\"SELECT * FROM `#@__goodsattr` WHERE `goodsid`=$typeid\");\t\tif($dosql->GetTotalRow() > 0)\t\t{echo 55555;\t\t\t//构成属性字符串\t\t\t$goodsattr = array();\t\t\twhile($row = $dosql->GetArray())\t\t\t{\t\t\t\t//选中的属性构成字符串\t\t\t\tif(isset($_POST['attrid_'.$row['id']]))\t\t\t\t{\t\t\t\t\t$goodsattr[$row['id']] = $_POST['attrid_'.$row['id']];//这里的参数可以控制\t\t\t\t}\t\t\t}\tvar_dump($goodsattr);\t\t}\t\telse\t\t{\t\t\t$goodsattr[$row['id']] = '';\t\t}\t}\t//初始化购物车字符串\tif(!empty($_COOKIE['shoppingcart']))\t\t$shoppingcart = unserialize(AuthCode($_COOKIE['shoppingcart']));\telse\t\t$shoppingcart = array();\t//选中信息存入数组\tif(isset($goodsid) &&\t   isset($buynum) &&\t   isset($goodsattr))\t{\t\t//过滤参数\t\t$goodsid = intval($goodsid);\t\t$buynum  = intval($buynum);\t\t\t\t$shoppingcart[] = array($goodsid, $buynum, $goodsattr);\t}var_dump($shoppingcart);\t//存入COOKIE\tsetcookie('shoppingcart', AuthCode(serialize($shoppingcart),'ENCODE'));//吧购物车的内容加密之后存入cookie 这样我们就能先利用$_POST['attrid_'.$row['id']]来写入我们的注入shellcode，然后将将得到的shoppingcart的COOKIE改成username就可以达到利用了\techo TRUE;\texit();\n   漏洞证明：  测试方法     打开http://127.0.0.1/mywind/shoppingcart.php?typeid=10&a=addshopingcart&goodsid=1&buynum=1     POST提交attrid_1=sssss2'    PS:测试的时候请安装体验数据~需要有一个商品ID即可~    然后把cookie里面的shoppingcart复制三份    分别改成empty($_COOKIE['username']) &   !empty($_COOKIE['lastlogintime'])    !empty($_COOKIE['lastloginip']))这三个   然后打开http://127.0.0.1/mywind/member.php?c=default 即可因为很多地方用到了authdecode cookie 这样我们得到一个加密的值之后 就可以登录任意用户 甚至是后台也是这样验证的\n\n\n\n\n\n   修复方案：  你猜~   版权声明：转载请注明来源 Matt@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-08-10 12:26 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-17 19:21 |    \t\t小飞 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:12        | 挖洞对于16岁的我来说实在是太艰难了！10...)\t\t \n  这是个什么鬼漏洞，，，这个即使能报错也不能利用啊还是核心白帽子 醉了。。。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}