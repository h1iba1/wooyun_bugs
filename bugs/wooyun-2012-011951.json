{"id": 65199, "wybug_id": "wooyun-2012-011951", "wybug_title": "点我吧某站点存在严重支付漏洞", "wybug_corp": "dianwoba.com", "wybug_author": "风萧萧", "wybug_date": "2012-09-09 23:04", "wybug_open_date": "2012-10-24 23:05", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-09-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-09-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-09-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-10-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-10-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-10-24：\t细节向公众公开  简要描述： 喜迎乌云币系统上线，送上一个支付漏洞 详细说明：  1.不用说了，是主站啊，看这里\nhttp://www.dianwoba.com\n\n\n2.去餐厅看看呢，选必胜客吧，哥们到现在都没去过呢！土比啊\nhttp://www.dianwoba.com/dianwoba/grid/liansuo.jsp?lid=22\n\n\n3.点两份披萨，送我基友@neal一份，这娃子好久没来乌云了，有点想念了！这里两份一个118，外加10元的跑路费！\n\n   漏洞证明：  4.点击提交订单，抓包看下post的数据\nfun=addOrder&addrid=118501&qukuai=C&contact=昆汀&addrs=的顶顶顶顶顶顶顶顶顶顶&phone=13812344321&receiveTime=2012-09-11 11:15&menu_list=180010|1;180013|1;&menu_list2=意式鲜香腊肉肠披萨|1;香酥罗非鱼披萨|1;&menuPrice=118&runnerPrice=10&totalAmount=2&remarks=无&supid=180&sexvalue=1&arrivetime=2012-09-11 11:15&pay=1&sessionid=180&lng=120198876&lat=30282527&distance=3300&etime=21:00&over=0&youhuifee=0&code=197334&verifypwd=&deliveryMode=0&discountForCustomer=100&fapiaoFlag=0&fapiaoTaitou=&youhuiForCustomer=0&packageMenulist=\n看重点的啊，参数menuPrice是点餐话费的金额数，需要118元，runnerPrice参数肯定是跑路费了，10元。这里把餐费该成11元吧，给少了不太好，做人得厚道撒！\n\n5.看返回的结果，果然没有进行校验啊，客户端改了就改了！支付21元就可以成功购买了\n\n6.跳转到支付宝的支付页面，还是这个价哦！虽然支付宝的接口做的狠好，但是人家管不了你自己内部的逻辑问题啊！\n\n   修复方案：  1.像金额这样的信息不要放在页面上，确实有随时被篡改的风险，这些信息本来就在数据库中，可以定义一个字符型的字段代替金额的传输，或者直接由商品唯一标识来查询数据库得到金额；2.签名校验是最重要的了，将购买的商品、数量、金额（或替代字段）、订单的ID号生成一个校验字符串。在每次数据传输的过程中进行校验，当然这个校验的内容可以多次生成；3.银行或者第三方支付平台的支付接口都会检验商户的订单数据签名，这里当支付页面跳转到块钱的时候没有做签名校验，导致金额数据被篡改，请进一步确认接口问题；4.支付前需要做签名校验，支付之后同样需要再次做校验，按理说所有银行应该在支付完成之后返回一些信息（如支付金额等）给商户，这样可以通过回来的信息判断是否全额支付；5.还有什么比SSL更可靠的呢！   版权声明：转载请注明来源 风萧萧@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-09-12 05:58 厂商回复： 非常感谢 风萧萧 提交的漏洞信息， 点我吧技术部门正在处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-10-24 23:43 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:111        | 收wb   1：5 无限量收   [平台担保])\t\t \n  这个站太难访问了'    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}