{"id": 56188, "wybug_id": "wooyun-2014-058572", "wybug_title": "PHPDisk E-Core 补丁过滤不严继续重装", "wybug_corp": "phpdisk.com", "wybug_author": "′雨。", "wybug_date": "2014-04-28 11:47", "wybug_open_date": "2014-07-24 11:48", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-03：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向公众公开  简要描述： 过滤不严。 详细说明：   WooYun: PHPDisk E-Core 漏洞 可注入 可重装 鸡肋可getshell 上个地址。今天看到发布补丁了 去下载来看看。在phpdisk_del_process.php中\nparse_str(pd_encode($str,'DECODE'));\t$pp = iconv('utf-8','gbk',$pp);\t$arr = explode('.',$pp);\t$file_id = (int)$file_id;\t$file_name = $db->escape($file_name);\t$src_file = $arr[0].get_real_ext($arr[1]);\n这里官方的修复方式是\n$file_id = (int)$file_id;\t$file_name = $db->escape($file_name);\n对一个转整 对一个转义。  这样解决了注入。 但是却没有解决重装。\t$pp = iconv('utf-8','gbk',$pp);\t$arr = explode('.',$pp);这里切割 第一个用来做文件名 第二个用来做后缀。这函数get_real_ext对后缀有一些过滤 如果检测到含其中的后缀就重新定义为txt但是里面没有lock 所以我们可以用来删除lock。\n$rs = $db->fetch_one_array(\"select file_real_name,file_extension,file_store_path from {$tpf}files where file_id='$file_id' limit 1\");\tif($rs){\t\t$num = @$db->result_first(\"select count(*) from {$tpf}files where file_real_name='{$rs[file_real_name]}' and file_extension='{$rs[file_extension]}' and file_name='{$file_name}' and file_store_path='{$rs[file_store_path]}'\");\t}\tif($safe){\t\tif($num==1){\t\t\t\t\tif(@unlink(PHPDISK_ROOT.$src_file)){\n由于注入被修复了 不能向之前那样直接通过注入来让$num为1了这里只需要系统上存在一个文件就好。不管是谁传的。\n\n成功删除。   漏洞证明：  \n\n成功重装。   修复方案：  加强过滤。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-07-24 11:48 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}