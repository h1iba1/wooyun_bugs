{"id": 43715, "wybug_id": "wooyun-2014-081928", "wybug_title": "猎豹、2345浏览器处理TLS证书不当导致中间人攻击", "wybug_corp": "国家互联网应急中心", "wybug_author": "MITM", "wybug_date": "2014-11-06 17:54", "wybug_open_date": "2015-02-04 17:56", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当", "客户端程序设计错误", "浏览器"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-14：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-04：\t细节向公众公开  简要描述： @乌云：刚才我提交的时候忘了登陆了。能不能审核这个，忽略之前匿名提交的那个，内容是一样的。非常感谢！之前已经报过360和搜狗的TLS证书漏洞，这回又发现了猎豹安全浏览器和2345加速浏览器有同样问题，一起报了。同时还测了百度、QQ、遨游浏览器，没有这个漏洞。 详细说明：  当这两个浏览器打开的https网页提供的SSL/TLS证书无效时（如自签名、域名不匹配），它会自动打开页面。猎豹安全浏览器有文字提示。2345加速浏览器甚至没有明显的文字提示。光在\"https\"上画个杠和锁上画个叉，我不知道有几个用户能注意到。当然下文会说到，有文字提示用处也不大，照样偷cookie。\n\n\n\n以下说利用方法（无需安装根证书、无需用户交互，部分思路来源于 http://fex.baidu.com/blog/2014/04/traffic-hijack-2/）：一是，如果用户使用网站的自动登录功能的话，cookie会在第一次访问时一并发送，所以自动加载页面可能导致cookie泄露。二是，如果没有自动登录，但是有自动填表功能。https被劫持的情况下，中间人可插入JavaScript读取并发送表单内容。以上这两点可以通过自动跳转来利用，可窃取任意HTTPS网站的cookie或密码（如果浏览器有记录的话）。非HTTPS网站的cookie和密码被窃取是很正常的，但是如果HTTPS网站也能被窃取cookie，那这就是浏览器的漏洞了。   漏洞证明：  Fiddler下的演示（再次强调，无需安装Fidder的根证书）：加入以下AutoResponder规则：\n\n然后打开2345浏览器，访问http://www.example.com/，一两秒后显示的是百度首页，无任何证书无效提示、警告：\n\n然后看Fiddler的抓包结果，cookie尽收眼底：\n\n再看猎豹浏览器，访问http://www.example.com/，一两秒后显示的是百度首页，会有安全警告，但是晚了，而且用户不可能知道之前跳转了哪些网站：\n\n然后看Fiddler的抓包结果，cookie尽收眼底：\n\n当然这仅仅是演示，实际攻击中可以使用更加灵活的规则，比如刚开始跳转任意网站到“认证”页，点击确认进入最初跳转点。也可以用meta refresh跳转，因为3xx重定向有最大跳转次数限制。自动填表的懒的弄了，我想应该可以拿到密码。    修复方案：  当SSL证书无效时，不要打开页面，除非用户点击继续。   版权声明：转载请注明来源 MITM@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-11-11 09:55 厂商回复： 作为通用软件案例确认，暂未能建立与所有厂商的联系渠道，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}