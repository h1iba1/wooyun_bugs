{"id": 13141, "wybug_id": "wooyun-2013-020167", "wybug_title": "腾讯某处存储型XSS，且看我如何利用来定向劫持用户腾讯微博", "wybug_corp": "腾讯", "wybug_author": "se55i0n", "wybug_date": "2013-03-16 21:04", "wybug_open_date": "2013-04-30 21:04", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "安全", "黑盒"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-03-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-03-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-03-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-04-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-04-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-04-30：\t细节向公众公开  简要描述： TSRC的同学你们好，我是来自WooYun的白帽子！ 详细说明：  还是iweibo的问题，虽然限制了某参数的httponly不能直接劫持iweibo，但是我们却能利用这个反过来劫持t.qq.com的用户！！！1）这里以我自己的微博帐号\"se55i0n\"进行演示,利用上个洞借来的帐号先收听se55i0n,然后广播里@se55ion 输入以下内容；\n123</textarea><iframe src=javascript:alert(/1/)>\n2)登录se55i0n帐号，在广播里发现这里对关键的字符是做了过滤的，不存在直接的跨站，但是我不小心点到我的听众，却出现了下面的情况；\n\n3)哈哈，腾讯这里的贴心功能造就了该安全问题，应该是想给用户显示每个听众最后@自己的内容，但是这里却没有对内容进行过滤直接显示了出来 -_-||；4)知道漏洞产生的原因，那我们就看看能不能利用这个xss劫持用户的帐号吧，进行一番测试发现在广播栏里插入普通的劫持cookie的代码会被腾讯过滤导致代码不完整，但是在广播里输入以下代码，成功绕过防御并执行；\n\n5）登录se55i0n的帐号，点击我的听众，于是乎；\n\n6）难道就这么就成功劫持了用户的微博帐号么，NO！使用获取到的cookie登录依然提示输入用户名、密码，当然第一个反应是做了httponly,打开firebug一看，果不其然看参数\"t_skey\"-_-||\n\n7）难道就木有办法了么！！！非也，前面有童鞋提到过腾讯的cookie具有通用性，而且查看了本站cookie就一个参数做了httponly，于是我打开了xsser.me分析收到cookie值；\n\n8）我手工提权了se55i0n登录t.qq.com后的cookie值，跟收到iweibo的cookie值进行了下对比，于是我找到了突破口，收到的iweibo的cookie值居然跟t.qq.com下的一模一样，仅仅多了两个无关痛痒的参数值\"ts_last\"\"ts_sid\"，所以我们利用这个cookie成功登录到了腾讯微博；\n\n   漏洞证明：  见详细说明   修复方案：     版权声明：转载请注明来源 se55i0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2013-03-18 12:08 厂商回复： 非常感谢您的报告。我们会马上安排专人跟进确认处理，有新的情况会及时同步。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-03-16 21:08 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  一哥你好    \n     2013-03-16 21:27 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @xsser 。。。。。    \n     2013-03-16 21:32 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  一哥不送    \n     2013-03-16 22:07 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  一哥再见    \n     2013-03-16 22:50 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  一哥继续！    \n     2013-03-16 23:07 |    \t\t1ee \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:14        | 看书中....)\t\t \n  一哥慢走    \n     2013-03-16 23:33 |    \t\trasca1 \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:16        | 菜鸟一只)\t\t \n  一哥你好 连续剧么？    \n     2013-03-16 23:44 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  各位亲，我只是发个洞子，没想怎么怎么样，，难道让我丢到tsrc去呀-_-|    \n     2013-03-16 23:49 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @se55i0n 谁去tsrc谁2 8点20分发    \n     2013-03-17 04:20 |    \t\tMujj \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:4        | IDC商)\t\t \n  谁去tsrc谁2 8点20分发    \n     2013-03-18 10:50 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  球组队去tsrc刷公仔 大概8点20分发    \n     2013-03-18 11:07 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @xsjswt 我收到非企鹅的厂商发的一只大企鹅，谁去tsrc谁2 8点20分发    \n     2013-03-19 08:36 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  我草为什么tsrc上镜率那么高？好奇为啥洞主大牛不是核心？ 刚过8点20分发    \n     2013-04-30 21:09 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  一哥晚安。    \n     2013-04-30 22:33 |    \t\tx1aoh4i \t\t\t( 普通白帽子  |\t\t\t        Rank:403 漏洞数:62        )\t\t \n  @se55i0n 看起来很牛逼的样子 你说你怎么就那么牛逼的呢 能吹不？高潮下    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}