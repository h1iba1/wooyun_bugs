{"id": 9803, "wybug_id": "wooyun-2013-025758", "wybug_title": "EcShop冒充任意用户发商品评论，合理利用可操纵网店舆论", "wybug_corp": "ShopEx", "wybug_author": "小点兵", "wybug_date": "2013-06-12 18:01", "wybug_open_date": "2013-09-10 18:01", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-06-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-06-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-06-16：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-08-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-08-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-08-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-10：\t细节向公众公开  简要描述： 登录用户可以冒充任意其他注册用户对任意商品发表评论，合理利用可操纵网店舆论 详细说明：  漏洞代码在comment.php的287行处：\n\n$user_name = empty($cmt->username) ? $_SESSION['user_name'] : trim($cmt->username);$cmt是一个json数据结构，在comment.php的37行处赋值：\n\n$cmt  = $json->decode($_REQUEST['cmt']);由此可见，这里只要用户提交了\"username\":\"any user account\"的json code，就能冒充任意用户发表对指定商品的评论！   漏洞证明：  为验证此攻击，我自己搭建了ECShop的网店，注册了两个账户，test以及test3,如下图：\n\n然后以test登录，进入某个商品的界面，如下图：\n\n发表评论\"test comment\",此时用fiddle截获post,并强行添加\"username\":\"test3\"到提交的json结构中，如下图：\n\n评论发表后的结果如下图：\n\n这里注意ECShop可以设置用户评论的发表是否需要管理员审核，当设置成不需要审核时，评论自动发表。即使设置成需要审核时，管理员也很难看出哪个评论是冒名提交的，哪个不是，如下图：\n\n看，管理员看见的，也是被冒名的test3提交的评论！当然，对于大量提交，在需要管理员审核的时候，ip地址是个问题，不过，攻击者可以用不同的代理服务器来提交不同的冒名评论，这样，ip地址也很难成为侦测这个攻击的线索了:-)   修复方案：  将代码：$user_name = empty($cmt->username) ? $_SESSION['user_name'] : trim($cmt->username);改为：$user_name = $_SESSION['user_name'];   版权声明：转载请注明来源 小点兵@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2013-06-13 11:48 厂商回复： 非常感谢您为shopex信息安全做的贡献我们将尽快修复非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-06-12 18:14 |    \t\t噬魂 \t\t\t( 普通白帽子  |\t\t\t        Rank:141 漏洞数:37        | 08安全团队)\t\t \n  这是什么原理。。。求解释    \n     2013-06-12 18:20 |    \t\t小点兵 \t\t\t( 普通白帽子  |\t\t\t        Rank:126 漏洞数:13        | 这个人很懒。。。)\t\t \n  @噬魂 往数据库里写的时候，username没有强行指定session值，用户可以提交数据覆盖session值往数据库中写    \n     2013-06-12 18:24 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  看到标题我也找到了漏洞所在    \n     2013-06-12 18:26 |    \t\t大肠精 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 业余兴趣而已)\t\t \n  这种漏洞有什么意义。。。    \n     2013-06-12 18:32 |    \t\t小点兵 \t\t\t( 普通白帽子  |\t\t\t        Rank:126 漏洞数:13        | 这个人很懒。。。)\t\t \n  @大肠精 @大肠精 操纵舆论不是很多蠕虫想干的事么？现在蠕虫都不用了，直接越权操纵舆论，把我卖的商品顶上去，同时还能说别人的商品的坏话，呵呵    \n     2013-06-12 20:04 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  目测会忽略。。真心不觉得是问题。    \n     2013-06-12 20:50 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @齐迹 @小点兵 其实还是算越权把，但是对于用这些开源系统的用户来说，这个算业务问题    \n     2013-06-12 23:08 |    \t\t小点兵 \t\t\t( 普通白帽子  |\t\t\t        Rank:126 漏洞数:13        | 这个人很懒。。。)\t\t \n  @齐迹 比如你在某以ECShop构建的购物网站注册，然后买了东西。若干天后，你再次登录，发现有人以你的名义在网站上多大量商品进行了评论。难道你认为这不是个问题？你还敢继续信任这个网站不？你还敢继续在这个网站上继续购物？？？    \n     2013-06-12 23:10 |    \t\t小点兵 \t\t\t( 普通白帽子  |\t\t\t        Rank:126 漏洞数:13        | 这个人很懒。。。)\t\t \n  @小胖胖要减肥 是越权，问题出在代码上。运营网站的管理员无法修复。故不能算业务问题    \n     2013-06-19 00:51 |    \t\t0x2b \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:12        )\t\t \n  这种漏洞有什么意思 我想知道下     \n     2013-09-11 09:16 |    \t\t孤独男孩 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:5        | 专注网络信息安全，漏洞发掘，代码审核，云...)\t\t \n  我先了解一下，试试先    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}