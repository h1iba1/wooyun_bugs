{"id": 14375, "wybug_id": "wooyun-2013-017137", "wybug_title": "手把手教你劫持李开复的腾讯微博", "wybug_corp": "腾讯微搏", "wybug_author": "胖子变瘦了", "wybug_date": "2013-01-14 11:25", "wybug_open_date": "2013-02-28 11:26", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏校验", "设计不当", "认证设计不合理", "搞笑有爱"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-14：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-02-28：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 想劫持李开复老师的微博怎么办？发私信扔个URL？NO，人家不会看私信的。发邮箱？NO，压根不知道邮箱是多少？还有什么办法呢？那就是本文！李开复老师，注意安全哟 详细说明：  1. 如简单描述中所述，常规方法多半是不行的。2. 我们根据李开复老师的职业习惯，以及微博发送内容，可以了解到他经常会上一些资讯、科技类网站。比如36kr。如果我们能在36kr的网站上插入一段JS代码，里面再嵌入一个反射型XSS，此时李开复老师访问36kr且带有QQ的登录状态。我们就可以成功劫持李开复老师微博了。3. 36kr是很多站长，投资人都会去上的一个资讯网站。本人身边也有不少朋友经常去看。网站本身是否可被入侵不得而知，但是难度相对不小。看了看36kr。没什么问题，挺小清新的。【图片1】\n\n4. 随后点进去一篇文章，可以看到文章的最下方，有社交评论插件。【图片2】\n\n3. 问题就在这里了。 这个评论插件是一家第三方网站（denglu.cc），而且经过我们的检测，是存在安全问题的。例如：这里我们对其进行了XSS检测，发现其存在存储型XSS。我们可以成功在评论中插入我们的XSS代码。【图片3】\n\n4. 当然，惯性的思维是，就算是denglu.cc存在XSS，顶多影响的是denglu.cc的用户，而实际上并不是这样。 我们完全可以植入36kr.com自己的反射型XSS，或者第三方网站，如：腾讯的反射型XSS，来达到存储型XSS的效果。这里以腾讯某处反射型XSS为例。我们在36kr的文章下进行批量推送评论。【图片4】\n\n5. 这样一来，我们的恶意JS代码，就被夹杂到36kr的文章评论中了，见步骤3截图。当然普通用户对此会毫不知情。一旦用户访问了36kr的文章，我就会让他们去关注乌云的腾讯微博。6. 接着就是等待。 终于在某一天，李开复老师来了。我看到他的腾讯微博关注了【乌云漏洞报告平台】以及某些QQ官方账号 （这些账号用做参照：排除因为李开复老师自己主动收听【乌云漏洞报告平台】而造成的假阳性结果）。【图片5】\n\n7. 我们通过，36kr --> denglu.cc --> 腾讯某站反射型XSS --> 腾讯微博 的方式，在不是非常漫长的蹲点之后，捕获到了李开复老师的微博。在整个过程中，我们还捕获到了很多其他站长以及投资人的微博。其中也包括其他网站的某些人，比如UCWEB的，还包括36kr自己网站的一些人。腾讯的cookies没有http-only，因此我们可以使用获取的cookies，来使用这些帐号登录QQ其他应用(如QQ邮箱)，进而进行后续利用（具体利用危害见： WooYun: 跨站脚本-可以让战场离得更远（浅谈腾讯架构缺陷） ）。如下图：【图6】\n\n8. 声明：我们是友好的测试，整个测试过程中，并未获取记录任何cookies数据，关注微博的请求是通过csrf来实现的。我们使用“微博关注”的方式来统计了危害效果，并未动用victim的微博帐号去做任何其他事情。9. 最后总结：到头来，本质上来说，漏洞的根源在于腾讯和denglu.cc，而36kr只是一个第三方插件的受害者，成为了攻击者的跳板。我们可以从中学习到两点。9.1. 腾讯业务线长，类似的反射型XSS漏洞十分多，依靠腾讯安全 中心每天扫描后，再做一些不是很靠谱的修复，只是增加了攻击者寻找缺陷的时间而已，但是并没有从真正意义上解决用户的安全问题，这种解决方式是十分、非常、极其不可取的。本例就是一个典型，修复了成百上千个XSS又如何？再随便找一个反射型XSS就over了。任何一个【微不足道的】分站的【微不足道的】反射型XSS都会危害到用户的微博，邮箱，QQ空间等应用是一件多么可怕的事情。试想，你们还敢随便点开一个网页吗？ 一点开，就莫名其妙的，自己QQ的各种WEB应用随时被劫持？随时受不了，随手受不了。因此强烈建议，腾讯微博自己再加一次验证吧。9.2. denglu.cc这种第三方的插件也在不断涌现，而其中一部分程序在设计时又缺乏对安全的考虑。因此站长在使用此类程序时，请谨慎选择，勿将用户的安全抛给了第三方的插件。截至本稿：36kr官方已经更换掉了第三方评论插件。   漏洞证明：  \n\n   修复方案：  36KR已经换了评论插件,denglu.cc的问题还没修复.重要的是腾讯微搏的问题要好好修修.   版权声明：转载请注明来源 胖子变瘦了@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-01-09 19:04 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  投资就算了，腾讯微博来注册吧~~    \n     2013-01-09 19:18 |    \t\t心伤的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:147 漏洞数:21        | 严肃点~此号为虚拟小号，并不存在实体...)\t\t \n  。。。。这是谁马甲，这么NB。。。。    \n     2013-01-09 19:26 |    \t\t胖子变瘦了 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 伤心的胖子,伤心的瘦子,以及其他所有胖子瘦...)\t\t \n  @心伤的瘦子 我们不是一个人的马甲么?    \n     2013-01-09 19:27 |    \t\t心伤的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:147 漏洞数:21        | 严肃点~此号为虚拟小号，并不存在实体...)\t\t \n  @胖子变瘦了 我一直是瘦子，从来没胖过，显然不是。。    \n     2013-01-09 19:28 |    \t\t胖子变瘦了 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 伤心的胖子,伤心的瘦子,以及其他所有胖子瘦...)\t\t \n  @心伤的瘦子 每个瘦子都是胖子的前身.    \n     2013-01-09 19:30 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @心伤的瘦子 @胖子变瘦了 好了!表吵了!都跟我回家!    \n     2013-01-09 20:01 |    \t\t心伤的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:147 漏洞数:21        | 严肃点~此号为虚拟小号，并不存在实体...)\t\t \n  插个广告：本马甲等待认领    \n     2013-01-09 21:00 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  。。。我擦，又一个马甲。。    \n     2013-01-09 21:01 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  马甲帝,出来露头了.  牛逼的路人甲还未完结,又来一个奶牛逼的马甲帝,还让不让我们这种默默挖洞的鸟儿活.    \n     2013-01-09 21:08 |    \t\t0x0F \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:60        | 尖刀安全 (JDSec.Com).......................)\t\t \n  这厂商。洞主肯定是故意的。    \n     2013-01-09 21:24 |    \t\t易水寒 \t\t\t( 实习白帽子  |\t\t\t        Rank:67 漏洞数:6        )\t\t \n  这年头，连马甲都搞连载了    \n     2013-01-09 21:42 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  我擦，玩过火了吧。。    \n     2013-01-09 22:28 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  是否对你承诺了太多!还是我原本给的就不够?    \n     2013-01-09 23:14 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  @only_guest 你始终有千万种理由,我一直都跟随你的感受..让你疯让你去放纵,以为你有天会感动..    请接唱..    \n     2013-01-09 23:17 |    \t\tBlackeagle \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:10        | 向WooYun致敬)\t\t \n  @胖子变瘦了 预测近期会出现瘦子变胖子    \n     2013-01-09 23:18 |    \t\tBlackeagle \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:10        | 向WooYun致敬)\t\t \n  @胖子变瘦了 预测近期会出现瘦子变胖了    \n     2013-01-09 23:30 |    \t\tnull \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:2        | 左岸是无法忘却的回忆，右岸是值得把握的青...)\t\t \n  汗。。。    \n     2013-01-10 00:22 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  @null @Blackeagle @心伤的瘦子 目测是剑心的马甲    \n     2013-01-10 08:39 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @蟋蟀哥哥 我觉得不是，剑心不会那么高调把，倒是另外那些人说不定了，比如肾斗士哈哈，反正瘦子是二哥    \n     2013-01-10 08:43 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  @only_guest  @Black Angel 关于流言我装作无动于衷    \n     2013-01-10 08:45 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  胖子减肥成功了..近期是否要出现其他连载马甲帝    \n     2013-01-10 09:05 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  神器的屌丝，越搞越娱乐    \n     2013-01-10 10:05 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  真是各种欢乐啊 ~~    \n     2013-01-10 11:06 |    \t\t心伤的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:147 漏洞数:21        | 严肃点~此号为虚拟小号，并不存在实体...)\t\t \n  你们好无聊。都开始K歌鸟。    \n     2013-01-10 11:49 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @心伤的瘦子 三天三夜，三更半夜，黑阔不停歇！    \n     2013-01-10 12:31 |    \t\t心伤的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:147 漏洞数:21        | 严肃点~此号为虚拟小号，并不存在实体...)\t\t \n  @疯子 请来个妹子跟我对歌    \n     2013-01-10 13:06 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @心伤的瘦子 请联系贱心 @xsser     \n     2013-01-10 13:08 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @疯子 不搅基 谢谢    \n     2013-01-10 13:17 |    \t\tshack2 \t\t\t( 普通白帽子  |\t\t\t        Rank:470 漏洞数:71        | QQ:1341413415 一个热爱编程(Java),热爱网...)\t\t \n  @马甲党    \n     2013-01-10 13:18 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  @xsser 不需要你搞基 只需要你配合    \n     2013-01-10 16:34 |    \t\trasca1 \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:16        | 菜鸟一只)\t\t \n  妈的 都是大牛    \n     2013-01-12 17:20 |    \t\t摩斯 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        | 每天进步一点点！努力学习技术！)\t\t \n  @腾讯 厂商写错了吧    \n     2013-01-12 19:26 |    \t\tcnhello \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 小菜一枚，学习中。。。)\t\t \n  这年头，连马甲都搞连载了    \n     2013-01-12 19:37 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  感觉应该弄个功能，只要厂商名字中有腾讯二字，就直接会@到腾讯    \n     2013-01-14 11:40 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  ......    \n     2013-01-14 11:48 |    \t\t假装纯情 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 不折腾会死星人~)\t\t \n  留个记号，这个很V5啊~    \n     2013-01-16 19:03 |    \t\tzsx \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | undefined)\t\t \n  MARK!    \n     2013-01-17 10:08 |    \t\t冷静 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        )\t\t \n  @xsser 20号还不认领是不是就公开了？    \n     2013-01-17 10:09 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @冷静 这个是未注册的，要一个半月，没指给企鹅    \n     2013-01-17 16:36 |    \t\tadwin \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:11        | 小菜请多指教。)\t\t \n  密切关注    \n     2013-02-19 17:34 |    \t\tVolltin \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:4        | gnihtoN‮)\t\t \n  密切关注    \n     2013-02-28 11:39 |    \t\t冷静 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        )\t\t \n  社工好思路    \n     2013-02-28 11:53 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  名副其实的“跨站”脚本攻击啊    \n     2013-02-28 11:56 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  这不是水坑模式么     \n     2013-02-28 13:35 |    \t\tAntBean \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 01d day)\t\t \n  靠，牛逼思路    \n     2013-02-28 13:42 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  缺陷关联： WooYun: 灯鹭社会化评论框xss  感谢LZ把我这个漏洞发扬光大，我担心的社交化登录危害就是这类实例！    \n     2013-02-28 16:26 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  留名，会火。    \n     2013-02-28 18:14 |    \t\t心伤的裤子 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:2        | 看啥，裤子都掉了还看！)\t\t \n  啊，，tmd那个@唐尸三摆手  不知道是谁的马甲，是吧？@only_guest 。。    \n     2013-02-28 18:36 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  会火，我也留名。    \n     2013-02-28 23:12 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @horseluke 目前一些类似的第三方的插件都可能或者已经存在问题。一个小XSS的危害会因此而急剧放大～    \n     2013-02-28 23:39 |    \t\t心伤的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:147 漏洞数:21        | 严肃点~此号为虚拟小号，并不存在实体...)\t\t \n  慎用慎用    \n     2013-03-02 15:10 |    \t\timlonghao \t\t\t( 普通白帽子  |\t\t\t        Rank:730 漏洞数:74        )\t\t \n  WTF！！！！    \n     2013-03-04 22:17 |    \t\t苏南同学 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:5        | 苏南同学，就是苏南同学~~~)\t\t \n  为啥不说这个xss是啥呢？？？？    \n     2013-03-04 22:18 |    \t\t苏南同学 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:5        | 苏南同学，就是苏南同学~~~)\t\t \n  就是腾讯的这个某分站的xss内容，为啥不说呢？    \n     2013-03-08 22:10 |    \t\t摩斯 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        | 每天进步一点点！努力学习技术！)\t\t \n  终于公开了！    \n     2013-03-29 21:04 |    \t\t银冥币 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:21        | \"/upload/avatar/avatar_251_b.jpg\" />)\t\t \n  mark.    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}