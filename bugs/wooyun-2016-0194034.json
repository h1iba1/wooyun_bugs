{"id": 87069, "wybug_id": "wooyun-2016-0194034", "wybug_title": "突破重重防护获得进入同程邮箱（iPhone内置接口利用技巧）", "wybug_corp": "苏州同程旅游网络科技有限公司", "wybug_author": "if、so", "wybug_date": "2016-04-08 20:34", "wybug_open_date": "2016-05-23 21:30", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-23：\t细节向公众公开  简要描述： 防不胜防，一个攻击新姿势，终极杀招。 详细说明：  同程网的邮件系统\nmail.17u.cn\n\n\n加了双重认证，需要手机动态验证码来验证。扫描了下端口，也没有开启pop3，也就是说有了账户密码都不能进入邮箱。怎么办?真的不能突破了？下面来介绍一个新东西\nMicrosoft ActiveSync 是基于 Windows Mobile 的设备的最新同步软件版本。ActiveSync 提供了即时可用的与基于 Windows 的个人计算机和 Microsoft Outlook 的良好同步体验。ActiveSync 可充当基于Windows 的个人计算机与基于 Windows Mobile 的设备之间的网关，从而允许您在个人计算机与设备之间传输 Outlook 信息、Office 文档、图片、音乐、视频和应用程序。除了与台式计算机进行同步之外，ActiveSync 还可以直接与 Microsoft Exchange Server 2003同步，从而允许您在离开个人计算机时也能通过无线方式获得最新的电子邮件、日历数据、任务和联系人信息。\n通俗来讲就是一个功能接口提供给手机用户方便移动办公想要使用此服务，比如收发邮件，就去手机上设置 如图\n\n\n\n选择exchange然后进行设置很多人都会想，服务器什么相关邮件服务端口都没开，怎么可能连接上邮件服务器，并且收发邮件？其实不是，强大的微软早已提供相关接口注意，域名那里一定要填写域名，这里的域名是windows ad域名，至于域名是什么，需要自己去收集信息。\n\n WooYun: 利用某些漏洞可以重置同程网任意用户密码  这个漏洞里面正好当时正好记录下了内网域名\nc:\\windows\\system32\\inetsrv\\> net group \"domain admins\" /domain这项请求将在域 tcent.cn 的域控制器处理。\n填完相关信息，连上wifi，在电脑上抓包获得认证包\nOPTIONS /Microsoft-Server-ActiveSync HTTP/1.1Host: mail.17u.comAccept-Encoding: gzip, deflateContent-Length: 0Connection: keep-aliveProxy-Connection: keep-aliveAccept: */*User-Agent: Apple-iPhone8C2/1304.15Authorization: Basic dHVuaXUtaW5jXHF3ZTpxd2U=Accept-Language: zh-cnX-MS-PolicyKey: 0\n一切搞定，开始放入burp爆破\n\n爆破点在\nAuthorization: Basic dHVuaXUtaW5jXHF3ZTpxd2U=\n这里被base64编码了，原始格式是\ntcent.cn\\username\n(是一个斜杠，被乌云转码多了一个)手上刚好遗漏以前的同程的一些用户名，开始爆破最后成功获得1个用户yucuilan tcw123手机连接，成功连接上，但是需要管理员审核貌似，等了几天，成功被开启，哈哈\n\n\n\n土豪公司。。   漏洞证明：  如上所示，同程密码强度现在做的蛮好的，爆破了好久。其实也不能怪同程，微软接口太多了，防不胜防，不过网络管理员审核用户时应该要核实后才能给用户开启邮件服务。想找出更多案列来，可惜满足邮件系统有验证码验证加没开启邮件服务端口条件的公司本来就不多，而且弱口令也爆不出来，一大遗憾。   修复方案：     版权声明：转载请注明来源 if、so@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2016-04-08 21:25 厂商回复： 感谢关注同程旅游，帐号是有密码策略的，不少于8位，所以我们日常扫描的字典就没有低于8位的。回头看看哪儿出问题了。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-08 20:34 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  哈哈 不错    \n     2016-04-08 20:35 |    \t\tBear baby \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:28        | 总感觉我会在哪天突然顿悟。)\t\t \n  你关注的白帽子 if、so 发表了漏洞 突破重重防护获得进入同程邮箱（iPhone内置接口利用技巧）    \n     2016-04-08 20:39 |    \t\t镱鍚 \t\t\t( 普通白帽子  |\t\t\t        Rank:265 漏洞数:34        | 。。！)\t\t \n  前排    \n     2016-04-08 20:42 |    \t\t紫霞仙子  \t\t\t( 普通白帽子  |\t\t\t        Rank:2302 漏洞数:307        | 长期招聘安全测试人员，熟悉or精通python,...)\t\t \n  终极杀招。    \n     2016-04-08 20:43 |    \t\tDloveJ \t\t\t( 普通白帽子  |\t\t\t        Rank:1427 漏洞数:255        | 专业潜水哒~)\t\t \n  关注    \n     2016-04-08 20:44 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:389 漏洞数:96        | 管你有多么失措 别再叫我。  |  Tr3jer@Gma...)\t\t \n  关注    \n     2016-04-08 20:51 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:817 漏洞数:100        | 没关系啊，我们还有音乐)\t\t \n  有意思    \n     2016-04-08 21:03 |    \t\t大师兄 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:8        | 每日必关注乌云)\t\t \n  原来是这样的啊    \n     2016-04-08 21:04 |    \t\t诡道 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 懒得和猪一样)\t\t \n  .    \n     2016-04-08 21:12 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:244 漏洞数:94        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  关注    \n     2016-04-08 21:25 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1393 漏洞数:147        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  牛逼啊    \n     2016-04-08 21:26 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1137 漏洞数:198        | px1624)\t\t \n  厉害，原来是这样！    \n     2016-04-08 21:31 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  狗哥帮忙把充值多少钱那边打个码吧，露财不好→_→    \n     2016-04-08 21:32 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1199 漏洞数:103        | Enjoy Hacking)\t\t \n  @苏州同程旅游网络科技有限公司 。。。    \n     2016-04-08 21:42 |    \t\t孤梦° \t\t\t( 普通白帽子  |\t\t\t        Rank:143 漏洞数:48        )\t\t \n  你关注的白帽子 if、so 发表了漏洞 突破重重防护获得进入同程邮箱（iPhone内置接口利用技巧）    \n     2016-04-08 22:00 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @if、so 哥你对我们情有独钟啊 为啥就不愿意来呢 过来和Matt他们一起做攻防    \n     2016-04-08 22:03 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1199 漏洞数:103        | Enjoy Hacking)\t\t \n  。。。一言难尽，保持暧昧挺好的     \n     2016-04-08 22:04 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1199 漏洞数:103        | Enjoy Hacking)\t\t \n  @苏州同程旅游网络科技有限公司     \n     2016-04-08 23:43 |    \t\t高小厨  \t\t\t( 普通白帽子  |\t\t\t        Rank:978 漏洞数:90        | 不会吹牛的小二不是好厨子！)\t\t \n  膜拜啊    \n     2016-04-09 07:08 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1621 漏洞数:221        | 。)\t\t \n  膜拜    \n     2016-04-09 11:04 |    \t\tMr .LZH \t\t\t( 普通白帽子  |\t\t\t        Rank:622 漏洞数:79        | 非妹子勿扰···)\t\t \n  @苏州同程旅游网络科技有限公司 挖人太赤裸裸了。。。    \n     2016-04-09 11:06 |    \t\t坏男孩-A_A \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:23        | 膜拜学习中)\t\t \n  这人挖的= =    \n     2016-04-09 18:15 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1739 漏洞数:229        | 逆流而上)\t\t \n  关注新姿势    \n     2016-04-10 21:36 |    \t\tblnxz \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:16        | 为了防止世界被破坏，为了维护世界的和平，...)\t\t \n  两天不上网，大牛又出新东西了？我发现你字典不错哦    \n     2016-04-11 08:52 |    \t\t刘海哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:135 漏洞数:30        | 索要联系方式但不送礼物的厂商定义为无良厂...)\t\t \n  目测找到泄露的密码然后通过iPhone的自带邮件功能，登录进去绕过了他页面登录需要的手机验证码。     \n     2016-04-11 09:02 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1137 漏洞数:198        | px1624)\t\t \n  @刘海哥 二次手机短信验证码这个，貌似只要是个客户端的都可以~    \n     2016-04-11 09:08 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1199 漏洞数:103        | Enjoy Hacking)\t\t \n  @px1624 show case    \n     2016-04-11 09:49 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1137 漏洞数:198        | px1624)\t\t \n  @if、so   WooYun: 网易邮箱某重要邮件系统可绕过邮箱登录二次验证从而登录邮箱 WooYun: 网易邮箱登录二次验证绕过漏洞 WooYun: 网易重要邮件手机验证可成功绕过    \n     2016-04-11 10:16 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1199 漏洞数:103        | Enjoy Hacking)\t\t \n  和你那不属于一个东西，这是exchange，，邮件端口都没开，知道的人也比较少    \n     2016-04-11 14:58 |    \t\t刘海哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:135 漏洞数:30        | 索要联系方式但不送礼物的厂商定义为无良厂...)\t\t \n  那着能坐等观看了    \n     2016-04-28 22:00 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1712 漏洞数:261        | 老司机发车污污污污污污！)\t\t \n  简直6！！！    \n     2016-04-28 22:36 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:431 漏洞数:61        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  @if、so 我还看不到漏洞,难道是调用微软API接口;https收邮件就行了.短信验证就不知道了.. 但是亲测N次,web登录邮箱是登录不了的;https收取就可以了;微软有API    \n     2016-04-29 09:06 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1199 漏洞数:103        | Enjoy Hacking)\t\t \n  是一个接口，和你说的不是一个，并且这个也算一个可以暴力破解的接口    \n     2016-04-30 03:29 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:431 漏洞数:61        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  @if、so 666    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}