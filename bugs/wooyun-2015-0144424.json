{"id": 73373, "wybug_id": "wooyun-2015-0144424", "wybug_title": "phpyun最新版两处注入(无视gpc)", "wybug_corp": "php云人才系统", "wybug_author": "Xser", "wybug_date": "2015-10-05 17:42", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-09：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-11-30：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： PHP云人才系统 phpyun v4.0正式版 build201508194.0已经重新改版了，别在用3.2和4.0比较 详细说明：  第一处出现在/member/com/model/show.class.php中3.2版本的源码是\nfunction delshow_action(){\t\t$company_show=$this->obj->DB_select_all(\"company_show\",\"`id` in (\".$_POST['ids'].\") and `uid`='\".$this->uid.\"'\",\"`picurl`\");\t\tif(is_array($company_show)&&$company_show){\t\t\tforeach($company_show as $val){\t\t\t\t$this->obj->unlink_pic(\".\".$val['picurl']);\t\t\t}\t\t\t$this->obj->DB_delete_all(\"company_show\",\"`id` in (\".$_POST['ids'].\") and `uid`='\".$this->uid.\"'\",\"\");\t\t}\t\treturn true;\t}\n以下是4.0的\nfunction delshow_action(){ $ids=$_POST['ids']; $company_show=$this->obj->DB_select_all(\"company_show\",\"`id` in (\".$ids.\") and `uid`='\".$this->uid.\"'\",\"`picurl`\"); if(is_array($company_show)&&$company_show){ foreach($company_show as $val){ unlink_pic(\".\".$val['picurl']); } $this->obj->DB_delete_all(\"company_show\",\"`id` in (\".$ids.\") and `uid`='\".$this->uid.\"'\",\"\"); $this->obj->member_log(\"删除企业环境展示\"); } return true;\n POST来的值直接带入查询，没有单引号，所以可以注入 试试带入字符看看是否可以 url\nhttp://127.0.0.1/phpyun/member/index.php?c=show&act=delshow\n postdata\nids=aaaa#\n \n\n 成功带入\n2015/10/1 14:14\tSELECT `picurl` FROM `phpyun_company_show` WHERE `id` in (aaaa#) and `uid`='1'\n第二处出现在/member/user/model/show.class.php中第二处改的比较明显3.2是用GET方法获取del参数但是4.0改用了POST的方法获取，但是没有过滤3.2的\n$delid=$_GET['del'];//GET的del没有过滤，传给delid\n4.0的\n$ids=$_POST['ids']\n以下是3.2源码\nfunction job(){。。。570行\t\tif($_GET['del'] || is_array($_POST['checkboxid']))\t\t{\t\t\tif(is_array($_POST['checkboxid'])){\t\t\t\t$layer_type=1;\t\t\t\t$delid=$this->pylode(\",\",$_POST['checkboxid']);\t\t\t}else if($_GET['del']){\t\t\t\t$layer_type=0;\t\t\t\t$delid=$_GET['del'];//GET的del没有过滤，传给delid\t\t\t}\t\t\t$rows=$this->obj->DB_select_all(\"company_job\",\"`uid`='\".$this->uid.\"' and `id` in (\".$delid.\")\",\"`state`\");\t\t\t$nid=$this->obj->DB_delete_all(\"company_job\",\"`uid`='\".$this->uid.\"' and `id` in (\".$delid.\")\",\" \");\t\t\techo $nid;\t\t\t$this->obj->DB_delete_all(\"company_job_link\",\"`uid`='\".$this->uid.\"' and `jobid` in (\".$delid.\")\",\" \");。。。}\n以下是4.0的\nfunction delshow_action(){ $ids=$_POST['ids']; $resume_show=$this->obj->DB_select_all(\"resume_show\",\"`id` in (\".$ids.\") and `uid`='\".$this->uid.\"'\",\"`picurl`\"); if(is_array($resume_show)&&$resume_show){ foreach($resume_show as $val){ unlink_pic(\".\".$val['picurl']); } $this->obj->DB_delete_all(\"resume_show\",\"`id` in (\".$ids.\") and `uid`='\".$this->uid.\"'\",\"\"); $this->obj->member_log(\"删除作品案例\"); } return true;\n POST来的值直接带入查询，没有单引号，所以可以注入 试试带入字符看看是否可以 url\nhttp://127.0.0.1/phpyun/member/index.php?c=show&act=delshow\n postdata\nids=aaaa#\n \n\n 可以看到成功带入 \n2015/10/1 13:56\tSELECT `picurl` FROM `phpyun_resume_show` WHERE `id` in (aaaa#) and `uid`='2'\n   漏洞证明：  第一处出现在/member/com/model/show.class.php中3.2版本的源码是\nfunction delshow_action(){\t\t$company_show=$this->obj->DB_select_all(\"company_show\",\"`id` in (\".$_POST['ids'].\") and `uid`='\".$this->uid.\"'\",\"`picurl`\");\t\tif(is_array($company_show)&&$company_show){\t\t\tforeach($company_show as $val){\t\t\t\t$this->obj->unlink_pic(\".\".$val['picurl']);\t\t\t}\t\t\t$this->obj->DB_delete_all(\"company_show\",\"`id` in (\".$_POST['ids'].\") and `uid`='\".$this->uid.\"'\",\"\");\t\t}\t\treturn true;\t}\n以下是4.0的\nfunction delshow_action(){ $ids=$_POST['ids']; $company_show=$this->obj->DB_select_all(\"company_show\",\"`id` in (\".$ids.\") and `uid`='\".$this->uid.\"'\",\"`picurl`\"); if(is_array($company_show)&&$company_show){ foreach($company_show as $val){ unlink_pic(\".\".$val['picurl']); } $this->obj->DB_delete_all(\"company_show\",\"`id` in (\".$ids.\") and `uid`='\".$this->uid.\"'\",\"\"); $this->obj->member_log(\"删除企业环境展示\"); } return true;\n POST来的值直接带入查询，没有单引号，所以可以注入 试试带入字符看看是否可以 url\nhttp://127.0.0.1/phpyun/member/index.php?c=show&act=delshow\n postdata\nids=aaaa#\n \n\n 成功带入\n2015/10/1 14:14\tSELECT `picurl` FROM `phpyun_company_show` WHERE `id` in (aaaa#) and `uid`='1'\n第二处出现在/member/user/model/show.class.php中第二处改的比较明显3.2是用GET方法获取del参数但是4.0改用了POST的方法获取，但是没有过滤3.2的\n$delid=$_GET['del'];//GET的del没有过滤，传给delid\n4.0的\n$ids=$_POST['ids']\n以下是3.2源码\nfunction job(){。。。570行\t\tif($_GET['del'] || is_array($_POST['checkboxid']))\t\t{\t\t\tif(is_array($_POST['checkboxid'])){\t\t\t\t$layer_type=1;\t\t\t\t$delid=$this->pylode(\",\",$_POST['checkboxid']);\t\t\t}else if($_GET['del']){\t\t\t\t$layer_type=0;\t\t\t\t$delid=$_GET['del'];//GET的del没有过滤，传给delid\t\t\t}\t\t\t$rows=$this->obj->DB_select_all(\"company_job\",\"`uid`='\".$this->uid.\"' and `id` in (\".$delid.\")\",\"`state`\");\t\t\t$nid=$this->obj->DB_delete_all(\"company_job\",\"`uid`='\".$this->uid.\"' and `id` in (\".$delid.\")\",\" \");\t\t\techo $nid;\t\t\t$this->obj->DB_delete_all(\"company_job_link\",\"`uid`='\".$this->uid.\"' and `jobid` in (\".$delid.\")\",\" \");。。。}\n以下是4.0的\nfunction delshow_action(){ $ids=$_POST['ids']; $resume_show=$this->obj->DB_select_all(\"resume_show\",\"`id` in (\".$ids.\") and `uid`='\".$this->uid.\"'\",\"`picurl`\"); if(is_array($resume_show)&&$resume_show){ foreach($resume_show as $val){ unlink_pic(\".\".$val['picurl']); } $this->obj->DB_delete_all(\"resume_show\",\"`id` in (\".$ids.\") and `uid`='\".$this->uid.\"'\",\"\"); $this->obj->member_log(\"删除作品案例\"); } return true;\n POST来的值直接带入查询，没有单引号，所以可以注入 试试带入字符看看是否可以 url\nhttp://127.0.0.1/phpyun/member/index.php?c=show&act=delshow\n postdata\nids=aaaa#\n \n\n 可以看到成功带入 \n2015/10/1 13:56\tSELECT `picurl` FROM `phpyun_resume_show` WHERE `id` in (aaaa#) and `uid`='2'\n   修复方案：  改为\"`id` in ('\".$ids.\"')加入单引号就可以了   版权声明：转载请注明来源 Xser@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-10-06 13:25 厂商回复： 感谢提供，我们会尽快修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-10-05 17:45 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:527 漏洞数:85        | 活到老，学到老!)\t\t \n  两处啥？    \n     2015-10-05 19:29 |    \t\t末影人 \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:10        | 末影人(Enderman)是一个三个方格高的人形生...)\t\t \n  两处什么    \n     2015-10-05 22:20 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:237 漏洞数:78        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  两处啥？    \n     2015-10-06 21:43 |    \t\t金枪银矛小霸王 \t\t\t( 普通白帽子  |\t\t\t        Rank:141 漏洞数:29        | 不会挖洞洞的猿猿不是好学生)\t\t \n  两处啥？    \n     2015-10-07 17:03 |    \t\t找寻者 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 学习啊)\t\t \n  9:10收10WB,手续协商...进社区学习ing    \n     2015-10-11 08:21 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:793 漏洞数:151        | http://menmen519.blog.sohu.com/)\t\t \n  这么快就有奖金了，@疯狗 @Finger 给我底下的也发了吧，没钱吃饭了    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}