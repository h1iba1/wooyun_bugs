{"id": 38059, "wybug_id": "wooyun-2015-0106331", "wybug_title": "网鱼网咖鱼泡泡手机应用getshell然后ke刷各种支持网吧的网费", "wybug_corp": "网鱼网咖", "wybug_author": "xsser_w", "wybug_date": "2015-04-08 12:01", "wybug_open_date": "2015-05-23 12:02", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-08：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-05-23：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： RT     这么刷网费真是开心阿 详细说明：  首先、我们需要getshell 一个 那么 shell 的过程就是一个鱼泡泡的getshell这个getshell 不是重点，重点是刷钱那么这套系统有个pubwin.php 是pubwin接口 我们来看下信息\npublic function Recharge($cardno,$money,$zsmoney,$is_return=false)\t{\t\t$response = $this->GetUserInfoByCardNo($cardno);\t\t\t\tif(!$response[\"success\"])\t\t{\t\t\treturn $response;\t\t}\t\t//充值类型\t\t$source_type = \"4\";\t\tif($is_return)\t\t\t$source_type = \"6\";\t\t\t\t$param = \"{$cardno}|{$money}|{$zsmoney}|{$source_type}\";\t\t330104199009073010|-11800000||5\t\t$host = $this->BarCenterHost;\t\t$wangbano = $this->WangBaNo;\t\t$isonline = $response[\"isonline\"];\t\t\t\tif($isonline == 1)\t\t{\t\t\t$wangbano = $response[\"wangbano\"];\t\t\t$bar_res = $this->GetWangBaInfoById($wangbano);\t\t\tif(!$bar_res[\"success\"])\t\t\t{\t\t\t\tlog_message('error',\"get online wangba info no fail[{$wangbano}]\");\t\t\t\treturn $bar_res;\t\t\t}\t\t\t\t\t\t\t$host = $bar_res[\"ip\"];\t\t\t$port = $bar_res[\"port\"];\t\t\t\t\t\t$host = \"http://{$host}:{$port}\";\t\t\t\t\t\t\t\t\t}\t\telse //不在线的，需要用网鱼总店的认证,把会员信息拉到网鱼总店，否则无法充值\t\t{\t\t\t$auth_res = $this->memberAuth($host,$cardno);\t\t\t\t\t\tif($auth_res[\"success\"] == false)\t\t\t{\t\t\t\treturn $auth_res;\t\t\t}\t\t\telse \t\t\t{\t\t\t\t$memberType = $auth_res[\"membertype\"];\t\t\t\tif($memberType != \"1\")\t\t\t\t{\t\t\t\t\t$res = array(\"success\"=>false,\"code\"=>\"40099\",\"msg\"=>\"临时会员无法充值\");\t\t\t\t\treturn $res;\t\t\t\t}\t\t\t}\t\t}\t\t\t\t$url = $host.\"/NetCafe/servlet/CommunicationDataServlet?operation=memberRecharge&param={$param}\";\t\t\t\t$result = http_get($url);\t\t$error_result = $result;\t\t\t\t//40000|32200||1397\t\t\t\t$result = explode(\"|\", $result);\t\t\t\t$code = $result[0];\t\t\t\t\tif($code != \"40000\")\t\t{\t\t\tlog_message('error',\"充值失败：\".$url);\t\t\t$error_result = mb_convert_encoding($error_result,\"utf-8\", \"GBK\"); \t\t\tlog_message('error',\"充值失败：\".$error_result);\t\t\t$msg = $result[1];\t\t\t$response = array(\"success\"=>false,\"code\"=>$code,\"wangbano\"=>$wangbano,\"msg\"=>$msg);\t\t}\t\telse\t\t{\t\t\t$cash_balance = $result[1];\t\t\t$trade_no = $result[3];\t\t\t$response = array(\"success\"=>true,\"cash_balance\"=>$cash_balance,\"trade_no\"=>$trade_no,\"wangbano\"=>$wangbano);\t\t}\t\t\t\treturn $response; \t\t\t}\nrecharge 函数对 发起一个请求到服务器 不管在不在线都会使用网吧pubwin其实在此前还有一个总的Pubwin服务器接口，不过现在好像做了防火墙策略？ 可以Ping,但是http包不能正常返回 我们先不管这个无意间，我得到了以下地址http://gms.wywk.cn/app/wywk/pubwinClent.html?_resourceid=40288a6b3da55260013db059bc192eef&application=11e1-892d-55b16c79-9894-3ff4f220aec6\n\n是全国接近200家的地址，这意味着什么？我们可以向任意地址发起请求 充值我的账户!_!  核心业务已经被突破了shell地址http://yppapi.wanyoo.com/appupdate/1.php哦对了，这个服务器上挂着 升级版的鱼泡泡，那我要是替换了岂不是…\n\n上线前做好安全监测，业务涉及金钱部分未做业务隔离   漏洞证明：  http://yppapi.wanyoo.com/appupdate/1.php   修复方案：  1。隔离开升级业务的鱼泡泡2.校验上传 3。禁止匿名访问这些pubwin接口  对全国200家……网吧总台做防火墙策略，强行要求…4、修改参数名5、pubwin端验证数值类型   版权声明：转载请注明来源 xsser_w@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：20 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2015-04-09 15:18 |    \t\t有妹子送上 \t\t\t( 实习白帽子  |\t\t\t        Rank:89 漏洞数:28        | 杭州最帅的男人)\t\t \n  快忽略    \n     2015-04-09 15:31 |    \t\txsser_w \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:33        | 哎)\t\t \n  @有妹子送上 呵呵！  - -    \n     2015-05-23 12:20 |    \t\t夸父追日 \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:6        | 每天六个小时的睡眠,十二节四十五分钟到一...)\t\t \n  主动忽略然后偷偷修复了,呵呵    \n     2015-05-23 19:59 |    \t\txsser_w \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:33        | 哎)\t\t \n  @夸父追日 未能联系到厂商或者厂商积极拒绝    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 20, "Ranks": null}