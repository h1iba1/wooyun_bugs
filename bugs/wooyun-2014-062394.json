{"id": 55026, "wybug_id": "wooyun-2014-062394", "wybug_title": "YouYax论坛SQL注入漏洞", "wybug_corp": "youyax.com", "wybug_author": "路人甲", "wybug_date": "2014-05-30 11:51", "wybug_open_date": "2014-05-30 12:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-30：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 代码审计之SQL注入，针对这个严谨的厂商，有注入绝不能忍啊，必须是高啊。而且其他都做了addsalsh ，这个是漏的 详细说明：  问题出在register.php文件中先说fuzz时候是怎么发现的注册用户的时候发现在第二次注册会给出提醒alert('注册失败，该IP地址已经使用超过了1次');于是想着用XFF能不能绕过，果断添加X-Forwarded-For字段，就绕过了然后在X-Forwarded-For这里，修改ip地址为1.1.1.1' and 1=1等等，测试均成功，由此判断这里肯定是个注入，只不过是个盲注，在外面测试不太方便就没跑库于是去看源码关键代码\tif($mix['is_prevent_reg']){\t\tif (!empty($_SERVER['HTTP_CLIENT_IP']))        //直接从客户端获取ip        $myIp = $_SERVER['HTTP_CLIENT_IP'];    else if (!empty($_SERVER['HTTP_X_FORWARDED_FOR']))        //从xff字段里直接获取        $myIp = $_SERVER['HTTP_X_FORWARDED_FOR'];    else        $myIp = $_SERVER['REMOTE_ADDR'];    $sql    = \"select * from \" . $config['db_prefix'] . \"user where ip_addr='\" . $myIp . \"'\";    //这里直接拼接到sql语句中，造成注入，后面看到是没有回显的，是个盲注    $result = mysql_query($sql);    $num    = mysql_num_rows($result);\t    if($num >= $mix['prevent_reg_num']){\t    \techo \"<script>alert('注册失败,此IP地址已经使用超过 \".$mix['prevent_reg_num'].\" 次了');</script>\";\t      echo \"<script>window.parent.location.href='\" . url_site . \"';</script>\";\t      exit;\t    }\t}   漏洞证明：  问题出在register.php文件中先说fuzz时候是怎么发现的注册用户的时候发现在第二次注册会给出提醒alert('注册失败，该IP地址已经使用超过了1次');于是想着用XFF能不能绕过，果断添加X-Forwarded-For字段，就绕过了然后在X-Forwarded-For这里，修改ip地址为1.1.1.1' and 1=1等等，测试均成功，由此判断这里肯定是个注入，只不过是个盲注，在外面测试不太方便就没跑库于是去看源码关键代码\tif($mix['is_prevent_reg']){\t\tif (!empty($_SERVER['HTTP_CLIENT_IP']))        //直接从客户端获取ip        $myIp = $_SERVER['HTTP_CLIENT_IP'];    else if (!empty($_SERVER['HTTP_X_FORWARDED_FOR']))        //从xff字段里直接获取        $myIp = $_SERVER['HTTP_X_FORWARDED_FOR'];    else        $myIp = $_SERVER['REMOTE_ADDR'];    $sql    = \"select * from \" . $config['db_prefix'] . \"user where ip_addr='\" . $myIp . \"'\";    //这里直接拼接到sql语句中，造成注入，后面看到是没有回显的，是个盲注    $result = mysql_query($sql);    $num    = mysql_num_rows($result);\t    if($num >= $mix['prevent_reg_num']){\t    \techo \"<script>alert('注册失败,此IP地址已经使用超过 \".$mix['prevent_reg_num'].\" 次了');</script>\";\t      echo \"<script>window.parent.location.href='\" . url_site . \"';</script>\";\t      exit;\t    }\t}   修复方案：  SQL注入修复   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-05-30 12:34 厂商回复： 2天前有其他白帽子就指出来了，很早就修复了 最新状态： 2014-05-30：最新版已经有验证代码if(!filter_var($myIp, FILTER_VALIDATE_IP)){    \t\techo \"<script>alert('此IP地址是无效的!');</script>\";\t    echo \"<script>window.parent.location.href='\" . url_site . \"';</script>\";\t    exit;    }  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}