{"id": 1655, "wybug_id": "wooyun-2014-063441", "wybug_title": "DedeCMS最新版前台SQL注射", "wybug_corp": "Dedecms", "wybug_author": "blue", "wybug_date": "2014-06-04 01:54", "wybug_open_date": "2014-09-02 01:56", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "注射漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-09：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-02：\t细节向公众公开  简要描述： 又见SQL注射，一个小问题引发的多处血案... 详细说明：  DedeCMS在注册时对用户名、电子邮箱等限制的很死，唯独对用户笔名没做限制，可填写单引号等，由此导致再次使用笔名入库时二次注入1. /member/reg_new.php 约194行\n$inQuery = \"INSERT INTO `#@__member` (`mtype` ,`userid` ,`pwd` ,`uname` ,`sex` ,`rank` ,`money` ,`email` ,`scores` ,        `matt`, `spacesta` ,`face`,`safequestion`,`safeanswer` ,`jointime` ,`joinip` ,`logintime` ,`loginip` )       VALUES ('$mtype','$userid','$pwd','$uname','$sex','10','$dfmoney','$email','$dfscores',       '0','$spaceSta','','$safequestion','$safeanswer','$jointime','$joinip','$logintime','$loginip'); \"; //在此之前没有对$uname做判断，可注入单引号        if($dsql->ExecuteNoneQuery($inQuery))\n2. 全局搜索M_UserName,username,getUserName()等，找到将笔名再次入库的点，如/include/memberlogin.class.php 约567行\nfunction RecordFeeds($type, $title, $note, $aid)    {        global $dsql,$cfg_mb_feedcheck;        //确定是否需要记录        if (in_array($type,array('add','addsoft','feedback','addfriends','stow'))){            $ntime = time();            $title = htmlspecialchars(cn_substrR($title,255));            if(in_array($type,array('add','addsoft','feedback','stow')))            {                $rcdtype = array('add'=>' 成功发布了', 'addsoft'=>' 成功发布了软件',                                 'feedback'=>' 评论了文章','stow'=>' 收藏了');                //内容发布处理                $arcrul = \" <a href='/plus/view.php?aid=\".$aid.\"'>\".$title.\"</a>\";                $title = htmlspecialchars($rcdtype[$type].$arcrul, ENT_QUOTES);            } else if ($type == 'addfriends')            {                //添加好友处理                $arcrul = \" <a href='/member/index.php?uid=\".$aid.\"'>\".$aid.\"</a>\";                $title = htmlspecialchars(' 与'. $arcrul.\"成为好友\", ENT_QUOTES);            }            $note = Html2Text($note);            $aid = (isset($aid) && is_numeric($aid) ? $aid : 0);            $ischeck = ($cfg_mb_feedcheck == 'Y')? 0 : 1;            $query = \"INSERT INTO `#@__member_feed` (`mid`, `userid`, `uname`, `type`, `aid`, `dtime`,`title`, `note`, `ischeck`)                         Values('$this->M_ID', '$this->M_LoginID', '$this->M_UserName', '$type', '$aid', '$ntime', '$title', '$note', '$ischeck'); \"; //插入用户动态，这里是重点，直接使用了$this->M_UserName            $rs = $dsql->ExecuteNoneQuery($query);            return $rs;        } else {            return FALSE;        }\n3. 通过一些可记录feed的操作，如发表文章，加好友等，即可触发此注入   漏洞证明：  1. 注入新用户，插入sql语句（根据自己爱好写吧，最好结尾加\\，然后找到可控的临近字段）\n\n2. 加个好友，触发用户动态记录\n\n3. 到个人中心看看吧～\n\n   修复方案：  在注册时就限制好笔名的格式最简单   版权声明：转载请注明来源 blue@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2014-06-06 19:42 厂商回复： 已修复，感谢提交 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-04 01:56 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  沙发    \n     2014-06-04 01:59 |    \t\tblue  \t\t\t( 普通白帽子  |\t\t\t        Rank:779 漏洞数:70        | 我心中有猛虎，细嗅蔷薇。)\t\t \n  @phith0n 好巧，早点睡啊～    \n     2014-06-04 03:49 |    \t\t傻傻的xj \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 专注被泡33年.)\t\t \n  专注 dede 18年...    \n     2014-06-04 06:09 |    \t\tMuZhU0 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:4        )\t\t \n  隔一段时间，一个DEDECMS的SQL注射。可悲的织梦。    \n     2014-06-04 06:24 |    \t\t马丁 \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:23        | 大爷~给口饭吧。)\t\t \n  前排  知足了  这么近  一定可以沾光    \n     2014-06-04 08:42 |    \t\t园长 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:14        | 你在身边就是缘，缘分写在数据库里面。)\t\t \n  哥，我们今天去啊。    \n     2014-06-04 09:02 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:189        )\t\t \n  织梦如今这么可怜....    \n     2014-06-04 09:04 |    \t\t大白菜 \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:19        )\t\t \n  我来围观了。。。    \n     2014-06-04 09:04 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  前排mark    \n     2014-06-04 09:09 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2360 漏洞数:406        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  我也要沾光    \n     2014-06-04 09:11 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  又是dede    \n     2014-06-04 09:31 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  牛逼    \n     2014-06-04 09:43 |    \t\t紫衣大侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:21        | 愿结天下有识之士)\t\t \n  流弊    \n     2014-06-04 09:49 |    \t\tblue  \t\t\t( 普通白帽子  |\t\t\t        Rank:779 漏洞数:70        | 我心中有猛虎，细嗅蔷薇。)\t\t \n  @园长 so good，好好玩，安全第一    \n     2014-06-04 09:50 |    \t\tChora \t\t\t( 普通白帽子  |\t\t\t        Rank:337 漏洞数:22        | 生存、生活、生命。)\t\t \n  亲你又调皮了    \n     2014-06-04 09:51 |    \t\tcold \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 生命不息，折腾不止。)\t\t \n  流弊,来沾光    \n     2014-06-04 10:01 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-06-04 10:29 |    \t\t落月 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 落月，关注网络安全；关注黑帽劫持；)\t\t \n  又是dede  ，织梦怎么这么多洞    \n     2014-06-04 11:04 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  这货成就了那么多土豪啊    \n     2014-06-04 11:07 |    \t\tblue  \t\t\t( 普通白帽子  |\t\t\t        Rank:779 漏洞数:70        | 我心中有猛虎，细嗅蔷薇。)\t\t \n  @wefgod 楼上才是真土豪～    \n     2014-06-04 11:33 |    \t\t邪少 \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:7        )\t\t \n  这次有亮点吗?    \n     2014-06-04 11:44 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  织梦这个我倒是发现有sql注入，但是它有一个防护机制，好多函数或者写法被屏蔽了，不知道楼主是已经发现了绕过的方法，请赐教！！！    \n     2014-06-04 12:43 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @blue 酱油路人各种打    \n     2014-06-04 12:46 |    \t\tblue  \t\t\t( 普通白帽子  |\t\t\t        Rank:779 漏洞数:70        | 我心中有猛虎，细嗅蔷薇。)\t\t \n  @menmen519 绕过方法公开了，呃，drops上就有 http://drops.wooyun.org/papers/353    \n     2014-06-04 13:34 |    \t\tc0lc \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 小牛牛说，要打死你)\t\t \n  我要膜拜这个亮点    \n     2014-06-04 13:44 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  感谢大神，织梦sql注入漏洞已提交，等待中    \n     2014-06-04 13:53 |    \t\tblue  \t\t\t( 普通白帽子  |\t\t\t        Rank:779 漏洞数:70        | 我心中有猛虎，细嗅蔷薇。)\t\t \n  @menmen519 厉害    \n     2014-06-04 13:55 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  @blue @menmen519 全是大神，根本挡不住    \n     2014-06-05 23:37 |    \t\t大白菜 \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:19        )\t\t \n  。。。。你的神器真是牛爆了~！！    \n     2014-09-02 10:33 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  牛逼    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}