{"id": 85727, "wybug_id": "wooyun-2016-0174188", "wybug_title": "利用人人设计缺陷劫持用户私信内容(绕过跨域策略/bypass)", "wybug_corp": "人人网", "wybug_author": "q601333824", "wybug_date": "2016-02-01 14:53", "wybug_open_date": "2016-03-14 15:10", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误", "设计不当", "设计错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-02-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-03-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-03-14：\t细节向公众公开  简要描述： 设计的时候别绕了，没发现绕了半天跑回起点了吗,说是bypass，其实利用设计上的漏洞 跨域会报错：Blocked a frame with origin \"xxxxx\" from accessing  详细说明：     1.这个漏洞，利用的是 \ncontentWindow\n   2.这个函数可以让父窗口获取子窗口的内容，但是前提是同个域,这里举个例子就是，我可以从人人网校园，获取人人网用户个人中心的内容，如图 \n\n   3.至于XSS，找到一个去年虽然不知道是谁提交但是未修复的XSS WooYun: 人人网分站再爆xss漏洞一枚 -------------------------------------------------------------------------------------    4.获取用户聊天信息的接口 \nhttp://webpager.renren.com/api/getChatList?lt=15&st=0&type=0&roomId=874460788\n    5.这个接口的roomId,代表用户聊天的对象，只要把data-id 遍历出来就行了(这里我就把整个body弹出来了，没有去弄数组遍历了) \n\n \n\n   ---------------------------------------------------------------------------------------   6 .接下来就是，如何跨域，这个接口\nhttp://webpager.renren.com/api/getChatList?lt=15&st=0&type=0&roomId=874460788\n属于webpager.renren.com域,如果获取内容会报错 ,因为http://st.renren.com/属于renren.com域 \n\n  \n\n----------------------------------------------------------------------------------------------     7.但是在用户个人中心，存在一个地址,之后发现，这个地址属于renren.com域名，  \nhttp://webpager.renren.com/api/ime.jsp\n \n\n \n\n-------------------------------------------------------------------------------------------------    8.觉得上面乱的话，我整理一下逻辑上面就是      ①.\nhttp://webpager.renren.com/api/ime.jsp\n属于renren.com域     ②.\nhttp://webpager.renren.com/api/getChatList?lt=15&st=0&type=0&roomId=874460788\n 属于webpager.renren.com域  -------------------------------------------------------------------------------------------    9.这个时候设计上的缺陷也就出来了       ①\nhttp://st.renren.com/\n(这个属于renren.com域,存在XSS漏洞) 　　　　　　　　　　　　　　　↓        ②\nhttp://www.renren.com/\n(这个属于renren.com域) 　　　　　　　　　　　　　　　↓        ③.\nhttp://webpager.renren.com/api/ime.jsp\n属于renren.com域　　　　　　　　　　　　　　　↓        ④.\nhttp://webpager.renren.com/api/getChatList?lt=15&st=0&type=0&roomId=874460788\n属于webpager.renren.com域--------------------------------------------------------------------------------------      10.因为document.domain 是可以设置自己本身域，还有基础域,也就是说        ①. \nhttp://st.renren.com/\n和\nhttp://www.renren.com/\n可以相互通信        ②.\nhttp://webpager.renren.com/api/ime.jsp\n和\nhttp://webpager.renren.com/api/getChatList?lt=15&st=0&type=0&roomId=874460788\n 可以相互通信        ③.又因为\nhttp://www.renren.com/\n和\nhttp://webpager.renren.com/api/ime.jsp\n可以相互通信        ④.换句话就是说， \nhttp://st.renren.com/\n和\nhttp://webpager.renren.com/api/getChatList?lt=15&st=0&type=0&roomId=874460788\n可以相互通信---------------------------------------------------------------------------------------------       11.自己的总结就是，\nhttp://st.renren.com/\n借助，\nhttp://www.renren.com/\n，再借助\nhttp://webpager.renren.com/api/ime.jsp\n和\nhttp://webpager.renren.com/api/getChatList?lt=15&st=0&type=0&roomId=874460788\n进行通信       12.所以，这种设计，\nhttp://st.renren.com/\n可以被绕过和\nhttp://webpager.renren.com/api/getChatList?lt=15&st=0&type=0&roomId=874460788\n通信----------------------------------------------------------------------------------------------       13.下面是测试截图,直接获取webpager.renren.com域的聊天内容了        ①.\n\n     漏洞证明：        1.漏洞证明你看上面     2.用偶像的话说，这个时候结果已经不重要了   修复方案：         1.域之间最好相互隔开，不然坑的是自己      2.我小白，你们比较厉害   版权声明：转载请注明来源 q601333824@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2016-02-01 17:37 厂商回复： 谢谢提醒，非常感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-02-01 17:47 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:269 漏洞数:56        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  凑齐了    \n     2016-02-26 10:38 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:269 漏洞数:56        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  方法就是借打电话给别人的例子，中转一下 举个例子就是：虽然A不信任C,但是B信任C,同时A信任B,那结果就是A间接信任C,这个就是例子只要这些条件凑齐就能bypass掉    \n     2016-02-26 11:05 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:269 漏洞数:56        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  --------------------------------------------------------------（分割线,别捣乱）投了简历，如果面试问这个，上面就是回答    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}