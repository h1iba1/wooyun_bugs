{"id": 52186, "wybug_id": "wooyun-2014-072033", "wybug_title": "建站之星( v2.7_build140505) sql注入一枚", "wybug_corp": "建站之星", "wybug_author": "roker", "wybug_date": "2014-08-12 18:55", "wybug_open_date": "2014-11-10 18:56", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-10：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： RT 详细说明：  mod_user.php\npublic function save_profile() {       $user_info =@ ParamHolder::get('user', array());\t   $extend_info=& ParamHolder::get('extends', array());        if (sizeof($user_info) <= 0) {            $this->assign('json', Toolkit::jsonERR(__('Missing user information!')));            return '_result';        }        $user_id = SessionHolder::get('user/id',0);        if (empty($user_id)){        \t$this->assign('json', Toolkit::jsonERR(__('Login first!')));        \treturn '_result';        }        $passwd_changed = false;        try {            $o_user = new User($user_id);\t\t\tif($o_user->s_role=='{admin}'){\t\t\t\t$this->assign('json', Toolkit::jsonERR(__('Role Error!')));\t\t\t\treturn '_result';\t\t\t}            if ($user_info['email'] != $o_user->email) {                /* Check duplicates */                if ($o_user->count(\"email=?\", array($user_info['email'])) > 0) {                    $this->assign('json', Toolkit::jsonERR(__('User E-mail address exists!')));                    return '_result';                }            }\t\t\t\t $custom_fields=array();\t\t $fields=  UserField::findAll2(\" showinlist='1' \",\" order by i_order\");\t    foreach($fields as $fieldinfo){\t\t\t$fieldname=\"field\".$fieldinfo['id'];\t\t\t$fieldtype=$fieldinfo['field_type'];\t\t\t$propname=$fieldinfo['label'];\t\t\t\t\t\t$isrequired=$fieldinfo['required'];\t\t\tif($isrequired=='1' && ($fieldtype == 0 && (!isset($user_info[$propname]) || UserField::trim($user_info[$propname])=='')\t\t\t\t\t\t\t||\t $fieldtype != 0 &&(!isset($extend_info[$fieldname]) ||UserField::trim($extend_info[$fieldname])==''))){\t\t\t\t$label=UserField::getUserDefineLabel($fieldinfo); \t\t\t\t$this->assign('json', Toolkit::jsonERR(__('The field cannot be empty!').\":{$label}\"));\t\t\t\treturn '_result';\t\t\t}else if($fieldtype != 0){\t\t\t\tif(isset($extend_info[$fieldname]) && UserField::trim($extend_info[$fieldname])!=''){\t\t\t\t\t $custom_fields[$fieldname] =$extend_info[$fieldname];\t\t\t\t}\t\t\t}\t\t}\t\t$user_info['params'] =json_encode($custom_fields);\t\t\t\t\t\t\t\t\t\t            $o_user->set($user_info);            /* Check password */            $passwd_info =@ ParamHolder::get('passwd', array());            if (sizeof($passwd_info) != 2) {                $this->assign('json', Toolkit::jsonERR(__('Invalid Password!')));                return '_result';            }            if (strlen(trim($passwd_info['passwd'])) > 0 ||                strlen(trim($passwd_info['re_passwd'])) > 0) {                if ($passwd_info['passwd'] == $passwd_info['re_passwd']) {                    $o_user->passwd = sha1($passwd_info['passwd']);                    $passwd_changed = true;                }            }            $o_user->save();        } catch (Exception $ex) {            $this->assign('json', Toolkit::jsonERR($ex->getMessage()));            return '_result';        }        if ($passwd_changed) {        \tSessionHolder::destroy();            $this->assign('json', Toolkit::jsonOK(array('forward' => 'index.php')));        } else {        \t$forward_url = Html::uriquery('mod_user', 'edit_profile');            $this->assign('json', Toolkit::jsonOK(array('forward' => $forward_url)));        }        return '_result';    }\n将post过来的数据循环带入了数据库，这个cms的 管理员和普通用户在一个表，判断权限的是s_role字段。我们注册用户，修改资料post数据。。添加参数\nuser%5Bs_role%5D={admin}\n即可成功提升到管理员权限。\n\n\n\n   漏洞证明：  \n\n\n\n   修复方案：  修复~么么哒   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-08-13 18:01 厂商回复： 补丁已经发布，请去官网更新补丁或下载最新安装包，谢谢。 最新状态： 2014-08-13：谢谢!  ", "replys": "漏洞评价：\n评论\n     2014-08-12 18:58 |    \t\t贫道来自河北 \t\t\t( 普通白帽子  |\t\t\t        Rank:1395 漏洞数:423        | 一个立志要把乌云集市变成零食店的男人)\t\t \n  大牛，你的漏洞好高产啊    \n     2014-08-12 19:13 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  这个不是大厂商么..0.0@xsser    \n     2014-08-12 19:15 |    \t\t贫道来自河北 \t\t\t( 普通白帽子  |\t\t\t        Rank:1395 漏洞数:423        | 一个立志要把乌云集市变成零食店的男人)\t\t \n  @roker 建站之星的漏洞我看过了，除了一个前台GETWEBshell是大厂商，其他都是小厂商    \n     2014-08-12 19:23 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  @贫道来自河北 0.0这样啊。。我看360那儿 Sitestar 在列表里。还以为是大厂商呢。。    \n     2014-08-12 19:24 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  @贫道来自河北 没你高产。。    \n     2014-08-12 19:54 |    \t\t贫道来自河北 \t\t\t( 普通白帽子  |\t\t\t        Rank:1395 漏洞数:423        | 一个立志要把乌云集市变成零食店的男人)\t\t \n  @roker 360那里也只有1000块，乌云的大厂商是2000呢    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}