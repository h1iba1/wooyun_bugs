{"id": 57473, "wybug_id": "wooyun-2014-054224", "wybug_title": "VeryIde Sql注入漏洞一枚", "wybug_corp": "veryide.com", "wybug_author": "′雨。", "wybug_date": "2014-03-21 17:10", "wybug_open_date": "2014-06-16 17:11", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-28：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-05-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-16：\t细节向公众公开  简要描述： 过滤不严。 详细说明：  \nfunction GetIP(){\tif(!empty($_SERVER[\"HTTP_CLIENT_IP\"])) $cip = $_SERVER[\"HTTP_CLIENT_IP\"];\telse if(!empty($_SERVER[\"HTTP_X_FORWARDED_FOR\"])) $cip = $_SERVER[\"HTTP_X_FORWARDED_FOR\"];\telse if(!empty($_SERVER[\"REMOTE_ADDR\"])) $cip = $_SERVER[\"REMOTE_ADDR\"];\telse $cip = \"\";\treturn $cip;}\n可伪造xff 且未过滤。。看看哪里调用了这个函数。\npublic static function admin_login( $username, $password ){\t\tglobal $_G;\t\t\t\t\tif( !$password || !$username ){\t\t\t\t\t\t//登录信息不能为空!                        \t\t\treturn -1;\t\t\t\t}elseif( $_G['setting']['global']['captcha'] == \"on\" && ( !$_SESSION['captcha'] || $_POST['captcha'] != $_SESSION['captcha'] ) ){\t\t\t\t\t\t//验证码输入错误!                        \t\t\treturn -2;\t\t\t\t}elseif( strlen($password) != 32 || !$_SESSION['RNDCODE'] || $_SESSION['RNDCODE'] != $_POST[\"rndcode\"] ){\t\t\t\t\t\t\t\t\t\t\t//写入安全日志\t\t\tself :: insert_event( \"login\",time(),time(),\"尝试登录系统时使用密码不符合规则：\".$password);\t\t\t\t\t\t//密码或随机验证输入错误!\t\t\treturn -3;\t\t\t\t\t\t}elseif( $_G['setting']['global'][\"ipzone\"] && !checkIP( explode(\"\\n\",$_G['setting']['global'][\"ipzone\"]) ,GetIP()) ){\t\t\t\t\t\t\t\t\t\t\t//写入安全日志\t\t\tself :: insert_event( \"login\",time(),time(),\"尝试登录系统时使用的IP不在允许的范围内：\".GetIP());\t\t\t\t\t\t//当前IP不在授权的范围!\t\t\treturn -4;\t\t\t\t\t\t}else{\n再继续看看哪里调用了这个。。switch ($action){ \n//登录\tcase \"login\":\t\t\t\t\t\t//连接数据库\t\tSystem :: connect();\t\t\t\t$username = getgpc(\"username\");\t\t$password = getgpc('password');\t\t\t\t$result = System :: admin_login( $username, $password );\n在登录的时候调用了。 来注入把。   漏洞证明：  \n\n注入成功。   修复方案：  过滤xff   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-06-16 17:11 厂商回复：  最新状态： 2014-03-29：抱歉，回复晚了。已经进行修正，谢谢 ′ 雨。  ", "replys": "漏洞评价：\n评论\n     2014-04-22 12:46 |    \t\t无名小卒 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 我不是黑阔，但我认识的全是黑阔！)\t\t \n  哈哈哈！    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}