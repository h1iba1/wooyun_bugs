{"id": 28019, "wybug_id": "wooyun-2015-0123784", "wybug_title": "同程旅游网邮箱伪造漏洞", "wybug_corp": "苏州同程旅游网络科技有限公司", "wybug_author": "Aerfa21", "wybug_date": "2015-07-01 09:58", "wybug_open_date": "2015-07-02 10:17", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-02：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 关于DNS配置不当的漏洞，在一波DNS域传送之后就渐渐冷却了。其实，关于DNS还可以有很多洞可以挖，比如spf参数配置不当，可劫持，然后伪造官方邮箱，然后.... 详细说明：  \n查询域名17usoft.com是否存在MX记录:nslookup -qt=mx 17usoft.com\n\n\n\n确定存在有MX记录即可以使用该域名服务器发送邮件，再查看是否配置得当\n\n\n\n对于熟悉DNS的大黑阔来讲，一眼就看出了猫腻，缺少spf参数。在这里也科普一下（因为之前在看大牛们提交的洞洞时有些内容太基础而不屑写出来，但是小菜们看不懂，于是我就想尽量让各个层次的人都能明白）\n\n科普：mx记录的作用是给寄信者指明某个域名的邮件服务器有哪些。\n\n科普：SPF是跟DNS相关的一项技术，它的内容写在DNS的txt类型的记录里面。SPF的作用跟mx相反，它向收信者表明，哪些邮件服务器是经过某个域名认可会发送邮件的。\n\n在本地搭建一个邮箱服务器，添加上域名17usoft.com，添加一个用户admin，发送给我的163邮箱，邮件内容自由发挥了\n\n\n   漏洞证明：  \n17u.com存在MX记录\n\n\n\nDNS配置不当：未配置spf参数，可导致邮箱劫持/邮箱伪造\n\n\n\n本地搭建邮箱服务器，添加域名17u.com，添加用户zxh（想必同程的人对这个邮箱熟悉吧）。发送邮件给163邮箱\n\n\n\n判断存在MX记录\n\n\n\nDNS参数spf未进行配置\n\n\n\n本地搭建邮箱服务器，添加域名17u.net，添加用户zhl（想必同程的人也对这个邮箱熟悉吧）。还是发送邮件给163邮箱\n\n\n\n\n\n判断存在MX记录\n\n\n\n未找到DNS参数spf\n\n\n\n本地搭建邮箱服务器，添加域名laidingba，添加用户zhl（想必同程的人也对这个邮箱熟悉吧）。还是发送邮件给163邮箱\n\n\n\n\n\n站长查出来的确叫同程接口站\n\n\n\n查看存在MX记录\n\n\n\n配置中缺少spf参数\n\n\n\n本地搭建邮箱服务器，添加域名tcent.cn，添加用户admin（想必同程的人也对这个邮箱熟悉吧）。还是发送邮件给163邮箱\n\n\n   修复方案：  关注安全，关注DNS健全   版权声明：转载请注明来源 Aerfa21@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-07-01 10:22 厂商回复： 感谢提交关注同程安全，通知IT进行修复！ 最新状态： 2015-07-02：这个之前内部提过，所以对外发送邮件的ly.com有spf记录，其他域名因为不对外就疏忽了，感谢洞主告之，IT已添加。  ", "replys": "漏洞评价：\n评论\n     2015-07-02 20:03 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @苏州同程旅游网络科技有限公司 这个漏洞早就回复里一带而过提醒你们了。。。 WooYun: 携程旅游网服务器配置不当可直接导致官方邮件劫持（邮件伪造与防识别原理）   倒数第二行    \n     2015-07-02 22:52 |    \t\tAerfa21 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:44        )\t\t \n  @黑暗游侠 我提交的时候确实没注意到你提交的洞。。    \n     2015-07-03 00:56 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @Aerfa21 没事的，漏洞没有谁的一说，大家一起研究网络安全。厂商不太重视而已。    \n     2015-07-04 09:16 |    \t\tAerfa21 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:44        )\t\t \n  @黑暗游侠 膜拜大牛    \n     2015-07-06 08:44 |    \t\tB1gstar \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:6        | 向各位学习来了。)\t\t \n  你在本地搭建邮件服务器的软件是啥？    \n     2015-07-06 08:47 |    \t\tAerfa21 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:44        )\t\t \n  Winmail    \n     2015-07-06 19:02 |    \t\tFrank_lee \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:2        | 努力学习安全知识)\t\t \n  @Aerfa21 学习了    \n     2015-07-07 14:59 |    \t\t小豹 \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:8        | 一个人的寂寞，整个群的错234236)\t\t \n  执行nslookup -qt=txt xxx.com显示v=spf1 include:spf.xxx.com -all楼主，这是啥意思啊？    \n     2015-07-07 18:48 |    \t\tAerfa21 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:44        )\t\t \n  这就是配置了spf，该域名指定了邮件服务器    \n     2015-07-07 18:48 |    \t\tAerfa21 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:44        )\t\t \n  @小豹 这就是配置了spf，该域名指定了邮件服务器    \n     2015-07-07 23:18 |    \t\t小豹 \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:8        | 一个人的寂寞，整个群的错234236)\t\t \n  @Aerfa21 哦哦，3q楼主    \n     2015-07-23 15:41 |    \t\tAerfa21 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:44        )\t\t \n  @苏州同程旅游网络科技有限公司 京东购物卡已充值，谢谢中国好厂商    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}