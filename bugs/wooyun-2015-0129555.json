{"id": 66537, "wybug_id": "wooyun-2015-0129555", "wybug_title": "中软华泰某防火墙产品设计不当可获取明文账号密码", "wybug_corp": "北京中软华泰信息技术有限责任公司", "wybug_author": "YY-2012", "wybug_date": "2015-07-29 10:46", "wybug_open_date": "2015-10-30 09:16", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-09-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-30：\t细节向公众公开  简要描述： rt 详细说明：  \"中软HuaTech-2000防火墙\"产品由于jinru.inc配置文件可直接访问，导致系统配置信息泄露。从配置文件中发现\"$filename=\"definition/temp/user.txt\";\"上面文件地址加上url访问，发现直接爆出明文管理员账号密码。吓尿了。。   漏洞证明：  配置文件jinru.inc可直接访问。\n<?$finalfilename=\"/usr/local/etc/ht-users\";$filename=\"definition/temp/user.txt\";$b=finaltotmp($finalfilename,$filename);function finaltotmp($finalfilename,$tmpfilename){\t$datas1=file($finalfilename);\t$fp=fopen($tmpfilename,\"w+\");\tfor ($i=0;$i<count($datas1);$i++ )\t{\t\t$datas1[$i]=($i+1).\";\".$datas1[$i];\t\tfputs($fp,$datas1[$i]);\t}\tfclose($fp);\treturn 1;}/*for ($i=0;$i<count($filename);$i++)\t{\t\t$a=explode(\";\",$filename[$i]);$pri=array(\"$a[3]\",\"$a[4]\");if($a[3]==0&&$a[4]==0)//$s=session_register($pri);*/session_register(\"sortt\");global  $username;$sortt=check_passwd($username,$password,$filename,$REMOTE_ADDR);`logger \"fwserver: $username;$REMOTE_ADDR;注册信息(ssl)\"`;function dectobin($str){  $data=explode(\".\",$str);  for($i=0;$i<count($data);$i++){    $temp=DecBin($data[$i]); //十进制变二进制    $long=8-strlen($temp);      for($j=0;$j<$long;$j++){  //二进制数不足8位补0      $temp=\"0\".$temp;       }    $new.=$temp;  //二进制  }  return $new;}function check_passwd($user,$pass,$filename,$client_ip){\t$users=file($filename);\tif($user==\"\")\t{\t\techo \"<script language=javascript>  \t\t\t\twindow.location='index.html';</script>\";\t\texit();\t\t\t\t}\t$j=0;\tfor ($i=0;$i<count($users);$i++)\t{\t\t$lines=explode(\";\",$users[$i]);\t\tif($user==$lines[1])\t\t{\t\t\t$user_s=$lines[1];\t\t\t$pass_s=$lines[2];\t\t\t$sortt=trim($lines[3]);\t\t\t$group=trim($lines[4]);\t\t\t$pri=array($sortt,$user_s);\t\t\t$ip = trim($lines[5]);\t\t\t$mask = trim($lines[6]);\t\t\t$j++;\t\t\t\t\t\t}\t}    $a=\"er.txt\";    $fp=fopen($a,\"w+\");    fputs($fp,$user);    fclose($fp);\tif($j==0)\t{\t\t`logger \"fwserver: $user;$client_ip;注册失败(ssl)\"`;\t\t\t\techo \"<script language=javascript> window.alert('没有这个用户');\t\t\t\twindow.location='index.html';</script>\";\t\texit();\t\t\t\t\t\t}\tif($pass<>$pass_s)\t{   `logger \"fwserver: $user;$client_ip;注册失败(ssl)\"`;\t\techo \"<script language=javascript> window.alert('密码输入错误');\t\t\t\thistory.go(-1);</script>\";\t\texit()\t;\t\t\t\t\t\t\t}//\techo \"$ip $mask $client_ip\";\t$ip_b = dectobin($ip);\t$mask_b = dectobin($mask);\t$client_ip_b = dectobin($client_ip);//\techo \"$ip_b $mask_b $client_ip_b\";\t$resulte1 = $ip_b & $mask_b;\t$resulte2 = $client_ip_b & $mask_b;\tif (strcmp($resulte1,$resulte2) != 0){\t\t`logger \"fwserver: $user;$client_ip;注册失败(ssl)\"`;\t\techo \"<script language=javascript> window.alert('您没有权限从 $client_ip 登录'); history.go(-1);</script>\";\t\texit()\t;\t\t\t\t}\tif($sortt==0)\t{ `logger \"fwserver: $user;$client_ip;注册成功(ssl)\"`;\t  echo \"<script language=javascript>window.location='index.php';</script>\";\texit()\t;\t\t\t\t\t}\t\treturn $sortt;\t\t}?>\n\n\n\n\n\n\n\n\n\n\n\n\n   修复方案：  限制访问inc文件等。   版权声明：转载请注明来源 YY-2012@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-08-01 09:15 厂商回复： cnvd确信并复现所述情况，已经由cnvd向软件生产厂商中软华泰公司技术部门邮箱通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}