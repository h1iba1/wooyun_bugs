{"id": 58541, "wybug_id": "wooyun-2014-050834", "wybug_title": "TCCMS （最新）8.0 后台GETSHELL （源码详析）", "wybug_corp": "teamcen.com", "wybug_author": "lxj616", "wybug_date": "2014-02-13 15:29", "wybug_open_date": "2014-05-11 15:30", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-23：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-11：\t细节向公众公开  简要描述： TCCMS 8.0 BBS版（目前官网最新）后台一处设计不当可GETSHELL 详细说明：  /app/admin/tempalate.class.php    line:79\npublic function Save() {\t\t$msgObj = new Msg();\t\t$path = ROOT_PATH . \"/templates/\" . Config::get(\"t_dir\");\t\t$fullPath = $path . \"/\" . $_POST[\"name\"];                //居然直接从POST里面取得文件名，虽然前台没有改文件名的地方，但是只要提供一个有效的post name 就可以上传任意文件了\t\t$handle = fopen($fullPath,\"w+\");\t\t$teamplateStr = StringUtil::teamplate_in(stripslashes($_POST[\"file_content\"]));\t\tfwrite($handle,$teamplateStr);\t\tfclose($handle);\t\t$msgObj->addMsg('success', Config::lang(\"TEAMPLATEMODIFYSUCCESS\"));\t\tStringUtil::goback();\t}\n进入 网站管理-模板管理\n\n随便点开一个模板（例子中是about.html）\n\n抓包点保存\n\n通过修改POST中的文件名上传php木马木马为about.php，就在原来html文件夹里面\n\n执行木马，echo 'hi'\n\n   漏洞证明：  进入 网站管理-模板管理\n\n随便点开一个模板（例子中是about.html）\n\n抓包点保存\n\n通过修改POST中的文件名上传php木马木马为about.php，就在原来html文件夹里面\n\n执行木马，echo 'hi'\n\n   修复方案：  修改 $fullPath = $path . \"/\" . $_POST[\"name\"];不允许用户控制文件名，至少硬性规定后缀名为html比如：$fullPath = $path . \"/\" . md5($_POST[\"name\"]).\".html\";   版权声明：转载请注明来源 lxj616@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-05-11 15:30 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-17 10:40 |    \t\t小贱人 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 资深菜鸟，)\t\t \n  mark    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}