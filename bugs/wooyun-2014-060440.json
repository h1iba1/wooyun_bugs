{"id": 2188, "wybug_id": "wooyun-2014-060440", "wybug_title": "大汉版通系统任意文件上传/删除漏洞", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "路人甲", "wybug_date": "2014-05-14 18:58", "wybug_open_date": "2014-08-12 19:00", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-17：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-12：\t细节向公众公开  简要描述： 大汉版通某系统存在多处任意文件上传/删除漏洞 详细说明：  一、漏洞代码文件上传：漏洞一：/xxgk/jcms_files/jcms1/web1/site/zfxxgk/ysqgk/attachupload.jsp漏洞二：/xxgk/jcms_files/jcms1/web1/site/zfxxgk/ysqgk/apply_attach_upload.jsp文件删除：上述两个文件同时存在任意文件删除漏洞先来看任意文件删除的代码：\nif(\"D\".equals(strBillStatus)) {\t\tdelFileName = filepath.substring(filepath.lastIndexOf(\"/\")+1,filepath.length());\t// 删除文件\tString strFilePath = strDictionary + \"/\"+delFileName;\tFile file = new File(strFilePath);\tif(file.exists() && file.isFile()) {\t\tfile.delete();}\n可以看出来，没有经过任何的过滤便进行了文件的删除操作，因而造成了任意文件删除漏洞。再来看任意文件上传代码：\nif(\"S\".equals(strBillStatus)) {\t\t\tif (bResult) {\t\t\t//上传文件名\t\tstrName = upload.getFileName();\t\t//文件大小\t\tlong nSize = upload.getFileSize();\t\t//文件名\t\tString strOldName = strDictionary + \"/\" + strName;\t\t//文件类型\t\tint nPot = strOldName.indexOf(\".\", strOldName.length() - 6);\t\tString strFileType = strOldName.substring(nPot + 1, strOldName.length());\t\tFile file1 = new File( strOldName );   \t\t\t\t\t//得到系统时间\t\tjava.util.Date current = new java.util.Date();\t\tjava.text.SimpleDateFormat formatter =  new java.text.SimpleDateFormat(\"yyMMddHHmmssSSS\");\t\tjava.text.SimpleDateFormat formatter1 =  new java.text.SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\t\t//新文件名=系统时间+原文件类型\t\tstrNewName = formatter.format(current)+\".\"+strFileType;\t\t\t\t\t\tFile newFile = new File(strDictionary + \"/\" + strNewName);\t\t//改文件名\t\tfile1.renameTo(newFile);\t\tfilepath = sessionPath + \"/\" + strNewName;\t\tfilename = strName;\t} //end if}\n这里上传的类File 对上传文件的后缀有一定的限制，但在Window下同样可以实现GETSHELL二、漏洞利用首先来看任意文件删除我们先上传任意的jpg文件，来测试删除漏洞，如下图\n\n点击删除后，抓包修改文件路径即可删除任意文件，考虑到删除任意文件有很大的危害性,这里不具体测试,如下图\n\n再来测试任意文件上传：首先上传一个正常的帮马图片，点击上传 抓包修改,如图\n\n我们知道\".\"在Windows下会被自动忽略，于是生成.jsp文件,如图\n\n   漏洞证明：  三、漏洞证明\n\n   修复方案：  过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-05-14 19:22 厂商回复： 感谢关注 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-18 10:20 |    \t\tLaiX \t\t\t( 普通白帽子  |\t\t\t        Rank:128 漏洞数:39        | 承接 建站、仿站、维护、反黑客、代码审计...)\t\t \n  路人甲你好，路人甲再见    \n     2014-08-12 19:21 |    \t\tMG小贱 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:3        | 本人只是一名高中生，个人比较喜欢研究安全...)\t\t \n  路人甲大神好    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}