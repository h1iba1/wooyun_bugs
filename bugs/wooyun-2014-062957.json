{"id": 1732, "wybug_id": "wooyun-2014-062957", "wybug_title": "CmsEasy最新版本无限制SQL注射", "wybug_corp": "cmseasy", "wybug_author": "blue", "wybug_date": "2014-05-31 11:46", "wybug_open_date": "2014-08-29 11:48", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "注射漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-29：\t细节向公众公开  简要描述： 版本号：CmsEasy 5_5_0_20140420_UTF8，SQL注射，程序员过于追求完美时，会忽略那些值得珍惜的人或事，比如女朋友（会有么?），比如这一处代码... 详细说明：  /lib/default/user_act.php  326行左右，及/lib/tool/front_class.php 541行左右，有对ip是否正确的判断：\nif(!preg_match('/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/', front::ip())&&!preg_match('@^\\s*((([0-9A-Fa-f]{1,4}:){7}(([0-9A-Fa-f]{1,4})|:))|(([0-9A-Fa-f]{1,4}:){6}(:|((25[0-5]|2[0-4]\\d|[01]?\\d{1,2})(\\.(25[0-5]|2[0-4]\\d|[01]?\\d{1,2})){3})|(:[0-9A-Fa-f]{1,4})))|(([0-9A-Fa-f]{1,4}:){5}((:((25[0-5]|2[0-4]\\d|[01]?\\d{1,2})(\\.(25[0-5]|2[0-4]\\d|[01]?\\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:){4}(:[0-9A-Fa-f]{1,4}){0,1}((:((25[0-5]|2[0-4]\\d|[01]?\\d{1,2})(\\.(25[0-5]|2[0-4]\\d|[01]?\\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:){3}(:[0-9A-Fa-f]{1,4}){0,2}((:((25[0-5]|2[0-4]\\d|[01]?\\d{1,2})(\\.(25[0-5]|2[0-4]\\d|[01]?\\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:){2}(:[0-9A-Fa-f]{1,4}){0,3}((:((25[0-5]|2[0-4]\\d|[01]?\\d{1,2})(\\.(25[0-5]|2[0-4]\\d|[01]?\\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(([0-9A-Fa-f]{1,4}:)(:[0-9A-Fa-f]{1,4}){0,4}((:((25[0-5]|2[0-4]\\d|[01]?\\d{1,2})(\\.(25[0-5]|2[0-4]\\d|[01]?\\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(:(:[0-9A-Fa-f]{1,4}){0,5}((:((25[0-5]|2[0-4]\\d|[01]?\\d{1,2})(\\.(25[0-5]|2[0-4]\\d|[01]?\\d{1,2})){3})?)|((:[0-9A-Fa-f]{1,4}){1,2})))|(((25[0-5]|2[0-4]\\d|[01]?\\d{1,2})(\\.(25[0-5]|2[0-4]\\d|[01]?\\d{1,2})){3})))(%.+)?\\s*$@', front::ip())){ //这位置写得太复杂了，好像很强大，我看到了(%.+)?，呃，%'不过可以注入引号了？                \texit('来源非法');                }\n而本程序的ip获取是有X-Forwarded-For 代理ip的测试了下程序，用户注册，游客投稿等都能注入，看漏洞证明截图   漏洞证明：  1. 用户注册注入X-Forwarded-For\n\n2. 登录看结果吧\n\n   修复方案：  在入库时统一addslashes最佳   版权声明：转载请注明来源 blue@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-05-31 19:03 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-31 11:52 |    \t\txcoder \t\t\t( 实习白帽子  |\t\t\t        Rank:59 漏洞数:9        | 一个世界有你，一个世界没有你，让两者的不...)\t\t \n  蓝哥啊，都放假了你都不让人家休息！    \n     2014-05-31 11:57 |    \t\tblue  \t\t\t( 普通白帽子  |\t\t\t        Rank:779 漏洞数:70        | 我心中有猛虎，细嗅蔷薇。)\t\t \n  @xcoder 程序员放假了能玩啥？你放假了能玩啥？    \n     2014-05-31 11:58 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  挖洞的blue过于专注代码，会忽略那些值得珍惜的人或事，比如女朋友（会有么?）    \n     2014-05-31 12:08 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  此处关注    \n     2014-05-31 12:08 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  我心中有猛虎，细嗅蔷薇 感觉这句话好美    \n     2014-05-31 12:08 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @phith0n 跟着师傅一起 默默关注。    \n     2014-05-31 12:26 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @′  雨。 @phith0n 跟着师傅一起 默默关注。    \n     2014-05-31 12:43 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  — —    \n     2014-05-31 14:13 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  @寂寞的瘦子 蓝哥结婚了    \n     2014-05-31 14:34 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  @只发通用型  一直很好奇你是谁的马甲！你妹，快说    \n     2014-05-31 14:36 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  @寂寞的瘦子 私信我，我告诉你    \n     2014-05-31 16:55 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  @梧桐雨 QAQ 还给不给人隐私了    \n     2014-06-04 15:25 |    \t\td0u \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 大道至简,衍化至繁)\t\t \n  这样的cms真心悲哀，都成洞主了    \n     2014-06-05 10:16 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  膜拜mark    \n     2014-08-29 12:50 |    \t\t刘海哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:114 漏洞数:28        | 索要联系方式但不送礼物的厂商定义为无良厂...)\t\t \n  mark    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}