{"id": 88470, "wybug_id": "wooyun-2016-0192841", "wybug_title": "Bypass阿里云盾、百度云加速、安全宝、安全狗、云锁、360主机卫士SQL注入防御                                      ", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "从容", "wybug_date": "2016-04-06 21:50", "wybug_open_date": "2016-07-07 19:00", "wybug_type": "非授权访问/认证绕过", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-11：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-06-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-07-07：\t细节向公众公开  简要描述： 安全只有相对，没有绝对。 详细说明：  Mysql在执行语句时，#注释将忽略掉\"当前行\"后面的所有语句，但是即使忽略了注释后面的语句，遇到换行的话还是会紧接注释之前的语句继续执行。\n\n再经过URL编码后为%23%0A\n\n   漏洞证明：  阿里云盾：\n\nBypass:\nhttps://**.**.**.**/ask/3689?spm=5176.100241.0.0.eViKRY?id=1%20union%23%0Aselect%20user%20from%20ddd\n\n\n百度云加速:\n\nBypass:\n\n安全宝:安全宝就比较有意思了，这个方法试了下不可行。\n\n再看看安全宝怎么检测的：\n\n只有union select不会被拦截。\n\n当union select后面加上查询字段的时候就会被拦截，所以可以不必在union与select之间使用这个方法。想了想，要是有方法配合%23%0A能绕过也可以啊，在union select%23与%0A之间做文章。各种能想到的方式都试了个遍，也许大家猜到了故事的开头，却没猜到故事的结局。。。想到了Emoji。。。(其实Emoji很久之前就想过了，但是一直没利用上，这回终于用上了。)\n\n一个emoji图标占5个字节，mysq也支持emoji的存储，在mysql下占四个字节：\n\n既然在查询的时候%23会忽略掉后面的，那么Emoji就可以插入到%23与%0A之间。\n\n再加多试了试，成功绕过了，200多个emoji图标，只能多，但少一个都不行。。。(这里暴露出一个bug，200多个emoji插入到code区域中时，发现emoji后面的内容全没了！！！也就是说我这后面是重写了两遍！！！所以截图吧。。。)\n\n可能会说，这是因为超长查询导致的绕过吧？并不是。\n\n这么长，mysql也是会执行的：\n\n\n\n安全狗：Windows Server 2008 + APACHE + PHP + Mysql\n\nBypass:\n\n云锁：Windows Server 2003 + APACHE + PHP + Mysql\n\n360主机卫士：和安全宝那个利用方式一样，也是需要结合emoji图标即可实现绕过注入防御。\n\nBypass:\n\n可能会想，知道创宇的加速乐忘了？没有啊。。。其实这个方法加速乐可以是可以，但是相对来说，利用起来很鸡肋。union select是绕过了，没法绕过后面的检测。\n\n\n\n   修复方案：  唉，写了半天。。。挨个通知修复过滤吧。。。   版权声明：转载请注明来源 从容@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-04-08 18:58 厂商回复： CNVD未直接复现所述情况，已由CNVD通过软件生产厂商公开联系渠道向其邮件和电话通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-06 21:51 |    \t\t: ) \t\t\t( 实习白帽子  |\t\t\t        Rank:67 漏洞数:10        | 知足常乐，心态要好)\t\t \n  前排留名。小白围观。    \n     2016-04-06 21:54 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1418 漏洞数:149        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  前排留名。小白围观。    \n     2016-04-06 21:55 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:259 漏洞数:96        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  前排留名。小白围观。    \n     2016-04-06 22:08 |    \t\tthewind \t\t\t( 普通白帽子  |\t\t\t        Rank:149 漏洞数:37        | 古道无仙···)\t\t \n  前排留名。小白围观。    \n     2016-04-06 22:10 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:265 漏洞数:33        | 开发真是日了狗了)\t\t \n  前排留名。小白围观。    \n     2016-04-06 22:13 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 别摸我，我怕热……  |  Tr3jer@Gmail.com ...)\t\t \n  妈的。。。重新编辑三次了！！！bypass的姿势一贴上来把后面的内容都截断了。。。    \n     2016-04-06 22:13 |    \t\ty1ngz1 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:5        | 一起交流，一起学习～  email:y1ng@jdsec.c...)\t\t \n  前排留名。小白围观。    \n     2016-04-06 22:18 |    \t\thuoji \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:17        | 目标是当个农民)\t\t \n  前排围观    \n     2016-04-06 22:19 |    \t\t孤梦° \t\t\t( 普通白帽子  |\t\t\t        Rank:151 漏洞数:52        )\t\t \n  前排留名。小白围观。    \n     2016-04-06 22:26 |    \t\tacai \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 请输入个人的简要介绍)\t\t \n  前排留名。小白围观。    \n     2016-04-06 22:57 |    \t\tFu地魔 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:8        | 无声无息)\t\t \n  小生路过    \n     2016-04-06 23:07 |    \t\t奈何彼岸 \t\t\t( 普通白帽子  |\t\t\t        Rank:140 漏洞数:49        | 乌云一下你就知道)\t\t \n  厉害啊    \n     2016-04-06 23:26 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 别摸我，我怕热……  |  Tr3jer@Gmail.com ...)\t\t \n  狗哥，重新编辑了@疯狗    \n     2016-04-06 23:46 |    \t\tphith0n  \t\t\t( 普通白帽子  |\t\t\t        Rank:834 漏洞数:127        | 一个想当文人的黑客~)\t\t \n  @从容 说起截断想起来wp那个utf-16，莫非是类似的字符    \n     2016-04-06 23:56 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 别摸我，我怕热……  |  Tr3jer@Gmail.com ...)\t\t \n  @phith0n 没错，不过只是在bypass安全宝和360主机卫士用到了    \n     2016-04-07 03:24 |    \t\t少宇 \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:20        | 所谓的江湖路，不过是，她道一句,初心勿忘,...)\t\t \n  老牛逼了，前排出售瓜子!    \n     2016-04-07 05:57 |    \t\t小白-x9 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:4        | 欢迎加入SaFeBug-专注于安全漏洞 官方群 56...)\t\t \n  前排围观    \n     2016-04-07 06:33 |    \t\twebhe4d \t\t\t( 普通白帽子  |\t\t\t        Rank:143 漏洞数:48        | 这世界上只有一种真正的英雄主义，就是在看...)\t\t \n  后排站位    \n     2016-04-07 07:00 |    \t\t高小厨  \t\t\t( 普通白帽子  |\t\t\t        Rank:998 漏洞数:91        | 不会吹牛的小二不是好厨子！)\t\t \n  表哥牛逼    \n     2016-04-07 07:50 |    \t\t暗香疏影 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:6        | 我感动哭了)\t\t \n  后排站位    \n     2016-04-07 08:18 |    \t\tVinc \t\t\t( 普通白帽子  |\t\t\t        Rank:383 漏洞数:58        | 提莫队长正在待命！)\t\t \n  关注    \n     2016-04-07 08:35 |    \t\t刘海哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:135 漏洞数:30        | 索要联系方式但不送礼物的厂商定义为无良厂...)\t\t \n  似乎在楼主的吐槽中好像知道了点什么。    \n     2016-04-07 09:01 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 别摸我，我怕热……  |  Tr3jer@Gmail.com ...)\t\t \n  @刘海哥 你牛逼    \n     2016-04-07 09:05 |    \t\t路人毛 \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:64        | 要想Rank给高，标题一定得屌)\t\t \n  此处应该有$    \n     2016-04-07 09:08 |    \t\tsangfor.org \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:26        | 天下熙熙，皆为利来；天下攘攘，皆为利往...)\t\t \n  此处应该打雷    \n     2016-04-07 09:12 |    \t\t安全狗(乌云厂商)\t\t \n  有意思，但愿你提交的这个没有场景要求，不然就鸡肋了。    \n     2016-04-07 09:25 |    \t\t骑虎打狗 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:9        | 我是中国式的 你懂得..)\t\t \n  看了这个帖子，我特别想知道洞主挑了哪一款...    \n     2016-04-07 09:38 |    \t\tsm0nk \t\t\t( 普通白帽子  |\t\t\t        Rank:174 漏洞数:30        | all is well)\t\t \n  666    \n     2016-04-07 09:43 |    \t\t带我玩 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:8        | 带我玩)\t\t \n  后排占座    \n     2016-04-07 09:45 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 别摸我，我怕热……  |  Tr3jer@Gmail.com ...)\t\t \n  @安全狗 没有    \n     2016-04-07 09:51 |    \t\t带我玩 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:8        | 带我玩)\t\t \n  @安全狗 你这是想拉近你的客户么?    \n     2016-04-07 10:51 |    \t\t安全宝(乌云厂商)\t\t \n  @从容 大牛求绕过细节    \n     2016-04-07 11:29 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1922 漏洞数:305        | 最近有人冒充该账号行骗，任何自称HackBrai...)\t\t \n  装逼成功    \n     2016-04-07 11:37 |    \t\t路人毛 \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:64        | 要想Rank给高，标题一定得屌)\t\t \n  安全狗跟安全宝是亲兄弟么？    \n     2016-04-07 13:02 |    \t\t紫霞仙子  \t\t\t( 普通白帽子  |\t\t\t        Rank:2302 漏洞数:307        | 没好团队，啥都干不成！！！)\t\t \n  额    \n     2016-04-07 15:10 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | ☯☯☯☯☯☯☯☯☯☯)\t\t \n  牛逼牛逼～。-    \n     2016-04-07 15:40 |    \t\twaht000 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:14        | 我还是太菜。。。)\t\t \n  膝盖收好    \n     2016-04-07 16:39 |    \t\tManning \t\t\t( 普通白帽子  |\t\t\t        Rank:1183 漏洞数:145        | https://github.com/manning23/MSpider)\t\t \n  心跳加速    \n     2016-04-07 20:00 |    \t\t采菇凉的小蘑菇 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 孩子不哭 站起来撸)\t\t \n  前排 围观 出售瓜子  饮料 花生米 买不起的手别碰啊    \n     2016-04-07 20:37 |    \t\t隐形人真忙 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:25        | ...)\t\t \n  这个绕过   sqlmap里有    \n     2016-04-07 20:41 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 别摸我，我怕热……  |  Tr3jer@Gmail.com ...)\t\t \n  @隐形人真忙 姿势1有，姿势2没有。    \n     2016-04-07 21:35 |    \t\t隐形人真忙 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:25        | ...)\t\t \n  @从容 万变不离qizong    \n     2016-04-07 21:38 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 别摸我，我怕热……  |  Tr3jer@Gmail.com ...)\t\t \n  @隐形人真忙 说的跟真事似的哈哈，    \n     2016-04-08 08:45 |    \t\t安全狗(乌云厂商)\t\t \n  @从容 没有过from，比较可惜    \n     2016-04-08 11:16 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 别摸我，我怕热……  |  Tr3jer@Gmail.com ...)\t\t \n  @安全狗 only safedog    \n     2016-04-08 13:15 |    \t\t懒懒滴1994 \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:25        | 偶尔是个乖乖仔，不作恶，世界从来没有安全...)\t\t \n  @从容 papapa    \n     2016-04-08 22:56 |    \t\tAgeloVito \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:6        | Just do what i love, enjoy it and try my...)\t\t \n  后排占位。小白围观。     \n     2016-04-09 06:50 |    \t\tautO_pw \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:25        | o_O``)\t\t \n  小白特地赶来围观。    \n     2016-04-11 21:17 |    \t\t灰灰灰阔 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:3        | 好好学习)\t\t \n  是    \n     2016-05-31 09:43 |    \t\t美食家L \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | http://bbs.404.so 和朋友一起开的论坛 .没...)\t\t \n  后排围观    \n     2016-06-12 19:08 |    \t\tHancock  \t\t\t( 普通白帽子  |\t\t\t        Rank:578 漏洞数:96        | ‮kcocnaH)\t\t \n  emoji....Omz    \n     2016-06-13 00:50 |    \t\tFireC@t \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | perl艺术家。)\t\t \n  23232223    \n     2016-06-13 01:45 |    \t\tniexinming \t\t\t( 普通白帽子  |\t\t\t        Rank:331 漏洞数:55        | 好好学习，天天日站)\t\t \n  师傅威武    \n     2016-06-13 15:58 |    \t\t乌云首席鉴黄师 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:6        | 这个人很懒，什么也没留下。)\t\t \n  围观    \n     2016-06-13 16:25 |    \t\t愚蠢的两脚兽 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:4        | 么么哒)\t\t \n  围观,太6    \n     2016-06-14 12:55 |    \t\tFSociety \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:3        | 即将毕业（失业）的迷茫。)\t\t \n  我就过来看看有多少人围观...    \n     2016-06-14 21:58 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1415 漏洞数:157        | 乌云核心菜鸟，此号长期由联盟托管，如果近...)\t\t \n  @从容 表情怎么输上去的？    \n     2016-06-16 11:06 |    \t\t立志成为厨神的男人 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:1        | 我饿了)\t\t \n  瓜子饮料方便面    \n     2016-06-16 14:16 |    \t\t醉入红尘梦 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:3        | 我白了)\t\t \n  级别不够，看来要找漏洞了    \n     2016-06-21 10:17 |    \t\tdragon110 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:6        | 其实我是龙6)\t\t \n  啥时候才能看到呐。。等吧。    \n     2016-06-28 00:41 |    \t\tEason13 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:75        | 你好，我是Eason)\t\t \n  emoji给跪了    \n     2016-06-28 09:41 |    \t\t美食家L \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | http://bbs.404.so 和朋友一起开的论坛 .没...)\t\t \n  提醒：级别足够但是无法查看 Rank 高于自己的白帽子漏洞 ( 可以等待进一步公开或者支付 5 个乌云币提前查看    \n     2016-06-29 10:25 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:401 漏洞数:74        | 小段子手)\t\t \n  emoji 都能用到这上面，在下佩服大神独特（猥琐）的思路。    \n     2016-07-01 15:26 |    \t\tHckmaple \t\t\t( 普通白帽子  |\t\t\t        Rank:289 漏洞数:67        | ~~~)\t\t \n  emoji表情没法粘贴到地址栏怎么办    \n     2016-07-01 15:33 |    \t\t❤ \t\t\t( 普通白帽子  |\t\t\t        Rank:283 漏洞数:74        | ❤)\t\t \n  @从容 win系统怎么把emoji符号打到浏览器里？    \n     2016-07-01 16:04 |    \t\t美食家L \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | http://bbs.404.so 和朋友一起开的论坛 .没...)\t\t \n  提醒：级别足够但是无法查看 Rank 高于自己的白帽子漏洞 ( 可以等待进一步公开或者支付 5 个乌云币提前查看   确定支付并查看 )    \n     2016-07-01 17:36 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:99        | 别摸我，我怕热……  |  Tr3jer@Gmail.com ...)\t\t \n  @Hckmaple @❤ urlencode    \n     2016-07-01 23:52 |    \t\t❤ \t\t\t( 普通白帽子  |\t\t\t        Rank:283 漏洞数:74        | ❤)\t\t \n  @从容 %F0%9F%98%83?这样?如:login.jsp?id=admin%20union%20select#%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%F0%9F%98%83%0Auser(),version()    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}