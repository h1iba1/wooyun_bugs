{"id": 15682, "wybug_id": "wooyun-2012-014230", "wybug_title": "万达电影网站的任意帐号密码重置漏洞", "wybug_corp": "大连万达集团股份有限公司", "wybug_author": "风萧萧", "wybug_date": "2012-11-02 15:59", "wybug_open_date": "2012-12-17 16:00", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-11-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-11-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-11-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-11-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-12-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-12-17：\t细节向公众公开  简要描述： 剑总，你信我么？ 详细说明：  1.万达电影网站的主站对密码重置这一模块，部署了强悍的验证码，因此这里是没有问题的！\n\n2.但是在给移动终端访问的站点http://m.wandafilm.com存在问题，没有部署验证码，可以通过爆破手机短信码（区别于图片验证码，这里称作短信码）从而重置任意帐号的密码，听我慢慢道来！首先打开移动终端的主站，点击【会员中心】\n\n3.如果你没有登录的话，会跳到登录界面，但是看到【忘记密码？】。我激动了：\n\n4.点她吧！输入要找回密码的手机号码，我这里为测试，使用了自己的：\n\n5.点击【获取验证码】，网站便跳转到了重置的页面同时手机上收到短信码，为6位纯数字：745233，我随手写个6位纯数字验证码111111，并填上需要重置的密码，点击提交，这里注意要抓包，查看请求：\n\n可以看到返回\"手机验证码错误\"的字样\n\n6.从抓包的数据看，POST的请求为：\nPOST /member/resetPassByToken.do HTTP/1.1Host: m.wandafilm.comProxy-Connection: keep-aliveContent-Length: 48Cache-Control: max-age=0Origin: http://m.wandafilm.comUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/22.0.1229.94 Safari/537.4Content-Type: application/x-www-form-urlencodedAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Referer: http://m.wandafilm.com/member/findPass.doAccept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3Cookie: cityCodeCookies=3774659600; JSESSIONID=EF648CCE0C1400944E9125F5ACAAD04C; __utma=81395784.778974478.1351818648.1351818648.1351837926.2; __utmb=81395784.33.10.1351837926; __utmc=81395784; __utmz=81395784.1351818648.1.1.utmcsr=wanda.cn|utmccn=(referral)|utmcmd=referral|utmcct=/group/jumpPage/hotel.shtml; Hm_lvt_12e233684b48dc67054644eaa9e278fc=1351818647992,1351819397061,1351837925819; Hm_lpvt_12e233684b48dc67054644eaa9e278fc=1351838684225mobileNo=手机号&token=111111&newPass=222222\n其中，mobileNo参数为手机号，token参数为短信码，newPass为需要重置的密码，那么只要token被猜测对了，只需一次请求即可重置相关手机号的密码：\n\n   漏洞证明：  7.继续模拟上述请求，将POST请求发送到burpsuite的intruder模块，设置好需要爆破的参数为token：\n\n8.由于只是测试，我这里从745200开始爆破，在爆破时如果token不正确则返回\"万达电影_系统忙\"的字样，并且从返回内容字数的多少也可以判断：\n\n9.成功爆破短信码后，系统会返回【万达电影移动_密码修改成功】的字样：\n\n10.后面利用爆破的账号密码成功登陆系统：\n\n\n\n   修复方案：  1.实际上在移动用户密码重置这里确实有一个小小的限制，短信码的有效期为5分钟，但是对真正的黑客来说这并不算什么！假设网速可以的情况下，每秒能进行一次爆破验证码的请求，那么10计算机并发1000个线程只需两分钟即可成功重置账号！2.短信码可以为6位纯数字，甚至可以缩短为4为纯数字；可以不设置图片验证码，甚至可以不用设置短信码的有效期。但是为什么不设置连续5次尝试失败就锁定本次密码重置的请求呢？   版权声明：转载请注明来源 风萧萧@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2012-11-02 16:35 厂商回复： 感谢风萧萧同学的关注与贡献！提供的信息完整全面，我们将尽快修复此漏洞。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-11-02 16:08 |    \t\tcnrstar \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:23        | Be my personal best!)\t\t \n  @江苏苏宁易购电子商务有限公司 终于？围观、    \n     2012-11-02 16:08 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  楼上注意身份    \n     2012-11-02 16:12 |    \t\tcnrstar \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:23        | Be my personal best!)\t\t \n  我成楼上了。    \n     2012-11-02 16:13 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  楼上的什么身份，自爆一下    \n     2012-11-02 16:15 |    \t\tcnrstar \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:23        | Be my personal best!)\t\t \n  @Rookie 楼上消失了。看@    \n     2012-11-02 16:22 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  求公开     \n     2012-11-02 16:32 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  貌似万达昨天进来就开始送礼物了    \n     2012-11-02 16:33 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @疯子 好人一生无洞    \n     2012-11-02 17:16 |    \t\t一刀终情 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:28        | ‮‮PKAV技术宅社区-安全爱好者)\t\t \n  @xsser 不能，人怎么也有几个洞的～好人也不能太特殊的    \n     2012-11-02 17:45 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  日，你们聊了这么多怎么就没人说信我呢！我还有支付漏洞你们信么？    \n     2012-11-02 17:50 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @风萧萧 求私信求公开    \n     2012-11-02 18:02 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  @风萧萧 我凑合信你一下吧    \n     2012-11-02 20:43 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @xsser 土豆网另一个存储型XSS，求通过呀求通过。。。    \n     2012-11-02 21:36 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @鬼魅羊羔 。。。    \n     2012-11-02 21:38 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @风萧萧 。。。是啥意思啊？求解释。。求安慰。。    \n     2012-11-02 22:33 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @鬼魅羊羔 剑总去把妹了，明天联系他吧    \n     2012-11-02 22:42 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @风萧萧 嗯嗯，把妹要紧，把妹要紧。。IT男很少有会把妹的，剑总威武。。。    \n     2012-12-04 15:56 |    \t\t小牟东 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 小菜菜)\t\t \n  前一阵貌似看到过类似的一个暴密码的，很是强大。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}