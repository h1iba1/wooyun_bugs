{"id": 47093, "wybug_id": "wooyun-2015-0116851", "wybug_title": "票友ERP网页版售票系统40多处注射漏洞打包（该系统可以导致泄露大量机票等用户敏感信息）", "wybug_corp": "票友软件", "wybug_author": "路人甲", "wybug_date": "2015-05-29 11:20", "wybug_open_date": "2015-09-06 00:00", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-06：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-06：\t细节向公众公开  简要描述： 44处注入；良心白帽子就不分开提交了，希望厂商能不能好好地从根源修复一下？乌云就喜欢我们这种打包的人，哎！不说了，真羡慕你们这些城里的人！ 详细说明：  来个首页吧~建议交由CNVD好好地转达给票友修复；维护客户利益;也希望厂商从代码根源去修复漏洞----记得某天晚上看到路人甲直接刷了一片票友的系统的漏洞，如果我没猜错的话，那些漏洞是一个ID为Er打头的小伙子提交的~后来这些漏洞被公开之后发现厂商的确对系统有做修复，但未对程序本身做修复，只不过是在程序内置增加了一些WAF机制，而且这个WAF机制仅仅对GET类型的数据传输做了处理，对于POST的完全没有进行处理！常规的SQL注入语句已经无法进行注入，而这些WAF机制却能够轻易地绕过，甚至连SQLMAP自动化注入工具也能够直接绕过进行注入。使用SQLMAP工具加载“space2comment.py”就可以直接绕过官方的WAF机制了；这程序员也太懒了吧，这WAF还不如一个安全狗；研究了一下票友ERP网页版的系统发现诸多的注入；这里列出44处乌云平台无重复的注入(27处GET型注入+17处POST型注入)；官方的介绍：\nhttp://www.pekpiaoyou.com/Internet.htm  票友ERP网页版\nSQL注入点：(与乌云现公开的无重复记录)\nGET类型(27处)：1、/Parmset/sms_mb_edit.aspx?id=2、/Sales/meb_edit.aspx?id= 3、/Sales/meb_his.aspx?id=4、/Other/hotel_edit.aspx?id=5、/Visa/visa_edit.aspx?id= 6、/Visa/gjqz_add.aspx?id=2147、/flight/Print_tp.aspx?sid=8、/flight/Print_tp_3.aspx?sid=9、/Other/train_order_detail.aspx?id=10、/flight/scgq_detail.aspx?id=11、/Finance/Inv_req.aspx?id=12、/flight/refund_update.aspx?id=13、/Json_db/flight_cycn.aspx?dtype=0&sdate=*             sdate参数存在注入14、/Other/Edit.aspx?id=15、/Json_db/flight_zhekou.aspx?sd=16、/flight/Html.aspx?id=17、/Finance/Invoice_detail.aspx?id=18、/Json_db/other_report.aspx?its=11&dfs=0&jq=0&sdate=   sdate参数存在注入19、/info/zclist_new.aspx?id=20、/Other/train_input.aspx?memberid=21、/Other/hotel_input.aspx?memberid= 22、/Other/input.aspx?memberid=23、/flight/Print_url_sel.aspx?id=24、/flight/Refund.aspx?id=25、/flight/Xcd_selected.aspx?id=26、/System/history.aspx?id= 27、/flight/scgq.aspx?id=POST类型注入(17处):28、/Finance/Chart_pie.aspx      生成图表时Post数据中的username参数存在注入29、/member/cardnum_rec.aspx     查询中POST中的meb参数存在注入30、/flight/hf_history.aspx      查询中POST中的keyword参数存在注入31、/bx/product.aspx             产品设置中POST中的product参数存在注入32、/Finance/bank.aspx           帐户设置中POST中的bank参数存在注入33、/Finance/other_cn.aspx       查询中POST中的kefu参数存在注入 34、/member/cjr.aspx             查询中POST中的key参数存在注入35、/Finance/Balance.aspx        生产报表中POST中的参数sdate存在注入36、/Finance/Deposit.aspx        查询中POST中的sdate参数存在注入37、/Finance/details.aspx        查询中POST中的sdate参数存在注入38、/Finance/Chart_money.aspx    生产图表中POST中的kefu参数存在注入39、/System/roles.aspx           新建角色中POST中的rolename参数存在注入40、/System/group.aspx           新建分组中POST中的bmname参数存在注入41、/System/history.aspx         查询中POST中的key参数存在注入42、/Parmset/city.aspx           查询中POST中的keyword参数存在注入43、/Parmset/km.aspx             查询中POST中的keyword参数存在注入44、/Sales/meb_top.aspx          排序中POST中的flag参数存在注入\nCase:(太晚了就不翻案例了，复制前人案例来吧)\nhttp://demo.piaoyou.org/ （官方demo）http://oa.ryxtrip.com/http://oa.cht-travel.com/http://py.4008836868.com/http://cz.4000211929.com/http://wh.4000211929.com/http://oa.starstrip.net/http://sdn.4000211929.com/http://oa.yccas.com/http://oa.wuzhouair.com/等等....\n   漏洞证明：  下面就是测试这44枚注入点了；不多说这些注入点找起来容易，测试起来证明截图就难了！所以说：“没有功劳也有苦劳啊！”先说一下这些票友系统是给哪些客户我也没仔细看，但是下面的测试都是简单的证明；并未获取任何敏感的数据，因为涉及到售票方面，甚至都没有读取表的名称；以下是随机案例的简单证明注入问题：\n第一处：/Parmset/sms_mb_edit.aspx?id=\n\n第二处：/Sales/meb_edit.aspx?id= \n\n\n\n第三处：/Sales/meb_his.aspx?id=\n\n\n\n第四处：/Other/hotel_edit.aspx?id=\n\n\n\n第五处:/Visa/visa_edit.aspx?id= \n\n\n\n第六处：/Visa/gjqz_add.aspx?id=214\n\n\n\n第七处：/flight/Print_tp.aspx?sid=\n\n\n\n第八处：/flight/Print_tp_3.aspx?sid=\n\n\n\n第九处：/Other/train_order_detail.aspx?id=\n\n\n\n第十处：/flight/scgq_detail.aspx?id=\n\n\n\n第十一处：/Finance/Inv_req.aspx?id=\n\n\n\n第十二处：/flight/refund_update.aspx?id=\n\n\n\n第十三处：/Json_db/flight_cycn.aspx?dtype=0&sdate=    sdate参数存在注入\n\n\n\n\n\n\n\n第十四处：/Other/Edit.aspx?id=\n\n\n\n第十五处：/Json_db/flight_zhekou.aspx?sd=\n\n\n\n\n\n\n\n第十六处：/flight/Html.aspx?id=\n\n\n\n第十七处：/Finance/Invoice_detail.aspx?id=\n\n\n\n第十八处：/Json_db/other_report.aspx?its=11&dfs=0&jq=0&sdate=       sdate参数存在注入\n\n\n\n\n\n\n\n第十九处：/info/zclist_new.aspx?id=\n\n\n\n第二十处：/Other/train_input.aspx?memberid=\n\n\n\n第二十一处：/Other/hotel_input.aspx?memberid= \n\n\n\n第二十二处：/Other/input.aspx?memberid=\n\n\n\n第二十三处：/flight/Print_url_sel.aspx?id=\n\n\n\n第二十四处：/flight/Refund.aspx?id=\n\n\n\n第二十五处：/flight/Xcd_selected.aspx?id=\n\n\n\n第二十六处:/System/history.aspx?id= \n\n\n\n第二十七处：/flight/scgq.aspx?id=\n\n\n\n第二十八处：/Finance/Chart_pie.aspx  生成图标时Post数据中的username参数存在注入\n\n\n\n\n\n\n\n第二十九处：/member/cardnum_rec.aspx  查询中POST中的meb参数存在注入\n\n\n\n第三十处：/flight/hf_history.aspx   查询中POST中的keyword参数存在注入\n\n\n\n第三十一处：/bx/product.aspx     产品设置中POST中的product参数存在注入\n\n\n\n第三十二处：/Finance/bank.aspx   帐户设置中POST中的bank参数存在注入\n\n\n\n第三十三处：/Finance/other_cn.aspx   查询中POST中的kefu参数存在注入\n\n\n\n第三十四处：/member/cjr.aspx     查询中POST中的key参数存在注入\n\n\n\n第三十五处：/Finance/Balance.aspx  生产报表中POST中的参数sdate存在注入\n\n\n\n\n\n\n\n第三十六处：/Finance/Deposit.aspx   查询中POST中的sdate参数存在注入\n\n\n\n\n\n\n\n第三十七处：/Finance/details.aspx   查询中POST中的sdate参数存在注入\n\n\n\n\n\n\n\n第三十八处：/Finance/Chart_money.aspx    生产图表中POST中的kefu参数存在注入\n\n\n\n\n\n\n\n第三十九处：/System/roles.aspx    新建角色中POST中的rolename参数存在注入\n\n\n\n第四十处：/System/group.aspx    新建分组中POST中的bmname参数存在注入\n\n\n\n第四十一处：/System/history.aspx   查询中POST中的key参数存在注入\n\n\n\n第四十二处：/Parmset/city.aspx   查询中POST中的keyword参数存在注入\n\n\n\n第四十三处：/Parmset/km.aspx     查询中POST中的keyword参数存在注入\n\n\n\n第四十四处：/Sales/meb_top.aspx   排序中POST中的flag参数存在注入\n\n\n\n\n证明证的累死了~厂商千万不要浪费我的劳动成果   修复方案：  厂商要是真的很懒得话，教你一招直接修复越权问题就好了~Rank20+总是要给的吧？别舍不得啊！   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-06-03 10:33 厂商回复： CNVD确认并复现所述情况,已经由CNVD按4月份获知的软件生产厂商邮件联系方式向其通报,涉及的案例较多,暂未能一一处置,已经向软件生产厂商说明. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-05-29 11:23 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  槽，这特么就是诈骗团伙的ATM好么！    \n     2015-05-29 11:28 |    \t\t冰海 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:7        | I can do better , why not ?)\t\t \n  良心白帽子就不分开提交了    \n     2015-05-29 11:33 |    \t\t小包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:100 漏洞数:19        | 关注技术与网络安全)\t\t \n  目测都已经重复的漏洞。。。    \n     2015-05-29 11:41 |    \t\t北京方便面  \t\t\t( 核心白帽子 |\t\t\t        Rank:876 漏洞数:66        | 我爱吃北京方便面)\t\t \n  良心白帽子    \n     2015-05-29 12:30 |    \t\tonly_admin \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:5        | ~~~~我只是个孩子╭(°A°`)╮~~~~)\t\t \n  @爱上平顶山 说你呢    \n     2015-05-29 12:35 |    \t\t冰海 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:7        | I can do better , why not ?)\t\t \n  我也是良心白帽，嘿嘿，要不 WooYun: 拉勾网某设计缺陷导致30000份儿童节礼物免费送 这30000礼物我就刷了 ^-^    \n     2015-05-29 12:39 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2738 漏洞数:547        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  @only_admin 不是一回事    \n     2015-05-29 12:39 |    \t\tonly_admin \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:5        | ~~~~我只是个孩子╭(°A°`)╮~~~~)\t\t \n  @冰海 送什么    \n     2015-05-29 14:02 |    \t\t冰海 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:7        | I can do better , why not ?)\t\t \n  @only_admin  有洗车券、酒店券、礼盒券、美甲券等5个种类。    \n     2015-05-29 14:11 |    \t\t孤零落叶寒 \t\t\t( 普通白帽子  |\t\t\t        Rank:162 漏洞数:26        | 今天的跌倒是是为了明天更好的站着)\t\t \n  真羡慕你们这些城里的人    \n     2015-05-29 15:13 |    \t\t冰海 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:7        | I can do better , why not ?)\t\t \n  @爱上平顶山 此平顶山 <=> 彼平顶山  ？俺想确认下恁是不是平顶山人 ^-^    \n     2015-05-29 16:19 |    \t\tbitcoin \t\t\t( 普通白帽子  |\t\t\t        Rank:715 漏洞数:218        | 学习是最好的投资！)\t\t \n  @疯狗 为什么我发的票友ERP网页版售票系统没有人审核呢？都一个月了。http://wooyun.org/bugs/wooyun-2015-0112092/trace/08ba281dc49d51219833e796e8674211http://wooyun.org/bugs/wooyun-2015-0112088/trace/1d45a35a653a031a96c20a33c2666838http://wooyun.org/bugs/wooyun-2015-0112064/trace/182bfdf2e376c878b87e4557211663ce    \n     2015-05-29 17:11 |    \t\t撸撸侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:250 漏洞数:26        | 我是撸撸侠)\t\t \n  @bitcoin 这样匿名的一个个刷 真的好么    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}