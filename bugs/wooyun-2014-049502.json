{"id": 4663, "wybug_id": "wooyun-2014-049502", "wybug_title": "Discuz! X3.1 刷分系列漏洞 #1", "wybug_corp": "Discuz!", "wybug_author": "Coxxs", "wybug_date": "2014-01-22 09:12", "wybug_open_date": "2014-04-22 09:13", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "低", "wybug_rank_0": "3", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-01-25：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-03-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-22：\t细节向公众公开  简要描述： Discuz!X最新版本（及部分旧版本所存在的刷分漏洞）今天论坛有个用户积分突然涨了特别多，一查日志，发现是以前在旧版发现的一个刷分洞。原本以为早就修复了，没想到还存在，那就提交上来吧。 详细说明：  在完成任务时（home.php?mod=draw&do=view&id=xx），任务先前的状态缺少判断完成任务的链接形如：\nhome.php?mod=draw&do=view&id=xx\n这个地址最终在 source\\class\\class_task.php 中被处理约第370行：\nfunction draw($id) {\tglobal $_G;\tif(!($this->task = C::t('common_task')->fetch_by_uid($_G['uid'], $id))) {\t\tshowmessage('task_nonexistence');\t} elseif($this->task['status'] != 0) {\t\tshowmessage('task_not_underway');\t} elseif($this->task['tasklimits'] && $this->task['achievers'] >= $this->task['tasklimits']) {\t\treturn -1;\t}......之后就是获得任务奖励了\n总觉得上面这一段少了些什么判断？我们对比下其他代码约第473行：\nfunction giveup($id) {\tglobal $_G;\tif($_GET['formhash'] != FORMHASH) {\t\tshowmessage('undefined_action');\t} elseif(!($this->task = C::t('common_task')->fetch_by_uid($_G['uid'], $id))) {\t\tshowmessage('task_nonexistence');\t} elseif($this->task['status'] != '0') {\t\tshowmessage('task_not_underway');\t}\n这一段是放弃任务的判断，我们看到如果 $this->task['status'] != '0',就是说任务没有开始的时候，是不能放弃任务的。但是，在上面那段获取任务奖励的代码中，并没有判断任务是否开始，造成了无需领取任务，就可以无限次数获取奖励。此漏洞还可以用于强行获取由于用户组不符，没有权限领取的任务的奖励。漏洞详细利用，请见漏洞证明。   漏洞证明：  1、新建一个任务，就选择红包类任务吧2、此时千万不要申请任务，而是进入任务详细页面（完成之后就不能刷了）\nhome.php?mod=task&do=view&id=2\n这样就能看到任务详情了，任务的奖励是 威望+1。我们把地址改为领取任务奖励\nhome.php?mod=task&do=draw&id=2\n打开这个地址，获得了 威望+1。不断刷新这个页面，即可不断获得奖励。   修复方案：  在 source\\class\\class_task.php 中的 draw 函数部分，加入任务是否领取的判断即加上\n...... elseif($this->task['status'] != '0') {\tshowmessage('task_not_underway');}\n这样，再次使用漏洞时，就会提示\n不是进行中的任务\n   版权声明：转载请注明来源 Coxxs@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-01-22 11:44 厂商回复： 谢谢。我们会尽快处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-01-22 09:18 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  RMB的节奏？？？    \n     2014-01-22 09:21 |    \t\tnauscript \t\t\t( 普通白帽子  |\t\t\t        Rank:291 漏洞数:57        | 我淫荡啊我淫荡)\t\t \n  哇靠 必须关注。。。。早点放出来让常年混迹于各个dz的本吊丝刷一下    \n     2014-01-22 10:19 |    \t\tCoxxs \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:8        | 节操数:233 | ww)\t\t \n  @Discuz 纠正一下：昨天发完漏洞，仔细看了下代码，发现不是没有作判断，只是因为程序升级，以前的判断失效了。上面的分析可以忽略了= =只需把 0 改为 '0' 即可修复    \n     2014-01-22 12:06 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  危害等级低。重点应用。这么说500块钱到手咯？    \n     2014-01-22 12:37 |    \t\tW3C3 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | wooyun.org)\t\t \n  是不是任务漏洞？ 如果论坛开启了任务功能，用户先是接取任务，然后等任务完成后领取任务的时候无限领取？ 这个BUG，在2013-5月份左右就存在了，当时的出现版本是7.0 到.2.5 现在X3的版本也有。    \n     2014-01-22 12:37 |    \t\tW3C3 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | wooyun.org)\t\t \n  @Coxxs 是这样么？    \n     2014-01-22 16:13 |    \t\tCoxxs \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:8        | 节操数:233 | ww)\t\t \n  @光刃 这类漏洞会有特别提示的，刷分的话也不到低危吧    \n     2014-01-22 16:15 |    \t\tCoxxs \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:8        | 节操数:233 | ww)\t\t \n  @W3C3 差不多。。但不是。。还有这个漏洞？    \n     2014-01-22 17:36 |    \t\tW3C3 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | wooyun.org)\t\t \n  @Coxxs 是的。你不知道么？    \n     2014-01-22 17:58 |    \t\tCoxxs \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:8        | 节操数:233 | ww)\t\t \n  @W3C3 我刚测试过了，领取的时候提示任务已经完成了。。 X3.1    \n     2014-01-22 18:08 |    \t\tW3C3 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | wooyun.org)\t\t \n  @Coxxs 你在discuz.net 搜索里面搜索 任务漏洞 四个大字就知道了反映此问题的最近两天的也有，早期的也有。其中一个帖传送门http://www.discuz.net/forum.php?mod=viewthread&tid=3200164    \n     2014-01-22 18:15 |    \t\tCoxxs \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:8        | 节操数:233 | ww)\t\t \n  @W3C3 嗯，看到了。似乎问题不少啊= =#    \n     2014-01-22 22:59 |    \t\tW3C3 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | wooyun.org)\t\t \n  @Coxxs 是啊，你是酷Q的作者？    \n     2014-02-28 17:42 |    \t\tCoxxs \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:8        | 节操数:233 | ww)\t\t \n  @Discuz! Discuz! X3.1 Release 20140301中，此bug依然未被修复    \n     2014-03-05 02:33 |    \t\tmOon \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 上线非本人，请勿打扰！)\t\t \n  How to Create a Log-» Click Here «-¿Cómo crear un registro?-» Click Aquí «-Support Chat / Chat de Soporte -» Click Here / Click Aquí «- discuz刷分漏洞      home.php?mod=task&do=view&id=2>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>How to Create a Log-» Click Here «-¿Cómo crear un registro?-» Click Aquí «-Support Chat / Chat de Soporte -» Click Here / Click Aquí «-     \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}