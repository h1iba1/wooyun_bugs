{"id": 41674, "wybug_id": "wooyun-2014-088043", "wybug_title": "phpems在线模拟考试系统 getshell", "wybug_corp": "phpems", "wybug_author": "Royal.", "wybug_date": "2014-12-25 17:01", "wybug_open_date": "2015-03-25 17:02", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-25：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-03-25：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： phpems 最新版本20141103http://phpems.net/forum/thread-441-1-1.html上传过滤不严导致任意文件上传。 详细说明：  phpems\\app\\document\\api.php\npublic function swfupload()\t{\t\t$path = 'files/attach/images/content/'.date('Ymd').'/';\t\t$fileurl = $this->files->uploadFile($this->ev->getFile('Filedata'),$path);\t\tif($this->ev->get('imgwidth') || $this->ev->get('imgheight'))\t\t{\t\t\tif($this->files->thumb($fileurl,$fileurl.'.png',$this->ev->get('imgwidth'),$this->ev->get('imgheight')))\t\t\t$thumb = $fileurl.'.png';\t\t\telse\t\t\t$thumb = $fileurl;\t\t}\t\telse\t\t$thumb = $fileurl;\t\texit(json_encode(array('thumb' => $thumb)));\t}\nphpems\\lib\\ev.cls.php\npublic function getFile($par)    {    \tif(isset($this->file[$par]))return $this->file[$par];    \telse return false;    }\nphpems\\lib\\files.cls.php\npublic function uploadFile($file,$updir,$sExtension = NULL,$name = NULL)\t{\t\tif(!$sExtension)$sExtension = $this->getFileExtName($file['name']);\t\tif(!$name)$name = time().rand(1000,9999);\t\tif(!file_exists($updir))$this->mdir($updir);\t\t$url = $updir.$name.'.'.$sExtension;\t\tif(file_exists($url))unlink($url);\t\tmove_uploaded_file( $file['tmp_name'], $url ) ;\t\tif (file_exists($url))\t\t{\t\t\t$oldumask = umask(0) ;\t\t\tchmod( $url, 0777 ) ;\t\t\tumask( $oldumask ) ;\t\t}\t\treturn $url;\t}\n后缀名未做任何检测和限制。直接上传php文件getshell。   漏洞证明：  1.注册账号，上传头像抓包。\n\n2.官方demo测试成功。\n\n   修复方案：  过滤。   版权声明：转载请注明来源 Royal.@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}