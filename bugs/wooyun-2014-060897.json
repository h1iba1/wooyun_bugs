{"id": 2247, "wybug_id": "wooyun-2014-060897", "wybug_title": "用友协作办公平台通杀SQL注入(续一)", "wybug_corp": "用友软件", "wybug_author": "路人甲", "wybug_date": "2014-05-15 18:12", "wybug_open_date": "2014-08-10 18:14", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入", "源码审计"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-20：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-10：\t细节向公众公开  简要描述： 用友协作办公平台某目录下存在多个通杀SQL注入，影响众多系统..Tips:几乎全部以最高权限运行(nt authority\\system).Ma Ya.. 详细说明：  #1 漏洞文件该系统的/sysform/目录下的多个文件存在SQL注入存在漏洞的的文件为(检查下，应该不止列出来的这些)\n/sysform/003/editflow_manager.jsp?option=2&GUID=1111/sysform/003/share_select.jsp?type=2&fid=111/sysform/004/addPlugin.jsp?ContainerId=111&flag=1/sysform/017/cardContent.jsp/sysform/994/464-1.jsp?oldtypeCur=11&SYS_CODE_KEY=1\n选择其中两个，贴下源代码/sysform/003/editflow_manager.jsp\n<%@page import=\"fe.dao.FieldSet\"%><%@page import=\"fe.dao.DataTable\"%><%@page import=\"fe.util.StringUtil\"%><%@page import=\"fe.dao.Dao\"%><%@ page language=\"java\" contentType=\"text/html; charset=utf-8\" pageEncoding=\"utf-8\"%><%@page import=\"fe.res.ResourceManage\"%><%@page import=\"fe.workflow.cooperation.CflowworkService\"%><%\t//Zero.lu 2012/08/03 修复已发协同/已发事项中，点击查看协同，加签后页面显示空白的BUG.  将原来的SUBMIT方式改为AJAX调用，并将删除节点从WF_INFOR表删除  begin\tString option = request.getParameter(\"option\");\tif (\"1\".equals(option)) {\t\t\t\t\t\t\t\tCflowworkService service = (CflowworkService)ResourceManage.getContext(\"cflowworkService\");\t\tString inforId = request.getParameter(\"inforId\");\t\tservice.editFlow(inforId);\t} else if (\"2\".equals(option)) {\t    String GUID = request.getParameter(\"GUID\");//获取参数GUID\t\tDao dao = (Dao)ResourceManage.getContext(\"basicDao\");\t\t//String sql = \"select WI13 from \" + dao.getTableName(\"WF_INFOR\") + \" where WI62=?\";\t\t\t\tString sql = \"select WI13 from \" + dao.getTableName(\"WF_INFOR\") + \" where WI62='\"+ GUID +\"'\";//带入了SQL查询\t\t\t\tString procType = dao.getStringData(sql);\t\tout.print(procType);\t}%>\n/sysform/003/share_select.jsp\n<%   String type=request.getParameter(\"type\");   if(\"2\".equals(type)){   String fid=request.getParameter(\"fid\");//接收参数   Dao dao=(Dao)ResourceManage.getContext(\"dao\");   String userId=dao.getStringData(\"SELECT COL_MDL_USERID FROM SYS_COLLABORATIVE_MOUDLE WHERE ID=\"+fid);//带入了SQL语句   User user=(User)ResourceManage.getRequest().getSession().getAttribute(\"User\");   String userID=\"\";   if(user!=null)userID=user.getUserID();   if(!userID.equals(userId))     out.print(\"<script>alert(\\\"该模板不允许被共享\\\");window.close();</script>\");   } %>\n由于漏洞的形成比较简单，就不多说，下面直接漏洞测试.#2 采用sqlmap进行测试由于网上有大量的实例，任意选取两个案例进行测试验证..下面测试一\nhttp://oa.kaili.net.cn:9090//sysform/003/editflow_manager.jsp?option=2&GUID=1111\n\n\n效果如图所示\n\n   漏洞证明：  接下来测试二\nhttp://oa.bnuz.edu.cn:8080/sysform/003/editflow_manager.jsp?option=2&GUID=1111\n\n\n效果如图所示\n\n#3跑出的数据\n\n均是以最高权限运行的 nt authority\\system\n\n   修复方案：  赶紧修复吧   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-08-10 18:14 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-15 18:58 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  我总觉得你就是那个。    \n     2014-05-15 20:46 |    \t\tGrayTrack \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:14        | 灰色轨迹)\t\t \n  @wefgod 近期路人甲老是提交那套系统。。。    \n     2014-05-16 10:38 |    \t\t1号马甲 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 我只吃素，谢谢)\t\t \n  用友协作，同一个漏洞被来回搞，那么多客户，传统软件厂商弱势尽显。。。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}