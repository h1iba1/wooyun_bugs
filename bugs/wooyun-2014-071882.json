{"id": 1167, "wybug_id": "wooyun-2014-071882", "wybug_title": "详解广发银行信用卡商城多处sql注入", "wybug_corp": "广发银行", "wybug_author": "白非白", "wybug_date": "2014-08-11 08:57", "wybug_open_date": "2014-09-25 08:58", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["字符类型注射", "数字类型注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-25：\t细节向公众公开  简要描述： http://www.wooyun.org/bugs/wooyun-2010-070595后记。 详细说明：  #1自上次无意发现了商城一个注入之后，直觉告诉我肯定存在其他漏洞。今天终于有时间，便顺手测试了一下。首先是找一找目标，随便用谷歌搜了一下：site:cgbchina.com.cn filetype:jsp在返回结果中随便打开几个带id的连接测试一下。\n\n看到链接https://shop.cgbchina.com.cn/CgbMall/jsp/brandQuery.jsp?gid=131&goods_price=中有个gid参数，用1=1尝试一下，结果返回，变量类型错误，看来没法注入了\nError 500: java.lang.NumberFormatException: For input string: \"131 and 1=1\"\n正要随手关掉这个页面时，发现了一个有意思的地方。\n\n输入价格0-300，查看网络请求，找到如下连接。\nhttps://shop.cgbchina.com.cn/BusinessCityWeb/ecity.do?func=queryClassFun&dom=<request><queryClass currpage=\"1\" rowspage=\"20\" sorttype=\"0\" brand=\"043\" goods_price=\"0|300\" goods_nm=\"\" color=\"\" type_pid=\"\" type_id=\"\" querytype=\"brandForColor\"/></request>\n测试发现goods_price参数可以注入。#2本来可以直接提交了，但是上一次提交只有16rank，不甘心。那么继续吧，仔细看一下连接中，除了goods_price，还有好几个带值参数，经过测试发现，brand也是可以注入的，分析如下图\n\n。#3这下可以提交乌云了，但是，wait。上一次注入是在积分商城，这一次注入是在分期购物。然而请求访问的文件是同一个，区别只是参数不一样，那么是不是只要找到其他的请求参数可以发现其他的注入点呢？其他的请求参数又应该到哪里去找?当然，如果是工具党，可以spider跑跑连接就出来了，很easy。但是，扫描器容易影响业务，毕竟是银行，还是手动找找吧。于是又回到google到的页面，发现了下面几个地方\n\n沿着这个思路，点了一下广发团。发现没有之前的搜索功能。但是发现了其他有意思的东西，如下图，后来证明确实又找到一个可以注入的参数typeid。\n\n   漏洞证明：  注入点：#1 参数goods_price 数字型注入\n\n\n\n#2 参数brand 字符型注入\n\n\n\n#3 参数typeid 字符型注入\n\n\n\n   修复方案：  1.过滤2.建议对https://shop.cgbchina.com.cn/BusinessCityWeb/ecity.do文件（不知道是文件还是什么，就是这个东西吧）做一次全面的检查，不要指哪补哪。   版权声明：转载请注明来源 白非白@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-08-11 10:57 厂商回复： 非常感谢您的报告。报告中的问题已确认并复现,典型的SQL注射漏洞，危害性大.影响的数据：高攻击成本：低造成影响：高综合评级为：高，rank：20正在联系相关网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-11 18:09 |    \t\t书生今天不吃饭 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 没人来过。。。。。)\t\t \n  前排卖瓜子 可乐 避孕套    \n     2014-08-13 16:35 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  这个发错了吧。怎么转到广东去了    \n     2014-08-13 16:39 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @cncert国家互联网应急中心 不晓得呀，上一次提交的平台也转给广东去了    \n     2014-08-13 16:51 |    \t\tDrizzle.Risk \t\t\t( 普通白帽子  |\t\t\t        Rank:255 漏洞数:19        | You have an error in your SQL syntax; ch...)\t\t \n  @cncert国家互联网应急中心  目测利害关系，你懂的    \n     2014-08-13 16:53 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @Drizzle.Risk 这个我真不懂。。。    \n     2014-09-25 10:49 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:189        )\t\t \n  屌啊 屌 啊 ！！！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}