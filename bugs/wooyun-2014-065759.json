{"id": 1218, "wybug_id": "wooyun-2014-065759", "wybug_title": "cmseasy最新版存储型XSS+代码分析（可绕过xss防护机制）", "wybug_corp": "cmseasy", "wybug_author": "roker", "wybug_date": "2014-06-24 16:36", "wybug_open_date": "2014-09-22 16:38", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-22：\t细节向公众公开  简要描述： cmseasy  5.5.0.20140605 详细说明：  bbs/ajax.php\n$data = array();      $_POST['content'] = unescape($_POST['content']);      $data['aid'] = isset($_POST['aid']) ? intval($_POST['aid']) : exit(0);      $data['tid'] = isset($_POST['tid']) ? intval($_POST['tid']) : 0;      $data['content'] = isset($_POST['content']) ? $_POST['content'] : exit(0);      $data['username'] = isset($_COOKIE['username']) ? $_COOKIE['username'] : '';      //$data['userid'] = $admin->userid;      $data['addtime'] = mktime();      $data['ip'] = $_SERVER['REMOTE_ADDR'];      $reply = db_bbs_reply::getInstance();      $r = $reply->inserData($data);      if($r){      \t  $archive = db_bbs_archive::getInstance();          $archive->updateClickReply($data['aid'],'replynum');......\n看到unescape 函数。\nfunction unescape($str) {\t$str = rawurldecode($str);\tpreg_match_all(\"/%u.{4}|&#x.{4};|&#d+;|.+/U\",$str,$r);\t$ar = $r[0];\tforeach($ar as $k=>$v){\t\tif(substr($v,0,2) == \"%u\"){\t\t\t$ar[$k] = iconv(\"UCS-2\",\"UTF-8\",pack(\"H4\",substr($v,-4)));\t\t}elseif(substr($v,0,3) == \"&#x\"){\t\t\t$ar[$k] = iconv(\"UCS-2\",\"UTF-8\",pack(\"H4\",substr($v,3,-1))); \t\t}elseif(substr($v,0,2) == \"&#\"){\t\t\t$ar[$k] = iconv(\"UCS-2\",\"UTF-8\",pack(\"n\",substr($v,2,-1)));\t\t}\t}\treturn join(\"\",$ar); }\n有了 rawurldecode所以提交 url格式编码数据。绕过remove_xss检测。再rawurldecode还原。即可xss列如 %3Cscript%3Ealert(1)%3C%2Fscript%3E\n\n\n\n   漏洞证明：  如上所诉   修复方案：  修复   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-06-24 18:26 厂商回复： 马上修正 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-24 16:43 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  说句话你不要打我 这不是重复了么？http://wooyun.org/bugs/wooyun-2010-063803    \n     2014-06-24 16:50 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @mramydnei 这俩不是同一个漏洞，当前漏洞利用更加自由随意些    \n     2014-06-24 16:51 |    \t\teval \t\t\t( 普通白帽子  |\t\t\t        Rank:131 漏洞数:23        | 专注小厂商五十年。)\t\t \n  @疯狗 管理员帮审下 我那几个。。。私信你了    \n     2014-06-24 17:03 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @疯狗 嗯，知道了    \n     2014-06-24 18:22 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  @mramydnei M老湿。。。。    \n     2014-06-24 18:25 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @roker 我不哭，我站着撸    \n     2014-06-24 22:11 |    \t\tzj1244 \t\t\t( 普通白帽子  |\t\t\t        Rank:273 漏洞数:33        | 小葵)\t\t \n  还是bbs？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}