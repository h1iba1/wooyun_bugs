{"id": 86855, "wybug_id": "wooyun-2016-0176035", "wybug_title": "傲游浏览器远程命令执行", "wybug_corp": "傲游", "wybug_author": "多多关照", "wybug_date": "2016-02-15 18:46", "wybug_open_date": "2016-05-19 15:30", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行", "浏览器漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-02-22：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-04-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-19：\t细节向公众公开  简要描述： 新年快乐 详细说明：  1. 首先是漏洞的背景，见 http://**.**.**.**/test/all/readme.htm由于漏洞具体利用成因，我已经在 http://**.**.**.**/bugs/wooyun-2010-0175902 里详细描述，此处不再多说。2. 这个小问题，会导致我们可以通过通过 location.href=\"vbefile:/../../../已知路径/1.js\"  的方式来调用wscript.exe \"vbefile:/../../../已知路径/1.js\" 也就是让系统的wscript来执行一个脚本文件。3. 这里采用浏览器的缓存机制来向本地写入恶意的缓存文件，再通过location.href=\"vbefile:/../../../缓存文件\"的方式来执行恶意缓存文件。首先是要得到缓存文件的路径：只要我们知道当前客户端用户名，就可以知道这个缓存目录的路径，c:/Users/用户名/AppData/Local/Temp/Maxthon3Cache/Temp/Webkit/Cache然后是缓存文件的文件名，文件名是在f_000000 -> f_ffffff 范围内依次递增。虽然 f_000000 -> f_ffffff 的范围看似很大，而实际上能被用到的范围却相对较小，本人常年在使用的chrome，cache目录里 f的最大值仅仅达到6万。4. 因此，在我们知道用户名的情况下，我们可以首先创建恶意的缓存文件到Cache目录下，然后通过location.href='vbefile:/../../../../../../../../../Users/用户名/AppData/Local/Temp/Maxthon3Cache/Temp/Webkit/Cache/缓存文件名\" //E:jscript /B \"';来执行缓存文件里的恶意代码。虽然我们并不知道缓存文件名，但是由于缓存文件名是递增的，这可以让我们进行暴力尝试执行。具体见利用代码。------------------------如何得到用户名？------------------------1. 找到一个傲游的XSS，傲游在新的版本，似乎加入了XSS的过滤功能? 不过这里还是可以绕过防护。http://**.**.**.**/security/safe/?url=http://**.**.**.**/?%3Cimg/src=%221%22/onerror=location=location.hash.slice(1)//#javascript:alert(1);void/**/0;2. 通过XSS，我们就可以获得Mx3data路径\nvar getPath=maxthon.system.Environment.getFolderPath('Mx3data');\n从路径里，可以得到用户名   漏洞证明：  win7, 开启UAC 或 WIN XP均可，  傲游v**.**.**.**0，漏洞前提：需浏览器默认安装到系统盘下，方可利用使用傲游访问测试地址【见测试代码部分】正在生成恶意缓存：\n\n暴力执行恶意缓存：\n\n   修复方案：  1. 在浏览器调用外部协议时，弹出交互提示，让用户选择是否继续，并给予重复的“安全警告”。2. 修复XSShttp://**.**.**.**/security/safe/?url=http://**.**.**.**/?%3Cimg/src=%221%22/onerror=location=location.hash.slice(1)//#javascript:alert(1);void/**/0;   版权声明：转载请注明来源 多多关照@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2016-02-19 15:21 厂商回复： 会在 4.9 修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-02-15 19:02 |    \t\t’‘Nome \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:31        | 有事请发邮件，2859857@gmail.com，垃圾邮...)\t\t \n  二哥    \n     2016-02-15 19:57 |    \t\t末影人 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:20        | 末影人(Enderman)是一个三个方格高的人形生...)\t\t \n  为什么要用小号发    \n     2016-02-15 20:02 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:244 漏洞数:91        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  为什么要用小号发    \n     2016-02-15 21:32 |    \t\thkcs \t\t\t( 实习白帽子  |\t\t\t        Rank:56 漏洞数:9        | 只是路过)\t\t \n  为什么要用小号发     \n     2016-02-15 22:44 |    \t\t番茄炒蛋 \t\t\t( 普通白帽子  |\t\t\t        Rank:187 漏洞数:50        | 这条路还很长，还需要更努力)\t\t \n  为什么要用小号发    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}