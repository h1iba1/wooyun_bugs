{"id": 2377, "wybug_id": "wooyun-2014-059965", "wybug_title": "逐浪cms SQL注入漏洞", "wybug_corp": "逐浪CMS", "wybug_author": "路人甲", "wybug_date": "2014-05-08 23:20", "wybug_open_date": "2014-08-06 23:22", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-06：\t细节向公众公开  简要描述： 逐浪最新版x1.5sql注入 详细说明：  地址\nhttp://demo.zoomla.cn/Customer.aspx\n源码如下\nprotected void Page_Load(object sender, EventArgs e){    if (base.Request.QueryString[\"type\"] != null)    {        if (base.Request.QueryString[\"type\"] == \"Seat\")        {            this.GetSeat();        }        if (base.Request.QueryString[\"type\"] == \"add\")        {            this.SetInfo(base.Request.Form.ToString());        }        bool flag1 = base.Request.QueryString[\"type\"] == \"answer\";        if ((base.Request.QueryString[\"type\"] == \"getservice\") && (base.Request.QueryString[\"uid\"] != null))        {            this.GetServerInfo(base.Request.QueryString[\"uid\"].ToString(), base.Request.Cookies[\"Provisional\"][\"Uid\"]); //跟进        }        if (base.Request.QueryString[\"type\"] == \"OnlineUsers\")        {            this.GetOnlineUsers();        }        bool flag2 = base.Request.QueryString[\"type\"] == \"CallMe\";        if (base.Request.QueryString[\"type\"] == \"msg\")        {            this.GetMsg(); //跟进        }        this.DelUser();    }}\n\nprivate void GetMsg(){    StringBuilder builder = new StringBuilder();    DataTable table = this.bcsbll.Select_Where(\" CS_Type=0 and CS_OID=\" + base.Request.Cookies[\"Provisional\"][\"Uid\"], \" DISTINCT CS_SendID,CS_SendName \", \"\"); //没处理存在注入    for (int i = 0; i < table.Rows.Count; i++)    {        builder.Append(string.Concat(new object[] { table.Rows[i][\"CS_SendID\"], \",\", table.Rows[i][\"CS_SendName\"], \";\" }));    }    string s = builder.ToString();    if (s.EndsWith(\";\"))    {        s = s.Substring(0, s.Length - 1);    }    base.Response.Write(s);}\n另一处\nprivate void GetServerInfo(string uid, string sessid){    DataTable customerByUid = this.bcsbll.GetCustomerByUid(DataConverter.CLng(uid), sessid); //跟进    StringBuilder builder = new StringBuilder();    if (!string.IsNullOrEmpty(uid) && !string.IsNullOrEmpty(sessid))    {        for (int i = 0; i < customerByUid.Rows.Count; i++)        {            if (((customerByUid.Rows[i][\"CS_OID\"] != null) && (sessid == customerByUid.Rows[i][\"CS_OID\"].ToString())) && (customerByUid.Rows[i][\"CS_SendID\"].ToString() == sessid))            {                builder.Append(string.Concat(new object[] { customerByUid.Rows[i][\"CS_AddTime\"], \"  你对\", customerByUid.Rows[i][\"CS_CtoName\"], \"说：<br />&nbsp;&nbsp;\", customerByUid.Rows[i][\"CS_Context\"], \"<br />\" }));            }            else            {                builder.Append(string.Concat(new object[] { customerByUid.Rows[i][\"CS_AddTime\"].ToString(), \"  \", customerByUid.Rows[i][\"CS_SendName\"], \"对你说：<br />&nbsp;&nbsp;\", customerByUid.Rows[i][\"CS_Context\"], \"<br />\" }));            }        }    }    base.Response.Write(builder.ToString());}\n \npublic DataTable GetCustomerByUid(int id, string sessid){    string strSQL = \"\";    if (id > 0)    {        string str2 = strSQL;        strSQL = str2 + \" (CS_SendID=\" + id.ToString() + \" or CS_Ctouid=\" + id.ToString() + \")\";    }    if (!string.IsNullOrEmpty(sessid))    {        strSQL = strSQL + \" and CS_OID='\" + sessid + \"'\"; //没处理存在注入    }    DataTable dt = this.SelectWhere(strSQL, \" CS_ID,CS_Context,CS_SendName,CS_SendID,CS_CtoName,CS_AddTime,CS_OID \", \" CS_AddTime asc\");    this.updateType(dt, id, sessid);    return dt;}\n    漏洞证明：  访问 \nhttp://demo.zoomla.cn/\n添加cookie值\n\n然后访问\nhttp://demo.zoomla.cn/Customer.aspx?type=msg\n\n\n或者访问\nhttp://demo.zoomla.cn/Customer.aspx?type=getservice&uid=1\ncookie构造如下\n\n   修复方案：  对cookie进行处理   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2014-05-09 08:14 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-08 23:23 |    \t\txlz0iza1 \t\t\t( 普通白帽子  |\t\t\t        Rank:1027 漏洞数:207        | \"><script/src=data:,alert(1)%2b\")\t\t \n  这是2000的节奏啊。    \n     2014-05-08 23:31 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  你们这是叫我继续翻我之前的代码出来吗    \n     2014-05-08 23:36 |    \t\txlz0iza1 \t\t\t( 普通白帽子  |\t\t\t        Rank:1027 漏洞数:207        | \"><script/src=data:,alert(1)%2b\")\t\t \n  @wefgod 嘿嘿~    \n     2014-05-08 23:49 |    \t\tLonely \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:27        | 人生如梦,始终都游不过当局者迷的悲哀。)\t\t \n  神奇的路人甲。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}