{"id": 31752, "wybug_id": "wooyun-2015-0113178", "wybug_title": "廊坊市人民检察院文件下载导致数据库泄露", "wybug_corp": "廊坊市人民检察院", "wybug_author": "小红猪", "wybug_date": "2015-05-22 17:31", "wybug_open_date": "2015-07-10 13:02", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-10：\t细节向公众公开  简要描述： 廊坊市人民检察院文件下载导致源码泄露风险，数据库，后台暴露。 详细说明：  域名：www.lfjcy.gov.cn正常的文件下载：http://www.lfjcy.gov.cn/activity/downLoad.php?fileName=/activity/upload/1404877864.docfileName的取值可发现，至少可访问到activity目录，故可下载到index.php、download.php等文件的源码，该站本身本身代码量小，很容易就可获取到整个php代码及数据库配置文件。下载downLoad.php：http://www.lfjcy.gov.cn/activity/downLoad.php?fileName=/activity/downLoad.php\n\n下载index.php文件：http://www.lfjcy.gov.cn/activity/downLoad.php?fileName=/activity/index.php\n\n可看到数据库连接文件：http://www.lfjcy.gov.cn/activity/downLoad.php?fileName=/activity/connect.php\n\n端口扫描发现3306对外开放：\n\n后台URL：http://www.lfjcy.gov.cn/activity/login.php登录：\n\n在后台可发布任意内容的新闻，而且有编辑器，这里就不试上传了，另外如果有绝对路径的话，通过数据库也可以拿到shell的。另外看了一下几个php文件，都未考虑到sql注入的问题：比如：ns.php：\n<?php include 'head.php'; ?>\t    <?php$id=$_GET[\"id\"];\t?> \t<?php $sql=\"SELECT * FROM ac1_news where id='\".$id.\"' \";$result = mysql_query($sql,$con);$row = mysql_fetch_array($result);$title=$row['title'];$cls=$row['cls'];$mes=$row['mes'];$fj=$row['fj']; ?>\n变量$id明显可注入。queryNews.php中的$cls变量也可注入：\n$cls=$_GET[\"c\"];// 获取当前页数if( isset($_GET['pageNo']) ){   $page = intval($_GET['pageNo']);}else{   $page = 1;} // 每页数量$page_size = 10; // 获取总数据量$sql = \"select count(*) as amount from ac1_news where cls='\".$cls.\"'\";$result = mysql_query($sql,$con);\n   漏洞证明：  参考详细说明处。   修复方案：  1）对fileName的取值范围进行严格限制，比如只允许访问特定的目录，其他目录都禁止访问，从权限上严格控制；   版权声明：转载请注明来源 小红猪@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-05-26 13:00 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT下发给河北分中心，由其后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}