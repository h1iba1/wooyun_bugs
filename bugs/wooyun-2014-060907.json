{"id": 2027, "wybug_id": "wooyun-2014-060907", "wybug_title": "74cms 逻辑漏洞导致sql注入2", "wybug_corp": "74c,s.com", "wybug_author": "menmen519", "wybug_date": "2014-05-19 17:11", "wybug_open_date": "2014-08-17 17:12", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "注射漏洞利用技巧", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向公众公开  简要描述： 74cms_v3.4.20140410逻辑漏洞导致sql注入 详细说明：  /include/fun_personal.php(346-373)\n$resume_work=get_resume_work($uid,$pid);\t\t$resume_training=get_resume_training($uid,$pid);\t\t$resume_photo=$resume_basic['photo_img'];\t\tif (!empty($resume_work))$percent=$percent+13;\t\tif (!empty($resume_training))$percent=$percent+13;\t\tif (!empty($resume_photo))$percent=$percent+14;\t\t$setsqlarr['complete']=1;\t\t$setsqlarr['complete_percent']=$percent;\t\trequire_once(QISHI_ROOT_PATH.'include/splitword.class.php');\t\t$sp = new SPWord();\t\t\t\t$setsqlarr['key']=$resume_basic['intention_jobs'].$resume_basic['recentjobs'].$resume_basic['specialty'];\t\t\t\techo $setsqlarr['key'].\"<br>\";\t\t$setsqlarr['key']=\"{$resume_basic['fullname']} \".$sp->extracttag($setsqlarr['key']);\t\t$setsqlarr['key']=str_replace(\",\",\" \",$resume_basic['intention_jobs']).\" {$setsqlarr['key']} {$resume_basic['education_cn']}\";\t\t$setsqlarr['key']=$sp->pad($setsqlarr['key']);\t\t\t\tif (!empty($resume_education))\t\t{\t\t\tforeach($resume_education as $li)\t\t\t{\t\t\t$setsqlarr['key']=\"{$li['school']} {$setsqlarr['key']} {$li['speciality']}\";\t\t\t}\t\t}\t\t$setsqlarr['refreshtime']=$timestamp;\t}\t\tupdatetable(table('resume'),$setsqlarr,\"uid='{$uid}' AND id='{$pid}'\");\n当执行到$resume_work=get_resume_work($uid,$pid); 然后执行到$setsqlarr['key']=$sp->pad($setsqlarr['key']);对此之前存入数据库的数据原封不动的获取出来，当数据流向updatetable(table('resume'),$setsqlarr,\"uid='{$uid}' AND id='{$pid}'\");故而触发sql注入漏洞具体发送请求如图所示：\n\n根据此逻辑过程，完全就变成一个最为普通的sql注入了，所以读者可以想干什么，就干什么   漏洞证明：     修复方案：  在get_resume_work这个函数返回时候做转义或者在$sp->pad函数返回时候做转义即可   版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-05-20 15:53 厂商回复： ok 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-19 17:14 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  两个洞的名字一样，是不是重复了？    \n     2014-05-19 17:16 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  @从容 不是    \n     2014-05-19 17:19 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  有点意思来一发    \n     2014-05-19 17:23 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  @Finger - -.    \n     2014-05-19 20:14 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  @从容 当然不一样了，我给最土团购 发了一个打包的sql注入，居然被忽略，想不通     \n     2014-05-19 20:16 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  @menmen519 正常，提交漏洞你得挑厂商- -.    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}