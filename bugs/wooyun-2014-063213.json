{"id": 54813, "wybug_id": "wooyun-2014-063213", "wybug_title": "Mallbuilder(多用户商城) 多枚注入点", "wybug_corp": "Mallbuilder", "wybug_author": "′雨。", "wybug_date": "2014-06-03 12:23", "wybug_open_date": "2014-09-01 12:28", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-03：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-09-01：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Check。 详细说明：  首先来看看全局文件\nfunction magic(){\tif(!get_magic_quotes_gpc()&&isset($_POST))\t{\t\tforeach($_POST as $key=>$v)\t\t{\t\t\tif(!is_array($v))\t\t\t\t$_POST[$key]=addslashes($v);\t\t\telse\t\t\t{\t\t\t\tforeach($v as $skey=>$sv)\t\t\t\t{\t\t\t\t\tif(!is_array($sv))\t\t\t\t\t\t$_POST[$key][$skey]=addslashes($sv);\t\t\t\t\telse\t\t\t\t\t{\t\t\t\t\t\tif($sssv)\t\t\t\t\t\t{\t\t\t\t\t\t\tforeach($sv as $sskey=>$ssv)\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\tif(!is_array($ssv))\t\t\t\t\t\t\t\t\t$_POST[$key][$skey][$sskey]=addslashes($ssv);\t\t\t\t\t\t\t\telse\t\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\tif($sssv)\t\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\tforeach($ssv as $ssskey=>$sssv)\t\t\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\tif(!is_array($sssv))\t\t\t\t\t\t\t\t\t\t\t\t$_POST[$key][$skey][$sskey][$ssskey]=addslashes($sssv);\t\t\t\t\t\t\t\t\t\t\telse\t\t\t\t\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\tif($sssv)\t\t\t\t\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\tforeach($sssv as $sssskey=>$ssssv)\t\t\t\t\t\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t$_POST[$key][$skey][$sskey][$ssskey][$sssskey]=addslashes($ssssv);\t\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t}\n 只对post进行了addslashes  没有对GET 等其他的进行addslashes但是对GET有一个小过滤。\nif(inject_check(implode('',$_GET)))\t{\t\tdie('Invalid URL !');\t}\n\nfunction inject_check($sql){ \treturn preg_match(\"/^select|insert|delete|\\.\\.\\/|\\.\\/|union|into|load_file|outfile/\", $sql);// 进行过滤   }\n这里匹配到了就退出 但是他这里没有开启/i 修正符所以大小写就可以绕过了。绕过了这里 GET的注入点就是一大堆了。   漏洞证明：  第一处在aboutus.php中http://web.com/mallbuilder/aboutus.php?type=asd' UNION SELECT 1,2,3,4,5,6,7%23二http://web.com/mallbuilder/help.php?type=asd'三http://web.com/mallbuilder/lostpass.php?md5=aa&userid=aa'还有很多 我就只贴这点了。\n\n   修复方案：  GET addslashes   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}