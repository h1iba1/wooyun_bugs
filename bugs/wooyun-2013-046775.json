{"id": 6191, "wybug_id": "wooyun-2013-046775", "wybug_title": "中国电信某核心业务监控平台沦陷引发内网信息泄漏", "wybug_corp": "中国电信", "wybug_author": "hacker@sina.cn", "wybug_date": "2013-12-23 11:33", "wybug_open_date": "2014-02-06 11:34", "wybug_type": "SQL注射漏洞", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["弱口令", "注入漏洞"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-01-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-01-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-01-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-02-06：\t细节向公众公开  简要描述： 为了感谢电信的节前礼物，特意在节前挖了点漏洞送你们，是不是很没节操？工程师蛋碎了有木有？呵呵呵呵呵 详细说明：  这套系统隶属21CN技术总部，作为邮箱系统的监控平台而存在。电信大内网10.62段，负责监控189邮箱系统、21CN邮箱系统、BNET网等。自我判断所有邮箱系统核心业务段都是其负责监控。做监控的主机有什么危害？他能监控别人，就意味着几乎可以不受限制的访问对方，这就是一个最佳跳板！很少管理员会想去做监控主机的ACL脆弱点：1.Ipswitch WhatsUp Gold监控平台默认口令 admin/admin2.SA权限SQL注入可执行任意系统命令3.敏感信息泄漏第一个就不说了，安全意识问题，其中SQL注入这个问题完全是人为原因导致,本来也没什么，这套系统自身很安全，而且只把WEB管理端的端口映射了出来，虽然有默认管理口令，也顶多看看内网的IP地址主机名什么的，因为电信监控架构的原因，实质上这个监控平台只是依靠PING做一些网路连通性检测，没有部署其他操作执行的权限，至此危害并不大。但工程师可能觉得看着英文界面不爽 还是操作麻烦怎么滴，自己写了一个业务状态统合统计页面。这就坑爹了，就是这个页面参数没过滤，直接导致了SA权注入，这套享誉业界的Whatsup监控系统默认会安装MSSQL组件作为默认存储数据库，默认帐号就是SA用户，可见当初安装时并未做降权处理而是直接采用了默认配置。上个月发现这个点的时候，脑抽了一阵，本来可以速战速决的，但是不知当时是怎么的，愣是以为这台机器只映射出来个管理端口，自身无法联网。好像当时是执行了个telnet 测试到我VPS的nc监听端口没出来,要不然直接种个后门反弹出来。接着暴不到网站路径，用master..xp_cmdshell 写猜的c:\\inetpub\\wwwroot\\1.asp也访问不到(因为网站不是这个路径)。注入点无法用工具跑，没法列目录什么的(后来看到asp文件里的SQL语句我都哭了)。呵呵呵 当时我都放弃了 嫌麻烦。因为也不知道这东西有什么价值，要不是电信这几天送我礼物我都想不起来。18号接到CNVD的信后，一下子心情就不一样了，好像终于见到回头钱了一样。逐决定把这些以前没心思看的重新捡起来试试。其实当时的测试是非常不严谨的，毕竟测试系统是否能联网的方式有很多种，telnet、ftp、一句话wget.vbs什么的 ,我当时只采取了第一种方式，所以这次本也以为他无法外连的(惯性思维了 啪>_<#!)，就去找了Ipswitch的破解版拉到本地安装了一番（几百兆啊我去！网通2M小水管下了半天啊有木有！！）。找到了如下信息：默认SA口令：WhatsUp_Gold默认管理员：admin/admin默认安装后的网站路径：C:\\Program Files\\Ipswitch\\WhatsUp\\HTML知道路径后开始尝试echo一句话到C:\\Program Files\\Ipswitch\\WhatsUp\\HTML\\1.asp,访问404 玻璃心都碎了有木有。然后开始猛击键盘泄愤，敲着敲着蹦出来个D:\\Program Files\\Ipswitch\\WhatsUp\\HTML\\1.asp，瞬间脑抽痊愈，路径正确，访问成功。 果然管理员是把监控装在了D盘，可能觉得系统盘不好吧？呵呵呵，其实我特别不理解一块硬盘或作了RAID的情况，然后觉得C盘东西多影响系统速度的思维。以前搞外国人的网站人家什么都装C盘里 呵呵呵。拿到shell抓了下密码管理，发现内网一些WIN服务器可登录哦！其中一台主机名为：YT-VPN2 呵呵呵，这什么节奏？我没细看了。这要做测评肯定不合规，呵呵呵，口令怎么能通用呢。c段开放3389端口的机器：10.62.13.18 监控本机10.62.13.19 YT-VPN210.62.13.5010.62.13.53接下来讲讲敏感信息泄漏的事儿：访问网站点击右侧的“监控点清单”直接列出来所有监控目标项目了，不觉得这很坑爹么？连后台都不用登录。http://121.14.53.189:58000/MonitorList.asp连检测脚本也可以看到，有的服务测试帐号密码也可见呦http://121.14.53.189:58000/MonitorCheckScriptList.asp回到服务器上，翻目录发现D盘有个“中国电信集团电子邮件和网络存储系统设备信息统计.xls” 这个文档其实是被加密了，管理员还是有点安全意识的，可没人告诉过他这种97式office的打开密码可以被移除么？赶紧换xlsx的ASE加密吧，咳咳咳。轻松用Office Password Recovery Toolbox移除，里面就是如图所示的全网IP地址列表了，呵呵呵。这种东西都不应该放在服务器上，应该只放在网管机器上。不符规定。这个表我截图完就删了，留着也没用，只是为了说明这种加密不安全。全篇写了那么长的废话是因为自己2货了一把，很鄙视自己啊，唉。果然做事情要认真细致才能少走弯路啊。不过意外的还是完成了既定目的，这说明，持之以恒也是很重要的，嗯 信心很重要。不抛弃不放弃。最后把工程师写的SQL语句贴出来与君共勉：\ndatasql=\"Exec whatsup.dbo.p_DeviceDetailsData\" + nDeviceID\n我说我怎么读不出来数据呢，坑死爹了。研究了半天语法、绕过、闭合这那的。总提示and 附近语法错误 呵呵呵呵。   漏洞证明：  后台默认口令：http://121.14.53.189:58000/NmConsole/CoreNm/User/DlgUserLogin/DlgUserLogin.aspadmin/adminSA注入点命令执行：\nhttp://121.14.53.189:58000/devicedetails.asp?nDeviceID=170;exec%20master..xp_cmdshell%20\"ipconfig /all>d:\\Progra~1\\Ipswitch\\WhatsUp\\HTML\\NmConsole\\1.txt\";--\n主机名：21cn-yt-whatsup内网IP：10.62.13.18管理员：Administrator管理密码：!@#$&*()   备注：这个密码是键位顺序密码，太短，也不好，容易被破解，服务器密码建议至少14位以上。主机是2003企业版sp1 几乎没打补丁，这个习惯很不好，就算不是SA，db导出个ASP上去也能提权有木有？监控项目列表(具体IP没截图，每个组里一堆机器)：\n\n内部IP列表:\n\n检测脚本敏感信息：\n\n监控列表IP泄漏：\n\n   修复方案：  为何极2跟极1一个价，电信发我们极1呢？还有 我一直觉得 黑色比较酷！适合黑客群体诶！银色略屌。   版权声明：转载请注明来源 hacker@sina.cn@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-12-27 20:47 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT紧急向中国电信集团公司通报。对于白帽子，也请注意控制非授权测试风险。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-12-23 11:37 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  坑，有一张图不对劲！怎么还重复了，还有 那几张很小的图怎么变这么大，这更坑了！ 我找的图都是很小的啊。    \n     2013-12-23 11:40 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  重新编辑了漏洞，补了最后一张错图，删掉了显示难看的表情图， 求重新审核 @xsser    \n     2013-12-23 11:44 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  这个为啥不在首页呢 呵呵    \n     2013-12-27 22:40 |    \t\t剑无名 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:32        | 此剑无名。)\t\t \n  @hacker@sina.cn 对于白帽子，也请注意控制非授权测试风险    \n     2013-12-28 06:59 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  @剑无名 这句话警示我们做事不带套 是要对自己种下的果负责任的。对于有文化的软妹，尺度很重要，人家不喜欢被强攻内射。    \n     2014-02-06 12:20 |    \t\t有点小鸡冻 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        )\t\t \n  厂商无节操的回复亮了 呵呵    \n     2014-02-06 13:38 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  厂商的意思是 下次注意开VPN！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}