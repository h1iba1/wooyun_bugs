{"id": 36843, "wybug_id": "wooyun-2015-0100994", "wybug_title": "PHPEMS一处SQL注入漏洞", "wybug_corp": "PHPEMS", "wybug_author": "路人甲", "wybug_date": "2015-03-13 10:21", "wybug_open_date": "2015-04-30 18:48", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-13：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-04-30：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： PHPEMS一处SQL注入漏洞 详细说明：  10. Phpems某处存在SQL注入漏洞存在注入漏洞的代码位于/app/exam/phone.php的favor()函数中在这个函数中具体位置如下1029行往下if($search['knowsid'])$args[] = \"quest2knows.qkknowsid IN ({$search['knowsid']})\";\t\t\tif($type)\t\t\t{\t\t\t\tif($search['questype'])$args[] = \"questionrows.qrtype = '{$search['questype']}'\";\t\t\t\t$favors = $this->favor->getFavorListByUserid($page,20,$args,1);\t\t\t}\t\t\telse\t\t\t{\t\t\t\tif($search['questype'])$args[] = \"questions.questiontype = '{$search['questype']}'\";\t\t\t\t$favors = $this->favor->getFavorListByUserid($page,20,$args);\t\t\t}我们看到$search['knowsid']没有经过任何过滤就参与到数据库语句的组合中再往前追溯$search = $this->ev->get('search');可以看到$search是可以被完全控制的，因而导致了SQL注入的发生验证过程，注册用户，登录之访问链接：localhost/ems/index.php?exam-phone-favor&search[knowsid]=1,updatexml(1,user(),1)\n\nOK验证没有问题好吧，这10个漏洞弄完了，友情提示：teach.php中依旧存在大致5个SQL注入漏洞，自己研究吧，不然都发了。。。TT   漏洞证明：  验证过程，注册用户，登录之访问链接：localhost/ems/index.php?exam-phone-favor&search[knowsid]=1,updatexml(1,user(),1)\n\nOK验证没有问题   修复方案：  严格过滤参数吧   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}