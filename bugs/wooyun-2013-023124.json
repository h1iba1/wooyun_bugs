{"id": 10973, "wybug_id": "wooyun-2013-023124", "wybug_title": "ecsho后台任意用户可以下载整站源码", "wybug_corp": "ShopEx", "wybug_author": "齐迹", "wybug_date": "2013-05-05 17:01", "wybug_open_date": "2013-08-03 17:02", "wybug_type": "任意文件遍历/下载", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取利用", "文件操作参数未加过滤"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-05-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-05-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-05-08：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-06-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-07-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-07-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-03：\t细节向公众公开  简要描述： ecshop(2.5以上版本全部存在)只要有后台帐号即可下载整站源码 详细说明：  PS:默认安装如果选择了安装测试数据就会多出2个帐号。本文从这两个帐号开始！这个漏洞存在ec2.5以上的所有版本中漏洞发生在admin/template.php 行575 模版备份处\nif ($_REQUEST['act'] == 'backup'){    include_once('includes/cls_phpzip.php');    $tpl = trim($_REQUEST['tpl_name']);    $filename = '../temp/backup/' . $tpl . '_' . date('Ymd') . '.zip';    $zip = new PHPZip;    $done = $zip->zip('../themes/' . $tpl . '/', $filename);    if ($done)    {        make_json_result($filename);    }    else    {        make_json_error($_LANG['backup_failed']);    }}\n问题1这里没有检查当前用户是否有权限操作问题2没有对参数tpl_name进行过滤和限制导致问题的产生。   漏洞证明：  访问备份地址和要备份的目录\n\n备份成功的时候可以看到备份成功的地址 进行下载\n\n打开看看正常与否\n\n   修复方案：  加强权限检查 以及对参数的过滤！最后附带一个小要求。我本来是ec论坛的超级版主，可惜帐号疑是被盗导致封号。。。。由于是超级版主无法找回密码。。。求解封，然后去掉我的版主身份让我可以找回密码！多谢！帐号：齐迹   版权声明：转载请注明来源 齐迹@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2013-05-05 21:18 厂商回复： 感谢您为shopex安全做的贡献我们将尽快修复非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-05-05 17:09 |    \t\tmomo \t\t\t( 实习白帽子  |\t\t\t        Rank:91 漏洞数:24        | ★精华漏洞数:24 | WooYun认证√)\t\t \n  - -、    \n     2013-05-05 17:52 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  这就开始了？    \n     2013-05-05 18:42 |    \t\twszf \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:3        | 打酱油)\t\t \n  好屌啊    \n     2013-05-05 19:28 |    \t\t杀戮 \t\t\t( 普通白帽子  |\t\t\t        Rank:141 漏洞数:19        | 我，是来打酱油的。)\t\t \n  无语 ECShop本来就开源    \n     2013-05-05 19:39 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  @杀戮 假如网站有备份过数据。。。那么你懂的！    \n     2013-05-05 19:42 |    \t\t杀戮 \t\t\t( 普通白帽子  |\t\t\t        Rank:141 漏洞数:19        | 我，是来打酱油的。)\t\t \n  @齐迹 好吧    \n     2013-05-05 20:24 |    \t\tcnrstar \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:23        | Be my personal best!)\t\t \n  不过得登录才可以。。不登录就能下更好    \n     2013-05-05 21:48 |    \t\tdocall \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 帅哥十枚)\t\t \n  @齐迹 对，尤其是后台多用户的时候，好东西，求细节    \n     2013-05-05 22:12 |    \t\tkimdle \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | @kimdle)\t\t \n  @齐迹 求细节！    \n     2013-05-05 22:13 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  @ShopEx 我的帐号怎么办？    \n     2013-05-06 10:46 |    \t\t夜 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:4        | 小夜，一个苦逼程序员)\t\t \n  求细节啊！    \n     2013-05-06 16:08 |    \t\t专业查水表 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:5        | \"><script>alert(/我是\"J.L\"的大号/);</scr...)\t\t \n  @齐迹 @杀戮 还有配置文件~~你懂的~~~    \n     2013-05-07 09:47 |    \t\tkimdle \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | @kimdle)\t\t \n  @专业查水表 求细节啊！手上有一个能进后台，什么权限都没的站，正好试试！    \n     2013-05-13 22:05 |    \t\t小痞子 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:21        | <xss>alert(\"a\")</xss>￥&@&……dssKhwjcw...)\t\t \n  @齐迹 咋弄的 跪求？    \n     2013-05-29 15:39 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  @xsser ec修复了竟然说是360提供，此事你怎么看？http://bbs.ecshop.com/viewthread.php?tid=1129622    \n     2013-06-01 09:50 |    \t\t夜 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:4        | 小夜，一个苦逼程序员)\t\t \n  求公开啊！求包养啊！    \n     2013-07-12 15:09 |    \t\t网络小兵 \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:3        | t00ls)\t\t \n  @齐迹 哇，原来你是EC论坛里的齐老师？久仰久仰啊    \n     2013-07-12 15:15 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  @网络小兵 可恶的晓天给我帐号封了。。。唉很久没有论坛了    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}