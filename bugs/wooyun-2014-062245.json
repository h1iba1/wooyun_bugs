{"id": 55069, "wybug_id": "wooyun-2014-062245", "wybug_title": "Maccms V8 Sql Injection #1（有gpc限制）", "wybug_corp": "maccms.com", "wybug_author": "Mody", "wybug_date": "2014-05-27 15:34", "wybug_open_date": "2014-08-25 15:36", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-30：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-25：\t细节向公众公开  简要描述： 现在 V8版本 基本全部文件都有zend加密了。而且还有360_safe3.php保护刚开始以为没搞头的，结果有个妹子发来微信。妹子：在干嘛？我：挖洞妹子：一个人挖？我：对啊！妹子：我过去陪你一起挖吧！我马上关机。擦，想跟老子抢乌云币？果断一个人作死开挖 详细说明：  是cookie注入，有gpc限制，4处注入点重现下发现过程1. inc/common/function.php直接获取cookie，未过滤\nfunction getCookie($key){\tif(!isset($_COOKIE[$key])){\t\treturn '';\t}\telse{\t\treturn $_COOKIE[$key];\t}}\n2. admin/admin_conn.phpchkLogin() 函数获取cookie未过滤\nfunction chkLogin(){\tglobal $db;\t$m_id = getCookie('adminid'); //这里直接没有过滤\t$m_name = getCookie('adminname'); //这里直接没有过滤\t$m_check = getCookie('admincheck'); //这里直接没有过滤\t/*\tprint '$m_id='.$m_id.'<br>';\tprint '$m_name='.$m_name.'<br>';\tprint '$m_check='.$m_check.'<br>';\t*/\tif (!isN($m_name) && !isN($m_id)){\t\t/*\t\tprint '$sql=';\t\tprint 'SELECT * FROM {pre}manager WHERE m_name=\\'' . $m_name .'\\' AND m_id= \\''.$m_id .'\\' AND m_status=1';\t\tprint '<br>';\t\t*/\t\t$row = $db->getRow('SELECT * FROM {pre}manager WHERE m_name=\\'' . $m_name .'\\' AND m_id= \\''.$m_id .'\\' AND m_status=1');\t\tif($row){\t\t\t$loginValidate = md5($row['m_random'] . $row['m_name'] . $row['m_id']);\t\t\tif ($m_check != $loginValidate){ \t\t\t   sCookie ('admincheck','');\t\t\t   redirect('?m=admin-login','top.');\t\t\t}\t\t}\t\telse{\t\t\tsCookie ('admincheck','');\t\t    redirect('?m=admin-login','top.');\t\t}\t}\telse{\t\tredirect('?m=admin-login','top.');\t}}\n3. admin/editor/uploadshow.php但是cookie都通过了360_safe3.php保护，怎么办呢？当然是找漏网之鱼了，发现几处\n<?phprequire(dirname(__FILE__) .'/../admin_conn.php');chkLogin();$action=be(\"get\",\"action\");$id=be(\"get\",\"id\");$path=be(\"get\",\"path\");?>\n此处调用完全没过滤，直接sqlmap开搞即可其它几处类似注入点\n\n   漏洞证明：  官网不是这个程序，本地搭的>sqlmap.py -u \"http://localhost/maccms8/admin/editor/uploadshow.php\" --cookie=\"adminid=1; adminname=admin; admincheck=aaaa\" -p cookie\n\n   修复方案：  1. include 360_safe3.php2. 其它四处类似，别忘了   版权声明：转载请注明来源 Mody@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-05-27 17:14 厂商回复： 漏洞已经修复，稍后发布更新。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-27 17:41 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  @maccms.com 确认真快，赞一个，可是挖了3个洞，还不到10rank。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}