{"id": 3466, "wybug_id": "wooyun-2014-054220", "wybug_title": "持续绕过cmseasy两次补丁继续注入", "wybug_corp": "cmseasy", "wybug_author": "′雨。", "wybug_date": "2014-03-21 16:37", "wybug_open_date": "2014-06-19 16:38", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-25：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-05-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-19：\t细节向公众公开  简要描述： 或许是最后一次绕过这里了把? 详细说明：  上次的漏洞分析: WooYun: 继续绕过cmseasy补丁继续注入 首先下载官方的包 看是如何做的处理。 下载之后 看到。\nelse            foreach ($row as $key=>$value) {                if (in_array($key,explode(',',$this->getcolslist()))) {                    $value=$value;\t\t\t\t\t/*if (preg_match('/^\\[(.*)\\]$/',$value,$match))                        $sqlud .= \"`$key`\".\"= '\".$match[1].\"',\";                    else*/\n可以看到 是把我上次说的那个正则那里 直接注释掉了。那这次就不用再利用这里了, 换个地方再看看。但是针对我这里说的: WooYun: 继续绕过cmseasy补丁继续注入 condition 这个函数有点小问题 还是没有修复，这里再提出来一下。\nfunction condition(&$condition) {        if (isset($condition) &&is_array($condition)) {            $_condition=array();\t            foreach ($condition as $key=>$value) {                //$value=str_replace(\"'\",\"\\'\",$value);                $_condition[]=\"`$key`='$value'\";            }        $condition=implode(' and ',$_condition);\t\t       \t\t\t\t}        else if (is_numeric($condition)) {            $this->getFields();            $condition=\"`$this->primary_key`='$condition'\";        }else if(true === $condition){        \t$condition = 'true';        }        if (get_class($this) == 'archive') {            if (!front::get('deletestate')) {                if ($condition)                    $condition.=' and (state IS NULL or state<>\\'-1\\') ';                else                    $condition='state IS NULL or state<>\\'-1\\' ';            }            else {                if ($condition)                    $condition.=' and state=\\'-1\\' ';                else                    $condition=' state=\\'-1\\' ';            }        }    }\n这里有点奇葩。 一般来说 用单引号保护的 是字符型的。但是在这里 如果是 字符 却没有单引号引着的, 而如果是数字的话 才会被引住。。略奇葩。。 所以导致了这个漏洞的产生。\n\n如果提交数字的话 UPDATE `cmseasy_p_orders` SET `id`= '1',`status`= '4' WHERE `id`='1'可以看到有单引号 如果提交字符的话。\n\nUPDATE `cmseasy_p_orders` SET `id`= '1a',`status`= '4' WHERE 1awhere 后面的就没有单引号了。但是在之前就过滤掉了 = < > 但是 还有依旧可以绕过。   漏洞证明：  \n\n\n\n调换一下null和sleep 的位置如果查询出来的是那么多的话就延时。   修复方案：  好好改一改。如果是字符的话用单引号引着。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-03-22 07:38 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-21 16:40 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @cmseasy  话说 有个图上传错了。。           无伤大雅。      \n     2014-03-21 16:40 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  干脆，你给官方写个patch吧。。    \n     2014-03-21 16:41 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @′  雨。 那啥，给我吧，我更新近期，要严谨    \n     2014-03-21 16:45 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @疯狗  狗哥 已经更新啦。         话说这次补了 我就应该绕不过了 - -    \n     2014-03-21 16:55 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @疯狗  - - 我没怎么学过php。 都没写过什么东西。。        让我写patch的话 我还真写不出来。        - - 无能为力啊。   只能给官方一点建议啦。    \n     2014-03-25 14:43 |    \t\t猪头子 \t\t\t( 普通白帽子  |\t\t\t        Rank:189 漏洞数:35        | 自信的看着队友rm -rf/tar挂服务器)\t\t \n  官方真出补丁了？官网上cmseasy的最新版还是20140118版的啊    \n     2014-03-25 15:13 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @猪头子     没更改内容    更新了直接覆盖原来的文件。 可以去问官网的客服。    \n     2014-03-25 17:11 |    \t\t猪头子 \t\t\t( 普通白帽子  |\t\t\t        Rank:189 漏洞数:35        | 自信的看着队友rm -rf/tar挂服务器)\t\t \n  @′  雨。 soga，谢谢~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}