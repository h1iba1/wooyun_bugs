{"id": 10992, "wybug_id": "wooyun-2013-023088", "wybug_title": "科创CMS uploadImageFile_do.jsp页面文件上传漏洞", "wybug_corp": "chinacreator.com", "wybug_author": "健宇", "wybug_date": "2013-05-04 21:50", "wybug_open_date": "2013-08-02 21:50", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传内容未检查", "文件上传漏洞", "任意"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-05-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-05-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-05-10：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-07-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-07-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-07-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-02：\t细节向公众公开  简要描述： 科创CMS任意上传JSP可执行脚本文件漏洞，波及一大批厅级、市级政府网站。 详细说明：  之前把漏洞上报在了cnvd，应cnvd要求把该漏洞上报至wooyun来。\n\n   漏洞证明：  科创CMS上传0day存在位置/creatorcms/comm_front/email/uploadImageFile_do.jsp/comm_front/email/uploadImageFile_do.jsp通过谷歌搜索关键字可以看到相关的政府网站http://www.google.com.hk/search?hl=zh-Hans-HK&source=hp&q=comm_front%2Femail%2F&gbv=2&oq=comm_front%2Femail%2F&gs_l=heirloom-hp.12...15360.15360.0.16453.1.1.0.0.0.0.0.0..0.0...0.0..0.1c.govyZeEz1ZI\n\n总共有26,500条结果，可以看到政府网站使用科创cms的还是很多的。漏洞文件出在信箱，比如某厅网站为厅长信箱，某局网站为局长信箱，在信箱有一个上传附件，是允许群众上传附件给领导们查看一些相关图片之类的，由于网站程序对上传过滤不严导致了存在可以上传任意文件的漏洞。漏洞利用方法，本地构造表单，以湖南省农业厅网站做为示例\n<form id=\"frmUpload\" enctype=\"multipart/form-data\" action=\"http://www.hnagri.gov.cn/comm_front/email/uploadImageFile_do.jsp\" method=\"post\">Upload a new file:<br><input type=\"file\" name=\"NewFile\" size=\"50\"><br><input id=\"btnUpload\" type=\"submit\" value=\"Upload\"></form>\n通过保存以下代码为HTML文件可以选择任意JSP文件进行上传。\n\n选择好文件点upload可以看到结果。\n\n\n\n如图所示，就可以直接上传JSP文件，如果被黑客利用可以导致大规模的政府网站被恶意篡改、挂马。   修复方案：  对上传文件进行服务端验证，只允许上传JPG,GIF,BMP文件，而且大小写全部转换成小写，对0x00，分号冒号等特殊符号进行过滤。   版权声明：转载请注明来源 健宇@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-05-07 22:32 厂商回复： CNVD确认并复现所述情况，并在互联网上多个实例上复现。根据测试结果，已通知湖南等多地分中心，要求分中心协助处置涉及本省的政府部门案例，根据白帽子提供的信息，对应用软件进行了特征提取，以备下次有漏洞时进行快速测试。同时，已在此前尝试联系软件开发厂商，后续情况待8日查证后再反馈。rank=8.97*1.1*1.5=14.800 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-05-04 21:58 |    \t\tWorzm \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        )\t\t \n  健宇叫我们来加人气的.    \n     2013-05-04 21:59 |    \t\tLmy \t\t\t( 实习白帽子  |\t\t\t        Rank:69 漏洞数:12        | 低调求发展)\t\t \n  你还是发出来了，希望这个漏洞别公开，私信给这类的站长修复，发出来又要被轮....    \n     2013-05-04 21:59 |    \t\t马杀鸡 \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:5        | 作为一匹勇敢的马，杀鸡是必不可少的)\t\t \n  我也是来加人气的    \n     2013-05-04 22:00 |    \t\tz7y \t\t\t( 实习白帽子  |\t\t\t        Rank:57 漏洞数:9        | 关注技术与网络安全)\t\t \n  健宇吩咐的事，我不敢说不，人气+！    \n     2013-05-04 22:00 |    \t\t冉冉升起 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:6        | ...)\t\t \n  健宇叫我们来加人气的.     \n     2013-05-04 22:00 |    \t\t健宇 \t\t\t( 普通白帽子  |\t\t\t        Rank:131 漏洞数:14        | tools kid)\t\t \n  @Lmy 额，想领个证书。    \n     2013-05-04 22:02 |    \t\tLmy \t\t\t( 实习白帽子  |\t\t\t        Rank:69 漏洞数:12        | 低调求发展)\t\t \n  @健宇 这个想法不错。。    \n     2013-05-04 22:03 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @Lmy 走乌云的新流程的    \n     2013-05-04 22:04 |    \t\tner \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:4        )\t\t \n  健宇叫我来加人气,我拉上和尚和众呢姑来捧场了    \n     2013-05-04 22:06 |    \t\t法海 \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:5        | 许仙去哪了)\t\t \n  求细节    \n     2013-05-04 22:11 |    \t\t三十度 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 本屌精通各种花式撸管，装逼32式炉火纯青。...)\t\t \n  健宇叫我们来加人气的.     \n     2013-05-05 00:11 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @法海 他不懂爱    \n     2013-05-06 16:17 |    \t\t慕林 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:1        | 好钻研， 爱安全)\t\t \n  科创CMS, 官网是啥呢？ 不会保密了吧？     \n     2013-05-28 09:01 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @慕林 见过其它地方用这个    \n     2013-08-02 23:32 |    \t\t紫林 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:4        | 喜欢白帽子)\t\t \n  上传后的路径在那？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}