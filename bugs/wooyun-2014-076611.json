{"id": 50843, "wybug_id": "wooyun-2014-076611", "wybug_title": "B2Bbuilder 最新版前台sql注入（打包）-5", "wybug_corp": "B2Bbuilder", "wybug_author": "路人甲", "wybug_date": "2014-09-19 12:57", "wybug_open_date": "2014-12-18 12:58", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-19：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-12-18：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： RT  前台sql注入 无需管理员登陆 详细说明：  在文件admin_message_list_inbox.php中： \ninclude_once(\"$config[webroot]/includes/page_utf_class.php\");include_once(\"$config[webroot]/module/message/includes/plugin_msg_class.php\");//=============================================$msg=new msg();if(isset($_POST[\"deid\"])&&!empty($_POST['del'])){\t$msg->del_mail();}if(isset($_POST[\"deid\"])&&!empty($_POST['save'])){\t$msg->save_mail();}\n 调用了del_mail() 再看这个方法： \nfunction del_mail($id=NULL)\t{\t\tif(empty($id))\t\t{\t\t\tfor($i=0;$i<count($_POST[\"deid\"]);$i++)\t\t\t{\t\t\t\t$id=$_POST[\"deid\"][$i];\t\t\t\t$sql=\"update  \".FEEDBACK.\" set iflook=2 where id=$id\";\t\t\t\t$this->db->query($sql);\t\t\t\tunset($sql);\t\t\t}\t\t}\t\telse\t\t{\t\t\t$sql=\"update  \".FEEDBACK.\" set iflook=2 where id=$id\";\t\t\t$this->db->query($sql);\t\t}\t}\n id没有过滤 直接带入到了sql语句执行 同一文件中还有几处类似漏洞： \n//恢复邮件 function recover_mail($id=NULL) { global $admin; if(!empty($id)) { $sql=\"update \".FEEDBACK.\" set iflook=1 where id=$id\"; $this->db->query($sql); $admin->msg(\"main.php?m=message&s=admin_message_list_inbox\"); } else {\tfor($i=0;$i<count($_POST[\"deid\"]);$i++) { $id=$_POST[\"deid\"][$i]; $sql=\"update \".FEEDBACK.\" set iflook=1 where id=$id\"; $this->db->query($sql); unset($sql); } } }\n \nfunction friend_msg_batch_send() {\tglobal $buid,$admin; if(!empty($_POST['senduser'])&&!empty($_POST['msgcon'])) { $date=date(\"Y-m-d H:i:s\"); $sear=explode(';',$_POST['senduser']); if(count($sear)>1) { $sear1=array_unique($sear); $suser=\"'0'\"; foreach($sear1 as $v) { $suser.=\",'$v'\"; } $sql=\"select user,email,userid from \".ALLUSER.\" where user in ($suser)\"; } else\n \n\n该厂商拥有大量客户：\n\n   漏洞证明：  \n\n该厂商拥有大量客户：\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}