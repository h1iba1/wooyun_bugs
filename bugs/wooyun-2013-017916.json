{"id": 14066, "wybug_id": "wooyun-2013-017916", "wybug_title": "我是如何重置爱爱医任意用户密码的", "wybug_corp": "爱爱医", "wybug_author": "se55i0n", "wybug_date": "2013-01-26 12:54", "wybug_open_date": "2013-03-12 12:55", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-01-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-02-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-02-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-02-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-03-12：\t细节向公众公开  简要描述： rank不给力，礼物要给力呀！ 详细说明：     问题缺陷在“通过手机重置用户密码”，虽然爱爱医的同学在这方面还是下了不少功夫的（限制ip日操作次数、同帐号操作请求次数），且看我是如何突破限制重置任意用户密码的；1）手机注册用户一枚，通过之前的测试发现系统会限制ip日操作次数、同帐号操作请求次数，但是系统没有对手机验证码校验的错误次数做限制；\n\n2）我们可使用爆破的方式获取到用户真实校验码（根据系统response字节长度确定），但是系统限制了校验码使用次数（使用一次即过期）,我们无法通过常规渠道利用获取到的真实验证码来重置用户密码；\n\n3）但是我们同时注意到，在爆破到真实验证码时，系统返回了这样一段内容;\n{\"ckey\":\"aaaaaaaaaaaaaaaaaaa\",\"rcode\":bbbbbbbbbb,\"status\":\"success\"}\n4)哈哈，聪明的同学可能都想到了，系统可能会以“ckey”、“rcode”参数值为凭证来进行下一步的密码重置校验，但是我们如何知道是怎样一种逻辑呢，很简单，直接进行一次真正的密码重置并在过程中抓包来分析系统的逻辑；5）通过抓包我们发现，当我们输入真正的验证码时系统会将\"ckey\"、“rcode”的参数值分别传递给“kcode”和“tcode”参数，并生成如下url请求；\nhttp://auth.iiyi.com/safe/mod_pwd?kcode=aaaaaaaaaaaaaaaaaaa&tcode=bbbbbbbbbb\n6）如此看来，我们的推断基本正确，那么我们只要爆破到真实验证码就可以获取到“ckey”、“rcode”参数值，当然也就知道了“kcode”和“tcode”参数值，有了上面的参数值我们就能直接重置用户密码了，let's go；7)获取到我们需要的相关参数值；\n\n8）利用上面获取到的参数值构造url请求，直接来到了密码重置环节；\n\n9）输入我们需要重置的密码即可（突破限制利用漏洞演示完成）；\n\n   漏洞证明：  见详细说明~   修复方案：     版权声明：转载请注明来源 se55i0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-01-26 14:00 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-02-26 09:21 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:103        | going)\t\t \n  怎么突破限制ip日操作次数、同帐号操作请求次数的呢    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}