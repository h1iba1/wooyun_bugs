{"id": 49895, "wybug_id": "wooyun-2014-079684", "wybug_title": "Discuz! 微信公众平台插件补丁绕过 越权删除数据库", "wybug_corp": "Discuz!", "wybug_author": "menmen519", "wybug_date": "2014-10-17 10:53", "wybug_open_date": "2015-01-15 10:54", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-24：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向公众公开  简要描述： Discuz! 微信公众平台插件补丁绕过 越权删除数据库，完全可以绕过百度云waf 详细说明：  上一个漏洞发表的是getshell，结果插件响应迅速啊，今天就打了补丁，不得不说dz很给力那么真的修复干净了吗：再看代码:\nif (!strpos($_GET['mod'],'/') && !strpos($_GET['mod'],'\\\\') && !strpos($_GET['ac'],'/') && !strpos($_GET['ac'],'\\\\')) {\tinclude DISCUZ_ROOT.'./source/plugin/hux_wx/mod/'.$_GET['mod'].'/'.$_GET['ac'].'.php';}\n这是它修补后的代码，过滤了反斜杠和正斜杠1.$_GET['mod']='..'  绕过2.$_GET['ac'] = \"uninstall\"; 绕过 这句话的翻译最终的结果就是执行了hux_wx/uninstall.php我们再看看这个文件\n<?phpif(!defined('IN_DISCUZ')) {\texit('Access Denied');}$sql = <<<EOFDROP TABLE IF EXISTS pre_hux_wx;DROP TABLE IF EXISTS pre_hux_wx_action;DROP TABLE IF EXISTS pre_hux_wx_config;DROP TABLE IF EXISTS pre_hux_wx_userjp;EOF;runquery($sql);$finish = TRUE;?>\n看到了吗 只是if(!defined('IN_DISCUZ')) {\texit('Access Denied');}这里明显就是任何用户可访问ok代码分析到此完毕，演示就不用做了，要不直接上插件中心主页试试，这个完全可以绕过百度云waf，哈哈   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-10-21 09:20 厂商回复： 感谢，感谢。我们尽快通知插件作者修改。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-17 15:37 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  前排围观    \n     2014-10-17 16:21 |    \t\t默秒全 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | a....)\t\t \n  强势围观    \n     2014-10-19 11:26 |    \t\t君宝 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:4        | 不要跟我比浪。。你浪不过我。。)\t\t \n  围观    \n     2014-10-24 14:12 |    \t\t乌云合作伙伴-知道创宇(乌云厂商)\t\t \n  strpos使用有问题 可以直接绕过    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}