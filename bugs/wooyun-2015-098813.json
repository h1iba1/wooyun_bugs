{"id": 44478, "wybug_id": "wooyun-2015-098813", "wybug_title": "众多厂商邮件系统配置不当可伪造邮件人", "wybug_corp": "wooyun众多厂商", "wybug_author": "一天到晚吃", "wybug_date": "2015-03-09 18:59", "wybug_open_date": "2015-04-23 19:00", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-23：\t细节向公众公开  简要描述： 批量检测了一下，一百多个厂商都存在这个问题,包括华为，奇虎，小米，魅族，途牛，人人，开源中国，万达，乐友，淘米,尚游网络等，不至于这些厂商，厂商列表说明中有. 详细说明：  邮箱服务器设置不当，没有开启验证，可以伪造发件人.影响企业内部信息安全.写了两个脚本对wooyun上的厂商跑了一遍.下面的脚本是跑出所有厂商的邮箱服务器域名或者IP.\n#!/usr/local/bin/python# -*- coding: utf8 -*-import timeimport dns.resolverfrom multiprocessing import Processimport osOK=[]ERROR=[]WHITE=[\"GOOGLEMAIL.COM\",\"GOOGLE.COM\",\"googlemail.com\",\"qq.com\",\"google.com\",\"163.com\",\"126.com\"]def white(s):    for w in WHITE:\tif w in s:\t\treturn False    return Truedef q(ym):    try:\tif ym.startswith(\"www.\"):\t\tym=ym.split(\"www.\")[1]        if ym.count(\".\")>1:\t\t#get the domain\t\tym=ym.split(\".\")[-2]+\".\"+ym.split(\".\")[-1]\ttmp=dns.resolver\ttmp.timeout=1        answers = tmp.query(ym, 'MX')        for rdata in answers:\t    if white(str(rdata.exchange)):\t\t    #print \"xxxx\"\t\t    cmd=\"echo \"+str(rdata.exchange)+\" >> mail.txt\"\t\t    #print cmd\t\t    os.system(cmd)\t\t    print rdata.exchange\t\t    OK.append(str(rdata.exchange))    except Exception,e:\tprint e\tERROR.append(ym)PATH = r\"yuming.txt\"fp = open(PATH, \"r\")x=[]start=time.time()for eachline in fp:    p=Process(target=q,args=(eachline.strip(),))    p.start()    x.append(p)    #q(eachline.strip())for i in range(len(x)):    x[i].join()print OKprint ERRORend=time.time()print end-start\n下面的脚本是检测得到的邮件服务器有没有开验证，能否伪造发件人\nimport os, sys, stringimport smtplibimport tracebackfrom multiprocessing import Process,QueueFOUND=Queue()WHITE=[\"auth\",\"error\",\"bad\",\"deny\",\"denied\",\"rejected\"]def white(s):\tfor w in WHITE:\t\tif w in s:\t\t\treturn False\treturn Truedef go(mailserver):\ttry:\t\tyuming=mailserver[len(mailserver.split(\".\")[0])+1:]\t\tprint yuming\t\tfrom_addr=\"hr@\"+yuming\t\tto_addr=\"hr@\"+yuming\t\tmsg=\"test\"\t\tsvr=smtplib.SMTP(mailserver,timeout=10)\t\t#svr.set_debuglevel(1)\t\tsvr.docmd(\"HELO localhost\")\t\tx=svr.docmd(\"mail from:%s\"%from_addr)\t\tif white(x[1].lower()):\t\t\ty=svr.docmd(\"rcpt to:%s\"%to_addr)\t\t\tif white(y[1].lower()):\t\t\t\tprint \"-------------\"\t\t\t\tprint mailserver\t\t\t\tglobal FOUND\t\t\t\tFOUND.put(mailserver)\t\t\t#svr.docmd(\"data\")\t\t\t#svr.send(msg+\"\\r\\n\")\t\t\t#svr.send(\".\\r\\n\")\t\t\t#print svr.getreply()\t\t\tsvr.quit()\texcept Exception,e:\t\ttraceback.print_exc()x=[]for m in open(\"mail.txt\").readlines():\tp=Process(target=go,args=[m.strip().rstrip(\".\")])        p.start()        x.append(p)for i in range(len(x)):\tx[i].join()while FOUND.empty()==False:\tprint FOUND.get()\n   漏洞证明：  mail.taomee.commail.syyx.commx2.ctrip.commail.iboxpay.commailgateway.jiayuan.comtfw.qihoo.netmgw1.wanda.cnmx2.mail.renren.commx2.mail.renren.commx.ctrip.commail.51greenorange.commx2.ctrip.commail.ku6.commailgate2.neusoft.comstaff.178.commail03.meituan.commail.591wed.commgw2.wanda.cnmx1.huawei.commailsrv1.lianzhong.commail.998.commail.mplife.comsmtpin.ceair.commail.5173.commail2.qmango.commx1.global-mail.cnmail.jingwei.commxb.mailgun.orgmail.legendsec.comspam.jsbc.com115.182.12.87mail.aibang.comantispam.m18.comwebmail.17500.cnmx2.huawei.commx.ctrip.commailx.picchealth.com60.190.244.147mail.uzai.commx.global-mail.cnmx01.changyou.commail.sootoo.commail.ecitic.commail.cnmo.commail3.sankuai.infomx.global-mail.cnmx01.unionpayintl.commta-189.21cn.commeg.creditease.cnmail.chexun.commail.playcool.commx.zhaopin.com.cnmail02.playcool.commail.zuche.comsmtp.huimai365.commx3.huawei.commail.rong360.commailmx.picchealth.commx1.cofco.commx3.mxmail.xiaomi.comsmtpgw4.chinaamc.commail.locojoy.commail.zhujiwu.comsmtpgw1.chinaamc.commail01.meituan.comcs.5173.commx2.weiphone.commail.tujia.commx1.bianfeng.commail.fun.tv121.12.162.99tfw.qihoo.netsmtpgw2.chinaamc.commail2.51greenorange.commeizuMX1.meizu.commx2.vancl.cnmail.dbw.cnmx1.mail.renren.comsmtp.nsfocus.comoa.legendsec.commail.yundaex.comdianping-com.mail.protection.partner.outlook.cnmail.leyou.commxi.opera.commx1.global-mail.cnmail.oschina.netmx1.vancl.cnmail2.founderbn.commail2.bitauto.comsmtpgw3.chinaamc.comwebmail.chinahr.commx.55tuan.comspam.goodbabygroup.commail.china-sss.commail.tuniu.commeizuMX2.meizu.comqhome.3322.orgchuangxin-com.mail.protection.partner.outlook.cnmail.99bill.commx1.mail.renren.commeg.creditease.cnmailgate.neusoft.comcnexcbeiedg01.chinahr.commail.h3c.commail.netentsec.commail1.h3c.commail01.playcool.commailmx1.sinopec.commail3.founderbn.commx1.shandagames.commail1.h3c.comappchina-com.mail.protection.partner.outlook.cnexchange.chanjet.comexchange01.chanjet.commail.51web.commx4.huawei.com182.148.112.202cnexcbeiedg02.chinahr.commx.fun.tvmta-189.21cn.commx2.99bill.commail.h3c.commx1.99bill.com上面的也不一定都存在，但是目测存在率80%以上，手工试了十几个大厂商，都是存在的，截图如下\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n   修复方案：  各大厂商请认证   版权声明：转载请注明来源 一天到晚吃@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：14  确认时间：2015-03-13 18:00 厂商回复： CNVD确认所述漏洞情况，暂未建立与软件生产厂商（或网站管理单位）的直接处置渠道，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 14, "Ranks": null}