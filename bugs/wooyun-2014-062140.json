{"id": 1850, "wybug_id": "wooyun-2014-062140", "wybug_title": "Discuz! &lt;=2.5 csrf防御绕过", "wybug_corp": "Discuz!", "wybug_author": "索马里的海贼", "wybug_date": "2014-05-26 10:33", "wybug_open_date": "2014-08-24 10:34", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-24：\t细节向公众公开  简要描述： 在Discuz! <=2.5版本的某处设计存在失误，csrf防御可被绕过可以获取到formhash 所以应该算全局的绕过吧 详细说明：  其实还是\tdrops文章《上传文件的陷阱》带来的问题。dz2.5以下版本修改头像处未检查图片文件的合法性，可以上传.jpg后缀的swf文件。使用这个swf文件发起恶意请求读取页面源码就能获取到formhash 有formhash之后。。想干嘛就干嘛了具体文件/uc_server/control/user.php 281行onuploadavatar函数\n$imgtype = array(1 => '.gif', 2 => '.jpg', 3 => '.png');\n只检查了后缀而不像3.0以上用库检查了图片格式   漏洞证明：  步骤1、新建一个获取页面源码 提取formhash 然后用formhash发送添加副站长请求的swf，保存为.jpg后缀\n\n2、注册一个账号，去/home.php?mod=spacecp&ac=avatar上传上一步生成的.jpg后缀的swf文件并抓包 上传后的地址应该是http://192.168.1.104/uc_server/data/tmp/upload{uid}.jpg这样的\n\n3、新建一个html页面，把上一步拿到的头像地址当作flash加载到页面。4、引诱管理员访问这个html页面，就会在后台把你的账号添加为副站长\n\n\n\n   修复方案：  把3.0 3.1的检查代码搬过来吧   版权声明：转载请注明来源 索马里的海贼@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-05-26 11:17 厂商回复： 感谢您提出的问题。由于该问题和论坛版本无关，是ucenter的问题，所以我们之前曾经针对ucenter单独发过修正。只是目前安装包中的ucenter一直没有更新，所以X3之前的版本还会存在这个问题。我们会尽快更正这个问题。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-26 11:22 |    \t\tMoc \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:12        | 屌丝何苦为难屌丝)\t\t \n  确认这么快    \n     2014-05-26 12:39 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @Discuz!  实际上X25之后的版本也有这个问题    \n     2014-08-25 15:59 |    \t\t破锁 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:6        )\t\t \n  @mramydnei 真打脸    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}