{"id": 42105, "wybug_id": "wooyun-2014-086749", "wybug_title": "CmsEasy最新版5.5 存储型XSS导致GetShell", "wybug_corp": "cmseasy", "wybug_author": "zph", "wybug_date": "2014-12-11 17:16", "wybug_open_date": "2015-01-17 17:18", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-16：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-17：\t细节向公众公开  简要描述： n处XSS，我不信都插完打不到cookie，get不了shell -.- 详细说明：  第一处（只代码审计第一处，后面几处类似。都是没有过滤）：\nfunction login_false() {        cookie::set('loginfalse',(int) cookie::get('loginfalse')+1,time()+3600);        event::log('loginfalse','失败 user='.front::post('username'));        front::flash(lang('登陆失败！').\"<a href=''>\".lang('backuppage').\"</a>\");    }\n只要登陆失败，就会调用login_false函数，然后front::post来查询username后返回给event::log函数进行记录继续跟进post\nself::$post=$_POST;\n程序把POST内容给了self::$post\nstatic function post($var) {        if (isset(self::$post[$var]))            return self::$post[$var];        else            return false;    }\n并且直接返回了post内容继续跟进event::log函数\nstatic function log($action,$remark){        $user = new user();        $username = cookie::get('login_username');        $row = $user->getrow(array('username'=>$username));        $uid = $row['userid'];        $action = lang($action);$remark = lang($remark);        $ip = front::ip();        $addtime = time();        $sql = \"INSERT INTO `\".config::get('database', 'prefix').\"event`  VALUES (null,'$uid','$username','$ip','$addtime','$action','$remark')\";        $event = new event;        $event->query($sql);    }\n程序直接把参数带入插入语句，无过滤，导致XSS证明：前台登陆，用户名填写<script>alert(document.cookie);</script>，密码随意后台日志处，即可触发XSS，cookie内容中包括用户名和密码。\n\n\n\n第二处：\n\n前台支付订单处，订单留言中填写xss代码。后台处理订单，即可触发XSS，内容中包含用户名和密码\n\n第三处：前台应聘处插入XSS。\n\n后台查看即可触发XSS：\n\n\n\n第四处：前台邮件订阅处（index.php?case=archive&act=email）插入xss代码，未进行邮件合法性判断和xss脚本过滤\n\n后台邮件处即可触发。\n\n\n\n最后，既然都x进后台了，getshell我就不说了吧。模板处直接编辑文件写shell就ok了。基本上想干什么干什么了。   漏洞证明：  如上。   修复方案：  过滤xss代码，邮件处判断合法性。   版权声明：转载请注明来源 zph@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-01-17 17:18 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-11 09:03 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  插得好    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}