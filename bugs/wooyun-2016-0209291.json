{"id": 86960, "wybug_id": "wooyun-2016-0209291", "wybug_title": "新姿势之获取果壳全站代码和多台机器root权限", "wybug_corp": "果壳传媒", "wybug_author": "黑客,绝对是黑客", "wybug_date": "2016-05-16 14:39", "wybug_open_date": "2016-05-21 14:40", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-05-21：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 新姿势～可获取 果壳，mooc，在行等全站代码并获取机器root权限 详细说明：  0x00 简介果壳自动化build docker image的系统\nhttp://builder.iguokr.com/#/signin\n\n\n通过之后的分析，发现是通过gitlab hook，当代码变更时，自动触发image build过程，通过将代码和运行环境打包到 docker image里，实现自动化和快速部署0x01 漏洞原因docker engine daemon api直接暴露公网\n\n\nmask 区域\n\n1.http://**.**.**\n\n\n\n还有很多其他ip也开放2375端口，请厂商自查\n也就是说，docker能做的所有操作，这里都可以做比如：运行、删除container，拉取image等等0x02 漏洞证明查看当前运行的containerdocker 命令行（需要安装docker）\n\n\nmask 区域\n\n1.://**.**.**//54.223.50.135:2375 ps\n\n\n\n\n或直接访问\n\n\nmask 区域\n\n1.http://**.**.**/containers/json\n\n\n\n\nCLI结果\n\n\nmask 区域\n\n*****         CREATED             STATUS         **********       4 days ago          Up 4 days              **********       4 days ago          Up 4 days              **********       4 days ago          Up 4 days              **********         4 days ago          Up 4 days           **********       4 days ago          Up 4 days              **********       4 days ago          Up 4 days              **********         4 days ago          Up 4 days           **********.s\"   4 days ago          Up 4 days        **********ntrypoint.sh redis\"   4 days ago   *****\n\n\n\n\n已证明，其他不列出   漏洞证明：  0x03 脑洞大开我们现在能做的只是运行docker的一些命令，比如操作container、image，没法直接控制宿主机那么怎么才能控制宿主机呢？先分析下：docker的运行需要root权限的，即我们有一个以root运行的进程但docker本身执行命令只能在container内部，与宿主机是隔离的，即使是反弹一个shell，控制的也是container，除非有溢出漏洞，然而我并没有～那么我们来看一下docker本身能够做什么？脑洞开了下，想到docker 运行 container的时候，可以将本地文件或目录作为volume挂载到container内，并且在container内部，这些文件和目录是可以修改的。这里一下就想到了redis + ssh漏洞，非常的像我们看一下服务器是否开放22端口，bingo，有ssh服务器\n\n\nmask 区域\n\n*****23.50.**********23.50.**********54.223.**********is '**********.1p1 Ubunt*****\n\n\n\n\n那么直接把/root/.ssh目录挂载到container内，比如/tmp/.ssh，然后修改/tmp/.ssh/authorized_keys文件，把自己的public key写进去，然后就可以了登录0x04 获取机器root权限这里具体命令就不给了，只给出证明 ifconfig\n\n\nmask 区域\n\n*****1-1-228**********(root) gr*****\n\n\n\n\n/home/ubuntu目录下文件\n\n\nmask 区域\n\n1.://**.**.**/home/ubuntu***** 18**********tu  163 Sep 24**********ubuntu 4.0K **********untu 4.0K Apr**********tu 4.0K Sep  7********** 77 Apr  8 05:50**********untu 4.0K Dec**********tu 4.0K Nov 12**********ubuntu 4.0K **********untu 4.0K May**********ot   4.0K Dec**********.7K Apr 28 10:20**********tu 472K Dec 17**********tu 1.3K Feb  3**********untu 4.0K Nov**********root   4.0K **********tu 4.0K Mar  8**********22M Mar  2 20:10**********untu 4.0K Mar**********tu 1.2K Feb 11**********  14M Dec 17 03**********tu 4.0K Feb 23**********untu 4.0K May********** 110M Dec  3 09**********untu  243 Nov**********M Jul 31  2015 so**********untu 4.0K Jan**********untu  689 Nov*****\n\n\n\n\ndocker仓库在内网 docker-registry.guokr.com \nping docker-registry.guokr.comPING ec2-54-222-135-194.cn-north-1.compute.amazonaws.com.cn (172.31.14.62) 56(84) bytes of data.\n0x04 获取全站源代码对当前docker运行的container进行了查看和分析，发现image build的过程会从\ngit.iguokr.com\n拉取源代码，这里是用了public key验证，找了找，在代码中发现了私钥和公钥且git.iguokr.com公网开放有了密钥，看到builder有一个postgresql数据库，可以公网连接，在代码中找到帐号和密码连接后发现有git repository列表，这里给出部分\n\n\n\n里面有果壳，在行，mooc等全站代码，git clone一份，给出证明\n\n0x05 哎～在机器上装了个nmap，对所在网段的b段扫了下2375端口，扫到了一些只有内网才能访问的2375端口，并且都有ssh服务，都可以拿到root权限，这里就不贴了，和这个类似。本来想试试能不能撸到线上，结果发现线上环境在另一个网段，试了试还是放弃了   修复方案：  禁止外网访问～   版权声明：转载请注明来源 黑客,绝对是黑客@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-05-21 14:40 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-16 14:43 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:765 漏洞数:83        | 铁甲依然在)\t\t \n  黑客就是屌    \n     2016-05-16 14:43 |    \t\t狗胜  \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:1        | ../../../../../../../../../../../../../....)\t\t \n  据说国内外都没有的姿势。。我想看看这个b有多牛    \n     2016-05-16 14:46 |    \t\tsauce \t\t\t( 普通白帽子  |\t\t\t        Rank:228 漏洞数:37        | test)\t\t \n  据说国内外都没有的姿势。。    \n     2016-05-16 14:47 |    \t\tphith0n  \t\t\t( 普通白帽子  |\t\t\t        Rank:816 漏洞数:126        | 一个想当文人的黑客~)\t\t \n  这个姿势才不会告诉你们    \n     2016-05-16 14:57 |    \t\t千机 \t\t\t( 普通白帽子  |\t\t\t        Rank:490 漏洞数:89        | 蜀中唐门，千机鬼斧)\t\t \n  黑客,绝对是黑客    \n     2016-05-16 16:17 |    \t\t孤独雪狼  \t\t\t( 普通白帽子  |\t\t\t        Rank:761 漏洞数:159        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  gitlab?    \n     2016-05-16 16:18 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1393 漏洞数:147        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  前排学习姿势    \n     2016-05-16 16:27 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:817 漏洞数:100        | 没关系啊，我们还有音乐)\t\t \n  lz的姿势水平挺高的嘛    \n     2016-05-16 17:06 |    \t\tHax0rs \t\t\t( 实习白帽子  |\t\t\t        Rank:61 漏洞数:12        | Hax0rs)\t\t \n  黑客,绝对是黑客    \n     2016-05-16 17:12 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1878 漏洞数:154        | 不要患得患失，我羡慕你，但是我还是选择做...)\t\t \n  zabbix？monitor？    \n     2016-05-16 17:20 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:265 漏洞数:33        | 开发真是日了狗了)\t\t \n  mark    \n     2016-05-16 17:26 |    \t\t黑客,绝对是黑客 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:6        | 黑客,绝对是黑客)\t\t \n  非gitlab zabbix monitor    \n     2016-05-16 17:34 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1621 漏洞数:221        | 。)\t\t \n  那是什么求文章    \n     2016-05-16 17:37 |    \t\tRaven \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | rm -rf /)\t\t \n  黑客,绝对是黑客    \n     2016-05-16 18:20 |    \t\t黑客,绝对是黑客 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:6        | 黑客,绝对是黑客)\t\t \n  @scanf 请关注drops    \n     2016-05-16 18:55 |    \t\t姿势不行 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:7        | 我是爱卖萌的小阿狸呀http://www.qinqinyo....)\t\t \n  这姿势。。    \n     2016-05-16 19:26 |    \t\t放逐 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 白帽子放逐Gg？得失乐与悲与Av Qq205655539)\t\t \n  黑客,绝对是黑客    \n     2016-05-16 19:28 |    \t\tsco4x0 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:14        )\t\t \n  太黑客了    \n     2016-05-16 20:46 |    \t\tQ1NG \t\t\t( 普通白帽子  |\t\t\t        Rank:148 漏洞数:27        | 临 兵 斗 者 皆 阵 列 前 行 !)\t\t \n  @黑客,绝对是黑客  黑客绝逼是黑客     \n     2016-05-16 20:51 |    \t\tfun \t\t\t( 实习白帽子  |\t\t\t        Rank:46 漏洞数:20        | 做自己喜欢的事。)\t\t \n  围观一下    \n     2016-05-16 20:53 |    \t\tdragon110 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 谨言、慎行、多思。)\t\t \n  @黑客,绝对是黑客 黑客绝逼是黑客     \n     2016-05-16 22:10 |    \t\t无名 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:9        | 我是一只小菜鸟呀，伊雅伊尔哟。)\t\t \n  坐等新姿势    \n     2016-05-16 22:39 |    \t\t凌晨G度 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:2        | 充实的麦穗都是低着头，倒是那些空壳却昂着...)\t\t \n  前来围观    \n     2016-05-16 23:01 |    \t\t小逗逼 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:3        | rt)\t\t \n  坐等新姿势     \n     2016-05-16 23:11 |    \t\tSTCX \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:8        | 向大黑阔们致敬)\t\t \n  不会要火吧，赶紧留个名    \n     2016-05-17 08:21 |    \t\t山鹰 \t\t\t( 实习白帽子  |\t\t\t        Rank:78 漏洞数:23        | 拒绝搞基，啊哈)\t\t \n  黑客，绝对是黑客，要火    \n     2016-05-17 10:34 |    \t\t少宇 \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:13        | QQ ：1126179674  By : 少宇 http://www.90...)\t\t \n  这个黑客要火，相信我    \n     2016-05-17 12:55 |    \t\tX20610 \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:40        )\t\t \n  吓死我了 还以为你发现我零蛋了    \n     2016-05-17 13:47 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1888 漏洞数:300        | 最近有人冒充该账号行骗，任何自称HackBrai...)\t\t \n  这种该加精华啊    \n     2016-05-18 12:46 |    \t\tHucheat \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:5        | 什么时候才不是路人T_T)\t\t \n  漏洞类型：敏感信息泄露    \n     2016-05-18 16:13 |    \t\t雷锋 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 看人生万般无奈，看世间千姿百态...)\t\t \n  照这么下去，所有厂商还不都被刷下去呀    \n     2016-05-18 16:57 |    \t\tjackyu \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:9        | 世界上没有一个系统是绝对安全的，系统最大...)\t\t \n  我草，什么漏洞怎么严重，获取果壳全站代码和多台机器root权限    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}