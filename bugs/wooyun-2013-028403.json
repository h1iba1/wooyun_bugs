{"id": 10371, "wybug_id": "wooyun-2013-028403", "wybug_title": "微信公众平台黑名单功能绕过", "wybug_corp": "腾讯", "wybug_author": "Icyblade", "wybug_date": "2013-07-10 19:38", "wybug_open_date": "2013-08-24 19:38", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误", "设计不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-07-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-07-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-07-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-07-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-08-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-24：\t细节向公众公开  简要描述： 用户被公众平台拉黑后，可以通过某种方式绕过黑名单的限制继续发送消息 详细说明：  取消关注再关注即可   漏洞证明：  在没有拉黑的情况下发一条\"whitelisted\"，正常\n\n拉黑\n\n拉黑后发送\"blacklisted\"，微信公众平台没有接收到，黑名单功能正常\n\n取消关注再关注，发送\"unsubscribed\"，微信公众平台成功接收到消息，黑名单被绕过\n\n\n\n同时用户组由黑名单变成了未分组\n\n利用微信公众平台API，将用户发送的消息存到数据库内，也可以看出黑名单功能被绕过了，这里的SQL语句是\nSELECT  `toUserName` ,  `fromUserName` ,  `createTime` ,  `msgType` ,  `content` ,  `msgId` ,  `event` FROM  `xxxxxxxx` WHERE fromUserName =  'xxxxxxxxxxx'ORDER BY createTime DESC LIMIT 0 , 30\n\n\n   修复方案：  用户取消关注后不直接从数据库中删除用户条目，而是改isSubscribed字段为false应该就可以了   版权声明：转载请注明来源 Icyblade@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2013-07-11 15:46 厂商回复： 非常感谢您的报告。这个问题我们已经确认，正在与业务部门进行沟通制定解决方案。如有任何新的进展我们将会及时同步。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-07-10 20:40 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  尼玛 我被你拉黑了？  坐等解释    \n     2013-08-11 12:56 |    \t\t9k九块钱 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:11        | ส็็็็็็็็็็็็็็็็็็็...)\t\t \n  哈哈 楼上的还冤枉啊！ 要不我加你 哈哈！    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}