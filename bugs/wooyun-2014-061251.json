{"id": 2074, "wybug_id": "wooyun-2014-061251", "wybug_title": "通达OA本地文件包含可拿SHELL", "wybug_corp": "通达信科", "wybug_author": "cmd", "wybug_date": "2014-05-18 14:00", "wybug_open_date": "2014-08-16 14:02", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-16：\t细节向公众公开  简要描述： 通达OA本地文件包含漏洞 详细说明：  foeeach($MENU_LEFT as $MENU)    if(is_array($MENU['module'])){        include_once($include_file);}通达OA的/inc/menu_left.php文件include_file参数没有过滤，导致可以包含任意文件。要执行到 include_once($include_file)，需要两个条件，MENU_LEFT参数是数组，他的子成员MENU也要是数组，MENU['module']还要是数组才行。通达OA默认register_globals是开启的，所以可以用GLOBALS传递参数。所以提交GLOBALS[MENU_LEFT][A][module][1]=a&include_file=../robots.txt就可以包含文件了。   漏洞证明：  要想拿shell，就要传一个一句话上去，然后包含。打开发邮件的功能，选择批量插入图片，然后传一个图片后缀的一句话木马1.png抓包，可以看到/module/upload/upload.php返回了{\"id\":\"170818@1405_183125983,\",\"name\":\"1.png*\",那么图片的地址就是../../attach/upload_temp/1405/183125983.1.pngshell地址就是/inc/menu_left.php?GLOBALS[MENU_LEFT][A][module][1]=a&include_file=../../attach/upload_temp/1405/183125983.1.png官网测试成功。\n\n   修复方案：  过滤   版权声明：转载请注明来源 cmd@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2014-05-19 10:29 厂商回复： 1、访问前需要先登录2、无法上传可执行的PHP文件 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-18 14:20 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  赞一个！    \n     2014-05-19 10:34 |    \t\tcmd \t\t\t( 普通白帽子  |\t\t\t        Rank:192 漏洞数:18        )\t\t \n  @通达信科，无法上传可执行的PHP文件？？那我怎么拿的shell    \n     2014-05-19 10:37 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:189        )\t\t \n  @cmd 这是厂商心虚了    :-D      \n     2014-05-19 10:40 |    \t\tcmd \t\t\t( 普通白帽子  |\t\t\t        Rank:192 漏洞数:18        )\t\t \n  只有有个普通账号，就能拿shell，竟然给1rank，无量厂商    \n     2014-05-19 10:44 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:189        )\t\t \n  @cmd 安啦~    这个可能会给RMB      \n     2014-05-19 11:40 |    \t\t爱上襄阳 \t\t\t( 普通白帽子  |\t\t\t        Rank:345 漏洞数:86        | ...)\t\t \n  这个屌·    \n     2014-05-19 14:32 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @cmd 他们不懂包含。。    \n     2014-05-19 17:27 |    \t\t酱油甲 \t\t\t( 普通白帽子  |\t\t\t        Rank:645 漏洞数:126        | 打个酱油，吃个海蜇~)\t\t \n  @cmd 厂商很天真~~    \n     2014-06-08 15:14 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  目测厂商连文件包含漏洞是什么都不知道    \n     2014-06-09 11:48 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  无法上传可执行的PHP文件？恶搞哦。看来官方不知道什么是文件包含？    \n     2014-06-30 12:17 |    \t\tF4K3R \t\t\t( 普通白帽子  |\t\t\t        Rank:297 漏洞数:31        | 学习)\t\t \n  1、访问前需要先登录2、无法上传可执行的PHP文件    \n     2014-07-02 15:35 |    \t\tgreg.wu \t\t\t( 普通白帽子  |\t\t\t        Rank:815 漏洞数:99        | 打酱油的~)\t\t \n  洞主很牛啊，思路清晰，赞一个，厂商丢人丢大发了    \n     2014-07-14 17:04 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  我知道包含，可不可以给一个8k的工作，    \n     2015-01-10 20:00 |    \t\t炊烟 \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:44        | 每一天都需要努力。)\t\t \n  求图片路径。。为什么我找不到    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}