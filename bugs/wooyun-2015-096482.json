{"id": 45282, "wybug_id": "wooyun-2015-096482", "wybug_title": "小蚁摄像头命令执行补丁绕过", "wybug_corp": "上海小蚁科技有限公司", "wybug_author": "路人甲", "wybug_date": "2015-02-10 20:29", "wybug_open_date": "2015-03-27 20:30", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["命令执行", "摄像头", "智能硬件", "智能家居"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-02-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-02-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-02-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-27：\t细节向公众公开  简要描述： 事情是这样的，上周在微博上围观了某安全实验室与某厂摄像头的撕逼大战，看了公开的一个老版本漏洞顿时被震惊了啊，所以就想看看人家手里捂着那个漏洞是怎么回事，四处求人无果，正在这时候，摄像头在微博发布了补丁升级，说修改了安全漏洞，这么看来确实是存在漏洞了，狗我就想能不能拿到固件分析补丁来找到漏洞在哪。那知道这一分析被我发现…….呜呜呜…..补丁哪能这么打….醉了。 详细说明：  狗我的摄像头的固件版本是 1.8.5.1B ，新发布的补丁固件版本是1.8.5.1C首先向办法拿到固件，通过本机架热点的办法抓包发现升级包地址是http://yi-version.qiniudn.com/@/familymonitor/1.8.5.1C_201514062136home（1.8.5.1C_201514062136 是全版本号，在app里面看得到）他在版本后面加了个home，这样也得到了之前固件的地址：http://yi-version.qiniudn.com/@/familymonitor/1.8.5.1B_201513211614homeok,就拿这俩分析下吧：先用firmware-mod-kit解开固件，发现里面修改的文件还比较多，本狗用周末抽空分析比较了这些文件，发现一个可疑修改点，在goolink文件中，新版本的文件中对这个haystack做了过滤，过滤了字符串 telnet,reboot,和字符 | & ; > < 空格等 （想不通为啥要过滤telnet和reboot啊，醉了）\n\n还要求包含字符串 http://yi-version.qiniudn.com/@/familymonitor/\n\n等等，这不是下载固件那个网址么，然后在后面将这个字符串拼接命令并执行，\n\n到这里应该就很明确了，这个命令执行漏洞就在摄像头固件的升级的地方，通过在固件url中注入命令实现命令执行。不过。。。。这补丁也太草率了，看本狗怎么绕它   漏洞证明：  首先的问题是怎么篡改url，本狗采用的办法是劫持篡改app版本查询接口的返回结果。\n\n再来个清晰的图 \n\n(反引号)Wireshark 抓包就能看到执行结果\n\n\n\nWhoami返回结果root不过限制了url长度，想想我能干什么  ….halt…rm\\t-rf\\t/……?而且，这个地方这个字符串会在通过命令在三个程序中传递 goolink->getLoadFile->cloudAPI，就意味着会进行两次shell解析虽然限制比较大，但还是有非常大的想象空间的。   修复方案：  不能这样过滤啊，过滤telnet,reboot算什么事啊。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2015-02-13 21:03 厂商回复： 非常感谢这位白帽子以及所有关心这个漏洞的热心人对小蚁科技的关注！正如这位白帽子所言，这个漏洞实际上就是之前的一个漏洞的延续。我们的工程师在修复漏洞时思考的不够全面，导致了补丁没有完全生效。这个漏洞本质上是手机所在的网络被劫持导致的，但是考虑到1，手机用户处于一个非常分散的网络环境中，因此很难出现大量的连接摄像头的手机被劫持的可能性；2，因为摄像头本身做了一些限制，因此无法利用这个漏洞获取用户的视频和音频，也无法获取用户的wifi密码信息；3，摄像头仅在做升级操作时，才有可能引发此漏洞，正常使用中是无法利用这个漏洞的；即使升级时，被人利用这个漏洞恶意的注入了指令，导致摄像头异常，也可以通过手动升级对摄像头进行修复。因此我们认为这个是一个在非常特定的场合下才会出现的漏洞，对极个别的用户可能会造成一定的影响。谢谢大家的关注！再次感谢这位热心的白帽子！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-02-10 17:17 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  你们真是的~! 关注13个 一个都不评论！！！    \n     2015-02-10 20:38 |    \t\t天地不仁 以万物为刍狗 \t\t\t( 普通白帽子  |\t\t\t        Rank:977 漏洞数:264        | 天地本不仁 万物为刍狗)\t\t \n  @mango  卧槽  大神  又是你  膜拜下  沾沾神气    \n     2015-02-10 20:45 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2360 漏洞数:406        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  你们真是的~! 关注18个 才两个人评论！！！     \n     2015-02-10 21:52 |    \t\t问题来了 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:23        | 挖漏洞哪家强)\t\t \n  目测得加入wifi,希望不要是管理员权限才能执行.    \n     2015-02-11 00:49 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  我擦，关注26个，才5个评论~~~你们好过分。。    \n     2015-02-11 11:22 |    \t\tpyhwx \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | ....)\t\t \n  \"狗我就想能不能拿到固件分析补丁来找到漏洞在哪\"    \n     2015-02-13 21:54 |    \t\t野狼 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | CcAv TeAm成员，CCAV11站长，白帽子。)\t\t \n  @pyhwx 亮了    \n     2015-02-14 09:43 |    \t\t’‘Nome \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:19        | 在此感谢 @M4sk @mango @裤裆 @泳少 @5up3r...)\t\t \n  @上海小蚁科技有限公司  真有道。。。。。有漏洞修复不就好了，，，，说这话的意思是说没太大影响？？？    \n     2015-02-14 09:47 |    \t\t’‘Nome \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:19        | 在此感谢 @M4sk @mango @裤裆 @泳少 @5up3r...)\t\t \n  @上海小蚁科技有限公司  感觉你们和小米一样，，    \n     2015-02-14 19:31 |    \t\tlaoyao \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:5        | ด้้้้้็็็็็้้้้้็็็็...)\t\t \n  。。。    \n     2015-02-15 10:02 |    \t\t野狼 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | CcAv TeAm成员，CCAV11站长，白帽子。)\t\t \n  @’‘Nome 小蚁科技前身叫云蚁科技，就是因为与小米的合作而改名    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}