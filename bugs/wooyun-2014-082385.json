{"id": 43559, "wybug_id": "wooyun-2014-082385", "wybug_title": "kppw任意文件上传-2", "wybug_corp": "KPPW", "wybug_author": "路人甲", "wybug_date": "2014-11-07 16:35", "wybug_open_date": "2015-02-05 16:36", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-07：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-02-05：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： KPPW是客客团队主打的开源威客系统，同类开源建站产品的领跑者，搭建无物流电子商务在线服务交易平台的首选系统。2014年6月新版KPPW2.5发布了，新版借助客客团队近4年来威客行业的开源产品和商业项目的成熟经验，对前端功能进行了深入改进。KPPW从产品规划、UI设计、程序开发多个环节进行了优化，在未做框架重构情况下对程序进行更优秀的改进。  详细说明：  \nkeke_user_avatar_class.php文件：\tstatic function uploadavatar($uid) {\t\t@header ( \"Expires: 0\" );\t\t@header ( \"Cache-Control: private, post-check=0, pre-check=0, max-age=0\", FALSE );\t\t@header ( \"Pragma: no-cache\" );\t\tif (empty ( $uid )) {\t\t\treturn - 1;\t\t}\t\tif (empty ( $_FILES ['Filedata'] )) {\t\t\treturn - 3;\t\t}\t\tlist ( $width, $height, $type, $attr ) = getimagesize ( $_FILES ['Filedata'] ['tmp_name'] );\t\t$imgtype = array (1 => '.gif', 2 => '.jpg', 3 => '.png' );\t\t$filetype = $imgtype [$type];\t\tif (! $filetype)\t\t\t$filetype = '.jpg';\t\t$tmpavatar = _DATADIR . './tmp/upload' . $uid . $filetype;\t\tfile_exists ( $tmpavatar ) && @unlink ( $tmpavatar );\t\tif (@copy ( $_FILES ['Filedata'] ['tmp_name'], $tmpavatar ) || @move_uploaded_file ( $_FILES ['Filedata'] ['tmp_name'], $tmpavatar )) {\t\t\t@unlink ( $_FILES ['Filedata'] ['tmp_name'] );\t\t\tlist ( $width, $height, $type, $attr ) = getimagesize ( $tmpavatar );\t\t\tif ($width < 10 || $height < 10 || $type == 4) {\t\t\t\t@unlink ( $tmpavatar );\t\t\t\treturn - 2;\t\t\t}\t\t} else {\t\t\t@unlink ( $_FILES ['Filedata'] ['tmp_name'] );\t\t\treturn - 4;\t\t}\t\t$avatarurl = _DATAURL . '/tmp/upload' . $uid . $filetype;\t\treturn $avatarurl;\t}在这里$tmpavatar = _DATADIR . './tmp/upload' . $uid . $filetype; 是保存的文件名，在这里uid没有进行过滤，也没有进行长度限制，由于开了GPC 无法利用%00截断。这里就用长文件名截断\n\n\n\n\n   漏洞证明：  \n\n\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}