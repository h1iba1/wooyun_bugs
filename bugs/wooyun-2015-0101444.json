{"id": 36614, "wybug_id": "wooyun-2015-0101444", "wybug_title": "xdcms最新版注入", "wybug_corp": "www.xdcms.cn", "wybug_author": "Xser", "wybug_date": "2015-03-16 16:57", "wybug_open_date": "2015-06-19 16:59", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-21：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-19：\t细节向公众公开  简要描述： XDcms企业网站管理系统是一套完全开源的通用的内容管理系统。主要使用php+mysql+smarty技术基础进行开发，XDcms采用OOP（面向对象）方式进行基础运行框架搭建。模块化开发方式做为功能开发形式。框架易于功能扩展，代码维护，二次开发能力优秀。XDcms开发团队具有多年网站开发经验，经过几年时间的沉淀，让我们更懂您的需求。系统特点：内容管理模型，自定义字段，更方便扩展功能。自带模型：单页模型、新闻模型、产品模型、招聘模型栏目自定义，便于内容管理模板管理，后台编辑模板更方便邮件发送，表单留言自动发送邮件到邮箱数据缓存，访问速度更快会员自定义模型、字段结合Smarty开发的万能loop标签，数据调用更简单、更方便内容模块化，二次开发更便捷。自带模块：幻灯片、QQ客服、友情链接、自定义表单(在线留言、简历管理) 后台菜单智能管理，所有后台可添加、删除 详细说明：  fun.inc.php\nfunction safe_html($str){\tif(empty($str)){return;}\t$str=preg_replace('/select|insert | update | and | in | on | left | joins | delete |\\%|\\=|\\/\\*|\\*|\\.\\.\\/|\\.\\/| union | from | where | group | into |load_file|outfile/','',$str);\treturn htmlspecialchars($str);}注入文件member/index.php\tpublic function register_save(){\t\t$username=safe_html($_POST['username']);\t\t$password=$_POST['password'];\t\t$password2=$_POST['password2'];\t\t$fields=$_POST['fields'];\t\tif(empty($username)||empty($password2)||empty($password)){\t\t\tshowmsg(C('material_not_complete'),'-1');\t\t}\t\tif(!strlength($username,5)){\t\t\tshowmsg(C('username').C('str_len_error').'5','-1');\t\t}\t\tif(!strlength($password,5)){\t\t\tshowmsg(C('password').C('str_len_error').'5','-1');\t\t}\t\tif($password!=$password2){\t\t\tshowmsg(C('password_different'),'-1');\t\t}\t\t$password=md5(md5($password));\t\t//注入\t\t$user_num=$this->mysql->num_rows(\"select * from \".DB_PRE.\"member where `username`='$username'\");//判断会员是否存在\t\tif($user_num>0){\t\t\tshowmsg(C('member_exist'),'-1');\t\t}\t\t$ip=safe_replace(safe_html(getip()));\t\t$this->mysql->db_insert('member',\"`username`='\".$username.\"',`password`='\".$password.\"',`creat_time`='\".datetime().\"',`last_ip`='\".$ip.\"',`is_lock`='0',`logins`='0',`groupid`='1'\");//插入主要字段——用户名、密码\t\t$last_id=$this->mysql->insert_id();\t\t\t\t//插入附属字段\t\t$field_sql='';\t\tforeach($fields as $k=>$v){\t\t\t$f_value=$v;\t\t\tif(is_array($v)){\t\t\t\t$f_value=implode(',',$v);\t\t\t}\t\t\t$field_sql.=\",`{$k}`='{$f_value}'\";\t\t}\t\t$field_sql=substr($field_sql,1);\t\t$query=$this->mysql->query($field_sql);\t\t\t\tshowmsg(C('register_success'),'index.php?m=member&f=register');\t}\n $fields没有过滤。\nforeach($fields as $k=>$v){\t\t\t$f_value=$v;\t\t\tif(is_array($v)){\t\t\t\t$f_value=implode(',',$v);\t\t\t}\t\t\t$field_sql.=\",`{$k}`='{$f_value}'\";\t\t}\t\t$field_sql=substr($field_sql,1);\t\t$query=$this->mysql->query($field_sql);\n重组sql语句。带入查询。找到注册页面输入用户密码 在姓名或者邮箱填写注入代码即可。写了个软件测试下，有些版权敏感的就涂了\n\n   漏洞证明：  fun.inc.php\nfunction safe_html($str){\tif(empty($str)){return;}\t$str=preg_replace('/select|insert | update | and | in | on | left | joins | delete |\\%|\\=|\\/\\*|\\*|\\.\\.\\/|\\.\\/| union | from | where | group | into |load_file|outfile/','',$str);\treturn htmlspecialchars($str);}注入文件member/index.php\tpublic function register_save(){\t\t$username=safe_html($_POST['username']);\t\t$password=$_POST['password'];\t\t$password2=$_POST['password2'];\t\t$fields=$_POST['fields'];\t\tif(empty($username)||empty($password2)||empty($password)){\t\t\tshowmsg(C('material_not_complete'),'-1');\t\t}\t\tif(!strlength($username,5)){\t\t\tshowmsg(C('username').C('str_len_error').'5','-1');\t\t}\t\tif(!strlength($password,5)){\t\t\tshowmsg(C('password').C('str_len_error').'5','-1');\t\t}\t\tif($password!=$password2){\t\t\tshowmsg(C('password_different'),'-1');\t\t}\t\t$password=md5(md5($password));\t\t//注入\t\t$user_num=$this->mysql->num_rows(\"select * from \".DB_PRE.\"member where `username`='$username'\");//判断会员是否存在\t\tif($user_num>0){\t\t\tshowmsg(C('member_exist'),'-1');\t\t}\t\t$ip=safe_replace(safe_html(getip()));\t\t$this->mysql->db_insert('member',\"`username`='\".$username.\"',`password`='\".$password.\"',`creat_time`='\".datetime().\"',`last_ip`='\".$ip.\"',`is_lock`='0',`logins`='0',`groupid`='1'\");//插入主要字段——用户名、密码\t\t$last_id=$this->mysql->insert_id();\t\t\t\t//插入附属字段\t\t$field_sql='';\t\tforeach($fields as $k=>$v){\t\t\t$f_value=$v;\t\t\tif(is_array($v)){\t\t\t\t$f_value=implode(',',$v);\t\t\t}\t\t\t$field_sql.=\",`{$k}`='{$f_value}'\";\t\t}\t\t$field_sql=substr($field_sql,1);\t\t$query=$this->mysql->query($field_sql);\t\t\t\tshowmsg(C('register_success'),'index.php?m=member&f=register');\t}\n $fields没有过滤。\nforeach($fields as $k=>$v){\t\t\t$f_value=$v;\t\t\tif(is_array($v)){\t\t\t\t$f_value=implode(',',$v);\t\t\t}\t\t\t$field_sql.=\",`{$k}`='{$f_value}'\";\t\t}\t\t$field_sql=substr($field_sql,1);\t\t$query=$this->mysql->query($field_sql);\n重组sql语句。带入查询。找到注册页面输入用户密码 在姓名或者邮箱填写注入代码即可。写了个软件测试下，有些版权敏感的就涂了\n\n   修复方案：  你们懂   版权声明：转载请注明来源 Xser@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-06-19 16:59 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-28 22:50 |    \t\t二愣子 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:22        | 毛毛你是个好姑娘)\t\t \n  你好，请问你说的最新版？是在哪里下载的呢？    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}