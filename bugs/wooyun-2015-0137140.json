{"id": 71377, "wybug_id": "wooyun-2015-0137140", "wybug_title": "万户OA系统任意文件上传4处打包可影响公网大量企业OA", "wybug_corp": "万户网络", "wybug_author": "路人甲", "wybug_date": "2015-08-28 17:47", "wybug_open_date": "2015-11-26 15:50", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-31：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-26：\t细节向公众公开  简要描述： 第三处突破了前人没有突破的上传点 详细说明：      万户网络的OA系统用户量非常非常非常非常非常巨大，公网暴露的就至少上千的OA系统！！涉及大量的客户：包括中国国家图书馆、中联重科、美特斯邦威、哈药集团、北京市国资委以及大量政府的OA系统都使用的是万户Ezoffice，并且危害巨大，可直接获取webshell，影响的系统可谓是危害大！官方部分客户列表：http://**.**.**.**/cn/index_74.html\n总结：第一处：/defaultroot/govezoffice/gov_documentmanager/senddocument_import.jsp  构造参数上传第二处：/defaultroot/customize/formClassUpload.jsp   无限制任意上传第三处：/defaultroot/public/jsp/smartUploadPic.jsp  构造参数截断URL和上传的文件名#需服务器支持URL允许存在空字节！第四处：/defaultroot/work_flow/jsFileUpload.jsp  后门！简直就是后门，只能上传jsp文件！\n   漏洞证明：  【免责声明：以下为漏洞测试报告非攻击性操作，仅供证明上传漏洞未获取任何有效数据，案例仅供国家互联网应急中心测试使用，其它人不可利用漏洞进行恶意破坏，否则后果自负，漏洞列举的案例在厂商确认后均做打码处理，感谢您的支持与理解！】【测试表单在测试代码区域】上传的测试代码内容为：\n<%out.print(\"Powered by WooYun!\");%>\n第一处：/defaultroot/govezoffice/gov_documentmanager/senddocument_import.jsp  构造fileType=jsp来完成上传利用第一处上传的表单，直接上传jsp文件；直接返回文件名，如图：\n\n文件在upload参数设置的“archives”：/defaultroot/upload/archives/\n\n案例：\n\nmask 区域\n1.http://**.**.**/defaultroot/govezoffice/gov_documentmanager/senddocument_import.jsp_2.http://**.**.**/defaultroot/govezoffice/gov_documentmanager/senddocument_import.jsp_3.://**.**.**/defaultroot/govezoffice/gov_documentmanager/senddocument_import.jsp_4.://**.**.**/defaultroot/govezoffice/gov_documentmanager/senddocument_import.jsp_5.http://**.**.**/defaultroot/govezoffice/gov_documentmanager/senddocument_import.jsp\n\n**********************************华丽的分割线************************************第二处：/defaultroot/customize/formClassUpload.jsp  没有任何限制直接上传，上传后的文件名是原文件名。存在defaultroot/devform/customize/ 目录下\n\n\n\n案例：\n\nmask 区域\n1.http://**.**.**/defaultroot/customize/formClassUpload.jsp_2.http://**.**.**//defaultroot/customize/formClassUpload.jsp_3.http://**.**.**/defaultroot/customize/formClassUpload.jsp_4.http://**.**.**/defaultroot/customize/formClassUpload.jsp_5.http://**.**.**/defaultroot/customize/formClassUpload.jsp\n\n**********************************华丽的分割线************************************第三处：/defaultroot/public/jsp/smartUploadPic.jsp  利用第三处的构造参数截断URL和上传的文件名#需服务器支持URL允许存在空字节！文件上传存在/defaultroot/upload/archives/下，注：如果服务器不支持在GET中存在空字节，那么会出现Bad Request的字样。**.**.**.**:7001作为测试案例\n\n\n\n至于哪些服务器允许空字节在GET中截断的案例我不可能一个一个挑出来给你，只能枚举一些，自己测试吧。\n\nmask 区域\n1.http://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_2.://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_3.http://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_4.://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_5.://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_6.://**.**.**//defaultroot/public/jsp/smartUploadPic.jsp_7.://**.**.**//defaultroot/public/jsp/smartUploadPic.jsp_8.http://**.**.**//defaultroot/public/jsp/smartUploadPic.jsp_9.://**.**.**//defaultroot/public/jsp/smartUploadPic.jsp_10.http://**.**.**//defaultroot/public/jsp/smartUploadPic.jsp_11.://**.**.**//defaultroot/public/jsp/smartUploadPic.jsp_*****ublic/jsp/sma*****12.://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_13.://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_14.://**.**.**//defaultroot/public/jsp/smartUploadPic.jsp_15.://**.**.**//defaultroot/public/jsp/smartUploadPic.jsp_16.http://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_17.http://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_18.://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_*****ublic/jsp/sma*****19.://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_20.://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_21.http://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp_22.http://**.**.**/defaultroot/public/jsp/smartUploadPic.jsp\n\n**********************************华丽的分割线************************************第四处：/defaultroot/work_flow/jsFileUpload.jsp   后门，简直就是后门！因为它只允许你上次JSP文件，其它的文件还不能让你上传\n\n文件上传在：/defaultroot/devform/workflow/ 原上传文件名。\n\n案例：\n\nmask 区域\n1.http://**.**.**/defaultroot/work_flow/jsFileUpload.jsp_2.http://**.**.**/defaultroot/work_flow/jsFileUpload.jsp_3.://**.**.**/defaultroot/work_flow/jsFileUpload.jsp_4.http://**.**.**/defaultroot/work_flow/jsFileUpload.jsp_5.://**.**.**/defaultroot/work_flow/jsFileUpload.jsp\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2015-08-28 15:49 厂商回复： CNVD确认并复现所述情况，已由CNVD通过软件生产厂商（或网站管理方）公开联系渠道向其邮件（和电话）通报，由其后续提供解决方案并协调相关用户单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-26 19:08 |    \t\t有归于无 \t\t\t( 实习白帽子  |\t\t\t        Rank:94 漏洞数:18        | 有归于无)\t\t \n  像泛微那样的无限制getshell吗？    \n     2015-08-31 18:40 |    \t\t苏安泽 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:26        | 看什么看，没见过人家资料啊？ฏ๎๎๎๎๎...)\t\t \n  卧槽，前几天提交的是一处，最后果断不过，你提交的就过了....    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}