{"id": 72817, "wybug_id": "wooyun-2015-0147799", "wybug_title": "西门子S7-300存在绕过权限修改寄存器值", "wybug_corp": "西门子", "wybug_author": "路人甲", "wybug_date": "2015-10-19 16:59", "wybug_open_date": "2016-01-21 11:10", "wybug_type": "权限控制绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["工控"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-26：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-21：\t细节向公众公开  简要描述： S7编程软件是官方与西门子S7-300进行通信的软件，通信协议是S7协议，通过抓取S7数据包，绕过权限，发送数据包给西门子S7-300.可通过修改数据包字段达到修改西门子S7-300寄存器（比如I区、Q区)的值。 详细说明：  首先用S7编程软件建立与西门子S7-300建立通信的程序，用wireshark抓包，通过一些攻击方式以及协议格式分析，得出没有认证字段，然后通过下载程序获得其通信流程，通过构造I区、Q区下置数据包，发送数据包给西门子S7-300。没发送Q区数据包之前：\n\n发送Q区数据包：\n\n没有发送I区数据包:\n\n发送I区数据包：\n\n   漏洞证明：  每个程序所编写程序的符号表和监视变量不一致，下面是我所监视的变量表：\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2015-10-23 11:03 厂商回复： CNVD未直接复现，已经直接转报给西门子（中国）有限公司，由其后续反馈并提供解决方案。 最新状态： 2015-11-11：更新厂商回复:由于S7 300 PLC已经销售了很长时间，装机数量巨大，为保证系统间的兼容性，西门子无法修改S7协议。因此，西门子（如在安全通告中）建议客户采取如下安全防护措施：1.      Restrict physical and electronic access to automation products, networks and systems to only those individuals authorized to be in contact with control system equipment2.      Employ layered security and defense-in-depth methods in system design to restrict and control access to individual products and control networks. Refer tohttp://www.siemens.com/industrialsecurity for comprehensive information about implementing validated architectures designed to deliver these measures.3.      Block all traffic to the PROFIBUS, MPI and PROFINET protocol based devices from outside the Manufacturing Zone by restricting or blocking Ethernet access to TCP and UDP Port# 102 using appropriate security technology (e.g. SCALANCE S612  Module order no. 6GK5612-0BA00-2AA3 or similar effective firewall, or other security appliance). 对于新建系统，建议客户尽可能第采用最新一代的S7 1200（新版本固件）及S7-1500。1200/1500系列PLC采用的是S7+协议通信，新协议在安全上做了针对性的设计，目前的这种重放攻击将无法修改S7 1200/1500 PLC的变量取值。  ", "replys": "漏洞评价：\n评价\n     2015-10-19 17:08 |    \t\tYY-2012 \t\t\t( 普通白帽子  |\t\t\t        Rank:3231 漏洞数:678        | 意淫，是《红楼梦》原创的词汇，但后来演变...)\t\t \n  之前一直接触这番工控，，为何当时没想过现场测试。。    \n     2015-10-19 17:09 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:267 漏洞数:20        | 当我又回首一切,这个世界会好吗?)\t\t \n  这两个区干啥的呢？    \n     2015-10-19 17:50 |    \t\tmtfly \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:12        | 啥都不会)\t\t \n  卧槽，这才是真正的工控啊    \n     2015-10-19 18:37 |    \t\t珈蓝夜宇 \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:33        | 人不彻底绝望一次，就不会懂得什么是自己最...)\t\t \n  我能猜到你是谁    \n     2015-10-20 10:22 |    \t\tHuacon \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:6        | 专注工控安全、渗透)\t\t \n  @珈蓝夜宇 何出此言？    \n     2015-10-21 11:21 |    \t\t大漠長河 \t\t\t( 实习白帽子  |\t\t\t        Rank:66 漏洞数:10        | ̷̸̨̀͒̏̃ͦ̈́̾( 天龙源景区枫叶正...)\t\t \n  @Huacon ...威武    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}