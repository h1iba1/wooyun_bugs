{"id": 10633, "wybug_id": "wooyun-2015-0121016", "wybug_title": "记一次成功的漫游人人网内部网络至主站沦陷(人人/56网用户告急)", "wybug_corp": "人人网", "wybug_author": "蓝冰", "wybug_date": "2015-06-17 08:29", "wybug_open_date": "2015-08-01 09:50", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "渗透测试思路", "安全意识不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-01：\t细节向公众公开  简要描述： 总结这次渗透测试就是 信息收集和撞库审核求赐一道闪电PS:未动一丝数据 勿查水表 详细说明：  0x00内网入口点首先发现一个人人开放平台文档系统http://wiki.dev.renren.com通过翻找链接,找到一处用户名泄露的页面http://wiki.dev.renren.com/wiki/Special:Listusers\n\n看用户名命名方式,可猜测出这些用户是人人网员工的用户名接着通过扫描子域名发现一个排期系统.http://bb.renren.com/发现没有验证码可以进行暴力破解用户名是邮箱地址, 人人的邮箱后缀是 @renren-inc.com通过在开放平台得到的用户名 将两者拼接进行弱口令暴力破解成功爆出密码为 123456的用户进入系统后发现权限是管理员接着在后台发现了一处上传点 完全无过滤可上传一个JSP木马\n\n然后菜刀连接\n\n处于内网,而且是root权限然后在服务器翻找数据库,找到两枚\n\n\n\n泄漏人人内部员工邮箱,由于密码是salt md5加密 不进行破解 利用此服务器跳进内网其中 10.22.198.16 数据库貌似是一个运维的,里面存有40多个数据库账号密码经测试可登录里面含有人人活动的一些数据.数据量大0x01进入内网利用reGeorg代理进内网首先把tunnel.jsp代理脚本放到网站服务器上然后连接过去\n\n接着用一些socks代理软件连接本地2333端口就可以了至此内网漫游准备就绪0x02内网漫游经过人人漫游者前辈们的教训,为了防止被T没有立马开扫,首先去乌云收集一些人人内网的一些信息 WooYun: 一次失败的漫游人人内网 \n\n#1拿到了一些内网的应用,那么先从这些应用开刀但这些应用meeting.renren-inc.comwe.renren-inc.com都跳转到了一个统一认证平台https://passport.renren-inc.com/由于有次数限制导致爆破不了,既然如此只能乖乖找漏洞很幸运的在密码找回处发现一个SQL注入\n\n支持union查询通过注入找到两个比较重要的表sysuser 用户密码表(md5加密)logonlog 登录历史表 里面存有base64编码的密码 也就是说可以看到任意员工的密码的变换过程有助于后续的撞库攻击\n\n从库中破了 sysadmin2这个用户的密码 进行登录\n\nOA系统,管理员权限\n\n\n\n会议室预定系统\n\n资产管理系统\n\n\n\n#2接着找到一个bbs论坛dz7.2http://bbs.renren-inc.com存在faq.php的注入,通过注入拿到了uc_key但是config.inc.php没有写入权限,getshell失败随后发现该站登录也是通过统一认证平台于是首先通过注入列出所有论坛管理员的邮箱然后通过邮箱在利用统一认证的注入漏洞,破解出密码登录到bbs论坛接着后台登录,利用后台xml上传一个phpwebshellgetshell成功\n\n\n\n继续泄漏员工信息#3 接着又找到一个dz7.2论坛http://daxue.renren-inc.com可惜的是faq.php文件被删但是dz7.2还有一个投票注入,需要积分50找到一个管理员,利用邮箱从统一认证平台登录到论坛发布投票进行注入,但数据库中的uc_key被加密是124位的导致利用不了都知道从前台登录后台需要重新输入一次密码,而我是直接从认证平台登录的而且管理员密码也破解不出来,所以进不了后台纠结了一阵,扫了一下目录发现存在test.php 是phpinfo信息,拿到网站物理路径数据库权限是root,刚好数据库与网站是同服.直接利用load_file()读取config.inc.php的uc_key利用uc_key成功getshell\n\n数据库就不贴了,也是员工的到这 搜集过来的内网应用基本搞定于是无耻的接着在乌云收集人人网信息 233 WooYun: 我是如何用最简单直接的方法进入人人网的（可导致内部信息泄漏） 通过这里的信息 找到马**这个人的邮箱利用统一认证注入漏洞  找出这个人的密码,撞库发现不对随后查找logonlog表 发现这个人的密码变更规律 每次基本只改一位于是挨个试过去 成功登录邮箱\n\n搜索vpn没有搜出来然后搜索密码 找到广告系统和密码也就是上面那个乌云链接里的广告系统登录进去发现该用户的权限是最高的\n\n46652家广告,还可以对任意一个厂家广告进行管理继续搜索邮箱找到两个系统http://jira.d.xiaonei.com/        jira项目平台http://wiki.d.xiaonei.com        Confluence 沟通协作平台两个系统共用一个账号,弱口令很严重jira\n\n基本涵盖所有的项目Confluence 沟通协作平台\n\n这里面猛料太多了,各种数据库密码,服务器信息和项目信息,对之后的渗透测试给予了很大的帮助从这个沟通协作平台搞到了一个vpn申请流程,并成功撞到了一个部门负责人的邮箱vpn的申请需要部门负责人的抄送登录邮箱搜索vpn,结果告诉我vpn的用户名是邮箱前缀和邮箱密码 23333333还是不够经验于是利用此人的邮箱账号密码成功登录vpn,之前那个代理脚本毕竟比不过vpn稳定果断连vpn杀入内网https://vpn.renren-inc.com/dana-na/auth/url_default/welcome.cgi?p=failed\n\n利用沟通协作平台继续收集信息,并找出运维人员或者领导级的邮箱并进行撞库得到若干系统人人运维管理系统\n\n服务器资产管理系统\n\n目测涵盖了人人网所有正在使用的服务器离线数据平台\n\nbugs报告平台\n\n技术评级系统\n\n这里猛料貌似也挺多PE系统（业务更新展示,修改报警）\n\nGanglia中的导航页,包含了外网各系统的链接\n\nzabbix监控系统弱口令 admin/zabbix\n\n\n\n服务器很多可反弹一个shell至于 zabbix agent能不能执行 没测试过 这玩意成功几率有点低......随手捡到一个,windows3389权限,貌似是网关?\n\n0x03终极目标-人人主站之前通过翻找协作平台发现人人网用svn托管所有项目代码于是在协作平台搜索加翻找 找出主工程也就是主站的svn地址并在邮箱找到这么一个信息\n\n由此可见每周都会进行一次代码更新,于是想到这么个思路找出主工程开发人员 并拿到svn权限,然后在svn留一个webshell这样等周三代码更新到线上环境后 主站也就随之沦陷了首先从协作平台找到一份表格 从中获取了负责主工程的一些名单利用此名单 继续撞库 进入邮箱 但是没找到有关svn的密码信息通过之前的邮箱信息收集 猜测 svn的用户名是邮箱前缀 密码是Kerberos认证的密码但是 Kerberos  的初始密码是通过手机发送的于是利用统一认证平台注入,找出密码变更规律猜测出svn 密码\n\n然后留了一个 比较隐蔽的webshell之后就是漫长的等待了等待的同时继续信息搜集 在jira项目平台找到这么一个信息\n\n这个ip地址也是指向的人人主站 并且可以正常登录然后周一的时候发现svn里的代码已经更新了等到周二 去试了下主站有没有更新结果没有,但10.4.22.51这个ip上更新了然后试了下 有没有带回webshell 结果报500错误 果然带来了PS:其实10.4.22.51相当于主站了有外网ip.另上图已说明从10.4.22.51获取上线,所以默认解析的主站ip沦陷是早晚的事,写该文的日期为周二,常规是周三会更新到线上环境\n\n接着就是找数据库链接了,但翻了几个小时也没找到 netstat -an |grep 3306 是有连接的但就是找不到,于是在该服务器上执行tcpdump 然后登录一次主站,结束抓包\n\n在数据包中找到了用户名和明文密码\n\n把tcpdump数据包导入到wireshark中 发现是从10.3.16.222 返回了 数据库连接URL信息(ICEP协议是什么鬼…….)然后顺利连接数据库(数据库太多了….找出用户库也是一个苦力活啊)\n\n人人手机注册用户千万\n\n人人+56 总计数亿(人人手机用户也包括在这里)从数据库中找到了我12年注册的人人账号,密码破解出来正是我当时设置的密码人人网的肯定可以登录 至于56网被卖了具体不知道什么情况 但测试了几个56的均可登录,库应该还是比较新的\n\n\n\n   漏洞证明：  已证明   修复方案：  统一认证平台出漏洞往往是很致命的...还有就是弱口令问题把漏洞补完,并要求全体员工统一更换密码   版权声明：转载请注明来源 蓝冰@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-06-17 09:48 厂商回复： 非常感谢，我们尽快处理！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-17 08:33 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  干得漂亮！    \n     2015-06-17 08:37 |    \t\tPgHook \t\t\t( 普通白帽子  |\t\t\t        Rank:964 漏洞数:115        | ...........................................)\t\t \n  干得漂亮！    \n     2015-06-17 08:38 |    \t\tY4ngshu \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:7        | 十年磨一剑。)\t\t \n  终于来了！    \n     2015-06-17 08:42 |    \t\tkow \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:4        | 研表究明，汉字的序顺并不定一能影阅响读，...)\t\t \n  居然没有打雷，不科学啊~~    \n     2015-06-17 09:00 |    \t\t啊L川 \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:39        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  干得漂亮！    \n     2015-06-17 09:09 |    \t\t打电话叫人 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 没事，我打电话叫人)\t\t \n  干得漂亮！     \n     2015-06-17 09:19 |    \t\tJumbo \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:29        | 猫 - http://www.chinabaiker.com)\t\t \n  Niu    \n     2015-06-17 09:20 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  这个标题，得长期蹲坑才能实现啊。    \n     2015-06-17 09:21 |    \t\tY4ngshu \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:7        | 十年磨一剑。)\t\t \n  @猪猪侠 洞主要约猪猪侠！！约约约么    \n     2015-06-17 09:24 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  这个标题，得长期蹲坑才能实现啊。    \n     2015-06-17 09:25 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  你们都是大黑阔啊    \n     2015-06-17 09:27 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  好叼    \n     2015-06-17 09:27 |    \t\twps2015 \t\t\t( 普通白帽子  |\t\t\t        Rank:426 漏洞数:60        | 不叫一日荒废)\t\t \n  新手点赞    \n     2015-06-17 09:30 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  干得漂亮啊    \n     2015-06-17 09:30 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:84        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  卧槽 打雷了    \n     2015-06-17 09:36 |    \t\t残废 \t\t\t( 普通白帽子  |\t\t\t        Rank:179 漏洞数:40        | 我是残废，啦啦啦啦)\t\t \n  干的漂亮   赤裸裸的啪啪    \n     2015-06-17 09:43 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  人人网求1rank啊！    \n     2015-06-17 09:45 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  apt啊    \n     2015-06-17 09:52 |    \t\t理工小强 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 学一行恨一行,目前从事无线行业。)\t\t \n  Good Job    \n     2015-06-17 09:58 |    \t\t啊L川 \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:39        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  卧槽 下雨了    \n     2015-06-17 10:03 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  我以为是20，剩下5 rank是因为什么考虑？    \n     2015-06-17 10:19 |    \t\tucifer \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:52        | 萌萌哒~)\t\t \n  卧槽，撸了多久~    \n     2015-06-17 10:34 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @疯狗 剩下5 rank是安全部门的尊严，给15表示出强烈的不服。    \n     2015-06-17 10:38 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:84        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  @猪猪侠 @疯狗 打雷 是不是会翻倍奖励    \n     2015-06-17 10:38 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @ucifer 十多天 ～    \n     2015-06-17 10:39 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @疯狗 @猪猪侠 哈哈 这个解释好啊    \n     2015-06-17 11:08 |    \t\t鸟云厂商  \t\t\t( 核心白帽子 |\t\t\t        Rank:1313 漏洞数:146        | 中国菜鸟)\t\t \n  收下我的膝盖吧    \n     2015-06-17 11:14 |    \t\t’‘Nome \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:19        | 在此感谢 @M4sk @mango @裤裆 @泳少 @5up3r...)\t\t \n  @猪猪侠 你的回答好像有点欠佳，，，， 剩下3 rank 是运维人的尊严，， 2rank 是开发的尊严！    \n     2015-06-17 11:18 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @鸟云厂商 别闹大牛 ：）    \n     2015-06-17 11:35 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  @猪猪侠 这个评论很wooyun    \n     2015-06-17 14:24 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2015-06-17 17:12 |    \t\t迦南 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:11        | 我不是玩黑，我就是认真)\t\t \n  666666666666666666666666666    \n     2015-06-17 22:35 |    \t\t叫我阿米 \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:18        | 想好了，就去做，没想好，就去试错)\t\t \n  节奏微猛啊    \n     2015-06-27 23:49 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  这个是完全日穿了呀！！！欣赏楼主的思路！！    \n     2015-06-28 13:05 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @phith0n ph大大见笑了  核心就是好...能提前看漏洞 ^_^    \n     2015-07-01 00:24 |    \t\tOops \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:5        | 资深酱油党！)\t\t \n  选择在周三更新是为啥。。    \n     2015-07-07 09:59 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  惨不忍睹！    \n     2015-07-10 05:49 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  牛逼  学习了    \n     2015-07-10 12:10 |    \t\tgreg.wu \t\t\t( 普通白帽子  |\t\t\t        Rank:815 漏洞数:99        | 打酱油的~)\t\t \n  真是牛逼    \n     2015-07-17 16:05 |    \t\txsser_w \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:33        | 哎)\t\t \n  其实这个帖子曝光出来后 带的问题会更多，大家都知道主站的内网IP了。 也知道好多信息  人人网业务太多 一般人不会有那么多时间修改和整理这次渗透的全部信息。。   以后搞站的黑客可以更容易进去了 :)     \n     2015-07-17 21:36 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @xsser_w 嗯 确实想的不够周到 欠考虑了    \n     2015-07-20 09:22 |    \t\txsser_w \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:33        | 哎)\t\t \n  @蓝冰 这个应该怪wooyun  没有周到的考虑到这些问题 只是知道曝光，但是业务这么多 改IP 会牵连一大堆的问题 有的时候改个密码都要通知好多    \n     2015-07-20 16:27 |    \t\tqiaoy \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:16        )\t\t \n  真棒！    \n     2015-07-21 13:53 |    \t\tChu \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:9        | 学习ing。)\t\t \n  搞人人千万不要异地登陆邮箱千万不要异地登陆邮箱不要异地登陆邮箱    \n     2015-08-01 10:25 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  牛逼呀    \n     2015-08-01 10:53 |    \t\t独孤小白兔 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 小明有10个苹果，小红有5个苹果，如果小明...)\t\t \n  又要改密码了....心好累    \n     2015-08-01 11:24 |    \t\t野驴~ \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 充满强烈好奇心的菜鸟。)\t\t \n  @独孤小白兔 在大牛面前改密码有用吗。注销都不一定能抹掉数据库。;）    \n     2015-08-03 12:45 |    \t\t幻老头儿 \t\t\t( 普通白帽子  |\t\t\t        Rank:133 漏洞数:30        | 新手上路。)\t\t \n  @xsser_w 屌屌！    \n     2015-08-03 13:51 |    \t\tanswer \t\t\t( 普通白帽子  |\t\t\t        Rank:347 漏洞数:45        | 答案)\t\t \n  看来来晚了。。。。这么棒    \n     2015-08-06 11:16 |    \t\tGrayTrack \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:14        | 灰色轨迹)\t\t \n  非常精彩，太精彩的渗透了    \n     2015-08-17 21:40 |    \t\t木马游民 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:8        | I love LSD!)\t\t \n  6666666666    \n     2015-08-22 17:37 |    \t\tCroxy \t\t\t( 普通白帽子  |\t\t\t        Rank:513 漏洞数:54        | 只会送人头)\t\t \n  nice    \n     2015-08-24 02:41 |    \t\t黑名单 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:13        | 像个傻瓜似的，为什么。)\t\t \n  楼主蹲坑至少一个月    \n     2015-08-31 15:23 |    \t\twy007 \t\t\t( 实习白帽子  |\t\t\t        Rank:95 漏洞数:10        | 其实我是一名卧底...)\t\t \n  Well done!~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}