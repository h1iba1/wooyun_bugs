{"id": 57641, "wybug_id": "wooyun-2014-053781", "wybug_title": "phpmywind 9枚sql注入漏洞", "wybug_corp": "phpmywind.com", "wybug_author": "′雨。", "wybug_date": "2014-03-18 17:58", "wybug_open_date": "2014-06-16 17:59", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-05-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-16：\t细节向公众公开  简要描述： 过滤不严。位于同一文件中。 详细说明：  在member.php中。注入1 :\nelse if($a == 'delfavorite'){\tif(is_array($checkid))\t{\t\tforeach($checkid as $v)\t\t{\t\t\t$dosql->ExecNoneQuery(\"DELETE FROM `#@__userfavorite` WHERE `id`=$v AND `uname`='$c_uname'\");\t\t}\t}\theader('location:?c=favorite');\texit();}\n数组遍历 然后 带入查询 无单引号。\n\n有图有真相。类似的 2:\nelse if($a == 'delmsg'){\tif(is_array($checkid))\t{\t\tforeach($checkid as $v)\t\t{\t\t\t$dosql->ExecNoneQuery(\"DELETE FROM `#@__message` WHERE `id`=$v AND `nickname`='$c_uname'\");\t\t}\t}\n原理一样 都不多说了。类似的3:\nelse if($a == 'delorder'){\tif(is_array($checkid))\t{\t\tforeach($checkid as $v)\t\t{\t\t\t$dosql->ExecNoneQuery(\"DELETE FROM `#@__goodsorder` WHERE `id`=$v AND `username`='$c_uname'\");\t\t}\t}\n类似的4:\nelse if($a == 'delcomment'){\t//是否开去文章评论功能\tif($cfg_comment == 'N') exit();\tif(is_array($checkid))\t{\t\tforeach($checkid as $v)\t\t{\t\t\t$dosql->ExecNoneQuery(\"DELETE FROM `#@__usercomment` WHERE `id`=$v AND `uname`='$c_uname'\");\t\t}\t}\theader('location:?c=comment');\texit();}\n注入 5:\nelse if($a == 'getgoods'){\t$r = $dosql->GetOne(\"SELECT `checkinfo` FROM `#@__goodsorder` WHERE `username`='$c_uname' AND `id`=$id\");\t$checkinfo = explode(',',$r['checkinfo']);\tif(!in_array('getgoods', $checkinfo))\t{\t\t$checkinfo = $r['checkinfo'].',getgoods';\t}\t$dosql->ExecNoneQuery(\"UPDATE `#@__goodsorder` SET checkinfo='$checkinfo' WHERE `username`='$c_uname' AND `id`=$id\");\theader('location:?c=ordershow&id='.$id);\texit();}\n这里$id 可控 并且无intval 直接带入了查询 无单引号 可注入。\n\n不用多说了把?注入6:\nelse if($a == 'applyreturn'){\t$r = $dosql->GetOne(\"SELECT `checkinfo` FROM `#@__goodsorder` WHERE `username`='$c_uname' AND `id`=$id\");\t$checkinfo = explode(',',$r['checkinfo']);\tif(!in_array('applyreturn', $checkinfo))\t{\t\t$checkinfo = $r['checkinfo'].',applyreturn';\t}\t$dosql->ExecNoneQuery(\"UPDATE `#@__goodsorder` SET checkinfo='$checkinfo' WHERE `username`='$c_uname' AND `id`=$id\");\theader('location:?c=ordershow&id='.$id);\n跟注入5一样 不多说。注入7:\nelse if($a == 'getarea'){\t//初始化参数\t$datagroup = isset($datagroup) ? $datagroup   : '';\t$level     = isset($level)     ? $level   : '';\t$v         = isset($areaval)   ? $areaval : '0';\tif($datagroup == '' or $level == '' or $v == '')\t{\t\theader('location:?c=default');\t\texit();\t}\t$str = '<option value=\"-1\">--</option>';\t$sql = \"SELECT * FROM `#@__cascadedata` WHERE `level`=$level And \";\tif($v == 0)\t\t$sql .= \"datagroup='$datagroup'\";\telse if($v % 500 == 0)\t\t$sql .= \"`datagroup`='$datagroup' AND `datavalue`>$v AND `datavalue`<\".($v + 500);\telse\t\t$sql .= \"`datavalue` LIKE '$v.%%%' AND `datagroup`='$datagroup'\";\t\t$sql .= \" ORDER BY orderid ASC, datavalue ASC\";\t\t$dosql->Execute($sql);\twhile($row = $dosql->GetArray())\n这里$level 直接带入查询当中 无单引号 直接注入\n\n注入8:\nelse if($a == 'savecomment'){\t//是否开去文章评论功能\tif($cfg_comment == 'N') exit();\t//初始化参数\t$aid   = isset($aid)   ? $aid   : '';\t$molds = isset($molds) ? $molds : '';\t$body  = isset($body)  ? htmlspecialchars($body) : '';\t$link  = isset($_SERVER['HTTP_REFERER']) ? $_SERVER['HTTP_REFERER'] : '';\t\tif($aid == '' or $molds == '' or $body == '')\t{\t\theader('location:?c=default');\t\texit();\t}\t$reply = '';\t\tif(empty($c_uname))\t{\t\t$uid   = '-1';\t\t$uname = '游客';\t}\telse\t{\t\t$r = $dosql->GetOne(\"SELECT `id`,`expval`,`integral` FROM `#@__member` WHERE `username`='$c_uname'\");\t\t$uid   = $r['id'];\t\t$uname = $c_uname;\t}\t$time  = time();\t$ip    = GetIP();\t$dosql->ExecNoneQuery(\"INSERT INTO `#@__usercomment` (aid,molds,uid,uname,body,reply,link,time,ip,isshow) VALUES ('$aid','$molds','$uid','$uname','$body','$reply','$link','$time','$ip','1')\");\n$link是referer 可控。 并且直接带入了insert中\n\n直接注入注入9:\nelse if($a == 'savefavorite'){\t$aid   = isset($aid)   ? $aid   : '';\t$molds = isset($molds) ? $molds : '';\t$link  = isset($_SERVER['HTTP_REFERER']) ? $_SERVER['HTTP_REFERER'] : '';\tif($aid == '' or $molds == '' or $link == '')\t{\t\theader('location:?c=default');\t\texit();\t}\t$r = $dosql->GetOne(\"SELECT `id`,`expval`,`integral` FROM `#@__member` WHERE `username`='$c_uname'\");\t$uid   = $r['id'];\t$uname = $c_uname;\t$time  = time();\t$ip    = GetIP();\t$r2 = $dosql->GetOne(\"SELECT `aid`,`molds` FROM `#@__userfavorite` WHERE `aid`=$aid and `molds`=$molds\");\tif(!is_array($r2))\t{\t    echo aaaa;exit;\t\t$dosql->ExecNoneQuery(\"INSERT INTO `#@__userfavorite` (aid,molds,uid,uname,link,time,ip,isshow) VALUES ('$aid','$molds','$uid','$uname','$link','$time','$ip','1')\");\t\t\t\t//收藏一条增加1经验值2积分\n跟注入8一样 就不多说了。   漏洞证明：  见详细说明。   修复方案：  无尽的过滤。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-03-26 17:11 厂商回复： 漏洞存在。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-06 20:56 |    \t\t小贱人 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 资深菜鸟，)\t\t \n  mark    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}