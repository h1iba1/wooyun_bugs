{"id": 69572, "wybug_id": "wooyun-2015-0138498", "wybug_title": "91导学网伪静态SQL注入+前台任意用户密码重置+目录遍历等多个漏洞（可刷币/可影响数据库）", "wybug_corp": "91导学网", "wybug_author": "wy007", "wybug_date": "2015-09-02 10:21", "wybug_open_date": "2015-10-17 10:22", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["目录遍历", "数据库账户权限过高", "管理后台对外", "伪静态注入", "任意用户密码重置"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-02：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-10-17：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 这个案例告诉我们...惊喜无处不在... 详细说明：  网站首页：http://www.91daoxue.com/对于这个网站了解不多，简单看了一下，好像是针对小学——高中的一个学习教育平台，听说做的还不错.简单的公司介绍：\n\n本是无意间发现的这个网站，第一眼简单一看网站做了伪静态，不过看着伪静态的规则很简单，参数很明显，于是就测试了一下，结果发现可注入...然后就有了接下来的故事...   漏洞证明：  我们就先从伪静态注入说起吧..伪静态注入点：http://www.91daoxue.com/index.php/Course/content/id/6202先是手工测试了一下，伪静态地址是否存在注入\n\n\n\nOK，判断成功，确实存在注入点.接下来直接丢进注入神器SQLMap中自己跑去吧...检测到注入点：\n\n当前网站所使用数据库和数据库管理员及权限：\n\n所有数据库列表：\n\n\navailable databases [6]:[*] daoxuewang[*] information_schema[*] mysql[*] performance_schema[*] test[*] zhangshiyong\ndaoxuewang数据库的所有表信息：\n\n\nDatabase: daoxuewang[31 tables]+------------------+| v_admin          || v_clabj          || v_cladocs        || v_class          || v_clauser        || v_code           || v_collection     || v_course         || v_docs           || v_error_fl       || v_feedback       || v_firstpic       || v_homework       || v_inout          || v_order          || v_order_item     || v_pingjia        || v_question_reply || v_questions      || v_school         || v_share_class    || v_shop           || v_stuhomework    || v_teacher        || v_tiku           || v_tiku_error_fl  || v_tiku_teacher   || v_uploadfile     || v_user           || v_userpapers     || v_zujuan         |+------------------+\n从上面的表名中可以分析v_admin应该是存放网站管理员的数据表，而v_user和v_teacher分别是网站注册用户和注册教师，下面我们来看一下到底是不是...既然是root权限，我们可以进sql-shell中直接执行MySQL查询语句看一下（本来想直接os-shell进行提权的，无奈不知道网站存放的物理路径，也懒得去继续找爆路径的漏洞）v_user表的数据：\n\n\n\n查了一下，这个表有7746条数据（即注册用户7746个），也还是不算少的。连同其它几个表一起看了一下，数据都还是不少的。\n\n既然有了用户数据，那么就随便找一个登录网站看看能不能有新发现吧。随便从上面加密的MD5密码中找了一条然后进行解密。解密结果：\n\n用户登录页面：\n\n\n\n我们来看看账户管理里面有什么...\n\n意外的发现居然有账户余额（虚拟币...）而且在旁边不远处还有一个是账户提现...\n\n可以看到，这个虚拟币还是很值钱的...等价RMB而且是支持支付宝的...很多黑产牛们的支付宝是不是这么被封的啊...（个人猜测而已~各位淡定，千万不要去搞破坏哦，会被警察叔叔抓的...）好了，为了安全起见就不进一步测试能不能提现了...下面继续我们的渗透测试...既然一开始我们读取了v_admin发现了网站管理员的用户和密码，那么先试着看看能不能找到网站后台吧...用了几个网站路径扫描工具扫了一遍，没有什么收获...于是放弃了从后台这一步了...其实渗透测试做到这里的时候，已经明显感觉到这个网站整体的安全性很低，很多环节一触即破于是乎，打算对网站服务器扫描一下端口看看能不能获得一些更多的信息...\n\n可以看到扫到了几个端口，于是挨个测试了一下，又有了意外发现...PHPMyadmin数据库管理后台地址：\n\n目录遍历漏洞：（有MySQL数据库备份文件）\n\nSVN服务端口：\n\n这一扫，还是收获颇多的。既然发现了MySQL数据库的管理后台，那么我们只要想办法把root的hash密码给破解出来，就可以登录进去了。刚开始的时候我们看到数据库用户是root权限，那么可以读一下root的hash密码，然后去试一下能不能解密...\n\n\n\n可以看到是一条收费的MD5记录...不要紧，这里找了一位大牛帮忙破解...\n\nroot密码已经破解出来了。OK，让我们登录一下看看...\n\n进到这里，其实已经可以为所欲为了。我们刚才前面提到，注册用户的账户管理里面有一个账户余额（导学币），来到这里，我想大家一定和我一样有个想法想去验证一下...\n\n可以看到这里的9.95和上面的账户余额是一样的哦~也就是说只要修改amount这个字段就可以实现任意刷币哦~（不敢想下去了o.o）好了，YY就到这里...（用户数据未做更改，只是截图说明一下而已...）还有最后一个漏洞...也算是比较严重的扫路径的时候，发现了一个地址很可疑，于是点进去看了一下...\n\n发现没有...这个应该是一个重置密码的链接...不过怎么没有设置重置密码的用户呢？先不要着急，我们来设置一下密码，然后BurpSuite抓包看一下有没有什么发现。\n\n看到里面有一个email=字段居然是空值...据我们上面的经验来看，这个email应该是我们的注册邮箱或者是注册用户名，因为注册用户名都是用邮箱注册的...我们来修改一下试试。\n\n\n\n可以看到提示修改密码成功...到这里，基本上所有漏洞演示已经结束...以上所有操作并未修改用户数据，也未进行拖库等操作，网站管理员不放心，可自行在检查一遍即可...所有操作只是登陆查看做截图演示用。建立了一个测试账号， 测试完毕已经删除。网站联系方式...\n\n   修复方案：  1.伪静态注入：对.htaccess伪静态规则进行重新设计，建议复杂一些，不要太容易猜解。2.目录遍历漏洞：设置访问权限，关闭对外访问。3.SVN服务端口：设置访问权限，关闭对外访问。4.任意用户密码重置：检查用户密码重置源码判断语句，语句逻辑不严谨，导致出现越权访问，增加权限判断   版权声明：转载请注明来源 wy007@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2015-10-17 13:21 |    \t\twy007 \t\t\t( 普通白帽子  |\t\t\t        Rank:108 漏洞数:11        | 其实我是一名卧底...)\t\t \n  小厂商就是坑啊...都没人认领...    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}