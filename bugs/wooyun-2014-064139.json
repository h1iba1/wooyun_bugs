{"id": 54519, "wybug_id": "wooyun-2014-064139", "wybug_title": "YouYaX_V5.66 SQL注入漏洞(官网躺枪)", "wybug_corp": "youyax.com", "wybug_author": "索马里的海贼", "wybug_date": "2014-06-09 11:38", "wybug_open_date": "2014-09-07 11:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-07：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 最近很活跃的卖萌厂商我喜欢 详细说明：  /Lib/MessageAction.php行94\npublic function delMesses()    {        $user = $_SESSION['youyax_user'];        if ($user == \"\" || $user == null)            $this->redirect(\"Index\" . C('default_url') . \"index\" . C('static_url'));        for ($k = 0; $k < count($_POST['cb']); $k++) {            $id     = $_POST['cb'][$k];            $result = $this->find(C('db_prefix') . \"message\", 'string', \"mto='\" . $_SESSION['youyax_user'] . \"' and id='\" . $id . \"'\");            if ($result) {                $this->delete(C('db_prefix') . \"message\", \"mto='\" . $_SESSION['youyax_user'] . \"' and id='\" . $id . \"'\");            }        }        $this->assign('jumpurl', $this->youyax_url . \"/Message\" . C('default_url') . \"show\" . C('static_url'))->assign('msgtitle', '操作成功')->assign('message', '消息已删除！')->success();    }\n$id     = $_POST['cb'][$k];未过滤直接进了$this->find();来看find()/ORG/YouYa.php行356\npublic function find($table, $ext = \"string\", $param)    {        //在 param 中寻找与给定的正则表达式 pattern 所匹配的子串        if (preg_match_all(\"/=/\", $param, $tmp)) {             $sql = \"select * from \" . $table . \" where \" . $param;        } else {            $param = \"id=\".intval($param);            $sql   = \"select * from \" . $table . \" where \" . $param;        }        $result = mysql_query($sql);\n只要$parm里面有“=” 就不会intval了，这个点一样没输出 只能基于时间注入 跟 WooYun: YouYaX_V5.47 SQL注入漏洞(官网躺枪) 这个一样附送一个鸡肋的本地文件包含/ORG/YouYa.php 行107\nprivate function deal($tp)    {        if (isset($_COOKIE['youyax_lang'])) {            $this->lang                = require(\"lang/\" . $_COOKIE['youyax_lang'] . \"/lang.php\"); //不太安全吧            $this->array_array['lang'] = $this->lang;\n在当前mysql用户有file权限 但是对web目录不可写的情况下，可以用注入写一个lang.php到/tmp 然后设置cookie youyax_lang为../../../tmp 就可以成功包含shell了   漏洞证明：  \nPOST http://bbs.youyax.com/Message-delMesses.aspx HTTP/1.1Host: bbs.youyax.comdropdown=del&cb[]=1'\n就能看到报错信息 具体注入方法与 WooYun: YouYaX_V5.47 SQL注入漏洞(官网躺枪) 一致就不用sqlmap来演示了   修复方案：  别漏了   版权声明：转载请注明来源 索马里的海贼@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-06-09 12:33 厂商回复： 第一个代码太多遗漏了，第二个不明觉厉，也加强了一下 最新状态： 2014-06-09：更新  ", "replys": "漏洞评价：\n评论\n     2014-06-09 11:42 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  只可惜走小厂商    \n     2014-06-09 11:44 |    \t\t索马里的海贼 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:24        | http://tieba.baidu.com/f?kw=WOW)\t\t \n  @小川 确实用户群还不多，不过厂商很活跃的样子    \n     2014-06-09 12:00 |    \t\tYouYaX(乌云厂商)\t\t \n  @索马里的海贼 我去看看    \n     2014-06-09 13:43 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  为毛我发的注入一周了还不给审核……    \n     2014-06-09 13:56 |    \t\tYouYaX(乌云厂商)\t\t \n  @roker 你发的是啥，哪方面的？    \n     2014-06-09 14:10 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  @YouYaX 私信你了。。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}