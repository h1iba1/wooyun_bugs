{"id": 28691, "wybug_id": "wooyun-2015-0111794", "wybug_title": "味全:从jboss配置不当到域控沦陷", "wybug_corp": "味全及其子公司", "wybug_author": "Helix", "wybug_date": "2015-05-03 23:58", "wybug_open_date": "2015-06-18 00:00", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "默认配置不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-03：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-06-18：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 菜鸟的一次渗透之旅 详细说明：  故事从一处jboss配置不当开始。站点：http://workflow.weichuan.com.cn/jmx-console/，没有设置访问密码，可以远程部署shell\n\n。这是一个叫NaNaWeb的企业流程管理软件，很多配置该软件的企业也有jboss配置的问题。连上3389后，mimikatz读取密码为空，可能机器重启过了。从jboss的deploy目录下我们可以看到数据库连接的xml，\n\n，数据库在同网段的另外一台机器上，是MSSQL，sa权限，尝试打开xp_cmdshell，成功后添加用户登录，拿到内网第二台机器，成功读取用户密码。为了获取更多的密码，可以从数据库里翻Hash，不过修改登录页面的javascript可以方便的劫持到使用中的密码明文，\n\n积累一份字典后，我们开始扫描内网，尝试爆破139和1433端口，再次扩大内网控制权。\n\n，还遇到了味全子公司一个使用NaNaWeb的站点，虽然jmx-console设置了密码，但仍能用工具部署shell。\n\n其中一台机器的浏览记录让我看到了内网一点结构，可以用WebBrowserPassView读取保存的密码，只读到用户名也可以，我们可以用之前收集的字典。\n\n从登陆IP来看，248.29这台机应该是运维经常使用的机器，应该有不少敏感信息，另外机器名也给我们指明了内网中较为重要的机器，\n\n。爆破进入248.29，翻看文件，果然找到了一些资料，好像是某运维这几天辞职交接的资料，\n\n拓扑，ip，密码。。。。。。有了这些资料，在内网中就没有什么阻碍了，域控、VPN、邮箱、官网。。。一一到手\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n   漏洞证明：  \n\n\n\n   修复方案：  1.Jboss删除不必要的组件 jmx-console,Invoker等2.内网不同安全等级的机器使用不同强度密码3.运维交接敏感资料的管理   版权声明：转载请注明来源 Helix@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：15 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2015-06-18 08:22 |    \t\tWooyun第一大屌 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:3        )\t\t \n  大表哥果然厉害，但还是被拒绝了！    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 15, "Ranks": null}