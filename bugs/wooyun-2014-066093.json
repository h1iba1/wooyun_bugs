{"id": 53912, "wybug_id": "wooyun-2014-066093", "wybug_title": "Tipask问答系统可代替提问者指定最佳答案（刷财富）", "wybug_corp": "Tipask", "wybug_author": "飞黎", "wybug_date": "2014-06-24 18:53", "wybug_open_date": "2014-09-22 18:54", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误", "越权操作", "认证缺陷", "设计不当导致攻击界面扩大"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-24：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-09-22：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Tipask问答系统逻辑上和百度知道一样，提问者可以选择最佳答案，然后系统会给最佳答案回答者相应的悬赏，此漏洞可以代替提问者把自己选为最佳答案，奖励就会发到自己这里，达到刷财富的目的，随意选择最佳答案也有误导用户的可能性，从刷财富上讲，危害还算是很大的 详细说明：  比如这个问题：http://help.tipask.com/q-19646.html这个有15+2的悬赏财富随便回答一个：\n\n然后点继续回答，截取url如下:http://help.tipask.com/answer/append/19646/3962.html更改url，改成：http://help.tipask.com/question/adopt/?qid=19646&aid=3962（对应的问题id和回答id要再三确认，出错了仍然显示成功，当初在这个地方闹心了半天...）访问之\n\n返回重刷新：\n\n搞定！   漏洞证明：  查看自己的回答记录可以看到确实已采纳了：\n\n   修复方案：  （以下使用最新版源码）问题出在：control/question.phpline 246:\nfunction onadopt() {        $qid = intval($this->post['qid']);        $aid = intval($this->post['aid']);        $comment = $this->post['content'];        $question = $_ENV['question']->get($qid);        $answer = $_ENV['answer']->get($aid);        $ret = $_ENV['answer']->adopt($qid, $answer);        if ($ret) {            $this->load(\"answer_comment\");            $_ENV['answer_comment']->add($aid, $comment, $question['authorid'], $question['author']);            $this->credit($answer['authorid'], $this->setting['credit1_adopt'], intval($question['price'] + $this->setting['credit2_adopt']), 0, 'adopt');            $this->send($answer['authorid'], $question['id'], 1);            $viewurl = urlmap('question/view/' . $qid, 2);            $_ENV['doing']->add($question['authorid'], $question['author'], 8, $qid, $comment, $answer['id'], $answer['authorid'], $answer['content']);        }        $this->message('采纳答案成功！', $viewurl);    }\n全程未加验证，在255行执行了回答锁定，256行对用户积分进行了更新（达到了目的）修复方法：在249行加验证，判断当前操作用户是否是提问者自己P.S.：这个漏洞报告写了五天，苦逼初三党用极少的上网时间凑起来写的，求过....   版权声明：转载请注明来源 飞黎@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}