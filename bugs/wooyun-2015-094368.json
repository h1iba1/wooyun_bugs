{"id": 44278, "wybug_id": "wooyun-2015-094368", "wybug_title": "cmseasy 管理端越权(删除 修改 添加 产品 和 订单) 不花钱你懂的", "wybug_corp": "cmseasy", "wybug_author": "menmen519", "wybug_date": "2015-01-29 11:47", "wybug_open_date": "2015-04-29 11:48", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-02-02：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-03-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-29：\t细节向公众公开  简要描述： cmseasy 管理端越权(删除 修改 添加 产品 和 订单) 不花钱你懂的 详细说明：  看代码:manage_act.php:\nfunction init() {        $user='';        $guest = front::get('guest');        if($guest=='1'&&config::get('opguestadd')) {            $user = 'Guest';        }else {            if(cookie::get('login_username') &&cookie::get('login_password')) {                $user=new user();                $user=$user->getrow(array('username'=>cookie::get('login_username')));            }        }        if(cookie::get('login_username') &&cookie::get('login_password')) {            $guestuser=new user();            $guestuser=$guestuser->getrow(array('username'=>cookie::get('login_username')));        }        $this->view->guestuser = $guestuser;        if(!$user &&front::$act != 'login'&&front::$act != 'register')  front::redirect(url::create('user/login'));        $this->view->user=$user;        $this->_user=new user;        $this->table=front::get('manage');        if($this->table <>'archive'&&$this->table <>'orders') exit('PAGE NOT FOUND!');        $this->_table=new $this->table;        $this->_table->getFields();\n第一步 如果我们不是匿名用户的话\nif(cookie::get('login_username') &&cookie::get('login_password')) {                $user=new user();                $user=$user->getrow(array('username'=>cookie::get('login_username')));            }\n就会走到这里 看到问题了吧 cookie::get('login_password') 没有做任何参与运算的东西直接拿到user第二步：我们修改cookie:login_username=admin; 我们打印一下 当前用户是什么:\n\n看到没有超级管理员用户下来我们看看能干什么：case=manage&act=add&manage=archive 如果是这样的 那么archive的东西都能操作比如list_action，add_action，edit_action,delete_action 都可以操作case=manage&act=add&manage=orders 如果是这样的 那么也可以执行list_action，add_action，edit_action,delete_action当然是订单表的东西了我们看看；\nfunction edit_action() {        $from=session::get('from');        front::check_type(front::get('id'));        if(front::post('submit') &&$this->manage->vaild()) {            $this->manage->filter();            $info=$this->_table->getrow(front::get('id'));            if($info['userid'] != $this->view->user['userid'] ) {                front::flash('记录修改失败！(原因：未经授权！)');                header(\"Location: \".$from,TRUE,302);                exit;            }            if($info['checked']) {                front::flash('记录修改失败！(原因：已通过审核！)');                header(\"Location: \".$from,TRUE,302);                exit;            }            $this->manage->save_before();            $data=array();            $fieldlimit=$this->_table->getcols(front::$act=='list'?'user_manage':'user_modify');            $fieldlimits=explode(',',$fieldlimit);            foreach(front::$post as $key=>$value) {            \tif(preg_match('/(select|union|and|\\'|\"|\\))/i',$value)){            \t\texit('非法参数');            \t}                if(in_array($key,$fieldlimits))                    $data[$key]=$value;            }            $update=$this->_table->rec_update($data,front::get('id'));\n这里来自post的所有东西并且key 没有做unset操作 且现在具有权限了，那么我就可以任意修改订单的状态证明，略去，只要证明目前的所有操作是在超级管理员底下即可   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2015-01-30 20:33 厂商回复： 谢谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-31 00:49 |    \t\tsco4x0 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        | O_o)\t\t \n  咋全都是1分啊？    \n     2015-02-03 16:30 |    \t\t君宝 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:4        | 不要跟我比浪。。你浪不过我。。)\t\t \n  1rank....    \n     2015-02-05 10:07 |    \t\t蛇精病 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:10        | 你连棒棒糖都没有，还谈什么狗屁爱情？)\t\t \n  @疯狗  看 又一分    \n     2015-02-05 19:07 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @蛇精病 这厂商。。。    \n     2015-04-29 11:59 |    \t\t冰封的心 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:2        | 会免杀、会搞基、会3P.....)\t\t \n  看了这厂商的所有漏洞，给的rank都低的吓人，这厂商绝逼是醉了.....    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}