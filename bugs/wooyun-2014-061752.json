{"id": 3119, "wybug_id": "wooyun-2014-061752", "wybug_title": "中国联通邮箱多处存在存储型XSS漏洞", "wybug_corp": "mail.wo.com.cn", "wybug_author": "nextdoor", "wybug_date": "2014-05-21 21:03", "wybug_open_date": "2014-07-05 21:04", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "13", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-05：\t细节向公众公开  简要描述： 中国联通邮箱多处存在存储型XSS漏洞o 详细说明：  先说一下测试的过程吧，是黑名单过滤机制。过滤了script,iframe，img的onerror事件和alert函数等。先看一看主要的漏洞测试点如图主要是闭合<a>和<embed>标签\n\n1.闭合<a>标签，再利用<object>标签。漏洞处没有对特殊字符转意可以对<a>标签进行闭合构造代码\n</a><object data=data:text/html;base64,PHNjcmlwdD5hbGVydCgid29veXVufnRlc3QiKTwvc2NyaXB0Pg==></object>\n\n\n漏洞执行并直接触发\n\n插入后代码执行\n\n2.对伪协议javascript没有过滤，过滤了alert函数。过滤alert函数没有什么用啊可以用confirm(11)测试，还可以用document.title=\"Exploit\"测试。对于其他的伪协议像vbscript，ed2k,expression等自己做一下测试。测试代码：\njavascript:confirm(document.cookie)\n\n\n点击链接后触发\n\n插入成功的代码\n\n代码成功执行3.对div,img等标签没有防御这个漏洞想要说明的是仅仅过滤部分on事件是不够的，要过滤全部on事件。由于过多的标签没有被过滤掉，仅仅拿这两个标签作为测试。测试代码\n<div onmouseover=\"confirm(88)\">TEST</div>\n\n\n鼠标移动到测试代码上代码执行成功\n\n代码执行成功\n\n利用img标签做的测试，上图不详述\n\n\n\n4.插入多媒体文件处也是伪协议的问题。这里要进行简单绕过。测试代码\njavascript:confirm(11) //.swf\n\n\n打开邮箱直接触发\n\n插入的代码\n\n5.插入flash处漏洞测试代码，由于插入flash和多媒体都是用的embed标签，利用过程差不多\njavascript:confirm(11)\n\n\n打开邮箱直接触发\n\n插入的代码\n\n总结：测试过程中还有很多标签没有过滤如<base>且下面js脚本是相对路径，测试一下没加载成功，没有再次测试，这个标签也过滤一下吧。对于漏洞的利用可以构造js盗取cookie的代码，在这不在进行构造。   漏洞证明：  漏洞证明\n\n   修复方案：  关于防御，有两个建议1.对<a><embed>进行http协议的验证，2.就是对一些关键词的过滤把onerror替换成on_error //所有的on事件都替换成此种形式把javascript替换java_script 把data标签替换成_data把vbscript替换成vb_script把expression替换成_expression 把ed2k替换成_ed2k这样就能防御大部分XSS漏洞了，即使代码插入了也很难执行。   版权声明：转载请注明来源 nextdoor@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-05-26 14:14 厂商回复： CNVD确认并复现所述情况，转由CNCERT协调中国联合网络通信集团有限公司通报处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-22 01:42 |    \t\t大白菜 \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:19        )\t\t \n  ...这么厉害多处    \n     2014-07-05 22:31 |    \t\txiaokinghk \t\t\t( 实习白帽子  |\t\t\t        Rank:82 漏洞数:16        | 【DBA】)\t\t \n  我相信联通不会处理的    \n     2014-07-05 22:55 |    \t\tnextdoor \t\t\t( 普通白帽子  |\t\t\t        Rank:325 漏洞数:74        )\t\t \n  @xiaokinghk 好像电信的邮箱系统换了，联通的还没有看    \n     2014-08-30 21:21 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:61        | 工作需要，暂别一段时间)\t\t \n  直接换系统也是很屌    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}