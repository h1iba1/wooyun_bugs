{"id": 20603, "wybug_id": "wooyun-2012-05156", "wybug_title": "汉庭连锁酒店后台SQL注入", "wybug_corp": "汉庭连锁酒店", "wybug_author": "only_guest", "wybug_date": "2012-03-10 10:10", "wybug_open_date": "2012-04-24 10:11", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-03-10：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2012-04-24：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 汉庭连锁酒店后台SQL注入,可绕过登陆限制进入后台,可脱库. 详细说明：  问题发生在这个站点.http://miaosha.htinns.com/标题内没有写具体信息.因为怕发布后被人入侵.后台登陆地址为:http://miaosha.htinns.com/admin/admin_login.php帐号输入admin'登陆后提示如下图\n\n爆出了查询语句.\nDatabase error: [You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '453e41d218e071ccfb2d1c99ce23906a'' at line 1]select * from users_admin where userid='admin'' and pwd='453e41d218e071ccfb2d1c99ce23906a'\n重点在这里select * from users_admin where userid='admin'' and pwd='453e41d218e071ccfb2d1c99ce23906a'然后构造绕过使用帐号admin' or '1'='1 /*成功绕过登陆后台,截图如下\n\n拥有后台全部权限...可以获得所有秒杀成功的数据,对其进行诈骗.也可以发布秒杀信息,造成汉庭信任公关危机...无意冒犯.我也是汉庭常客.喜欢你们的服务态度.就是网速太慢了.啥时候能提升下网速呢?   漏洞证明：  \n\n   修复方案：  过滤各种提交.   版权声明：转载请注明来源 only_guest@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2012-04-24 13:03 |    \t\tPnig0s \t\t\t( 实习白帽子  |\t\t\t        Rank:46 漏洞数:2        | The quiter you are,the more you're able ...)\t\t \n  ....竟然拒绝了？    \n     2012-04-24 15:59 |    \t\tpfdz \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | Stay hungry. Stay foolish.)\t\t \n  这里使用admin' or '1'='1' /*，为啥绕不过去？求指点。。    \n     2012-04-25 13:02 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  缺陷关联： WooYun: 搜狐分站存在严重注射漏洞.可以拿下很多分站服务器数据    \n     2012-04-25 13:47 |    \t\tpfdz \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | Stay hungry. Stay foolish.)\t\t \n  @horseluke 神牛。。能解答下我的问题不。。这个地方注释有点不懂。。    \n     2012-04-25 13:53 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  @pfdz 这个万能密码现在还可以登录啊，咋不成了？    \n     2012-04-25 14:01 |    \t\tpfdz \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | Stay hungry. Stay foolish.)\t\t \n  @horseluke 我是说admin' or '1'='1' /*这个不行。。。多了一个'号就不行了？这个是什么原因？    \n     2012-04-25 14:26 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  @pfdz （1）原SQL注入语句是这样的：select * from users_admin where userid='【输入字符串1】' and pwd='【输入字符串2】'。（2）你那个的话就变成了：select * from users_admin where userid='admin' or '1'='1' /*' and pwd='123'。成为了一个存在错误注释的SQL。（3）洞主所使用的万能密码并非是注释掉后面的SQL运算，似乎是利用了操作符优先级关系：select * from users_admin where userid='admin' or '1'='1 /*' and pwd='123'。（http://dev.mysql.com/doc/refman/5.1/zh/functions.html#operator-precedence ）。有点神奇啊，同求解释...    \n     2012-04-25 14:40 |    \t\tpfdz \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | Stay hungry. Stay foolish.)\t\t \n  @horseluke 恩，我也看到这个语句了，关注了好几天了，一直没有人来看啊，召唤@xss，求解释。。    \n     2012-04-25 14:42 |    \t\tpfdz \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | Stay hungry. Stay foolish.)\t\t \n  @xss 这样召唤？    \n     2012-04-25 14:43 |    \t\tpfdz \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | Stay hungry. Stay foolish.)\t\t \n  招错了。再次召唤@xsser @only_guest     \n     2012-04-25 14:55 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  @pfdz 用搜索引擎再度搜索“MYSQL AND OR 优先级”，然后本机用EXPLAIN EXTENDED + SHOW WARNINGS试验，发现确实是优先级问题，因为and高于or，所以select * from users_admin where userid='admin' or '1'='1 /*' and pwd='123'就会变成select * from users_admin where userid='admin' or ('1'='1 /*' and pwd='123')。参考：（1）http://www.2cto.com/database/201203/122589.html （2）http://bbs.chinaunix.net/thread-1046414-1-1.html。    \n     2012-04-25 15:17 |    \t\tpfdz \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | Stay hungry. Stay foolish.)\t\t \n  @horseluke 那为啥多了一个'号就不行了？/*是注释的开始吧？不是很懂，求通俗。。    \n     2012-04-25 15:18 |    \t\tpfdz \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | Stay hungry. Stay foolish.)\t\t \n  还是说这地方的/*不是注释的作用了？因为在'号里面？    \n     2012-04-25 15:32 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  @pfdz 2012-04-25 14:26的这个已经回答了你啊：“（2）你那个的话就变成了：select * from users_admin where userid='admin' or '1'='1' /*' and pwd='123'。成为了一个存在错误注释的SQL。”，完整的注释符一定要是这样子的：/**/，单行注释是“-- ”    \n     2012-04-25 15:36 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  @pfdz 对，洞主的/*其实并没有起到注释的意义    \n     2012-04-25 15:48 |    \t\tpfdz \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | Stay hungry. Stay foolish.)\t\t \n  @horseluke 恩，懂了~多谢神牛。。膜拜下。。    \n     2012-04-25 23:43 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  各种真相帝.我只是习惯性的注释....哈哈`让你们想多了    \n     2012-06-21 14:31 |    \t\t紫梦芊 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:9        | 踏踏实实做测试)\t\t \n  @horseluke 有时/*  #  !-- 不顶用的时候 对于不支持多语句的 ;也是个不错的解决方案    \n     2013-03-02 13:10 |    \t\tbotak \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:6        | 只为xsser邀请码)\t\t \n  @only_guest 我觉得也是，估计楼主只是想在密码里，也加上个*/这样如果密码不先进行加密或变换的话，就能达到/*中间过程语句*/按报错图片来看。输入正确的帐号如admin  ，万能密码就是admin' or '1'='1  over顺便求告知如何在dede的plus/search.php漏洞exp列库。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}