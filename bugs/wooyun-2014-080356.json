{"id": 49100, "wybug_id": "wooyun-2014-080356", "wybug_title": "北京地铁收费系统基础安全算法漏洞", "wybug_corp": "北京地铁", "wybug_author": "eycp", "wybug_date": "2014-10-22 14:26", "wybug_open_date": "2014-12-06 14:28", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全漏洞", "北京地铁", "收费系统"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-06：\t细节向公众公开  简要描述： 违反国家标准《CJ/T-166》，使用私自开发的签名算法，由于未经测试便设入工程应用，现发现强度不够，可以被完全破解。 详细说明：  破解的照片以及向政府反映情况的信息。\n\n\n\n   漏洞证明：  \n\nmask 区域\n*****^意见稿）》规定^**********^^（serialNumber）字^**********^据和动态区数据^**********C使用不^**********^行^**********^成动态区MAC，这是^**********^^MAC^**********行商^**********^^8个输入字节（M**********[0] ^ **********[1] ^ **********[2] ^ ********** UID********** CSN********** CSN********** CSN********** CSN**********使用的输入^**********^^MAC^**********算方^**********行更新，动态区A和B都必须重新计算他们的MAC。这只会发生**********的输^**********[0] ^ **********[1] ^ **********[2] ^ ********** UID********** CSN********** CSN********** CSN********** CSN**********cAreaMAC**********AreaMAC&**********cAreaMAC**********taticA**********rc>**********rc>**********rc>********** =  **********[13] ^ M1[1**********态区MAC有效，这可以^**********（m[0]到m[239]），^**********re**********s 12 bit********************m[11] that**********..m[23] th**********...**********..m[239] th********************20]; that ********************ant 12 b**********^、CRC32等计算过程进行混和，最终**********^^->特征值-^**********^简^**********^制数**********^致，用以模拟对业务数据^**********数据串，而保^**********^^验值不变，那么原始数据必^**********序从^**********^向原始^**********^如不同，则需对原始串，从指针位**********^^倒数第32^**********，当然，它除了那几个人为修^**********^^关键业务数据而保障CRC校验值不变，因此本来用于签名的SAM计算将被完全绕^*****\n\n   修复方案：  采用《CJ/T166 建设事业IC卡应用技术》签名技术修复   版权声明：转载请注明来源 eycp@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-10-27 09:55 厂商回复： 至27日，CNVD未直接复现，已经向白帽子协调后续信息。根据后续提供的信息，对所述标准披露情况以及截图验证情况进行初步确认，拟后续协调北京市政府信息化主管部门处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n          这些评论似乎很乌云~~~思密达          2014-12-12 11:19 |\t\t\t\t\teycp \t\t\t( 实习白帽子  |\t\t\t\t\t\tRank:40 漏洞数:1\t\t\t| 效布莱德利往事)\t\t\t\t\t\t\t\n  鉴于涉事单位出尔反尔的态度和事态异乎寻常的发展，本人被迫寻求公益律师提供法律支持！为表明态度，现发布单程票查询APP（阉割版）先；支持北京单程票的金额、时间查询（对应计程计时的用户需求）http://pan.baidu.com/s/1ntHp8ZB    \n   \n \n     2014-10-22 14:27 |    \t\tYY-2012 \t\t\t( 普通白帽子  |\t\t\t        Rank:2763 漏洞数:641        | 意淫，是《红楼梦》原创的词汇，但后来演变...)\t\t \n  @国家质监    \n     2014-10-22 14:28 |    \t\tNoxxx \t\t\t( 普通白帽子  |\t\t\t        Rank:509 漏洞数:41        )\t\t \n  留名    \n     2014-10-22 14:28 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  求与洞主交个朋友，地铁已涨价，免费充个值如何？    \n     2014-10-22 14:29 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  这个厉害    \n     2014-10-22 14:29 |    \t\t咸鱼翻身 \t\t\t( 普通白帽子  |\t\t\t        Rank:576 漏洞数:108        )\t\t \n  帅。。。。。北京地铁的相关负责人喝茶的节奏    \n     2014-10-22 14:33 |    \t\t        Jn·  \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:14        | 本小菜很可爱，如果不服你TM来打我啊--哎呀...)\t\t \n  前排，刘明 表示在北京    \n     2014-10-22 14:36 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  mark    \n     2014-10-22 14:44 |    \t\tZ-0ne  \t\t\t( 普通白帽子  |\t\t\t        Rank:559 漏洞数:38        | 目前专注于工控安全基础研究，工业数据采集...)\t\t \n  mark    \n     2014-10-22 14:46 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  哈哈，果然等出来了。    \n     2014-10-22 14:48 |    \t\t大孩小孩 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:7        | 哈哈哈哈)\t\t \n  mark    \n     2014-10-22 14:57 |    \t\t老笨蛋 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 老笨蛋一个)\t\t \n  路人甲无所不黑。    \n     2014-10-22 15:02 |    \t\t贫道来自河北 \t\t\t( 普通白帽子  |\t\t\t        Rank:1395 漏洞数:423        | 一个立志要把乌云集市变成零食店的男人)\t\t \n  小伙子，你知道的太多了，小心被失踪    \n     2014-10-22 15:03 |    \t\t进击的zjx \t\t\t( 普通白帽子  |\t\t\t        Rank:295 漏洞数:61        | 工作需要，暂别一段时间)\t\t \n  路人甲无所不能    \n     2014-10-22 15:05 |    \t\twkc_2014 \t\t\t( 普通白帽子  |\t\t\t        Rank:164 漏洞数:45        | 2014-)\t\t \n  神奇的路人甲    \n     2014-10-22 15:06 |    \t\tAdra1n \t\t\t( 普通白帽子  |\t\t\t        Rank:437 漏洞数:68        )\t\t \n  神奇的路人甲    \n     2014-10-22 15:17 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  我信洞主    \n     2014-10-22 15:20 |    \t\tcoffiney \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 喵～)\t\t \n  marke    \n     2014-10-22 15:32 |    \t\tWalle \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:5        | ...   位卑、未敢忘忧国！   ...)\t\t \n  神奇的路人甲     \n     2014-10-22 15:41 |    \t\t龙猫侠 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:5        | 我就是我。)\t\t \n  mark    \n     2014-10-22 15:43 |    \t\tDemon \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:14        | You are my dream)\t\t \n  mark    \n     2014-10-22 15:49 |    \t\t银狼_avi \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:13        | 本屌十二岁破处)\t\t \n  mark    \n     2014-10-22 15:49 |    \t\tqwerty \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:16        | 已注销)\t\t \n  CCTV记者同志看这里    \n     2014-10-22 16:19 |    \t\t冰冻冷咖啡 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 菜鸟一只)\t\t \n  http://hi.baidu.com/killererg/item/9b5677f5782d1829a62988d2 可以查看博主的百度空间 好像这地铁被国外利用来分析东西了？    \n     2014-10-22 16:21 |    \t\t咸鱼翻身 \t\t\t( 普通白帽子  |\t\t\t        Rank:576 漏洞数:108        )\t\t \n  我去。。。。楼上的看完蛋都疼了。。。。。    \n     2014-10-22 16:40 |    \t\t浮萍 \t\t\t( 普通白帽子  |\t\t\t        Rank:555 漏洞数:118        | 默默潜水)\t\t \n  碎了    \n     2014-10-22 16:57 |    \t\tNeeke \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:24        | 求传授刷Rank方法？)\t\t \n  看完楼上上链接..........................卧槽    \n     2014-10-22 17:00 |    \t\tki11y0u \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:23        | 好好学习，求带飞~~~~~~~~~~~~~~~~~~~~~~...)\t\t \n  路人甲呢？    \n     2014-10-22 17:01 |    \t\tMurk Emissary \t\t\t( 实习白帽子  |\t\t\t        Rank:74 漏洞数:14        | 低调做人 低调行事)\t\t \n  CCAV看这里！    \n     2014-10-22 17:03 |    \t\tSunshine \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:10        | Nothing.)\t\t \n  看完楼上上上链接.......................... 卧槽    \n     2014-10-22 18:17 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  这个能让北京即将上涨的车票降价吗？    \n     2014-10-22 18:43 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  一大波记者正在路上    \n     2014-10-22 18:59 |    \t\tBMa \t\t\t( 普通白帽子  |\t\t\t        Rank:1776 漏洞数:200        )\t\t \n  CCTV可以报道了    \n     2014-10-22 19:08 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @冰冻冷咖啡 这他吗都可以..    \n     2014-10-22 19:58 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:16        | 猜猜我是谁？)\t\t \n  我要上电视！你们这些可恶的前排！    \n     2014-10-22 20:13 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  看过博主的博客文章 再结合今天的动作 你们可以多想一想 ，里面有很多值得回味的事情。 目标明确 结构严谨 论文表述 引人深思     \n     2014-10-22 20:56 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-10-22 21:10 |    \t\t0c0c0f \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:15        | My H34rt c4n 3xploit 4ny h0les!)\t\t \n  这种基础设施一定要重视！    \n     2014-10-22 22:04 |    \t\tahnhhh \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 你在乌云这么吊，你家人知道么？)\t\t \n  看这里看这里！    \n     2014-10-22 22:16 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:16        | 猜猜我是谁？)\t\t \n  @紫霞仙子 抓到你了！    \n     2014-10-22 23:29 |    \t\tCoffee \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:15        | Corie, a student of RDFZ.)\t\t \n  这是要上电视的节奏……    \n     2014-10-23 07:11 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  哈哈，这是在挑战什么吗？    \n     2014-10-23 10:21 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  鉴于该算法为某外国公司绕过中华人民共和国国家标准，有意为之的设计；难不成是敌对势力为北京项目中设计的“棱镜算法”吧？    \n     2014-10-23 10:58 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  @毕月乌 好吧，被你发现了。    \n     2014-10-23 18:28 |    \t\tSPRITEKING \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:3        | x)\t\t \n  火钳刘明    \n     2014-10-23 18:32 |    \t\tSPRITEKING \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:3        | x)\t\t \n  @紫霞仙子 @毕月乌 前排两个准备捡肥皂？    \n     2014-10-24 13:13 |    \t\tx37e \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | HI!Man,what are you doing?)\t\t \n  mark    \n     2014-10-24 13:30 |    \t\ttestKaI \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        )\t\t \n  mark    \n     2014-10-24 21:38 |    \t\tcnhello \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 小菜一枚，学习中。。。)\t\t \n  mark    \n     2014-10-25 00:05 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-11-17 09:37 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  好像没有细节呢？    \n     2014-12-02 20:19 |    \t\tpeter \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 孤单的活着，只为等待你！)\t\t \n  西安地铁可以这么玩吗？    \n     2014-12-03 00:10 |    \t\t无名指7年 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:4        | 努力学习奋斗，争取成为一名合格的白帽子。)\t\t \n  我上电视啦  我上电视啦    \n     2014-12-03 13:57 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  已经看到有人利用了。    \n     2014-12-03 14:24 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  采购部门干啥吃的    \n     2014-12-03 14:46 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @peter 不行，你西安的？    \n     2014-12-03 19:43 |    \t\teycp \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:1        | 效布莱德利往事)\t\t \n  立此存照:北京地铁公司今日回应，经核实纯属造谣。北京地铁自动售检票系统符合国家安全等级标准要求，具备全面的安全防范与控制能力。“请市民不信谣，不传谣，谨防上当受骗造成损失，规范使用车票，文明乘车。目前公安部门对此事已经介入调查，请市民遵守国家有关法律法规。    \n     2014-12-03 22:04 |    \t\t路西法 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 堕落天使路西法)\t\t \n  @eycp 你怎么找到余额算法的.... 我买了20多张一次性的卡都没找到......    \n     2014-12-05 19:42 |    \t\t北洋贱队 \t\t\t( 普通白帽子  |\t\t\t        Rank:252 漏洞数:25        )\t\t \n  火钳刘明    \n     2014-12-06 22:09 |    \t\tBlunber \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:13        )\t\t \n  给膝盖了。    \n     2014-12-07 09:10 |    \t\tObserver \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:8        | 我在夕阳下奔跑，那是我逝去的青春)\t\t \n  碉堡了    \n     2014-12-07 13:38 |    \t\tRainShine \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:4        )\t\t \n  @eycp 呃，不信谣，不传谣，我是好孩纸    \n     2014-12-08 11:30 |    \t\t铁汉 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:6        | 向各种大神学习之)\t\t \n  骚年 你叫张呈？    \n     2014-12-08 13:32 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:177 漏洞数:31        | Hacked by @ringzero 我錯了)\t\t \n  CCTV往这拍    \n     2014-12-12 11:19 |    \t\teycp \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:1        | 效布莱德利往事)\t\t \n  鉴于涉事单位出尔反尔的态度和事态异乎寻常的发展，本人被迫寻求公益律师提供法律支持！为表明态度，现发布单程票查询APP（阉割版）先；支持北京单程票的金额、时间查询（对应计程计时的用户需求）http://pan.baidu.com/s/1ntHp8ZB    \n     2014-12-12 11:39 |    \t\t问题来了 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:23        | 挖漏洞哪家强)\t\t \n  @eycp 求完整版。。    \n     2014-12-12 11:42 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  @eycp 我记得有人复制了500张，在中关村地铁站那刚卖几张就被抓了，罚了39W    \n     2014-12-12 11:52 |    \t\t5d1 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 眼前一盆绿萝。)\t\t \n  @eycp http://www.wooyun.org/lawer 这个人好像还行    \n     2014-12-12 12:29 |    \t\t问题来了 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:23        | 挖漏洞哪家强)\t\t \n  @5d1 这人很厉害的。。    \n     2014-12-12 12:55 |    \t\t小火苗 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 我是一只小火苗呀，春风吹又生呀...)\t\t \n  看来有些屁股是真的摸不得。    \n     2014-12-12 13:48 |    \t\tDocuments \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 感谢李大牛)\t\t \n  看不懂啊 ……     \n     2014-12-12 14:01 |    \t\tRammstein \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 开源安全，metasploit开发，生存专家)\t\t \n  好多年前就有某位同志上报过，这都多少年了，还没修补，po主自己又出来提交，还公开到wooyun上，这是作死的表现，wooyun也不是和平饭店，没有周润发出来保你不死，cnvd也不是，有些东西有他自己的特殊处理渠道，提交到wooyun不是拿到免死金牌，我想就是方胖子也不敢说你提交到乌云就没事了，别整天戴着个白帽子就什么漏洞都敢公布，做事动动脑子，po主处理的方式和流程有点问题。    \n     2014-12-12 14:02 |    \t\tRammstein \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 开源安全，metasploit开发，生存专家)\t\t \n  好多年前就有某位同志上报过，这都多少年了，还没修补，po主自己又出来提交，还公开到wooyun上，这是作死的表现，wooyun也不是和平饭店，没有周润发出来保你不死，cnvd也不是，有些东西有他自己的特殊处理渠道，不能随便的公开，不是说提交到乌云就获得了免死金牌，方胖子也不敢跟你这样保证，不要带着个白帽子以为谁都不会动你，提交之前先动动脑子    \n     2014-12-12 14:50 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  @Rammstein 剑心不胖    \n     2014-12-12 17:52 |    \t\tRammstein \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 开源安全，metasploit开发，生存专家)\t\t \n  @浩天 叫了这么多年，习惯了，比以前胖多了    \n     2014-12-18 18:49 |    \t\teycp \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:1        | 效布莱德利往事)\t\t \n  请问北京市质监局公示的《北京市轨道交通自动售检票系统技术规范（征求意见稿）》是否与《CJ-166 建设事业IC卡应用》在MAC算法上是冲突的？答:您好： 来信收悉，现就您提出的问题答复如下： 因MAC算法涉及票卡安全，在2010年征求意见后，根据征求意见反馈情况，市交通委对《北京市轨道交通自动售检票系统技术规范（征求意见稿）》进行了大幅调整，形成标准送审稿时已将该部分内容取消，该部分内容已不属于本标准制定内容。目前，该标准已通过专家审查会审查，计划明年年初发布。待标准发布后可登录北京市质量技术监督局网站（www.bjtsb.gov.cn）或首都标准网（www.capital-std.com）查阅。 感谢您对北京市标准化工作的关心和支持。     \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}