{"id": 63025, "wybug_id": "wooyun-2013-033357", "wybug_title": "咕咚网分站某错输入错误参数导致数据库信息泄露", "wybug_corp": "咕咚网", "wybug_author": "mango", "wybug_date": "2013-08-03 09:08", "wybug_open_date": "2013-09-17 09:08", "wybug_type": "系统/服务运维配置不当", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露", "错误信息未屏蔽"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-08-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-09-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-17：\t细节向公众公开  简要描述： 泄露数据库和小部分源码 详细说明：  漏洞存在与捐献卡币时点捐献 plan_id 改为负值\n\n\n\n\n\n\nDATABASES \t{'default': {'ENGINE': 'django.db.backends.mysql',             'HOST': 'rdsfviy3ifviy3i1367979506919.mysql.rds.aliyuncs.com',             'NAME': 'app_codoon',             'OPTIONS': {},             'PASSWORD': '********************',             'PORT': '3306',             'TEST_CHARSET': None,             'TEST_COLLATION': None,             'TEST_MIRROR': None,             'TEST_NAME': None,             'TIME_ZONE': 'Asia/Shanghai',             'USER': 'aliyunmysql'}}\n   漏洞证明：  \nIntegrityError at /give_calcoin(1452, 'Cannot add or update a child row: a foreign key constraint fails (`app_codoon`.`commonweal_calcoinorder`, CONSTRAINT `codoon_plan_id_refs_id_6bd1254d` FOREIGN KEY (`codoon_plan_id`) REFERENCES `commonweal_codoonplan` (`id`))')Request Method: \tPOSTRequest URL: \thttp://gongyi.codoon.com/give_calcoinDjango Version: \t1.3.1Exception Type: \tIntegrityErrorException Value: \t(1452, 'Cannot add or update a child row: a foreign key constraint fails (`app_codoon`.`commonweal_calcoinorder`, CONSTRAINT `codoon_plan_id_refs_id_6bd1254d` FOREIGN KEY (`codoon_plan_id`) REFERENCES `commonweal_codoonplan` (`id`))')Exception Location: \t/opt/python2.7.2/lib/python2.7/site-packages/MySQLdb/connections.py in defaulterrorhandler, line 36Python Executable: \t/opt/python2.7.2/bin/pythonPython Version: \t2.7.2Python Path: \t['/var/www/ncodoon/gongyi', '/opt/python2.7.2/lib/python2.7/site-packages/distribute-0.6.24-py2.7.egg', '/opt/python2.7.2/lib/python2.7/site-packages/pip-1.3.1-py2.7.egg', '/var/www/ncodoon/src/gevent', '/opt/python2.7.2/lib/python27.zip', '/opt/python2.7.2/lib/python2.7', '/opt/python2.7.2/lib/python2.7/plat-linux2', '/opt/python2.7.2/lib/python2.7/lib-tk', '/opt/python2.7.2/lib/python2.7/lib-old', '/opt/python2.7.2/lib/python2.7/lib-dynload', '/opt/python2.7.2/lib/python2.7/site-packages', '/opt/python2.7.2/lib/python2.7/site-packages/setuptools-0.6c11-py2.7.egg-info', '/var/www/ncodoon/gongyi', '/var/www/ncodoon']Server time: \t星期五, 2 八月 2013 21:47:00 +0800Traceback Switch to copy-and-paste view    /opt/python2.7.2/lib/python2.7/site-packages/django/core/handlers/base.py in get_response                                response = callback(request, *callback_args, **callback_kwargs)        ...    ▼ Local vars    Variable \tValue    exceptions \t    <module 'django.core.exceptions' from '/opt/python2.7.2/lib/python2.7/site-packages/django/core/exceptions.pyc'>    e \t    IntegrityError(1452, 'Cannot add or update a child row: a foreign key constraint fails (`app_codoon`.`commonweal_calcoinorder`, CONSTRAINT `codoon_plan_id_refs_id_6bd1254d` FOREIGN KEY (`codoon_plan_id`) REFERENCES `commonweal_codoonplan` (`id`))')    callback_args \t    ()    receivers \t    [(<function _rollback_on_exception at 0x1857d70>, None)]    middleware_method \t    <bound method AuthenticationMiddleware.process_request of <django.contrib.auth.middleware.AuthenticationMiddleware object at 0x1680b50>>    self \t    <django.core.handlers.wsgi.WSGIHandler object at 0x1632390>    settings \t    <django.conf.LazySettings object at 0x13b5e10>    request \t    <WSGIRequest    GET:<QueryDict: {}>,    POST:<QueryDict: {u'plan_id': [u'-1'], u'calcoin': [u'1']}>,    COOKIES:{'Hm_lpvt_9cca1c462e3682d7fb991e5cf0c7382f': '1375451017',     'Hm_lvt_9cca1c462e3682d7fb991e5cf0c7382f': '1374217191,1375449009,1375449119,1375449162',     'sessionid': '2927ea2dce22f153cf094f1781672934'},    META:{'CONTENT_LENGTH': '20',     'CONTENT_TYPE': 'application/x-www-form-urlencoded',     'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',     'HTTP_ACCEPT_ENCODING': 'gzip, deflate',     'HTTP_ACCEPT_LANGUAGE': 'zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3',     'HTTP_CONNECTION': 'close',     'HTTP_COOKIE': 'Hm_lvt_9cca1c462e3682d7fb991e5cf0c7382f=1374217191,1375449009,1375449119,1375449162; Hm_lpvt_9cca1c462e3682d7fb991e5cf0c7382f=1375451017; sessionid=2927ea2dce22f153cf094f1781672934',     'HTTP_HOST': 'gongyi.codoon.com',     'HTTP_MANGO': 'TEST',     'HTTP_REFERER': 'http://gongyi.codoon.com/plan/1',     'HTTP_USER_AGENT': 'Mozilla/5.0 (Windows NT 5.1; rv:22.0) Gecko/20100101 Firefox/22.0',     'HTTP_X_REAL_IP': '122.225.175.91',     'HTTP_X_SCHEME': 'http',     'PATH_INFO': u'/give_calcoin',     'QUERY_STRING': '',     'REMOTE_ADDR': '127.0.0.1',     'REQUEST_METHOD': 'POST',     'SCRIPT_NAME': u'',     'SERVER_NAME': 'gongyi.codoon.com',     'SERVER_PORT': '80',     'SERVER_PROTOCOL': 'HTTP/1.0',     'wsgi.errors': <open file '<stderr>', mode 'w' at 0x7f4e2d698270>,     'wsgi.input': <_io.BytesIO object at 0x1e62bf0>,     'wsgi.multiprocess': True,     'wsgi.multithread': False,     'wsgi.run_once': False,     'wsgi.url_scheme': 'http',     'wsgi.version': (1, 0)}>    callback \t    <function _decorator at 0x1cc35f0>    resolver \t    <RegexURLResolver gongyi.urls (None:None) ^/>    urlresolvers \t    <module 'django.core.urlresolvers' from '/opt/python2.7.2/lib/python2.7/site-packages/django/core/urlresolvers.pyc'>    callback_kwargs \t    {}    response \t    None    urlconf \t    'gongyi.urls'    /var/www/ncodoon/gongyi/commonweal/decorators.py in _decorator                return func(request, *args, **kwargs)        ...    ▼ Local vars    Variable \tValue    code \t    None    args \t    ()    request \t    <WSGIRequest    GET:<QueryDict: {}>,    POST:<QueryDict: {u'plan_id': [u'-1'], u'calcoin': [u'1']}>,    COOKIES:{'Hm_lpvt_9cca1c462e3682d7fb991e5cf0c7382f': '1375451017',     'Hm_lvt_9cca1c462e3682d7fb991e5cf0c7382f': '1374217191,1375449009,1375449119,1375449162',     'sessionid': '2927ea2dce22f153cf094f1781672934'},    META:{'CONTENT_LENGTH': '20',     'CONTENT_TYPE': 'application/x-www-form-urlencoded',     'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',     'HTTP_ACCEPT_ENCODING': 'gzip, deflate',     'HTTP_ACCEPT_LANGUAGE': 'zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3',     'HTTP_CONNECTION': 'close',     'HTTP_COOKIE': 'Hm_lvt_9cca1c462e3682d7fb991e5cf0c7382f=1374217191,1375449009,1375449119,1375449162; Hm_lpvt_9cca1c462e3682d7fb991e5cf0c7382f=1375451017; sessionid=2927ea2dce22f153cf094f1781672934',     'HTTP_HOST': 'gongyi.codoon.com',     'HTTP_MANGO': 'TEST',     'HTTP_REFERER': 'http://gongyi.codoon.com/plan/1',     'HTTP_USER_AGENT': 'Mozilla/5.0 (Windows NT 5.1; rv:22.0) Gecko/20100101 Firefox/22.0',     'HTTP_X_REAL_IP': '122.225.175.91',     'HTTP_X_SCHEME': 'http',     'PATH_INFO': u'/give_calcoin',     'QUERY_STRING': '',     'REMOTE_ADDR': '127.0.0.1',     'REQUEST_METHOD': 'POST',     'SCRIPT_NAME': u'',     'SERVER_NAME': 'gongyi.codoon.com',     'SERVER_PORT': '80',     'SERVER_PROTOCOL': 'HTTP/1.0',     'wsgi.errors': <open file '<stderr>', mode 'w' at 0x7f4e2d698270>,     'wsgi.input': <_io.BytesIO object at 0x1e62bf0>,     'wsgi.multiprocess': True,     'wsgi.multithread': False,     'wsgi.run_once': False,     'wsgi.url_scheme': 'http',     'wsgi.version': (1, 0)}>    token \t    {u'access_token': u'bbcf72d399e17323684fc1d238b11051',     u'expire_in': 93312000,     u'refresh_token': u'53a5e2ec575f3d6751af3f7df6f4937e',     u'scope': u'feeds messages user',     u'token_type': u'bearer',     u'user_id': u'45273fbc-8804-4d5b-b435-6225997a6d15'}    error \t    None    func \t    <function _decorator at 0x1cc3578>    kwargs \t    {}    token_flag \t    True    /var/www/ncodoon/gongyi/commonweal/decorators.py in _decorator                return func(request, *args, **kwargs)        ...    ▼ Local vars    Variable \tValue    args \t    ()    request \t    <WSGIRequest    GET:<QueryDict: {}>,    POST:<QueryDict: {u'plan_id': [u'-1'], u'calcoin': [u'1']}>,    COOKIES:{'Hm_lpvt_9cca1c462e3682d7fb991e5cf0c7382f': '1375451017',     'Hm_lvt_9cca1c462e3682d7fb991e5cf0c7382f': '1374217191,1375449009,1375449119,1375449162',     'sessionid': '2927ea2dce22f153cf094f1781672934'},    META:{'CONTENT_LENGTH': '20',     'CONTENT_TYPE': 'application/x-www-form-urlencoded',     'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',     'HTTP_ACCEPT_ENCODING': 'gzip, deflate',     'HTTP_ACCEPT_LANGUAGE': 'zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3',     'HTTP_CONNECTION': 'close',     'HTTP_COOKIE': 'Hm_lvt_9cca1c462e3682d7fb991e5cf0c7382f=1374217191,1375449009,1375449119,1375449162; Hm_lpvt_9cca1c462e3682d7fb991e5cf0c7382f=1375451017; sessionid=2927ea2dce22f153cf094f1781672934',     'HTTP_HOST': 'gongyi.codoon.com',     'HTTP_MANGO': 'TEST',     'HTTP_REFERER': 'http://gongyi.codoon.com/plan/1',     'HTTP_USER_AGENT': 'Mozilla/5.0 (Windows NT 5.1; rv:22.0) Gecko/20100101 Firefox/22.0',     'HTTP_X_REAL_IP': '122.225.175.91',     'HTTP_X_SCHEME': 'http',     'PATH_INFO': u'/give_calcoin',     'QUERY_STRING': '',     'REMOTE_ADDR': '127.0.0.1',     'REQUEST_METHOD': 'POST',     'SCRIPT_NAME': u'',     'SERVER_NAME': 'gongyi.codoon.com',     'SERVER_PORT': '80',     'SERVER_PROTOCOL': 'HTTP/1.0',     'wsgi.errors': <open file '<stderr>', mode 'w' at 0x7f4e2d698270>,     'wsgi.input': <_io.BytesIO object at 0x1e62bf0>,     'wsgi.multiprocess': True,     'wsgi.multithread': False,     'wsgi.run_once': False,     'wsgi.url_scheme': 'http',     'wsgi.version': (1, 0)}>    token \t    {u'access_token': u'bbcf72d399e17323684fc1d238b11051',     u'expire_in': 93312000,     u'refresh_token': u'53a5e2ec575f3d6751af3f7df6f4937e',     u'scope': u'feeds messages user',     u'token_type': u'bearer',     u'user_id': u'45273fbc-8804-4d5b-b435-6225997a6d15'}    user \t    {u'_auto_id': 1288778,     u'address': u'',     u'age': 13,     u'birthday': {u'd': 1, u'm': 8, u'y': 2000},     u'certificateid': u'',     u'certificateinfo': u'',     u'certificatename': u'',     u'descroption': u'\\u201c><img src=1 onerror=alert(1);>',     u'domain': u'~tc5v!i!',     u'email': u'xiaoleboke@qq.com',     u'emailverified': False,     u'fighting_level': 0,     u'followers': 0,     u'followings': 2,     u'gender': u'0',     u'get_icon_large': u'http://static.codoon.com/image/default_header/female_l.png',     u'get_icon_middle': u'http://static.codoon.com/image/default_header/female_m.png',     u'get_icon_small': u'http://static.codoon.com/image/default_header/female_s.png',     u'get_icon_tiny': u'http://static.codoon.com/image/default_header/female_t.png',     u'get_icon_xlarge': u'http://static.codoon.com/image/default_header/female_x.png',     u'group_ids': u'',     u'height': 170,     u'hobby': u'\\u8dd1\\u6b65',     u'id': u'45273fbc-8804-4d5b-b435-6225997a6d15',     u'installed_apps': u'CDN_JOURNAL CDN_WELFARE',     u'is_newuser': False,     u'last_login': 0,     u'location': u'\\u5317\\u4eac ',     u'mobile_portraits': [],     u'mobile_portraits_l': [],     u'mobile_portraits_x': [],     u'mobilenumber': u'I1375449215156',     u'mobileverified': False,     u'nick': u'mango1995',     u'portrait': u' ',     u'realname': u' ',     u'routes_count': 0,     u'runstridelength': 90,     u'stridelength': 50,     u'tmp_portrait': u'',     u'verify_code': u'c25553c5e99f427d8e35046eee52574b',     u'week_goal_type': u'steps',     u'week_goal_value': 70000,     u'weight': 60.0}    func \t    <function give_calcoin at 0x1cc3500>    kwargs \t    {}    /var/www/ncodoon/gongyi/commonweal/views.py in give_calcoin            flag, result = interface.create_order(plan_id, user_id, calcoin, request.user.get('nick'), request.user.get('domain'))        ...    ▼ Local vars    Variable \tValue    urlencode \t    <function urlencode at 0x1e9ea28>    plan_id \t    u'-1'    request \t    <WSGIRequest    GET:<QueryDict: {}>,    POST:<QueryDict: {u'plan_id': [u'-1'], u'calcoin': [u'1']}>,    COOKIES:{'Hm_lpvt_9cca1c462e3682d7fb991e5cf0c7382f': '1375451017',     'Hm_lvt_9cca1c462e3682d7fb991e5cf0c7382f': '1374217191,1375449009,1375449119,1375449162',     'sessionid': '2927ea2dce22f153cf094f1781672934'},    META:{'CONTENT_LENGTH': '20',     'CONTENT_TYPE': 'application/x-www-form-urlencoded',     'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',     'HTTP_ACCEPT_ENCODING': 'gzip, deflate',     'HTTP_ACCEPT_LANGUAGE': 'zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3',     'HTTP_CONNECTION': 'close',     'HTTP_COOKIE': 'Hm_lvt_9cca1c462e3682d7fb991e5cf0c7382f=1374217191,1375449009,1375449119,1375449162; Hm_lpvt_9cca1c462e3682d7fb991e5cf0c7382f=1375451017; sessionid=2927ea2dce22f153cf094f1781672934',     'HTTP_HOST': 'gongyi.codoon.com',     'HTTP_MANGO': 'TEST',     'HTTP_REFERER': 'http://gongyi.codoon.com/plan/1',     'HTTP_USER_AGENT': 'Mozilla/5.0 (Windows NT 5.1; rv:22.0) Gecko/20100101 Firefox/22.0',     'HTTP_X_REAL_IP': '122.225.175.91',     'HTTP_X_SCHEME': 'http',     'PATH_INFO': u'/give_calcoin',     'QUERY_STRING': '',     'REMOTE_ADDR': '127.0.0.1',     'REQUEST_METHOD': 'POST',     'SCRIPT_NAME': u'',     'SERVER_NAME': 'gongyi.codoon.com',     'SERVER_PORT': '80',     'SERVER_PROTOCOL': 'HTTP/1.0',     'wsgi.errors': <open file '<stderr>', mode 'w' at 0x7f4e2d698270>,     'wsgi.input': <_io.BytesIO object at 0x1e62bf0>,     'wsgi.multiprocess': True,     'wsgi.multithread': False,     'wsgi.run_once': False,     'wsgi.url_scheme': 'http',     'wsgi.version': (1, 0)}>    token \t    {u'access_token': u'bbcf72d399e17323684fc1d238b11051',     u'expire_in': 93312000,     u'refresh_token': u'53a5e2ec575f3d6751af3f7df6f4937e',     u'scope': u'feeds messages user',     u'token_type': u'bearer',     u'user_id': u'45273fbc-8804-4d5b-b435-6225997a6d15'}    calcoin \t    u'1'    user_id \t    u'45273fbc-8804-4d5b-b435-6225997a6d15'    /var/www/ncodoon/gongyi/commonweal/interface.py in create_order                                             value=value, order_num=create_order_num())        ...    ▼ Local vars    Variable \tValue    nick \t    u'mango1995'    domain \t    u'~tc5v!i!'    user_id \t    u'45273fbc-8804-4d5b-b435-6225997a6d15'    value \t    1    plan_id \t    u'-1'    /opt/python2.7.2/lib/python2.7/site-packages/django/db/models/manager.py in create                return self.get_query_set().create(**kwargs)        ...    ▼ Local vars    Variable \tValue    self \t    <django.db.models.manager.Manager object at 0x1cc0cd0>    kwargs \t    {'codoon_plan_id': u'-1',     'order_num': '2013080221476uXE',     'user_domain': u'~tc5v!i!',     'user_id': u'45273fbc-8804-4d5b-b435-6225997a6d15',     'user_nick': u'mango1995',     'value': 1}    /opt/python2.7.2/lib/python2.7/site-packages/django/db/models/query.py in create                obj.save(force_insert=True, using=self.db)        ...    ▼ Local vars    Variable \tValue    self \t    [<CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, <CalcoinOrder: CalcoinOrder object>, '...(remaining elements truncated)...']    obj \t    <CalcoinOrder: CalcoinOrder object>    kwargs \t    {'codoon_plan_id': u'-1',     'order_num': '2013080221476uXE',     'user_domain': u'~tc5v!i!',     'user_id': u'45273fbc-8804-4d5b-b435-6225997a6d15',     'user_nick': u'mango1995',     'value': 1}    /opt/python2.7.2/lib/python2.7/site-packages/django/db/models/base.py in save                self.save_base(using=using, force_insert=force_insert, force_update=force_update)        ...    ▼ Local vars    Variable \tValue    using \t    'default'    self \t    <CalcoinOrder: CalcoinOrder object>    force_update \t    False    force_insert \t    True    /opt/python2.7.2/lib/python2.7/site-packages/django/db/models/base.py in save_base                            result = manager._insert(values, return_id=update_pk, using=using)        ...    ▼ Local vars    Variable \tValue    origin \t    <class 'gongyi.commonweal.models.CalcoinOrder'>    non_pks \t    [<django.db.models.fields.related.ForeignKey object at 0x1cc05d0>,     <django.db.models.fields.CharField object at 0x1cc0710>,     <django.db.models.fields.CharField object at 0x1cc0790>,     <django.db.models.fields.CharField object at 0x1cc0810>,     <django.db.models.fields.CharField object at 0x1cc0890>,     <django.db.models.fields.FloatField object at 0x1cc0910>,     <django.db.models.fields.IntegerField object at 0x1cc0950>,     <django.db.models.fields.DateTimeField object at 0x1cc0990>]    f \t    <django.db.models.fields.DateTimeField object at 0x1cc0990>    self \t    <CalcoinOrder: CalcoinOrder object>    force_update \t    False    connection \t    <django.db.backends.mysql.base.DatabaseWrapper object at 0x1870258>    force_insert \t    True    raw \t    False    manager \t    <django.db.models.manager.Manager object at 0x1cc0cd0>    meta \t    <Options for CalcoinOrder>    values \t    [(<django.db.models.fields.related.ForeignKey object at 0x1cc05d0>, -1),     (<django.db.models.fields.CharField object at 0x1cc0710>, '2013080221476uXE'),     (<django.db.models.fields.CharField object at 0x1cc0790>,      u'45273fbc-8804-4d5b-b435-6225997a6d15'),     (<django.db.models.fields.CharField object at 0x1cc0810>, u'mango1995'),     (<django.db.models.fields.CharField object at 0x1cc0890>, u'~tc5v!i!'),     (<django.db.models.fields.FloatField object at 0x1cc0910>, 1.0),     (<django.db.models.fields.IntegerField object at 0x1cc0950>, 0),     (<django.db.models.fields.DateTimeField object at 0x1cc0990>,      u'2013-08-02 21:47:00')]    pk_val \t    None    using \t    'default'    pk_set \t    False    org \t    None    cls \t    <class 'gongyi.commonweal.models.CalcoinOrder'>    update_pk \t    True    record_exists \t    False    /opt/python2.7.2/lib/python2.7/site-packages/django/db/models/manager.py in _insert                return insert_query(self.model, values, **kwargs)        ...    ▼ Local vars    Variable \tValue    self \t    <django.db.models.manager.Manager object at 0x1cc0cd0>    values \t    [(<django.db.models.fields.related.ForeignKey object at 0x1cc05d0>, -1),     (<django.db.models.fields.CharField object at 0x1cc0710>, '2013080221476uXE'),     (<django.db.models.fields.CharField object at 0x1cc0790>,      u'45273fbc-8804-4d5b-b435-6225997a6d15'),     (<django.db.models.fields.CharField object at 0x1cc0810>, u'mango1995'),     (<django.db.models.fields.CharField object at 0x1cc0890>, u'~tc5v!i!'),     (<django.db.models.fields.FloatField object at 0x1cc0910>, 1.0),     (<django.db.models.fields.IntegerField object at 0x1cc0950>, 0),     (<django.db.models.fields.DateTimeField object at 0x1cc0990>,      u'2013-08-02 21:47:00')]    kwargs \t    {'return_id': True, 'using': 'default'}    /opt/python2.7.2/lib/python2.7/site-packages/django/db/models/query.py in insert_query            return query.get_compiler(using=using).execute_sql(return_id)        ...    ▼ Local vars    Variable \tValue    raw_values \t    False    return_id \t    True    values \t    [(<django.db.models.fields.related.ForeignKey object at 0x1cc05d0>, -1),     (<django.db.models.fields.CharField object at 0x1cc0710>, '2013080221476uXE'),     (<django.db.models.fields.CharField object at 0x1cc0790>,      u'45273fbc-8804-4d5b-b435-6225997a6d15'),     (<django.db.models.fields.CharField object at 0x1cc0810>, u'mango1995'),     (<django.db.models.fields.CharField object at 0x1cc0890>, u'~tc5v!i!'),     (<django.db.models.fields.FloatField object at 0x1cc0910>, 1.0),     (<django.db.models.fields.IntegerField object at 0x1cc0950>, 0),     (<django.db.models.fields.DateTimeField object at 0x1cc0990>,      u'2013-08-02 21:47:00')]    using \t    'default'    query \t    <django.db.models.sql.subqueries.InsertQuery object at 0x1dcf550>    model \t    <class 'gongyi.commonweal.models.CalcoinOrder'>    /opt/python2.7.2/lib/python2.7/site-packages/django/db/models/sql/compiler.py in execute_sql                cursor = super(SQLInsertCompiler, self).execute_sql(None)        ...    ▼ Local vars    Variable \tValue    self \t    <django.db.backends.mysql.compiler.SQLInsertCompiler object at 0x1dcffd0>    return_id \t    True    /opt/python2.7.2/lib/python2.7/site-packages/django/db/models/sql/compiler.py in execute_sql                cursor.execute(sql, params)        ...    ▼ Local vars    Variable \tValue    cursor \t    <django.db.backends.util.CursorDebugWrapper object at 0x1dcff90>    self \t    <django.db.backends.mysql.compiler.SQLInsertCompiler object at 0x1dcffd0>    params \t    (-1,     '2013080221476uXE',     u'45273fbc-8804-4d5b-b435-6225997a6d15',     u'mango1995',     u'~tc5v!i!',     1.0,     0,     u'2013-08-02 21:47:00')    result_type \t    None    sql \t    'INSERT INTO `commonweal_calcoinorder` (`codoon_plan_id`, `order_num`, `user_id`, `user_nick`, `user_domain`, `value`, `state`, `create_time`) VALUES (%s, %s, %s, %s, %s, %s, %s, %s)'    /opt/python2.7.2/lib/python2.7/site-packages/django/db/backends/util.py in execute                    return self.cursor.execute(sql, params)        ...    ▼ Local vars    Variable \tValue    self \t    <django.db.backends.util.CursorDebugWrapper object at 0x1dcff90>    stop \t    1375451220.39204    start \t    1375451220.388513    params \t    (-1,     '2013080221476uXE',     u'45273fbc-8804-4d5b-b435-6225997a6d15',     u'mango1995',     u'~tc5v!i!',     1.0,     0,     u'2013-08-02 21:47:00')    sql \t    u'INSERT INTO `commonweal_calcoinorder` (`codoon_plan_id`, `order_num`, `user_id`, `user_nick`, `user_domain`, `value`, `state`, `create_time`) VALUES (-1, 2013080221476uXE, 45273fbc-8804-4d5b-b435-6225997a6d15, mango1995, ~tc5v!i!, 1.0, 0, 2013-08-02 21:47:00)'    duration \t    0.003526926040649414    /opt/python2.7.2/lib/python2.7/site-packages/django/db/backends/mysql/base.py in execute                    return self.cursor.execute(query, args)        ...    ▼ Local vars    Variable \tValue    query \t    'INSERT INTO `commonweal_calcoinorder` (`codoon_plan_id`, `order_num`, `user_id`, `user_nick`, `user_domain`, `value`, `state`, `create_time`) VALUES (%s, %s, %s, %s, %s, %s, %s, %s)'    self \t    <django.db.backends.mysql.base.CursorWrapper object at 0x1dcf110>    args \t    (-1,     '2013080221476uXE',     u'45273fbc-8804-4d5b-b435-6225997a6d15',     u'mango1995',     u'~tc5v!i!',     1.0,     0,     u'2013-08-02 21:47:00')    e \t    IntegrityError(1452, 'Cannot add or update a child row: a foreign key constraint fails (`app_codoon`.`commonweal_calcoinorder`, CONSTRAINT `codoon_plan_id_refs_id_6bd1254d` FOREIGN KEY (`codoon_plan_id`) REFERENCES `commonweal_codoonplan` (`id`))')    /opt/python2.7.2/lib/python2.7/site-packages/MySQLdb/cursors.py in execute                    self.errorhandler(self, exc, value)        ...    ▼ Local vars    Variable \tValue    charset \t    'utf8'    exc \t    <class '_mysql_exceptions.IntegrityError'>    self \t    <MySQLdb.cursors.Cursor object at 0x1dcf150>    args \t    (-1,     '2013080221476uXE',     u'45273fbc-8804-4d5b-b435-6225997a6d15',     u'mango1995',     u'~tc5v!i!',     1.0,     0,     u'2013-08-02 21:47:00')    db \t    <weakproxy at 0x1e6aaa0 to Connection at 0x1fdf3a0>    value \t    IntegrityError(1452, 'Cannot add or update a child row: a foreign key constraint fails (`app_codoon`.`commonweal_calcoinorder`, CONSTRAINT `codoon_plan_id_refs_id_6bd1254d` FOREIGN KEY (`codoon_plan_id`) REFERENCES `commonweal_codoonplan` (`id`))')    query \t    \"INSERT INTO `commonweal_calcoinorder` (`codoon_plan_id`, `order_num`, `user_id`, `user_nick`, `user_domain`, `value`, `state`, `create_time`) VALUES (-1, '2013080221476uXE', '45273fbc-8804-4d5b-b435-6225997a6d15', 'mango1995', '~tc5v!i!', 1, 0, '2013-08-02 21:47:00')\"    /opt/python2.7.2/lib/python2.7/site-packages/MySQLdb/connections.py in defaulterrorhandler            raise errorclass, errorvalue        ...    ▼ Local vars    Variable \tValue    errorclass \t    <class '_mysql_exceptions.IntegrityError'>    errorvalue \t    IntegrityError(1452, 'Cannot add or update a child row: a foreign key constraint fails (`app_codoon`.`commonweal_calcoinorder`, CONSTRAINT `codoon_plan_id_refs_id_6bd1254d` FOREIGN KEY (`codoon_plan_id`) REFERENCES `commonweal_codoonplan` (`id`))')    error \t    (<class '_mysql_exceptions.IntegrityError'>,     IntegrityError(1452, 'Cannot add or update a child row: a foreign key constraint fails (`app_codoon`.`commonweal_calcoinorder`, CONSTRAINT `codoon_plan_id_refs_id_6bd1254d` FOREIGN KEY (`codoon_plan_id`) REFERENCES `commonweal_codoonplan` (`id`))'))Request informationGETNo GET dataPOSTVariable \tValueplan_id \tu'-1'calcoin \tu'1'FILESNo FILES dataCOOKIESVariable \tValueHm_lvt_9cca1c462e3682d7fb991e5cf0c7382f \t'1374217191,1375449009,1375449119,1375449162'sessionid \t'2927ea2dce22f153cf094f1781672934'Hm_lpvt_9cca1c462e3682d7fb991e5cf0c7382f \t'1375451017'METAVariable \tValueHTTP_X_SCHEME \t'http'CONTENT_TYPE \t'application/x-www-form-urlencoded'HTTP_REFERER \t'http://gongyi.codoon.com/plan/1'wsgi.multithread \tFalseSCRIPT_NAME \tu''wsgi.input \t<_io.BytesIO object at 0x1e62bf0>REQUEST_METHOD \t'POST'HTTP_HOST \t'gongyi.codoon.com'PATH_INFO \tu'/give_calcoin'SERVER_PROTOCOL \t'HTTP/1.0'QUERY_STRING \t''HTTP_CONNECTION \t'close'HTTP_X_REAL_IP \t'122.225.175.91'CONTENT_LENGTH \t'20'HTTP_USER_AGENT \t'Mozilla/5.0 (Windows NT 5.1; rv:22.0) Gecko/20100101 Firefox/22.0'wsgi.version \t(1, 0)HTTP_COOKIE \t'Hm_lvt_9cca1c462e3682d7fb991e5cf0c7382f=1374217191,1375449009,1375449119,1375449162; Hm_lpvt_9cca1c462e3682d7fb991e5cf0c7382f=1375451017; sessionid=2927ea2dce22f153cf094f1781672934'SERVER_NAME \t'gongyi.codoon.com'REMOTE_ADDR \t'127.0.0.1'wsgi.run_once \tFalsewsgi.errors \t<open file '<stderr>', mode 'w' at 0x7f4e2d698270>wsgi.multiprocess \tTrueHTTP_ACCEPT_LANGUAGE \t'zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3'wsgi.url_scheme \t'http'HTTP_MANGO \t'TEST'SERVER_PORT \t'80'HTTP_ACCEPT \t'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'HTTP_ACCEPT_ENCODING \t'gzip, deflate'SettingsUsing settings module settingsSetting \tValueUSE_L10N \tTrueUSE_THOUSAND_SEPARATOR \tFalseLANGUAGE_CODE \t'zh-cn'ROOT_URLCONF \t'gongyi.urls'MANAGERS \t()SAE_MYSQL_USER \t'aliyunmysql'DEFAULT_CHARSET \t'utf-8'SERVER_DOMAIN \t'xiaogd.com'STATIC_ROOT \t'/var/www/ncodoon/static_root_s'TEST_DATABASE_CHARSET \tNoneMESSAGE_STORAGE \t'django.contrib.messages.storage.user_messages.LegacyFallbackStorage'DATABASE_HOST \t''EMAIL_SUBJECT_PREFIX \t'[Django] 'SEND_BROKEN_LINK_EMAILS \tFalseURL_VALIDATOR_USER_AGENT \t'Django/1.3.1 (http://www.djangoproject.com)'STATICFILES_FINDERS \t('django.contrib.staticfiles.finders.FileSystemFinder', 'django.contrib.staticfiles.finders.AppDirectoriesFinder')SESSION_COOKIE_DOMAIN \tNoneSESSION_COOKIE_NAME \t'sessionid'ADMIN_FOR \t()TIME_INPUT_FORMATS \t('%H:%M:%S', '%H:%M')DATABASES \t{'default': {'ENGINE': 'django.db.backends.mysql',             'HOST': 'rdsfviy3ifviy3i1367979506919.mysql.rds.aliyuncs.com',             'NAME': 'app_codoon',             'OPTIONS': {},             'PASSWORD': '********************',             'PORT': '3306',             'TEST_CHARSET': None,             'TEST_COLLATION': None,             'TEST_MIRROR': None,             'TEST_NAME': None,             'TIME_ZONE': 'Asia/Shanghai',             'USER': 'aliyunmysql'}}TEST_DATABASE_NAME \tNoneFILE_UPLOAD_PERMISSIONS \tNoneFILE_UPLOAD_HANDLERS \t('django.core.files.uploadhandler.MemoryFileUploadHandler', 'django.core.files.uploadhandler.TemporaryFileUploadHandler')DEFAULT_CONTENT_TYPE \t'text/html'APPEND_SLASH \tTrueFIRST_DAY_OF_WEEK \t0DATABASE_ROUTERS \t[]YEAR_MONTH_FORMAT \t'F Y'STATICFILES_STORAGE \t'django.contrib.staticfiles.storage.StaticFilesStorage'CACHES \t{'default': {'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',             'LOCATION': ''}}SERVER_EMAIL \t'root@localhost'SESSION_COOKIE_PATH \t'/'USE_X_FORWARDED_HOST \tFalseIGNORABLE_404_ENDS \t('mail.pl', 'mailform.pl', 'mail.cgi', 'mailform.cgi', 'favicon.ico', '.php')MIDDLEWARE_CLASSES \t('django.middleware.common.CommonMiddleware', 'django.contrib.sessions.middleware.SessionMiddleware', 'django.contrib.auth.middleware.AuthenticationMiddleware')USE_I18N \tTrueTHOUSAND_SEPARATOR \t','SECRET_KEY \t'********************'HOME_URL \t'http://www.a.com/home'LANGUAGE_COOKIE_NAME \t'django_language'FILE_UPLOAD_TEMP_DIR \tNoneTRANSACTIONS_MANAGED \tFalseLOGGING_CONFIG \t'django.utils.log.dictConfig'TEMPLATE_LOADERS \t('django.template.loaders.filesystem.Loader',)TEMPLATE_DEBUG \tTrueAUTHENTICATION_BACKENDS \t('django.contrib.auth.backends.ModelBackend',)TEST_DATABASE_COLLATION \tNoneFORCE_SCRIPT_NAME \tNoneCACHE_BACKEND \t'locmem://'SSO_KEY \t'12345678'DECIMAL_SEPARATOR \t'.'SESSION_COOKIE_SECURE \tFalseCSRF_COOKIE_DOMAIN \tNoneFILE_CHARSET \t'utf-8'DEBUG \tTrueSESSION_FILE_PATH \tNoneDEFAULT_FILE_STORAGE \t'django.core.files.storage.FileSystemStorage'INSTALLED_APPS \t['django.contrib.sessions', 'gongyi.custom_tags', 'gongyi.demo', 'gongyi.commonweal', 'gongyi.common']LANGUAGES \t(('ar', 'Arabic'), ('az', 'Azerbaijani'), ('bg', 'Bulgarian'), ('bn', 'Bengali'), ('bs', 'Bosnian'), ('ca', 'Catalan'), ('cs', 'Czech'), ('cy', 'Welsh'), ('da', 'Danish'), ('de', 'German'), ('el', 'Greek'), ('en', 'English'), ('en-gb', 'British English'), ('es', 'Spanish'), ('es-ar', 'Argentinian Spanish'), ('es-mx', 'Mexican Spanish'), ('es-ni', 'Nicaraguan Spanish'), ('et', 'Estonian'), ('eu', 'Basque'), ('fa', 'Persian'), ('fi', 'Finnish'), ('fr', 'French'), ('fy-nl', 'Frisian'), ('ga', 'Irish'), ('gl', 'Galician'), ('he', 'Hebrew'), ('hi', 'Hindi'), ('hr', 'Croatian'), ('hu', 'Hungarian'), ('id', 'Indonesian'), ('is', 'Icelandic'), ('it', 'Italian'), ('ja', 'Japanese'), ('ka', 'Georgian'), ('km', 'Khmer'), ('kn', 'Kannada'), ('ko', 'Korean'), ('lt', 'Lithuanian'), ('lv', 'Latvian'), ('mk', 'Macedonian'), ('ml', 'Malayalam'), ('mn', 'Mongolian'), ('nl', 'Dutch'), ('no', 'Norwegian'), ('nb', 'Norwegian Bokmal'), ('nn', 'Norwegian Nynorsk'), ('pa', 'Punjabi'), ('pl', 'Polish'), ('pt', 'Portuguese'), ('pt-br', 'Brazilian Portuguese'), ('ro', 'Romanian'), ('ru', 'Russian'), ('sk', 'Slovak'), ('sl', 'Slovenian'), ('sq', 'Albanian'), ('sr', 'Serbian'), ('sr-latn', 'Serbian Latin'), ('sv', 'Swedish'), ('ta', 'Tamil'), ('te', 'Telugu'), ('th', 'Thai'), ('tr', 'Turkish'), ('uk', 'Ukrainian'), ('ur', 'Urdu'), ('vi', 'Vietnamese'), ('zh-cn', 'Simplified Chinese'), ('zh-tw', 'Traditional Chinese'))DATABASE_ENGINE \t''DATABASE_NAME \t''COMMENTS_FIRST_FEW \t0PREPEND_WWW \tFalseSESSION_COOKIE_HTTPONLY \tFalseDATABASE_PORT \t''DEBUG_PROPAGATE_EXCEPTIONS \tFalseIMG_URL \t'http://img2.a.com'MONTH_DAY_FORMAT \t'F j'LOGIN_URL \t'/accounts/login/'SESSION_EXPIRE_AT_BROWSER_CLOSE \tFalseSAE_MYSQL_PASS \t'aliyunmysql5401036'TIME_FORMAT \t'P'REDIRECT_URL \t'http://gongyi.codoon.com'DATE_INPUT_FORMATS \t('%Y-%m-%d', '%m/%d/%Y', '%m/%d/%y', '%b %d %Y', '%b %d, %Y', '%d %b %Y', '%d %b, %Y', '%B %d %Y', '%B %d, %Y', '%d %B %Y', '%d %B, %Y')CSRF_COOKIE_NAME \t'csrftoken'EMAIL_HOST_PASSWORD \t'********************'PASSWORD_RESET_TIMEOUT_DAYS \t'********************'CACHE_MIDDLEWARE_ALIAS \t'default'SESSION_SAVE_EVERY_REQUEST \tFalseADMIN_MEDIA_PREFIX \t'/static/admin/'NUMBER_GROUPING \t0SAE_MYSQL_HOST \t'rdsfviy3ifviy3i1367979506919.mysql.rds.aliyuncs.com'SESSION_ENGINE \t'django.contrib.sessions.backends.db'CSRF_FAILURE_VIEW \t'django.views.csrf.csrf_failure'COMMENTS_SKETCHY_USERS_GROUP \tNoneLOGIN_REDIRECT_URL \t'/accounts/profile/'IMG2_URL \t'http://img2.a.com'LOGGING \t{'disable_existing_loggers': False, 'handlers': {'mail_admins': {'class': 'django.utils.log.AdminEmailHandler',                              'level': 'ERROR'}}, 'loggers': {'django.request': {'handlers': ['mail_admins'],                                'level': 'ERROR',                                'propagate': True}}, 'version': 1}CACHE_MIDDLEWARE_KEY_PREFIX \t''LOCALE_PATHS \t()TEMPLATE_STRING_IF_INVALID \t''COMMENTS_ALLOW_PROFANITIES \tFalseLOGOUT_URL \t'/accounts/logout/'EMAIL_USE_TLS \tFalseTEMPLATE_DIRS \t('/var/www/ncodoon/gongyi/templates',)FIXTURE_DIRS \t()EMAIL_HOST \t'localhost'DATE_FORMAT \t'Y-m-d'SAE_MYSQL_DB \t'app_codoon'MEDIA_ROOT \t'/var/www/ncodoon/gongyi/media'ADMINS \t()FORMAT_MODULE_PATH \tNoneDEFAULT_FROM_EMAIL \t'webmaster@localhost'VAR_DICT \t{'db': ('aliyunmysql',        'aliyunmysql5401036',        'rdsfviy3ifviy3i1367979506919.mysql.rds.aliyuncs.com'), 'home_url': 'http://www.a.com/home', 'img2_url': 'http://img2.a.com', 'media_url': '/media', 'mom_url': 'http://mom.a.com:8003', 'sso_url': 'http://sso.a.com:8002'}STATICFILES_DIRS \t()MEDIA_URL \t'/media'DATETIME_FORMAT \t'Y-m-d H:i'IGNORABLE_404_STARTS \t('/cgi-bin/', '/_vti_bin', '/_vti_inf')SITE_ID \t1DISALLOWED_USER_AGENTS \t()ALLOWED_INCLUDE_ROOTS \t()API_DOMAIN \t'http://api.codoon.com'SSO_DOMAIN \t'http://sso.a.com:8002'SHORT_DATE_FORMAT \t'm/d/Y'DATABASE_USER \t''TEST_RUNNER \t'django.test.simple.DjangoTestSuiteRunner'TIME_ZONE \t'Asia/Shanghai'FILE_UPLOAD_MAX_MEMORY_SIZE \t2621440EMAIL_BACKEND \t'django.core.mail.backends.smtp.EmailBackend'DEFAULT_TABLESPACE \t''TEMPLATE_CONTEXT_PROCESSORS \t('django.core.context_processors.debug', 'django.core.context_processors.i18n', 'django.core.context_processors.media', 'django.core.context_processors.request', 'gongyi.common.context_processors.config')SITE_DOMAIN \t'http://www.codoon.com'SESSION_COOKIE_AGE \t1209600SETTINGS_MODULE \t'settings'USE_ETAGS \tFalseSITE_ROOT \t'/var/www/ncodoon/gongyi'MOM_DOMAIN \t'http://mom.a.com:8003'LANGUAGES_BIDI \t('he', 'ar', 'fa')DEFAULT_INDEX_TABLESPACE \t''INTERNAL_IPS \t()STATIC_URL \t'/static/'EMAIL_PORT \t25SHORT_DATETIME_FORMAT \t'm/d/Y P'ABSOLUTE_URL_OVERRIDES \t{}DATABASE_OPTIONS \t{}CACHE_MIDDLEWARE_SECONDS \t600BANNED_IPS \t()DATETIME_INPUT_FORMATS \t('%Y-%m-%d %H:%M:%S', '%Y-%m-%d %H:%M', '%Y-%m-%d', '%m/%d/%Y %H:%M:%S', '%m/%d/%Y %H:%M', '%m/%d/%Y', '%m/%d/%y %H:%M:%S', '%m/%d/%y %H:%M', '%m/%d/%y')DATABASE_PASSWORD \t'********************'COMMENTS_MODERATORS_GROUP \tNonePROFANITIES_LIST \t'********************'SAE_MYSQL_PORT \t'3306'EMAIL_HOST_USER \t''COMMENTS_BANNED_USERS_GROUP \tNoneYou're seeing this error because you have DEBUG = True in your Django settings file. Change that to False, and Django will display a standard 500 page.\n   修复方案：  你懂得   版权声明：转载请注明来源 mango@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2013-08-03 10:57 厂商回复： 谢谢，已修改 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-08-03 09:44 |    \t\tz@cx \t\t\t( 普通白帽子  |\t\t\t        Rank:434 漏洞数:56        | 。-。-。)\t\t \n  @咕咚网 你们的手环啥时候发布哇！！！    \n     2013-08-03 09:53 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  @z@cx  - -不要问我    \n     2013-08-03 09:56 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环求咕咚手环    \n     2013-08-03 09:57 |    \t\t我是小号 \t\t\t( 普通白帽子  |\t\t\t        Rank:334 漏洞数:51        | Martin)\t\t \n  @mango 这是刷屏的节奏···    \n     2013-08-03 09:57 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  @我是小号  - -    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}