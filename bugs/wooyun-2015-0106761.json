{"id": 20012, "wybug_id": "wooyun-2015-0106761", "wybug_title": "瑞星杀毒网络版存在通信漏洞，可导致远程停止监控、卸载、上传下载文件、远程shell权限执行", "wybug_corp": "RiSing", "wybug_author": "路人甲", "wybug_date": "2015-04-09 10:28", "wybug_open_date": "2015-07-08 13:10", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行", "客户端安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-08：\t细节向公众公开  简要描述：     企业内部安装的“瑞星杀毒软件网络版”（RavSetup22.01.70.60）通信存在漏洞，可导致局域网内其他计算机可以远程攻击安装有“瑞星杀毒软件网络版”的计算机。    可导致的后果：远程调整瑞星设置、远程启动停止瑞星监控、远程上传文件到目标计算机、远程以SHELL身份执行任意程序。 详细说明：      “瑞星杀毒软件网络版”与服务器通信方式部分在ravsevproxy.dll中，通信方式采用了CORBA作为通信协议来进行网络版客户端和服务器直接通信使用，同时并没有使用SSLIOP进行通信加密导致可通过监听来分析通信数据与命名格式。     在分析出通信协议的具体格式后发现瑞星网络版通信协议并未对发送命令的来源方进行检测导致存在认证漏洞。任意计算机可模仿瑞星网络版服务器对任意客户端发送假冒命令。\n\n   漏洞证明：  该问题是几年前发现，向瑞星反馈无果，考虑到安全性风险，所以一直未公布。现在考虑请求邀请码才将其发布出来。目前所在环境无法运行对应的瑞星程序，所以只能提供代码或截图片段证明。\n\n通信接口代码（片段）\ninterface Service{\tlong RunRavProgram(in string filePath);\tlong QuitRavProgram(in string filePath);\tlong InstallSoftware(in long agr1, in string agr2, in string agr3, in string agr4, in long agr5);\tchar InstallControl(in string arg1, in short arg2);\tchar UninstallControl();\tDiskInfo GetAllDisk();\tDiskInfo GetAllHardDisk();\tDiskInfo GetAllHardNetDisk();\tchar GetFileStatus(in string filePath, out FileState state);\tlong GetFile(in string filePath, in long nPos, out List buffer);\tlong GetFileEx(in string filePath, in long nPos, out List buffer);\tlong ReadFile(in string filePath, in long nPos, out List buffer);\tlong AddTask(in string taskInfo, in long replayCount, in string remoteIP, in long nPort, in string objectName, in string macAddress, in string arg3, in string arg4);\tlong DeleteTask(in long taskId);\tlong QueryTask(in long fastId, in long count, out TaskInfoList askList);\tlong OnFinishTask(in string taskInfo, in string arg1, in long arg2, in string agr3);\tDiagnoseInfo GetDiagnose(in long type);\t//List GetRegInfoList(in List info);\t// SysDef、AppCtrl、ActVirus、RemovMon、WebMon、RsSelf、FileMon、MailMon\tlong CtrlMonitorEx(in InfoValueList arg0);\tlong ReadConfig(in string name, in string arg2, out string retValue);\tlong WriteConfig(in string name, in string arg2, in string value);\tlong GetRsConfig(in long arg0, out List arg1, out long arg2);\tlong SetRsConfig(in long arg0, in List arg1, in long arg2);\tlong GetClientStatus(out ClientInfo info);};\nIDA反汇编代码：\ncase 42:        result = remote_Uninstall(v7, (int)readPos, (DWORD)readSize, (char *)readBuffer, (int)writeBuffer);        break;      case 43:        result = remote_UninstallControl(v7, (int)readPos, (int)readSize, (int)readBuffer, (int)writeBuffer);        break;      case 44:        result = remote_UninstallReceiver(v7, (int)readPos, (int)readSize, (int)readBuffer, writeBuffer);        break;      case 45:        result = remote_UninstallSender(v7, (int)readPos, (int)readSize, (int)readBuffer, writeBuffer);        break;      case 46:        result = remote_UpdateClient(v7, (int)readPos, (int)readSize, (int)readBuffer, (int)writeBuffer);        break;      case 47:        result = remote_UpdateStrategy(v7, (int)readPos, (DWORD)readSize, (char *)readBuffer, (int)writeBuffer);        break;      case 48:        result = remote_WriteConfig(v7, (int)readPos, (int)readSize, (char *)readBuffer, writeBuffer);        break;      default:        goto LABEL_52;    }  }  return result;}int __cdecl ServiceCreateProcess(LPCSTR lpString2){  int v1; // eax@1  int result; // eax@4  char ArgList[4]; // [sp+0h] [bp-4h]@1  *(_DWORD *)ArgList = 0;  CheckSystemVersion_sub_10001380(ArgList);  v1 = (int)GetNCRsLogUtility();  OutputLogToFile_0(v1, \"ServiceCreateProcess():%d-%s\");  if ( ArgList[0] == 0x93 || ArgList[0] == 0x91 || ArgList[0] == 0x92 )    result = (int)ExecuteProcessAsUser((int)lpString2);  else    result = ExecuteProcess(lpString2);  return result;}\n   修复方案：  需瑞星公司更新版本增加通信认证机制，同时建议增加通信加密处理。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2015-04-09 13:09 厂商回复： 3Q! 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-09 10:30 |    \t\tMr.leo \t\t\t( 普通白帽子  |\t\t\t        Rank:1314 漏洞数:176        | 说点神马呢！！)\t\t \n  你赢了，主页变形了。    \n     2015-04-09 10:31 |    \t\t火焰真菌 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:11        | 火焰真菌)\t\t \n  duang  diao    \n     2015-04-09 10:31 |    \t\tH4ck1y \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:5        | 不拿Shell的帽子不是好的白帽子！！)\t\t \n  同楼上。。。    \n     2015-04-09 10:33 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  好长的标题，乌云主页都变形了 －－    \n     2015-04-09 10:33 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  标题要不要这么长    \n     2015-04-09 10:34 |    \t\tbitcoin \t\t\t( 普通白帽子  |\t\t\t        Rank:715 漏洞数:218        | 学习是最好的投资！)\t\t \n  好长    \n     2015-04-09 10:35 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @疯狗 没看到变形啊    \n     2015-04-09 10:36 |    \t\tHackPanda \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:15        | Talk is cheap,show me the shell.)\t\t \n  MITM吧    \n     2015-04-09 10:38 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  看着标题好难受    \n     2015-04-09 10:39 |    \t\tbitcoin \t\t\t( 普通白帽子  |\t\t\t        Rank:715 漏洞数:218        | 学习是最好的投资！)\t\t \n  @疯狗 这样好多了！    \n     2015-04-09 10:39 |    \t\the1renyagao \t\t\t( 普通白帽子  |\t\t\t        Rank:225 漏洞数:29        | 是金子总会发光，在还未发光之前，先打磨打...)\t\t \n  so diao    \n     2015-04-09 13:01 |    \t\t小马宝利 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | 特么的ID打错了。是小马宝莉。)\t\t \n  碉堡了啊。。    \n     2015-04-09 13:17 |    \t\talong \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:7        | 关注信息安全，阿龙)\t\t \n  貌似挺严重，rank才1呢？坐等公开。    \n     2015-04-09 13:43 |    \t\tbey0nd \t\t\t( 普通白帽子  |\t\t\t        Rank:895 漏洞数:142        | 相忘于江湖，不如相濡以沫)\t\t \n  1？    \n     2015-04-09 14:01 |    \t\tMITM \t\t\t( 普通白帽子  |\t\t\t        Rank:167 漏洞数:25        | 先空着)\t\t \n  貌似瑞星大部分都是1 rank。    \n     2015-04-15 08:41 |    \t\tFire ant \t\t\t( 实习白帽子  |\t\t\t        Rank:73 漏洞数:26        | 他们回来了................)\t\t \n  回复楼上=。=   瑞星穷你不知道么    \n     2015-06-23 19:08 |    \t\t内谁 \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:5        | 我是内谁)\t\t \n  1rank，醉了……    \n     2015-07-12 09:47 |    \t\t落叶_test \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:1        | 爱渗透 爱搞基)\t\t \n  该问题是几年前发现，向瑞星反馈无果，考虑到安全性风险，所以一直未公布。现在考虑请求邀请码才将其发布出来----------------洞主好厉害    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}