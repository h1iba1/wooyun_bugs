{"id": 65172, "wybug_id": "wooyun-2012-013993", "wybug_title": "美特斯邦威两个商城代码执行导致直接沦陷+某子站nginx解析漏洞", "wybug_corp": "banggo.com", "wybug_author": "Seay", "wybug_date": "2012-10-29 13:40", "wybug_open_date": "2012-12-13 13:41", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-10-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-10-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-11-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-11-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-11-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-12-13：\t细节向公众公开  简要描述： 美特斯邦威两个商城PHP代码执行导致直接沦陷;某子站nginx解析漏洞 详细说明：  两个商城ThinkPHP框架URI任意代码执行漏洞http://ampm.banggo.com/Goods/allcomment_616513.shtml/abc-abc-abc-$%7B@print(phpinfo())%7D/http://tuan.banggo.com/pptuan/10-0-1-0.shtml/abc/abc/abc/$%7B@print(phpinfo())%7D代码执行，直接就可以getshell了。还有一个nginx解析漏洞：http://express.banggo.com/css/templatecss/global.css/seay.php   漏洞证明：  亲，直接上图了哦。代码执行的两个站：\n\n\n\nnginx解析漏洞\n\n   修复方案：  亲爱的美邦，一直很喜欢哇，求礼物，求鼓励。thinkphp的代码执行，可下载官方发布的补丁： http://code.google.com/p/thinkphp/source/detail?spec=svn2904&r=2838 或者或者直接修改源码：/trunk/ThinkPHP/Lib/Core/Dispatcher.class.php$res = preg_replace('@(w+)'.$depr.'([^'.$depr.'\\/]+)@e', '$var[\\'\\\\1\\']=\"\\\\2\";', implode($depr,$paths));修改为$res = preg_replace('@(w+)'.$depr.'([^'.$depr.'\\/]+)@e', '$var[\\'\\\\1\\']=\"\\\\2';', implode($depr,$paths));将preg_replace第二个参数中的双引号改为单引号，防止其中的php变量语法被解析执行。nginx解析漏洞修复：引用自百度：1 关闭php.ini里的path_info，cgi.path_info设置成0.如果默认前面有;或者就没这段，就手动加上cgi.path_info = 0，2 修改nginx里的设置。比如原始文件server {listen 80;server_name typengine.com;location / {root /home/www/typengine.com;index index.php index.html index.htm;autoindex on;}location ~ \\.php$ {root html;fastcgi_pass 127.0.0.1:9000;fastcgi_index index.php;if ( $fastcgi_script_name ~ \\..*\\/.*php ) {return 403;}fastcgi_param SCRIPT_FILENAME /home/www/typengine.com$fastcgi_script_name;include fastcgi_params;}}   版权声明：转载请注明来源 Seay@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-10-29 14:29 厂商回复： 谢谢好友提醒 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-11-01 07:06 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @Seay 有礼物？    \n     2012-11-01 11:49 |    \t\tSeay \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:8        )\t\t \n  @风萧萧 给送了一双鞋    \n     2012-11-18 20:00 |    \t\tVty \t\t\t( 普通白帽子  |\t\t\t        Rank:199 漏洞数:37        )\t\t \n  @Seay 邪恶了    \n     2012-11-28 20:05 |    \t\tB1uH4ck \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | 大牛们你们好，小弟刚来。)\t\t \n  这个漏洞不知道是哪个版本的thinkphp    \n     2012-11-28 21:40 |    \t\tSeay \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:8        )\t\t \n  @B1uH4ck 2.1  http://www.cnseay.com/archives/564    \n     2012-11-30 00:46 |    \t\tB1uH4ck \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | 大牛们你们好，小弟刚来。)\t\t \n  @Seay 已拜读，感谢    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}