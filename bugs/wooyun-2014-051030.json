{"id": 4228, "wybug_id": "wooyun-2014-051030", "wybug_title": "phpcms最新版本sql注射一枚", "wybug_corp": "phpcms", "wybug_author": "寂寞的瘦子", "wybug_date": "2014-02-15 17:38", "wybug_open_date": "2014-05-16 17:39", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-16：\t细节向公众公开  简要描述： 操蛋捏...注：经测试需register_globals=on 详细说明：    首先我是官网选择的utf-8版本的然后下载的，（ps:应该是最新的吧...）下载之后搭建好之后要进我下载的是官网的utf-8版本（ps:应该是最新了吧...）本地搭建好之后要去后台点击生成首页测试...废话不多说了   bug存在文件/phpcms/modules/content/classes/content_tag.class.php 232行\n$siteid = $GLOBALS['siteid'] ? $GLOBALS['siteid'] : 1;\t\t$catid = (empty($data['catid']) || $data['catid'] == 0) ? '' : intval($data['catid']);\t\tif($catid) {\t\t\t$siteids = getcache('category_content','commons');\t\t\tif(!$siteids[$catid]) return false;\t\t\t$siteid = $siteids[$catid];\t\t\t$this->category = getcache('category_content_'.$siteid,'commons');\t\t}\t\tif($catid && $this->category[$catid]['child']) {\t\t\t$catids_str = $this->category[$catid]['arrchildid'];\t\t\t$pos = strpos($catids_str,',')+1;\t\t\t$catids_str = substr($catids_str, $pos);\t\t\t$sql = \"`catid` IN ($catids_str) AND \";\t\t}  elseif($catid && !$this->category[$catid]['child']) {\t\t\t\t$sql = \"`catid` = '$catid' AND \";\t\t}\t\tif($thumb) $sql .= \"`thumb` = '1' AND \";\t\tif(isset($data['where'])) $sql .= $data['where'].' AND ';\t\tif(isset($data['expiration']) && $data['expiration']==1) $sql .= '(`expiration` >= \\''.SYS_TIME.'\\' OR `expiration` = \\'0\\' ) AND ';\t\t$sql .= \"`posid` = '$posid' AND `siteid` = '\".$siteid.\"'\";通过全局接受了siteid变量所以才要开启全局变量才能注射\n   漏洞证明：    本地测试  开启mysql监控，然后burp抓包加入'可以看到'被带入查询了。\n\n   然后附上本地证明一张，利用显错读取信息。\n\n\n注：经测试需register_globals=on\n   修复方案：  求一份精美的小礼物。   版权声明：转载请注明来源 寂寞的瘦子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-02-17 09:56 厂商回复： 请联系 客服。索取礼物！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-02-16 03:02 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  默默的前排，mark    \n     2014-02-16 05:50 |    \t\tAzui \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:10        | 用一只黑色铅笔画一出舞台默剧。)\t\t \n  mark    \n     2014-03-31 18:59 |    \t\tZvall \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:14        | hello world)\t\t \n  注：经测试需register_globals=on这也算漏洞？    \n     2014-04-01 09:55 |    \t\t小驴牙牙 \t\t\t( 普通白帽子  |\t\t\t        Rank:168 漏洞数:43        | 不断学习，进步！)\t\t \n  @Zvall 怎么就不算，分析的很合理，就是存在注入点的    \n     2014-05-16 19:15 |    \t\tLonely \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:27        | 人生如梦,始终都游不过当局者迷的悲哀。)\t\t \n  register_globals=on  怕是极少啊。不过确实也算存在。    \n     2015-07-26 18:09 |    \t\t0c0c0f \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:15        | My H34rt c4n 3xploit 4ny h0les!)\t\t \n  @寂寞的瘦子 代码和截图不一致呢？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}