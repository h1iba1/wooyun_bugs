{"id": 15899, "wybug_id": "wooyun-2012-013370", "wybug_title": "ThinkSNS修改帐号验证不安全，可伪造", "wybug_corp": "ThinkSNS", "wybug_author": "齐迹", "wybug_date": "2012-10-23 10:35", "wybug_open_date": "2012-12-07 10:35", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-10-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-10-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-11-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-11-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-11-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-12-07：\t细节向公众公开  简要描述： ThinkSNS开启邮箱验证后修改帐号邮箱发送的连接不安全，可伪造 详细说明：  版本最新的2.8代码位置：thinksns\\addons\\services\\ValidationService.class.php\n$validation_code = $this->__generateCode($vid);$target_url\t = $target_url . \"&validationid=$vid&validationcode=$validation_code\";$res = model('Validation')->where(\"`validation_id`=$vid\")->setField(array('code','target_url'), array($validation_code, $target_url));if ($res) {\treturn $target_url;}else {\treturn false;}private function __generateCode($id) {return md5($id.'thinksns#^!@*#%^!@#');}\n明显这个validationid和validationcode可以很容易伪造。作为开源程序这个应该做为常量安装的时候配置，但是他们没有   漏洞证明：  说说利用把加入 a(用户id假设为1) 用户修改了安全邮箱就会收到一个验证连接如下http://test.thinksns.com/index.php?app=home&mod=Public&act=doModifyEmail&validationid=1&validationcode=304dbee8afac9f91bc211009ce9de3e8而validationcode就等于 md5(\"1thinksns#^!@*#%^!@#\")所以可以通过这个方式绕过所有的验证。好在数据不是通过参数接收的 安全级别给个低把。   修复方案：  用自定义的常量代替thinksns#^!@*#%^!@#或者自由发挥！   版权声明：转载请注明来源 齐迹@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2012-10-23 19:12 厂商回复： 此代码确实不严谨，验证串应该随机生成的。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-10-19 23:33 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  这个漏洞不是已经有厂商了么，怎么还在被认领    \n     2012-10-23 10:02 |    \t\tThinkSNS(乌云厂商)\t\t \n  @zzR 一直领不下来呢... 不知道怎么搞的    \n     2012-10-23 10:20 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  @xsser 这个厂商都来啦，怎么还处在被认领状态呢，嘿嘿    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}