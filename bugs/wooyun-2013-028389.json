{"id": 11588, "wybug_id": "wooyun-2013-028389", "wybug_title": "Android 8219321 - 漏洞分析分享", "wybug_corp": "Google", "wybug_author": "SeaRobber", "wybug_date": "2013-07-10 13:04", "wybug_open_date": "2013-07-10 13:04", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-07-10：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-07-10：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 漏洞位置：Android系统中java.util.zip工具包下ZipFile.java文件中的语句“mEntries.put(newEntry.getName(), newEntry);”没有进行校验重名entry逻辑漏洞。ZipFile.java文件如下连接：http://www.java2s.com/Open-Source/Android/android-core/platform-libcore/java/util/zip/ZipFile.java.htm 详细说明：  漏洞利用分析：zipFile.java文件是用于根据不同打开模式(如read\\write等)进行解压apk应用文件的；如下 \n/**     * Opens a file as <i>ZIP-archive</i>. \"mode\" must be {@code OPEN_READ} or     * {@code OPEN_DELETE} . The latter sets the \"delete on exit\" flag through a     * file.     * ...     */\tpublic ZipFile(File file, int mode) throws IOException {\t\t...\t\treadCentralDir();\t\t...\t}\n其中有函数readCentralDir(),其作用为根据apk压缩包的结构进行读取压缩包内容,如下： \n/**     * Find the central directory and read the contents.\t * ...     */    private void readCentralDir() throws IOException {\t\t...        rafs = new RAFStream(mRaf, centralDirOffset);        bin = new BufferedInputStream(rafs, 4096);        for (int i = 0; i < numEntries; i++) {            ZipEntry newEntry = new ZipEntry(ler, bin);            mEntries.put(newEntry.getName(), newEntry);        }\t}\n其中在遍历整个apk压缩包文件的每个entry节点并读取其内容时，语句\"mEntries.put(newEntry.getName(), newEntry);\"没有进行重名entry节点校验，从而导致apk文件在被加入重名的（并被加入了恶意代码的）Class.dex文件后，其校验签名时还是用第一个拥有正确签名的Class.dex文件，而在解压读取时却被加入的重名文件把正确的内容进行了覆盖执行；从而产生的攻击行为。目前google给出的补丁为对此语句进行重名entry校验并抛出异常：如下： \nif (mEntries.put(entryName, newEntry) != null) {\t\tthrow new ZipException(\"Duplicate entry name: \" + entryName);\t}\n   漏洞证明：  目前网上已经出现POC代码：https://gist.github.com/poliva/36b0795ab79ad6f14fd8   修复方案：     版权声明：转载请注明来源 SeaRobber@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-07-10 13:31 |    \t\t基佬库克 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:15        | 简介什么的是直接爆菊吧..)\t\t \n  前排..    \n     2013-07-10 15:04 |    \t\t熊猫 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:33        | panda)\t\t \n  厉害    \n     2013-07-10 15:56 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:132        )\t\t \n  啥都没看懂~    \n     2013-07-10 16:00 |    \t\t林夕梦 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 互联网运维工作)\t\t \n  啥都没看懂~     \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}