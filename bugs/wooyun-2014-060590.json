{"id": 55546, "wybug_id": "wooyun-2014-060590", "wybug_title": "DouPHP轻量级企业建站系统任意文件下载源码漏洞", "wybug_corp": "douco.com", "wybug_author": "Pany自留地", "wybug_date": "2014-06-23 11:57", "wybug_open_date": "2014-09-21 11:58", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-21：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 任意文件下载，漏洞文件:admin/backup.php可以下载整站文件源码，官网测试站通过。 详细说明：  漏洞文件admin/backup.php第187行开始。/** +---------------------------------------------------------- * 备份下载 +---------------------------------------------------------- */if ($_REQUEST['rec'] == 'down'){\t$sql_file_name = $dou->addslashes_deep($_GET['sql_file_name']);\tob_clean();\tif ($fp = @ fopen(\"../data/backup/\" . $sql_file_name, 'r'))\t{\t\theader(\"Content-type: application/zip\");\t\theader(\"Content-Disposition: attachment; filename=\" . $sql_file_name);\t\theader(\"Accept-Ranges: bytes\");\t\theader(\"Content-Length:\" . filesize(\"backup/\" . $sql_file_name));\t\theader('Content-transfer-encoding: binary');\t\twhile (!@ feof($fp))\t\t\techo fread($fp, 10240);\t}}PS：进入此函数需要后台管理员权限用途？在某些地方，读取数据库配置文件等等。利用再难也不能忽略这是一个漏洞   漏洞证明：  http://demo.douco.com/admin/backup.php?rec=down&sql_file_name=../../captcha.php\n\n\n\n   修复方案：  验证绝对路径。只允许下载备份目录内的文件。   版权声明：转载请注明来源 Pany自留地@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-06-23 12:01 厂商回复： 感谢您的反馈，该漏洞已经修正 最新状态： 2014-06-23：已经修复  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}