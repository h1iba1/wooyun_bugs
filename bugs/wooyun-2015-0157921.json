{"id": 79530, "wybug_id": "wooyun-2015-0157921", "wybug_title": "rockoa某处sql注入可shell", "wybug_corp": "www.rockoa.com", "wybug_author": "range", "wybug_date": "2015-12-03 13:59", "wybug_open_date": "2016-01-17 14:00", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-03：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2016-01-17：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： rt 详细说明：  在官网下了个最新版，然后在webrock\\webim\\record目录下，recordAction.php代码：\npublic function dataAjax()\t{\t\t$atype = $this->request('atype');\t\t$sid   = $this->request('sid');\t\t$aid   = $this->request('aid');\t\t$page  = (int)$this->request('page', '1');\t\t$fen\t= 20;\t\t$whes\t= $this->rock->dbinstr('receuid', $aid);\t\t$where \t= \"\";\t\tif($atype == 'user'){\t\t\t$where = \"and ((`sendid`=$aid and `receid`=$sid) or (`sendid`=$sid and `receid`=$aid))\";\t\t}\t\tif($atype == 'group' || $atype == 'system' || $atype == 'dept'){\t\t\t$where = \"and `receid`=$sid and $whes \";\t\t}\t\t\t\t$count  = m('im_mess')->rows(\"`type`='$atype' $where\");\t\t$maxpage= ceil($count / $fen);\t\t\t\t$sql\t= \"select * from [Q]im_mess where `type`='$atype' $where order by `id` desc limit \".(($page-1)*$fen).\",$fen\"; //没有过滤就执行了\t\t$rows   = $this->db->getall($sql);\t\t\t\tif($atype != 'system'){\t\t\t$snid \t= '0'; \t\t\tforeach($rows as $k=>$rs){\t\t\t\t$snid .=','.$rs['sendid'];\t\t\t}\t\t\tif($snid != '0'){\t\t\t\t$uarr = m('admin')->getall(\"`id` in($snid)\", '`id`,`name`,`face`');\t\t\t\t$_ursa= array();\t\t\t\tforeach($uarr as $k=>$rs){\t\t\t\t\t$rs['face'] = $this->rock->repempt($rs['face'], 'images/im/user100.png');\t\t\t\t\t$_ursa[$rs['id']] = $rs;\t\t\t\t}\t\t\t\tforeach($rows as $k=>$rs){\t\t\t\t\t$rows[$k]['sendname'] = $_ursa[$rs['sendid']]['name'];\t\t\t\t\t$rows[$k]['sendface'] = $_ursa[$rs['sendid']]['face'];\t\t\t\t}\t\t\t}\t\t}else{\t\t\tforeach($rows as $k=>$rs){\t\t\t\t$rows[$k]['sendname'] = '';\t\t\t\t$rows[$k]['sendface'] = 'images/im/shezhi_blue.png';\t\t\t}\t\t}\t\t\t\techo json_encode(array(\t\t\t'data'\t=> $rows,\t\t\t'count'\t=> $count,\t\t\t'page'\t=> $page,\t\t\t'maxpage' => $maxpage\t\t));\t}\nsql语句没有过滤就执行了，可以直接用sqlmap跑出来   漏洞证明：  拿官网demo做演示：其绝对路径可以由报错知道：\n\n然后sqlmap：\n\n\n\n其实已经传上去了\n\n**.**.**.**/help1.php 密码 b374k   修复方案：  过滤   版权声明：转载请注明来源 range@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}