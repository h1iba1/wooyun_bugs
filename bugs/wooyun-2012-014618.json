{"id": 15516, "wybug_id": "wooyun-2012-014618", "wybug_title": "光棍节屌丝的逆袭专场NO.5---58同城网修改任意妹子账号密码漏洞", "wybug_corp": "58同城", "wybug_author": "风萧萧", "wybug_date": "2012-11-11 08:26", "wybug_open_date": "2012-12-26 08:27", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计不当", "认证设计不合理", "设计错误", "手机短信"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-11-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-11-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-11-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-12-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-12-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-12-26：\t细节向公众公开  简要描述： 各位屌丝，你们知道么？58同城也可以交友啦！赶紧注册账号把妹子吧！58同城，一个神奇的网站！喜欢杨幂的屌丝请看这里！ 详细说明：  1.好的，为满足广大屌丝的要求，首先上一张杨大美人的代言58同城的靓照！\n\n2.那我们开始了，访问网址：http://jiaoyou.58.com(其实主站也可以的)，看到【忘记密码？】的链接没有，对了就是点击这里！\n\n3.选择取回方式为手机号码，输入手机号码与图片验证码后，点击【提交】按钮：\n\n4.这里由于是测试，我使用了自己的手机号码，收到了6为纯数字的短信码（为了与图片验证码区别，这里成为短信码）是【807077】，这里随意的填写了一个短信码123456，点击【重设密码】之前设置好浏览器的代理为burpsuite！\n\n5.代理抓到的请求包如下：\nPOST /mobileresetpassword HTTP/1.1Host: passport.58.comProxy-Connection: keep-aliveContent-Length: 72Cache-Control: max-age=0Origin: http://passport.58.comUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.13 (KHTML, like Gecko) Chrome/24.0.1284.2 Safari/537.13Content-Type: application/x-www-form-urlencodedAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Referer: http://passport.58.com/checkvalidcodeAccept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3Cookie: id58=05eNElCctZgQjUwMVxGbAg==; ipcity=sh%7C%u4E0A%u6D77; regreferer=\"http://sh.58.com/\"; from=\"\"; utm_source=\"\"; utm_campaign=\"\"; myfeet_tooltip=end; city=bj; 58home=bj; PassportVerifyCode=PassPort58-70b114dc-84bb-4c01-a275-f9f27231e84d; resetuid=2988365276934; resetmobile=1*********9; __utma=253535702.2029226588.1352447226.1352447226.1352587297.2; __utmb=253535702.19.10.1352587297; __utmc=253535702; __utmz=253535702.1352587297.2.2.utmcsr=wooyun.org|utmccn=(referral)|utmcmd=referral|utmcct=/corps/page/4mobile=1*********9&validcode=123456&password=******&cpassword=******\n很容易判断出参数mobile为手机号码，validcode参数为短信码，password和cpassword为需要重置的密码。   漏洞证明：  5.那么，我开始对validcode参数进行暴力破解了！操上burpsuite，设置好需要爆破的参数\n\n由于只是测试，我从800000开始\n\n设置并发的线程数为20个，看看需要花多长事件：\n\n6.通过返回的字节数或者返回的内容得出正确的短信码：短信码错误时，返回的字节数为598，而短信码正确时字节数为1525；当然也可从返回的内容来判断是否获取正确的短信码，短信码错误时返回内容包含\"检验记录不存在\"的字样，短信码正确时则返回跳转到重置成功的页面！\n\n\n\n7.其实，爆破的时候，密码已经重置过了，这里直接使用重置的密码进行登录即可，但是为了说明另一个问题：短信码可多次使用，我用爆破的短信码进行再次重置，表示依然可以！\n\n   修复方案：  1.一般情况下，短信码应设置为1次使用立即失效，防止他人无需走重置密码的流程即可对短信码爆破等等！2.6位纯数字短信码的爆破，即平均50万次的请求，我使用了burpsuite测试单台机器100线程，8分多钟即可重置任意一个手机账号！危险啊3.短信码可以为6位纯数字，甚至可以缩短为4为纯数字；可以不设置图片验证码，甚至可以不用设置短信码的有效期。但是为什么不设置连续5次尝试失败就锁定本次密码重置的请求呢？4.求20rank，求礼物！   版权声明：转载请注明来源 风萧萧@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-11-12 10:02 厂商回复： 感谢报告的漏洞，确认该漏洞对58账号安全影响较大，属于高危漏洞，马上安排修复漏洞。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-11-11 11:34 |    \t\tDefa \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:13        | <img src=1 onerror=alert(1)>)\t\t \n  mark，牛逼    \n     2012-11-12 08:12 |    \t\tmomo \t\t\t( 实习白帽子  |\t\t\t        Rank:91 漏洞数:24        | ★精华漏洞数:24 | WooYun认证√)\t\t \n  是对杨幂有非分之想。不是喜欢。    \n     2012-12-24 17:41 |    \t\tAssassin \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:1        | !)\t\t \n  洞主  个人信息暴漏了 ！！    \n     2012-12-26 10:02 |    \t\tEl4pse \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:7        | 世界上从来没有不可能这几个字，可不可能完...)\t\t \n  看到mobile了    \n     2012-12-26 11:03 |    \t\tWangl \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:4        | 新浪支付，值得拥有)\t\t \n  马赛克打的不全，露点了。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}