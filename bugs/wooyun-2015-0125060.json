{"id": 11956, "wybug_id": "wooyun-2015-0125060", "wybug_title": "饿了么逻辑漏洞之免费吃喝不是梦", "wybug_corp": "饿了么", "wybug_author": "计算姬", "wybug_date": "2015-07-07 10:40", "wybug_open_date": "2015-07-29 16:12", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-29：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 饿了么-中国最专业的网上订餐平台 详细说明：  自认为思路还是屌屌的，没见过类似的漏洞啊，能打雷么~问题是在饿了么早餐的地方，饿了么早餐真心方便啊早餐最近出了个活动，可以领10元抵用券\n\n输入信息后，领取成功\n\n这一步其实是收集信息，后面的一个请求才是真的申领红包抵用券的请求测试发现，一个手机号只能领2个红包\n\n于是就开始fuzz1）正常情况，只能2次，无法多次获取红包\n{\"flag\":2,\"phoneNo\":\"18xxxxxxx33\"}\n\n{\"status\":\"ERROR\",\"data\":null,\"message\":\"该用户最多只能领取2次\"}\n2）测试是否仅对phoneNo做校验，在手机号后面加字母测试\n{\"flag\":2,\"phoneNo\":\"18xxxxxxx33ff\"}\n\n{\"status\":\"SUCCESS\",\"data\":\"获取成功\",\"message\":null}\n是可以发送成功的，只是因为手机号错误的原因，我们收不到短信3）那么思路就来了，只要phoneNo每次不同，绕过服务端的校验，同时，该值作为发送短信的目标又是真实可达的，就好了也就是说，服务端直接检验phoneNo是否超过2次，同时不经过处理，就直接丢给短信发送平台进行红包短信发送（这是我猜的）最容易想到的就是手机号前面加86了\n{\"flag\":2,\"phoneNo\":\"8618xxxxxxx33\"}\n发送成功，手机也成功收到短信，这样一个手机号就有4个红包了4）那再测试手机号前面加+86\n{\"flag\":2,\"phoneNo\":\"+8618xxxxxxx33\"}\n手机木有收到短信，该方法无效5）那再测试第一种手机号后面加非数字的情况\n{\"flag\":2,\"phoneNo\":\"18xxxxxxx33！\"}\n手机也木有收到短信，不过我自己手机测试，是可以发送成功的啊\n\n如上图，自己测试，是能收到短信的，不知道平台为嘛不行6）还是那样，只要phoneNo的值能让平台成功发送短信即可，那我又想到了使用小号用的阿里的小号\n\n\n{\"flag\":2,\"phoneNo\":\"13216994045！\"}\n成功收到小号转发过来的短信\n\n这样结合上面的两个成功的方法，就可以获得8个红包啦~~阿里小号每个月可以有3次免费临时小号的使用那么就可以获得4*（1+3）=16个红包啦~感觉红包应该够用了啊，但是我不是为了福利，是为了安全啊，继续看看还有没有其他问题7）那继续测，想着手机群发的时候，貌似以逗号，分隔号码，测试下\n{\"flag\":2,\"phoneNo\":\"18xxxxxxx33,138xxxxxxx\"}\n手机没有收到短信，此时在这个点也fuzz的很长时间，没有用，，就不多说了8）后来又想到分号；作为分隔\n{\"flag\":2,\"phoneNo\":\"18xxxxxxx33;138xxxxxxx\"}\n测试发现，只有分号前面的手机号可以收到短信，不过目的已经达到了，保持分号前面手机号不变，分号后面任意内容，即可无限制获取红包抵用券的短信   漏洞证明：  总结一下正常情况可以成功\n{\"flag\":2,\"phoneNo\":\"18xxxxxxx33\"}\n手机号前面加86可以成功\n{\"flag\":2,\"phoneNo\":\"8618xxxxxxx33\"}\n短号，小号，可以转发短信的。例如阿里小号，亲情小号等\n{\"flag\":2,\"phoneNo\":\"13216994045！\"}\n分号分隔可以成功，可无限获取红包\n{\"flag\":2,\"phoneNo\":\"18xxxxxxx33,138xxxxxxx\"}\n\n\n3天的早餐只要5毛钱，给饿了么点个赞啊\n\n   修复方案：  phoneNo的值要经过提纯再进入短信发送平台进行发送   版权声明：转载请注明来源 计算姬@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2015-07-07 11:03 厂商回复： 漏洞已经确认，感谢你对饿了么安全的关注 最新状态： 2015-07-29：漏洞已修复。谢谢你们的关注。  ", "replys": "漏洞评价：\n评论\n     2015-07-07 10:41 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:84        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  @xsser @浩天 帮我审核呀 谢谢 我的洞好几个都几天没审核了    \n     2015-07-07 10:43 |    \t\tGHK \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 请叫我小渣渣。)\t\t \n  记者拍这里    \n     2015-07-07 10:45 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:84        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  @GHK 您好 我是记者 ，根据你近期活跃红灯区 各大会所的动态，我们cctv讲为您展开专访    \n     2015-07-07 11:12 |    \t\temeditor \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 过来乌云学习 求大神别黑)\t\t \n  窝也要免费吃喝 (☆_☆)    \n     2015-07-07 11:19 |    \t\t末影人 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:9        | 末影人(Enderman)是一个三个方格高的人形生...)\t\t \n  这都能闪电？    \n     2015-07-07 11:21 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:84        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  我去 666 雷劈了      \n     2015-07-07 11:22 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  虽然闪电，这rank也太少了吧，白白浪费了一次rank翻倍的机会啊@xsser 能补咩~    \n     2015-07-07 11:25 |    \t\t90Snake \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:42        | 最大的漏洞就是人)\t\t \n  @末影人 你看见详情了？    \n     2015-07-07 11:26 |    \t\tJim叔叔 \t\t\t( 普通白帽子  |\t\t\t        Rank:153 漏洞数:25        | 这样子不太好吧。。)\t\t \n  @计算姬 估计只有等7月的洞主演义，，可以额外奖50WB。。。    \n     2015-07-07 11:26 |    \t\tJGHOOluwa \t\t\t( 普通白帽子  |\t\t\t        Rank:206 漏洞数:32        | 就是来看看大牛们如何超神的^-^)\t\t \n  @90Snake 他以前能看到还信，现在那个漏洞修复了，应该看不到吧。。。    \n     2015-07-07 11:27 |    \t\tv0yager_1ce \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        )\t\t \n  屌屌屌，麻麻以后再也不用担心没中饭吃了    \n     2015-07-07 11:28 |    \t\t夜鸥 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我所知道的，和你差不多，我所感受到的，和...)\t\t \n  别提交了。。这个漏洞可以吃半辈子了 哈哈。    \n     2015-07-07 11:44 |    \t\t凯茵 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:1        | 求组织吸纳)\t\t \n  然并卵，一个手机号只能兑换两次优惠吗……    \n     2015-07-07 12:25 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  @凯茵 你可以找亲戚朋友多个手机号啊    \n     2015-07-07 12:56 |    \t\tmyhalo \t\t\t( 普通白帽子  |\t\t\t        Rank:281 漏洞数:55        | 所属团队:TSafe)\t\t \n  学习闪电新姿势    \n     2015-07-09 18:55 |    \t\t90Snake \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:42        | 最大的漏洞就是人)\t\t \n  @JGHOOluwa 他都没看到还在那儿bb  这都能闪电 啥的。。      \n     2015-07-27 12:05 |    \t\t带馅儿馒头 \t\t\t( 普通白帽子  |\t\t\t        Rank:1278 漏洞数:143        | 心在，梦在)\t\t \n  思路不错    \n     2015-07-27 12:21 |    \t\ts3xy \t\t\t( 核心白帽子 |\t\t\t        Rank:832 漏洞数:113        | 相濡以沫，不如相忘于江湖)\t\t \n  goooooooooood    \n     2015-07-28 23:41 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  涨姿势了    \n     2015-07-29 16:19 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  很淫荡的思路    \n     2015-07-29 16:23 |    \t\t紫衣大侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:21        | 愿结天下有识之士)\t\t \n  这么机智...    \n     2015-07-29 16:34 |    \t\t不二 \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:5        | 如果遇到从前的我，请把他带回来。QQ:71017...)\t\t \n  这个思路屌。    \n     2015-07-29 16:42 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:544 漏洞数:107        | 低调求发展)\t\t \n  3 rank....    \n     2015-07-29 16:59 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  赞LZ    \n     2015-07-29 17:05 |    \t\t小杨 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:4        | 。)\t\t \n  饿了    \n     2015-07-29 17:15 |    \t\t然并卵 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 呵呵)\t\t \n  好像很多人叫我    \n     2015-07-29 17:19 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  @然并卵 然并卵    \n     2015-07-29 18:10 |    \t\tPower \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:22        | 还需要等待.........)\t\t \n  这都行...    \n     2015-07-29 18:45 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  佩服    \n     2015-07-29 20:02 |    \t\t90Snake \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:42        | 最大的漏洞就是人)\t\t \n  佩服~    \n     2015-07-29 20:45 |    \t\t未出现的风景 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | keep moving!菜鸟求带。。。求带啊。。。啊...)\t\t \n  赞~好有趣    \n     2015-07-29 22:09 |    \t\tHex \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:9        | Do you know what is worth fighting for?)\t\t \n  思路真赞    \n     2015-07-29 22:46 |    \t\tDKing \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 盲人摸象中)\t\t \n  3 RANK........还是搁家里吃一年吧    \n     2015-07-30 13:54 |    \t\t斯杰 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:5        | By：S丶jer)\t\t \n  楼上+1    \n     2015-08-03 12:40 |    \t\t三浪兄 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:6        | I am a singer-songwriter.)\t\t \n  吊吊的    \n     2015-08-03 15:27 |    \t\tpomelo \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 新手白帽子，好好学习，好好挖洞！)\t\t \n  3个rank，太不值钱了    \n     2015-08-10 17:11 |    \t\t路人毛 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:10        | 昨晚做梦，挖到了电信都漏洞，被电信起诉了...)\t\t \n  打雷的3RANK。。。厂商对他免费吃喝提出了严重抗议    \n     2015-08-12 21:18 |    \t\tc4bbage \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:7        | var_dump($me);)\t\t \n  棒    \n     2015-08-25 15:10 |    \t\t蓝雪 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:5        | 爱研究技术，爱结交技术大牛的杭州妹子)\t\t \n  之前在饿了么付4元买30元东西的事干过些，早知道也来乌云提交了    \n     2015-08-25 15:30 |    \t\tJGHOOluwa \t\t\t( 普通白帽子  |\t\t\t        Rank:206 漏洞数:32        | 就是来看看大牛们如何超神的^-^)\t\t \n  @蓝雪 哇妹纸，尼这阔以当作证据告你啊，注意注意~~    \n     2015-08-25 17:02 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  @蓝雪 哇妹纸，尼这阔以当作证据告你啊，注意注意~~    \n     2015-08-26 09:06 |    \t\t蓝雪 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:5        | 爱研究技术，爱结交技术大牛的杭州妹子)\t\t \n  @JGHOOluwa 好可怕( ⊙ o ⊙ )！    \n     2015-08-26 09:06 |    \t\t蓝雪 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:5        | 爱研究技术，爱结交技术大牛的杭州妹子)\t\t \n  @计算姬 好可怕( ⊙ o ⊙ )！    \n     2015-08-26 09:37 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  @蓝雪 妹子表怕~    \n     2015-08-27 17:18 |    \t\t月小对 \t\t\t( 普通白帽子  |\t\t\t        Rank:142 漏洞数:23        | 打着篮球唱着歌)\t\t \n  @计算姬 再调戏妹子，我就告诉静静    \n     2015-08-27 17:25 |    \t\tJGHOOluwa \t\t\t( 普通白帽子  |\t\t\t        Rank:206 漏洞数:32        | 就是来看看大牛们如何超神的^-^)\t\t \n  @计算姬 再调戏妹子，我就调戏静静    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}