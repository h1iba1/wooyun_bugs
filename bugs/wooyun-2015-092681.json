{"id": 46095, "wybug_id": "wooyun-2015-092681", "wybug_title": "WinMail邮件系统存储型xss漏洞打包过滤规则形同虚设", "wybug_corp": "华美科技（苏州）有限公司", "wybug_author": "路人甲", "wybug_date": "2015-01-19 15:40", "wybug_open_date": "2015-03-05 15:42", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型", "黑盒测试技巧", "技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-02-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-05：\t细节向公众公开  简要描述：     WinMail邮件系统是公司企业、大专院校、中小学校、集团组织、政府部门的企业邮局系统架设软件。但它有xss漏洞。  详细说明：       WinMail邮件系统是公司企业、大专院校、中小学校、集团组织、政府部门的企业邮局系统架设软件。它的典型客户涵盖了政府机关、政府信息中心、税务机关、军队公安武警、法院,检察院系统、监狱系统、事业单位、新闻报社、电视媒体.....，总之使用单位相当多，但是它出xss了，并且简单绕过，使其过滤规则形同虚设，从而xss满屏跑。     xss漏洞一：不需要绕过就能触发型，方式，在邮件标题处写上测试代码<style><img src=\"</style><img src=x onerror=alert(1)//\">，然后打开信件点击回复，即可触发，效果如下图：\n\n     当然仅仅是这个层次的xss，我们是无法满意的，一不够隐蔽；二不够直接，我们的要求是打开就弹。下来我们对邮箱富文本区域进行测试，测试代码<img src=# style=\"display:none\" onerror=alert(0)>,发送抓发，如图：\n\n，分析发现'<'括号存在，onerror存在(多了个双引号)，style存在，不存在的有等号以及等号后面紧跟的一个字母，根据几年研究邮箱xss漏洞的经验，该处只要使用3D即可击垮该富文本区域的过滤机制，重新修改测试代码为<img src=3D# style=3D\"display:none\" onerror=3Dalert(0)>，发信，打开信，弹框如下：\n\n。抓包结果展示如下：\n\n。至于其他的测试代码，只需要仿照上面处理下等号，即可随意实现xss。   漏洞证明：  WinMail邮件系统是公司企业、大专院校、中小学校、集团组织、政府部门的企业邮局系统架设软件。它的典型客户涵盖了政府机关、政府信息中心、税务机关、军队公安武警、法院,检察院系统、监狱系统、事业单位、新闻报社、电视媒体.....，总之使用单位相当多，但是它出xss了，并且简单绕过，使其过滤规则形同虚设，从而xss满屏跑。     xss漏洞一：不需要绕过就能触发型，方式，在邮件标题处写上测试代码<style><img src=\"</style><img src=x onerror=alert(1)//\">，然后打开信件点击回复，即可触发，效果如下图：\n\n     当然仅仅是这个层次的xss，我们是无法满意的，一不够隐蔽；二不够直接，我们的要求是打开就弹。下来我们对邮箱富文本区域进行测试，测试代码<img src=# style=\"display:none\" onerror=alert(0)>,发送抓发，如图：\n\n，分析发现'<'括号存在，onerror存在(多了个双引号)，style存在，不存在的有等号以及等号后面紧跟的一个字母，根据几年研究邮箱xss漏洞的经验，该处只要使用3D即可击垮该富文本区域的过滤机制，重新修改测试代码为<img src=3D# style=3D\"display:none\" onerror=3Dalert(0)>，发信，打开信，弹框如下：\n\n。抓包结果展示如下：\n\n。至于其他的测试代码，只需要仿照上面处理下等号，即可随意实现xss。   修复方案：    重写富文本区域的xss过滤机制吧，另外对信件信头区域做防xss处理。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-01-22 16:29 厂商回复： CNVD确认所述情况，已经由CNVD通过以往建立的处置渠道向软件生产厂商通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-02-21 20:02 |    \t\t随随意意 \t\t\t( 普通白帽子  |\t\t\t        Rank:160 漏洞数:35        | 我对XSS并非真爱(┬＿┬)最近有人冒充该...)\t\t \n  为什么是3D    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}