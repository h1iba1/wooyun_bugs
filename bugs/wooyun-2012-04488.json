{"id": 20974, "wybug_id": "wooyun-2012-04488", "wybug_title": "腾讯3366小游戏站算法被破解", "wybug_corp": "腾讯", "wybug_author": "only_guest", "wybug_date": "2012-02-14 04:04", "wybug_open_date": "2012-03-30 04:05", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["加密算法设计错误", "算法破解", "逆向破解思路"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-02-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-02-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-02-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-03-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-03-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-03-30：\t细节向公众公开  简要描述： 对于这样一个网站来说.积分算法被破解.就等于可以随意修改自己的分数.严重程度可想而知. 详细说明：  某日和我家程序员一起出差去做一个项目.然后夜里俩人打赌,谁先破解出来3366的算法,输的人第二天就要请胜利者足疗.于是乎便有了下面的故事.最终的结果是我家伟大的程序员取得了整场比赛的胜利!恭喜她,她就是verkey!!!!!好,下面我来分析下整个算法的破解过程.我在3366.com上选取了一款玩的人最多的积分游戏.名字叫做彩色砖块,由于我水平太差,第一盘只得了31分,如下图\n\n1.对上图数据抓包得到以下内容qzversion=0&platform=1&key=bgvbapy1c89f901d0cdf89334b994e429c0100992e3b90692abe6fadd&submit=true&uin=2443199410&score=31&act=set&pid=1000132可以看到分数为31分,key值为bgvbapy1c89f901d0cdf89334b994e429c0100992e3b90692abe6fadd2.去掉这个key值的后48位得到bgvbapy1c3、剩余key值的第一位：如果是a，则从第2位开始计算。如果是b，则从第3位开始计算。....依次类推。对应如下：a-2b-3c-4d-5e-6f-7.....该key的第一位为b，所以从第3位开始计算，第3位为v.3、计算剩余key的长度，按照如下对应关系，取有效计算范围。如剩余key值长度为9，那么取1位计算。如剩余key值长度为10，那么取2位计算。如剩余key值长度为11，那么取3位计算。如剩余key值长度为12，那么取4位计算。.....剩余的key值的长度为9,那么从第3位\"v\"开始，取1位，即\"v\"。4、计算\"v\"的值，怎么计算呢？其实分数的算法为36进制，0-9，a-z等36个数字字符构成如下对应关系：0-01-12-23-34-45-56-67-78-89-9a-10b-11c-12d-13e-14f-15g-16h-17i-18j-19k-20l-21m-22n-23o-24p-25q-26r-27s-28t-29u-30v-31w-32x-33y-34z-35.....从z之后，再往下推，可得到：10 3611 3712 3813 3914 4015 4116 4217 4318 4419 451a 461b 471c 481d 491e 501f 511g 521h 531i 541j 551k 561l 571m 581n 591o 60 1p 611q 621r 631s 641t 651u 661v 671w 681x 691y 701z 71由上得知v等于31那么更大一点的数字呢?比如说\"1a\"这样的值呢?这样推导太麻烦，怎么用公式进行计算呢？其实很简单，看如下示例：1a=1*36+a=36+10=46再看几个例子相信你就会推导了：9位长度的key：ad5x7lsyb 1d79f349cc25551adff77cbdf5768509acf99812b656119c 计算：d=13c1imrwe0d 36443325bec5f7f4f1b0b56b04804bee90f25ecf931c2c08计算：m=2210位长度的key：a3dfcfdqvc 36443325bec5f7f4f1b0b56b04804bee90f25ecf931c2c08计算：3d=3*36+d=108+13=121b53h20htmd c829da8e21bc82ea9b964a6094bb7d92f9f7f50aa04e5fc7计算：3h=3*36+h=108+17=12511位长度的key：b38p4nvtb6e eec693296a4a49131ed70461f5e354f2018f6cf5ccb8957e计算：8p4=((8*36)+p)*36+4=313*36+4=11272a9662iq0u4d eec693296a4a49131ed70461f5e354f2018f6cf5ccb8957e计算：966=((9*36)+6)*36+6=(324+6)*36+6=11880+6=11886依次类推。。。。截断.修改数据包就可以改你的游戏分数了.但是貌似key的长度不能变.破解算法无恶意,只做研究.发出来大家学习下.另外确实想要几只腾讯的新版公仔了...之前送的那只被领导收留了...   漏洞证明：  \n\nhttp://www.3366.com/game/1000190.shtml弹粉笔欢迎挑战   修复方案：  修改得分机制吧.再复杂一点.   版权声明：转载请注明来源 only_guest@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2012-02-14 21:12 厂商回复： thx 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-02-14 04:07 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  看样子3366.com应该停业整顿一天了..我错了...    \n     2012-02-14 04:10 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  情人节都去抱妹子吧..我抱着电脑过.    \n     2012-02-14 09:07 |    \t\t128bit \t\t\t( 实习白帽子  |\t\t\t        Rank:74 漏洞数:7        | May the SHELL be with you)\t\t \n  8？    \n     2012-02-14 10:48 |    \t\tlivers \t\t\t( 实习白帽子  |\t\t\t        Rank:94 漏洞数:6        | mov esp,0jmp espcrash.....)\t\t \n   @only_guest  这是什么命    \n     2012-02-14 10:54 |    \t\tshine  \t\t\t( 普通白帽子  |\t\t\t        Rank:831 漏洞数:77        | coder)\t\t \n  关注楼主与电子设备的基友关系！    \n     2012-02-14 11:09 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  买个大头显示器好好抱抱。哇哈哈    \n     2012-02-14 12:40 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  @only_guest 你害得多少程序员没法陪伴女友过节日，恐怕要造出多少杯具，罪过罪过...    \n     2012-02-14 12:59 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  让你们鲜花...让你们红酒...让你们烛光...!!!!!    \n     2012-02-14 15:09 |    \t\tTwoSpring \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:1        | 游走于道德与随性之间……)\t\t \n  Happy情人节，Happy Gay!    \n     2012-02-14 16:41 |    \t\tpopok \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:24        | nothing)\t\t \n  GAY。。。    \n     2012-02-14 21:48 |    \t\tValo洛洛 \t\t\t( 普通白帽子  |\t\t\t        Rank:458 漏洞数:52        | 。)\t\t \n  @popok 嗯哼    \n     2012-03-30 09:04 |    \t\tXhm1n9 \t\t\t( 实习白帽子  |\t\t\t        Rank:57 漏洞数:13        | bug)\t\t \n  求科普啊，算法你是怎么知道的？    \n     2012-03-30 11:31 |    \t\tlivers \t\t\t( 实习白帽子  |\t\t\t        Rank:94 漏洞数:6        | mov esp,0jmp espcrash.....)\t\t \n  死GAY    \n     2012-03-30 13:07 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  = = 我觉得，这个只要把FLASH反编一下， 里面就有算法了吧？。为什么还要自己推。    \n     2012-03-30 13:13 |    \t\tXhm1n9 \t\t\t( 实习白帽子  |\t\t\t        Rank:57 漏洞数:13        | bug)\t\t \n  这个逆推的思路牛比，求科普    \n     2012-03-30 13:14 |    \t\tXhm1n9 \t\t\t( 实习白帽子  |\t\t\t        Rank:57 漏洞数:13        | bug)\t\t \n  不会是像gainover说的FLASH反编一下吧？    \n     2012-03-30 13:22 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  这种FLASH小游戏提交积分， 被破解本身就是不可避免的，加密算法肯定是在FLASH源码里有的。  如果FLASH的源码能够得到很好的保护，让其它人无法看到其中的加密算法，才有可能减轻这种现状么，否则，算法怎么换都没用。不过楼主这种都能逆推，挺牛X..     \n     2012-03-30 14:29 |    \t\t笨猪 \t\t\t( 实习白帽子  |\t\t\t        Rank:56 漏洞数:13        | Jarett|最近忙，洞发得少。。)\t\t \n  这是逆向的结果呢还是半猜？    \n     2012-03-30 15:09 |    \t\tpopok \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:24        | nothing)\t\t \n  @笨猪 如果是单纯靠直觉猜的，我就跪下了！    \n     2012-03-30 15:25 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @popok 同跪    \n     2012-03-30 15:51 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @xsser 膜拜吧....呵呵程序猿!白帽子!只要敢想!没什么不可能的!    \n     2012-03-30 17:33 |    \t\tpopok \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:24        | nothing)\t\t \n  @xsser @only_guest 看来这想象能力可以达到异想天开的级别了，受小弟一拜！    \n     2012-03-30 18:18 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  @only_guest 破300了。我擦。    \n     2012-03-30 18:43 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @zeracker 肿么了.这是要刷rank么?嘿嘿.最近想发些有意思的东西.    \n     2012-03-30 18:54 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  @only_guest 继续围观。哈哈,发神马有意思的东西    \n     2012-03-30 21:42 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @zeracker 你猜`猜到奖励充气娃娃一个.    \n     2012-03-30 21:53 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  @only_guest O(∩_∩)O哈哈~。坐等，我要松岛枫的娃娃，    \n     2012-03-30 22:29 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @zeracker 松岛枫?我只有空空的....    \n     2012-03-30 22:30 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  @only_guest 现在要搞就玩大的了。O(∩_∩)O哈哈哈~ 苍井空不务正业，拍MV去了。    \n     2012-05-06 20:19 |    \t\ttaylortai \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 三分钟热度)\t\t \n  绝对膜拜啊 @only_guest 你怎么就知道去掉多少位呢    \n     2012-05-07 18:58 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @taylortai 算啊...愁    \n     2012-11-11 20:17 |    \t\tshack2 \t\t\t( 普通白帽子  |\t\t\t        Rank:470 漏洞数:71        | QQ:1341413415 一个热爱编程(Java),热爱网...)\t\t \n  膜拜了    \n     2012-12-19 14:54 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  这帖子我看了4遍了，看一次跪一次，真心牛X了。。。。    \n     2013-11-04 11:20 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  @only_guest，你好厉害啊，求带我啊    \n     2013-11-06 16:14 |    \t\tsysALong \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:5        | 电脑里的AV片 永远 和 电脑旁的卫生纸 成 ...)\t\t \n  我真心不知道看多少遍了，太牛性了。。。 膜拜。。。    \n     2014-06-21 12:42 |    \t\t浅兮 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:30        )\t\t \n  数学怎这么好啊    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}