{"id": 40505, "wybug_id": "wooyun-2015-091457", "wybug_title": "万户ezOffice协同办公管理平台两处通用型SQL注入漏洞", "wybug_corp": "万户ezOffice", "wybug_author": "路人甲", "wybug_date": "2015-01-12 18:58", "wybug_open_date": "2015-04-13 16:58", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-03-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-13：\t细节向公众公开  简要描述： 两处注入打包 详细说明：  注入1.\\govezoffice\\gov_documentmanager\\govdocumentmanager_judge.jsp\n<%@ page contentType=\"text/html; charset=GBK\"%><%com.whir.common.util.DataSourceBase dsb = new com.whir.common.util.DataSourceBase();java.sql.Connection conn = null;java.sql.Statement stmt = null;String numId=request.getParameter(\"numId\");//获取参数numIdString field2=request.getParameter(\"field2\");String  recordId=request.getParameter(\"record\")==null?\"\":request.getParameter(\"record\").toString();int ny=new java.util.Date().getYear()+1900;try{         conn = dsb.getDataSource().getConnection();         stmt = conn.createStatement();                 int iskey=1;//0 不重排, 1 重排         String numStr=\"select  keyValue from gov_senddocumentNum   where  id=\"+numId;//这里是构造SQL语句，没过滤~\t\t String  strSql=\"SELECT DOCUMENTSENDFILE_ID FROM EZOFFICE.GOV_DOCUMENTSENDFILE WHERE sendFilePoNumId=\" + numId+\" and  field2=\"+ field2 ;//这里还有个查询                   System.out.println(\"////////////////////////////numStr\"+numStr);\t\t  if(!recordId.equals(\"\")){\t\t    \t\t   strSql+= \" and DOCUMENTSENDFILE_ID<> \"+recordId;\t\t  } \t     java.sql.ResultSet rs = stmt.executeQuery(numStr);//带入到查询，我们跟进          if(rs.next()){           iskey=rs.getInt(1);          }\t            if(iskey==1){// 重排           \t       strSql+=\" and field3=\"+ny+\"\";     \t\t  }\t          System.out.println(\"////////////////////////////strSql:\"+strSql);     rs = stmt.executeQuery(strSql);    int channelsort = 0;    if(rs.next()){        out.print(\"0\");    }else{        out.print(\"1\");    }}catch(Exception e){    System.out.println(\"-----------------------------------------------------\");    e.printStackTrace();    System.out.println(\"-----------------------------------------------------\");}finally{    if(stmt != null){        stmt.close();    }    if(conn != null){    \tconn.close();    }}%>\n注入2.govezoffice\\gov_documentmanager\\govdocumentmanager_judge_seq.jsp\nString numId=request.getParameter(\"numId\");String field2=request.getParameter(\"field2\");String recordId=\"\";if(request.getParameter(\"record\")==null||request.getParameter(\"record\").toString().equals(\"null\")){}else{recordId=request.getParameter(\"record\");}String  seqId=request.getParameter(\"seqId\")==null?\"\":request.getParameter(\"seqId\").toString();String  seqfig=request.getParameter(\"seqfig\")==null?\"\":request.getParameter(\"seqfig\").toString();System.out.println(\"/////////////////////////recordId:\"+recordId);String outResult=\"1\";try{         conn = dsb.getDataSource().getConnection();         stmt = conn.createStatement();   \t\t String  strSql=\"SELECT receiveFile_ID  FROM EZOFFICE.GOV_receiveFile WHERE seqId=\" +seqId+\" and seqfig=\"+ seqfig;//同注入1，这里也是参数没有经过任何处理，导致注入发生\t\t  if(!recordId.equals(\"\")){\t\t   strSql+= \" and receiveFile_ID <> \"+recordId;\t\t  }        java.sql.ResultSet rs = stmt.executeQuery(strSql);\t\t if(rs.next()){         outResult=\"0\";       }          \t   out.print(outResult);\n   漏洞证明：  案例（1）http://lnjoa.vicp.net:88/defaultroot/govezoffice/gov_documentmanager/govdocumentmanager_judge.jsp?numId=1http://lnjoa.vicp.net:88/defaultroot/govezoffice/gov_documentmanager/govdocumentmanager_judge_seq.jsp?numId=1&field2=1&recordId=1\n\n案例（2）http://oa.sxky.cn/defaultroot/govezoffice/gov_documentmanager/govdocumentmanager_judge.jsp?numId=1和http://oa.sxky.cn/defaultroot/govezoffice/gov_documentmanager/govdocumentmanager_judge_seq.jsp?numId=1&field2=1&recordId=1\n\n案例（3）http://61.136.203.132:7001/defaultroot/govezoffice/gov_documentmanager/govdocumentmanager_judge.jsp?numId=1和http://61.136.203.132:7001/defaultroot/govezoffice/gov_documentmanager/govdocumentmanager_judge_seq.jsp?numId=1&field2=1&recordId=1\n\n案例（4）http://oa.orionww.com:7001/defaultroot/govezoffice/gov_documentmanager/govdocumentmanager_judge.jsp?numId=1和http://oa.orionww.com:7001/defaultroot/govezoffice/gov_documentmanager/govdocumentmanager_judge_seq.jsp?numId=1&field2=1&recordId=1\n\n案例（5）http://58.221.210.116:7001/defaultroot/govezoffice/gov_documentmanager/govdocumentmanager_judge_seq.jsp?numId=1&field2=1&recordId=1和http://58.221.210.116:7001/defaultroot/govezoffice/gov_documentmanager/govdocumentmanager_judge_seq.jsp?numId=1&field2=1&recordId=1\n\n   修复方案：  toString();或者加个防护脚本过滤下   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-01-16 16:19 厂商回复： CNVD确认并复现所述情况，感谢白帽子后续协助提供的情况，已经由CNVD按以往处置渠道向软件生产厂商万户网络公司通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-14 10:33 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  您好：感谢您对CNVD的支持，请协助CNVD提供下第二处注入漏洞信息、复现详情及过程截图，以文档的形式邮件vreport@cert.org.cn邮箱，以便CNVD复现和验证。祝好！    \n     2015-01-16 12:57 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @cncert国家互联网应急中心  两天前已发送    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}