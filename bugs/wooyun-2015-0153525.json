{"id": 81495, "wybug_id": "wooyun-2015-0153525", "wybug_title": "张家港政府网站集群getshell", "wybug_corp": "张家港政府", "wybug_author": "niexinming", "wybug_date": "2015-11-22 20:36", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： 双十一都在刷洞的黑客都是好狗，汪汪汪汪汪汪汪汪汪汪~~~~~ 详细说明：  这个漏洞很有意思，我在这里写了出来，希望大家学习首先是苏州市住房公积金管理中心—张家港分中心的网站目录可便利http://**.**.**.**/EpointBigFileUpload然后里面的部分源代码可下载，http://**.**.**.**/EpointBigFileUpload/EpointBigFileUpLoad.rarhttp://**.**.**.**/EpointBigFileUpload/EpointBigFileUpLoad22.rar发现soap的服务http://**.**.**.**/EpointBigFileUpload/FCKFile/EpointFileServer.asmx发现里面的有个上传的接口\n\n用awvs的webserver导入\n\n发现上传的那个接口需要验证密码：\n\n于是我就利用下载的那两个压缩包先去看那个asmx对应的是哪个dll文件\n\n看到是EpointBigFileUpLoad这个dll文件然后在bin文件夹里面找到然后用ILSpy.exe 这个软件反编译.net发现这个代码\n\n追踪到ValidateEncrpytion这个函数：\n\n这个就很好玩了（1）首先他先获得当前的tickes 也就是dtTicks这个参数微软官网对于ticks是这样定义的：A single tick represents one hundred nanoseconds or one ten-millionth of a second. There are 10,000 ticks in a millisecond, or 10 million ticks in a second.The value of this property represents the number of 100-nanosecond intervals that have elapsed since 12:00:00 midnight, January 1, 0001 (0:00:00 UTC on January 1, 0001, in the Gregorian calendar), which represents F:System.DateTime.MinValue. It does not include the number of ticks that are attributable to leap seconds.（2）对dtTicks进行还原，还原为时间（3）减去当前时间，如果大于5分钟，则返回false(4)对还原之后的时间(也就是now参数)进行sha1加密(5)最后和传递进来的encryption参数做对比，对比成功则返回true然后我用c#实现了类似的功能\nusing System;using System.Collections.Generic;using System.Text;using Microsoft.Practices.EnterpriseLibrary.Common;using Epoint.Frame.Common;namespace 实验\t{    class Program    {        static void Main(string[] args)        {            DateTime now = DateTime.Now;            now = new DateTime(Convert.ToInt64(DateTime.Now.Ticks));            string a =EncryptOperate.SHA1Encrypt(now);            Console.WriteLine(a);            Console.WriteLine(DateTime.Now.Ticks);        }    }}\n\n\n然后把这个信息复制到Uploadfile的接口上就可以任意上传了\n\n上传成功http://**.**.**.**/EpointBigFileUpload/FCKFile/6666.asp 密码：MH   漏洞证明：  \n\n\n\n\n\n   修复方案：  过滤上传后缀   版权声明：转载请注明来源 niexinming@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2015-11-25 11:52 厂商回复： CNVD确认所述情况，已经转由CNCERT下发给江苏分中心，由其后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}