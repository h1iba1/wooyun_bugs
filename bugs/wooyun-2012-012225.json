{"id": 16671, "wybug_id": "wooyun-2012-012225", "wybug_title": "好孩子某站点存在支付漏洞", "wybug_corp": "好孩子育儿网", "wybug_author": "风萧萧", "wybug_date": "2012-09-14 19:06", "wybug_open_date": "2012-10-29 19:07", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-09-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-09-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-09-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-10-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-10-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-10-29：\t细节向公众公开  简要描述： 最近好孩子网站很火，我也来凑个热闹。有礼物么？ 详细说明：  1.存在支付漏洞的是下面这个站点：好孩子集团网上旗舰店\nhttp://www.haohaizi.com/\n\n\n2.买一件小短裤送给灾区的小朋友吧，俺也是个很有爱心的人呢！\n\n3.抓包查看提交的信息：\n\n4.POST的数据中不难看出，虽然商品的金额使用goodsIds参数在服务器端获得，但是数量参数counts这里是不是能改下呢？尝试改成-1，点击forward提交：\nact=addCartGoods&goodsIds=1448279&counts=1&bigorsmalls=2\n5.查看返回结果，金额确实也是负数了，怎么办！\n\n   漏洞证明：  6.再买两件衣服吧，一共只需要9元：\n\n7.点击结算，查看订单信息如下，嗯，加上18元的快递费，仍然只需要付27元哦！\n\n8.选择网上银行支付，支付的金额仍是27元哪！测试到这里就结束了，话说有礼物么？\n\n   修复方案：  1.像金额这样的信息不要放在页面上，确实有随时被篡改的风险，这些信息本来就在数据库中，可以定义一个字符型的字段代替金额的传输，或者直接由商品唯一标识来查询数据库得到金额；2.签名校验是最重要的了，将购买的商品、数量、金额（或替代字段）、订单的ID号生成一个校验字符串。在每次数据传输的过程中进行校验，当然这个校验的内容可以多次生成；3.银行或者第三方支付平台的支付接口都会检验商户的订单数据签名，这里当支付页面跳转到块钱的时候没有做签名校验，导致金额数据被篡改，请进一步确认接口问题；4.支付前需要做签名校验，支付之后同样需要再次做校验，按理说所有银行应该在支付完成之后返回一些信息（如支付金额等）给商户，这样可以通过回来的信息判断是否全额支付；5.还有什么比SSL更可靠的呢！   版权声明：转载请注明来源 风萧萧@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2012-09-14 20:41 厂商回复： 谢谢。传统企业必须人工确认才能继续，算是我们的一道防线。不过确实是个挺大的问题，如果我们有自动拆单或自审核之类就能造成大漏子了。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-10-15 21:15 |    \t\t慕容祥风 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 东南西北风啊，没事就卖萌啊)\t\t \n  学习了。    \n     2012-10-17 08:08 |    \t\t陌路 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:5        | 安全爱好者！)\t\t \n  又是逻辑漏洞!    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}