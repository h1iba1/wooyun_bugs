{"id": 5399, "wybug_id": "wooyun-2013-046480", "wybug_title": "ECSHOP 后台sql注入漏洞2枚（鸡肋）", "wybug_corp": "ShopEx", "wybug_author": "Matt", "wybug_date": "2013-12-19 17:25", "wybug_open_date": "2014-03-19 17:26", "wybug_type": "SQL注射漏洞", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-12-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-02-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-19：\t细节向公众公开  简要描述： ECSHOP 后台注入漏洞 详细说明：  \nadmin/affiliate_ck.phpif ($_REQUEST['act'] == 'list'){    $logdb = get_affiliate_ck();    $smarty->assign('full_page',  1);    $smarty->assign('ur_here', $_LANG['affiliate_ck']);    $smarty->assign('on', $separate_on);function get_affiliate_ck(){    $affiliate = unserialize($GLOBALS['_CFG']['affiliate']);    empty($affiliate) && $affiliate = array();    $separate_by = $affiliate['config']['separate_by'];    $sqladd = '';    if (isset($_REQUEST['status']))    {        $sqladd = ' AND o.is_separate = ' . (int)$_REQUEST['status'];        $filter['status'] = (int)$_REQUEST['status'];    }    if (isset($_REQUEST['order_sn']))    {        $sqladd = ' AND o.order_sn LIKE \\'%' . trim($_REQUEST['order_sn']) . '%\\'';        $filter['order_sn'] = $_REQUEST['order_sn'];    }    if (isset($_GET['auid']))    {\n漏洞2：\nadmin/agency.phpif ($_REQUEST['act'] == 'list'){    $smarty->assign('ur_here',      $_LANG['agency_list']);    $smarty->assign('action_link',  array('text' => $_LANG['add_agency'], 'href' => 'agency.php?act=add'));    $smarty->assign('full_page',    1);    $agency_list = get_agencylist();    $smarty->assign('agency_list',  $agency_list['agency']);    $smarty->assign('filter',       $agency_list['filter']);    $smarty->assign('record_count', $agency_list['record_count']);    $smarty->assign('page_count',   $agency_list['page_count']);function get_agencylist(){    $result = get_filter();    if ($result === false)    {        /* 初始化分页参数 */        $filter = array();        $filter['sort_by']    = empty($_REQUEST['sort_by']) ? 'agency_id' : trim($_REQUEST['sort_by']);//这俩个参数都可以注入        $filter['sort_order'] = empty($_REQUEST['sort_order']) ? 'DESC' : trim($_REQUEST['sort_order']);        /* 查询记录总数，计算分页数 */        $sql = \"SELECT COUNT(*) FROM \" . $GLOBALS['ecs']->table('agency');        $filter['record_count'] = $GLOBALS['db']->getOne($sql);        $filter = page_and_size($filter);        /* 查询记录 */        $sql = \"SELECT * FROM \" . $GLOBALS['ecs']->table('agency') . \" ORDER BY $filter[sort_by] $filter[sort_order]\";        set_filter($filter, $sql);    }    else    {        $sql    = $result\n   漏洞证明：  测试方法127.0.0.1/ec/admin/affiliate_ck.php?act=list&auid=1'\n\n测试方法 127.0.0.1/ec/admin/agency.php?act=listPOST 提交sort_by=111111'\n\n   修复方案：  你猜   版权声明：转载请注明来源 Matt@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2013-12-19 17:44 厂商回复： 非常感谢您为shopex信息安全做的贡献我们将尽快修复非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}