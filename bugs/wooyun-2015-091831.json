{"id": 40347, "wybug_id": "wooyun-2015-091831", "wybug_title": "ASPCMS最新版V2.5.6权限提升漏洞", "wybug_corp": "ASPCMS", "wybug_author": "云天河", "wybug_date": "2015-01-19 11:26", "wybug_open_date": "2015-04-20 14:22", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-19：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-04-20：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： ASPCMS最新版V2.5.6存在权限提升漏洞，注册普通用户的时候可以直接注册成超级管理员。 详细说明：  ASPCMS最新版V2.5.6下载地址：http://www.aspcms.com/aspcms-2179839-1-1.html该版本存在insert注入，在注册用户的时候没有判断性别参数Gender是否为数字，插入数据库的时候没有用引号引起来，导致过滤函数不起作用。利用Access 16%截断技巧注释掉后面的语句，可以直接注册GroupID为1的超级管理员组用户。/member/reg.asp\nSub addUser\t'dim UserID,GroupID,LanguageID,SceneID,LoginName,Password,PswQuestion,PswAnswer,UserStatus,RegTime,RegIP,LastLoginIP,LastLoginTime,LoginCount,TrueName,Gender,Birthday,Country,Province,City,Address,PostCode,Phone,Mobile,Email,QQ,MSN,Permissions,AdminDesc\tDim LoginName,Password,verifyPass,Email,Mobile,Address,PostCode,Gender,QQ,UserStatus,RegTime,RegIP,LastLoginIP,LastLoginTime,Birthday,Exp1,Exp2,Exp3,GroupID,TrueName,Phone\tif getForm(\"code\",\"post\")<>Session(\"Code\") then alertMsgAndGo \"验证码不正确\",\"-1\"\tLoginName=filterPara(getForm(\"LoginName\",\"post\"))\tPassword=filterPara(getForm(\"userPass\",\"post\"))\tverifyPass=filterPara(getForm(\"verifyPass\",\"post\"))\tEmail=filterPara(getForm(\"Email\",\"post\"))\tMobile=filterPara(getForm(\"Mobile\",\"post\"))\tAddress=filterPara(getForm(\"Address\",\"post\"))\tPostCode=filterPara(getForm(\"PostCode\",\"post\"))\tGender=1\tGender=filterPara(getForm(\"Gender\",\"post\"))\tQQ=filterPara(getForm(\"QQ\",\"post\"))\tPhone=filterPara(getForm(\"Phone\",\"post\"))\tTrueName=filterPara(getForm(\"TrueName\",\"post\"))\t\tUserStatus=1\tRegTime=now()\tRegIP=getip()\tGroupID=3\t\tif isnul(LoginName) then alertMsgAndGo \"用户名不能为空\",\"-1\"\tif Conn.Exec(\"select count(*) from {prefix}User where LoginName='\"&LoginName&\"'\",\"r1\")(0) >0 then alertMsgAndGo \"该用户名已被注册\",\"-1\"\t\tif isnul(Password) then alertMsgAndGo \"密码不能为空\",\"-1\"\tif isnul(verifyPass) then alertMsgAndGo \"确认密码不能为空\",\"-1\"\tif Password<>verifyPass then alertMsgAndGo \"两次输入密码不相同\",\"-1\"\tif len(LoginName)>15 then alertMsgAndGo \"用户名不能大于15个字符\",\"-1\"\tif not IsSafeStr(LoginName) then alertMsgAndGo \"您的用户名里包含了不安全字段，请重新输入\",\"-1\"\tif not IsSafeStr(TrueName) then alertMsgAndGo \"您的真是姓名里包含了不安全字段，请重新输入\",\"-1\"\tif len(TrueName)>5 then alertMsgAndGo \"真实姓名不能大于5个字符，如真实姓名超过5个字符的用户，请联系网站管理员！\",\"-1\"\tif not isnul(Mobile) then\t\tif not CheckMobile(Mobile) then alertMsgAndGo \"您输入的手机号码格式不正确，请重新输入\",\"-1\"\tend if\tif not isnul(Phone) then\t\tif not CheckTelPhone(Phone) then alertMsgAndGo \"您输入的电话号码格式不正确，请重新输入\",\"-1\"\tend if\tif not isnul(Email) then\t\tif not CheckEmail(Email) then alertMsgAndGo \"您输入的邮箱格式不正确，请重新输入\",\"-1\"\tend if\tif not isnul(QQ) then\t\tif not CheckQQnum(QQ) then alertMsgAndGo \"您输入的QQ格式不正确，请重新输入\",\"-1\"\tend if\tif not isnul(Address) then\t\tif not IsSafeStr(Address) then alertMsgAndGo \"您输入的地址里面含有不安全字段，请检查并且重新输入\",\"-1\"\tend if\tif not isnul(PostCode) then\t\tif not CheckCdoe(PostCode) then alertMsgAndGo \"您输入的邮政编码格式不正确，请重新输入\",\"-1\"\tend if\tPassword=md5(Password,16)\tConn.Exec\"insert into {prefix}User(LoginName,[Password],Email,Mobile,Address,PostCode,Gender,QQ,UserStatus,RegIP,RegTime,GroupID,TrueName,Phone) values('\"&LoginName&\"','\"&Password&\"','\"&Email&\"','\"&Mobile&\"','\"&Address&\"','\"&PostCode&\"',\"&Gender&\",'\"&QQ&\"',\"&UserStatus&\",'\"&RegIP&\"','\"&RegTime&\"',\"&GroupID&\",'\"&TrueName&\"','\"&Phone&\"')\",\"exe\"        //插入数据库之前没有判断Gender字段是否为数字，插数据库的时候没有用引号引起来。管理员和用户使用同一个表，普通用户组GroupID为3，超级管理员组GroupID为1，因此可以利用Access 16%截断特性，直接注册成GroupID为1的超级管理员。\talertMsgAndGo \"注册成功！\",sitePath&setting.languagepath&\"member/login.asp\"End Sub\n   漏洞证明：  注册普通用户的时候抓包，修改Gender参数的值（括号后面为%16 URL-decode后的字符）：\n\n成功登录管理后台：\n\n   修复方案：  对Gender参数进行判断   版权声明：转载请注明来源 云天河@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2015-01-19 12:56 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  这么牛逼，坐等公开！    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}