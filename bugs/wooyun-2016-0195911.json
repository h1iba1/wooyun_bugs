{"id": 87220, "wybug_id": "wooyun-2016-0195911", "wybug_title": "2345某主要站点SQL注入影响所有用户数据影响N个同服网站数据（注入需绕过WAF）", "wybug_corp": "2345网址导航", "wybug_author": "黑吃黑", "wybug_date": "2016-04-13 17:51", "wybug_open_date": "2016-05-29 10:10", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-29：\t细节向公众公开  简要描述： 我一直以为大家都是来装逼的，没想到装逼的是我而已。 详细说明：  开篇废话&渗透小思路&小技巧：（你们以为我真有时间写那么多字？其实我就想加个精华而已）很久没有提交漏洞了，最近看到身边的朋友们都再挖大厂商漏洞，不是上首页就是打雷加精的漏洞，实在是逼格很高啊，我想了想，我也挖个大厂商的漏洞吧，于是有了下文。最近在乌云很少看到详细说明思路的漏洞了，基本都是一点文字说明和几张图片，感觉这样不是很好，因为很多人来乌云最重要的目的之一就是学习！！！所以我更希望乌云有更多附加详细思路和说明的漏洞，方便大家学习，一起共同提高。找这个漏洞找了几天，搞这个漏洞又搞了几天，原因是网站有WAF,网速卡 等等。。。我身边有很多朋友比较鄙视用扫描器日站的人，认为用扫描器没啥水平。。。但是我始终认为用扫描器很是挺好的，因为确实能提高效率。我很多时候用扫描器并不是指望扫描器能扫出什么高危漏洞，最主要的还是信息收集，比如了解网站的目录结构，各种参数，指纹信息等等，然后再结合自己的经验手工验证或者为其他测试做前期准备。（其实我认为大神们也用扫描器的只不过是他们比较牛逼，能自己写扫描器或者按照需求自己写脚本而已）看了2345以前的漏洞感觉厂商挺够意思，于是拿扫描器各种扫描以前已经公开的漏洞网站，然而除了误报的漏洞其他的都没什么收获，这个注入点是在结合扫描器的扫描结构和经历了各种测试以后才发现的，因为这个注入点是打不开网站的。注入点：\nhttp://game.2345.com/server/search/think.php?so=a  参数：so\n如果你把这个注入点放入浏览器你会发现是空白页，然后并不影响注出数据。手工测试感觉有搞的时候（本来想手工继续搞奈何水平有限。。。），于是放入了sqlmap中，但是没有成功。。。。只有屏幕一片红。。。。以前也经常用sqlmap但是很少去认真的研究过怎么用。直到遇到了这个又WAF的洞。各种百度sqlmap绕过WAF的技巧：\nhttp://drops.wooyun.org/tools/4760\n但是看了一下sqlmap的tamper文件夹，里面有几十个绕过脚本，网上又卡种不能一个一个实验吧，于是又各种百度技巧但是没有找到如何选择正确的绕过脚本，以前在乌云漏洞中也没有见到谁提到如果识别，于是这个问题又自己研究了半天，终于有了发现，原来就再sqlmap的姨妈红里面：\n\n就是slqmap提示要加载这个space2comment.py脚本去尝试，于是我就成功注出数据了，这个也算是一个小技巧吧。（上面的一些小思路和小技巧是写给需要的人的，大牛们自动忽略吧）   漏洞证明：  注入点：\nhttp://game.2345.com/server/search/think.php?so=a  参数：so\n\n\n通过注入得知数据库管理员为：\ncurrent user:  'xiaoyouxi_2345@172.16.20.148'\n里面很多表，包括管理员和用户的表，以及2345游戏论坛的bbs所有用户数据。因为是2345主要的游戏网站，所以用户和表都很多，因为网速实在太慢了，就大概跑了一下。。。如图证明：\n\n\n\n\n\n\n\n\n\n游戏网站用户数据：用户名，密码，邮箱，手机号，实在太慢了随便跑了一些。。。\n\n拿其中一个用户登录演示：   用户名：hensonlei   密码MD5加密的，解密即可。经过信息收集，发现很多网站都是共享这个数据库的！！！也就是同个服务器的网站，查询了一下与\nhttp://game.2345.com\n同服的有十几个网站，这里列举个重要的比如关于钱的点券，礼包，充值，游戏论坛BBS.......\n\n\n\n\n\n还能直接进入游戏嗨起。。。\n\n   修复方案：  写了很多很久，厂商大哥给个20吧，为了跑你们的几个表，开机很久了，给点电费。   版权声明：转载请注明来源 黑吃黑@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2016-04-14 10:04 厂商回复： 感谢您对2345的关注，问题已修复，您说的用户信息是很久以前部分老用户是MD5加密的，修改过密码或者新用户不存在此问题，另外为表示感谢我们会给您寄去精美礼品一份，请注意是查收。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-13 18:01 |    \t\tArrow \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:14        )\t\t \n  果然好逼    \n     2016-04-13 18:04 |    \t\t库日天 \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:8        | 图样图森破！！！)\t\t \n  我一直以为大家都是来装逼的，没想到装逼的是我而已。    \n     2016-04-13 18:21 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:32        | 不是因为看到了希望才去努力，而是努力了才...)\t\t \n  @浩天 @乌云小秘书 乌云欠我一个精华    \n     2016-04-13 19:53 |    \t\t学习委员 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:8        | 人生真是寂寞如雪！)\t\t \n  装得一手好逼    \n     2016-04-13 19:55 |    \t\t天朝 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:1        | too yang too simple)\t\t \n  我一直以为大家都是来装逼的，没想到装逼的是我而已。    \n     2016-04-14 10:22 |    \t\t紫霞仙子  \t\t\t( 普通白帽子  |\t\t\t        Rank:2302 漏洞数:307        | 没好团队，啥都干不成！！！)\t\t \n  请注意是查收。    \n     2016-04-14 10:27 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:32        | 不是因为看到了希望才去努力，而是努力了才...)\t\t \n  @紫霞仙子 我语文不好不要这样    \n     2016-04-14 13:35 |    \t\t多特(乌云厂商)\t\t \n  不好意思，多写了一个字，请注意查收    \n     2016-04-15 00:12 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  您说的用户信息是很久以前部分老用户是MD5加密的，修改过密码或者新用户不存在此问题  这个本身不是就说明存在问题了么，当时加salt密码以md5为基础进行转换不就好了，直接旧密码可以全部覆盖了，每个用户独立salt，举例 ：sha256（md5+salt），salt大于8位    \n     2016-04-23 21:28 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:32        | 不是因为看到了希望才去努力，而是努力了才...)\t\t \n  @多特 礼物已经收到，非常精美！多谢！    \n     2016-05-04 12:57 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1800 漏洞数:274        | 123)\t\t \n  @黑吃黑 “就是slqmap提示要加载这个space2comment.py脚本去尝试，于是我就成功注出数据了，这个也算是一个小技巧吧。” ------   其实这不是技巧，是运气不错，因为那是e.g，是默认举的tamper例子而已，刚好成功了，总体不错，加油    \n     2016-05-07 13:00 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:32        | 不是因为看到了希望才去努力，而是努力了才...)\t\t \n  @黑暗游侠 多谢大牛指点    \n     2016-05-07 18:59 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1800 漏洞数:274        | 123)\t\t \n  @黑吃黑 我早已退出安全界    \n     2016-05-08 00:15 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:32        | 不是因为看到了希望才去努力，而是努力了才...)\t\t \n  @黑暗游侠 我也不是安全界的，爱好而已。    \n     2016-05-29 10:18 |    \t\tExploit DB \t\t\t( 普通白帽子  |\t\t\t        Rank:521 漏洞数:135        | 水能载舟，亦可覆舟)\t\t \n  这个算最基础的绕WAF了 想达到精华差距还很大    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}