{"id": 1011, "wybug_id": "wooyun-2014-067666", "wybug_title": "Srun3000计费系统任意文件下载漏洞（直接获取管理密码）", "wybug_corp": "srun.com", "wybug_author": "Ano_Tom", "wybug_date": "2014-07-07 12:53", "wybug_open_date": "2014-10-02 12:54", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-12：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-02：\t细节向公众公开  简要描述： Srun3000计费系统任意文件下载漏洞[无需登录] 详细说明：  版本：版本 \tSrun3000 [3.00rc14.17.4] 使用量还是相当多的，主要为各大高校:(url不列出来了，太暴力，怕自己学校的也被爆。1.任意文件下载漏洞漏洞文件/srun3/srun/services/modules/login/controller/login_controller.php代码\n/**     * 下载一个文件     *     */    // 此处存在任意文件下载漏洞--fuck    public function download(){        global $file;        $this->model->download_file($file);    }\ndownload_file文件路径为/srun3/srun/services/modules/modules.php代码为\n/**     * 下载一个文件     *     * @param unknown_type $file                 */    public function download_file($file) {        if (file_exists ( $file )) {            $this_base_file = basename ( $file );            header ( \"Content-type:application/octet-stream\" );            header ( \"Accept-Ranges: bytes\" );            header ( \"Accept-Length: \" . filesize ( $file ) );            header ( \"Content-Disposition: attachment; filename=\\\"\" . $this_base_file . \"\\\"\" );            readfile ( $file );        }    }\n简单粗暴的任意文件下载漏洞，$file是用户可控的，在global.php里注册变量   漏洞证明：  此处下载其配置文件/srun3/etc/srun.conf如图\n\n下载/etc/passwd 如图\n\n结果\n\n然后，对srun3000的系统进行大致的说明系统默认端口为8800，对应的web路径为/srun3/srun/services/端口为8080的对应web路径为/srun3/srun/web/端口为8081的对应的web路径为/srun3/srun/system/[全是洞。。。]端口为80的对应的web路径为/srun3/web//srun3/srun/services/为学生登录查看自己的个人信息，个人上网记录等，其数据库密码加密方式为密码md5然后从第9位开始取16位，数据库表为user/srun3/srun/web/ 对应的管理员对用户的管理  ，其数据库密码加密方式为密码md5，对应的数据库表为sysmgr 有两个帐号admin密码admin support登录地址为http://xxoo:8080//srun3/srun/system/对应的管理员对服务器的管理，其密码加密方式为md5.js加密的，而其存放位置即系统的位置/srun3/etc/srun.conf文件里登录地址为http://xxoo:8081/login.php/srun3/srun/web/应该为综合web网关入口页面，下载后的文件，srun.conf里的密码是md5加密的，破解后可以直接登录，如图\n\n登录后拿shell就很容易了，随便来一处命令执行即可，获得shell如图\n\n   修复方案：  用户可控的变量太多   版权声明：转载请注明来源 Ano_Tom@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-10-02 12:54 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-07 13:24 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  沙发    \n     2014-07-07 14:02 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:463 漏洞数:89        | 硬件与无线通信研究方向)\t\t \n  板凳    \n     2014-07-07 18:19 |    \t\tHackPanda \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:15        | Talk is cheap,show me the shell.)\t\t \n  个人觉得这个影响不是太大，大部分部署的实例都限制了IP，是新版本嘛？后台确定下版本号，我给你联系郑总    \n     2014-07-08 12:28 |    \t\tAno_Tom \t\t\t( 普通白帽子  |\t\t\t        Rank:368 漏洞数:40        | Talk is cheap.:)\t\t \n  @HackPanda 不过我抽样测试的17个案例中只有两个是限制的ip的，而且该漏洞是可以结合设计缺陷、命令执行等等直接getshell或获取整个数据库备份的。危害大不大还得看具体的场景，在我看来已经很严重了：）    \n     2014-07-08 12:51 |    \t\tHackPanda \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:15        | Talk is cheap,show me the shell.)\t\t \n  版本号亲，14.17嘛？17以上版本已经不用shell执行命令了，数据是核心，只要影响数据的都算严重，确定一下版本号我给你转一下郑总，不然他们不上乌云号的…    \n     2014-07-08 12:55 |    \t\tAno_Tom \t\t\t( 普通白帽子  |\t\t\t        Rank:368 漏洞数:40        | Talk is cheap.:)\t\t \n  好的，14.17.4顺便提交了个漏洞集合还没审核，速度来确认下    \n     2014-07-08 12:57 |    \t\tHackPanda \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:15        | Talk is cheap,show me the shell.)\t\t \n  那你得@狗哥…审核过了的我给你联系下阿，可否私信我你的联系电话，我转给他们？    \n     2014-07-08 13:09 |    \t\tHackPanda \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:15        | Talk is cheap,show me the shell.)\t\t \n  @Ano_Tom 已经短信了，等着吧    \n     2014-07-08 13:19 |    \t\tAno_Tom \t\t\t( 普通白帽子  |\t\t\t        Rank:368 漏洞数:40        | Talk is cheap.:)\t\t \n  @HackPanda ok 等狗哥审了在。麻烦你了，多谢哦；）    \n     2014-07-12 18:45 |    \t\tpangshenjie \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:14        )\t\t \n  @HackPanda 17 用了框架。但是貌似他旧版本其他端口的服务还在的    \n     2014-07-12 20:08 |    \t\tHackPanda \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:15        | Talk is cheap,show me the shell.)\t\t \n  @pangshenjie 我在等洞主传源码…    \n     2014-07-13 14:38 |    \t\tpangshenjie \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:14        )\t\t \n  @HackPanda 很多wooyun上的洞目测都没补 lz脱去吧    \n     2014-07-13 17:02 |    \t\tAno_Tom \t\t\t( 普通白帽子  |\t\t\t        Rank:368 漏洞数:40        | Talk is cheap.:)\t\t \n  @HackPanda 后天发你，最近太忙    \n     2014-12-20 12:48 |    \t\tretanoj \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:9        )\t\t \n  @Ano_Tom 洞主，你能找到14.17的源码吗    \n     2014-12-20 12:51 |    \t\tretanoj \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:9        )\t\t \n  @Ano_Tom 哦。。是14.17.15    \n     2015-01-01 19:12 |    \t\tC.K.Logic \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 一直坚信“信息改变世界”)\t\t \n  8081的用户名是多少    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}