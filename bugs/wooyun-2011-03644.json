{"id": 21710, "wybug_id": "wooyun-2011-03644", "wybug_title": "mac 迅雷泄漏用户cookie", "wybug_corp": "迅雷", "wybug_author": "路人甲", "wybug_date": "2011-12-16 00:50", "wybug_open_date": "2011-12-21 00:50", "wybug_type": "用户敏感数据泄漏", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-12-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2011-12-21：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： mac版迅雷下载文件时，会泄漏用户cookie！ 详细说明：  mac版迅雷的浏览器扩展在下载文件时，会将Refer域的Cookie传给迅雷，造成迅雷将此Cookie传给Host域，造成用户数据被泄漏！如在google reader中的文件连接（假设为xx.com/xx.txt），右键选择迅雷下载，迅雷会将google的cookie传给xx.com。同理搜索引擎中的url，如baidu，soso都会被这个漏洞影响。目前只是在mac上复现了，不知道其他系统是否有此问题。   漏洞证明：  下面给出在google reader中，下载一个文件的流量证明：（注：在chrome safari  都复现了。chrome:17.0.963 dev  迅雷：1.1.0（132） chrome插件：1.0.20 ）Step 1: 在google reader中选一个文件下载\n\nStep 2: 迅雷显示为\n\nStep 3：使用wireshark抓到了相应的包，如下（注意cookie是google域的）\n\n这个漏洞后来在几个同学的mac上都复现了！原因分析：分析了下迅雷chrome支持插件，在xl.js中发现如下一段代码： \nfunction downloadByThunder(url){\tif(!isHookDownload()){\t\treturn false;\t}\t\tvar theURL = PreParseURL(url);\tif(theURL)\t{       \t  var refer_url = document.location.href;          var cookie = document.cookie;\t  var plugin = document.getElementById(g_thunderPluginId);\t  if(plugin != null){\t    return plugin.Download(url,refer_url,cookie);          }\t}\treturn false;}\n可以想到应该是迅雷的浏览器插件对cookie没有进行正确处理。   修复方案：  想了下，迅雷这样做可能是为了下载需要登陆的连接，不过这时候应该验证下Host域和Refer域是否同一个域！   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2011-12-21 00:50 厂商回复：  漏洞Rank：2  (WooYun评价) 最新状态： 2011-12-21：没有收到wooyun的及时反馈，只收到公开漏洞时发来的邮件，这方面希望wooyun能完善一下，做得更好！  ", "replys": "漏洞评价：\n评论\n     2011-12-16 16:29 |    \t\tGaRY \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:3        | 真悲剧平男君)\t\t \n  这漏洞其实很牛逼，可惜简介写的很简单，基本可以钓鱼偷到任何域的cookie。等公开了，关注之。    \n     2011-12-17 01:16 |    \t\t草榴社区 \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:26        | 未满18周岁,不准进入.)\t\t \n  怎么就公开了。。。2000W就这么没了。    \n     2011-12-20 23:00 |    \t\tcnyouker \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:13        | root it)\t\t \n  关注哦    \n     2011-12-21 12:12 |    \t\tFrankie \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 你存在,我的代码里...Line 0://你)\t\t \n  哈哈..悲催了..貌似乌云管理最近很忙.....迅雷官方回复亮了.!!!    \n     2012-12-07 10:59 |    \t\t米兰春天 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 1)\t\t \n  膜拜大牛～    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}