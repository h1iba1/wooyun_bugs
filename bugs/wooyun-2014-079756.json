{"id": 49877, "wybug_id": "wooyun-2014-079756", "wybug_title": "BrigeOS小区带宽OA系统几个漏洞", "wybug_corp": "BrigeOS", "wybug_author": "piaoye", "wybug_date": "2014-10-17 18:11", "wybug_open_date": "2015-01-15 18:12", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["应用敏感信息泄漏"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向公众公开  简要描述： 跟前面俩人提交的可能不一样。。这个系统使用的范围比较广泛 暂没特征 但通过其他数据可以了解到 详细说明：   WooYun: 盈捷万通 BridgeOS MongoDB 配置不当 （可能会影响到一批小ISP）  很早就有白帽子发过。。但搜索引擎检索的不是很多。。 WooYun: 北京某小区宽带OA系统监控信息泄露（涉及用户cookies）  WooYun: 北京某小区宽带OA系统监控信息泄露（涉及用户cookies） 这个平台有个日志查看网监功能 在8080口 默认密码admin 也可以通过下面的方法创建Id_user 绕过验证\n\nMongoDB这个我就不说了，我们看这个平台的问题，通过一些方法得到了这平台源码登陆页面login.php\n$sql_select = \"select * from staff where name='\".$user_name.\"' and password='\".$user_password.\"'\";\t$dataset = yjwt_mysql_select($sql_select);\t//echo \"$sql_select\";\tif($dataset && $row = mysql_fetch_array($dataset)){\t\tsetcookie(\"php_user\", $row[\"flag\"], time()+1800);//半小时,这个语句必需要html这前    //这俩行是神设置 \t\tsetcookie(\"Id_user\", $row[\"Id\"], time()+1800);\n验证成功后写入浏览器cookie在看看fun.php全局验证\nlonger_cookie('php_user');longer_cookie('Id_user');if ($_GET['t'] == 'exit') {\techo \"<script>\";\techo \"alert('请重新登陆！');\";\techo \"window.location.href = '?t=login';\";\techo \"</script>\";}if ($_GET['t'] == '') {\techo \"<script>\";\techo \"window.location.href = '?t=getid';\";\techo \"</script>\";}\n 可见确实是通过cookie验证登陆的。。这个伪造下就行了 \n\n现在可以进去了 在看看ram.php \n<?\theader(\"Content-type: application/txt\");\theader(\"Content-Disposition: attachment; filename=$_GET[name].txt\");\treadfile(\"$_GET[path]\");?>\n神下载。。伪造raw.php?path=/etc/cfg.php&name=1.txt 即可下载数据库配置信息 以及服务器任意文件。。在来看看ping.php\n$to_ping = $_GET[\"ip\"]; $count = 1; $psize = 65;exec(\"ping $to_ping -n $count -w 1\", $list); if($list[2] == \"请求超时。\") print \"<div style=\\\"background-color:#999999;height:1000px;width:1000px;color:#ffffff;\\\">\".$_GET[\"name\"].\"</div>\"; else print \"<div style=\\\"background-color:#00ff00;height:1000px;width:1000px;color:#ffffff;\\\">\".$_GET[\"name\"].\"</div>\";\n执行啊。。。省略一万行...其他的注射就不说了。。这个系统BrigeOS 使用量其实比较大的 很多小区都在使用 一旦能登陆访问并且操作 将威胁整个小区的网络安全环境    漏洞证明：  我们在官方网站看看：有个文档查询的http://reg.bri-os.com:8080/php_center/cmd_help.php?mode=keymode存在注射 然后顺利进入官方OA系统。。\n\n出现的一些数据比较丰富 包含网络拓扑图等等 其中的devid 应该是装有 BrigeOS 客户端 所以对应上面所说的使用量应该不小。。 完全是个宽带接入商\n\n\n\n\n\n然后在文件管理处 毫无悬念的拿下shell。。官方的服务器ip为 125.39.155.32  通过搜索引擎得到http://www.im286.com/thread-10960888-1-1.html  发现这个宽带商会在用户浏览器加载广告。。然后在服务器 /var/www/html/ 一些目录确实发现如上描述的脚本信息。。若被利用？没事给各个小区用户弹个窗啥的再补上一张官方新版的BrigeOS 建议把小区那个升级到这个上面\n\n测试就到此为止   修复方案：  对系统平台进行升级修复 对ip进行限制访问 对官方各类漏洞进行处理。。。对用户上网信息不再监控。。。   版权声明：转载请注明来源 piaoye@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2014-10-20 13:56 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-18 09:30 |    \t\tpiaoye \t\t\t( 普通白帽子  |\t\t\t        Rank:343 漏洞数:53        | ww)\t\t \n  代码不全了？。。奇怪    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}