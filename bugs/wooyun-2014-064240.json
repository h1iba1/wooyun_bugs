{"id": 1534, "wybug_id": "wooyun-2014-064240", "wybug_title": "大汉版通JCMS某处越权+任意文件文件上传漏洞（反删除）", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "wefgod", "wybug_date": "2014-06-09 22:02", "wybug_open_date": "2014-09-07 22:04", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传", "文件上传安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-07：\t细节向公众公开  简要描述： 有删除文件的操作，可“反”之。 详细说明：  漏洞点：jcms/m_5_7/replace/opr_importinfo.jsp部分系统还存在越权。fn_billstatus为1时可以直接访问该页面无需验证：http://www.shanting.gov.cn/jcms/m_5_7/replace/opr_importinfo.jsp?fn_billstatus=1\n\nhttp://tuoshan.yzwh.gov.cn/jcms/m_5_7/replace/opr_importinfo.jsp?fn_billstatus=1\n\n   漏洞证明：  扯下代码\n// 基本变量初始化\tString strFilePath = \"\";\tString strFileName = \"\";\tstrFilePath = application.getRealPath(\"\") + \"/m_5_7/replace/temp/\";\n路径就是这了，不多说，下面看关键的（省略了一部分）：\nCommonUploadFile upload = new CommonUploadFile(strFilePath, \"\");\t\tboolean bResult = upload.uploadFile(request);\t\tString strUpFileName = \"\";\t\tif (bResult) {\t\ttry {……………………省略\t\t} catch (Exception e) {\t\t\tstrIllMsg += \"<\" + strFiles[i] + \">\";\t\t}\t\tfile.delete();\t\t\t}//end for\t\t}\t\telse {\t\t\tstrMsg = \"上传文件失败！\";\t\t}\n我们看到，如果if的条件成立，则最后的操作会删除文件。而if的条件不成立时，则只会提示上传文件失败，嗯，我们可以测试看，何时bResult=false啊好吧，直接说结果吧，文件上传时，对于上传的文件会有一个顺序的排列，从file1,file2...一直下去。很奇怪，如果跳过了file1，从file2开始，则此处的bResult=false了。利用这一特点，我们可以反删除，保留我们的文件在temp目录下！上传时改下后缀：\n\n\n\n   修复方案：  升级   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-06-10 11:12 厂商回复： 感谢关注 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-09 22:58 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  怎么又来了,鄙视鄙视    \n     2014-06-09 23:10 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @pandas 哈哈，尽情鄙视我吧    \n     2014-06-09 23:30 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @wefgod @pandas 应该鄙视我.....看看我的洞都是泪，够买电脑了就停下来了.....    \n     2014-06-09 23:31 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  妈蛋，不是上次发了完结篇了么    \n     2014-06-09 23:33 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @计算姬 你这头像....    \n     2014-06-09 23:34 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  @Mosuan 你想表达什么    \n     2014-06-09 23:45 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @计算姬 手颤抖打错字了    \n     2014-06-09 23:50 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @Mosuan @计算姬 他鸡动了。我也激动了所以就发了    \n     2014-06-10 03:09 |    \t\t鶆鶈 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:30        )\t\t \n  看了下洞主的记录，这犀利的速度，简直不是人干的事。牛X    \n     2014-06-10 04:35 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  求带刷钱    \n     2014-06-10 09:06 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  反之上传？ mark一下    \n     2014-06-10 10:42 |    \t\tloli  \t\t\t( 普通白帽子  |\t\t\t        Rank:550 漏洞数:52        )\t\t \n  高产啊。    \n     2014-06-10 19:13 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @鶆鶈 没啊，至少质量上比不上你的。    \n     2014-06-21 14:14 |    \t\thnnetsafe \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 信息安全中心)\t\t \n  有没有更猛的?    \n     2014-09-07 23:15 |    \t\t园长 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:14        | 你在身边就是缘，缘分写在数据库里面。)\t\t \n  老实交代，源码哪来的？    \n     2014-09-11 10:28 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @园长 以前犯下的错    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}