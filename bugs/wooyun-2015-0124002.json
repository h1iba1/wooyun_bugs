{"id": 70808, "wybug_id": "wooyun-2015-0124002", "wybug_title": "php云人才系统越权替换简历", "wybug_corp": "php云人才系统", "wybug_author": "Zhe", "wybug_date": "2015-07-02 18:34", "wybug_open_date": "2015-09-30 18:36", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-05：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-30：\t细节向公众公开  简要描述： RT 详细说明：  版本：PHPYUN人才招聘系统4.0_beta说明：简历创建的方式有两种，直接创建跟在线黏贴，问题出在，修改在线黏贴的简历\n\n文件位置：\\upload\\member\\user\\model\\expectq.class.php\nfunction save_action(){\t\tif($_POST['submit']){\t\t\t$eid=(int)$_POST['eid'];\t\t\t$data['doc']=str_replace(\"&amp;\",\"&\",html_entity_decode($_POST['doc'],ENT_QUOTES,\"GB2312\"));\t\t\t$_POST['lastupdate']=mktime();\t\t\t$_POST['integrity']=100;\t\t\tunset($_POST['eid']);\t\t\tunset($_POST['submit']);\t\t\tunset($_POST['doc']);\t\t\tif(!$eid){\t\t\t\t$num=$this->obj->DB_select_num(\"resume_expect\",\"`uid`='\".$this->uid.\"'\");\t\t\t\tif($num>=$this->config['user_number']&&$_GET['e']==''){\t\t\t\t\t$this->ACT_msg(\"index.php?c=resume\",\"你的简历数已经超过系统设置的简历数了\");\t\t\t\t}\t\t\t\t$_POST['doc']='1';\t\t\t\t$_POST['uid']=(int)$this->uid;\t\t\t\t$_POST['defaults']=$num<=0?1:0;\t\t\t\t$nid=$this->obj->insert_into(\"resume_expect\",$_POST);\t\t\t\t$resume = $this->obj->DB_select_once(\"resume\",\"`uid`='\".$this->uid.\"'\",\"`name`,`edu`,`exp`,`sex`,`birthday`,`idcard_status`,`status`,`r_status`\");\t\t\t\t\t\t\t\t$this->obj->update_once(\"resume_expect\",array(\t\t\t\t\t\t\"edu\"=>$resume['edu'],\t\t\t\t\t\t\"exp\"=>$resume['exp'],\t\t\t\t\t\t\"uname\"=>$resume['name'],\t\t\t\t\t\t\"sex\"=>$resume['sex'],\t\t\t\t\t\t\"birthday\"=>$resume['birthday'],\t\t\t\t\t\t\"idcard_status\"=>$resume['idcard_status'],\t\t\t\t\t\t\"status\"=>$resume['status'],\t\t\t\t\t\t\"r_status\"=>$resume['r_status'],\t\t\t\t\t\t\"photo\"=>$resume['photo']\t\t\t\t\t\t),array('uid'=>$this->uid));\t\t\t\t$data['eid']=(int)$nid;\t\t\t\t$data['uid']=(int)$this->uid;\t\t\t\t$nid2=$this->obj->insert_into(\"resume_doc\",$data);\t\t\t\tif($nid2){\t\t\t\t\tif($num==0){\t\t\t\t\t\t$this->obj->update_once('resume',array('def_job'=>$nid),array('uid'=>$this->uid)); \t\t\t\t\t}\t\t\t\t\t$nid2=$this->obj->DB_update_all(\"member_statis\",\"`resume_num`=`resume_num`+1\",\"uid='\".$this->uid.\"'\");\t\t\t\t}\t\t\t\tif($nid2)\t\t\t\t{\t\t\t\t\t$this->obj->member_log(\"添加粘贴简历\",2,1);\t\t\t\t\t$this->ACT_layer_msg(\"添加成功！\",9,\"index.php?c=resume\");\t\t\t\t}else{\t\t\t\t\t$this->ACT_layer_msg(\"添加失败！\",8,\"index.php?c=resume\");\t\t\t\t}\t\t\t}else{\t\t\t\t$_POST['height_status']='0';\t\t\t\t$this->obj->update_once(\"resume_expect\",$_POST,array(\"id\"=>$eid));//未对用户权限进行判断\t\t\t\t$nid=$this->obj->update_once(\"resume_doc\",$data,array(\"eid\"=>$eid));//未对用户权限进行判断\t\t\t\tif($nid)\t\t\t\t{\t\t\t\t\t$this->obj->member_log(\"更新粘贴简历\",2,2);\t\t\t\t\t$this->ACT_layer_msg(\"更新成功！\",9,\"index.php?c=resume\");\t\t\t\t}else{\t\t\t\t\t$this->ACT_layer_msg(\"更新失败！\",8,\"index.php?c=resume\");\t\t\t\t} \t\t\t}\t\t}\t}\n   漏洞证明：  账号A在线黏贴简历编号为1\n\n账号B在线黏贴简历编号为2\n\n账号B修改2的时候，保存修改时抓包，修改eid=1（即账号A的简历，可遍历，简历id递增）\n\n即可成功修改账号A的简历\n\n   修复方案：  加个权限判断   版权声明：转载请注明来源 Zhe@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-07-02 18:35 厂商回复： 感谢提供！我们会尽快修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}