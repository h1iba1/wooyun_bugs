{"id": 19905, "wybug_id": "wooyun-2012-05980", "wybug_title": "骑士cms任意目录打包下载漏洞。。。", "wybug_corp": "74c,s.com", "wybug_author": "猪头子", "wybug_date": "2012-04-23 14:21", "wybug_open_date": "2012-06-07 14:21", "wybug_type": "敏感信息泄露", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-04-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-04-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-04-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2012-06-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-06-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-07-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-06-07：\t细节向公众公开  简要描述： 74cms_v3.1.20120214中任意web目录打包下载。。。很有意思的漏洞 详细说明：  74cms后台有一个备份模板的功能，程序会自动备份选中的模板并压缩下载，但是没有对用户提交的$tpl变量进行检查就带入函数，导致构造变量即可打包任意目录并下载。。看代码。。在admin/admin_template.php 第47行\nelseif ($act == 'backup'){\tcheck_token();\tcheck_permissions($_SESSION['admin_purview'],\"tpl_backup\");\trequire_once(ADMIN_ROOT_PATH.'include/admin_phpzip.php');\t$tpl = trim($_REQUEST['tpl_name']);        //$filename受$tpl影响\t$filename = '../temp/backup_templates/' . $tpl . '_' . date('Ymd') . '.zip';\t$zip = new PHPZip;        //没有检查tpl_name的有效性就直接调用zip进行压缩        //由于$filename也受$tpl控制，导致如果遍历层数大于三层web程序会把压缩文件        //放入web目录外。。\t$done = $zip->zip('../templates/' . $tpl . '/', $filename);\t\tif ($done)\t\t{\t\theader(\"Location:\".$filename.\"\");\t\t}\t\telse\t\t{\t\tadminmsg(\"操作失败！\",0);\t\t}\t}\n   漏洞证明：  \n\n更改tpl_name，我们下载data文件夹\n\n\n\n\n\n\n\n   修复方案：  过滤吧亲   版权声明：转载请注明来源 猪头子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2012-04-23 16:23 厂商回复： 添加对漏洞的补充说明以及做出评价的理由 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-04-12 13:13 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  发现你喜欢搞后台的漏洞，但是真正难的不是从前台到后台么？    \n     2012-04-12 13:20 |    \t\t猪头子 \t\t\t( 普通白帽子  |\t\t\t        Rank:189 漏洞数:35        | 自信的看着队友rm -rf/tar挂服务器)\t\t \n  @xsser 同意。。可是我都没有找到前台的漏洞~~~~    \n     2012-06-07 21:01 |    \t\tpopok \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:24        | nothing)\t\t \n  @xsser 原来是个后台的功能，这个差别太大了。。如果前台的任意打包下载，那就值20rank,如果是后台的，顶多值5rank    \n     2013-04-23 13:03 |    \t\thfy \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:3        | 打了个狗~)\t\t \n  @猪头子 猪头子啊~    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}