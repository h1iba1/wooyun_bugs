{"id": 3132, "wybug_id": "wooyun-2014-055725", "wybug_title": "Hdwiki Sql Injection#2", "wybug_corp": "互动在线（北京）科技有限公司", "wybug_author": "′雨。", "wybug_date": "2014-04-06 12:02", "wybug_open_date": "2014-07-05 12:03", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-05：\t细节向公众公开  简要描述： 发现最近Hdwiki的洞 官方都只给2Rank?  分就不能高一点?牛逼。虽然这样我还是继续发。 详细说明：  在control/pms.php中\nfunction docheckrecipient(){\t\t$sendto = $this->post['sendto'];\t\tif (WIKI_CHARSET == 'GBK'){\t\t\t$sendto = string::hiconv($sendto,'GBK','UTF-8',1);\t\t}\t\t$send = explode(',',$sendto);\t\tif(count($send)>10){\t\t\t$this->message($this->view->lang['fullsend'],'',2);\t\t}\t\t$checkreturn = $_ENV['pms']->check_recipient($sendto,0);\t\t\t$message = ($checkreturn === true)? 'OK' : ($checkreturn.' '.$this->view->lang['loginTip3']);\t\t$this->message($message,'',2);\t}\n\n$sendto = $this->post['sendto'];\t\tif (WIKI_CHARSET == 'GBK'){\t\t\t$sendto = string::hiconv($sendto,'GBK','UTF-8',1);\t\t}\n虽然转义 但是这里  \nfunction hiconv($str,$to='',$from='',$force=false) {\t\tif (empty($str)) return $str;\t\tif(!preg_match( '/[\\x80-\\xff]/', $str)) return $str; // is contain chinese char\t\tif(empty($to)){\t\t\tif ('utf-8' == strtolower(WIKI_CHARSET)){\t\t\t\treturn $str;\t\t\t}\t\t\t$to=WIKI_CHARSET;\t\t}\t\tif(empty($from)){\t\t\t$from = ('gbk'==strtolower($to)) ? 'utf-8':'gbk';\t\t}\t\t$to=strtolower($to);\t\t$from=strtolower($from);\t\t//$isutf8=preg_match( '/^([\\x00-\\x7f]|[\\xc0-\\xdf][\\x80-\\xbf]|[\\xe0-\\xef][\\x80-\\xbf]{2}|[\\xf0-\\xf7][\\x80-\\xbf]{3})+$/', $str );\t\t$re = strlen($str) > 6 ? '/([\\xe0-\\xef][\\x80-\\xbf]{2}){2}/' : '/[\\xe0-\\xef][\\x80-\\xbf]{2}/';\t\t$isutf8 = preg_match($re, $str);\t\t\t\t//$force = (substr($to, 0, 3) == 'utf') ? true : $force;\t\t\t\tif(!$force && $isutf8 && $to=='utf-8' ) return $str;\t\tif(!$force && !$isutf8 && $to=='gbk' ) return $str;\t\t\t\tif (function_exists('iconv')){\t\t\t$str = iconv($from, $to, $str);\n只要force为true的话 就会iconv。然后直接利用宽字节来注入。\nfunction check_recipient($sendto, $type){\t\t$userinfos = array();\t\t$send = array_unique(explode(',', $sendto));\t\tsort($send);\t\t$num = count($send);\t\t$sendto = str_replace(\",\", \"','\", $sendto);\t\t\t\t\t\t$query = $this->db->query(\"SELECT username,uid FROM \".DB_TABLEPRE.\"user WHERE username IN ('$sendto')\");\n这里由于逗号会被替换 就放弃逗号把。   漏洞证明：  \n\n由于这里没回显 我就直接把结果输出一些把 至少能说明是可以注入的。盲注。 就不用多说了。   修复方案：  求过滤。求高分。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-04-09 11:05 厂商回复： 安排处理中~~多谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}