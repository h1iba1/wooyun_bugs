{"id": 2017, "wybug_id": "wooyun-2014-061360", "wybug_title": "大汉网络JCMS又一上传漏洞可被Getshell（需登陆）", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "路人甲", "wybug_date": "2014-05-19 17:55", "wybug_open_date": "2014-08-17 17:56", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向公众公开  简要描述：  详细说明：  问题出在jcms/setup/opr_upload.jsp中该功能为导入一个更新包...\n\n\nCommonUploadFile upload = null;\tif(request.getMethod().toUpperCase().equals(\"POST\")){   \t\t\tJcms_UpdaterecordBLF blf = new Jcms_UpdaterecordBLF(\"1\");\t\tJcms_Update_RecordEntity entity = new Jcms_Update_RecordEntity();\t\t//解压路径\t\tString strFilePath = strSysPath + \"/update/\";\t\t\t\t//zip文件上传的临时目录\t\tString strTemp = strFilePath + \"temp/\";\t\t\t\tConvert.createDirectory(strTemp);\t        //建立上传\t\tupload = new CommonUploadFile( strTemp ,\"\");\t\t\t\t\t   try{            //上传zip包\t\t\t\t\tboolean bResult = upload.uploadFile(request);\t\t\t\t\t\tString[] strFileName = upload.getAllFileName();\t\t\t\t\t\tstrBakPath = upload.getFormValue(\"vc_bakPath\");\t\t\tstrBakPath = Convert.getValue(strBakPath);\t\t\tstrBakPath = (strBakPath.trim().length() == 0) ? strFilePath : strBakPath;\t\t\t\t\tstrBakPath = strBakPath.replaceAll(\"\\\\\\\\\",\"/\");\t\t\tif(strBakPath.endsWith(\"/\") || strBakPath.endsWith(\"\\\\\"))\t\t\t\tstrBakPath = strBakPath.substring(0,strBakPath.length()-1);\t\t\tstrBakPath = strBakPath+\"/bak/\";\t\t\t//创建备份目录\t\t\tConvert.createDirectory(strBakPath);           \t\t\tZipFile zip = new ZipFile();\t\t\t//解压zip包\t\t    boolean  bl = zip.unzip( true,strTemp + strFileName[0].trim(),strFilePath );\t\t\t\t\t\t\tString strDate = DateFormat.getStrCurrentDate(DateFormat.LONG_DATE_TIME);\t\t\t\t\t\t//zip包名\t\t\tString strZipName = strFileName[0].substring(0,strFileName[0].lastIndexOf(\".zip\"));\t\t\t \t\t\t if( bResult && bl){\t\t\t\t entity.setVc_packagename(strZipName);\t\t\t\t entity.setVc_spath(strFilePath);\t\t\t\t entity.setVc_bpath(strBakPath);\t\t\t\t entity.setC_createtime(strDate);\t\t\t\t entity.setI_flag(1);\t\t\t\t entity.setVc_status(\"未执行\");\t\t\t\t entity.setB_cancel(0);\t\t\t\t bl = blf.doInsert(entity);\t\t\t }\t\t\t \t\t\t if( !bl ){\t\t\t\t  LogWriter.error( \"ERROR: mark record!\" );\t\t\t  }else{\t\t\t\t  //删除上传的zip文件\t\t\t\t  jcms.util.FileUtil.deleteFolder(strTemp);\n在导入更新包的，必须是zip包，我们可以将我们的马打包成zip包。。\nJcms_UpdaterecordBLF blf = new Jcms_UpdaterecordBLF(\"1\");\t\tJcms_Update_RecordEntity entity = new Jcms_Update_RecordEntity();\t\t//解压路径\t\tString strFilePath = strSysPath + \"/update/\";//最终解压到该目录当中\t\t\t\t//zip文件上传的临时目录\t\tString strTemp = strFilePath + \"temp/\";\n最后会将马解压到目录中update中\n\n\n\n   漏洞证明：  \n\n\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-05-20 10:25 厂商回复： 感谢关注 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-20 11:04 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  后台哦    \n     2014-06-09 10:32 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @zzR 还是setup目录    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}