{"id": 83025, "wybug_id": "wooyun-2015-0149172", "wybug_title": "foxmail某缺陷可以导致界面劫持等危害", "wybug_corp": "腾讯", "wybug_author": "隐形人真忙", "wybug_date": "2015-10-28 10:56", "wybug_open_date": "2015-12-17 14:48", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行", "客户端安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-31：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： foxmail很好用，所以测试一下。 详细说明：  版本信息：\n\nFoxmail收取邮件时，也是会保存到本地的，在C盘的appdata相关路径下，有一个tmp开头的文件夹，和客户端对应关系如下：\n\n对mail_frame.html研究，发现使用了CSP策略，所以内联事件、script标签是无效的。根据定义的CSP策略，看起来只支持本地域。但是经过测试发现可以使用embed引入相关代码：\n\nFoxmail中允许html格式下进行发送，通过大量测试，构造payload如下：<embed code=\"evil.html\" allowscriptaccess=always>evil.html应该是一个我们能控制的页面。那么怎么在main_frame.html目录下进行引入呢？通过测试发现，收到邮件的附件上的文本也是解压到这个目录下，并且没有进行文件名的重新命名。所以攻击思路大致如下：（1）发一封邮件，带上恶意附件，用户点击，使附件出现在目录下。\n\n（2）发第二封邮件，用户点击查看就中招。\n\n\n\n\n\n这样就获得了一个本地域的XSS，看了一下本地域的API，没找到条件构成命令执行。不过可以嵌入页面的话，就能进行界面劫持或者其他问题。粗略的演示下效果：\n\n   漏洞证明：  \n\n\n\n\n\n   修复方案：  修复：1、禁止任何嵌入页面执行js。2、继续完善富文本过滤。   版权声明：转载请注明来源 隐形人真忙@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-10-28 18:37 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}