{"id": 2312, "wybug_id": "wooyun-2014-060275", "wybug_title": "一种几乎通杀各大厂商的文件防护绕过", "wybug_corp": "各大安全厂商", "wybug_author": "毕月乌", "wybug_date": "2014-05-11 11:42", "wybug_open_date": "2014-08-09 11:44", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计不当", "防护绕过"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-17：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-09：\t细节向公众公开  简要描述： 一种几乎通杀各大厂商的文件防护绕过 详细说明：  连发了两个防护绕过，鉴于发现此方法具有通用性，想了想还是单独把方法和思路发出来吧。为了避免刷rank之嫌，自评1。其实就是利用了NTFS的硬链接特性，利用同一个磁盘文件的不同文件名和路径来规避常规的安全软件检测。\nfsutil hardlink create c:\\a.txt C:WINDOWS\\system32\\drivers\\etc\\hosts\n执行此命令后c:\\a.txt与C:WINDOWS\\system32\\drivers\\etc\\hosts两个文件实际上是等价的，在硬盘上是同一个文件，只是拥有两个文件名而已，利用这一点可以绕过一些常规安全软件的防护。有了这个特性，我们就可以任意读写大多数文件了。   漏洞证明：  其实就是利用了NTFS的硬链接特性，利用同一个磁盘文件的不同文件名和路径来规避常规的安全软件检测。\nfsutil hardlink create c:\\a.txt C:WINDOWS\\system32\\drivers\\etc\\hosts\n执行此命令后c:\\a.txt与C:WINDOWS\\system32\\drivers\\etc\\hosts两个文件实际上是等价的，在硬盘上是同一个文件，只是拥有两个文件名而已，利用这一点可以绕过一些常规安全软件的防护。有了这个特性，我们就可以任意读写大多数文件了。\n\n\n\n\n\n下面是对360的吐槽图：提交至360SRC时的证明截图：\n\n\n\n\n\n而昨晚的测试中，最新版360安全卫士变成了直接拦截硬链接创建：\n\n   修复方案：  加强监控吧在这里顺便鄙视一下360，这个问题最早于05-09凌晨03:19:30提交至360SRC。于05-10 19:29被忽略，得到回复管理员非可信程序调用fsutil为关键文件创建硬链接的行为是会拦截的，你可以将你的cmd.exe修改几个字节再调用试试。于是又花了一夜对国内常见的安全卫士们都做了一遍测试。除金山卫士没发现敏感文件保护的组件外，百度卫士和腾讯管家均存在问题，最让我惊讶的是，360居然拦截了！于是又翻出老版本360安全卫士在虚拟机测试，发现5.9之前的版本存在问题，在此我想问一下，这就是360对待缺陷的态度？一边偷偷修复，一边否认？   版权声明：转载请注明来源 毕月乌@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-05-14 17:44 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-11 11:54 |    \t\t切克脑 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:9        | z..)\t\t \n  火钳刘明~    \n     2014-05-11 13:17 |    \t\t浅兮 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:30        )\t\t \n  貌似很厉害啊！    \n     2014-05-11 13:36 |    \t\tFire ant \t\t\t( 实习白帽子  |\t\t\t        Rank:73 漏洞数:26        | 他们回来了................)\t\t \n  出租广告位    \n     2014-05-11 13:47 |    \t\t酱油甲 \t\t\t( 普通白帽子  |\t\t\t        Rank:645 漏洞数:126        | 打个酱油，吃个海蜇~)\t\t \n  @毕月乌 @xsser 这种通杀各大厂商的交给谁处理呢……    \n     2014-05-11 14:02 |    \t\tMetasploit \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:7        | http://www.metasploit.cn/)\t\t \n  看看    \n     2014-05-11 14:03 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  马克    \n     2014-05-11 15:42 |    \t\t玄空 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 文艺范)\t\t \n  mark    \n     2014-05-11 17:27 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:16        | 猜猜我是谁？)\t\t \n  @酱油甲 cncert吧    \n     2014-05-11 17:41 |    \t\t破锁 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:6        )\t\t \n   坐等啊  ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็这个符号很厉害    \n     2014-05-12 09:24 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  真的啊？给力哦！    \n     2014-05-14 01:57 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  给力啊！    \n     2014-05-14 09:33 |    \t\t于小木 \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:4        )\t\t \n  坐等被忽略啊啊啊啊啊    \n     2014-05-15 08:57 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-05-17 08:43 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  火前留名占座巫云众真#￥#聪明 这都能想到办到    \n     2014-05-17 18:07 |    \t\t帅爆的小烬烬 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:25        | 路上有个漂亮妹子和我搭讪，知道我赶着去挖...)\t\t \n  mark     \n     2014-06-03 17:56 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  这就是360对待缺陷的态度？一边偷偷修复，一边否认？    \n     2014-06-03 22:59 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  这个真心有意思~~    \n     2014-06-04 12:44 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  普通的shell，可以搞这个链接吗？    \n     2014-06-23 20:49 |    \t\tACGT \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:4        | another script kiddie)\t\t \n  360一贯如此  WooYun: 360一主程序存在严重漏洞    \n     2014-06-25 17:02 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  原来如此    \n     2014-06-30 18:21 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:16        | 猜猜我是谁？)\t\t \n  @ACGT 本来打算先混点他家的奖励的，算了，不想了，以后还是直接打脸吧~    \n     2014-08-09 12:14 |    \t\t季煜熙 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | 人生就像一场游戏。)\t\t \n   ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็试试这个符号。。    \n     2014-08-10 09:40 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  顶，顺便鄙视360    \n     2014-10-23 11:05 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n   ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ด้้้้้็็็็็้้้้้็็็็็้้้้้้้้็็็็็้้้้้็็็็ 这个符号很厉害    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}