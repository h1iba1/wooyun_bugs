{"id": 55152, "wybug_id": "wooyun-2014-062064", "wybug_title": "KPPW Sql 最新版 可修改管理密码", "wybug_corp": "keke.com", "wybug_author": "′雨。", "wybug_date": "2014-05-25 12:04", "wybug_open_date": "2014-08-20 12:06", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-30：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-20：\t细节向公众公开  简要描述： 更新日期: \t2014-05-19 12:17:29。。可以修改管理密码 但是修改的密码是不可控的。  还是老老实实注入把。 详细说明：  在api/uc.php中\nif(!defined('IN_UC')) {\trequire_once '../app_comm.php';\trequire_once S_ROOT.'/config/config_ucenter.php';\t$get = $post = array();\t$code = @$_GET['code'];\tparse_str(_authcode($code, 'DECODE', UC_KEY), $get);\tif(DEBUGUC==TRUE){\t\t$get['realtime'] = date('Y-m-d H:i:s', $get['time']);\t\tfile_put_contents(S_ROOT.'/data/log/uc_client_log.txt', var_export ( $get, 1), FILE_APPEND);\t}\tif(time() - $get['time'] > 3600) {\t\texit('Authracation has expiried');\t}\tif(empty($get)) {\t\texit('Invalid Request');\t}\tinclude_once S_ROOT.'/uc_client/lib/xml.class.php';\t$post = xml_unserialize(file_get_contents('php://input'));\n默认的uckey为123456.在直接用uckey getshell发现\nif($post['UC_API']) {\t\t\t$UC_API = str_replace(array('\\'', '\"', '\\\\', \"\\0\", \"\\n\", \"\\r\"), '', $post['UC_API']);\t\t\tunset($post['UC_API']);\t\t}\n还是来注入把\nfunction updatepw($get, $post) {\t\tglobal $_G;\t\tif(!API_UPDATEPW) {\t\t\treturn API_RETURN_FORBIDDEN;\t\t}\t\t$newpw = md5(time().rand(100000, 999999));\t\tdb_factory::updatetable(TABLEPRE.'witkey_space', array('password'=>$newpw), array('username'=>$get['username']));\t\tdb_factory::updatetable(TABLEPRE.'witkey_member', array('password'=>$newpw), array('username'=>$get['username']));\t\treturn API_RETURN_SUCCEED;\t}\n调用这函数。   但是$newpw 是不可控的。。也即使时间戳+随机的。    要修改的用户的名字是可控的。所以可以修改任意用户的密码。。。 但是密码不可控这样比较麻烦啊。   还是来注入把。调用authcode生成一下语句。\nfunction updatepw($get, $post) {\t\tglobal $_G;\t\tif(!API_UPDATEPW) {\t\t\treturn API_RETURN_FORBIDDEN;\t\t}\t\t$newpw = md5(time().rand(100000, 999999));\t\tdb_factory::updatetable(TABLEPRE.'witkey_space', array('password'=>$newpw), array('username'=>$get['username']));\t\tdb_factory::updatetable(TABLEPRE.'witkey_member', array('password'=>$newpw), array('username'=>$get['username']));\t\treturn API_RETURN_SUCCEED;\t}\n调用这个函数   漏洞证明：  \n\n\n\n   修复方案：  判断是否整合uc否 退出。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-08-20 12:06 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}