{"id": 55705, "wybug_id": "wooyun-2014-060159", "wybug_title": "phpmps 注入 (可修改其他用户密码,官网成功)", "wybug_corp": "phpmps.com", "wybug_author": "′雨。", "wybug_date": "2014-05-10 22:48", "wybug_open_date": "2014-08-08 22:50", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-08：\t细节向公众公开  简要描述： 验证不足啊。 详细说明：  在api/uc.php中\ndefine('IN_PHPMPS', true);define('UC_CLIENT_VERSION', '1.5.0');\t//note UCenter 版本标识define('UC_CLIENT_RELEASE', '20081031');define('API_DELETEUSER', 1);\t\t//note 用户删除 API 接口开关define('API_RENAMEUSER', 1);\t\t//note 用户改名 API 接口开关define('API_GETTAG', 1);\t\t    //note 获取标签 API 接口开关define('API_SYNLOGIN', 1);\t\t    //note 同步登录 API 接口开关define('API_SYNLOGOUT', 1);\t\t    //note 同步登出 API 接口开关define('API_UPDATEPW', 1);\t\t    //note 更改用户密码 开关define('API_UPDATEBADWORDS', 1);\t//note 更新关键字列表 开关define('API_UPDATEHOSTS', 1);\t\t//note 更新域名解析缓存 开关define('API_UPDATEAPPS', 1);\t\t//note 更新应用列表 开关define('API_UPDATECLIENT', 1);\t\t//note 更新客户端缓存 开关define('API_UPDATECREDIT', 0);\t\t//note 更新用户积分 开关define('API_GETCREDITSETTINGS', 0);\t//note 向 UCenter 提供积分设置 开关define('API_GETCREDIT', 0);\t\t    //note 获取用户的某项积分 开关define('API_UPDATECREDITSETTINGS', 0);\t//note 更新应用积分设置 开关define('API_RETURN_SUCCEED', '1');define('API_RETURN_FAILED', '-1');define('API_RETURN_FORBIDDEN', '-2');//note 普通的 http 通知方式if(!defined('IN_UC')) {\terror_reporting(0);\tset_magic_quotes_runtime(0);\tdefined('MAGIC_QUOTES_GPC') || define('MAGIC_QUOTES_GPC', get_magic_quotes_gpc());\tinclude '../include/common.php';\tinclude '../include/uc.inc.php';\t$_DCACHE = $get = $post = array();\t$code = @$_GET['code'];\tparse_str(_authcode($code, 'DECODE', UC_KEY), $get);\tif(MAGIC_QUOTES_GPC) {\t\t$get = _stripslashes($get);\t}\t$action = $get['action'];\trequire_once '../uc_client/lib/xml.class.php';\t$post = xml_unserialize(file_get_contents('php://input'));\nUC_KEY 默认为phpmps。    官网的也如此。为1的我们都可以调用。那就来调用这个把\nfunction updatepw($get, $post) {\t\t\tglobal $db,$table;\t\tif(!API_UPDATEPW) {\t\t\treturn API_RETURN_FORBIDDEN;\t\t}\t\t\t\t$username = $get['username'];\t\t$password = $get['password'];\t\t$newpw = md5($password);\t\t$db->query(\"UPDATE {$table}member SET password='$newpw' WHERE username='$username'\");\t\treturn API_RETURN_SUCCEED;\t}\n这里 是个update的语句 所以我们可以更改其他用户的密码。然后我们自己生成一个加密的注入语句。。。    漏洞证明：  测试demo。\n\n   修复方案：  验证。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-05-12 10:28 厂商回复： 感谢作者提供漏洞信息，作者是一个非常细心的人，非常感谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-01 00:21 |    \t\t9k九块钱 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:11        | ส็็็็็็็็็็็็็็็็็็็...)\t\t \n  大牛求认识    \n     2014-10-27 14:37 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  mark，还可以这么用的阿    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}