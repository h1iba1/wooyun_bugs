{"id": 29220, "wybug_id": "wooyun-2015-0120093", "wybug_title": "黑魔法系列-我是如何重置V电影主站任意用户密码的", "wybug_corp": "vmovier.com", "wybug_author": "黑暗游侠", "wybug_date": "2015-06-15 11:25", "wybug_open_date": "2015-07-30 17:26", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-30：\t细节向公众公开  简要描述： 希望能获得6月洞主演艺最佳思路漏洞入选名额 详细说明：  又去重温了一遍多啦A梦，看到了v电影视频门户习惯使然了，顺手测试一下，找到了黑魔法，快修复吧忘记密码：http://www.vmovier.com/user/forgetpwd填上任意用户的邮箱，然后发送，先来看一下原装的重置链接是什么\nhttp://www.vmovier.com/user/resetpwd?email=**@**.***&token=f321cd2871eac182554f78ab6b3bb9c3\n访问以下自动重置了新的密码，如图：\n\n链接很简单，问题一目了然，控制了 token 就控制了整个重置机制那么看 tokenf321cd2871eac182554f78ab6b3bb9c3what is this ？经过多次测试验证，这里直接给出答案：\ntoken=md5（时间戳）\n时间戳是服务端接收数据包并处理的时候的瞬间时间戳格式为unix格式笑话，服务端处理的瞬时时间我们怎么知道，难道只有对某几十秒内进行fuzzing么？no这里还存在一个tmpkey，tmpkey的时间戳来自当前数据包的时间戳，更重要的是，这串时间戳包含在cookie里可以直接获取服务端验证机制应该类似是：\n……if(token==key || token == tmpkey){    …………}\n来实际看一下对比：正常发送的邮件数据包，可以看到cookie里的时间戳为：1434110820md5加密后：20fcfdec4985c7f81cfe359a5f792377再来看实际收到的邮件token：\n\n看到了吧，实际上是有两个key的即使我们无法计算出正常流程获得的邮件中的token，但是我们可以直接获取post包中的当前时间戳，加密后放到如下链接：\nhttp://www.vmovier.com/user/resetpwd?email=任意用户邮箱&token=本地计算的时间戳加密哈希\n然后访问之，即可直接重置密码：\n\n========================================================那么黑魔法在哪？key是我们控制的，包括加密的哈希原型我们可以自己自定义想要的任何key自定义一个时间，2008-1-1 1:1:1  转换成unix如下：\n\n当然这个时间可以是你的生日，是开国大典，是多啦A梦刚认识大雄的日期。。。复制下来，然后再次找回密码，替换掉数据包里的时间戳。。。\n\n1199120461md5加密后得到：\nd79d46cc75b8d6059d9c3fa441bae060\n直接访问：\nhttp://www.vmovier.com/user/resetpwd?email=admin@ruo.me&token=d79d46cc75b8d6059d9c3fa441bae060\n\n\n多么简单实用的黑魔法，秒杀一切用户   漏洞证明：     修复方案：  20rank吧，写了那么多   版权声明：转载请注明来源 黑暗游侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2015-06-15 17:24 厂商回复： 非常感谢发现这个重要bug，已经修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-15 17:24 |    \t\tV电影(乌云厂商)\t\t \n  非常感谢    \n     2015-06-15 19:20 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @V电影 有礼物么    \n     2015-08-24 09:01 |    \t\t风格 \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:6        | 注册为白帽子，你可以在这里提交你发现的漏...)\t\t \n  @V电影 只修复了token的取值算法和时效。如果我用一个邮箱获取到了token值，再替换邮箱也是可以重置任意用户密码的~~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}