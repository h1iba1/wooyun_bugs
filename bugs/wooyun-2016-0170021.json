{"id": 85929, "wybug_id": "wooyun-2016-0170021", "wybug_title": "天融信TopScanner两处任意文件下载删除漏洞(无需登录)", "wybug_corp": "天融信", "wybug_author": "xfkxfk", "wybug_date": "2016-01-15 10:15", "wybug_open_date": "2016-04-11 16:08", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "任意文件读取", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-18：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-03-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-03-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-03-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-04-11：\t细节向公众公开  简要描述： 天融信TopScanner两处任意文件下载删除漏洞(无需登录) 详细说明：  第一处任意文件下载几删除：文件/task/saveTaskIpList.php\n<?$fileName = $_GET['fileName'];if(!$fileName){\theader(\"Content-type: text/html; charset=utf-8\");\techo \"<script language='javascript'>\";\techo \"alert('保存过程发生错误！')\";\techo \"</script>\";\texit();}$handler = fopen(\"$fileName\",'r');if(!$handler){\theader(\"Content-type: text/html; charset='utf-8'\");\techo \"<script language='javascript'>\";\techo \"alert('保存过程中发生错误，打开文件失败！')\";\techo \"</script>\";\texit();}$length = filesize($fileName);if($length === false){\theader(\"Content-type: text/html; charset='utf-8'\");\techo \"<script language='javascript'>\";\techo \"alert('保存过程发生错误，读取文件长度失败！')\";\techo \"</script>\";\texit();}$outputFile = 'Devices';header(\"Cache-Control:\");header(\"Cache-Control: public\");header(\"Content-Type: application/force-download\");header(\"Content-Disposition: attachment; filename=\\\"$outputFile\\\"\");header(\"Accept-Ranges: bytes\");   $size=filesize($fileName);   $fp=fopen(\"$fileName\",\"rb\");   fseek($fp,$range);   while(!feof($fp)){       print(fread($fp,1024*8));   }   fclose($fp);   unlink($fileName);?>\n$fileName = $_GET['fileName'];直接进入fopen，fread导致任意文件读取而且$fileName还进入了unlink函数，导致任意文件删除第二处任意文件下载：文件/task/downloadFile.php\n<?    include_once 'policy/CTaskManager.php';     session_start();     $fileName=$_GET['fileName'];     $fileTar=\"report/\".$fileName;         header(\"Content-Description: File Transfer\"); \t header(\"Content-Type: application/octet-stream\");    \t header(\"Content-Disposition: attachment; filename=\".basename($fileTar));      header(\"Content-Transfer-Encoding: binary\");     header(\"Expires:0\");     header(\"Cache-Control: must-revalidate, post-check=0, pre-check=0\");      header(\"Pragma: public\");      header(\"Content-Length: \" . filesize($fileTar));      ob_clean();      flush();     readfile($fileTar);     exit();    ?>\n显而易见$fileName进入readfile函数导致任意文件读取   漏洞证明：  漏洞验证链接见测试代码\n\n\n\n   修复方案：  登录验证   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2016-01-15 14:14 厂商回复： 已确认，感谢提交！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-15 10:23 |    \t\tAasron \t\t\t( 普通白帽子  |\t\t\t        Rank:410 漏洞数:95        | raw_input(\"你知道我要输入什么？\"))\t\t \n  6    \n     2016-01-15 10:24 |    \t\t带头大哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:691 漏洞数:211        | |任意邮件伪造| |目录遍历| |任意文件读取|...)\t\t \n  66    \n     2016-01-15 10:31 |    \t\t夏殇 \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:23        | 不忘初心，方得始终。)\t\t \n  666    \n     2016-01-15 10:35 |    \t\t伤心的猫猫 \t\t\t( 普通白帽子  |\t\t\t        Rank:115 漏洞数:32        | @sangfor,@qq,@alibaba,@baidu)\t\t \n  666    \n     2016-01-15 10:37 |    \t\tcf_hb \t\t\t( 普通白帽子  |\t\t\t        Rank:119 漏洞数:17        | 爱生活，爱安全！)\t\t \n  6666    \n     2016-01-15 10:53 |    \t\t骑虎打狗 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:7        | 我是中国式的 你懂得..)\t\t \n  66666    \n     2016-01-15 11:17 |    \t\t麦兜 \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:10        | 麦兜爱吃苹果.)\t\t \n  666666    \n     2016-01-15 11:32 |    \t\tpudding2 \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:43        | 新人报道，请多关照)\t\t \n  6666666    \n     2016-01-15 11:40 |    \t\tBy遗忘 \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:7        | 网络爱好者)\t\t \n  66666666    \n     2016-01-15 11:54 |    \t\t带我玩 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:8        | 带我玩)\t\t \n  66666666 6    \n     2016-01-15 11:59 |    \t\tsco4x0 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        | 身高两米)\t\t \n  6666666666    \n     2016-01-15 12:02 |    \t\t不能忍 \t\t\t( 实习白帽子  |\t\t\t        Rank:96 漏洞数:49        | 要是能重来，我要选李白!)\t\t \n  9    \n     2016-01-15 12:28 |    \t\tHero \t\t\t( 普通白帽子  |\t\t\t        Rank:137 漏洞数:38        | 药药切克闹,充气娃娃迷幻药)\t\t \n  99    \n     2016-01-15 12:54 |    \t\t路人毛 \t\t\t( 普通白帽子  |\t\t\t        Rank:107 漏洞数:42        | 要想Rank给高，标题一定得屌)\t\t \n  999    \n     2016-01-15 13:07 |    \t\t坏男孩-A_A \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:23        | 膜拜学习中)\t\t \n  9999    \n     2016-01-15 15:19 |    \t\t雨水 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:4        | 新手入道，多多指教。)\t\t \n  9999    \n     2016-01-15 15:21 |    \t\tterrying \t\t\t( 实习白帽子  |\t\t\t        Rank:59 漏洞数:15        | 雅蠛蝶)\t\t \n  99999    \n     2016-01-15 15:29 |    \t\t0hey_boy0 \t\t\t( 普通白帽子  |\t\t\t        Rank:123 漏洞数:22        | balabala~)\t\t \n  999999    \n     2016-01-17 09:49 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  9999999    \n     2016-01-20 14:27 |    \t\t0xLucifer \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | NULL)\t\t \n  断！    \n     2016-01-21 12:54 |    \t\tTwoEyes \t\t\t( 普通白帽子  |\t\t\t        Rank:108 漏洞数:35        | 你看到我的小熊了吗)\t\t \n  断断！    \n     2016-01-21 23:07 |    \t\tAtomath \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:2        | 你瞅啥)\t\t \n  断断断！    \n     2016-02-01 23:47 |    \t\tFriday  \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:11        | 破土的小竹笋)\t\t \n  第二个洞好像有些问题，下载下来的文件都是0    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}