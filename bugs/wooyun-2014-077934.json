{"id": 50398, "wybug_id": "wooyun-2014-077934", "wybug_title": "CuuMall免费开源商城系统 sql多处注入", "wybug_corp": "cuumall.com", "wybug_author": "menmen519", "wybug_date": "2014-10-02 10:18", "wybug_open_date": "2014-12-31 10:20", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-31：\t细节向公众公开  简要描述： CuuMall免费开源商城系统 sql多处注入 详细说明：  直接看代码：SearchAction.class.php(71-109):\npublic function Exsearch( )\t\t\t\t{\t\t\t\t\t\t\t\t$pinpai = $_POST['pinpai'];\t\t\t\t\t\t\t\t$pr1 = $_POST['pr1'];\t\t\t\t\t\t\t\t$pr2 = $_POST['pr2'];\t\t\t\t\t\t\t\t$key_word = $_POST['key_word'];\t\t\t\t\t\t\t\tif ( $pinpai == 0 )\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$pinpai = \"\";\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\tif ( $pinpai != \"\" )\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$sql1 = \"pinpai=\".$pinpai.\" and \";\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\telse\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$sql1 = \"\";\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\tif ( $pr1 != \"\" )\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$sql2 = \"memprice>\".$pr1.\" and \";\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\telse\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$sql2 = \"\";\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\tif ( $pr2 != \"\" )\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$sql3 = \"memprice<\".$pr2.\" and \";\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\telse\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$sql3 = \"\";\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t$title = c( \"MALLTITLE\" ).\"-\".$key_word;\t\t\t\t\t\t\t\t$this->assign( \"title\", $title );\t\t\t\t\t\t\t\t$header = a( \"Header\" );\t\t\t\t\t\t\t\t$header->index( );\t\t\t\t\t\t\t\t$list = new Model( \"produc\" );\t\t\t\t\t\t\t\timport( \"ORG.Util.Page\" );\t\t\t\t\t\t\t\t$count = $list->where( $sql1.$sql2.$sql3.\"title like '%\".$key_word.\"%' and body like '%\".$key_word.\"%'\" )->count( );\t\t\t\t\t\t\t\t$page = new Page( $count, 24 );\n发现了没有这里的 $pinpai  $pr1  $pr2  都不在引号里面 我们做一个测试url:http://192.168.10.70/cuumall_v2.3/v2.3/mall_upload/index.php/home/search/Exsearchpostdata:pinpai=1 and 1=1&pr1=1&pr2=2访问之后抓取sql语句：SELECT COUNT(*) AS tp_count FROM `cuu_produc` WHERE pinpai=1 and 1=1 and memprice>1 and memprice<2 and title like '%%' and body like '%%' LIMIT 1看到了没有1=1 完全进入到sql语句中间我们在看下一个 ：还是这个文件：135行 172：\npublic function px( )\t\t\t\t{\t\t\t\t\t\t\t\t$order = $_GET['order'];\t\t\t\t\t\t\t\t$title = c( \"MALLTITLE\" );\t\t\t\t\t\t\t\t$this->assign( \"title\", $title );\t\t\t\t\t\t\t\t$header = a( \"Header\" );\t\t\t\t\t\t\t\t$header->index( );\t\t\t\t\t\t\t\t$list = new Model( \"produc\" );\t\t\t\t\t\t\t\timport( \"ORG.Util.Page\" );\t\t\t\t\t\t\t\tif ( $order == \"addtime\" )\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$count = $list->count( );\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\telse\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$count = $list->where( $order.\"=1\" )->count( );\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t$page = new Page( $count, 24 );\t\t\t\t\t\t\t\t$show = $page->show( );\t\t\t\t\t\t\t\tif ( $order == \"addtime\" )\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$pro = $list->order( $order.\" desc\" )->limit( $page->firstRow.\",\".$page->listRows )->select( );\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\telse\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$pro = $list->where( $order.\"=1\" )->order( \"addtime desc\" )->limit( $page->firstRow.\",\".$page->listRows )->select( );\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t$pro = $this->bakimg( $pro );\t\t\t\t\t\t\t\t$this->assign( \"page\", $show );\t\t\t\t\t\t\t\t$this->assign( \"pro\", $pro );\t\t\t\t\t\t\t\t$lm = new Model( \"lanmu_one\" );\t\t\t\t\t\t\t\t$d_lm = $lm->select( );\t\t\t\t\t\t\t\t$this->assign( \"d_lm\", $d_lm );\t\t\t\t\t\t\t\t$pp = $this->pinpai( );\t\t\t\t\t\t\t\t$this->assign( \"pp\", $pp );\t\t\t\t\t\t\t\t$this->display( \"Home:searchlist\" );\t\t\t\t\t\t\t\t$bu = new ButtomAction( );\t\t\t\t\t\t\t\t$bu->Index( );\n看到了没有$order = $_GET['order']; 没有做处理$count = $list->where( $order.\"=1\" )->count( );  原理一样,这里就不演示了   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-10-09 13:39 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}