{"id": 2008, "wybug_id": "wooyun-2014-061475", "wybug_title": "74CMS最新版二次SQL注入", "wybug_corp": "74c,s.com", "wybug_author": "路人甲", "wybug_date": "2014-05-19 19:27", "wybug_open_date": "2014-08-17 19:28", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "数字类型注射", "安全意识不足", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向公众公开  简要描述： ~~ 详细说明：  文件：/user/company/company_jobs.php\n$addrand=intval($_POST['addrand']);\tif($_SESSION['addrand']==$addrand){\tunset($_SESSION['addrand']);\t$setsqlarr['add_mode']=intval($add_mode);\t$setsqlarr['uid']=intval($_SESSION['uid']);\t$setsqlarr['companyname']=$company_profile['companyname'];\t$setsqlarr['company_id']=$company_profile['id'];\t$setsqlarr['company_addtime']=$company_profile['addtime'];\t$setsqlarr['company_audit']=$company_profile['audit'];\t$setsqlarr['jobs_name']=!empty($_POST['jobs_name'])?trim($_POST['jobs_name']):showmsg('您没有填写职位名称！',1);\t$setsqlarr['contents']=!empty($_POST['contents'])?trim($_POST['contents']):showmsg('您没有填写职位描述！',1);\tcheck_word($_CFG['filter'],$_POST['contents'])?showmsg($_CFG['filter_tips'],0):'';\t$setsqlarr['nature']=intval($_POST['nature']);\t$setsqlarr['nature_cn']=trim($_POST['nature_cn']);\t$setsqlarr['sex']=intval($_POST['sex']);\t$setsqlarr['sex_cn']=trim($_POST['sex_cn']);\t$setsqlarr['amount']=intval($_POST['amount']);\t$setsqlarr['category']=!empty($_POST['category'])?intval($_POST['category']):showmsg('请选择职位类别！',1);\t$setsqlarr['subclass']=intval($_POST['subclass']);\t$setsqlarr['category_cn']=trim($_POST['category_cn']);\t$setsqlarr['trade']=$company_profile['trade'];\t$setsqlarr['trade_cn']=$company_profile['trade_cn'];\t$setsqlarr['scale']=$company_profile['scale'];\t$setsqlarr['scale_cn']=$company_profile['scale_cn'];\t$setsqlarr['district']=!empty($_POST['district'])?intval($_POST['district']):showmsg('请选择工作地区！',1);\t$setsqlarr['sdistrict']=intval($_POST['sdistrict']);\t$setsqlarr['district_cn']=trim($_POST['district_cn']);\t$setsqlarr['tag']=trim($_POST['tag']);\t$setsqlarr['street']=$company_profile['street'];\t$setsqlarr['street_cn']=$company_profile['street_cn'];\t$setsqlarr['officebuilding']=$company_profile['officebuilding'];\t$setsqlarr['officebuilding_cn']=$company_profile['officebuilding_cn'];\t\t$setsqlarr['education']=intval($_POST['education']);\t\t\t$setsqlarr['education_cn']=trim($_POST['education_cn']);\t$setsqlarr['experience']=intval($_POST['experience']);\t\t\t$setsqlarr['experience_cn']=trim($_POST['experience_cn']);\t$setsqlarr['wage']=intval($_POST['wage']);\t\t\t$setsqlarr['wage_cn']=trim($_POST['wage_cn']);\t$setsqlarr['graduate']=intval($_POST['graduate']);\t$setsqlarr['addtime']=$timestamp;\t$setsqlarr['deadline']=strtotime(\"\".intval($_POST['days']).\" day\");\t$setsqlarr['refreshtime']=$timestamp;\t$setsqlarr['key']=$setsqlarr['jobs_name'].$company_profile['companyname'].$setsqlarr['category_cn'].$setsqlarr['district_cn'].$setsqlarr['contents'];\trequire_once(QISHI_ROOT_PATH.'include/splitword.class.php');\t$sp = new SPWord();\t$setsqlarr['key']=\"{$setsqlarr['jobs_name']} {$company_profile['companyname']} \".$sp->extracttag($setsqlarr['key']);\t$setsqlarr['key']=$sp->pad($setsqlarr['key']);\t$setsqlarr['subsite_id']=intval($_CFG['subsite_id']);\t$setsqlarr['tpl']=$company_profile['tpl'];\t$setsqlarr['map_x']=$company_profile['map_x'];\t$setsqlarr['map_y']=$company_profile['map_y'];\tif ($company_profile['audit']==\"1\")\t{\t$setsqlarr['audit']=intval($_CFG['audit_verifycom_addjob']);\t}\telse\t{\t$setsqlarr['audit']=intval($_CFG['audit_unexaminedcom_addjob']);\t}\t$setsqlarr_contact['contact']=!empty($_POST['contact'])?trim($_POST['contact']):showmsg('您没有填写联系人！',1);\t$setsqlarr_contact['qq']=trim($_POST['qq']);\t$setsqlarr_contact['telephone']=!empty($_POST['telephone'])?trim($_POST['telephone']):showmsg('您没有填写联系电话！',1);\tcheck_word($_CFG['filter'],$_POST['telephone'])?showmsg($_CFG['filter_tips'],0):'';\t$setsqlarr_contact['address']=!empty($_POST['address'])?trim($_POST['address']):showmsg('您没有填写联系地址！',1);\t$setsqlarr_contact['email']=!empty($_POST['email'])?trim($_POST['email']):showmsg('您没有填写联系邮箱！',1);\t$setsqlarr_contact['notify']=intval($_POST['notify']);\t\t$setsqlarr_contact['contact_show']=intval($_POST['contact_show']);\t$setsqlarr_contact['email_show']=intval($_POST['email_show']);\t$setsqlarr_contact['telephone_show']=intval($_POST['telephone_show']);\t$setsqlarr_contact['address_show']=intval($_POST['address_show']);\t$setsqlarr_contact['qq_show']=intval($_POST['qq_show']);\t\t//添加职位信息\t$pid=inserttable(table('jobs'),$setsqlarr,true);\tempty($pid)?showmsg(\"添加失败！\",0):'';\t//添加联系方式\t$setsqlarr_contact['pid']=$pid;\t!inserttable(table('jobs_contact'),$setsqlarr_contact)?showmsg(\"添加失败！\",0):'';\n$setsqlarr['companyname']=$company_profile['companyname'];这里的companyname是企业用户注册的公司名称这里直接取出companyname的名称进入SQL语句。\nfunction inserttable($tablename, $insertsqlarr, $returnid=0, $replace = false, $silent=0) {\tglobal $db;\t$insertkeysql = $insertvaluesql = $comma = '';\tforeach ($insertsqlarr as $insert_key => $insert_value) {\t\t$insertkeysql .= $comma.'`'.$insert_key.'`';\t\t$insertvaluesql .= $comma.'\\''.$insert_value.'\\'';\t\t$comma = ', ';\t}\t$method = $replace?'REPLACE':'INSERT';\t$state = $db->query($method.\" INTO $tablename ($insertkeysql) VALUES ($insertvaluesql)\", $silent?'SILENT':'');\tif($returnid && !$replace) {\t\treturn $db->insert_id();\t}else {\t    return $state;\t} }\n   漏洞证明：  1、先注册一个企业，晚上公司信息，把公司名称改为111111'2、然后添加职位，在保存时，即可触发错误\n\n   修复方案：  过滤完善   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-05-20 14:37 厂商回复： 已经在处理中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}