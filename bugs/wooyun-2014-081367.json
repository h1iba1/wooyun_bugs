{"id": 43878, "wybug_id": "wooyun-2014-081367", "wybug_title": "pageadmin ViewState缺陷导致sql注入", "wybug_corp": "pageadmin.net", "wybug_author": "Damo", "wybug_date": "2014-10-30 15:52", "wybug_open_date": "2015-01-28 15:54", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "敏感接口缺乏校验", "逻辑错误", "设计不当导致攻击界面扩大", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-02：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-28：\t细节向公众公开  简要描述： 此处省略50万条网站信息1、.............. 2、..............  ..............50.、http://www.pageadmin.net影响页面甚多，还望厂商以及各站长能逐一检查  听说咱们出新功能了 乌云新增刷乌云币功能  连接http://zone.wooyun.org/content/16138  特地来试试好不好使另外所用到的工具同样在“测试代码”中提供下载地址 详细说明：  具体分析：1、查找一个动态页面例如：\n/e/aspx/data_select.aspx\n 参数：\nsiteid=1&table=article&field=1&multiple=&sortid=&keyword=&pagesize=2\n\n\n查看源码得到 ：aspNetHidden 内容如下\n/wEPDwUJMzkzMjk4Njc3DxYIHgtDdXJyZW50UGFnZWYeDENhbGN1bGF0ZXNxbAUzc2VsZWN0IGNvdW50KGlkKSBhcyBjbyBmcm9tIGFydGljbGUgd2hlcmUgc2l0ZV9pZD0xHgNzcWwFqQFzZWxlY3Qgc2l0ZV9pZCxzb3J0X2lkLGlkLHRpdGxlLHN0YXRpY19kaXIsc3RhdGljX2ZpbGUsbGFubXVfaWQsc3VibGFubXVfaWQsemR5X3VybCxwZXJtaXNzaW9ucyxjaGVja2VkLFtodG1sXSx0aGVkYXRlIGZyb20gYXJ0aWNsZSB3aGVyZSBzaXRlX2lkPTEgb3JkZXIgYnkgdGhlZGF0ZSBkZXNjHglQYWdlQ291bnQCkQEWAmYPZBYMAgEPFgIeC18hSXRlbUNvdW50AgIWBGYPZBYEZg8VAQM5MzlkAgEPFQEDOTM5ZAIBD2QWBGYPFQEDOTM4ZAIBDxUBAzkzOGQCAg8PFgIeBFRleHQFAzI4OWRkAgMPDxYCHwUFATFkZAIEDw8WAh8FBQMxNDVkZAIFDw8WAh4HRW5hYmxlZGhkZAIHDxBkEBWRAQExATIBMwE0ATUBNgE3ATgBOQIxMAIxMQIxMgIxMwIxNAIxNQIxNgIxNwIxOAIxOQIyMAIyMQIyMgIyMwIyNAIyNQIyNgIyNwIyOAIyOQIzMAIzMQIzMgIzMwIzNAIzNQIzNgIzNwIzOAIzOQI0MAI0MQI0MgI0MwI0NAI0NQI0NgI0NwI0OAI0OQI1MAI1MQI1MgI1MwI1NAI1NQI1NgI1NwI1OAI1OQI2MAI2MQI2MgI2MwI2NAI2NQI2NgI2NwI2OAI2OQI3MAI3MQI3MgI3MwI3NAI3NQI3NgI3NwI3OAI3OQI4MAI4MQI4MgI4MwI4NAI4NQI4NgI4NwI4OAI4OQI5MAI5MQI5MgI5MwI5NAI5NQI5NgI5NwI5OAI5OQMxMDADMTAxAzEwMgMxMDMDMTA0AzEwNQMxMDYDMTA3AzEwOAMxMDkDMTEwAzExMQMxMTIDMTEzAzExNAMxMTUDMTE2AzExNwMxMTgDMTE5AzEyMAMxMjEDMTIyAzEyMwMxMjQDMTI1AzEyNgMxMjcDMTI4AzEyOQMxMzADMTMxAzEzMgMxMzMDMTM0AzEzNQMxMzYDMTM3AzEzOAMxMzkDMTQwAzE0MQMxNDIDMTQzAzE0NAMxNDUVkQEBMAExATIBMwE0ATUBNgE3ATgBOQIxMAIxMQIxMgIxMwIxNAIxNQIxNgIxNwIxOAIxOQIyMAIyMQIyMgIyMwIyNAIyNQIyNgIyNwIyOAIyOQIzMAIzMQIzMgIzMwIzNAIzNQIzNgIzNwIzOAIzOQI0MAI0MQI0MgI0MwI0NAI0NQI0NgI0NwI0OAI0OQI1MAI1MQI1MgI1MwI1NAI1NQI1NgI1NwI1OAI1OQI2MAI2MQI2MgI2MwI2NAI2NQI2NgI2NwI2OAI2OQI3MAI3MQI3MgI3MwI3NAI3NQI3NgI3NwI3OAI3OQI4MAI4MQI4MgI4MwI4NAI4NQI4NgI4NwI4OAI4OQI5MAI5MQI5MgI5MwI5NAI5NQI5NgI5NwI5OAI5OQMxMDADMTAxAzEwMgMxMDMDMTA0AzEwNQMxMDYDMTA3AzEwOAMxMDkDMTEwAzExMQMxMTIDMTEzAzExNAMxMTUDMTE2AzExNwMxMTgDMTE5AzEyMAMxMjEDMTIyAzEyMwMxMjQDMTI1AzEyNgMxMjcDMTI4AzEyOQMxMzADMTMxAzEzMgMxMzMDMTM0AzEzNQMxMzYDMTM3AzEzOAMxMzkDMTQwAzE0MQMxNDIDMTQzAzE0NBQrA5EBZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZxYBZmRk\n此加密内容解密的到下图：\n\n那么我们只要能修改红色圈出的部分即可 想的到什么数据 就能得到什么数据\n\n本地测试 获取管理员中的数据  sql为红色圈住的部分 ：\nselect username+userpassword as id from pa_member\n注：可能小伙伴不解为何 as   id  看页面代码 \n<%#DataBinder.Eval(Container.DataItem,\"id\")%>\"\n   也就是说 绑定的是id  故 as id 将修改后的数据加密  加密后的内容 详细代码请查看 “测试代码” 然后 浏览器 F12  替换掉原来的加密字符串即可  ；但是这个时候 小伙伴们捉急了 ，获取的数据哪？那么请看if(!Page.IsPostBack)    {  ViewState[\"sql\"]=\"select site_id,sort_id,id,title,static_dir,static_file,lanmu_id,sublanmu_id,zdy_url,permissions,checked,[html],thedate from \"+TheTable+\" where site_id=\"+SiteId+sql_str+\" order by thedate desc\";}实际的代码片段是在这个地方  IsPostBack了  所以这个时候我们需要一个事件触发 才能获取数据有两种方式 ：1、替换原来的加密字符串之后，点击下一页 然后在返回到第一页 即可2、或者POST数据 到此地址 /e/aspx/data_select.aspx?siteid=1&table=article&field=1&multiple=&sortid=&keyword=&pagesize=2这个时候小伙伴们又捉急了  数据哪 数据哪？  数据在这里 下图：\n\n\n\n   漏洞证明：  \n\n\n\n   修复方案：  这是由ViewState引发的血案   影响页面甚多 不发集合了   贵司珍重   版权声明：转载请注明来源 Damo@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-10-30 16:05 厂商回复： 新版本已经修复，谢谢白帽子 最新状态： 2014-11-11：之前给和另外一个viewstate泄露给搞混淆了，不好意思，今天才确认并进行了修复。  ", "replys": "漏洞评价：\n评论\n     2014-10-30 16:19 |    \t\tDamo \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:31        | 我只是喜欢看加菲猫而已ส็็็็็็็็...)\t\t \n  @PageAdmin v3.0 build20141029  http://down.admin5.com/net/8537.html#link  2014-10-29发布的漏洞满满的   这未免修复的也忒快了吧    \n     2014-11-12 08:16 |    \t\tDamo \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:31        | 我只是喜欢看加菲猫而已ส็็็็็็็็...)\t\t \n  @pageadmin.net   双十一你们不放假吗    \n     2014-11-12 10:54 |    \t\tPageAdmin(乌云厂商)\t\t \n  @Damo 苦逼程序猿哪里会有假期    \n     2014-11-26 19:07 |    \t\tBMa \t\t\t( 普通白帽子  |\t\t\t        Rank:1776 漏洞数:200        )\t\t \n  @Damo viewstatedecoder？aspx的都应该解密去看看    \n     2014-11-27 09:04 |    \t\tDamo \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:31        | 我只是喜欢看加菲猫而已ส็็็็็็็็...)\t\t \n  @BMa  首先反编译源码 看看有木有用到viewstate  如果 有用到的就解密去看看    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}