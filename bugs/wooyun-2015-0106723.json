{"id": 34301, "wybug_id": "wooyun-2015-0106723", "wybug_title": "大米CMS最新版注入可创建有任意余额的账户！", "wybug_corp": "damicms.com", "wybug_author": "izy", "wybug_date": "2015-04-17 10:23", "wybug_open_date": "2015-07-16 20:22", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-16：\t细节向公众公开  简要描述： 参数过滤不严。 详细说明：  出现问题的地方在：/Web/Lib/Action/MemberAction.class.php\nfunction qqcreate(){$data = array_map('strval',$_POST);$data = array_map('remove_xss',$data);if($data['realname']=='' || $data['qid']==''){$this->error('参数错误!');exit();}$t = M('member')->where(\"username='\".$data['realname'].\"'\")->find();if(!$t){$data['username'] = $data['realname'];}else{$data['username'] = (string)time();}$data['userpwd'] = md5(time().rand(0,9999));$User = D(\"Member\"); // 实例化User对象if ($User->create()){$this->error($User->getError());}else{$uid = M('member')->add($data);$_SESSION['dami_uid'] = $uid;$_SESSION['dami_username'] = $data['username'];$_SESSION['dami_usericon'] = $data['icon'];if(!empty($_REQUEST['lasturl'])){\t\t$this->assign('jumpUrl',urldecode(htmlspecialchars($_REQUEST['lasturl'])));\t}else{$this->assign('jumpUrl',U('Member/main'));}$this->success('绑定成功,正在登陆~');\t}}\n我们看到这，直接save了变量data，data是一个数组，在之前没有判断字段合法性，这样就可以修改其他字段的数据了：\n$uid = M('member')->add($data);\n如果我们post money=999999 可以就可以得到一个有999999元的账户，此漏洞类似于 WooYun: 大米CMS v4.9 sql注入 \n\n   漏洞证明：  \n\n   修复方案：  unset($data['money']);//禁止修改money   版权声明：转载请注明来源 izy@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-04-17 20:20 厂商回复： 充值是有日志记录的，查下用户的充值记录发现里面的数据会不符合。但这种构造数据非法修改仍然危害巨大 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}