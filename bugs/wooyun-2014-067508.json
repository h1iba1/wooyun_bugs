{"id": 53493, "wybug_id": "wooyun-2014-067508", "wybug_title": "FengCMS新版本重装", "wybug_corp": "fengcms.com", "wybug_author": "xlz0iza1", "wybug_date": "2014-07-07 16:38", "wybug_open_date": "2014-10-05 16:40", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-10：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-05：\t细节向公众公开  简要描述： FengCms Beta 1.20管理这样判断冒是那里不对啊。 详细说明：  用switch做判断，真的搞不懂程序猿是怎么想的啊，这里的step变量可以控制，导致重装程序。\nswitch($_GET['step']){    case '1': //安装许可协议\t\tinclude ABS_PATH.\"/step/step1.php\";\tbreak;    case '2': //检查安装环境是否满足要求\t\t$PHP_GD  = '';\t\tif(extension_loaded('gd')) {\t\t\tif(function_exists('imagepng')) $PHP_GD .= 'png';\t\t\tif(function_exists('imagejpeg')) $PHP_GD .= ' jpg';\t\t\tif(function_exists('imagegif')) $PHP_GD .= ' gif';\t\t}\t\t$PHP_JSON = '0';\t\tif(extension_loaded('json')) {\t\t\tif(function_exists('json_decode') && function_exists('json_encode')) $PHP_JSON = '1';\t\t}\t\t//新加fsockopen 函数判断,此函数影响安装后会员注册及登录操作。\t\tif(function_exists('fsockopen')) {\t\t\t$PHP_FSOCKOPEN = '1';\t\t}\t\t$PHP_DNS = preg_match(\"/^[0-9.]{7,15}$/\", @gethostbyname('www.baidu.cn')) ? 1 : 0;\t\t//是否满足FengCms安装需求\t\t$is_right = (phpversion() >= '5.2.0' && extension_loaded('mysql') && $PHP_JSON && $PHP_GD && $PHP_FSOCKOPEN) ? 1 : 0;\t\t//配置文件是否存在和可写\t\t$is_config = (is_readable($config_file) && is_writable($config_file)) ? 1 : 0;\t\t//上传目录是否可写\t\t$is_upload = (dir_writeable(ROOT_PATH.\"/upload\")) ? 1 : 0;\t\t\t\t//模块导出目录是否可写\t\t$is_module = (dir_writeable(ROOT_PATH.\"/upload/module\")) ? 1 : 0;\t\t//前台缓存目录是否可写\t\t$is_cache = (dir_writeable(ROOT_PATH.\"/app/cache\")) ? 1 : 0;\t\tinclude ABS_PATH.\"/step/step2.php\";\tbreak;    case '3': //填写数据库信息\t\tinclude ABS_PATH.\"/step/step3.php\";\tbreak;    case '4': //正在安装\t\t$conn=@mysql_connect($_GET['host'],$_GET['user'],$_GET['password']);\t\tif(!$conn){\t\t\t\techo '<script type=\"text/javascript\">alert(\"链接主机失败，请检查主机地址、用户名和密码是否正确！\");history.go(-1);</script>';\t\t\t\texit();  \t\t}elseif(intval(mysql_get_server_info($conn))<5){\t\t\t\techo '<script type=\"text/javascript\">alert(\"您的MYSQL版本为'. mysql_get_server_info($conn).'，版本太低，不能安装FengCms!\");history.go(-1);</script>';\t\t\t\texit();  \t\t}else{  \t\t\tif(!mysql_select_db($_GET['dbname'],$conn)){   //如果数据库不存在，我们就进行创建。\t\t\t\tif (!mysql_query(\"CREATE DATABASE \". $_GET['dbname'] .\" default character set utf8;\",$conn))\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\techo '<script type=\"text/javascript\">alert(\"数据库不存在，创建不成功\");history.go(-1);</script>';\t\t\t\t\t}else{\t\t\t\t\t\tif(!mysql_select_db($_GET['dbname'],$conn)){\t\t\t\t\t\t\t\t\t\t\t\t\t\techo '<script type=\"text/javascript\">alert(\"链接数据库失败，请检查数据库是否正确！\");history.go(-1);</script>';\t\t\t\t\t\t}else{\t\t\t\t\t\t\tinclude \"data.php\";\t\t\t\t\t}\t\t\t\t}\t\t\t}else{\t\t\t\tinclude \"data.php\";\t\t   }\t\t}\tbreak;    case '5': //安装完成\t\tinclude ABS_PATH.\"/step/step5.php\";\tbreak;    case '6': //删除安装目录\t\tif(rmdirs(ROOT_PATH.'/install') or rmdir(ROOT_PATH.'/install')){\t\t\t  echo '<script type=\"text/javascript\">alert(\"删除成功！\");close();</script>';\t\t\t  exit();\t\t}else{\t\t\t  echo '<script type=\"text/javascript\">alert(\"删除失败，请手工删除网站根目录下install目录！\");close();</script>';\t\t\t  exit();\t\t}\tbreak;}\n   漏洞证明：  \nhttp://test.com/FengCms%20Beta%201.20/install/index.php?host=localhost&user=root&password=****&dbname=fengcms&prefix=f_&url_type=1&step=4\n\n\n前提用户在没有删除/install的情况下面导致程序无限制任意安全。   修复方案：  修改判断语句~提醒用户删除可以改成强制。   版权声明：转载请注明来源 xlz0iza1@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-07-07 17:28 厂商回复： 站长应该在安装完之后，删除install这个文件夹。这样，我们做个处理，让他不可以无限安装吧。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-08 12:37 |    \t\tFengCMS(乌云厂商)\t\t \n  FengCms安全测试站地址：http://guf521656.h163.92hezu.org/ 有效期2014-7-8至2014-7-15 欢迎各位安全界的朋友帮我们寻找安全漏洞！作为一个小小的创业团队，对各位朋友对FengCms的关注表示衷心的感谢！    \n     2014-07-10 16:22 |    \t\tFengCMS(乌云厂商)\t\t \n  非常感谢各位白帽子的辛勤工作！FengCms安全测试站地址：http://guf521656.h163.92hezu.org/ 已经升级到最新版本 有效期2014-7-8至2014-7-15 欢迎各位安全界的朋友帮我们寻找安全漏洞！作为一个小小的创业团队，对各位朋友对FengCms的关注表示衷心的感谢！     \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}