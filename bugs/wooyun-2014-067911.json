{"id": 53367, "wybug_id": "wooyun-2014-067911", "wybug_title": "ShopBuilder商城程序代码缺陷导致SQL注入一枚", "wybug_corp": "shop-builder.cn", "wybug_author": "屎蛋", "wybug_date": "2014-08-27 11:41", "wybug_open_date": "2014-11-22 11:42", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-01：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-22：\t细节向公众公开  简要描述： 代码缺陷，缺乏过滤 详细说明：  问题代码存在convertip.php文件中getip函数通过$_SERVER['HTTP_X_FORWARDED_FOR']))获取ip,可被用户控制造成注入\n/**获取ＩＰ**/function getip(){    if (isset($_SERVER))    {    if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {       $realip = $_SERVER['HTTP_X_FORWARDED_FOR'];     } elseif (isset($_SERVER['HTTP_CLIENT_IP'])) {       $realip = $_SERVER['HTTP_CLIENT_IP'];    } else {       $realip = $_SERVER['REMOTE_ADDR'];    }    } else {    if (getenv(\"HTTP_X_FORWARDED_FOR\")) {       $realip = getenv( \"HTTP_X_FORWARDED_FOR\");    } elseif (getenv(\"HTTP_CLIENT_IP\")) {       $realip = getenv(\"HTTP_CLIENT_IP\");    } else {       $realip = getenv(\"REMOTE_ADDR\");    }    }    return $realip;\n在smarty_config.php中调用getip函数并统计来访ip入库\nif($config['openstatistics']){    if(!isrobot())    {        global $db;        $user=empty($_COOKIE['USER'])?NULL:$_COOKIE['USER'];        $time=date(\"Y-m-d H:i:s\");        $ip=getip();        $sql=\"insert into \".PV.\"        (url,ip,time,username,fileName)        values        ('\".substr(urlencode($_SERVER['REQUEST_URI']),0,30).\"','$ip','$time','$user','\".substr($_SERVER['SCRIPT_NAME'],0,30).\"')\";  //入库        $db->query($sql);\n   漏洞证明：  官网demo测试\n\n   修复方案：  使用其他方法来获取Ip，必须时做好过滤。   版权声明：转载请注明来源 屎蛋@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-11-22 11:42 厂商回复： CNVD未在实例上确认，先根据代码分析确认，暂未建立与软件生产厂商的联系渠道，待认领，同时先行确认，建议第三方厂商提供安全防护措施。 漏洞Rank：11  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-17 22:48 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n   WooYun: ShopBuilder商城 v5.6.1 sql注入#2 一样的。来个解释，？ @xsser @疯狗    \n     2014-08-18 12:32 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @roker 转为厂商认领，联系到最终处理企业进行评分确认。    \n     2014-08-18 13:21 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  @疯狗 @屎蛋 感觉我会被洞主打死。。。    \n     2014-08-18 13:25 |    \t\t屎蛋 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | boom)\t\t \n  @roker 我也不清楚，但是看时间我好像是提前提交一会的    \n     2014-08-18 13:57 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  你是提前审核。编码是提交时间我是 067088.    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}