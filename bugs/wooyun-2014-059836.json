{"id": 55825, "wybug_id": "wooyun-2014-059836", "wybug_title": "Tipask问答系统可修改他人回答（官方Demo成功）", "wybug_corp": "Tipask", "wybug_author": "飞黎", "wybug_date": "2014-05-08 17:30", "wybug_open_date": "2014-08-06 17:32", "wybug_type": "非授权访问/权限绕过", "wybug_level": "低", "wybug_rank_0": "13", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "越权操作", "认证设计不合理", "平行权限"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-08：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-08-06：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Tipask一处越权操作可非法操作他人回答 详细说明：  首先盯紧目标回答，比如这个问题的第一个回答：http://help.tipask.com/q-19260.html\n\nF12看一下评论按钮的链接，搞到回答的ID：\n\nID是3608，然后访问：http://help.tipask.com/question/editanswer/3608/0.html\n\n提交之，修改成功：\n\n----------------------------------\n问题出在： control/question.phpline323:    function oneditanswer() {        $navtitle = '修改回答';        $aid = $this->get[2] ? $this->get[2] : $this->post['aid'];        $answer = $_ENV['answer']->get($aid);        (!$answer) && $this->message(\"回答不存在或已被删除！\", \"STOP\");        $question = $_ENV['question']->get($answer['qid']);        $navlist = $_ENV['category']->get_navigation($question['cid'], true);        if (isset($this->post['submit'])) {            $content = $this->post['content'];            $viewurl = urlmap('question/view/' . $question['id'], 2);            //检查审核和内容外部URL过滤            $status = intval(2 != (2 & $this->setting['verify_question']));            $allow = $this->setting['allow_outer'];            if (3 != $allow && has_outer($content)) {                0 == $allow && $this->message(\"内容包含外部链接，发布失败!\", $viewurl);                1 == $allow && $status = 0;                2 == $allow && $content = filter_outer($content);            }            //检查违禁词            $contentarray = checkwords($content);            1 == $contentarray[0] && $status = 0;            2 == $contentarray[0] && $this->message(\"内容包含非法关键词，发布失败!\", $viewurl);            $content = $contentarray[1];            $_ENV['answer']->update_content($aid, $content, $status);            if (0 == $status) {                $this->message('修改回答成功！为了确保问答的质量，我们会对您的回答内容进行审核。请耐心等待......', $viewurl);            } else {                $this->message('修改回答成功！', $viewurl);            }        }        include template(\"editanswer\");    }\n\n在348行跳到 model/answer.class.php的：line138:    function update_content($aid, $content, $status = 0) {        $this->db->query(\"UPDATE `\" . DB_TABLEPRE . \"answer` set content='$content',status=$status  WHERE `id` =$aid\");    }\nsql语句没有判断userid就直接更新了回答内容，导致漏洞的产生   漏洞证明：  \n\n   修复方案：  判断要修改的回答是不是用户自己的   版权声明：转载请注明来源 飞黎@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-07-01 20:40 |    \t\t飞黎 \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:13        | 一个会写代码的产品经理)\t\t \n  @疯狗 早就45天了啊，咋没公开？    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}