{"id": 727, "wybug_id": "wooyun-2014-068226", "wybug_title": "模拟调试器结束金山毒霸进程", "wybug_corp": "金山毒霸", "wybug_author": "没有昵称", "wybug_date": "2014-07-15 11:39", "wybug_open_date": "2014-10-13 11:40", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["拒绝服务", "调试器", "附加"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-13：\t细节向公众公开  简要描述： 金山毒霸进程自我保护不足，恶意程序可以模拟调试器附加到其上并使其退出。 详细说明：  简单来说代码只有两行：GetProcessIdByName(L\"kxetray.exe\", &dwPID);DebugActiveProcess(dwPID);其中GetProcessIdByName只需用CreateToolhelp32Snapshot创建进程快照，并用Process32First和Process32Next遍历即可。DebugActiveProcess是API函数，其唯一参数是被调试进程的PID。我们只要不在退出前分离毒霸进程（被调试进程）就可以导致其退出。当然为了在其退出后继续运行，示例中采用了再运行一次自身的办法。源码、程序请见http://pan.baidu.com/s/1dDrJPWP。在Win8.1+VS2013+毒霸最新版下测试通过。   漏洞证明：  运行程序前：\n\n运行后：\n\n可以看到毒霸已经默默的退出了，但我们的程序（其实是被自身第二次运行的）正在运行。   修复方案：  防止被调试器附件的方法有很多，当然要和毒霸现有的防护方法融合。相信金山的大神可以解决，我就不班门弄斧了。   版权声明：转载请注明来源 没有昵称@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-07-16 09:25 厂商回复： 收到，我们将尽快跟进处理。不管评论怎么说，也算是存在一定的风险。我们愿意更谨慎。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-15 14:58 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  360一样可以被wdbg附加上，然后干掉。这算什么漏洞。    \n     2014-07-15 14:59 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  识别调试自己的是调试器还是恶意程序，不是一个简单活，也不是杀毒软件该做的事情。    \n     2014-07-15 15:52 |    \t\t没有昵称 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 学习为主)\t\t \n  @xsjswt 360附加不上，我刚刚试过。当然只试了最简单的附加方法    \n     2014-07-15 15:55 |    \t\t没有昵称 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 学习为主)\t\t \n  @xsjswt 你说的对，是比较困难。不过一般杀软没有配合被调试的需要，而且保证自己不被这种相对简单的办法干掉是很重要的。所以杀软应该避免自己被调试。至于公司内部怎么调试开发，肯定是有办法解决的    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}