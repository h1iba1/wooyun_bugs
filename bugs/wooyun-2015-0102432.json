{"id": 36183, "wybug_id": "wooyun-2015-0102432", "wybug_title": "易乐游留言板CSRF添加管理员", "wybug_corp": "yileyoo.com", "wybug_author": "路人甲", "wybug_date": "2015-03-30 09:53", "wybug_open_date": "2015-06-28 10:04", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-02：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-28：\t细节向公众公开  简要描述： 大量网吧在使用这个留言板 详细说明：  看到manager.inc.php\ncase 'addUser':    \t$username = strtolower(post('username'));    \t$password = post('password');    \t$roll = post('roll');    \tif($_SESSION[\"___isadmin\"]) {    \t\t$info = $db->SelectS('SELECT * FROM systemuser WHERE username=\"'.$username.'\"',1);\t\t\tif($info) {\t\t\t\techo 'UE';//用户名已存在\t\t\t}\t\t\telse {\t\t\t\tif($db->query(\"insert into systemuser(username,password,su,createtime) VALUES ('\".$username.\"','\".md5($password).\"',\".$roll.\",\".time().\")\")) {\t\t\t\t\t$lastInsertId = $db->insert_id();\t\t        \t$where = 'id='.$lastInsertId;\t\t        \t$lastData = $db->Select(array('where'=>$where));\t\t\t\t\t$lastData[0][\"createtime\"] = date(\"Y-m-d H:i\",$lastData[0][\"createtime\"]);\t\t        \techo json_encode($lastData[0]);\t\t        \texit;\t    \t\t}\n在添加管理员的时候没有防御CSRF。对于一款留言板的软件，CSRF的威力还是挺大的。在留言位置直接挂上我们的页面。坐等管理员点击。首先我们先留个言。\n\n管理员审核，访问之后。\n\n可以看到，多了一个超级用户。\n\n然后进入后台就可以getshell了。同样也可以CSRF修改管理员密码。poc可见测试代码。   漏洞证明：  \n\n   修复方案：  加个token   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-03-30 10:03 厂商回复： 本漏洞确实会给网吧带来一定的风险，造成普通用户可以通过非法手段添加管理员的目的，目前我们已经着手处理，并尽快更新发布。 最新状态： 2015-06-29：本漏洞已经处理，并发布更新。  ", "replys": "漏洞评价：\n评论\n     2015-03-30 10:03 |    \t\t湖北盛天网络技术股份有限公司(乌云厂商)\t\t \n  非常感谢反馈，我们已经着手处理。    \n     2015-07-23 13:08 |    \t\t你大爷在此 百无禁忌 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:6        | Hello 各位小伙伴们 大家好 我是王尼玛)\t\t \n  易乐游2.0没法后台getshell    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}