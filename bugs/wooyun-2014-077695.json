{"id": 48477, "wybug_id": "wooyun-2014-077695", "wybug_title": "大汉版通系统文件上传无限制getshell", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "路人甲", "wybug_date": "2014-09-30 17:20", "wybug_open_date": "2014-12-26 17:22", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "任意文件写入利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-05：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-26：\t细节向公众公开  简要描述： 这系统貌似还没有人提交getshell的. 详细说明：  有些国家部委也在用这系统， @南京大汉网络有限公司 你们看着办吧.0x01 漏洞的文件/lm/sys/opr_uploadimg.jsp造成漏洞的部分代码\nif(action.equals(\"upload\")){\t\t//构造上传类，传入上传的路径\t\tCommonUploadFile upload = new CommonUploadFile( strDictionary);\t\t \t\tupload.setM_nLimitsize(50);\t\t//设置文件总大小\t\tupload.setM_nFilesize(10);\t\t//设置单个文件大小\t\tupload.setM_filetype(\"gif\");\t//设置允许上传文件类型\t\t//上传操作\t\tboolean b = upload.uploadFile(request);\t\tConvert c = new Convert();\t\t//上传成功\t\tif(b){\t\t\tout.println(\"<br>上传成功！\");\t\t\tString[] files = upload.getAllFileName();\t\t\t//打印文件名称\t\t\tfor (int i=0;i<files.length;i++){\t\t\t\tString filename = files[i];\t\t\t\tFile file = new File(strDictionary + filename);\t\t\t\t\tc.copyFile(strDictionary + filename,strDictionary_img+img);\t\t\t}\t\t}else{\t\t\tout.println(\"<br>上传失败，请检查文件大小和文件类型是否正确!\");\t\t}\t\tinfo += \"<script>top.buttomFrame.right_frame.location.reload();</script>\";\t}\n其实这段代码表面上看起来安全性还可以，通过upload.setM_filetype(\"gif\");\t//设置允许上传文件类型限制了只能上传gif格式的文件，然而该段代码却有一个严重的逻辑漏洞：c.copyFile(strDictionary + filename,strDictionary_img+img);将上传的gif文件通过copyFile函数copy 到strDictionary_img+img，来看看img参数是怎么来的String img  = request.getParameter(\"img\");很明显是用户提交的参数，那么用户提交img = XXXXX.jsp shell不就到手了0x02 漏洞证明打开http://www.xxxx.gov.cn//lm/sys/opr_uploadimg.jsp上传任意gif文件，抓包修改img参数，如下\n\n点击GO,即可在images 目录下生成shell.jsp,可成功连接：\n\n   漏洞证明：  成功获取到的shell\n\n   修复方案：  copy干嘛呢?   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-26 17:22 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-30 18:06 |    \t\tbacktrack丶yao \t\t\t( 普通白帽子  |\t\t\t        Rank:290 漏洞数:107        | \"><img src=x onerror=alert(666666);> <im...)\t\t \n  好像很厉害的样子    \n     2014-12-26 17:33 |    \t\t笨笨熊 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | PHPer)\t\t \n  无影响厂商忽略.....    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}