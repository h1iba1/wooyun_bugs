{"id": 16848, "wybug_id": "wooyun-2012-013491", "wybug_title": "ShopEx收货地址可任意查看修改删除", "wybug_corp": "ShopEx", "wybug_author": "Steven", "wybug_date": "2012-10-18 10:54", "wybug_open_date": "2012-10-23 10:54", "wybug_type": "非授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-10-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-10-23：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 普通会员登录网站后，通过恶意构造的URL可以实现对整个网站的收货地址查看、修改、和删除。造成用户敏感隐私泄漏和网站不必要的损失。 详细说明：  core/shop/controller/ctl.member.php文件\n//修改收货地址    function modifyReceiver($addrId){        $oMem = &$this->system->loadModel('member/member');        if($aRet = $oMem->getAddrById($addrId)){            $aRet['defOpt'] = array('0'=>__('否'), '1'=>__('是'));            $this->pagedata = $aRet;        }else{            $this->system->error(404);            exit;        }        $this->_output();    }    function saveRec(){        $this->begin($this->system->mkUrl('member','modifyReceiver',array($_POST['addr_id'])));        $oMem = &$this->system->loadModel('member/member');        if($oMem->saveRec($_POST,$this->member['member_id'],$message)){            $this->redirect('member','receiver');        }        trigger_error($message, E_USER_ERROR);        $this->end(false,__('修改失败'),$this->system->mkUrl('member','modifyReceiver',array($_POST['addr_id'])));    }    //删除收货地址    function delRec($addrId){        $oMem = &$this->system->loadModel('member/member');        if($oMem->delRec($addrId)){            $this->redirect('member','receiver');        }        $this->_output();    }\n以上三个函数没有对所修改的地址所属用户ID进行判断，造成用户信息泄漏和安全隐患。   漏洞证明：  打开任意shopex4.85网站，注册会员登录后，修改以下URL中的ID属性/?member-21-modifyReceiver.html 可显示和修改其他用户的地址/?member-21-delRec.html  可删除其他用户的地址   修复方案：  函数添加对用户ID的判断\n//修改收货地址    function modifyReceiver($addrId){        $oMem = &$this->system->loadModel('member/member');\t\t        if($aRet = $oMem->getAddrById($addrId)){\t\t\t\t if($aRet['member_id']!=$this->member['member_id']){\t\t\t\t $this->system->error(404);           \t\t exit;\t\t\t }else{\t\t\t\t$aRet['defOpt'] = array('0'=>__('否'), '1'=>__('是'));\t\t\t\t$this->pagedata = $aRet;\t\t\t }        }else{            $this->system->error(404);            exit;        }        $this->_output();    }    function saveRec(){        $this->begin($this->system->mkUrl('member','modifyReceiver',array($_POST['addr_id'])));        $oMem = &$this->system->loadModel('member/member');        foreach($_POST as $ke=>$ve){            $_POST[$ke] = strip_tags($ve);        }\t\tif($aRet = $oMem->getAddrById($_POST['addr_id'])){\t\t\t  if($aRet['member_id']!=$this->member['member_id']){\t\t\t\t $this->system->error(404);           \t\t exit;\t\t\t}\t\t}        if($oMem->saveRec($_POST,$this->member['member_id'],$message)){            $this->redirect('member','receiver');        }        trigger_error($message, E_USER_ERROR);        $this->end(false,__('修改失败'),$this->system->mkUrl('member','modifyReceiver',array($_POST['addr_id'])));    }    //删除收货地址    function delRec($addrId){        $oMem = &$this->system->loadModel('member/member');\t\tif($aRet = $oMem->getAddrById($_POST['addr_id'])){\t\t\t  if($aRet['member_id']!=$this->member['member_id']){\t\t\t\t $this->system->error(404);           \t\t exit;\t\t\t}\t\t}        if($oMem->delRec($addrId)){            $this->redirect('member','receiver');        }        $this->_output();    }\n   版权声明：转载请注明来源 Steven@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2012-10-23 10:54 厂商回复：  最新状态： 2012-10-23： 额。。貌似没收到通知邮件不好意思。这个问题一直存在，在修改感谢您的提交非常感谢  ", "replys": "漏洞评价：\n评论\n     2012-10-18 16:42 |    \t\t陌路 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:5        | 安全爱好者！)\t\t \n  跟前几天那漏洞差不多..    \n     2012-10-20 17:57 |    \t\tSteven \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 致力互联网技术发展与网络安全,网站安全检...)\t\t \n  下載官方的最新補丁包打上後，此漏洞仍然存在。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}