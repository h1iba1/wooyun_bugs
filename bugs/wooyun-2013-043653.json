{"id": 6922, "wybug_id": "wooyun-2013-043653", "wybug_title": "钱方支付继续getshell", "wybug_corp": "北京钱方互动科技有限公司", "wybug_author": "瘦蛟舞", "wybug_date": "2013-11-22 11:00", "wybug_open_date": "2014-01-06 11:00", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-12-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-12-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-12-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-01-06：\t细节向公众公开  简要描述： 2013-11-21：最终确认由第三方wp主题造成，昨日下午已修复！我晕倒，密码不改，shell不删，就升级了下wordpress。 详细说明：  1.厂商对此漏洞理解有些误差，仅对wp进行了升级。管理员密码没有修改依旧可以进入。\n\n2.这个漏洞主要问题是人员安全意识不足存在弱口令和wp后台审核机制也不是很完善，攻击可以利用比如wpscan对应用进行自动化攻击。3.上次的木马还在，shell都不删可见厂商对安全的理解还非常不充分。那估计就更没有分析日志了，害我瞎忙删日志，浪费时间。\n\n   漏洞证明：  部分nginx配置文件，同服下很多网站均可以控制。\nserver {        listen       80;        server_name  bbs.qfpay.com;    \taccess_log /home/qfpay/nginx/logs/bbs_access.log;\terror_log /home/qfpay/nginx/logs/bbs_error.log;\t\t        location / {            fastcgi_pass unix:/home/qfpay/www/qfbbs/web.sock;            fastcgi_param REQUEST_METHOD $request_method;            fastcgi_param QUERY_STRING $query_string;            fastcgi_param CONTENT_TYPE $content_type;            fastcgi_param CONTENT_LENGTH $content_length;            fastcgi_param GATEWAY_INTERFACE CGI/1.1;            fastcgi_param SERVER_SOFTWARE nginx/$nginx_version;            fastcgi_param REMOTE_ADDR $remote_addr;            fastcgi_param REMOTE_PORT $remote_port;            fastcgi_param SERVER_ADDR $server_addr;            fastcgi_param SERVER_PORT $server_port;            fastcgi_param SERVER_NAME $server_name;            fastcgi_param SERVER_PROTOCOL $server_protocol;            fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;            fastcgi_param PATH_INFO $fastcgi_script_name;                 }        \tlocation ~^/static {                root /home/qfpay/www/bbs_static;                expires 24h;                access_log on;                }#\tlocation ~^/static/admin {#                root /home/qfpay/www/bbs_new/qfbbs/static/media;#                expires 24h;#                access_log on;#                }        \t    error_page   500 502 503 504  /50x.html;            location = /50x.html {            root   html;                }        }\tserver {\t\tlisten     80;\t\tserver_name\twww.qfpay.com www.qfsyb.com;\t\troot /home/qfpay/www/wordpress;        access_log /home/qfpay/nginx/logs/www_access.log;        error_log /home/qfpay/nginx/logs/www_error.log;\t\tindex index.php index.html;\t\tlocation /nginx_status {                \tstub_status on;                \taccess_log   off;                \tallow all;\t\t}\t\tlocation / {\t\t\tif (!-e $request_filename){\t\t\t\trewrite (.*) /index.php;\t\t\t}\t\t}\t\tlocation ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$ {\t\t\texpires 30d;\t\t}   \t\tlocation ~ .*\\.(js|css) {\t\t\texpires 10d;\t\t}\t\tlocation /wp-content {\t\t\taccess_log  off;\t\t}   \t\tlocation ~ \\.php$ {\t\t\tfastcgi_index  index.php;\t\t\tfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\t\t\tfastcgi_pass   127.0.0.1:9009;\t\t\tfastcgi_intercept_errors on;\t\t\tinclude      fastcgi_params;\t\t}\t}\tserver {\t\tlisten 80;\t\tserver_name app.qfsyb.com;        access_log /home/qfpay/nginx/logs/appqfsyb_access.log;        error_log /home/qfpay/nginx/logs/appqfsyb_error.log;\t\t\t\tlocation / {\t\t    root /home/qfpay/www/qfsyb;\t\t    index mobile/index.html;\t\t}\t\tlocation /app {\t\t\troot /home/qfpay/app2;\t\t}\t}\n除了本地mysql外，内网还有其他mysql数据库，数个数据库用户信息泄漏风险\n\n备份数据库\n\napp可以替换为恶意应用\n\n   修复方案：  1.对人员进行安全培训2.加强密码强度3.wp后台设置访问控制，如再加入basic认证或者直接外网不能访问后台。4.服务器权限合理设置，如nginx用户不应能访问配置数据库文件。5.定期审核日志   版权声明：转载请注明来源 瘦蛟舞@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-11-23 19:14 厂商回复： 会对wp等漏洞建议进行逐项整改 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-11-22 11:06 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  额    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}