{"id": 58282, "wybug_id": "wooyun-2014-051735", "wybug_title": "XDcms Sql Injection 29-50", "wybug_corp": "www.xdcms.cn", "wybug_author": "HackBraid", "wybug_date": "2014-02-25 14:44", "wybug_open_date": "2014-05-23 14:45", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "6", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射", "源码审核", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-07：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-05-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-23：\t细节向公众公开  简要描述： Sql Injection 详细说明：  注入在XDCMS企业管理系统后台的栏目添加处，\\system\\modules\\xdcms\\category.php文件：管理员在添加栏目和编辑栏目的时候会分别调用add_save()和edit_save()函数，三个注入点就出现在这两个函数里：add_save()函数,11个注入点：\npublic function add_save(){\t\t$config=base::load_cache(\"cache_set_config\",\"_config\");\t\t$catname=safe_html($_POST['catname']);//注入点1，大写可绕过\t\t$catdir=$_POST['catdir'];//注入点2\t\t$thumb=safe_html($_POST['thumb']);//注入点3，大写可绕过\t\t$is_link=intval($_POST['is_link']);\t\t$url=$_POST['url'];//注入点4\t\t$model=safe_html($_POST['model']);//注入点5，大写可绕过\t\t$sort=intval($_POST['sort']);\t\t$is_show=intval($_POST['is_show']);\t\t$parentid=intval($_POST['parentid']);\t\t$is_target=intval($_POST['is_target']);\t\t$is_html=intval($_POST['is_html']);\t\t$template_cate=safe_html($_POST['template_cate']);//注入点6，大写可绕过\t\t$template_list=safe_html($_POST['template_list']);//注入点7，大写可绕过\t\t$template_show=safe_html($_POST['template_show']);//注入点8，大写可绕过\t\t$seo_title=safe_html($_POST['seo_title']);//注入点9，大写可绕过\t\t$seo_key=safe_html($_POST['seo_key']);//注入点10，大写可绕过\t\t$seo_des=safe_html($_POST['seo_des']);//注入点11，大写可绕过\t\t$url_list=intval($_POST['url_list']);\t\t$url_show=intval($_POST['url_show']);\t\t$modelid=modelid($model);\t\t$power=addslashes(var_export($_POST['power'],true));\t\t$lang=isset($_POST['lang'])?intval($_POST['lang']):1;\t\t$pagesize=intval($_POST['pagesize']);\t\t\t\tif(empty($catname)||empty($catdir)||empty($model)||empty($pagesize)){\t\t\tshowmsg(C('material_not_complete'),'-1');\t\t}\t\t\t\tif(!check_str($catdir,'/^[a-z0-9][a-z0-9]*$/')){\t\t\tshowmsg(C('catdir').C('numbers_and_letters'),'-1');\t\t}\t\t\t\tif($is_html==1){\t\t\tif($config['createhtml']!=1){\t\t\t\tshowmsg(C('config_html_error'),'index.php?m=xdcms&c=setting');\t\t\t}\t\t}\t\t\t\t$nums=$this->mysql->db_num(\"category\",\"catdir='\".$catdir.\"'\");\t\tif($nums>0){\t\t\tshowmsg(C('catdir_exist'),'-1');\t\t}\t\t\t\t$sql=\"insert into \".DB_PRE.\"category (catname,catdir,thumb,is_link,url,model,modelid,sort,is_show,is_target,is_html,template_cate,template_list,parentid,template_show,seo_title,seo_key,seo_des,power,lang,url_list,url_show,pagesize) values ('\".$catname.\"','\".$catdir.\"','\".$thumb.\"','\".$is_link.\"','\".$url.\"','\".$model.\"','\".$modelid.\"','\".$sort.\"','\".$is_show.\"','\".$is_target.\"','\".$is_html.\"','\".$template_cate.\"','\".$template_list.\"','\".$parentid.\"','\".$template_show.\"','\".$seo_title.\"','\".$seo_key.\"','\".$seo_des.\"','\".$power.\"','\".$lang.\"','\".$url_list.\"','\".$url_show.\"','\".$pagesize.\"')\";\t\t$this->mysql->query($sql);\t\t$catid=$this->mysql->insert_id();\t\t\t\tif($is_link==0){//生成url\t\t\t$ob_url=base::load_class(\"url\");\t\t\t$url=$ob_url->caturl($catid,$catdir,$is_html,0,$lang,$url_list);\t\t\t$this->mysql->db_update(\"category\",\"`url`='\".$url.\"'\",\"`catid`=\".$catid);\t\t}\t\t\t\t$this->category_cache();\t\tshowmsg(C('add_success'),'-1');\t}\nedit_save()函数有11个注入点：\npublic function edit_save(){\t\t$config=base::load_cache(\"cache_set_config\",\"_config\");\t\t$catid=intval($_POST['catid']);\t\t$catname=safe_html($_POST['catname']);//注入点1，大写可绕过\t\t$catdir=$_POST['catdir'];//注入点2\t\t$thumb=safe_html($_POST['thumb']);//注入点3，大写可绕过\t\t$is_link=intval($_POST['is_link']);\t\t$url=$_POST['url'];//注入点4\t\t$sort=intval($_POST['sort']);\t\t$is_show=intval($_POST['is_show']);\t\t$parentid=intval($_POST['parentid']);\t\t$is_target=intval($_POST['is_target']);\t\t$is_html=intval($_POST['is_html']);\t\t$template_cate=safe_html($_POST['template_cate']);//注入点5，大写可绕过\t\t$template_list=safe_html($_POST['template_list']);//注入点6，大写可绕过\t\t$template_show=safe_html($_POST['template_show']);//注入点7，大写可绕过\t\t$seo_title=safe_html($_POST['seo_title']);//注入点8，大写可绕过\t\t$seo_key=safe_html($_POST['seo_key']);//注入点9，大写可绕过\t\t$seo_des=safe_html($_POST['seo_des']);//注入点10，大写可绕过\t\t$url_list=intval($_POST['url_list']);\t\t$url_show=intval($_POST['url_show']);\t\t$model=safe_html($_POST['model']);//注入点11，大写可绕过\t\t$modelid=modelid($model);\t\t$power=addslashes(var_export($_POST['power'],true));\t\t$lang=isset($_POST['lang'])?intval($_POST['lang']):1;\t\t$pagesize=intval($_POST['pagesize']);\t\t\t\tif(empty($catname)||empty($catdir)||empty($catid)||empty($pagesize)){\t\t\tshowmsg(C('material_not_complete'),'-1');\t\t}\t\t\t\tif(!check_str($catdir,'/^[a-z0-9][a-z0-9]*$/')){\t\t\tshowmsg(C('catdir').C('numbers_and_letters'),'-1');\t\t}\t\t\t\tif($is_html==1){\t\t\tif($config['createhtml']!=1){\t\t\t\tshowmsg(C('config_html_error'),'index.php?m=xdcms&c=setting');\t\t\t}\t\t}\t\t\t\t$nums=$this->mysql->db_num(\"category\",\"catdir='\".$catdir.\"' and catid!=\".$catid);\t\tif($nums>0){\t\t\tshowmsg(C('catdir_exist'),'-1');\t\t}\t\t\t\t//判断栏目是否有数据，否则不予更改模型\t\t$rs=$this->mysql->get_one(\"select catid,model from \".DB_PRE.\"category where `catid`=\".$catid);\t\tif($rs['model']!=$model){\t\t\t$catnum=$this->mysql->db_num($rs['model'],\"catid=\".$catid);\t\t\tif($catnum>0){\t\t\t\tshowmsg(C('category_have_data'),'-1');\t\t\t}\t\t}\t\t\t\tif($is_link==0){   //生成url\t\t\t$ob_url=base::load_class(\"url\");\t\t\t$url=$ob_url->caturl($catid,$catdir,$is_html,0,$lang,$url_list);\t\t}\t\t\t\t$this->mysql->db_update(\"category\",\"`catname`='\".$catname.\"',`catdir`='\".$catdir.\"',`thumb`='\".$thumb.\"',`is_link`='\".$is_link.\"',`url`='\".$url.\"',`sort`='\".$sort.\"',`is_show`='\".$is_show.\"',`is_target`='\".$is_target.\"',`is_html`='\".$is_html.\"',`parentid`='\".$parentid.\"',`template_cate`='\".$template_cate.\"',`template_list`='\".$template_list.\"',`template_show`='\".$template_show.\"',`seo_title`='\".$seo_title.\"',`seo_key`='\".$seo_key.\"',`seo_des`='\".$seo_des.\"',`power`='\".$power.\"',`lang`='\".$lang.\"',`model`='\".$model.\"',`modelid`='\".$modelid.\"',`url_list`='\".$url_list.\"',`url_show`='\".$url_show.\"',`pagesize`='\".$pagesize.\"'\",\"`catid`=\".$catid);\t\t$this->category_cache();\t\tshowmsg(C('update_success'),'index.php?m=xdcms&c=category');\t}\nsort_save()函数包含1处注入点：\npublic function sort_save(){\t\t$catid=$_POST['catid'];//未过滤\t\tforeach($catid as $val){\t\t\t$sort=$_POST[\"sort{$val}\"];\t\t\tif(is_numeric($sort)){\t\t\t\t$this->mysql->db_update(\"category\",\"`sort`='\".$sort.\"'\",\"`catid`=\".$val);\t\t\t}\t\t}\t\t$this->category_cache();\t\tshowmsg(C('update_success'),'index.php?m=xdcms&c=category');\t}\n   漏洞证明：  添加栏目处以catname为例，点击栏目添加：\n\n抓包添加exp：\n\n成功！：\n\n   修复方案：  过滤！   版权声明：转载请注明来源 HackBraid@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-05-23 14:45 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}