{"id": 8591, "wybug_id": "wooyun-2013-033072", "wybug_title": "JEEBBS v3.0 一处逻辑漏洞和一处定向XSS", "wybug_corp": "JEECMS", "wybug_author": "园长", "wybug_date": "2013-07-31 23:10", "wybug_open_date": "2013-10-29 23:11", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "6", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-07-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-09-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-10-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-10-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-10-29：\t细节向公众公开  简要描述： 两个两个一起发吧，凑一对。Jeebbs 一处逻辑漏洞和一处定向XSS。轻易的获取对方cookie...明文密码...  详细说明：  Jeebbs基本上都没有判断referer，没有token，可造成csrf。1、不科学的积分漏洞积分兑换方法如下：\n@RequestMapping(value = \"/member/creditExchange.jspx\")\tpublic void creditExchange(Integer creditIn, Integer creditOut,\t\t\tInteger creditOutType, Integer miniBalance, String password,\t\t\tHttpServletRequest request, HttpServletResponse response) {}\n可以看到这里直接用了SpringMvc注入参数，而这些参数恰恰是控制程序逻辑的关键。比如构建如下URL，通过GET或者POST方式都能恶意修改用户的积分：http://localhost/jeebbs/member/creditExchange.jspx?creditIn=26&creditOut=-27600&creditOutType=1&miniBalance=-10000000&password=wooyun因为他的逻辑是这么写的：\nif(user.getPoint()-creditOut>miniBalance){    balance=true;}else{    flag=1;}\n从User对象里面取出积分的数值，而积分兑换威望具体需要多少是在确定兑换关系后由ajax去后台计算出来的，提交的时候也没有验证计算的结果有没有被客户端改过。其中的creditOut和miniBalance都是我们可控的。所以这个等式不管在什么情况下我们都可以让它成立。Cookie不加密我的明文密码又出来晒太阳了。\n\n\n\n2、打招呼XSS\n\n逻辑有做判断：1、用户名为空。2、不允许发送消息给自己。3、用户名不存在。在控制层并没有做过滤：\n\n    在调用com.jeecms.bbs.manager.impl. BbsMessageMngImpl.java的sendMsg方法的时候依旧没有过滤。到最终的BbsMessageDaoImpl 的save方法还是没有过滤就直接储存了;一般性的做法，关系到用户交互的地方最好做referer和xss过滤检测，控制层负责收集数据的同时最好处理下用户的请求，就算controller不处理起码在service层做下处理吧。\n\n   漏洞证明：  \n\n\n\n   修复方案：  修改下逻辑验证，不要信任客户端传递的参数。   版权声明：转载请注明来源 园长@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2013-08-01 15:44 厂商回复： 感谢对jeecms系列软件提供漏洞信息，我们会在本周内修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-08-01 07:41 |    \t\tBlueheart \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 路人甲乙丙丁)\t\t \n  园长你又调皮了，捅人家菊花一次就算了，还一日三次！    \n     2013-08-01 09:54 |    \t\t园长 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:14        | 你在身边就是缘，缘分写在数据库里面。)\t\t \n  @Blueheart 没办法工作压力太大，捅捅菊花解解闷。    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}