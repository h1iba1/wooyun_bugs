{"id": 8714, "wybug_id": "wooyun-2013-036663", "wybug_title": "敏感信息泄露系列#1 系统管理员运维不当导致唱吧3000万+用户信息告急", "wybug_corp": "Changba-inc", "wybug_author": "猪猪侠", "wybug_date": "2013-09-10 14:07", "wybug_open_date": "2013-10-25 14:08", "wybug_type": "重要敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露", "源码泄漏", "文件泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-09-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-09-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-09-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-09-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-10-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-10-25：\t细节向公众公开  简要描述： 有时候，一个微不足道的信息泄露问题就能造成整个企业安全的崩盘。#安全需要顾全整体# 详细说明：  #1 信息泄露源由于唱吧主站服务器WEB服务端配置缺陷，以及开发人员代码上线安全意识不足，直接将版本控制软件SVN所残留的信息发布到了线上。 WooYun: Changba-inc唱吧svn敏感信息泄露 白帽子曾经报告过一个svn信息泄露威胁，但唱吧的修复方案只是简单的针对http://访问源进行了限制，而对https的配置并未生效，导致仍然存在缺陷。https://changba.com/.svn/entries#2 写个自动化工具扫描，并爬行泄露的源码\nsvn_disclosure.py https://changba.com /******************************************* Fetching: https://changba.com* mkdir changba.com* http://www.kulv.com/repos/kulv/KTV/www* http://www.kulv.com/repos/kulv******************************************DIR: \\DIR: \\helpDIR: \\commonDIR: \\cssDIR: \\voiceofchinaDIR: \\banzouDIR: \\incomingDIR: \\personcenterDIR: \\TwigDIR: \\paymentDIR: \\activityDIR: \\fmDIR: \\memberDIR: \\exportsongDIR: \\gameDIR: \\jsDIR: \\newindexDIR: \\competitionDIR: \\rulesDIR: \\accountDIR: \\viewsDIR: \\historyDIR: \\signupDIR: \\cashoutDIR: \\datePickerDIR: \\gamesDIR: \\anniversaryDIR: \\yunyingDIR: \\imagesDIR: \\agreementDIR: \\data******************************************FILE: \\mobsong_notfound.htmlFILE: \\competition_controller.phpFILE: \\crontab_share_activity_statistics.phpFILE: \\d.htmlFILE: \\crontab_make_songindex_db.phpFILE: \\index.htmlFILE: \\wochangba.phpFILE: \\appstore.phpFILE: \\banner_area.phpFILE: \\CompetitionMain.phpFILE: \\yunying.phpFILE: \\help.htmlFILE: \\question.phpFILE: \\pcsong_notfound.htmlFILE: \\gamegift.phpFILE: \\redirect_index.phpFILE: \\Activity_Mem.phpFILE: \\stats.phpFILE: \\buy.phpFILE: \\static_activity_page.phpFILE: \\recommond.htmlFILE: \\mindex.htmlFILE: \\activity_new.phpFILE: \\makerecommenduser.phpFILE: \\activity_ios.phpFILE: \\contact.htmlFILE: \\qqvipgift.phpFILE: \\policy.htmlFILE: \\old_index.htmlFILE: \\crontab_share_activity_statistics2.phpFILE: \\updateapp.phpFILE: \\activity.phpFILE: \\qq_callback.phpFILE: \\Mobile_Detect.phpFILE: \\exchangecenter.htmlFILE: \\staticcompetition.phpFILE: \\gamegift1.phpFILE: \\alert.phpFILE: \\login.phpFILE: \\favicon.icoFILE: \\game.phpFILE: \\recommend.phpFILE: \\changba_unicom.htmlFILE: \\crontab_make_songlist_db.phpFILE: \\login_success.htmlFILE: \\guide_sing.phpFILE: \\gamehome.phpFILE: \\videotest.htmlFILE: \\activity_no_build.htmlFILE: \\download.htmlFILE: \\redirect_song.phpFILE: \\anzhuang.htmlFILE: \\RecommendMusicService.php******************************************Author: tianranAuthor: guotengAuthor: gaojieAuthor: luohongjianAuthor: liuyutongAuthor: wuhaiwenAuthor: xiaokai.zhanAuthor: zhouhaixuAuthor: ericAuthor: chenzhuoAuthor: kongmiaomiao******************************************\n#3 获取了源码，即可针对代码进行代码审计或其它漏洞挖掘\n\n#4 针对源码挖掘，发现其中一个上传漏洞\\competition\\common_functions.php  159行\n/** * 主办方上传授权协议 *  * @return 如果出错返回相应的errorcode */function uploadAgreement() {\t$result = array ();\tif (! isset ( $_FILES ['agreement'] ['name'] ) || empty ( $_FILES ['agreement'] ['name'] )) {\t\t$result ['errorcode'] = \"EMPTY\";\t} elseif ($_FILES [\"agreement\"] [\"error\"] > 0) {\t\t$result ['errorcode'] = \"FAIL\";\t} elseif (($_FILES [\"agreement\"] [\"size\"] / 1024) > 10240) {\t\t$result ['errorcode'] = \"EXCEED_SIZE\";\t} else {\t\t$fileDir = \"/home/wwwroot/www.changba.com/agreement/\";\t\tif (! file_exists ( $fileDir )) {\t\t\tmkdir ( $fileDir, 0777 );\t\t}\t\t$currentTimestamp = strtotime ( date ( \"Y-m-d H:i:s\" ) );\t\t$filename = $currentTimestamp . $_FILES [\"agreement\"] [\"name\"];\t\t$realPath = $fileDir . $filename;\t\tif (move_uploaded_file ( $_FILES [\"agreement\"] [\"tmp_name\"], $realPath )) {\t\t\t$result ['errorcode'] = \"OK\";\t\t\t$result ['filename'] = $filename;\t\t} else {\t\t\t$result ['errorcode'] = \"FAIL\";\t\t}\t}\treturn $result;}\n\n\n   漏洞证明：  #5 任意文件上传漏洞利用\n\n#6 查看数据库配置信息\n<?php// =============================// ======  纵切专用库  ===========// =============================/*mysql client 写数据库地址*/$config['ZuitaoKtvServer_client']['servername'] = '192.168.*.***';$config['ZuitaoKtvServer_client']['port'] = 3306;$config['ZuitaoKtvServer_client']['username'] = '******';$config['ZuitaoKtvServer_client']['password'] = 'PS***********94';$config['ZuitaoKtvServer_client']['pconnect'] = 0;$config['ZuitaoKtvServer_client']['dbname'] = 'changba_client';$config['ZuitaoKtvServer_client']['charset'] = 'utf8';/*mysql client 读数据库地址*/$config['ZuitaoKtvServer_client_read']['servername'] = '192.168.*.***';$config['ZuitaoKtvServer_client_read']['port'] = 3306;$config['ZuitaoKtvServer_client_read']['username'] = '****';$config['ZuitaoKtvServer_client_read']['password'] = 'PS***********94';$config['ZuitaoKtvServer_client_read']['pconnect'] = 0;$config['ZuitaoKtvServer_client_read']['dbname'] = 'changba_client';$config['ZuitaoKtvServer_client_read']['charset'] = 'utf8';\n   修复方案：  #1 漏洞修复方案修复完整#2 找专业安全人员代码审计#3 可以找乌云众测平台的白帽子们帮你们消灭掉存在的边界隐患   版权声明：转载请注明来源 猪猪侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-09-10 17:49 厂商回复： 记得上午已经确认了？不论如何，谢谢这位童鞋，请把联系方式告知我们，我们将作出感谢，并欢迎给出更多建议！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-09-10 14:08 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @猪猪侠 暴走了    \n     2013-09-10 14:16 |    \t\t冷静 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        )\t\t \n  我始终觉得你不是人    \n     2013-09-10 14:18 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  3000W!!!    \n     2013-09-10 14:21 |    \t\tlucky \t\t\t( 普通白帽子  |\t\t\t        Rank:409 漏洞数:84        | 三人行必有我师焉########################...)\t\t \n  我始终觉得你不是一个人在战斗！    \n     2013-09-10 14:26 |    \t\t虫子 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 小弟也是大学生)\t\t \n  其实我知道是谁    \n     2013-09-10 14:28 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2738 漏洞数:547        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  @ 猪猪侠 哪个google浏览器检测svn框架的插件是什么？  谢谢    \n     2013-09-10 14:30 |    \t\tMujj \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:4        | IDC商)\t\t \n  不怕人家又加你QQ找你咩    \n     2013-09-10 14:40 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  暴走拉...    \n     2013-09-10 14:41 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @爱上平顶山 自己写，就几个http请求判断这么简单。    \n     2013-09-10 14:44 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2738 漏洞数:547        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  @猪猪侠  厉害  呵。。   求发2250086856@qq.com  谢谢    \n     2013-09-10 14:44 |    \t\tfeng \t\t\t( 普通白帽子  |\t\t\t        Rank:664 漏洞数:79        | 想刷个6D)\t\t \n  猪哥v5,期待更多教学提帖    \n     2013-09-10 14:46 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  猪哥v5,期待更多教学提帖    \n     2013-09-10 15:21 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  求抱大腿。。    \n     2013-09-10 15:21 |    \t\twinsyk \t\t\t( 普通白帽子  |\t\t\t        Rank:108 漏洞数:16        | 越长大越孤单)\t\t \n  注册都注册不了，测试不了。。    \n     2013-09-10 15:55 |    \t\t小痞子 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:21        | <xss>alert(\"a\")</xss>￥&@&……dssKhwjcw...)\t\t \n   留名·    \n     2013-09-10 16:43 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:463 漏洞数:89        | 硬件与无线通信研究方向)\t\t \n  你不是一个人    \n     2013-09-10 18:04 |    \t\talso \t\t\t( 普通白帽子  |\t\t\t        Rank:424 漏洞数:52        | 招渗透/php/前端/ios&android安全，广州地...)\t\t \n  话说我前天刚下在这个软件，昨晚自个儿唱了一晚，哈哈，发现很难玩    \n     2013-09-10 19:03 |    \t\t低调的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:466 漏洞数:68        | loading……………………)\t\t \n  求欧弟、钱枫及各种女神的联系方式！！    \n     2013-09-10 22:07 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  有时候，一个微不足道的信息泄露问题就能造成整个企业安全的崩盘。    \n     2013-09-11 10:26 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  @低调的瘦子 屌丝气质尽显无疑。。。我只想说以后遇到这样的事情，记得叫上我。    \n     2013-09-11 13:22 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  @猪猪侠 求唱吧里面的那个ID：方大人 那个女神的联系方式    \n     2013-09-12 10:03 |    \t\texploits \t\t\t( 实习白帽子  |\t\t\t        Rank:69 漏洞数:17        | As We Do，As You Know !)\t\t \n  目测洞主已被查水表。    \n     2013-10-11 04:15 |    \t\talou \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | PHP屌丝一枚)\t\t \n  请把联系方式告知我们，我们将查水表    \n     2013-10-25 14:50 |    \t\t姿势不行 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:7        | 我是爱卖萌的小阿狸呀http://www.qinqinyo....)\t\t \n  唱吧不是装了安全保吗 能随便上传？？    \n     2013-10-25 17:38 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  @姿势不行 看来是挖出问题后买的服务！    \n     2013-12-03 09:22 |    \t\tice \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | inevitable...)\t\t \n  学习了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}