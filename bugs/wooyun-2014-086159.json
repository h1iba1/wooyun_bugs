{"id": 42304, "wybug_id": "wooyun-2014-086159", "wybug_title": "PHP云刷积分刷粉丝csrf两处", "wybug_corp": "php云人才系统", "wybug_author": "Ader_duo", "wybug_date": "2014-12-16 12:06", "wybug_open_date": "2015-01-22 12:08", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-21：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-22：\t细节向公众公开  简要描述： 版本v3.1   9.231.控制邀请面试的参数也就那么几个，自己可以构造，直接post方式提交就行，不用登陆，就能执行成功。另外邀请面试需要消耗积分2.关注。只有两个参数，关注人uid，被关注人id。可以关注公司也可以关注求职者 详细说明：  一。文件位置：/upload/model/ajax.class.php\nfunction sava_ajaxresume_action()\t{\t\t$data['uid']=(int)$_POST['uid'];//邀请面试人的uid\t\t$data['title']='面试邀请';\t\t$data['content']=iconv(\"utf-8\",\"gbk\",$_POST['content']);//邀请内容\t\t$data['fid']=$this->uid;\t\t$data['datetime']=time();\t\t$info['content']=$data['content'];\t\t$info['jobname']=iconv(\"utf-8\",\"gbk\",$_POST['jobname']);//邀请面试的职位\t\t$info['username']=iconv(\"utf-8\",\"gbk\",$_POST['username']);        $p_uid=(int)$_POST['uid'];\t\t$black=$this->obj->DB_select_once(\"blacklist\",\"`p_uid`='\".$p_uid.\"' and `c_uid`='\".$this->uid.\"'\");//查询面试人是不是在自己公司的黑名单\t\tif(!empty($black))\t\t{\t\t\t$arr['status']=8;\t\t\techo json_encode($arr);die;\t\t}\t\t$black=$this->obj->DB_select_once(\"blacklist\",\"`c_uid`='\".$p_uid.\"' and `p_uid`='\".$this->uid.\"'\");//查询公司在不在面试人的黑名单\t\tif(!empty($black))\t\t{\t\t\t$arr['status']=9;\t\t\techo json_encode($arr);die;\t\t}\t\tif(!$this->uid || !$this->username || $_COOKIE['usertype']!=2)//公司的uid，username都有值$usertype=2\t\t{\t\t\t$arr['status']=0;\t\t\techo json_encode($arr);die;\t\t}else{$umessage = $this->obj->DB_select_once(\"userid_msg\",\"`uid`='\".$p_uid.\"' AND `fid`='\".$this->uid.\"'\");//查询里面无\t\t\tif(is_array($umessage))\t\t\t{\t\t\t \t$arr['status']=7;\t\t\t}else{                               ：                               ：//前面条件满足才能发送面试邀请                         }\n综上：要想成功发邀请要满足的条件，1.互不在黑名单2.公司的uid，公司名称username都有值$usertype=23.个人的uid-面试人uid：注册时按照注册先后顺序自增的值，username-面试人姓名，jobname-申请职位不是说发送邀请没什么，是要花积分的，积分是需要公司自己充值的。二。文件位置：/upload/model/ajax.class.phpfunction Atn_action()这个函数。代码出现原理是一样的，不贴代码了只有两个参数可控，post提交可以关注再次提交取消关注。   漏洞证明：  一。1.登录公司账户查看邀请面试的人才\n\n是0个目前公司积分19764分\n\n2.退出登录，自己构造包且在无用户登录状态\n\n3.提交包\n\n目前公司积分19752分，少12积分\n\n4.登录公司账号\n\n成功，你想去什么公司可以自己构造给自己发面试邀请啊二。1.post内容只需两个参数，关注人uid，被关注人id。这两个参数都是注册时自增的值。\n\n2.用户33未关注11\n\n3.发post包。33关注11\n\n登录查看。已关注\n\n4.再次发   33取消关注11\n\n登录查看 。取消\n\n   修复方案：  参数太简单了，我看管理员后台有pytoken，前台也可以加上   版权声明：转载请注明来源 Ader_duo@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-01-22 12:08 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}