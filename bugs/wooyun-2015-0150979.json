{"id": 82463, "wybug_id": "wooyun-2015-0150979", "wybug_title": "Kingtrans物流管理系统&amp;Kingtrans客户服务系统均存在两处通用型DBA权限注入", "wybug_corp": "深圳市易宇通科技有限公司", "wybug_author": "路人甲", "wybug_date": "2015-11-02 09:41", "wybug_open_date": "2015-12-17 14:48", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-09：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： 可影响大量物流公司信息、包括运往国外的物流信息，DBA权限可直接shell。你懂得~ 详细说明：  官方部分案例：\nhttp://**.**.**.**/case/\n产品：Kingtrans物流管理系统、Kingtrans客户服务系统说明：1、前人似乎提交过类似的事件漏洞，但好像他根本不清楚这是一套通用？2、Kingtrans物流管理系统和Kingtrans客户服务系统是相互依存、同时存在的。3、系统分别为K5版(暂时这样叫)和标准版，并且K5版的客户服务系统和标准版的界面风格也不一致。4、虽然很多是同主域名的不同子域，但从官方给出的案例查找系统和对域名IP反查发现虽然是不同子域的但并非同一物流公司，所以是属于通用。5、两个不同版的物流管理系统和以及对应的客户服务系统都分别存在两处注入，6、案例请mask保护。：：在官方的case中：http://**.**.**.**/case/ 找三个站点：\nhttp://**.**.**.**/http://**.**.**.**/http://**.**.**.**/\n在上面的网站找网站中的“会员登录”处直接点登陆进去客户服务系统得到三个物流管理系统分别是：\n\nmask 区域\n1.http://**.**.**/  深圳市超时空国际货运代理有限公司_2.http://**.**.**/ 宁波海曙龙旺达货运代理有限公司_3.http://**.**.**/ 广州瞬通货运代理有限公司\n\n可以发现 虽然看起来是不同的子域，但是确实不同物流公司的系统；并且IP也不是同一个IP。SQL注入简要描述：\n1、K5版登陆处注入：POST /Logon?action=logon    userid联合查询注入POST数据：ifcookie=0&driveno=&macaddr=&userid=admin&password=aaa&Submit=%E7%99%BB%E5%BD%952、K5版对应的客户服务系统：POST /client/Logon?action=logon   userid报错注入POST数据：userid=kehu&password=aaaa3、K5版注册注入存在注入：POST /CUesrRegister?action=register  userid联合查询注入POST数据：userid=admin&password=111111&password_1=111111&corpid=123&clientname=aaaaa&totalname=bbbbb&regno=cccc&tel=dddd&faxno=&post=&website=&clientaddress=&pickaddr=eeee&contact=&qq=ffff&msn=&mobile=eeee&email=&othertel=&note=&checkname=1&Submit=%E6%B3%A8%E5%86%8C4、标准版登陆处注入：POST /Logon?action=logon    userid联合查询注入POST数据：txtMACAddr=&txtIPAddr=&txtDNSName=&userid=a&password=a5、标准版对应的客户服务系统注入：POST /client/Logon?action=logon   userid报错注入POST数据：userid=kehu&password=aaaa6、标准版的注册处存在注入：POST /data/CUesrRegister?action=register  userid延时注入POST数据：userid=admin&password=111111&corpshname=111111&corpname=1111&contcter=111111&telphone=11111&mphone=11111&email=11111%**.**.**.**&addr=111&Submit=%B1%A3%B4%E6\n案例：【分别列举了K5版、标准版的物流管理、客户服务系统】\n\nmask 区域\n*****管理系统：***********ca12234621e3a15e1c938e.jpg*****1.http://**.**.**/logon.jsp  官方demo_2.http://**.**.**/logon.jsp_3.http://**.**.**/logon.jsp_4.http://**.**.**/logon.jsp_5.://**.**.**/logon.jsp_6.http://**.**.**/logon.jsp_7.://**.**.**/logon.jsp_8.http://**.**.**/logon.jsp_9.http://**.**.**/logon.jsp_10.http://**.**.**/logon.jsp_11.http://**.**.**/logon.jsp_12.http://**.**.**/logon.jsp_13.http://**.**.**/logon.jsp_14.http://**.**.**/logon.jsp_15.http://**.**.**/logon.jsp_16.http://**.**.**/logon.jsp_17.http://**.**.**/logon.jsp_18.http://**.**.**/logon.jsp_19.http://**.**.**/logon.jsp_20.http://**.**.**/logon.jsp_21.http://**.**.**/logon.jsp_22.http://**.**.**/logon.jsp_23.http://**.**.**/logon.jsp_***********************************^^应的客户服务系统^**********72a1b21c9757d3c58f4fc4.jpg*****24.http://**.**.**/c_index.jsp_25.http://**.**.**/c_index.jsp_26.http://**.**.**/c_index.jsp_27.http://**.**.**/c_index.jsp_28.http://**.**.**/c_index.jsp_29.://**.**.**/c_index.jsp_30.http://**.**.**/c_index.jsp_31.http://**.**.**/c_index.jsp_32.http://**.**.**/c_index.jsp_33.http://**.**.**/c_index.jsp_34.http://**.**.**/c_index.jsp_35.http://**.**.**/c_index.jsp_36.http://**.**.**/c_index.jsp_37.http://**.**.**/c_index.jsp_38.http://**.**.**/c_index.jsp_39.http://**.**.**/c_index.jsp_40.http://**.**.**/c_index.jsp_41.http://**.**.**/c_index.jsp_*************************^^管理系统：**********454fc83231935e665a8f91.jpg*****42.://**.**.**/_43.://**.**.**/_44.://**.**.**/_45.://**.**.**/_46.://**.**.**/_47.://**.**.**/_48.://**.**.**/_49.://**.**.**/_******.*******50.://**.**.**/_51.http://**.**.**/_52.http://**.**.**/_53.http://**.**.**/_54.http://**.**.**/_55.http://**.**.**/_56.http://**.**.**/_57.http://**.**.**/_58.http://**.**.**/_59.http://**.**.**/_60.http://**.**.**/_61.http://**.**.**/_62.http://**.**.**/_63.http://**.**.**/_64.http://**.**.**/_65.http://**.**.**/_66.http://**.**.**/_67.http://**.**.**/_68.http://**.**.**/_69.http://**.**.**/_*************************所对应的客户服务**********a8752622d299915f25288c.jpg*****70.://**.**.**/client.jspretry_reason=PASSWORD_71.://**.**.**/client.jspretry_reason=PASSWORD_72.://**.**.**/client.jspretry_reason=PASSWORD_73.http://**.**.**/client.jspretry_reason=PASSWORD_74.://**.**.**/client.jspretry_reason=PASSWORD_75.http://**.**.**/client.jspretry_reason=PASSWORD_76.http://**.**.**/client.jspretry_reason=PASSWORD_77.http://**.**.**/c_index.jspretry_reason=PASSWORD_78.http://**.**.**/client.jspretry_reason=PASSWORD_79.http://**.**.**/client.jspretry_reason=PASSWORD_80.http://**.**.**/client.jspretry_reason=PASSWORD_81.http://**.**.**/client.jspretry_reason=PASSWORD_82.http://**.**.**/client.jspretry_reason=PASSWORD_83.http://**.**.**/client.jspretry_reason=PASSWORD_84.http://**.**.**/client.jspretry_reason=PASSWORD_85.http://**.**.**/client.jspretry_reason=PASSWORD_86.http://**.**.**/client.jspretry_reason=PASSWORD_87.http://**.**.**/daili/\n\n   漏洞证明：  【免责声明：详细说明与漏洞证明为漏洞报告非利用方式，漏洞将由厂商认领、修复或者提交给国家互联网应急中心进行通知厂商修复，本漏洞仅供证明漏洞存在未获取任何有效机密数据，案例仅供国家互联网应急中心测试使用，其它人不可利用该漏洞进行恶意破坏，否则后果自负，漏洞在厂商确认后均做打码处理】K5版证明：SQL注入一：K5版本物流管理系统、以及对应的客户管理系统登陆处都存在注入。\nPOST /Logon?action=logon HTTP/1.1Host: **.**.**.**Proxy-Connection: keep-aliveContent-Length: 77Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://**.**.**.**User-Agent: *****Content-Type: application/x-www-form-urlencodedReferer: http://**.**.**.**/logon.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: ifcookie=0&driveno=&macaddr=&userid=admin&password=aaa&Submit=%E7%99%BB%E5%BD%95\n\n漏洞证明：userid参数存在注入\n\n\n\nK5版对应的客户服务管理系统：\n\n\n\nPOST /client/Logon?action=logon HTTP/1.1Host: **.**.**.**Proxy-Connection: keep-aliveContent-Length: 25Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://**.**.**.**User-Agent: ***Content-Type: application/x-www-form-urlencodedReferer: http://**.**.**.**/c_index.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: userid=kehu&password=aaaa漏洞证明：userid存在注入，虽然是相互依存的系统，但可以看到对应的语句也不一样，前面是联合，这里可以是报错。\n\n\n\n\nSQL注入二：K5版的注册处存在注入\n/reg.jsp、或者/CUesrRegister?action=initReg\n\nPOST /CUesrRegister?action=register HTTP/1.1Host: **.**.**.**Proxy-Connection: keep-aliveContent-Length: 256Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://**.**.**.**User-Agent: ****Content-Type: application/x-www-form-urlencodedReferer: http://**.**.**.**/reg.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: userid=admin&password=111111&password_1=111111&corpid=123&clientname=aaaaa&totalname=bbbbb&regno=cccc&tel=dddd&faxno=&post=&website=&clientaddress=&pickaddr=eeee&contact=&qq=ffff&msn=&mobile=eeee&email=&othertel=&note=&checkname=1&Submit=%E6%B3%A8%E5%86%8C\n\n\n\n\n标准版证明：SQL注入一：标准版物流管理系统、以及对应的客户管理系统登陆处都存在注入。\n\n\n POST /Logon?action=logon HTTP/1.1Host: **.**.**.**Proxy-Connection: keep-aliveContent-Length: 55Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://**.**.**.**User-Agent: ****Content-Type: application/x-www-form-urlencodedReferer: http://**.**.**.**/Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: txtMACAddr=&txtIPAddr=&txtDNSName=&userid=a'&password=a漏洞证明：userid存在联合查询\n\n\n\n对应的客户服务系统也存在注入：\n\n\n\nPOST /client/Logon?action=logon HTTP/1.1Host: ***.**.**.**Proxy-Connection: keep-aliveContent-Length: 25Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://***.**.**.**User-Agent: ****Content-Type: application/x-www-form-urlencodedReferer: http://***.**.**.**/client.jsp?retry_reason=PASSWORDAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie:userid=kehu&password=aaaa漏洞证明：userid存在报错注入\n\n\n\n另外可以使用万能密码：大量发往国外的物流信息啊\n\n\n\n\nSQL注入二：标准版的注册处存在注入：\n标准版注册处存在注入： /reg.jsp\n\nPOST /data/CUesrRegister?action=register HTTP/1.1Host: **.**.**.**Proxy-Connection: keep-aliveContent-Length: 154Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://**.**.**.**User-Agent: ***Content-Type: application/x-www-form-urlencodedReferer: http://***.**.**.**/reg.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8userid=admin&password=111111&corpshname=111111&corpname=1111&contcter=111111&telphone=11111&mphone=11111&email=11111%**.**.**.**&addr=111&Submit=%B1%A3%B4%E6漏洞证明：userid仅支持延迟注入\n\n\n\n\n   修复方案：  写的好像很复杂？简单来说：两个不同版本的不同系统的登陆处和注册处都存在注入。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：14  确认时间：2015-11-06 17:50 厂商回复： 暂未建立与软件生产厂商单位的直接处置渠道,待认领. 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 14, "Ranks": null}