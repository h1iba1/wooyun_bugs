{"id": 65142, "wybug_id": "wooyun-2013-016761", "wybug_title": "[祝PKAV以及wooyun所有白帽子元旦快乐]anwsion缺陷大结合.", "wybug_corp": "anwsion.com", "wybug_author": "_Evil", "wybug_date": "2013-01-01 00:17", "wybug_open_date": "2013-02-15 00:18", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-01-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-01-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-01-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-01-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-02-15：\t细节向公众公开  简要描述： foreach处理不当爆路径,程序设置缺陷,绕过全局变量的包含----变量覆盖 详细说明：  (1).foreach处理不当爆路径\nhttp://wenda.anwsion.com/search/ajax/search_result/\n\n\n缺陷:\n<?php foreach ($this->search_result AS $key => $val)\n 代码没有检测$this->search_result是否为空,是否没数组....\\wenda\\views\\default\\inbox\\read_message.tpl.htm\n<?php foreach($this->list AS $key => $val) {\n缺陷一样.\n\n2)程序设置缺陷.\nhttp://wenda.anwsion.com/question/395\n当你直接点击桌面zip下载需需要注册.在源码中看见:\nfile/download/file_name-5qGM6Z2iLnppcA==__url-aHR0cDovL3dlbmRhLmFud3Npb24uY29tL3VwbG9hZHMvcXVlc3Rpb25zLzIwMTIwNjA3L2JkMGFhY2FhNjg2YzEyNDlkOTY1YzZjZWM5ZDEwY2Y1LnppcA==\n其中:\naHR0cDovL3dlbmRhLmFud3Npb24uY29tL3VwbG9hZHMvcXVlc3Rpb25zLzIwMTIwNjA3L2JkMGFhY2FhNjg2YzEyNDlkOTY1YzZjZWM5ZDEwY2Y1LnppcA==\n我们base64解码下.最终连接;\nhttp://wenda.anwsion.com/uploads/questions/20120607/bd0aacaa686c1249d965c6cec9d10cf5.zip\n= =不用登陆能下载了,如果对方指定为VIP用户或者得注册(要邀请码)才能下载的话呢??3)绕过全局变量的包含----变量覆盖wenda\\system\\init.php 中\nif (@ini_get('register_globals')){\tif ($_REQUEST)\t{\t\tforeach ($_REQUEST AS $name => $value)\t\t{\t\t\tunset($$name);\t\t}\t}}\n此段代码程序是当全局开启全局时销毁变量,防止恶意代码赋值导致严重的后果.但是程序员没了解,unset()默认只会销毁局部变量.我们测试下:\n<?phpif (@ini_get('register_globals')){\tif ($_REQUEST)\t{\t\tforeach ($_REQUEST AS $name => $value)\t\t{\t\t\tunset($$name);\t\t}\t}}print $a.\"<br>\";print $_GET[b];?>\n\nhttp://127.0.0.1:8080/wenda/system/unset.php?a=1&b=2\n\n\na变量被销毁,达到程序目的.可是:....\nhttp://127.0.0.1:8080/wenda/system/unset.php?GLOBALS[a]=1&b=2\n\n\nGLOBALS[a]以覆盖全局变量时,则可以成功控制变量$a的值~~~~还有思路突破:http://zone.wooyun.org/content/1872\n为什么超全局变量$_REQUEST没有读取到$_COOKIE的参数呢？这个是php 5.3以后php.ini默认设置request_order = \"GP\"，所以你懂的！如果你修改request_order = \"GPC\"，$_REQUEST应该就可以接受到参数了！所以如果php是大于5.3的，变量覆盖漏洞应该可以再次利用！\n   漏洞证明：  见详细说明.   修复方案：  检查是否数组,是否空. 逻辑严格点? 变量覆盖这个我想不出好点子,你写好了我再看看。。。   版权声明：转载请注明来源 _Evil@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2013-01-01 00:35 厂商回复： 谢谢，新年快乐 最新状态： 2013-01-05：GLOBALS 暂时不做处理。request_order 已经解决了  ", "replys": "漏洞评价：\n评论\n     2013-01-01 00:24 |    \t\tBlackeagle \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:10        | 向WooYun致敬)\t\t \n  新年快乐~    \n     2013-01-01 11:59 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  新年快乐~    \n     2013-01-01 13:05 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  新年快乐~    \n     2013-01-01 14:04 |    \t\t0x0F \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:60        | 尖刀安全 (JDSec.Com).......................)\t\t \n  我明明是沙发。    \n     2013-01-21 09:31 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  哇塞 小猪的 需要支付乌云币了 看来我落伍好多了    \n     2013-01-31 11:39 |    \t\t猫头鹰 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:6        | 不解释)\t\t \n  新年快乐    \n     2013-02-15 11:16 |    \t\t溪水流淌 \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:2        | 如果一切都任我欲为，我会有迷失在这自由深...)\t\t \n  新年快乐~    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}