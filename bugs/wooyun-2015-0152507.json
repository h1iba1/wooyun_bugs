{"id": 81930, "wybug_id": "wooyun-2015-0152507", "wybug_title": "360手机助手设计缺陷可进行部分远程操作（有限制）", "wybug_corp": "奇虎360", "wybug_author": "路人甲", "wybug_date": "2015-11-09 11:37", "wybug_open_date": "2015-12-17 14:48", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-12：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： 360手机助手设计缺陷可进行部分远程操作（有限制），可以被远程操作访问任意URL，下载、安装、开启任意应用。 详细说明：  在手机上安装并开启360手机助手后，发现它监听了38517端口。而且此端口没有bind到本地，意味着任意能访问到它的主机都可以连接到这个端口。\n\n进一步查看发现，360手机助手在本地通过NanoHttpd实现了一个server。其serve方法如下：\n\n在里面我们看到了很多request，例如/in，/opeanApp，/openPage, 等等，显然360手机助手可以通过接收client发来的request来进行各种操作，如打开应用，访问URL等。这个方法虽然在一开始获取了一下http-client-ip，但是并没有据此进行任何判断。意味着来自任意地址的访问仍然可以被处理。对于/openPage这个request，360手机助手首先会从parameter中取得url，然后会进行如下的判断：\n\n看起来360手机助手对URL的来源进行了限制，仅允许访问几个自己的域名。但是不幸的是，这个限制实际上可以轻易被绕过，因为我们知道，在**.**.**.**中点击搜索到的网页都是要通过**.**.**.**跳转一层的，因此可以很容易构造一个从**.**.**.**到任意URL的跳转。例如通过该URL我们可以直接访问手机新浪网：http://m.**.**.**.**/jump?u=http://**.**.**.**/&m=853640在根据上面的域名后缀判断URL的合法性之后，360手机助手会直接在app内打开这个URL。所以，我们只需要一条简单的命令就可以远程让360手机助手访问URL：\ncurl --data-urlencode “http://m.**.**.**.**/jump?u=http://**.**.**.**/&m=853640“ **.**.**.**/openPage\n/in这个request可以被用来实现任意apk的下载和安装，它接收的paramater很多：\n\n但是实际上我们只需要提供url和sign两个参数即可。sign是用来对url参数进行校验的，算法很简单：\nsign = MD5_hexstr(url + “mobilemgr_wififind”)\n校验完这个request参数的合法性之后，该方法会调用如下方法来执行应用的下载和安装：\n\n在有root的机型上或者智能安装功能启动的机型上，应用的安装甚至不需要用户的确认。/opeanApp可以被用来开启本地的任意一个应用，它只需要两个参数：apkId和sign，其中apkId就是应用的包名，而sign的算法和/in中一样：sign = MD5_hexstr(apkId + “mobilemgr_wififind”)。\n\n经测试360手机助手一直到3.2.61版本均有上述问题。   漏洞证明：     修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-11-09 13:31 厂商回复： 感谢提交，报告中提到的360产品老版本的安全问题是有安全防护措施的，如云端和服务端的安全检查，我们在发布的最新版本中也加强了安全防护措施。报告中提到的web安全问题，此处本身有签名校验安全防护措施，我们会再加强安全措施。根据您的建议，我们还会再进一步加强安全防护措施。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-11-09 11:39 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:233 漏洞数:81        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  听说有宝马？    \n     2015-11-09 13:27 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:260 漏洞数:63        | 潜心代码审计。)\t\t \n  宝马丢了    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}