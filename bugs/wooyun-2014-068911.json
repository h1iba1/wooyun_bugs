{"id": 53076, "wybug_id": "wooyun-2014-068911", "wybug_title": "TinyShop 多处sql注入#2", "wybug_corp": "tinyrise.com", "wybug_author": "roker", "wybug_date": "2014-07-18 11:12", "wybug_open_date": "2014-10-16 11:14", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-16：\t细节向公众公开  简要描述： rt 详细说明：  看到 /framework/lib/util/filter_class.php\n......public static function sql($str)\t{\t\tif (get_magic_quotes_gpc()){\t\t\t$str = stripslashes($str);\t\t}else{\t\t\t//不使用主要是因为，先有mysql的连接\t\t\t//$str =  mysql_real_escape_string($str);\t\t\t$str = addslashes($str);\t\t}\t\treturn $str;\t}.....\n当php为低版本或者 gpc开启（php默认是开启的吧）时。\t\t\t$str = stripslashes($str);去掉 转义符， 跳出转义。找一个调用 Filter::sql的。例如 index.php\npublic function js()    {        $id = Filter::sql(Req::args(\"id\"));        $model = new Model(\"ad\");        $time = date('Y-m-d');        $ad = $model->where(\"number = '$id' and start_time<='$time' and end_time >='$time'\")->find();        if($ad==null) return;        if($ad['is_open']==0) return;\n百度搜索到某个使用 tinyshop的站，just a test~\n\n调用该函数的 还有 /protected/controllers/simple.php\npublic function reset_password()    {        $safecode = Filter::sql(Req::args('safecode'));        if($safecode!=null && strlen($safecode)==32)        {            $model = $this->model->table('reset_password');            $obj = $model->where(\"safecode='\".$safecode.\"'\")->find();            $this->assign('status','fail');            $this->assign('safecode',$safecode);            if(!empty($obj)) $this->assign('status','success');            $this->redirect();        }        else        {            $this->redirect('index/index');        }    }\n/protected/controllers/ucenter.php/protected/controllers/payment.php。。。。就不贴代码一一举例了。   漏洞证明：  \n\n   修复方案：  过滤   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2014-07-20 10:46 厂商回复： 非常感谢您为TinyShop信息安全做的贡献我们将尽快修复,非常感谢您的支持。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-11 10:57 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  @疯狗能解释一下这个吗？http://www.wooyun.org/bugs/wooyun-2014-068004/trace/93d9b8328ab867fdb521f38209e76f60    \n     2014-08-11 11:20 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  @xiaoL 除了rp。。我还能说啥。。。    \n     2014-08-11 15:04 |    \t\txiaoL \t\t\t( 普通白帽子  |\t\t\t        Rank:361 漏洞数:67        | PKAV技术宅社区!Blog:http://www.xlixli....)\t\t \n  @roker 好像是哦，难怪最近走在路上捡不到钱...    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}