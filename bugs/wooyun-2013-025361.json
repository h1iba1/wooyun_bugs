{"id": 11291, "wybug_id": "wooyun-2013-025361", "wybug_title": "论升级的重要性,低版本squirrel mail的XSS利用实例", "wybug_corp": "香港科技大学", "wybug_author": "nyannyannyan", "wybug_date": "2013-06-07 23:24", "wybug_open_date": "2013-07-22 23:25", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型", "利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-06-07：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-07-22：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 低版本的sqmail有几个xss洞...但是没有exploit...这次通过实例补充一下求不要跨省...我还要读几年书呢 详细说明：  香港科技大学喜欢使用squirrel mail作为webmail后端屡次标榜先进性却不思升级...这不就跪了么这次实战的洞有CVE-2008-2379和一个老洞...但是sqmail的最新版好像也没完全修好先看看科大用的sqmail版本logout以后任意访问一个需要login的页面就可以了\n\n1.4.10a恩...http://squirrelmail.org/security/来看看对应版本有什么洞...我注意到的是2008-12-04\tCross site scripting in HTML filter\t1.4.0 - 1.4.16\t0\tCVE-2008-2379这个洞...先搜一下网上有没有现成的exploit好了..........没有...那就自己研究先看一下patchhttp://squirrelmail.svn.sourceforge.net/viewvc/squirrelmail/branches/SM-1_4-STABLE/squirrelmail/functions/mime.php?r1=13276&r2=13338&view=patch然后抓源码下来研究一番原来啊...洞在于在函数的一开始，把链接两边的quote去掉了\n\n但是在处理完以后，忘记加上quote了..\n\n但是啊....仔细研究这段源码...发现了一些棘手的事情\n\n开发者提前探测了一些危险字符，然后是一旦出现直接打入冷宫= =这里我想再要吐槽一下....尼玛过滤其他的字符我还能理解，过滤20空格,21感叹号,23井号,24美元符号,25百分号是要逆天么?你这样让一个正常的url也要悲剧啊...好了...那么也即...要在大多数已经用惯的分隔符不能使用之际，来构造XSS第一个任务...如何将tag name同tag attribute分隔开因为过滤空格等分隔符的原因\n<img onload=xxx>\n这样是不行的...但是啊...我表示曾经试出过一个奇葩的用法\n<img/onload=xxx>\n也即...用反斜杠是可以分隔tag name和tag attribute的而且经测试是通杀各大浏览器的其实呢...按照sqmail直接返回内容的尿性...到这里已经够了...因为直接script标签就搞定了...但是呢...我还想来试试用img标签怎么搞这就涉及到第二个问题...分隔tag attribute的方法这时候是不能用反斜杠分隔的，因为反斜杠会被认为在attribute里面这时候我另一个奇葩的发现又派出了用场...那就是，各大浏览器会把\\127当成单引号来parse....于是可以有如下的代码\n<img/src=\\127\\48\\127onerror=\\127console.log(/xss/)\\127/>\n然后这个洞的完整exploit就是\n<a href='http://test/?p=></a><img/src=\\127\\48\\127onerror=\\127console.log(/xss/)\\127/>' >test</a>\n效果最后再给然后接下来是一个老洞就是svg里面xlink:href插入javascript的问题不多说...直接上exploit\n<svg xmlns=\"http://www.w3.org/2000/svg\" style=\"width:700px;height:400px;z-index:101;display:block;margin-top:-400px;\"> <a xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:actuate=\"onClick\" xlink:href=\"javascript:console.log(/xss/)\"><rect width=\"1000\" height=\"1000\" fill=\"transparent\"/></a> </svg>\n为什么说新版的sqmail修了一半呢...这段exploit原意是用一个很大的可点击的透明rect覆盖几乎整个页面，让用户只要点击就会触发脚本新版的sqmail修正了用style覆盖页面的漏洞，但是没有修正xlink:href含有javasctipt的漏洞最后是这个版本的sqmail所有cookie包括session都不是http only的...所以xss是致命的\n\n然后赶紧实战一下send封email给自己\n\n查看邮件页面里赫然已有痕迹\n\n\n\n然后那个onerror的已然执行\n\n那个骗点击的工作正常\n\n所以啊...不升级伤不起啊   漏洞证明：  \n\n\n\n\n\n\n\n   修复方案：  升级啊升级然后那个xlink:href的小洞squirrel mail修一下?之前不是说好升级换代成Google Apps吗....怎么没动静了要我说啊...科大赶紧换Google Apps嘛...   版权声明：转载请注明来源 nyannyannyan@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-06-08 00:03 |    \t\tnyannyannyan \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 蒟蒻一枚)\t\t \n  @xsser @疯狗 有张图好像还是没修好然后文中有处错误....等公开以后我发评论澄清吧= =    \n     2013-07-23 17:14 |    \t\tCnCxzSec(衰仔) \t\t\t( 普通白帽子  |\t\t\t        Rank:322 漏洞数:32        | Wow~~~)\t\t \n  @nyannyannyan 公开了，来说说~    \n     2013-07-23 20:42 |    \t\tnyannyannyan \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 蒟蒻一枚)\t\t \n  @CnCxzSec(衰仔) 哦...那个\\127的效果是后端chr造成的...不是浏览器造成的    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}