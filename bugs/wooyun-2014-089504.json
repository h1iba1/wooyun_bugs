{"id": 46762, "wybug_id": "wooyun-2014-089504", "wybug_title": "360webscan防御脚本绕过", "wybug_corp": "奇虎360", "wybug_author": "MayIKissYou", "wybug_date": "2014-12-31 15:41", "wybug_open_date": "2015-02-14 15:42", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-14：\t细节向公众公开  简要描述： 测试一下是不是真的好使，我是来蹭rank的 详细说明：  1：之前的漏洞描述里面有点知识理解错了，但是不影响结果，测试下360webscan的看能不能搞定 2：在正则表达式里面，\\s的理解有如下字符，在php，python以及c下面测试结果均为： 0x09,0x0a,0x0b,0x0c,0x0d,0x20如下6个字符， 3：在如下帖子中知名，mysql理解的whitespace有如下字符： 0x09,0x0a,0x0b,0x0c,0x0d,0x20,0xa0 \nhttp://zone.wooyun.org/content/16772\n 感谢狗哥哥分享的帖子 4:如此看来，0xa0是正则\\s中不不包括的，在大多数的union select注入识别中 一般都会输入类似的代码union[]select[] []的都喜欢使用\\s的匹配，这里就很有可能由于 web端和mysql端对于其理解不同造成bypass 5：cmseasy使用的是360webscan，下载最新版本20141015，其中360webscan防御的正则为\n\\\\<.+javascript:window\\\\[.{1}\\\\\\\\x|<.*=(&#\\\\d+?;?)+?>|<.*(data|src)=data:text\\\\/html.*>|\\\\b(alert\\\\(|confirm\\\\(|expression\\\\(|prompt\\\\(|benchmark\\s*?\\(.*\\)|sleep\\s*?\\(.*\\)|load_file\\s*?\\\\()|<[a-z]+?\\\\b[^>]*?\\\\bon([a-z]{4,})\\s*?=|^\\\\+\\\\/v(8|9)|\\\\b(and|or)\\\\b\\\\s*?([\\\\(\\\\)'\\\"\\\\d]+?=[\\\\(\\\\)'\\\"\\\\d]+?|[\\\\(\\\\)'\\\"a-zA-Z]+?=[\\\\(\\\\)'\\\"a-zA-Z]+?|>|<|\\s+?[\\\\w]+?\\\\s+?\\\\bin\\\\b\\\\s*?\\(|\\\\blike\\\\b\\\\s+?[\\\"'])|\\\\/\\\\*.*\\\\*\\\\/|<\\\\s*script\\\\b|\\\\bEXEC\\\\b|UNION.+?SELECT@{0,2}(\\\\(.+\\\\)|\\\\s+?.+?|(`|'|\\\").*?(`|'|\\\"))|UPDATE@{0,2}(\\\\(.+\\\\)|\\\\s+?.+?|(`|'|\\\").*?(`|'|\\\"))SET|INSERT\\\\s+INTO.+?VALUES|(SELECT|DELETE)@{0,2}(\\\\(.+\\\\)|\\\\s+?.+?\\\\s+?|(`|'|\\\").*?(`|'|\\\"))FROM(\\\\(.+\\\\)|\\\\s+?.+?|(`|'|\\\").*?(`|'|\\\"))|(CREATE|ALTER|DROP|TRUNCATE)\\\\s+(TABLE|DATABASE)|\\\\/\\\\*.*?\\\\*\\\\/|'\n我们看关键部分，第一部分是union部分\nUNION.+?SELECT@{0,2}(\\\\(.+\\\\)|\\\\s+?.+?|(`|'|\\\").*?(`|'|\\\"))\n此部分关键的是\\s+?这里的意思是非贪婪的匹配1个或多个空白，注意mysql中的%a0哦，貌似输入在这会有效果第二部分是select部分的\n(SELECT|DELETE)@{0,2}(\\\\(.+\\\\)|\\\\s+?.+?\\\\s+?\n同样注意这里的\\s+?，原理同上6：我们在浏览器中输入http://192.168.4.70/cmseasy/uploads/index.php?id=1 union select 1 from table查看结果如下：\n\n7：我将%a0放置在select和from的后面\n\n   漏洞证明：  6：我们在浏览器中输入http://192.168.4.70/cmseasy/uploads/index.php?id=1 union select 1 from table查看结果如下：\n\n7：我将%a0放置在select和from的后面\n\n   修复方案：  修改正则   版权声明：转载请注明来源 MayIKissYou@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-12-31 17:50 厂商回复： 感谢您的反馈，我们会尽快处理此问题。感谢大家对360产品安全的关注，谢谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-31 15:45 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  最新的？    \n     2014-12-31 15:49 |    \t\tMayIKissYou \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:33        | 勿忘初心)\t\t \n  @menmen519 我下的20141015那个cmseasy    \n     2014-12-31 15:51 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  @MayIKissYou 哦 那个没有更新过 坐等你的思路    \n     2014-12-31 16:12 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  ...8E0？    \n     2014-12-31 20:32 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  那个。。。union select？    \n     2014-12-31 20:44 |    \t\tMayIKissYou \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:33        | 勿忘初心)\t\t \n  @泳少 恩    \n     2014-12-31 20:46 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  @MayIKissYou 我也尝试了。。只是弄不来。学习你的思路吧~    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}