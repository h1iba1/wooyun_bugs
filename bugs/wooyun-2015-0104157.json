{"id": 25381, "wybug_id": "wooyun-2015-0104157", "wybug_title": "phpcms前台任意代码执行（有php版本限制）", "wybug_corp": "phpcms", "wybug_author": "xcrypt", "wybug_date": "2015-03-27 14:40", "wybug_open_date": "2015-06-25 16:32", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-30：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-25：\t细节向公众公开  简要描述： 还是string2array函数，之前有人提到过了，但这次在前台找到了利用方法。20150305的补丁仍没有修复。 详细说明：  在后台利用该函数执行代码比较简单，但前台利用需要使用到mysql和php的2个小特性。首先利用了mysql的一个特性，mysql在存储数据的时候会根据当前数据库的字符集来校验数据，发现非法数据时会抛弃其后续数据。当表的字符集是utf8_general_ci时，测试SQL：Insert into table values (concat('ab', 0x80, 'cd'))，因为0x80不是有效的UTF-8字符，所以只有ab被写入数据库中，cd会被截断。当表的字符集是gbk_chinese_ci时，测试SQL：Insert into table values (concat('ab', 0x8027, 'cd'))，因为0x8027不是有效的gbk字符，所以只有ab被写入数据库中，cd会被截断。第二个是利用了php语法的松散性。 \n\n以上代码语法上存在错误，但在php 5.2.17上可以正常运行，在5.3.29和5.4.30上测试失败。所以该漏洞在较高版本的php上暂时没法利用。   漏洞证明：  \n\n投票结果展示的关键代码。\n\n$data对应数据库中v9_vote_data表的data字段。正常的值如下\n\n数组的键名可控，来自提交的radio数组，然后经过了array2string函数处理。\n\n构造如下post数据，gbk和utf-8版本利用代码相同。\n\n数据库中的值如下\n\n\n\n   修复方案：  eval里面的$data外面加上双引号。   版权声明：转载请注明来源 xcrypt@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-03-27 16:30 厂商回复： 感谢提出 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-27 14:48 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  料不少    \n     2015-03-27 14:49 |    \t\t核心粉木耳 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:2        | 。。。)\t\t \n  需不需要登陆 这是个问题。。。。    \n     2015-03-27 14:52 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @核心粉木耳 不需要    \n     2015-03-27 14:54 |    \t\t核心粉木耳 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:2        | 。。。)\t\t \n  mark    \n     2015-03-27 15:26 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  卧槽。    \n     2015-03-27 16:27 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  关注下    \n     2015-03-30 16:51 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  @finger 漏洞求审核http://www.wooyun.org/bugs/wooyun-2015-098828/trace/ad7d391ea57be3e37014046a5960faa7    \n     2015-03-30 22:08 |    \t\t忆苦思甜 \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:25        )\t\t \n  mark    \n     2015-03-31 01:36 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2015-04-01 12:18 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  不会是投票那个吧?!这就给放出来了?    \n     2015-04-01 14:40 |    \t\tAzui \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:10        | 用一只黑色铅笔画一出舞台默剧。)\t\t \n  无需会员中心= =..    \n     2015-04-01 14:52 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  我知道了 就是投票那个..  php需低于5.3    \n     2015-04-01 14:57 |    \t\txcrypt \t\t\t( 实习白帽子  |\t\t\t        Rank:87 漏洞数:9        | 暂无介绍~)\t\t \n  @Black Angel 其他地方有相关细节？    \n     2015-04-01 15:37 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  @xcrypt 我不知道,,我啥都不知道~     \n     2015-04-01 15:48 |    \t\t岩少 \t\t\t( 普通白帽子  |\t\t\t        Rank:586 漏洞数:171        | 破晓团队)\t\t \n  又掀起不小的风波    \n     2015-04-20 14:40 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  @Black Angel 气死就是咯~    \n     2015-04-26 11:41 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  为啥php版本要低于5.3    \n     2015-04-26 12:56 |    \t\t微尘 \t\t\t( 普通白帽子  |\t\t\t        Rank:218 漏洞数:74        )\t\t \n  mark~~    \n     2015-06-07 19:59 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  料多来的    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}