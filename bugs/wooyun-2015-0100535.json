{"id": 30192, "wybug_id": "wooyun-2015-0100535", "wybug_title": "惠尔顿上网行为管理系统Getshell续（无需登录）", "wybug_corp": "深圳市惠尔顿信息技术有限公司", "wybug_author": "pandas", "wybug_date": "2015-03-10 18:02", "wybug_open_date": "2015-06-13 11:34", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-18：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-13：\t细节向公众公开  简要描述： 这套系统登录后的漏洞很多，就不继续刷洞了。浅挖了几个无需登录的漏洞，这里再提交一处无需登录的getshell，该处getshell利用方式有点奇异，我也是请教了好基友@do9gy之后才利用成功。 详细说明：  漏洞文件:base/sys/plug_status.php\n<?php\t$file = \"/etc/sysconfig/firewallset\";\t$nat_chk = 0;\t$show_config_values = parse_ini_file($file);\tforeach($show_config_values as $k=>$v){\t\tif($k==\"p_internet_security_plug_nat\"){\t\t\t$nat_chk = $v;                                                                                           \t\t}\t}\t$user_IP = ($_SERVER[\"HTTP_VIA\"]) ? $_SERVER[\"HTTP_X_FORWARDED_FOR\"] : $_SERVER[\"REMOTE_ADDR\"];\t$user_IP = ($user_IP) ?  $user_IP : $_SERVER[\"REMOTE_ADDR\"]; \t$userip = $user_IP;\t$result_str = exec(\"/usr/local/WholetonTM/triton/bin/TritonIPCTools -g \".$userip);\t//$result_str = \"3232261130,1\\n3232261144,0\";\t//alert(\"$result_str\");\t$status_ary = array();\t$_str .= '';        ...省略部分代码...\n错误很明显，未对userip进行过滤而直接拼接执行，利用方式大家肯定都想得到就是伪造XFF，但是直接伪造是不成功的，具体在此不细说了，有兴趣的可以看代码测试区。   漏洞证明：  直接访问如下图：\n\n伪造xff头为恶意代码，可直接getshell：\n\n   修复方案：  .   版权声明：转载请注明来源 pandas@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-03-15 11:33 厂商回复： 已经由CNVD通过网站公开联系方式（或以往建立的处置渠道）向网站管理单位（软件生产厂商）通报 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}