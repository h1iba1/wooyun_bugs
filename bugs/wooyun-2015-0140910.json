{"id": 66614, "wybug_id": "wooyun-2015-0140910", "wybug_title": "链家地产某站点上传过滤不严格导致shell（可内网渗透）", "wybug_corp": "homelink.com.cn", "wybug_author": "路人甲", "wybug_date": "2015-09-13 16:43", "wybug_open_date": "2015-10-31 22:16", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-31：\t细节向公众公开  简要描述： 不要20，不要15,只要12，可以吗？ 详细说明：  \nhttp://wooyun.org/bugs/wooyun-2015-0130301由一个弱口令进而对链家的一次简单内网漫游\n这个洞里面修复了，上传和弱口令，但是上传过滤不严实，依然会有getshell风险\nhttp://gongyi.homelink.com.cn/lianjia/portal/index\n先申请一个账号，手机什么的随便填写，没人去验证\n\n下面就可以在个人资料的地方编辑上传文件\nhttp://gongyi.homelink.com.cn/lianjia/portal/user/personalCenterUpdate\n\n\n发现此处对文件的后缀名要求特别严格，只能是jpg等图像格式后来发现一个有意思的现象，上传xiao.jsp.jpg的时候提示格式不正确的错误，然后想这事图片格式，怎么能不正确呢？换了一个图片上传，没有跳出提示，然后就改动刚才的文件名xiao.jpg，果断没有提示。\n\n\n\n\n\nburp抓包，绕过限制，在数据包的名称中修改成xiao.jpg.jsp，不能直接改写jsp，否则还是提醒格式不正确，看来只是对上传文件做了第一个点后面的格式匹配，没有照看到后面的，成功返回shell路径\n\n配置文件\n#Thu Sep 10 20:54:47 CST 2015database.support.autokeys=truedatabase.driver.name=mysqldatabase.connection.pool.timeout=5000database.connection.dbname=jforumdatabase.support.subqueries=truedao.driver=net.jforum.dao.mysql.MysqlDataAccessDrivermysql.unicode=database.connection.pool.min=5database.connection.password=homelink2016database.connection.pool.max=10database.connection.username=workerdbencoding=utf-8database.connection.port=3306dbunicode=truedatabase.connection.host=10.10.28.11database.connection.driver=com.mysql.jdbc.Driverdatabase.connection.string=jdbc\\:mysql\\://10.10.28.11\\:3306/lianjia?user\\=worker&password\\=homelink2016&autoReconnect\\=true${mysql.unicode}${mysql.encoding}&useNewIO\\=false&zeroDateTimeBehavior\\=convertToNull&useServerPrepStmts\\=false&dumpQueriesOnException\\=true&jdbcCompliantTruncation\\=falsemysql.encoding=\n\n/usr/local/tomcat/webapps/jforum/>iduid=0(root) gid=0(root) groups=0(root)\n\neth0      Link encap:Ethernet  HWaddr 00:50:56:97:07:57            inet addr:10.10.28.11  Bcast:10.10.28.255  Mask:255.255.255.0          inet6 addr: fe80::250:56ff:fe97:757/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:20911870 errors:0 dropped:0 overruns:0 frame:0          TX packets:18813230 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000           RX bytes:8725777527 (8.1 GiB)  TX bytes:30497410242 (28.4 GiB)lo        Link encap:Local Loopback            inet addr:127.0.0.1  Mask:255.0.0.0          inet6 addr: ::1/128 Scope:Host          UP LOOPBACK RUNNING  MTU:65536  Metric:1          RX packets:14939466 errors:0 dropped:0 overruns:0 frame:0          TX packets:14939466 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0           RX bytes:14343201433 (13.3 GiB)  TX bytes:14343201433 (13.3 GiB)\n   漏洞证明：  root权限，可以安装后门什么的，配置了一下ssocks，没有成功。还可以使用regeorg，配置一下，可以成功访问内网\n\n费心，不渗透了附上小马，其他的看看日志文件吧http://gongyi.homelink.com.cn/jforum/tools/bin/mysql.jsphttp://gongyi.homelink.com.cn/jforum/tunnel.jsp...   修复方案：  上传的地方再好好看看吧   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-09-16 22:15 厂商回复： 确认，谢谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-09-15 17:06 |    \t\t北京链家房地产经纪有限公司(乌云厂商)\t\t \n  你好，可否留下联系方式，按照这个方法并未成功复现。    \n     2015-09-15 17:30 |    \t\t@sdf \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | @sdf)\t\t \n  @北京链家房地产经纪有限公司 qq162187647    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}