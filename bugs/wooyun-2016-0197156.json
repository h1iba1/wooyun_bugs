{"id": 88327, "wybug_id": "wooyun-2016-0197156", "wybug_title": "wifi安全之海魔方getshell（影响多个站点）                                      ", "wybug_corp": "himofi.com", "wybug_author": "千机", "wybug_date": "2016-05-18 09:02", "wybug_open_date": "2016-07-03 09:30", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-05-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-05-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-07-03：\t细节向公众公开  简要描述： 武汉海传信息技术有限公司是一家专业从事互联网/移动互联网产品研发和服务的科技型公司，坚持自主研发的路线和优质服务的理念，与国内领先的路由系统进行战略合作，是武汉智慧城市WiFi合作发展重要项目，提供硬件和云服务平台相结合的优质产品和服务，为用户提供专业的Wi-Fi网站综合解决方案，致力于成为中国 第一家Wi-Fi网站专业解决方案提供商。 详细说明：  \nhttp://www.himofi.com/\n海魔方某处getshell。因为貌似对方服务器开启了保护模式，shell不能执行命令，危害有限。干脆我就把过程写详细点，看能不能上首页先是用子域名扫描发现了一个后台域名\nhttp://m.himofi.com/v3/cp/users/login\n然后呢试了各种弱口令都没成功，于是看到右下角有个申请试用的按钮\n\n虽然说是1到3天内审核通过，不过我刚提完申请就把账号发我了\n\n在认证页里面有个上传图片的地方试了下都能上传shell，过程是曲折的上传图片的问题在于他只在前端验证了文件的后缀名是不是jpg的，并没有在后台验证但是如果只是把shell的后缀改成jpg然后去上传的话会提示上传失败因此的话只能上传php图片一句话木马才行然后找了半天都没找到php图片马于是自己制作一个先弄个php一句话叫a.php。然后随便找个图片，用cmd的copy命令来合成如果以默认模式合成的图片马依旧不能够上传图片要用二进制读取，php文件要ascii码读取。然后合成的图片才上传成功\n\n上传过程中抓包将后缀改成php就可以了。但是php会提醒执行错误原来是这种合成的话会在图片里加一堆貌似是adobe的什么代码，\n\n我也不知道这是什么，貌似就是这玩意影响了php一句话执行的。把这些删了就好了。\n\nshell地址为\nhttp://m.himofi.com/v3/cp/upload/merchant/2016/04/16/57120841d30f0.php\n密码是feiji\n\n24个站都能看到源代码和配置文件可是蛋疼的就是，，不能执行命令，菜刀说啥子对方开启了保护模式，命令执行失败找到一个备份数据库，貌似挺大的，反正我没下载成功。。\n\n   漏洞证明：  \n\n   修复方案：  限制上传接口   版权声明：转载请注明来源 千机@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2016-05-19 09:20 厂商回复： 感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}