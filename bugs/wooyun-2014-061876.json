{"id": 55198, "wybug_id": "wooyun-2014-061876", "wybug_title": "PHP云人才某系统功能CSRF漏洞", "wybug_corp": "php云人才系统", "wybug_author": "小猪", "wybug_date": "2014-05-27 16:27", "wybug_open_date": "2014-08-25 16:28", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "低", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-02：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-25：\t细节向公众公开  简要描述： @/fd牛在drops丢了一篇关于上传问题的文章，http://drops.wooyun.org/tips/2031关于这篇文章的一些细节在@/fd牛发表之前刚好跟@Mramydnei M哥聊过一些M哥表示wb已经足够ipad了所以就把这个机会让给了我，我就献丑找个通用型的cms来一发ps:这个问题的根源出在上传逻辑上，所以类型选了文件上传ps:感谢@Mramydnei 详细说明：  这个问题对没有检查上传文件头，没有写好crossdomain.xml的站点来说危害很大待会儿再发一个没处理好crossdomain.xml导致问题的样例时间关系没有挖后台getshell的地方 所以就用csrf添加管理员来演示phpyun上传功能（只拿个人中心-》照片管理功能上传测试）未检测上传文件的实际文件格式，只对后缀做了检查。可以上传一个.jpg后缀的swf文件。通过swf中的as来执行post get等操作，相当于一个本域的存储型XSS了。具体操作如下   漏洞证明：  1、先抓取phpyun后台添加管理员的包，提取参数和地址。然后新建一个flash文件，添加post的as脚本，参数可写死也可后期用flashvar在调用的时候写，我这里写死在as里了。如图\n\n2、编译成swf然后改后缀为.jpg，然后通过个人中心的上传形象照功能上传到服务器\n\n3、在别的地方（任何域哦，只要你可控）构造一个页面，插入刚才上传的jpg(实际为swf)的地址 allowscriptaccess要为always。\n\n4、引诱管理员（看你本事了）访问刚才那个页面，后台就多了一个超管 test:test123\n\n   修复方案：  上传逻辑加个文件头检查吧   版权声明：转载请注明来源 小猪@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-05-30 14:05 厂商回复： 首先感谢您的提供，我们会加强上传验证，3.1新版已经增加后台CSRF防御，再次感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-31 10:07 |    \t\tneal \t\t\t( 普通白帽子  |\t\t\t        Rank:219 漏洞数:23        )\t\t \n  全局过滤 不是加了xss防御代码吗 你绕过了?    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}