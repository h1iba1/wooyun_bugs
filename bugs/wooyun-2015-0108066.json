{"id": 34081, "wybug_id": "wooyun-2015-0108066", "wybug_title": "泡椒网某服务未经授权访问(部分信息泄漏)", "wybug_corp": "paojiao.com", "wybug_author": "李旭敏", "wybug_date": "2015-04-15 11:22", "wybug_open_date": "2015-06-02 22:08", "wybug_type": "未授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "1", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-02：\t细节向公众公开  简要描述： 我也不知道泄漏个啥，反正你是泄漏了 详细说明：  \n\n\n\nmemcached空口令进去了··   漏洞证明：  stats itemsSTAT items:5:number 1STAT items:5:age 966188STAT items:5:evicted 0STAT items:5:evicted_nonzero 0STAT items:5:evicted_time 0STAT items:5:outofmemory 0STAT items:5:tailrepairs 0STAT items:5:reclaimed 0STAT items:5:expired_unfetched 0STAT items:5:evicted_unfetched 0STAT items:6:number 287STAT items:6:age 1052262STAT items:6:evicted 0STAT items:6:evicted_nonzero 0STAT items:6:evicted_time 0STAT items:6:outofmemory 0STAT items:6:tailrepairs 0STAT items:6:reclaimed 131579STAT items:6:expired_unfetched 131564STAT items:6:evicted_unfetched 0STAT items:7:number 138STAT items:7:age 988879STAT items:7:evicted 0STAT items:7:evicted_nonzero 0STAT items:7:evicted_time 0STAT items:7:outofmemory 0STAT items:7:tailrepairs 0STAT items:7:reclaimed 84619STAT items:7:expired_unfetched 52916STAT items:7:evicted_unfetched 0STAT items:8:number 1STAT items:8:age 965814STAT items:8:evicted 0STAT items:8:evicted_nonzero 0STAT items:8:evicted_time 0STAT items:8:outofmemory 0STAT items:8:tailrepairs 0STAT items:8:reclaimed 781STAT items:8:expired_unfetched 101STAT items:8:evicted_unfetched 0STAT items:9:number 3STAT items:9:age 1083357STAT items:9:evicted 0STAT items:9:evicted_nonzero 0STAT items:9:evicted_time 0STAT items:9:outofmemory 0STAT items:9:tailrepairs 0STAT items:9:reclaimed 1027STAT items:9:expired_unfetched 72STAT items:9:evicted_unfetched 0STAT items:10:number 2STAT items:10:age 968580STAT items:10:evicted 0STAT items:10:evicted_nonzero 0STAT items:10:evicted_time 0STAT items:10:outofmemory 0STAT items:10:tailrepairs 0STAT items:10:reclaimed 2500STAT items:10:expired_unfetched 15STAT items:10:evicted_unfetched 0STAT items:11:number 2STAT items:11:age 12809161STAT items:11:evicted 0STAT items:11:evicted_nonzero 0STAT items:11:evicted_time 0STAT items:11:outofmemory 0STAT items:11:tailrepairs 0STAT items:11:reclaimed 3STAT items:11:expired_unfetched 0STAT items:11:evicted_unfetched 0STAT items:12:number 2STAT items:12:age 967259STAT items:12:evicted 0STAT items:12:evicted_nonzero 0STAT items:12:evicted_time 0STAT items:12:outofmemory 0STAT items:12:tailrepairs 0STAT items:12:reclaimed 96STAT items:12:expired_unfetched 81STAT items:12:evicted_unfetched 0STAT items:13:number 1STAT items:13:age 965814STAT items:13:evicted 0STAT items:13:evicted_nonzero 0STAT items:13:evicted_time 0STAT items:13:outofmemory 0STAT items:13:tailrepairs 0STAT items:13:reclaimed 1463STAT items:13:expired_unfetched 5STAT items:13:evicted_unfetched 0STAT items:14:number 1STAT items:14:age 966188STAT items:14:evicted 0STAT items:14:evicted_nonzero 0STAT items:14:evicted_time 0STAT items:14:outofmemory 0STAT items:14:tailrepairs 0STAT items:14:reclaimed 2STAT items:14:expired_unfetched 1STAT items:14:evicted_unfetched 0STAT items:18:number 1STAT items:18:age 965814STAT items:18:evicted 0STAT items:18:evicted_nonzero 0STAT items:18:evicted_time 0STAT items:18:outofmemory 0STAT items:18:tailrepairs 0STAT items:18:reclaimed 9101STAT items:18:expired_unfetched 4519STAT items:18:evicted_unfetched 0STAT items:20:number 6STAT items:20:age 966124STAT items:20:evicted 0STAT items:20:evicted_nonzero 0STAT items:20:evicted_time 0STAT items:20:outofmemory 0STAT items:20:tailrepairs 0STAT items:20:reclaimed 101091STAT items:20:expired_unfetched 101081STAT items:20:evicted_unfetched 0   修复方案：  \nhttp://drops.wooyun.org/papers/865\nMemcache服务器端都是直接通过客户端连接后直接操作，没有任何的验证过程，这样如果服务器是直接暴露在互联网上的话是比较危险，轻则数据泄露被其他无关人员查看，重则服务器被入侵，因为Mecache是以root权限运行的，况且里面可能存在一些我们未知的bug或者是缓冲区溢出的情况，这些都是我们未知的，所以危险性是可以预见的。内网访问最好把两台服务器之间的访问是内网形态的，一般是Web服务器跟Memcache服务器之间。普遍的服务器都是有两块网卡，一块指向互联网，一块指向内网，那么就让Web服务器通过内网的网卡来访问Memcache服务器，我们Memcache的服务器上启动的时候就监听内网的IP地址和端口，内网间的访问能够有效阻止其他非法的访问。# memcached -d -m 1024 -u root -l 192.168.0.200 -p 11211 -c 1024 -P /tmp/memcached.pidMemcache服务器端设置监听通过内网的192.168.0.200的ip的11211端口，占用1024MB内存，并且允许最大1024个并发连接设置防火墙防火墙是简单有效的方式，如果却是两台服务器都是挂在网的，并且需要通过外网IP来访问Memcache的话，那么可以考虑使用防火墙或者代理程序来过滤非法访问。 一般我们在Linux下可以使用iptables或者FreeBSD下的ipfw来指定一些规则防止一些非法的访问，比如我们可以设置只允许我们的Web服务器来访问我们Memcache服务器，同时阻止其他的访问。# iptables -F# iptables -P INPUT DROP# iptables -A INPUT -p tcp -s 192.168.0.2 --dport 11211 -j ACCEPT# iptables -A INPUT -p udp -s 192.168.0.2 --dport 11211 -j ACCEPT上面的iptables规则就是只允许192.168.0.2这台Web服务器对Memcache服务器的访问，能够有效的阻止一些非法访问，相应的也可以增加一些其他的规则来加强安全性，这个可以根据自己的需要来做。   版权声明：转载请注明来源 李旭敏@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-04-18 22:06 厂商回复： 已经确认，正在安排人员处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-15 12:45 |    \t\tdiguoji \t\t\t( 普通白帽子  |\t\t\t        Rank:323 漏洞数:79        | 中国吉林长春)\t\t \n  卖鸡爪子的 也来乌云厂商啦     \n     2015-04-19 09:47 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  没有秘方？    \n     2015-04-19 16:23 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2738 漏洞数:547        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  mongdb    \n     2015-04-19 23:35 |    \t\t李旭敏 \t\t\t( 普通白帽子  |\t\t\t        Rank:469 漏洞数:71        | ฏ๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎...)\t\t \n  @爱上平顶山 赌1WB不是··    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}