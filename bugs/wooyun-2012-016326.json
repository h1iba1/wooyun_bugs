{"id": 14759, "wybug_id": "wooyun-2012-016326", "wybug_title": "腾讯某业务存储型XSS，盗取指定用户cookie，通杀所有业务。", "wybug_corp": "腾讯", "wybug_author": "鬼魅羊羔", "wybug_date": "2012-12-21 14:49", "wybug_open_date": "2013-02-04 14:50", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-12-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-12-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-12-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-01-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-01-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-02-04：\t细节向公众公开  简要描述： 腾讯某业务存储型XSS，盗取指定用户cookie，通杀所有业务。QQ空间、邮箱、微博、以及所有个人业务。。跟上我上一个帖子是一样的。。霸气的标题。。。感谢疯子、以及金山毒霸的基友参与测试哈。。 详细说明：  腾讯QQ管家举报中心，对URL地址过滤存在不足，url地址只要加入http://www开头，就可以正常提交XSS代码。另一个问题，就是在提交后，腾讯会在次日的10:30分准时给用户反馈提交的结果，问题就出在这里，反馈回来的邮件内容中包含XSS语句，可以正常执行，就造成了此次事情。。。另另外一个问题……算了，我还是配图说吧，这样说别扭。。。这个玩了几天，过完瘾了，就发出来了顺便说句。。。你们马总是不是不玩QQ邮箱啊？好嘛，跨了以后没劫持到他的信息。。   漏洞证明：  腾讯QQ管家举报中心，对URL地址过滤存在不足，url地址只要加入http://www开头，就可以正常提交XSS代码。http://guanjia.qq.com/report_url.html虽然下方的接收反馈信息的邮件地址是可控的，但是提交后，默认反馈的地址，还是登陆时的QQ号，我也尝试过，不登陆任何QQ进行提交，但是，点击提交，还是会要求登陆。。\n\n通过抓包发现，貌似是以uin中的内容为准啊。。不知道是不是这样，，反正，修改uin和email内容为要攻击的邮箱地址。。\n\n获取信息内容。。\n\n登陆别人空间。。\n\n\n\n这几张图就够了吧。。。   修复方案：  过滤。。   版权声明：转载请注明来源 鬼魅羊羔@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2012-12-21 17:15 厂商回复： 非常感谢您的报告。这个问题我们已经确认，正在与业务部门进行沟通制定解决方案。如有任何新的进展我们将会及时同步。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-12-21 14:50 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  前排广告位出租    \n     2012-12-21 15:01 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  这个碉堡了，http://www.mcbang.com/article-14438-1.html    \n     2012-12-21 15:06 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @鬼魅羊羔 真的如描述的话，你发了，等着收ipad吧~    \n     2012-12-21 15:07 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  @se55i0n 嗯、危害挺大的、    \n     2012-12-21 15:09 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @se55i0n 确实如描述。本来想拿这个搞helen二货的，不过看他可怜就算了    \n     2012-12-21 15:12 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @se55i0n 腾讯不会给的，G博士他们都发了多少了，才给个U盘，我这东西算什么啊。。我就没报希望。。我上一个腾讯应用的，也是这样的危害，而且是实时性的，立刻见效，这个要等到次日的10:30分，腾讯审核后，才能收获cookie。。轮时间上，不如上一个。。上一个才给10RANK。。你想吧，这个多配了几个图，最多也是12。。我有预感。。    \n     2012-12-21 15:13 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @疯子 哈哈~tx的筒子冬至都过不好咯~    \n     2012-12-21 15:15 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @鬼魅羊羔 哈哈~圣诞来了~说不定给你派发礼物呢~    \n     2012-12-21 15:15 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @se55i0n ~.~我还加班呢 我觉得十二月的乌云期刊这个可以上的...算一个新的储存型XSS的手法。    \n     2012-12-21 15:16 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @se55i0n 哎。。其实我的标题起的有点夸张了，就是cookie可以登录所有的腾讯个人业务，微博、空间、邮箱、个人中心、各种web上的应用和服务。。要是能打到腾讯内网，估计ipad就有了。。可惜了，腾讯审核没几个是活人，全部是设备。。    \n     2012-12-21 15:17 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @鬼魅羊羔 @疯子 哈哈~坐等公开    \n     2012-12-21 15:17 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  几个好基友，这个你把qq邮箱的qq号遍历一遍就牛b了，那么ipad应该有了    \n     2012-12-21 15:25 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @小胖胖要减肥 你咋老琢磨着QQ遍历啊亲。。。    \n     2012-12-21 15:27 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @鬼魅羊羔 你想想啊遍历qq号发邮件多牛b啊，打开邮件就中招，收cookies收到剑心颤抖，那么多qq的各种业务都能登录，那估计离家被爆破也不远了    \n     2012-12-21 15:33 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @小胖胖要减肥 你这样的想法，剑心看见要郁闷的。。    \n     2012-12-21 15:35 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  腾讯在乌云上面的 给个u盘 算好的了..    \n     2012-12-21 15:38 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  围观!!!!!!!!!!    \n     2012-12-21 15:43 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  @小胖胖要减肥 果断爆破    \n     2012-12-21 15:50 |    \t\t陈再胜 \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:13        | 微博收收听~~~●﹏●)\t\t \n  哟呵，找到很大的洞洞啊······    \n     2012-12-21 15:57 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @陈再胜 反正挺好玩，社工用不错哈。。。各种微博、空间、邮箱都能登录。。    \n     2012-12-21 15:59 |    \t\tRookie \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:78        | 123)\t\t \n  @鬼魅羊羔 最近搞上腾讯了..你也打算连载吗    \n     2012-12-21 16:03 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @Rookie 别吓我了，这运气可不是天天有的啊。。。连载毛线啊。。能找到一个我都觉得不容易了。。    \n     2012-12-21 16:27 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  目测1rank.....期望早点公开，我还有腾讯的xss呢..然后尝试一下    \n     2012-12-21 16:32 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @蟋蟀哥哥 你小子打算尝试什么？乌鸦嘴啊你，应该不会RANK的，上一个腾讯给了10，这个最低也得10吧。。。    \n     2012-12-21 16:32 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @蟋蟀哥哥 和你打赌不止1rank     \n     2012-12-21 16:49 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @小胖胖要减肥 加赌注，除非腾讯真心不想在乌云了...    \n     2012-12-21 17:09 |    \t\tupload \t\t\t( 普通白帽子  |\t\t\t        Rank:251 漏洞数:43        | 此处略--！)\t\t \n  哇    \n     2012-12-21 17:16 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @蟋蟀哥哥 @疯子 蟋蟀哥哥把你的xss贡献出来吧    \n     2012-12-21 17:17 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @小胖胖要减肥 15rank @蟋蟀哥哥 输了...    \n     2012-12-21 18:46 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  @疯子 我又没说要赌    \n     2012-12-21 23:27 |    \t\tcircus \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:4        | 你会为一件事去说一句话,也会为一句话去干...)\t\t \n  围观。    \n     2012-12-21 23:41 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @circus - -||    \n     2012-12-22 00:29 |    \t\tJason \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 我是来打酱油的！~~~)\t\t \n  真威武呀，调这时间提交，真会选日子，呵呵！关注！    \n     2012-12-22 15:24 |    \t\t小智 \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:5        | 低调低调，学习学习~)\t\t \n  如果能直接读取cookies就更好了，应该是js爆cookies？    \n     2012-12-22 15:28 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @小智 就是直接获取cookie。。看腾讯给15rank ，就知道了，，，    \n     2012-12-22 15:29 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  我之前发现一个现象无论你接收邮箱地址填写的是什么  还是会发送到你登陆的那个QQ号的邮箱所以，11月初测试的时候失败了。。17号提交了个腾讯平台的XSS，才想起这件事。。经过抓包后发现那个uin参数   就是当前登陆的QQ号修改那个参数后  就OK了修改uin和email内容为要攻击的邮箱地址。。email：代表当前填写的接收反馈信息邮件地址uin：代表当前登录的QQ号综上所述，其实只修改uin就完全OK的。。。    \n     2012-12-22 15:31 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  顺便再补充一个哈，关于cookie劫持的问题，其实登陆别人空间神马的，只需要三个参数，uin  o_cookie  skey最重要的就是skey其他两个可以推出来的o_cookie 这个值填写QQ号就行uin  参数里o开头  o后面必须保证是10位9位数的QQ  前面需要加0凑齐位数  例如：uin=o01234567898位的话应该就是加00    例如:uin=o0012345678说简单点，其实获得了对方的skey，就可以直接登陆对方的空间了，其他两个可以推出来嘛。。难度的问题，就是如何获取对付的skey值。。所以啊，各位客官，下次抓包时候，截图要记得打码哟，，别自己把自己卖喽。。我的就无所谓了，反正是测试账号嘛。。。    \n     2012-12-22 15:36 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @鬼魅羊羔 说那么详细干毛？    \n     2012-12-22 15:38 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @疯子 反正修复了0 0    \n     2012-12-22 15:49 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @疯子 他菊花痒了呗    \n     2012-12-22 15:50 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @小胖胖要减肥 痒了给艹不...给艹十分，不给-10086    \n     2012-12-22 16:16 |    \t\t小智 \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:5        | 低调低调，学习学习~)\t\t \n  @鬼魅羊羔 哈哈，那能做token~也能干很多坏事~    \n     2012-12-23 10:05 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  貌似乌云中礼物给的最好的,就是送了部小米手机吧..    \n     2012-12-23 12:43 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @px1624 这个就不知道了。。。我得的最好的，就是个双肩背包。。金山给的。。    \n     2012-12-23 13:51 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @鬼魅羊羔 我就新浪给了次,三件套...    \n     2012-12-24 00:48 |    \t\tFate \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:5        | www.0hk.org)\t\t \n  @鬼魅羊羔 这次腾讯要给ipad了...    \n     2012-12-24 01:00 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @Fate 你们咋都想要ipad呢，其实这次腾讯99%是给公仔。我问过他们了，他们说礼物肯定让我满意，但是就是不提是什么。。    \n     2012-12-24 10:01 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @鬼魅羊羔 尼玛，没我报道的新闻你这个漏洞没杀伤力，求礼物的一半..    \n     2012-12-24 10:04 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @疯子 如果来公仔，我把公仔的照片给你；如果来了ipad，我把电池给你，我凑合着插电玩吧。。    \n     2013-01-21 04:06 |    \t\t烨少 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        )\t\t \n  好热闹啊，我也来凑热闹了。    \n     2013-01-21 16:40 |    \t\tlsh4ck \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:14        | 不是黑客!但是黑客手段都要会?)\t\t \n  @鬼魅羊羔 冰杰躺抢    \n     2013-02-04 19:22 |    \t\tRootUser \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:5        | null)\t\t \n  我类个去,应该是公仔这次    \n     2013-02-04 21:25 |    \t\tlsh4ck \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:14        | 不是黑客!但是黑客手段都要会?)\t\t \n  1    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}