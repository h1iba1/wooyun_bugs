{"id": 4282, "wybug_id": "wooyun-2014-050816", "wybug_title": "A.sop CMS4.8及以下版本存在任意用户密码重置漏洞", "wybug_corp": "北京航天四创软件公司", "wybug_author": "刺刺", "wybug_date": "2014-02-13 14:31", "wybug_open_date": "2014-05-14 14:32", "wybug_type": "非授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["越权操作", "认证缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-21：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-14：\t细节向公众公开  简要描述： 该漏洞影响的是A.sop CMS 4.8及以下版本，基本上是为http://www.wooyun.org/bugs/wooyun-2010-013964的补充；本来这些版本的用户也没有几个了，加上版本较早，无论是兼容性还是功能性都没有什么亮点，但是还有几个相对有点分量，于是希望cncert能够协调告知。 详细说明：  a.sop CMS4.8以下版本权限控制松散，有很多功能权限的验证采用了js验证，或者是没有验证，其中影响最大的是管理用户部分：比如：http://cms.qingdao.gov.cn:10000/cmsweb/admin/loadUserAttrAction.do?dn=dc=cms,cn=human,sn=1可以直接查看平台超级用户的资料：\n\n这里可以得到超级用户的用户名，变换sn=1的值，可以看到其他的管理用户信息；这里只是个辅助；主要的越权是直接重置用户密码；比如：http://cms.qingdao.gov.cn:10000/cmsweb/admin/resetUserPasswordAction.do?dn=dc=cms,cn=human,sn=1直接get访问以上link，超级用户cmsdev的用户名就会被重置成password（个别的可能存在js验证，你可以通过FF的noscript来验证）继续补充一点，如何获取shell使用重置密码的超级用户cmsdev登录，http://cms.qingdao.gov.cn:10000/cmsweb（由于该系统对浏览器的支持不好，建议你找一个低版本的IE，比如IE6）点击内容管理，进入对应的栏目添加文章，在附件上传那里直接上传jsp脚本即可\n\n上传完成，选择编辑器底部的html查看源码，可以看到上传的jsp脚本路径\n\njsp脚本木马的路径就是http://cms.qingdao.gov.cn:10000/n16858051/n16858711/n28030640.files/n28030645.jsp访问如图：\n\n   漏洞证明：  目前能够搜到的A.sop cms大概有这些,南宁市，合肥市，科协，体育总局，青岛市等等：http://cms.qingdao.gov.cn:10000/cmswebhttp://58.59.136.79:7001/cmsweb/http://58.59.136.81:8000/cmswebhttp://218.21.246.6:7001/cmswebhttp://220.178.124.29:7001/cmswebhttp://210.14.113.47:7001/cmsweb/http://220.178.124.33:7001/cmswebhttp://202.204.24.102:7001/cmswebhttp://cms.qingdao.gov.cn:10000/cmswebhttp://www.qdsn.gov.cn:7001/cmswebhttp://cms.laoshan.gov.cn:7001/cmsweb/http://cms.sport.gov.cn/cmsweb/验证重置科协的后台超级用户密码，password登入：\n\n至于国家体育总局，看看用户信息可以http://cms.sport.gov.cn/cmsweb/admin/loadUserAttrAction.do?dn=dc=cms,cn=human,sn=1重置密码和上传就不验证了。(祝愿中国健儿在本届冬奥会取得更好的成绩！)（其实从别的系统试探过，体育总局部署有WAF的，脚本木马会被拦截的。）   修复方案：  换一款CMS产品吧。价格便宜，功能质量好的有很多。   版权声明：转载请注明来源 刺刺@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-02-18 10:04 厂商回复： CNVD确认并在多个实例上复现所述情况，根据测试结果，已经转由CNCERT向广西、内蒙古、安徽、山东等省份下发处置任务，同时还将继续对可能存在更高层级用户进行测试。如后续有涉及国家部委网站的情况，也请白帽子继续提供。rank 20 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-30 19:41 |    \t\tsec_jtn \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:56        | 本想无耻的刷rank，最后发现是我想太多了。...)\t\t \n  牛逼，都jb怎么找的漏洞    \n     2014-07-31 08:57 |    \t\t刺刺 \t\t\t( 普通白帽子  |\t\t\t        Rank:603 漏洞数:52        | 真正的安全并不是技术，而是人类善良的心灵...)\t\t \n  @sec_jtn 主要是他们的程序代码是早期的，安全方面当时并没有过多的考虑，也就是说用现在现成的测试方法去测试早期的程序，问题肯定也比较明显的。我这样的能力，也就能搞搞这些了。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}