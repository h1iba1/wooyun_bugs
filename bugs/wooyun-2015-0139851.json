{"id": 71782, "wybug_id": "wooyun-2015-0139851", "wybug_title": "最新版Discuz修复不全导致仍可针对管理员存储XSS", "wybug_corp": "Discuz!", "wybug_author": "RickGray", "wybug_date": "2015-09-09 08:53", "wybug_open_date": "2015-12-08 10:36", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-11-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-08：\t细节向公众公开  简要描述： 程序员修漏洞得修完全，不认真就不对了 详细说明：  新版本中修复了在 http://wooyun.org/bugs/wooyun-2010-099979 中所提供的插入点但是由于程序员的疏忽，修复的代码中仍有可用的 shortcode 可以造成 XSS具体的漏洞分析都在 http://wooyun.org/bugs/wooyun-2010-099979 中都有提及，其主要原因是由于 /static/js/bbcode.js 文件中的 bbcode2html() 函数对 shortcode 进行正则替换时，导致可以构造 payload，让编辑器渲染时形成 XSS。通过 diff 前后两个版本可得到 bbcode.js 文件的更新结果：\n\n注意红色框所标注部分，虽然厂商对在 http://wooyun.org/bugs/wooyun-2010-099979 中所提及的 payload 进行了过滤，但是红色标注部分的 shortcode 正则替换仍能造成 XSS。新的 payload 形态为：[email]2\"onmouseover=\"alert(2)[/email]将 payload 作为帖子内容或者评论，在管理员或者有权限人员对包含 payload 的帖子或者评论进行编辑时，利用 onmouseover 触发 JS 执行。\n\n\n\n\n\n   漏洞证明：  \n\n\n\n   修复方案：  不维护了么？还不更新   版权声明：转载请注明来源 RickGray@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-09-09 10:34 厂商回复： 感谢您提出的问题，我们会尽快修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-09-09 08:54 |    \t\t#6c6c6c \t\t\t( 普通白帽子  |\t\t\t        Rank:300 漏洞数:50        | 像一条狗孤独的活着，渴望的活着，绝望的活...)\t\t \n  = =.233    \n     2015-09-09 09:18 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:1324 漏洞数:332        | 乌云有着这么一群人，在乌云学技术，去某数...)\t\t \n  要火的节奏啊！    \n     2015-09-09 09:52 |    \t\t内谁 \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:5        | 我是内谁)\t\t \n  关注下    \n     2015-09-14 03:06 |    \t\tdr.m1st3r \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:5        | o)\t\t \n  mark    \n     2015-09-14 11:07 |    \t\tba1ma0 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 什么都不会..)\t\t \n  666    \n     2015-09-14 16:31 |    \t\tModNar \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 路人甲)\t\t \n  这。。是我发的那个的绕过么    \n     2015-09-17 08:48 |    \t\tNelion \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:20        | 老实，腼腆，潜力股；不谈情，不说爱，只泡...)\t\t \n  mark    \n     2015-12-08 10:38 |    \t\tPzacker \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:5        | 请用你知道的去帮助别人，就像别人当初帮助...)\t\t \n  666666    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}