{"id": 43663, "wybug_id": "wooyun-2014-082096", "wybug_title": "齐博CMS 二次注入2", "wybug_corp": "齐博CMS", "wybug_author": "Power", "wybug_date": "2014-11-07 12:04", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-12：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： 奇博门户v5.0 二次注入 详细说明：  shop\\member\\address.php\nelseif($action==\"postnew\"){\t$db->query(\"INSERT INTO `{$_pre}address` (`uid` ,`order_username` ,`order_phone` ,`order_mobphone` ,`order_email` ,`order_qq` ,`order_postcode` ,`order_address` ) VALUES ('$lfjuid', '$order_username', '$order_phone', '$order_mobphone', '$order_email', '$order_qq', '$order_postcode', '$order_address')\");\trefreshto(\"?job=list\",'',0);}elseif($action==\"edit\"){\tcheckrid($rid);\t$db->query(\"UPDATE `{$_pre}address` SET order_username='$order_username',order_phone='$order_phone',order_email='$order_email',order_qq='$order_qq',order_postcode='$order_postcode',order_address='$order_address',order_mobphone='$order_mobphone' WHERE rid='$rid'\");\trefreshto(\"?job=list\",'',0);}\n这个地方数据插入表qb_shop_address，来看数据表字段\n\n也就是order_emaill,order_address比较大点，应该能够插入足够的数据。\\shop\\join.php中\nif($action==\"postnew\"){\t//自定义字段的合法检查与数据处理\t$Module_db->checkpost($field_db,$postdb,'');\tjoin_post();//此函数判断使用新地址还是旧地址，此处使用旧地址，也就是出库的地方。\tunset($id_array);\tforeach($listdb AS $uid=>$array){\t\t$totalmoney = 0;\t\t$detail='';\t\tforeach($array AS $_rs){\t\t\t$totalmoney+=$_rs[price]*$p_totalArray[$_rs[id]];\t\t\t$detail[] = \"$_rs[id]={$p_totalArray[$_rs[id]]}\";\t\t}\t\t$products = addslashes( implode(',',$detail) );\t\t$rs=$db->get_one(\"SELECT * FROM `{$pre}purse` WHERE uid='$uid'\");\t\t$parray=unserialize($rs[config]);\t\t\t\tif($postdb[order_sendtype]==2){\t\t\t//平邮\t\t\t$totalmoney+=floatval($parray[slow_send]);\t\t}elseif($postdb[order_sendtype]==3){\t//快递\t\t\t$totalmoney+=floatval($parray[norm_send]);\t\t}elseif($postdb[order_sendtype]==4){\t//EMS\t\t\t$totalmoney+=floatval($parray[ems_send]);\t\t}\t\t//$totalmoney = number_format($totalmoney,2);\t\t/*往主信息表插入内容*/\t\t$db->query(\"INSERT INTO `{$_pre}join` ( `mid` , `cid` , `cuid` ,  `posttime` ,  `uid` , `username` , `yz` , `ip` ,  `totalmoney`,`products`) \t\tVALUES (\t\t'$mid' , '$_rs[id]' , '$uid', '$timestamp','$lfjdb[uid]','$lfjdb[username]','0','$onlineip','$totalmoney','$products')\");\t\t$id = $id_array[] = $db->insert_id();\t\tunset($sqldb);\t\t$sqldb[]=\"id='$id'\";\t\t$sqldb[]=\"uid='$lfjuid'\";\t\t\t\t/*检查判断辅信息表要插入哪些字段的内容*/\t\tforeach( $field_db AS $key=>$value){//在$field_db中存在的数组$key,并且在$postdb中同样存在$key的进行赋值成为$sqldb\t\t\tisset($postdb[$key]) && $sqldb[]=\"`{$key}`='{$postdb[$key]}'\";//$postdb[$key]添加单引号\t\t}\t\t$sql=implode(\",\",$sqldb);//将数组中添加\",\"号\t\t$db->query(\"INSERT INTO `{$_pre}content_$mid` SET $sql\");//入库\n截取到此处入库的操作语句为\nINSERT INTO `qb_shop_content_2` SET id='39',uid='39',`order_paytype`='1',`order_address`='jkk',`content`='',`order_phone`='jjj',`order_username`='test2',`order_mobphone`='jjj',`order_email`='1'...\n字段order_address在order_emaill之前，所以要在order_address处set order_emaill的值如果表qb_shop_content_2中的字段够长并且属于同样类型则ok了，来看字段信息。\n\n字段符合，长度够大.   漏洞证明：  此网站躺抢http://www.tongyuxian.com/shop/member/address.php?job=postnew添加新地址，保存。\n\n购买商品，并使用此地址。然后访问个人主页中的控制面板，商城系统，我购买的订单，查看订单详情\n\n   修复方案：  ....   版权声明：转载请注明来源 Power@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}