{"id": 88147, "wybug_id": "wooyun-2016-0189060", "wybug_title": "winmail过滤不严getshell+任意文件下载(需要登录邮箱）                                      ", "wybug_corp": "magicwinmail.com", "wybug_author": "路人甲", "wybug_date": "2016-03-25 22:50", "wybug_open_date": "2016-06-27 10:40", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-01：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-05-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-27：\t细节向公众公开  简要描述： winmail 过滤不严可getshell+任意文件下载 详细说明：  winmail邮箱管理系统过滤不严，导致任意文件上传需要以普通用户身份登录邮箱，登录以后有个网络磁盘功能，随意上传一个文件，选择文件上传！上传urlhttp://xxx.xxx.xxx.xxx:6080/main.php?sessid=5772430e1cd708d2521d9a0dedadd904&act=netdisk&opt=html5upload&ftpfolder=Ly4uLy4uL3dlYm1haWwvd3d3Lw==&retid=0.8386508285207916\n\n\n\n\n\nburpsuit拦截，看到其中有个ftpfolder参数，base64编码的解码后为/，通过修改ftpfolder参数为/../../webmail/www/再base64编码。/对应的原来的目录为 server/netstore/test(用户目录).\n\ngetshell成功！同样的下载文件时修改filename参数跳转到data/adminuser.cfg 可下载管理员用户密码，密码md5加密！/main.php?sessid=6ca89212aceb7b4b6997d3b1b4b9eaf0&act=netdisk&opt=download&ftpfolder=Lw%3D%3D&filename=cGhwaW5mby5waHA%3D&retid=33938934\n\n对应的代码！\ncase 'download':\t$filename = base64_decode($filename);\t$ftpfile = $ftpfolder;\tif (substr($ftpfile, -1) != '/')\t\t$ftpfile .= '/';\t$ftpfile .= $filename;\theader('Content-type: application/force-download');\theader('Content-Disposition: attachment; filename=\"'.$filename.'\"');\t$localfile = $ftphandle->ftp_home_directory.$ftpfile;\t//if(file_exists($localfile))\t\t//die($localfile);  \tif (file_exists($localfile)) {\t\t$length = filesize($localfile);\t\t\t\theader('Accept-Ranges: bytes');\t\theader('Content-Length: '.$length);\t\t$fp = fopen($localfile, \"rb\");\t\tif ($fp){\t\t\twhile(!feof($fp))\t\t\t\techo fread($fp, 655360);\t\t\t\t\t\t\tfclose($fp);\t\t}    }\n都差不多不贴了！   漏洞证明：  用的客户蛮多的，等我找到一个个邮箱进去，或者前台getshell再证明!   修复方案：  过滤用户输入的参数！   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2016-03-29 10:39 厂商回复： CNVD确认并复现所述情况，已由CNVD通过网站管理方公开联系渠道向其邮件通报，由其后续提供修复方案。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-22 11:46 |    \t\tbobo \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:4        | 新开始)\t\t \n  通杀吗？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}