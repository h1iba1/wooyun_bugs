{"id": 49570, "wybug_id": "wooyun-2014-080877", "wybug_title": "qibocms 地方门户系统 二次注入#5(demo测试)", "wybug_corp": "齐博CMS", "wybug_author": "′雨。", "wybug_date": "2014-10-31 11:56", "wybug_open_date": "2015-01-29 11:58", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-29：\t细节向公众公开  简要描述： 二次注入。 详细说明：  在hy/member/homepage_ctrl/pic_fm.php中\nif(count($pids)<1) showerr(\"请选择一张图片\");if(!$psid) showerr(\"请指定一个图集\");foreach($pids as $pid){\tif($pid){\t\t$rt=$db->get_one(\"SELECT url FROM {$_pre}pic WHERE pid='$pid'\");\t\t$db->query(\"UPDATE {$_pre}picsort SET faceurl='$rt[url]' WHERE psid='$psid' AND uid='$uid'\");//这里把出库的带入到了update查询当中 来找找入库的\t\tbreak;\t}}\n入库的地方挺多 随便找一处把在hy/member/homepage_ctrl/pic_upload.php中\nforeach($photoDB[url] AS $key=>$value){\t\tif(!eregi(\"\\.(gif|jpg|jpeg|png|bmp)$\",$value)){\t\t\tdelete_attachment($uid,tempdir($value));//限定结尾必须jpg啥的\t\t\tcontinue;\t\t}\t\t\t$picpath = \"homepage/pic/\".ceil($uid/1000).\"/\";\t\t$picurl = $picpath.basename($value);//basename不影响\t\t\tmove_attachment($uid,tempdir($value),$picpath);\t//图片转移目录与加水印\t\tif(!is_file(ROOT_PATH.\"$webdb[updir]/$picurl\")){\t\t\t$picurl=$value;\t\t}\t\t\t\t$Newpicpath=ROOT_PATH.\"$webdb[updir]/{$picurl}.gif\";\t\tgdpic(ROOT_PATH.\"$webdb[updir]/$picurl\",$Newpicpath,150,150);\t\tif(!is_file($Newpicpath)){\t\t\tcopy(ROOT_PATH.\"$webdb[updir]/{$picurl}\",$Newpicpath);\t\t}\t\t$title = filtrate($photoDB[name][$key]);\t\t$title = get_word($title,32);\t\t\t//echo \"INSERT INTO `{$_pre}pic` (`psid` , `uid` , `username` ,  `title` , `url` , `level` , `yz` , `posttime` , `isfm` , `orderlist`  ) VALUES ('$psid', '$uid', '$lfjid', '$title', '$picurl', '0', '1', '$timestamp', '0', '0')\";exit;\t\t$db->query(\"INSERT INTO `{$_pre}pic` (`psid` , `uid` , `username` ,  `title` , `url` , `level` , `yz` , `posttime` , `isfm` , `orderlist`  ) VALUES ('$psid', '$uid', '$lfjid', '$title', '$picurl', '0', '1', '$timestamp', '0', '0')\"); //这里把$picurl 带入到了insert当中 入库\t\t$ck++;\n首先入库一个。\n\n转义入库。 然后 \n\n出库 导致注入。构造一下。\n\n转义入库 这里我把语句输出一下。然后 出库。/hy/member/homepage_ctrl.php?atn=pic_fm&pids[]=45&psid=3313\n\n出数据。demo 测试:\n\n入库出库\n\n构造一下 可以看update哪个column 出数据的。   漏洞证明：  \n\n   修复方案：  出库转义。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-10-31 15:44 厂商回复： 感谢提出来 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-31 11:57 |    \t\tPythonPig \t\t\t( 普通白帽子  |\t\t\t        Rank:491 漏洞数:71        | 只会简单工具的小小菜)\t\t \n  雨牛冲破1000大关    \n     2014-10-31 12:06 |    \t\t′雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n         算了  放弃了。。  全都是上首页后马上就下首页。   本来还以为能靠这几个破1000rank。    结果全部小厂商。      又不是同一种代码造成的注入，     @Finger 后面几个不用急着通过了，  麻烦牛牛了，            还是好好读书了 闪人。    \n     2014-10-31 12:14 |    \t\tki11y0u \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:23        | 好好学习，求带飞~~~~~~~~~~~~~~~~~~~~~~...)\t\t \n  @′雨。 雨牛，威武，好好读书吧。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}