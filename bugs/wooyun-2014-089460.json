{"id": 46779, "wybug_id": "wooyun-2014-089460", "wybug_title": "湖南省医疗系统严重运营风险(可至全省上万基层医疗机构瘫痪,大量个人就诊信息资料泄露)", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "superbing", "wybug_date": "2014-12-31 09:48", "wybug_open_date": "2015-02-14 09:50", "wybug_type": "账户体系控制不严", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["弱口令", "用户敏感信息泄露", "认证设计不合理", "敏感功能直接对外", "认证缺陷", "内部系统对外"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-14：\t细节向公众公开  简要描述： 标题有点吓人，但并不夸张，卫生院、医院、药店等受波及！老规矩抽白沙烟日站。湖南省医疗系统严重运营风险,可至全省上万基层医疗机构瘫痪,千万级个人就诊信息资料泄露 详细说明：   WooYun: 湖南省某卫生管理系统1万多个医疗点帐号密码泄漏，数据库密码泄漏 乌云君表示为“已经修复”经过仔细搜索找到了新入口，也就是说压根没修复，换了个IP而已。我家在农村，你别把我信息泄露了哈，赶紧发出来补补！别被坏人利用了！希望这次补好哈！上次报太简单了，这次稍微深入点，不然你不修复！   漏洞证明：  描述下过程1：首先http://222.240.205.104/wwwroot.rar 下载打包2：解压3：改VIP目录下 hisonline.aspx（最新的那个）为hisonline.mdb4：去掉MDB密码，浏览hospinfo表，导出为excl\n\n5：根据hospinfo表中的 hosppwd 字段和hospitalcode 字段 爆破 \n\n得到密码为000的医疗机构11235个，基本都验证了下，几个不同的返回长度对应的是权限都测试过了的。\n\n为了以后公开漏洞不造成太大影响我这里只贴出部分，审核漏洞的如果想确认个数可以自己下载wwwroot.rar，打开hisonline.mdb或者私下联系我获取那1万个弱口令账号。\n系统高权限测试账号代表yzshis  000\n\n\n\n卫生院账号代表账号：430181310601 密码：000 2层账号：001 2层密码：000\n\n\n\n医院账号代表431127204  000  管理员  2层账号：001 2层密码：000\n\n\n在给出一些账号，好测试。\n430181040501\t2708\tASP.NET_SessionId=x4ixvt55lbmje0fz0ndkf1mp; path=/; HttpOnly430181050601\t2708\tASP.NET_SessionId=m5pzltipuocfyl45coajuj45; path=/; HttpOnly430181051002\t2708\tASP.NET_SessionId=bevfivi3oub02d553xkhn5qf; path=/; HttpOnly430181051101\t2708\tASP.NET_SessionId=m4txd545apq1xsy1xrs5qd45; path=/; HttpOnly430181100101\t2708\tASP.NET_SessionId=dbjk01i3xlizgtn2rxizyp45; path=/; HttpOnly430181100201\t2708\tASP.NET_SessionId=0jzvowqcznotgl55in53eu45; path=/; HttpOnly430181100301\t2708\tASP.NET_SessionId=okkybovyi20votjqnoklwmyc; path=/; HttpOnly430181100401\t2708\tASP.NET_SessionId=mcdfurelllkex555yv4zhh55; path=/; HttpOnly430181100501\t2708\tASP.NET_SessionId=dsdsanymusvyw5iiixp32d45; path=/; HttpOnly430181130201\t2708\tASP.NET_SessionId=rpg5ns55ilckv245fasemy55; path=/; HttpOnly430181130401\t2708\tASP.NET_SessionId=4tfwa155a5pvjumtn23s2e45; path=/; HttpOnly430181130501\t2708\tASP.NET_SessionId=ibgqiirvfqijpaa4lhx1lg55; path=/; HttpOnly430181130601\t2708\tASP.NET_SessionId=puqmrp45kmvjqzy0sizggc45; path=/; HttpOnly430181130901\t2708\tASP.NET_SessionId=is2i3x55jwtfq245bfsm2a55; path=/; HttpOnly430181131001\t2708\tASP.NET_SessionId=14kxge55ulgoml45z2yf0b45; path=/; HttpOnly430181131201\t2708\tASP.NET_SessionId=ha4rn455rlehnfvp3o5wfh55; path=/; HttpOnly430181131601\t2708\tASP.NET_SessionId=ohxg1qmbigdf5uri1fhosbeu; path=/; HttpOnly430181140006\t2708\tASP.NET_SessionId=xmstgk55bba5bivyai3plf55; path=/; HttpOnly430181140801\t2708\tASP.NET_SessionId=d2m4emav1ofbnz45o4h0ko45; path=/; HttpOnly430181140901\t2708\tASP.NET_SessionId=h03l5mvv1kak1d55el3gga2c; path=/; HttpOnly430181141101\t2708\tASP.NET_SessionId=gne0tc45qsvwyl55zjqw0ymq; path=/; HttpOnly430181141501\t2708\tASP.NET_SessionId=k01zsejbxeqzgq555n1lnx55; path=/; HttpOnly430181160701\t2708\tASP.NET_SessionId=jqwywdv4ieidskmlkxlenb45; path=/; HttpOnly430181170301\t2708\tASP.NET_SessionId=us5wgmfdznlxqs45rdzgf445; path=/; HttpOnly430181180201\t2708\tASP.NET_SessionId=0hlk0h45p35ol3zq32hvji45; path=/; HttpOnly430181180801\t2708\tASP.NET_SessionId=nwrs3b55lzlrte55atgx11a3; path=/; HttpOnly430181181001\t2708\tASP.NET_SessionId=pao0pcvlgz2exm45fszwdj45; path=/; HttpOnlyrdhis\t2584\tASP.NET_SessionId=3yfju32bxgio2c55tkv4qmmg; path=/; HttpOnlyA230500A018\t2587\tASP.NET_SessionId=3nnhw0zijuvazy2ztthjlg45; path=/; HttpOnly430202100\t2588\tASP.NET_SessionId=oqsofh55pbzk5nzbdkv2enet; path=/; HttpOnly430202201\t2595\tASP.NET_SessionId=rgyu3y455o0mj345hvm22045; path=/; HttpOnly430203108\t2595\tASP.NET_SessionId=nvbehb2bbraobk55fljhqlzx; path=/; HttpOnly430203211\t2595\tASP.NET_SessionId=he2vaz45acfnxpibdtm2zwuk; path=/; HttpOnly430211101\t2595\tASP.NET_SessionId=pqy4as45vxbl01b3afv52ofu; path=/; HttpOnly430211105\t2595\tASP.NET_SessionId=hos5fo45quor2ymdgyz2b1ro; path=/; HttpOnlyyzshis\t2599\tASP.NET_SessionId=2yfg2b45dvpv1g45c23qyzma; path=/; HttpOnlyzzshis\t2599\tASP.NET_SessionId=olmc3tn331nnqm45axugiy55; path=/; HttpOnly\n其实说了这么多，后来我发现这个账号其实是可以绕过的，那么受威胁的就不是11235个，而是12802个（截止13年的那个MDB）。以\nhttp://113.240.245.42/simpmzora/x32_application.htm?A430124simpmz&430124251702\n为例子，这个是登陆1层密码后成功返回的地址，我发现这个是可以根据hisonline.mdb 中的 dbcache 字段构造出来的。比如卫生院的账号是：430124251702 我查询下 hisonline.mdb中的dbcache 数据是 A430124simpmz直接构造成\nhttp://113.240.245.42/simpmzora/x32_application.htm?A430124simpmz&430124251702\n 就可以免第一层登陆了，是不是很happy？ 呵呵。最后说明下标题，为什么我说可以瘫痪全省上万基层医疗机构呢？因为可以改药价，可以改处方，可以乱报农合。。。。等等。。自己看吧为什么是千万级个人就诊信息资料泄露呢？随便登陆个卫生院、医院之类的 每天的病人我就打10个 或者说5个，大家算算这么些年这么多机构能有多少数据。我也不好确认这系统我不敢搞坏了，数据密码和地址人家写到hisonline.mdb 里面清清楚楚 pym 和 datapwd 字段，可是要内网，我就是为了刷个分没必要进去确认了。千万级真保守了！只是查起来不方便点，卫生院能调到县级以内的患者数据。要查分开查吧。\n\n\n\n怕审核的看着这么乱的介绍头大，简单描述下登陆流程：弹窗拦截插件要关掉，登陆后那窗口是弹出来的。登陆过程中提示的插件要全装上，如果要调用户就诊、病例等数据提示的exe也得装上。1层默认密码 000 2层默认账号 001 密码 000 ，1层是医院的，2层是医院用户的。来记录登陆流程图。1层\n\n2层小权限的话是这样的：\n\n2层大权限的话是这样的：\n\n   修复方案：  这个我也说不好了，直接丢给开发商吧，反正卫生厅出了钱的。   版权声明：转载请注明来源 superbing@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-01-05 08:07 厂商回复： CNVD确认并复现所述情况,已经转由CNCERT下发给湖南分中心,由其后续协调网站管理单位处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-02-14 19:47 |    \t\tidcspy \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | idcspy)\t\t \n  祝兄弟羊年天天都抽芙蓉王。    \n     2015-02-15 09:30 |    \t\tBMa \t\t\t( 普通白帽子  |\t\t\t        Rank:1776 漏洞数:200        )\t\t \n  @idcspy 至少得中华吧    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}