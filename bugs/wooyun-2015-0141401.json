{"id": 84811, "wybug_id": "wooyun-2015-0141401", "wybug_title": "百度软件管理可信路径劫持", "wybug_corp": "百度", "wybug_author": "路人甲", "wybug_date": "2015-09-17 10:48", "wybug_open_date": "2015-12-20 15:12", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计不当", "客户端程序设计错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-24：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-11-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-20：\t细节向公众公开  简要描述： 百度软件管理进程创建参数设置不当，导致路径截断，一共两处。 详细说明：  漏洞1：调用CreateProcess这个API时，由于没有使用双引号包围参数路径，导致创建进程时路径截断，直接运行C:\\Program.exe程序。漏洞2：创建的服务项BDSoftMgrSvc指定的ImagePath由于没有使用双引号包围参数路径，导致服务启动时路径截断，直接以SYSTEM权限运行C:\\Program.exe程序。   漏洞证明：  测试版本：**.**.**.**4（官方最新版本，更新日期为2015-07-13），截图如下：\n\n安装百度软件管理到操作系统上，随后放一个名为Program.exe的程序到C盘根目录下，比如复制C:\\Windows\\System32\\calc.exe到C:\\Program.exe。双击桌面图标打开百度软件管理，可以看到先后创建了两个Program.exe进程，其中一个以SYSTEM权限启动，如下图所示：\n\nBDSoftMgr的子进程创建参数为（没有双引号）：\nC:\\Program Files\\Baidu\\BaiduSoftMgr\\**.**.**.**4\\BDSWAcc.exe 2564 393842 394442 65617\nSYSTEM权限启动的Program.exe进程是因为服务项中的ImagePath没有使用双引号造成的，如下图所示：\n\n注册表位置为：HKEY_LOCAL_MACHINE下的SYSTEM\\CurrentControlSet\\Services\\BDSoftMgrSvc，键名为ImagePath，键值没有双引号：\nC:\\Program Files\\Baidu\\BaiduSoftMgr\\**.**.**.**4\\BDSoftMgrSvc.exe\n   修复方案：  请使用双引号包围进程路径，包括CreateProcess的参数以及系统服务项的ImagePath参数。其中CreateProcess的位于BDSWHomePage.dll的sub_5F931870函数中，如下图所示：\n\n   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-09-21 15:10 厂商回复： 感谢提交 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}