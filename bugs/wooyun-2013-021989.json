{"id": 11271, "wybug_id": "wooyun-2013-021989", "wybug_title": "SDCMS后台绕过直接进入,一种不常见的设计失误案例", "wybug_corp": "SDCMS（时代网站信息管理系统）", "wybug_author": "ziwen", "wybug_date": "2013-04-24 12:19", "wybug_open_date": "2013-07-23 12:20", "wybug_type": "非授权访问/认证绕过", "wybug_level": "中", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "设计不当导致攻击界面扩大", "认证缺陷", "盲目信任用户数据", "认证设计不合理", "欺骗", "安全", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-04-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-04-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-06-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-06-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-07-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-07-23：\t细节向公众公开  简要描述： SDCMS后台绕过直接进入：测试版本2.0 beta2 其他版本未测试 详细说明：  \nIslogin //判断登录的方法sub islogin()if sdcms.strlen(adminid)=0 or sdcms.strlen(adminname)=0 then dim t0,t1,t2 t0=sdcms.getint(sdcms.loadcookie(\"adminid\"),0) loadcookie t1=sdcms.loadcookie(\"islogin\")t2=sdcms.loadcookie(\"loginkey\")if sdcms.strlen(t0)=0 or sdcms.strlen(t1)=0 or sdcms.strlen(t2)<>50 then //这里判断很坑爹 sdcms.strlen(t2)<>50 loginkey 没有任何要求 只需要输入50个即可往下执行//sdcms.go \"login.asp?act=out\"exit subelsedim datadata=sdcms.db.dbload(1,\"adminid,adminname,adminpass,islock,groupid,g.pagelever,g.catearray,g.catelever\",\"sd_admin u left join sd_admin_group g on u.groupid=g.id\",\"adminid=\"&t0&\"\",\"\") //根据管理员ID查询 ID可控if ubound(data)<0 thensdcms.go \"login.asp?act=out\"exit subelseif instr(data(1,0)&data(2,0),sdcms.decrypt(t1,t2))<0 or data(3,0)=0 thensdcms.go \"login.asp?act=out\"exit subelseadminid=data(0,0)adminname=data(1,0)admin_page_lever=data(5,0)admin_cate_array=data(6,0)admin_cate_lever=data(7,0)if sdcms.strlen(admin_page_lever)=0 then admin_page_lever=0if sdcms.strlen(admin_cate_array)=0 then admin_cate_array=0if sdcms.strlen(admin_cate_lever)=0 then admin_cate_lever=0if clng(admingroupid)<>0 thenadmin_lever_where=\" and menuid in(\"&admin_page_lever&\")\"end ifsdcms.setsession \"adminid\",adminidsdcms.setsession \"adminname\",adminnamesdcms.setsession \"admingroupid\",data(4,0)end ifend ifend ifelsedata=sdcms.db.dbload(1,\"g.pagelever,g.catearray,g.catelever\",\"sd_admin u left join sd_admin_group g on u.groupid=g.id\",\"adminid=\"&adminid&\"\",\"\")if ubound(data)<0 thensdcms.go \"login.asp?act=out\"exit subelseadmin_page_lever=data(0,0)admin_cate_array=data(1,0)admin_cate_lever=data(2,0)if sdcms.strlen(admin_page_lever)=0 then admin_page_lever=0if sdcms.strlen(admin_cate_array)=0 then admin_cate_array=0if sdcms.strlen(admin_cate_lever)=0 then admin_cate_lever=0if clng(admingroupid)<>0 thenadmin_lever_where=\" and menuid in(\"&admin_page_lever&\")\"end ifend ifend ifend sub\n   漏洞证明：  看看操作COOKIE的函数\npublic function loadcookie(t0)loadcookie=request.cookies(prefix&t0)end functionpublic sub setcookie(byval t0,byval t1)response.cookies(prefix&t0)=t1end subprefix'变量前缀，如一个空间下多次使用本程序的话，请每个程序配置不同的值dim prefixprefix=\"1Jb8Ob\"'这个值访问一下admin/login.asp?act=out 便可得到 在COOKIE里 sub outsdcms.setsession \"adminid\",\"\"sdcms.setsession \"adminname\",\"\"sdcms.setsession \"admingroupid\",\"\"sdcms.setcookie \"adminid\",\"\"sdcms.setcookie \"loginkey\",\"\"sdcms.setcookie \"islogin\",\"\"sdcms.go \"login.asp\"end sub\n利用方法：设置cookie prefixloginkey 50个字符 prefixislogin 随意 循环下prefixadminid 即可 默认1 然后访问后台，就可以了！   修复方案：  修改函数！   版权声明：转载请注明来源 ziwen@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-04-24 13:59 厂商回复： 打开lib/cmd.asp找到“if instr(data(1,0)&data(2,0),sdcms.decrypt(t1,t2))<0 or data(3,0)=0 then”修改为if instr(data(1,0)&data(2,0),sdcms.decrypt(t1,t2))<=0 or data(3,0)=0 then即可同时：可以更改默认的后台目录PS：感谢ziwen  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-04-17 15:20 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  何种不常见法？    \n     2013-04-18 21:18 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  @瘦蛟舞 乌云给我改的题目，我也不知道    \n     2013-04-25 08:47 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @ziwen 洞主，13岁？有才哦。是啊乌云偶尔会改标题    \n     2013-05-03 12:26 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  有洞主联系说该漏洞是在t00ls被转载的，是姐么个情况么，是的话俺就加个来源了啊    \n     2013-05-06 21:19 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  @xsser 首先他们是从我这转载的!如果我是转载的话乌云是不会收录的！而且SDCMS官方也已经和我构成联系了，这绝对是我首发！还有，我有个问题很奇怪，你说的加来源是什么意思？    \n     2013-05-10 07:18 |    \t\t海。 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:3        | 前进的道路也许坎坷,但阻挡不住我们的热情!)\t\t \n  围观ing    \n     2013-05-15 09:07 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @ziwen 上头那有一个来源。    \n     2013-05-16 22:09 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  @wefgod ？    \n     2013-05-17 08:58 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @ziwen 漏洞来源：\t http://www.wooyun.org    \n     2013-05-17 21:09 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  @wefgod 去你的    \n     2013-05-17 22:16 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @ziwen ……这位朋友几岁？我只是说你上面说的“加来源”是什么意思而已，你自己不清楚，别人回复你你还这样说话？如果是一个小朋友，那我也没什么可说了，千万别说你已成年了啊    \n     2013-05-17 22:43 |    \t\txcloud \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 我要奖品。)\t\t \n  @wefgod     他不知道@xsser 。。。    \n     2013-05-17 23:52 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  @wefgod 好吧，年龄在上面写着，我13    \n     2013-05-17 23:52 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  @xcloud 说很多遍了，这是我自己找到的    \n     2013-05-18 08:28 |    \t\txcloud \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:1        | 我要奖品。)\t\t \n  @ziwen 你这是要吓尿我吗?真的年龄是很大问题，脑袋还是没法转弯，@xsser 是乌云的管理员，没人说不是你找到的，只是问一下你啊，他的意思是如果不是就加一个来源。    \n     2013-05-19 18:34 |    \t\tQQ852451559 \t\t\t( 实习白帽子  |\t\t\t        Rank:79 漏洞数:18        | 学生党)\t\t \n  没有硝烟的战场。    \n     2013-06-07 21:25 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  @QQ852451559 HEHE    \n     2013-07-21 13:57 |    \t\tHuc-Unis \t\t\t( 普通白帽子  |\t\t\t        Rank:1055 漏洞数:292        | 诶，现在通用奖励越来越低了；离买保时捷卡...)\t\t \n  @ziwen咋不邪恶出EXP来哦    \n     2013-07-23 09:04 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  @Huc-Unis 哈哈 有兴趣可以来www.garwen.net玩阿 这里漏洞很多东西也很多    \n     2014-02-10 16:50 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  @wefgod 去年不懂事刚入乌云 今天看到这些觉得做得很不对 跟你道个歉 对不起了    \n     2014-02-10 17:01 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @ziwen 哦这个没事。我都忘记了哈哈    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}