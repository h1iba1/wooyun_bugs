{"id": 18519, "wybug_id": "wooyun-2012-010675", "wybug_title": "IdeaCMS_XDAY", "wybug_corp": "天一方网络科技", "wybug_author": "mOon", "wybug_date": "2012-08-08 11:06", "wybug_open_date": "2012-08-08 11:06", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-08-08：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2012-08-08：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 简介:IdeaCMS网站内容管理系统是主要服务于中小企业的CMS内容管理系统，一般的开发人员能够使用系统提供的模块以最低的成本、最少的人力投入在最短的时间内架设一个功能齐全、性能优异的网站平台。 　　IdeaCMS是基于ASP+Access/ASP+MSSQL开发的网站内容管理系统，这样一般的开发人员都能比较轻松的掌握本系统。目前本系统集成了简介类模块，新闻类模块，产品类模块，视频类模块，图片类模块，下载类模块。并且有评论，订单，应聘等插件供选择。并支持生成静态网站，方便搜索引擎收录。 　　本系统从2007年发布至今经历了1.0，1.1，2.0，3.0，4.0四个版本，受到了许多用户的肯定以及市场的检验，并不断吸收来自各方面的发展建议和成功经验，其功能不断完善和发展，目前系统不仅适用于企业网站，也适合门户、政府、学校、以及其他各种资讯类网站使用。  详细说明：  \n<!--#include file=\"../inc/Main_Class.asp\"--><%'****************************************************'Code for IdeaCMS'****************************************************dim action,str,page,sql,MesTitle,LinkName,Content,validcode,Company,Address,Telephone,Email,backaction=filterPara(getForm(\"action\",\"get\")) : str=filterPara(getForm(\"str\",\"get\")) : page=filterPara(getForm(\"page\",\"get\"))MesTitle=filterPara(getForm(\"MesTitle\",\"post\")) : LinkName=filterPara(getForm(\"LinkName\",\"post\")) : Content=codeTextarea(filterPara(getForm(\"Content\",\"post\")),\"en\")Company=filterPara(getForm(\"LinkComp\",\"post\")) : Address=filterPara(getForm(\"LinkAddr\",\"post\")) : Telephone=filterPara(getForm(\"LinkTel\",\"post\")) : Email=filterPara(getForm(\"LinkEmail\",\"post\"))back=\"GuestBook.asp\"if action=\"add\" then    if isNul(Content) then alertback \"内容为空！\"    validcode = replace(filterPara(getForm(\"input_yzm\",\"post\")),\"'\",\"\")\tif Session(\"GetCode\")<>validcode then\t    alert \"验证码错误！\",back\telse\t\tsql=\"insert into {pre}GuestBook(MesTitle,LinkName,Content,Company,Address,Telephone,Email) values('\"&MesTitle&\"','\"&LinkName&\"','\"&Content&\"','\"&Company&\"','\"&Address&\"','\"&Telephone&\"','\"&Email&\"')\"\t\tconn.db sql,\"0\"\t\tif err then err.clear : alert \"留言添加失败\",back else if cint(guestmode)=1 then alert \"留言添加成功,将在审核后显示!\",back else alert \"留言添加成功!\",back\tend ifend ifif isNul(page) then \tpage=1 else \tif isNum(page) then page=clng(page) else alert \"参数错误！\",backend ifdim templateobj,channelTemplatePath : set templateobj = mainClassobj.createObject(\"MainClass.template\")dim channelTemplateName,channelStrchannelTemplatePath = PubPath(\"guestbook.html\")with templateObj : .load(channelTemplatePath) : .parseComm() : .parseColumn() : .parseChannel(\"\") : .parseList 0,page,\"guestlist\",\"\" : .parseIf() : channelStr = .content : end withif str=\"签写留言\" then    channelStr = replace(channelStr,\"id=guestlist>\",\"id=guestlist style=display:none>\")\tchannelStr = replace(channelStr,\"id=guestwrite style=display:none>\",\"id=guestwrite>\")end ifEcho channelStrset templateobj =nothing : terminateAllObjects%>跟踪getForm 和 filterParaFunction getForm(element,mtype)\tSelect case mtype\t\tcase \"get\"\t\t\tgetForm=trim(request.QueryString(element))\t\tcase \"post\"\t\t\tgetForm=trim(request.Form(element))\t\tcase else\t\t\tif isNul(request.QueryString(element)) then getForm=trim(request.Form(element)) else getForm=trim(request.QueryString(element))\tEnd SelectEnd Function去掉空格继续跟踪函数Function filterPara(byVal Para)    filterPara=preventSqlin(filterStr(Para,\"jsiframe\"))End Function先来看看Function preventSqlin(content)\tdim sqlStr,sqlArray,i,speStr\tsqlStr=\"%27|*|and|exec|dbcc|alter|drop|insert|select|update|delete|count|master|truncate|char|declare|where|set|declare|mid|chr\"\tif isNul(content) then Exit Function\tsqlArray=split(sqlStr,\"|\")\tfor i=lbound(sqlArray) to ubound(sqlArray)\t\tif instr(lcase(content),sqlArray(i))<>0 then alertback \"你提交的数据含非法字符\" : Exit Function\tnext\tpreventSqlin=contentEnd Function你还想注入么????再看'去除html格式Function filterStr(Byval str,Byval filtertype)\tif isNul(str) then  filterStr = \"\" : Exit Function\tdim regObj, outstr,rulestr : set regObj = New Regexp\tregObj.IgnoreCase = true : regObj.Global = true\tSelect case filtertype\t\tcase \"html\"\t\t\t\trulestr = \"(<[a-zA-Z].*?>)|(<[\\/][a-zA-Z].*?>)\"\t\tcase \"jsiframe\"\t\t\trulestr = \"(<(script|iframe).*?>)|(<[\\/](script|iframe).*?>)\"\tend Select\tregObj.Pattern = rulestr\toutstr = regObj.Replace(str, \"\")\toutstr=replace(outstr,\"{ideacms:page}\",\"\")\toutstr=replace(outstr,\"&nbsp;\",\"\")\tset regObj = Nothing : filterStr = outstrEnd Function这是过滤html么\n绕过之<style/onload=alert(/welcome to my blog www.moonhack.org by mOon/)>   漏洞证明：  \n\n   修复方案：  各种过滤！！！！！   版权声明：转载请注明来源 mOon@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}