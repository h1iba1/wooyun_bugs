{"id": 22264, "wybug_id": "wooyun-2011-02822", "wybug_title": "WiiNews(Mobile新闻系统) -- 注入漏洞", "wybug_corp": "wiipu微普科技", "wybug_author": "路人甲", "wybug_date": "2011-09-14 21:56", "wybug_open_date": "2011-09-14 22:20", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射", "注射技巧", "防注入程序绕过", "源码审核", "注射漏洞利用技巧", "防注入绕过"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-09-14：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2011-09-14：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 漏洞文件:newsDetail.php漏洞类型:sql注入漏洞漏洞发现:Fa1c0nSql注射漏洞，爆出数据库结构， 主机相关信息，导致信息泄漏，导致大量用户信息泄漏。 详细说明：  代码片段:\" ?>$id=sqlReplace(Trim($_GET['id']));$sqlStr=\"select * from wiinews_news where news_id=$id\";$result = mysql_query($sqlStr) or die (\"查询失败，请检查SQL语句。编码号：1010\");$row = mysql_fetch_array($result);..........后面代码省略...$id=sqlReplace(Trim($_GET['id']));我们看下sqlReplace函数做了些什么代码片段:function sqlReplace($str){$strResult = $str;if(!get_magic_quotes_gpc())//如果gpc没有开的话{$strResult = addslashes($strResult);//编码}return HTMLEncode($strResult);//gpc开的话，返回HTMLEncode()}function HTMLEncode($str){if (!empty($str)){$str=str_replace(\"&\",\"&\",$str);$str=str_replace(\">\",\">\",$str);$str=str_replace(\"<\",\"<\",$str);$str=str_replace(CHR(32),\" \",$str);$str=str_replace(CHR(9),\"    \",$str);$str=str_replace(CHR(9),\"    \",$str);$str=str_replace(CHR(34),\"\"\",$str);$str=str_replace(CHR(39),\"'\",$str);$str=str_replace(CHR(13),\"\",$str);$str=str_replace(CHR(10),\"\",$str);}//看到了,只拦截了引号，空格，并没有拦截类似and,select的函数return $str;}   漏洞证明：  我们可以构造newsDetail.php?id=1+AND+1=1来进行sql注入。   修复方案：  多做过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：5 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 5, "Ranks": null}