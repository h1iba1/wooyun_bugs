{"id": 44248, "wybug_id": "wooyun-2015-099892", "wybug_title": "方格子网吧模拟构造特定封包可修改客户端信息、游戏行为、点击量，进而伪造服务端数据", "wybug_corp": "上海网恒文化传播有限公司", "wybug_author": "战争贩子", "wybug_date": "2015-03-06 19:30", "wybug_open_date": "2015-04-30 18:48", "wybug_type": "非授权访问/认证绕过", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["入侵", "客户端", "修改", "网吧", "协议", "模拟"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-06：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-04-30：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 网吧装有方格子产品环境下。通过伪造多个特定TCP及UDP客户端封包，对服务端进行欺骗。从而达到刷数据，非法上线等功能、控制服务端数据的目的。 详细说明：  第一步 与服务端建立链接\n\n服务端变化： \n\n第二步 伪造信息\n\n服务端变化：\n\n第三步 模拟游戏点击/运行\n\n点击之前 \n\n点击之后 \n\n   漏洞证明：  #pragma pack(1)typedef struct _TAGPACKET_ //250字节 上线包分析结果{\tBYTE PacketLen[2];\tBYTE UnkownBuffer[254];\tBYTE Tag[4];}*PTAGPACKET,TAGPACKET;\ttypedef struct _HOSTINFOPACKET_ //信息包分析结果{\tBYTE PacketLen[2];\tBYTE UnkownBuffer1[2];\tCHAR Hostname[81];\tCHAR szMac[19];\tCHAR Version1[8];\tBYTE UnkownBuffer2[16];\tCHAR Version2[8];\tBYTE UnkownBuffer3[16];\tCHAR Version3[24];\tDWORD dwUnkownRescue;//好像是防火墙\tbyte UnkownReserve[4];//未知4字节,有两字节填充\tbyte UnkownReserve2[4];//未知1字节\tbyte Driver[28]; //如果UnkownTwoByte第三位不为2为磁盘还原开关，如果为0这三位都为还原盘符\tbyte UnkownTwoByte[3]; //\\x01\\x01 缓冲区和还原是否启用的开关 第三位 还原盘符的数量\tbyte UnkownBuffer4[42];//未知74字节的0 \tBYTE UnkownWord; //0x67}*PHOSTINFO,STHOSTINFO;typedef struct _GAMECOUNTPACKET_ //游戏点击{\tBYTE PacketLen[2];\tBYTE UnkownBuffer1[2];\tDWORD GameID;//游戏ID\tbyte Unkown[8];   //0x01\tbyte UnkownBuffer[16];//一段常量 未知作用\tCHAR szMac[82];\tBYTE UnkownBuffer3[142];//未知\tDWORD UnkownTag; //0XFFFFFFFF}*PGAMECOUNT,STGAMECOUNT;typedef struct _UDPCOUNTPACKET_{\tBYTE PacketLen[2];\tBYTE UnkownBuffer1[2];\tCHAR GameInfoBuffer[248];//游戏名称和MAC地址拼起来的字符串\tDWORD GameID;//游戏ID\tbyte UnkownBuffer2[6];}*PUDPCOUNT,STUDPCOUNT;点击使用的UDP 64300端口 TCP为5000端口    修复方案：  心跳包 Tag结构都不完善 希望加上非对称加密部分。   版权声明：转载请注明来源 战争贩子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：8 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n     2015-03-06 19:30 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  这个漏洞好强大    \n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 8, "Ranks": null}