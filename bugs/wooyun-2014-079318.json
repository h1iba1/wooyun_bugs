{"id": 49997, "wybug_id": "wooyun-2014-079318", "wybug_title": "yxcms host header attack 获取用户重置密码的token", "wybug_corp": "yxcms.net", "wybug_author": "路人甲", "wybug_date": "2014-10-16 16:39", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-21：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： drops文档实例。利用HTTP host头攻击的技术。需要交互。 详细说明：  原理参考：http://drops.wooyun.org/papers/1383 \n}else{           $setmes=in($_POST['backname']);           if(empty($setmes)) $this->error('填写信息不全~');           switch ($_POST['type']) {             case 'acc':               if(!Check::userName($setmes)) $this->error('非法账户名~');               $info=model('members')->find(\"account='{$setmes}'\",'email');               if(empty($info)) $this->error('账户不存在~');               $url='http://'.$_SERVER['HTTP_HOST'].url('member/index/getpassword',array('code'=>urlencode(cp_encode($setmes,config('ENCODE_KEY'),600))));               echo $url;               $email=new Email(config('EMAIL'));               $email->send($info['email'],config('sitename').'密码重置','请点击以下链接以重置密码~<br><a href=\"'.$url.'\">重置密码</a>');               $this->success('请到邮箱查看邮件~',url('index/getpassword'));               break;             case 'email':               if(!Check::email($setmes)) $this->error('邮箱格式错误~');               $list=model('members')->select(\"email='{$setmes}'\",'account');               if(empty($list)) $this->error('该邮箱未注册~');               $email=new Email(config('EMAIL'));               foreach ($list as $vo) {                 $url.=\"<a href='http://\".$_SERVER['HTTP_HOST'].url('member/index/getpassword',array('code'=>urlencode(cp_encode($vo['account'],config('ENCODE_KEY'),600)))).\"'>重置：\".$vo['account'].\"&nbsp;的密码</a><br>\";               }               $email->send($setmes,config('sitename').'密码重置','请点击以下链接以重置密码~<br>'.$url);               $this->success('请到邮箱查看邮件~',url('index/getpassword'));               break;             default:               $this->error('错误的类型~');               break;\n注意：$url='http://'.$_SERVER['HTTP_HOST'].url('member/index/getpassword',array('code'=>urlencode(cp_encode($setmes,config('ENCODE_KEY'),600))));\n\n重置密码连接里的域名会变成别人控制的域名，用户点击之后，token就发送给他人控制的服务器上了。\n\n   漏洞证明：  \n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}