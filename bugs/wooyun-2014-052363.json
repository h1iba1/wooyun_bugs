{"id": 58084, "wybug_id": "wooyun-2014-052363", "wybug_title": "CSDJCMS程式舞曲最新版Sql 一枚", "wybug_corp": "chshcms.com", "wybug_author": "′雨。", "wybug_date": "2014-03-04 10:50", "wybug_open_date": "2014-06-02 10:51", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-07：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-02：\t细节向公众公开  简要描述： 看到官网上又更新了 2014-2-25 加强了SQL安全注入。特别感谢白帽子：（′ 雨。、C4nf3ng、Jim叔叔、寂寞的瘦子、lxj616   ）对程序的漏洞检测。 还感谢了各白帽子啊 还不错。那就继续挖挖? 详细说明：  在user\\pay.php中\npublic function tenpay_return_url() {         require_once (CSCMSPATH.\"tenpay/ResponseHandler.class.php\");        $resHandler = new ResponseHandler();        $resHandler->setKey($key);        //判断签名        if($resHandler->isTenpaySign()) {\t        //通知id\t        $notify_id = $resHandler->getParameter(\"notify_id\");\t        //商户订单号\t        $out_trade_no = $resHandler->getParameter(\"out_trade_no\");\t        //财付通订单号\t        $transaction_id = $resHandler->getParameter(\"transaction_id\");\t        //如果有使用折扣券，discount有值，total_fee+discount=原请求的total_fee\t        $discount = $resHandler->getParameter(\"discount\");\t        //支付结果\t        $trade_state = $resHandler->getParameter(\"trade_state\");\t        //交易模式,1即时到账\t        $trade_mode = $resHandler->getParameter(\"trade_mode\");\t        if(\"1\" == $trade_mode ) {\t\t        if( \"0\" == $trade_state){                                 $row=$this->db->query(\"select CS_RMB from \".CS_SqlPrefix.\"pay where CS_Dingdan='\".$out_trade_no.\"'\")->row();                                if(!$row){                                        $this->CsdjSkins->Msg_url('验证失败,该定单不存在!',site_url('user'));                                 }                                $this->CsdjSkins->Msg_url('恭喜您，成功充值了 '.$row->CS_RMB.' 元，若出现问题请尽快联系客服,请牢记您的定单号：'.$out_trade_no.'!',site_url('user')); \t\t        } else {\t\t\t        //当做不成功处理\t\t\t        echo \"<br/>\" . \"即时到帐支付失败\" . \"<br/>\";\t\t        }\t        }elseif( \"2\" == $trade_mode  ) {\t\t        if( \"0\" == $trade_state) {\t\t\t        echo \"<br/>\" . \"中介担保支付成功\" . \"<br/>\";\t\t        } else {\t\t\t        echo \"<br/>\" . \"中介担保支付失败\" . \"<br/>\";\t\t        }\t        }        } else {\t        echo \"<br/>\" . \"认证签名失败\" . \"<br/>\";\t        echo $resHandler->getDebugInfo() . \"<br>\";\ngetParameter 就相当request把?这里是没有过滤的。  但是有点验证。\nfunction isTenpaySign() {\t\t$signPars = \"\";\t\tksort($this->parameters);\t\tforeach($this->parameters as $k => $v) {\t\t\tif(\"sign\" != $k && \"\" != $v) {\t\t\t\t$signPars .= $k . \"=\" . $v . \"&\";\t\t\t}\t\t}\t\t$signPars .= \"key=\" . $this->getKey();\t\t\t\t$sign = strtolower(md5($signPars));\t\t\t\t$tenpaySign = strtolower($this->getParameter(\"sign\"));\t\t\t\t\t\t//debug信息\t\t$this->_setDebugInfo($signPars . \" => sign:\" . $sign .\t\t\t\t\" tenpaySign:\" . $this->getParameter(\"sign\"));\t\t\t\treturn $sign == $tenpaySign;\t\t\t}\n相等即可。Come and Sql it.   漏洞证明：  \n\n官网测试成功。还可以充值任意金额。   修复方案：  Check it.   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-03-04 13:57 厂商回复： 非常感谢~！已经修复~！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}