{"id": 10713, "wybug_id": "wooyun-2013-027138", "wybug_title": "图虫网重置密码hash算法破解可导致重置任意用户密码", "wybug_corp": "图虫网", "wybug_author": "VIP", "wybug_date": "2013-06-28 21:02", "wybug_open_date": "2013-08-12 21:02", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-06-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-06-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-07-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-07-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-07-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-12：\t细节向公众公开  简要描述： 许多网站也存在同样的问题，hash算法过于简单，导致轻易就能被破解。 详细说明：  首先重置下密码，收到了一封邮件，重置密码地址是：\nhttp://tuchong.com/account/reset/?code=1372415571&sign=9c4a3cab666fcddfdcec52a0d87ff73f&email=smtp_admin%40yeah.net\ncode是时间戳，email是我的邮箱，那么，sign是什么呢？手贱测试了下，拿1372415571smtp_admin@40yeah.net去cmd5加密，结果正是9c4a3cab666fcddfdcec52a0d87ff73f!!!所以，图虫的hash算法应该是\n$sign=md5($code.$email);\n从此，图虫的重置密码hash算法已被攻破。为了证明这个漏洞，我再次执行了一次找回密码接下来，并且打开Chrome审查元素功能，记下找回密码后服务器返回数据的时间（格林尼治时间，须在基础上+8小时）。\n\n然后打开在线工具，把时间转换成时间戳\n\n得到时间戳为1372423073拿1372423073smtp_admin@yeah.net去cmd5加密，结果为790f0f42e5dcb3e00977ece88c0f50bc这样，重置密码的三个参数都有了。构造url:http://tuchong.com/account/reset/?code=1372423073&sign=790f0f42e5dcb3e00977ece88c0f50bc&email=smtp_admin%40yeah.net\n\n\n\n构造重置密码链接的过程中，并没有登录邮箱查看邮件。现在我们登录邮箱，看看收到的链接是不是一样的？\n\n完全一致   漏洞证明：  以上已证明   修复方案：  1.将加密算法复杂化，例如\n$sign=md5(md5($code).md5(md5(rand()).$email));\n2.采用RSA等高强度算法，增加攻击成本。   版权声明：转载请注明来源 VIP@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-06-28 22:31 厂商回复： 你们真是太牛逼了。。。md5都能反向。。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-06-28 21:21 |    \t\t带馅儿馒头 \t\t\t( 普通白帽子  |\t\t\t        Rank:1278 漏洞数:143        | 心在，梦在)\t\t \n  mark    \n     2013-06-28 22:49 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  @VIP 记得一年前都测试过找回密码连接。 MD5 用户名和*Unin时间戳？？？  不靠谱啊 ！ 大侠 能私信科普下么？ 曾经测试两个不成功 WooYun: 奇虎360任意用户密码修改漏洞   求教育 大侠。    \n     2013-06-29 00:19 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @图书网 一般登录的加密都直接在源码中可以看到，或者在js中压缩写入了。理论上是肯定可以得到算法的，如果你只用了一次md5那种的话，肯定就悲剧了呗。。    \n     2013-06-29 01:51 |    \t\t唐尸三摆手 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:9        | 摆手啊摆手啊摆手！！)\t\t \n  厂商回复亮了    \n     2013-06-29 02:08 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  厂商回复亮了    \n     2013-06-29 09:53 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  厂商回复亮瞎了。。。    \n     2013-06-29 10:41 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  @px1624 是在php加密的，不过太简单了，一试就试出来了    \n     2013-06-29 17:49 |    \t\tf0r \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:12        | 寻声暗问弹者谁？那人却在灯火阑珊处)\t\t \n  @VIP 8986fe9371b02d18求目测    \n     2013-06-29 19:06 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  @f0r 参与加密的有什么？    \n     2013-06-30 01:20 |    \t\t佩佩 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 一个热衷于网络安全的白帽子,具有很强的逻...)\t\t \n  厂商回复亮瞎了。。。     \n     2013-06-30 22:45 |    \t\tf0r \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:12        | 寻声暗问弹者谁？那人却在灯火阑珊处)\t\t \n  @VIP 只是好奇厂商说的反向md5。。。    \n     2013-07-01 23:52 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  哈哈，亲爱的，我来看你了。。。    \n     2013-07-02 07:13 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  @小胖子 恭喜发财    \n     2013-07-18 23:00 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  。。。这个只能说是运气好刚好碰上了。。如果开发人员稍微手贱一点 $sign=md5($code.$email.\"tushu.com\");那个估计洞主打死都破解不出来。    \n     2013-07-19 20:02 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  太神奇了，，，，\"MD5都能反向\"，，，，    \n     2013-07-29 00:27 |    \t\t半世倾尘 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 努力)\t\t \n  学习了 小学生放假不做作业啊    \n     2013-07-29 09:59 |    \t\t核攻击 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:7        | 统治全球，奴役全人类！毁灭任何胆敢阻拦的...)\t\t \n  Nice!    \n     2013-07-29 10:03 |    \t\tletboy \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:33        | 其实学点技术比较实在！)\t\t \n  厂商回复也用牛逼二字，给跪了    \n     2013-07-30 09:26 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n  厂商卖萌    \n     2013-07-30 21:53 |    \t\tF4K3R \t\t\t( 普通白帽子  |\t\t\t        Rank:297 漏洞数:31        | 学习)\t\t \n  mark!    \n     2013-07-31 17:41 |    \t\tnmeia \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        | 这个人很懒，什么都没有留下。)\t\t \n  厂商卖萌    \n     2013-08-12 21:04 |    \t\tBlack Angel \t\t\t( 普通白帽子  |\t\t\t        Rank:163 漏洞数:35        | 最神奇的一群人，智慧低调又内敛，俗称马甲...)\t\t \n  厂商卖萌。    \n     2013-08-12 22:23 |    \t\t园长 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:14        | 你在身边就是缘，缘分写在数据库里面。)\t\t \n  同样的思路我试过算企鹅XXX的Hash，几种组合都没成功。    \n     2013-08-12 22:43 |    \t\tLxai \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:8        )\t\t \n  厂商回复好给力。。    \n     2013-08-13 04:10 |    \t\t邪少 \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:7        )\t\t \n  你们真是太牛逼了。。。 md5都能反向。。    \n     2013-08-13 10:15 |    \t\txsjswt \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:49        | 我思故我猥琐，我猥琐故我强大)\t\t \n  洞主理解有误了，rsa不一定就是高强度算法。算法没有强弱之分，有强弱之分的是使用算法的方法和协议。    \n     2013-08-13 10:27 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  @xsjswt 感谢教育    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}