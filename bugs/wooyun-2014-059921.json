{"id": 2388, "wybug_id": "wooyun-2014-059921", "wybug_title": "74CMS设计缺陷可能导致任意用户密码重置", "wybug_corp": "74c,s.com", "wybug_author": "xfkxfk", "wybug_date": "2014-05-08 16:27", "wybug_open_date": "2014-08-06 16:28", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "设计缺陷", "敏感接口缺乏校验", "源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-06：\t细节向公众公开  简要描述： 74CMS存在设计缺陷，导致可重置任意用户密码 详细说明：  文件/user/user_getpass.php\n//找回密码第2步elseif ($act=='get_pass'){\t$captcha=get_cache('captcha');\t$postcaptcha = trim($_POST['postcaptcha']);\tif($captcha['verify_getpwd']=='1' && empty($postcaptcha))\t{\t\tshowmsg(\"请填写验证码\",1); \t}\tif ($captcha['verify_getpwd']=='1' &&  strcasecmp($_SESSION['imageCaptcha_content'],$postcaptcha)!=0)\t{\t\tshowmsg(\"验证码错误\",1);\t}\t$postusername=trim($_POST['username'])?trim($_POST['username']):showmsg('请输入用户名！',1);\tif (empty($_POST['email']) || !preg_match(\"/^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$/\",$_POST['email']))\t{\tshowmsg('电子邮箱格式错误！',1);\t}\trequire_once(QISHI_ROOT_PATH.'include/fun_user.php');\t$userinfo=get_user_inusername($postusername);\tif (empty($userinfo) || $userinfo['email']<>$_POST['email'])\t{\tshowmsg('用户名或注册邮箱填写错误',1);\t}\telse\t{\t\t\t$mailconfig=get_cache('mailconfig');\t\t\t$arr['username']=$userinfo['username'];\t\t\t$arr['password']=rand(100000,999999);\t\t\t\tif (smtp_mail($userinfo['email'],\"找回密码\",\"您的新密码为：\".$arr['password']))\t\t\t\t{\t\t\t\t\t$md5password=md5(md5($arr['password']).$userinfo['pwd_hash'].$QS_pwdhash);\t\t\t\t\tif (!$db->query( \"UPDATE \".table('members').\" SET password = '$md5password'  WHERE uid='{$userinfo['uid']}'\"))\t\t\t\t\t{\t\t\t\t\tshowmsg('密码修改失败',1);\t\t\t\t\t} \t\t\t\t\t$smarty->assign('step',\"2\");\t\t\t\t\t$smarty->assign('email',$userinfo['email']);\t\t\t\t\t$smarty->assign('title','找回密码 - '.$_CFG['site_name']);\t\t\t\t\t$smarty->display('user/getpass.htm');\t\t\t\t}\t\t\t\telse\t\t\t\t{\t\t\t\t\tshowmsg('邮件发送失败，请联系网站管理员',0);\t\t\t\t}\t}}\n当输入用户名和email之后就会发送新密码到email然后新密码是6位纯数字：$arr['password']=rand(100000,999999);所以导致在知道用户名和email的情况下课爆破处用户的新密码。再者就是，对于用户名和email，因为这是人才系统，在用户简历中存在用户名和email信息只要注册企业用户就能看到用户的用户名和email等信息，为重置密码提供便捷。如图：\n\n最后就是剩下的，来爆破重置之后的密码了，因为此系统安装后默认是不开启登陆验证码的，就算开启验证码我们也可以进行爆破。接口：http://localhost/74cms/wap/wap_login.php\n\n   漏洞证明：  找回用户111111的密码：\n\n然后来爆破密码：\n\n成功得到用户新密码   修复方案：  加强用户的新密码负责度   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-05-09 15:17 厂商回复： 感谢您对骑士的支持 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-08 17:23 |    \t\trootnmxx \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        )\t\t \n  等的就是这个    \n     2014-05-08 17:59 |    \t\t夜 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:4        | 小夜，一个苦逼程序员)\t\t \n  等的就是这个    \n     2014-05-09 08:42 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  等的就是这个    \n     2014-05-10 14:02 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  唉 发了3个74的注入全部忽略。 洞主运气不错啊,竟然确认了。@骑士人才系统  你很叼。    \n     2014-05-16 22:43 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  靠!    \n     2014-08-06 17:05 |    \t\tf1t2y \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:3        | 为人驱使者为奴,为人尊处者为客)\t\t \n  等的就是这个    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}