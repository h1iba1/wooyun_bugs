{"id": 53404, "wybug_id": "wooyun-2014-067779", "wybug_title": "某管理系统通用SQL注入漏洞（源码分析+实例演示）", "wybug_corp": "Cncert国家互联网应急中心", "wybug_author": "sex is not show", "wybug_date": "2014-07-08 12:23", "wybug_open_date": "2014-10-06 12:24", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-06：\t细节向公众公开  简要描述： 涉及几十家大型百货商场、 上首页可好 详细说明：  开发公司：青岛海信智能商用股份有限公司（http://www.hisense.com）程序名称：供应链管理系统漏洞类型：SQL注入(post类型)漏洞文件：ScmUser/Login.aspx漏洞参数：tbUserCode是否需要登录：否关键字：海信供应链管理系统/供应链管理系统. Ver:3.5.5影响用户：几十家吧搜集一些用户列表\n中泽商业物流供应链管理系统http://123.235.56.106:8080/(S(ygruigzv3w5c2f55zlxcmk45))/ScmUser/Login.aspx中山市及时便利连锁有限公司-供应链管理系统http://125.92.248.29:8888/(S(l4b0tw45zawtsk55atajfn55))/ScmUser/Login.aspx海宁华联供应链管理系统http://218.75.63.158:8001/ScmUser/Login.aspx泰安凌云经贸有限公司供应链管理系统http://221.1.178.18:8080/ScmUser/MainFrom.aspx 招远金都百货供应链管理系统http://221.214.208.51/(S(zgka40n2fydrmibazhstkd55))/ScmUser/MainFrom.aspx鑫利精品生活超市供应链管理系统http://shangjia.jqxlsc.com/scmuser/login.aspx东营商业大厦供应链管理系统http://58.57.130.134/scmuser/login.aspx青 岛 海 信 广 场http://sup.hisense-plaza.com/scmuser/login.aspx星力百货供应链管理系统http://scm.xinglico.com:8888/ScmUser/Login.aspx利客来供应链管理系统http://124.129.157.189:90/ScmUser/Login.aspxhttp://60.209.125.94:8123/ScmUser/Login.aspx乌海市通用时代广场供应链管理系统http://120.193.178.207/(S(jzibo545a1zgogq1rwodti45))/ScmUser/Login.aspx青岛会生活商贸有限公司供应链管理系统http://supply.granvida.cn/(S(axxlwr45iexaqk55abp2wm45))/ScmUser/Login.aspx山东圣豪供应链管理系统http://119.185.1.162:8088/(S(c5grpx55mnz0sp45hrne0p55))/ScmUser/Login.aspx富万家商贸有限责任公司供应链管理系统http://114.135.67.38:81/(S(k3bqrr55hmivwz4505f2j145))/ScmUser/Login.aspx\n列表不全... 太多了，复制的手酸代码分析片段：点击登录按钮\nprotected void btnLogin_Click(object sender, EventArgs e){    this.str = \"\";    StringBuilder builder = new StringBuilder();    builder.Append(\"<script language=javascript>\");    if (base.Request.Cookies[\"HiCadreCheckCode\"].Value != this.tbCheckCode.Text.ToUpper())    {        this.str = \"验证码校验失败！\";        builder.Append(\"alert('\" + this.str + \"');\");        builder.Append(\"</script>\");        this.Page.RegisterStartupScript(\"MessageBox\", builder.ToString());        return;    }    try    {        this.LoginOperator = new HiLogin();        this.UserCode = this.tbUserCode.Text.ToString();        this.LoginOperator.UserCode = this.UserCode;        this.Pwd = this.tbPassword.Text.ToString();        this.LoginOperator.UserPwd = Crypt.MD5hash(this.Pwd);        int num = this.LoginOperator.LoginValidated(); //进入LoginValidated（）        int num2 = 0;        ///.....省略无关代码\n继续看LoginValidated()方法：\npublic int LoginValidated(){    if (this._User.IsExistThisUser(this._UserCode))//这里判断，并且带入usercode参数    {        if (this.IsPasswordOK())        {            return 1;        }        return 3;    }    return 2;}\n继续IsExistThisUser函数：\npublic bool IsExistThisUser(string UserCode){    string str = \"Select UserName From tScmUser Where UserCode = '\" + UserCode + \"'\";    ///usercode参数未过滤，直接带入查询，注入产生    _Command.CommandText = str;    if (_Command.ExecuteScalar() == null)    {        return false;    }    return true;}\n   漏洞证明：  实例演示：####1：中泽商业物流供应链管理系统http://123.235.56.106:8080/(S(ygruigzv3w5c2f55zlxcmk45))/ScmUser/Login.aspx\n\n\n\n###2：中山市及时便利连锁有限公司-供应链管理系统http://125.92.248.29:8888/(S(l4b0tw45zawtsk55atajfn55))/ScmUser/Login.aspx\n\n\n\n####3：海宁华联供应链管理系统http://218.75.63.158:8001/ScmUser/Login.aspx\n\n\n\n###4：泰安凌云经贸有限公司供应链管理系统http://221.1.178.18:8080/ScmUser/MainFrom.aspx\n\n\n\n####5： 招远金都百货供应链管理系统http://221.214.208.51/(S(zgka40n2fydrmibazhstkd55))/ScmUser/Login.aspx\n\n表：\n\n   修复方案：  参数过滤   版权声明：转载请注明来源 sex is not show@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：17  确认时间：2014-07-12 22:43 厂商回复： CNVD确认所述情况，通过公开渠道暂未能联系上软件生产厂商，待后续再联系处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 17, "Ranks": null}