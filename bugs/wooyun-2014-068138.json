{"id": 53300, "wybug_id": "wooyun-2014-068138", "wybug_title": "TurboMail邮件系统任意文件读取漏洞（需管理权限）", "wybug_corp": "TurboMail", "wybug_author": "error", "wybug_date": "2014-07-11 10:50", "wybug_open_date": "2014-10-09 10:52", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["文件包含漏洞"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-09：\t细节向公众公开  简要描述： TurboMail邮件系统处理日志文件时未对文件路径进行判断，导致可读取服务器上的任意文件。 详细说明：  邮件后台管理进行“WEB日志查看”时存在任意文件读取漏洞。漏洞代码位于TomcatLogAjax.class，其中getLog函数读取web服务器日志文件的源代码实现如下：publicstatic void getLog(HttpServletRequest request, HttpServletResponse response)    throws ServletException, IOException{    MailSession ms = WebUtil.getms(request,response);    if (ms == null) {      AjaxUtil.ajaxFail(request, response,\"info.nologin\", null);      return;    }    UserInfo userinfo = ms.userinfo;    if (userinfo == null) {      AjaxUtil.ajaxFail(request, response,\"info.loginfail\", null);      return;    }    String logPath = getLogPath();    String subType =WebUtil.getParameter(request, true, \"subType\");    if ((subType != null) &&(\"getLogList\".equals(subType))) {      getLogList(request, response, logPath);      return;    }    StringsLogFile = WebUtil.getParameter(request, true, \"logFile\");    …..//此处省略N行    try{     FiletempFile = new File(logPath + SysConts.FILE_SEPARATOR + sLogFile);     //漏洞点，直接拼接      if (!tempFile.exists()) {        AjaxUtil.ajaxFail(request, response,\"info.ajax.fail\", null);        return;      }      bb.clear();      fis = new RandomAccessFile(tempFile,\"r\");      if (bReverse) {        long lFileLen = fis.length();        fis.seek(lFileLen);        bsLine = ReadLineInput.RReadLine(fis, false,lo, bb, temp_bs);      } else {        bsLine = ReadLineInput.ReadLine(fis,false, lo, bb, temp_bs);      }getLog函数在处理用户传递的参数logFile时未进行安全路径的检测导致可以使用../进行读取服务器上的任意文件。   漏洞证明：  使用邮箱管理员账号登陆邮箱管理后台，进行邮件“日志查看”，选择“web服务器日志”\n\n\n\nhttp请求包如下：\n\n使用burpsuit修改http请求包的logFile参数为../../../../../../../../../../../../../windows/win.ini：\n\n可以发现已经成功读取服务器上的文件：\n\n测试下读取c:/boot.ini：\n\n\n\n   修复方案：  禁止读取的文件名包含/和\\   版权声明：转载请注明来源 error@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-07-16 09:59 厂商回复： CNVD暂未直接复现（需要较强认证前提），由CNVD通过以往建立的处置联系渠道向软件生产厂商通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-17 09:39 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  您好！    感谢您对CNVD的支持，请您提供下登录地址及管理员账号、密码。以便CNVD及时验证、处置。谢谢！    祝好！    \n     2014-07-19 20:05 |    \t\terror \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:96        )\t\t \n  @cncert国家互联网应急中心 亲，我是本地搭建测试。官网下载地址：http://www.turbomail.org/download.html     \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}