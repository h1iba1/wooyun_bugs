{"id": 1782, "wybug_id": "wooyun-2014-062300", "wybug_title": "Jcms越权导致数据篡改和注入", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "矿主", "wybug_date": "2014-05-29 10:45", "wybug_open_date": "2014-08-27 10:46", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏认证"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-27：\t细节向公众公开  简要描述： Jcms未授权页面访问导致数据篡改和SQL注入。 详细说明：  大汉修补漏洞做了不少努力，修补了很多问题，但是还有不少的问题，用户量大慢慢来吧，一起努力吧。\n\n   漏洞证明：  数据篡改：\n\n\n//源文件setup/opr_initjcmsdb.jsp //程序开始执行，没有任何权限限制，直接能够访问。 //获取动态参数，没有任何过滤，直接传入参数。  String main_ip = Convert.getParameter( request,\"jcms_ip\");  String main_port = Convert.getParameter( request,\"jcms_port\");  String main_dbname = Convert.getParameter( request,\"jcms_dbname\");  String main_user = Convert.getParameter( request,\"jcms_user\");  String main_pwd1 = Convert.getParameter( request,\"jcms_pwd1\");  //数据库类型s  String dbtype = Convert.getParameter( request,\"dbtype\");  int ndbtype = Convert.getStringValueInt( dbtype );  String appname = Convert.getParameter( request,\"appname\",\"jcms\");  String strRealPath = application.getRealPath(\"\");   //创建表,初始化数据 ，能够导致关键信息被覆盖。  jcms.sys.Install install = new jcms.sys.Install( strRealPath );  boolean bl = install.setDBServer( ndbtype,main_ip,main_port,main_dbname,main_user,main_pwd1,appname );  String strMessage = \"\";  //......strMessage = \"创建失败,请查看日志文件!\";//......\nSQL注入：\n\n\n//菜单管理页面setup/opr_updatenewmenu.jsp //程序开始执行，没有任何权限限制，直接能够访问。 //获取动态参数，没有任何过滤，直接传入参数。 String action = request.getParameter(\"action\"); String menuid = Convert.getParameter(request,\"vc_menuid\"); String menuname = Convert.getParameter(request,\"vc_menuname\"); String menuurl = Convert.getParameter(request,\"vc_menuurl\"); String c_grade = Convert.getParameter(request,\"c_grade\",\"2\");\t //默认2 String parentid = Convert.getParameter(request,\"vc_parentid\");//后面开始各种插入查询数据库语句，能够直接控制数据库。 if(\"do\".equals(action)){  //插入 admin的菜单 webid=0  strSql = \"INSERT INTO merp_pub_usermenu (vc_userid,vc_menuid,vc_menuname,vc_menuurl,c_grade,\"    +\" i_order,vc_parentid,c_enable,n_visitnum,i_webid) VALUES (\"    +\"'admin','\"+menuid+\"','\"+menuname+\"','\"+menuurl+\"','\"+c_grade+\"',\"    +\"99,'\"+parentid+\"','1',0,0)\";  Manager.doExcute(strAppID,strSql);  //插入 def的菜单 webid=0  strSql = \"INSERT INTO merp_pub_usermenu (vc_userid,vc_menuid,vc_menuname,vc_menuurl,c_grade,\"    +\" i_order,vc_parentid,c_enable,n_visitnum,i_webid) VALUES (\"    +\"'def','\"+menuid+\"','\"+menuname+\"','\"+menuurl+\"','\"+c_grade+\"',\"    +\"99,'\"+parentid+\"','1',0,0)\";  Manager.doExcute(strAppID,strSql);    //......  //取出已设置菜单的用户   strSql = \"select distinct vc_userid from merp_pub_usermenu where i_webid =\"+webid+\" \";  //......  //程序中已经提示删除本文件了，但是基本都没有删除。  out.println(\"<br><font color=red>执行完毕，请立刻删除本文件[./setup/update/opr_updatenewmenu.jsp]!</font><br>\");\n   修复方案：  限制访问权限，添加过滤机制，注意加强新版本的权限验证问题。卖这么多套产品，有这么多用户了，多增加一些安全投入吧。   版权声明：转载请注明来源 矿主@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-05-29 14:49 厂商回复： 感谢关注 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-18 15:23 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  居然没有漏洞验证只有代码就可以了啊？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}