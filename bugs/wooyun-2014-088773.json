{"id": 47147, "wybug_id": "wooyun-2014-088773", "wybug_title": "同程旅游某服务配置不当getshell入内网并泄露内网结构", "wybug_corp": "苏州同程旅游网络科技有限公司", "wybug_author": "杀器王子", "wybug_date": "2014-12-26 14:36", "wybug_open_date": "2015-02-03 13:53", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-03：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 休息好几天了，活动活动 详细说明：  http://61.155.159.159/cacti/cacti系统61.155.159.159 ftp空密码访问\nftp> ls229 Entering Extended Passive Mode (|||12888|)150 Opening ASCII mode data connection for file list-rw-r--r--   1 root     root       653445 Jun 26  2014 6.7-nconf-tianyan-memcached.20140626.tgzdrwxr-xr-x   2 root     root         4096 Jun 17  2014 AUTOdrwxr-x---   5 mysql    yunwei       4096 Jun 27  2014 DBI-1.609-rw-r--r--   1 root     root       510309 Feb 25  2014 DBI-1.609.tar.gzdrwxr-xr-x   3 root     root         4096 Jun 17  2014 FTPdrwxr-xr-x   3 ftp      ftp          4096 Dec 26 02:01 ftp-rw-r--r--   1 root     root            0 Dec 25 22:59 move_log.log-rw-r--r--   1 root     root          441 Jan 22  2013 my.cnf-rw-r--r--   1 root     root     23595610 Jun 17  2014 mysql-5.5.3-m3.tar.gzdrwxr-xr-x   5 1000     1000         4096 Jun 27  2014 mysqlsla-2.03-rw-r--r--   1 root     root        33674 Nov 11  2008 mysqlsla-2.03.tar.gz226 Transfer completeftp> ls ftp229 Entering Extended Passive Mode (|||50775|)150 Opening ASCII mode data connection for file list-rw-r--r--   1 ftp      ftp        137364 Jan 16  2014 DBD-mysql-4.026.tar.gz-rw-r--r--   1 ftp      ftp       1643615 Dec 11  2013 cacti-20131211160701.sql.gzdrwxr-xr-x   6 1000     users        4096 Jun 18  2014 cacti-spine-0.8.7g-rw-r--r--   1 ftp      ftp        592801 Jul  9  2010 cacti-spine-0.8.7g.tar.gz-rw-r--r--   1 ftp      ftp       7200529 Aug 30  2013 httpd-2.2.22.tar.gz-rw-r--r--   1 ftp      ftp       4716070 Sep  5  2013 libiconv-1.13.1.tar.gz-rw-r--r--   1 ftp      ftp       1335178 Sep  5  2013 libmcrypt-2.5.8.tar.gz-rw-r--r--   1 ftp      ftp        471915 Sep  5  2013 mcrypt-2.6.8.tar.gz-rw-r--r--   1 ftp      ftp        931437 Sep  5  2013 mhash-0.9.9.9.tar.gz-rw-r--r--   1 ftp      ftp      23595610 Sep  4  2013 mysql-5.5.3-m3.tar.gz-rw-r--r--   1 ftp      ftp       5955981 Jul 19  2012 net-snmp-5.6.2.tar.gz-rw-r--r--   1 ftp      ftp        201339 Sep  5  2013 php-5.2.17-fpm-0.5.14.diff.gz-rw-r--r--   1 ftp      ftp      11801597 Sep  5  2013 php-5.2.17.tar.gz-rw-r--r--   1 ftp      ftp       1345477 Jul  5  2010 rrdtool-1.4.4.tar.gz226 Transfer completeftp>\n下载cacti-20131211160701.sql.gz文件\n\n解出admin密码 cacti@17u登陆后使用cacti的命令执行getshell\n\ncacti系统中监控了内网的大部分运维重要系统。\n\n   漏洞证明：  有了cacti nagios 和zabbix也是内网监控必不可少的部分本机mysql中存在nagios的数据库，同样有内网的结构。查看本机配置/usr/local/nagios/etc/nrpe.cfg定位nagios位置allowed_hosts=127.0.0.1,61.155.159.159,172.16.6.7,61.155.159.211,192.168.2.211127.0.0.1,61.155.159.159,172.16.6.7,为本机61.155.159.211,192.168.2.211为nagios机器访问之\n\n恩 棒棒的随便打开一个nagios 需要401认证根据刚才的cacti密码 成功猜到nagios的密码nagios/nagios@17u并且所有ngios通杀\n\n那么 xxxx@17u在内网可以通杀多少呢 应该不少   修复方案：  关闭未授权访问 健壮内网口令   版权声明：转载请注明来源 杀器王子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-12-26 14:44 厂商回复： 感谢关注同程旅游，已在火速处理。 最新状态： 2014-12-27：唉，最近被刷了好多洞，我都没有测到，心里挺难受的。这一个月天天主动加班，老婆晚上问我，你不会出轨了吧  ( ・ω・)✄╰ひ╯下午我们做了应急响应，在修复了白帽子报告的问题后。顺势把这次看作成一次演习，讨论了下哪些地方缺监控，哪些地方要去关注异常。快速过了一遍防火墙配置，用Ansible+Lynis对所有Linux机器做了一次简单的审计。还是有发现的，有机器允许root登陆，SELinux配置问题，mysql空密码，有些软件包要排计划升级...这事儿主要责任在我，21 1433 3306 3389 6379 11211 27017等高危端口，当初是写了个脚本放在腾讯云上的一台虚拟机监控的，但是这些端口一般也不会向公网开放，一个又一个月过去了，虚拟机过期关闭了也没注意到。防火墙还是要收口到安全部门，要不然这种“黑盒”的监控不确定因素太多。cacti这个事情，运维这边平常本来也很忙，升级挺麻烦的。我说至少覆盖下那个php文件，当时好像也没poc，没办法验证，后来也就忘记了... 这补丁管理没做好，不能怪别人。通知到了不算，一定要验证。密码的事情我已经不想再说了，说了很多很多次... 我的建议是用Keepass+Btsync来做团队的密码管理方案。希望大家吸取我的教训，我也会继续更新这次暴露出的问题后续的处理供大家参考、自查。 2015-02-03：公开公开  ", "replys": "漏洞评价：\n评论\n     2014-12-26 14:37 |    \t\ts0mun5  \t\t\t( 普通白帽子  |\t\t\t        Rank:493 漏洞数:24        | .)\t\t \n  人民币玩家又来了    \n     2014-12-26 14:37 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  人民币玩家又来了    \n     2014-12-26 14:54 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  @苏州同程旅游网络科技有限公司 处理速度和态度是最好的，说明该企业很重视企业安全和用户信息安全，而且正视问题    \n     2014-12-27 16:02 |    \t\tCoffee \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:15        | Corie, a student of RDFZ.)\t\t \n  厂商态度给个赞！    \n     2014-12-27 20:15 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  应该号召厂商学习一下贵公司对安全处理的态度，不掩盖，正视问题，快速处理，而且很得当，良心企业    \n     2014-12-28 21:02 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  厂商态度给个赞！    \n     2015-01-05 13:01 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  这个厂商是想做乌云厂商的标杆么，不错幺    \n     2015-01-05 13:13 |    \t\t草榴社区 \t\t\t( 普通白帽子  |\t\t\t        Rank:109 漏洞数:26        | 未满18周岁,不准进入.)\t\t \n  赞.厂商不错.    \n     2015-01-05 13:13 |    \t\t杀器王子  \t\t\t( 普通白帽子  |\t\t\t        Rank:1532 漏洞数:121        | 磨刀霍霍向猪羊)\t\t \n  @苏州同程旅游网络科技有限公司 礼物收到了啊 私信点了确认了    \n     2015-01-06 19:51 |    \t\tloli  \t\t\t( 普通白帽子  |\t\t\t        Rank:550 漏洞数:52        )\t\t \n  不会是打着补漏洞的借口出轨吧，哈哈哈    \n     2015-01-08 00:45 |    \t\tMartes \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:3        | 人若无名，便可专心练剑)\t\t \n  甲方做安全，盘子大，问题多，没话语权推不动真心累啊  哎    \n     2015-01-21 20:42 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  厂商的回复是给老婆看的么？    \n     2015-01-27 20:49 |    \t\tACGT \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:4        | another script kiddie)\t\t \n  看到厂商对运维安全的理解还停留在封端口、打补丁的时代，我就放心了    \n     2015-01-28 16:53 |    \t\t疯子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:42        | 世人笑我太疯癫，我笑世人看不穿~)\t\t \n  @ACGT 求给个进步的方法    \n     2015-02-03 13:49 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @ACGT 半路出家，望赐教    \n     2015-02-03 14:31 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  厂商态度给个赞！    \n     2015-02-03 17:06 |    \t\tilll \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:9        | 轻吟一句情话，执笔一副情画。绽放一地情...)\t\t \n  点赞    \n     2015-02-03 22:47 |    \t\tcuger \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:44        | 这个家伙很懒，什么也没留下)\t\t \n  @苏州同程旅游网络科技有限公司 良心厂商啊，赞一个！    \n     2015-02-05 17:21 |    \t\thblf \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:2        | 甲方安全攻城狮一枚)\t\t \n  @苏州同程旅游网络科技有限公司 兄弟有没有考虑在内部用电子流程跟踪问题，比如这个洞涉及到的“覆盖下那个php文件，当时好像也没poc，没办法验证”，在内部oa建个漏洞跟踪流程，发现一个洞你就启一个流程，下一节点设成相关开发，修补好了再流回你这里验证，验证通过了流程close。中间可以根据实际情况抄送相关领导。大概就是这么个意思。用流程的好处大大的，省的你自己手工记录，做相关数据统计什么的也方便，尤其年底需要向老板“邀功”时候，哈哈。    \n     2015-02-05 17:26 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @hblf 有jira，不过没有真的在用jira走流程。    \n     2015-06-08 09:57 |    \t\tsql小神 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:4        | 有些漏洞可以提，有些漏洞不可以提。)\t\t \n  @苏州同程旅游网络科技有限公司 最近你们挺火的啊。。。。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}