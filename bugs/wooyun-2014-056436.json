{"id": 4055, "wybug_id": "wooyun-2014-056436", "wybug_title": "昵图网会员中心存在SQL注入漏洞（任意update积分）", "wybug_corp": "杭州昵图信息技术有限公司", "wybug_author": "Rain", "wybug_date": "2014-04-11 11:21", "wybug_open_date": "2014-05-26 11:22", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-26：\t细节向公众公开  简要描述： 会员中心的我抽中的奖品存在SQL注入，没有做到严格参数判断，导致注入 详细说明：  会员中心的我抽中的奖品在查询的时候，对于查询字段提交到后端未做任何处理，导致SQL注入发生到下面网址http://user.nipic.com/login.asp使用测试账号rainboyhi测试密码rainboyhi登录到会员中心，登录后访问下面的网址http://user.nipic.com/index.asp?open=event_prize_user.asp?leixing=1返回正常的结果，具体效果，如下图所示\n\n因为已经测试过存在注入点，使用我们直接给增加积分。刚刚共享分是0分的。我们现在来增加一些共享分,增加10分做测试吧http://user.nipic.com/index.asp?open=event_prize_user.asp?leixing=1;update%20az_user%20set%20gxfen=10%20where%20username='rainboyhi';--具体效果看截图\n\n当然由于权限比较高，使用对数据库、表、字段、数据进行增、删、改、查、drop都是可以的。甚至可以提权写webshell   漏洞证明：  http://user.nipic.com/index.asp?open=event_prize_user.asp?leixing=1正常结果如下图\n\n其中leixing是奖品类型，是通过select进行选择的。传递http://user.nipic.com/index.asp?open=event_prize_user.asp?leixing=1 or 1=1 搞定，出来全部记录，如下图\n\n通过编写curl模拟请求脚本，可以扫表名、表结构、数据库名、表数据，危险度极高而且由于是MS sql的，使用asp使用分号之后可以执行任何权限范围内的对数据库、表、字段、数据的delete、update、insert、drop等等操作，甚至可以提权写出webshell   修复方案：  对leixing进行严格处理，最好处理为转整数或者使用switch方式单独针对值判断更精确   版权声明：转载请注明来源 Rain@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-04-11 11:41 厂商回复： 感谢 Rain 对昵图网的大力支持，已经说得很详细了，漏洞已经修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-10 11:48 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  话说是下素材需要的那个积分不？    \n     2014-04-11 11:37 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  我怎么看成了唯品会    \n     2014-04-11 12:34 |    \t\t马云 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:5        | 啪啪啪啪啪啪啪啪)\t\t \n  @zzR 撸多了会眼花    \n     2014-04-11 12:50 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  @马云 跨擦 ！马云在漏洞昵图网会员中心存在SQL注入漏洞（任意update积分）的评论里提到了你，去看看吧!吓死我了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}