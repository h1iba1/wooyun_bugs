{"id": 56262, "wybug_id": "wooyun-2014-058372", "wybug_title": "phpyun某功能对参数处理不严可导致sql注入", "wybug_corp": "php云人才系统", "wybug_author": "啊L川", "wybug_date": "2014-05-07 10:41", "wybug_open_date": "2014-06-21 10:41", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-21：\t细节向公众公开  简要描述： 学习中......少装不努力，老大搞IT！！！ 详细说明：  ｐｈｐｙｕｎ　个人会员中心member/model/index.class.php $_COOKIE[\"usertype\"];参数存在注入，从下面代码中可以看到$data[\"usertype\"] 直接读取COOKIE的值，带入到sql中，sql未对值进行过滤处理\nfunction msg_action(){\t\tif($_GET[\"del\"]){\t\t\t$nid=$this->obj->DB_delete_all(\"userid_msg\",\"`id`='\".$_GET[\"del\"].\"' and `uid`='\".$this->uid.\"'\");\t\t\tisset($nid)?$this->obj->ACT_msg(\"index.php?C=msg\",\"删除成功\"):$this->obj->ACT_msg(\"index.php?C=msg\",\"删除失败\");\t\t}\t\t$this->public_action();\t\t$urlarr=array(\"C\"=>\"msg\",\"page\"=>\"{{page}}\");\t\t$pageurl=$this->url(\"index\",\"index\",$urlarr);\t\t$this->get_page(\"userid_msg\",\"`uid`='\".$this->uid.\"' and type!='1' order by id desc\",$pageurl,\"20\");\t\tif($_GET[\"c_uid\"]){\t\t\t$data[\"c_uid\"]=$_GET[\"c_uid\"];\t\t\t$data[\"inputtime\"]=mktime();\t\t\t$data[\"p_uid\"]=$_COOKIE[\"uid\"];\t\t\t$data[\"usertype\"]=$_COOKIE[\"usertype\"];\t\t\t$data[\"com_name\"]=$_GET[\"c_name\"];\t\t\t$haves=$this->obj->DB_select_once(\"blacklist\",\"`p_uid`=\".$data[\"p_uid\"].\" and `c_uid`=\".$data[\"c_uid\"].\"  and `usertype`=\".$data[\"usertype\"].\"\");\t\t\tif(is_array($haves)){\t\t\t\t$this->obj->ACT_msg($_SERVER['HTTP_REFERER'],\"该用户已在您黑名单中\");\t\t\t}else{\t\t\t$nid=$this->obj->insert_into(\"blacklist\",$data);\t\t\t$this->obj->DB_delete_all(\"userid_msg\",\"`uid`=\".$data[\"p_uid\"].\" and `fid`=\".$data[\"c_uid\"].\"\",\" \");\t\t\t$nid?$this->obj->ACT_msg($_SERVER['HTTP_REFERER'],\"操作成功\"):$this->obj->ACT_msg($_SERVER['HTTP_REFERER'],\"操作失败\");\t\t\t}\t\t}\n\nfunction DB_select_once($tablename, $where = 1, $select = \"*\") {\t\t$cachename=$tablename.$where;\t\tif(!$return=$this->Memcache_set($cachename)){\t\t$SQL = \"SELECT \".$select.\" FROM \" . $this->def . $tablename . \" WHERE \".$where.\" limit 1\";            echo $SQL;\t\t\t$query = $this->db->query($SQL);\t\t\t$return=$this->db->fetch_array($query);\t\t\t$this->Memcache_set($cachename,$return);\t\t}\t\treturn $return;\t}\n\n\n   漏洞证明：     修复方案：     版权声明：转载请注明来源 啊L川@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-05-07 11:23 厂商回复： 感谢您的支持，我们会尽快完善并修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-05-27 11:45 |    \t\tneal \t\t\t( 普通白帽子  |\t\t\t        Rank:219 漏洞数:12        )\t\t \n  你是把 过滤文件删了  在测试的？    \n     2014-05-27 11:58 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:188        | Only Code Never Lie To Me.)\t\t \n      。。。全局的过滤呢    \n     2014-05-28 22:07 |    \t\t啊L川 \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:37        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  @neal @′  雨。 大牛勿喷，菜鸟。。。。。    \n     2014-05-28 22:24 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:188        | Only Code Never Lie To Me.)\t\t \n  @啊L川   没有啊，    之前找到几个没有单引号的地方  就是没绕过全局的过滤，    \n     2014-05-28 22:46 |    \t\t啊L川 \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:37        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  @′  雨。 我测试的时候去掉了360那个检测的文件，后来测着就忘记了，，，看到输出了  一激动就赶紧提了，再然后发现，，，，，大牛们 别喷我呀  真是菜鸟呀    \n     2014-05-30 09:12 |    \t\tneal \t\t\t( 普通白帽子  |\t\t\t        Rank:219 漏洞数:12        )\t\t \n  @啊L川  360检测 根本没去管它，你能过全局检测就行了。    \n     2014-05-30 09:21 |    \t\t啊L川 \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:37        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  @neal 我是菜鸟，，，大牛求带    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}