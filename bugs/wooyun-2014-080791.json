{"id": 49593, "wybug_id": "wooyun-2014-080791", "wybug_title": "B2Bbuilder 网站商城存在越权操作十余处", "wybug_corp": "shop-builder.cn", "wybug_author": "nextdoor", "wybug_date": "2014-10-28 13:58", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "非授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["越权操作"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-02：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： B2Bbuilder 网站商城存在多处越权操作10处 详细说明：  下载的版本 B2Bbuilder B2B网站管理系统 v7.0 .1最新 正式版1-3处\nmain.php中 switch ($action){\tcase \"admin_subscribe\":\t{\t\t\tinclude_once(\"includes/plugin_tradealter_class.php\");\t\t$tradealter=new tradealter();\t\tif(!empty($_POST['addid']))\t\t{\t\t\tif(!empty($_POST['seditid']))\t\t\t\t$re=$tradealter->up_subscribe($_POST['seditid']); //跟踪up_subscribe函数\t\t\telse\t\t\t\t$re=$tradealter->up_subscribe();\t\t\tif($re)\t\t\t\tmsg(\"main.php?action=admin_subscribe\");\t\t}\t\tif(!empty($_GET['editid']))\t\t\t$tpl->assign(\"de\",$tradealter->list_subscribe($_GET['editid'])); //跟踪list_subscribe函数\t\tif(!empty($_GET['delid']))\t\t\t$tradealter->delete_subscribe($_GET['delid']); //跟踪delete_subscribe函数\t\t$tpl->assign(\"subscribe\",$tradealter->list_subscribe());\t\t$page=\"admin_subscribe.htm\";\t\tbreak;\t}include/plugin_tradealter_class.php文件\tfunction up_subscribe($sid='')\t{\t\tglobal $buid,$config;\t\tif(!empty($sid))\t\t{\t\t\t$nt=time();\t\t\t$sql=\"update \".SUBSCRIBE.\" set keywords='$_POST[keycon]',ktype='$_POST[ktype]',p_catids='$_POST[catids]',p_cats='$_POST[cats]',validity='$_POST[validity]',frequency='$_POST[frequency]',uptime='$nt',email='$_POST[email]' where id='$sid'\"; //未判断所属用户直接操作\t\t\t$this->db->query($sql);\t\t}\t\telse\t\t{\t\t\t\t$nt=time();\t\t\t$sql=\"insert into \".SUBSCRIBE.\" (userid,keywords,ktype,p_catids,p_cats,validity,frequency,uptime,email) \t\t\tvalues ( '$buid','$_POST[keycon]','$_POST[ktype]','$_POST[catids]','$_POST[cats]','$_POST[validity]','$_POST[frequency]','$nt','$_POST[email]')\";\t\t\t$this->db->query($sql);\t\t\tinclude(\"includes/point_inc.php\");\t\t\tif($point_config['point']=='1'&&$point_config['sub_scribe']!='0')\t\t\trenew_point('',$point_config['sub_scribe']);\t\t}\t}include/plugin_tradealter_class.php文件function list_subscribe($id=\"\")\t{\t\tglobal $buid;\t\tif(empty($id))\t\t{\t\t\t$sql=\"select * from \".SUBSCRIBE.\" where userid='$buid' order by uptime desc\"; \t\t\t$this->db->query($sql);\t\t\t$re=$this->db->getRows();\t\t}\t\telse\t\t{\t\t\t$sql=\"select * from \".SUBSCRIBE.\" where id='$id'\";//未判断属性导致越权\t\t\t$this->db->query($sql);\t\t\t$re=$this->db->fetchRow();\t\t}\t\treturn $re;\t}include/plugin_tradealter_class.php\tfunction delete_subscribe($did=\"\")\t{\t\tglobal $buid;\t\t$sql=\"delete  from \".SUBSCRIBE.\" where  id='$did'\"; //可以任意删除他人的内容\t\t$this->db->query($sql);\t}\n第四处\ncase \"admin_adv_list\":\t{\t\t\tif(!empty($_GET['deid']))\t\t\t$db->query(\"delete from \".ADVSCON.\" where ID='$_GET[deid]'\"); //越权,任意删除订单\t\tif(!empty($_GET['order_id']))\t\t\t$db->query(\"update \".ADVSCON.\" set statu=1 where ID='$_GET[order_id]'\"); \t\t\t\t\t$db->query(\"select * from \".ADVSCON.\" where userid='$buid'\");\t\t$tpl->assign(\"re\",$re = $db->getRows());\t\t$page= \"admin_adv_list.htm\";\t\tbreak;\t}\n第5—6处\ncase \"admin_subuser\":\t{\t\t\tif(!empty($_GET['deid']))\t\t\t$admin->delete_personal($_GET['deid']); \t\t\t\t\tif(!empty($_POST['action'])&&$_POST['action']=='submit')\t\t{\t\t\t$admin->add_personal();\t\t\tmsg(\"main.php?action=admin_subuser&t=1&adduser=$_GET[adduser]\");\t\t}\t\tif(!empty($_POST['action'])&&$_POST['action']=='update')\t\t{\t\t\t\t$admin->update_personal($_POST['uid']); //存在越权\t\t\tmsg(\"main.php?action=admin_subuser&adduser=$_GET[adduser]&t=1\");\t\t}\t\t\t\tinclude_once(\"lang/\".$config['language'].\"/company_type_config.php\");\t\t$tpl->assign(\"de\",$de=$admin->get_personal_detail($_GET['editid'])); //存在越权\t\t$tpl->assign(\"plist\",$admin->get_personal_list());\t\t$tpl->assign(\"prov\",get_province($de['province']));\t\t\t\tif(!empty($_GET['adduser']))\t\t{\t\t\t$nohead='true';\t\t\t$page=\"admin_add_personal.htm\";\t\t\tif(empty($_GET['editid']))\t\t\t\t$tpl->assign(\"de\",NULL);\t\t}\t\telse\t\t\t$page=\"admin_subuser.htm\";\t\tbreak;\t}跟踪函数 update_personalfunction update_personal($uid)\t{\t\tglobal $config,$buid;$logo=NULL;$ssql=NULL;\t\tif(empty($uid))\t\t\t$uid=$buid;\t\t$_POST['province']=!empty($_POST['province1'])?$_POST['province1']:$_POST['province'];\t\t$_POST['city']=!empty($_POST['city1'])?$_POST['city1']:$_POST['city'];\t\t$_POST['sex']=empty($_POST['sex'])?1:$_POST['sex'];\t\t\t\t$sql=\"UPDATE \".ALLUSER.\" SET\t\tname='$_POST[name]',email='$_POST[email]',email2='$_POST[email2]',tel='$_POST[tel]',qq='$_POST[qq]',province='$_POST[province]',city='$_POST[city]',sex='$_POST[sex]',skype='$_POST[skype]',position='$_POST[position]',mobile='$_POST[mobile]',logo='$_POST[logo]'\t\tWHERE userid='$uid'\"; //对属性判断不严\t\t\t\t$re=$this->db->query($sql);\t\treturn $re;\t}get_personal_detail函数\tfunction get_personal_detail($id)\t{\t\tglobal $buid,$config;\t\tif(empty($id))\t\t\t$id=$buid;\t\t$sql=\"select * from \".ALLUSER.\" a left join \".COUNTRY.\" b on a.country=b.id WHERE a.userid='$id'\";//认证不严\t\t$this->db->query($sql);\t\t$re=$this->db->fetchRow();\t\tif($config['language']=='cn')\t\t\t$re['country']=$re['cname'];\t\telse\t\t\t$re['country']=$re['ename'];\t\treturn $re;\t}\n第七处\nadmin_message_det.php f(!empty($_GET['deid'])){\t$msg->del_mail($_GET['deid']*1);\tmsg(\"main.php?m=message&s=admin_message_list_inbox\");//删除后进入收件箱}if(!empty($_GET['save_id'])){\t$msg->save_mail($_GET['save_id']*1);}if(!empty($_GET['remove'])){\t$msg->remove_mail($_GET['remove']*1);}if(!empty($_GET['recover'])){\t$msg->recover_mail($_GET['recover']*1);}$tpl->assign(\"re\",$msg ->mail_det($_GET['id'])); //存在越权$tpl->assign(\"config\",$config);$tpl->assign(\"lang\",$lang);plugin_msg_class.php文件\tfunction mail_det($id)\t{\t\tglobal $buid;\t\t$sql=\"select *,NULL as about from \".FEEDBACK.\" where id='$id'\"; //id参数\t\t$this->db->query($sql);\t\t$re=$this->db->fetchRow();\t\tif($re['iflook']<1)\t\t{\t\t\t$sql=\"update \".FEEDBACK.\" SET iflook=1  WHERE id='$id'\";\t\t\t$this->db->query($sql);\t\t}\t\t\t\tif($re[\"fromuserid\"]&&$re['msgtype']==1)\t\t{//收件箱\t\t\t$sql=\"select * from \".ALLUSER.\" where userid='\".$re['fromuserid'].\"'\";\t\t\t$this->db->query($sql);\t\t\t$re[\"fromInfo\"]=$this->db->fetchRow();\t\t}\t\tif($re[\"touserid\"]&&$re['msgtype']==2)\t\t{//发件箱\t\t\t$sql=\"select * from \".ALLUSER.\" where userid='\".$re['touserid'].\"'\";\t\t\t$this->db->query($sql);\t\t\t$re[\"fromInfo\"]=$this->db->fetchRow();\t\t}\t\tif($re['fromuserid'])\t\t{\t\t\t$sql=\"select id from \".FRIENDS.\" where fuid=$re[fromuserid]\";\t\t\t$this->db->query($sql);\t\t\t$re[\"is_myfriend\"]=$this->db->fetchField('id');\t\t}\t\t\t\t$re['edit_con']='<br><br><br><br><br>//======================================================='.$re['con'];\t\t\t\treturn $re;\t}\n第八处\nadmin_message_list_savebox.php<?phpinclude_once(\"$config[webroot]/includes/page_utf_class.php\");include_once(\"$config[webroot]/module/message/includes/plugin_msg_class.php\");$msg=new msg();//======================================================if(isset($_POST[\"deid\"])&&!empty($_POST['del'])){\t$msg->del_freom_save_mail(); //跟踪函数}$type='savebox';$tpl->assign(\"re\",$msg ->mail_list($type));//======================================================$tpl->assign(\"config\",$config);$tpl->assign(\"lang\",$lang);$output=tplfetch(\"admin_message_list_savebox.htm\");?>function del_freom_save_mail()\t{\t\tif(empty($id))\t\t{\t\t\tfor($i=0;$i<count($_POST[\"deid\"]);$i++)\t\t\t{\t\t\t\t$id=$_POST[\"deid\"][$i];\t\t\t\t$sql=\"update  \".FEEDBACK.\" set is_save=0 where id=$id\"; //id参数\t\t\t\t$this->db->query($sql);\t\t\t\tunset($sql);\t\t\t}\t\t}\t\telse\t\t{\t\t\t$sql=\"update  \".FEEDBACK.\" set is_save=0 where id=$id\";\t\t\t$this->db->query($sql);\t\t}\t}\n第九处\nadmin_message_list_outbox.php<?phpinclude_once(\"$config[webroot]/includes/page_utf_class.php\");include_once(\"$config[webroot]/module/message/includes/plugin_msg_class.php\");$msg=new msg();//================================================if(isset($_POST[\"deid\"])&&!empty($_POST['del'])){\t$msg->del_mail(); //跟踪函数}$type='outbox';$tpl->assign(\"re\",$msg ->mail_list($type));//===============================================$tpl->assign(\"config\",$config);$tpl->assign(\"lang\",$lang);$output=tplfetch(\"admin_message_list_outbox.htm\");?>plugin_msg_class.php\tfunction del_mail($id=NULL)\t{\t\tif(empty($id))\t\t{\t\t\tfor($i=0;$i<count($_POST[\"deid\"]);$i++)\t\t\t{\t\t\t\t$id=$_POST[\"deid\"][$i];\t\t\t\t$sql=\"update  \".FEEDBACK.\" set iflook=2 where id=$id\"; //id元素\t\t\t\t$this->db->query($sql);\t\t\t\tunset($sql);\t\t\t}\t\t}\t\telse\t\t{\t\t\t$sql=\"update  \".FEEDBACK.\" set iflook=2 where id=$id\";\t\t\t$this->db->query($sql);\t\t}\t}//关于message这个类的越权还有很多，在这列举几个，其他的漏洞开发自己好好审审吧\n第十处\n<?phpinclude_once(\"$config[webroot]/module/message/includes/plugin_friend_class.php\");$friend=new friend();//============================================================if(isset($_GET['editid'])&&is_numeric($_GET['editid']))\t$tpl->assign(\"de\",$friend->edit_friend_info($_GET['editid']));//edit_friend_info函数\tif(isset($_GET['friendid']))\t$tpl->assign(\"de\",$friend->get_friend_info($_GET['friendid']));if(isset($_GET['detail_id'])&&is_numeric($_GET['detail_id']))\t$tpl->assign(\"de\",$friend->edit_friend_info($_GET['detail_id']));\tif(isset($_POST['isure'])){\tif(!empty($_POST['editid']))\t\t$friend->update_friend_info($_POST['editid']);\telse\t\t$friend->update_friend_info();}//==================================plugin_msg_class.php function edit_friend_info($id='')\t{\t\t\t$sql=\"select * from \".FRIENDS.\" where id='$id'\"; //id参数\t\t$this->db->query($sql);\t\t$rs=$this->db->fetchRow();\t\treturn $rs;\t}\n第十一处\ndmin_friends_list.php <?phpinclude_once(\"$config[webroot]/module/message/includes/plugin_friend_class.php\");$friend=new friend();//============================================================include_once(\"$config[webroot]/includes/page_utf_class.php\");if(isset($_GET['delid'])&&is_numeric($_GET['delid'])){\t$friend->del_friend_info($_GET['delid']); //跟踪函数}$tpl->assign(\"re\",$friend->friends_list());//==================================$tpl->assign(\"config\",$config);$tpl->assign(\"lang\",$lang);$output=tplfetch(\"admin_friends_list.htm\");?>plugin_friend_class.php\t\tfunction del_friend_info($id='')\t{\t\t\t$sql=\"delete from \".FRIENDS.\" where id='$id'\"; //id函数\t\t$this->db->query($sql);\t}\n第十二处\nadmin_brand.php http://democn.b2b-builder.com/main.php?edit=428&m=brand&s=admin_brandinclude_once(\"$config[webroot]/module/brand/includes/plugin_brand_class.php\");$brand=new brand();//============================================================if(!empty($submit)&&empty($_POST['editID'])){\t$re=$brand->add_brand();\tif($re)\t\tmsg(\"main.php?m=brand&s=admin_brand_list\");}if(isset($_POST['editID'])){\t$re=$brand->edit_brand(); //跟踪函数\tif($re)\t\tmsg(\"main.php?m=brand&s=admin_brand_list\");}if(isset($_GET['edit'])){\t$tpl->assign(\"de\",$brand->brand_detail($_GET['edit']));}//==================================$tpl->assign(\"country\",country_list());$tpl->assign(\"config\",$config);$tpl->assign(\"lang\",$lang);$output=tplfetch(\"admin_brand.htm\");?>plugin_friend_class.php中\tfunction edit_brand()\t{\t\tglobal $config;\t\tinclude_once($config['webroot'].'/lib/allchar.php');\t\t\t\tif($config['language']=='cn')\t\t\t$sql=\"select cname as name from \".COUNTRY.\" where id='$_POST[country]'\";\t\telse\t\t\t$sql=\"select ename as name from \".COUNTRY.\" where id='$_POST[country]'\";\t\t$this->db->query($sql);\t\t\t\t$country=$this->db->fetchField('name');\t\t\t$province=$_POST['province'];\t\t$city=$_POST['city'];\t\tif(empty($province) and empty($city))\t\t{\t\t\t$province=$_POST['province1'];\t\t\t$city=$_POST['city1'];\t\t}\t\t$str=c(trim($_POST['name']));\t\t$fstr=substr($str,0,1);\t\t\t\t\t\t$sql=\"update \".BRAND.\" set name='\".$_POST['name'].\"',con='\".$_POST['con'].\"',company='\".$_POST['company'].\"',tel='\".$_POST['tel'].\"',pic='\".$_POST['pic'].\"',statu='0',url='$_POST[url]',country='$country',province='$province',city='$city',time='\".time().\"',inner_url='$_POST[inner_url]',char_index='$fstr',char_all='$str' where id='\".$_POST['editID'].\"'\"; //editID 参数\t\t$re=$this->db->query($sql);\t\treturn $re;\t}\n第十三处\nadmin_news.php <?phpinclude_once(\"$config[webroot]/module/\".$_GET['m'].\"/includes/plugin_news_class.php\");$news=new news();//===============================================\t$class=$news->get_newsclass();\t$tpl->assign(\"class\",$class);\tif(isset($_GET['newsid']) and $_POST['action']==\"edit\")\t{\t\t$news->fun_news('edit'); //跟踪fun_news函数\t\t$admin->msg(\"main.php?m=$_GET[m]&s=admin_news_list\");\t}\tif(!isset($_GET['newsid']) and $_POST['action']==\"add\")\t{\t\t$re=$news->check_access();\t\tif($re==false)\t\t\tmsg(\"main.php?action=msg&type=access_dine\");\t\t$news->fun_news('add');\t\t$admin->msg(\"main.php?m=$_GET[m]&s=admin_news_list\");\t}\tif(isset($_GET['newsid']))\t{\t\t$tpl->assign(\"news\",$news->news_detail($_GET['newsid']));\t\t}\t//-----------\t$group_add_news='user_add_news_'.$_SESSION['IFPAY'];\t$tpl->assign(\"is_post\",$config[$group_add_news]);//==================================$tpl->assign(\"config\",$config);$tpl->assign(\"lang\",$lang);$output=tplfetch(\"admin_news.htm\");?>plugin_friend_class.php\tfunction fun_news($type)\t{\t\tglobal $config,$buid,$bcid;\t\tif(!empty($_FILES['img_url'])&&is_uploaded_file($_FILES['img_url']['tmp_name']))\t\t{\t\t\tif(!empty($_POST['pic']))\t\t\t{\t\t\t\t$file=$config['webroot'].\"/uploadfile/news/\".$_POST['pic'];\t\t\t\t@unlink($file);\t\t\t\t$file=$config['webroot'].\"/uploadfile/news/big/\".$_POST['pic'];\t\t\t\t\t@unlink($file);\t\t\t}\t\t\t$pname=time().\".jpg\";\t\t\t$savefile=$config['webroot'].\"/uploadfile/news/\".$pname;\t\t\t$bsavefile=$config['webroot'].\"/uploadfile/news/big/\".$pname;\t\t\tmakethumb($_FILES['img_url']['tmp_name'],$savefile,140,125);\t\t\tmakethumb($_FILES['img_url']['tmp_name'],$bsavefile,275,200);\t\t}\t\tif(!empty($_POST['pic']) and empty($pname))\t\t{\t\t\t$pname=$_POST['pic'];\t\t}\t\t\t\tif(empty($pname))\t\t{\t\t\t$ispic=0;\t\t}\t\telse\t\t{\t\t\t$ispic=1;\t\t}\t\t\t\tif(empty($_POST['smalltext']))\t\t{\t\t\t$con=$_POST['body'];\t\t\t$str = explode('<p>',$con);\t\t\tforeach($str as $i=>$k)\t\t\t{\t\t\t\t$val=trim(strip_tags($k));\t\t\t\tif(!empty($val))\t\t\t\t{\t\t\t\t\t$_POST['smalltext']=$val;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t}\t\t}\t\tif($type==\"add\")\t\t{\t\t\t//-----------------------\t\t\t$ifpay=empty($_SESSION[\"IFPAY\"])?1:$_SESSION[\"IFPAY\"];\t\t\tif($config['replace_outside_link_'.$ifpay]==1)\t\t\t{\t\t\t\t$_POST[\"smalltext\"]=replace_outside_link($_POST[\"smalltext\"]);\t\t\t\t$_POST[\"body\"]=replace_outside_link($_POST[\"body\"]);\t\t\t}\t\t\t//----------------------\t\t\t$statu=$config['infoCheck_'.$ifpay];\t\t\t\t\t\t$sql=\"INSERT \".NEWSD.\"(classid,title,ftitle,keyboard,ispass,titlefont,uid,company_id,uptime,smalltext,writer,titlepic,ispic,lastedittime,imgs_url,videos_url,ispl,userfen,newstempid,source) \t\t\tVALUES \t\t\t('$_POST[classid]','$_POST[title]','$_POST[ftitle]','$_POST[key]','$statu','','$buid','$bcid','\".time().\"','$_POST[smalltext]','$buser','$pname','$ispic','\".time().\"','','','0','0','0','')\";\t\t\t\t\t\t$re=$this->db->query($sql);\t\t\t$id=$this->db->lastid();\t\t\t\t\t\t$sql=\"INSERT INTO \".NEWSDATA.\" (nid,con) values ('$id','$_POST[body]')\";\t\t\t$re=$this->db->query($sql);\t\t\t\t\t\tinclude(\"includes/point_inc.php\");\t\t\tif($point_config['point']=='1'&&$point_config['add_news']!='0')\t\t\t\trenew_point('',$point_config['add_news']);\t\t}\t\tif($type==\"edit\")\t\t{\t\t\t$_POST['onclick']=empty($_POST['onclick'])?0:$_POST['onclick'];\t\t\t\t\t\t$sql=\"update \".NEWSD.\" set title='$_POST[title]',classid='$_POST[classid]',ftitle='$_POST[ftitle]',keyboard='$_POST[key]',onclick='$_POST[onclick]',smalltext='$_POST[smalltext]',titlepic='$pname',ispic='$ispic',lastedittime='\".time().\"' where nid= $_GET[newsid]\";   \t\t   $re=$this->db->query($sql);\t\t   $sql=\"update \".NEWSDATA.\" set con='$_POST[body]' where nid= $_GET[newsid]\";  \t\t   $re=$this->db->query($sql);\t\t}\t}\t\tglobal $config,$buid,$bcid;\t\tif(!empty($_FILES['img_url'])&&is_uploaded_file($_FILES['img_url']['tmp_name']))\t\t{\t\t\tif(!empty($_POST['pic']))\t\t\t{\t\t\t\t$file=$config['webroot'].\"/uploadfile/news/\".$_POST['pic'];\t\t\t\t@unlink($file);\t\t\t\t$file=$config['webroot'].\"/uploadfile/news/big/\".$_POST['pic'];\t\t\t\t\t@unlink($file);\t\t\t}\t\t\t$pname=time().\".jpg\";\t\t\t$savefile=$config['webroot'].\"/uploadfile/news/\".$pname;\t\t\t$bsavefile=$config['webroot'].\"/uploadfile/news/big/\".$pname;\t\t\tmakethumb($_FILES['img_url']['tmp_name'],$savefile,140,125);\t\t\tmakethumb($_FILES['img_url']['tmp_name'],$bsavefile,275,200);\t\t}\t\tif(!empty($_POST['pic']) and empty($pname))\t\t{\t\t\t$pname=$_POST['pic'];\t\t}\t\t\t\tif(empty($pname))\t\t{\t\t\t$ispic=0;\t\t}\t\telse\t\t{\t\t\t$ispic=1;\t\t}\t\t\t\tif(empty($_POST['smalltext']))\t\t{\t\t\t$con=$_POST['body'];\t\t\t$str = explode('<p>',$con);\t\t\tforeach($str as $i=>$k)\t\t\t{\t\t\t\t$val=trim(strip_tags($k));\t\t\t\tif(!empty($val))\t\t\t\t{\t\t\t\t\t$_POST['smalltext']=$val;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t}\t\t}\t\tif($type==\"add\")\t\t{\t\t\t//-----------------------\t\t\t$ifpay=empty($_SESSION[\"IFPAY\"])?1:$_SESSION[\"IFPAY\"];\t\t\tif($config['replace_outside_link_'.$ifpay]==1)\t\t\t{\t\t\t\t$_POST[\"smalltext\"]=replace_outside_link($_POST[\"smalltext\"]);\t\t\t\t$_POST[\"body\"]=replace_outside_link($_POST[\"body\"]);\t\t\t}\t\t\t//----------------------\t\t\t$statu=$config['infoCheck_'.$ifpay];\t\t\t\t\t\t$sql=\"INSERT \".NEWSD.\"(classid,title,ftitle,keyboard,ispass,titlefont,uid,company_id,uptime,smalltext,writer,titlepic,ispic,lastedittime,imgs_url,videos_url,ispl,userfen,newstempid,source) \t\t\tVALUES \t\t\t('$_POST[classid]','$_POST[title]','$_POST[ftitle]','$_POST[key]','$statu','','$buid','$bcid','\".time().\"','$_POST[smalltext]','$buser','$pname','$ispic','\".time().\"','','','0','0','0','')\";\t\t\t\t\t\t$re=$this->db->query($sql);\t\t\t$id=$this->db->lastid();\t\t\t\t\t\t$sql=\"INSERT INTO \".NEWSDATA.\" (nid,con) values ('$id','$_POST[body]')\";\t\t\t$re=$this->db->query($sql);\t\t\t\t\t\tinclude(\"includes/point_inc.php\");\t\t\tif($point_config['point']=='1'&&$point_config['add_news']!='0')\t\t\t\trenew_point('',$point_config['add_news']);\t\t}\t\tif($type==\"edit\")\t\t{\t\t\t$_POST['onclick']=empty($_POST['onclick'])?0:$_POST['onclick'];\t\t\t\t\t\t$sql=\"update \".NEWSD.\" set title='$_POST[title]',classid='$_POST[classid]',ftitle='$_POST[ftitle]',keyboard='$_POST[key]',onclick='$_POST[onclick]',smalltext='$_POST[smalltext]',titlepic='$pname',ispic='$ispic',lastedittime='\".time().\"' where nid= $_GET[newsid]\";   \t\t   $re=$this->db->query($sql);\t\t   $sql=\"update \".NEWSDATA.\" set con='$_POST[body]' where nid= $_GET[newsid]\";  //newsid参数\t\t   $re=$this->db->query($sql);\t\t}\t}\n存在平行权限的还有很多，开发人员在好好看看   漏洞证明：  漏洞证明：短信息越权，改变id参数即可\n\n\n\n\n\n订阅越权更改editid参数\n\n\n\n\n\n任意删除他人广告越权参数deid\n\n\n\n\n\n商友越权，任意查看他人商友信息参数editid\n\n\n\n\n\n\n\n修改子账户越权editid参数\n\n\n\n\n\n其他的就不再截图演示了   修复方案：  验证属性 一起提交了 希望审核给点力，做个前台啊   版权声明：转载请注明来源 nextdoor@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}