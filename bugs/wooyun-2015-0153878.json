{"id": 73268, "wybug_id": "wooyun-2015-0153878", "wybug_title": "一个弱口令引发的链家内网渗透(已登陆多个系统\\自如网多个数据库等大量信息泄露)", "wybug_corp": "homelink.com.cn", "wybug_author": "路人甲", "wybug_date": "2015-11-17 09:31", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "账户体系控制不严", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "内网渗透"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： 链家加油站\\链家理财系统svn\\OA系统\\ehr系统\\hr系统\\自如网数据库等大量信息泄露 详细说明：  渗透的开始是手机弱口令，最好能够直接拨入vpn，这样就省很多事情。收集链家员工的工号和登录名，使用姓名为账号，工号为密码，再配以常用弱口令等进行爆破，爆破处一枚邮箱\nlo****/10083***\n#1 邮箱的探索得到账号之后进入邮箱，不过让人有点失望，邮箱邮件大部分都已经被删除了，只留下一部分没有什么重要信息的，这位员工的做法还是比较好的，将重要信息处理完毕都删除，跟后面的那位比好多了。使用这枚账号登陆vpn，登陆成功不过没有资源列表。也就失败了翻看了几封邮件，就开始寻找通讯录了，链家的通讯录是每个人都享有的，方便大家工作的同事也增加了员工信息泄露的几率。找到了链家运维小组的邮箱地址，总共九个人，一块打包（其实是一个一个自己打到文本里的）。下面一步就开始针对这几个人做一次有针对性的fuzzing（觉得很高大上），刚开始先做的是单独每个人的fuzzing，后来失败了，还是字典不够强大。太费事，干脆一块丢进去，跑一下午，我想应该还是可以跑出来的\n密码采用简单的组合homelink@123homelink@2011homelink@2012homelink@2013homelink@2014homelink@2015等还有其他的一些常用密码\n不得不佩服还是字典好用，再加上耐性，终会看到一些令自己满意的结果。成功一个运维小组的人\nyangg***/qwe12****\n登陆邮箱看一下\n\n找到了大量资料，下面就一一展示自如网后台管理员信息\n\n\n\njira账户\n\n自如网可能要搭建的服务邮箱账户\n\n资产生产楼盘系统生产数据库\n\n下面是乌云漏洞，有密码了，原来厂商们都是这样看漏洞的呀，跟百度网盘一样\n\n自如网数据库（泄露的信息下面将会讲明），这么多裤子，应该是黑产们的最爱吧，但是咱们是白帽子，不能做那样的事~\n\n\n\n\n\n\n\n\n\n下面是工作交接文档中自如网全部机器的ip与环境\n\n下面是链家93台主机存活与环境\n\n收集信息就到这里吧，从上面的种种信息可以看出来这个账号是链家运维小组里面负责ziroom网安全配置等工作的，相信运维小组一定会有vpn资源列表的，下面开始了   漏洞证明：  #2 拨入vpn进入内网渗透\nhttps://vpn.homelink.com.cn/\n和猜想的没有差别，运维小组的人权限就是大，看了一下可使用的资源列表，覆盖了七网段，这也就是说，链家的内网全部可以访问了\n\n #2.1 链家加油站（SQL注入\\存储型xss）\nhttp://bjxwgl.homelink.com.cn/\n依然使用原来的账号，登陆之后发现这是一个积分平台，跟乌云集市差不太多\nPOST /order/order_getMyOrderList.action HTTP/1.1Content-Type: application/x-www-form-urlencodedX-Requested-With: XMLHttpRequestAccept: text/html, */*Referer: http://bjxwgl.homelink.com.cn/order/order_toMyOrder.actionAccept-Language: zh-CNAccept-Encoding: gzip, deflateUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko LBBROWSERContent-Length: 101Host: bjxwgl.homelink.com.cnPragma: no-cacheCookie: Hm_lvt_023ae7ee49c070f6bdc1695ebecb6da9=1446302228; __utma=1.1117316601.1446302227.1446302227.1446302227.1; JSESSIONID=6062A26E18BDDEE2D228AE3EE57DE785page.curPageNo=1&page.pageSize=5&productName=&startDate=2015-11-04'*&endDate=2015-11-13&orderStatus=-1\nstartDate参数存在注入，不验证了\n\n还有一个存储型xss，应该是可以打管理员的，在反馈处，填写代码查看自己的反馈信息，打到了\n\n #2.2 多个系统弱口令1. https://172.16.6.214/svn 弱口令没有修复，在\n WooYun: 互联网房产行业之链家地产意识不足引发的内网漫游(涉及内部核心房源和销售系统\\链家理财系统\\掌上链家\\服务器数据库权限等敏感信息) \n提到密码zhouhongting/zhouhongting，全是链家理财的代码，如果被利用了，可想后果有多么的严重\n\n从中找到一些敏感信息--微信\n\n2. ehr和hr系统账户和密码是上面提供的两枚\n\n\n\n3. 签约平台可以爆破，工号/工号\nhttp://172.16.4.148:8080/common/toShangquanAuditList.html\n\n\n\n\n4. OA\n\n5. 还有一个忘了名字了，也是弱口令\n\n #2.3 ziroom的数据库直接在本地登陆了一个mysql数据库\n\n这个库还包含自如网微信的关注者信息\n\n一页1000个，共75页\n\n同样共85页，含银行卡等个人信息\n\n部分员工的身份证号\n\n #2.4 发现有两个站点有目录遍历\n\n\n\n#3 结束这次其实也算不上什么高大上的渗透，本次渗透的主要目的就是为了揪出链家这个系统的其中一个脆弱点，系统往往会很坚固，但是人就不一样了，可坚固可脆弱，如果真的防止类似的时间发生，链家需要做的还有很多： 1. 对员工开展安全教育培训，让每一名员工都有一个保护系统的意识，而不是单纯的为了自己的方便而设置简单的弱口令。 2. 系统自身还需要加固，这次入侵能够成功的一个因素就是没有防爆破机制，导致可以无限次的试探员工的账号密码，这一点个人感觉苏宁做的很好，在发现被爆破之后，立即会添加防爆破机制，如添加可行的验证码或限制密码试探次数。 3.  这次测试发现以往提出来的安全问题，依然存在，比如svn的口令，都过去好几个月了，行动是不是有点迟缓呢？并不是所有东西放在内网就是安全的，一旦被找到系统的脆弱点，打进内网，都晚了。   修复方案：  1.统一限制密码长度，足够位数以上，尤其是运维等具有管理系统级别的人物2.抓紧修补以前的漏洞3.这次测试主要原因不在于前面提供的两个账号的，即使他们不是弱口令，其他人也会有的，希望不要责难。4.这次是最累的一次了，20rank可好？   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-11-17 09:45 厂商回复： 确认，谢谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}