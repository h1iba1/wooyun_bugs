{"id": 58841, "wybug_id": "wooyun-2014-049408", "wybug_title": "盛大在线主站URL跳转(钓鱼)", "wybug_corp": "盛大在线", "wybug_author": "隐形小桃", "wybug_date": "2014-01-21 10:42", "wybug_open_date": "2014-03-07 10:43", "wybug_type": "URL跳转", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["跳转", "安全策略绕过", "跳转导致钓鱼"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-07：\t细节向公众公开  简要描述： 虽然对跳转域名做了白名单的检查，但是可以通过一定的方法进行绕过。 详细说明：  1、先来看下首页底部的几个分站的跳转链接：\n客服中心http://www.sdo.com/common/RedirectAppSite?url=http%3A%2F%2Fkf.sdo.com%2Fsdch%2Findex.asp&name=%E5%AE%A2%E6%9C%8D%E4%B8%AD%E5%BF%83关于盛大集团http://www.sdo.com/common/RedirectAppSite?url=http%3A%2F%2Fwww.snda.com%2F&name=%E5%85%B3%E4%BA%8E%E7%9B%9B%E5%A4%A7%E9%9B%86%E5%9B%A2盛大招聘http://www.sdo.com/common/RedirectAppSite?url=http%3A%2F%2Fhr.snda.com%2F&name=%E7%9B%9B%E5%A4%A7%E6%8B%9B%E8%81%98G买卖http://www.sdo.com/common/RedirectAppSite?url=http%3A%2F%2Fgmm.sdo.com&name=G%E4%B9%B0%E5%8D%96电子书http://www.sdo.com/common/RedirectAppSite?url=http%3A%2F%2Fwww.yuncheng.com%2Fbb&name=%E7%9B%9B%E5%A4%A7%E7%94%B5%E5%AD%90%E4%B9%A6\n1、截图如下\n\n2、随便点一个，就会前往负责URL跳转的页面，来看一下源码。发现会对参数传入的URL进行白名单检查。\n<script type=\"text/javascript\" src=\"http://ipic.staticsdo.com/external/install_beacon.js\"></script><script src=\"../static/js/jquery.js?20131015001\" type=\"text/javascript\"></script><script charset=\"utf-8\" src=\"../static/js/go.js?20131015001\" type=\"text/javascript\"></script><script type=\"text/javascript\" >    //document.domain=\"sdo.com\";    function redirect(){        //检查是否白名单        var locUrl = $_goUrlload.whiteList(\"http://kf.sdo.com/sdch/index.asp\");        if(locUrl == false){            window.top.location.href = '/';            return;        }        var appUrl = \"http%3A%2F%2Fkf.sdo.com%2Fsdch%2Findex.asp\";        //window.top.location.href = appUrl;        window.top.location.href = '/go#http://kf.sdo.com/sdch/index.asp';    }    setTimeout(redirect,3*1000);</script>\n2、截图如下\n\n3、看到【http://www.sdo.com/static/js/go.js?20131015001】这个JS就是白名单，查看一下。\ndocument.domain = \"sdo.com\";var _white_list = ['sdo.com',    'snda.com',    'zx110.org',    'cyberpolice.cn',    'gov.cn',    'shjubao.cn',\t'yuncheng.com',\t'qidian.com',\t'readnovel.com',\t'yunduan.cn',\t略……\n3、截图如下\n\n   漏洞证明：  4、这个白名单和对域名的检查方式非常弱，只是检查URL这个参数传入的域名中是否含有白名单中的某一个，也就是普通的关键词匹配。这样做最大的问题就在于，而没有对该关键词出现的部分（域名或者参数）做检测。这样的话就得出了这种检测方式的绕过方法，如下：http://www.sdo.com/common/RedirectAppSite?url=http%3A%2F%2Fwww.baidu.com?momo=sdo.com&name=momo在跳转到baidu的时候，加上一个参数【?momo=sdo.com】，这样的话就可以通过这个白名单的检测。4、截图如下\n\n\n\n   修复方案：  如坚持使用该跳转检查的方式，那么请对URL参数传入的的域名进行解析，分离出域名的部分和参数的部分，然后将域名部分和白名单进行对照。   版权声明：转载请注明来源 隐形小桃@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-01-22 10:00 厂商回复： 谢谢报告，万分感谢，但是呢洞主好像截图少了一张，链接打开时盛大在线会友情提示即将跳转，类似http:///lto?url=https:///elvanderb/TCP-，sebug这个算不算漏洞呢？ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}