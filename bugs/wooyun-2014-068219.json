{"id": 53281, "wybug_id": "wooyun-2014-068219", "wybug_title": "PHPMyWind后台管理界面的SQL注入漏洞", "wybug_corp": "phpmywind.com", "wybug_author": "蓝蓝", "wybug_date": "2014-07-13 13:37", "wybug_open_date": "2014-10-11 13:38", "wybug_type": "SQL注射漏洞", "wybug_level": "低", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-17：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-11：\t细节向公众公开  简要描述： 后台管理界面因为过滤不严格导致SQL注入漏洞，可以使权限较低的管理员取得较高权限，以及获取并修改超级管理员的用户名密码。 详细说明：  存在问题的代码，admin_save.php 59-101行，SQL语句中的$id存在注入\nelse if($action == 'update'){\t//创始人账号不允许更改状态\tif($id == 1 and ($checkadmin != 'true' or $levelname != '1'))\t{\t\tShowMsg('抱歉，不能更改创始账号状态！','-1');\t\texit();\t}\t//只有超级管理员才有权修改超级管理员\tif($cfg_adminlevel > 1 and $levelname == 1)\t{\t\tShowMsg('非法的操作，不能修改为超级管理员！', '-1');\t\texit();\t}\tif($password == '')\t{\t\t$sql = \"UPDATE `$tbname` SET nickname='$nickname', question='$question', answer='$answer', levelname='$levelname', checkadmin='$checkadmin' WHERE id=$id\";\t}\telse\t{\t\t$oldpwd   = md5(md5($oldpwd));\t\t$password = md5(md5($password));\t\t$r = $dosql->GetOne(\"SELECT `password` FROM `#@__admin` WHERE id=$id\");\t\tif($r['password'] != $oldpwd)\t\t{\t\t\tShowMsg('抱歉，旧密码错误！','-1');\t\t\texit();\t\t}\t\t\t\t$sql = \"UPDATE `$tbname` SET password='$password', nickname='$nickname', question='$question', answer='$answer', levelname='$levelname', checkadmin='$checkadmin' WHERE id=$id\";\t}\tif($dosql->ExecNoneQuery($sql))\t{\t\theader(\"location:$gourl\");\t\texit();\t}}\n漏洞证明\n\n下面的很多SQL语句的参数，都没有过滤。86行\n$r = $dosql->GetOne(\"SELECT `password` FROM `#@__admin` WHERE id=$id\");\n79行\n$sql = \"UPDATE `$tbname` SET nickname='$nickname', question='$question', answer='$answer', levelname='$levelname', checkadmin='$checkadmin' WHERE id=$id\";\n93行\n$sql = \"UPDATE `$tbname` SET password='$password', nickname='$nickname', question='$question', answer='$answer', levelname='$levelname', checkadmin='$checkadmin' WHERE id=$id\";\n115行\n$sql = \"UPDATE `$tbname` SET checkadmin='false' WHERE `id`=$id\";\n总之就是都没有过滤   漏洞证明：  如上   修复方案：  intval()   版权声明：转载请注明来源 蓝蓝@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2014-07-14 07:34 厂商回复： 感谢提交漏洞，我们会尽快修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}