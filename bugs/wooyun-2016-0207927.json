{"id": 88268, "wybug_id": "wooyun-2016-0207927", "wybug_title": "建设银行某分站漏洞导致GetShell（多处）                                      ", "wybug_corp": "建设银行", "wybug_author": "白泽", "wybug_date": "2016-05-13 15:03", "wybug_open_date": "2016-07-01 10:00", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-05-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-05-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-05-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-07-01：\t细节向公众公开  简要描述： 建设银行某分站漏洞导致GetShell 详细说明：  **.**.**.**多个上传导致getshell   漏洞证明：  1、正常图片上传GetShellupload.class.php 代码 uploadfile()导致以下文件出现任意上传：upvouch.phpupmarket.phpupinformation.php\nfunction uploadfile($upfile, $maxsize, $updir, $newname = 'date') {    $name = $upfile [\"name\"];    $type = $upfile [\"type\"];    $size = $upfile [\"size\"];    $tmp_name = $upfile [\"tmp_name\"];\tif ($newname == 'date')        $newname = date ( \"Ymdhis\" ); //使用日期做文件        $newname = date ( \"Ymdhis\" ).mt_rand(1,1000000);\t//$newname = md5($name.time());\t$p = strrpos($name,\".\");\t$extend = strtolower(substr($name,$p));\t$fileSize = $size;    if ($size > $maxsize) {        $maxpr = $maxsize / 1000;        //return  ( \"警告！上传文件大小不能超过\" . $maxpr . \"K!\" );\t\treturn false;    }\tif(!is_dir($updir))\t{\t\t//mkdir($updir);\t\tdo {\t\t   $dir = $updir;\t\t   while (!@mkdir($dir,0777)) {\t\t\t   $dir = dirname($dir);\t\t\t   if ($dir == '/' || is_dir($dir))\t\t\t\t   break;\t\t   }\t\t} while ($dir != $updir);\t}    if (move_uploaded_file ( $tmp_name, $updir . \"/\" . $newname . $extend )) {        return $updir .\"/\" . $newname . $extend;    }}\n2、解压压缩文件GetShellsubjectpublish.php需要满足两个条件才能上传zip文件\nif( $_POST['tmap'] && is_numeric($_POST['tmap'])     && $_POST['auth']   //加密验证串    && $_POST['path']     && !empty($_FILES)  ){    $tmap = $_POST['tmap'];    $auth = $_POST['auth'];    $path = $_POST['path'];    if( time()-ceil($tmap/1000) > 600 || $auth!=md5($path.$tmap.$key) ){        $err = 7;\n满足压缩包中是否存在html文件\n\n最后获得路径\n\n\n\n   修复方案：  已经删除测试脚本   版权声明：转载请注明来源 白泽@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-05-17 09:55 厂商回复： CNVD确认并复现所述情况,已经转由CNCERT直接通报给对应银行集团公司,由其后续协调网站管理部门处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-13 16:19 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:803 漏洞数:85        | root@qisec.com)\t\t \n  总感觉 洞主迟早被抓    \n     2016-05-13 16:39 |    \t\t键盘手 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:4        | @!@)\t\t \n  祈祷多福吧    \n     2016-05-13 17:02 |    \t\tHax0rs \t\t\t( 实习白帽子  |\t\t\t        Rank:73 漏洞数:16        | Hax0rs)\t\t \n  银行专业户    \n     2016-07-01 10:15 |    \t\t酷帥王子 \t\t\t( 普通白帽子  |\t\t\t        Rank:270 漏洞数:74        | 天之屌，人之神！天人合一，乃屌神也！绝对...)\t\t \n  冻猪，你已经被中国某些机构终身监视，因为你知道的太多了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}