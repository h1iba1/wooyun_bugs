{"id": 17408, "wybug_id": "wooyun-2012-010744", "wybug_title": "乐视网某站点存在严重漏洞", "wybug_corp": "乐视网", "wybug_author": "风萧萧", "wybug_date": "2012-08-09 17:12", "wybug_open_date": "2012-09-23 17:13", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-08-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-08-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-08-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-08-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-09-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-09-23：\t细节向公众公开  简要描述： RT 详细说明：  呵呵，支付的问题啦！1.存在问题的站点是\nhttp://hdtv.letv.com/\n2.买一个3D云视频超清机吧，这么牛X的东西！\n\n3.原价980元啊，太贵鸟！\n\n4.选择银行进行支付了\n\n   漏洞证明：  5.点击【下一步】进行支付了，在数据传输过程中，透过代理修改啦\n\n，上面这段传输的数据如下：\ninputCharset=1&bgUrl=http%3A%2F%2Febankapi.letv.com%2Fletvkqnetpay%2Freceive.jsp&pageUrl=&version=v2.0&language=1&signType=4&merchantAcctId=1001334246401&payerName=&payerContactType=1&payerContact=yangw%40letv.com&orderId=20120809152629226921425&orderAmount=98000&orderTime=20120809032629&productName=%E8%B6%85%E6%B8%85%E6%9C%BAS30+%E7%82%AB%E9%85%B7%E9%BB%91&productNum=1&productId=1213&productDesc=&ext1=&ext2=&payType=10&redoFlag=0&pid=&bankId=CMB&signMsg=pNu%2FNuNVrzHD1m91rZV3tUldzupsv4WlHQZZ7E9PZWmukp%2BYzF%2Biko3nGHCvnOrkB1cUOa3j11LV%0D%0AtIar1TfVh3m6S2ku0qXvmiwPUXCWgh37%2F7QwUzMgVMSw0cXa7V6FA%2FA86sj00dMPzv9eDCL45CoM%0D%0AvH%2BCTw3FKcIbiEWFKWA%3D\n6.很明显orderAmount=98000是需要支付的金额了，该成100吧，返回银行支付页面如下：\n\n7.到这一步就结束啦，没有购买任何东西哦！   修复方案：  1.像金额这样的信息不要放在页面上，确实有随时被篡改的风险，这些信息本来就在数据库中，可以定义一个字符型的字段代替金额的传输，或者直接由商品唯一标识来查询数据库得到金额；2.签名校验是最重要的了，将购买的商品、数量、金额（或替代字段）、订单的ID号生成一个校验字符串。在每次数据传输的过程中进行校验，当然这个校验的内容可以多次生成；3.银行或者第三方支付平台的支付接口都会检验商户的订单数据签名，这里当支付页面跳转到块钱的时候没有做签名校验，导致金额数据被篡改，请进一步确认接口问题；4.支付前需要做签名校验，支付之后同样需要再次做校验，按理说所有银行应该在支付完成之后返回一些信息（如支付金额等）给商户，这样可以通过回来的信息判断是否全额支付；5.还有什么比SSL更可靠的呢！   版权声明：转载请注明来源 风萧萧@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2012-08-09 17:23 厂商回复： 感谢挖掘，前段时间曾经有过类似的问题，我们目前除了验证订单，同时还会验证用户最终的成交金额。当然此问题也值得我们思考，需要优化支付流程。再次感谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-08-09 17:16 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  最后一步一般企业会到银行校验的    \n     2012-08-09 17:22 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @xsser 你测试了么？修复方案的第四点也提到了这个哎.期待补充！    \n     2012-08-09 17:22 |    \t\tshine  \t\t\t( 普通白帽子  |\t\t\t        Rank:831 漏洞数:77        | coder)\t\t \n  原来洞主说的是支付问题啊！    \n     2012-08-09 23:08 |    \t\t一刀终情 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:28        | ‮‮PKAV技术宅社区-安全爱好者)\t\t \n  我昨天看这我的乐视会员，还在想，是不是当时充的一年少了点T_T，应该不会再有这个问题了……    \n     2012-08-10 06:44 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @一刀兄，乐视还是挺给力的！挖洞送乐豆的！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}