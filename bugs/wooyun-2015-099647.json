{"id": 44598, "wybug_id": "wooyun-2015-099647", "wybug_title": "小米某服务器Elasticsearch Groovy命令执行", "wybug_corp": "小米科技", "wybug_author": "lijiejie", "wybug_date": "2015-03-05 14:31", "wybug_open_date": "2015-04-20 14:22", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-20：\t细节向公众公开  简要描述： 小米某服务器Elasticsearch Groovy命令执行 详细说明：  随手发现，这漏洞扫描和利用的成本都很低。\n101.251.102.17:9200/_search?pretty\n有小米彩票cp.mi.com的Ngix access log，可能是小米的机器。例如:\n\"message\":\"10.144.7.2 - - [22/Jan/2015:11:24:19 +0800] \\\"GET /v11/css/pay.css HTTP/1.0\\\" cp.mi.com 200 9315 \\\"http://cp.mi.com/pay/xiaomicashpay/xiaomi-cash-pay!xiaomireturndata.action?{%22result%22:%22errorCode=200&isSuccess=T&notifyType=RETURN&orderDesc=%E5%B0%8F%E7%B1%B3%E5%BD%A9%E7%A5%A8-%E5%8F%8C%E8%89%B2%E7%90%83&outOrderId=20150122112119009284103&partnerId=10000077&payBank=NOT_APPLICABLE&payTime=1421897034&totalFee=1&tradeId=20150122112135132001060332001501&tradeStatus=TRADE_SUCCESS&sign=wmQF0NiZiH-cCzwnthoe1clyvez4nFDPXVC6HPk57CadEaAh5I_OBEunpsnYBa2IaNzY29jIYT9Yh6FUPm0iYI1sflVMiaVlnQ_tDxR6OJJylbmcDGVhQoMHiA1xeUNknKiYXCfmrPuwaQG3DEeqpAkOtuUU3fqNjrASg2MXjgE.%22,%22code%22:0}\\\" \\\"Mozilla/5.0 (Linux; U; Android 4.1.1; zh-cn; MI 2S Build/JRO03L) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30 MiuiYellowPage\\\" \\\"112.65.230.236\\\" - - - \\\"-\\\" - > 0.000\",\"@version\":\"1\",\"@timestamp\":\"2015-01-22T03:24:20.095Z\",\"type\":\"nginx-access\",\"host\":\"vm10-140-26-24.ksc.com\",\"path\":\"/micai_data/nginx_log/access.log\",\"client_ip\":\"10.144.7.2\",\"ident\":\"-\",\"auth\":\"-\",\"timestamp\":\"22/Jan/2015:11:24:19 +0800\",\"verb\":\"GET\",\"request\":\"/v11/css/pay.css\",\"http_version\":\"1.0\",\"domain\":\"cp.mi.com\",\"response\":\"200\",\"bytes\":\"9315\",\"referrer\":\"\\\"http://cp.mi.com/pay/xiaomicashpay/xiaomi-cash-pay!xiaomireturndata.action?{%22result%22:%22errorCode=200&isSuccess=T&notifyType=RETURN&orderDesc=%E5%B0%8F%E7%B1%B3%E5%BD%A9%E7%A5%A8-%E5%8F%8C%E8%89%B2%E7%90%83&outOrderId=20150122112119009284103&partnerId=10000077&payBank=NOT_APPLICABLE&payTime=1421897034&totalFee=1&tradeId=20150122112135132001060332001501&tradeStatus=TRADE_SUCCESS&sign=wmQF0NiZiH-cCzwnthoe1clyvez4nFDPXVC6HPk57CadEaAh5I_OBEunpsnYBa2IaNzY29jIYT9Yh6FUPm0iYI1sflVMiaVlnQ_tDxR6OJJylbmcDGVhQoMHiA1xeUNknKiYXCfmrPuwaQG3DEeqpAkOtuUU3fqNjrASg2MXjgE.%22,%22code%22:0}\\\"\",\"agent\":\"\\\"Mozilla/5.0 (Linux; U; Android 4.1.1; zh-cn; MI 2S Build/JRO03L) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30 MiuiYellowPage\\\"\",\"x_forword\":\"112.65.230.236\",\"upstream_content_type\":\"\\\"-\\\"\",\"request_time\":\"0.000\"\n   漏洞证明：  读取passwd:\n\"root:x:0:0:root:/root:/bin/bash\", \"bin:x:1:1:bin:/bin:/sbin/nologin\", \"daemon:x:2:2:daemon:/sbin:/sbin/nologin\", \"adm:x:3:4:adm:/var/adm:/sbin/nologin\", \"lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\", \"sync:x:5:0:sync:/sbin:/bin/sync\", \"shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\", \"halt:x:7:0:halt:/sbin:/sbin/halt\", \"mail:x:8:12:mail:/var/spool/mail:/sbin/nologin\", \"uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin\", \"operator:x:11:0:operator:/root:/sbin/nologin\", \"games:x:12:100:games:/usr/games:/sbin/nologin\", \"gopher:x:13:30:gopher:/var/gopher:/sbin/nologin\", \"ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin\", \"nobody:x:99:99:Nobody:/:/sbin/nologin\", \"vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin\", \"saslauth:x:499:76:\\\"Saslauthd user\\\":/var/empty/saslauth:/sbin/nologin\", \"postfix:x:89:89::/var/spool/postfix:/sbin/nologin\", \"sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin\", \"ntp:x:38:38::/etc/ntp:/sbin/nologin\", \"apache:x:48:48:Apache:/var/www:/sbin/nologin\", \"tcpdump:x:72:72::/:/sbin/nologin\", \"elasticsearch:x:498:498:elasticsearch user:/usr/share/elasticsearch:/sbin/nologin\", \"logstash:x:497:497:logstash:/opt/logstash:/sbin/nologin\"\n\n\n   修复方案：  升级或配置script.groovy.sandbox.enabled: false不绑定外网IP   版权声明：转载请注明来源 lijiejie@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-03-05 17:55 厂商回复： 该ip为合作厂商彩米公司所属，已积极联系合作厂商修复，感谢提交。 最新状态： 2015-03-06：彩米公司回复：1.该服务器上已经没有数据了，且已经被金山云收回；2.金山云收回服务器后没有初始化，所以我们之前没有关闭的服务还在运行（现在已经确认关闭）  ", "replys": "漏洞评价：\n评论\n     2015-03-05 14:46 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  我在线，我是不是也应该来刷一个呢？    \n     2015-03-05 14:48 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  @猪猪侠  快快快，来一发！    \n     2015-03-05 14:52 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  擦，你又开始刷了！    \n     2015-03-05 14:56 |    \t\t无心、 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:20        | 你不是风儿，我也不是沙，再怎么缠绵也到不...)\t\t \n  关注，今天刚在想，好久没看见小米的漏洞了，然后一刷新，就出现了。。。。    \n     2015-03-05 15:07 |    \t\t呆子不开口 \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:25        | 求各种兼职)\t\t \n  @无心、 你为什么要想“好久没看见小米的漏洞了”呢，你女朋友在小米么    \n     2015-03-05 15:08 |    \t\tlijiejie  \t\t\t( 核心白帽子 |\t\t\t        Rank:2210 漏洞数:294        | Just for fun.)\t\t \n  @猪猪侠 大侠你莫非要一打一打地刷...    \n     2015-03-05 15:14 |    \t\t无心、 \t\t\t( 实习白帽子  |\t\t\t        Rank:71 漏洞数:20        | 你不是风儿，我也不是沙，再怎么缠绵也到不...)\t\t \n  @呆子不开口 你猜啊。    \n     2015-03-05 15:18 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  小二，上一提Elasticsearch Groovy命令执行    \n     2015-03-05 15:37 |    \t\tBMa \t\t\t( 普通白帽子  |\t\t\t        Rank:1776 漏洞数:200        )\t\t \n  又开始刷这个了，    \n     2015-03-05 15:59 |    \t\ttodaro \t\t\t( 实习白帽子  |\t\t\t        Rank:39 漏洞数:12        | 完结。)\t\t \n  真可怕，什么应景刷什么    \n     2015-03-05 17:34 |    \t\t龍 、 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:135        | 你若安好  我就是晴天)\t\t \n  真可怕，什么应景刷什么     \n     2015-03-05 17:59 |    \t\t大大灰狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:248 漏洞数:53        | Newbie)\t\t \n  正在拼命的刷洞中    \n     2015-03-05 19:14 |    \t\tpigzhu \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:4        | 网络共享！)\t\t \n  牛X  开启膜拜模式    \n     2015-03-05 23:25 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  大牛别跑太快    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}