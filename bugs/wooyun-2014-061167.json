{"id": 2006, "wybug_id": "wooyun-2014-061167", "wybug_title": "qibocms黄页SQL注入漏洞一枚", "wybug_corp": "齐博CMS", "wybug_author": "′雨。", "wybug_date": "2014-05-19 19:40", "wybug_open_date": "2014-08-17 19:42", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向公众公开  简要描述： 刚从官网首页上面下载的。比较苦逼。  首页上好像没更新文件?本来还以为可以直接提升自己为管理的, 不过测试测试 蛋疼的多行 让我放弃了 老老实实来注入把。。    详细说明：  在hy/member/homepage_ctrl/contracrus.php中\n@extract($_POST);\t\tif($qy_contact_email&&!ereg(\"^[-a-zA-Z0-9_\\.]+\\@([0-9A-Za-z][0-9A-Za-z-]+\\.)+[A-Za-z]{2,5}$\",$qy_contact_email)){\t\tshowerr('邮箱不符合规则');\t}\telseif($qy_website&&!eregi(\"^http:\",$qy_website)){\t\tshowerr('网址有误,必须是http://开头');\t}elseif($qy_postnum&&!eregi(\"^([0-9]{6})$\",$qy_postnum)){\t\tshowerr('邮政编码有误');\t}elseif($qy_contact_mobile&&!eregi(\"^1([0-9]{10})$\",$qy_contact_mobile)){\t\tshowerr('手机号码有误');\t}elseif($qq&&!eregi(\"^([0-9]{5,11})$\",$qq)){\t\tshowerr('QQ号码有误');\t}elseif($msn&&!ereg(\"^[-a-zA-Z0-9_\\.]+\\@([0-9A-Za-z][0-9A-Za-z-]+\\.)+[A-Za-z]{2,5}$\",$msn)){\t\tshowerr('msn不符合规则');\t}\t$db->query(\"UPDATE `{$_pre}company` SET\t`qy_contact`='$qy_contact',\t`qy_contact_zhiwei`='$qy_contact_zhiwei',\t`qy_contact_tel`='$qy_contact_tel',\t`qy_contact_fax`='$qy_contact_fax',\t`qy_contact_mobile`='$qy_contact_mobile',\t`qy_website`='$qy_website',\t`qy_contact_email`='$qy_contact_email',\t`qy_postnum`='$qy_postnum',\t`qy_address`='$qy_address',\t`qq`='$qq',\t`msn`='$msn',\t`skype`='$skype',\t`ww`='$ww',\t`city_id`='{$city_id}',\t`gg_maps`='$gg_maps'\tWHERE uid='$uid'\");\n这里@extract($_POST); 变量覆盖。一开始想的是把update的这表前缀给覆盖了。然后update qb_memberdata 给自己提升为管理。但是这可恶的多行。 # -- 只能做单行注释`qy_contact`='$qy_contact',\t`qy_contact_zhiwei`='$qy_contact_zhiwei',没办法注释掉这下面的这些,  用/*的话 我测试了必须还在最后加上*/。。。用换行也失败了。。看来只有老老实实来注入了。UPDATE `qibo_hy_company` SET\t`qy_contact`='',\t`qy_contact_zhiwei`='',\t`qy_contact_tel`='',因为无法注释掉后面的 所以只有想办法来补全语句来注入但是因为后面的这个set qy_contact 只是在表company里面才有所以还是得让$_pre为这个表。语句大概为这样的。  首先覆盖掉$_pre 让其为qibo_hy_company此时之星的语句为UPDATE `qibo_hy_company_company` SET\t`qy_contact`='',\t`qy_contact_zhiwei`='',\t`qy_contact_tel`='',然后先闭合第一个反引号 然后单行注释掉_company` SETUPDATE `qibo_hy_company`#_company` SET\t`qy_contact`='',最后自己补一个。UPDATE `qibo_hy_company` SET qy_contact=xx#_company` SET\t`qy_contact`='',可以注入了。     漏洞证明：  \n\n   修复方案：  check   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2014-05-20 11:06 厂商回复： 老问题来的，个别程序遗漏了更新。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}