{"id": 5683, "wybug_id": "wooyun-2013-044618", "wybug_title": "金山毒霸NDProxy漏洞防护再次轻易绕过（第二弹）", "wybug_corp": "金山毒霸", "wybug_author": "zeroday-king", "wybug_date": "2013-12-01 22:43", "wybug_open_date": "2014-03-01 22:43", "wybug_type": "权限提升", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-12-06：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-01-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-01：\t细节向公众公开  简要描述： 11.29提交了金山毒霸防御微软NDProxy内核漏洞的版本存在轻松绕过缺陷http://www.wooyun.org/bugs/wooyun-2010-044412。今天看了看，金山已经修复了之前“拦一个漏一个的低级错误”（NDProxy漏洞CVE-2013-5065有两个设备控制码都可以触发），不过稍微变下攻击手法，金山这个漏洞防护又可以轻松绕过了，演示视频http://v.youku.com/v_show/id_XNjQyMTgxNTM2.html其实绕过方法已经很old了，乌云上去年就有人提交过，所以说不认真学习乌云吞恶果啊。 详细说明：  金山毒霸的新驱动kisknl.sys (2013年11月29日 20:22:48) ，修复了之前报告的写一个漏一个的漏洞，把两个控制码都拦截了，不过拦截处理上还有问题。在处理设备控制时，kisknl.sys会在异常处理捕获中访问缓存，并判断其中是否存在可造成攻击的数值。我们将缓存构造成PAGE_GUARD的，就会触发kisknl的异常处理，放行这个设备控制，接着系统就去除guard标记，将有问题的设备控制命令发送到有漏洞的驱动了，就这么绕过了金山毒霸的拦截。这里用的guard page绕过技巧是乌云在2012年11月公开的一个漏洞： WooYun: 主动防御类软件的通用实现漏洞   里首先在国内公开的。   漏洞证明：  *((DWORD *)((PCHAR)InputBuffer+0x14)) = 0x7030125;       DWORD dwoldprot ; VirtualProtect(InputBuffer , 0x400 , PAGE_READWRITE | PAGE_GUARD , &dwoldprot);DeviceIoControl(hDevice, 0x8fff23c8, InputBuffer, 0x400, InputBuffer, 0x80, &junk, 0);运行后即BSOD，设置SHELLCODE后可内核执行代码。\n\n   修复方案：  认真学习   版权声明：转载请注明来源 zeroday-king@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2013-12-03 11:03 厂商回复： 收到，非常感谢。我们将尽快协调业务部门进行漏洞确认与更新升级。 最新状态： 2013-12-10：目前最新版已经修复，非常感谢  ", "replys": "漏洞评价：\n评论\n     2013-12-01 23:31 |    \t\t雷锋 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 承接:钻井，架工，木工，电工，水暖工，力...)\t\t \n  楼主v687    \n     2013-12-02 09:34 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  楼    \n     2013-12-04 10:08 |    \t\tLeon \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 永无宁日啊)\t\t \n  V5    \n     2014-03-02 08:26 |    \t\t小震 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | ~)\t\t \n  这个马赛克是怎么打的。求教啊。。。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}