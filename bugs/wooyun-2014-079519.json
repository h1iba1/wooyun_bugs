{"id": 47836, "wybug_id": "wooyun-2014-079519", "wybug_title": "搜狗输入法设计缺陷助我成功提权", "wybug_corp": "搜狗", "wybug_author": "goubuli", "wybug_date": "2014-10-15 20:16", "wybug_open_date": "2015-01-13 20:18", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "中", "wybug_rank_0": "7", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-21：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-13：\t细节向公众公开  简要描述： 装机量如此之大，甚至很多服务上都会发现搜狗的输入法。依稀记得微软经典的输入法漏洞，这个当然不能与它相提并论了。。。   详细说明：  之前搞了没有权限的shell，当时由于提权不成功，也就扔在那儿了。。。这几天翻看菜刀发现shell还在，依旧没有权限\n\n没有权限。。。手头提权工具搞不定啊。。。看看进程。。。装了很多软件，SVN、WAMP、JAVA、Oracle等等主要还是装了360.。。肯定是把工具给干了！！！再看看发现有搜狗输入法。。\n\n这个是我好早之前就发现的问题，一直没想到利用，今天终于派上用场了。主要问题是：由于搜狗输入法默认设置是自动更新（很少有人去更改这个设置），更新程序没有对exe做任何校验直接在输入法升级时调用运行，导致可以执行恶意代码。\n\n本地测试，整个计算器（calc.exe）改名为：PinyinUp.exe\n\n等了好久（这个更新时间间隔忘记是多少了），可爱的“计算器”就在那儿显示着。。。\n\n成功执行。。。。后面的提权操作，直接上图了。。。。\n\n\n\n过了一段时间以后。。。\n\n\n\n下面操作略。。。我在以前5.x的版本好像就发现过，那个时候没当回事，觉得这个太鸡肋肯定用不到，今天突然想到，作为白帽子还是提交了吧。。。   漏洞证明：  \n\n\n\n\n\n\n\n\n\n   修复方案：  加文件校验或文件hash对比   版权声明：转载请注明来源 goubuli@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-10-18 22:52 厂商回复： 感谢支持，欢迎到SGSRC平台提交漏洞。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-15 20:19 |    \t\tYY-2012 \t\t\t( 普通白帽子  |\t\t\t        Rank:2763 漏洞数:641        | 意淫，是《红楼梦》原创的词汇，但后来演变...)\t\t \n  又是win7，win8，win10 ?    \n     2014-10-15 20:27 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2738 漏洞数:547        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  hehe    \n     2014-10-15 20:33 |    \t\tgoubuli \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:61        )\t\t \n  @YY-2012  只针对搜狗输入法，不针对特定系统，这个问题一直有。    \n     2014-10-15 21:52 |    \t\t雷锋 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:2        | 承接:钻井，架工，木工，电工，水暖工，力...)\t\t \n  别滴输入法捏    \n     2014-10-16 09:04 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  厉害~    \n     2014-10-16 11:57 |    \t\tB1acken \t\t\t( 普通白帽子  |\t\t\t        Rank:174 漏洞数:56        | 渣渣)\t\t \n  略屌    \n     2014-10-19 15:29 |    \t\tKnight \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:10        | 刚刚上洗手间，看到一个玉树临风的少年，气...)\t\t \n  感觉和我那个漏洞是一样一样的。    \n     2014-11-10 21:34 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  jsp的shell？要不应该权限不会太高啊，不一定可以替换    \n     2014-11-10 21:44 |    \t\tgoubuli \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:61        )\t\t \n  @wefgod  对的，环境苛刻。但是只要访问C盘没问题就可以的。搜狗输入法那个目录没有特殊限制    \n     2014-11-11 15:30 |    \t\t小包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:100 漏洞数:19        | 关注技术与网络安全)\t\t \n  后来用的什么替换了pinyinup.exe提权的？    \n     2014-11-11 16:06 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @小包子 看图的意思应该是    \n     2014-11-11 16:15 |    \t\t小包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:100 漏洞数:19        | 关注技术与网络安全)\t\t \n  @wefgod 哦，明白了，添加了个账户。。。    \n     2014-12-04 07:27 |    \t\tCoffee \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:15        | Corie, a student of RDFZ.)\t\t \n  思路不错～    \n     2014-12-05 14:37 |    \t\t小r00to1 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:42        )\t\t \n  确实很好。。。    \n     2015-01-13 20:26 |    \t\tJumbo \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:29        | 猫 - http://www.chinabaiker.com)\t\t \n  @goubuli 自动更新就运行我们的PinyinUp.exe？然后PinyinUp.exe是添加用户的？难道360不会报警吗    \n     2015-01-13 20:42 |    \t\tgoubuli \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:61        )\t\t \n  @Jumbo 你随便debug一个exe添加用户，第一次执行的时候你看看360会不会报警。。。    \n     2015-01-13 20:42 |    \t\tplane636 \t\t\t( 普通白帽子  |\t\t\t        Rank:160 漏洞数:16        )\t\t \n  这个漏洞有年头了，竟然还没修复    \n     2015-01-13 20:51 |    \t\tgoubuli \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:61        )\t\t \n  @plane636  O(∩_∩)O~ o(╯□╰)o    \n     2015-01-13 21:59 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:29        | 倚楼听风雨，淡看江湖路...)\t\t \n  学习了    \n     2015-01-13 23:37 |    \t\t曙光的希望 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 曙光的希望)\t\t \n  我好想知道 那是要等多久啊    \n     2015-01-14 00:41 |    \t\tdiguoji \t\t\t( 普通白帽子  |\t\t\t        Rank:323 漏洞数:79        | 中国吉林长春)\t\t \n  @曙光的希望 等到输入法升级    \n     2015-01-14 01:35 |    \t\t05XS \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:5        | 总是拿着微不足道的成就来骗自己)\t\t \n  真吊。    \n     2015-01-14 09:51 |    \t\tBMa \t\t\t( 普通白帽子  |\t\t\t        Rank:1776 漏洞数:200        )\t\t \n  这不是老早就存在的？ - - !    \n     2015-01-14 11:34 |    \t\t小虾米 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 刚开始学习安全的一名学生，希望可以快速的...)\t\t \n  学习了    \n     2015-01-14 11:39 |    \t\t爱梅小礼 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:16        | 我怀念的是无话不说)\t\t \n  输入法主程序目录下能有写权限吗？既然权限都这么大了不如替换主程序好了。表示怀疑。    \n     2015-01-14 12:13 |    \t\tgoubuli \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:61        )\t\t \n  @爱梅小礼  可以访问C盘就可以，亲测！O(∩_∩)O~    \n     2015-01-14 12:48 |    \t\tmomo \t\t\t( 实习白帽子  |\t\t\t        Rank:91 漏洞数:24        | ★精华漏洞数:24 | WooYun认证√)\t\t \n  思路很奇葩。学习了一招。    \n     2015-01-14 23:42 |    \t\t曙光的希望 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 曙光的希望)\t\t \n  @diguoji  真屌。。卧槽。。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}