{"id": 85004, "wybug_id": "wooyun-2015-0158353", "wybug_title": "金蝶K3财务软件系统任意文件上传demo测试成功", "wybug_corp": "金蝶", "wybug_author": "hello", "wybug_date": "2015-12-05 11:35", "wybug_open_date": "2016-03-03 09:24", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "代码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-10：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-03-03：\t细节向公众公开  简要描述： 最近公司也买了这系统，对系统测试了下发现存在漏洞，官网demo同样存在这漏洞。财务系统如果对外了被拿权限了确实很麻烦。 详细说明：  漏洞地址\nhttp://**.**.**.**/k3cloud/\n漏洞代码如下\npublic void ProcessRequest(HttpContext context){    try    {        context.Response.ContentType = \"text/plain\";        string physicalPath = context.Request.Headers[\"filefolder\"];        if (string.IsNullOrEmpty(physicalPath))        {            physicalPath = context.Server.MapPath(\"UploadFiles\");        }        else        {            physicalPath = PathUtils.GetPhysicalPath(physicalPath);        }        if (!Directory.Exists(physicalPath))        {            Directory.CreateDirectory(physicalPath);        }        HttpFileCollection files = context.Request.Files;        int count = files.Count;        if (count > 0)        {            for (int i = 0; i < count; i++)            {                HttpPostedFile file = files[i];                if ((file != null) && (file.ContentLength > 0))                {                    string filename = physicalPath + \"/\" + file.FileName;                    file.SaveAs(filename);                }            }            context.Response.Write(\"0\");        }        else        {            string str3 = context.Request.Headers[\"Name\"].ToString();            if (string.IsNullOrWhiteSpace(str3))            {                str3 = \"null\";            }            FileStream stream = new FileStream(physicalPath + \"/\" + str3, FileMode.Append);            context.Request.InputStream.CopyTo(stream);            stream.Flush();            stream.Close();            context.Response.Write(\"1\");        }    }    catch (Exception exception)    {        context.Response.Write(\"-1\");        throw exception;    }}\n没有对上传文件类型进行判断。   漏洞证明：  随便找了个网站 \nhttp://**.**.**.**/k3cloud\n\n\n\n\n\n\n官网demo\n\n\n\n   修复方案：  对文件后缀进行判断。   版权声明：转载请注明来源 hello@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2015-12-07 13:25 厂商回复： 感谢对金蝶的关注，已安排相关人员立即修复！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}