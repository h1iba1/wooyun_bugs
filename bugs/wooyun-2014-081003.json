{"id": 47412, "wybug_id": "wooyun-2014-081003", "wybug_title": "金蝶政务GSiS服务平台通用任意文件上传漏洞", "wybug_corp": "金蝶", "wybug_author": "路人甲", "wybug_date": "2014-10-27 19:29", "wybug_open_date": "2015-01-25 19:30", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-31：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向公众公开  简要描述： 参照下前人的描述：GSiS政务服务平台：首个完全根据国家政策要求全新开发的，支撑政务服务体系和行政权力监督体系融合运转的一体化平台。存在任意文件上传漏洞，可获取webshellPS：两$$符啥感觉，给一个爽爽吧~~ 详细说明：  程序名称：Kingdee GSIS开发公司：金蝶漏洞类型：任意文件上传漏洞文件：/core/upload/upload.jsp关键词：inurl:/kdgs/收集几个案例，方便测试\n\nmask 区域\n1.http://**.**.**/kdgs/_2.http://**.**.**/kdgs/_3.http://**.**.**/kdgs/_4.http://**.**.**/kdgs/_5.http://**.**.**/kdgs/\n\n漏洞成因：对文件上传类型没有严格过滤，当允许类型allowedTypes为null时，采用的是*.*通配，导致任意文件上传。\n//判断上传格式String fileDesc;String fileExt;String uploadFileNumber;    if(allowedTypes.equals(\"image\" )|| allowedTypes==\"image\"){    \tfileDesc=\"jpg/gif/jpeg/png/bmp\";    \tfileExt=\"*.jpg;*.gif;*.jpeg;*.png;*.bmp\";    \tuploadFileNumber=\"1\";    }else{    \tfileDesc=\"*\";    \tfileExt=\"*.*\";/////这里是问题所在    \tuploadFileNumber=\"10\";    }\n漏洞利用：①首先注册一个普通用户，登录及注册地址：/kdgs/biz/portal/login/login.action②访问/kdgs/core/upload/upload.jsp ，选择jsp文件，上传抓包，把path的值改为ITEM_PATH提交，即可获得webshell,简单粗暴实例演示：###NO.1\n\nmask 区域\n1.http://**.**.**/kdgs/\n\n首先访问http://******.gov.cn:8080/kdgs/biz/portal/login/login.action点击注册一个用户，这里我注册的testbye/testtest，登录进去\n\n直接访问:http://*****.gov.cn:8080/kdgs/core/upload/upload.jsp\n\n选择jsp马上传抓包，改path:ITEM_PATH\n\n在返回值里看shell路径\n\nshell路径为：/uploads/item/11e4-5dc8-b4173752-b77d-1335b63918b7.jsp，后面的Jf**.jsp去掉\n\n####NO.2\n\nmask 区域\n1.http://**.**.**/kdgs/\n\n步骤和上面一样，注册个用户，登录访问core\\upload/upload.jsp 上传抓包改包：\n\n返回的shell地址：\n\nshell：\n\n政府站点，演示证明下就行了，shell已删.. 就不去弄5个站演示了   漏洞证明：  如上   修复方案：  过滤上传文件类型   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-10-28 09:59 厂商回复： 感谢关注金蝶产品安全，之前已经有同学反馈了，只是产品部门不够重视修复进度比较慢，目前已经自上而下去推动了。再次感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-29 10:39 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  我就说吗，之前有人提交过了啊    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}