{"id": 35047, "wybug_id": "wooyun-2015-0119999", "wybug_title": "74cms三处sql注入漏洞", "wybug_corp": "74c,s.com", "wybug_author": "answer", "wybug_date": "2015-06-12 15:40", "wybug_open_date": "2015-09-15 15:43", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-06-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-06-17：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-15：\t细节向公众公开  简要描述： 代码审计第三发 详细说明：  看代码include/fun_company.php 963-968行\nfunction action_user_setmeal($uid,$action){\tglobal $db;\t$sql=\"update \".table('members_setmeal').\" set `\".$action.\"`=\".$action.\"-1  WHERE uid=\".intval($uid).\"  AND  effective=1 LIMIT 1\";    return $db->query($sql);}\n可以看到$action未做处理就进入SQL语句了。下面看看哪些地方调用了action_user_setmeal这个函数有以下这些文件\n\n其中我划线的文件，变量就是我们可控的。下面看看那三个文件1.plus/ajax_get_promotion.php 263-264行\n$user_pname=trim($_GET['pro_name']);\t\t\t\t\taction_user_setmeal($_SESSION['uid'],$user_pname); //更新套餐中相\n可看到$user_pname来自用户传过去pro_name参数，而且并未做处理，就进入了action_user_setmeal 函数，所以造成注入。2.user/company/company_ajax.php  266-267行3.user/company/company_promotion.php  262-263行这两处和第一处一样，代码就不贴了。下面证明   漏洞证明：  我们用第二处来证明，因为这一出，更直观。首先注明：需要后台的运营模式是套餐模式。(虽然默认的不是，但是总会用网站的是需要第二种模式的。)\n\n1.注册一个企业账号2.发布一个职位3.来到推广的地方\n\n可任意点击红框内的一个按钮，这里拿置顶来测试。点击置顶之后，截包，我划红线的地方就是可控的参数\n\n看看SQL语句监控\n\n完美执行，这里我们就可以该自己的用户类型，变成高级会员 哈哈哈。因为有waf，绕不过，所以只能用布尔盲注。所以找了找页面变化的地方。加载payload之前的\n\n加了payload之后的是\n\n 免费会员就成了我们提交的34了，此处就可以作为布尔盲注判断的地方，进行注入。（可以写脚本跑的）。至于payload中的uid参数，抓个包就能看见是多少了其他两处都差不多   修复方案：  你懂的额   版权声明：转载请注明来源 answer@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-09-15 15:43 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-06-25 19:29 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:6        | 学姿势，学思路。)\t\t \n  等阵子看公开    \n     2015-09-15 15:44 |    \t\tsOnsec \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:18        | 安全是什么...)\t\t \n  - - 为何无影响呢。    \n     2015-09-15 16:13 |    \t\tHckmaple \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:1        | ~~~)\t\t \n  学习了    \n     2015-09-15 16:49 |    \t\tRainism \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | hacking for fun)\t\t \n  学习了    \n     2015-09-15 17:52 |    \t\thack_lan \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 爱好linux开源架构，安全，python)\t\t \n  监控工具是撒工具啊？    \n     2015-09-15 18:02 |    \t\tMsyb \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:8        | 非常荣幸加入乌云。)\t\t \n  @hack_lan 是seay代码审计系统自带的一个mysql监视插件。    \n     2015-09-16 09:30 |    \t\thack_lan \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 爱好linux开源架构，安全，python)\t\t \n  @Msyb  谢谢 我去看看    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}