{"id": 44540, "wybug_id": "wooyun-2015-093229", "wybug_title": "腾讯某通用插件储存XSS（可影响几百个分站）", "wybug_corp": "腾讯", "wybug_author": "px1624", "wybug_date": "2015-01-21 20:01", "wybug_open_date": "2015-04-21 20:02", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["腾讯"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-03-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-21：\t细节向公众公开  简要描述： 这个影响的范围真心大，请赶紧修补吧，随便插了条xss，不到3分钟就获取到了300多条cookie。 详细说明：  漏洞存在使用腾讯牛评这个插件的所有分站中，貌似基本上大部分的分站使用的都是这个评论插件。然后当评论后，那条评论会在0-30分钟不等的时间里，显示到全部评论里面（不知道为啥，这里不同分站显示的时间不一样，有的立即就会显示，有的会过段时间而不会时时显示的）。然后由于评论位置存在XSS，所以会导致用户在访问这个存在xss的网页的时候就中招了。可以影响的站点有，腾讯新闻、体育、娱乐、视频等等，累计大大小小的分站几百个，所以危害还是很大啊。这里我随便找了个网页，不到3分钟，就收到了300多条cookie。设想如果写个脚本，给所有使用腾讯牛评的分站的评论位置都写入XSS的话，那么会有多少人会中招呢？1 存在缺陷的通用插件：腾讯牛评 http://www.qq.com/coral/coralindex/indexCoral_new.htm\n\n2 以下面这个站为例子说明漏洞（为了避免影响他人，测试代码已经删除）http://ent.qq.com/a/20150121/005159.htm3 由于某处存在缺陷，所以可以构造利用代码进行XSS，代码见测试代码位置。4 然后可以发现成功插入并执行了XSS\n\n5 F12看看输出，成功插入了script标签执行了xss，并且闭合了后面代码，效果如图。\n\n6 同理，可以成功的插入调用外部js的代码\n\n7 可以成功盗取用户cookie信息，这里我随便找了个网页，不到3分钟，就收到了300多条cookie。\n\n8 利用cookie随便登录几个帐号证明下。\n\n\n\n\n\n9 然后这里我试了试其他的使用腾讯牛评的分站，一般有2种情况，一种就是直接可以添加图片的，那么就可以按上述方法进行XSS。还有一种是不提供添加图片的功能的，这种只需要自己手动添加post请求的图片参数picture，然后按照上述方法也可以成功XSS。\n\n综上，通杀所有使用腾讯牛评这个评论插件的站   漏洞证明：  如上写的很详细了。然后你们也可以看看这个测试站点：http://cul.qq.com/a/20150121/055254.htm不过不知道当你看到这个漏洞报告的时候，我插的那个xss评论还在没，有么有被别人的评论给刷没了呢。。。   修复方案：  过滤特殊字符   版权声明：转载请注明来源 px1624@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-01-22 15:55 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-22 15:58 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  哎呀，不错啊    \n     2015-01-22 16:13 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  哎呀，厉害啊    \n     2015-01-22 16:21 |    \t\tboooooom  \t\t\t( 普通白帽子  |\t\t\t        Rank:467 漏洞数:50        | 我有一个好想法！)\t\t \n  diao！    \n     2015-01-22 16:26 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  哎呀，厉害啊    \n     2015-01-22 16:46 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @小川 看来确认后其他人就可以看到了额。诶，这种不算通用型么？ @Finger     \n     2015-01-22 19:40 |    \t\t无痕 \t\t\t( 实习白帽子  |\t\t\t        Rank:36 漏洞数:7        | 菜鸟一枚)\t\t \n  这个厉害。。。    \n     2015-01-24 11:50 |    \t\t蛇精病 \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:10        | 你连棒棒糖都没有，还谈什么狗屁爱情？)\t\t \n  哎呀，厉害啊    \n     2015-01-25 21:24 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @boooooom 大牛好！    \n     2015-01-26 04:26 |    \t\tlaoyao \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:5        | ด้้้้้็็็็็้้้้้็็็็...)\t\t \n  mark    \n     2015-01-26 20:30 |    \t\tsoftbug \t\t\t( 实习白帽子  |\t\t\t        Rank:66 漏洞数:10        | 为人类设计最好的软件，解放人的双手,一起...)\t\t \n  不应该啊！     \n     2015-01-26 20:51 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @softbug 怎么不应该？    \n     2015-01-27 21:27 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:1208 漏洞数:316        | 乌云有着这么一群人，在乌云学技术，去某数...)\t\t \n  px牛……    \n     2015-04-22 18:40 |    \t\t屠龙宝刀点击就送 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 简要介绍不能为空)\t\t \n  牛。。。！    \n     2015-08-03 10:31 |    \t\t鬼见愁 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 挖洞之神)\t\t \n  求代码.我给1wb    \n     2015-08-27 11:43 |    \t\tSnow陈伦 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 闷骚的家伙，何处都是你的战场。)\t\t \n  http://www.wooyun.org/upload/201508/27113931231a92c406d3d35e5a651a8728cd7638.jpg    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}