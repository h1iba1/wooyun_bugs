{"id": 9593, "wybug_id": "wooyun-2013-033430", "wybug_title": "QQ浏览器 XSS 漏洞", "wybug_corp": "腾讯", "wybug_author": "心伤的胖子", "wybug_date": "2013-08-03 22:35", "wybug_open_date": "2013-09-17 22:35", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["浏览器漏洞"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-08-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-09-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-17：\t细节向公众公开  简要描述： QQ浏览器中本地某文件过滤不严导致 XSS 漏洞。 详细说明：  测试版本：7.4.11785.400 Beta访问一个任意不存在的页面，QQ浏览器会使用自己的 404 页面进行替换。如下图：\n\n右键查看页面属性为：qqbrowser://html/error.html#404&指定的网页不存在&http://xxx.qq.com/xxx接着查看源代码，找到了自定义 404 页面的代码，如下：\n<script type=\"text/javascript\" src=\"http://www.qq.com/404/search_children.js\" charset=\"utf-8\"></script><script type=\"text/javascript\">     var tempUrl = document.location.href;        var i = tempUrl.indexOf(\"#\");        i = tempUrl.indexOf(\"&\", i + 1);        i = tempUrl.indexOf(\"&\", i + 1);        url = tempUrl.substring(i + 1);    var a = document.getElementsByTagName(\"a\");    for(i=0; i<a.length; ++i){        if(a[i].className=='back_home'){            a[i].className = \"\";                        a[i].innerText = \"刷新本页\";            a[i].setAttribute('href', url);            onload = true;            break;        }    }           </script>\n从上面代码可以看到，我们要访问的不存在的链接最后会成为一个 a 标签的 href 属性，如果我们构造如下的代码是不是可以产生一个本地的 XSS 呢？qqbrowser://html/error.html#404&指定的网页不存在&javascript:alert(1)扔到浏览器中访问，然后点击上图中的“刷新本页”，是不是弹了。如下图：\n\n其实源代码中还有一处：\nfunction handleRefresh(e) {    if (url && !url.match(/^http/i)) {        return;    }    document.location.href = url;}\n只是这地方却对 URL 进行了判断，有点不明白同一个页面为什么只有一处过滤了？这个 XSS 应该属于 qqbrowser 域，不过貌似做不了什么事情。   漏洞证明：  如下图：\n\n   修复方案：  对 URL 进行处理。   版权声明：转载请注明来源 心伤的胖子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2013-08-05 10:14 厂商回复： 感谢反馈，该漏洞已经有人提前报告过，目前正在排期修复中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-08-03 22:44 |    \t\t橙夏 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:4        | 喵呜喵呜喵呜呜呜 喵呜呜喵呜呜呜呜 喵呜呜...)\t\t \n  前排关注    \n     2013-08-03 23:00 |    \t\t360安全卫士 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 360安全卫士就是好)\t\t \n  强势围观    \n     2013-08-03 23:03 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:463 漏洞数:89        | 硬件与无线通信研究方向)\t\t \n  @360安全卫士 来了啊，呵呵，一起看热闹    \n     2013-08-03 23:04 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  mark    \n     2013-08-03 23:10 |    \t\t360安全卫士 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 360安全卫士就是好)\t\t \n  @一只猿 是呀，就喜欢看腾讯的热闹，呵呵    \n     2013-08-03 23:11 |    \t\tevavus \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:11        | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@...)\t\t \n  Mark    \n     2013-08-03 23:55 |    \t\t封印师 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 我是小彩笔来的。...(｡•ˇ‸ˇ•｡) ...)\t\t \n  腾讯滴哎!齐齐来围观!    \n     2013-08-04 00:11 |    \t\tp.z  \t\t\t( 普通白帽子  |\t\t\t        Rank:411 漏洞数:40        )\t\t \n  胖子 你是要赚钱还债吗    \n     2013-08-04 00:42 |    \t\t心伤的胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:308 漏洞数:29        | 因为心伤，所以胖子。)\t\t \n  @p.z 是呀，一堆人追着我要。    \n     2013-08-04 00:44 |    \t\t菊花卫士 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 网站卫士是360旗下为网站提供有偿主动保护...)\t\t \n  @360安全卫士 大哥 这么早到啊    \n     2013-08-04 01:03 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:463 漏洞数:89        | 硬件与无线通信研究方向)\t\t \n  @360网站卫士 @360安全卫士 你们这是要闹哪出？    \n     2013-08-04 06:59 |    \t\t我是小号 \t\t\t( 普通白帽子  |\t\t\t        Rank:334 漏洞数:51        | Martin)\t\t \n  @心伤的胖子 据说在TSRC报告过了~    \n     2013-08-04 08:48 |    \t\t360安全卫士 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 360安全卫士就是好)\t\t \n  @360网站卫士 好基友呀！    \n     2013-08-04 09:02 |    \t\t心伤的胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:308 漏洞数:29        | 因为心伤，所以胖子。)\t\t \n  @我是小号 小号你好    \n     2013-08-04 09:42 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  @鬼魅羊羔   羊羔你好  羊羔再见。    \n     2013-08-04 09:58 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  @鬼魅羊羔 羊羔你好 羊羔再见。    \n     2013-08-04 10:56 |    \t\tSogili \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:27        )\t\t \n  神似我那个360的啊    \n     2013-08-05 10:15 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  有人报告你也要说出来 2    \n     2013-08-05 10:40 |    \t\t心伤的胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:308 漏洞数:29        | 因为心伤，所以胖子。)\t\t \n  麻烦腾讯仔细确认下和之前报告的是不是一样，表面一样可是实质是不一样的哦。    \n     2013-08-05 13:19 |    \t\t冷静 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        )\t\t \n  有人报告你也要说出来 2    \n     2013-08-05 13:20 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  有人报告你也要说出来 2    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}