{"id": 66811, "wybug_id": "wooyun-2015-0142610", "wybug_title": "修改迅雷赚钱宝固件伪造上传量获取水晶（已怒赚10元）", "wybug_corp": "迅雷", "wybug_author": "GoSSIP_SJTU", "wybug_date": "2015-09-21 17:55", "wybug_open_date": "2015-11-06 06:40", "wybug_type": "网络设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-06：\t细节向公众公开  简要描述： 迅雷赚钱宝固件中部署了迅雷DCDN客户端。迅雷DCDN服务器无法验证赚钱宝发来的统计数据的有效性。因此通过修改赚钱宝固件，可以在不占用上传带宽的情况下欺骗迅雷服务器自己正在满速上传，达到单个路由宝约每日5元的最大收益。 详细说明：  来看来看路由宝的/thunder/lib/libdcdn_client.so:* upload_manager_get_period_statistic函数每隔一秒触发一次，用来上报自己已经上传的数据量，* 这个函数最开始判断了两个条件，若果两个条件满足任意一个就上报上传量：   1. 距离上出上报的时间已经超过阈值（300秒）   2. 上次上报到现在已经上传了超过64M数据\n\n* 该函数接下来调用p2p_upload_get_period_stat_data函数获得上次上报之后的统计信息* 可以看到一开始就使用msg_report_upload_set_total_upload_bytes设置了上传量\n\n * 所以只要修改so文件的两个地方就可以欺骗迅雷服务器：* 首先是upload_manager_get_period_statistic最开始的判断条件需要去除，让程序经常上报统计数据，改成如下图:\n\n* 然后是修改p2p_upload_get_period_stat_data中的总上传量，就改成64M好了:\n\n   漏洞证明：  \n\n\n\n   修复方案：     版权声明：转载请注明来源 GoSSIP_SJTU@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2015-09-22 06:39 厂商回复： 感谢反馈! 最新状态： 2015-09-23：您好，经与业务确认，服务器侧具有对账功能，能够发现此类问题，帐实不符的账号会做封号处理。安全上也会继续加强和改进，感谢~ 2015-09-23：经确认:1.该问题属于客户端侧动态库安全机制的漏洞，但是不会影响到水晶流量结算，迅雷流量服务器会对用户上报的流量数据进行对账，用户恶意刷量会触发流量反作弊机制；2.迅雷赚钱宝未设收益上限；3.客户端侧的动态库漏洞会更新固件解决，感谢对迅雷赚钱宝的关注！  ", "replys": "漏洞评价：\n评论\n     2015-09-21 18:05 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:567 漏洞数:108        | 低调求发展)\t\t \n  每日5元。。    \n     2015-09-21 18:20 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1362 漏洞数:218        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  买100台，可以回家养老了    \n     2015-09-21 18:24 |    \t\t‮ \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:4        | -->‮)\t\t \n  再把路由宝固件也改一下，每天坐等养老    \n     2015-09-21 19:54 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1213 漏洞数:321        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  买100台，可以回家养老了    \n     2015-09-21 20:03 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:737 漏洞数:92        | 没关系啊，我们还有音乐)\t\t \n   该来的还是来了.....    \n     2015-09-21 20:31 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1038 漏洞数:176        | px1624)\t\t \n  爽爽的啊！    \n     2015-09-21 20:50 |    \t\t梧桐树下 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:23        | 一大波洞正在过来……)\t\t \n  终于有解套的办法了。    \n     2015-09-21 20:54 |    \t\t来了 \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:6        | .....)\t\t \n  三楼名字亮了    \n     2015-09-21 21:28 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:131 漏洞数:49        | [code]时光如水，总是无言，你若安好，便是...)\t\t \n  买100台，可以回家养老了    \n     2015-09-21 22:13 |    \t\tsherlock \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | 这个人很懒 标点符号都没留下)\t\t \n  厂商不奖励几百块洞主就太亏了    \n     2015-09-22 05:30 |    \t\t大漠長河 \t\t\t( 实习白帽子  |\t\t\t        Rank:64 漏洞数:9        | ̷̸̨̀͒̏̃ͦ̈́̾( 天龙源景区枫叶正...)\t\t \n  是迅雷路由器吗    \n     2015-09-22 07:50 |    \t\t蝶舞天涯 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 家穷人丑，一米四九，小学文化，农村户口，...)\t\t \n  怒赚十元    \n     2015-09-22 09:43 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:208        | 逆流而上)\t\t \n  买10000台，回家想养啥养啥    \n     2015-09-22 10:09 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:463 漏洞数:108        | 什么狗屁爱，生活已乱套！人的一生中，...)\t\t \n  @niliu 假如每台50元 1万台要50万，每天一台赚5元，1万台就是5万，10天就回本钱！这个致富快呀    \n     2015-09-22 10:35 |    \t\tGoSSIP_SJTU \t\t\t( 实习白帽子  |\t\t\t        Rank:74 漏洞数:5        | 上海交通大学密码与计算机安全实验室软件安...)\t\t \n  @大漠長河 不是，是之前那个79元重酬现在卖到158的迅雷赚钱宝。。。    \n     2015-09-22 14:24 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  怒赚10元！    \n     2015-09-23 08:25 |    \t\t商网(乌云厂商)\t\t \n  3楼是个什么鬼    \n     2015-09-23 09:32 |    \t\t迅雷(乌云厂商)\t\t \n  您好，经与业务确认，服务器侧具有对账功能，能够发现此类问题，帐实不符的账号会做封号处理。安全上也会继续加强和改进，感谢~    \n     2015-09-23 12:12 |    \t\tHackPanda \t\t\t( 普通白帽子  |\t\t\t        Rank:113 漏洞数:15        | Talk is cheap,show me the shell.)\t\t \n  @牛 小 帅 这样算几台都是10天回本~    \n     2015-09-23 12:19 |    \t\t随风的风 \t\t\t( 普通白帽子  |\t\t\t        Rank:131 漏洞数:49        | [code]时光如水，总是无言，你若安好，便是...)\t\t \n  @商网 你怎么没有注册成功就说话，真牛逼。    \n     2015-09-23 12:39 |    \t\t迅雷(乌云厂商)\t\t \n  经确认:1.该问题属于客户端侧动态库安全机制的漏洞，但是不会影响到水晶流量结算，迅雷流量服务器会对用户上报的流量数据进行对账，用户恶意刷量会触发流量反作弊机制；2.迅雷赚钱宝未设收益上限；3.客户端侧的动态库漏洞会更新固件解决，感谢对迅雷赚钱宝的关注！    \n     2015-09-23 13:33 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1362 漏洞数:218        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  @商网 @xsser @疯狗 @浩天 z这个商网是个什么鬼啊,不明觉厉    \n     2015-10-23 13:15 |    \t\tby灰客 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:12        | &#8238;)\t\t \n  犆st犆stte    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}