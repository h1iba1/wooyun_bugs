{"id": 7265, "wybug_id": "wooyun-2013-037962", "wybug_title": "Z-Blog PHP版之三低权限管理员POST注入", "wybug_corp": "Z-Blog", "wybug_author": "只发通用型", "wybug_date": "2013-09-24 12:24", "wybug_open_date": "2013-12-23 12:24", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-09-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-09-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-09-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-11-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-11-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-12-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-12-23：\t细节向公众公开  简要描述： 注册个评论者账号就能注到管理员 详细说明：  木有找到你们接受POST变量的函数在哪，所以认为问题出在/zb_system/function/lib/dbsql.php\npublic function ParseWhere($where){\t\tglobal $zbp;\t\t$sqlw=null;\t\tif(!empty($where)) {\t\t\t$sqlw .= ' WHERE ';\t\t\t$comma = '';\t\t\tforeach($where as $k => $w) {\t\t\t\t$eq=$w[0];\t\t\t\tif($eq=='='|$eq=='<'|$eq=='>'|$eq=='LIKE'|$eq=='<>'|$eq=='!='){\t\t\t\t\t$x = (string)$w[1];\t\t\t\t\t$y = (string)$w[2];\t\t\t\t\t$y = $zbp->db->EscapeString($y);\t\t\t\t\t$sqlw .= $comma . \" $x $eq '$y' \";\t\t\t\t}\t\t\t\tif($eq=='BETWEEN'){\t\t\t\t\t$b1 = (string)$w[1];\t\t\t\t\t$b2 = (string)$w[2];\t\t\t\t\t$b3 = (string)$w[3];\t\t\t\t\t$sqlw .= $comma . \" $b1 BETWEEN '$b2' AND '$b3' \";\t\t\t\t}\t\t\t\tif($eq=='search'){\t\t\t\t\t$j=count($w);\t\t\t\t\t$sql_search='';\t\t\t\t\t$c='';\t\t\t\t\tfor ($i=1; $i <= $j-1-1; $i++) { \t\t\t\t\t\t$x=(string)$w[$i];\t\t\t\t\t\t$y=(string)$w[$j-1];\t\t\t\t\t\t$y=$zbp->db->EscapeString($y);\t\t\t\t\t\t$y=$w[$j-1];\t\t\t\t\t\t$sql_search .= $c . \" ($x LIKE '%$y%') \";\t\t\t\t\t\t$c='OR';\t\t\t\t\t}\t\t\t\t\t$sqlw .= $comma .  '(' . $sql_search . ')';\t\t\t\t}\t\t\t\tif($eq=='array'){\t\t\t\t\t$c='';\t\t\t\t\t$sql_array='';\t\t\t\t\tif(!is_array($w[1]))continue;\t\t\t\t\tif(count($w[1])==0)continue;\t\t\t\t\tforeach ($w[1] as $x=>$y) {\t\t\t\t\t\t$y[1]=$zbp->db->EscapeString($y[1]);\t\t\t\t\t\t$sql_array .= $c . \" $y[0]='$y[1]' \";\t\t\t\t\t\t$c='OR';\t\t\t\t\t}\t\t\t\t\t$sqlw .= $comma .  '(' . $sql_array . ')';\t\t\t\t}\t\t\t\tif($eq=='custom'){\t\t\t\t\t$sqlw .= $comma .  '(' . $w[1] . ')';\t\t\t\t}\t\t\t\t$comma = 'AND';\t\t\t}\t\t}\t\techo $sqlw;//顺便把SQL语句ehco 出来,你们的拼接写得好蛋疼\t\treturn $sqlw;\t}\n\n\n注入方法的利用和这个一样 WooYun: Z-Blog的php版前台正则SQL盲注漏洞 ，拿sqlmap跑一下就出来了   漏洞证明：  \n\n   修复方案：  接受的POST都过滤一下   版权声明：转载请注明来源 只发通用型@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-09-24 13:38 厂商回复： 非常感谢！！！已着手处理中了。 最新状态： 2013-09-24：2013-09-24：dbsql.php第197行，删除就好了。  ", "replys": "漏洞评价：\n评论\n     2013-09-24 13:01 |    \t\tX防部 \t\t\t( 普通白帽子  |\t\t\t        Rank:487 漏洞数:137        )\t\t \n  坐等公开 秒杀某热博客！    \n     2013-09-24 14:18 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  return addslashes($sql);即可    \n     2013-09-27 14:38 |    \t\tSkull \t\t\t( 实习白帽子  |\t\t\t        Rank:95 漏洞数:33        | 菜鸟一枚。)\t\t \n  求公开啊。黑阔们，注意啦啊    \n     2013-09-27 15:59 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  谁的马甲。。。封了！    \n     2013-09-27 20:45 |    \t\tZ-Blog(乌云厂商)\t\t \n  @齐迹  反正不是我的    \n     2013-09-27 20:46 |    \t\tZ-Blog(乌云厂商)\t\t \n  @Z-Blog   咦我居然用的不是个人帐号    \n     2013-09-28 02:20 |    \t\tMosuan \t\t\t( 普通白帽子  |\t\t\t        Rank:449 漏洞数:175        | 尘封此号，不装逼了，再见孩子们。by Mosua...)\t\t \n  @Z-Blog 你别搞笑了。。    \n     2013-09-28 08:58 |    \t\tX防部 \t\t\t( 普通白帽子  |\t\t\t        Rank:487 漏洞数:137        )\t\t \n  @Z-Blog 过两天再发补丁包！我先日了某人博客再说 哈哈！    \n     2013-09-28 11:29 |    \t\t只发通用型 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:14        | 刷通用型奖金小号)\t\t \n  @X防部 PHP版有人用了？    \n     2015-02-06 01:00 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  @只发通用型 怎么没看到 $ ，这个没奖金？？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}