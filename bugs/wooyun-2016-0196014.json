{"id": 87329, "wybug_id": "wooyun-2016-0196014", "wybug_title": "深信服应用交付报表系统某处命令执行                                      ", "wybug_corp": "深信服", "wybug_author": "路人甲", "wybug_date": "2016-04-13 22:10", "wybug_open_date": "2016-06-02 08:10", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "16", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-04-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-04-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-02：\t细节向公众公开  简要描述： RT 详细说明：  仅仅影响4.5以下，漏洞存在于report\\script\\login.php\n$user_urlcoded = $_REQUEST['userID'];$pswd_urlcoded = $_REQUEST['userPsw'];$addr_urlcoded = urlencode($_SERVER['REMOTE_ADDR']);$userName = urldecode($_REQUEST['userID']);//这里都使用urldecode了，为啥不用其他的替换呢$log_type = $_REQUEST['log_type'];if(strlen($user_urlcoded)!=0 && strlen($pswd_urlcoded)!=0){\t$errorMsg = exec(\"/usr/sbin/webui/cgi-bin/login.cgi login_check \" . $user_urlcoded .\" \". $pswd_urlcoded . \" \" .$addr_urlcoded);\t//直接就执行了\tif ($errorMsg == \"0\")\t{\t\t$_SESSION[\"user_name\"] = $userName;\t\t// 获取当前用户权限\t\tget_user_permission($user_urlcoded);\t\t// 检查是否拥有权限\t\tif(!$_SESSION['rep_login'])\t\t{\t\t\t$errorMsg = \"提示：对不起，您没有权限登录报表\";\t\t}\t\telse if($_SESSION['rep_view'] == \"0\")\t\t{\t\t\t$errorMsg = \"提示：对不起，您没有权限查看报表\";\t\t}\t\t// 设定超时\t\t$_SESSION['request_time'] = time();\t\t$_SESSION['max_time'] = 600;\t\t$session_file = simplexml_load_file('/etc/sinfor/ad/sys/sys_adminif.conf');\t\tforeach($session_file->property as $property)\t\t{\t\t\tif($property['name']==\"rep_timeout\")\t\t\t{\t\t\t\t$_SESSION['max_time'] = intval($property);\t\t\t}\t\t}\t}}\n$_SERVER['REMOTE_ADDR']被url编码了.只是剩下了userPsw跟userID可以执行了.\n\nuserPsw的执行\n\n   漏洞证明：  userID的命令执行\n\nuserPsw的命令执行\n\n附上几个案例\nhttp://oat.aweb.com.cn:85/report/script/login.phphttp://223.203.217.104:85/report/script/login.php\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-04-18 08:02 厂商回复： 感谢白帽子提交的问题。经确认，该问题确实存在，该问题只存在于AD3.9-AD4.5中的部分版本设备中，4.5以上版本已经将此问题修复（目前版本为6.4）。由于该设备并未进行版本升级，导致问题遗留，目前客服同事正在进行跟踪核对，协助老版本用户修复漏洞。感谢白帽子为我们指出问题，请白帽子私信留下联系方式，我们将为您寄送礼物以示答谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-04-14 00:35 |    \t\t带头大哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:841 漏洞数:250        | |任意邮件伪造| |目录遍历| |任意文件读取|...)\t\t \n  好好好    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}