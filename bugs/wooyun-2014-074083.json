{"id": 51565, "wybug_id": "wooyun-2014-074083", "wybug_title": "YiDacms最新版漏洞大礼包", "wybug_corp": "yidacms.com", "wybug_author": "xfkxfk", "wybug_date": "2014-08-27 17:47", "wybug_open_date": "2014-11-22 17:48", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "设计不当导致攻击界面扩大", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-01：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-22：\t细节向公众公开  简要描述： YiDacms最新版漏洞大礼包 详细说明：  易达CMS 企业建站系统当前最新版本是：YidaCms X3.2（20140718）版这里我们主要看看后台比较严重的漏洞关于xss和sql注入我们就不多讲了，后台的SQL注入很多都没有用全局过滤，导致sql注入首先来看看第一处目录遍历，任意文件读取，拿shell：文件/Yidacms/admin/admin_fso.asp：\nElseIf action = (\"Edit\") then\t'读取文件\t\tDim FileAll\t\tFilePath = Trim(Request.Form(\"ThisDir\"))\t\tFileName = Trim(Request.Form(\"FileId\"))\t\tFilePath1 = Server.MapPath(\"\"&webpath&\"template/\") & FilePath & \"\\\" & FileName\t\tIf Fso.FileExists(FilePath1) then\t\t\tSet FileOpen = Fso.OpenTextFile (FilePath1,1)\t\t\t\tFileAll = FileOpen.ReadAll\t\t\tFileOpen.close\t\tIf IsReplace then FileAll = Replace(FileAll,\"textarea\",\"\\\\textarea\\\\\")\t\t\tElse\t\t\t\tResponse.write \"<script>alert('发生错误，文件已经被删除或者损坏！');location.replace('admin_fso.asp');</script>\"\t\tEnd If\n这里在读取文件时，没有任何过滤处理，直接拼接文件路径，然后直接读取，显示这里我们读取inc/db.asp文件，敏感信息都在这里了：\n\n这里读取到了口令正好这列修改文件是需要口令，那么我么修改文件后，加入我们的后门shell即可拿到shell第二处目录遍历http://10.65.40.6/Yidacms/admin/admin_upload.asp?action=Open&Dir=\\..\\修改Dir即可遍历全站文件\n\n第三处任意文件删除文件：/Yidacms/admin/admin_login.asp\nSub DelAll()\tDim FolderId,FileId,ThisDir,FileNum,FolderNum,FilePath,FolderPath\tFolderId = Split(Request.Form(\"FolderId\"),\",\")\tFileId = Split(Request.Form(\"FileId\"),\",\")\tThisDir = trim(Request.Form(\"ThisDir\"))\tFileNum=0\tFolderNum=0\tIf Ubound(FolderId) <> -1 then\t\t'删除文件夹\t\tFor i = 0 to Ubound(FolderId)\t\t\tFolderPath = Server.MapPath(\"\"&webpath&\"uploadimg/\") & ThisDir & \"\\\" & trim(FolderId(i))\t\t\tIf Fso.FolderExists(FolderPath) then\t\t\t\tFso.DeleteFolder FolderPath,true\t\t\t\tFolderNum = FolderNum + 1\t\t\tEnd If\t\tNext\tEnd If\tIf Ubound(FileId) <> -1 then\t\t'删除文件\t\tFor j = 0 to Ubound(FileId)\t\t\tFilePath = Server.MapPath(\"\"&webpath&\"uploadimg/\") & ThisDir & \"\\\" & trim(FileId(j))                        response.write(FilePath)\t\t\tIf Fso.FileExists(FilePath) then\t\t\t\tFso.DeleteFile FilePath,true\t\t\t\tFileNum = FileNum + 1                                response.write(FilePath)\t\t\tEnd If\t\tNext\tEnd If\tResponse.write \"<script>alert('\\n恭喜,删除成功\\n\\n\"& FolderNum &\" 个文件夹被删除\\n\"& FileNum &\" 个文件被删除');window.location.href=('\"& Replace(Request.ServerVariables(\"HTTP_REFERER\"),\"\\\",\"\\\\\") &\"')</script>\"End Sub\n删除文件时，直接拼接路径，导致任意文件删除：\n\n第三处修改上传类型，上传任意文件拿shell全局——条件设置\n\n这里不允许直接设置asp，我们添加cer类型即可\n\n等等还有其他很多问题。。。。。。   漏洞证明：  见详细说明   修复方案：     版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-11-22 17:48 厂商回复：  最新状态： 2014-09-02：看了您的漏洞以后。我觉得存在一个问题。 你的都是基于在管理员已登录状态的状态下才可以操作的。 如果是在管理员没有登录的状态下，您还能利用这些漏洞吗？ 在线文件编辑，除了管理员登录以后，还要在条件设置中开启权限才可以。  ", "replys": "漏洞评价：\n评论\n     2014-08-27 18:01 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  。。。。。。。好狠    \n     2014-08-29 17:19 |    \t\t易达CMS(乌云厂商)\t\t \n  看了您的漏洞以后。我觉得存在一个问题。你的都是基于在管理员登录状态的状态下才可以操作的。如果是在管理员没有登录的状态下，您还能利用这些漏洞吗？在线文件编辑，除了管理员登录以后，还要在条件设置中开启权限才可以。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}