{"id": 15088, "wybug_id": "wooyun-2012-015550", "wybug_title": "网易开放平台第三方应用oauth强制用户授权漏洞", "wybug_corp": "网易", "wybug_author": "小点兵", "wybug_date": "2012-12-03 15:59", "wybug_open_date": "2013-01-17 16:00", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-12-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-12-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-12-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-12-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-01-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-01-17：\t细节向公众公开  简要描述： 利用此漏洞，在网易开放平台注册的第三方应用可以跳过询问用户是否授权的页面，而直接拿到用户的授权访问用户敏感信息 详细说明：  正常的oauth授权流程应符合如下几个步骤（假设网易用户已经登录）：1，在http://t.163.com/app点击应用2，访问应用网址，比如：http://158.132.255.52:25006/t163_php_sdk/index_normal.php3, 应用访问http://api.t.163.com/oauth/request_token取得request token以及request token secret4, 应用从定向用户到网页，比如 http://api.t.163.com/oauth/authenticate?oauth_token=XXXXXXX&oauth_callback=XXXXXXX, 询问用户是否授权。此页面详细描述是向什么应用授予什么权限，以帮助用户做出选择5, 用户点击授权按钮，浏览器向授权服务器http://api.t.163.com/oauth/authenticate 发送相应的同意授权信息 （POST命令）6，应用用已经拿到授权的request token通过http://api.t.163.com/oauth/access_token 换取access token以及access token secret此漏洞在于恶意的应用可以在第3步后直接忽略第4步，而执行第5步，因此在未得到用户同意（用户不知情）的情况下，拿到用户的授权   漏洞证明：  为了验证漏洞的存在，我们创建了一个实验app:应用名称：oauth_vulnerability_test应用类型：工具类Consumer Key：ulHM02MWX0CFx75u应用创建时间：2012-11-29我们的试验代码需要用户在点击应用前用已经登录网易，但是只要对代码稍微改进，即使用户在点击应用的时候未登录，我们也可以引导用户登录访问 http://158.132.255.52:25006/t163_php_sdk/index_normal.php 可以体验正常的授权过程访问 http://158.132.255.52:25006/t163_php_sdk/index_attack.php 可以直接观察到这个应用可以未经用户许可，拿到用户授权 \n\n\n\n\n\n   修复方案：  建议在第4步用户访问http://api.t.163.com/oauth/authenticate?oauth_token=XXXXXXX&oauth_callback=XXXXXXX, 加入随机码，在用户提交同意授权的表单中，需要同时提交这个随机码，以保证这个提交表单确实是用户同意的   版权声明：转载请注明来源 小点兵@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2012-12-04 14:04 厂商回复： 感谢您对网易的关注，漏洞已经修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-01-17 16:04 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  缺陷关联： WooYun: CSRF导致微博应用自动授权    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}