{"id": 58431, "wybug_id": "wooyun-2014-051266", "wybug_title": "EasyTalk 提升用户为管理员漏洞", "wybug_corp": "nextsns.com", "wybug_author": "xfkxfk", "wybug_date": "2014-02-18 11:19", "wybug_open_date": "2014-05-19 11:20", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "逻辑错误", "安全意识不足", "源码审核", "注射漏洞利用技巧", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-02-21：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-19：\t细节向公众公开  简要描述： EasyTalk 提升用户为管理员漏洞 详细说明：  在用户基本信息修改处，存在设计缺陷，导致EasyTalk提升自己为管理员，而且还能无限增加自己的粉丝等啊！来看看漏洞所在文件：/Home/Lib/Action/SettingAction.class.php\n//保存设置    public function doset() {        $user=M('Users');        $data=array();\t\t\t\t$userdata=$_POST['user'];        $userdata['nickname']= daddslashes(clean_html(trim($userdata[\"nickname\"])));\t\t$userdata['provinceid']=intval($userdata['provinceid']);\t\t$userdata['cityid']=intval($userdata['cityid']);        $userdata['user_info']= daddslashes(trim(htmlspecialchars($userdata['user_info'])));        if(!preg_match('/^[0-9a-zA-Z\\xe0-\\xef\\x80-\\xbf_-]+$/i',$userdata['nickname'])) {\t\t\techo json_encode(array('res'=>'error','tips'=>L('setting2')));            exit;        }        if (!$userdata['nickname'] || !$userdata['provinceid'] || !$userdata['cityid']) {            echo json_encode(array('res'=>'error','tips'=>L('setting1')));            exit;        }\t\tif ($userdata['qq'] && !is_numeric($userdata['qq'])) {            echo json_encode(array('res'=>'error','tips'=>L('qqiserror')));            exit;        }\t\tif ($userdata['msn'] && count(explode('@',$userdata['msn']))==1) {            echo json_encode(array('res'=>'error','tips'=>L('msniserror')));            exit;        }\t\t//昵称检测        if ($userdata['nickname'] && $userdata['nickname']!=$this->my['nickname']) {            if (StrLenW($userdata['nickname'])<=12 && StrLenW($userdata['nickname'])>=3) {                $newnickname=$user->where(\"nickname='$userdata[nickname]'\")->find();                if ($newnickname) {                    echo json_encode(array('res'=>'error','tips'=>L('setting4')));\t\t\t\t\texit;                } else {                    M('Atusers')->where(\"atuname='\".$this->my['user_name'].\"'\")->setField('atnickname',$userdata['nickname']);                }            } else {                echo json_encode(array('res'=>'error','tips'=>L('setting2')));\t\t\t\texit;            }        }        $user->where(\"user_id='\".$this->my['user_id'].\"'\")->data($userdata)->save();\t\t$this->finishprofile();        echo json_encode(array('res'=>'success','tips'=>L('setting3')));    }\n这里只是通过循环接收数字中的数据的，没有进行限制，所以我们可以任意添加字段及内容。   漏洞证明：  来看看新注册的用户的信息：\n\n我们来设置新注册用户222222的基本信息，我们添加了两个字段isadmin和followme_num。构造如下：\n\n返回success，说明修改成功啦。来看看用户222222的信息：\n\n此时新注册用户222222已经是管理员了，粉丝数已经被修改了。\n\n   修复方案：  控制可被修改的字段   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-02-18 12:38 厂商回复： 已经修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}