{"id": 40889, "wybug_id": "wooyun-2015-090532", "wybug_title": "大米CMS v4.9 sql注入", "wybug_corp": "damicms.com", "wybug_author": "roker", "wybug_date": "2015-01-12 12:46", "wybug_open_date": "2015-04-13 16:58", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-03-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-03-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-13：\t细节向公众公开  简要描述： rt 详细说明：  看到 操作数据的save函数 \npublic function save($data='',$options=array()) {        if(empty($data)) {            // 没有传递数据，获取当前数据对象的值            if(!empty($this->data)) {                $data    =   $this->data;            }else{                $this->error = L('_DATA_TYPE_INVALID_');                return false;            }        }        // 分析表达式        $options =  $this->_parseOptions($options);        if(!isset($options['where']) ) {            // 如果存在主键数据 则自动作为更新条件            if(isset($data[$this->getPk()])) {                $pk   =  $this->getPk();                $options['where']  =  $pk.'=\\''.$data[$pk].'\\'';                $pkValue = $data[$pk];                unset($data[$pk]);            }else{                // 如果没有任何更新条件则不执行                $this->error = L('_OPERATION_WRONG_');                return false;            }        }        return $this->db->update($data,$options);    }\n然而，在调用时 ，基本没有对 键值进行判断是否合法。例如 修改资料处\nfunction main(){self::is_login();if($_POST){$data = array_map('strval',$_POST);$data = array_map('remove_xss',$data);$data['id'] = $_SESSION['dami_uid'];M('member')->save($data);$this->success('资料保存成功~');}else{$info = M('member')->where('id='.$_SESSION['dami_uid'])->find();$this->assign('info',$info);$this->display();}}\n我们抓包添加一个 money字段\n\n可以看到金额变成1000000 了~\n\n   漏洞证明：  \n\n   修复方案：  判断字段 是否合法。   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-01-12 14:12 厂商回复： 修改考虑不全 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}