{"id": 13771, "wybug_id": "wooyun-2013-018599", "wybug_title": "搜狐微博首页储存型XSS，可以插任意东西，可以大范围蠕虫、刷粉丝、钓鱼 ~~(☆_☆)/~~", "wybug_corp": "搜狐", "wybug_author": "px1624", "wybug_date": "2013-02-11 21:29", "wybug_open_date": "2013-03-28 21:30", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-02-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-02-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-02-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-03-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-03-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-03-28：\t细节向公众公开  简要描述： 这里先祝大家新年好，恭喜发财~春晚后上网看到刘谦、力宏和云迪三人的故事，然后顺藤摸瓜就来到了搜狐微博，然后觉得那个位置比较可疑，就去试了试，果然感觉比较准，确实存在严重的漏洞，随便插啥玩意都行。。。 详细说明：  漏洞原因：post数据中的pics没有过滤 \\漏洞影响：随便插啥代码都行，可以大范围蠕虫、刷粉丝、钓鱼等1 位置在搜狐微博发图片的那个pics参数中。下面是一条普通的带图微博的post数据\nmsg\t分享图片pics\t[{\"url\":\"http://s3.t.itc.cn/mblog/pic/20132_11_3/s_pzenz7686783935702.jpg\",\"extraData\":{\"smallest\":{\"w\":90, \"h\":120, \"size\":5010},\"small\":{\"w\":160, \"h\":213, \"size\":11146},\"middle\":{\"w\":312, \"h\":416, \"size\":24486},\"big\":{\"w\":312, \"h\":416, \"size\":24486}}}]\n可以看到其中的pics是以json的形式发送的。2 于是这里果断去测试了一下 \\ ,因为在js中可以用 \\+ASCII码 的形式表示任意字符的，果然没有过滤。然后就顺手在url参数的jpg后面加了 \"onload=\"alert(1) 的js编码（我就这么叫吧）形式，post数据就变成了下面的代码\nmsg\t分享图片pics [{\"url\":\"http://s3.t.itc.cn/mblog/pic/20132_11_3/s_pzenz7686783935702.jpg\\u0022\\u006f\\u006e\\u006c\\u006f\\u0061\\u0064\\u003d\\u0022\\u0061\\u006c\\u0065\\u0072\\u0074\\u0028\\u0031\\u0029\",\"extraData\":{\"smallest\":{\"w\":90, \"h\":120, \"size\":5010},\"small\":{\"w\":160, \"h\":213, \"size\":11146},\"middle\":{\"w\":312, \"h\":416, \"size\":24486},\"big\":{\"w\":312, \"h\":416, \"size\":24486}}}]\nps：这里可以利用gainover的工具进行js编码转换 http://app.baidu.com/app/enter?appid=280383发现成功插入了代码，弹出了1图1\n\n3 接着又分别测测试了插入<img>、<iframe>、<script>等标签对，表示都毫无任何压力的成功插入了。（有没有成功插入可以通过谷歌浏览器F12用颜色区分，或者复制到外部txt中查看）图2 3 4插<img>\n\n插<iframe>\n\n插<script>\n\n4 如上，可以调用任意外部js文件，由于post数据中没有key、token等东西，所以蠕虫表示毫无压力。具体蠕虫和刷粉丝的利用可以查看 @imlonghao 的这个帖子 WooYun: 搜狐微博某处存储型小松鼠+顺便提一提相关接口未加上TOKEN 5 cookie就算了，能盗取到，不过搜狐微博是http-only的，盗取到了也么啥用，也登不上（不过可以通过伪造钓鱼页面 骗取账号和密码）。还不如搞蠕虫，刷粉丝实在。6 最后，也不奢求能有礼物，只求把rank给够。不要直接啥都不回复甩个 5rank 给我，因为这个的确危害影响蛮大的！~   漏洞证明：  漏洞证明上面描述的已经很清楚了，这里就发个弹cookie的图吧。。图5\n\n   修复方案：  过滤 \\ps：字符\\全部都被乌云编辑器转换成了\\\\，剑心帮忙给改下。（改好后这句话删了额）   版权声明：转载请注明来源 px1624@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2013-02-11 23:56 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-02-11 21:51 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  收听风萧萧吸了么？    \n     2013-02-11 22:28 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  看春晚手都能抖一下，厉害！！！！@px1624    \n     2013-02-11 22:32 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @风萧萧 。。。么有，搜狐微博不玩，只是因为那个消息是来源于搜狐微博的，所以才有了这个，并不是专门去挖的。    \n     2013-02-11 22:33 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @Coody 。。你目前的rank有点霸气。。不怎么和谐诶、、、o(╯□╰)o    \n     2013-02-11 23:22 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:177 漏洞数:31        | Hacked by @ringzero 我錯了)\t\t \n  我也是经常小手一抖就有洞了    \n     2013-02-12 00:41 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @搜狐 诶之前看到有个类似的给了20rank、、、郁闷~~   WooYun: 搜狐微博存储型XSS漏洞二    \n     2013-02-12 07:08 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @px1624 你没让人家过好年呀！    \n     2013-02-12 10:16 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  @px1624 哈哈，我的rank值霸气有点侧漏了哈，，，    \n     2013-03-15 13:33 |    \t\t烨少 \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        )\t\t \n  你们都很霸气侧漏    \n     2013-03-29 13:34 |    \t\t屌丝王爷 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:4        | 心境随和些，处事淡然些。)\t\t \n  淡定的过来看看    \n     2013-10-10 17:21 |    \t\t咖啡 \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:20        )\t\t \n  好像还没修复啊    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}