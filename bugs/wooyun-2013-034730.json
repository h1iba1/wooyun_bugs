{"id": 9230, "wybug_id": "wooyun-2013-034730", "wybug_title": "天涯某处设计缺陷可劫持用户账号", "wybug_corp": "天涯社区", "wybug_author": "xfkxfk", "wybug_date": "2013-08-19 15:53", "wybug_open_date": "2013-10-03 15:54", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "敏感接口缺乏校验", "设计不当", "认证设计不合理"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-09-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-09-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-10-03：\t细节向公众公开  简要描述： 天涯某处设计缺陷可劫持任意用户 详细说明：  问题在于天涯的手机版：\nhttp://m.tianya.com\n手机版的登录认证是靠url中三个参数来进行验证的：\nhttp://m.tianya.cn/index.jsp?idwriter=81847003&key=*********&chk=********************************\nidwrite是用户的uid，key和chk是主要的认证字符串。只要有这个url就能登录对应idwrite的用户了。那么我们从哪能拿到这个url呢？这就是问题所在，下面看看我们如何获得到用户的则个url。首先，我们发一个微博，里面带上一条url，让其他用户去访问这个url，只要有用户访问我们这个url，那么他就会被我们所劫持，也就是我们就拿到了这个url。发送的这个微博中的url内容如下：\n<?php$file = fopen(\"header.txt\",\"w\");foreach (getallheaders() as $name => $value) {\tfwrite($file,\"$name: $value\\n\");\techo \"$name: $value\\n\";}fclose($file);?>\n就是获取访问这个url的请求头，然后写入文件。\n\n然后我们点击访问这个url看看什么效果：\n\nurl就被我们抓到了：\n\n通过上面的过程看到了，我们主要是通过请求头里面的Referer获取到url的。然后我们就可以那Referer的url登录这个用户了。\n\n为了劫持其他用户，我们可以把这个url发到我们自己的空间，然后发布诱惑力很强的微博，诱使用户访问，或者通过私信发送到其他用户诱使用户访问这个url。这样就可以劫持任意用户了。   漏洞证明：  见详细说明   修复方案：  非本域，就不要发送Referer啊   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2013-08-19 17:17 厂商回复： 正在联系相关业务人员修复，感谢提供。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}