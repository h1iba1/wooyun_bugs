{"id": 42881, "wybug_id": "wooyun-2014-084439", "wybug_title": "BiWEB最新门户版多处越权打包", "wybug_corp": "BiWEB", "wybug_author": "路人甲", "wybug_date": "2014-11-25 16:17", "wybug_open_date": "2015-02-23 16:18", "wybug_type": "非授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["越权操作", "认证缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-25：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-02-23：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： BiWEB最新门户版多处越权打包 详细说明：  在wooyun上看到了有人把biweb的shell拿到了： WooYun: BIWEB门户版Getwebshell漏洞 ，也有人提了其他漏洞，我也来找找它的漏洞吧。去官网下BiWEB门户版最新的5.8.3来看看。这里提一个越权删除任意用户发布的供求信息、资讯信息、产品信息、企业信息、会展信息、招聘信息、问题信息、视频信息……这些地方都存在这个漏洞\n/ask/adminu/index.php/company/adminu/index.php/exhibition/adminu/index.php/job/adminu/index.php/links/adminu/index.php/news/adminu/index.php/product/adminu/index.php/trade/adminu/index.php/video/adminu/index.php\n以/trade/adminu/index.php进行证明，看看/trade/adminu/index.php吧\n无关代码 $arrWhere = array();$arrLink = array();if(isset($_GET['action'])){\tif($_GET['action']=='search') {\t\t// 构造搜索条件和翻页参数\t\t$arrLink[] = 'action=search';\t\tif (!empty($_GET['title'])) {\t\t\t$strKeywords = strval(urldecode($_GET['title']));\t\t\tif($strKeywords[0] == '/'){\t\t\t\t//精确查询ID\t\t\t\t$strKeywords = substr($strKeywords,1);\t\t\t\tif(is_numeric($strKeywords)) $arrWhere[] = \"id = '\" . $strKeywords . \"'\";\t\t\t}else{\t\t\t\t$arrWhere[] = \"tag LIKE '%\" . $_GET['title'] . \"%'\";\t\t\t}\t\t\t$arrLink[] = 'title=' . $_GET['title'];\t\t}\t\tif ($_GET['pass'] == '1' || $_GET['pass'] == '0') {\t\t\t$arrWhere[] = \"pass='\".$_GET['pass'].\"'\";\t\t\t$arrLink[] = 'pass=' . $_GET['pass'];\t\t}\t\tif (!empty($_GET['type_id'])) {\t\t\t$intTypeID = intval($_GET['type_id']);\t\t\t$arrWhere[] = \"type_id='\".$intTypeID.\"' or type_roue_id like '%:$intTypeID:%'\";\t\t\t$arrLink[] = 'type_id='.$intTypeID;\t\t}\t} else {\t\t$objWebInit->doInfoAction($_GET['action'],$_POST['select']);\t}}无关代码\n当$_GET['action']=’del’时，则执行这条语句$objWebInit->doInfoAction($_GET['action'],$_POST['select'])，我们再去看看doInfoAction()， 在/web_common5.8/php_common.php中\n无关代码function doInfoAction($strAction=null,$arrData=null,$arrFile=array('photo')){\t\tswitch ($strAction){\t\t\tcase 'del':\t\t\t\tforeach ($arrData as $key=>$val){\t\t\t\t\t$this->deleteInfo($val,$arrFile);\t\t\t\t}\t\t\t\tbreak;\t\t\tcase 'delpic':\t\t\t\tforeach ($arrData as $key=>$val){\t\t\t\t\t$this->deleteInfoPic($val,$arrFile);\t\t\t\t}\t\t\t\tbreak;\t\t\tcase 'moveup':\t\t\t\tforeach ($arrData as $key=>$val){\t\t\t\t\t$this->moveupInfo($val);\t\t\t\t}\t\t\t\tbreak;\t\t\tcase 'check':\t\t\t\tforeach ($arrData as $key=>$val){\t\t\t\t\t$this->passInfo($val,1);\t\t\t\t}\t\t\t\tbreak;\t\t\tcase 'uncheck':\t\t\t\tforeach ($arrData as $key=>$val){\t\t\t\t\t$this->passInfo($val,0);\t\t\t\t}\t\t\t\tbreak;\t\t\tcase 'settop':\t\t\t\tforeach ($arrData as $key=>$val){\t\t\t\t\t$this->topInfo($val,1);\t\t\t\t}\t\t\t\tbreak;\t\t\tcase 'unsettop':\t\t\t\tforeach ($arrData as $key=>$val){\t\t\t\t\t$this->topInfo($val,0);\t\t\t\t}\t\t\t\tbreak;\t\t\tcase 'setrecommend':\t\t\t\tforeach ($arrData as $key=>$val){\t\t\t\t\t$this->recommendInfo($val,1);\t\t\t\t}\t\t\t\tbreak;\t\t\tcase 'unsetrecommend':\t\t\t\tforeach ($arrData as $key=>$val){\t\t\t\t\t$this->recommendInfo($val,0);\t\t\t\t}\t\t\t\tbreak;\t\t}\t\treturn true;\t}无关代码\n再去看看相同文件中的deleteInfo()\nfunction deleteInfo($intInfoID,$arrFile=array('photo')){\t\tif($arr = $this->getInfo($intInfoID)){\t\t\tif(!empty($this->arrGPic['FileSavePath'])){\t\t\t\tforeach($arrFile as $val){\t\t\t\t\tif(!empty($arr[$val]) && is_array($arr[$val])){\t\t\t\t\t\tforeach($arr[$val] as $v){\t\t\t\t\t\t\tif(is_string($v)) {\t\t\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].$v);\t\t\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].'s/'.$v);\t\t\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].'b/'.$v);\t\t\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].'f/'.$v);\t\t\t\t\t\t\t}\t\t\t\t\t\t\tif(is_array($v)){\t\t\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].$v[$val]);\t\t\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].'s/'.$v[$val]);\t\t\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].'b/'.$v[$val]);\t\t\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].'f/'.$v[$val]);\t\t\t\t\t\t\t}\t\t\t\t\t\t}\t\t\t\t\t}elseif(!empty($arr[$val]) && is_string($arr[$val])){\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].$arr[$val]);\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].'s/'.$arr[$val]);\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].'b/'.$arr[$val]);\t\t\t\t\t\t@unlink($this->arrGPic['FileSavePath'].'f/'.$arr[$val]);\t\t\t\t\t}\t\t\t\t}\t\t\t}\t\t}else{\t\t\tcheck::AlertExit('ID号为 '.$intInfoID.' 的记录并不存在！',-1);\t\t}\t\t$strWhere = \" WHERE `id` = $intInfoID\";\t\treturn $this->deleteDataG($this->tablename2,$strWhere);\t}\n可以看到，在删除的整个过程中没有对用户的属性进行判断，直接构造了$strWhere = \" WHERE `id` = $intInfoID\"并执行，这就造成了越权删除。而且无论哪个用户发表的各类信息，其id全都是统一从1开始编号，如果要全部删除，只要遍历就可以了，如果要删除哪条，直接删除其id对应的内容即可。测试时，注册一个用户，访问 www.xxxx.com/trade/adminu/index.php?action=del，然后修改POST提交的内容为select[]=3,即可供求信息中id为3的供求信息删除。   漏洞证明：  见 详细说明   修复方案：  判断用户属性   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}