{"id": 702, "wybug_id": "wooyun-2014-068707", "wybug_title": "Discuz! 7.2的SQL注射漏洞与代码执行漏洞", "wybug_corp": "Discuz!", "wybug_author": "Map", "wybug_date": "2014-07-16 11:47", "wybug_open_date": "2014-10-14 11:48", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-14：\t细节向公众公开  简要描述： 再响应一下通用漏洞奖励 详细说明：  上次发的漏洞拿到奖励之后，看了几天没有收获，就看了一些其他的东西的代码，昨天拿起来再看居然发现了一个有意思的漏洞。在discuz的7.2里有一段代码include/search_sort.inc.php文件里的代码：\n@include_once DISCUZ_ROOT.'./forumdata/cache/threadsort_'.$selectsortid.'.php';\n而且这个$selectsortid变量没有做过任何处理，而且最后还进入到了SQL的查询语句里：\n$query = $db->query(\"SELECT tid FROM {$tablepre}optionvalue$selectsortid \".($sqlsrch ? 'WHERE '.$sqlsrch : '').\"\");\n\n\n\n\n应当是在开启了主题分类的网站可以进行SQL注射，而文件包含中的截断方法应该可以在部分主机上进行任意代码执行。   漏洞证明：  开启主题分类办法：1，版块 » 编辑版块 » 主题分类 （开启）2，左侧添加 分类信息类别3，类别详情进行随意修改，保存4，create出optionvale{$sortid}表，一般从3开始，几次就可以猜中。   修复方案：  把输入转换成数字类型   版权声明：转载请注明来源 Map@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-07-21 09:49 厂商回复： 感谢您提出的问题，我们会尽快给于处理 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-16 11:47 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  大神又来了！    \n     2014-07-16 12:23 |    \t\tNoxxx \t\t\t( 普通白帽子  |\t\t\t        Rank:509 漏洞数:41        )\t\t \n  前排    \n     2014-07-16 12:27 |    \t\t泳少 \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:79        | ★           梦想这条路踏上了，跪着也要...)\t\t \n  3？    \n     2014-07-16 12:30 |    \t\tEv1l \t\t\t( 实习白帽子  |\t\t\t        Rank:68 漏洞数:20        | 问题真实存在但影响不大。联系邮箱security...)\t\t \n  前排占座火钳刘明    出售啤酒饮料矿泉水    \n     2014-07-16 12:40 |    \t\t浮萍 \t\t\t( 普通白帽子  |\t\t\t        Rank:555 漏洞数:118        | 默默潜水)\t\t \n  啤酒饮料矿泉水，香烟瓜子八宝粥    \n     2014-07-16 12:41 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  我信洞主    \n     2014-07-16 12:42 |    \t\tLonely \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:27        | 人生如梦,始终都游不过当局者迷的悲哀。)\t\t \n  得永生    \n     2014-07-16 13:03 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  膜拜    \n     2014-07-16 13:05 |    \t\tHero \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:31        | 药药切克闹,充气娃娃迷幻药)\t\t \n  杀一下    \n     2014-07-16 13:06 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-07-16 13:41 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  前排围观    \n     2014-07-16 13:47 |    \t\tlck丶 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 求大牛拿0day砸死)\t\t \n  你关注的白帽子 Map 发表了漏洞 Discuz 7 SQL注射漏洞 或 代码执行漏洞balabala~~    \n     2014-07-16 13:50 |    \t\tzhxs \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:19        | Jyhack-TeaM：http://bbs.jyhack.com/)\t\t \n  悄悄的告诉我吧、、    \n     2014-07-16 14:28 |    \t\tx7iao \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:41        | 文能床上控萝莉，武能床上定人妻)\t\t \n  我操！    \n     2014-07-16 15:44 |    \t\tp4ssw0rd \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:92        | 不作死就不会死)\t\t \n  mark    \n     2014-07-16 15:48 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  上一波还没平息，又来一波    \n     2014-07-16 16:29 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  薅羊毛    \n     2014-07-16 16:43 |    \t\t0x7575 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:16        )\t\t \n  我艹 又来？    \n     2014-07-16 17:00 |    \t\tadm1n \t\t\t( 普通白帽子  |\t\t\t        Rank:216 漏洞数:66        | 只是一个渣渣而已。。。)\t\t \n  膜拜    \n     2014-07-16 17:21 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  你关注的绿帽子 Map 发表了漏洞 Discuz 7 SQL注射漏洞 或 代码执行漏洞    \n     2014-07-16 17:59 |    \t\tsutdy \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:33        | 0.0)\t\t \n  洞主开门   查水表！    \n     2014-07-16 18:23 |    \t\t老笨蛋 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:8        | 老笨蛋一个)\t\t \n  @pandas 绿帽子……    \n     2014-07-16 19:01 |    \t\tDeep \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 一个小白.想要变小黑.)\t\t \n  哇喔    \n     2014-07-16 19:50 |    \t\tManning \t\t\t( 普通白帽子  |\t\t\t        Rank:559 漏洞数:78        | 就恨自己服务器太少)\t\t \n  真牛逼    \n     2014-07-16 20:29 |    \t\tMap \t\t\t( 普通白帽子  |\t\t\t        Rank:154 漏洞数:10        | 闭关几个星期，学点东西。)\t\t \n  @pandas 。。。。。。    \n     2014-07-16 21:37 |    \t\tmaples \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:11        | 学习的小菜鸟)\t\t \n  又一个    \n     2014-07-16 22:17 |    \t\t金枪银矛小霸王 \t\t\t( 普通白帽子  |\t\t\t        Rank:103 漏洞数:25        | 不会挖洞洞的猿猿不是好学生)\t\t \n  ......................................................................................................................................................................................................................................................    \n     2014-07-16 22:20 |    \t\the1renyagao \t\t\t( 普通白帽子  |\t\t\t        Rank:225 漏洞数:29        | 是金子总会发光，在还未发光之前，先打磨打...)\t\t \n  ///////////////////////////////////////////////////////    \n     2014-07-16 22:31 |    \t\ttenzy \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:21        | Need not to know)\t\t \n  汝之屌，父知之？    \n     2014-07-17 17:15 |    \t\t爱Gail \t\t\t( 普通白帽子  |\t\t\t        Rank:237 漏洞数:38        | 爱漏洞、爱编程、爱旅游、爱Gail)\t\t \n  不错    \n     2014-07-17 17:38 |    \t\t炊烟 \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:44        | 每一天都需要努力。)\t\t \n  叼的不行.........    \n     2014-07-17 17:58 |    \t\tJim叔叔 \t\t\t( 普通白帽子  |\t\t\t        Rank:153 漏洞数:25        | 这样子不太好吧。。)\t\t \n  mark    \n     2014-07-19 22:11 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  前排坐等爆料    \n     2014-07-21 10:30 |    \t\tD_in \t\t\t( 普通白帽子  |\t\t\t        Rank:413 漏洞数:62        | 到我嘴里来)\t\t \n  我的大雕已饥渴难耐    \n     2014-07-21 10:32 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  @D_in 大屌    \n     2014-07-27 12:27 |    \t\t蓝莓说 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:18        | 爱网络安全 代码审计 php网站开发)\t\t \n  discuz7.2 SQL注入和代码执行  补丁出了吗     \n     2014-07-27 12:30 |    \t\t蓝莓说 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:18        | 爱网络安全 代码审计 php网站开发)\t\t \n  求补丁文件啊    \n     2014-08-06 14:43 |    \t\tAofa \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | check it out yo)\t\t \n  @蓝莓说 求方法    \n     2014-08-21 10:04 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @蓝莓说 getshell在哪里    \n     2014-08-31 19:29 |    \t\tnetwind \t\t\t( 普通白帽子  |\t\t\t        Rank:249 漏洞数:40        | 挖掘漏洞为乐趣)\t\t \n  还是有点鸡肋 默认都是没开分类信息    \n     2014-09-05 09:14 |    \t\tkimdle \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | @kimdle)\t\t \n  敢不敢来个爆路径    \n     2014-09-05 10:17 |    \t\tnetwind \t\t\t( 普通白帽子  |\t\t\t        Rank:249 漏洞数:40        | 挖掘漏洞为乐趣)\t\t \n  暴露径的实际已经有了    \n     2014-09-05 10:32 |    \t\tMap \t\t\t( 普通白帽子  |\t\t\t        Rank:154 漏洞数:10        | 闭关几个星期，学点东西。)\t\t \n  @netwind Wish I could say more. :)     \n     2014-09-05 11:04 |    \t\tnetwind \t\t\t( 普通白帽子  |\t\t\t        Rank:249 漏洞数:40        | 挖掘漏洞为乐趣)\t\t \n  @Map say more ：）!  那个投票的注入点可以用用    \n     2015-02-27 11:12 |    \t\tSky、King \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 偶尔当别人的配角、并不会让你的人生少一角)\t\t \n  赞一个    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}