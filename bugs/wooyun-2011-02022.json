{"id": 22949, "wybug_id": "wooyun-2011-02022", "wybug_title": "中国信息安全认证中心源代码泄露漏洞", "wybug_corp": "中国信息安全认证中心", "wybug_author": "akast", "wybug_date": "2011-05-02 13:05", "wybug_open_date": "2011-05-02 14:39", "wybug_type": "系统/服务补丁不及时", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码泄漏"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-05-02：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2011-05-02：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 中国信息安全认证中心源代码泄露漏洞 详细说明：  http://www.isccc.gov.cn/turbosearch/search.jsp%20http://www.isccc.gov.cn/turbosearch/search.jsp%2ehttp://www.isccc.gov.cn/turbosearch/search.jsp.bak   漏洞证明：  \n<%@ page language=\"java\" contentType=\"text/html; charset=utf-8\" %><%@ page import=\"org.apache.lucene.analysis.*,org.apache.lucene.analysis.cn.*,org.apache.lucene.document.*,org.apache.lucene.index.*,org.apache.lucene.search.*,org.apache.lucene.search.highlight.*,org.apache.lucene.queryParser.*,com.turbosearch.plugin.htmlparser.Entities,TurboCMS.tools.*,org.apache.lucene.document.DateTools.*,com.turbosearch.action.SystemSetAction\" %><%@ page import=\"java.text.*,java.util.*,java.io.*\"%><%@ page import=\"com.turbosearch.tools.FileLoader\"%><%@ page import=\"com.turbosearch.action.IndexTaskAction;\"%><%!public String getContent(String url) throws Exception{\tString retv=\"\";\ttry{\t\tFileLoader fl = FileLoader.getInstance();\t\turl = Config.SiteDirectory + url;\t\tretv = fl.getContent(url);\t}catch(Exception e){\t\tretv = e.getMessage();\t}\treturn(retv);}public static String GetDateString(String FieldValue) throws Exception{\tString sDate=\"\";\tif(FieldValue==null||FieldValue.equals(\"null\")) return(\"\");\ttry{\t\tsDate = sDate + FieldValue.substring(0,4) + \"-\";        sDate = sDate + FieldValue.substring(4,6) + \"-\";\t\tsDate = sDate + FieldValue.substring(6,8) + \" \";\t\tsDate = sDate + FieldValue.substring(8,10) + \":\";\t\tsDate = sDate + FieldValue.substring(10,12) + \":\";\t\t//sDate = sDate + FieldValue.substring(12,14) + \":\";\t}catch(Exception e){\t\tsDate = FieldValue;\t}\treturn(sDate);}public static String gDate(String dstr) throws Exception{\tString sdate = \"\";\ttry{\t\tSimpleDateFormat f = new SimpleDateFormat(\"yyyy-MM-dd hh:mm\");\t\tjava.util.Date d = f.parse(dstr);\t\td = Config.DateAdd(d,28800);\t\tsdate = Config.GetDateString(d).substring(0,16);\t}catch(Exception e){\t\tsdate = dstr;\t}\treturn(sdate);}%><%request.setCharacterEncoding(\"UTF-8\");%><%    class CachedIndex {\t\t// an entry in the cache    IndexReader reader;\t\t// an open reader    long modified;\t\t \t// reader's modified date        public CachedIndex(String name) throws Exception {      modified = IndexReader.lastModified(name);  \t// get modified date      reader = IndexReader.open(name);\t\t  \t\t// open reader    }  }long t0,t1;t0 = System.currentTimeMillis();\tAnalyzer analyzer = new ChineseAnalyzer();    \tHighlighter highlighter =null;\tString strSummary;\tString catalog = \"\";\t\tif(request.getParameter(\"catalog\")==null){%><script>alert(\"参数错误！\");window.close();</script><%\t\t}else{\t\tcatalog = request.getParameter(\"catalog\");\t}\t//catalog=\"hs3w\";\tif(catalog.trim().equals(\"\")||catalog.trim().length()==0){%><script>alert(\"参数错误！\");window.close();</script><%\t}else{\tString catalogs[];\tif(catalog.indexOf(\",\")>-1) \t\tcatalogs = catalog.split(\",\"); \telse{\t\tcatalogs = new String[] {\"\"};\t\tcatalogs[0] = catalog;\t}\tIndexSearcher searchers[];\tsearchers = new IndexSearcher[catalogs.length];\tSystemSetAction catalogcfg = new SystemSetAction();\tfor(int i=0;i<catalogs.length;i++){\t\t\t\tString indexPath = catalogcfg.getIndexBaseDir()+\"/\"+catalogs[i];\t\tCachedIndex index = new CachedIndex(indexPath);\t\tIndexReader reader = index.reader;\t\tsearchers[i] = new IndexSearcher(reader);\t}\tMultiSearcher searcher = new MultiSearcher(searchers);\tString qtype = request.getParameter(\"qtype\");\tif(qtype==null|| qtype.trim().length()==0) qtype=\"contents\";\tString queryString = request.getParameter(\"query\");\tif (queryString == null || queryString.trim().length()==0 ){   \t\tout.print(\"<br><br><p align='center'>没有输入搜索条件!</p>\");   \t\treturn;\t}else if(queryString.equals(\"-\")||queryString.equals(\"+\")){\t\tout.print(\"<br><br><p align='center'>搜索条件有错误!</p>\");\t\treturn;\t}\tint start = 0;\t\t  // first hit to display\tString startString = request.getParameter(\"start\");\tif (startString != null) start = Integer.parseInt(startString);\tint hitsPerPage = 20;\t\t  // number of hits to display\tString hitsString = request.getParameter(\"hitsPerPage\");\tif (hitsString != null) hitsPerPage = Integer.parseInt(hitsString);\tboolean showSummaries = true;\t  // show summaries\tif (request.getParameter(\"showSummaries\")!=null&&\"false\".equals(request.getParameter(\"showSummaries\")))\t\tshowSummaries = false;\tQuery query = null;\ttry {//多field检索\t\tString field[] = new String[]{\"\",\"\",\"\"};\t\tif(qtype.equals(\"contents\")) field[0] = \"contents\";\t\tif(qtype.equals(\"title\")) field[0] = \"title\";\t\tif(qtype.equals(\"all\")){\tfield[0] = \"contents\";\tfield[1] = \"title\";\t\t}\t\t//field[2]=\"channel\";\t\tquery = (new MultiFieldQueryParser(field,analyzer)).parse(queryString);\t} catch (Exception e) {\t  // error parsing query     out.println(\"<br><br>处理搜索条件时出错<br>搜索条件：\");     out.println(queryString);     out.println(\"<br>------------------------------------------\");     out.println(e.getMessage());     return;   }\t//时间段检索\tDateFormat df = DateFormat.getDateInstance();\tString qdate =\"\" ;\tString date1 =\"\" ;\tString date2 = \"\";\tif(request.getParameter(\"qdate\")==null||request.getParameter(\"qdate\").equals(\"\")) \t\tqdate = \"modified\"; \telse \t\tqdate = request.getParameter(\"qdate\");\tif(request.getParameter(\"date1\")==null||request.getParameter(\"date1\").equals(\"\")) \t\tdate1 = \"2000-01-09\"; \telse \t\tdate1 = request.getParameter(\"date1\");\tif(request.getParameter(\"date2\")==null||request.getParameter(\"date2\").equals(\"\")) \t\tdate2 = Config.GetDateString(Config.Now()).substring(0,10);\telse \t\tdate2 = request.getParameter(\"date2\");\tDate startdate = df.parse(date1);\tDate enddate = df.parse(date2);\tTerm s1 = new Term(qdate,DateTools.dateToString(Config.DateAdd(\"d\",-1,startdate),Resolution.SECOND));\tTerm s2 = new Term(qdate,DateTools.dateToString(Config.DateAdd(\"d\",1,enddate),Resolution.SECOND));\tTerm s3 = new Term(\"channel\",\"新闻中心\");\tRangeQuery rangeQuery = new RangeQuery(s1, s2, true);\tBooleanQuery bquery = new BooleanQuery();\tTermQuery tquery = new TermQuery(s3);\tbquery.add(query,BooleanClause.Occur.MUST);\tbquery.add(rangeQuery,BooleanClause.Occur.MUST);\t//bquery.add(tquery,BooleanClause.Occur.MUST);  \tHits hits;\t//按某一顺序排序\tString qsort;\tqsort = request.getParameter(\"qsort\");\tif(qsort==null||qsort.equals(\"\")) qsort=\"RELEVANCE\";\tSort sort=null;\tif(qsort.equals(\"RELEVANCE\"))\t\tsort = Sort.RELEVANCE;\t\t//使用Lucene默认的排序\t\t//sort = Sort.INDEXORDER;\t//根据IndexOrder排序\t\t//sort = new Sort(\"modified\",true);\t//根据文件的更新时间排序\tif(qsort.equals(\"modified\"))\t\tsort = new Sort(new SortField[]{new SortField(\"modified\", SortField.STRING, true)});\tif(qsort.equals(\"pubdate\"))\t\tsort = new Sort(new SortField[]{new SortField(\"pubdate\", SortField.STRING, true)});   \thits = searcher.search(bquery,sort);\ttry{\t\tSimpleHTMLFormatter simpleHTMLFormatter = new SimpleHTMLFormatter(\"<font color=#e10900>\",\"</font>\");   \t\t//SimpleHTMLFormatter simpleHTMLFormatter = new SimpleHTMLFormatter();   \t\thighlighter = new Highlighter(simpleHTMLFormatter,new QueryScorer(query));      \t\t\thighlighter.setTextFragmenter(new SimpleFragmenter(2000));\t\t//highlighter.setTextFragmenter(new NullFragmenter());\t}catch(Exception eee){\t\tSystem.out.println(eee.getMessage());\t}\tint tpg = (int)Math.ceil((hits.length() + hitsPerPage-1) / hitsPerPage);    String pgg=request.getParameter(\"pg\");\tint pg=1;\tif(pgg==null||pgg.equals(\"\")){ \t\tpg=start/10+1;\t}else{\t\tpg=Integer.parseInt(pgg);\t\tif(pg>tpg) pg=tpg;\t\tif(pg<1) pg = 1;\t\tstart = (pg-1)*hitsPerPage;\t}    int end = Math.min(hits.length(), start + hitsPerPage);   t1=System.currentTimeMillis();%><html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>中国信息安全认证中心-全文检索</title><style type=\"text/css\">body{ font-size:14px;}td{\tfont-family: \"宋体\";\tfont-size: 12px;\tline-height: 20px;\tcolor: #000000;\ttext-decoration: none;}</style><script language=\"javascript\">function CheckAll(form) {\tfor (var i=0;i<form.elements.length;i++) {\t\tvar e = form.elements[i];\t\tif (e.name.substring(0,5) !=\"chkall\" && e.type==\"checkbox\" && e.name!=\"showSummaries\"){\t\t\te.checked = document.getElementsByName(\"chkall\")[0].checked;\t\t}\t}}function check(){\tif(fm.query.value==\"\"){\t\talert(\"请输入要检索的内容！\");\t\tfm.query.focus();\t\treturn(false);\t}\t\tfunction selectdate(el){\tvar args=\"font-size:10px;dialogWidth:286px;dialogHeight:290px;center:yes;status:no;help:no\";\tvar argu=new Array();\t<%\tCalendar cal = Calendar.getInstance(); \t\tSimpleDateFormat sdf=new SimpleDateFormat(\"M-d-yyyy\");\t%>\targu[0]=\"<%=sdf.format(cal.getTime())%>\";\tvar selectdate=window.showModalDialog(\"selectdate.htm\",argu,args);\tif (selectdate!=null)\t  el.value=selectdate;\t}</script></head><body><%//=getContent(\"/includes/head.html\")%><table width=\"1002\" border=\"0\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\">  <tr>    <td align=\"center\" valign=\"top\"><iframe src=\"http://www.isccc.gov.cn/include/top_new.html\" frameborder=\"0\" height=\"283\" width=\"1002\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></td>  </tr></table><table width=\"1002\" border=\"0\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\">  <tr>  <td width=\"776\" valign=\"top\"><table width=\"776\" border=\"0\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\">    <tr>    <td height=\"1\"></td>  </tr>  <tr>    <td height=\"25\"><table width=\"100%\"  border=\"0\" cellpadding=\"10\" cellspacing=\"1\" bgcolor=\"#CCCCCC\">      <tr>\t    <td width=\"75\" align=\"center\" valign=\"middle\" bgcolor=\"#FFFFFF\"><b>站<BR>内<BR>检<BR>索<hr size=\"1\">\t    ISCCC网站</b></td>        <td bgcolor=\"#FFFFFF\"><table border=\"0\" width=\"100%\">\t<form name=\"fm\" method=\"post\" action=\"search.jsp\" onSubmit=\"return check()\">\t\t<input type=\"hidden\" name=\"catalog\" value=\"isccc\">         <input type=\"hidden\" name=\"qtype\" value=\"all\"> \t<tr><td></td><td></td></tr><tr><td>检索范围：</td><td><select name=\"qtype\">\t<option value=\"contents\" selected>在内容中检索\t<option value=\"title\">在标题中检索\t<option value=\"all\">在标题和内容中检索</select>&nbsp;&nbsp;<select name=\"qdate\">\t<option value=\"pubdate\">文章发布时间\t<option value=\"modified\" selected>文章更新时间</select>从<input type=\"text\" value=\"<%=date1%>\" name=\"date1\" size=\"12\"><img src=\"images/calendar.gif\" onClick=\"selectdate(date1);\" style=\"cursor:hand\" title=\"点击选择时间\">到<input type=\"text\" value=\"<%=date2%>\" name=\"date2\"  size=\"12\"><img src=\"images/calendar.gif\" onClick=\"selectdate(date2);\" style=\"cursor:hand\" title=\"点击选择时间\">之间</td></tr><tr><td>检索设置：</td><td>每页显示<input type=\"text\" name=\"hitsPerPage\" value=\"20\" size=\"4\" style=\"text-align:center\">篇&nbsp;&nbsp;<input type=\"checkbox\" name=\"showSummaries\" value=\"false\" id=\"showsum\"><label for=\"showsum\" style=\"cursor:hand\">不显示摘要</label>&nbsp;&nbsp;<select name=\"qsort\">\t<option value=\"pubdate\" selected>按文章发布时间排序\t<option value=\"modified\">按文章更新时间排序\t<option value=\"RELEVANCE\">按相关度排序</select></td></tr><tr><td>关键字：</td><td><input type=\"text\" name=\"query\" size=\"50\">&nbsp;&nbsp;&nbsp;&nbsp;<input type=\"image\" src=\"images/search.gif\" value=\"检索\" name=\"search\"></td></tr>\t</form></table></td></tr></table>\t</td>  </tr>  <tr>    <td height=\"5\"></td>  </tr>  <tr>    <td>\t\t</td>  </tr>  <tr>    <td height=\"5\"></td>  </tr></table><!--分页开始----><table width=\"776\"  border=\"0\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\">  <tr>    <td height=\"4\"></td>  </tr>  <tr>    <td> </td>  </tr>    <tr>    <td><table width=\"100%\"  border=\"0\" cellpadding=\"0\" cellspacing=\"1\" bgcolor=\"#CCCCCC\">      <tr>        <td bgcolor=\"#FFFFFF\"><table width=\"100%\"  border=\"0\" cellspacing=\"0\" cellpadding=\"10\">          <tr>            <td width=\"76%\" valign=\"top\"><table width=\"100%\"  border=\"0\" cellspacing=\"0\" cellpadding=\"0\">              <tr><td colspan=\"2\">\t\t\t  </td></tr>\t\t\t<%\t\t\t    for (int i = start; i < end; i++) {\t\t  // display the hits\t\t\t\t    Document doc = hits.doc(i);\t\t\t    String title = doc.get(\"title\");\t\t\t    if (title.equals(\"\"))\t  // use url for docs w/o title\t\t\t      title = doc.get(\"url\");\t\t\t\t  TokenStream ts = analyzer.tokenStream(\"title\",new StringReader(title));\t\t\t\t  String tmps = \"\";\t\t\t\t  try{\t\t\t\t\t  tmps = highlighter.getBestFragments(ts, title, 3, \"...\");\t\t\t\t  }catch(Exception e){\t\t\t\t\t  tmps = \"\";\t\t\t\t  }\t\t\t\t  if(!tmps.equals(\"\")) title = tmps;\t\t\t      strSummary = doc.get(\"summary\");\t\t\t\t  TokenStream ts2 = analyzer.tokenStream(\"summary\",new StringReader(doc.get(\"summary\")));\t\t\t\t  try{\t\t\t\t\t  tmps = highlighter.getBestFragments(ts2, doc.get(\"summary\"), 2, \"...\");\t\t\t\t\t  //tmps = highlighter.getBestFragment(ts2, doc.get(\"summary\"));\t\t\t\t  }catch(Exception e){\t\t\t\t\t  //e.printStackTrace();\t\t\t\t\t  //System.out.println(e.getMessage());\t\t\t\t\t  tmps = \"\";\t\t\t\t  }\t\t\t\t  if(!tmps.equals(\"\")) strSummary = tmps;\t\t\t%>\t\t\t\t\t\t<tr>             <td width=\"80%\"><%=i+1%>.<a href=\"<%=doc.get(\"url\")%>\"><%=title%></a></td><td width=\"20%\" title=\"(更新时间：<%=gDate(GetDateString(doc.get(\"modified\")))%>)\"><%=gDate(GetDateString(doc.get(\"pubdate\")))%> <!--(更新时间：<%=gDate(GetDateString(doc.get(\"modified\")))%>)--> </td>              </tr>\t\t\t  <%\t\t\t  if(showSummaries){\t\t\t  %>\t\t\t  <tr><td colspan=\"2\"><b>摘要:</b><%=strSummary%></td></tr>\t\t\t  <tr><td><a href=\"<%=doc.get(\"url\")%>\" target=\"_blank\"><%=(doc.get(\"description\")==null)?\"\":doc.get(\"description\")%></a>&nbsp;</td><td align=\"right\" class=\"font_hei\" width=\"100\">相关度：<%\t\t\t  out.print((int)(hits.score(i) * 100.0f));\t\t\t  %>%&nbsp;</tr>\t\t  \t\t\t  <%\t\t  \t\t\t  }\t\t  \t\t\t  %><tr><td colspan=\"2\" height=\"1\" bgcolor=\"#EEEEEE\"></td></tr><%}%><tr>    <td align=\"center\" style=\"font-size:12px\" colspan=\"2\">    <form name=\"search\" method=\"post\">   <input type=\"hidden\" name=\"query\" value=\"<%=Entities.encode(queryString)%>\">   <input type=\"hidden\" name=\"start\" value=\"<%=end%>\">   <input type=\"hidden\" name=\"catalog\" value=\"<%=catalog%>\">   <input type=\"hidden\" name=\"hitsPerPage\" value=\"<%=hitsPerPage%>\">   <input type=\"hidden\" name=\"showSummaries\" value=\"<%=showSummaries%>\">   <input type=\"hidden\" name=\"qsort\" value=\"<%=qsort%>\">    <input type=\"hidden\" name=\"date1\" value=\"<%=date1%>\">   <input type=\"hidden\" name=\"date2\" value=\"<%=date2%>\">   <input type=\"hidden\" name=\"qdate\" value=\"<%=qdate%>\">总<%=hits.length()%> 篇 ，共 <%=(int)Math.ceil((hits.length() + hitsPerPage-1) / hitsPerPage)%> 页     <%if (start>0){%>\t <a href=\"#\" onClick=\"document.search.start.value=<%=start-hitsPerPage%>;document.search.submit();\" class=\"font_lv\">上一页</a><%}else{%><font class=\"font_lv\">上一页</font><%}%><a href=\"#\" onClick=\"document.search.start.value=0;document.search.submit();\">最首页</a><%//开始显示分页代码int tenp;String sUrl=\"\";int pc=(int)Math.ceil((hits.length() + hitsPerPage -1) / hitsPerPage);tenp=(int)Math.floor((pg-1)/10);if (tenp>0) //显示上10页{%> <a href=\"#\"  onClick=\"document.search.pg.value=<%=((tenp-1)*10+1)%>;document.search.start.value=<%=hitsPerPage*((tenp-1)*10)%>;document.search.submit();\">上10页</a> <%}else{%>上10页<%}int t=0;if ((tenp+1)*10>pc) t=pc; else t=(tenp+1)*10;for (int i=tenp*10+1;i<=t;i++){\t\tif (pg==i)\t{%>\t\t<b><font color=red><%=pg%></font></b><%\t}else{%><a href=\"#\"  onClick=\"document.search.pg.value=<%=i%>;document.search.start.value=<%=hitsPerPage*(i-1)%>;document.search.submit();\" class=a03><%=i%></a> <%}}if (tenp<Math.floor(pc/10))  //显示下10页{%><a href=\"#\"  onClick=\"document.search.pg.value=<%=((tenp+1)*10+1)%>;document.search.start.value=<%=hitsPerPage*((tenp+1)*10)%>;document.search.submit();\"  class=a03>下10页</a>  <%}else{%>下10页<%}%><a href=\"#\"  onClick=\"document.search.pg.value=<%=pc%>;document.search.start.value=<%=hitsPerPage*(pc-1)%>;document.search.submit();\" class=a03>最末页</a><%if (end < hits.length()) {\t\t\t  // insert next page button%>      <!--<input type=\"submit\" value=\"后一页>>\">-->\t  <a href=\"#\" onClick=\"document.search.submit();\" class=\"font_lv\">下一页</a><%}else{%><font class=\"font_lv\">下一页</font><%}%></font><input type=\"text\" name=\"pg\" size=\"3\"><input type=\"submit\" value=\"GO\">   </form>    </td>  </tr>\t\t\t              </table></td>            </tr>        </table></td>      </tr>    </table></td>  </tr></table><!--分页结束--></td>    <td width=\"226\" valign=\"top\"><iframe src=\"http://www.isccc.gov.cn/include/left4.html\" frameborder=\"0\" height=\"500\" width=\"226\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></td>      </tr></table><!-------------------------------网页底部------------------------------------><table width=\"1002\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\">  <tr>    <td align=\"center\"><iframe src=\"http://www.isccc.gov.cn/include/bottom_new.htm\" frameborder=\"0\" height=\"175\" width=\"1002\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></td>  </tr></table></body></html><%}%>\n   修复方案：  who knows ？你说呢？akast@ngsst.com   版权声明：转载请注明来源 akast@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝 漏洞Rank：4 (WooYun评价)  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "未能联系到厂商或者厂商积极拒绝", "wybug_rank_fromcorp": 4, "Ranks": null}