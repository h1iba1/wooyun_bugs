{"id": 57084, "wybug_id": "wooyun-2014-055367", "wybug_title": "EasyTalk越权查看任意用户的消息", "wybug_corp": "nextsns.com", "wybug_author": "BadCat", "wybug_date": "2014-04-03 08:29", "wybug_open_date": "2014-06-29 08:30", "wybug_type": "非授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["越权操作"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-03：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-05-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-29：\t细节向公众公开  简要描述： EasyTalk越权查看任意用户的消息 详细说明：  出现问题的代码文件路径 : easytalk/Home/Lib/Action/ImAction.class.php代码加载时，没要求登录\npublic function _initialize() {        parent::init();    }\n出现问题的代码在这里\n//获得历史聊天记录        public function getDayRecord() {                $uid=intval($_POST['user_id']);                $user=M('Users')->where(\"user_id='$uid'\")->find();                if ($user) {                        $info=getsubstr($user['user_info'],0,50);                        $info=$info?$info:L('nothing_write');                                                $data = D('MessagesView')->where(\"(senduid='\".$this->my['user_id'].\"' AND sendtouid='$uid') OR (senduid='$uid' AND sendtouid='\".$this->my['user_id'].\"')\")->order(\"message_id DESC\")->limit(10)->select();                        if ($data) {                                $aCent=A('Content');                                foreach ($data as $val) {                                        $val['messagebody']=$aCent->ubb($val['messagebody']);                                        $val['sendtime']=timeop($val['sendtime']);                                        $msg[]=$val;                                }                        }                        //标记已读                        if ($this->my['priread']>0) {                                M('Messages')->where(\"senduid='$uid' AND sendtouid='\".$this->my['user_id'].\"'\")->setField('isread',1);                                $count=M('Messages')->where(\"sendtouid='\".$this->my['user_id'].\"' AND isread=0\")->count();                                if ($count==0) {                                        M('Users')->where(\"user_id='\".$this->my['user_id'].\"'\")->setField('priread',0);                                }                        }                        echo json_encode(array('userinfo'=>$info,'msg'=>$msg));                } else {                        echo 'null';                }        }\n只需post user_id (用户的ID)就可以查看用户的消息\n\n   漏洞证明：  都在上面了   修复方案：  加个权限确认呗   版权声明：转载请注明来源 BadCat@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-06-29 08:30 厂商回复： 这里仅仅可以看到的是你和传入uid的来往私信 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}