{"id": 857, "wybug_id": "wooyun-2014-067944", "wybug_title": "Ecmall某处SQL二次注入第一弹", "wybug_corp": "ShopEx", "wybug_author": "′雨。", "wybug_date": "2014-07-10 10:52", "wybug_open_date": "2014-10-08 10:54", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-10：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-08：\t细节向公众公开  简要描述： 20140618 详细说明：  20140618做了些过滤但是还是能勉强绕过首先注册一个会员 然后发布以上商品然后转义入库 入库后转义符消失商品名称 \t商品分类 \t品牌 \t价格 \t库存 \t上架 \t推荐 \t禁售 \t操作\t全选 \t\t\txxx'and extractvalue(1,concat(0x5c,(user()))),1,1,1,1)# \t\t\t10.00 \t100 \t[可编辑] \t[可编辑] \t\t编辑 | 删除发布一个如上的商品然后找找出库的地方  在app/cart.app.php中 \nfunction add()    {        $spec_id   = isset($_GET['spec_id']) ? intval($_GET['spec_id']) : 0;        $quantity   = isset($_GET['quantity']) ? intval($_GET['quantity']) : 0;        if (!$spec_id || !$quantity)        {            return;        }        /* 是否有商品 */        $spec_model =& m('goodsspec');        $spec_info  =  $spec_model->get(array(            'conditions'    => $spec_id,            'join'          => 'belongs_to_goods',        ));        if (!$spec_info)        {            $this->json_error('no_such_goods');            /* 商品不存在 */            return;        }        /* 如果是自己店铺的商品，则不能购买 */        if ($this->visitor->get('manage_store'))        {            if ($spec_info['store_id'] == $this->visitor->get('manage_store'))            {                $this->json_error('can_not_buy_yourself');                return;            }        }        /* 是否添加过 */        $model_cart =& m('cart');        $item_info  = $model_cart->get(\"spec_id={$spec_id} AND session_id='\" . SESS_ID . \"'\");        if (!empty($item_info))        {            $this->json_error('goods_already_in_cart');            return;        }        if ($quantity > $spec_info['stock'])        {            $this->json_error('no_enough_goods');            return;        }        $spec_1 = $spec_info['spec_name_1'] ? $spec_info['spec_name_1'] . ':' . $spec_info['spec_1'] : $spec_info['spec_1'];        $spec_2 = $spec_info['spec_name_2'] ? $spec_info['spec_name_2'] . ':' . $spec_info['spec_2'] : $spec_info['spec_2'];        $specification = $spec_1 . ' ' . $spec_2;        /* 将商品加入购物车 */        $cart_item = array(            'user_id'       => $this->visitor->get('user_id'),            'session_id'    => SESS_ID,            'store_id'      => $spec_info['store_id'],            'spec_id'       => $spec_id,            'goods_id'      => $spec_info['goods_id'],            'goods_name'    => $spec_info['goods_name'],            'specification' => trim($specification),            'price'         => $spec_info['price'],            'quantity'      => $quantity,            'goods_image'   => $spec_info['default_image'],\n这里出库后 goods_name没转义。造成了二次注入。\n\n直接出数据   漏洞证明：  见上。、   修复方案：  addslashes   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-07-10 14:00 厂商回复： 非常感谢您为shopex信息安全做的贡献我们将尽快修复非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-10 11:02 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  为什么这么吊    \n     2014-07-10 11:18 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  @疯狗 这个也审核下呗http://www.wooyun.org/bugs/wooyun-2014-067717/trace/db140b73d6ad31ce7387d5197bd204aa    \n     2014-07-24 15:30 |    \t\tretanoj \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:9        )\t\t \n  @′ 雨。我看v2.3.0-0918版本里，cart.app.php文件修改日期2010年10月18日已经做过addslashes，你说20140618是什么意思？你的漏洞源码是哪个版本？    \n     2014-10-08 11:33 |    \t\t残废 \t\t\t( 普通白帽子  |\t\t\t        Rank:179 漏洞数:40        | 我是残废，啦啦啦啦)\t\t \n  雨牛千秋万代！    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}