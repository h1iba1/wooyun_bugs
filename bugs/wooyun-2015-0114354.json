{"id": 31305, "wybug_id": "wooyun-2015-0114354", "wybug_title": "安全狗扫描拒绝服务漏洞", "wybug_corp": "安全狗", "wybug_author": "蜗牛的贝壳", "wybug_date": "2015-05-19 14:27", "wybug_open_date": "2015-08-19 18:12", "wybug_type": "拒绝服务", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["拒绝服务", "客户端安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-24：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-07-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-19：\t细节向公众公开  简要描述： 网站安全狗在windows系统中扫描某些文件时会自动退出，造成拒绝服务 详细说明：  先说下本人的测试环境,windows2003+IIS6,安全狗是IIS v3.5 Beta版,是最新的了.首先新建一个文件1111111111.jpg(文件名适当长点),然后在网站根目录下新建一个文件夹,把先前的jpg文件拷贝进去,然后重命名这个文件夹,比如文件夹名可以是：\"大白大白大白......大白大白大白.asp\",点号就是很多'大白'的组成,一直到文件名长度达到最大就可以了.然后就用安全狗的自定义网站扫描去扫描那个包含上述文件的网站,不一会安全狗就自动退出了,造成拒绝服务。经过OD动态调试分析发现,是安全狗按照常规使用MAX_PATH这一大小来申请一块缓冲区,在其调用wcscat_s时由于缓冲区过小,造成缓冲区溢出,但由于代码是调用微软安全函数wcscat_s,所以就造成拒绝服务了,自动退出了.下面来动态分析下.   漏洞证明：  \n\n看上图,图片中左上角的地方就是出问题的所在,再看左下角的内存窗口,蓝色区域的大小就是申请的缓冲区大小,为0x208,也就是2倍的MAX_PATH,是unicode类型,而橙色方框内的就是那个超长目录的路径,长度大小为0x1f0,也就是说这个缓冲区可以至多存放0x208-0x1f0=0x18字节大小(忽略字符串结尾\\0所占的两个字节的影响).再来看看右下角的堆栈窗口,红色方框内的就是那个jpg文件名称,长度大小为0x34字节(unicode类型),这个比缓冲区最多能够存放的0x18字节要大,所以在调用wcscat_s函数时就发生缓冲区溢出,造成拒绝服务了.   修复方案：  虽然MAX_PATH是常用来处理windows环境下文件名路径的长度大小的常用方法,但是总有些特殊情况存在,这又是在比较老的windows系统上,所以还是增大缓冲区长度吧,或者加上异常处理吧.   版权声明：转载请注明来源 蜗牛的贝壳@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-05-21 18:11 厂商回复： 感谢蜗牛的贝壳对安全狗的关注,  研发部门已经开始着手修复. 此漏洞需由管理员手工触发, 利用环境受限. 希望贝壳再接再厉.  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}