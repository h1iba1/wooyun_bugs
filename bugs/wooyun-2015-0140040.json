{"id": 66524, "wybug_id": "wooyun-2015-0140040", "wybug_title": "奇葩方式进去广东省联通沃盟（可发短信给全省渠道或任意个人/实名制信息泄露/0元购机自己审核等）", "wybug_corp": "中国联通", "wybug_author": "孔卡", "wybug_date": "2015-09-12 09:54", "wybug_open_date": "2015-10-29 23:14", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["认证设计不合理", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-29：\t细节向公众公开  简要描述： 广东联通的省级B2B渠道平台，奇葩设计逻辑导致直接最高权限登录后台，功能太强大了---表哥们给朵小云吧，中秋不发月饼只要云~~~废话不多说，开始了~~~ 详细说明：  这部分主要说漏洞成因：http://www.wom186.com/  直接打开会发现，是一个账户密码登录页面，甚是恼人啊~~~~没办法，看能不能找回密码呢？\n\n发现admin账号存在，诶~~~要填验证码，试过4位的不行，那爆破还是算了，就算进去了也显得过程不好玩儿不是？右键查看下源码，发现了点东西，贴出关键部分源码\n<div class=\"form_div\">\t\t\t\t\t\t<form method=\"post\" id=\"resetpwdForm\">\t\t\t\t\t\t<input type=\"hidden\" id=\"userId\" />\t\t\t\t\t\t<input type=\"hidden\" id=\"isValid\" />\t\t\t\t\t\t<input type=\"hidden\" id=\"userType\" />\t\t\t\t\t\t<input type=\"hidden\" id=\"groupDetailId\" />                        <input type=\"hidden\" id=\"securityCodeToken\" />\t\t\t\t\t\t\t<div class=\"register\">\t\t\t\t\t\t\t\t<ul>\t\t\t\t\t\t\t\t\t<li step=\"1\" class=\"li\" id=\"accountLi\">\t\t\t\t\t\t\t\t\t\t<b>※</b>\t\t\t\t\t\t\t\t\t\t<div class=\"label\">\t\t\t\t\t\t\t\t\t\t\t帐号：\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class=\"inputOuter\">\t\t\t\t\t\t\t\t\t\t\t<input id=\"account_val\" class=\"inputStyle\" type=\"text\" name=\"userMap['account']\"/>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div id=\"account_msg\" class=\"msg\">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<br class=\"clear\"/>\t\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t\t\t<li step=\"1\" class=\"li\" id=\"inputVcLi\">\t\t\t\t\t\t\t\t\t\t<b></b>\t\t\t\t\t\t\t\t\t\t<div class=\"label\">\t\t\t\t\t\t\t\t\t\t\t验证码：\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class=\"inputVcOuter\">\t\t\t\t            \t\t\t\t<input type=\"text\" class=\"inputVcStyle\" id=\"inputVc\" maxlength=\"5\" />\t\t\t\t           \t\t\t\t </div>\t\t\t\t\t\t\t\t\t\t<div class=\"left\">                                            <a href=\"javascript:void(0);\" id=\"change_code_img\">                                             \t<img src=\"http://www.wom186.com/verification_code.jpg\" height=\"39\" width=\"80\" />                                            </a>\t\t\t\t\t\t\t\t\t\t</div>                                        <a class=\"btn2-main left\" style=\"color: #157ABF;line-height: 40px;margin-left: 5px;\" id=\"changeVcImg\">看不清换一张</a>\t\t\t\t\t\t\t\t\t\t<div id=\"inputVc_msg\" class=\"msg\"></div>\t\t\t\t\t\t\t\t\t\t<br class=\"clear\"/>\t\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t\t\t<li step=\"2\" class=\"li\" id=\"phoneLi\" style=\"display: none;\">\t\t\t\t\t\t\t\t\t\t<b></b>\t\t\t\t\t\t\t\t\t\t<div class=\"label\">\t\t\t\t\t\t\t\t\t\t\t手机号：\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class=\"inputOuter\">\t\t\t\t\t\t\t\t\t\t\t<input id=\"phone_val\" class=\"inputStyle\" type=\"text\" disabled=\"disabled\"/>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div id=\"phone_msg\" class=\"msg\">\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<br class=\"clear\"/>\t\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t\t\t<li step=\"2\" class=\"li\" id=\"msgVcCodeLi\" style=\"display: none\">\t\t\t\t\t\t\t\t\t\t<b>※</b>\t\t\t\t\t\t\t\t\t\t<div class=\"label\">\t\t\t\t\t\t\t\t\t\t\t验证码：\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class=\"inputOuter\">\t\t\t\t\t\t\t\t\t\t\t<input id=\"msgVcCode\" class=\"inputStyle\" type=\"text\" />\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div id=\"msgVcCode_msg\" class=\"msg\">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<br class=\"clear\"/>\t\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t\t\t<li step=\"2\" class=\"li\" id=\"getVCBtnLi\" style=\"display: none;padding-left: 120px;padding-top: 10px;height:30px;\">\t\t\t\t\t\t\t\t\t\t<div class=\"btn2\" id=\"getVCBtn\">\t\t\t\t\t\t\t\t\t\t\t<div class=\"btn2-warp\">\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"btn2-top left\">&nbsp;</div>\t\t\t\t\t\t\t\t\t\t\t\t<!-- <a class=\"btn2-main left\">免费获取验证码</a> -->\t\t\t\t\t\t\t\t\t\t\t\t<a style=\"text-decoration:none;\" href=\"###\" class=\"a_btn\">免费获取验证码</a>\t\t\t\t\t\t\t\t\t\t\t\t<br class=\"clear\"/>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<span id=\"getVcTipSpan\" style=\"display: none;\">短信发送成功，重新发送(' + wait + ')</span>\t\t\t\t\t\t\t\t\t\t<br class=\"clear\"/>\t\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t\t\t<li step=\"3\" class=\"li\" id=\"newPasswordLi\" style=\"display: none\">\t\t\t\t\t\t\t\t\t\t<b>※</b>\t\t\t\t\t\t\t\t\t\t<div class=\"label\">\t\t\t\t\t\t\t\t\t\t\t新密码：\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class=\"inputOuter\">\t\t\t\t\t\t\t\t\t\t\t<input id=\"newPassword\" class=\"inputStyle\" type=\"password\" onselectstart=\"return false;\"                                                   ondragenter=\"return false;\"   autocomplete=\"off\"                                                   onpaste=\"return false;\" />\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div id=\"newPassword_msg\" class=\"msg\">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<br class=\"clear\"/>\t\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t\t\t<li step=\"3\" class=\"li\" id=\"repasswordLi\" style=\"display: none\">\t\t\t\t\t\t\t\t\t\t<b>※</b>\t\t\t\t\t\t\t\t\t\t<div class=\"label\">\t\t\t\t\t\t\t\t\t\t\t确认密码：\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class=\"inputOuter\">\t\t\t\t\t\t\t\t\t\t\t<input id=\"repassword\" class=\"inputStyle\" type=\"password\" onselectstart=\"return false;\"                                                   ondragenter=\"return false;\"   autocomplete=\"off\"                                                   onpaste=\"return false;\" />\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div id=\"repassword_msg\" class=\"msg\">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<br class=\"clear\"/>\t\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t\t\t<li>\t\t\t\t\t\t\t\t\t\t<div class=\"textcenter\">\t\t\t\t\t\t\t\t\t\t\t<div class=\"btn2\" id=\"nextstepbtn\">\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"btn2-warp\">\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"btn2-main button_ok button_ok_red\">下一步</div>\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t\t</li>\t\t\t\t\t\t\t\t</ul>\t\t\t\t\t\t\t</div>\n简单分析下就得出 重置密码分三步（上面的源码里叫作step1,2,3）：1. 输入账号2. 填写收来的短信验证码3.设置新密码嗯，简直是废话~~~~那我们的目标是 step3!再看看数据包，奇葩现象出现了，第一步填写要找回的账号admin后，自动发出了俩post包\n\nOK，亮点在第二个包\n\nuserMap.step=1 userMap.pwd 又留空，结合上面的分析，这不就是第一步么，密码还是空的，再看下这个包对应的回包\n\n嗯，也是step1，送到repeater里，大胆的把userMap.step=1改为3，userMap.pwd给加上我们要设置的密码，奇迹出现了~~~~\n\n重置成功！ 账号 admin 密码 woaini@123  表哥们审核完后记得给这里mask一下哈\n\n登录后选地市平台专区这里进入，就是广东省全省的渠道了，国代那里授权还没统一，漏洞证明部分开始爆料~~~~   漏洞证明：  体育老师说写文章要首尾呼应，不能当标题党~~~~0x01 官方身份任意发短信给全省渠道或者任意联通用户\n\n1万多个营业网点都可以推送骚扰短信了，给任意用户发的话，编辑下资料，把用户信息加入到营业网点这里就好，或者直接抓包截断改下手机号也成。0x02 实名制信息泄露（里面还包含SIM卡串号，结合峰会的4G卡复制，不知什么时候能实现直接串号复制）\n\n\n\nexcel看着方便点 0x03 0元购机自己审核\n\n这里直接可以下单购买手机了\n\n手机卖多少咱说了算哈\n\n其实这价差也可以接受哈，联通手机卖的不贵，嗯嗯。0x04  其他一些信息\n\n哇，这么多渠道~~~~\n\n8600多条支付信息。。七七八八的信息好多，强大的后台~~~~~   修复方案：  逻辑讲清楚了，不在后台测试注入和getshell了  露点的问题够多了~~~~   版权声明：转载请注明来源 孔卡@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-09-14 23:12 厂商回复： CNVD确认所述情况，已经转由CNCERT下发给广东分中心，由其后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}