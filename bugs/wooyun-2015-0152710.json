{"id": 72327, "wybug_id": "wooyun-2015-0152710", "wybug_title": "中国铁建内网漫游沦陷多个重要部门泄漏大量信息(redis+ssh-keygen免认证登录案例)", "wybug_corp": "中国铁建", "wybug_author": "wsg00d", "wybug_date": "2015-11-08 10:23", "wybug_open_date": "2015-12-26 10:42", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-26：\t细节向公众公开  简要描述： 当redis遇到ssh将擦出怎样的火花？http://antirez.com/news/96http://zone.wooyun.org/content/23759中国铁建内网漫游沦陷多个重要部门，海康威视摄像头，蓝盾网页防篡改系统，多台华为防火墙.... 详细说明：  鄙人仍在努力学习内网渗透，有些地方写得啰嗦了就当记笔记。。大牛轻喷一切都是从这里开始的。。。。IP: **.**.**.**  中国铁建蓝信系统\n\n该服务器开放了 6379端口也就是redis默认的端口了，未授权访问，直接远程连接\n\n然后此时一般的思路就是找到网站物理路径，然后通过备份拿到webshell，然而这个站点的物理路径并没有找到，但是端口扫描发现该服务器开放了ssh22端口，于是可以通过问题描述里连接的方法拿到shell了，首先通过ssh-keygen生成private和public密钥。然后将生成的public密钥拷贝到远程机器后，就可以使用ssh登录到远程机器上去而不要密码。\n\n上图，红色圈内表示生成的公钥。我们只需要将这个公钥上传到目标服务器的“/root/.ssh/”目录并重命名为authorized_keys。做好了后，我们就可以直接登录目标服务器了，不需要输入用户名和密码。但是怎么通过redis拷贝文件过去呢？其实只需把id_rsa.pub里的内容复制过去就行了。具体看图。首先看看id_rsa.pub里的内容\n\n我们只需把这些内容想备份一句话木马的形式备份到/root/.ssh/目录下就行了，当然备份的名字得改为uthorized_keys，如图，最好在公钥内容的前面和后面都加上一点空格和回车，不然貌似数据库的其它内容会造成影响。\n\n\n\n\nPS(然后发现其实我不是第一个进来的了，，因为之前就发现文件备份的位置和名字都已经是上图那样了，而且下图是之前的公钥内容，我进来才替换的，完全是跟着上面那篇外国人写的文章做的，后来测试时，公钥又被换回去了。很不爽没法继续。于是擅自给redis数据库设了个密码为hamapi   所以不要打我。。。)redis设置密码 config set requirepass test123查询密码 config get requirepass\n\n\n通过save命令保存后，直接ssh远程即可登录了，无需密码，如图\n\n   漏洞证明：  既然有了ssh，而且在内网还是root权限，不继续怎么能行呢？通过ssh建立一个socket5连接，本地再通过配置proxychains就可以继续内网渗透了ssh建立socke5连接   ssh -f -N -D **.**.**.**:7777 root@**.**.**.**接下来就扫描内网段，信息收集，再结合乌云上已经爆出的铁建的帐号密码扫弱口令了简单测试了下，直接上结果1、首先跳板服务器mysql帐号密码泄漏，而且还允许外联，泄漏大量信息**.**.**.**  mysql帐号lanxin 密码crcc_t20150428\n\n2、仍有多台linux服务器装有redis且都为空口令导致可按同样方法远程ssh，如图\n\n受影响服务器\n**.**.**.**: 6379**.**.**.**: 6379**.**.**.**: 6379**.**.**.**: 6379**.**.**.**: 6379**.**.**.**: 6379\n3、\n**.**.**.**  tomcat弱口令  admin  admin  服务器沦陷\n\n\n\n\n\n\n4、\n**.**.**.**40  admin  123456\n 海康威视摄像头，没装插件，看不见了，。。\n\n5、\n中国铁建协同管理系统  **.**.**.**:8080弱口令账户，密码全为123456liweilimlijuanwangjunliliwanghuizhangbyangjingliuhuiwangjhzihlijianyangyanwjgchenhualifengzhangjianguowangdongzhangzqliuyunhuangywanggxyanglinglixiaohong\n通讯录\n\n工管系统等。。。。。\n\n5、\n**.**.**.**  企业生产计划统计管理系统  弱口令 sunps  123456\n\n\n6、\nhttp://**.**.**.**64   安全隐患排查系统  弱口令  libin  123456\n\n\n\n\n\n\n7、多台华为SUG5530防火墙弱口令\n**.**.**.**  **.**.**.**  **.**.**.**弱口令admin Admin@123\n这个危害有点大吧。。\n\n8、\n**.**.**.**:8080 中国铁建工程项目信息系统弱口令123456789 1234561 1234567758521 123456987654321 123456lili 123456yangling 12345611 123456andy 1234569 123456\n \n\n9、\nhttp://**.**.**.**51:8080/  admin  admin  蓝盾网页防篡改系统\n威胁主站以及其它站点安全中国铁建-CN中非铁城监理铁建青年网铁建财务国际集团中国铁建-EN\n\n\n\n10、\n人力资源系统apusic弱口令  http://**.**.**.**31:6890/admin/protected/index.jsp  admin   admin\n\n\n11、其它ftp弱口令 **.**.**.**6  **.**.**.**  oracle 123456**.**.**.**32  oracle oracle\n\n\n\n\n\n\n\n隐患抽样系统 **.**.**.**/login.do?reqCode=init  libin  123456\n\n\n\n   修复方案：  累。。困死。睡觉。。   版权声明：转载请注明来源 wsg00d@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-11-11 10:41 厂商回复： CNVD确认所述情况，已经由CNVD通过以往建立的处置渠道向网站管理单位通报。  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-11-09 22:58 |    \t\tLionEiJonson \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:3        | 持剑的浪客，写诗的可达鸭。)\t\t \n  大哥的描述也是越来越骚了    \n     2015-11-10 15:33 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 哈！躁起来！)\t\t \n  乌云首个案例是这么玩的，闪一下    \n     2015-11-10 16:28 |    \t\twsg00d \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:16        | 本人学识渊博，经验丰富，代码风骚，效率恐...)\t\t \n  @浩天 卧槽，上个课回来就打雷了，谢谢浩天哥    \n     2015-11-10 17:43 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1417 漏洞数:225        | WooYun is the Bigest gay place :))\t\t \n  感觉自己跟精华失之交臂...    \n     2015-11-10 17:53 |    \t\twsg00d \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:16        | 本人学识渊博，经验丰富，代码风骚，效率恐...)\t\t \n  @_Thorns 膜拜铁建专业户    \n     2015-11-10 17:55 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1417 漏洞数:225        | WooYun is the Bigest gay place :))\t\t \n  @wsg00d 没，我说的是redis+ssh-keygen。要哭了(┬＿┬)    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}