{"id": 82549, "wybug_id": "wooyun-2015-0150736", "wybug_title": "魔都某大型漫展官网存在上传漏洞，可上传任意类型文件，并因服务器权限控制不当，导致服务器沦陷", "wybug_corp": "上海摩都文化传播有限公司", "wybug_author": "sdjnmxd", "wybug_date": "2015-10-31 09:44", "wybug_open_date": "2015-12-15 09:44", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-31：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2015-12-15：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 魔都某大型漫展官网存在上传漏洞，可上传任意类型文件。并因服务器权限控制不当，导致服务器沦陷 详细说明：  首先，先熟悉下站点的情况，web组件为IIS7.5，服务器为阿里云。因为阿里云的原因，直接放弃嗅探，于是从该站点的其他地方下手于是就先找上传漏洞，大概头像那是第一个上传的途径\n\n经测试发现，上传时并未对文件格式做检查。但是，如果上传一个非图片文件，服务器会把该文件当作图片来处理（因为头像在上传后可以调整宽高），所以会返回一个500，这样会导致无法获取上传后带有时间戳的URL于是这里就使用常用的copy /b方法   把shell隐藏在图片后面，既让服务器能返回地址给我，同时还不影响shell的正常运行\n\n之后菜刀连接，效果图如下\n\n本来我想就此结束了，但当我看到能访问C盘文件的时候，不尽的又开始了进一步操作遂正常添加用户？没戏！把guest账户扔到administrators组里？没戏！  回头看了下用户，跑在了IIS的用户里\n\n本来想着就社工来着，于是看了下本地用户，当然试了试并没有任何收获（截这个图的时候已经是提权后了，所以是有wooyun账号的）\n\n你以为这就完了么！   当然不是！看了下systeminfo的补丁数量，让我放弃了使用CVE提权的方法，所以tasklist了一下，然后在netstat -ano看看有没有入手点果然，服务器跑着sql server，并且1433端口监听在了0.0.0.0，这就让事情开始有了转机\n\n\n\n于是下一步让我想到了xp_cmdshell大法，但前提是有sa，并且有密码于是网站根目录下扒了扒，收获不错！\n\n呐，system权限来了\n\n既然是system那就没有不能干的事了\n\nrdp居然有人在线\n\n后续：其实本地还运行了一个FTP服务，而且FTP的密码是MD5加密存储在FTP服务端目录\n\n然后密码还挺简单\n\n   漏洞证明：  \n\n\n\n\n\n   修复方案：  1.上传校验2.不要用sa,不要用sa,不要用sa3.控制好权限4.linux大法好   版权声明：转载请注明来源 sdjnmxd@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评价\n     2015-11-28 12:37 |    \t\tsdjnmxd \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 初入大坑)\t\t \n  等了那么长时间今天居然修复了。。。这是要默默无闻修漏洞的节奏？    \n     2015-11-28 12:50 |    \t\t小龙 \t\t\t( 普通白帽子  |\t\t\t        Rank:1462 漏洞数:379        | 乌云有着这么一群人，在乌云学技术，去某数...)\t\t \n  @sdjnmxd 无良厂商呗。。    \n     2015-11-30 11:04 |    \t\tsdjnmxd \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 初入大坑)\t\t \n  @小龙 欸。。。好无奈。。。本来挺有意思的一次实习。。 就这么把兴趣打破了    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}