{"id": 37136, "wybug_id": "wooyun-2015-0115909", "wybug_title": "携程旅游网服务器配置不当可直接导致官方邮件劫持（邮件伪造与防识别原理）", "wybug_corp": "携程旅行网", "wybug_author": "黑暗游侠", "wybug_date": "2015-05-25 13:19", "wybug_open_date": "2015-05-25 15:30", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-25：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 以为快乐会永久 像不变星空 陪著我 详细说明：  之前提交了 http://wooyun.org/bugs/wooyun-2015-0114708(标题:一种可大规模定向钓鱼携程旅游网千万用户的攻击过程重放（附案例，非携程用户依然躺枪）这个比较鸡肋，因为还需要高深的html技术去构造，并且后面的表单并不能去掉，只能在一块区域自定义内容那么so，附上直接版的吧，大招。携程有两个域名ctrip.com 和 c-ctrip.com\n; <<>> DiG 9.8.4-rpz2+rl005.12-P1 <<>> -t ctrip.com;; global options: +cmd;; Got answer:;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 16330;; flags: qr rd ra; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 13;; QUESTION SECTION:;.\t\t\t\tIN\tNS;; ANSWER SECTION:.\t\t\t250997\tIN\tNS\tc.root-servers.net..\t\t\t250997\tIN\tNS\ta.root-servers.net..\t\t\t250997\tIN\tNS\th.root-servers.net..\t\t\t250997\tIN\tNS\tb.root-servers.net..\t\t\t250997\tIN\tNS\tf.root-servers.net..\t\t\t250997\tIN\tNS\tl.root-servers.net..\t\t\t250997\tIN\tNS\tj.root-servers.net..\t\t\t250997\tIN\tNS\td.root-servers.net..\t\t\t250997\tIN\tNS\tg.root-servers.net..\t\t\t250997\tIN\tNS\ti.root-servers.net..\t\t\t250997\tIN\tNS\tm.root-servers.net..\t\t\t250997\tIN\tNS\te.root-servers.net..\t\t\t250997\tIN\tNS\tk.root-servers.net.;; ADDITIONAL SECTION:c.root-servers.net.\t581623\tIN\tA\t192.33.4.12c.root-servers.net.\t581625\tIN\tAAAA\t2001:500:2::ca.root-servers.net.\t580364\tIN\tA\t198.41.0.4a.root-servers.net.\t581623\tIN\tAAAA\t2001:503:ba3e::2:30h.root-servers.net.\t581623\tIN\tA\t128.63.2.53h.root-servers.net.\t581623\tIN\tAAAA\t2001:500:1::803f:235b.root-servers.net.\t581624\tIN\tA\t192.228.79.201b.root-servers.net.\t581626\tIN\tAAAA\t2001:500:84::bf.root-servers.net.\t581623\tIN\tA\t192.5.5.241f.root-servers.net.\t581623\tIN\tAAAA\t2001:500:2f::fl.root-servers.net.\t581623\tIN\tA\t199.7.83.42l.root-servers.net.\t581623\tIN\tAAAA\t2001:500:3::42j.root-servers.net.\t581624\tIN\tA\t192.58.128.30;; Query time: 5 msec;; SERVER: 211.137.130.3#53(211.137.130.3);; WHEN: Sun May 24 04:26:52 2015;; MSG SIZE  rcvd: 508\n\n; <<>> DiG 9.8.4-rpz2+rl005.12-P1 <<>> -t c-ctrip.com;; global options: +cmd;; Got answer:;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 52168;; flags: qr rd ra; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 13;; QUESTION SECTION:;.\t\t\t\tIN\tNS;; ANSWER SECTION:.\t\t\t251076\tIN\tNS\tc.root-servers.net..\t\t\t251076\tIN\tNS\ta.root-servers.net..\t\t\t251076\tIN\tNS\th.root-servers.net..\t\t\t251076\tIN\tNS\tb.root-servers.net..\t\t\t251076\tIN\tNS\tf.root-servers.net..\t\t\t251076\tIN\tNS\tl.root-servers.net..\t\t\t251076\tIN\tNS\tj.root-servers.net..\t\t\t251076\tIN\tNS\td.root-servers.net..\t\t\t251076\tIN\tNS\tg.root-servers.net..\t\t\t251076\tIN\tNS\ti.root-servers.net..\t\t\t251076\tIN\tNS\tm.root-servers.net..\t\t\t251076\tIN\tNS\te.root-servers.net..\t\t\t251076\tIN\tNS\tk.root-servers.net.;; ADDITIONAL SECTION:c.root-servers.net.\t581702\tIN\tA\t192.33.4.12c.root-servers.net.\t581704\tIN\tAAAA\t2001:500:2::ca.root-servers.net.\t580443\tIN\tA\t198.41.0.4a.root-servers.net.\t581702\tIN\tAAAA\t2001:503:ba3e::2:30h.root-servers.net.\t581702\tIN\tA\t128.63.2.53h.root-servers.net.\t581702\tIN\tAAAA\t2001:500:1::803f:235b.root-servers.net.\t581703\tIN\tA\t192.228.79.201b.root-servers.net.\t581705\tIN\tAAAA\t2001:500:84::bf.root-servers.net.\t581702\tIN\tA\t192.5.5.241f.root-servers.net.\t581702\tIN\tAAAA\t2001:500:2f::fl.root-servers.net.\t581702\tIN\tA\t199.7.83.42l.root-servers.net.\t581702\tIN\tAAAA\t2001:500:3::42j.root-servers.net.\t581703\tIN\tA\t192.58.128.30;; Query time: 4 msec;; SERVER: 211.137.130.3#53(211.137.130.3);; WHEN: Sun May 24 04:25:32 2015;; MSG SIZE  rcvd: 508\n其中ctrip的mx和txt记录：\n;; QUESTION SECTION:;ctrip.com.\t\t\tIN\tMX;; ANSWER SECTION:ctrip.com.\t\t777\tIN\tMX\t20 mx2.ctrip.com.ctrip.com.\t\t777\tIN\tMX\t10 mx.ctrip.com.\n\nctrip.com.\t\t900\tIN\tTXT\t\"0RhgfGwGA1HoaS1HmgmNzd+tKZb46AxM4nqm73bTsj9/3MIn0pmyIbZasbdvgvrrXYGtnr6K+wHvPhQ0QysxoQ==\"ctrip.com.\t\t900\tIN\tTXT\t\"v=spf1 include:spf.ctrip.com ~all\"ctrip.com.\t\t900\tIN\tTXT\t\"v=spf2.0/pra include:spf.ctrip.com ~all\"ctrip.com.\t\t900\tIN\tTXT\t\"MS=ms62746735\"\nc-ctrip.com的mx和txt记录：\n;; QUESTION SECTION:;c-ctrip.com.\t\t\tIN\tMX;; ANSWER SECTION:c-ctrip.com.\t\t900\tIN\tMX\t20 mx1.c-ctrip.com.c-ctrip.com.\t\t900\tIN\tMX\t10 mx2.c-ctrip.com.\n\nAddress:  211.137.130.3c-ctrip.com        primary name server = ns5.ctrip.com        responsible mail addr = hostmaster.ctrip.com        serial  = 2015051301        refresh = 7200 (2 hours)        retry   = 3600 (1 hour)        expire  = 604800 (7 days)        default TTL = 3600 (1 hour)\ndiff 一下ctrip.com域下作了spf但是c-ctrip.com域下并没有DNS记录txt类型的spf记录登记邮件服务器IP看证明：   漏洞证明：  伪造csrc@c-ctrip.com搭建一个邮局服务器添加域名c-ctrip.com添加用户csrc自定义邮件发给自己（茫茫用户中的小小一个）\n\n(亲，携程邀请你去看5月28号的多啦A梦：伴我同行）   修复方案：  给个参考链接   http://www.openspf.org/SPF_Record_Syntax   版权声明：转载请注明来源 黑暗游侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-05-25 15:30 厂商回复： 感谢您对携程的关注。 漏洞Rank：5  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-05-25 16:29 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  携程领导毕竟牛逼    \n     2015-05-28 15:59 |    \t\tTopman王 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:6        | 软件开发工程师!白帽子!XSSER,渗透,SEO)\t\t \n  携程不认真对待白帽子的后果。。。今天全被X机了。。。    \n     2015-05-28 16:13 |    \t\tby_奇奇 \t\t\t( 实习白帽子  |\t\t\t        Rank:35 漏洞数:7        | 2)\t\t \n  携程领导毕竟吊    \n     2015-05-28 16:21 |    \t\tpopok \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:24        | nothing)\t\t \n  围观一下    \n     2015-05-28 16:24 |    \t\tbackda0 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:6        | none)\t\t \n  携程老板是不是为了纪念股市跳水？    \n     2015-05-28 16:24 |    \t\t姗姗来迟 \t\t\t( 普通白帽子  |\t\t\t        Rank:297 漏洞数:72        | coffeesafe的小号)\t\t \n  前排留名，火了~~我要上央视！    \n     2015-05-28 16:24 |    \t\txiaogui \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:24        | 围观大牛来了~~~)\t\t \n  回过头来再看看这个洞，貌似错过了什么    \n     2015-05-28 16:25 |    \t\t027—呔妖怪 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | ~)\t\t \n  (亲，携程邀请你去看5月28号的多啦A梦：伴我同行）    \n     2015-05-28 16:30 |    \t\t我才不叫小耗子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        )\t\t \n  啦啦啦~留个名    \n     2015-05-28 16:34 |    \t\t我才不叫小耗子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        )\t\t \n  问世间情为何物，只叫人生死相许    \n     2015-05-28 16:35 |    \t\t姗姗来迟 \t\t\t( 普通白帽子  |\t\t\t        Rank:297 漏洞数:72        | coffeesafe的小号)\t\t \n  携程事件，个人初步怀疑不是路人甲干的，就是带头大哥干的。这两人太坏了！这两人太坏了。。应该抓起来。    \n     2015-05-28 16:37 |    \t\tBalalaika. \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | noob)\t\t \n  目测白帽子又要上头条了    \n     2015-05-28 16:41 |    \t\tTaro \t\t\t( 普通白帽子  |\t\t\t        Rank:178 漏洞数:48        | 走向最远的方向，哪怕前路迷茫；抱着最大的...)\t\t \n  路人甲和带头大哥表示负责    \n     2015-05-28 16:44 |    \t\t大灰狼 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 额、、)\t\t \n  前排留名。。    \n     2015-05-28 16:55 |    \t\tT工匠 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 就是个楞头！)\t\t \n  头条了 哈哈前排广告位出租！Cav看这里喔。    \n     2015-05-28 16:57 |    \t\t二少 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | xxxxx)\t\t \n  @黑暗游侠 洞主在携程刷了不少了吧？连撞库都给予了￥￥￥奖励，突然一个“漏洞”没有给予奖励，是不是心理有点失衡？    \n     2015-05-28 17:05 |    \t\tSword \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:11        | 求大牛带飞)\t\t \n  前排留名  ！！！    \n     2015-05-28 17:06 |    \t\tB1acken \t\t\t( 普通白帽子  |\t\t\t        Rank:174 漏洞数:56        | 渣渣)\t\t \n  17楼关注    \n     2015-05-28 17:18 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @二少 完全木有失衡    \n     2015-05-28 17:27 |    \t\tLauRen \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 苦逼屌丝一枚。)\t\t \n  我知道记者要来这里，记者看我看我    \n     2015-05-28 17:28 |    \t\t你大爷在此 百无禁忌 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:6        | Hello 各位小伙伴们 大家好 我是王尼玛)\t\t \n  明明是他们自己技术员修复漏洞手贱了 好么    \n     2015-05-28 18:02 |    \t\t孔卡 \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:12        | 我已经过了那个餐桌上只有一条鸡腿就一定能...)\t\t \n  携程说因外部攻击，无法访问了，所以，请大家访问阿里.去啊；但是表忘了，阿里见过大世面啊，双11怎么抗下来的？“心机”了一下，转变策略，官网放话叫大家访问艺龙，艺龙什么结果大家都看到了~~~~我只想知道，接下来我们是不是该临时访问途牛了？    \n     2015-05-28 18:05 |    \t\tmilan \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:32        | 妈妈说：搬不完砖就别回家。)\t\t \n  瓜子  啤酒  花生  矿泉水啦     \n     2015-05-28 18:07 |    \t\tllkoio \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:3        | 热爱网络安全！)\t\t \n  留名，万一火了上电视了能拍到我的留言呢！    \n     2015-05-28 18:12 |    \t\tKi11 \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:5        | ส็็็็็็็็็็็็็็็็็็็...)\t\t \n  ccav看这里！！  妈妈我上电视了！！！！！    \n     2015-05-28 18:23 |    \t\tEcho \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | ฏ๎๎๎๎๎๎๎๎๎ฏด้้้้้็็็...)\t\t \n  前排占座！！！    \n     2015-05-28 18:25 |    \t\t盛大网络(乌云厂商)\t\t \n  110看这里    \n     2015-05-28 18:32 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  请不要回复了，都是小事情    \n     2015-05-28 18:51 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @黑暗游侠 嗯跟这个漏洞有啥关系，这些媒体。。。    \n     2015-05-28 18:53 |    \t\tmilan \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:32        | 妈妈说：搬不完砖就别回家。)\t\t \n  @疯狗 乌云官方微博上 提的这个漏洞    \n     2015-05-28 18:56 |    \t\tPooke \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 菜鸟团撸过。)\t\t \n  最后一句话。。。。5.28    \n     2015-05-28 19:03 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @疯狗 诶    \n     2015-05-28 19:04 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @疯狗 关键还没rank    \n     2015-05-28 19:04 |    \t\tMr.R \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:14        | 求大神带我飞 qq2584110147)\t\t \n  携程。 我们来悼念你了    \n     2015-05-28 19:12 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @黑暗游侠 给了些分析分。这个漏洞其实影响一般，但SPF这个细节值得鼓励。    \n     2015-05-28 19:26 |    \t\tCorpse \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:5        | 我只是个酱油~~~)\t\t \n  携程走好~    \n     2015-05-28 20:09 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @疯狗 影响其实是挺大的，看我上一个攻击过程重放，不完美的钓鱼，已经有支付宝资金转账案例，直接版的这个则可以绕过携程的一切服务端防御规则、邮件自定义，因为是完全由攻击者控制的。    \n     2015-05-28 20:14 |    \t\t大师哥 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | I am the government)\t\t \n  看这里 看这里    \n     2015-05-28 20:32 |    \t\t不会游泳的鱼 \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:35        | 非著名白帽子)\t\t \n  ccav，看这里    \n     2015-05-28 20:46 |    \t\tlogin \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 一个感情和生活的记录者)\t\t \n  @黑暗游侠 膜拜你    \n     2015-05-28 21:09 |    \t\t山鹰 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 拒绝搞基，啊哈)\t\t \n  留名。cctv拍我    \n     2015-05-28 21:11 |    \t\tBroken \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:1        | 万丈红尘三杯酒，千秋大业一壶茶。)\t\t \n  这个页面肯定会火！    \n     2015-05-28 21:16 |    \t\t洗剪吹 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 出门在外，安全第一！)\t\t \n  不留名也不行啊。。 验证码是 86JB    \n     2015-05-28 21:49 |    \t\t4399gdww \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:4        | )\t\t \n  不留名也不行啊。。 验证码是 95VA    \n     2015-05-28 21:49 |    \t\t煎饼侠 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 请叫我红领巾)\t\t \n  目测，内部程序员手贱修复了，导致误操作。    \n     2015-05-28 22:00 |    \t\t我不是小黑 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我真不是小黑)\t\t \n  出租广告位    \n     2015-05-28 22:27 |    \t\tMayter \t\t\t( 实习白帽子  |\t\t\t        Rank:36 漏洞数:10        | 没事瞎搞。)\t\t \n  cctv拍这里。。我要上电视了。感谢我的家人，感谢cctv。感谢祖国。感谢中华人民共和国让我有一次露脸的机会。。    \n     2015-05-28 23:16 |    \t\tchord \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:3        | 纯属路过的)\t\t \n  拍这里..我才是路过的    \n     2015-05-29 08:37 |    \t\ttony \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | null)\t\t \n  mark    \n     2015-05-29 09:30 |    \t\t啤酒 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 道不同.喝酒结盟)\t\t \n  携程在手,说gou就gou    \n     2015-05-29 14:33 |    \t\t0749orz \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:4        | 厌了，烦了~~~)\t\t \n  哈哈~~    \n     2015-05-29 14:38 |    \t\t黑暗游侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:1780 漏洞数:268        | 123)\t\t \n  @苏州同程旅游网络科技有限公司  顺便提醒下你们的17u.com，和此漏洞问题一样，不提交了    \n     2015-05-29 15:55 |    \t\tfuzzzz \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | Into a soul absolutely free.)\t\t \n  v587    \n     2015-07-03 15:06 |    \t\thack0ne \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:2        | keep going)\t\t \n  66666666666    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}