{"id": 51933, "wybug_id": "wooyun-2014-072914", "wybug_title": "安徽某地cms任意文件上传，多地gov沦陷，已被黑产利用", "wybug_corp": "www.ahxwkj.com", "wybug_author": "路人甲", "wybug_date": "2014-08-19 12:57", "wybug_open_date": "2014-11-17 12:58", "wybug_type": "地下0day/成功的入侵事件", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "应用程序后门"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-26：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-11-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-17：\t细节向公众公开  简要描述： 任意文件上传。多地gov沦陷了。貌似被黑产玩完了 详细说明：  无意看到的一个站。弱口令进了后台。随便看一下。找到了一个上传页面。没有过滤。。可以上传任意文件。。http://www.chlyj.gov.cn/MANAGE/uploadify/demo.asp拿到了shell。\n\n这是一个cms看看是不是通用漏洞吧。。找了一个关键字百度一看 其他网站还真有这个漏洞。但是文件命名方式有点蛋疼，如果不进后台看不到返回的文件名，即使上传了shell也不能访问。。\npublic sub SaveOne(path, num, byref outFileName, byref outLocalFileName)      Dim streamFile, fileItems, fileItem, fs        set fs = Server.CreateObject(\"Scripting.FileSystemObject\")      if Right(path, 1) <> \"\\\" then path = path & \"\\\"      if not uploadedYet then Upload      if UploadedFiles.Count > 0 then         fileItems = UploadedFiles.Items         set fileItem = fileItems(num)               outFileName = fileItem.FileName         outLocalFileName = GetFileName(path, outFileName)\n看了一下代码 不知道对不对，小菜在学php。不太懂asp。反正就是大概根据这段代码连猜带蒙找到了命名规则。。命名方式：上传时间+num  这个num貌似是固定的7349（问我怎么知道的。多上传文件几个看出来的，哈哈）上传页面有了，也找到文件名了 试试其他网站吧http://www.chsajj.gov.cn/MANAGE\\IMAGE\\201407181845567349.ASPhttp://www.chlyj.gov.cn/\\MANAGE\\IMAGE\\201407181845047349.ASPhttp://www.chsjw.gov.cn/\\MANAGE\\IMAGE\\201407181844007349.ASPhttp://www.hfwxd.gov.cn/\\MANAGE\\IMAGE\\201407181840547349.ASPhttp://hdz.ww.gov.cn/manage/image/201407181837327349.ASP   漏洞证明：  无意看到的一个站。弱口令进了后台。随便看一下。找到了一个上传页面。没有过滤。。可以上传任意文件。。http://www.chlyj.gov.cn/MANAGE/uploadify/demo.asp拿到了shell。\n\n这是一个cms看看是不是通用漏洞吧。。找了一个关键字百度一看 其他网站还真有这个漏洞。但是文件命名方式有点蛋疼，如果不进后台看不到返回的文件名，即使上传了shell也不能访问。。\npublic sub SaveOne(path, num, byref outFileName, byref outLocalFileName)      Dim streamFile, fileItems, fileItem, fs        set fs = Server.CreateObject(\"Scripting.FileSystemObject\")      if Right(path, 1) <> \"\\\" then path = path & \"\\\"      if not uploadedYet then Upload      if UploadedFiles.Count > 0 then         fileItems = UploadedFiles.Items         set fileItem = fileItems(num)               outFileName = fileItem.FileName         outLocalFileName = GetFileName(path, outFileName)\n看了一下代码 不知道对不对，小菜在学php。不太懂asp。反正就是大概根据这段代码连猜带蒙找到了命名规则。。命名方式：上传时间+num  这个num貌似是固定的7349（问我怎么知道的。多上传文件几个看出来的，哈哈）上传页面有了，也找到文件名了 试试其他网站吧http://www.chsajj.gov.cn/MANAGE\\IMAGE\\201407181845567349.ASPhttp://www.chlyj.gov.cn/\\MANAGE\\IMAGE\\201407181845047349.ASPhttp://www.chsjw.gov.cn/\\MANAGE\\IMAGE\\201407181844007349.ASPhttp://www.hfwxd.gov.cn/\\MANAGE\\IMAGE\\201407181840547349.ASPhttp://hdz.ww.gov.cn/manage/image/201407181837327349.ASP   修复方案：  http://wooyun.org/bugs/wooyun-2014-067380/trace/2063df6caecfa56b47effc846b19fa46这个漏洞都好几个月了  怎么还没审核呢？？@疯狗 @xsser   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2014-08-23 23:36 厂商回复： CNVD确认并复现所述情况，已经转由CNCERT下发给安徽分中心，由其后续协调网站管理单位处置。按多个案例评分，rank 16 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-14 16:17 |    \t\t雏鹰 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 关注互联网的那些事、关注web安全、关注安...)\t\t \n  是ZCMS    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}