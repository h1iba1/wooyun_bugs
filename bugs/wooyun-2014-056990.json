{"id": 2943, "wybug_id": "wooyun-2014-056990", "wybug_title": "Dedecms全版本后台验证码逻辑漏洞可导致暴力破解", "wybug_corp": "Dedecms", "wybug_author": "zhq445078388", "wybug_date": "2014-04-14 11:07", "wybug_open_date": "2014-07-13 11:08", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-17：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向公众公开  简要描述： 后台验证码本应是防止暴力破解的屏障，但是织梦后台的验证码，只有当你输错验证码之后，才会给一个新的验证码，这就犯了一个最严重的逻辑漏洞 详细说明：  \n//登录检测$admindirs = explode('/',str_replace(\"\\\\\",'/',dirname(__FILE__)));$admindir = $admindirs[count($admindirs)-1];if($dopost=='login'){    $validate = empty($validate) ? '' : strtolower(trim($validate));    $svali = strtolower(GetCkVdValue());    if(($validate=='' || $validate != $svali) && preg_match(\"/6/\",$safe_gdopen)){        ResetVdValue();        ShowMsg('验证码不正确!','login.php',0,1000);        exit;    } else {        $cuserLogin = new userLogin($admindir);        if(!empty($userid) && !empty($pwd))        {            $res = $cuserLogin->checkUser($userid,$pwd);            //success            if($res==1)            {                $cuserLogin->keepUser();                if(!empty($gotopage))                {                    ShowMsg('成功登录，正在转向管理管理主页！',$gotopage);                    exit();                }                else                {                    ShowMsg('成功登录，正在转向管理管理主页！',\"index.php\");                    exit();                }            }            //error            else if($res==-1)            {\t\t\t\tShowMsg('你的用户名不存在!',-1,0,1000);\t\t\t\texit;            }            else            {                ShowMsg('你的密码错误!',-1,0,1000);\t\t\t\texit;            }        }        //password empty        else        {            ShowMsg('用户和密码没填写完整!',-1,0,1000);\t\t\texit;        }    }}\n这是后台login.php文件中的登录验证   漏洞证明：     修复方案：  在用户名或者密码不正确的时候 都执行 ResetVdValue(); 此函数   版权声明：转载请注明来源 zhq445078388@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2014-04-17 16:00 厂商回复： 感谢反馈，我们已经进行修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-14 11:10 |    \t\t卡卡 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:52        | <script>alert('安全团队长期招人')</scrip...)\t\t \n  这个验证码问题从低版本开始到现在一直都存在的啊~~~    \n     2014-04-14 11:12 |    \t\t酱油甲 \t\t\t( 普通白帽子  |\t\t\t        Rank:645 漏洞数:126        | 打个酱油，吃个海蜇~)\t\t \n  我一直以为这个洞被厂商默许了……    \n     2014-04-14 11:18 |    \t\t园长 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:14        | 你在身边就是缘，缘分写在数据库里面。)\t\t \n  这个问题一直都存在....    \n     2014-04-14 11:20 |    \t\t卡卡 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:52        | <script>alert('安全团队长期招人')</scrip...)\t\t \n  @酱油甲 f4ck？大家同处一门啊，呵呵~~    \n     2014-04-14 11:49 |    \t\tlkboboy \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 无所事事)\t\t \n  dede的验证码一直这样。。    \n     2014-04-14 16:19 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  关键是怎么找到后台呢    \n     2014-04-15 10:11 |    \t\tLeon \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 永无宁日啊)\t\t \n  好吧 我承认 这两年前就这样了。验证码就是固定的那几个。    \n     2014-04-15 11:29 |    \t\tzhq445078388 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:19        | 请牢记\"杀进程点康姆\")\t\t \n  现在找后台还是比较容易的    \n     2014-04-15 11:35 |    \t\tMorker \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:24        | 双手是最重要的、、、)\t\t \n  @zhq445078388 求方法    \n     2014-04-17 17:16 |    \t\tzhq445078388 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:19        | 请牢记\"杀进程点康姆\")\t\t \n  @Morker 卧槽我没发过这个啊? 怎么情况?@xsser    \n     2014-04-17 17:26 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @zhq445078388 啊？    \n     2014-04-17 17:29 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  ..................    \n     2014-04-17 17:36 |    \t\tzhq445078388 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:19        | 请牢记\"杀进程点康姆\")\t\t \n  @xsser 你这个啊是什么情况啊? 我没发过这个洞啊..咋跑我头上来了鸟..莫名飞来的荣誉么..    \n     2014-04-17 17:45 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @zhq445078388 装    \n     2014-04-17 17:47 |    \t\tzhq445078388 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:19        | 请牢记\"杀进程点康姆\")\t\t \n  @xsser 卧槽我真没发过..我不会搞这个啊...我这基本上只看客户端.    \n     2014-04-17 18:05 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @zhq445078388 兄弟 赶紧检查乌云币吧    \n     2014-04-21 12:14 |    \t\tzhq445078388 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:19        | 请牢记\"杀进程点康姆\")\t\t \n  @xsser 0.0我一次都没兑换过.按理说乌云币和rank是一样的吧?    \n     2014-04-21 12:16 |    \t\tzhq445078388 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:19        | 请牢记\"杀进程点康姆\")\t\t \n  @xsser 检查过了..兑换了一次100QB? 然后转账给exploits了.都不是我操作的..应该和上次密码重置邮件然后密码被改有关系吧..    \n     2014-04-30 16:06 |    \t\tt-ara \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:2        | t-ara)\t\t \n  @zhq445078388     兄弟  求方法    \n     2014-04-30 20:30 |    \t\t五色花 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | jvav)\t\t \n  关注下！！    \n     2014-07-13 12:01 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n  哎...    终于找到为啥了   你的一句话  让我做的一个暴力破解织梦密码的脚本成了摆设了.     \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}