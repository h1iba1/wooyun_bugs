{"id": 71190, "wybug_id": "wooyun-2015-0144098", "wybug_title": "深圳公交卡系统一日游", "wybug_corp": "shenzhentong.com", "wybug_author": "路人甲", "wybug_date": "2015-09-29 17:20", "wybug_open_date": "2015-11-22 10:20", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(广东省信息安全测评中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传漏洞", "补丁不及时"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-22：\t细节向公众公开  简要描述： 从web到内网，威胁内网安全和用户数据。 详细说明：  **.**.**.**进入官网首页，点公交卡余额查询跳转到http://**.**.**.**:8080/sztnet/qryCard.do  这是我们的切入点2.http://**.**.**.**:8080/mbapp/upload.jsp  文件上传点，没有回显文件路径怎么办http://**.**.**.**:8080/mbapp/file.jsp \n\nshell路径来了shell地址\nhttp://**.**.**.**:8080/mbapp/upload/1_1443170412936_0.jsp    cmd\n3.数据库配置文件\n<transactionManager type=\"JDBC\">\t\t<dataSource type=\"SIMPLE\">\t\t\t<property name=\"JDBC.Driver\" value=\"oracle.jdbc.driver.OracleDriver\" />\t\t\t<property name=\"JDBC.ConnectionURL\" value=\"jdbc:oracle:thin:@**.**.**.**:1521:sztweb\" />\t\t\t<!-- <property name=\"JDBC.ConnectionURL\" value=\"jdbc:oracle:thin:@**.**.**.**:1521:orcl\" />  -->\t\t\t<property name=\"JDBC.Username\" value=\"sztweb\" />\t\t\t<property name=\"JDBC.Password\" value=\"szt88web\" />\t\t\t<property name=\"Pool.MaximumActiveConnections\" value=\"30\" />\t\t\t<property name=\"Pool.MaximumIdleConnections\" value=\"10\" />\t\t\t<property name=\"Pool.MaximumCheckoutTime\" value=\"30000\" />\t\t\t<property name=\"Pool.TimeToWait\" value=\"500\" />\t\t\t<property name=\"Pool.PingQuery\" value=\"select 1 from sample\" />\t\t\t<property name=\"Pool.PingEnabled\" value=\"false\" />\t\t\t<property name=\"Pool.PingConnectionsOlderThan\" value=\"1\" />\t\t\t<property name=\"Pool.PingConnectionsNotUsedFor\" value=\"1\" />\t\t</dataSource>\t</transactionManager>\n4.海量数据可以看到用户每一次刷卡的记录，用户信息，公交，地铁相关信息等等\n\n\n\n\n\n5.反弹shell,提权linux内核2.6.18,直接上EXP提权成功\n\n\n\n\n\nroot弱密码，破解出来为root12346.危及内网安全，用自带nmap简单扫了一下\nInteresting ports on **.**.**.**:Not shown: 1673 closed portsPORT     STATE SERVICE       VERSION135/tcp  open  msrpc         Microsoft Windows RPC139/tcp  open  netbios-ssn445/tcp  open  netbios-ssn3389/tcp open  microsoft-rdp Microsoft Terminal Service5800/tcp open  vnc-http      RealVNC 4.0 (Resolution 400x250; VNC TCP port: 5900)5900/tcp open  vnc           VNC (protocol 3.8)8080/tcp open  http          Microsoft IIS webserver 7.0\n\nInteresting ports on **.**.**.**:Not shown: 1669 closed portsPORT     STATE    SERVICE     VERSION21/tcp   open     ftp         vsftpd 2.0.522/tcp   open     ssh         OpenSSH 4.3 (protocol 2.0)23/tcp   open     telnet      BSD-derived telnetd25/tcp   open     smtp        Cisco PIX sanatized smtpd111/tcp  open     rpc465/tcp  open     ssl/smtp    Exim smtpd 4.63587/tcp  open     smtp        Exim smtpd 4.631005/tcp open     rpc1720/tcp filtered H.323/Q.9312000/tcp filtered callbook5060/tcp filtered sip\n\nInteresting ports on **.**.**.**:Not shown: 1669 closed portsPORT     STATE    SERVICE     VERSION21/tcp   open     ftp         vsftpd 2.0.522/tcp   open     ssh         OpenSSH 4.3 (protocol 2.0)111/tcp  open     rpc139/tcp  open     netbios-ssn Samba smbd 3.X (workgroup: MYGROUP)445/tcp  open     netbios-ssn Samba smbd 3.X (workgroup: MYGROUP)672/tcp  open     rpc1720/tcp filtered H.323/Q.9312000/tcp filtered callbook3306/tcp open     mysql       MySQL 5.1.56-community5060/tcp filtered sip8007/tcp open     ajp12?\n\nInteresting ports on x3250-6 (**.**.**.**):Not shown: 1669 closed portsPORT     STATE SERVICE    VERSION21/tcp   open  ftp        vsftpd 2.0.522/tcp   open  ssh        OpenSSH 4.3 (protocol 2.0)25/tcp   open  smtp       Exim smtpd 4.63111/tcp  open  rpc465/tcp  open  ssl/smtp   Exim smtpd 4.63587/tcp  open  smtp       Exim smtpd602/tcp  open  rpc8000/tcp open  http-proxy nginx http proxy 1.5.48009/tcp open  ajp13?8080/tcp open  http       Apache Tomcat/Coyote JSP engine 1.19100/tcp open  jetdirect?\n\nInteresting ports on **.**.**.**:Not shown: 1665 closed portsPORT     STATE SERVICE      VERSION21/tcp   open  ftp          Microsoft ftpd80/tcp   open  http         Microsoft IIS webserver 6.082/tcp   open  http         Microsoft IIS webserver 6.0135/tcp  open  msrpc        Microsoft Windows RPC139/tcp  open  netbios-ssn445/tcp  open  microsoft-ds Microsoft Windows 2003 microsoft-ds1026/tcp open  msrpc        Microsoft Windows RPC1027/tcp open  msrpc        Microsoft Windows RPC1433/tcp open  ms-sql-s?2013/tcp open  raid-am?5001/tcp open  apc-agent    APC PowerChute agent5800/tcp open  vnc-http     RealVNC 4.0 (Resolution 400x250; VNC TCP port: 5900)5900/tcp open  vnc          VNC (protocol 3.8)8009/tcp open  ajp13?8080/tcp open  http         Apache Tomcat/Coyote JSP engine 1.1\n\nInteresting ports on **.**.**.**:Not shown: 1673 closed portsPORT     STATE SERVICE          VERSION21/tcp   open  ftp              vsftpd 2.0.522/tcp   open  ssh              OpenSSH 4.3 (protocol 2.0)111/tcp  open  rpc139/tcp  open  netbios-ssn      Samba smbd 3.X (workgroup: MYGROUP)445/tcp  open  netbios-ssn      Samba smbd 3.X (workgroup: MYGROUP)677/tcp  open  rpc7000/tcp open  afs3-fileserver?\n\nInteresting ports on **.**.**.**:Not shown: 1674 closed portsPORT    STATE SERVICE     VERSION21/tcp  open  ftp         vsftpd 2.0.522/tcp  open  ssh         OpenSSH 4.3 (protocol 2.0)111/tcp open  rpc139/tcp open  netbios-ssn Samba smbd 3.X (workgroup: MYGROUP)445/tcp open  netbios-ssn Samba smbd 3.X (workgroup: MYGROUP)783/tcp open  rpc\n7.用root1234这个密码直接ssh到了**.**.**.**这台机器\n\n\n\n到了10.1.2.*段了8.已经到了核心业务段了，内网服务基本一览无余了，点到为止，就没有深入搞了。   漏洞证明：  1.\n\n2.\n\n   修复方案：  1.删除不必要的上传组件，或者过滤上传2.升级内网机器内核3.禁止服务器弱口令4.完善防火墙策略5.未做任何修改，未动任何数据。紧作为一次测试。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2015-10-08 10:18 厂商回复： 非常感谢您的报告。报告中的问题已确认并复现.影响的数据：高攻击成本：低造成影响：高综合评级为：高，rank：18正在联系相关网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-09-29 17:31 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:567 漏洞数:108        | 低调求发展)\t\t \n  强势围观    \n     2015-09-29 20:38 |    \t\t第四维度 \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:39        | 唯有梦想与好姑娘不可辜负)\t\t \n  前排    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}