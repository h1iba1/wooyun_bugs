{"id": 16416, "wybug_id": "wooyun-2012-012683", "wybug_title": "百度开放平台oauth授权接口可以劫持access_token", "wybug_corp": "百度", "wybug_author": "心伤的胖子", "wybug_date": "2012-09-25 10:05", "wybug_open_date": "2012-11-09 10:06", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-09-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-09-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-10-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-10-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-10-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-11-09：\t细节向公众公开  简要描述： Oauth2.0相比较Oauth1.0步骤简化，通过HTTPS和限制回调地址来提高安全性。但是各互联网公司的业务在对Oauth2.0的实现上并没有完全按照Oauth2.0的标准来做。所以就会有一些问题存在。比如对回调地址限制不严格就会造成问题。 详细说明：  详细的步骤如下：1、结合 WooYun: 去哪儿一处存储型XSS漏洞 这个漏洞（应该审核通过了吧）2、百度账号可以登录qunar网站，通过百度账号连接服务3、授权模式中的Implicit grant模式只需要client_id和redirect_uri就可以完成账号的授权流程，从而把获取到的access_token返回到redirect_uri页面中4、构造如下的URL：http://openapi.baidu.com/oauth/2.0/authorize?scope=super_msg&response_type=token&client_id=RCKbWANx8KewnXs9rwGWFtZV&redirect_uri=http://lvtu.qunar.com/mobile_ugc/web/album.htm?albumId=4228client_id为qunar网的百度应用IDredirect_uri为获取access_token后的回调地址response_type=token是采用Implicit grant授权模式scope为申请的权限5、可以把该地址发给他人诱使别人连接，最方便的利用是结合点击劫持来让用户完成授权流程。从而劫持到用户的access_token6、获取到的token可以利用api接口来操作该账号（百度的api少的可怜）。   漏洞证明：  下面图是劫持后的。\n\n   修复方案：  1、最好是严格限制redirect_uri，我知道很难。2、可以在授权页面加入放点击劫持代码，降低风险   版权声明：转载请注明来源 心伤的胖子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2012-09-25 13:20 厂商回复： 感谢你对百度安全的关注，我们马上安排处理。 最新状态： 2012-11-09：该漏洞已于2012-10-12修复上线。  ", "replys": "漏洞评价：\n评论\n     2012-09-25 10:16 |    \t\t心伤的胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:308 漏洞数:29        | 因为心伤，所以胖子。)\t\t \n  貌似中间一些细节没有写太清楚！    \n     2012-09-25 10:57 |    \t\txcl0ud \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        )\t\t \n  赞思路！已经说清楚了！    \n     2012-09-25 11:09 |    \t\t心伤的胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:308 漏洞数:29        | 因为心伤，所以胖子。)\t\t \n  @xcl0ud 楼上能看到？？？？？？ 谁的马甲！    \n     2012-09-25 12:43 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  @心伤的胖子 估计是百度那边的人吧～～    \n     2012-09-25 12:59 |    \t\t心伤的胖子 \t\t\t( 普通白帽子  |\t\t\t        Rank:308 漏洞数:29        | 因为心伤，所以胖子。)\t\t \n  @gainover 哈哈 想到了！    \n     2012-11-10 12:55 |    \t\t陈再胜 \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:13        | 微博收收听~~~●﹏●)\t\t \n  你真的不是黑哥么？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}