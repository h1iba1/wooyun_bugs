{"id": 85531, "wybug_id": "wooyun-2016-0172033", "wybug_title": "网站安全狗WebShell上传拦截Bypass", "wybug_corp": "安全狗", "wybug_author": "RedFree", "wybug_date": "2016-01-22 22:15", "wybug_open_date": "2016-03-08 21:29", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "9", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计不当", "设计缺陷", "安全狗"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-22：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-02-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-03-08：\t细节向公众公开  简要描述： 网站安全狗又一发绕过WebShell上传拦截的姿势 详细说明：  测试环境Windows2003+IIS6+ASP。安全狗版本：\n\n上传asp文件被拦截：\n\n一个典型的上传包如下（主要部分）：\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryWyGa1hk6vT9BZGRr  //头部\n\n------WebKitFormBoundaryWyGa1hk6vT9BZGRrContent-Disposition: form-data; name=\"FileUploadPath\"C:\\Inetpub\\wwwroot------WebKitFormBoundaryWyGa1hk6vT9BZGRrContent-Disposition: form-data; name=\"FileUploadName\"; filename=\"test.asp\"Content-Type: application/octet-stream<%response.write(\"bypass safedog test!\")%>------WebKitFormBoundaryWyGa1hk6vT9BZGRr--\n------WebKitFormBoundaryWyGa1hk6vT9BZGRr从POST数据开始到结束------WebKitFormBoundaryWyGa1hk6vT9BZGRr--推测安全狗是通过匹配multipart/form-data; boundary=----WebKitFormBoundaryWyGa1hk6vT9BZGRr来解析一个上传包中的各个参数的，那么可能发生在安全狗和Web Server之间的差异是什么呢？尝试如下请求：\n\n在头部的WebKitFormBoundaryWyGa1hk6vT9BZGRr随便加上字符，便可成功上传。\n\n同理，保持头部的WebKitFormBoundary...不变，更改（减去最后一个字符或增加几个字符）POST参数中的WebKitFormBoundary...一样可以绕过上传拦截。\n\n\n\n\n\n   漏洞证明：  \n\n\n\n\n\n   修复方案：  Web Server容错性好，能处理的异常请求也比较多，在检测数据包时不能只按正常的格式去解析，还应考虑那些不正常的格式。   版权声明：转载请注明来源 RedFree@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2016-01-25 10:00 厂商回复： 感谢老师。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-22 22:17 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:1664 漏洞数:249        | WooYun is the Bigest gay place.  网络工...)\t\t \n  前排抢沙发！    \n     2016-01-22 22:44 |    \t\thecate \t\t\t( 普通白帽子  |\t\t\t        Rank:768 漏洞数:119        | ®高级安全工程师 | WooYun认证√)\t\t \n  红老湿    \n     2016-01-23 00:02 |    \t\t诚殷的小白帽 \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:26        )\t\t \n  这尼玛都能首页？我也是醉的不要不要的    \n     2016-01-23 00:27 |    \t\t岛云首席鉴黄师 \t\t\t( 普通白帽子  |\t\t\t        Rank:460 漏洞数:125        | icisaw.cn 超低价虚拟主机VPS 购买返现 支...)\t\t \n  红老师威武！！    \n     2016-01-23 02:12 |    \t\t李旭敏 \t\t\t( 普通白帽子  |\t\t\t        Rank:702 漏洞数:99        | ฏ๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎...)\t\t \n  据说红老师有1000种绕过的方式。。。    \n     2016-01-23 09:50 |    \t\thkcs \t\t\t( 实习白帽子  |\t\t\t        Rank:56 漏洞数:9        | 只是路过)\t\t \n  绕狗绕狗，天天绕狗，真过瘾    \n     2016-01-23 11:14 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:303 漏洞数:54        | little red pig!)\t\t \n  据说红老师有一种方法可以绕过1000种waf    \n     2016-01-23 11:18 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:532 漏洞数:79        | 潜心学习~~~)\t\t \n  红师傅为安全狗的新品销售做出了卓越的贡献    \n     2016-01-23 11:27 |    \t\tShAdow丶 \t\t\t( 实习白帽子  |\t\t\t        Rank:84 漏洞数:14        | i am a fans of kimYeWon.)\t\t \n  据说红老师有一种方法可以绕过1000种waf    \n     2016-01-23 14:08 |    \t\tling \t\t\t( 实习白帽子  |\t\t\t        Rank:80 漏洞数:36        | 我是屌丝、我为自己代言 。)\t\t \n  1    \n     2016-01-23 15:08 |    \t\tHax0rs \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:4        | Hax0rs)\t\t \n  专注安全狗300年?    \n     2016-01-25 10:10 |    \t\t安全狗(乌云厂商)\t\t \n  @诚殷的小白帽 你来试一试？    \n     2016-01-25 21:13 |    \t\t诚殷的小白帽 \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:26        )\t\t \n  @安全狗 已经过狗 但是不准备发出来啊    \n     2016-01-26 08:54 |    \t\t安全狗(乌云厂商)\t\t \n  @诚殷的小白帽 我信了你的鞋    \n     2016-02-26 15:56 |    \t\t你大爷在此 百无禁忌 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:7        | 迎风尿三丈 顺风八十米)\t\t \n  又增加日站难度咯    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}