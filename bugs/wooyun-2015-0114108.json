{"id": 31387, "wybug_id": "wooyun-2015-0114108", "wybug_title": "吉林市公安局交通管理支队网站（SQL注入、上传）", "wybug_corp": "公安部一所", "wybug_author": "路人甲", "wybug_date": "2015-05-14 16:17", "wybug_open_date": "2015-06-29 16:10", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(公安部一所)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-06-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-29：\t细节向公众公开  简要描述： 12年有人提交过，不过那个时候是php开发的，现在的是C#，所以不存在已经被报告。http://www.wooyun.org/bugs/wooyun-2010-010577 详细说明：  在对吉林市公安局交通管理支队网站进行SQL注入检测时发现两处SQL注入第一处：\nhttp://www.jlsjj.gov.cn/page/zdxx.aspx\n\n\n参数ctl00$content$cxdh第二处：\nhttp://www.jlsjj.gov.cn/page/ShowData.aspx?id=0&mc=%e6%94%af%e9%98%9f%e7%ae%80%e4%bb%8b&tableName=endna196ZGpq\n参数tableName需要对该参数进行base64编码再进行注入   漏洞证明：  注入结果\n\n登陆进入后台\nhttp://www.jlsjj.gov.cn/login.aspx\n\n\n上传，编辑或者发布图片新闻，利用FCK编辑器漏洞即可成功上传webshell地址\nhttp://www.jlsjj.gov.cn//UploadFile/ASPXspy2.aspx\n密码\nadmin\n\n\n通过逆向分析\nif (str3 != null)        {            if (!(str3 == \"jgcx_jdcyq\"))            {                if (str3 == \"jgcx_jdcbf\")                {                    view = DataAccess.CreateView(((\"select * from \" + str + \" where 1=1 \") + \" and hphm=\" + Fun.SQLField(\"吉\" + this.hphm.Text)) + \" order by id\");                    if (view.Count == 0)                    {                        return;                    }                    strArray = new string[] { \"gzlx\", \"syr\", \"hpzl\", \"hphm\", \"clxh\", \"bfqz\" };                    builder.Append(\"<td bgcolor='#f0f0f0' align='middle' nowrap width='80px'><font size='2'><strong>告知类型</strong></font></td>\");                    builder.Append(\"<td bgcolor='#f0f0f0' align='middle' nowrap><font size='2'><strong>所有人</strong></font></td>\");                    builder.Append(\"<td bgcolor='#f0f0f0' height='35' width='80px' align='middle' nowrap><font size='2'><strong>号牌种类</strong></font></td>\");                    builder.Append(\"<td bgcolor='#f0f0f0' width='80px' align='middle' nowrap><font size='2'><strong>车牌号码</strong></font></td>\");                    builder.Append(\"<td bgcolor='#f0f0f0' width='80px' align='middle' nowrap width='80px'><font size='2'><strong>车辆型号</strong></font></td>\");                    builder.Append(\"<td bgcolor='#f0f0f0' align='middle' nowrap width='80px'><font size='2'><strong>强制报废期止</strong></font></td>\");                }            }            else            {                view = DataAccess.CreateView(((\"select * from \" + str + \" where hpzl=\" + Fun.SQLField(this.CarType.SelectedItem.Text)) + \" and hphm=\" + Fun.SQLField(\"吉\" + this.hphm.Text)) + \" order by id\");                if (view.Count == 0)                {                    return;                }                builder.Append(\"<td bgcolor='#f0f0f0' align='middle' nowrap><font size='2'><strong>所有人</strong></font></td>\");                builder.Append(\"<td bgcolor='#f0f0f0' height='35' width='80px' align='middle' nowrap><font size='2'><strong>号牌种类</strong></font></td>\");                builder.Append(\"<td bgcolor='#f0f0f0' width='80px' align='middle' nowrap><font size='2'><strong>车牌号码</strong></font></td>\");                builder.Append(\"<td bgcolor='#f0f0f0' width='80px' align='middle' nowrap><font size='2'><strong>告知名称</strong></font></td>\");                builder.Append(\"<td bgcolor='#f0f0f0' align='middle' nowrap><font size='2'><strong>告知内容</strong></font></td>\");            }        }\n驾驶员和违章信息储存在表\njgcx_jdcyq和jgcx_jdcbf\n内但是经过对其进行数量查询时为0\n\n可能是还没有将数据进行导入，根据文件修改时间可以猜测，最近在对代码进行升级维护。如果不及时修复以上漏洞，待将来数据导入后极其容易被恶意攻击者窃取，望及时修复。   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-05-15 16:08 厂商回复： 感谢提交！！验证确认所描述的问题，已通知其修复。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}