{"id": 19735, "wybug_id": "wooyun-2012-06598", "wybug_title": "Dedecms 注射漏洞获得管理员密码", "wybug_corp": "Dedecms", "wybug_author": "c4rp3nt3r", "wybug_date": "2012-05-02 11:46", "wybug_open_date": "2012-06-16 11:47", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "语句注射", "注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-05-02：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2012-06-16：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： Dedecms 某文件没过滤直接带入sql查询,攻击者在magic_quotes_gpc=off时,可以注射SQL代码,绕过sqlids检测,执行sql语句. 详细说明：  要求会员中心,注册用户登录,magic_quotes_gpc=off,以及php版本要求,其实也没有什么危害.漏洞代码如下:\nroot@bt:/var/www/dede/member# cat -n edit_face.php    9 require_once(dirname(__FILE__).”/config.php”); //这里包含和谐的 ../include/filter.inc.php    10 CheckRank(0,0); //检查权限，至少要是通过认证的会员，什么注册不了会员？别着急我们有办法    11 $menutype = ‘config’;    12 if(!isset($dopost))    13 {    14 $dopost = ”;    15 }    16 if(!isset($backurl))    17 {    18 $backurl = ‘edit_face.php’;    19 }    20 if($dopost==’save’)    21 {    22 $maxlength = $cfg_max_face * 1024;    23 $userdir = $cfg_user_dir.’/’.$cfg_ml->M_ID;    24 if(!preg_match(“#^”.$userdir.”#”, $oldface)) //绕过这个正则表达式才能继续玩    25 {    26 $oldface = ”;    27 }    28 if(is_uploaded_file($face))    29 {    30 if(@filesize($_FILES['face']['tmp_name']) > $maxlength)    31 {    32 ShowMsg(“你上传的头像文件超过了系统限制大小：{$cfg_max_face} K！“, ‘-1′);    33 exit();    34 }    35 //删除旧图片（防止文件扩展名不同，如：原来的是gif，后来的是jpg）    36 if(preg_match(“#\\.(jpg|gif|png)$#i”, $oldface) && file_exists($cfg_basedir.$oldface))    37 {    38 @unlink($cfg_basedir.$oldface);    39 }    40 //上传新工图片    41 $face = MemberUploads(‘face’, $oldface, $cfg_ml->M_ID, ‘image’, ‘myface’, 180, 180);    42 }    43 else    44 {    45 $face = $oldface; // $oldface是我们能控制的变量    46 }    47 $query = “UPDATE `#@__member` SET `face` = ‘$face’ WHERE mid=’{$cfg_ml->M_ID}’ “; //这里导致注射漏洞    48 $dsql->ExecuteNoneQuery($query);    49 // 清除缓存    50 $cfg_ml->DelCache($cfg_ml->M_ID);    51 ShowMsg(‘成功更新头像信息！‘, $backurl);    52 exit();    53 }\n   漏洞证明：  \n\n   修复方案：  省略...   版权声明：转载请注明来源 c4rp3nt3r@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2012-05-02 12:18 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  暴走    \n     2012-05-02 12:55 |    \t\t子墨 \t\t\t( 普通白帽子  |\t\t\t        Rank:194 漏洞数:22        | 天地不仁,以万物为刍狗;圣人不仁,以百姓为...)\t\t \n  貌似是黑客防线那篇？    \n     2012-05-02 12:59 |    \t\tc4rp3nt3r \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:10        | 人生的意义就在于从一个圈子跳到另一个更大...)\t\t \n  @子墨 你说的对啊,本来想换2块钱稿费,结果5月了也不见发布,我就公布了.    \n     2012-05-02 13:04 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @c4rp3nt3r 如果乌云给稿费你愿意投递到乌云木    \n     2012-05-02 13:07 |    \t\tc4rp3nt3r \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:10        | 人生的意义就在于从一个圈子跳到另一个更大...)\t\t \n  @xsser 如果都不给稿费,我愿意投递到乌云    \n     2012-05-02 13:09 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @c4rp3nt3r 嗯 都努力撒 长久看 还是应该有价值回报的 否则不可持续 否则还真是我们都在学雷锋，你们都在学和珅了    \n     2012-05-02 13:24 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  @c4rp3nt3r @xsser 别呀，等我能找到有价值漏洞了 在给稿费呀 呵呵这个是影响dede所有版本？    \n     2012-05-02 13:31 |    \t\tc4rp3nt3r \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:10        | 人生的意义就在于从一个圈子跳到另一个更大...)\t\t \n  @possible 测试时候是最新版本,别的版本没当雷锋    \n     2012-06-08 20:15 |    \t\txiaoshi \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:2        )\t\t \n  公布啊！    \n     2012-07-26 15:40 |    \t\tZvall \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:14        | hello world)\t\t \n  未能联系到厂商或者厂商积极拒绝这什么情况？    \n     2012-07-26 15:43 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @Zvall 不屌你 就这个情况    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}