{"id": 3278, "wybug_id": "wooyun-2014-054906", "wybug_title": "建站之星 Sitestar 本地包含漏洞一枚", "wybug_corp": "建站之星", "wybug_author": "′雨。", "wybug_date": "2014-03-30 09:54", "wybug_open_date": "2014-06-28 09:55", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-03-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-03-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-05-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-06-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-28：\t细节向公众公开  简要描述： 过滤不严 包含漏洞。 虽然没有办法上传图片 但是还是有办法Getshell。 详细说明：  在module/mod_auth.php中。\npublic function auth_callback(){\t\t$this->_layout = NO_LAYOUT;\t\t$type=$_REQUEST['type'];\t\t$code=$_REQUEST['code'];\t\t$db=MysqlConnection::get();\t\t$db->query(\"SET sql_mode = ''\");\t\ttry{\t\t\t$className=$this->auth_lib($type);\t\t\tif(empty($className)) die('Failed!');\t\t\t$authclass=new $className();\ntype code可控。 无过滤。 然后进入auth_lib来看看 \npublic static function auth_lib($type){\t\t\t$dirname=P_LIB.'/auth/';\t\t\t$classname=$type.'_auth';\t\t\t\t\t\t$libfilename=$dirname.$classname.'.php';\t\t\t\t\t\tif(is_file($libfilename)){\t\t\t\trequire_once($dirname.\"oauth_class.php\");\t\t\t\trequire_once($libfilename);\t\t\t\treturn $classname;\t\t\t}\t\t}\n只要文件存在就包含 。  虽然会自动加上.php 但是是可以截断后面的.php的。截断后 就可以来包含了。  \n\n这里 包含根目录下的robots.txt成功。 但是怎么来getshell呢?我找了找 没有找到能上传图片的地方。   只有另外看其他的了。看了会码 看到个这个。 \npublic function dologout() {    \t //日志写入\t\t$reg_time = date(\"Y-m-d H:i:s\",time());\t\t$url = $_SERVER[SERVER_NAME].$_SERVER[REQUEST_URI];\t\t$lastlog_time = date(\"Y-m-d H:i:s\",SessionHolder::get('user/lastlog_time'));\t\t$lastlog_ip = SessionHolder::get('user/lastlog_ip');\t\t$user = SessionHolder::get('user/login');\t\t$file = '#log#.log';$str = <<<LOGSTR注册时间:$lastlog_time\\r\\n注册IP:$lastlog_ip\\r\\n操作时间:$reg_time\\r\\n操作类型:退出\\r\\n用户源IP地址:$_SERVER[REMOTE_ADDR]\\r\\n用户源端口号:$_SERVER[REMOTE_PORT]\\r\\n用户名:$user\\r\\nURL:$url\\r\\nURL:$url\\r\\n======================================================   \\r\\nLOGSTR;\t\tParamParser::writeFile($file,$str);        SessionHolder::destroy();        // TODO: We need a logged out page and countdown redirecting to index.php//        Content::redirect(Html::uriquery('mod_auth', 'loginform'));        Content::redirect(Html::uriquery('frontpage', 'index'));    }\n可以看到 这里 写了一个Log.txt  看看有没有可控的。\n注册时间:$lastlog_time\\r\\n注册IP:$lastlog_ip\\r\\n操作时间:$reg_time\\r\\n操作类型:退出\\r\\n用户源IP地址:$_SERVER[REMOTE_ADDR]\\r\\n用户源端口号:$_SERVER[REMOTE_PORT]\\r\\n用户名:$user\\r\\nURL:$url\\r\\nURL:$url\\r\\n\n看这里 至少我们用户名是可以控制的。 然后我们就来注册一个phpinfo的用户\n\n注册成功 看看log 有没有成功写入。\n\n成功写入码。然后直接包含这个。 可Getshell。   漏洞证明：  \n\n成功Getshell。   修复方案：  过滤。   版权声明：转载请注明来源 ′雨。@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2014-03-31 10:01 厂商回复： 处理中，感谢 最新状态： 2014-04-03：补丁已经发布，请去官网更新补丁或下载最新安装包，谢谢。  ", "replys": "漏洞评价：\n评论\n     2014-06-28 10:10 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  赞    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}