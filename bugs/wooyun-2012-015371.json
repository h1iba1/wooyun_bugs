{"id": 15970, "wybug_id": "wooyun-2012-015371", "wybug_title": "躺在床上读代码之 phpwind后台SQL注射", "wybug_corp": "phpwind", "wybug_author": "快点啊！！", "wybug_date": "2012-11-28 14:50", "wybug_open_date": "2012-12-03 14:50", "wybug_type": "SQL注射漏洞", "wybug_level": "低", "wybug_rank_0": "3", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-11-28：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-12-03：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 这个漏洞是一个后台注射，影响不大，本身我是不想发的，漏洞本身可能造成影响不大，但是整个漏洞分析的过程应该在自己还有兴趣的时候记录下来，因为以后我会知道当时还有兴趣分析了它。PHPWIND是我一直以来觉得为了实现安全无所不用其极的一款产品，我是喜欢这样小聪明解决问题的产品的。该产品使用checkVar函数全局将GP（GET,POST）中的.. ) < = 都替换成了HTML实体，所以即使你找到了一个SQL注射，你也会被限制在不允许使用函数及子查询中，即使你找到了一个代码执行漏洞，也被限制在函数和php标签的开始中。以上这一段也是为什么我还是写了这个漏洞的原因之一，我觉得一个产品做的这样的事情应当被人所知。 详细说明：  首先，我找到了一个函数。deleteMessagesByMessageIds在lib/message/db/ms_messagesdb.class.php中\nfunction deleteMessagesByMessageIds($messageIds){\t\t$messageIds = is_array($messageIds) ? S::sqlImplode($messageIds) : $messageIds;\t\t$query = $this->_db->query ( \"DELETE FROM \" . $this->_tableName. \" WHERE mid in (\".$messageIds.\") \" );\t\treturn $this->_db->affected_rows ();\t}\n所以我知道如果没有什么东西限制messageIds必须是数组的话，它如果是一个字符串的话，将会导致SQL注射，而接下来我就需要找到到底在哪里它不被要求是一个数组。然后我找到了manageMessageWithMessageIds函数，在lib/message/message/search.ms.php。接下来我就发现它在后台被调用了。在admin/superdel.php中\nS::gp(array('delid'),'P');empty($delid) && adminmsg(\"请选择要删除的消息\");$messageServer->manageMessageWithMessageIds($delid);adminmsg('operate_success',\"$url\");\n前面我提到了checkVar，对做这个事情的人我发自内心的钦佩。之所以在这里我们能注入是因为这个函数对后台放了一马。\nfunction checkVar(&$var) {\t\tif (is_array($var)) {\t\t\tforeach ($var as $key => $value) {\t\t\t\tS::checkVar($var[$key]);\t\t\t}\t\t} elseif (P_W != 'admincp') {\t\t\t$var = str_replace(array('..',')','<','='), array('&#46;&#46;','&#41;','&#60;','&#61;'), $var);\t\t} elseif (str_replace(array('<iframe','<meta','<script'), '', $var) != $var) {\t\t\tglobal $basename;\t\t\t$basename = 'javascript:history.go(-1);';\t\t\tadminmsg('word_error');\t\t}\t}\n中的\n} elseif (P_W != 'admincp') {\n   漏洞证明：  \n\n   修复方案：  S::gp(array('delid'),'P',2);: )   版权声明：转载请注明来源 快点啊！！@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2012-12-03 14:50 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-11-28 16:00 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  V5了!    \n     2012-11-28 16:31 |    \t\t╰ァBy﹎刑天 \t\t\t( 实习白帽子  |\t\t\t        Rank:54 漏洞数:21        | http://t.qq.com/mybudui)\t\t \n  躺在床上读代码我看你是躺也中枪    \n     2012-11-28 16:53 |    \t\tc4rp3nt3r \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:10        | 人生的意义就在于从一个圈子跳到另一个更大...)\t\t \n  躺床上用什么代码呢? pad ? 手机 ?    \n     2012-11-28 17:07 |    \t\tc4bbage \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:7        | var_dump($me);)\t\t \n  @c4rp3nt3r 目测，应该是专门买了个躺椅，之后前方弄了一个桌板。比如 鲜血时的 献血椅。（楼主如有雷同 莫怪，只是YY）    \n     2012-11-28 17:22 |    \t\t快点啊！！ \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 开源产品在走下坡路，能干点啥就干点啥吧。)\t\t \n  名字是纪念以前的一个前辈啊，当时他是打印了代码躺在床上看，现在我是没地方就蜷在沙发上。    \n     2012-11-29 10:25 |    \t\tc4rp3nt3r \t\t\t( 实习白帽子  |\t\t\t        Rank:70 漏洞数:10        | 人生的意义就在于从一个圈子跳到另一个更大...)\t\t \n  @c4bbage 觉得比较奇怪啊,要速度快的话得搜索啊,要手工打字吧.要是挨着一个个文件的看还可以.本屌丝手机屏幕小,没法看.    \n     2012-11-29 22:53 |    \t\t快点啊！！ \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:4        | 开源产品在走下坡路，能干点啥就干点啥吧。)\t\t \n  我本将心向明月，奈何明月照沟渠啊，两天了，确认一下漏洞会屎吗？    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}