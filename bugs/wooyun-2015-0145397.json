{"id": 71257, "wybug_id": "wooyun-2015-0145397", "wybug_title": "腾讯企业邮箱通用跨站漏洞（需目标站xss配合）", "wybug_corp": "腾讯", "wybug_author": "Sogili", "wybug_date": "2015-10-08 19:16", "wybug_open_date": "2015-11-23 19:48", "wybug_type": "xss跨站脚本攻击", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型", "利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-11-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-11-23：\t细节向公众公开  简要描述： 由于开发人员问题疏忽导致目标的任意子站的 XSS 都可以被用来攻击企业邮箱。 详细说明：  企业邮的这个页面 /zh_CN/htmledition/domain0ef52a.html 可以被用来做 XSS域跳板，每个腾讯企业邮都存在这个页面。只要是以 mail.主站.xxx 这种形式的都可以通过目标任意一个子站的 XSS 攻击的邮箱。   漏洞证明：  \n<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"/><script>(function(){\tvar _sDomain = location.search.split(\"?\").pop().split(\"&\").shift();\twindow.onerror = function(){return true;};\t_sDomain && (document.domain = decodeURIComponent(_sDomain));})();</script><script>var goBody = [];(function(){\tif(!parent.getTop)\t{\t\treturn;\t}\tvar _oFrameElm = window.frameElement,\t\t_oHeader = [decodeURIComponent(_oFrameElm.getAttribute(\"_header\") || \"\")],\t\t_sBody = decodeURIComponent(_oFrameElm.getAttribute(\"_body\") || \"\"),\t\t_oFiles = decodeURIComponent(_oFrameElm.getAttribute(\"_file\") || \"\").split(\"|\"),\t\t_oFileInfo, _sFileType, _sFile;\t_sBody.indexOf(\"<body\") == -1 ? goBody.push('<body class=\"domain\">', _sBody, '</body>') : goBody.push(_sBody);\tfor (var i = _oFiles.length - 1; i >= 0; i--)\t{\t\t_oFileInfo = _oFiles[i].split(\":\");\t\t_sFileType = _oFileInfo.shift();\t\t_sFile = _oFileInfo.join(\":\");\t\tswitch(_sFileType)\t\t{\t\tcase \"js\":\t\tcase \"html\":\t\tcase \"img\":\t\t\tif (_sFileType == \"img\" || \t\t\t\tnavigator.userAgent.toLowerCase().indexOf(\"webkit\") != -1)\t\t\t{\t\t\t\tgoBody.push('<img src=\"', _sFile, '\"/>');\t\t\t\tbreak;\t\t\t}\t\t\tif (!','.split(/,/).length) //ie\t\t\t{\t\t\t\t_oHeader.push('<script src=\"', _sFile, '\" ><\\/script>');\t\t\t\tbreak;\t\t\t}\t\tcase \"css\":\t\t\t_oHeader.push('<link rel=\"stylesheet\" type=\"text/css\" href=\"', _sFile, '\" />');\t\t}\t}\tdocument.write(_oHeader.join(\"\"));})();</script></head><script>goBody && document.write(goBody.join(\"\"));</script></html>\nhttp://mail.javaweb.org/zh_CN/htmledition/domain0ef52a.html?javaweb.org打开控制台，输入 document.domain，可以看到 值为 javaweb.org，也就是说我们可以通过任意一个子域的 XSS 攻击企业邮箱。   修复方案：  1. 对于企业来说最好是不使用主站的域名做企业邮2. 对于腾讯来说没有什么好的办法，可以参考下QQ邮箱。   版权声明：转载请注明来源 Sogili@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2015-10-09 19:47 厂商回复： 非常感谢您的报告，问题已着手处理，感谢大家对腾讯业务安全的关注。如果您有任何疑问，欢迎反馈，我们会有专人跟进处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}