{"id": 52520, "wybug_id": "wooyun-2014-070978", "wybug_title": "ECSHOP后台注入", "wybug_corp": "ShopEx", "wybug_author": "Power", "wybug_date": "2014-08-11 16:46", "wybug_open_date": "2014-08-16 16:48", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-16：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 后台注入，但是要登录............. 详细说明：  upload/admin/agency.php 48行开始\nelseif ($_REQUEST['act'] == 'query'){    $agency_list = get_agencylist(); //跟踪这个函数    $smarty->assign('agency_list',  $agency_list['agency']);    $smarty->assign('filter',       $agency_list['filter']);    $smarty->assign('record_count', $agency_list['record_count']);    $smarty->assign('page_count',   $agency_list['page_count']);    /* 排序标记 */    $sort_flag  = sort_flag($agency_list['filter']);    $smarty->assign($sort_flag['tag'], $sort_flag['img']);    make_json_result($smarty->fetch('agency_list.htm'), '',        array('filter' => $agency_list['filter'], 'page_count' => $agency_list['page_count']));}\nget_agencylist()函数代码如下\nfunction get_agencylist(){    $result = get_filter();//当$result为false时才能够实现。    if ($result === false)    {        /* 初始化分页参数 */        $filter = array();        $filter['sort_by']    = empty($_REQUEST['sort_by']) ? 'agency_id' : trim($_REQUEST['sort_by']);//未过滤        $filter['sort_order'] = empty($_REQUEST['sort_order']) ? 'DESC' : trim($_REQUEST['sort_order']);//未过滤        /* 查询记录总数，计算分页数 */        $sql = \"SELECT COUNT(*) FROM \" . $GLOBALS['ecs']->table('agency');        $filter['record_count'] = $GLOBALS['db']->getOne($sql);        $filter = page_and_size($filter);        /* 查询记录 */        $sql = \"SELECT * FROM \" . $GLOBALS['ecs']->table('agency') . \" ORDER BY $filter[sort_by] $filter[sort_order]\";//代入查询。        set_filter($filter, $sql);    }    else    {        $sql    = $result['sql'];        $filter = $result['filter'];    }    $res = $GLOBALS['db']->selectLimit($sql, $filter['page_size'], $filter['start']);//带入查询函数    $arr = array();    while ($rows = $GLOBALS['db']->fetchRow($res))    {        $arr[] = $rows;    }    return array('agency' => $arr, 'filter' => $filter, 'page_count' => $filter['page_count'], 'record_count' => $filter['record_count']);}\nget_filter()代码如下//传参是为空所以返回false\nfunction get_filter($param_str = ''){    $filterfile = basename(PHP_SELF, '.php');    if ($param_str)    {        $filterfile .= $param_str;    }    if (isset($_GET['uselastfilter']) && isset($_COOKIE['ECSCP']['lastfilterfile'])        && $_COOKIE['ECSCP']['lastfilterfile'] == sprintf('%X', crc32($filterfile)))    {        return array(            'filter' => unserialize(urldecode($_COOKIE['ECSCP']['lastfilter'])),            'sql'    => base64_decode($_COOKIE['ECSCP']['lastfiltersql'])        );    }    else    {        return false;    }}\n   漏洞证明：  \n\n   修复方案：  ...............   版权声明：转载请注明来源 Power@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-08-16 16:48 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}