{"id": 14366, "wybug_id": "wooyun-2013-017294", "wybug_title": "我是如何绕过新浪微博防御继续刷粉丝的", "wybug_corp": "新浪微博", "wybug_author": "风萧萧", "wybug_date": "2013-01-14 12:41", "wybug_open_date": "2013-02-28 12:41", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏校验", "漏洞利用", "利用技巧", "类型应用", "利用", "防护策略绕过"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-01-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-01-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-02-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-02-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-02-28：\t细节向公众公开  简要描述： 1.本洞非标题党；2.首先参考上一漏洞http://wooyun.org/bugs/wooyun-2010-017271，分享了一个各大互联网厂商防范CSRF的通病；3.其实在这之前我就与金龙大锅提过新浪对于CSRF防范是存在问题的，但是那时无法提供有力的证据，今天正好一并发着这里了。 详细说明：  1.我这里会说2个case，从最严重的开始吧！2.出问题的站点是微博媒体，看这里：\nhttp://media.weibo.com/profile.php?uid=1807689562&ref=\n\n\n3.点击关注，抓包看发送的请求：是一个POST请求！我再次以为会没戏：\n\n4.参数uid是你要关注的对象，fromuid是你自己，其他的都不重要，可以忽略，当然fromuid也可以忽略，我再尝试将碰到的N个POST改成GET的失败后，终于成功了一次，偷懒的程序员啊！构造如下链接\nhttp://media.weibo.com/attention/aj_addfollow.php?uid=1981622273&fromuid=\nuid当然是乌云的官方微博了撒！5.直接访问，是不行的，验证了referer！向上一篇漏洞所说，将它放在微博域下面，我首先直接将它发表在微博首页，点击访问，也是不行，看来referer验证的够深啊！M00004应该是一个报错代号：\n\n6.幸好这个media.weibo.com是可以留言的，直接在这里发表留言吧！\n\n生成的短链接也截个图撒，如果能配上文艺范的文字，欺骗效果会更好：\n\n点击访问，由于此时的referer确实是media.weibo.com，那么我就能顺利的帮乌云刷粉丝了！\n\n   漏洞证明：  1.后面这个case和上面阐述的一样啦，大家可以略过了撒！2.微博又个频道叫着微刊：\nhttp://kan.weibo.com/\n在这里，微博用户可以主营一个刊物。其他用户如果喜欢可以订阅这个刊物，但是一旦订阅，就必须关注刊物的负责人！\n\n点击【订阅】，然后抓包，查看请求。擦，一个GET请求，订阅和关注刊主都是这一个链接做到的：\nhttp://kan.weibo.com/aj/subscribe?wid=3444217594949975&_t=0&__rnd=1358083222514\n3.上述链接参数wid应该是微刊的唯一标识，其他两个参数可以忽略，我直接访问GET请求，返回如下，服务器就知道了我要CSRF啊！\n\n4.于是我将这个链接直接发在了微博首页：\n\n生成的短链接如下：\n\n5.成功订阅刊物和关注刊主：\n\n\n\n   修复方案：  1.关键请求还是改成post比较好！2.关键请求还是加token比较好！3.礼物啊礼物！年底各种忙，还不忘给新浪找洞，要鼓励这种舍己为人的精神啊！   版权声明：转载请注明来源 风萧萧@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2013-01-14 14:43 厂商回复： 再次感谢风兄，稍后礼物奉上。已经安排人员进行处理了。  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-01-14 12:42 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  我信洞主    \n     2013-01-14 12:49 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  mark    \n     2013-01-14 12:52 |    \t\tcnhello \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 小菜一枚，学习中。。。)\t\t \n  mark    \n     2013-01-14 12:57 |    \t\tsuperwbd \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:6        | 一个不懂技术的黑客。。。)\t\t \n  mark    \n     2013-01-14 13:44 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  碉堡了，刷粉丝专业户啊！！！！    \n     2013-01-14 13:46 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  来几万粉丝吧。。    \n     2013-01-14 14:48 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  东主'来两斤粉丝    \n     2013-01-14 15:25 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @zeracker 好的，没问题，你是要刷新浪的还是腾讯的？    \n     2013-01-14 15:26 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @zzR 一斤粉丝是多少个啊？小王子    \n     2013-01-14 15:31 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @VIP @px1624 @px1624 @superwbd @小胖子 以上各位白帽子每人要多少粉丝啊？QQ联系我哦    \n     2013-01-14 15:36 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @风萧萧 到四位数 id就是小胖胖_要减肥    \n     2013-01-14 15:43 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @小胖胖要减肥 我帮你刷5为数吧！改天晚上一起出来吃个饭撒，先洗个澡啊！    \n     2013-01-14 15:51 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @风萧萧 你在魔都？我不贡献菊花的先说好    \n     2013-01-14 15:57 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @小胖胖要减肥 贡献嘴就可以了    \n     2013-01-14 15:59 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  @风萧萧 去死，手都不行，我没那么嗜好，你要搞基可以找@se55i0n 吧     \n     2013-01-14 16:00 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  @风萧萧 到四位数 id就是VIP_Wooyun    \n     2013-01-14 16:00 |    \t\t风萧萧  \t\t\t( 核心白帽子 |\t\t\t        Rank:1020 漏洞数:76        | 人这一辈子总要动真格的爱上什么人)\t\t \n  @小胖胖要减肥  哈哈哈哈    \n     2013-01-14 16:02 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @风萧萧 @小胖胖要减肥 欢迎来蓉城搞基...    \n     2013-01-14 18:20 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @风萧萧 吃饭洗澡我包了！！！！新浪ID   加加大号棉花糖  求上5位数！！！！    \n     2013-01-14 20:04 |    \t\t明.   \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:7        | ส็็็็็็็็็็็็็็็็็็็...)\t\t \n  唉 要是洞主肯卖这洞。 10W都有人要收。！    \n     2013-01-14 20:21 |    \t\t伪装 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:5        | soga)\t\t \n  White_shirt求粉丝@风萧萧感谢大神阿！！！！    \n     2013-01-14 22:38 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @风萧萧 敢问丰胸qq多少。偶的腾讯微博还行，有4k+，新浪微博貌似不到100、、、    \n     2013-01-17 15:21 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  @风萧萧 说，你是不是专门刷我了，我发现我被强加粉丝了...    \n     2013-01-17 15:32 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  （接上）打错，是被强加关注了    \n     2013-02-28 13:50 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  又见GET...    \n     2013-07-01 09:29 |    \t\tlhshaoren \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:7        | OM)\t\t \n  必须要get吗？post如何构造？    \n     2013-07-04 12:56 |    \t\t伪装 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:5        | soga)\t\t \n  来两斤粉丝好么    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}