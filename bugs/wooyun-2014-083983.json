{"id": 43052, "wybug_id": "wooyun-2014-083983", "wybug_title": "wecenter重定向漏洞导致可挟持微博用户", "wybug_corp": "anwsion.com", "wybug_author": "只发通用型", "wybug_date": "2014-11-27 21:11", "wybug_open_date": "2015-02-25 21:12", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-25：\t细节向公众公开  简要描述： 尽管新浪已经修复了OAuth的redirect_uri重定向漏洞,但是不怕神一样的对手 就怕...这个就是一个样列... 详细说明：  \n/app/account/main.php191行开始public function sync_login_action()\t{\t\tif (get_setting('ucenter_enabled') == 'Y')\t\t{\t\t\tif ($uc_uid = $this->model('ucenter')->is_uc_user($this->user_info['email']))\t\t\t{\t\t\t\t$sync_code = $this->model('ucenter')->sync_login($uc_uid);\t\t\t}\t\t}\t\t\t\tif ($_GET['url'])\t\t{\t\t\t$url = base64_decode($_GET['url']);\t\t}\t\tif ((strstr($url, '://') AND !strstr($url, get_setting('base_url'))) OR !$url)\t\t{\t\t\t$url = '/';\t\t}\t\tH::redirect_msg(AWS_APP::lang()->_t('欢迎回来: %s , 正在带您进入站点...', $this->user_info['user_name']) . $sync_code, $url);\t}\nif ((strstr($url, '://') AND !strstr($url, get_setting('base_url'))) OR !$url) 对base64之后的url进行了判断但是可以用 \"@\" 绕过判断。于是....\nEXP:http://127.0.0.1/?/account/sync_login/url-aHR0cDovLzEyNy4wLjAuMTp0ZXN0QHd3dy5iYWlkdS5jb20=\nbase64解开是http://127.0.0.1:test@www.baidu.com唔 chrome下是不提示直接跳转的 为了生动演示效果用了Firefox\n\n这样好像只是个普通的任意跳转 没有啥危害.但是配合起OAuth的redirect_uri就可以挟持微博绑定的帐号了.攻击者构造地址让受害者打开，攻击者再记录下REFERER就可以挟持weibo了\n\n   漏洞证明：  \n\n   修复方案：  过滤下@?   版权声明：转载请注明来源 只发通用型@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2014-11-28 00:25 厂商回复： 不严谨的过滤照成的，谢谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}