{"id": 2034, "wybug_id": "wooyun-2014-061197", "wybug_title": "大汉版通系统敏感信息泄露+SQL注入漏洞", "wybug_corp": "南京大汉网络有限公司", "wybug_author": "路人甲", "wybug_date": "2014-05-19 15:32", "wybug_open_date": "2014-08-17 15:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "注射漏洞利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向公众公开  简要描述： 大汉版通某系统存在比较严重的信息泄露另加两处SQL注入 详细说明：  该系统为：大汉信息公开系统(xxgk)#1 信息泄露漏洞文件路径\n/xxgk/setup/tools/getuserinfo.jsp\n网上的泄露案例如图所示\n\n#2 SQL注入漏洞文件如下\n/xxgk/short_message/que_recemsg.jsp/xxgk/workflow/statistics/que_apply_sta.jsp\n引起漏洞的部分代码（/xxgk/short_message/que_recemsg.jsp）\nstrQueKeyWords \t= Convert.getParameter(request, \"que_keywords\");\tstrQueKeyWords1 = Convert.getParameter(request, \"que_keywords1\");\tstrQueScope \t= Convert.getParameter(request, \"que_scope\");\tstrStartDate \t= Convert.getParameter(request, \"que_startdate\");\tstrEndDate \t\t= Convert.getParameter(request, \"que_enddate\");\t//高级检索的关键字优先\tstrQueKeyWords \t= (strQueKeyWords1.length() > 0) ? strQueKeyWords1\t\t\t: strQueKeyWords;\t//组织时间条件\tString strDateCond = \"\";\tif (!\"\".equals(strStartDate) && !\"\".equals(strEndDate)) {\t\tstrDateCond += \" AND a.dt_sendtime >= '\" + strStartDate \t\t+ \" 00:00:00' AND a.dt_sendtime <= '\" + strEndDate + \" 23:59:59'\";\t} else if (!\"\".equals(strStartDate) && \"\".equals(strEndDate)) {\t\tstrDateCond += \" AND a.dt_sendtime >= '\" + strStartDate + \" 00:00:00'\";\t} else if (\"\".equals(strStartDate) && !\"\".equals(strEndDate)) {\t\tstrDateCond += \" AND a.dt_sendtime <= '\" + strEndDate + \" 23:59:59'\";\t}\t\t// 查询条件部分\tStringBuffer sbWhere = new StringBuffer(128);\tstrTitle = \"短消息→收件箱\";\tsbWhere.append(\" a.vc_receiverid='\"+ id +\"'\");//这里get提交的loginid参数\tif(!\"\".equals(strQueKeyWords)) {\t\tString strQueKeyWords_ = strQueKeyWords.replaceAll(\"'\",\"''\");\t\tsbWhere.append(\" AND vc_msgtitle like '%\" + strQueKeyWords_ + \"%'\");\t}\n引起漏洞的部分代码（/xxgk/workflow/statistics/que_apply_sta.jsp）\n<%\t//自行判断权限\tString userid =  Convert.getParameter(request, \"userid\");\t\t//取得非子流程的流程定义\tModelEntity  en  = new ModelEntity();\ten.setB_child(0);\tBasicFlowBLF bf = new BasicFlowBLF();\tArrayList al = bf.getModel(en);\t/*获取表单提交变量*/\tString que_startdate = Convert.getParameter(request,\"starttime\");\tString que_enddate = Convert.getParameter(request,\"endtime\");\tString strModelname = Convert.getParameter(request,\"modelname\");\tString strModelname1 = Convert.getParameter(request,\"modelname1\");\tstrModelname = ( strModelname1.length() > 0 ) ? strModelname1 : strModelname;\t/*定义变量、取值*/\tString strTitle = \"按申请记录统计\" ;\tString startTime = \"\";\tString endTime = \"\";\tString modelName = \"\";\t/*查询条件*/\tStringBuffer sbWhere = new StringBuffer(128);\tsbWhere.append( \" 1=1 \");\tif(que_startdate.length()>0){\t\tstartTime = \" and dt_submittime >=  '\"\t+ que_startdate+\" 00:00:00'\";\t}    if(que_enddate.length()>0){    \tendTime =\" and dt_submittime <= '\"\t+ que_enddate+\" 23:59:59'\" ;    }    if(strModelname.length()>0){    \tmodelName = \" AND vc_flowcode = '\"+ strModelname +\"'\";    }    if(strModelname1.length()>0){    \tmodelName = \" AND vc_flowcode = '\"+ strModelname1 +\"'\";    //...}\n可以看出上述几个参数均没有经过过滤 就直接带入了SQL查询，造成了SQL注入#3 漏洞测试这里我们随机在互联网上选择案例，采用sqlmap直接测试，参数 modelname1案例SQL注入一：\nhttp://xxgk.weifang.gov.cn/xxgk/workflow//statistics/que_apply_sta.jsp?userid=0&modelname=1&modelname1=2\n成功后如图所示\n\n案例SQL注入二：\nhttp://xxgk.weifang.gov.cn/xxgk/short_message/que_recemsg.jsp?que_keywords=1&loginid=1&boxtype=1&que_keywords1=1&que_startdate=1&que_enddate=1\n成功后如图所示\n\n   漏洞证明：  #4 获取数据测试\n\n   修复方案：  过滤吧   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-05-19 17:32 厂商回复： 感谢关注 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}