{"id": 48331, "wybug_id": "wooyun-2014-083457", "wybug_title": "php设计缺陷导致绕过open_basedir列举目录#2", "wybug_corp": "PHP", "wybug_author": "phith0n", "wybug_date": "2014-11-16 10:13", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-21：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： @/fd 曾在这篇帖子里 http://zone.wooyun.org/content/11268 给出了一些绕过open_basedir的方法。方法总体来说有一些鸡肋性，看客官如何理解了。 根据PHP的尿性，这个洞肯定忽略了，之后我也会整理一些类似的方法，公布出来。 详细说明：  @/fd的代码里对于列目录有两个方法，一是利用DirectoryIterator类，二是利用realpath函数。前者很好用，我就不多说了。单说下后者，realpath函数在处理已存在的文件（目录）与不存在的文件（目录）时情况不同，如果文件已存在则会抛出错误:open_basedir restriction in effect. File(xxxxx) is not within the allowed path(s)，如果文件不存在则会返回false。 所以我们可以通过捕捉错误handle，来判断某文件是否存在。 我的第二个方法也类似。php中有个bindtextdomain函数，看看文档：\n\n为一个domain设置一个path，这个path就是一个文件名。这个函数，在$directory存在的时候返回$directory，不存在则返回false。测试代码：\n<?phpprintf('<b>open_basedir: %s</b><br />', ini_get('open_basedir'));$re = bindtextdomain('xxx', $_GET['dir']);var_dump($re);?>\n/etc/passwd存在，则返回它：\n\n/etc/hehe不存在，则返回false:\n\n所以同样，这个函数也能作为枚举目录的方式。   漏洞证明：  很不幸的是，这个函数似乎不支持windows，我在win下测试报错Call to undefined function bindtextdomain()……，而linux下似乎没有<>等好用的通配符？所以只能暴力枚举了。暴力枚举方法见@/fd的代码：http://zone.wooyun.org/content/11268   修复方案：  只要在open_basedir外，不管文件是否存在，都应该抛出相同错误。   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  漏洞Rank：15  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-16 10:34 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  php自己说open_basedir是一个失败的设计    \n     2014-11-16 12:11 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  @xsser PHP居然会说话！好NB啊！    \n     2014-11-16 12:45 |    \t\t′雨。 \t\t\t( 普通白帽子  |\t\t\t        Rank:1231 漏洞数:190        | Only Code Never Lie To Me.)\t\t \n  <?phpecho 'open_basedir是一个失败的设计 ';?>    \n     2014-11-16 13:07 |    \t\tphith0n  \t\t\t( 核心白帽子 |\t\t\t        Rank:656 漏洞数:107        | 一个想当文人的黑客~)\t\t \n  @xsser 确实比较拙计，源码里控制这块的代码没设计好    \n     2014-11-16 18:42 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  师傅别这样。    \n     2014-11-16 21:50 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @齐迹 以前报告那个mail函数说绕过open_basedir的问题就说他们不管这个了     \n     2014-11-21 12:22 |    \t\t真旅网集团(乌云厂商)\t\t \n  应该算是个漏洞，不过目前看利用价值确实不大。欢迎大家来挖我们漏洞，凭良心给rank, 还有礼物送哦~    \n     2014-11-21 12:24 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  @真旅网集团 真的嘛 一群白帽子已经在路上了    \n     2014-11-21 13:46 |    \t\t真旅网集团(乌云厂商)\t\t \n  @玉林嘎 可以去问来访过的白帽子哈，不过初期礼物额度可能比较小，小漏洞几百元购物卡，严重的几千元，后期会根据大家的意见做合理调整。    \n     2014-11-21 13:46 |    \t\t真旅网集团(乌云厂商)\t\t \n  扫我们新站www.tdxinfo.com吧，这个站只要发现漏洞礼物标准翻翻~    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}