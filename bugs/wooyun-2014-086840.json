{"id": 42072, "wybug_id": "wooyun-2014-086840", "wybug_title": "php云越权关注", "wybug_corp": "php云人才系统", "wybug_author": "Ader_duo", "wybug_date": "2014-12-12 15:42", "wybug_open_date": "2015-03-12 15:44", "wybug_type": "非授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-16：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-19：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-09：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-19：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-12：\t细节向公众公开  简要描述： 版本v3.1 9.23 1.关注，可以让招聘者关注你，或者求职者关注你2.关注问题。你发表问题可以让大家关注其中uid是注册的时候自增的值 详细说明：  1.代码位置  upload/model/ajax.class.php   function Atn_action()\nfunction Atn_action()\t{\t\t$id=(int)$_POST['id'];\t\tif((int)$_POST['id']>0){\t\t\tif($this->uid>0){\t\t\t\tif($_POST['id']==$this->uid){\t\t\t\t\techo 4;die;\t\t\t\t}\t\t\t\t$atninfo = $this->obj->DB_select_once(\"atn\",\"`uid`='\".$this->uid.\"' AND `sc_uid`='\".$id.\"'\");//查询是不是关注过了\t\t\t\t$user=$this->obj->DB_select_once(\"member\",\"`uid`='\".$id.\"'\",\"`usertype`\");//查询想关注别人的你的信息\t\t\t\tif($user['usertype']==\"1\")//确定求职者身份\t\t\t\t{\t\t\t\t\t$table=\"resume\";\t\t\t\t}elseif($user['usertype']==\"2\"){//招聘者身份\t\t\t\t\t$table=\"company\";\t\t\t\t}\t\t\t\t$comurl = $this->furl(array(\"url\"=>\"c:profile,id:\".$id));\t\t\t\t$row=$this->obj->DB_select_once(\"friend_info\",\"`uid`='\".$id.\"'\");\t\t\t\t$name = $row['nickname'];\t\t\t\tif(is_array($atninfo)&&!empty($atninfo))//判断关注过就会取消关注\t\t\t\t{\t\t\t\t\t：：\t\t\t\t}else{//否则关注\t\t\t\t\t：：\t\t\t\t}\t\t\t}else{\t\t\t\techo \"3\";die;\t\t\t}\n只需id,uid为大于0的值2.代码位置   upload/ask/model/index.class.phpfunction attention_action()\t{\t\t$this->is_login();//判断登录\t\t$is_set=$this->obj->DB_select_once(\"attention\",\"`uid`='\".$this->uid.\"' and `type`='\".(int)$_POST['type'].\"'\");\t\tif($_POST['type']=='1')\t\t{\t\t\t$info=$this->obj->DB_select_once(\"question\",\"`id`='\".(int)$_POST['id'].\"'\",\"`id`,`title`,`uid`\");\t\t\t$gourl= $this->aurl(array(\"url\"=>\"c:content,id:\".$info['id']));\t\t\t$content=\"关注了<a href=\\\"\".$gourl.\"\\\" target=\\\"_blank\\\">《\".$info['title'].\"》</a>。\";//关注别人\t\t\t$n_contemt=\"取消了对<a href=\\\"\".$gourl.\"\\\" target=\\\"_blank\\\">《\".$info['title'].\"》</a>的关注。\";//取消关注别人\t\t}else{\t\t\t$info=$this->obj->DB_select_once(\"q_class\",\"`id`='\".$_POST['id'].\"'\",\"`id`,`name`\");\t\t\t$gourl= $this->aurl(array(\"url\"=>\"c:getclass,id:\".$info['id']));\t\t\t$content=\"关注了<a href=\\\"\".$gourl.\"\\\" target=\\\"_blank\\\">\".$info['name'].\"</a>。\";//关注互联网\t\t\t$n_contemt=\"取消了<a href=\\\"\".$gourl.\"\\\" target=\\\"_blank\\\">\".$info['name'].\"</a>的关注。\";//取消关注互联网\t\t}看登录这里function  is_login()\t{\t\tif($this->uid==\"\"||$_COOKIE['username']=='')\t\t{\t\t\techo 'no_login';die;\t\t}\t}只判断是否为空只需有type=1或2，id、uid、username有值   漏洞证明：  1.登录查看此时33未关注11\n\n构造post包。Replay\n\n登录查看33关注了11\n\n再次发包33取消关注11\n\n2.1》type=1登录未关注问题\n\n构造包 发包\n\n已关注\n\n2》type=2\n\ntype=2 不登录发包\n\n查看\n\n   修复方案：  验证登录   版权声明：转载请注明来源 Ader_duo@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：5  确认时间：2014-12-16 17:26 厂商回复： 感谢您的提供，相关问题我们已经修复 近期会及时更新补丁！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 5, "Ranks": null}