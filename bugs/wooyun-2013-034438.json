{"id": 9307, "wybug_id": "wooyun-2013-034438", "wybug_title": "大数据HACK系列#4 百姓网论坛基础架构逻辑缺陷 (Discuz某设计缺陷的实战Fuzz篇)", "wybug_corp": "百姓网", "wybug_author": "猪猪侠", "wybug_date": "2013-08-15 15:57", "wybug_open_date": "2013-09-29 15:58", "wybug_type": "网络设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["逻辑错误", "设计缺陷"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-09-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-09-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-29：\t细节向公众公开  简要描述： 大数据HACK的前提是数据+信息收集，二次处理后利用规则进行自动化Fuzz；这是基于Discuz逻辑设计缺陷Fuzz的实战篇，闲来无聊，就以百姓网为研究基础案例，京东商城论坛客串。 详细说明：  #1 原理介绍Discuz为了实现其Web2.0的特性，设计了许多SNS应有特有的功能，比如查看用户信息：\nhttp://bbs.jd.com/home.php?mod=space&uid=1&do=profile\n当你点开上面的链接，你会发现什么？对，你通过UID捕捉到了对应用户的如下信息：管理组：管理员用户组：管理员\n\n暴漏了用户的管理组信息，是很大的一个威胁，后面会细谈到。再看如下链接：\nhttp://bbs.jd.com/forum.php?mod=viewthread&tid=25&extra=page%3D1\n\n\n在左边，测漏了对应用户的组别信息我们都知道，拥有一个Discuz论坛管理员权限的用户意味着你能间接控制WEB服务器，和WEB服务器所承载的业务数据。#2 继续利用既然上面谈到的链接，在默认安装Discuz论坛的基础下，未登录论坛就可以查看任意用户信息，那么也说明 搜索引擎 也能够爬到与之对应的信息。\nsite:bbs.jd.com inurl:profile 管理员\n\n\nhttp://bbs.jd.com/home-space-uid-4-do-profile-view-me.html\n\n通过介绍的原理，分析出对应的规则，再找出收集信息的方式，就能将所有论坛管理员的信息都获取下来了。#3 有了管理员用户名，还需要登录接口辅助Discuz很多默认的登录接口，都为我们Fuzz提供了便利# 前台\n\n# 后台http://bbs.jd.com/admin.php\n\n#4 通过以上原理，我们可以先获取一堆管理员用户名的列表，然后写一个HTTP FORM自动化POST的工具。(可能有很多人在这里会说验证码呀，安全提问等限制啊！但是大多数Discuz论坛默认都没用上这些东西的，我想这个比列在80%以上)Discuz这里的默认策略是，同一个IP尝试登陆同一个用户超过5次就会锁定15分钟后才能再次登陆。对应解决，我们都知道Discuz属于php应用层，获取IP的函数如下：\n$onlineip = '';if(getenv('HTTP_CLIENT_IP') && strcasecmp(getenv('HTTP_CLIENT_IP'), 'unknown')) {\t\t$onlineip = getenv('HTTP_CLIENT_IP');} elseif(getenv('HTTP_X_FORWARDED_FOR') && strcasecmp(getenv('HTTP_X_FORWARDED_FOR'), 'unknown')) {\t\t$onlineip = getenv('HTTP_X_FORWARDED_FOR');} elseif(getenv('REMOTE_ADDR') && strcasecmp(getenv('REMOTE_ADDR'), 'unknown')) {\t\t$onlineip = getenv('REMOTE_ADDR');} elseif(isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'], 'unknown')) {\t\t$onlineip = $_SERVER['REMOTE_ADDR'];}\t\treturn $onlineip;\n你只需要在客户端重写HTTP_X_FORWARDED_FOR，就能欺骗Discuz绕过IP限制了。#5 实战流程获取用户信息 --> 通过用户名信息检索自有的大数据资源 --> 生成字典 --> 自动化Fuzz -> 输出结果   漏洞证明：  #6 实战百姓网的结果\n\n#7 实战结果通过前台的登录接口，结合Fuzz的密码字典，成功得到管理员(百姓网合作)的密码为123456直接到达后台\n\n#8 搞到SHELl\nhttp://www.80vul.com/dzvul/sodb/18/sodb-2009-02.txt\n\n\n   修复方案：  # 管理入口更名或加IP限制# 登录接口加入验证码或重复次数暴力猜解限制   版权声明：转载请注明来源 猪猪侠@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2013-08-15 16:36 厂商回复： 一个半死不活的bbs果然还是被hack了。。。密码用123456的人真该tjjtds啊。。。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-08-15 16:02 |    \t\tMaster \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:10        )\t\t \n  猪猪侠 碉堡了！    \n     2013-08-15 16:05 |    \t\t菊花卫士 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 网站卫士是360旗下为网站提供有偿主动保护...)\t\t \n  大数据黑阔啊    \n     2013-08-15 16:07 |    \t\tHxai11 \t\t\t( 普通白帽子  |\t\t\t        Rank:1137 漏洞数:218        | 于是我们奋力向前游，逆流而上的小舟，不停...)\t\t \n  为了超级棒棒糖，不惜失去和菲菲相处的时间来挖洞，真是一个无情无义之人啊！    \n     2013-08-15 16:08 |    \t\tn0bele \t\t\t( 普通白帽子  |\t\t\t        Rank:220 漏洞数:45        | 无耻最寂寞)\t\t \n  前排学习fuzz    \n     2013-08-15 16:11 |    \t\t \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | 博客寻友链 http://imlonghao.com/)\t\t \n  ...........    \n     2013-08-15 16:20 |    \t\tdyun \t\t\t( 普通白帽子  |\t\t\t        Rank:102 漏洞数:15        | [code][/code])\t\t \n  fuzz...    \n     2013-08-15 16:25 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  又被雷劈了！    \n     2013-08-15 16:29 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @Hxai11 这都被你看出来了，佩服啊～菲菲公主最近对我意见可大了。    \n     2013-08-15 16:32 |    \t\t包子 \t\t\t( 实习白帽子  |\t\t\t        Rank:33 漏洞数:6        | 共同交流，共同进步)\t\t \n  日站->脱库子->用裤子日站->再脱库子..呵呵    \n     2013-08-15 16:37 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @包子 如此循环。    \n     2013-08-15 16:37 |    \t\t0x334 \t\t\t( 普通白帽子  |\t\t\t        Rank:171 漏洞数:35        | 漏洞无影响，已忽略～～～～～～～)\t\t \n  tjjdds，内涵了。    \n     2013-08-15 16:38 |    \t\t0x334 \t\t\t( 普通白帽子  |\t\t\t        Rank:171 漏洞数:35        | 漏洞无影响，已忽略～～～～～～～)\t\t \n  @0x334 tjjtds    \n     2013-08-15 17:19 |    \t\t小痞子 \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:21        | <xss>alert(\"a\")</xss>￥&@&……dssKhwjcw...)\t\t \n   没位子了  让让 前面的。。 开水~~     \n     2013-08-15 17:38 |    \t\t \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | 博客寻友链 http://imlonghao.com/)\t\t \n  tjjtds    \n     2013-08-15 17:50 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  关注    \n     2013-08-15 18:12 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  猪猪侠最近怎么了。。。    \n     2013-08-15 18:53 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  密码用123456的人真该tjjtds啊    \n     2013-08-15 22:01 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  5rank，加精=10rank，不给力啊。、。    \n     2013-08-15 22:05 |    \t\tppt \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | ) | ( 我猜出了用户名，可我没猜出密码。)\t\t \n  123456    \n     2013-08-15 22:14 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @px1624  WooYun: 百姓网某分站任意文件读取漏洞  任意文件读取给了20RANK，拿到个SHELL，还是在内网，才给5RANK，你能怎么着呢？ 难道非得走(****万用户信息告急)，他们才会知道问题的严重性？    \n     2013-08-15 23:13 |    \t\t有妹子送上 \t\t\t( 实习白帽子  |\t\t\t        Rank:89 漏洞数:28        | 杭州最帅的男人)\t\t \n  马克    \n     2013-08-16 00:13 |    \t\tSpid3r \t\t\t( 实习白帽子  |\t\t\t        Rank:50 漏洞数:10        | 常年撒网打鱼.)\t\t \n  回复碉堡了...    \n     2013-08-17 18:10 |    \t\tHxai11 \t\t\t( 普通白帽子  |\t\t\t        Rank:1137 漏洞数:218        | 于是我们奋力向前游，逆流而上的小舟，不停...)\t\t \n  @猪猪侠 从厂商的回复就看的出来，厂商很不负责，很傲慢！    \n     2013-09-29 16:58 |    \t\t齐迹 \t\t\t( 核心白帽子 |\t\t\t        Rank:784 漏洞数:100        | 一名普通的phper开发者，关注web安全。)\t\t \n  总结三字：弱密码！洞主的文笔太猛了。。。    \n     2013-09-29 18:56 |    \t\tElegance \t\t\t( 实习白帽子  |\t\t\t        Rank:48 漏洞数:3        | 此人很懒，什么话都没留下！)\t\t \n  @奇迹 分析的过程才是关键！    \n     2013-09-30 09:02 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  可惜了才给5    \n     2013-09-30 09:17 |    \t\t封印师 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 我是小彩笔来的。...(｡•ˇ‸ˇ•｡) ...)\t\t \n  关注学习！    \n     2013-09-30 10:28 |    \t\twoody \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:1        | 菜鸟一枚)\t\t \n  其实就一弱密码吧过程显得惊心动魄这厂商回复真搞    \n     2013-09-30 12:44 |    \t\t猪猪侠  \t\t\t( 核心白帽子 |\t\t\t        Rank:3224 漏洞数:254        | 你都有那么多超级棒棒糖了，还要自由干吗？)\t\t \n  @齐迹 @woody  这已经不是弱口令的问题了，而是登录名泄露，认证机制Bypass，明显的设计缺陷导致的自动化枚举漏洞。我写一个脚本，就能黑下全世界80%以上的Discuz论坛，你用简单的弱口令问题能做到？    \n     2013-09-30 16:55 |    \t\t心伤的裤子 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:2        | 看啥，裤子都掉了还看！)\t\t \n  @猪猪侠 给discuz再发一个，后台登录无验证码，ip限制形同虚设，管理username随意获取﹉    \n     2014-01-11 19:50 |    \t\t廷廷 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 有很强的好奇心，爱好广泛，求女女带走。。...)\t\t \n  @猪猪侠 LZ碉堡了，我是粉丝··    \n     2014-03-22 12:12 |    \t\tHero \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:31        | 药药切克闹,充气娃娃迷幻药)\t\t \n  弹鸡鸡弹到死啊！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}