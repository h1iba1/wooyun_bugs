{"id": 15888, "wybug_id": "wooyun-2012-013794", "wybug_title": "手机淘宝网session劫持，可进一步发展为蠕虫", "wybug_corp": "淘宝网", "wybug_author": "seclab_zju", "wybug_date": "2012-10-23 15:05", "wybug_open_date": "2012-12-07 15:06", "wybug_type": "账户体系控制不严", "wybug_level": "中", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-10-23：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-10-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-11-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-11-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-11-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-12-07：\t细节向公众公开  简要描述： 手机淘宝网用户登录的session id可以被劫持，劫持后可替代用户操作发布虚假恶意信息。 详细说明：  手机用户登录淘宝网m.taobao.com，获得的session id被存储在URL内（因为有的手机不支持cookie，加之cmwap下的cookie双重管理问题），并被放入了随后该用户的所有访问链接内。如果存在外链从m.taobao.com/somepage?sid=xxxx到hacker.com，那么hacker.com的访问记录里就可以看到如下的http header：\nHost: hacker.comConnection: keep-aliveUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.4 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Referer: http://m.taobao.com/somepage?sid=xxxxAccept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3\n其中Referer的信息包涵sid，从而导致session被劫持。进一步，当hacker获得sid后，可以以该用户身份向其SNS好友发送类似外链，如果好友正好也是从手机浏览器登入，也会被劫持sid，进而发展成蠕虫。   漏洞证明：  \n\n（左）用户登录手机淘宝网，所有链接均带有sid=68d5...作为登录凭证；（中）登入后的用户点击外链sid.f3322.org；（右）sid.f3322.org的所有者用php读出受害者访问该域使用的http header。   修复方案：  禁止外链会影响用户体验。最好的办法是像新浪微博那样用<meta>跳转，对主流浏览器都不会留下Referer trace。不能采用301/302跳转。除了用户可以post的恶意外链以外，m.taobao.com下面还有很多外链是指向合作站点的，同样会向对方泄漏sid，但是危害没有上面说的那么大，除非合作站点是竞争对手要恶意控制淘宝用户。我这里用python扫出来的link有到360buy、weibo、tudou、youku、baidu几十个域名的，具体你们可以从一个已登录URL开始用spider扫一遍。   版权声明：转载请注明来源 seclab_zju@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2012-10-23 16:54 厂商回复： 感谢seclab_zju的投递，我们已经强制m.taobao.com域禁止外联。 最新状态： 2012-10-23：呃，写错了，其实我们是强制tui.m.etao.com域禁止外联……  ", "replys": "漏洞评价：\n评论\n     2012-11-22 19:12 |    \t\tzsx \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | undefined)\t\t \n  写错了。。    \n     2012-11-24 00:26 |    \t\t猴子 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:5        | 我是一只骚猴子)\t\t \n  写错了、、、。。这个。。。额。。。。额。。。。额。。。伤不起    \n     2012-12-07 16:38 |    \t\t小胖胖要减肥  \t\t\t( 普通白帽子  |\t\t\t        Rank:686 漏洞数:101        )\t\t \n  是不是可以将sid和cookies里的某个值进行校验，这样就会提示没有操作权限，禁止域外链感觉体验很不好    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}