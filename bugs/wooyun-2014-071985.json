{"id": 130, "wybug_id": "wooyun-2014-071985", "wybug_title": "蝉知企业门户系统 v2.5 前台getshell", "wybug_corp": "chanzhi.org", "wybug_author": "roker", "wybug_date": "2014-08-12 09:31", "wybug_open_date": "2014-11-10 09:32", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-08-15：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-06：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-16：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-26：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-10：\t细节向公众公开  简要描述： rt。 详细说明：  看到 module/file/control.php\npublic function ajaxUpload($uid)    {        $file = $this->file->getUpload('imgFile');        $file = $file[0];        if($file)        {            if(!$this->file->checkSavePath()) $this->send(array('error' => 1, 'message' => $this->lang->file->errorUnwritable));            move_uploaded_file($file['tmpname'], $this->file->savePath . $file['pathname']);            if(in_array(strtolower($file['extension']), $this->config->file->imageExtensions) !== false)            {                $this->file->compressImage($this->file->savePath . $file['pathname']);                $imageSize = $this->file->getImageSize($this->file->savePath . $file['pathname']);                $file['width']  = $imageSize['width'];                $file['height'] = $imageSize['height'];            }            $url =  $this->file->webPath . $file['pathname'];            $file['addedBy']   = $this->app->user->account;            $file['addedDate'] = helper::now();            $file['editor']    = 1;            unset($file['tmpname']);            $this->dao->insert(TABLE_FILE)->data($file)->exec();            $_SESSION['album'][$uid][] = $this->dao->lastInsertID();            die(json_encode(array('error' => 0, 'url' => $url)));        }    }\n这个上传文件的跟到 \npublic function getUpload($htmlTagName = 'files')    {        $files = array();        if(!isset($_FILES[$htmlTagName])) return $files;        /* The tag if an array. */        if(is_array($_FILES[$htmlTagName]['name']))        {            extract($_FILES[$htmlTagName]);            foreach($name as $id => $filename)            {                if(empty($filename)) continue;                $file['extension'] = $this->getExtension($filename);\n继续跟进 getExtension函数\npublic function getExtension($filename)    {        $extension = pathinfo($filename, PATHINFO_EXTENSION);        if(empty($extension)) return 'txt';        if(strpos($this->config->file->dangers, strtolower($extension)) !== false) return 'txt';        return $extension;    }\ndangers 的值是\n$config->file->dangers = 'php,jsp,py,rb,asp,'; // Dangerous file types.\nif(strpos($this->config->file->dangers, strtolower($extension)) !== false) return 'txt'这句话逻辑有点问题，应该把strpos的两个参数位置替换下，例如 我提交 a.php+空格的话 就能 绕过了\n\n\n\n   漏洞证明：  \n\n\n\n   修复方案：  上面写了   版权声明：转载请注明来源 roker@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-08-12 16:58 厂商回复： 已经确认，会影响windows服务器的用户。近期会发布新版本解决这个问题。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}