{"id": 86841, "wybug_id": "wooyun-2016-0175738", "wybug_title": "海康威视某视频接入网关系统通用型设计缺陷(漏洞集合无需登录)", "wybug_corp": "海康威视", "wybug_author": "路人甲", "wybug_date": "2016-02-14 08:13", "wybug_open_date": "2016-05-18 18:30", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-02-21：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-04-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-04-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-18：\t细节向公众公开  简要描述： rt 详细说明：  多处越权访问：设备类型管理http://xxxxxxxxx:7288/devicetype/取流服务器配置http://xxxxxxx:7288/mediaconfig/信令网关信息http://xxxxxxx:7288/mediastatus/远程升级http://xxxxxxxx:7288/remoteupdate/服务器日志http://xxxxxxx:7288/serverlog/信令服务器配置http://xxxxxxx:7288/signalconfig/信令网关信息http://xxxxxx:7288/signalstatus/转码服务器配置http://xxxxxx:7288/transformserver/用户管理http://xxxxxxxxx:7288/userinfo/任意目录遍历（data/fetchPlugJsonByFolder.php）\n<?php\tinclude('../common/connDb.php');\t$dirName = $_GET['dirName'];\tclass TreeNode{\t  var $id;\t  var $text;\t  var $iconCls;\t  var $state;\t  var $children=array();\t  function __construct(){\t\t\t  }\t  public function setId($id)\t  {\t\t$this->id = $id;\t  }\t  public function setText($text)\t  {\t\t$this->text = $text;\t  }\t   public function setIconCls($iconCls)\t  {\t\t$this->iconCls = $iconCls;\t  }\t   public function setState($state)\t  {\t\t$this->state = $state;\t  }\t   public function setChildren($children)\t  {\t\t$this->children = $children;\t  }\t   public function getId()\t  {\t\treturn $this->id;\t  }\t  public function getText()\t  {\t\treturn $this->text;\t  }\t   public function getIconCls()\t  {\t\treturn $this->iconCls;\t  }\t   public function getState()\t  {\t\treturn $this->state;\t  }\t   public function getChildren()\t  {\t\treturn $this->children;\t  }\t\t}\t\t$jsonArray = array();\t$pNode = new TreeNode();\t$pNode->setId('0');\t$pNode->setText($dirName);\t$pNode->setIconCls('icon-plugFold');\tarray_push($jsonArray,$pNode); //��Ӳ���ļ��и��ڵ�\t$floderPath ='../../../../plugins/'.$dirName; \tif(is_dir($floderPath)){   \t \t\t$handle=opendir($floderPath);\t\t\t\tfor(;$file = strtolower(readdir($handle));){\t\t\tif($file != '..'  && $file != '.'){\t\t\t\t$cNode = new TreeNode();\t\t\t\t$cNode->setId($file);\t\t\t\t$cNode->setText($file);\t\t\t\t$cNode->setIconCls('icon-systemMenu');\t\t\t\tif ($pNode->getChildren() != null) {\t\t\t\t\t$childrenArray = $pNode->getChildren();\t\t\t\t\tarray_push($childrenArray,$cNode);\t\t\t\t\t$pNode->setChildren($childrenArray);\t\t\t\t}else{\t\t\t\t\t\t$childrenNodes = array();\t\t\t\t\t\tarray_push($childrenNodes,$cNode);\t\t\t\t\t\t$pNode->setChildren($childrenNodes);\t\t\t\t}\t\t\t}\t\t}\t\tclosedir($handle);\t\t}\tprint_r(json_encode($jsonArray));?>\n同时发现部分安装了海康威视相关设备系统的计算机会同时开启Java RMI Registry服务，默认端口1099 由于未授权访问导致目录遍历。1099/tcp open  java-rmi Java RMI Registry任意目录删除(/data/deletePlugFolder.php)\n<?php\tinclude('../common/connDb.php');\t$fileNames = $_POST['fileNames'];\t$foldPath = '../../../../plugins/';\t$fileNameArray = explode(\",\",$fileNames);\tfor($i=0;$i<count($fileNameArray);$i++){\t\tif(!deldir($foldPath.$fileNameArray[$i])){\t\t\techo 1;\t\t\treturn;\t\t}\t}\techo 0;\tfunction deldir($dir) {\t\t//先删除目录下的文件：\t\t$dh=opendir($dir);\t\twhile ($file=readdir($dh)) {\t\t\tif($file!=\".\" && $file!=\"..\") {\t\t\t\t$fullpath=$dir.\"/\".$file;\t\t\t\tif(!is_dir($fullpath)) {\t\t\t\t\tunlink($fullpath);\t\t\t\t} else {\t\t\t\t\tdeldir($fullpath);\t\t\t\t}\t\t\t}\t\t}\t\tclosedir($dh);\t\t//删除当前文件夹：\t\tif(rmdir($dir)) {\t\t\treturn true;\t\t} else {\t\t\treturn false;\t\t}\t}?>\n   漏洞证明：  多处越权访问(举例三个例子，更多越权可以请参考案例)：\n\n用户管理右键源码可获取明文密码\n\n\n\n任意目录遍历（data/fetchPlugJsonByFolder.php）\n\n\n\nJava RMI Registry服务未授权访问导致目录遍历\n\n\n\n\n\n\n\n任意目录删除(/data/deletePlugFolder.php)\n\n案例：\n**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/http://**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/http://**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/http://**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:8090/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/**.**.**.**:7288/\n\n\n   修复方案：  你们懂的。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2016-02-18 18:25 厂商回复： 您好，该问题属于旧版本已知问题，已在2015年修复。我们会对使用旧版本的客户进行加固升级。未来公司将逐步替换PHP开发的产品。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-05-18 18:49 |    \t\t欧尼酱 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:7        | 技术马马虎虎)\t\t \n  已在2015年修复？？？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}