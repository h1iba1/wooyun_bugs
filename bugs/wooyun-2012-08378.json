{"id": 18698, "wybug_id": "wooyun-2012-08378", "wybug_title": "(第N次)用友ICC网站客服系统任意文件上传漏洞", "wybug_corp": "用友软件", "wybug_author": "鬼哥", "wybug_date": "2012-06-16 22:32", "wybug_open_date": "2012-07-31 22:33", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-06-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-06-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-06-21：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2012-08-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-08-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-09-01：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-07-31：\t细节向公众公开  简要描述： 用友ICC网站客服系统任意文件上传漏洞已经暴过很多次了，上次我也暴了个 昨天看了下代码发现还有个地方存在任意上传。官方修复确实不彻底呀！！ 详细说明：  漏洞文件：/5107/include/sendmsg.class.php\nfunction saveAttach() {\t\tglobal $errorMsg, $lang, $CONFIG, $COMMON, $basePath;\t\t\t\tif (empty($_FILES[\"attach\"][\"name\"])) return '';\t\t//生成留言附件保存目录.\t\t$path = 'data/leavewordfile/'.date(\"Ymd\").'/';\t\tif (!is_dir($CONFIG->basePath.$path))\t{\t\t\t $COMMON->createDir($CONFIG->basePath.$path);\t\t}\t\t\t\t//文件名.\t\t$fileName = date('YmdHis').rand(100000, 999999).strrchr($_FILES['attach']['name'], '.');\t\t$sysFileName = $CONFIG->basePath.$path.$fileName;\t\t$urlFileName = $CONFIG->baseUrl.$path.$fileName;\t\t\t\tif (!empty($_FILES['attach']['name'])) {\t\t\t//附件文件非空时检测文件是否合法.\t\t\tif ($this->checkFileType(strrchr($_FILES['attach']['name'], '.'))) {\t\t\t\t//附件文件类型不合法//\t\t\t\t$errorMsg .= $lang['attach_type'];\t\t\t}else if ($_FILES['attach']['size'] >= 5242880 || $_FILES['attach']['size'] <= 0) {\t\t\t\t//附件文件大小不合法/\t\t\t\t$errorMsg .= $lang['attach_size'];\t\t\t}\t\t}\t\t\t\t//上传附件//\t\tmove_uploaded_file($_FILES[\"attach\"][\"tmp_name\"], $sysFileName);\t\tchmod($sysFileName, 0444);\t\treturn $urlFileName;\t\t}\n没过滤啊。。导致可以直接上传php具体利用：打开：http://xxx.com/5107/msg/sendmsg.php 附件那里直接传php上传后的地址会在  /data/leavewordfile/日期/随即文件名.php文件名虽然随即了。 但是可以拿工具扫猜。基本上只是时间问题 ！   漏洞证明：  随便找了个站测试如下↓\n\n   修复方案：  过滤拉。希望不要再让我找到你们的这类漏洞哦。。   版权声明：转载请注明来源 鬼哥@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-06-18 09:30 厂商回复： 已确认在基于部分特定发布版本的代码及其分支确实存在此问题，上传的文件名随机但可能被猜测，目前开发人员正在修复此问题并审查文件上传功能相关的所有代码，万分感谢 鬼哥@乌云 对ICC产品的安全性提升的巨大帮助。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-06-16 22:36 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  — —    \n     2012-06-16 22:40 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  = = 囧    \n     2012-06-16 22:43 |    \t\tMoments \t\t\t( 实习白帽子  |\t\t\t        Rank:55 漏洞数:10        | 2)\t\t \n  让官方直接聘你去修复吧 哈哈    \n     2012-06-16 23:00 |    \t\t鬼哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:136 漏洞数:13        | 鬼哥 ！！！！)\t\t \n  @Moments 哈哈。。    \n     2012-06-17 05:44 |    \t\timlonghao \t\t\t( 普通白帽子  |\t\t\t        Rank:730 漏洞数:74        )\t\t \n  囧。    \n     2012-06-17 08:27 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  @鬼哥 去哪下载源代码？    \n     2012-06-17 12:19 |    \t\t鬼哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:136 漏洞数:13        | 鬼哥 ！！！！)\t\t \n  @possible  拿个shell在打包下。    \n     2012-06-17 14:06 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  @鬼哥 哦膜拜 我说怎么找不到呢 呵呵    \n     2012-07-11 21:59 |    \t\tCp0204 \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:4        | 著名艺术家)\t\t \n  怎么都搞用友的ICC上传呢，哈哈    \n     2012-08-01 02:11 |    \t\talso \t\t\t( 普通白帽子  |\t\t\t        Rank:424 漏洞数:52        | 招渗透/php/前端/ios&android安全，广州地...)\t\t \n  @用友软件 感谢是对的，应该给点鼓励，他会更给力！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}