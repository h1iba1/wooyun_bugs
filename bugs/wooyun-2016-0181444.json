{"id": 87598, "wybug_id": "wooyun-2016-0181444", "wybug_title": "安美世纪自主研发的酒店高速互联网接入及综合管理服务系统设备任意命令执行&amp;存储型XSS                                      ", "wybug_corp": "安美世纪(北京)科技有限公司", "wybug_author": "YY-2012", "wybug_date": "2016-03-07 12:50", "wybug_open_date": "2016-06-09 18:10", "wybug_type": "命令执行", "wybug_level": "中", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "逻辑错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-11：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-03-14：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-05-05：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-15：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-25：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-09：\t细节向公众公开  简要描述： 任意命令执行漏洞&存储型XSS(只需登录系统立刻触发) 详细说明：  任意命令执行/manager/radius/server_ping.php\n<?if (!isset($ip) || $ip == \"\" || !isset($id) || $id == \"\") exit;$cmd = \"ping -c 2 -s 65 $ip\";$fp = popen($cmd, \"r\");$getString = \"\";if ($fp) {\twhile (($line = fgets($fp, 512))) {\t\t$getString .= trim($line);\t}\tpclose($fp);\t}if (strstr($getString, \"2 received, 0%\")) {\techo \"<html><body><script language=\\\"javascript\\\">\\n\";\techo \"parent.doTestResult('$id', 'ok');\\n\";\techo \"</script></body></html>\\n\";} else {\techo \"<html><body><script language=\\\"javascript\\\">\\n\";\techo \"parent.doTestResult('$id', 'no');\\n\";\techo \"</script></body></html>\\n\";}?>\n模板功能设置页面/language.php未授权访问，能任意修改系统功能名称导致存储型XSS跨站漏洞。\n<?/*\t功能：添加语言文字页面mysql> desc T_Lang;+-----------+--------------+------+-----+---------+----------------+| Field     | Type         | Null | Key | Default | Extra          |+-----------+--------------+------+-----+---------+----------------+| SerialID  | int(16)      | NO   | PRI | NULL    | auto_increment | | LangID    | varchar(128) | NO   |     |         |                | | LangName  | varchar(255) | NO   |     |         |                | | LangEName | varchar(255) | YES  |     |         |                | | LangType  | varchar(64)  | NO   |     |         |                | +-----------+--------------+------+-----+---------+----------------+mysql> desc T_LangMenu;                                                         +----------+--------------+------+-----+---------+----------------+| Field    | Type         | Null | Key | Default | Extra          |+----------+--------------+------+-----+---------+----------------+| SerialID | int(16)      | NO   | PRI | NULL    | auto_increment | | MenuName | varchar(128) | NO   |     |         |                | +----------+--------------+------+-----+---------+----------------+*/include_once (\"mysql.php\");$dblang = new newDB();$showResult = \"\";if (!isset($SerialID)) $SerialID = \"\";if (!isset($LangType)) $LangType = \"\";if (!isset($LangID)) $LangID = \"\";if (!isset($LangName)) $LangName = \"\";if (!isset($LangEName)) $LangEName = \"\";if (!isset($Type)) $Type = \"\";if (!isset($Flag)) $Flag = \"\";if (!isset($Search)) $Search = \"\";if (!isset($TitleList)) $TitleList = \"\";if (!isset($Lately)) $Lately = \"\";if (!isset($doWrite)) $doWrite = \"\";if (!isset($EditStatus)) $EditStatus = \"\";if (!isset($doAddMenu)) $doAddMenu = \"\";if (!isset($MenuName)) $MenuName = \"\";$LangID = str_replace(\"'\", \"\", $LangID);$LangName = str_replace(\"'\", \"\", $LangName);$LangEName = str_replace(\"'\", \"''\", $LangEName);$LangName = str_replace(\"\\\\t\", \"\", $LangName);$LangEName = str_replace(\"\\\\t\", \"\", $LangEName);$Search = str_replace(\"'\", \"\", $Search);$MenuName = str_replace(\"'\", \"\", $MenuName);if (strcasecmp($doWrite, \"ok\") == 0) {\t$cn_file = \"/usr/eflow/hibos/include/lang_cn.php\";\t$en_file = \"/usr/eflow/hibos/include/lang_en.php\";\t$get_string_cn = \"<?\\n/*\\n *\t功能：简体中文语言\\n */\\n\\n\\$CHARSET = \\\"GB2312\\\";\\n\\$lang = array\\n(\\n\";\t$get_string_en = \"<?\\n/*\\n *\t功能：英文语言\\n */\\n\\n\\$CHARSET = \\\"UTF-8\\\";\\n\\$lang = array\\n(\\n\";\t$title_stats = \"\";\t$sqlcmd = \"select LangID, LangName, LangEName, LangType from T_Lang order by LangType, LangID ASC\";\t$result = $dblang->query($sqlcmd);\twhile ($result && ($row = $dblang->fetch_row($result)) != false) {\t\tif ($row[3] != $title_stats) {\t\t\t$get_string_cn .= \"\\t//\".$row[3].\"\\n\";\t\t\t$get_string_en .= \"\\t//\".$row[3].\"\\n\";\t\t\t$title_stats = $row[3];\t\t}\t\t$get_string_cn .= \"\\t'\".$row[0].\"' => '\".str_replace(\"'\", \"\\\\'\", $row[1]).\"',\\n\";\t\t$get_string_en .= \"\\t'\".$row[0].\"' => '\".str_replace(\"'\", \"\\\\'\", $row[2]).\"',\\n\";\t}\t$get_string_cn .= \"'');\\n\\n?>\";\t$get_string_en .= \"'');\\n\\n?>\";\t$result_cn = 0;\t$cnfd = fopen($cn_file, 'w');\tif ($cnfd) {\t\t$result_cn = 1;\t\tfputs($cnfd, $get_string_cn);\t\tfclose($cnfd);\t}\t$result_en = 0;\t$enfd = fopen($en_file, 'w');\tif ($enfd) {\t\t$result_en = 1;\t\tfputs($enfd, $get_string_en);\t\tfclose($enfd);\t}\techo \"<html>\\n\";\techo \"<body>\\n\";\techo \"<script language=\\\"JavaScript\\\">\\n\";\tif ($result_cn && $result_en) {\t\techo \"alert('写文件成功！');\\n\";\t} else {\t\techo \"alert('写文件失败！');\\n\";\t}\techo \"</script>\\n\";\techo \"</body>\\n\";\techo \"</html>\\n\";\texit;}if (strcasecmp($doAddMenu, \"ok\") == 0) {\tif ($MenuName != \"\") {\t\t$sqlcmd = \"insert into T_LangMenu (MenuName) values ('$MenuName')\";\t\t$result = $dblang->query($sqlcmd);\t} else \t\t$result = 0;\tif ($result)\t\t$showResult = \"标示位置添加成功！\";\telse\t\t$showResult = \"标示位置添加失败！\";}if (isset($UID) && $UID == \"add\") {\t//添加\t$sqlcmd = \"select LangName from T_Lang where LangID='$LangID'\";\t$result = $dblang->query($sqlcmd);\tif ($result && $dblang->num_rows($result) > 0) {\t\t$showResult = \"下标ID已经存在！\";\t} else {\t\t$sqlcmd = \"insert into T_Lang(LangID,LangName,LangEName,LangType)\";\t\t$sqlcmd .= \"values('$LangID','$LangName','$LangEName','$LangType')\";\t\tif ($dblang->query($sqlcmd) != false) {\t\t\t$showResult = \"$LangID => $LangName 已添加完成！\";\t\t\t$LangID = \"\";\t\t\t$LangName = \"\";\t\t\t$LangEName = \"\";\t\t\t$LangType = \"\";\t\t} else {\t\t\t$showResult = \"$LangID => $LangName 添加失败！\";\t\t}\t}} else if (isset($Flag) && $Flag == \"edit\") {\t$sqlcmd = \"select LangID, LangName, LangEName, LangType, SerialID from T_Lang where LangID='$id'\";\t$result = $dblang->query($sqlcmd);\tif ($result && ($row = $dblang->fetch_row($result)) != false) {\t\t$LangID = $row[0];\t\t$LangName = $row[1];\t\t$LangEName = $row[2];\t\t$LangType = $row[3];\t\t$SerialID = $row[4];\t} else {\t\t$Flag = \"\";\t}} else if (isset($UID) && $UID == \"edit\" && $SerialID != \"\") {\t\t$sqlcmd = \"update T_Lang set LangID='$LangID', LangName='$LangName', LangEName='$LangEName', LangType='$LangType' where SerialID='$SerialID'\";\t\tif ($dblang->query($sqlcmd) != false) {\t\t\t$showResult = \"$LangID => $LangName 已修改完成！\";\t\t\t$LangID = \"\";\t\t\t$LangName = \"\";\t\t\t$LangEName = \"\";\t\t\t$LangType = \"\";\t\t} else {\t\t\t$showResult = \"$LangID => $LangName 修改失败！\";\t\t}} else if (isset($UID) && $UID == \"del\") {\t$sqlcmd = \"delete from T_Lang where LangID='$id'\";\tif ($dblang->query($sqlcmd) != false) {\t\t$showResult = \"$id 已删除完成！\";\t} else {\t\t$showResult = \"$id 删除失败！\";\t}}?><html><title>语言管理</title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"><link REL=\"STYLESHEET\" TYPE=\"text/css\" HREF=\"/script/style.css\"><script language=\"JavaScript\" src=\"/script/string.js\"></script><script language=\"JavaScript\" src=\"/script/flybar.js\"></script><script language=\"JavaScript\"> function docheck(form){\tform.LangID.value = trim(form.LangID.value);\tif (form.LangID.value == \"\") {\t\talert(\"下标ID不允许空\");\t\tform.LangID.focus();\t\treturn false;\t}\tform.LangName.value = trim(form.LangName.value);\tif (form.LangName.value == \"\") {\t\talert(\"中文语言内容不允许空\");\t\tform.LangName.focus();\t\treturn false;\t}\tform.LangEName.value = trim(form.LangEName.value);\tif (form.LangEName.value == \"\") {\t\talert(\"英文语言内容不允许空\");\t\tform.LangEName.focus();\t\treturn false;\t}\tif (form.LangType.value == \"\") {\t\talert(\"请选择标示位置\");\t\treturn false;\t}\treturn true;}function doWriteLang(){\tvar ifr = document.createElement(\"IFRAME\");\tifr.frameBorder = 0;\tifr.scrolling = \"no\";\tifr.width = 0;\tifr.height = 0;\tifr.src = \"language.php?doWrite=OK\";\tdocument.body.appendChild(ifr);}function addMenuName(){\tvar getNamestr = trim(document.getElementById('MenuName').value);\tif (getNamestr == \"\") {\t\talert(\"标示位置不允许空！\");\t\treturn;\t}\tdocument.getElementById('divBar').style.visibility = \"hidden\";\tvar ifr = document.createElement(\"IFRAME\");\tifr.frameBorder = 0;\tifr.scrolling = \"no\";\tifr.width = 0;\tifr.height = 0;\tifr.src = \"language.php?doAddMenu=OK&MenuName=\" + getNamestr;\tdocument.body.appendChild(ifr);}</script><body><br><center><form action=\"language.php\" method=\"post\"><input type=\"hidden\" name=\"EditStatus\" value=\"<? echo $EditStatus ?>\"><table width=\"750\" height=\"35\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin:7px\">  <tr><td width=\"100%\" height=\"35\" align=\"left\" style=\"padding-left:20px\"><b>语言内容查找(中英)：</b> <input type=\"text\" name=\"Search\" value=\"\" size=\"30\">  <input type=\"submit\" name=\"submit2\" value=\" 查 找 \">  &nbsp;&nbsp;<span style=\"width:30px\">&nbsp;</span>  <input type=\"button\" name=\"btn_lately\" value=\"最新记录\" onclick=\"location.href='language.php?EditStatus=<? echo $EditStatus ?>&Lately=ok'\">&nbsp;&nbsp;  <input type=\"button\" name=\"btn_title\" value=\"列标题\" onclick=\"location.href='language.php?EditStatus=<? echo $EditStatus ?>&TitleList=ok'\">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <input type=\"button\" name=\"btn_title\" value=\"写文件\" onclick=\"doWriteLang();\"></table></form><form action=\"language.php\" method=\"post\" onsubmit=\"return docheck(this)\"><input type=\"hidden\" name=\"UID\" value=\"<? if ($Flag != \"\") echo \"edit\"; else echo \"add\"; ?>\"><input type=\"hidden\" name=\"Type\" value=\"<? echo $Type ?>\"><input type=\"hidden\" name=\"SerialID\" value=\"<? echo $SerialID ?>\"><input type=\"hidden\" name=\"EditStatus\" value=\"<? echo $EditStatus ?>\"><input type=\"hidden\" name=\"Search\" value=\"<? echo $Search ?>\"><input type=\"hidden\" name=\"Lately\" value=\"<? echo $Lately ?>\"><table width=\"750\" height=\"200\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin:7px\">  <tr><td width=\"32%\" height=\"200\" align=\"left\" style=\"padding-left:10px\"><b>标示位置<?if($TitleList==\"\" && $Type==\"\"){?>[<a href=\"javascript:void(0);\" onclick=\"divBar.style.visibility='visible';\">增</a>]<?}?>：</b><br>\t<select name=\"LangType\" size=\"20\" style=\"width:200px;height:180px\"><?\tif ($Type != \"\" && $Flag == \"\") {?>\t\t<option value=\"<? echo $Type ?>\" selected><? echo $Type ?></option><?\t} else {\t\t$sqlcmd = \"select MenuName from T_LangMenu order by MenuName ASC\";\t\t$result2 = $dblang->query($sqlcmd);\t\twhile ($result2 && ($row2 = $dblang->fetch_row($result2)) != false) {?>\t\t<option value=\"<? echo $row2[0] ?>\"<? if ($Flag != \"\" && $LangType == $row2[0]) echo \" selected\"; ?>><? echo $row2[0] ?></option><?\t\t} //while end\t} //if end?>\t</select><font color=\"#CC0000\">*</font>\t  </td>      <td width=\"53%\" align=\"left\" style=\"padding-left:20px\">\t\t<b>下标ID：</b><br>\t\t<input type=\"text\" name=\"LangID\" value=\"<? echo $LangID ?>\" maxlength=\"127\" size=\"36\" onBlur=\"this.value=trim(this.value)\" <? if ($EditStatus == \"\" && $Flag != \"\") echo \"style='background-color:#EFEFEF' readonly\"; ?>><font color=\"#CC0000\">*</font>\t\t<br><p>\t\t<b>语言内容(中文)：</b><br>\t\t<input type=\"text\" name=\"LangName\" value=\"<? echo $LangName ?>\" maxlength=\"2000\" size=\"48\" onBlur=\"this.value=trim(this.value)\"><font color=\"#CC0000\">*</font>\t\t<br><p>\t\t<b>语言内容(英文)：</b><br>\t\t<input type=\"text\" name=\"LangEName\" value=\"<? echo $LangEName ?>\" maxlength=\"2000\" size=\"48\" onBlur=\"this.value=trim(this.value)\"><font color=\"#CC0000\">*</font>\t  </td>      <td width=\"15%\" align=\"center\"><input type=\"submit\" name=\"submit\" value=\" <? if ($Flag != \"\") echo \"修 改\"; else echo \"添 加\"; ?> \"></td></tr></table></form></center><p><div align=\"left\"><?$lang = array();$show_string = \"\";$sqlcmdlang = \"select LangID, LangName, LangType, LangEName from T_Lang where 1=1 \";if ($Type != \"\") $sqlcmdlang .= \"and LangType='$Type' \";if ($Search != \"\") $sqlcmdlang .= \"and (LangName like '%$Search%' or LangEName like '%$Search%') \";if ($Lately != \"\") { \t$sqlmax = \"select Max(SerialID) from T_Lang\";\t$resultn = $dblang->query($sqlmax);\t$nmax = 0;\tif ($resultn && ($rowl = $dblang->fetch_row($resultn)) != false) {\t\t$nmax = $rowl[0] ? $rowl[0] : 0;\t}\t$sqlcmdlang .= \"and SerialID>'\".($nmax > 0 ? ($nmax-300) : 0).\"' order by LangType, SerialID desc\";} else \t$sqlcmdlang .= \"order by LangType, SerialID\";$resultlang = $dblang->query($sqlcmdlang);while ($resultlang && ($rowlang = $dblang->fetch_row($resultlang)) != false) {\tif (!isset($lang[$rowlang[2]])) {\t\t$lang[$rowlang[2]] = $rowlang[2];\t\t$show_string .= \"<br><b><span style='padding-left:15px'>[<a href='language.php?Lately=$Lately&EditStatus=$EditStatus&Type=$rowlang[2]'>$rowlang[2]</a>]</span></b><br>\\n\";\t}\t$cstrlang = str_replace(\"<\", \"&lt;\", $rowlang[1]);\t$cstrlang = str_replace(\">\", \"&gt;\", $cstrlang);\t$estrlang = str_replace(\"<\", \"&lt;\", $rowlang[3]);\t$estrlang = str_replace(\">\", \"&gt;\", $estrlang);\t$show_string .= \"<span style='padding-left:40px'>[<a href='language.php?Lately=$Lately&EditStatus=$EditStatus&Type=$Type&Flag=edit&id=${rowlang[0]}&Search=$Search'>改</a>]\";\tif ($EditStatus != \"\") {\t\t$show_string .= \" [<a href=\\\"javascript:if(confirm('确定删除下标为$rowlang[0]的记录吗？')) location='language.php?Lately=$Lately&EditStatus=$EditStatus&UID=del&Type=$Type&id=${rowlang[0]}&Search=$Search';\\\">删</a>]\";\t}\t$show_string .= \" &nbsp; <font color='#CC0000' size='2'>'$rowlang[0]'</font> => <font color='#00CC00' size='2'>'$cstrlang'</font> => <font color='#00CC00' size='2'>'$estrlang'</font></span><br>\\n\";}if ($Type == \"\" && $Flag == \"\") {\techo \"<div align=\\\"left\\\" style=\\\"margin:0px 10px;\\\">\";\t$last_str = \"\";\twhile (list($key, $value) = each($lang)) {\t\tif (substr($value, 0, 2) != $last_str) {\t\t\techo \"<br>\";\t\t\t$last_str = substr($value, 0, 2);\t\t}\t\techo \"&nbsp;[<a href='language.php?Lately=$Lately&EditStatus=$EditStatus&Type=$key'><b>$value</b></a>]&nbsp;&nbsp;\";\t}\techo \"</div><br>\";}if ($TitleList == \"ok\") {\techo \"</div>\\n</body>\\n</html>\\n\";\texit;}if ($Flag == \"\") {\techo $show_string;}?></div><br><?\tif ($showResult != \"\") {?><script language=\"JavaScript\"> alert(\"<? echo $showResult ?>\");</script><?\t}\t\tif ($Flag != \"\") {\t\techo \"<center><input type='button' name='btn_return' value=' 返 回 ' onclick=\\\"location='language.php?Lately=$Lately&EditStatus=$EditStatus&Type=$Type&Search=$Search'\\\"></center>\\n\";\t} else if ($Type != \"\") {\t\techo \"<center><input type='button' name='btn_return' value=' 返 回 ' onclick=\\\"location='language.php?Lately=$Lately&EditStatus=$EditStatus'\\\"></center>\\n\";\t}?><br><div id=\"divBar\" style='position:absolute;top:90px;left:200px;visibility:hidden;z-index:100'><table cellspacing=\"0\" cellpadding=\"0\" border=\"1\" width=\"360\" height=\"60\">\t<tr><td valign=\"top\">\t\t<table border=\"0\" width=\"100%\" height=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\t\t\t<tr>\t\t\t\t<td class=\"bg2 text-right\" width=\"70%\" height=\"100%\"><input type=\"text\" name=\"MenuName\" value=\"\" maxlength=\"120\" size=\"35\"></td>\t\t\t\t<td class=\"bg2 text-left\" width=\"30%\" height=\"100%\" style=\"padding-left:5px;\"><input type=\"button\" name=\"addbtn\" value=\"添加\" onclick=\"addMenuName()\">&nbsp;&nbsp;&nbsp;&nbsp;<input type=\"button\" name=\"closebtn\" value=\"关闭\" onclick=\"divBar.style.visibility='hidden';\"></td>\t\t\t</tr>\t\t</table>\t</td></tr></table></div></body></html>\n   漏洞证明：  任意命令执行：\n\n\n\n存储型XSS(只需登录系统立刻触发)\n\n\n\n\n\n案例：\n**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**:8443/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php**.**.**.**/manager/login.php\n   修复方案：  联系厂商   版权声明：转载请注明来源 YY-2012@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2016-03-11 18:09 厂商回复： CNVD确认并复现所述情况，已由CNVD通过软件生产厂商公开联系渠道向其邮件通报，由其后续提供解决方案并协调相关用户单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-03-07 14:49 |    \t\t一只猿 \t\t\t( 普通白帽子  |\t\t\t        Rank:546 漏洞数:96        | 硬件与无线通信研究方向)\t\t \n  这个屌    \n     2016-03-07 14:51 |    \t\tYY-2012 \t\t\t( 核心白帽子 |\t\t\t        Rank:3814 漏洞数:726        | 意淫，是《红楼梦》原创的词汇，但后来演变...)\t\t \n  @一只猿 你怎么知道的？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}