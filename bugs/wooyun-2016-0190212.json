{"id": 88149, "wybug_id": "wooyun-2016-0190212", "wybug_title": "中兴某网关设备通用型命令执行（无需登录）                                      ", "wybug_corp": "中兴通讯股份有限公司", "wybug_author": "路人甲", "wybug_date": "2016-03-29 10:23", "wybug_open_date": "2016-06-27 11:30", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2016-03-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2016-03-29：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2016-04-01：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航、无声信息）\t\t\t\t\t\t\t\t\t2016-05-23：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2016-06-02：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-06-12：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-06-27：\t细节向公众公开  简要描述： 中兴某网关设备通用型命令执行 详细说明：  混乌云之pwnsh4d0w（与freebuf不同)\n\n设备型号为：ZTE Management system可通过傻蛋搜索\n\n在sys_backuprestore.be.php中通过上枚漏洞读到该文件内容\nfunction sys_upload_apply($post){\tglobal $db;\tglobal $lang;\tglobal $res;    $savepath = WEB_TMP_DIR;    $savepath =$savepath.\"uploaded/\";\t$filename1 = $_FILES['userfile1']['name'];\t$filename2 = $_FILES['userfile2']['name'];\t$filename3 = $_FILES['userfile3']['name'];\t$filename4 = $_FILES['userfile4']['name'];    $filenameture= false;  \t$dbUserTables = array('otusers','user_lcrservices','users','devices','sip','zap','forwards','black_list','speed_dials','ftp_users','authreg','internal_contexts','otu_services','ext_binding');   //å¤ä»½å¤åº \t$dbSystemTables = array('acd_agents','acd_queue_members','acd_queues','call_rule_dests','call_rules','callbacks','conferences','dhcp_hosts','dhcp_ranges','did_routes','dns_domains','dns_records','fw_black_list','h323_providers','http_vhosts','hunt_groups','iax_providers','ip_routes','ivr_tree','lcm_globals','lcr_services','mail_aliases','mail_banlist','mail_domains','mail_relay_domains','nmo_app_definitions','nmo_blacklist','nmo_bm_policy','oft_operators','oft_roles','outbound_route_dests','outbound_routes','pbx_feature_codes','qos_services','queue','sip_providers','smb_shares','tc_conf','tc_conf_pipes');  \t$dbLogTables = array('nmo_web_auditlog','nmo_ftp_auditlog','nmo_im_auditlog','nmo_p2p_auditlog','nmo_mail_auditlog','nmo_contents','nmo_logcontents','nmo_ipfraud_log','nmo_over_budget_conn_log');   //å¤ä»½å¤åº\t\t//$dbUserTables = array('otusers','user_lcrservices','users'); \t$dbAnalyTables = array('nmo_web_auditlog','nmo_ftp_auditlog','nmo_im_auditlog','nmo_p2p_auditlog','nmo_mail_auditlog','nmo_contents','nmo_logcontents','nmo_ipfraud_log','nmo_over_budget_conn_log');    if (($filename1 == \"\") && ($filename2 == \"\") && ($filename3 == \"\") && ($filename4 == \"\")) {       //echo \"å¤§å¥ä¼ ç¹ä¸è¥¿ä¸æ¥å§ï¼ä¸ç¶å°±ä¸è¦ä¹±æï¼\";\t}    if(is_dir($savepath) && file_exists($savepath)){       \t}\telse\t{\t\tmkdir($savepath);\t}\tif (isset($filename1) && ($filename1 != \"\")) {\t\tif ((preg_match(\"/.sql/i\",$filename1)) && (preg_match(\"/user/i\",$filename1))) {\t\t\tmove_uploaded_file($_FILES['userfile1']['tmp_name'],$savepath.$filename1);\t\t\t$con = mysql_connect(\"localhost\",\"root\",\"admin\");\t\t\tmysql_select_db(\"ot\",$con);\t\t\tmysql_query(\"SET @@FOREIGN_KEY_CHECKS = 0\");\n这个函数只要$filename1不为空，以及后面匹配$filename1名字即可但是$filename1名字要匹配user，又要匹配.sql ，这里很容易通过，所以我们只要构造好user.sql这样的文件即可获取一个shell.保存路径又是自定义好的/temp/uploaded/所以写form表单即可\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n案例非常多**.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.**   漏洞证明：  混乌云之pwnsh4d0w（与freebuf不同)\n\n设备型号为：ZTE Management system可通过傻蛋搜索\n\n在sys_backuprestore.be.php中通过上枚漏洞读到该文件内容\nfunction sys_upload_apply($post){\tglobal $db;\tglobal $lang;\tglobal $res;    $savepath = WEB_TMP_DIR;    $savepath =$savepath.\"uploaded/\";\t$filename1 = $_FILES['userfile1']['name'];\t$filename2 = $_FILES['userfile2']['name'];\t$filename3 = $_FILES['userfile3']['name'];\t$filename4 = $_FILES['userfile4']['name'];    $filenameture= false;  \t$dbUserTables = array('otusers','user_lcrservices','users','devices','sip','zap','forwards','black_list','speed_dials','ftp_users','authreg','internal_contexts','otu_services','ext_binding');   //å¤ä»½å¤åº \t$dbSystemTables = array('acd_agents','acd_queue_members','acd_queues','call_rule_dests','call_rules','callbacks','conferences','dhcp_hosts','dhcp_ranges','did_routes','dns_domains','dns_records','fw_black_list','h323_providers','http_vhosts','hunt_groups','iax_providers','ip_routes','ivr_tree','lcm_globals','lcr_services','mail_aliases','mail_banlist','mail_domains','mail_relay_domains','nmo_app_definitions','nmo_blacklist','nmo_bm_policy','oft_operators','oft_roles','outbound_route_dests','outbound_routes','pbx_feature_codes','qos_services','queue','sip_providers','smb_shares','tc_conf','tc_conf_pipes');  \t$dbLogTables = array('nmo_web_auditlog','nmo_ftp_auditlog','nmo_im_auditlog','nmo_p2p_auditlog','nmo_mail_auditlog','nmo_contents','nmo_logcontents','nmo_ipfraud_log','nmo_over_budget_conn_log');   //å¤ä»½å¤åº\t\t//$dbUserTables = array('otusers','user_lcrservices','users'); \t$dbAnalyTables = array('nmo_web_auditlog','nmo_ftp_auditlog','nmo_im_auditlog','nmo_p2p_auditlog','nmo_mail_auditlog','nmo_contents','nmo_logcontents','nmo_ipfraud_log','nmo_over_budget_conn_log');    if (($filename1 == \"\") && ($filename2 == \"\") && ($filename3 == \"\") && ($filename4 == \"\")) {       //echo \"å¤§å¥ä¼ ç¹ä¸è¥¿ä¸æ¥å§ï¼ä¸ç¶å°±ä¸è¦ä¹±æï¼\";\t}    if(is_dir($savepath) && file_exists($savepath)){       \t}\telse\t{\t\tmkdir($savepath);\t}\tif (isset($filename1) && ($filename1 != \"\")) {\t\tif ((preg_match(\"/.sql/i\",$filename1)) && (preg_match(\"/user/i\",$filename1))) {\t\t\tmove_uploaded_file($_FILES['userfile1']['tmp_name'],$savepath.$filename1);\t\t\t$con = mysql_connect(\"localhost\",\"root\",\"admin\");\t\t\tmysql_select_db(\"ot\",$con);\t\t\tmysql_query(\"SET @@FOREIGN_KEY_CHECKS = 0\");\n这个函数只要$filename1不为空，以及后面匹配$filename1名字即可但是$filename1名字要匹配user，又要匹配.sql ，这里很容易通过，所以我们只要构造好user.sql这样的文件即可获取一个shell.保存路径又是自定义好的/temp/uploaded/所以写form表单即可\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n**.**.**.**/temp/uploaded/user.sql.php\n\n案例非常多**.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.****.**.**.**   修复方案：     版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2016-03-29 11:25 厂商回复： 感谢提交～ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}