{"id": 55353, "wybug_id": "wooyun-2014-061233", "wybug_title": "destoon某敏感功能xss指哪打哪(绕过过滤)", "wybug_corp": "DESTOON", "wybug_author": "phith0n", "wybug_date": "2014-05-20 12:57", "wybug_open_date": "2014-08-18 12:58", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["持久型", "存储型", "源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-05-20：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-24：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-07-15：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-07-25：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-04：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-08-18：\t细节向公众公开  简要描述： 依旧是没处理好富文本，dsafe函数又被绕过了，给出各种浏览器payload（FF和IE1789均直接触发，其他浏览器点击触发）。。。之前学了一招“危害放大”，这回试试看~~ 详细说明：  不多说了，触发点在短消息的位置，所以可以指哪打哪。在http://wooyun.org/bugs/wooyun-2014-054857 里面能找到之前的一个漏洞。dsafe是过滤XSS的函数，之前这个漏洞交了以后destoon官方很负责地对dsafe进行了修改。但依旧没抓住重点，再次被绕过了。触发方式与上一篇相同。先看看是怎么绕过的吧。dsafe函数代码如下：\n\n首先匹配出html符号实体（&#xxx;），清除掉。如果再匹配出&#xxx;，就直接strip_tags过滤所有html标签。真够狠。。。之前嵌套绕过的那招不好用了。但我们看之后那个正则，这两者：\n\"/\\<\\!\\-\\-([\\s\\S]*?)\\-\\-\\>/\",\"/\\/\\*([\\s\\S]*?)\\*\\//\"\n是会被清除掉的。这两者实际上就是<!---->和/**/两个注释。那么，我们把其中之一如/**/放进&#xxx;中，会发生什么？&#/**/xxx;是不会被前面的if语句匹配的，然后在后面/**/被清除掉，剩下&#xxx;正好组成一个html符号实体。所以我们就能够通过使用html实体绕过后面部分关键词，如expression、script等，构造一个XSS，发短消息的话，指哪打哪。   漏洞证明：  先给一个全浏览器通用的XSS代码，点击触发payload：\n<a href=\"java&#/**/115;cript:al&#/**/101;rt(docum&#/**/101;nt.cooki&#/**/101;)\" style=\"font-size:500px;opacity:0;\">click</a>\n我特地在后面加了一个style=\"font-size:500px;opacity:0;\"。比如你收到一个短消息，里面有一个链接，你不一定会点。但如果收到一个短消息，里面一大片空白，你随手一点，就会中招。所以我把a的字体大小设置为500px，并且透明度设置为0，让人看不出是一个超链接。这算不算所谓的危害放大？演示一下吧。首先登陆，来到短消息，填写好收信人等信息，点发送。中途用burpsuite抓包，把上面的payload进行url编码后放进message[content]字段中：\n\n然后就好了。目标查看新短消息时是这个效果：\n\n一大片空白，随便点一下就触发了：\n\n加载远程js不用演示了吧。。。关键字用html实体绕过。IE下，直接触发：\n<img style=xss:expr&#/**/101;ssion(al&#/**/101;rt(docum&#/**/101;nt.cooki&#/**/101;))>\nFirefox下，直接触发：\n<embed src=java&#/**/115;cript:al&#/**/101;rt(docum&#/**/101;nt.cooki&#/**/101;)>\n给张图：\n\n   修复方案：  ubb或markdown代替富文本。   版权声明：转载请注明来源 phith0n@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-05-21 10:01 厂商回复： 感谢您的提醒和意见，已修复，详见：http:/// 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}