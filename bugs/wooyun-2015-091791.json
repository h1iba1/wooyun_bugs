{"id": 46282, "wybug_id": "wooyun-2015-091791", "wybug_title": "宜信某漏洞的技术利用深度挖掘过程（shell多多）", "wybug_corp": "宜信", "wybug_author": "白非白", "wybug_date": "2015-01-14 12:17", "wybug_open_date": "2015-02-28 12:18", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-01-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-01-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-01-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-02-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-02-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-02-28：\t细节向公众公开  简要描述： 宜信说：曾经有一份高危的漏洞摆在我的面前我没有去珍惜，等我忽略的时候才追悔莫及，人间最痛苦的事莫过于此。如果上天能给我一次再来一次的机会，我会对哪个漏洞说三个字：我认领，如果非要在这份漏洞上加一个rank，我希望是40rank！ 详细说明：  利用方式很简单，只要在如下连接｛｛｝｝位置填入想要查看的文件路径即可\nhttp://xinyi.creditease.cn/ajax.do?action=download&file=../../../../../../../../../../｛｛｝｝\n2.最近刚看猪猪侠提交了一个rsync的漏洞，那就来看看这个站点的rsync配置吧。下载/etc/rsync/rsyncd.conf查看\n\n可以看出使用了用户认证，虽然是弱密码123456，但是也限制了ip。无解3.继续深入一下，操起nmap看一下开放端口\n\n4.nice，开放了不少服务，拿ftp来演示吧。下载/etc/vsftpd/vsftpd.conf查看:使用了pam进行身份认证，禁止了匿名访问。\n\n下载/etc/pam.d/vsftpd :看到身份认证数据库\n\n下载ftp的身份认证文件：/etc/vsftpd/vftpuser.db，使用notepad++打开：得到ftp的用户名和密码（从右向左看，一个用户名一个密码，关键用户打码）\n\n5.使用马赛克用户和对应密码登录ftp\n\n上传下载均可。猜测目录内容均为网站目录。xiaowei目录猜测是宜信的小微金融站点。6.上传一个test.txt到该目录下，并且在这个连接访问一下http://xiaowei.yixin.com/test.txt，同步成功。\n\n心中一喜，直接传个php马儿不就ok了，结果在实践过程中遇到障碍，上传的php文件用菜刀连接提示404，到ftp目录里刷新一下，发现php马没了，但是test.txt还在，猜测可能有某种杀毒或者规则将php文件kill掉了。于是改变了一下思路，nginx的服务器，测试一下解析漏洞吧http://xiaowei.yixin.com/test.txt/1.php，访问该连接成功解析，nginx解析漏洞存在。继续上传一个xiaowei.txt的文件，用菜刀连接http://xiaowei.yixin.com/xiaowei.txt/1.php成功\n\n7.一句话连上了，xiaowei目录的站点也找到了，其他目录对应的站点呢？手工查找太麻烦，直接看nginx配置文件吧，结果/etc里翻了一遍没找到nginx配置。。。换个方法：虚拟终端里locate一下吧：\n\nnginx.conf中每个server_name会对应一个目录，下图显示出ftp目录与域名的对应关系（2个为例）：\n\nnsd：nsd.yixin.comenglish:english.creditease.cn影响范围：nginx配置文件中的任意站点：目测大概也有10-20个每个目录下上传个马，都可以拿到对应域名的shell，不多谈。8.need more？？？shell了，数据库就随便翻随便看了，涉及的都是金融用户，我就不继续了。nmap里还有很多服务类端口，其中管理用户与密码写在配置文件中的，均可以深入，由于在同一个ip，继续也乏味，我就不深入，只拿ftp服务演示一下。   漏洞证明：  当任意文件读取遇到ftp/tomcat/nginx，就会产生上面的各种奇幻之旅。   修复方案：  1.任意文件下载需要修复2.各种配置文件随便下载，这web容器权限也太大了，限制3.既然rsync服务限制了ip，ftp服务与其他服务最好也能限制一下4.nginx解析漏洞要修复5.这个ip上站点这么多，最好做一下权限划分与隔离   版权声明：转载请注明来源 白非白@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-01-15 10:16 厂商回复： 非常详细，十分感谢对我们安全问题的帮助。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-01-14 12:20 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  曾经有一份高危的漏洞摆在我的面前我没有去珍惜，等我忽略的时候才追悔莫及，人间最痛苦的事莫过于此。如果上天能给我一次再来一次的机会，我会对哪个漏洞说三个字：我认领，如果非要在这份漏洞上加一个rank，我希望是40rank！    \n     2015-01-14 12:21 |    \t\tCoody  \t\t\t( 核心白帽子 |\t\t\t        Rank:1565 漏洞数:189        | 不接单、不黑产；如遇接单收徒、绝非本人所...)\t\t \n  卧槽，真的是10shell?    \n     2015-01-14 12:35 |    \t\t发条橙子 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:6        | ∑(っ °Д °;)っ)\t\t \n  靠被发现了！    \n     2015-01-14 13:11 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @Coody :-)    \n     2015-01-14 13:11 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @zzR 么么扎    \n     2015-01-14 13:12 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @发条橙子 -.-发现什么了    \n     2015-01-14 13:15 |    \t\t路人N \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        )\t\t \n  mark    \n     2015-01-14 13:24 |    \t\tdiguoji \t\t\t( 普通白帽子  |\t\t\t        Rank:323 漏洞数:79        | 中国吉林长春)\t\t \n  宜信给的rank是所有厂商最低的 看你这个他给多少    \n     2015-01-14 13:43 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  必10rank!    \n     2015-01-15 10:23 |    \t\tcuger \t\t\t( 普通白帽子  |\t\t\t        Rank:200 漏洞数:44        | 这个家伙很懒，什么也没留下)\t\t \n  楼上神预测    \n     2015-01-15 10:34 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @紫霞仙子 说！厂商号是不是就是你控制的。。。    \n     2015-01-15 10:41 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @diguoji 原来十分感谢，就是用10rank来感谢的意思。    \n     2015-01-15 11:29 |    \t\tdiguoji \t\t\t( 普通白帽子  |\t\t\t        Rank:323 漏洞数:79        | 中国吉林长春)\t\t \n  @白非白 他能给你10就不错了，你看看别人的    \n     2015-01-15 12:47 |    \t\t紫霞仙子 \t\t\t( 普通白帽子  |\t\t\t        Rank:2027 漏洞数:279        | 天天向上 ！！！)\t\t \n  @白非白 我擦，真10rank    \n     2015-02-28 12:53 |    \t\t明月影 \t\t\t( 路人 |\t\t\t        Rank:12 漏洞数:8        | 学姿势，学思路。)\t\t \n  给了10有点难以忍受。这么多的漏洞。    \n     2015-02-28 13:23 |    \t\t苏州同程旅游网络科技有限公司(乌云厂商)\t\t \n  哥，rank给高一点又不要你付钱，人家也是花了时间和精力去测试的，这样大家会觉得这厂商怎么这么不厚道。    \n     2015-02-28 14:20 |    \t\t酷帥王子 \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:34        | 天朗日清，和风送闲，可叹那俊逸如我顾影自...)\t\t \n  这么精彩的漏洞实在是应该多看几眼，厂商应该给多些rank，话说那个任意文件下载漏洞是怎么找到的呢    \n     2015-02-28 14:57 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @苏州同程旅游网络科技有限公司 @明月影 天下厂商都如同程这般想法就好了    \n     2015-02-28 14:59 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @酷帥王子 有文件下载的地方就容易有这种漏洞。 WooYun: 宜信某分站任意文件下载    \n     2015-06-12 11:32 |    \t\t温柔的逍遥 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 温柔的逍遥)\t\t \n  嘿嘿    \n     2015-06-12 13:50 |    \t\t白非白 \t\t\t( 普通白帽子  |\t\t\t        Rank:447 漏洞数:60        | ♫ Freedom - Anthony Hamilton ♫)\t\t \n  @温柔的逍遥 哦？    \n     2015-06-12 15:54 |    \t\t温柔的逍遥 \t\t\t( 路人 |\t\t\t        Rank:10 漏洞数:1        | 温柔的逍遥)\t\t \n  大神方便留个QQ木？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}