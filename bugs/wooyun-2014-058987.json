{"id": 3593, "wybug_id": "wooyun-2014-058987", "wybug_title": "网康NS-ASG应用安全网关大量漏洞集合", "wybug_corp": "网康科技", "wybug_author": "路人甲", "wybug_date": "2014-04-30 14:15", "wybug_open_date": "2014-06-14 14:16", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["设计缺陷", "设计错误"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-01：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-05-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-05-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-05-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-06-14：\t细节向公众公开  简要描述： 网康NS-ASG应用安全网关存在严重设计缺陷包括命令执行、SQL注入、越权、任意文件下载等等等等... 详细说明：  #1 SQL注入漏洞/3g/index.php\n$AgentContent = $_SERVER['HTTP_USER_AGENT'];$AcceptContent = $_SERVER['HTTP_ACCEPT'];$time = date(\"Y-m-d H:i:s\",time());$insert = \"insert into MobileInfoTable values(NULL,'$AgentContent','$AcceptContent','$time');\";\n其中$AgentContent，$AcceptContent 不受GPC限制造成SQL注入漏洞\n$AgentContent = $_SERVER['HTTP_USER_AGENT'];$AcceptContent = $_SERVER['HTTP_ACCEPT'];\n证明：\n\n#2 命令执行/admin/configguide/ipsec_guide_1.php\nfunction getifipmask($ethx,$ipstr,$maskstr,$macstr){    unset($commandRet);    exec(\"sudo /sbin/ifconfig $ethx | head -1 | awk '{print $5}'\",$commandRet);    //macaddr format 00:0C:29:17:AE:4B    $macstr = $commandRet[0];    unset($commandRet);    exec(\"sudo /sbin/ifconfig $ethx | head -2 | awk '{NR==2} END{print $2}'\",$commandRet);    //ipaddr format:addr:192.168.1.126    sscanf($commandRet[0],\"addr:%s\", $ipstr);    unset($commandRet);    exec(\"sudo /sbin/ifconfig $ethx | head -2 | awk '{NR==2} END{print $4}'\",$commandRet);    //mask  format:Mask:255.255.255.0    sscanf($commandRet[0],\"Mask:%s\",$maskstr);}\n不多说 ：\n\n#3 任意修改防火墙策略/admin/add_fire_wall.php\n\n这里也有 /admin/add_ikev2.php#4 任意文件下载/admin/cert_download.php\n<?php$filename = substr($file,strpos('certs/',$certfile)+6);//文件的类型header('Content-type: application/pdf');//下载显示的名字header('Content-Disposition: attachment; filename=\"'.$filename.'\"');readfile(\"$certfile\");exit();?>\n#5 N多SQL注入漏洞\n/admin/config_Anticrack.php?GroupId=111/admin/config_ISCGroupNoCache.php?GroupId=111/admin/config_ISCGroupSSLCert.php?GroupId=111/admin/config_ISCGroupTimePolicy.php\nGroupId参数没有过滤造成SQL注入选择其一证明：\n\n#6其他SQL注入，太多了SQL注入漏洞/admin\\config_MT.php?action=delete&Mid=1  Mid/admin/count_host.php 该页多个参数存在注入漏洞  比如：主机名/admin/count_user.php 该页多个参数存在注入漏洞  比如：用户名/admin/edit_fire_wall.php?FireWallId=111    FireWallId参数/admin/edit_user_login.php 该页面多个参数存在SQL注入漏洞/admin/export_excel_user.php SQL注入漏洞#7多个命令执行漏洞：/admin/detail_tunel.php\npassthru(\"/sbin/ipsec statusall |grep $tunnelname\");$temp1=explode(\"{\",$tunnelname);exec(\"/sbin/ipsec statusall | grep \".$temp1[0].\"[{[]\", $readStr);\n太多了。。。任意文件下载/commonplugin/Download.php?reqfile=Download's filename任意命令执行：/commonplugin/DownloadWebCert.php$conv = \"/Isc/third-party/openssl/bin/openssl pkcs12 -export -in \" . $CertFile . \" -inkey \" . $KeyFile . \" -passin pass:\" . $pass .\" -passout pass:\" . $pass . \" -out \" . $P12OutFile;unset($result);exec(\"sudo \" . $conv, $result, $error);其中pass参数可控/commonplugin/getsysdatetime.phpif($changetime!=\"\"){  exec(\"sudo date -s '$changetime'\");  exec(\"sudo /sbin/hwclock --systohc\");  exec(\"sudo rm ../admin/drawpic/cpu.data ../admin/drawpic/cputime.data\");}/debug/list_logfile.php  这个文件非常重要，但多个参数可造成任意命令执行/debug/rproxy_diag.php 这个文件也有同样的问题case \"delete\":\t$count = count($logfile);\tif($count <=0)\t\tshow_error(\"未选择操作数据行!\");\tfor($i = 0; $i<$count; $i++)\t{\t\t$del = \"sudo rm -f \".$logfile[$i];\t\tsystem($del);\t}\tredirect(\"list_logfile.php\");\tbreak;case \"showlicense\": ... ...case \"restartservice\":\t$command = \"sudo /etc/init.d/\".$bash.\" stop\";\texec($command);\t$command = \"sudo /etc/init.d/\".$bash.\" start\";\texec($command);\tredirect(\"list_logfile.php\");\tbreak;case \"advlogfalse\":任意命令执行/debug/show_logfile.phpexec(\"sudo cat $filename\",$read);  //filename可控SQL注入/WebPages/applyhardware.php 多个参数存在SQL注入/WebPages/applyhardware.php?action=applyhardware&hard_user=%2527 (双编码即可)/WebPages/history.php uid参数SQL注入$query=\"select SessionId from ISCOnLineUser where SessionId=$uid\";/WebPages/singlelogin.php 多个参数SQL注入如：/WebPages/singlelogin.php?submit=1&loginid=11'   漏洞证明：  严重提示一下，/admin、目录下的程序几乎全部都存在SQL注射漏洞，太多了只能一句话概括了。   修复方案：  感觉可以重新改写代码了..   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-05-01 22:06 厂商回复： 4月29日，网康收到CNVD漏洞细节通知，迅速启动并同时展开了以下工作：1.进一步验证漏洞细节，目前已确认所曝漏洞确实存在于ASG产品；2.对全线产品进行安全自查，重点确认ASG产品是否仍存其它未知漏洞，并验证类似漏洞是否同存于其它产品线，截至目前，自查工作仍在进行中，全线产品暂未发现新的漏洞；3.开发用于漏洞修补的更新程序，将尽快发布应急补丁包，介时用户可通过操作设备管理界面直接安装该更新程序以对所曝漏洞进行应急性修补；4.售后服务部通过内部CRM系统导出全部ASG用户名单，并开始逐一联系用户通报漏洞情况，补丁包发布后，将再次逐一通知所有用户及时安装更新，此项工作预计3工作日内完成；5.为避免统计疏漏，工程部于4月30日16:00向CNVD共享了在线ASG设备的辨识方法，将配合CNVD共同开展在线设备的主动探测工作，一旦发现未更新补丁的在线设备，将联系并协助用户及时更新，此项工作预计10工作日内完成；6.将尽快向社会开放漏洞提交邮箱，接受第三方机构、白帽子及其它组织、个人向网康提交产品漏洞，向所有帮助网康产品进步的组织和人士表示感谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-30 14:23 |    \t\t计算姬 \t\t\t( 普通白帽子  |\t\t\t        Rank:398 漏洞数:90        | 看我看我看我啊)\t\t \n  火前留名    \n     2014-04-30 14:38 |    \t\tCoffee \t\t\t( 普通白帽子  |\t\t\t        Rank:144 漏洞数:15        | Corie, a student of RDFZ.)\t\t \n  没有五一了哈哈    \n     2014-04-30 15:44 |    \t\tF3K4 \t\t\t( 普通白帽子  |\t\t\t        Rank:121 漏洞数:49        | 木秀于林，风必摧之)\t\t \n  LZ你妈妈叫你回家吃饭了......    \n     2014-04-30 16:28 |    \t\tMoc \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:12        | 屌丝何苦为难屌丝)\t\t \n  楼层太高了就买不起了    \n     2014-06-14 14:43 |    \t\tbey0nd \t\t\t( 普通白帽子  |\t\t\t        Rank:895 漏洞数:142        | 相忘于江湖，不如相濡以沫)\t\t \n  感觉可以重新改写代码了..    \n     2014-06-15 21:11 |    \t\tゼ羽人 \t\t\t( 路人 |\t\t\t        Rank:15 漏洞数:4        | Forward...)\t\t \n  简直不能再bug了。。    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}