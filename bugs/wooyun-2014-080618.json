{"id": 49643, "wybug_id": "wooyun-2014-080618", "wybug_title": "U-Mail sql注射获取敏感信息", "wybug_corp": "cncert国家互联网应急中心", "wybug_author": "menmen519", "wybug_date": "2014-10-26 23:27", "wybug_open_date": "2015-01-24 23:28", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射漏洞利用技巧", "源码分析"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-10-26：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-10-31：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-11-03：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-12-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-04：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-14：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-24：\t细节向公众公开  简要描述： U-Mail sql注射获取敏感信息 详细说明：  o_concat.php:\nif ( ACTION == \"add-search-contact\" ){\t\t\t\t$grp = $_POST['grp'];\t\t\t\t$type = $_POST['stype'];\t\t\t\t$userids = $_POST['userids'];\t\t\t\t$user_arr = explode( \",\", $userids );\t\t\t\t$group_list = explode( \",\", $grp );\t\t\t\tif ( $type == \"oab\" || $type == \"oabshare\" )\t\t\t\t{\t\t\t\t\t\t\t\tif ( $user_arr )\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\tforeach ( $user_arr as $userid )\t\t\t\t\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$user_info = $Mailbox->getUserInfoByID( ( integer )$userid, \"*\", 0 );\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$data = array(\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"user_id\" => $user_id,\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"fullname\" => $user_info['realname'],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"birthday\" => $user_info['birthday'],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"pref_email\" => $user_info['email'],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"pref_tel\" => $user_info['mobil'],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"im_qq\" => $user_info['qqmsn'],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"im_msn\" => $user_info['qqmsn'],\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"updated\" => date( \"Y-m-d H:i:s\" )\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$contact_id = $PAB->add_contact( $data, 0 );\n第一步 :先从用户信息里面获取相关信息\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$user_info = $Mailbox->getUserInfoByID( ( integer )$userid, \"*\", 0 );第二步 :$contact_id = $PAB->add_contact( $data, 0 );这样一来 就产生了二次注入我们修改用户信息：\n\n然后我们访问url:http://192.168.47.132/webmail/client/pab/index.php?module=operate&action=add-search-contactpostdata:grp=xxxx&stype=oabshare&userids=3然后我们查看联系人列表：\n\n   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-10-31 17:41 厂商回复：   最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-02-08 10:50 |    \t\terror \t\t\t( 普通白帽子  |\t\t\t        Rank:415 漏洞数:96        )\t\t \n  敢问洞主单引号不会被转义吗？？    \n     2015-02-08 11:12 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:762 漏洞数:146        | http://menmen519.blog.sohu.com/)\t\t \n  @error 哥，这是二次注入    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}