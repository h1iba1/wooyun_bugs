{"id": 83070, "wybug_id": "wooyun-2015-0149012", "wybug_title": "网站安全狗敏感信息泄露(windows+apache)", "wybug_corp": "安全狗", "wybug_author": "路人甲", "wybug_date": "2015-10-27 12:16", "wybug_open_date": "2015-12-17 14:48", "wybug_type": "设计错误/逻辑缺陷", "wybug_level": "中", "wybug_rank_0": "8", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-27：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-27：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-30：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-21：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-31：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2016-01-10：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-12-17：\t细节向公众公开  简要描述： 网站安全狗（APACHE版）for Windows 3.5.11730 详细说明：  网站安全狗官方规则（安装完后的默认漏洞防护规则）存在泄漏的风险，可以被其他waf厂家参考，也可以被攻击者参考以更有针对性地绕过安全狗的防护。测试环境：网站安全狗（APACHE版）for Windows测试主程序版本：3.5.11730测试环境：vmware Windows xp sp3，apache+php+mysql集成环境测试过程：安全狗的防护规则是可以在线更新的，会从安全狗官方更新网站上下载，但是这个dat文件是经过加密混淆的，另外，在安装后，服务器管理员也不能直接通过安全狗界面来看到这些官方的规则，如下图：\n\n所以想估计在内存里是没经过处理的，于是使用内存读取或者动态调试软件加载安全狗主进程，通过搜索关键词，找到了防护规则（正则表达式）所在的内存区域：\n\n附部分规则（已模糊化处理）：\nSql17=<meta…….SCRIPT&gt;){1}.*\">Sql18=<script…….{0,100}>Sql19=HTTP_RANGE:bytes…….Sql2=(;|'|\\)|\\d|\\s) …….false|true|\\d+)\\bSql20=WFXSSProbeSql21=\\b(concat|group_concat…….Sql22=\\b(create|drop)\\ …….Sql23=\\b(create|drop…….Sql24=\\b(create|drop|backup…….Sql25=\\b…….\\s+\\btable\\b\\s+\\w*Sql26=\\bBULK…….bwith\\b.*Sql27=\\balter\\b.*\\bdatabase\\b.*Sql28=\\bcopy. …….*(from|to).*Sql29=\\bdbo\\.\\w+Sql3=(……(and|or|having)……*Sql30=\\bdeclare\\b……Sql31=\\bdelete……from\\b\\s+.*Sql32=\\bexec……Sql33=\\bextractvalue……Sql34=\\bgrant……\\b.*Sql35=\\binsert……\\b.*Sql36=\\bmyappadmin\\.adduser\\……Sql37=\\bpg_sleep\\(\\d+\\)Sql38=\\bselect\\……(from|benchmark|into)\\b.*Sql39=\\bselect……Sql4=(;|'|\\)|\\d|\\s)……(\\d+\\)……………………Sql52=data:text/plain,\\s*<\\?Sql53=data:text/plain;base64Sql54=onMouseOver\\s*=\\s*alertSql55=php://filterSql56=php://inputSql6=/\\.svn/text-base/……\n供安全狗工作人员确认用。   漏洞证明：  \nSql17=<meta…….SCRIPT&gt;){1}.*\">Sql18=<script…….{0,100}>Sql19=HTTP_RANGE:bytes…….Sql2=(;|'|\\)|\\d|\\s) …….false|true|\\d+)\\bSql20=WFXSSProbeSql21=\\b(concat|group_concat…….Sql22=\\b(create|drop)\\ …….Sql23=\\b(create|drop…….Sql24=\\b(create|drop|backup…….Sql25=\\b…….\\s+\\btable\\b\\s+\\w*Sql26=\\bBULK…….bwith\\b.*Sql27=\\balter\\b.*\\bdatabase\\b.*Sql28=\\bcopy. …….*(from|to).*Sql29=\\bdbo\\.\\w+Sql3=(……(and|or|having)……*Sql30=\\bdeclare\\b……Sql31=\\bdelete……from\\b\\s+.*Sql32=\\bexec……Sql33=\\bextractvalue……Sql34=\\bgrant……\\b.*Sql35=\\binsert……\\b.*Sql36=\\bmyappadmin\\.adduser\\……Sql37=\\bpg_sleep\\(\\d+\\)Sql38=\\bselect\\……(from|benchmark|into)\\b.*Sql39=\\bselect……Sql4=(;|'|\\)|\\d|\\s)……(\\d+\\)……………………Sql52=data:text/plain,\\s*<\\?Sql53=data:text/plain;base64Sql54=onMouseOver\\s*=\\s*alertSql55=php://filterSql56=php://inputSql6=/\\.svn/text-base/……\n   修复方案：  1）增加反调试功能；2）在内存中对正则加密和解密，可能会影响到web服务的运行效率，这套程序本身而言也是免费给大家用的，你们自己看着办，哈哈..   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：7  确认时间：2015-10-27 13:54 厂商回复： 感谢提交 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 7, "Ranks": null}