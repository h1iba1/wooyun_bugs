{"id": 16060, "wybug_id": "wooyun-2012-013351", "wybug_title": "人人网内网信息泄露+主站任意文件读取", "wybug_corp": "人人网", "wybug_author": "pysolve", "wybug_date": "2012-10-14 20:57", "wybug_open_date": "2012-11-28 20:57", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-10-14：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-10-19：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-10-29：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-11-08：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-11-18：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-11-28：\t细节向公众公开  简要描述： 剑总说不和没乌云币的人说话，为了找剑总办事，我只好来提交漏洞了。= =、人人网某处限制存在问题，导致内网信息泄露以及主站任意文件读取。 详细说明：  Author：pysolve人人网首页分享功能：\n\n分享127.0.0.1，出现如下这段话“你的浏览器不支持javascript，这会导致你不能正常使用人人， 点击这里 ，教你调整你的浏览器。……”\n\n从上图可以得出：1、可以输入127.0.0.1分享并且分享成功。2、猜测链接预览功能是后端采用了curlib库或类似的来实现的，取回response内容，然后反馈给用。由于不是浏览器，所以不支持js，触发<noscript>标签，也就有了上图这段话。由此可以产生一个内网信息泄露漏洞：分享内网的ip地址，如果该ip开放了web服务的话，通过链接预览就产生了信息泄露。毕竟内网ip段太广，我们直接用js来实现一个“扫描器”来扫描（代码略）。效果如下：\n\n内网信息泄露的部分截图如下：\n\n\n\n为避免信息再次泄露，图中ip地址已打码，但从172.21和172.18可以判断出确实是为内网ip。继续发散思路：1、内网中可能会有一些重要的web系统不加任何验证，我们在找到一个ip后，提交http://172.xx.xx.xx/admin.do http://172.xx.xx.xx:8080等等来试探是否还有信息泄露。例如上面的case，通过提交http://172.18.xx.xx/web/device/login?lang=1返回的信息可以判断出是H3C的web端\n\n而如果此web端有认证绕过或其他的漏洞的话，则又会泄露更多的信息。主站任意文件读取：上面我们猜测后端调用了curlib或类似的方法来实现链接预览，而curl是支持多种协议的，不仅仅是HTTP、HTTPS，比如ftp。恰恰人人网链接预览这里对协议没做限制就交给后端处理了，所以我们还可以通过构造ftp://xx.xx.xx.xx来试探内网的匿名FTP。但这不是重点，重点是curl还支持本地文件协议file://,截图如下：\n\nroot！   漏洞证明：  见上！   修复方案：  修复建议：1、限制url不能为内网地址2、限制只能为http、https协议   版权声明：转载请注明来源 pysolve@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2012-10-19 10:00 厂商回复： 添加对漏洞的补充说明以及做出评价的理由 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-10-14 20:58 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  学习！    \n     2012-10-14 21:49 |    \t\tWebSPRing \t\t\t( 普通白帽子  |\t\t\t        Rank:176 漏洞数:18        | Focus on Web Security (wspringox@gmail.c...)\t\t \n  原来你之前一直没在wooyun提交过啊    \n     2012-10-14 22:24 |    \t\tHRay \t\t\t( 普通白帽子  |\t\t\t        Rank:196 漏洞数:28        | 018)\t\t \n  这个看题目太给力了，关注！    \n     2012-10-14 22:28 |    \t\tiiiiiiiii \t\t\t( 普通白帽子  |\t\t\t        Rank:680 漏洞数:89        | )\t\t \n  ...    \n     2012-10-14 23:11 |    \t\t闪电小子 \t\t\t( 实习白帽子  |\t\t\t        Rank:63 漏洞数:5        | PKAV技术宅社区！---闪电小子！)\t\t \n  关注    \n     2012-10-14 23:41 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  @xsser 乌云现在更新好慢    \n     2012-10-14 23:46 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @zzR 虾米意思？    \n     2012-10-15 00:12 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @zzR 如果你指内容，我只能说人人都是乌云的一部分，所以乌云慢可以先看看自己 ：）    \n     2012-10-15 08:57 |    \t\tValo洛洛 \t\t\t( 普通白帽子  |\t\t\t        Rank:458 漏洞数:52        | 。)\t\t \n  mark    \n     2012-10-15 09:52 |    \t\tzeracker  \t\t\t( 核心白帽子 |\t\t\t        Rank:1068 漏洞数:137        | 多乌云、多机会!微信公众号: id:a301zls   ...)\t\t \n  我勒去。主站    \n     2012-10-15 10:08 |    \t\tgoderci \t\t\t( 普通白帽子  |\t\t\t        Rank:542 漏洞数:47        | http://www.yunday.org)\t\t \n  @WebSPRing QM?    \n     2012-10-15 10:11 |    \t\tpysolve \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | Time is killing u when ur killing time!)\t\t \n  @goderci 楼上的90后x阔 求别曝光我身份    \n     2012-10-15 10:13 |    \t\tpysolve \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | Time is killing u when ur killing time!)\t\t \n  @xsser 剑总求加精 顺路求通过团队（团队名xcl0ud）    \n     2012-10-15 10:15 |    \t\tpysolve \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | Time is killing u when ur killing time!)\t\t \n  @WebSPRing 之前用另外个ID提交过一次过    \n     2012-10-15 10:18 |    \t\tgoderci \t\t\t( 普通白帽子  |\t\t\t        Rank:542 漏洞数:47        | http://www.yunday.org)\t\t \n  @pysolve 牛掰团队 求加入~    \n     2012-10-15 10:22 |    \t\tFlyR4nk \t\t\t( 普通白帽子  |\t\t\t        Rank:119 漏洞数:18        )\t\t \n  什么情况    \n     2012-10-15 10:34 |    \t\tpysolve \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | Time is killing u when ur killing time!)\t\t \n  @FlyR4nk QL？我是QM，@WebSPRing 是QH    \n     2012-10-15 11:09 |    \t\tG8dSnow \t\t\t( 路人 |\t\t\t        Rank:21 漏洞数:5        | 一直在学习技术、分享知识的路上)\t\t \n  我想知道…看着就眼馋啊    \n     2012-10-16 09:37 |    \t\t鬼魅羊羔 \t\t\t( 普通白帽子  |\t\t\t        Rank:299 漏洞数:42        | (#‵′)凸(#‵′)凸(#‵′)凸(#‵′)凸(#‵...)\t\t \n  霸气的标题，坐等公布~~~    \n     2012-10-16 09:38 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  要火，我信洞主    \n     2012-10-16 10:40 |    \t\tcnrstar \t\t\t( 普通白帽子  |\t\t\t        Rank:157 漏洞数:23        | Be my personal best!)\t\t \n  围观基友，洞主威武~    \n     2012-10-22 09:39 |    \t\tpysolve \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | Time is killing u when ur killing time!)\t\t \n  这处理速度，未免也慢点了吧。    \n     2012-11-08 10:06 |    \t\tzzR  \t\t\t( 核心白帽子 |\t\t\t        Rank:1382 漏洞数:122        | 收wb   1：5 无限量收   [平台担保])\t\t \n  第一次见，还能这样哪，受教了    \n     2012-11-08 19:48 |    \t\ticefish \t\t\t( 普通白帽子  |\t\t\t        Rank:104 漏洞数:8        | 欢迎大家和我用邮件进行交流~)\t\t \n  很棒的思路.    \n     2012-11-08 20:01 |    \t\tyy520 \t\t\t( 普通白帽子  |\t\t\t        Rank:139 漏洞数:12        )\t\t \n  受教了，很不错的思路    \n     2012-11-09 00:27 |    \t\t猪头子 \t\t\t( 普通白帽子  |\t\t\t        Rank:189 漏洞数:35        | 自信的看着队友rm -rf/tar挂服务器)\t\t \n  受教了！    \n     2012-11-09 10:58 |    \t\tHRay \t\t\t( 普通白帽子  |\t\t\t        Rank:196 漏洞数:28        | 018)\t\t \n  终于可以看这个漏洞了，大饱眼福！    \n     2012-11-09 16:36 |    \t\tsaline \t\t\t( 普通白帽子  |\t\t\t        Rank:231 漏洞数:32        | Focus On Web Secur1ty)\t\t \n  确实啊！思路决定出路    \n     2012-11-15 13:38 |    \t\tpysolve \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | Time is killing u when ur killing time!)\t\t \n  附上博文一篇  http://hi.baidu.com/pysolve/item/c0f745ec69683bec2a09a4b7    \n     2012-11-15 13:42 |    \t\tqiaoy \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:16        )\t\t \n  新颖！    \n     2012-11-15 13:43 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @pysolve 这个相当不错鸟 很多的都有问题的说    \n     2012-11-28 21:21 |    \t\tpopok \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:24        | nothing)\t\t \n  诶哟屌爆了    \n     2012-11-28 21:22 |    \t\tpopok \t\t\t( 普通白帽子  |\t\t\t        Rank:117 漏洞数:24        | nothing)\t\t \n  诶哟屌爆了    \n     2012-11-28 22:44 |    \t\tErrorera \t\t\t( 普通白帽子  |\t\t\t        Rank:112 漏洞数:21        | 我们应该在犯错误的情况下学习！)\t\t \n  dz我们合体吧 人人内网权限在手－ －＃    \n     2012-11-29 08:07 |    \t\tSh1ne \t\t\t( 路人 |\t\t\t        Rank:5 漏洞数:1        | With great power comes great responsibil...)\t\t \n  牛人。@mole3o    \n     2012-11-29 09:10 |    \t\tw5r2 \t\t\t( 普通白帽子  |\t\t\t        Rank:226 漏洞数:52        )\t\t \n  niu!    \n     2012-11-29 10:03 |    \t\tpangshenjie \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:14        )\t\t \n  学习了。    \n     2012-11-29 11:48 |    \t\tDuking \t\t\t( 路人 |\t\t\t        Rank:1 漏洞数:1        | 懒人啦~~)\t\t \n  经典。。。。    \n     2012-11-29 11:52 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  洞主请和我联系来获得10月份最佳洞主的奖品    \n     2012-11-29 13:52 |    \t\t冷冷的夜 \t\t\t( 普通白帽子  |\t\t\t        Rank:135 漏洞数:12        )\t\t \n  学习了    \n     2012-11-29 15:17 |    \t\tpysolve \t\t\t( 路人 |\t\t\t        Rank:17 漏洞数:3        | Time is killing u when ur killing time!)\t\t \n  @xsser 剑总我爱你    \n     2012-11-30 15:11 |    \t\thorseluke \t\t\t( 普通白帽子  |\t\t\t        Rank:116 漏洞数:18        | Realize the dream in earnest.)\t\t \n  缺陷关联： WooYun: 人人网的分享网页功能存在诸多安全漏洞  厂商在同一类漏洞反复出现编码失误？    \n     2012-11-30 16:47 |    \t\timlonghao \t\t\t( 普通白帽子  |\t\t\t        Rank:730 漏洞数:74        )\t\t \n  nice!!!!!!!    \n     2012-12-02 13:30 |    \t\tStream \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 低头要有勇气，抬头要有底气!)\t\t \n  good    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}