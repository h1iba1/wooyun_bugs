{"id": 999, "wybug_id": "wooyun-2014-072858", "wybug_title": "北京语言大学内网漫游记(大面积沦陷)", "wybug_corp": "北京语言大学", "wybug_author": "蓝冰", "wybug_date": "2014-08-18 15:38", "wybug_open_date": "2014-10-02 15:40", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(CCERT教育网应急响应组)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["渗透测试思路", "安全意识不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-18：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-22：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-09-01：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-09-11：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-09-21：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-02：\t细节向公众公开  简要描述： 真实记录渗透过程看在写这么认真的份上 求首页(可否打雷啊) 0.0 详细说明：  之所以选择北语作为渗透目标 源于我发的第一个漏洞 WooYun: 城市热点任意下载漏洞+不安全因素+弱口令 前几天去看了下 发现漏洞还存在 不过这回把数据库端口放在了内网 从外面连不了数据库于是想到搞到一个服务器权限进行内网渗透先对北京语言大学进行了IP段扫描 基本上活跃的服务器段为202.112.192.1-254202.112.200.1-254接下来对这些IP进行测试,很快的找到一个科研主页存在struts2漏洞#1 http://kyc.blcu.edu.cn/xmsb/indexAction!to_index.action\n\n管理员权限 都不用提权了 加上一个帐号(lanbing lanbing) 接下来就是转发3389端口然后 利用hd ,Htran等工具做sockes代理 然后用sockes客户口端进入北语的内网破解系统帐号(administrator z***nm)#2 然后连接北语的城市热点数据库(参照上面发的链接)\n\n现在有了全校师生的上网数据库 可以想让谁断网就让谁断其中密码的加密是ASCII加密 顺便贴上python解密代码#!/usr/bin/env python#coding=utf-8def myindex(shadow):    j = 1    i = 1    while True:        if shadow<i:            break          j = j*2        i = i+1       return jdef password(word):    shift1 = 0    shift2 = 0    value = 0    str_len = len(word)    i = 0    while True:        ch = ord(word[i])         value ^=ch*myindex(shift1)        value ^=ch*myindex(shift2)        shift1 = (shift1+7)%19        shift2 = (shift2+13)%23        i = i+1        if i >= str_len:            break    value = (value^0x18901)%100537    return valuedef decode(text):    key = password(\"TblRefreshCurMonthServiceUse\")    str_len = len(text)-1    i = 0    to_text = []    while True:        if i>=str_len:            break        ch = ord(text[i])        if (ch>=32) and (ch<=126):            i = i+1            ch = ch-32            offset =96.0*(key*i%100537/100537.0)            ch = (ch-int(offset))%95            if ch<0:               ch = ch+95            ch = ch+32            i = i-1            to_text.append(chr(ch))        i = i+1    return to_texttext = raw_input(\"密文：\")to_text = decode(text)print \"明文：%s\" % ''.join(to_text)想批量解密 稍微改一下即可接下来继续扫描IP段 快速的过一遍能拿的都拿下来 在这过程中拿到下面几个系统#3 http://caiwu.blcu.edu.cn/zhcx/ 财务系统存在IIS 写权限漏洞利用老兵写的工具上传一个webshell 找到sa权限密码连接数据库利用xp_cmdshell扩展 添加一个帐号 提权成功(sa  密码samoashi,添加的系统帐号lanbing haohao..0123,administrator的密码 SamoaShi) 发现大量webshell 目测被搞多次了\n\n利用此思路对IP段进行 IIS写权限批量检测 发现只有这一个存在漏洞 悲哀!#4 http://202.112.200.185/ 网首IT运维系统 该系统以前进去过,它有默认帐号密码 sysadmin 1****在机房管理 添加机房然后 在机房图上传一个.php的webshell 即可#5 http://202.112.192.235/default.aspx 弱口令 admin 1***6 住宿管理系统(学生宿舍信息)#6 http://202.112.200.248/frameset.html 弱口令  admin a**n 未知#7 http://202.112.200.131/softwarer/admin/index.asp admin \n\nmask 区域\n**********\n\nadmin 计算机技能学习系统弱口令还真是多啊 下一步 对IP段进行各个端口的弱口令检测 拿到#8 202.112.200.144 1433弱口令 sa \n\nmask 区域\n*****45*****\n\n 目测是OA系统的备份数据库#9 oa.blcu.edu.cn OA系统 3389弱口令 123 \n\nmask 区域\n*****2*****\n\n 破解其余帐号(admin  \n\nmask 区域\n*****03*****\n\n) 1433弱口令 sa \n\nmask 区域\n*****45*****\n\n#10 http://admission.blcu.edu.cn/userfiles/1.asp;(1).jpg 留学生北语网fckeditor 漏洞利用uploadtest.html 上传webshell(未提权)现在有了教师的OA数据 接下来尝试去拿学生的敏感数据在一卡通查询主页上 发现oracle注入一枚(可脱库)#11 http://ecard.blcu.edu.cn/selfsearch/Index_ShowNews.aspx?NewsCode=331\n\n#12 http://yx.blcu.edu.cn/ http://lx.blcu.edu.cn/ 迎新和离校系统同一个服务器在公告连接处有oracle注入(bulletinId参数) 同样可脱\n\n继续扩大战果 在这之前把之前收集下来的密码加上一些弱口令对3389和22端口进行爆破最后失败了没拿到一台T_T然后我瞄上了数字校园系统#13 http://i.blcu.edu.cn/ 刚上线的系统 身份统一认证也就说只要拿到了这个系统 那么基本上学校的全线业务系统都会相应的沦陷 未登陆前目测没啥搞头 所以得想办法拿到一个登陆帐号密码点开登陆说明\n\n存在默认密码 但是需要身份正  刚好城市热点的数据库和一卡通数据库里有 证件号和学号,职工号就这样成功拿到一个普通权限的帐号密码登陆进去 进行漏洞挖掘最后在公共咨询台搜索处发现post注入一枚\n\nsqlmap跑起来 有很多数据库然后在usr_imp数据库里找到了该数据库的连接信息\n\n用oracle连接工具连接 查找user表 可是蛋疼了 翻了所有数据库竟然都找不到密码表好吧去这个系统的官网去看看 然后加了客服妹子\n\n无果(周六发的貌似休息呢)继续看官网 在产品描述中看到这样的信息\n\n数据库存储除了有关系型数据库(平常常用的)外还有LDAP数据库ldap好象在usr_imp数据库的某个表里见过 翻出来一看正是LDAP数据库的连接信息\n\n不过密码加密方式不知道是啥 然后破解出了这个表中的一串md5为wiscom我想密码应该一样最后成功连接 查看密码(SSHA加密 不能去cmd5破解悲剧了)\n\n成功拿下数据库校园系统 涉及的系统有 人事,科研，教务，财务，OA，学工，校园卡，就业，邮箱，等多个系统都可以直接访问到\n\n接下来继续扩大战果,思路是找到网络中心的人的ID 破解密码登陆数字校园查看邮箱里的敏感数据(ARP虽然很有效,但太危险了,就不尝试了)在数字北语主页处发现 问题咨询QQ群 果断加进去\n\n现在有了网络中心的姓名利用拿到的各数据库查询ID 先破解群主的吧用hashcat破解SSHA加密hash(费太多时间所以只进行了短密码的破解)成功破解出群主的数字校园密码 然后成功查看邮箱(eyou)在联系人处找到了齐全的网络中心管理员表 然后进行破解后成功登陆几个管理员的数字校园接下来就是收集信息了\n\n\n\n(urpdb2)之前数字校园数据库的SID是urpdb1 我想这个数据库也是跟数字校园有关系 现在IP有了果断用一样的帐号密码去尝试登陆果然成功登陆..接下来翻到了教务系统服务器的信息\n\n教务系统一共有三个IP 202.112.200.221 222 223成功以root权限登陆然后发现管理员发给各个子学院网站管理员ID和密码 也就是北语主站的管理权限http://wwwnew.blcu.edu.cn/jcms 找到一个没有改密码的您的用户名是：baoyuehong   密码是：\n\nmask 区域\n*****11*****\n\n/jcms/m_5_9/sendreport/downfile.jsp?filename=/etc/passwd&savename=passwd.txt任意下载漏洞不一样的是 该版本需要登陆后才能下载然后成功下载shadow和数据库连接池root:$1$1gQLNIXR$aQLvI8BLg4/z2a9S3KG801:15397:0:99999:7:::oracle:$1$Ft2cFcn7$3u6T2F8sQqrDrXNClwX5M/:15548:0:99999:7:::<something-else-entirely><proxool><alias>1</alias><driver-url><![CDATA[ jdbc:oracle:thin:@127.0.0.1:1521:orcl ]]></driver-url><driver-class>oracle.jdbc.driver.OracleDriver</driver-class><driver-properties><property name=\"user\" value=\"jcms\"/><property name=\"password\" value=\"blcujcms\"/></driver-properties><minimum-connection-count>10</minimum-connection-count><maximum-connection-count>30</maximum-connection-count><test-before-use>true</test-before-use><house-keeping-test-sql>select 1 from dual</house-keeping-test-sql><dbtype>oracle</dbtype></proxool></something-else-entirely>太狠了! 数据库端口内网都给禁了..北语在线学习平台与数字化校园中间库202.112.200.211mysql5.5 库名fanya 链接账户fanya 密码\n\nmask 区域\n*****4-=*****\n\n  mysql端口38141\n\n不要想太多里面没有密码信息 可以拿这个进一步深入   漏洞证明：  已证明后续渗透思路未进行(挂上ARP 收集网络中心管理员和保卫处邮箱密码 保卫处有很大几率有监控器的一些信息 或者对拿到的数据库进行撞库破解) 安全是一个整体,我知道你们网络中心的最近忙着上线数字校园系统 不过安全问题也要重视哦加油审核大大求打雷可以吗   修复方案：  上面的渗透过程 应该看出问题所在了吧T_T   版权声明：转载请注明来源 蓝冰@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：6  确认时间：2014-08-22 08:36 厂商回复： 通知用户处理中 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-18 15:39 |    \t\t浩天  \t\t\t( 普通白帽子  |\t\t\t        Rank:915 漏洞数:79        | 度假中...)\t\t \n  首页，雷就算了    \n     2014-08-18 15:43 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  哈哈 好吧    \n     2014-08-18 15:52 |    \t\tdiguoji \t\t\t( 普通白帽子  |\t\t\t        Rank:323 漏洞数:79        | 中国吉林长春)\t\t \n  @蓝冰 求语言大学妹子资料 可否共享    \n     2014-08-18 15:54 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @diguoji  T_T 木有啊 把代理都删了    \n     2014-08-18 16:07 |    \t\tdiguoji \t\t\t( 普通白帽子  |\t\t\t        Rank:323 漏洞数:79        | 中国吉林长春)\t\t \n  @蓝冰 我知道你不方便说，短消息说吧，    \n     2014-08-18 16:19 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @diguoji 额 真没有 再说我脱库干啥啊     \n     2014-08-18 16:35 |    \t\t动后河 \t\t\t( 实习白帽子  |\t\t\t        Rank:51 漏洞数:13        | ☭)\t\t \n  前来学习一下内网渗透    \n     2014-08-18 17:07 |    \t\tcat73 \t\t\t( 实习白帽子  |\t\t\t        Rank:34 漏洞数:6        | 喵爱吃鱼, 喵要吃好多好多鱼~~地址栏输入...)\t\t \n  雷是通用漏洞- -    \n     2014-08-19 08:56 |    \t\tcharles_zhang \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 做一个爱学习的小白帽。)\t\t \n  内网渗透，很少搞过，也来看一下。    \n     2014-08-21 18:44 |    \t\tMoo \t\t\t( 路人 |\t\t\t        Rank:8 漏洞数:3        | PS：不打脸，还要泡妞呢)\t\t \n      \n     2014-08-22 11:04 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @ccert教育网应急响应组  6rank ..还不如分开来刷呢 你说呢    \n     2014-08-22 11:05 |    \t\t大大灰狼 \t\t\t( 普通白帽子  |\t\t\t        Rank:248 漏洞数:53        | Newbie)\t\t \n  @蓝冰 呵呵    \n     2014-08-22 11:17 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @ccert教育网应急响应组  WooYun: 北京科技大学内网渗透测试 WooYun: 一次简单的河北大学内网漫游 我不觉得我的比他们差多少 要数据有数据 我也不去计较rank的多少 只希望你们尽量做到公平些 本来还有一个洞没发 这个给的高点的话 还打算靠另一个洞升普通白帽子的. 没戏！    \n     2014-09-02 01:17 |    \t\t3King \t\t\t( 普通白帽子  |\t\t\t        Rank:1129 漏洞数:92        | 【study at HNUST】非常感谢大家的关注~ 大...)\t\t \n  思路不错，内容也丰富，给20应该完全可以的。    \n     2014-09-02 08:53 |    \t\t蓝冰 \t\t\t( 核心白帽子 |\t\t\t        Rank:627 漏洞数:50        | -.-)\t\t \n  @3King 大大的安慰啊    \n     2014-10-02 16:15 |    \t\tj14n \t\t\t( 普通白帽子  |\t\t\t        Rank:114 漏洞数:23        | 我是一只小小小小鸟....)\t\t \n  20rank     \n     2014-10-02 18:05 |    \t\tfuckadmin \t\t\t( 普通白帽子  |\t\t\t        Rank:476 漏洞数:72        | 千里之堤溃于蚁穴)\t\t \n  看这报告挺丰富的，得花不少时间吧，可惜给6个rank，起码40个rank的说~~~    \n     2014-10-03 17:20 |    \t\tTinko \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 大学ing…………)\t\t \n  好评！地大两个对面的学校都被攻陷了，地大四面楚歌啊    \n     2014-10-03 22:25 |    \t\t小卖部部长 \t\t\t( 路人 |\t\t\t        Rank:24 漏洞数:3        | 别拿部长不当干部！)\t\t \n  洞主这么厉害。居然才RANK 6？    \n     2014-10-04 20:32 |    \t\thkAssassin \t\t\t( 普通白帽子  |\t\t\t        Rank:358 漏洞数:66        | 我是一只毛毛虫。)\t\t \n  我是来安慰楼主的~~~随后代表wooyun送妹子一个，楼主莫伤心，继续加油。    \n     2014-10-31 20:48 |    \t\t橘子 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:3        | 呢个...羞射高中生一枚。带上大神@Haswell...)\t\t \n  这才6rank我也是醉了...    \n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 6, "Ranks": null}