{"id": 168, "wybug_id": "wooyun-2014-071921", "wybug_title": "用友协作办公平台通用SQL注入一枚外加配置信息泄漏漏洞", "wybug_corp": "用友软件", "wybug_author": "sex is not show", "wybug_date": "2014-08-12 14:17", "wybug_open_date": "2014-11-07 14:18", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "12", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注射"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-08-12：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-17：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-10-11：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-21：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-31：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-11-07：\t细节向公众公开  简要描述： RT 详细说明：  厂商：用友软件程序名称：FE协作办公平台漏洞类型：SQL注入（GET）漏洞文件：assetsGroupReport/vendorEval.jsp漏洞参数：unitCode=11&cVenCode=22&Date=2012-01-01是否需要登录：否关键字：intitle:FE协作办公平台涉及版本：5.5.2/5.5/5.2.1 (5.5.2及一下版本都存在)影响用户：\n\n源码分析：\n<%User user = (User) ResourceManage.getSession(\"User\");String unitCode=request.getParameter(\"unitCode\");String cVenCode=request.getParameter(\"cVenCode\");String Date=request.getParameter(\"Date\");if(unitCode==null || \"\".equals(unitCode)){\tunitCode=user.getUnitId().toString();}if(cVenCode==null || \"\".equals(cVenCode)){\tcVenCode=HtmlFormat.format(\"\");}if(Date==null || \"\".equals(Date)){\tDate=HtmlFormat.format(new Date());}FixedAssetsReport far=(FixedAssetsReport)ResourceManage.getContext(\"far\");DataTable dt=far.getVendorEval(cVenCode,Date,unitCode); //这里把参数直接带入getVendorEval方法中%>\n再来到getVendorEval方法：\npublic DataTable getVendorEval(String vCode, String dDate, String unitCode)  {    String sql = \"\";    if (1 == this.dao.getDataBaseType()) {      sql = \"select t.*,LastTotal-AvgTotal as status from (select ID,VENDOR_NAME,VENDOR_CODE,count(ID)as Num,sum(Total)as Total,sum(Total)/count(ID)as AvgTotal, (select (nvl(sum(EXEC_DEPT),0)+nvl(sum(USE_DEPT),0))/2 from \" +         this.dao.getTableName(\"ASSETS_ACCEPT_VENDOR\") + \" where NOTE_ID=(select max(ID) from \" + this.dao.getTableName(\"ASSETS_ACCEPT\") + \" where VENDOR_NAME=tb.VENDOR_CODE))as LastTotal from \" +         \" (select v.ID,v.VENDOR_NAME,v.VENDOR_CODE,(select (nvl(sum(EXEC_DEPT),0)+nvl(sum(USE_DEPT),0))/2 from \" + this.dao.getTableName(\"ASSETS_ACCEPT_VENDOR\") + \" where NOTE_ID=a.ID)as Total \" +         \" from \" + this.dao.getTableName(\"ASSETS_ACCEPT\") + \" a,\" + this.dao.getTableName(\"VENDOR_INFO\") + \" v where v.VENDOR_CODE=a.VENDOR_NAME and a.STATUS=2\";    }    else {      sql = \"select *,LastTotal-AvgTotal as status from (select ID,VENDOR_NAME,VENDOR_CODE,count(ID)as Num,sum(Total)as Total,sum(Total)/count(ID)as AvgTotal, (select (isnull(sum(EXEC_DEPT),0)+isnull(sum(USE_DEPT),0))/2 from \" +         this.dao.getTableName(\"ASSETS_ACCEPT_VENDOR\") + \" where NOTE_ID=(select max(ID) from \" + this.dao.getTableName(\"ASSETS_ACCEPT\") + \" where VENDOR_NAME=tb.VENDOR_CODE))as LastTotal from \" +         \" (select v.ID,v.VENDOR_NAME,v.VENDOR_CODE,(select (isnull(sum(EXEC_DEPT),0)+isnull(sum(USE_DEPT),0))/2 from \" + this.dao.getTableName(\"ASSETS_ACCEPT_VENDOR\") + \" where NOTE_ID=a.ID)as Total \" +         \" from \" + this.dao.getTableName(\"ASSETS_ACCEPT\") + \" a,\" + this.dao.getTableName(\"VENDOR_INFO\") + \" v where v.VENDOR_CODE=a.VENDOR_NAME and a.STATUS=2\";    }    if ((unitCode != null) && (!\"\".equals(unitCode))) {//只判断是否为null,参数直接拼接进SQL了      sql = sql + \" and a.UNITCODE='\" + getUnitCode(unitCode) + \"'\";    }    if ((vCode != null) && (!\"\".equals(vCode))) {//同上      sql = sql + \" and v.VENDOR_CODE='\" + vCode + \"'\";    }    if ((dDate != null) && (!\"\".equals(dDate))) {//同上      if (this.dao.getDataBaseType() == 1) {        if (dDate.length() > 10)          dDate = dDate.substring(0, 10);        sql = sql + \" and to_char(a.ACCEPT_DATE,'yyyy-mm-dd')<='\" + dDate + \"' \";      }      else {        sql = sql + \" and Convert(varchar(10),a.ACCEPT_DATE,120)<=Convert(varchar(10),'\" + dDate + \"',120) \";      }    }    sql = sql + \" )tb group by ID,VENDOR_NAME,VENDOR_CODE)t\";    return this.dao.getDataTable(sql, 1, 2147483647);  }\n参数未处理直接带入，导致注入产生。实例演示：1.集团版V5.5http://oa.ztcz.cn/assetsGroupReport/vendorEval.jsp?unitCode=11&cVenCode=22&Date=2012-01-01\n\n2.标准版V5.5http://oa.peizheng.net.cn/assetsGroupReport/vendorEval.jsp?unitCode=11&cVenCode=22&Date=2012-01-01\n\n3.FE协作办公平台  5.5.2http://oa.chinabed.com/assetsGroupReport/vendorEval.jsp?unitCode=11&cVenCode=22&Date=2012-01-01\n\n   漏洞证明：  4.FE协作办公平台  5.5.2http://oa.hzuf.com:9090/assetsGroupReport/vendorEval.jsp?unitCode=11&cVenCode=22&Date=2012-01-01\n\n5.FE协作办公平台  5.2.1http://www.gzpiano.com/assetsGroupReport/vendorEval.jsp?unitCode=11&cVenCode=22&Date=2012-01-01\n\n配置信息泄漏：1.集团版V5.5http://oa.peizheng.net.cn/admin/systemXml/system-bean.xml\n\n算是自己留的后门吗？FE协作办公平台  5.5.2http://oa.chinabed.com/admin/systemXml/system-bean.xmlhttp://www.elkay.com.cn/admin/systemXml/system-bean.xmlhttp://gzwnq.88ip.cn:9090/admin/systemXml/system-bean.xmlV5.5http://oa.nyinn.cn/admin/systemXml/system-bean.xml\n\n不一一截图了   修复方案：  参数过滤   版权声明：转载请注明来源 sex is not show@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-11-07 14:18 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-08-12 14:18 |    \t\tU神 \t\t\t( 核心白帽子 |\t\t\t        Rank:1285 漏洞数:142        | 感谢乌云，知恩不忘，其实我一直都在乌云默...)\t\t \n  一般用友的通用漏洞不都是前台吗？    \n     2014-11-07 16:44 |    \t\t纠结师 \t\t\t( 实习白帽子  |\t\t\t        Rank:53 漏洞数:12        | 传说中的废材)\t\t \n  为啥跳转登陆呢。。    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}