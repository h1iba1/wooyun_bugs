{"id": 35147, "wybug_id": "wooyun-2015-0108067", "wybug_title": "艾普宽带某站奇葩时间手工盲注漏洞", "wybug_corp": "艾普宽带", "wybug_author": "大懒", "wybug_date": "2015-04-15 19:46", "wybug_open_date": "2015-05-30 22:08", "wybug_type": "SQL注射漏洞", "wybug_level": "中", "wybug_rank_0": "9", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": [], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-04-15：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-04-15：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2015-04-25：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-05-05：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-05-15：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-05-30：\t细节向公众公开  简要描述： 艾普宽带某站奇葩时间盲注两枚，sqlmap无法识别其数据库。 详细说明：  首先放出两枚存在问题的URL1.http://cd.aipu.com/m_news.php?id=2.http://cd.aipu.com/weixiu/?are=首先扫到该注入点，放到sqlmap准备跑一跑，结果给我看这个\n\n我开始还以为是误报，然后手工看了下\n\n\n\n确定是有注入点的，然后脑补了一下，难道是我跟不上潮流了，有什么新的高大上的数据库出来了，然后用手工确定是不是mysql\n\n是的啊，看报错界面\n\n也是的哇为什么sqlmap不出来，难道是有waf或者是厂商自己写了过滤器？就先往下尝试(select length(user()))=*\n\n\n\n\n\n确定用户长度是17那就一个一个尝试吧，后来在手工的过程中逐步确认了可能的原因举个例子ELT((ASCII(SUBSTR(user(),3,1)))>118,SLEEP(2))\n\nELT((ASCII(SUBSTR(user(),3,1)))>119,SLEEP(2))\n\n本来应该是这样美好的判断是119的，然而重复提交几次119请求结果发现了一次延时，对，没错就是延时\n\n于是我在想为什么哇，于是我在115至120之间每一个数字都重复提交多次，结果是这样的115-118之间不过提交多少次都是延时，而119-120重复提交多次有一次延时。奇葩啊，怪不得工具跑不出来，这种特例需要针对性的写工具才行，需要重复的判断，根据大量请求来稳定概率。   漏洞证明：  由于是延时 由于是手工就尝试推举user的前四位ELT((ASCII(SUBSTR(user(),1,1)))>109,SLEEP(2))\n\nELT((ASCII(SUBSTR(user(),1,1)))>110,SLEEP(2))\n\n110   n按照ELT((ASCII(SUBSTR(user(),*,1)))>109,SLEEP(2))在*出不断的加1，然后推出前四位是newa   修复方案：  1.结构化查询sql语句2.过滤对业务没有影响的特殊字符3.针对这个漏洞应该过滤特殊函数，如果对业务有影响就用规则来过滤   版权声明：转载请注明来源 大懒@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：中 漏洞Rank：5  确认时间：2015-04-15 22:07 厂商回复： 感谢您提交漏洞 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "中", "wybug_rank_fromcorp": 5, "Ranks": null}