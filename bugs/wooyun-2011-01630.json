{"id": 23286, "wybug_id": "wooyun-2011-01630", "wybug_title": "PIPI播放器溢出漏洞", "wybug_corp": "皮皮网", "wybug_author": "冰雪风谷[NNU", "wybug_date": "2011-03-17 17:39", "wybug_open_date": "2011-03-22 18:00", "wybug_type": "远程代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["缓冲区溢出", "栈溢出"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2011-03-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2011-03-22：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 皮皮播放器在处理用户输入的URL时，没有对其长度进行检测，从而造成溢出 详细说明：  皮皮播放器在处理用户输入的URL时，没有对其进行长度检测。从而造成溢出。不过，由于有GS，利用的时候有些困难\ncase 32780:      v9 = *(_DWORD *)(wParam + 4096);      v22 = 0;      v21 = v9;      *(_DWORD *)(wParam + 6344) = 1;      sub_40D480(v21, v22);      v42 = 5;      if ( CDialog::DoModal(&v31) == 1        && ATL::CStringT<char_StrTraitMFC_DLL<char_ATL::ChTraitsCRT<char>>>::Find(&v32, \"://\", 0) > 0 )      {        v10 = (const char *)ATL::CSimpleStringT<char_1>::operator char_const__(&v32);        if ( strnicmp(v10, \"ppfilm://\", 9u)     // 对输入的内容，比较前9位是否为ppfilm://          && (v11 = (const char *)ATL::CSimpleStringT<char_1>::operator char_const__(&v32), strnicmp(v11, \"pvod://\", 7u)) )        {          v22 = 0;          v21 = v12;          v29 = &v21;          ATL::CStringT<char_StrTraitMFC_DLL<char_ATL::ChTraitsCRT<char>>>::CStringT<char_StrTraitMFC_DLL<char_ATL::ChTraitsCRT<char>>>(            &v21,            &Default);          v20 = v13;          v28 = &v20;          LOBYTE(v42) = 6;          ATL::CStringT<char_StrTraitMFC_DLL<char_ATL::ChTraitsCRT<char>>>::CStringT<char_StrTraitMFC_DLL<char_ATL::ChTraitsCRT<char>>>(            &v20,            &Default);          v18 = v14;          *(_DWORD *)&Drive = &v18;          v41 = 7;          ATL::CStringT<char_StrTraitMFC_DLL<char_ATL::ChTraitsCRT<char>>>::CStringT<char_StrTraitMFC_DLL<char_ATL::ChTraitsCRT<char>>>(&v18);          LOBYTE(v42) = 5;          sub_4304F0(v3, v19, v20, v21, v22);        }        else        {          CommandLine = 0;          memset(&v34, 0, 0x1FCu);          v35 = 0;          v36 = 0;          sprintf(&CommandLine, \"%s%s \\\"%s\\\"\", dword_48AF30, \"jfCacheMgr.exe\", v32); //将输入的内容，直接调用sprintf函数，将其组合好的内容存放到CommandLine变量。          memset(&StartupInfo, 0, sizeof(StartupInfo));          ProcessInformation.hProcess = 0;          ProcessInformation.hThread = 0;          ProcessInformation.dwProcessId = 0;          ProcessInformation.dwThreadId = 0;          StartupInfo.cb = 68;          CreateProcessA(0, &CommandLine, 0, 0, 0, 0, 0, 0, &StartupInfo, &ProcessInformation);          if ( ProcessInformation.hThread )            CloseHandle(ProcessInformation.hThread);          if ( (_DWORD)ProcessInformation.hProcess )            CloseHandle(ProcessInformation.hProcess);        }      }      *(_DWORD *)(v3 + 6344) = 0;      v42 = -1;      result = sub_40D500(&v31);      break;\n//////////////////////////////////////////////////////////////对传入的url没有进行检测，直接调用sprintf(&CommandLine, \"%s%s \\\"%s\\\"\", dword_48AF30, \"jfCacheMgr.exe\", v32);函数，然后把url的值赋给CommandLine值,从而造成溢出。我们可以看到，在函数开始的地方，text:00430C20                 push    ebp.text:00430C21                 mov     ebp, esp.text:00430C23                 and     esp, 0FFFFFFF8h.text:00430C26                 push    0FFFFFFFFh.text:00430C28                 push    offset SEH_430C20.text:00430C2D                 mov     eax, large fs:0.text:00430C33                 push    eax.text:00430C34                 mov     large fs:0, esp.text:00430C3B                 sub     esp, 5F8h//一共分配了0x5F8大小的栈。   漏洞证明：  我们构造如下URL：“ppfilm://AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA”在皮皮播放器处点击，播放URL，将其输入，可以看到如下图：\n\n   修复方案：  对用户输入的URL进行长度限制   版权声明：转载请注明来源 冰雪风谷[NNU@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2011-03-22 18:00 厂商回复：  漏洞Rank：12  (WooYun评价) 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2011-03-22 18:05 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  这个不错哇    \n     2011-03-22 22:25 |    \t\t冰雪风谷[NNU \t\t\t( 实习白帽子  |\t\t\t        Rank:45 漏洞数:4        | no)\t\t \n  无影响厂商忽略，无语啊。    \n     2011-09-23 22:51 |    \t\tQQ852451559 \t\t\t( 实习白帽子  |\t\t\t        Rank:79 漏洞数:18        | 学生党)\t\t \n  溢出牛啊。    \n     2011-10-25 15:52 |    \t\t霍家二爷 \t\t\t( 实习白帽子  |\t\t\t        Rank:63 漏洞数:7        | 我撸管这么牛逼还是没妞喜欢我)\t\t \n  哈哈。。这个太牛了，被厂商无视了    \n     2012-01-18 21:48 |    \t\tsaga \t\t\t( 路人 |\t\t\t        Rank:11 漏洞数:2        | 世界上只有10种人，懂二进制的，和不懂二进...)\t\t \n  厂商只做产品，只要程序员不出“八阿哥”，一切就ok，不做安全。    \n     2012-11-18 17:12 |    \t\tzhq445078388 \t\t\t( 实习白帽子  |\t\t\t        Rank:60 漏洞数:19        | 请牢记\"杀进程点康姆\")\t\t \n  皮皮..话说这玩意有远程输入功能么? 比如从网页拉取? 如果存在 可能扩展成远程代码执行..如果不存在..那本地代码执行么亲..还真没啥影响    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}