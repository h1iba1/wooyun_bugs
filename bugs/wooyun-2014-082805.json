{"id": 43413, "wybug_id": "wooyun-2014-082805", "wybug_title": "PHPMyWind最新版代码执行漏洞", "wybug_corp": "phpmywind.com", "wybug_author": "xfkxfk", "wybug_date": "2014-11-11 19:01", "wybug_open_date": "2014-12-30 14:44", "wybug_type": "命令执行", "wybug_level": "高", "wybug_rank_0": "15", "wybug_status": "漏洞已经通知厂商但是厂商忽略漏洞", "wybug_from": "http://www.wooyun.org", "wybug_tags": "", "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2014-11-11：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2014-11-16：\t厂商主动忽略漏洞，细节向第三方安全合作伙伴开放\t\t\t\t\t\t\t\t\t2015-01-10：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2015-01-20：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2015-01-30：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2014-12-30：\t细节向公众公开  简要描述： PHPMyWind最新版代码执行漏洞，可GetShell 详细说明：  PHPMyWind最新版代码执行漏洞，可GetShellPHPMyWind的整个系统权限分为：\n超级管理员站点管理员文章发布员普通用户\n此漏洞点在文章发布员权限，有点门槛，但是门槛不高，一个文章发布员还是很好拿下的文件good_save.php\n//添加商品信息if($action == 'add'){\t//栏目权限验证\tIsCategoryPriv($classid,'add');\t//初始化参数\tif(!isset($typeid))        $typeid = '-1';\tif(!isset($brandid))       $brandid = '-1';\tif(!isset($attrid))        $attrid = '';\tif(!isset($attrvalue))     $attrvalue = '';\tif(!isset($flag))          $flag   = '';\tif(!isset($picarr))        $picarr = '';\tif(!isset($rempic))        $rempic = '';\tif(!isset($remote))        $remote = '';\tif(!isset($autothumb))     $autothumb = '';\tif(!isset($autodesc))      $autodesc = '';\tif(!isset($autodescsize))  $autodescsize = '';\tif(!isset($autopage))      $autopage = '';\tif(!isset($autopagesize))  $autopagesize = '';\t$attrstr = '';......//商品属性\tif(is_array($attrid) && is_array($attrvalue))\t{\t\t//组成商品属性与值\t\t$attrstr .= 'array(';\t\t$attrids = count($attrid);\t\tfor($i=0; $i<$attrids; $i++)\t\t{\t\t\t$attrstr .= '\"'.$attrid[$i].'\"=>'.'\"'.$attrvalue[$i].'\"'; \t\t\tif($i < $attrids-1)\t\t\t{\t\t\t\t$attrstr .= ',';\t\t\t}\t\t}\t\t$attrstr .= ');';\t}......$sql = \"INSERT INTO `$tbname` (classid, parentid, parentstr, typeid, typepid, typepstr, brandid, brandpid, brandpstr, title, colorval, boldval, flag, goodsid, payfreight, weight, attrstr, marketprice, salesprice, housenum, housewarn, warnnum, integral, source, author, linkurl, keywords, description, content, picurl, picarr, hits, orderid, posttime, checkinfo {$fieldname}) VALUES ('$classid', '$parentid', '$parentstr', '$typeid', '$typepid', '$typepstr', '$brandid', '$brandpid', '$brandpstr', '$title', '$colorval', '$boldval', '$flag', '$goodsid', '$payfreight', '$weight', '$attrstr', '$marketprice', '$salesprice', '$housenum', '$housewarn', '$warnnum', '$integral', '$source', '$author', '$linkurl', '$keywords', '$description', '$content', '$picurl', '$picarr', '$hits', '$orderid', '$posttime', '$checkinfo' {$fieldvalue})\";\tif($dosql->ExecNoneQuery($sql))\t{\t\theader(\"location:$gourl\");\t\texit();\t}\n这里在添加商品时，商品的属性内容进入数据库后是一个数组，以数组形式存储的如：\narray(\"1\"=>\"111\",\"2\"=>\"111\");\n文件goodsshow.php\n<div class=\"TwoOfTwos\"> \t\t<!-- 详细区域开始 -->\t\t<div class=\"goodsConts\">\t\t\t<?php\t\t\t//检测文档正确性\t\t\t$r = $dosql->GetOne(\"SELECT * FROM `#@__goods` WHERE id=$id\");\t\t\tif(@$r)\t\t\t{\t\t\t//增加一次点击量\t\t\t$dosql->ExecNoneQuery(\"UPDATE `#@__goods` SET hits=hits+1 WHERE id=$id\");\t\t\t$row = $dosql->GetOne(\"SELECT * FROM `#@__goods` WHERE id=$id\");\t\t\t?>\t\t\t<h1 class=\"title\"><?php echo $row['title']; ?></h1>......<!-- 商品信息开始 -->\t\t\t\t<div class=\"fr\">\t\t\t\t\t<ul class=\"tb-meta\">\t\t\t\t\t\t<li> <span>市场价</span><strong class=\"lt\"><?php echo $row['marketprice']; ?></strong>元 </li>\t\t\t\t\t\t<li> <span>促销价</span><strong class=\"price\"><?php echo $row['salesprice']; ?></strong>元 </li>\t\t\t\t\t\t<li> <span>浏览数</span><?php echo $row['hits']; ?> 次</li>\t\t\t\t\t\t<li> <span>配　送</span><?php if($row['payfreight']==0){echo '买家承担运费';}else{echo '商家承担运费';} ?></li>\t\t\t\t\t</ul>\t\t\t\t\t<div class=\"tb-skin\">\t\t\t\t\t\t<p class=\"tb-note-title\"><span>请选择您要的商品信息</span><a href=\"shoppingcart.php\" class=\"end\">结算购物车</a></p>\t\t\t\t\t\t<form name=\"gform\" id=\"gform\" method=\"post\">\t\t\t\t\t\t\t<dl class=\"tb-prop\">\t\t\t\t\t\t\t<?php\t\t\t\t\t\t\t//将商品属性id与值组成数组\t\t\t\t\t\t\t$rowattr = String2Array($row['attrstr']);\t\t\t\t\t\t\t$row2 = $dosql->Execute('SELECT * FROM `#@__goodsattr` WHERE `goodsid`='.$row['typeid'].\" AND `checkinfo`=true\");\t\t\t\t\t\t\tif($dosql->GetTotalRow() > 0)\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t$i = 0;\t\t\t\t\t\t\t\twhile($row2 = $dosql->GetArray())\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t?>\n从这里看出，这里在显示商品信息时，看这里\n//将商品属性id与值组成数组$rowattr = String2Array($row['attrstr']);\n跟进String2Array函数，文件common.func.php\n/*字符串转数组*/if(!function_exists('String2Array')){\tfunction String2Array($data)\t{\t\tif($data == '') return array();\t\t@eval(\"\\$array = $data;\");\t\treturn $array;\t}}\n这里强制将字符串转成数组，使用eval函数整个过程由于商品属性信息进入数据库时，没有过滤，在现实商品信息时，也没有处理导致在通过eval时，导致代码执行漏洞   漏洞证明：  文章发布员可以添加商品：\n\n在文章属性处添加商品属性：如：\n111|222{${phpinfo()}}\n然后在商品展示页面：\n\n   修复方案：     版权声明：转载请注明来源 xfkxfk@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：无影响厂商忽略 忽略时间：2014-12-30 14:44 厂商回复：  最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2014-11-11 21:48 |    \t\tBadCat \t\t\t( 实习白帽子  |\t\t\t        Rank:81 漏洞数:21        | 悲剧的我什么都不会)\t\t \n  前排围观    \n     2014-11-12 16:09 |    \t\t_Evil \t\t\t( 普通白帽子  |\t\t\t        Rank:418 漏洞数:59        | 万事无他,唯手熟尔。农民也会编程,别指望天...)\t\t \n  前排围观    \n     2015-09-12 16:05 |    \t\tBeenQuiver \t\t\t( 普通白帽子  |\t\t\t        Rank:101 漏洞数:26        | 专注而高效，坚持好的习惯千万不要放弃)\t\t \n  666    \n  \n\n\n", "wybug_level_fromcorp": "无影响厂商忽略", "wybug_rank_fromcorp": 0, "Ranks": null}